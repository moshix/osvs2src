         TITLE 'IFG019RA--OPEN/CLOSE/EOV/DADSM SERVICE ROUTINE'  YM3066 00200002
IFG019RA CSECT                                                          00400021
*********************************************************************** 00500021
*                                                                     * 00600021
*     VS2 RELEASE 037 DELETIONS/CHANGES/ADDITIONS                     * 00620037
* D188800-189600                                               @ZA20900 00640037
*C210600,241000,248620,248791                                  @ZA30676 00650037
*                                                                     * 00660037
*                                                                     * 00700021
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00800002
*0000                                                           Y30ASJC 00905000
*0000513843,515300                                             @ZA00113 00910002
*0000489800,499100                                             @ZA00114 00950002
*0000                                                          @ZA01283 00960002
*0000199600,200600-201800,202400                               @ZA01491 00970002
*0000200910,200922,597430-597490                               @ZA02166 00980002
*0000                                                          @ZA02177 00990002
*0000                                                          @ZA15963 00995037
*          VS2 RELEASE 03 DELETIONS/CHANGES                           * 01000037
*0000                                                          @ZA03157 01020037
*0000                                                          @ZA01348 01040037
*          VS2 RELEASE 03.7 DELETIONS/CHANGES                         * 01060037
*0000516600,517000-517200                                      @ZA13574 01080037
*0000                                                          @ZA18282 01100037
*0000                                                          @ZA18282 01110037
*********************************************************************** 01120002
*                                                                       01130002
* MODULE NAME = IFG019RA (OS/VS2)                                       01140002
*                                                                       01150002
* DESCRIPTIVE NAME = OPEN/CLOSE/EOV/DADSM SERVICE ROUTINE               01160002
*                                                                       01170002
* COPYRIGHT = NONE                                                      01180002
*                                                                       01190002
* STATUS = CHANGE LEVEL 000                                             01200002
*                                                                       01210002
* FUNCTION = IFG019RA PERFORMS THE FOLLOWING SERVICES FOR THE OPEN,     01220002
*            CLOSE, END OF VOLUME, AND DADSM MODULES:                   01230002
*            - WAIT                                                     01240002
*            - SELECT-LOAD                                              01250002
*            - DCB SYNCHRONIZATION                                      01260002
*            - QMNGRIO                                                  01270002
*            - LOAD AND BRANCH                                          01280002
*            - LOAD AND RETURN                                          01290002
*            - GET A WORK AREA                                          01300002
*            - GET WTG/EOV WORK AREA                                    01310002
*            - GET FIRST WORK AREA                                      01320002
*            - INITIALIZE A PREFIX=FIRST WORK AREA                      01330002
*            - INITIALIZATION AND/OR COPY A DCB                         01340002
*            - FREE A WORK AREA                                         01350002
*            - FREE FIRST OR WTG/EOV WORK AREA                          01360002
*            - USER EXIT                                                01370002
*                                                                       01380002
*                                                                       01390002
*      WAIT, SELECT-LOAD, LOAD AND BRANCH, LOAD AND RETURN, AND DCB     01400002
*      SYNCHRONIZATION FACILITIES:                                      01410002
*                                                                       01420002
*      THE WAIT, SELECT-LOAD, AND DCB SYNCHRONIZATION FACILITIES OF     01430002
*      THE SERVICE ROUTINE PERFORM THE FUNCTION OF AN INPUT/OUTPUT      01440002
*      SUPERVISOR FOR THE OPEN, CLOSE, AND EOV COMPONENTS, ESSENTIALLY  01450002
*      ALLOWING THESE COMPONENTS TO PROCESS PARALLEL DCB'S IN A SERIAL  01460002
*      MANNER WITHIN PARTICULAR MODULES.  THESE FACILITIES CONTROL      01470002
*      PROCESSING BY ISSUING ALL WAIT'S, LOADS, AND SWITCHING DCB'S     01480002
*      TO BE PROCESSED BY MODIFYING REGISTERS.                          01490002
*                                                                       01500002
*      A MODULE DESIRING TO ISSUE A WAIT FOR A DCB BRANCHES TO THE      01510002
*      SERVICE ROUTINE FOR THIS PURPOSE.  THE SERVICE ROUTINE THEN      01520002
*      RETURNS TO THE MODULE WITH ANOTHER DCB IMMEDIATELY, RATHER       01530002
*      THAN ISSUING A WAIT.  WHEN ALL DCB'S HAVE A WAIT PENDING,        01540002
*      THE SERVICE ROUTINE ISSUES A MULTIPLE WAIT.  ON RETURN FROM      01550002
*      THE WAIT, THE FIRST DCB IN THE PARAMETER LIST WHICH IS POSTED    01560002
*      IS SELECTED FOR PROCESSING. THIS ALLOWS OVERLAP OF I/O BETWEEN   01570002
*      DCB'S IN THE MODULE.                                             01580002
*                                                                       01590002
*      RATHER THAN A DCB ISSUING A LOAD WITHIN A MODULE, THE DCB        01600002
*      INDICATES WHICH MODULE IT WOULD LIKE TO LOAD BY PLACING THAT     01610002
*      MODULE'S TWO BYTE MODULE ID AND ENTRY POINT ADDRESS (EPA) IN     01620002
*      ITS WHERE-TO-GO (WTG) TABLE ENTRY AND BRANCHING TO IFG019RA,     01630002
*      WHICH THEN CHECKS WHETHER ANY DCB'S REMAIN IN NEED OF THE        01640002
*      CURRENT MODULE (IT CHECKS WHETHER ANY DCB'S ARE 'ACTIVE').       01650002
*      IT DOES THIS BY COMPARING THE MODULE ID'S IN THE WTG TABLE       01660002
*      BASIC SECTION AND THE WTG TABLE DCB ENTRY.  IF THE ID'S MATCH,   01670002
*      THE DCB IS ACTIVE.                                               01680002
*                                                                       01690002
*      AN ACTIVE DCB IS RETURNED TO THE MODULE.  IF NONE IS ACTIVE,     01700002
*      THE ID THAT IS LOWEST IN COLLATING SEQUENCE OF THE ID'S IN       01710002
*      THE WTG ENTRIES IS FOUND, AND A LOAD AND BRANCH IS EFFECTED      01720002
*      TO THAT MODULE.                                                  01730002
*                                                                       01740002
*      IN SOME INSTANCES, SUCH AS INTERFACING WITH MODULES NOT USING    01750002
*      THE SERVICE ROUTINE, IT IS DESIRABLE TO EXIT FROM THE SERVICE    01760002
*      ROUTINE'S CONTROL OF DCB LOOPING, ETC.  THIS IS ACCOMPLISHED BY  01770002
*      THE DCB SYNCHRONIZATION FACILITY OF THE SERVICE ROUTINE, WHICH   01780002
*      OPERATES SIMILARLY TO THE WAIT FACILITY.  RATHER THAN THE DCB    01790002
*      IN CONTROL IN A MODULE BRANCHING TO THE SERVICE ROUTINE FOR A    01800002
*      WAIT, A BRANCH IS TAKEN FOR A PSEUDO-WAIT.  IN THIS CASE, WHEN   01810002
*      ALL DCB'S FOR THIS MODULE HAVE PSEUDO-WAITS, A WAIT IS NOT       01820002
*      ISSUED, BUT CONTROL IS RETURNED TO THE MODULE, WITH REGISTERS    01830002
*      POINTING TO THE FIRST ACTIVE DCB IN THE OPEN/CLOSE PARAMETER     01840002
*      LIST.  THIS ENSURES THAT ALL DCB'S ACTIVE IN THE MODULE HAVE     01850002
*      COMPLETED EXECUTION UP TO THAT POINT AND EFFECTIVELY EXITS FROM  01860002
*      SERVICE ROUTINE CONTROL.                                         01870002
*                                                                       01880002
*      A DUMMY DCB IS INDICATED BY A MODULE ID OF X'00'.  THIS WILL     01890002
*      RESULT IN THE DCB NEVER BEING ACTIVE, AS NO MODULE HAS AN ID     01900002
*      EQUAL TO X'00'.                                                  01910002
*                                                                       01920002
*      IF THE SERVICE ROUTINE IS ENTERED FOR A LOAD AND A GTF TRACE IS  01930002
*      REQUESTED FOR THE DCB ENTERING THE SERVICE ROUTINE, THE TRACE    01940002
*      ROUTINE (IFG019TR) IS CALLED BY THE SERVICE ROUTINE VIA A BALR.  01950002
*      THE TRACE ROUTINE RETURNS CONTROL TO THE SERVICE ROUTINE AT      01960002
*      THE LINK ADDRESS AFTER TRACING REGISTER AND STORAGE CONTENTS.    01970002
*                                                                       01980002
*      THE THREE LOAD FACILITIES ARE BRANCH=QUEUED (SELECT-LOAD),       01990002
*      BRANCH=DIRECT (LOAD & BRANCH), AND BRANCH=NO (LOAD & RETURN).    02000002
*                                                                       02010002
*      IECRES LOAD,BRANCH=QUEUED IS USED BY OPEN/CLOSE/EOV WHEN         02020002
*      CONTROL IS TO BE PASSED TO ANOTHER OPEN/CLOSE/EOV MODULE.        02030002
*      IT FIRST RESETS THE WAIT BIT.  THEN, IF A GTF TRACE WAS          02040002
*      REQUESTED, IT GIVES CONTROL TO THE TRACE ROUTINE (IFG019TR).     02050002
*      IT THEN LOOKS FOR A WTG TABLE ENTRY WITH THE CALLING MODULE'S    02060002
*      ID.  IF FOUND, IT GIVES IT CONTROL.  OTHERWISE, IT FINDS         02070002
*      THE MODULE ID WITH THE LOWEST COLLATING SEQUENCE AMONG THE       02080002
*      WTG TABLE ENTRIES AND GIVES IT CONTROL.                          02090002
*                                                                       02100002
*      IECRES LOAD, BRANCH=QUEUED, BRANCH=DIRECT, OR BRANCH=NO          02110002
*      FIRST LOCATES THE ENTRY POINT ADDRESS OF THE MODULE SPECIFIED    02120002
*      IN WTGMODNM.  IF WTGMODEP IS ZERO, IT BRANCHES TO THE ACTIVE     02130002
*      LPA SEARCH SERVICE ROUTINE (IEAQCDSR) AND POSSIBLY TO THE LPA    02140002
*      SEARCH SERVICE ROUTINE (IEAVVMSR) TO FIND THE ENTRY POINT        02150002
*      ADDRESS.  IF NEITHER OF THESE ROUTINES CAN LOCATE THE MODULE,    02160002
*      IT ISSUES THE LOAD MACRO ON SYS1.SVCLIB.  FOR BRANCH=DIRECT,     02170002
*      CONTROL IS PASSED TO THE SPECIFIED MODULE.  FOR BRANCH=NO,       02180002
*      CONTROL IS RETURNED TO THE CALLING MODULE WITH THE EPA IN        02190002
*      WTGMODEP.                                                        02200002
*                                                                       02210002
*      BEFORE PERFORMING THE LOAD, A TEST IS MADE TO DETERMINE IF       02220002
*      THE WTGMODEP FIELD IS NON-ZERO.  IF SO, IT IS ASSUMED THAT       02230002
*      THE EPA IS ALREADY KNOWN AND CONTROL WILL RETURN                 02240002
*      IMMEDIATELY TO THE CALLING MODULE.  IF THE CALL TO LOAD          02250002
*      HAS COME FROM THE SELECT-LOAD OR LOAD AND BRANCH ENTRY OF        02260002
*      THIS MODULE, THIS WILL RESULT IN A BRANCH TO THE ADDRESS         02270002
*      IN 'WTGMODEP'.                                                   02280002
*                                                                       02290002
*                                                                       02300002
*      QMNGRIO FACILITY -                                               02310002
*                                                                       02320002
*      THE QMNGRIO ROUTINE ISSUES THE QMNGRIO MACRO TO 'READ' OR        02330002
*      'WRITE' THE JFCB IN SWA.                                         02340002
*                                                                       02350002
*                                                                       02360002
*      GET FACILITY -                                                   02370002
*                                                                       02380002
*      THE GET FACILITY HAS FOUR FUNCTIONS:                             02390002
*      1. IT CAN GET A SINGLE WORK AREA WITH OR WITHOUT PREFIX;         02400002
*      2. IT CAN GET AN EOV WORK AREA OR A WTG TABLE (OPEN/CLOSE);      02410002
*      3. IT CAN GET A FIRST WORK AREA FOR DADSM OR TASK CLOSE;         02420002
*      4. IT CAN INITIALIZE THIS WORK AREA FOR DADSM OR TASK CLOSE.     02430002
*                                                                       02440002
*      IECRES GET,PREFIX=YES OR =NO OR EXTPR=ADDR IS ENTERED BY         02450002
*      OPEN/CLOSE/EOV/DADSM MODULES TO GET STORAGE OTHER THAN FOR       02460002
*      A WTG TABLE OR FIRST WORK AREA. IT ISSUES THE GETMAIN MACRO      02470002
*      AND ZEROS THE STORAGE.  IT BUILDS A PREFIX AND CHAINS THE        02480002
*      WORK AREA IF REQUESTED.                                          02490002
*                                                                       02500002
*      IECRES GET,PREFIX=WTG OR =EOV GETS THE FIRST WORK AREA FOR       02510002
*      THE O/C/E MODULES.  IT GETS A SINGLE ENTRY WTG TABLE AND         02520002
*      WORK AREA FOR EOV OR A VARIABLE-LENGTH WTG TABLE FOR OPEN        02530002
*      AND CLOSE.  THE STORAGE IT REQUESTS INCLUDES A PREFIX,           02540002
*      EXTENDED PREFIX, WTG TABLE, RECOVERY ROUTINE PARAMETER LIST,     02550002
*      DCB PARAMETER LIST, WORK AREA USED BY IFG019RA, AND A TRACE      02560002
*      BUFFER, IF REQUESTED.  AFTER ISSUING THE GETMAIN MACRO, IT       02570002
*      ZEROS THE STORAGE AND BUILDS THE PREFIX.  IT THEN ENQUEUES       02580002
*      ON THE TIOT AND ISSUES THE ESTAE MACRO TO ESTABLISH THE          02590002
*      ADDRESS OF THE O/C/E/D RECOVERY ROUTINE OR THE ADDRESS OF        02600002
*      THE SECOND LEVEL RECOVERY ROUTINE IF THE WORK AREA IS BEING      02610002
*      OBTAINED FOR THE FIRST LEVEL O/C/E/D RECOVERY ROUTINE.           02620002
*                                                                       02630002
*      IECRES GET,PREFIX=FIRST IS ENTERED BY THE DADSM FUNCTIONS OR     02640002
*      BY TASK CLOSE TO GET STORAGE FOR THE MAIN WORK AREA.  THE        02650002
*      ROUTINE ADDS THE LENGTH OF A PREFIX, EXTENDED PREFIX, AND        02660002
*      RECOVERY ROUTINE PARAMETER LIST TO THE REQUESTED AMOUNT OF       02670002
*      SPACE.  AFTER ISSUING THE GETMAIN MACRO, IT ZEROS THE            02680002
*      STORAGE AND BUILDS THE PREFIX.                                   02690002
*                                                                       02700002
*      THE SECOND ENTRY OF IECRES GET,PREFIX=FIRST INITIALIZES          02710002
*      THE WTO LENGTH FIELD IN THE PSEUDO WTG TABLE AND ISSUES          02720002
*      THE ESTAE MACRO TO ESTABLISH THE ADDRESS OF THE O/C/E/D          02730002
*      OR TASK CLOSE RECOVERY ROUTINE.                                  02740002
*                                                                       02750002
*                                                                       02760002
*      INITIALIZATION/DCB COPY FACILITY -                               02770002
*                                                                       02780002
*      THE INIT/DCB COPY FACILITY PERFORMS TWO BASIC FUNCTIONS:         02790002
*      1 CERTAIN POINTERS IN THE OPEN/CLOSE/EOV WORK AREA ARE           02800002
*        INITIALIZED;                                                   02810002
*      2 THE DCB COPY FUNCTION IS PERFORMED.                            02820002
*                                                                       02830002
*      THE FIELDS WHICH ARE INITIALIZED BY THE INIT FUNCTION ARE:       02840002
*            DXUKEY   KEY OF CALLER OBTAINED FROM RESUME PSW IN         02850002
*                     SVRB                                              02860002
*            DXASCBAD ADDRESS OF ASCB                                   02870002
*            DXTCBADR ADDRESS OF TCB                                    02880002
*            DXJSCBAD ADDRESS OF ACTIVE JSCB POINTED TO BY JSCBACT      02890002
*                     IN THE JSCB POINTED TO BY THE TCB                 02900002
*            DXDSABQD ADDRESS OF DSAB QUEUE DESCRIPTOR BLOCK FROM       02910002
*                     THE ACTIVE JSCB                                   02920002
*            DXDSABAD ADDRESS OF DSAB FOR THE DCB/ACB BEING             02930002
*                     PROCESSED - OBTAINED FROM THE DEB EXTENSION       02940002
*                     OR BY SEARCHING THE DSAB CHAIN USING THE          02950002
*                     DCBDDNAM                                          02960002
*            DXDSAB   ADDRESS OF CURRENT DSAB. SAME AS DXDSABAD         02970002
*            DXDEBXAD ADDRESS OF DEB EXTENSION IF THE DCB IS OPEN       02980002
*            DXTIOTAD ADDRESS OF TIOT ENTRY FOR DCB BEING PROCESSED     02990002
*                     OBTAINED FROM THE DSAB OBTAINED AS                03000002
*                     STATED ABOVE                                      03010002
*            DXUCBADR ADDRESS OF UCB - FIRST UCB ADDRESS IN THE         03020002
*                     TIOT ENTRY OBTAINED AS STATED ABOVE IF THE        03030002
*                     DCB IS CLOSED; FIRST UCB ADDRESS IN THE DEB       03040002
*                     IF THE DCB IS OPEN AND THE DSORG IS NOT IS;       03050002
*                     SECOND UCB ADDRESS IN THE DEB IF THE DCB IS       03060002
*                     OPEN AND THE DSORG IS ISAM.                       03070002
*                                                                       03080002
*                                                                       03090002
*      FREE WORK AREA FACILITY -                                        03100002
*                                                                       03110002
*      THE FREE WORK AREA FACILITY HAS TWO FUNCTIONS:  IT CAN FREE      03120002
*      A SINGLE WORK AREA, OR IT CAN FREE A CHAIN OF WORK AREAS.        03130002
*                                                                       03140002
*      IECRES FREE DECHAINS THE WORK AREA BEING RELEASED IF A           03150002
*      PREFIX IS PRESENT.                                               03160002
*                                                                       03170002
*      IECRES FREE,PREFIX=WTG, =EOV, OR =FIRST DEQUEUES THE             03180002
*      TIOT IF IT WAS ENQUEUED DURING THE GETMAIN ROUTINE AND           03190002
*      DELETES THE RECOVERY ROUTINE ENVIRONMENT THAT WAS                03200002
*      ESTABLISHED AT THAT TIME.  IT THEN RELEASES THE INITIAL          03210002
*      WORK AREA AND ALL WORK AREAS CHAINED FROM THE INITIAL WORK AREA. 03220002
*                                                                       03230002
*                                                                       03240002
*      USER EXIT FACILITY -                                             03250002
*                                                                       03260002
*      IF THE PROTECT KEY INDICATED IN BITS 0-3 AT DXUKEY               03270002
*      IN THE OPEN/CLOSE/EOV WORK AREA POINTED TO BY REG 4              03280002
*      IS 7 OR LESS, THAT KEY WILL BE ASSUMED AND THE USER              03290002
*      EXIT WILL BE BRANCHED TO. OTHERWISE, THE SYNCH SVC 12            03300002
*      WILL BE USED TO PASS CONTROL TO THE USER EXIT.                   03310002
*                                                                       03320002
*      DXTCBADR IN THE OPEN/CLOSE/EOV WORK AREA WILL BE USED            03330002
*      TO LOCATE THE CURRENT SVRB. IF DXUKEY IS 8 OR GREATER            03340002
*      (USER IS NOT A SYSTEM ROUTINE) THE PREVIOUS RB IS                03350002
*      INSPECTED TO SEE IF IT IS A PRB (BITS 0 AND 1 OF RBSATB          03360002
*      SET TO 0). IF SO, THE REGISTERS 2-13 PASSED TO THE USER          03370002
*      EXIT WILL BE LOADED FROM THE CURRENT SVRB'S REGISTER             03380002
*      SAVE AREA. IF THE PREVIOUS RB IS NOT A PRB, THE RB               03390002
*      CHAIN WILL BE SEARCHED FOR A PRB. WHEN THE PRB MOST              03400002
*      RECENTLY IN CONTROL IS FOUND, THE REGISTERS 2-13 PASSED          03410002
*      TO THE USER EXIT ARE LOADED FROM THE SVRB WHICH THE              03420002
*      PRB PASSED CONTROL TO. IF NO PRB IS FOUND, OR IF                 03430002
*      DXUKEY IS 7 OR LESS, THE REGISTERS ARE LOADED FROM THE           03440002
*      CURRENT SVRB.                                                    03450002
*                                                                       03460002
*      REGISTERS 2-13 ARE SAVED ACROSS THE USER EXIT IN THE             03470002
*      CURRENT SVRB'S EXTENDED SAVE AREA. HENCE, THE USER EXIT          03480002
*      ROUTINE MUST NOT USE IT.                                         03490002
*                                                                       03500002
*      IMMEDIATELY BEFORE PASSING CONTROL TO THE USER EXIT,             03510002
*      BIT RRFUSREX IS SET TO 1 IN RRFLAGS1 IN THE RECOVERY             03520002
*      ROUTINE PARAMETER LIST.  UPON RETURN, IT IS RESET.               03530002
*                                                                       03540002
*                                                                       03550002
* NOTES = SEE BELOW                                                     03560002
*                                                                       03570002
*      DEPENDENCIES = THE EBCDIC CHARACTER SET WAS USED FOR ASSEMBLY.   03580002
*                     THE MODULE MUST BE REASEEMBLED IF A DIFFERENT     03590002
*                     CHARACTER SET IS USED DURING EXECUTION.           03600002
*                     THE CHARACTER SET CHARACTERISTICS THAT THIS       03610002
*                     MODULE IS DEPENDENT UPON ARE -                    03620002
*                     1. X'FF' IS NOT AN ALPHANUMERIC.                  03630002
*                     2. X'00' IS NOT AN ALPHANUMERIC.                  03640002
*                     3. A-Z,0-9 ARE IN COLLATING SEQUENCE, IN THAT     03650002
*                        ORDER.                                         03660002
*                     THESE CHARACTERISTICS APPLY TO THE TWO BYTE       03670002
*                     MODULE ID IN DETERMINING WHICH MODULE IS TO       03680002
*                     LOADED NEXT.                                      03690002
*                                                                       03700002
*      RESTRICTIONS = ONLY THE OPEN, CLOSE, AND EOV ROUTINES            03710002
*                     (INCLUDING RDJFCB) USE THE WAIT, SELECT-LOAD,     03720002
*                     SYNCH DCB, QMNGRIO, GET WTG/EOV, INIT/COPY,       03730002
*                     AND UEXIT FACILITIES.                             03740002
*                     ONLY DADSM ROUTINES AND TASK CLOSE USE THE        03750002
*                     GET FIRST AND INITIALIZE PREFIX=FIRST FACILITIES. 03760002
*                                                                       03770002
*      REGISTER CONVENTIONS = REGISTER 5 IS THE BASE REGISTER.          03780002
*                             REGISTER 14 CONTAINS THE RETURN ADDRESS.  03790002
*                             FOR MOST FUNCTIONS, REGISTER 15 POINTS    03800002
*                             TO A REGISTER SAVE AREA.                  03810002
*                             FOR ADDITIONAL REGISTER CONVENTIONS,      03820002
*                             SEE THE DESCRIPTIONS AT THE BEGINNING     03830002
*                             OF EACH FUNCTION.                         03840002
*                                                                       03850002
* PATCH LABEL = THERE ARE TWO PATCH LABELS: THE NEXT TO THE LAST LABEL  03860002
*               IN THE FIRST 4K AND THE THIRD LABEL BEFORE THE ORG      03870002
*               STATEMENT AT THE END OF THE LISTING.                    03880002
*                                                                       03890002
* MODULE TYPE = CONTROL                                                 03900002
*                                                                       03910002
*      PROCESSOR = ASSEMBLER XF                                         03920002
*                                                                       03930002
*      MODULE SIZE = SEE THE EXTERNAL SYMBOL DICTIONARY OR THE ORG      03940002
*                    STATEMENT AT THE END OF THE LISTING.               03950002
*                                                                       03960002
*      ATTRIBUTES = REENTRANT, REFRESHABLE, ENABLED, PRIVILEGED,        03970002
*                   KEY ZERO, DATA MANAGEMENT KEY, AND USER KEY,        03980002
*                   LINK PACK AREA RESIDENT/PAGEABLE OR NUCLEUS         03990002
*                   RESIDENT                                            04000002
*                                                                       04010002
* ENTRY POINT = ENTRY TO THIS MODULE IS MADE BY A DIRECT BRANCH FROM    04020002
*               ANY OPEN/CLOSE/EOV/DADSM MODULE.  THERE ARE FOURTEEN    04030002
*               ENTRY POINTS:                                           04040002
*                                                                       04050002
*               IFG019RA+0  - ENTRY FOR WAIT FACILITY                   04060002
*               IFG019RA+4  - ENTRY FOR SELECT-LOAD FACILITY            04070002
*               IFG019RA+8  - ENTRY FOR DCB SYNCHRONIZATION FACILITY    04080002
*               IFG019RA+12 - ENTRY FOR QMNGRIO FACILITY                04090002
*               IFG019RA+20 - ENTRY FOR LOAD AND BRANCH FACILITY        04100002
*               IFG019RA+24 - ENTRY FOR LOAD AND RETURN FACILITY        04110002
*               IFG019RA+28 - ENTRY FOR GET WORK AREA FACILITY          04120002
*               IFG019RA+32 - ENTRY FOR GET WTG/EOV WORK AREA FACILITY  04130002
*               IFG019RA+36 - ENTRY FOR GET FIRST WORK AREA FACILITY    04140002
*               IFG019RA+40 - ENTRY TO INITIALIZE PREFIX=FIRST WKAREA   04150002
*               IFG019RA+44 - ENTRY TO INITIALIZE AND/OR COPY THE DCB   04160002
*               IFG019RA+48 - ENTRY FOR FREE WORK AREA FACILITY         04170002
*               IFG019RA+52 - ENTRY FOR FREE FIRST OR WTG/EOV FACILITY  04180002
*               IFG019RA+56 - ENTRY FOR UEXIT FACILITY                  04190002
*                                                                       04200002
*      PURPOSE = SEE FUNCTION                                           04210002
*                                                                       04220002
*      LINKAGE = THIS MODULE IS BRANCHED TO VIA A FULLWORD POINTER      04230002
*                IN THE CVT, CVTDMSR.                                   04240002
*                                                                       04250002
*                                                                       04260002
*      INPUT = AS FOLLOWS:                                              04270002
*                                                                       04280002
*                                                                       04290002
*      THE INPUT FOR WAIT, SELECT-LOAD, AND DCB SYNCHRONIZATION:        04300002
*                                                                       04310002
*      REGISTERS -                                                      04320002
*          0 & 1 - SAVED BY SERVICE ROUTINE IN WORK AREA                04330002
*          3     - BASE REGISTER OF CALLING MODULE                      04340002
*          4     - ADDRESS OF DCB'S WORK AREA                           04350002
*          5     - ADDRESS OF IFG019RA                                  04360002
*          6     - WHERE-TO-GO TABLE ADDRESS                            04370002
*          9-13  - SAVED BY SERVICE ROUTINE IN WORK AREA                04380002
*         14     - RETURN ADDRESS TO CALLING MODULE FOR WAIT FACILITY   04390002
*                  AND DCB SYNCHRONIZATION FACILITY, SAVED BY SERVICE   04400002
*                  ROUTINE IN WORK AREA.                                04420002
*                                                                       04430002
*      WHERE-TO-GO TABLE BASIC SECTION -                                04440002
*         + 0 - EIGHT BYTE CURRENT MODULE NAME                          04450002
*         + 6 - TWO BYTE CURRENT MODULE ID                              04460002
*         +16 - FULLWORD WITH SERVICE ROUTINE WORK AREA ADDRESS         04470002
*               IN LOW ORDER THREE BYTES                                04480002
*         +31 - (WTGPATHS+1) TRACE ROUTINE INDICATOR                    04490002
*                                                                       04500002
*      WHERE-TO-GO TABLE DCB ENTRY -                                    04510002
*         + 0 - TWO BYTE MODULE ID                                      04520002
*         + 2 - THREE BYTE MODULE ENTRY POINT ADDRESS                   04530002
*         + 5 - DCB WORK AREA ADDRESS                                   04540002
*                                                                       04550002
*      SERVICE ROUTINE WORK AREA -                                      04560002
*         + 0 - PREFIX FOR OPTIONAL TRACE FUNCTION, ADDRESS OF          04570002
*               OPTIONAL TRACE ROUTINE                                  04580002
*         + 4 - OPTIONAL TRACE BUFFER ADDRESS                           04590002
*         + 8 - FULLWORD WITH PARAMETER LIST ADDRESS                    04600002
*        + 12 - MULTIPLE WAIT ECBLIST                                   04610002
*                                                                       04620002
*                                                                       04630002
*      THE INPUT FOR THE LOAD FACILITY:                                 04640002
*                                                                       04650002
*      REGISTERS -                                                      04660002
*          5 - BASE REGISTER FOR THIS MODULE                            04670002
*          6 - POINTER TO (PSEUDO) WHERE-TO-GO TABLE                    04680002
*         14 - RETURN ADDRESS OF CALLING MODULE                         04690002
*         15 - PTR TO PREFIX OF A WORK AREA WHERE REGISTERS MAY         04700002
*              BE SAVED, PRESERVED FOR THE CALLING MODULE.              04710002
*                                                                       04720002
*      STORAGE -                                                        04730002
*      THE FIELD 'WTGMODNM' MUST CONTAIN THE NAME (PADDED WITH          04740002
*      BLANKS) OF THE CSECT TO RECEIVE CONTROL.                         04750002
*      THE FIELD 'WTGMODEP' MUST BE ZERO IN ORDER TO GET THE            04760002
*      GIVEN MODULE LOADED.  IF NOT ZERO, IT IS ASSUMED TO              04770002
*      BE THE ADDRESS OF THE DESIRED MODULE.                            04780002
*                                                                       04790002
*                                                                       04800002
*      THE INPUT FOR THE QMNGRIO FACILITY:                              04810002
*                                                                       04820002
*      REGISTERS -                                                      04830002
*          0 = ZERO IF READ REQUESTED                                   04840002
*            = JFCB ADDRESS IF WRITE REQUESTED                          04850002
*          1 = POINTER TO JFCB TTR (JFCB PREFIX ADDRESS)                04860002
*          5 = BASE ADDRESS                                             04870002
*         14 = POINTER TO RETURN ADDRESS                                04880002
*         15 = POINTER TO IECPREFX                                      04890002
*                                                                       04900002
*                                                                       04910002
*      THE INPUT FOR THE GET FACILITY:                                  04920002
*                                                                       04930002
*      REGISTERS -                                                      04940002
*          0 - AMOUNT OF STORAGE BEING REQUESTED FOR PREFIX=YES OR =NO  04950002
*            - AMOUNT OF STORAGE BEING REQUESTED FOR PREFIX=FIRST       04960002
*              OR PREFIX=EOV                                            04970002
*            - 0 FOR PREFIX=WTG                                         04980002
*          1 - PREFIX ADDRESS FOR PREFIX=YES                            04990002
*            - NOT USED FOR PREFIX=NO                                   05000002
*            - EXTENDED PREFIX ADDRESS FOR EXTPR=ADDR (DADSM)           05010002
*            - 0 (MEANING NO PREVIOUS PREFIX) FOR PREFIX=FIRST          05020002
*            - DCB PARAMETER LIST ADDRESS FOR PREFIX=EOV OR =WTG        05030002
*          2 - SUBPOOL FOR PREFIX=YES, =NO, OR =FIRST                   05040002
*          3 - STORAGE PROTECT KEY FOR PREFIX=YES, =NO, OR =FIRST       05050002
*          4 - INDEX FOR PREFIX/LOCK STATUS IF PREFIX=YES,              05060002
*              PREFIX=NO, OR PREFIX=FIRST                               05070002
*              0 = NO PREFIX FOR WORK AREA/NO LOCAL LOCK HELD           05080002
*              1 = PREFIX FOR WORK AREA/NO LOCAL LOCK HELD              05090002
*              2 = PREFIX FOR WORK AREA/LOCAL LOCK HELD                 05100002
*              3 = NO PREFIX FOR WORK AREA/LOCAL LOCK HELD              05110002
*            - CALLER ID FOR PREFIX=WTG, OR =EOV                        05120002
*              0 = PREFIX=WTG                                           05130002
*              1 = PREFIX=EOV                                           05140002
*          5 - BASE REGISTER FOR THIS MODULE                            05150002
*         14 +0 - RETURN ADDRESS FOR PREFIX=NO, =WTG, OR =EOV           05160002
*               - ADDRESS OF A 4 BYTE ID FOR PREFIX=FIRST OR =YES       05170002
*         14 +4 - RETURN ADDRESS FOR PREFIX=FIRST OR PREFIX=YES OR      05180002
*                 EXTPR=ADDR                                            05190002
*         15 - REGISTER SAVE AREA ADDRESS                               05200002
*                                                                       05210002
*                                                                       05220002
*      THE INPUT FOR THE INIT/DCB COPY FACILITY:                        05230002
*                                                                       05240002
*        REGISTERS -                                                    05250002
*            0 - INDICATION OF WHETHER DCB IS OPEN OR CLOSED AND,       05260002
*                HENCE, WHETHER A DEB ADDRESS IN DCBDEBAD WILL BE       05270002
*                USED TO FIND SEVERAL OF THE POINTERS NEEDED FOR        05280002
*                THE INITIALIZATION FUNCTION:                           05290002
*                0 - NO WORK AREA INITIALIZATION IS REQUESTED           05300002
*                4 - DCB IS OPEN                                        05310002
*                8 - DCB IS CLOSED                                      05320002
*            1 - INDICATION OF DCB COPY FUNCTION REQUESTED              05330002
*                0 - NO DCB COPY REQUESTED                              05340002
*                4 - THE DCB POINTED TO BY DXUDCBAD IN THE OPEN/        05350002
*                    CLOSE/EOV WORK AREA (WHICH IS IN PROTECT KEY       05360002
*                    INDICATED BY DXUKEY IN THE WORK AREA) IS TO BE     05370002
*                    COPIED INTO THE PROTECTED WORK AREA POINTED TO     05380002
*                    REGISTER 2.                                        05390002
*                8 - THE PROTECTED WORK AREA COPY OF THE DCB POINTED    05400002
*                    TO BY REGISTER 2 IS TO BE COPIED ON TOP OF THE     05410002
*                    DCB POINTED TO BY WORK AREA LABEL, DXUDCBAD        05420002
*            2 - ADDRESS OF PROTECTED COPY OF DCB BEING PROCESSED       05430002
*            4 - ADDRESS OF OPEN/CLOSE/EOV WORK AREA                    05440002
*            5 - ADDRESS OF IFG019RA                                    05450002
*            6 - ADDRESS OF PREFIX OF MAIN WORK AREA                    05460002
*           14 - RETURN ADDRESS TO THE CALLING MODULE                   05470002
*           15 - POINTER TO A REGISTER SAVE AREA                        05480002
*                                                                       05490002
*                                                                       05500002
*      THE INPUT FOR THE FREE WORK AREA FACILITY:                       05510002
*                                                                       05520002
*      REGISTERS -                                                      05530002
*          0 - AMOUNT OF STORAGE BEING FREED IF PREFIX=NO               05540002
*          1 - ADDRESS OF A PREFIX OR AN EXTENDED PREFIX OR ADDRESS     05550002
*              OF A WORK AREA TO BE FREED                               05560002
*          2 - SUBPOOL FOR THE AREA IF PREFIX=NO                        05570002
*          3 - STORAGE PROTECT KEY OF THE AREA IF PREFIX=NO             05580002
*          4 - INDEX FOR PREFIX/LOCK STATUS IF PREFIX=YES OR =NO        05590002
*              0 = WORK AREA HAS NO PREFIX/NO LOCAL LOCK HELD           05600002
*              1 = WORK AREA HAS A PREFIX/NO LOCAL LOCK HELD            05610002
*              2 = WORK AREA HAS A PREFIX/LOCAL LOCK HELD               05620002
*              3 = WORK AREA HAS NO PREFIX/LOCAL LOCK HELD              05630002
*            - CALLER ID FOR PREFIX=WTG, =EOV, OR =FIRST                05640002
*              0 = PREFIX=WTG                                           05650002
*              1 = PREFIX=WTG FROM THE RECOVERY ROUTINES                05660002
*              2 = PREFIX=EOV                                           05670002
*              3 = PREFIX=EOV FROM THE RECOVERY ROUTINES                05680002
*              4 = PREFIX=FIRST                                         05690002
*              5 = PREFIX=FIRST FROM THE RECOVERY ROUTINES              05700002
*          5 - BASE REGISTER FOR THIS MODULE                            05710002
*         14 - RETURN ADDRESS OF CALLING MODULE                         05720002
*         15 - ADDRESS OF THE REGISTER SAVE AREA FOR IECRES FREE ONLY   05730002
*                                                                       05740002
*                                                                       05750002
*      THE INPUT FOR THE USER EXIT FACILITY:                            05760002
*                                                                       05770002
*      REGISTERS -                                                      05780002
*          0 & 1 VALUES TO BE PASSED TO USER EXIT                       05790002
*          1     VALUE TO BE PASSED TO USER EXIT                        05800002
*          2     MAY BE ADDRESS OF REGISTER SAVE AREA OF CALLER         05810002
*          4     ADDRESS OF OPEN/CLOSE/EOV WORK AREA                    05820002
*          5     BASE REGISTER                                          05830002
*         14     RETURN ADDRESS OF CALLER                               05840002
*         15     ADDRESS OF USER EXIT ROUTINE                           05850002
*                                                                       05860002
*                                                                       05870002
*      OUTPUT = AS FOLLOWS:                                             05880002
*                                                                       05890002
*                                                                       05900002
*      THE OUTPUT FOR WAIT, SELECT-LOAD, AND DCB SYNCHRONIZATION:       05910002
*                                                                       05920002
*      REGISTERS -                                                      05930002
*          0 & 1 - CONTENTS OF DXREG0 AND DXREG1                        05940002
*          2     - DCB ADDRESS (FROM OPEN/CLOSE PARAMETER LIST)         05950002
*          4     - DCB WORK AREA ADDRESS (FROM WTG TABLE DCB ENTRY)     05960002
*          7     - ADDRESS OF CURRENT PARAMETER LIST ENTRY              05970002
*          8     - ADDRESS OF CURRENT WTG DCB ENTRY                     05980002
*          9-14  - CONTENTS OF DXREG9 - DXREGE                          05990002
*                                                                       06000002
*                                                                       06010002
*      THE OUTPUT FOR THE LOAD FACILITY:                                06020002
*                                                                       06030002
*      THE OUTPUT OF THIS FACILITY IS THE ENTRY POINT ADDRESS TO        06040002
*      THE MODULE WHOSE NAME IS IN 'WTGMODNM'.  FOR BRANCH=NO,          06050002
*      THIS ADDRESS IF PLACED IN THE FIELD 'WTGMODEP'.  HOWEVER,        06060002
*      FOR BRANCH=DIRECT, REGISTER 15 CONTAINS THE ENTRY POINT          06070002
*      ADDRESS, AND 'WTGMODEP' IS ZERO.                                 06080002
*                                                                       06090002
*                                                                       06100002
*      THE OUTPUT FOR THE QMNGRIO FACILITY:                             06110002
*                                                                       06120002
*      REGISTERS -                                                      06130002
*          REGISTERS 0 - 15 ARE RESTORED.                               06140002
*                                                                       06150002
*      STORAGE -                                                        06160002
*      IF A READ WAS REQUESTED, IECQMNGR CONTAINS THE ADDRESS           06170002
*      OF THE WORK AREA WHICH NOW CONTAINS THE JFCB.                    06180002
*                                                                       06190002
*                                                                       06200002
*      THE OUTPUT FOR THE GET FACILITY:                                 06210002
*                                                                       06220002
*                                                                       06230002
*      REGISTERS -                                                      06240002
*          1 - ADDRESS OF THE STORAGE REQUESTED                         06250002
*          8 - PRESERVED FOR CALLING MODULE                             06260002
*          9 - PRESERVED FOR CALLING MODULE                             06270002
*         10 - PRESERVED FOR CALLING MODULE                             06280002
*         15 - PRESERVED FOR CALLING MODULE                             06290002
*                                                                       06300002
*                                                                       06310002
*      THE OUTPUT FOR THE INIT/DCB COPY FACILITY:                       06320002
*                                                                       06330002
*      REGISTERS -                                                      06340002
*          2 - ADDRESS OF THE PROTECTED (COPIED) DCB                    06350002
*          5 - ADDRESS OF IFG019RA                                      06360002
*         14 - RETURN ADDRESS OF THE CALLING MODULE                     06370002
*         15 - POINTER TO THE REGISTER SAVE AREA                        06380002
*      DATA -                                                           06390002
*          THE INITIALIZED WORK AREA POINTERS AND/OR THE REFRESHED      06400002
*          DCB.  IF THE FUNCTION REQUESTED WAS NOT COMPLETED            06410002
*          SATISFACTORILY, ONE OF THE BITS IN DXWCOPYE WILL             06420002
*          BE SET TO ONE.  OTHERWISE, THIS BYTE WILL BE ZERO.           06430002
*                                                                       06440002
*                                                                       06450002
*      THE OUTPUT FOR THE FREE WORK AREA FACILITY:                      06460002
*                                                                       06470002
*      REGISTERS -                                                      06480002
*          8 - PRESERVED FOR THE CALLING MODULE                         06490002
*          9 - PRESERVED FOR THE CALLING MODULE                         06500002
*         10 - PRESERVED FOR THE CALLING MODULE                         06510002
*         14 - RETURN ADDRESS OF THE CALLING MODULE                     06520002
*         15 - ADDRESS OF A REGISTER SAVE AREA FOR IECRES FREE ONLY     06530002
*                                                                       06540002
*                                                                       06550002
*      THE OUTPUT FOR THE USER EXIT FACILITY:                           06560002
*                                                                       06570002
*      REGISTERS -                                                      06580002
*          REGISTER 15 CONTAINS THE RETURN CODE FROM THE USER           06590002
*          EXIT ROUTINE. OTHER REGISTERS ARE RESTORED FROM THE          06600002
*          REGISTER SAVE AREA POINTED TO BY REGISTER 2.                 06610002
*                                                                       06620002
*                                                                       06630002
* EXIT-NORMAL = FOR WAIT, SELECT-LOAD, AND DCB SYNCHRONIZATION, SEE     06640002
*               THE EXPLANATION UNDER 'FUNCTION'.                       06650002
*               FOR THE LOAD AND BRANCH FACILITY, CONTROL IS PASSED     06660002
*               TO THE ENTRY POINT OF THE REQUESTED MODULE.             06670002
*               FOR ALL OTHER FACILITIES, CONTROL IS RETURNED TO        06680002
*               THE ADDRESS IN REGISTER 14.                             06690002
*                                                                       06700002
* EXIT-ERROR = AN OC1 ABEND IS ISSUED FOR SETLOCK OR TIOT ENQ ERRORS.   06710002
*                                                                       06720002
* EXTERNAL REFERENCES = SEE BELOW                                       06730002
*                                                                       06740002
*      ROUTINES = DEQ                                                   06750002
*                 ENQ                                                   06760002
*                 ESTAE                                                 06770002
*                 FREEMAIN                                              06780002
*                 GETMAIN                                               06790002
*                 IEAQCDSR                                              06800002
*                 IEAVVMSR                                              06810002
*                 IECRES                                                06820002
*                 LOAD                                                  06830002
*                 SETLOCK                                               06840002
*                 WAIT                                                  06850002
*                 WTO                                                   06860002
*                                                                       06870002
*      DATA AREAS = NONE                                                06880002
*                                                                       06890002
*      CONTROL BLOCKS = ACB                                             06900002
*                       AMB                                             06910002
*                       ASCB                                            06920002
*                       CDE                                             06930002
*                       CVT                                             06940002
*                       DCB                                             06950002
*                       DEB                                             06960002
*                       DSAB                                            06970002
*                       JESCT                                           06980002
*                       JFCB                                            06990002
*                       JSCB                                            07000002
*                       LPDE                                            07010002
*                       PSA                                             07020002
*                       QDB                                             07030002
*                       RB                                              07040002
*                       TIOT                                            07050002
*                       TCB                                             07060002
*                       UCB                                             07070002
*                                                                       07080002
* TABLES = OPEN/CLOSE WORK AREA (CONTAINING JFCB)                       07090002
*          EOV WORK AREA (CONTAINING JFCB)                              07100002
*          VARIOUS DADSM WORK AREAS                                     07110002
*          OPEN/CLOSE WTG TABLE                                         07120002
*                                                                       07130002
* MACROS = DEQ                                                          07140002
*          DEBCHK                                                       07150002
*          DMABCOND                                                     07160002
*          ENQ                                                          07170002
*          ESTAE                                                        07180002
*          FREEMAIN                                                     07190002
*          GETMAIN                                                      07200002
*          IDAAMB                                                       07210002
*          IECDSECS                                                     07220002
*          IECEQU                                                       07230002
*          IECRES                                                       07240002
*          IEFJESCT                                                     07250002
*          IEFQMIOP                                                     07260002
*          MODESET                                                      07270002
*          QMNGRIO                                                      07280002
*          RETURN                                                       07290002
*          SETLOCK                                                      07300002
*          SYNCH                                                        07310002
*          WAIT                                                         07320002
*          WTO                                                          07330002
*          XCTLTABL                                                     07340002
*                                                                       07350002
* CHANGE ACTIVITY = SEE DELETIONS/CHANGES FOLLOWING CSECT STATEMENT.    07360002
*                                                                       07370002
*********************************************************************** 07380002
         EJECT                                                          07390002
*                                                                       07400002
*        MISCELLANEOUS EQUATES                                          07450002
*                                                                       07500002
GETPREFX EQU   X'80000000'              ON = PREFIX WANTED       Y02080 07550002
GETLCKHD EQU   X'40000000'              ON = LOCAL LOCK HELD     Y02080 07600002
         IECEQU IEZDEB=YES,AOS=YES                               Y02134 11150002
*********************************************************************** 11160002
*                                                                     * 11170002
*        ENTRY TO OPEN/CLOSE/EOV/DADSM SERVICE ROUTINE                * 11180002
*                                                                     * 11190002
*********************************************************************** 11200002
         USING *,RES                    ADDRESS OF THIS MODULE          11210002
         USING FORCORE,RCORE            WORK AREA ADDRESS               11220002
         USING WTG,RWTG                 ADDRESS OF WTG TABLE            11230002
         USING WTGENTRY,RWTGC           WTG TABLE ENTRY ADDRESS         11240002
*                                                                       11260002
RES00100 B     RES00500                 ENTRY FOR WAIT                  11280002
RES00200 B     RES01900                 ENTRY FOR SELECT-LOAD    Y02080 11300002
RES00300 B     RES00400                 ENTRY TO SYNCHRONIZE     Y02080X11320002
                                        ALL DCB'S                YM3066 11340002
RES00310 B     RES10000                 ENTRY FOR QMNGRIO        YM3138 11360002
RES00320 DC    F'0'                     UNUSED ENTRY             Y02080 11380002
RES00330 B     RES02800                 ENTRY TO LOAD NEXT MOD   Y02080X11400002
                                        & BRANCH TO IT DIRECTLY  YM3066 11420002
RES00340 B     RES02810                 ENTRY TO LOAD NEXT MOD   Y02080X11440002
                                        BUT RETURN TO CALLER     YM3066 11460002
RES00350 B     RES01830                 GET ENTRY                Y02080 11480002
RES00360 B     RES01810                 GET WTG,EOV ENTRY        Y02080 11500002
RES00370 B     RES01750                 GET FIRST ENTRY          Y02080 11520002
RES00380 B     RES01760                 INITIALIZE PREFIX=FIRST  Y02080 11540002
RES00382 B     RES07000                 ENTRY FOR INIT/COPY      YM3138 11560002
RES00384 B     RES01860                 FREE ENTRY               Y02080 11580002
RES00386 B     RES01880                 FREE FIRST,WTG,EOV ENTRY Y02080 11600002
RES00388 B     RES09000                 UEXIT ENTRY              YM3138 11620002
         TITLE 'IFG019RA--OPEN/CLOSE/EOV WAIT AND SYNCH DCB FACILITIES' 11640002
*********************************************************************** 11660002
*                                                                     * 11680002
* WAIT AND PSEUDO WAIT HANDLING FACILITY OF THE SERVICE ROUTINE       * 11700002
*                                                                     * 11720002
* THIS SECTION RECEIVES CONTROL FROM THE CALLING MODULE WHEN THE      * 11740002
* CALLING MODULE REQUESTS A WAIT OR PSEUDO-WAIT FOR A PARTICULAR DCB  * 11760002
* AND FROM THE SELECT-LOAD FACILITY OF THE SERVICE ROUTINE WHEN  Y02080 11780002
* THERE REMAINS ONE OR MORE ACTIVE DCB'S IN THE CALLING MODULE   Y02080 11800002
* SO THAT A LOAD MAY NOT BE DONE.                                Y02080 11820002
*                                                                     * 11840002
* THE WAIT-PENDING BIT OR THE PSEUDO-WAIT BIT IS SET AS APPROPRIATE.  * 11860002
* ALL ACTIVE DCB'S ARE SCANNED, SEARCHING FOR A DCB WITH NEITHER A    * 11880002
* WAIT-PENDING NOR A PSEUDO-WAIT WHILE SIMULTANEOUSLY BUILDING AN     * 11900002
* ECBLIST FOR DCB'S WITH A WAIT PENDING.  UPON ENCOUNTERING AN ACTIVE * 11920002
* DCB WITH NEITHER A WAIT PENDING NOR A PSEUDO-WAIT, OR A DCB WITH A  * 11940002
* WAIT PENDING THAT IS ALREADY POSTED, CONTROL IS RETURNED TO THE     * 11960002
* CALLING MODULE FOR THAT DCB.  OTHERWISE, IF THERE ARE ANY DCB'S     * 11980002
* WITH A WAIT PENDING, A MULTIPLE WAIT IS ISSUED ON THE ECBLIST,      * 12000002
* THE POSTED DCB IS FOUND ON RETURN FROM WAIT, AND A RETURN IS TAKEN  * 12020002
* TO THE CALLING MODULE.  IF THERE ARE NO WAITS PENDING, ALL ACTIVE   * 12040002
* DCB'S MUST HAVE PSEUDO-WAITS.  THEREFORE, THE PSEUDO-WAIT BITS FOR  * 12060002
* ALL THE DCB'S ARE RESET AND A RETURN IS TAKEN TO THE CALLING MODULE * 12080002
* FOR THE FIRST ACTIVE DCB.                                           * 12100002
*                                                                     * 12120002
*********************************************************************** 12140002
*                                                                       12160002
* ENTRY TO SYNCHRONIZE ALL DCB'S TO THE SAME PROCESSING POINT           12180002
*                                                                       12200002
RES00400 EQU   *                        SET PSEUDO-WAIT BIT      YM3066 12220002
         MVI   DXRESIND,PSEUDOWT        SET PSEUDO-WAIT (SYNCH) BIT     12240002
         B     RES02000                 GO PROCESS AS IF THIS    Y02080 12260002
*                                       WERE A SELECT-LOAD       Y02080 12280002
*                                       REQUEST SO THAT THE      Y02080 12300002
*                                       TRACE RTN MAY BE CALLED. Y02080 12320002
*                                       THE SELECT-LOAD ENTRY    Y02080 12340002
*                                       WILL FIND AN ACTIVE DCB  Y02080 12360002
*                                                                       12400002
* ENTRY FOR WAIT                                                        12420002
*                                                                       12440002
RES00500 EQU   *                        ENTRY FOR WAIT           YM3066 12460002
         MVI   DXRESIND,WAITBIT         SET WAIT PENDING BIT            12480002
         BAL   R7,RES03000              GO SAVE REGISTERS        Y02080 12500002
         BAL   RET,RES03100             GO INITIALIZE REGISTERS         12520002
*                                                                       12540002
* SCAN THE DCB'S FOR WAIT-PENDING AND PSEUDO-WAIT CONDITION TO          12560002
* DETERMINE WHETHER A DCB MAY BE PROCESSED WITHOUT WAITING.  IF YES,    12580002
* SWITCH DCB'S AND RETURN.  IF NOT, BUILD ECBLIST AND ISSUE MULTIPLE    12600002
* WAIT.  IF NO DCB MAY BE STARTED AND NONE HAS A WAIT PENDING, ALL      12620002
* DCB'S MUST HAVE A PSEUDO-WAIT, IN WHICH CASE GO RESET PSEUDO-WAIT     12640002
* BITS PREPARATORY TO RETURNING TO THE CALLING MODULE.                  12660002
*                                                                       12680002
RES00600 EQU   *                        FIND A DCB TO PROCESS    YM3066 12700002
RES00700 CLC   WTGMODID,WTGIDTTR        IS THIS DCB ACTIVE             X12720002
                                        (MODULE ID'S EQUAL)             12740002
         BNE   RES00800                 NO, GO CHECK FOR LAST ENTRY     12760002
         TM    DXRESIND,WAITBIT         YES, TEST FOR WAIT PENDING      12780002
         BO    RES01000                 YES, GO SEE IF POSTED           12800002
         TM    DXRESIND,PSEUDOWT        NO, TEST FOR A PSEUDO-WAIT      12820002
         BNO   RES01200                 NO, GO RETURN TO BEGINNING OF  X12840002
                                        CALLING MODULE                  12860002
RES00800 EQU   *                        CHECK FOR LAST ENTRY     YM3138 12880002
         TM    PLISTOPT(RPARC),LASTNTRY  IS THIS LAST PARAMETER  YM3138X12900002
                                        LIST ENTRY                      12920002
         BNO   RES01100                 NO, GO INCREMENT AND LOOP       12940002
*                                       YES, HAS ECBLIST PTR     Y02080 12960002
*                                       BEEN INCREMENTED?        Y02080 12980002
*                                       (I.E., HAVE THERE BEEN   Y02080 13000002
*                                       ANY WAIT'S PENDING WITH  Y02080 13020002
*                                       CORRESPONDING ENTRIES IN Y02080 13040002
*                                       THE ECBLIST?)            Y02080 13060002
         L     RET,WTGPREFX             GET PTR TO PREFIX        Y02080 13080002
         USING IECPREFX,RET                                      Y02080 13100002
         L     RET,IECRESWA             GET PTR TO RES WORK AREA Y02080 13120002
         USING RWARESWA,RET                                      Y02080 13140002
         LA    RET,RWALIST              ADDR FIRST ECB ENTRY     Y02080 13160002
         CR    RET,RTIOT                CHECK IF ANY ECBS        Y02080 13180002
         DROP  RET                                               Y02080 13200002
         BE    RES01500                 NO, MUST HAVE ALL PSEUDO-WAITS, 13220002
*                                       OR NONE FOR THIS MODULE  Y02080 13240002
*                                       GO INITIALIZE AND RESET ALL     13260002
*                                       PSEUDO-WAIT BITS                13280002
         SH    RTIOT,FOUR               POINT TO LAST ECB ADDR   Y02080 13300002
         OI    0(RTIOT),LASTNTRY        YES, HAVE WAIT'S PENDING AND   X13320002
                                        NO DCB'S TO PROCESS, INDICATE  X13340002
                                        END OF ECBLIST                  13360002
         BAL   RET,RES03100             INITIALIZE AND RESET ECBLIST   X13380002
                                        ADDRESS                         13400002
         WAIT  1,ECBLIST=ECBLIST(RTIOT) MULTIPLE WAIT ON ANY ECB Y02080X13420002
                                        IN ECBLIST               Y02080 13440002
         B     RES00600                 GO FIND THE DCB WITH A POSTED  X13460002
                                        ECB                             13480002
RES01000 EQU   *                        TEST IF ECB IS POSTED    YM3138 13500002
         TM    DXECB,ECBPOST            IS ECB POSTED ALREADY           13520002
         BO    RES01300                 YES, RETURN TO CALLING MODULE   13540002
*                                                                       13580002
         LA    RUCB,DXECB               GET ECB ADDRESS FOR THIS DCB    13600002
         ST    RUCB,0(,RTIOT)           ADD ECB ADDRESS TO ECBLIST      13620002
         LA    RTIOT,K4(,RTIOT)         NO, INCREMENT            Y02080X13640002
                                        TO NEXT ECB POINTER      Y02080 13660002
         B     RES00800                 PROCESS NEXT DCB         Y02080 13680002
RES01100 EQU   *                        INCREMENT TO NEXT DCB    YM3138 13700002
         BAL   RET,RES03200             INCREMENT TO NEXT DCB           13720002
         B     RES00600                 LOOP TO CHECK NEXT DCB          13740002
*                                                                       13760002
* RETURN TO START OF CALLING MODULE SINCE THERE WAS NO WAIT PENDING     13780002
* OR PSEUDO-WAIT FOR THIS DCB.                                          13800002
*                                                                       13820002
RES01200 EQU   *                        RETURN TO START OF CALLING MOD  13840002
         L     RDCB,0(,RPARC)           GET DCB ADDRESS FROM PARAMETER X13860002
                                        LIST ENTRY                      13880002
         MVI   DXREGE,K0                ZERO HIGH ORDER BYTE OF XA01734X13900002
                                        REGISTER 14 IN WORKAREA XA01734 13920002
         NI    DCBIFLGS-IHADCB+DXDCB,ALLBITS-DCBIFPIO CLEAR ERR  YM8526 13930002
         LM    RTIOT,RET,DXREG9         RESTORE REGISTERS 9 THROUGH 14  13940002
         LM    R0,R1,DXREG0             RESTORE REGISTERS 0 AND 1       13960002
         BR    RBASE                    RETURN TO START OF CALLING     X13980002
                                        MODULE VIA CALLING MODULE'S    X14000002
                                        BASE REGISTER                   14020002
*                                                                       14040002
* RESET WAIT PENDING BIT                                                14060002
*                                                                       14080002
RES01300 EQU   *                        RESET WAIT PENDING BIT   YM3138 14100002
         NI    DXRESIND,X'FF'-WAITBIT   RESET WAIT PENDING BIT          14120002
*                                                                       14140002
* RETURN TO CALLING MODULE VIA CALLING MODULE'S LINK REGISTER           14160002
*                                                                       14180002
RES01400 EQU   *                        RETURN TO CALLING MODULE YM3138 14200002
         L     RDCB,0(,RPARC)           GET DCB ADDRESS FROM PARAMETER X14220002
                                        LIST ENTRY                      14240002
         LM    RTIOT,RET,DXREG9         RESTORE REGISTERS 9 THROUGH 14  14260002
         LM    R0,R1,DXREG0             RESTORE REGISTERS 0 AND 1       14280002
         BR    RET                      RETURN TO CALLING MODULE VIA   X14300002
                                        CALLING MODULE'S LINK REGISTER  14320002
*                                                                       14340002
* RESET ALL PSEUDO-WAIT BITS AND FIND THE FIRST ACTIVE DCB IN THE       14360002
* PARAMETER LIST FOR THE RETURN.                                        14380002
*                                                                       14400002
RES01500 EQU   *                        INITIALIZE REGISTERS     YM3138 14420002
         BAL   RET,RES03100             INITIALIZE REGISTERS            14440002
RES01600 EQU   *                        FIND 1ST ACTIVE DCB      YM3138 14460002
         EX    0,RES00700               IS THIS DCB ACTIVE             X14480002
                                        (MODULE ID'S EQUAL)             14500002
         BNE   RES01700                 NO, GO INCREMENT AND LOOP       14520002
         TM    DXRESIND,PSEUDOWT        YES, IS PSEUDO-WAIT BIT ON      14540002
         BNO   RES01400                 NO, GO RETURN VIA LINK REGISTER 14560002
         NI    DXRESIND,X'FF'-PSEUDOWT  YES, RESET PSEUDO-WAIT BIT      14580002
RES01700 TM    PLISTOPT(RPARC),LASTNTRY  IS THIS LAST PARM LIST ENTRY   14600002
         BO    RES01500                 YES, GO INITIALIZE REGS  YM3138 14640002
         BAL   RET,RES03200             INCREMENT TO NEXT DCB           14740002
         B     RES01600                 GO LOOP                         14760002
         TITLE 'IFG019RA--OPEN/CLOSE/EOV/DADSM GETMAIN FACILITY' YM3138 14780002
*********************************************************************** 14800002
*                                                                     * 14820002
*        FUNCTION PROLOGUE                                            * 14840002
*                                                                     * 14860002
*********************************************************************** 14880002
*                                                                       14900002
* FUNCTION NAME -                                                       14920002
*                                                                       14940002
*        GETMAIN FACILITY FOR OPEN/CLOSE/EOV/DADSM                      14960002
*                                                                       14980002
* FUNCTION -                                                            15000002
*                                                                       15020002
*        THIS ROUTINE HAS FOUR FUNCTIONS:                               15040002
*        1. IT CAN GET A SINGLE WORK AREA WITH OR WITHOUT PREFIX;       15060002
*        2. IT CAN GET AN EOV WORK AREA OR A WTG TABLE (OPEN/CLOSE);    15080002
*        3. IT CAN GET A FIRST WORK AREA FOR DADSM OR TASK CLOSE;       15100002
*        4. IT CAN INITIALIZE THIS WORK AREA FOR DADSM OR TASK CLOSE.   15120002
*                                                                       15140002
*        IECRES GET,PREFIX=YES OR =NO IS ENTERED BY O/C/E/D MODULES     15160002
*        TO GET STORAGE OTHER THAN FOR A WTG TABLE OR FIRST WORK AREA.  15180002
*        IT ISSUES THE GETMAIN MACRO AND ZEROS THE STORAGE.  IT BUILDS  15200002
*        A PREFIX AND CHAINS THE WORK AREA IF REQUESTED.                15220002
*                                                                       15240002
*        IECRES GET,PREFIX=WTG OR =EOV GETS THE FIRST WORK AREA FOR     15260002
*        THE O/C/E MODULES.  IT GETS A SINGLE ENTRY WTG TABLE AND       15280002
*        WORK AREA FOR EOV OR A VARIABLE-LENGTH WTG TABLE FOR OPEN      15300002
*        AND CLOSE.  THE STORAGE IT REQUESTS INCLUDES A PREFIX,         15320002
*        EXTENDED PREFIX, PREFIX, RECOVERY ROUTINE PARAMETER LIST,      15340002
*        DCB PARAMETER LIST, WORK AREA USED BY IFG019RA, AND A TRACE    15360002
*        BUFFER, IF REQUESTED.  AFTER ISSUING THE GETMAIN MACRO, IT     15380002
*        ZEROS THE STORAGE AND BUILDS THE PREFIX.  IT THEN ENQUEUES     15400002
*        ON THE TIOT AND ISSUES THE ESTAE MACRO TO ESTABLISH THE        15420002
*        ADDRESS OF THE O/C/E/D RECOVERY ROUTINE.                       15440002
*                                                                       15460002
*        IECRES GET,PREFIX=FIRST IS ENTERED BY THE DADSM FUNCTIONS OR   15480002
*        BY TASK CLOSE TO GET STORAGE FOR THE MAIN WORK AREA.  THE      15500002
*        ROUTINE ADDS THE LENGTH OF A PREFIX, EXTENDED PREFIX, AND      15520002
*        RECOVERY ROUTINE PARAMETER LIST TO THE REQUESTED AMOUNT OF     15540002
*        SPACE.  AFTER ISSUING THE GETMAIN MACRO, IT ZEROS THE          15560002
*        STORAGE AND BUILDS THE PREFIX.                                 15580002
*                                                                       15600002
*        THE SECOND ENTRY OF IECRES GET,PREFIX=FIRST INITIALIZES        15620002
*        THE WTO LENGTH FIELD IN THE PSEUDO WTG TABLE AND ISSUES        15640002
*        THE ESTAE MACRO TO ESTABLISH THE ADDRESS OF THE O/C/E/D        15660002
*        OR TASK CLOSE RECOVERY ROUTINE.                                15680002
*                                                                       15700002
* ENTRY POINTS -                                                        15720002
*                                                                       15740002
*        ENTRY TO THIS MODULE IS MADE BY A DIRECT BRANCH FROM ANY       15760002
*        MODULE IN THE COMPONENT.                                       15780002
*              IFG019RA+28 - ENTRY FOR GET WORK AREA FACILITY           15800002
*              IFG019RA+32 - ENTRY FOR GET WTG/EOV WORK AREA FACILITY   15820002
*              IFG019RA+36 - ENTRY FOR GET FIRST WORK AREA FACILITY     15840002
*              IFG019RA+40 - ENTRY TO INITIALIZE PREFIX=FIRST WORK AREA 15860002
*                                                                       15880002
* INPUT -                                                               15900002
*                                                                       15920002
*        REGISTERS -                                                    15940002
*        0 - AMOUNT OF STORAGE BEING REQUESTED FOR PREFIX=YES OR =NO    15960002
*          - AMOUNT OF STORAGE BEING REQUESTED FOR PREFIX=FIRST OR =EOV 15980002
*          - 0 FOR PREFIX=WTG                                           16000002
*        1 - PREFIX ADDRESS FOR PREFIX=YES                              16020002
*          - NOT USED FOR PREFIX=NO                                     16040002
*          - EXTENDED PREFIX ADDRESS FOR EXTPR=ADDR (DADSM)             16060002
*          - 0 (MEANING NO PREVIOUS PREFIX) FOR PREFIX=FIRST            16080002
*          - DCB PARAMETER LIST ADDRESS FOR PREFIX=EOV OR =WTG          16100002
*        2 - SUBPOOL FOR PREFIX=YES, =NO, OR =FIRST                     16120002
*        3 - STORAGE PROTECT KEY FOR PREFIX=YES, =NO, OR =FIRST         16140002
*        4 - INDEX FOR PREFIX/LOCK STATUS IF PREFIX=YES, =NO, OR =FIRST 16160002
*            0 = NO PREFIX FOR WORK AREA/NO LOCAL LOCK HELD             16180002
*            1 = PREFIX FOR WORK AREA/NO LOCAL LOCK HELD                16200002
*            2 = PREFIX FOR WORK AREA/LOCAL LOCK HELD                   16220002
*            3 = NO PREFIX FOR WORK AREA/LOCAL LOCK HELD                16240002
*          - CALLER ID FOR PREFIX=WTG, OR =EOV -                        16260002
*            0 = PREFIX=WTG                                             16280002
*            1 = PREFIX=EOV                                             16300002
*        5 - BASE REGISTER FOR THIS MODULE                              16320002
*       14 +0 - RETURN ADDRESS FOR PREFIX=NO, =WTG, OR =EOV             16340002
*             - ADDRESS OF A 4 BYTE ID FOR PREFIX=FIRST OR =YES         16360002
*       14 +4 - RETURN ADDRESS FOR PREFIX=FIRST OR =YES OR EXTPR=ADDR   16380002
*       15 - REGISTER SAVE AREA ADDRESS                                 16400002
*                                                                       16420002
* OUTPUT -                                                              16440002
*                                                                       16460002
*        REGISTERS -                                                    16480002
*        1 - ADDRESS OF THE STORAGE REQUESTED                           16500002
*        8 - PRESERVED FOR CALLING MODULE                               16520002
*        9 - PRESERVED FOR CALLING MODULE                               16540002
*       10 - PRESERVED FOR CALLING MODULE                               16560002
*       15 - PRESERVED FOR CALLING MODULE                               16580002
*                                                                       16600002
*********************************************************************** 16620002
         EJECT                                                   Y02080 16640002
         DS    0F                                                Y02080 16900002
RES01801 DC    F'0'                     NO PREFX - NO LOCK       Y02080 16920002
RES01802 DC    AL4(GETPREFX)            PREFIX                   Y02080 16940002
RES01803 DC    AL4(GETLCKHD+GETPREFX)   PREFIX + LOCK HELD       Y02080 16960002
RES01804 DC    AL4(GETLCKHD)            LOCK HELD                Y02080 16980002
**************************************************************** Y02080 17000002
*        GET FIRST FOLLOWED BY GET FIRST INITIALIZATION          Y02080 17020002
**************************************************************** Y02080 17040002
RES01750 LA    RB,RRPLEND-IECRRPL       LENGTH OF RRPLIST        Y02080 17060002
         LA    RB,IECDAEND-IECEXTPR(,RB)  LENGTH OF EXTENDED     Y02080X17080002
                                        PREFIX FOR DADSM         Y02080 17100002
         AR    R0,RB                    ADD RRPLIST AND EP       Y02080 17120002
         B     RES01830                 GETMAIN                  Y02080 17140002
**************************************************************** Y02080 17160002
*        GET FIRST INITIALIZATION                                Y02080 17180002
**************************************************************** Y02080 17200002
RES01760 LA    R0,IECSTART-IECPREFX     LENGTH OF BASE           Y02080 17220002
         SR    R1,R0                    ADDR OF BASE PREFIX      Y02080 17240002
         USING IECPREFX,R1              BASE PREFIX              Y02080 17260002
         LA    RWTG,IECDAEND            ADDR WTO PREFIX          Y02134 17280002
         MVC   0(K4,RWTG),MSGPREFX      SET WTO MSG PREFIX       Y02080 17300002
         LA    RWTG,WTG-WTGTABLE(,RWTG) POINTER TO WTG TABLE     Y02134 17320002
         ST    RWTG,IECWTGTB            ADDR OF WTG TBL          Y02080 17340002
         LR    R2,R1                    ADDR OF BASE PREFIX      Y02080 17360002
         A     R2,IECCORLN              LENGTH OF GETMAIN        Y02080 17380002
         LA    R0,RRPLEND-IECRRPL       LENGTH OF RRPLIST        Y02080 17400002
         SR    R2,R0                    GET ADDR OF RRPLIST      Y02080 17420002
         ST    R2,IECRRPRM              SAVE ADDR OF RRPLIST     Y02080 17440002
         LR    RA,RET                   SAVE RETURN ADDR         Y02144 17460002
         LA    RET,RR0F                 IFG0RR0A RECOVERY ID     Y02144 17480002
         CLC   IECCORID,RR0A+K4         IFG0RR0A ENTRY           Y02144 17500002
         BE    RES01770                 BRANCH IF YES            Y02144 17520002
         LA    RET,TC4A                 TASK CLOSE RECOVERY ID   Y02144 17540002
         CLC   IECCORID,TC0A+K4         TASK CLOSE ENTRY         Y02144 17560002
         BE    RES01770                 BRANCH IF YES            Y02144 17580002
         OI    RRFUNCTN-IECRRPL(R2),RRFDADSM INDICATE DADSM    @ZA02177 17590002
         LA    RET,RR0A                 DADSM RECOVERY ID        Y02144 17600002
RES01770 EQU   *                        ESTABLISH RECOVERY RTN   Y02144 17620002
         BAL   RC,RES06000              ESTABLISH RECOVERY RTN   Y02144 17640002
         LR    RET,RA                   RESTORE RETURN ADDR      Y02144 17660002
         L     R1,IECCORAD              RETURN ADDR OF EXT PREFX Y02080 17680002
         DROP  R1                                                Y02080 17700002
         BR    RET                      RETURN                   Y02080 17720002
         EJECT                                                          17740002
**************************************************************** Y02080 17760002
*        GET WTG,EOV                                             Y02080 17780002
*                                                                Y02080 17800002
*        0 - LENGTH OF WORK AREA (0 FOR WTG)                     Y02080 17820002
*        1 - ADDRESS OF USER'S PARAM LIST                        Y02080 17840002
*        4 - 0 IF WTG, 1 IF EOV                                  Y02080 17860002
*        5 - BASE REG FOR 19RA                                   Y02080 17880002
*        14 - RETURN ADDRESS                                     Y02080 17900002
*        15 - REGISTER SAVE AREA ADDRESS                         Y02080 17920002
**************************************************************** Y02080 17940002
RES01810 LA    RA,K0(,RET)              SAVE RETURN ADDRESS      Y02080 17960002
         MODESET EXTKEY=ZERO            KEY = ZERO               Y02080 17980002
RES01812 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        *18000002
               RELATED=(LOCAL,IFG019RA(RES01827))                Y02080 18020002
         LTR   RD,RD                    TEST FOR ERROR           Y02134 18040002
         BNZ   ERROR1                   BRANCH IF SETLOCK ERROR  Y02080 18060002
         LR    R8,R1                    ADDR OF USER'S PARAM LST Y02080*18080002
                                        OR ADDR DCB FOR EOV/FEOV Y02080 18100002
         SLL   R4,K31                   GET WTG, EOV INDICATOR   Y02080 18120002
         OR    RA,R4                    SAVE INDR ACROSS GET     Y02080 18140002
         LA    R9,K1                    1 DCB FOR EOV            Y02080 18160002
         LTR   RA,RA                    CHECK IF EOV             Y02080 18180002
         BM    RES01816                 EOV - NO DCB COUNT       Y02080 18200002
***                                                              Y02080 18220002
* NUMBER OF DCBS COMPUTED                                        Y02080 18240002
***                                                              Y02080 18260002
         L     R4,CVTPTR                LOAD CVT ADDRESS         Y02080 18280002
         L     R4,CVTTCBP-CVT(,R4)      ADDR OF TCB/ASCB PTRS    Y02080 18300002
         L     R4,K4(,R4)               ADDR OF CURRENT TCB      Y02080 18320002
         USING TCB,R4                   TCB FOR MODESET          Y02080 18340002
         MODESET EXTKEY=RBT234,WORKREG=2 USER'S KEY              Y02080 18360002
         DROP  R4                       NO TCB ADDR              Y02080 18380002
         LR    R6,R8                    ADDR USER PARAM LIST     Y02080 18400002
         LA    R9,K0                    INIT COUNT               Y02080 18420002
RES01814 TM    PLISTOPT(R6),LASTNTRY    CHECK IF LAST DCB ADDR   Y02080 18440002
         LA    R9,K1(,R9)               INCREMENT COUNT          Y02080 18460002
         LA    R6,K4(,R6)               INCREMENT TO NEXT ADDR   Y02080 18480002
         BNO   RES01814                 CHECK NEXT DCB           Y02080 18500002
         MODESET EXTKEY=ZERO            KEY ZERO                 Y02080 18520002
***                                                              Y02080 18540002
* CALCULATE LENGTH OF CORE DESIRED                               Y02080 18560002
***                                                              Y02080 18580002
RES01816 LR    R6,R0                    INIT WITH CORE REQ ENTRY Y02080 18600002
         LR    RB,R9                    NUMBER OF DCBS           Y02080 18620002
         SLL   RB,K4                    4 BYTES PER USER PLIST ENTRY   *18640002
                                        4 BYTES PER ECBLIST ENTRY      *18660002
                                        8 BYTES PER WTG ENTRY    Y02080 18680002
         AR    R6,RB                    INCR SIZE BY ABOVE       Y02080 18700002
         LA    R6,WTGFIXED(,R6)         INCR FOR FIXED LENGTH    Y02080 18720002
*                                       EXT PREFIX, WTO PREFIX,  Y02080 18740002
*                                       WTG BASE + 1 ENTRY,      Y02080 18760002
*                                       RECOVERY PARAMETER LIST, Y02080 18780002
*                                       RES WORK AREA            Y02080 18800002
*                                       TEST IF TRACE WAS REQUESTED. IF 18820002
*                                       SO, GET CORE FOR TRACE BUFFER   18840002
         L     R3,CVTPTR                GET POINTER TO CVT       Y02080 18860002
         LA    R6,TRCBFRLN(,R6)         INCREMENT GETMAIN SIZE   Y02080 18980002
RES01817 EQU   *                        CONT SETUP FOR GETMAIN   Y02080 19000002
***                                                              Y02080 19020002
*        SET PARAMETERS FOR GET                                  Y02080 19040002
***                                                              Y02080 19060002
         LR    R0,R6                    LENGTH                   Y02080 19080002
         SR    R1,R1                    NO PREVIOUS PREFIX       Y02080 19100002
         LA    R2,SP230                 SUBPOOL                  YM3138 19120002
         LA    R3,K5                    DATAMGT KEY              Y02080 19140002
         LA    R4,K2                    PREFIX + LOCK HELD       Y02080 19160002
         LTR   RA,RA                    CHECK IF EOV OR O/C      Y02080 19180002
         BM    RES01818                 EOV BRANCH               Y02080 19200002
         BAL   RET,RES01830             GETMAIN AREA             Y02080 19220002
         DC    CL4'O/C'                 STD ID FOR OPEN/CLOSE    Y02080 19240002
         B     RES01820                 INIT WORK AREA           Y02080 19260002
         EJECT                                                   Y02080 19270002
RES01818 BAL   RET,RES01830             GETMAIN AREA EOV         Y02080 19280002
         DC    CL4'EOV'                 ID FOR EOV               Y02080 19300002
*****************************************************************Y02080 19320002
*                                                                Y02080 19330002
*  RETURN FROM GETMAIN                                           Y02080 19340002
*                                                                Y02080 19360002
*        1 - ADDR OF EXTENDED PREFIX                             Y02080 19380002
*        8 - PRESERVED = USER'S PARAM LIST ADDR                  Y02080 19400002
*        9 - PRESERVED = NUMBER OF DCBS                          Y02080 19420002
*        10 - PRESERVED = ADDR RET TO INIT CALLER                Y02080 19440002
*        15 - PRESERVED = REG SAVE AREA ADDR                     Y02080 19460002
*                                                                Y02080 19480002
*        LOCAL LOCK HELD AND IN KEY 5                            Y02080 19500002
*****************************************************************Y02080 19520002
RES01820 LA    RB,IECSTART-IECPREFX     OFFSET FROM BASE TO EXT  Y02080 19540002
         SR    R1,RB                    PTR TO BASE PREFIX       Y02080 19560002
         USING IECPREFX,R1              BASE PREFIX              Y02080 19580002
         LA    R0,K0                    NO CORE AREA FOR WTG     Y02080 19600002
         LTR   RA,RA                    WTG?                     Y02080 19620002
         BNM   RES01822                 BR WTG                   Y02080 19640002
         LA    R0,EOVSIZE               LENGTH OF EOV W/A        Y02080 19660002
RES01822 LA    R2,IECOCEND              ADDRESS TO BE RETURNED   Y02080 19680002
         LR    RWTG,R2                  GET AREA POINTER         Y02080 19700002
         AR    RWTG,R0                  ADDR WTO PREFIX          Y02080 19720002
         MVC   0(K4,RWTG),MSGPREFX      SET WTO MSG PREFIX       Y02080 19740002
         LA    RWTG,WTG-WTGTABLE(,RWTG) ADDR OF WTG TABLE        Y02134 19760002
         ST    RWTG,IECWTGTB            ADDR WTG TBL IN EXT PREF Y02080 19780002
         ST    R1,WTGPREFX              SET ADDR BASE IN WTGTBL  Y02080 19800002
         LR    RD,R9                    NUMBER OF DCBS           Y02080 19820002
         SLL   RD,K3                    8 BYTES PER WTG ENTRY    Y02080 19840002
         LA    RB,WTGEND-WTG(RD,RWTG)   ADDR RECOVERY PARAM LIST Y02080 19860002
         ST    RB,IECRRPRM              ADDR RECOVERY PARAM LIST Y02080 19880002
         LA    RB,RRPLEND-IECRRPL(,RB)  ADDR OF USER'S PARAM LST Y02080 19900002
         ST    RB,IECUPRML              SAVE ADDR USER'S PLIST   Y02080 19920002
         STC   R9,IECDCBNO              SAVE NO. OF DCBS         Y02144 19940002
         LTR   RA,RA                    CHECK IF EOV             Y02080 19980002
         BM    RES01825                 EOV                      Y02080 20000002
         LR    R2,RWTG                  RETURN ADDR WTG IF O/C   Y02080 20020002
         LR    RC,R8                    SAVE USER PARMLIST PTR @ZA01491 20025002
         LR    RD,R9                    NUMBER OF DCBS           Y02080 20040002
         L     R4,CVTPTR                LOAD CVT POINTER       @ZA01491 20060002
         L     R4,CVTTCBP-CVT(,R4)      LOAD TCB POINTERS      @ZA01491 20080002
         L     R4,K4(,R4)               LOAD CURRENT TCB PTR   @ZA01491 20085002
         L     R4,TCBRBP-TCB(,R4)       LOAD CURRENT RB POINTER@ZA01491 20090002
         L     R4,RBLINK-RBBASIC(,R4)   LOAD CALLER RB POINTER @ZA01491 20090202
RES01824 EQU   *                        LOOP TO COPY PARMS     @ZA01491 20091402
         MODESET KEYADDR=RBOPSW+K1-RBBASIC(,R4),WORKREG=14     @ZA02166 20092202
*                                                                       20092602
*********************************************************************** 20093002
*                                                                       20093402
*        COPY USER PARAMETER LIST TO AVOID POSSIBLE ASYNCHRONOUS        20093802
*        MODIFICATION AND AVOID POSSIBLE INTEGRITY EXPOSURE.            20094202
*                                                                       20098202
*********************************************************************** 20098402
*                                                                       20098602
*        A PROGRAM CHECK AT THE NEXT INSTRUCTION INDICATES              20099002
*        THAT THE CALLERS PARAMETER LIST IS NOT IN THE SAME KEY         20099202
*        THAT THE CALLER WAS IN WHEN HE ISSUED THE SVC.                 20099402
*                                                                       20099602
*********************************************************************** 20099802
*                                                                       20099902
         L     RET,DXDCBLST-USERPRML(,RC) LOAD DCB PARM        @ZA01491 20100002
*                                                                       20101002
*********************************************************************** 20102002
*                                                                       20103002
         MODESET EXTKEY=DATAMGT         OUR KEY                @ZA01491 20105002
         ST    RET,DXDCBLST-USERPRML(,RB) COPY TO OUR LIST     @ZA01491 20120002
         LA    RC,L'DXDCBLST(,RC)       NEXT IN USER LIST      @ZA01491 20160002
         LA    RB,L'DXDCBLST(,RB)       NEXT IN OUR LIST       @ZA01491 20180002
         BCT   RD,RES01824              BRANCH IF MORE         @ZA01491 20190002
         LA    RD,L'DXDCBLST            GET OFFSET TO LAST     @ZA01491 20195002
         SR    RB,RD                    SUBTRACT GET LAST ENTRY@ZA01491 20196002
         OI    DXDCBLST-USERPRML(RB),LASTNTRY END OF PARM LIST   Y02134 20200002
         B     RES01826                 CONTINUE                 Y02080 20220002
RES01825 ST    R8,DXDCBLST-USERPRML(,RB) STORE DCB IN PARM LIST  Y02134 20260002
         OI    DXDCBLST-USERPRML(RB),LASTNTRY END OF PARM LIST   Y02134 20280002
         LR    R8,RB                    PT TO W/A PARM LIST      Y02080 20300002
RES01826 LA    RB,L'DXDCBLST(,RB)       ADDR OF RES WORK AREA    Y02080 20320002
         ST    RB,IECRESWA              SAVE RES WA POINTER      Y02134 20340002
         ST    R8,RWAPARM-RWARESWA(,RB) ADDRESS OF USER PARMLIST Y02134 20360002
         LR    R8,RB                    SAVE RESIDENT WKA PTR    Y02080 20380002
*                                                                       20385002
         MODESET EXTKEY=SUPR            SETLOCK KEY            @ZA01491 20390002
*                                                                       20395002
RES01827 SETLOCK RELEASE,TYPE=LOCAL,    END OF USER MOVE         Y02134X20400002
               RELATED=(LOCAL,IFGO19RA(RES01812))                Y02080 20420002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 20440002
         BNZ   ERROR1                   BRANCH IF SETLOCK ERROR  Y02080 20460002
         MODESET EXTKEY=DATAMGT         KEY OF AREA              Y02080 20480002
*                                                                       20500002
         L     RET,CVTPTR               LOAD POINTER TO CVT      Y02080 20520002
         TM    CVTGTFST-CVT(RET),CVTGTFAV  IS GTF ACTIVE         YM7365 20540002
         BNO   RES01828                 NO, DON'T LOAD IFG019TR  Y02080 20560002
         LR    RB,R8                    RESTORE RESIDENT WKA PTR Y02080 20580002
         USING RWARESWA,R8              RESIDENT WORK AREA       Y02080 20600002
         LR    RD,R9                    NUMBER OF DCB'S          Y02080 20620002
         SLL   RD,2                     4 BYTES PER DCB          Y02080 20640002
         LA    RB,RWALIST-RWARESWA(RD,RB) INCREMENT TO TRACE     Y02080C20660002
                                        BUFFER ADDRESS           Y02080 20680002
         ST    RB,RWATRBUF              SAVE TRACE BUFFER ADDR   Y02080 20700002
         LR    RD,RF                    SAVE REG SAVE AREA ADDR  Y02080 20720002
         IECRES LOAD,MODNM=TRAC,PREFIX=WTGPREFX,BRANCH=NO        Y02080C20740002
                                        GET EPA OF IFG019TR      Y02080 20760002
         LR    RF,RD                    RESTORE SAVE AREA ADDR   Y02080 20780002
         MVC   RWATRACE,WTGMODEP        SAVE EPA OF IFG019TR     Y02080 20800002
         XC    WTGMODNM(K12),WTGMODNM   CLEAR MODULE NAME + EPA  Y02080 20820002
         DROP  R8                       STOP USE OF RESWA DSECT  Y02080 20840002
         LR    R8,RB                    PT TO TRACE BUFFER       Y02080 20860002
         LA    RB,K8(,RB)               INCREMENT TO FIRST DATA  Y02080 20880002
         ST    RB,K4(R8)                SAVE PTR TO FIRST DATA   Y02080 20900002
         MVC   K2(L'FID,R8),FID         MOVE FORMAT ID TO BUFFER Y02080 20920002
*                                                                       20940002
RES01828 EQU   *                        ESTABLISH RECOVERY RTN   Y02080 20960002
         USING WTGENTRY,RWTGC           RESTORE ADDRESSABILITY   Y02080 20980002
         LA    RET,RR0A                 PT TO O/C/E RECOVERY RTN Y02144 21000002
         BAL   RC,RES06000              ESTABLISH RECOVERY RTN   Y02144 21020002
*                                                                       21040002
         BAL   RC,RES01850              ENQ TIOT               @ZA30676 21060037
*                                                                       21065002
*        ON RETURN REGISTER 0 CONTAINS RETURN INDICATOR FROM ENQ YM3185 21070002
*        0 - ENQ SUCCESSFUL OR CALLER HOLDS RESOURCE SHARED      YM3185 21075002
*        4 - CALLER HOLDS RESOURCE EXCLUSIVELY                   YM3185 21080002
*                                                                       21085002
* SET UP TO RETURN TO CALLER                                     Y02080 21100002
*                                                                Y02080 21120002
*        15 RESTORED                                             Y02080 21140002
*        14 RETURN ADDR                                          Y02080 21160002
*        0 - RESULT OF ENQ ON TIOT                               YM3185 21170002
*        1 - ADDR OF BASE PREFIX                                 Y02080 21180002
*        2 - ADDR OF WORK AREA IF EOV OR WTG IF OPEN             Y02080 21200002
*        6 - ADDR WTG TABLE                                      Y02080 21220002
***                                                              Y02080 21240002
         LR    RET,RA                   SET RETURN ADDR          Y02080 21260002
         LR    R1,R2                    ADDR OF AREA             Y02144 21280002
         BR    RET                      RETURN                   Y02080 21300002
         DROP  R1                                                Y02080 21320002
         EJECT                                                   Y02080 21340002
***                                                              Y02080 21360002
*        GET LOCAL LOCK FOR ENTRY TO GETMAIN                     Y02080 21380002
***                                                              Y02080 21400002
RES01830 LR    R6,RET                   SAVE RET ADDR            Y02080 21420002
         MODESET EXTKEY=ZERO            KEY 0 FOR SETLOCK        Y02080 21440002
         SLL   R4,K2                    CONVERT INDEX TO OFFSET  Y02080 21460002
         L     R4,RES01801(R4)          GET OPTIONS MASK         Y02080 21480002
         LR    RC,R4                    SAVE OPTIONS             Y02080 21500002
         N     R4,RES01802              PREFIX DESIRED           Y02080 21520002
         BZ    RES01831                 NO - THEN DON'T          Y02080 21540002
         LA    RB,IECSTART-IECPREFX     OFFSET FOR BASE PREFIX   Y02080 21560002
         AR    R0,RB                    ALLOW FOR BASE PREFIX    Y02080 21580002
RES01831 LR    R4,RC                    GET OPTIONS MASK         Y02080 21600002
         N     R4,RES01804              LOCK ALREADY HELD?       Y02080 21620002
         LR    R4,RC                    RESTORE MASK             Y02080 21640002
         BNZ   RES01834                 YES - THEN NO GET LOCK   Y02080 21660002
RES01832 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080*21680002
               RELATED=(LOCAL,IFG019RA(RES01847))                Y02080 21700002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 21720002
         BNZ   ERROR1                   BRANCH IF SETLOCK ERROR  Y02080 21740002
***                                                              Y02080 21760002
*        SET UP FOR GETMAIN                                      Y02080 21780002
***                                                              Y02080 21800002
RES01834 LR    RB,RF                    SAVE REG SAVE AREA ADDR  Y02080 21820002
         SLL   R3,K4                    00 00 00 KEY0            Y02080 21840002
         LR    RC,R4                    SAVE INDICATORS          Y02080 21860002
         OR    RC,R3                    MASK - KEY               Y02080 21880002
         L     R4,CVTPTR                PT CVT                   Y02080 21900002
         L     R4,CVTTCBP-CVT(,R4)      PT TO THE TCB/ASCB WORDS Y02080 21920002
         L     R7,K12(,R4)              PT ASCB                  Y02080 21940002
         L     R4,K4(,R4)               PT CURRENT TCB           Y02080 21960002
         LR    RD,R1                    SAVE PREFIX PTR          Y02080 21980002
         SR    R1,R1                    SCAFFOLD GETMAIN INDR    Y02080 22000002
         GETMAIN RU,SP=(R2),LV=(0),KEY=(3),BRANCH=YES            Y02080 22020002
         LR    R7,RC                    MASK - KEY               Y02080 22040002
         LR    R4,R2                    SAVE SP                  Y02080 22060002
         LR    R2,RC                    SAVE KEY OF AREA         Y02080 22080002
         MODESET KEYADDR=(2),WORKREG=2                           Y02080 22100002
***                                                              Y02080 22120002
*        CLEAR AREA TO ZEROS                                     Y02080 22140002
***                                                              Y02080 22160002
         LR    RC,R0                    SAVE LENGTH OF AREA      Y02080 22180002
         LR    RET,R1                   SAVE ADDR OF AREA        Y02080 22200002
         LR    R0,R1                    ADDR OF AREA             Y02080 22220002
         LR    R1,RC                    LENGTH OF AREA           Y02080 22240002
         LA    RF,K0                    FILL CHARACTER 0         Y02080 22260002
         MVCL  R0,RET                   CLEAR WORK AREA          Y02080 22280002
***                                                              Y02080 22300002
*        CHECK IF PREFIX                                         Y02080 22320002
***                                                              Y02080 22340002
         LR    R1,RET                   GET ADDR OF AREA         Y02080 22360002
         SLL   R2,K24                   KEY0 00 00 00            Y02080 22380002
         OR    R2,R4                    KEY0 00 00 SP            Y02080 22400002
         LR    RF,R7                    GET OPTIONS MASK         Y02080 22420002
         N     RF,RES01802              PREFIX REQUIRED?         Y02080 22440002
         BZ    RES01846                 NO - EXIT                Y02080 22460002
***                                                              Y02080 22480002
* ESTABLISH PREFIX                                               Y02080 22500002
***                                                              Y02080 22520002
         USING IECPREFX,R1              R1 PTS TO BASE PREFIX    Y02080 22540002
         MVC   IECCORID,K0(R6)          SET CORE ID              Y02080 22560002
         CLI   IECCORID,BLANK           CHECK FOR ID             Y02134 22580002
         BNE   RES01838                 BRANCH IF ID SPEC        Y02134 22600002
         MVC   IECCORID,OCED            MOVE IN DUMMY ID         Y02134 22620002
RES01838 ST    R2,IECCORKY              SAVE KEY AND SP          Y02080 22640002
         ST    RC,IECCORLN              SAVE LENGTH OF CORE      Y02080 22660002
         LA    RC,IECSTART              GET ADDR OF WORK AREA    Y02080 22680002
         ST    RC,IECCORAD              SET WORK AREA ADDR       Y02080 22700002
*                                                                Y02080 22720002
         LTR   RD,RD                    PREVIOUS PREFIX?         Y02080 22740002
         BZ    RES01840                 NO - THEN FIRST          Y02080 22760002
         LA    R3,IECSTART-IECPREFX     LENGTH OF BASE PREFIX    Y02080 22780002
         SR    RD,R3                    BACK UP TO BASE          Y02080 22800002
***                                                              Y02080 22820002
*        SET UP NTH ENTRY                                        Y02080 22840002
***                                                              Y02080 22860002
         MODESET EXTKEY=ZERO            KEY ZERO FOR MULTIPLE    Y02080*22880002
                                        KEYED AREAS - PROB IF    Y02080*22900002
                                        FETCH PROTECTED          Y02080 22920002
         L     RET,IECCORPS-IECPREFX(,RD) PTR TO HEAD            Y02080 22940002
         ST    RET,IECCORPS             SET CURRENT PTR TO HEAD  Y02080 22960002
         ST    RET,IECCORP2             SET CURR FWD PTR TO HEAD Y02080 22980002
         L     RF,IECCORP1-IECPREFX(,RET) GET PTR TO LAST        Y02080 23000002
         ST    RF,IECCORP1              SET CURR BACK PTR TO LST Y02080 23020002
         ST    R1,IECCORP2-IECPREFX(,RF)  SET LST FWD PTR TO CUR Y02080 23040002
         ST    R1,IECCORP1-IECPREFX(,RET)  SET FIRST BACK PTR TO Y02080*23060002
                                        CURRENT                  Y02080 23080002
         B     RES01842                 EXIT                     Y02080 23100002
***                                                              Y02080 23120002
*        FIRST PREFIX                                            Y02080 23140002
***                                                              Y02080 23160002
RES01840 ST    R1,IECCORPS              SET HEAD PTR TO THIS     Y02080 23180002
         ST    R1,IECCORP1              SET BACK PTR TO THIS     Y02080 23200002
         ST    R1,IECCORP2              SET FWD PTR TO THIS      Y02080 23220002
*                                                                Y02080 23240002
RES01842 L     R1,IECCORAD              R1 PTS TO WRK AREA ON RT Y02080 23260002
         DROP  R1                                                Y02080 23280002
         LA    R6,K4(,R6)               SET RETURN ADDR PAST ID  Y02080 23300002
***                                                              Y02080 23320002
*        SET UP RETURN                                           Y02080 23340002
***                                                              Y02080 23360002
RES01846 EQU   *                        RELEASE LOCAL LOCK       Y02080 23380002
         MODESET EXTKEY=ZERO            KEY 0 FOR SETLOCK        Y02080 23400002
         LR    RF,RB                    RESTORE SAVE AREA        Y02080 23420002
         N     R7,RES01804              LOCK HELD ON ENTRY       Y02080 23440002
         BNZ   RES01848                 RETURN IF TRUE           Y02080 23460002
RES01847 SETLOCK RELEASE,TYPE=LOCAL,                             Y02080*23480002
               RELATED=(LOCAL,IFG019RA(RES01832))                Y02080 23500002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 23520002
         BNZ   ERROR1                   BRANCH IF ERROR          Y02134 23540002
RES01848 SRL   R2,K24                   00 00 00 KEY0            Y02080 23560002
         MODESET KEYADDR=(2),WORKREG=2  SET RET KEY              Y02080 23580002
RES01849 LR    RET,R6                   SET UP RETURN            Y02080 23600002
         BR    RET                      RETURN                   Y02080 23620002
         EJECT                                                          23640002
***                                                                     23660002
*        THIS SECTION ENQ'S UPON THE TIOT.                       Y02134 23680002
*                                                                       23700002
*        THE TIOT IS ENQ'ED WHEN AN EOV WORK AREA OR A WTG       Y02134 23720002
*        IS OBTAINED.                                            Y02134 23740002
*                                                                       23760002
*        THE TIOT RESOURCE IS A SYSTEM (NOT STEP) RESOURCE -     Y02134 23780002
*              MAJOR NAME - SYSZTIOT                             Y02134 23800002
*              MINOR NAME - SIX BYTES CONTAINING                 Y02134 23820002
*                TWO BYTE ASID,                                  Y02134 23840002
*                FOUR BYTE DSAB QDB ADDRESS OBTAINED FROM THE    Y02134 23860002
*                ACTIVE JSCB.                                    Y02134 23880002
*        THE ENQ IS ISSUED RET=HAVE FOR SHARED CONTROL. THIS     Y02134 23900002
*        TASK WILL WAIT FOR THE RESOURCE IF ANOTHER TASK         Y02134 23920002
*        HAS IT EXCLUSIVELY. IF THE ENQ IS SUCCESSFUL,           Y02134 23940002
*        THE BIT WTGTSENQ IN THE WTG TABLE AT WTGPATHS+1         Y02134 23960002
*        WILL BE SET TO 1 INDICATING THAT THE RESOURCE SHOULD    Y02134 23980002
*        BE DEQ'ED WHEN THE EOV OR WTG WORK AREA IS FREED.       Y02134 24000002
*        IF THIS TASK HAD PREVIOUSLY ACQUIRED THE RESOURCE       Y02134 24020002
*        FOR SHARED CONTROL OR EXCLUSIVE CONTROL                 YM3185 24030002
*        (AS IN EOV BEING CALLED FROM CLOSE), BIT WTGTSENQ       Y02134 24040002
*        IN THE WTG TABLE AT WTGPATHS+1 WILL NOT BE SET TO 1.    Y02134 24060002
*                                                                       24062002
*        IF THE ENQ WAS SUCCESSFUL OR IF THE CALLER HOLDS THE    YM3185 24064002
*        TIOT RESOURCE FOR SHARED CONTROL, A RETURN CODE OF ZERO YM3185 24066002
*        WILL BE PASSED BACK IN REGISTER 0. IF THE CALLER HOLDS  YM3185 24068002
*        THE RESOURCE FOR EXCLUSIVE CONTROL, A RETURN CODE OF    YM3185 24070002
*        FOUR WILL BE PASSED BACK IN REGISTER 4.  THIS RETURN    YM3185 24072002
*        CODE WILL BE RETURNED TO THE CALLER OF IECRES GET,      YM3185 24074002
*        PREFIX=WTG OR PREFIX=EOV.                               YM3185 24076002
*                                                                       24080002
*        UPON ENTRY TO THIS SUBROUTINE RC CONTAINS THE RETURN  @ZA30676 24100037
*        ADDRESS.  RB, RC, RET MAY BE USED AS WORK REGISTERS.    Y02134 24120002
*        R2 POINTS TO THE START OF THE WTG TABLE OR THE EOV      Y02134 24140002
*        WORK AREA.  R1 POINTS TO THE BASE PREFIX.               Y02134 24160002
*                                                                       24180002
RES01850 EQU   *                        ISSUE ENQ ON TIOT        Y02134 24200002
         STM   RB,R6,IECREGSV-IECPREFX(R1) SAVE 12 REGISTERS     Y02134 24220002
         LA    R3,IECREGSV-IECPREFX+K4*K12(,R1)  POINT TO PARM   Y02134X24240002
                                        LIST IMMEDIATELY AFTER   YM3138X24250002
                                        THE 12 SAVED REGISTERS   YM3138 24260002
         USING ENQPARMS,R3              USING ON ENQ PARM LIST   Y02134 24270002
         MVC   ENQLIST(ENQLTH),ENQMACRO  MOVE IN LIST FORM       Y02134 24280002
         L     RB,CVTPTR                CVT ADDRESS              Y02134 24300002
         USING CVT,RB                                            Y02134 24320002
         L     RB,CVTTCBP               TCB/ASCB POINTERS        Y02134 24340002
         DROP  RB                                                Y02134 24360002
         L     RC,K12(,RB)              CURRENT ASCB             Y02134 24380002
         USING ASCB,RC                                           Y02134 24400002
         MVC   ENQASID,ASCBASID         ASID TO MINOR NAME       Y02134 24420002
         DROP  RC                                                Y02134 24440002
         L     RB,K4(,RB)               CURRENT TCB              Y02134 24460002
         USING TCB,RB                                            Y02134 24480002
         L     RB,TCBJSCB               TCB'S JSCB               Y02134 24500002
         USING IEZJSCB,RB                                        Y02134 24520002
         L     RB,JSCBACT               ACTIVE JSCB              Y02134 24540002
         MVC   ENQDSABQ,JSCDSABQ        DSAB QDB TO MINOR NAME   Y02134 24560002
         DROP  RB                                                Y02134 24580002
         ENQ   (,ENQMIN),MF=(E,ENQLIST)  ENQ TIOT                Y02134 24600002
         SR    R0,R0                    SET RETURN CODE 0        YM3185 24610002
         LTR   RF,RF                    ENQ SUCCESSFUL           Y02134 24620002
         BZ    RES01856                 BRANCH IF YES            Y02134 24640002
*                                                                       24642002
*        RETURN CODE OF 8 SHOULD BE PRESENT                      YM3185 24650002
*                                                                       24652002
         CLI   K3(RF),K8                WAS TIOT PREVIOUSLY      Y02134 24660002
*                                       ENQED BY THIS TASK       Y02134 24680002
         BNE   ERROR2                   BRANCH IF OTHER ERROR    Y02134 24700002
*                                                                       24702002
*        IF BIT 3 OF THE FIRST BYTE IS SET TO 1, THEN THE TASK   YM5904 24703002
*        HOLDS THE RESOURCE SHARED.  IF BIT 3 OF THE FIRST BYTE  YM5904 24704002
*        IS SET TO 0, THE TASK HOLDS THE RESOURCE EXCLUSIVELY.   YM5904 24705002
*                                                                       24708002
         TM    K0(RF),X10               TEST IF THE CALLER IS    YM5904X24710002
                                        ENQ'ED EXCLUSIVELY       YM5904 24711002
         BO    RES01857                 BRANCH IF ENQ'ED SHARED  YM5904 24712037
         LA    R0,K4(,0)                RETURN CODE TO CALLER    YM3185 24722037
         B     RES01857                 YES - DON'T SET ENQ BIT  YM1423 24732037
RES01856 OI    WTGPATHS+K1,WTGTSENQ     INDICATE ENQ SUCCESSFUL  Y02134 24742037
RES01857 EQU   *                        RETURN TO CALLER         YM1423 24752037
         XC    ENQLIST(ENQPARML),ENQLIST  ZERO ENQ LIST          Y02134 24780002
         DROP  R3                       DROP ENQ LIST POINTER    Y02134 24800002
         L     R1,WTGPREFX              LOAD PREFIX POINTER      Y02134 24820002
*                                                                       24830002
*        RESTORE RB - R6 BUT NOT R0, IT CONTAINS RETURN CODE     YM3185 24840002
*                                                                       24850002
         LM    RB,RF,IECREGSV-IECPREFX(R1) RESTORE FIRST 5 REGS  YM3185 24854002
*                                       RESTORE LAST 6 REGS      YM3185 24856002
         LM    R1,R6,IECREGSV-IECPREFX+(RF+K1-RB+(R1-R0))*K4(R1) YM3185 24858002
         LTR   R0,R0                    RET CODE=0 ?           @ZA15963 24860037
         BNZ   RES01858                 NO, BRANCH             @ZA15963 24861037
         BR    RC                       RETURN TO CALLER       @ZA30676 24862037
RES01858 L     R1,WTGPREFX              LOAD PREFIX POINTER    @ZA15963 24863037
         STM   R0,RF,IECREGSV-IECPREFX(R1) SAVE REGS           @ZA15963 24863337
         L     R2,IECUPRML-IECPREFX(,R1) POINT TO COPY OF PLIST@ZA15963 24863737
         L     R2,PLISTDCB(,R2)         LOAD ADDR OF DCB/ACB   @ZA15963 24864437
         LR    R3,R2                    POINT R3 TO DCB/ACB    @ZA15963 24865137
         USING IHADCB,R2                USE R2 FOR DCB         @ZA15963 24865837
         USING IFGACB,R3                USE R3 FOR ACB         @ZA15963 24866537
         MODESET EXTKEY=ZERO            KEY ZERO               @ZA15963 24866837
         TM    DCBMACRF,DCBMEXCP        EXCP DCB ?             @ZA15963 24867237
         BO    RES01859                 YES, BRANCH            @ZA15963 24867937
         TM    DCBDSRG2,ACBDORGA        ACB/AMB ?              @ZA15963 24868637
         BNO   RES01859                 NO, BRANCH             @ZA15963 24869337
         TM    ACBINFLG,ACBCAT+ACBSCRA  VSAM CAT FUNCTION ?    @ZA15963 24870037
         BNO   RES01859                 NO, BRANCH             @ZA15963 24870737
         DROP  R2,R3                    DROP DCB/ACB REGS      @ZA15963 24871437
         MODESET EXTKEY=DATAMGT         OPEN KEY               @ZA15963 24872137
         TESTAUTH FCTN=1,KEY=YES,BRANCH=YES                    @ZA15963 24872837
         LTR   RF,RF                    AUTHORIZED ?           @ZA15963 24873537
         L     R1,WTGPREFX              LOAD PREFIX POINTER    @ZA15963 24874237
         LM    R0,RF,IECREGSV-IECPREFX(R1) RESTORE REGS        @ZA15963 24874937
         BNZ   RES01861                 NOT AUTHORIZED,BRANCH  @ZA15963 24875637
         SR    R0,R0                    RET CODE 0 TO CALLER   @ZA15963 24876337
         B     RES01861                 BRANCH TO RETURN       @ZA15963 24877037
RES01859 MODESET EXTKEY=DATAMGT         OPEN KEY               @ZA15963 24877737
         L     R1,WTGPREFX              LOAD PREFIX POINTER    @ZA15963 24878037
         LM    R0,RF,IECREGSV-IECPREFX(R1) RESTORE REGS        @ZA15963 24878437
RES01861 BR    RC                       RETURN TO CALLER       @ZA30676 24879137
         TITLE 'IFG019RA--OPEN/CLOSE/EOV/DADSM FREEMAIN FACILITY'      *24880002
                                                                 Y02080 24900002
*********************************************************************** 24920002
*                                                                     * 24940002
*        FUNCTION PROLOGUE                                            * 24960002
*                                                                     * 24980002
*********************************************************************** 25000002
*                                                                       25020002
* FUNCTION NAME -                                                       25040002
*                                                                       25060002
*        FREEMAIN FACILITY FOR OPEN/CLOSE/EOV/DADSM                     25080002
*                                                                       25100002
* FUNCTION -                                                            25120002
*                                                                       25140002
*        THIS ROUTINE HAS TWO FUNCTIONS:  IT CAN FREE A SINGLE          25160002
*        WORK AREA, OR IT CAN FREE A CHAIN OF WORK AREAS.               25180002
*                                                                       25200002
*        IECRES FREE UNCHAINS THE WORK AREA BEING RELEASED AND          25220002
*        RECHAINS THE REMAINING WORK AREAS, IF NECESSARY.               25240002
*                                                                       25260002
*        IECRES FREE,PREFIX=WTG, =EOV, OR =FIRST DEQUEUES THE           25280002
*        TIOT IF IT WAS ENQUEUED DURING THE GETMAIN ROUTINE AND         25300002
*        DELETES THE RECOVERY ROUTINE ENVIRONMENT THAT WAS              25320002
*        ESTABLISHED AT THAT TIME.  IT THEN RELEASES THE INITIAL        25340002
*        WORK AREA AND ALL WORK AREAS CHAINED FROM THE INITIAL          25360002
*        WORK AREA.                                                     25380002
*                                                                       25400002
* ENTRY POINTS -                                                        25420002
*                                                                       25440002
*        ENTRY TO THIS MODULE IS MADE BY A DIRECT BRANCH FROM ANY       25460002
*        MODULE IN THE COMPONENT.                                       25480002
*              IFG019RA+48 - ENTRY FOR FREEMAIN FACILITY                25500002
*              IFG019RA+52 - ENTRY TO FREE PREFIX=WTG, =EOV, OR =FIRST  25520002
*                                                                       25540002
* INPUT -                                                               25560002
*                                                                       25580002
*        REGISTERS -                                                    25600002
*        0 - AMOUNT OF STORAGE BEING FREED IF PREFIX=NO                 25620002
*        1 - ADDR OF PREFIX OR EXTENDED PREFIX OR WORK AREA TO BE FREED 25660002
*        2 - SUBPOOL FOR THE AREA IF PREFIX=NO                          25680002
*        3 - STORAGE PROTECT KEY OF THE AREA IF PREFIX=NO               25700002
*        4 - INDEX FOR PREFIX/LOCK STATUS IF PREFIX=YES OR =NO -        25720002
*            0 = WORK AREA HAS NO PREFIX/NO LOCAL LOCK HELD             25740002
*            1 = WORK AREA HAS A PREFIX/NO LOCAL LOCK HELD              25760002
*            2 = WORK AREA HAS A PREFIX/LOCAL LOCK HELD                 25780002
*            3 = WORK AREA HAS NO PREFIX/LOCAL LOCK HELD                25800002
*          - CALLER ID FOR PREFIX=WTG, =EOV, OR =FIRST -                25820002
*            0 = PREFIX=WTG                                             25840002
*            1 = PREFIX=WTG FROM THE RECOVERY ROUTINES                  25860002
*            2 = PREFIX=EOV                                             25880002
*            3 = PREFIX=EOV FROM THE RECOVERY ROUTINES                  25900002
*            4 = PREFIX=FIRST                                           25920002
*            5 = PREFIX=FIRST FROM THE RECOVERY ROUTINES                25940002
*        5 - BASE REGISTER FOR THIS MODULE                              25960002
*       14 - RETURN ADDRESS OF CALLING MODULE                           25980002
*       15 - ADDRESS OF THE REGISTER SAVE AREA FOR IECRES FREE ONLY     26000002
*                                                                       26020002
* OUTPUT -                                                              26040002
*                                                                       26060002
*        REGISTERS -                                                    26080002
*              8 - PRESERVED FOR THE CALLING MODULE                     26100002
*              9 - PRESERVED FOR THE CALLING MODULE                     26120002
*             10 - PRESERVED FOR THE CALLING MODULE                     26140002
*             14 - RETURN ADDRESS OF THE CALLING MODULE                 26160002
*             15 - ADDRESS OF A REGISTER SAVE AREA FOR IECRES FREE ONLY 26180002
*                                                                       26200002
*********************************************************************** 26220002
         EJECT                                                   Y02080 26240002
RES01860 LR    R6,RET                   SAVE RETURN              Y02080 26260002
         SLL   R3,K4                    00 00 00 KEY0 IF NO PRFX Y02080 26280002
         LR    R7,R2                    SP SAVED                 Y02080 26300002
         XR    R2,R2                    CLEAR FOR MODESET        YM8350 26310002
         MODESET EXTKEY=ZERO,SAVEKEY=(2) KEY 0 AND SAVE THE KEY  Y02080 26320002
         SLL   R4,K2                    CONVERT INDEX TO OFFSET  Y02080 26340002
         L     R4,RES01801(R4)          GET OPTS                 Y02080 26360002
         OR    R4,R2                    SAVE KEY ENTRY IN OPTS   Y02080 26380002
*                                                                       26400002
         LR    RC,R4                    GET OPTION MASK          Y02080 26420002
         N     RC,RES01804              TEST FOR LOCK HELD       Y02080 26440002
         BNZ   RES01865                 BRANCH IF LOCK HELD      Y02080 26460002
RES01864 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080*26480002
               RELATED=(LOCAL,IFG019RA(RES01876))                Y02080 26500002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 26520002
         BNZ   ERROR1                   BRANCH IF SETLOCK ERROR  Y02080 26540002
RES01865 LR    RB,RF                    SAVE REG SAVE AREA ADDR  Y02080 26560002
         LR    RD,R1                    SAVE ADDR W/A OR PREFIX  Y02080 26580002
         LR    R2,R7                    SAVE SP                  Y02080 26600002
         LR    RF,R4                    GET OPTS                 Y02080 26620002
         N     RF,RES01802              PREFIX?                  Y02080 26640002
         BZ    RES01870                 NO - THEN BR             Y02080 26660002
         LA    RC,IECSTART-IECPREFX     GET LENGTH OF BASE PREFX Y02080 26680002
         SR    R1,RC                    BACK UP TO BASE PREFX    Y02080 26700002
         LR    RD,R1                    POINT TO AREA TO FREE    Y02080 26720002
***                                                              Y02080 26740002
*        DELINK PREFIX                                           Y02080 26760002
***                                                              Y02080 26780002
         USING IECPREFX,R1                                       Y02080 26800002
RES01866 L     RC,IECCORPS              ADDR OF FIRST PREFIX     Y02080 26820002
         CR    R1,RC                    FREEING THE FIRST?       Y02080 26840002
         BNE   RES01868                 NO - THEN BR             Y02080 26860002
         LR    RD,RC                    SET PTR TO FIRST FOR     Y02080*26880002
                                        FREE ALL                 Y02080 26900002
         L     R1,IECCORP1-IECPREFX(,RC) FREE LAST               Y02080 26920002
*                                                                Y02080 26940002
RES01868 L     RF,IECCORP1              GET NEXT                 Y02080 26960002
         L     RC,IECCORP2              GET PREV                 Y02080 26980002
         ST    RC,IECCORP2-IECPREFX(,RF) SET PREV TO NEXT        Y02080 27000002
         ST    RF,IECCORP1-IECPREFX(,RC) SET NEXT TO PREV        Y02080 27020002
***                                                              Y02080 27040002
*        SET UP PARAMETER FOR FREEMAIN                           Y02080 27060002
***                                                              Y02080 27080002
         L     R0,IECCORLN              GET LENGTH               Y02080 27100002
         XR    R2,R2                    CLEAR REG FOR FREEMAIN   Y02134 27120002
         IC    R2,IECCORSP              GET SP                   Y02080 27140002
         XR    R3,R3                    CLEAR REG FOR FREEMAIN   Y02134 27160002
         IC    R3,IECCORKY              GET KEY                  Y02080 27180002
         DROP  R1                                                Y02080 27200002
***                                                              Y02080 27220002
*        COMMON FREEMAIN SETUP                                   Y02080 27240002
***                                                              Y02080 27260002
RES01870 LR    RC,R4                    SAVE MASK-KEY            Y02080 27280002
         LR    RF,R2                    SP                       Y02080 27300002
         LR    R2,R1                    SAVE ADDR TO FREE        Y02080 27320002
         L     R4,CVTPTR                CVT ADDRESS              Y02080 27340002
         L     R4,CVTTCBP-CVT(,R4)      TCB/ASCB PTRS            Y02080 27360002
         L     R7,K12(,R4)              PTR ASCB                 Y02080 27380002
         L     R4,K4(,R4)               PTR CURRENT TCB          Y02080 27400002
         FREEMAIN RU,LV=(R0),SP=(RF),KEY=(R3),A=(R1),BRANCH=YES  Y02080 27420002
***                                                                     27440002
*        ANY MORE                                                Y02080 27460002
***                                                              Y02080 27480002
         LR    R4,RC                    RESTORE MASK & KEY       Y02080 27500002
         LR    R1,RD                    SET UP TO FREE NEXT      Y02080 27520002
         CR    RD,R2                    DID WE FREE THE LAST ONE Y02080 27540002
         BNE   RES01866                 NO - FREE THE NEXT       Y02080 27560002
         LR    R2,R4                    GET KEY ON ENDTRY        Y02080 27580002
         LR    RF,RB                    RESTR REG SAVE AREA ADR  Y02080 27600002
***                                                              Y02080 27620002
*        FINISHED                                                Y02080 27640002
***                                                              Y02080 27660002
         LR    RC,R4                    GET OPTION MASK          Y02080 27680002
         N     RC,RES01804              TEST FOR LOCK HELD       Y02080 27700002
         BNZ   RES01877                 BRANCH IF LOCK HELD      Y02080 27720002
RES01876 SETLOCK RELEASE,TYPE=LOCAL,                             Y02080*27740002
               RELATED=(LOCAL,IFG019RA(RES01864))                Y02080 27760002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 27780002
         BNZ   ERROR1                   BRANCH IF ERROR          Y02080 27800002
RES01877 MODESET KEYADDR=(2),WORKREG=2  RESTORE ENTRY KEY        Y02134 27820002
         LR    RET,R6                   RESTORE RET ADDR         Y02080 27840002
         BR    RET                      RETURN                   Y02080 27860002
         EJECT                                                   YM3138 27880002
*                                                                       27900002
*        FREEMAIN THE EOV WORK AREA, THE OPEN/CLOSE WTG TABLE,          27920002
*        OR A FIRST DADSM WORK AREA                                     27940002
*                                                                       27960002
*        THIS ENTRY DEQS THE TIOT IF IT HAD BEEN ENQED,          Y02134 27980002
*        AND THEN BRANCHES TO THE FREEMAIN ROUTINE TO            Y02134 28000002
*        PERFORM THE FREEMAIN.                                   Y02134 28020002
*                                                                       28040002
*        UPON ENTRY FOR PREFIX=EOV OR =WTG, REGISTER 1 POINTS    Y02134 28060002
*        TO THE EXTENDED PREFIX OF THE EOV WORK AREA OR THE WTG  Y02134 28080002
*        TABLE.  THUS THE WTG TABLE CAN BE LOCATED FROM THE      Y02134 28100002
*        IECWTGTB ADDRESS IN THE EXTENDED PREFIX.                Y02134 28120002
*                                                                       28140002
*        THE WTGTSENQ BIT IN WTGPATHS+1 INDICATES WHETHER        Y02134 28160002
*        A DEQ NEED BE DONE. IF WTGTSENQ IS SET TO ONE,          Y02134 28180002
*        A DEQ IS ISSUED. OTHERWISE NO DEQ IS PERFORMED.         Y02134 28200002
*        FOR PREFIX=FIRST, CONTROL BRANCHES AROUND THE DEQ.      Y02134 28220002
*                                                                       28240002
*        REGISTERS 6, 7, 11, 12, AND 13 CAN BE USED AS WORK      Y02134 28260002
*        REGISTERS, BUT REGS 0-5, 8-9, 14-15 MUST NOT BE ALTERED Y02134 28280002
*        WITHOUT BEING RESTORED.                                 Y02134 28300002
*                                                                       28320002
RES01879 DS    0F                       FREEMAIN BXLE MASKS      Y02080 28340002
         DC    X'00000000'              WTG FREEMAIN             Y02080 28360002
         DC    X'20000000'              WTG RECOVERY FREEMAIN    Y02080 28380002
         DC    X'00000000'              EOV FREEMAIN             Y02080 28400002
         DC    X'20000000'              EOV RECOVERY FREEMAIN    Y02080 28420002
         DC    X'40000000'              FIRST FREEMAIN           Y02080 28440002
         DC    X'60000000'              FIRST RECOVERY FREEMAIN  Y02080 28460002
*                                                                       28480002
RES01880 EQU   *                        LOAD BXLE MASK           Y02134 28500002
         LA    RB,K1                    SET ARG FOR BXLE         Y02080 28520002
         SLL   R4,K2                    MULTIPLY BY FOUR         Y02134 28540002
         O     RB,RES01879(R4)          OR IN BXLE MASK          Y02080 28560002
         BXLE  RB,RB,RES01885           BRANCH AROUND DEQ        Y02080 28580002
         USING IECEXTPR,R1              R1 POINTS TO EXT PREFIX  Y02134 28600002
         L     R7,IECWTGTB              R7 POINTS TO WTG TABLE   Y02134X28620002
                                        OR TO DXXWTG             Y02134 28640002
         TM    WTGPATHS-WTG+K1(R7),WTGTSENQ  IS DEQ NEEDED       Y02134 28660002
         BZ    RES01885                 BRANCH IF NOT TO FREE    Y02134X28680002
                                        ENTRY                    Y02134 28700002
         LA    R7,IECREGSV              DEQ WORK AREA            Y02134 28720002
         USING DEQPARMS,R7              USE REG SAV AREA FOR DEQ Y02134 28740002
         L     R4,CVTPTR                CVT ADDRESS              Y02134 28760002
         USING CVT,R4                                            Y02134 28780002
         L     R4,CVTTCBP               TCB PTR WORDS            Y02134 28800002
         L     RC,K12(,R4)              CURRENT ASCB             Y02134 28820002
         USING ASCB,RC                                           Y02134 28840002
         MVC   DEQASID,ASCBASID         MOVE ASID TO MIN NAME    Y02134 28860002
         L     R4,K4(,R4)               CURRENT TCB              Y02134 28880002
         USING TCB,R4                                            Y02134 28900002
         L     R4,TCBJSCB               TCB'S JSCB               Y02134 28920002
         USING IEZJSCB,R4                                        Y02134 28940002
         L     R4,JSCBACT               ACTIVE JSCB ADDR         Y02134 28960002
         MVC   DEQDSABQ,JSCDSABQ        MOVE DSAB QDB ADDR TO    Y02134X28980002
                                        MINOR NAME               Y02134 29000002
         DROP  R1,R4,RC                 DROP REGISTER USAGE      YM3198 29020002
         MVC   DEQLIST(DEQLTH),DEQMACRO  MOVE IN LIST FORM       Y02134 29040002
         LR    R4,R0                    SAVE R0                  Y02134 29060002
         LR    RC,R1                    SAVE R1                  Y02134 29080002
         LR    R6,RET                   SAVE RET                 Y02134 29100002
         LR    RD,RF                    SAVE RF                  Y02134 29120002
         DEQ   (,DEQMIN),MF=(E,DEQLIST) DEQ TIOT                 Y02134 29140002
         LR    R0,R4                    RESTORE R0               Y02134 29160002
         LR    R1,RC                    RESTORE R1               Y02134 29180002
         LR    RET,R6                   RESTORE RET              Y02134 29200002
         LR    RF,RD                    RESTORE RF               Y02134 29220002
         DROP  R7                                                Y02134 29240002
RES01885 BXLE  RB,RB,RES01890           BRANCH AROUND ESTAE      Y02080 29260002
         LR    R4,R0                    SAVE R0                  Y02080 29280002
         LR    RC,R1                    SAVE R1                  Y02080 29300002
         LR    R6,RET                   SAVE RET                 Y02080 29320002
         LR    RD,RF                    SAVE RF                  Y02080 29340002
         ESTAE 0                                                 Y02080 29360002
         LR    R0,R4                    RESTORE R0               Y02080 29380002
         LR    R1,RC                    RESTORE R1               Y02080 29400002
         LR    RET,R6                   RESTORE RET              Y02080 29420002
         LR    RF,RD                    RESTORE RF               Y02080 29440002
RES01890 EQU   *                        FREEMAIN ROUTINE         Y02080 29460002
         LA    R4,K1                    LOAD FREEMAIN BXLE MASKS Y02080 29480002
         B     RES01860                 BRANCH TO FREE CORE      Y02080 29500002
         TITLE 'IFG019RA--OPEN/CLOSE/EOV/DADSM LOAD FACILITY'   Y02080  29660002
*********************************************************************** 29680002
*                                                                     * 29700002
*        FUNCTION PROLOGUE                                            * 29720002
*                                                                     * 29740002
*********************************************************************** 29760002
*                                                                       29780002
* FUNCTION NAME -                                                       29800002
*                                                                       29810002
*        LOAD FACILITY FOR OPEN/CLOSE/EOV/DADSM                         29820002
*                                                                       29840002
* FUNCTION -                                                            29860002
*                                                                       29870002
*        THERE ARE 3 LOAD FUNCTIONS - BRANCH=QUEUED, =DIRECT, AND =NO.  29880002
*                                                                       29900002
*        IECRES LOAD,BRANCH=QUEUED IS USED BY OPEN AND CLOSE WHEN       29920002
*        CONTROL IS TO BE PASSED TO ANOTHER OPEN OR CLOSE MODULE.       29940002
*        IT FIRST RESETS THE WAIT BIT.  THEN, IF A GTF TRACE WAS        29960002
*        REQUESTED, IT GIVES CONTROL TO THE TRACE ROUTINE (IFG019TR).   29980002
*        IT THEN LOOKS FOR A WTG TABLE ENTRY WITH THE CALLING MODULE'S  30000002
*        ID.  IF FOUND, IT GIVES IT CONTROL.  OTHERWISE, IT FINDS       30020002
*        THE MODULE ID WITH THE LOWEST COLLATING SEQUENCE AMONG THE     30040002
*        WTG TABLE ENTRIES AND GIVES IT CONTROL.                        30060002
*                                                                       30080002
*        IECRES LOAD,BRANCH=DIRECT OR BRANCH=NO FIRST LOCATES THE       30100002
*        ENTRY POINT ADDRESS OF THE MODULE SPECIFIED IN WTGMODNM.       30120002
*        IF WTGMODEP IS ZERO, IT BRANCHES TO THE ACTIVE LPA SEARCH      30140002
*        SERVICE ROUTINE (IEAQCDSR) AND POSSIBLY TO THE LPA SEARCH      30160002
*        SERVICE ROUTINE (IEAVVMSR) TO FIND THE ENTRY POINT ADDRESS.    30180002
*        IF NEITHER OF THESE ROUTINES CAN LOCATE THE MODULE, IT         30200002
*        ISSUES THE LOAD MACRO.  FOR BRANCH=DIRECT, CONTROL IS          30220002
*        PASSED TO THE SPECIFIED MODULE.  FOR BRANCH=NO, CONTROL IS     30240002
*        RETURNED TO THE CALLING MODULE WITH THE EPA IN WTGMODEP.       30260002
*                                                                       30280002
*        BEFORE PERFORMING THE LOAD, A TEST IS MADE TO DETERMINE IF     30480002
*        THE WTGMODEP FIELD IS NON-ZERO.  IF SO, IT IS ASSUMED THAT     30500002
*        THE EPA IS ALREADY KNOWN AND CONTROL WILL RETURN               30520002
*        IMMEDIATELY TO THE CALLING MODULE.  IF THE CALL TO LOAD        30540002
*        HAS COME FROM THE SELECT-LOAD OR LOAD AND BRANCH ENTRY OF      30560002
*        THIS MODULE, THIS WILL RESULT IN A BRANCH TO THE ADDRESS       30580002
*        IN 'WTGMODEP'.                                                 30600002
*                                                                       30620002
* ENTRY POINTS -                                                        30640002
*                                                                       30660002
*        ENTRY TO THIS MODULE IS MADE BY A DIRECT BRANCH FROM ANY       30680002
*        MODULE IN THE COMPONENT.                                       30700002
*              IFG019RA+4  - ENTRY FOR SELECTIVE LOAD AND BRANCH        30720002
*                            FACILITY (BRANCH=QUEUED)                   30740002
*              IFG019RA+20 - ENTRY FOR LOAD AND BRANCH FACILITY         30760002
*              IFG019RA+24 - ENTRY FOR LOAD AND RETURN FACILITY         30780002
*                                                                       30800002
* INPUT -                                                               31000002
*                                                                       31010002
*        REGISTERS -                                                    31020002
*        5 - BASE REGISTER FOR THIS MODULE                              31040002
*        6 - POINTER TO (PSEUDO) WHERE-TO-GO TABLE                      31060002
*       14 - RETURN ADDRESS OF CALLING MODULE                           31080002
*       15 - PTR TO PREFIX OF A WORK AREA WHERE REGISTERS MAY           31100002
*            BE SAVED, PRESERVED FOR THE CALLING MODULE.                31120002
*                                                                       31140002
*        STORAGE -                                                      31160002
*        THE FIELD 'WTGMODNM' MUST CONTAIN THE NAME (PADDED WITH        31180002
*        BLANKS) OF THE CSECT TO RECEIVE CONTROL.                       31200002
*        THE FIELD 'WTGMODEP' MUST BE ZERO IN ORDER TO GET THE          31220002
*        GIVEN MODULE LOADED.                                           31240002
*                                                                       31260002
* OUTPUT -                                                              31280002
*                                                                       31300002
*        THE OUTPUT OF THIS FUNCTION IS THE ENTRY POINT ADDRESS TO      31320002
*        THE MODULE WHOSE NAME IS IN 'WTGMODNM'.  FOR BRANCH=NO,        31340002
*        THIS ADDRESS IF PLACED IN THE FIELD 'WTGMODEP'.  HOWEVER,      31350002
*        FOR BRANCH=DIRECT, REGISTER 15 CONTAINS THE ENTRY POINT        31360002
*        ADDRESS, AND 'WTGMODEP' IS ZERO.                               31370002
*                                                                       31400002
*********************************************************************** 32040002
         EJECT                                                   Y02080 32060002
**************************************************************** Y02080 32080002
*                                                                Y02080 32100002
* ENTRY FOR LOAD,BRANCH=QUEUED                                   Y02080 32120002
*                                                                Y02080 32140002
**************************************************************** Y02080 32160002
*                                                                Y02080 32180002
         USING FORCORE,RCORE            WORK AREA                Y02080 32200002
RES01900 EQU   *                        RESET WAIT, PSEUDO-WAIT  YM3138 32220002
         MVI   DXRESIND,K0              ENSURE WAIT, PSEUDO-WAIT OFF    32240002
RES02000 EQU   *                        TEST IF TRACE REQUIRED   YM3138 32260002
         BAL   R7,RES03000              GO SAVE REGISTERS        Y02080 32280002
         TM    WTGPATHS+K1,WTGTRACE     IS TRACE RTN SPECIFIED   YM3138 32300002
         BNO   RES02100                 NO, SKIP TRACE                  32340002
         TM    JFCBMASK+K6,JFCTRACE     IS TRACE REQUESTED FOR THIS DCB 32360002
         BNO   RES02100                 NO, SKIP TRACE                  32380002
         L     RTIOT,WTGPREFX           GET PTR TO PREFIX        Y02080 32400002
         USING IECPREFX,RTIOT                                    Y02080 32420002
         L     RTIOT,IECRESWA           GET PTR TO RES WORK AREA Y02080 32440002
         USING RWARESWA,RTIOT                                    Y02080 32460002
         L     RF,RWATRACE              LOAD TRACE ROUTINE ADDR  YM4623 32470002
         LTR   RF,RF                    TEST IF THIS ADDR EXISTS YM4623 32480002
         BZ    RES02100                 BRANCH IF NOT            YM4623 32490002
         DROP  RTIOT                                             Y02080 32500002
         BALR  RET,RF                   GO TO TRACE RTN TO TRACE YM3138X32520002
                                        THIS DCB AND RETURN      YM3138 32540002
*                                                                       32560002
* RETURN FROM THE OPTIONAL TRACE ROUTINE                                32580002
*                                                                       32600002
RES02100 EQU   *                        GO INITIALIZE REGISTERS  YM3138 32620002
         BAL   RET,RES03100             GO INITIALIZE REGISTERS         32640002
*                                                                       32660002
* SCAN DCB'S FOR A DCB ACTIVE IN THIS MODULE.  IF ONE IS FOUND, LET     32680002
* WAIT SECTION HANDLE IT.                                               32700002
*                                                                       32720002
RES02200 EQU   *                        FIND AN ACTIVE DCB       YM3138 32740002
         CLC   WTGMODID,WTGIDTTR        IS THIS DCB ACTIVE       Y02080X32760002
                                        (MODULE ID'S EQUAL)             32780002
         BE    RES00600                 YES, LET WAIT SECTION HANDLE IT 32800002
         TM    PLISTOPT(RPARC),LASTNTRY  NO, IS THIS LAST PARAMETER     32820002
*                                       LIST ENTRY                      32840002
         BO    RES02300                 YES, NONE ACTIVE, GO INITIALIZE 32860002
         BAL   RET,RES03200             NO, INCREMENT TO NEXT DCB       32880002
         B     RES02200                 GO LOOP TO CHECK NEXT DCB       32900002
RES02300 EQU   *                        GO INITIALIZE            YM3138 32920002
         BAL   RET,RES03100             INITIALIZE                      32940002
         MVI   WTGMODID,HIGHID          SET HIGH ID IN WTG TABLE        33000002
*                                       BASIC SECTION SO PRESENT        33020002
*                                       MODULE IN BASIC SECTION WILL    33040002
*                                       NOT BE LOWEST ID.               33060002
*                                                                       33080002
* SCAN DCB'S TO FIND LOWEST NEXT MODULE ID.  COMPARE NEXT MODULE        33100002
* ID IN WTG ENTRY WITH THAT IN WTG BASIC SECTION.  IF ID IN ENTRY       33120002
* IS SMALLER, GO MOVE IT INTO BASIC SECTION.  WHEN FINISHED (LAST       33140002
* PARAMETER LIST ENTRY), GO EXIT VIA LOAD.                              33160002
*                                                                       33180002
RES02400 EQU   *                        TEST FOR AN ACTIVE DCB   YM3138 33240002
         CLC   WTGMODID,WTGIDTTR        IS THIS DCB ACTIVE       Y02080 33260002
         BL    RES02500                 YES, GO LOOP                    33300002
         CLI   WTGIDTTR,CHAR00          IS MOD ID BINARY ZEROS IN      X33320002
                                        ENTRY (IGNORED DCB)             33340002
         BE    RES02500                 YES, DO NOT MOVE MOD ID TO     X33360002
                                        BASIC SECTION OF WTG TABLE      33380002
*                                                                       33420002
* MOVE NEXT ID AND TTR FROM WTG TABLE ENTRY TO WTG TABLE BASIC SECTION. 33440002
*                                                                       33460002
         MVC   WTGMODID,WTGIDTTR        MOVE MODULE ID FROM WTG        X33480002
                                        ENTRY TO WTG BASIC SECTION      33500002
         MVC   WTGMODEP+K1(K3),WTGIDTTR+L'WTGMODID  MOVE MODULE  Y02080X33520002
                                        VCON FROM WTG ENTRY TO   Y02080X33540002
                                        WTG BASIC SECTION        Y02080 33560002
RES02500 EQU   *                        TEST FOR LAST PARM LIST ENTRY   33580002
         TM    PLISTOPT(RPARC),LASTNTRY  IS THIS LAST PARM LIST ENTRY   33600002
         BO    RES02600                 YES, GO EXIT VIA LOAD    Y02080X33640002
                                        NO, COMPARE MODULE ID'S         33660002
         BAL   RET,RES03200             GO INCREMENT TO NEXT DCB        33680002
         B     RES02400                 GO LOOP                         33700002
*                                                                       33720002
* FIND THE FIRST ACTIVE DCB AND EXIT VIA LOAD                    Y02080 33740002
*                                                                       33760002
RES02600 EQU   *                        GO INITIALIZE REGISTERS  YM3138 33780002
         BAL   RET,RES03100             INITIALIZE                      33800002
RES02700 EQU   *                        TEST FOR AN ACTIVE DCB   YM3138 33820002
         CLC   WTGMODID,WTGIDTTR        IS THIS DCB ACTIVE       Y02080 33840002
         BE    RES02750                 YES, GO LOAD             Y02080 33860002
         BAL   RET,RES03200             NO, GO INCREMENT TO NEXT DCB    33880002
         B     RES02700                 GO LOOP TO CHECK NEXT DCB       33900002
RES02750 EQU   *                        GET ACTIVE DCB'S ADDRESS Y02080 33920002
         L     RDCB,0(,RPARC)           GET DCB ADDRESS FROM PARAMETER X33940002
                                        LIST ENTRY                      33960002
         LM    RTIOT,RET,DXREG9         RESTORE REGISTERS 9 - 14 Y02080 33980002
         LM    R0,R1,DXREG0             RESTORE REGISTERS 0 & 1  Y02080 34000002
         L     RF,WTGPREFX              GET WHERE-TO-GO PREFIX   Y02080 34020002
         USING IECPREFX,RF              ADDRESS PREFIX WITH R15  Y02080 34040002
         STM   R0,RET,IECREGSV          SAVE REGISTERS           Y02080 34060002
         DROP  RF                                                Y02080 34080002
*                                                                Y02080 34100002
* FALL THROUGH INTO LOAD-AND-BRANCH ROUTINE                      Y02080 34120002
*                                                                Y02080 34130002
         EJECT                                                   Y02080 34140002
**************************************************************** Y02080 34160002
*                                                                Y02080 34180002
* ENTRY FOR LOAD,BRANCH=DIRECT                                   Y02080 34200002
*                                                                Y02080 34220002
**************************************************************** Y02080 34240002
*                                                                Y02080 34260002
RES02800 ST    RET,IECREGSV-IECPREFX+K4*RET(,RF)  SAVE REG 14    Y02134 34280002
         BAL   RET,RES02810             GO LOAD INDICATED MODULE Y02080 34300002
         USING IECPREFX,RA              RET POINTS TO PREFIX     Y02080 34340002
         L     RF,WTGMODEP              LOAD CSECT ENTRY POINT   Y02080 34360002
         XC    WTGMODEP,WTGMODEP        ZERO EPA FOR REUSE       Y02080 34380002
         LM    R0,RET,IECREGSV          RESTORE REGISTERS        Y02080 34400002
         BR    RF                       BRANCH TO LOADED MODULE  Y02080 34420002
         DROP  RA                                                Y02080 34440002
         EJECT                                                   Y02080 34460002
**************************************************************** Y02080 34480002
*                                                                Y02080 34500002
* ENTRY FOR LOAD,BRANCH=NO                                       Y02080 34520002
*                                                                Y02080 34540002
**************************************************************** Y02080 34560002
*                                                                Y02080 34580002
RES02810 EQU   *                        ENTRY FOR LOAD FUNCTION  Y02080 34600002
         LR    R4,RET                   SAVE RETURN POINT        Y02080 34620002
         LR    RA,RF                    SAVE POINTER TO PREFIX   Y02080 34640002
**************************************************************** Y02080 34660002
*                                                                Y02080 34680002
* THE FOLLOWING INSTRUCTION IS A MODIFIABLE NOP BRANCH TO A WTO  Y02080 34700002
* MODULE TRACE ROUTINE.                                          Y02080 34720002
*                                                                Y02080 34760002
* CHANGE THIS INSTRUCTION TO AN UNCONDITIONAL BRANCH X'47F0' TO  Y02080 34780002
* ENABLE THE MODULE TRACE.  THE ADDRESS OF THIS MODULE MAY BE    Y02080 34800002
* FOUND IN THE CVT WORD CVTDMSR AT CVT OFFSET X'110'.            Y02080 34820002
*                                                                Y02080 34840002
* FURTHER DESCRIPTION PRECEDES THE WTO MODULE TRACE ROUTINE.     Y02080 34860002
*                                                                Y02080 34880002
**************************************************************** Y02080 34900002
RESTRACE NOP   RES03300                 GO TO MODULE TRACE RTN   Y02134 34920002
RES02820 EQU   *                        RETURN FROM MOD TRACE    Y02080 34940002
         L     R0,WTGMODEP              GET EPA                  Y02080 34960002
         LTR   R0,R0                    TEST IF EPA IS KNOWN     Y02080 34980002
         BNZ   RES02960                 YES, BYPASS LOAD         Y02080 35000002
*                                                                       35020002
         MODESET EXTKEY=ZERO,SAVEKEY=(2)                         Y02080 35040002
RES02830 EQU   *                        OBTAIN LOCAL LOCK        Y02080 35060002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080*35080002
               RELATED=(LOAD,IFG019RA(RES02885,RES02860))        Y02080 35100002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 35120002
         BNZ   ERROR1                   BRANCH IF ERROR          Y02080 35140002
RES02840 EQU   *                        OBTAIN CMS LOCK          Y02080 35160002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02080*35180002
               RELATED=(LOAD,IFG019RA(RES02850,RES02870))        Y02080 35200002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 35220002
         BNZ   ERROR1                   BRANCH IF ERROR          Y02080 35240002
*                                                                Y02080 35260002
*  CALL IEAQCDSR - ACTIVE LPA SEARCH SERVICE ROUTINE             Y02080 35280002
*                                                                Y02080 35300002
*        ENTRY                                                   Y02080 35320002
*              R8 - ADDRESS OF QUEUE TO SCAN                     Y02080 35340002
*              R9 - ADDRESS OF ENTRY POINT NAME                  Y02080 35360002
*              R14 - RETURN ADDRESS                              Y02080 35380002
*                                                                Y02080 35400002
*        EXIT                                                    Y02080 35420002
*              R0-R1 - ENTRY POINT NAME                          Y02080 35440002
*              R11 - ADDRESS OF CDE OR ZERO                      Y02080 35460002
*              R15 - SCRATCHED                                   Y02080 35480002
*                                                                Y02080 35500002
*              RETURN R14 + 0 IF EP FOUND                        Y02080 35520002
*                     R14 + 4 IF EP NOT FOUND                    Y02080 35540002
*                                                                Y02080 35560002
         L     R3,CVTADDR               LOAD CVT ADDRESS         Y02080 35580002
         L     R8,CVTQLPAQ-CVT(,R3)     LPAQ - CDES              Y02080 35600002
         LR    R9,RWTG                  ADDRESS OF EP NAME       Y02080 35620002
         L     RF,CVTQCDSR-CVT(,R3)     ADDRESS OF IEAQCDSR RTN  Y02080 35640002
         BALR  RET,RF                   LPA CDE SEARCH           Y02080 35660002
         B     RES02870                 BR RET IF CDE FOUND      Y02080 35680002
*                                                                Y02080 35700002
*  CALL IEAVVMSR - LPA SEARCH (LPDES) SERVICE ROUTINE            Y02080 35720002
*                                                                Y02080 35740002
*        ENTRY                                                   Y02080 35760002
*              R0-R1 - ENTRY POINT NAME                          Y02080 35780002
*              R3 - CVT ADDRESS                                  Y02080 35800002
*              R14 - RETURN ADDRESS                              Y02080 35820002
*                                                                Y02080 35840002
*        EXIT                                                    Y02080 35860002
*              R0 - ADDRESS OF LPDE OR ZERO                      Y02080 35880002
*              R6-R9 - SCRATCHED                                 Y02080 35900002
*                                                                Y02080 35920002
*              RETURN R14 + 0 - LPDE FOUND                       Y02080 35940002
*                     R14 + 4 - LPDE NOT FOUND                   Y02080 35960002
*                                                                Y02080 35980002
RES02850 EQU   *                        RELEASE CMS LOCK         Y02080 36000002
         SETLOCK RELEASE,TYPE=CMS,                               Y02080*36020002
               RELATED=(LOAD,IFG019RA(RES02840))                 Y02080 36040002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 36060002
         BNZ   ERROR1                   BRANCH IF SETLOCK ERROR  Y02080 36080002
         LR    RC,RWTG                  SAVE REGISTER 6          Y02080 36100002
         L     RF,CVTLPDSR-CVT(,R3)     ADDRESS OF IEAVVMSR RTN  Y02080 36120002
         BALR  RET,RF                   PAGEABLE LPA SEARCH      Y02080 36140002
         B     RES02880                 LPDE FOUND               Y02080 36160002
*                                                                Y02080 36180002
*  AS A LAST RECOURSE TRY A LOAD                                 Y02080 36200002
*                                                                Y02080 36220002
RES02860 EQU   *                        RELEASE LOCAL LOCK       Y02080 36240002
         LR    RWTG,RC                  RESTORE REGISTER 6       Y02080 36260002
         SETLOCK RELEASE,TYPE=LOCAL,                             Y02080*36280002
               RELATED=(LOAD,IFG019RA(RES02830))                 Y02080 36300002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 36320002
         BNZ   ERROR1                   BRANCH IF SETLOCK ERROR  Y02134 36340002
         MODESET KEYADDR=(2),WORKREG=2  RESTORE KEY              Y02080 36360002
         L     R1,CVTPTR                LOAD CVT ADDRESS         YM1280 36380002
         L     R1,CVTSVDCB-CVT(,R1)     GET SYS1.SVCLIB DCB ADDR YM1451 36400002
         LOAD  EPLOC=WTGMODNM,DCB=(1)   ISSUE LOAD TO FIND IT    YM1280 36420002
         B     RES02950                 RETURN TO CALLING MODULE Y02080 36440002
*                                                                Y02080 36460002
*  CDE IN REGISTER 11                                            Y02080 36480002
*                                                                Y02080 36500002
RES02870 EQU   *                        CDE FOUND                Y02080 36520002
         L     R0,CDENTPT-CDENTRY(,RB)  MODULE ENTRY POINT       Y02080 36540002
         SETLOCK RELEASE,TYPE=CMS,                               Y02080*36560002
               RELATED=(LOAD,IFG019RA(RES02840))                 Y02080 36580002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02080 36600002
         BNZ   ERROR1                   BRANCH IF SETLOCK ERROR  Y02134 36620002
         B     RES02885                 CONTINUE                 Y02080 36640002
*                                                                Y02080 36660002
*  LPDE IN REGISTER 0                                            Y02080 36680002
*                                                                Y02080 36700002
RES02880 EQU   *                        LPDE FOUND               Y02080 36720002
         LR    RWTG,RC                  RESTORE WTG REGISTER     Y02134 36740002
         LR    R1,R0                    SAVE LPDE ADDRESS        Y02080 36760002
         L     R0,LPDENTP-LPDE(,R1)     EPA IN REGISTER 0        Y02080 36780002
RES02885 EQU   *                        RELEASE LOCAL LOCK       Y02080 36800002
         SETLOCK RELEASE,TYPE=LOCAL,                             Y02080*36820002
               RELATED=(LOAD,IFG019RA(RES02830))                 Y02080 36840002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 36860002
         BNZ   ERROR1                   BRANCH IF SETLOCK ERROR  Y02134 36880002
RES02950 EQU   *                        RESTORE KEY              Y02080 36900002
         MODESET KEYADDR=(2),WORKREG=2  RESTORE KEY              Y02080 36920002
RES02960 EQU   *                        STORE MODULE EPA         Y02080 36940002
         ST    R0,WTGMODEP              STORE MODULE EPA         Y02080 36960002
         LR    RET,R4                   RESTORE RETURN POINT     Y02080 36980002
         LR    RF,RA                    RESTORE POINTER TO PREFX Y02080 37000002
         CLC   WTGMODNM,STOPNAME        CHECK IF MOD TO STOP ON  Y02080 37020002
         BNE   RES02965                 NO, THEN SKIP NOP        Y02080 37040002
         CNOP  0,8                      ALIGN NOP'S ON DOUBLEWD  YM4623 37050002
RESTRAC1 LR    RF,RF                    TWO BYTES OF LOGICAL NOP YM1280 37060002
         LR    RF,RF                    TWO MORE BYTES OF NOP    YM4623 37065002
         LR    RF,RF                    TWO MORE BYTES OF NOP    YM1280 37070002
         LR    RF,RF                    LAST TWO BYTES OF NOP    YM4623 37075002
RES02965 EQU   *                        RETURN TO CALLING MODULE Y02080 37080002
         BR    RET                      RETURN TO CALLING MODULE Y02080 37100002
     TITLE 'IFG019RA--OPEN/CLOSE/EOV REGISTER INITIALIZATION'    Y02080 37120002
*********************************************************************** 37160002
*                                                                     * 37180002
* ROUTINE TO SAVE REGISTERS                                           * 37200002
*                                                                     * 37220002
*********************************************************************** 37240002
*                                                                       37260002
RES03000 EQU   *                        SAVE REGISTERS IN WORK AREA     37280002
         STM   RTIOT,RET,DXREG9         SAVE REGISTERS 9 THROUGH 14    X37300002
                                        IN THE WORK AREA.               37320002
         STM   R0,R1,DXREG0             SAVE REGISTERS 0 AND 1 IN THE  X37340002
                                        WORK AREA.                      37360002
         BR    R7                       RETURN                          37380002
*********************************************************************** 37400002
*                                                                     * 37420002
* ROUTINE TO INITIALIZE WTG TABLE ENTRY PTR, PARAMETER LIST ENTRY     * 37440002
* PTR, SERVICE ROUTINE WORK AREA ADDRESS, AND WORK AREA ADDRESS       * 37460002
*                                                                     * 37480002
*********************************************************************** 37500002
*                                                                       37520002
         DROP  RWTGC                                             YM1105 37540002
RES03100 EQU   *                        INITIALIZE REGISTERS     YM3138 37560002
         L     RTIOT,WTGPREFX           GET PTR TO PREFIX        Y02080 37580002
         USING IECPREFX,RTIOT                                    Y02080 37600002
         L     RPARC,IECUPRML           PARAMETER LIST ADDRESS   Y02080 37620002
         L     RTIOT,IECRESWA           GET PTR TO RES WORK AREA Y02080 37640002
         USING RWARESWA,RTIOT                                    Y02080 37660002
         LA    RTIOT,RWALIST            INITIALIZE ECB LIST PTR  Y02080 37680002
         DROP  RTIOT                                             Y02080 37700002
         LA    RWTGC,WTGENTRY           PTR TO FIRST WTG ENTRY          37720002
         USING WTGENTRY,RWTGC           WTG TABLE ENTRY ADDR            37740002
         L     RCORE,WTGCORE-K1         PTR TO WORK AREA FROM THIS     X37760002
                                        DCB'S WTG ENTRY                 37780002
         BR    RET                      RETURN                          37800002
*********************************************************************** 37820002
*                                                                     * 37840002
* ROUTINE TO INCREMENT TO THE NEXT DCB THE PARAMETER LIST ENTRY AND   * 37860002
* THE WTG TABLE ENTRY, AND GET THE WORK AREA ADDRESS OF THAT DCB.     * 37880002
*                                                                     * 37900002
*********************************************************************** 37920002
*                                                                       37940002
RES03200 EQU   *                        INCREMENT RPARC AND RWTGC       37960002
         LA    RPARC,K4(,RPARC)         INCREMENT TO NEXT PARAMETER    X37980002
                                        LIST ENTRY                      38000002
         LA    RWTGC,L'WTGENTRY(,RWTGC)  INCREMENT TO NEXT WTG TABLE   X38020002
                                        ENTRY                           38040002
         L     RCORE,WTGCORE-K1         PTR TO WORK AREA FROM THIS     X38060002
                                        DCB'S WTG ENTRY                 38080002
         BR    RET                      RETURN                          38100002
         TITLE 'IFG019RA--OPEN/CLOSE/EOV/DADSM SERVICE ROUTINE'  YM3138 38120002
*********************************************************************** 38140002
*                                                                     * 38160002
*        WTO MODULE TRACE ROUTINE                                     * 38180002
*                                                                     * 38200002
* THIS ROUTINE ISSUES A WRITE TO OPERATOR OF THE NAME OF THE          * 38220002
* MODULE THAT WILL BE LOADED NEXT.                               Y02080 38240002
*                                                                     * 38260002
* FOR ALL OPEN/CLOSE/EOV/DADSM MODULES ISSUING THE IECRES LOAD MACRO, * 38280002
* THE NAME OF THE MODULE BEING LOADED MAY BE TRACED.                  * 38300002
*                                                                     * 38320002
* THIS TRACE ROUTINE MAY BE ENABLED BY CHANGING THE NOP BRANCH        * 38340002
* INSTRUCTION AT LABEL RESTRACE TO AN UNCONDITIONAL BRANCH            * 38360002
* X'47F0'.  THE ADDRESS OF THIS MODULE MAY BE FOUND IN THE CVT        * 38380002
* WORD NAMED CVTDMSR AT CVT OFFSET X'110'.                            * 38400002
*                                                                     * 38420002
* THE EIGHT BYTE MESSAGE IS ROUTED TO THE CONSOLE OPERATOR.      Y02080 38440002
*                                                                     * 38460002
* NOTE THAT A SIMULTANEOUS TRACE OF MORE THAN ONE TASK WILL TEND Y02080 38480002
* TO GIVE A CONFUSING TRACE.  IT WOULD BE BETTER TO MAKE SURE    Y02080 38500002
* THAT ONLY ONE TASK IS RUNNING WHEN THE TRACE IS USED.          Y02080 38520002
*                                                                     * 38540002
* IF SMF IS ACTIVE, EOV MAY TRANSFER CONTROL TO SEVERAL CLOSE    Y02080 38560002
* MODULES IN ORDER TO PROCESS SMF RECORDS. THIS RESULTS IN CLOSE Y02080 38580002
* MODULE NAMES APPEARING BETWEEN EOV MODULE NAMES.               Y02080 38600002
*                                                                Y02080 38620002
* AT THE TIME THIS MODULE TRACE ROUTINE GAINS CONTROL, REGISTER  Y02080 38640002
* CONTENTS ARE AS FOLLOWS--                                      Y02080 38660002
*    REG  5 - BASE REGISTER FOR IFG019RA                         Y02080 38680002
*    REG  6 - WHERE-TO-GO TABLE ADDRESS (FIRST EIGHT BYTES       Y02080 38700002
*             CONTAIN THE MODULE NAME BEING LOADED).             Y02080 38720002
*                                                                Y02080 38740002
*********************************************************************** 38760002
*                                                                       38780002
RES03300 EQU   *                        ENTRY TO TRACE ROUTINE   S21940 38800002
         LA    R1,WTGMODNM              GET ADDR OF MODULE NAME  Y02080 38820002
         SH    R1,FOUR                  BACK UP FOUR BYTES       Y02080 38840002
         WTO   MF=(E,(1))               ISSUE MESSAGE            Y02080 38860002
         B     RES02820                 RETURN TO LOAD           Y02080 38880002
         EJECT                                                   YM1360 38900002
**************************************************************** Y02144 38920002
*                                                                Y02144 38940002
*        ROUTINE TO ESTABLISH THE RECOVERY ENVIRONMENT           Y02144 38960002
*                                                                Y02144 38980002
*        THE INPUT REGISTERS TO THIS ROUTINE ARE:                Y02144 39000002
*        R1 POINTS TO THE MAIN WORK AREA PREFIX.                 Y02144 39020002
*        RC CONTAINS THE RETURN ADDRESS.                         Y02144 39040002
*        RET POINTS TO THE NAME OF THE RECOVERY MODULE.          Y02144 39060002
*        RF POINTS TO THE CALLER'S REGISTER SAVE AREA.           Y02144 39080002
*                                                                Y02144 39100002
**************************************************************** Y02144 39120002
*                                                                Y02144 39140002
RES06000 EQU   *                        ESTABLISH RECOVERY ENV   Y02144 39320002
         USING IECPREFX,R1                                       Y02144 39340002
         L     RWTG,IECWTGTB            GET PTR TO WTG TABLE     Y02144 39360002
         LR    RD,RF                    SAVE CALLER'S REGISTER   Y02144 39380002
*                                       SAVE AREA POINTER        Y02144 39400002
         IECRES LOAD,PREFIX=(R1),MODNM=(RET),BRANCH=NO           Y02144*39420002
                                        GET RECOVERY RTN ADDR    Y02144 39440002
         LR    R4,R1                    SAVE PREFIX ADDRESS      Y02144 39460002
         L     RET,WTGMODEP             RECOVERY RTN ADDR IN RET Y02144 39480002
         L     R7,IECRRPRM              GET PTR TO RRPLIST       Y02144 39500002
         USING RRPLIST,R7                                        Y02144 39520002
         MVC   RRPLIST+K4(ESTAELN),RESESTAE  MOVE ESTAE LIST     Y02144 39540002
*                                       FORM TO DSECT CORE       Y02144 39560002
         CLC   WTGMODNM,RR0F            ENTRY FROM IFG0RR0A      Y02144 39580002
         BNE   RES06100                 BRANCH IF NOT            Y02144 39600002
         MVC   IECRRPRM,IECRRPRM-IECPREFX(RD)  RESET ADDRESS OF  Y02144 39620002
*                                       RECOVERY PARMLIST TO THE Y02144 39640002
*                                       RRPLIST PTR IN EXISTENCE Y02144 39660002
*                                       UPON ENTRY TO IFG0RR0A   Y02144 39680002
RES06100 EQU   *                        ISSUE ESTAE              Y02144 39700002
         XC    WTGMODNM(K12),WTGMODNM   CLEAR MODULE NAME + EPA  Y02144 39720002
         LA    R1,RRPLIST+K4            POINT TO ESTAE LIST      Y02144 39740002
*                                                                Y02144 39760002
         ESTAE (RET),CT,PARAM=(R4),XCTL=YES,PURGE=NONE,          Y02144*39780002
               ASYNCH=YES,TERM=YES,RECORD=NO,MF=(E,(1))          Y02144 39800002
*                                                                Y02144 39820002
         LR    R1,R4                    RESTORE PREFIX ADDRESS   Y02144 39840002
         XC    RRPLIST+K4(ESTAELN),RRPLIST+K4  CLEAR ESTAE LIST  Y02144 39860002
         LM    R0,RET,IECREGSV          RESTORE REGISTERS        Y02144 39880002
         LR    RF,RD                    RESTORE CALLER'S REG     Y02144 39900002
*                                       SAVE AREA POINTER        Y02144 39920002
         DROP  R1,R7                                             Y02144 39940002
         BR    RC                       RETURN                   Y02144 39960002
***                                                              Y02144 39980002
* LIST FORM OF ESTAE MACRO FOR ESTABLISHING RECOVERY ENVIRONMENT Y02144 40000002
***                                                              Y02144 40020002
RESESTAE ESTAE ,CT,PURGE=NONE,                                   Y02144X40040002
               ASYNCH=YES,TERM=YES,RECORD=NO,MF=L                Y02144 40060002
ESTAELN  EQU   *-RESESTAE               LENGTH OF ESTAE LIST     Y02144 40080002
         EJECT                                                   Y02144 40100002
*********************************************************************   40140002
* THIS SECTION ESTABLISHES THE BASE REGISTER FOR THE ROUTINES    YM1360 40160002
* IN THE SECOND PAGE OF IFG019RA.                                YM1360 40180002
*********************************************************************   40200002
*                                                                       40220002
RES07000 EQU   *                        DCB INIT/COPY ENTRY      YM3138 40240002
         L     RES,RESPAGE2             LOAD ADDRESS OF PAGE 2   YM1360 40260002
         B     K0(,RES)                 BRANCH TO INIT/COPY RTN  YM3138 40280002
*                                                                       40300002
         TITLE 'IFG019RA--OPEN/CLOSE/EOV USER EXIT FACILITY'     YM1360 40560002
*********************************************************************** 40580002
*                                                                       40590002
*        USER EXIT INTERFACE FOR OPEN/CLOSE/EOV                  Y02082 40600002
*                                                                       40620002
* REGISTERS -                                                           40630002
*                                                                       40640002
*        THE REGISTERS ON ENTRY ARE:                             Y02082 40650002
*        0 & 1 VALUES TO BE PASSED TO USER EXIT                  Y02082 40680002
*        1     VALUE TO BE PASSED TO USER EXIT                   Y02082 40700002
*        2     MAY BE ADDRESS OF REGISTER SAVE AREA OF CALLER    Y02082 40720002
*        4     ADDRESS OF OPEN/CLOSE/EOV WORK AREA               Y02082 40740002
*        5     BASE REGISTER                                     YM3138 40800002
*        14    RETURN ADDRESS OF CALLER                          Y02082 40820002
*        15    ADDRESS OF USER EXIT ROUTINE                      Y02082 40840002
*                                                                       40860002
*        ON EXIT REGISTER 15 CONTAINS THE RETURN CODE FROM THE   Y02082 40880002
*        USER EXIT ROUTINE.                                      Y02082 40900002
*                                                                       41100002
* FUNCTION -                                                     Y02082 41120002
*                                                                       41130002
*        IF THE PROTECT KEY INDICATED IN BITS 0-3 AT DXUKEY      Y02082 41140002
*        IN THE OPEN/CLOSE/EOV WORKAREA POINTED TO BY REG 4      Y02082 41160002
*        IS 7 OR LESS, THAT KEY WILL BE ASSUMED AND THE USER     Y02082 41180002
*        EXIT WILL BE BRANCHED TO. OTHERWISE, THE SYNCH SVC 12   Y02082 41200002
*        WILL BE USED TO PASS CONTROL TO THE USER EXIT.          Y02082 41220002
*                                                                       41240002
*        DXTCBADR IN THE OPEN/CLOSE/EOV WORKAREA WILL BE USED    Y02082 41260002
*        TO LOCATE THE CURRENT SVRB. IF DXUKEY IS 8 OR GREATER   Y02082 41280002
*        (USER IS NOT A SYSTEM ROUTINE) THE PREVIOUS RB IS       Y02082 41300002
*        INSPECTED TO SEE IF IT IS A PRB (BITS 0 AND 1 OF RBSATB Y02082 41320002
*        SET TO 0). IF SO, THE REGISTERS 2-13 PASSED TO THE USER Y02082 41340002
*        EXIT WILL BE LOADED FROM THE CURRENT SVRB'S REGISTER    Y02082 41360002
*        SAVE AREA. IF THE PREVIOUS RB IS NOT A PRB, THE RB      Y02082 41380002
*        CHAIN WILL BE SEARCHED FOR A PRB. WHEN THE PRB MOST     Y02082 41400002
*        RECENTLY IN CONTROL IS FOUND, THE REGISTERS 2-13 PASSED Y02082 41420002
*        TO THE USER EXIT ARE LOADED FROM THE SVRB WHICH THE     Y02082 41440002
*        PRB PASSED CONTROL TO. IF NO PRB IS FOUND, OR IF        Y02082 41460002
*        DXUKEY IS 7 OR LESS, THE REGISTERS ARE LOADED FROM THE  Y02082 41480002
*        CURRENT SVRB.                                           Y02082 41500002
*                                                                       41520002
*        REGISTERS 2-13 ARE SAVED ACROSS THE USER EXIT IN THE    Y02082 41540002
*        CURRENT SVRB'S EXTENDED SAVE AREA. HENCE, THE USER      Y02082 41560002
*        EXIT ROUTINE MUST NOT USE IT.                           Y02082 41580002
*                                                                       41600002
*        IMMEDIATELY BEFORE PASSING CONTROL TO THE USER EXIT,    Y02082 41620002
*        BIT RRFUSREX IS SET TO 1 IN RRFLAGS1 IN THE RECOVERY    Y02082 41680002
*        ROUTINE PARAMETER LIST.  UPON RETURN, IT IS RESET.      Y02082 41700002
*                                                                       41720002
*********************************************************************** 41800002
*                                                                       41810002
RES09000 EQU   *                        USER EXIT ROUTINE        Y02082 41820002
         LA    RF,K0(,RF)               USER EXIT ADDRESS        Y02082 41840002
         LR    R3,RET                   SAVE RETURN ADDRESS      Y02082 41860002
         L     R6,DXTCBADR              CURRENT TCB ADDRESS      Y02082 41880002
         USING TCB,R6                                            Y02082 41900002
         L     RB,TCBRBP                CURRENT SVRB ADDRESS     Y02082 41920002
         USING RBBASIC,RB                                        Y02082 41940002
         L     RD,DXATCOM3              RECOVERY ROUTINE AREA    Y02082 41960002
         USING RRPLIST,RD                                        Y02082 41980002
         MODESET EXTKEY=SUPR            SVRB KEY                 Y02082 42000002
         STM   R2,RD,RBEXSAVE           SAVE ACROSS EXIT         Y02082 42020002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 42040002
         CLI   DXUKEY,USERKEY           IS USER IN SYSTEM KEY    Y02082 42060002
         BNL   RES09100                 BRANCH IF NO TO SYNCH    Y02082 42080002
         OI    RRFLAGS1,RRFUSREX        USER EXIT BIT FOR FRR    Y02082 42100002
         MODESET KEYADDR=DXUKEY,WORKREG=14  ASSUME USER KEY      Y02082 42120002
         LM    R2,RD,RBGRS2             LOAD USER REGS           Y02082 42140002
         BALR  RET,RF                   TAKE EXIT                Y02082 42160002
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       Y02082 42180002
         BALR  RET,K0                   ESTABLISH BASE           Y02082 42200002
         USING *,RET                    BASE FOR ONE INSTRUCTION Y02082 42220002
         B     RES09300                 BRANCH TO RESTORE REGS   Y02082 42240002
         DROP  RET                                               Y02082 42260002
RES09100 EQU   *                        TEST FOR A PRB           Y02082 42280002
         L     RC,RBLINK                PREVIOUS RB              Y02082 42300002
         TM    RBSTAB-RBBASIC(RC),RBSTPRB  IS PREVIOUS A PRB     Y02082 42320002
         BZ    RES09200                 BRANCH IF YES            Y02082 42340002
         LR    RB,RC                    PREVIOUS RB IS CURRENT   Y02082 42360002
         CLM   R6,B'0111',RBLINK+K1     IS PREVIOUS RB LAST      Y02082 42380002
         BNE   RES09100                 BR IF NO TO TEST FOR PRB Y02082 42400002
         L     RB,TCBRBP                ASSUME USER REGS IN      Y02082 42420002
*                                       CURRENT SVRB             Y02082 42440002
RES09200 EQU   *                        ISSUE SYNCH              Y02082 42460002
         OI    RRFLAGS1,RRFUSREX        USER EXIT BIT FOR FRR    Y02082 42480002
         LM    R2,RD,RBGRS2             LOAD USER REGS           Y02082 42500002
         SYNCH (15)                     TAKE USER EXIT           Y02082 42520002
*                                                                       42540002
RES09300 EQU   *                        RETURN FROM SYNCH        Y02082 42560002
         L     R2,CVTPTR                LOAD CVT ADDRESS         Y02082 42580002
         L     R6,CVTTCBP-CVT(,R2)      TCB/ASCB POINTERS        Y02082 42600002
         L     R6,K4(,R6)               CURRENT TCB              Y02082 42620002
         L     RB,TCBRBP                CURRENT SVRB             Y02082 42640002
         LM    R2,RD,RBEXSAVE           RESTORE OUR REGS         Y02082 42660002
         NI    RRFLAGS1,X'FF'-RRFUSREX  TURN OFF USER EXIT BIT   Y02082 42680002
         LR    RET,R3                   RETURN ADDRESS           Y02082 42700002
         BR    RET                      RETURN TO CALLER         Y02082 42720002
         DROP  R6,RB,RD                 DROP REGISTER USAGE      YM3198 42730002
         TITLE 'IFG019RA--OPEN/CLOSE/EOV QMNGRIO FACILITY'       YM1360 42740002
**************************************************************** Y02134 42760002
*                                                                Y02134 42780002
*        QMNGRIO READ/WRITE JFCB ROUTINE                         Y02134 42800002
*                                                                Y02134 42820002
*        ON ENTRY                                                Y02134 42840002
*        REGISTERS 0-14 SAVED IN IECREGSV                        Y02134 42860002
*        R0 = 0 IF READ REQUESTED                                Y02134 42880002
*        R0 = JFCB ADDRESS IF WRITE REQUESTED                    Y02134 42900002
*        R1 = POINTER TO JFCB TTR (JFCB PREFIX ADDRESS)          Y02134 42920002
*        RES = BASE ADDRESS                                      YM3138 42940002
*        RET = POINTER TO RETURN ADDRESS                         Y02134 42960002
*        RF = POINTER TO IECPREFX                                Y02134 42980002
*                                                                Y02134 43000002
*        INITIAL ENTRY VIA BAL RET,12(,RES)                      YM1360 43020002
*                                                                Y02134 43040002
*****************************************************************Y02134 43060002
*                                                                Y02134 43080002
RES10000 EQU   *                        ENTRY FOR QMNGRIO        YM1360 43100002
         LR    R8,RET                   SAVE RETURN POINTER      Y02134 43120002
         LR    R9,RF                    SAVE POINTER TO SAVEAREA Y02134 43140002
         LR    RA,RES                   SAVE BASE ADDRESS        YM1360 43160002
*                                                                Y02134 43180002
         USING IECPREFX,R9              R9 POINTS TO PREFIX      Y02134 43200002
*                                                                Y02134 43220002
         ICM   R1,B'1110',TIOEJFCB-TIOEJFCB(R1) GET JFCB PTR     Y02134 43240002
         STM   R0,R1,IECREGSV+K64       SAVE PARAMETERS          Y02134 43260002
*                                                                Y02134 43280002
         L     R1,IECQMNGR              POINTER TO QMNGRIO LIST  Y02134 43300002
         LTR   R1,R1                    TEST IF AREA OBTAINED    Y02134 43320002
         BNZ   RES10010                 BRANCH IF AREA OBTAINED  YM1360 43340002
         LA    R1,IECSTART              POINT TO AREA            Y02134 43360002
*                                                                Y02134 43380002
         IECRES GET,LV=QMIEND-QMIOP+JESWORK+JFCBLGTH+K72,        Y02134X43400002
               ID=QMGR,PREFIX=YES,A=(R1)                         Y02134 43420002
         LR    RES,RA                   RESTORE BASE ADDRESS     YM1360 43440002
*                                                                Y02134 43460002
         USING QMIOP,R1                                          Y02134 43480002
         L     RD,CVTPTR                LOAD CVT POINTER         Y02134 43500002
         L     RD,CVTTCBP-CVT(,RD)      GET ADDRESS OF TCB QUE   Y02134 43520002
         L     RD,K4(,RD)               GET CURRENT TCB          Y02134 43540002
         ST    RD,QMITCBAD              PUT TCB ADDR IN LIST     Y02134 43560002
         LA    RD,QMIEND                JES WORK AREA            Y02134 43580002
         ST    RD,QMIWRKAD              PUT WA ADDR IN LIST      Y02134 43600002
         MVI   QMIRECL+K1,JFCBLGTH      READ/WRITE 176 BYTES     Y02134 43620002
         ST    R1,IECQMNGR              SAVE POINTER TO LIST     Y02134 43640002
*                                                                Y02134 43660002
RES10010 EQU   *                        SET UP TO WRITE OR READ  YM1360 43680002
         LA    RD,QMIEND+JESWORK+JFCBLGTH GET QMNGR SAVEAREA PTR Y02134 43700002
*                                                                Y02134 43720002
*        SET UP FOR WRITE                                        Y02134 43740002
*                                                                Y02134 43760002
         MVI   QMIFLAGS,QMIOWRTE        SET TO WRITE             Y02134 43780002
         MVC   QMIRECAD,IECREGSV+K64    MOVE IN PARM REG 0       Y02134 43800002
         MVC   QMIDSKAD(K3),IECREGSV+K68 MOVE IN PARM REG 1      Y02134 43820002
*                                                                Y02134 43840002
         NC    QMIRECAD,QMIRECAD        JFCB POINTER = ZERO      Y02134 43860002
         BNZ   RES10020                 BRANCH IF WRITE REQUESTD YM1360 43880002
*                                                                Y02134 43900002
*        SET UP FOR READ                                         Y02134 43920002
*                                                                Y02134 43940002
         MVI   QMIFLAGS,QMIOREAD        SET TO READ              Y02134 43960002
         LA    R0,QMIEND+JESWORK        JFCB READ AREA POINTER   Y02134 43980002
         ST    R0,QMIRECAD              SAVE JFCB BUFFER PTR     Y02134 44000002
         ST    R0,IECREGSV+K68          SAVE PARM REG 1          Y02134 44020002
*                                                                Y02134 44040002
RES10020 EQU   *                        ISSUE QMNGRIO MACRO      YM1360 44060002
         MODESET EXTKEY=ZERO            QMNGRIO KEY              Y02134 44080002
         QMNGRIO                                                        44100002
         MODESET EXTKEY=DATAMGT         RESET KEY                Y02134 44120002
*                                                                Y02134 44140002
         LM    R0,R1,IECREGSV+K64       RESTORE PARAMETERS       Y02134 44160002
         LR    RET,R8                   RESTORE RETURN ADDRESS   Y02134 44180002
         LR    RF,R9                    RESTORE IECPREFX POINTER Y02134 44200002
         RETURN ,                                                Y02134 44220002
         DROP  R1,R9                                             Y02134 44240002
         TITLE 'IFG019RA--OPEN/CLOSE/EOV/DADSM SERVICE ROUTINE'  YM1360 44260002
*********************************************************************** 44280002
*                                                                     * 44290002
*        CONSTANTS                                                    * 44300002
*                                                                     * 44310002
*********************************************************************** 44320002
*                                                                       44330002
RESPAGE2 DC    A(RES11000)              BASE ADDRESS OF PAGE 2   YM3138 44340002
ERROR1   DMABCOND PCK,SETLOCK           ERROR ON SETLOCK         Y02080 44360002
ERROR2   DMABCOND PCK,ENQ               ERROR ON ENQ             Y02080 44380002
OCED     DC    CL4'OCED'                DUMMY CORE ID            Y02134 44400002
STOPNAME DC    CL8' '                   NAME TO STOP ON          Y02080 44420002
MSGPREFX DC    XL4'000C0000'            WTO PREFIX LENGTH        Y02080 44440002
FID      DC    X'00FF'                  FORMAT ID FOR GTF        Y02080 44460002
FOUR     DC    H'4'                     CONSTANT 4               Y02080 44480002
ENQMACRO ENQ   (SYSZTIOT,,S,6,SYSTEM),RET=HAVE,MF=L ENQ PARMLIST Y02082 44500002
ENQLTH   EQU   *-ENQMACRO               LENGTH OF PARM LIST      Y02082 44520002
DEQMACRO DEQ   (SYSZTIOT,,6,SYSTEM),RET=HAVE,MF=L DEQ PARMLIST   Y02082 44540002
DEQLTH   EQU   *-DEQMACRO               LENGTH OF PARM LIST      Y02134 44560002
SYSZTIOT DC    CL8'SYSZTIOT'            TIOT ENQ MAJOR NAME      YM1399 44580002
         EJECT                                                   YM3937 44590002
*********************************************************************** 44600002
*        TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                44620002
*********************************************************************** 44640002
*                                                                       44650002
         XCTLTABL ID=(RR0A,IFG0RR0A,RR0F,IFG0RR0F,               YM1360X44660002
               TC0A,IFG0TC0A,TC4A,IFG0TC4A,TRAC,IFG019TR),       YM1360X44680002
               BRT=SHORT,LENGTH=4K                               YM1360 44700002
         EJECT                                                   YM1360 44720002
*********************************************************************** 44740002
*        BRANCH TABLE FOR THE SECOND PAGE OF IFG019RA                   44760002
*********************************************************************** 44780002
*                                                                       44790002
         USING *,RES                    ESTABLISH ADDRESSABILITY YM1360 44800002
RES11000 EQU   *                        2ND PAGE OF IFG019RA     YM3138 44820002
RES11010 B     RES14000                 BRANCH TO INIT/COPY RTN  YM3138 44840002
          TITLE  'IFG019RA--OPEN/CLOSE/EOV INITIALIZATION AND DCB COPY X44880002
               FACILITIES'                                       Y02080 44930002
*********************************************************************** 45020002
*                                                                     * 45040002
*        FUNCTION PROLOGUE                                            * 45060002
*                                                                     * 45080002
*********************************************************************** 45100002
*                                                                     * 45120002
* FUNCTION NAME -                                                     * 45140002
*                                                                     * 45150002
*        INITIALIZATION AND DCB COPY FACILITIES FOR OPEN/CLOSE/EOV    * 45160002
*                                                                     * 45180002
* FUNCTION -                                                          * 45200002
*                                                                     * 45210002
*        THIS ROUTINE PERFORMS TWO BASIC FUNCTIONS:                   * 45220002
*        1 CERTAIN POINTERS IN THE OPEN/CLOSE/EOV WORKAREA ARE        * 45240002
*          INITIALIZED;                                               * 45260002
*        2 THE DCB COPY FUNCTION IS PERFORMED.                        * 45280002
*                                                                     * 45300002
*        THE FIELDS WHICH ARE INITIALIZED ARE                         * 45320002
*              DXUKEY   KEY OF CALLER OBTAINED FROM RESUME PSW IN     * 45340002
*                       SVRB                                          * 45360002
*              DXASCBAD ADDRESS OF ASCB                               * 45380002
*              DXTCBADR ADDRESS OF TCB                                * 45400002
*              DXJSCBAD ADDRESS OF ACTIVE JSCB POINTED TO BY JSCBACT  * 45420002
*                       IN THE JSCB POINTED TO BY THE TCB             * 45440002
*              DXDSABQD ADDRESS OF DSAB QUEUE DESCRIPTOR BLOCK FROM   * 45460002
*                       THE ACTIVE JSCB                               * 45480002
*              DXDSABAD ADDRESS OF DSAB FOR THE DCB/ACB BEING         * 45500002
*                       PROCESSED - OBTAINED FROM THE DEB EXTENSION   * 45520002
*                       OR BY SEARCHING THE DSAB CHAIN USING THE      * 45540002
*                       DCBDDNAM                                      * 45560002
*              DXDSAB   ADDRESS OF CURRENT DSAB. SAME AS DXDSABAD     * 45580002
*              DXDEBXAD ADDRESS OF DEB EXTENSION IF THE DCB IS OPEN   * 45600002
*              DXTIOTAD ADDRESS OF TIOT ENTRY FOR DCB BEING PROCESSED * 45620002
*                       OBTAINED FROM THE DSAB OBTAINED AS            * 45640002
*                       STATED ABOVE                                  * 45660002
*              DXUCBADR ADDRESS OF UCB - FIRST UCB ADDRESS IN THE     * 45680002
*                       TIOT ENTRY OBTAINED AS STATED ABOVE IF THE    * 45700002
*                       DCB IS CLOSED; FIRST UCB ADDRESS IN THE DEB   * 45720002
*                       IF THE DCB IS OPEN AND THE DSORG IS NOT IS;   * 45740002
*                       SECOND UCB ADDRESS IN THE DEB IF THE DCB IS   * 45760002
*                       OPEN AND THE DSORG IS IS.                     * 45780002
*                                                                     * 45800002
* ENTRY POINT -                                                       * 45820002
*                                                                     * 45830002
*        ENTRY TO THIS ROUTINE IS MADE BY A DIRECT BRANCH FROM ANY    * 45840002
*        MODULE IN OPEN/CLOSE/EOV.                                    * 45860002
*        IFG019RA+44 - ENTRY FOR INIT FUNCTION.                       * 45880002
*                                                                     * 45900002
* INPUT -                                                             * 45920002
*                                                                     * 45930002
*        REGISTERS -                                                  * 45940002
*              0 - INDICATION OF WHETHER DCB IS OPEN OR CLOSED AND,   * 45960002
*                  HENCE, WHETHER A DEB ADDRESS IS IN DCBDEBAD        * 45980002
*                  FOR THE PURPOSE OF FINDING SEVERAL OF THE POINTERS * 46000002
*                  NEEDED FOR THE INITIALIZATION FUNCTION:            * 46020002
*                  0 - NO WORKAREA INITIALIZATION IS REQUESTED        * 46040002
*                  4 - DCB IS OPEN                                    * 46060002
*                  8 - DCB IS CLOSED                                  * 46080002
*              1 - INDICATION OF DCB COPY FUNCTION REQUESTED          * 46100002
*                  0 - NO DCB COPY REQUESTED                          * 46120002
*                  4 - THE DCB POINTED TO BY DXUDCBAD IN THE OPEN/    * 46140002
*                      CLOSE/EOV WORKAREA (WHICH IS IN PROTECT KEY    * 46160002
*                      INDICATED BY DXUKEY IN THE WORKAREA) IS TO BE  * 46180002
*                      COPIED INTO THE PROTECTED WORKAREA POINTED TO  * 46200002
*                      REGISTER 2                                     * 46220002
*                  8 - THE PROTECTED WORKAREA COPY OF THE DCB POINTED * 46240002
*                      TO BY REGISTER 2 IS TO BE COPIED ON TOP OF THE * 46260002
*                      DCB POINTED TO BY WORKAREA LABEL, DXUDCBAD     * 46280002
*              2 - ADDRESS OF PROTECTED COPY OF DCB BEING PROCESSED   * 46300002
*              4 - ADDRESS OF OPEN/CLOSE/EOV WORKAREA                 * 46320002
*              5 - ADDRESS OF IFG019RA                                * 46340002
*              6 - ADDRESS OF PREFIX OF MAIN WORK AREA                * 46360002
*              14 - RETURN ADDRESS TO THE CALLING MODULE              * 46380002
*              15 - POINTER TO A REGISTER SAVE AREA                   * 46400002
*        KEY - DATA MANAGEMENT KEY                                    * 46420002
*                                                                     * 46440002
* OUTPUT -                                                            * 46460002
*                                                                     * 46470002
*        REGISTERS -                                                  * 46480002
*              2 - ADDRESS OF THE PROTECTED (COPIED) DCB              * 46500002
*              5 - ADDRESS OF IFG019RA                                * 46520002
*              14 - RETURN ADDRESS OF THE CALLING MODULE              * 46540002
*              15 - POINTER TO THE REGISTER SAVE AREA                 * 46560002
*        DATA -                                                       * 46580002
*              THE INITIALIZED WORKAREA POINTERS AND/OR THE REFRESHED * 46600002
*              DCB.  IF THE FUNCTION REQUESTED WAS NOT COMPLETED      * 46620002
*              SATISFACTORILY, ONE OF THE BITS IN DXWCOPYE WILL       * 46640002
*              BE SET TO ONE.  OTHERWISE, THIS BYTE WILL BE ZERO.     * 46660002
*                                                                     * 46680002
*                                                                     * 46700002
*********************************************************************** 46720002
         EJECT                                                   Y02134 46740002
*                                                                       46760002
*        THIS ROUTINE IS CONTROLLED BY ONE OF NINE BXLE MASKS    Y02134 46780002
*        LOADED DEPENDING UPON THE INPUT OF REGISTERS ZERO AND   Y02134 46800002
*        ONE. THE MASK IS KEPT IN R7 AND IS USED IN              Y02134 46820002
*        THE INSTRUCTIONS:                                       Y02134 46840002
*              BXLE R7,R7,LABEL                                  Y02134 46860002
*        THE BRANCH IS TAKEN IF THE HIGH ORDER BIT OF R7 IS ONE. Y02134 46880002
*                                                                       46900002
RES14000 EQU   *                        ENTRY FOR INIT/COPY      YM3066 46920002
         XC    DXWCOPYE,DXWCOPYE        CLEAR COPY ERROR         Y02134 46940002
         USING IHADCB,RDCB                                       Y02134 46960002
         LR    R3,R0                    SAVE DCBCOPY PARM        Y02134 46980002
         L     R7,MASKTBLE(R1)          LOAD ADDRESS OF ONE OF   Y02134 47000002
*                                       THREE LISTS OF MASKS     Y02134 47020002
         L     R7,K0(R7,R3)             GET PROPER MASK IN LIST  Y02134 47040002
* BXLE1  BRANCH IF NO INITIALIZATION                             Y02134 47060002
         BXLE  R7,R7,RES14300           BRANCH TO BXLE2          Y02134 47080002
         L     R3,CVTPTR                LOAD CVT ADDRESS         Y02134 47100002
         USING CVT,R3                                            Y02134 47120002
         L     R3,CVTTCBP               ADDR OF TCB/ASCB PTRS    Y02134 47140002
         L     R3,K4(,R3)               ADDRESS OF TCB           Y02134 47160002
         USING TCB,R3                                            Y02134 47180002
         L     R3,TCBRBP                ADDR OF CURRENT SVRB     Y02134 47200002
         USING RBBASIC,R3                                        Y02134 47220002
         L     R3,RBLINK                GET CALLER'S RB          Y02134 47240002
         MVC   DXUKEY,RBOPSW+K1         MOVE KEY, AMWP TO WORKAR Y02134 47260002
         NI    DXUKEY,KEYMASK           ZERO AMWP FIELD          Y02134 47280002
         ST    RDCB,DXUDCBAD            SET USER'S DCB ADDR      Y02134 47300002
         ST    RDCB,DXPDCBAD            SET PROTECTED DCB = USER Y02134 47320002
*                                                                Y02134 47340002
*        DCB COPY LOGIC INITIALIZATION                           Y02134 47360002
*                                                                Y02134 47380002
         LA    R2,DCBDDNAM              PT TO USER'S FOUNDATION  Y02134 47400002
         LA    R1,DXWFOUN               PT TO WORK AREA SAVE     Y02134 47420002
         LA    R3,L'DXWFOUN             LENGTH OF THE FOUNDATION Y02134 47440002
         BAL   RD,RES14850              COPY USER FOUNDATION     Y02134 47460002
         L     RDCB,DXUDCBAD            GET USER DCB ADDR        Y02134 47480002
         MVC   DXWMCR,DXWMACRF          GET MACREF OPENED DCB    Y02134 47500002
         TM    DXWOFLGS,DCBOFOPN+DCBOFEOV  CHECK IF DCB IS OPEN  Y02134 47520002
         BM    RES14010                 BRANCH IF DCB IS OPEN    Y02134 47540002
         MVC   DXWMCR,DXWMACR           GET MACREF UN-OPENED DCB Y02134 47560002
RES14010 EQU   *                        CHECK IF EXCP            Y02134 47580002
         XC    DXWDSORG,DXWDSORG        CLEAR SAVED DSORG        Y02134 47600002
         TM    DXWMCR,DCBMEXCP          CHECK IF EXCP            Y02134 47620002
         BNO   RES14020                 BRANCH IF NOT EXCP       Y02134 47640002
         TM    DXWMCR,DCBMFOUN          CHK FOUNDATION EXIST     Y02134 47660002
         BNO   RES14030                 NO FOUNDATION, NO DSORG  Y02134 47680002
RES14020 EQU   *                        PREPARE TO COPY          Y02134 47700002
         LA    R2,DCBDSORG              POINT TO USER'S DSORG    Y02134 47720002
         LA    R1,DXWDSORG              POINT TO PROTECTED DSORG Y02134 47740002
         LA    R3,L'DXWDSORG            LENGTH OF DSORG          Y02134 47760002
         BAL   RD,RES14850              COPY DCB TEMPORARILY     Y02134 47780002
*                                                                       47800002
*        THE FOLLOWING FIELDS WILL BE INITIALIZED                Y02134 47820002
*              DXASCBAD  ASCB ADDRESS                            Y02134 47840002
*              DXTCBADR  TCB ADDRESS                             Y02134 47860002
*              DXJSCBAD  ACTIVE JSCB ADDRESS                     Y02134 47880002
*              DXDSABQD  DSAB QUEUE DESCRIPTOR BLOCK ADDRESS     Y02134 47900002
*              DXTIOTAD  TIOT ADDRESS                            Y02134 47920002
*                                                                       47940002
RES14030 EQU   *                        INITIALIZE WKAREA FIELDS Y02134 47960002
         L     R3,CVTPTR                LOAD CVT ADDRESS         Y02134 47980002
         USING CVT,R3                                            Y02134 48000002
         L     R3,CVTTCBP               ADDR OF TCB/ASCB POINTRS Y02134 48020002
         MVC   DXASCBAD,K12(R3)         MOVE ASCB ADDRESS        Y02134 48040002
         L     R3,K4(,R3)               LOAD TCB ADDRESS         Y02134 48060002
         ST    R3,DXTCBADR              STORE TCB ADDR IN WORKAR Y02134 48080002
         USING TCB,R3                                            Y02134 48100002
         MVC   DXTIOTAD,TCBTIO          SAVE TIOT ADDRESS        Y02134 48120002
         L     R3,TCBJSCB               JSCB ADDRESS             Y02134 48140002
         USING IEZJSCB,R3                                        Y02134 48160002
         L     R3,JSCBACT               ACTIVE JSCB ADDR         Y02134 48180002
         ST    R3,DXJSCBAD              STORE ACTIVE JSCB ADDR   Y02134 48200002
         L     R3,JSCDSABQ              DSAB QDB ADDR            Y02134 48220002
         ST    R3,DXDSABQD              STORE QDB ADDR IN WORKAR Y02134 48240002
* BXLE11 BRANCH IF DEB=YES - FALL THROUGH IF DEB=NO              Y02134 48260002
         BXLE  R7,R7,RES14200           BRANCH TO DEB=YES        Y02134 48280002
         DROP  R3                       DROP REGISTER USAGE      YM3198 48290002
         EJECT                                                   Y02134 48300002
*                                                                       48320002
*        AT THIS POINT IN THE INITIALIZATION ROUTINE:            Y02134 48340002
*        R3  POINTS TO THE DSAB QDB.                             Y02134 48360002
*        R4  POINTS TO THE OPEN/CLOSE/EOV WORKAREA.              Y02134 48380002
*        R5  IS THE BASE REGISTER.                               Y02134 48400002
*        R6  POINTS TO THE PREFIX OF THE MAIN WORK AREA.         Y02134 48420002
*        R7  CONTAINS THE BXLE MASK.                             Y02134 48440002
*        R8  MUST BE PRESERVED FOR THE CALLER.                   Y02134 48460002
*        R9  MUST BE PRESERVED FOR THE CALLER.                   Y02134 48480002
*        R14 CONTAINS THE RETURN ADDRESS.                        Y02134 48500002
*        R15 MUST BE PRESERVED FOR THE CALLER.                   Y02134 48520002
*                                                                Y02134 48540002
*        THIS ROUTINE FILLS IN THE FIELDS                        Y02134 48560002
*              DXDSABAD                                          Y02134 48580002
*              DXDSAB                                            Y02134 48600002
*              DXTIOTAD                                          Y02134 48620002
*              DXUCBADR                                          Y02134 48640002
*        IN THE CASE THAT THE DCB IS NOT OPEN.                   Y02134 48660002
*                                                                       48680002
*                                                                       48700002
* TEST FOR CONCATENATION BIT.  IF ON, USE DCBTIOT.                      48720002
*                                                                       48740002
         TM    DXWOFLGS,DCBOFEOV        IS CONCATENATION BIT ON? Y02134 48760002
         BO    RES14100                 BRANCH IF YES            YM3138 48780002
         CLI   DXWDDNAM,C' '            IS DDNAME BLANK?         Y02134 48800002
         BE    RES14710                 BRANCH IF YES TO ERROR   Y02134X48820002
                                        EXIT                     Y02134 48840002
         TM    DXWMCR1,DCBMEXCP         IS IT EXCP?              Y02134 48860002
         BO    RES14110                 BRANCH IF YES            Y02134 48880002
         TM    DXWDSRG2,DCBACBM         IS CONTROL BLOCK ACB     Y02134 48900002
         BZ    RES14110                 BRANCH IF NO             Y02134 48920002
         CLC   DXWDDNAM,VTAMDDN         DOES DDNAME INDICATE     Y02134X48940002
                                        VTAM?                    Y02134 48960002
         BE    RES14170                 BRANCH IF YES TO EXIT  @ZA00114 48980002
RES14110 EQU   *                        TEST FOR A DSAB QDB ADDR Y02134 49000002
         LTR   R3,R3                    TEST FOR A DSAB QDB ADDR YM6708 49010002
         BZ    RES14160                 BRANCH IF NO TO ERROR    YM6708 49012002
         USING QDB,R3                   R3 POINTS TO DSAB QDB    YM1240 49020002
         L     RB,QDBFELMP              GET FIRST DSAB ADDRESS   Y02134 49040002
RES14120 EQU   *                        GET TIOT ENTRY ADDRESS   Y02134 49060002
         LTR   RB,RB                    ANY MORE DSABS?          Y02134 49080002
         BZ    RES14160                 BRANCH IF NO TO ERROR    Y02134X49100002
                                        EXIT                     Y02134 49120002
         USING DSAB,RB                                           Y02134 49140002
         L     RC,DSABTIOT              GET TIOT ENTRY FOR DSAB  Y02134 49160002
         USING TIOENTRY,RC                                       Y02134 49180002
         CLC   DXWDDNAM,TIOEDDNM        IS DCB FOR THIS TIOT     Y02134X49200002
                                        ENTRY?                   Y02134 49220002
         BE    RES14140                 BRANCH IF YES            Y02134 49240002
         L     RB,DSABFCHN              GET NEXT DSAB ADDRESS    Y02134 49260002
         B     RES14120                 TRY NEXT DSAB            Y02134 49280002
*                                                                       49300002
*        DCBTIOT OFFSET INTO TIOT WILL BE USED TO OBTAIN THE     Y02134 49320002
*        DSAB ADDRESS AND TIOT ENTRY ADDRESS.                    Y02134 49340002
*                                                                       49360002
RES14100 EQU   *                        TEST IF VTAM             Y02134 49380002
         BAL   RD,RES14250              OBTAIN TIOT ENTRY AS IF  Y02134X49400002
                                        DCB WERE OPEN            Y02134 49420002
*                                                                       49440002
*        RB NOW CONTAINS DSAB ADDRESS.                           Y02134 49460002
*        RC NOW CONTAINS TIOT ENTRY ADDRESS.                     Y02134 49480002
*        RB AND RC ARE ZERO IF NO DSAB WAS FOUND.                Y02134 49500002
*                                                                       49520002
         LTR   RB,RB                    WAS DSAB/TIOT OBTAINED?  Y02134 49540002
         BZ    RES14710                 BRANCH IF NO - ERROR     Y02134 49560002
RES14140 EQU   *                        STORE DSAB ADDRESS       Y02134 49580002
         ST    RB,DXDSABAD              STORE DSAB ADDRESS       Y02134 49600002
         ST    RB,DXDSAB                STORE CURRENT DSAB ADDR  Y02134 49620002
RES14150 EQU   *                        STORE TIOT AND UCB ADDRESSES    49640002
         ST    RC,DXTIOTAD              STORE TIOT ENTRY ADDRESS Y02134 49660002
         TM    TIOELINK,TIOESYOT+TIOESYIN  IS DATA SET SPOOLED?  Y02134 49680002
         BNZ   RES14240                 BR IF YES - NO UCB ADDR  Y02134 49700002
         MVC   DXUCBADR+K1(K3),TIOEFSRT  PUT UCB ADDR IN WKAREA  Y02134 49720002
         B     RES14240                 BRANCH TO EXIT           Y02134 49740002
RES14160 EQU   *                        ERROR EXIT TEST          Y02080 49760002
         TM    DXWMCR1,DCBMEXCP         IS IT EXCP?              Y02134 49780002
         BO    RES14700                 BRANCH IF YES            Y02134 49800002
         TM    DXWDSRG2,DCBACBM         IS CONTROL BLOCK ACB     Y02134 49820002
         BZ    RES14700                 BRANCH IF NO             Y02134 49840002
         TM    DXWFOUN+ACBINFLG-ACBDDNM,ACBCAT+ACBSCRA CHECK    Z30SSRL 49860037
*                                       FOR VSAM CATALOG/SCRA   Z30SSRL 49880037
         BZ    RES14700                 BR IF NOT TO ERROR EXIT Z30SSRL 49900037
RES14170 EQU   *                        VTAM ACB ENTRY         @ZA00114 49910002
         XC    DXTIOTAD,DXTIOTAD        IF YES, THEN NO TIOT OR  YM3937X49920002
                                        DSAB ADDRESS IS REQUIRED YM3937 49940002
         XC    DXDSAB,DXDSAB            CLEAR CURRENT DSAB ADDR  YM3937 49960002
         XC    DXDSABAD,DXDSABAD        CLEAR DSAB ADDRESS       YM3937 49980002
         B     RES14240                 BR TO SUCCESSFUL EXIT    YM3937 50000002
         DROP  R3                                                YM1240 50020002
         EJECT                                                   Y02134 50040002
*                                                                       50060002
*        AT THIS POINT IN THE INITIALIZATION ROUTINE:            Y02134 50080002
*        R4  POINTS TO THE OPEN/CLOSE/EOV WORKAREA.              Y02134 50100002
*        R5  IS THE BASE REGISTER.                               Y02134 50120002
*        R3  POINTS TO THE DSAB QDB.                             Y02134 50140002
*        R7  CONTAINS THE BXLE MASK.                             Y02134 50160002
*        R8  MUST BE PRESERVED FOR THE CALLER.                   Y02134 50180002
*        R9  MUST BE PRESERVED FOR THE CALLER.                   Y02134 50200002
*        R14 CONTAINS THE RETURN ADDRESS.                        Y02134 50220002
*        R15 MUST BE PRESERVED FOR THE CALLER.                   Y02134 50240002
*                                                                Y02134 50260002
*        THIS ROUTINE FILLS IN THE FIELDS                        Y02134 50280002
*              DXDSABAD                                          Y02134 50300002
*              DXTIOTAD                                          Y02134 50320002
*              DXUCBADR                                          Y02134 50340002
*              DXDEBXAD                                          Y02134 50360002
*        IN THE CASE THAT THE DCB IS OPEN.  IT OBTAINS THE DSAB         50380002
*        AND TIOT ADDRESSES BASED UPON THE TIOT OFFSET IN DCBTIOT.      50400002
*                                                                       50420002
RES14200 EQU   *                        INITIALIZE MORE FIELDS   Y02134 51100002
         BAL   RD,RES14250              LINK TO SUBROUTINE       Y02134 51120002
*                                                                       51140002
*        RB NOW CONTAINS DSAB ADDRESS                            Y02134 51160002
*        RC NOW CONTAINS TIOT ENTRY ADDRESS                      Y02134 51180002
*        RB AND RC ARE ZERO IF NO DSAB WAS FOUND                 Y02134 51200002
*                                                                       51210002
         L     RA,DXWDEBAD              LOAD DEB ADDRESS         Y02134 51280002
         LR    RD,RA                    LOAD DEB ADDR TO RA      Y02134 51300002
         LA    R3,DEBBASIC-DEBXTNP      NEGATIVE OFFSET TO       Y02134X51320002
                                        DEB EXTENSION ADDRESS    Y02134 51340002
         SR    RD,R3                    POINT RA TO EXT ADDR     Y02134 51360002
         USING DEBXTNP,RD                                        Y02134 51380002
         LTR   RB,RB                    CHECK IF DSAB/TIOT FOUND YM6519 51382002
         BNZ   RES14220                 BRANCH IF FOUND          YM6519 51384002
         TM    DXWDSRG2,ACBDORGA        CHECK FOR ACB/AMB        YM7861 51384102
         BNO   RES14710                 BRANCH IF NOT            YM7861 51384202
         CLI   DXWFOUN+ACBAMETH-ACBDDNM,ACBVTAM TEST FOR VTAM   Z30SSRL 51384337
         BE    RES14240                 EXIT IF VTAM            Y30ASJC 51384500
         TM    DXWFOUN+ACBINFL-ACBDDNM,ACBCAT+ACBSCRA  CHECK    Z30SSRL 51384637
*                                       FOR VSAM CATALOG/SCRA   Z30SSRL 51384837
         BZ    RES14710                 BR IF NOT CATALOG/SCRA  Z30SSRL 51384937
         MVC   DXDEBXAD(K4),DEBXTNP     SET DEB XTN ADDR         YM7046 51385202
         XC    DXTIOTAD,DXTIOTAD        ZERO TIOT ADDR FOR VSAM  YM8506 51385302
         B     RES14240                 BR TO SUCCESS EXIT       YM7046 51385502
RES14220 EQU   *                        COMPARE DSAB ADDRESSES   YM6519 51392002
         L     R3,DEBXTNP               LOAD DEB EXTENSION ADDR  Y02134 51400002
         USING DEBXTN,R3                                         Y02134 51420002
         USING DEBBASIC,RA                                       Y02134 51440002
         ST    R3,DXDEBXAD              STORE DEB EXTENSION ADDR YM7861 51450002
         C     RB,DEBXDSAB              DOES DSAB OBTAINED FROM  Y02134X51460002
                                        TIOT OFFSET MATCH THAT   Y02134X51480002
                                        IN DEB EXTENSION?               51500002
         BE    RES14225                 BR IF DSAB OK            YM7861 51520002
         TM    DXWDSRG2,ACBDORGA        CHECK FOR ACB/AMB        YM7861 51522002
         BNO   RES14710                 BRANCH IF NOT            YM7861 51524002
         TM    DXWFOUN+ACBINFL-ACBDDNM,ACBCAT+ACBSCRA  CHECK    Z30SSRL 51530037
*                                       FOR VSAM CATALOG/SCRA   Z30SSRL 51530437
*                                       IF VSAM CATALOG ORIGINAL YM7861 51532002
*                                       TIOT MAY NOT BE PRESENT  YM7861 51532402
*                                       VSAM WILL RECTIFY THIS   YM7861 51532802
         BZ    RES14710                 BR IF BAD CONTROL BLOCK Z30SSRL 51534037
         XC    DXTIOTAD,DXTIOTAD        ZERO TIOT ADDR FOR VSAM  YM8506 51534402
         B     RES14240                 BR IF VSAM CATALOG       YM8506 51536002
RES14225 EQU   *                        GOOD TIOT ENTRY          YM7861 51538002
         ST    RB,DXDSABAD              STORE DSAB ADDRESS       Y02134 51540002
         ST    RB,DXDSAB                STORE CURRENT DSAB ADD   Y02134 51560002
         DROP  R3                                                YM1240 51600002
         CLI   DEBNMEXT,K0              ANY EXTENTS?             Y02134 51620002
         BE    RES14230                 BR IF NO: NO UCBAD       Y02134 51640002
         MVC   DXUCBADR+K1(K3),DEBSUCBA+K1 USE FIRST EXTENT    @ZA13574 51660037
         CLC   DEBAMTYP,ISAM            CHECK FOR ISAM           YM1240 51680037
         BNE   RES14230                 BRANCH IF NOT ISAM     @ZA13574 51700037
         ST    R2,DXTIOTAD              SAVE REG 2             @ZA25526 51720037
         SR    R2,R2                    ZERO REG 2             @ZA18282 51722037
         ICM   R2,7,DEBSUCBA+K1         INDEX EXTENT ADDR      @ZA18282 51724037
         BNZ   RES14227                 BR IF VALID ADR        @ZA18282 51726037
         ICM   R2,7,DEBSUCBA+K5         PRIME EXTENT ADDR      @ZA18282 51728037
RES14227 EQU   *                                               @ZA25526 51730037
         MVC   DXUCBADR+K1(K3),1(R2)    UCBADDR TO WORK AREA   @ZA25526 51732037
         L     R2,DXTIOTAD              RESTORE R2             @ZA25526 51734037
RES14230 EQU   *                        STORE TIOT ENTRY ADDRESS Y02134 51740002
         ST    RC,DXTIOTAD              STORE TIOT ENTRY ADDRESS Y02134 51760002
*                                                                Y02134 51780002
* SUCCESSFUL INITIALIZATION EXIT                                 Y02134 51800002
*                                                                Y02134 51820002
RES14240 EQU   *                        SUCCESSFUL INIT EXIT     Y02134 51840002
         B     RES14310                 GO TEST IF COPY REQUIRED Y02134 51860002
         DROP  RA,RD                                             YM3198 51870002
         EJECT                                                   Y02134 51880002
*                                                                       51900002
*        THIS SUBROUTINE IS CALLED TO DETERMINE THE DSAB         Y02134 51920002
*        ADDRESS AND THE TIOT ENTRY ADDRESS BASED UPON THE       Y02134 51940002
*        TIOT OFFSET IN DCBTIOT.                                 Y02134 51960002
*        CALLING SEQUENCE IS BAL RD,RES14250                     Y02134 51980002
*        INPUT IS -                                              Y02134 52000002
*              RCORE POINTS TO O/C/E WORKAREA                    Y02134 52020002
*              R3    POINTS TO DSAB QDB                          Y02134 52040002
*              RD    RETURN ADDRESS                              Y02134 52060002
*              DXTIOTAD IN O/C/E WORKAREA CONTAINS TIOT ADDRESS  Y02134 52080002
*        OUTPUT IS -                                             Y02134 52100002
*              RB    ZERO OR POINTER TO DSAB                     Y02134 52120002
*              RC    ZERO OR POINTER TO TIOT ENTRY               Y02134 52140002
*        IF RB AND RC ARE ZERO ON EXIT, NO DSAB/TIOT ENTRY       Y02134 52160002
*        COULD BE FOUND MATCHING THE TIOT OFFSET IN THE DCB.     Y02134 52180002
*                                                                       52200002
RES14250 EQU   *                        GET DSAB ADDRESS         Y02134 52220002
         USING QDB,R3                   R3 POINTS TO DSABQDB     YM1240 52240002
         LH    RC,DXWTIOT               GET TIOT OFFSET          Y02134 52260002
         LA    RB,TIOENTRY-TIOT         MINIMUM TIOT OFFSET      Y02134 52280002
         CR    RC,RB                    IS IT LESS THAN MINIMUM  Y02134 52300002
         BL    RES14270                 BRANCH IF TOO LOW        Y02134 52320002
         A     RC,DXTIOTAD              RC IS NOW POINTER TO     Y02134X52340002
                                        TIOT ENTRY FOR DCBTIOT   Y02134 52360002
         L     RB,QDBFELMP              GET FIRST DSAB           Y02134 52380002
RES14260 EQU   *                        FIND DSAB/TIOT ADDRESSES Y02134 52400002
         LTR   RB,RB                    ANY MORE DSABS           Y02134 52420002
         BZ    RES14270                 BRANCH IF NO MORE        Y02134 52440002
         C     RC,DSABTIOT              IS TIOT ADDR IN THIS ONE Y02134 52460002
         BE    K0(,RD)                  RETURN IF YES            Y02134 52480002
         L     RB,DSABFCHN              GET NEXT DSAB            Y02134 52500002
         B     RES14260                 TEST THIS DSAB           Y02134 52520002
RES14270 EQU   *                        DSAB/TIOT NOT FOUND      Y02134 52540002
         SR    RC,RC                    ZERO TIOT ADDRESS        Y02134 52580002
         SR    RB,RB                    ZERO DSAB ADDRESS        Y02134 52600002
         BR    RD                       RETURN                   Y02134 52620002
         DROP  R3,RB,RC                                          YM3198 52630002
         EJECT                                                   Y02134 52640002
*                                                                Y02134 52660002
* NO INIT, SEE IF COPY AND/OR FIRST COPY                         Y02134 52680002
*                                                                Y02134 52700002
RES14300 EQU   *                        NO INIT ENTRY            Y02134 52720002
         SLL   R7,K1                    ELIMINATE INIT ARGUMENT  Y02134 52740002
* BXLE2  BRANCH IF DCBCOPY LOGIC NOT REQUIRED                    Y02134 52760002
         BXLE  R7,R7,RES14990           BRANCH TO BXLE10         Y02134 52780002
         CLC   DXUDCBAD,DXPDCBAD        TEST IF HAVE COPY        Y02134 52800002
         BNE   RES14800                 BR IF ALREADY HAVE COPY  Y02134 52820002
*                                                                Y02134 52840002
*        DCB COPY LOGIC INITIALIZATION                           Y02134 52860002
*                                                                Y02134 52880002
         L     RDCB,DXUDCBAD            POINT TO USER'S DCB      Y02134 52920002
         LA    R2,DCBDDNAM              PT TO USER'S FOUNDATION  Y02134 52940002
         LA    R1,DXWFOUN               POINT TO SAVE AREA       Y02134 52960002
         LA    R3,L'DXWFOUN             LENGTH OF THE FOUNDATION Y02134 52980002
         BAL   RD,RES14850              COPY USER FOUNDATION     Y02134 53000002
         L     RDCB,DXUDCBAD            GET USER DCB ADDRESS     Y02134 53020002
         MVC   DXWMCR,DXWMACRF          GET MACREF OPENED DCB    Y02134 53040002
         TM    DXWOFLGS,DCBOFOPN+DCBOFEOV CHECK IF DCB OPEN      Y02134 53060002
         BM    RES14304                 BRANCH IF DCB OPNE       Y02134 53080002
         MVC   DXWMCR,DXWMACR           GET MACREF UN-OPENED DCB Y02134 53100002
RES14304 EQU   *                        TEST FOR DCB FOUNDATION  Y02134 53120002
         XC    DXWDSORG,DXWDSORG        CLEAR SAVED DSORG        Y02134 53140002
         TM    DXWMCR,DCBMEXCP          CHECK IF EXCP            Y02134 53160002
         BNO   RES14306                 BR - NOT EXCP            Y02134 53180002
         TM    DXWMCR,DCBMFOUN          CHK IF FOUNDATION EXISTS Y02134 53200002
         BNO   RES14308                 NO FOUNDATION, NO DSORG  Y02134 53220002
RES14306 EQU   *                        COPY DCB TEMPORARILY     Y02134 53240002
         LA    R2,DCBDSORG              POINT TO USER'S DSORG    Y02134 53260002
         LA    R1,DXWDSORG              POINT TO PROTECTED DSORG Y02134 53280002
         LA    R3,L'DXWDSORG            LENGTH OF DSORG          Y02134 53300002
         BAL   RD,RES14850              COPY DCB TEMPORARILY     Y02134 53320002
RES14308 EQU   *                        GO GET COPY WORK AREA    Y02134 53340002
         B     RES14320                 GET COPY AREA            Y02134 53360002
         EJECT                                                   Y02134 53380002
RES14310 EQU   *                        TEST IF DCBCOPY REQUIRED Y02134 53400002
* BXLE2  BRANCH IF DCBCOPY LOGIC NOT REQUIRED                    Y02134 53420002
         BXLE  R7,R7,RES14990           BRANCH TO BXLE10         Y02134 53440002
*                                                                Y02134 53460002
*        DCB COPY LOGIC INITIALIZATION                           Y02134 53480002
*                                                                Y02134 53500002
         CLC   DXUDCBAD,DXPDCBAD        TEST IF HAVE COPY        Y02134 53520002
         BNE   RES14800                 BR IF ALREADY HAVE COPY  Y02134 53540002
*                                                                Y02134 53560002
*        DETERMINE SIZE OF DCB                                   Y02134 53580002
*                                                                Y02134 53600002
RES14320 EQU   *                        DETERMINE DCB SIZE       Y02134 53620002
         XR    RC,RC                    CLEAR LENGTH             Y02134 53640002
         XR    RD,RD                    CLR DELTA FROM DCB BASE  Y02134 53660002
         L     RDCB,DXUDCBAD            POINT TO USER'S DCB      Y02134 53680002
         TM    DXWMCR,DCBMEXCP          EXCP ACCESS METHOD       Y02134 53700002
         BNO   RES14450                 BRANCH IF NOT EXCP       Y02134 53720002
*                                                                Y02134 53740002
*        EXCP                                                    Y02134 53760002
*                                                                Y02134 53780002
         LA    RC,K52                   BASIC LENGTH             Y02134 53800002
         TM    DXWMCR,DCBMRAPG          APPENDAGES PRESENT       Y02134 53820002
         BNO   RES14340                 BRANCH IF NO APPENDAGES  Y02134 53840002
         LA    RC,K20(,RC)              LENGTH APPENDAGES = 20   Y02134 53860002
RES14340 EQU   *                        TEST FOR FOUNDATION      Y02134 53880002
         TM    DXWMCR,DCBMFOUN          FOUNDATION PRESENT       Y02134 53900002
         BO    RES14350                 BRANCH IF PRESENT        Y02134 53920002
         LA    RD,K40                   DELTA = 40               Y02134 53940002
         B     RES14750                 GET CORE                 Y02134 53960002
RES14350 EQU   *                        CHK FOR COMMON INTERFACE Y02134 53980002
         TM    DXWMCR,DCBMRCI           COMMON INTERFACE PRESENT Y02134 54000002
         BO    RES14370                 BRANCH IF YES            Y02134 54020002
         LA    RD,K32                   DELTA = 32               Y02134 54040002
         B     RES14750                 GET CORE                 Y02134 54060002
RES14370 EQU   *                        1 WORD DEVICE INTERFACE  Y02134 54080002
         TM    DXWMCR2,DCBMR1WD         1 WORD DEVICE INTERFACE  Y02134 54100002
         BNO   RES14390                 BRANCH IF NOT            Y02134 54120002
         LA    RD,K16                   DELTA = 16               Y02134 54140002
         B     RES14750                 GET CORE                 Y02134 54160002
RES14390 EQU   *                        3 WORD DEVICE INTERFACE  Y02134 54180002
         TM    DXWMCR2,DCBMR3WD         3 WORD DEVICE INTERFACE  Y02134 54200002
         BNO   RES14410                 BRANCH IF NOT            Y02134 54220002
         LA    RD,K8                    DELTA = 8                Y02134 54240002
         B     RES14750                 GET CORE                 Y02134 54260002
RES14410 EQU   *                        4 WORD DEVICE INTERFACE  Y02134 54280002
         TM    DXWMCR2,DCBMR4WD         4 WORD DEVICE INTERFACE  Y02134 54300002
         BNO   RES14430                 BRANCH IF NOT            Y02134 54320002
         LA    RD,K4                    DELTA = 4                Y02134 54340002
         B     RES14750                 GET CORE                 Y02134 54360002
RES14430 EQU   *                        5 WORD DEVICE INTERFACE  Y02134 54380002
         TM    DXWMCR2,DCBMR5WD         5 WORD DEVICE INTERFACE  Y02134 54400002
         BO    RES14750                 BRANCH - FULL FRONT END  Y02134 54420002
         LA    RD,K20                   DELTA = 20               Y02134 54440002
         B     RES14750                 GET CORE                 Y02134 54460002
*                                                                Y02134 54480002
*        ACB                                                     Y02134 54500002
*                                                                Y02134 54520002
RES14450 EQU   *                        CHECK FOR ACB/AMB        Y02134 54540002
         TM    DXWDSRG2,ACBDORGA        CHECK FOR ACB/AMB        Y02134 54560002
         BNO   RES14470                 BRANCH IF NOT            Y02134 54580002
         MODESET KEYADDR=DXUKEY,WORKREG=12  ASSUME USER KEY      YM1225 54600002
         LH    RC,ACBLENG-IFGACB(,RDCB)  GET LENGTH OF ACB       Y02134 54620002
         MODESET EXTKEY=DATAMGT         RESTORE DM KEY           YM1225 54640002
         SLL   RC,K17                   ENSURE POSITIVE LENGTH   Y02134 54660002
         SRL   RC,K17                   SIGN BIT 0               Y02134 54680002
         B     RES14750                 GET CORE                 Y02134 54700002
*                                                                Y02134 54720002
*        PHYSICAL SEQUENTIAL (PS)                                Y02134 54740002
*                                                                Y02134 54760002
RES14470 EQU   *                        TEST IF PS               Y02134 54780002
         TM    DXWDSORG,DCBDSGPS        TEST IF PS               Y02134 54800002
         BNO   RES14530                 BRANCH IF NOT PS         Y02134 54820002
*                                                                Y02134 54840002
*        QSAM                                                    Y02134 54860002
*                                                                Y02134 54880002
RES14480 EQU   *                        TEST IF BSAM OR QSAM     YM3070 54900002
         LA    RC,K96                   LN = 96 QSAM             Y02134 54920002
         TM    DXWMCR1,XC0              CHECK IF QSAM            Y02134 54940002
         BM    RES14490                 BRANCH IF QSAM           Y02134 54960002
         TM    DXWMCR2,XC0              CHECK IF QSAM            Y02134 54980002
         BM    RES14490                 BRANCH IF QSAM           Y02134 55000002
*                                                                Y02134 55020002
*        BSAM                                                    Y02134 55040002
*                                                                Y02134 55060002
         LA    RC,K88                   LN = 88 BSAM             Y02134 55080002
*                                                                Y02134 55100002
RES14490 EQU   *                        TEST FOR DUMMY DCB       Y02134 55120002
         L     R3,DXUCBADR              GET FIRST UCB ADDRESS    Y02134 55140002
         LTR   R3,R3                    CHECK FOR DUMMY DCB      Y02134 55160002
         BNZ   RES14495                 BRANCH IF NOT DUMMY      YM3066 55180002
*                                                                YM3066 55200002
         L     R3,DXTIOTAD              GET TIOT ADDRESS         YM3066 55220002
         LA    RD,K16                   INITIALIZE FOR A 1 WORD  YM3066X55240002
                                        DEVICE INTERFACE FOR TSO YM3066 55260002
         TM    TIOELINK-TIOENTRY(R3),TIOTTERM  TEST FOR TSO TERM YM3856 55280002
         BO    RES14750                 BR IF YES TO GET CORE    YM3066 55300002
         LA    RD,K20                   DUMMY DCB - INDICATE     YM3066X55320002
                                        NO DEVICE INTERFACE      YM3066 55340002
         B     RES14750                 GO GET THE CORE          YM3066 55360002
*                                                                YM3066 55380002
         USING UCBOB,R3                                          Y02134 55400002
RES14495 EQU   *                        CHECK IF UNIT RECORD     YM3066 55420002
         XR    RD,RD                    FULL DEVICE INTERFACE    Y02134 55440002
         TM    UCBTBYT3,UCB3UREC        CHECK IF UNIT RECORD     Y02134 55460002
         BNO   RES14750                 NOT U/R HAS DELTA = 0    Y02134 55480002
* CHECK IF PAPER TAPE                                            Y02134 55500002
         LA    RD,K8                    3 WORD DEVICE INTERFACE  Y02134 55520002
         CLI   UCBTBYT4,X'10'           PAPER TAPE - 2671        Y02134 55540002
         BE    RES14750                 BRANCH IF PAPER TAPE     Y02134 55560002
* CHECK IF OCR/MICR DEVICE                                       Y02134 55580002
         XR    RD,RD                    5 WORD DEVICE INTERFACE  YM3102X55600002
                                        FOR AN OCR/MICR DEVICE   YM3102 55620002
         LA    RB,RESOCMIE-RESOCMI      NBR OF OCR/MICR DEVICES  Y02134 55640002
         LA    R1,RESOCMI               FIRST OCR/MICR UNIT TYPE Y02134 55660002
RES14500 EQU   *                        CHECK IF OCR/MICR        Y02134 55680002
         CLC   UCBTBYT4,K0(R1)          CHECK IF OCR/MICR        Y02134 55700002
         BE    RES14750                 BRANCH IF OCR/MICR       Y02134 55720002
         LA    R1,K1(R1)                INCREMENT TO NEXT ENTRY  Y02134 55740002
         BCT   RB,RES14500              CHECK NEXT ENTRY         Y02134 55760002
* CARD READER/PUNCH/PRINTER DELTA=16                             Y02134 55780002
         LA    RD,K16                   UNIT RECORD HAS 1 WORD   Y02134X55800002
                                        DEVICE INTERFACE         YM3138 55810002
         B     RES14750                 GET CORE                 Y02134 55820002
         DROP  R3                                                Y02134 55840002
*                                                                Y02134 55860002
*        BPAM                                                    Y02134 55880002
*                                                                Y02134 55900002
RES14530 EQU   *                        CHECK IF BPAM            Y02134 55920002
         TM    DXWDSORG,DCBDSGPO        CHECK IF BPAM            Y02134 55940002
         BNO   RES14550                 BRANCH IF NOT BPAM       Y02134 55960002
         LA    RC,K88                   LN = 88, DELTA = 0       Y02134 55980002
         B     RES14750                 GET CORE                 Y02134 56000002
*                                                                Y02134 56020002
*        BDAM                                                    Y02134 56040002
*                                                                Y02134 56060002
RES14550 EQU   *                        CHECK IF BDAM            Y02134 56080002
         TM    DXWDSORG,DCBDSGDA        CHECK IF BDAM            Y02134 56100002
         BNO   RES14570                 BRANCH IF NOT BDAM       Y02134 56120002
         LA    RD,K16                   1 WORD DEVICE INTERFACE  YM4622 56130002
         LA    RC,K104                  LENGTH = 104, DELTA = 16 YM4622 56140002
         B     RES14750                 GET CORE                 Y02134 56160002
*                                                                Y02134 56180002
*        ISAM                                                    Y02134 56200002
*                                                                Y02134 56220002
RES14570 EQU   *                        CHECK IF ISAM            Y02134 56240002
         TM    DXWDSORG,DCBDSGIS        CHECK IF ISAM            Y02134 56260002
         BNO   RES14590                 BRANCH IF NOT ISAM       Y02134 56280002
         LA    RD,K16                   1 WORD DEVICE INTERFACE  Y02134 56300002
         LA    RC,K252                  LN = 252, DELTA = 16     Y02134 56320002
         B     RES14750                 GET CORE                 Y02134 56340002
*                                                                Y02134 56360002
*        BTAM                                                    Y02134 56380002
*                                                                Y02134 56400002
RES14590 EQU   *                        CHECK IF BTAM            Y02134 56420002
         TM    DXWDSORG,DCBDSGCX        CHECK IF BTAM            Y02134 56440002
         BNO   RES14630                 BRANCH IF NOT BTAM       Y02134 56460002
* PREFIX = 1 WORD FOR WTTA DEVICE                                Y02134 56480002
* PREFIX = 0 WORDS FOR ALL OTHER DEVICES                         Y02134 56500002
         L     R3,DXUCBADR              GET UCB ADDRESS          Y02134 56520002
         USING UCBOB,R3                 UCB ADDRESSABILITY       Y02134 56540002
         LA    RD,K20                   NO DEVICE INTERFACE      Y02134 56560002
         LA    RC,K56                   MINIMUM DCB LENGTH      YA02128 56580002
         CLI   UCBTBYT3,UCB3COMM        TEST FOR COMM EQUIP      Y02134 56600002
         BNE   RES14750                 NO - DEFAULT MIN DCB     Y02134 56620002
         LA    R1,K6                    WTTA INDICATOR           Y02134 56640002
         XR    RB,RB                    CLEAR WORK REGISTER      Y02134 56660002
         IC    RB,UCBTBYT4              GET DEVICE TYPE          Y02134 56680002
         SRL   RB,K4                    ALIGN BITS 0-3           Y02134 56700002
         CR    R1,RB                    CHECK IF WTTA            Y02134 56720002
         BNE   RES14600                 NO - THEN NO DEV INTF    Y02134 56740002
         LA    RD,K16                   WTTA HAS 1 WORD DEV INTF Y02134 56760002
* LENGTH = 100 FOR BI-SYNC                                       Y02134 56780002
* LENGTH = 56 FOR NOT BI-SYNC                                   YA02128 56800002
RES14600 EQU   *                        FIGURE OUT THE LENGTH    Y02134 56840002
         LA    RC,K100                  LENGTH BI-SYNC DCB       Y02134 56860002
         LA    R1,K7                    ID SYNC ADAPTOR TYPE I   Y02134 56880002
         CR    R1,RB                    CHK IF BI-SYNC ADAPTOR   Y02134 56900002
         BE    RES14750                 BRANCH IF YES            Y02134 56920002
         LA    R1,K9                    ID SYNC ADAPTOR TYPE II  Y02134 56940002
         CR    R1,RB                    CHK IF BI-SYNC ADAPTOR   Y02134 56960002
         BE    RES14750                 YES - GO GET CORE        Y02134 56980002
         DROP  R3                                                Y02134 57000002
* NOT BI-SYNC                                                    Y02134 57020002
         LA    RC,K56                   MINIMUM DCB LENGTH      YA02128 57040002
         B     RES14750                 GET CORE FOR DCB         Y02134 57160002
*                                                                Y02134 57180002
*        TCAM                                                    Y02134 57200002
*                                                                Y02134 57220002
RES14630 EQU   *                        CHK IF TCAM LINE GROUP   Y02134 57240002
         TM    DXWDSRG2,DCBDSGTX        CHK IF TCAM LINE GROUP   Y02134 57260002
         BNO   RES14640                 BRANCH IF NOT TX         Y02134 57280002
         MODESET KEYADDR=DXUKEY,WORKREG=11  DCB IN USER CORE     Y02134 57300002
         IC    RC,DCBOFLGS+K4           DCBILCT                  Y02134 57320002
         MODESET EXTKEY=DATAMGT         RETURN TO O/C/E KEY      Y02134 57340002
         SLL   RC,K2                    NUMBER OF BYTES          Y02134 57360002
         LA    RC,K60(,RC)              BASE DCB = 60            Y02134 57380002
         LA    RD,K20                   DELTA = 20               Y02134 57400002
         B     RES14750                 GET CORE                 Y02134 57420002
RES14640 EQU   *                        CHECK IF TCAM            Y02134 57440002
         TM    DXWDSRG2,DCBDSGTQ        CHECK IF TCAM            Y02134 57460002
         BNO   RES14670                 BRANCH IF NOT TCAM       S22024 57480002
         LA    RC,K64                   LN = 64                  YM3933 57500002
         LA    RD,K20                   DELTA = 20               Y02134 57520002
         B     RES14750                 GET CORE                 Y02134 57540002
*                                                                S22024 57560002
RES14670 EQU   *                        TEST FOR 3705            S22024 57580002
         TM    DXWDSRG2,DCBDSGTR        TEST FOR A 3705          S22024 57600002
         BNO   RES14680                 BRANCH IF NOT            S22024 57620002
         LA    RC,K56                   DCB LENGTH = 56 BYTES    S22024 57640002
         LA    RD,K8                    DELTA = 8 BYTES SINCE    S22024X57660002
                                        DCB HAS A 3 WORD DEVICE  S22024X57680002
                                        DEPENDENT SECTION        S22024 57700002
         B     RES14750                 GO GET THE CORE          S22024 57720002
*                                                                S22024 57740002
RES14680 EQU   *                        CHECK FOR GAM            Y02134 57760002
         TM    DXWDSRG2,DCBDSGGS        CHECK IF GAM             Y02134 57780002
         BNO   RES14690                 UNKNOWN DSORG            YM3070 57800002
         LA    RC,K52                   LN = 52                  Y02134 57820002
         B     RES14750                 GET CORE                 Y02134 57840002
*                                                                YM3070 57860002
RES14690 EQU   *                        UNKNOWN DSORG            YM3070 57880002
         OI    DXWCOPYE,X04             SET UNKNOWN DSORG FLAG   YM3070 57900002
         B     RES14480                 GO ASSUME DSORG IS PS    YM3070 57920002
*                                                                Y02134 57940002
* INVALID INITIALIZATION OR INITIAL COPY                         Y02134 57960002
*                                                                Y02134 57980002
RES14700 EQU   *                        DDNAME MISSING           Y02134 58000002
         OI    DXWCOPYE,X02             SET DDNAME MISSING BIT   Y02134 58020002
         B     RES14720                 CHECK IF COPY REQUEST    Y02134 58040002
RES14710 EQU   *                        SET ERROR INIT/COPY      Y02134 58060002
         OI    DXWCOPYE,X01             SET ERROR INIT/COPY BIT  Y02134 58080002
RES14720 EQU   *                        ZERO POINTERS            Y02134 58100002
         XC    DXDSABAD,DXDSABAD        ZERO DSAB POINTER        Y02134 58120002
         XC    DXTIOTAD,DXTIOTAD        ZERO TIOT ENTRY POINTER  Y02134 58140002
         BXLE  R7,R7,RES14950           BRANCH IF NO COPY        Y02134 58160002
         LA    RC,K52                   MINIMUM DCB LENGTH       Y02134 58180002
         LA    RD,K40                   GET FOUNDATION ONLY      Y02134 58200002
*                                                                       58220002
* THIS SECTION GETS THE CORE FOR THE PROTECTED (COPIED) DCB.            58240002
*                                                                       58260002
*        THE CALLER MUST BE IN KEY 5.                                   58280002
*        RC CONTAINS THE LENGTH.                                        58300002
*        RD CONTAINS THE DEAD SPACE IN FRONT OF THE DCB.                58320002
*                                                                       58340002
RES14750 EQU   *                        GET CORE FOR THE DCB     Y02134 58360002
         LTR   RC,RC                    CHECK IF ANY CORE TO GET Y02134 58380002
         BZ    RES14800                 BRANCH IF NOT            Y02134 58400002
         TM    DXWCOPYE,X04             TEST IF UNKNOWN DSORG    YM3070 58420002
         BNO   RES14760                 BRANCH IF DSORG KNOWN    YM3070 58440002
         STH   RC,DXUDCBML              SAVE BSAM/QSAM LENGTH    YM3070 58460002
         LA    RC,K252                  SET UP TO GET LARGEST    YM3070X58480002
                                        (ISAM) DCB LENGTH        YM3070 58500002
RES14760 EQU   *                        GET CORE FOR DCB         YM3070 58520002
         STM   RC,RF,DXREGD             SAVE RC, RD, CALLER'S    YM7079X58530002
                                        RETURN ADDR, & CALLER'S  YM7079X58532002
                                        REG SAVE AREA ADDRESS    YM7079 58536002
         LA    RD,K96                   MINIMUM GETMAIN LEN    @ZA01348 58538037
         C     RD,DXREGD                IS DCB LENGTH GE 96?   @ZA01348 58538437
         BNH   RES14765                 YES,CONTINUE           @ZA01348 58538837
         LR    RC,RD                    NO, SET LEN TO 96      @ZA01348 58539237
RES14765 EQU   *                                               @ZA01348 58539637
         LA    R6,IECEXTPR-IECPREFX(,R6) ADDR OF REGISTER SAVE   Y02134 58540002
         IECRES GET,LV=(RC),A=(R6),STM=(RCORE,R7,DXREG9),        YM7079X58560002
               ID=DCB,PREFIX=YES        GET COPY AREA            Y02134 58580002
*                                                                       58600002
         LM    RC,RF,DXREGD             RESTORE RC, RD, CALLER'S YM7079X58610002
                                        RETURN ADDR, & CALLER'S  YM7079X58620002
                                        REG SAVE AREA ADDRESS    YM7079 58630002
         ST    R1,DXPDCBAD              SAVE ADDR PROTECTED COPY Y02134 58640002
         LR    RDCB,R1                  POINT TO PROTECTED DCB   Y02134 58660002
         STH   RD,DXUDCBPL              SAVE DEAD SPACE LENGTH   Y02134 58680002
         TM    DXWCOPYE,X04             TEST IF UNKNOWN DSORG    YM3070 58700002
         BNO   RES14770                 BRANCH IF DSORG KNOWN    YM3070 58720002
         LH    RC,DXUDCBML              RELOAD SAVED LENGTH      YM3070 58740002
         NI    DXWCOPYE,X'FF'-X04       RESET UNKNOWN DSORG BIT  YM3070 58760002
*                                                                YM3070 58770002
RES14770 EQU   *                        SAVE REAL LENGTH OF DCB  YM3070 58780002
         SR    RC,RD                    REAL LENGTH OF DCB       Y02134 58800002
         STH   RC,DXUDCBML              SAVE REAL LENGTH OF DCB  Y02134 58820002
         MVC   DCBDDNAM(L'DXWFOUN),DXWFOUN  SET ORIG FOUN IN DCB Y02134 58840002
         MVC   DCBDSORG,DXWDSORG        SET ORIG DSORG IN DCB    Y02134 58860002
*                                                                Y02134 58880002
         L     R6,IECUPRML-IECEXTPR(,R6)  PT USER PLIST IN W/A   Y02134 58900002
         L     RB,DXUDCBAD              ADDRESS OF USER'S DCB    Y02134 58920002
RES14780 EQU   *                        CHECK IF ADDR IN LIST    Y02134 58940002
         CLM   RB,B'0111',K1(R6)        CHECK IF ADDR IN LIST    Y02134 58960002
         BE    RES14790                 BRANCH IF YES            Y02134 58980002
         TM    PLISTOPT(R6),LASTNTRY    TEST IF END OF PLIST     Y02134 59000002
         BO    RES14800                 YES - THEN NOT IN LIST   Y02134 59020002
         LA    R6,K4(R6)                SET NEXT ENTRY           Y02134 59040002
         B     RES14780                 KEEP LOOKING             Y02134 59060002
RES14790 EQU   *                        REPLACE USER POINTER     Y02134 59080002
         STCM  R2,B'0111',K1(R6)        REPLACE USER PTR WITH PROTECT  *59100002
                                        COPY ADDR IN USER PARAMETER    *59120002
                                        LIST IN THE WORK AREA    Y02134 59140002
         EJECT                                                   Y02134 59160002
***                                                              Y02134 59180002
*                                                                Y02134 59200002
*        DCB COPY LOGIC                                          Y02134 59220002
*                                                                Y02134 59240002
***                                                              Y02134 59260002
RES14800 EQU   *                        DCB COPY                 Y02134 59280002
         BXLE  R7,R7,RES14820           BR COPY FROM WORK AREA   Y02134 59300002
*                                                                Y02134 59320002
* COPY FROM THE USER'S DCB TO THE WORK AREA                      Y02134 59340002
*                                                                Y02134 59360002
         L     RDCB,DXPDCBAD            POINT TO PROTECTED COPY  Y02134 59380002
         MVC   DXWFOUN,DCBDDNAM         GET ORIG FOUNDATION      Y02134 59400002
         MVC   DXWDSORG,DCBDSORG        GET ORIGINAL DSORG       Y02134 59420002
         L     R1,DXPDCBAD              TARGET = PROTECTED COPY  Y02134 59440002
         L     R2,DXUDCBAD              FROM USER COPY           Y02134 59460002
         AH    R1,DXUDCBPL              BUMP PAST DEAD SPACE     Y02134 59480002
         AH    R2,DXUDCBPL              BUMP PAST DEAD SPACE     Y02134 59500002
         LH    R3,DXUDCBML              SET LENGTH OF MOVE       Y02134 59520002
         BAL   RD,RES14850              MOVE USER TO US          Y02134 59540002
*                                                                       59560002
         L     RDCB,DXPDCBAD            POINT TO PROTECTED COPY  Y02134 59580002
         LA    RC,ALLBITS-DCBOFIOF      SET BUSY OFF MASK        Y02134 59600002
         TM    DCBOFLGS,DCBOFIOF        CHK IF BUSY ON IN USER   Y02134 59620002
         BNO   RES14805                 BRANCH IF NOT ON         Y02134 59640002
         LA    RC,ALLBITS               SET BUSY ON MASK         Y02134 59660002
RES14805 EQU   *                        SET BUSY ON/OFF          Y02134 59680002
         IC    RD,DXWOFLGS              GET ORIGINAL OPEN FLAGS  Y02134 59700002
         NR    RD,RC                    SET BUSY ON/OFF          Y02134 59720002
         STC   RD,DXWOFLGS              SET IN PROTECTED COPY    Y02134 59740002
         MVC   DCBDDNAM(L'DXWFOUN),DXWDDNAM  SET ORIG FOUNDATION Y02134 59760002
         BXLE  R7,R7,RES14816           BRANCH IF NOT INIT       Y02134 59780002
*                                                                YM3136 59790002
* SET BUSY BIT IN BOTH THE USER'S DCB AND THE COPIED DCB         YM3136 59800002
*                                                                YM3136 59820002
         TM    DXWCOPYE,ALLBITS         CHECK IF ERROR           YM3136 59840002
         BM    RES14816                 BRANCH IF AN ERROR       YM3136 59860002
         TM    DCBOFLGS,DCBOPEN         TEST IF OPEN             YM3800 59880002
         BNO   RES14808                 BRANCH IF NOT OPEN       YM3800 59900002
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP            YM3800 59920002
         BO    RES14812                 BRANCH IF EXCP           YM3800 59940002
         B     RES14810                 BRANCH TO TEST DSORG     YM3800 59960002
RES14808 EQU   *                        EXCP TEST IF UNOPENED    YM3800 59980002
         TM    DCBMACR,DCBMEXCP         TEST FOR EXCP            YM3800 60000002
         BO    RES14812                 BRANCH IF EXCP           YM3800 60020002
RES14810 EQU   *                        TEST FOR ACB/AMB         YM3800 60040002
         TM    DCBDSRG2,DCBACBM         TEST FOR ACB/AMB         YM3800 60060002
         BNO   RES14812                 BRANCH IF NOT            YM3800 60080002
         CLI   AMBID-IDAAMB(RDCB),AMBIDENT  TEST FOR AMB         YM3800 60100002
         BE    RES14814                 DO NOT SET BUSY BIT ON   YM3800X60120002
                                        IN USER'S AMB            YM3800 60140002
RES14812 EQU   *                        SET BUSY BIT IN DCB      YM3800 60160002
         MODESET KEYADDR=DXUKEY,WORKREG=11  SWITCH TO USER KEY   YM3800 60180002
         L     RB,DXUDCBAD              LOAD USER'S DCB ADDRESS  YM3136 60200002
         OI    DCBOFLGS-IHADCB(RB),DCBOFIOF  SET BUSY BIT ON     YM3136X60220002
                                        IN USER'S DCB            YM3136 60240002
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    YM3800 60260002
RES14814 EQU   *                        SET BIT IN PROT'D DCB    YM3800 60280002
         OI    DCBOFLGS,DCBOFIOF        SET BUSY BIT ON IN       YM3136X60300002
                                        COPIED (PROTECTED) DCB   YM3136 60320002
RES14816 EQU   *                        MOVE IN ORIGINAL DSORG   Y02134 60340002
         MVC   DCBDSORG,DXWDSORG        SET ORIGINAL DSORG       Y02134 60360002
         B     RES14990                 EXIT                     Y02134 60380002
         EJECT                                                          60400002
*                                                                Y02134 60420002
* COPY FROM THE WORK AREA TO THE USER'S DCB                      Y02134 60440002
*                                                                Y02134 60460002
RES14820 EQU   *                        COPY FROM WORK AREA      Y02134 60480002
         MODESET KEYADDR=DXUKEY,WORKREG=11  ASSUME USER KEY      Y02134 60500002
         L     R0,DXUDCBAD              TARGET = USER'S DCB      Y02134 60520002
         L     R2,DXPDCBAD              FROM PROTECTED COPY      Y02134 60540002
         AH    R0,DXUDCBPL              BUMP PAST DEAD SPACE     Y02134 60560002
         AH    R2,DXUDCBPL              BUMP PAST DEAD SPACE     Y02134 60580002
         LH    R1,DXUDCBML              LENGTH OF DCB            Y02134 60600002
         LR    R3,R1                    LENGTH OF FROM SAME      Y02134 60620002
* AN 0C4 ABEND AT THE NEXT INSTRUCTION IS CAUSED BY A USER ERROR.       60640002
         MVCL  R0,R2                    COPY DCB                 Y02134 60660002
         MODESET EXTKEY=DATAMGT         RESTORE ENTRY KEY        Y02134 60680002
         B     RES14990                 EXIT                     Y02134 60700002
         EJECT                                                   Y02134 60720002
*                                                                Y02134 60740002
*        COPY FROM USER DCB TO WORK AREA COPY                    Y02134 60760002
*                                                                Y02134 60780002
*        R1 POINTS TO THE WORK AREA COPY (IN KEY 5).             Y02134 60800002
*        R2 POINTS TO THE USER'S DCB (IN USER KEY).              Y02134 60820002
*        R3 CONTAINS THE LENGTH OF THE MOVE IN BYTES.            Y02134 60840002
*        RD CONTAINS THE RETURN ADDRESS.                         Y02134 60860002
*                                                                Y02134 60880002
RES14850 EQU   *                        COPY FROM USER'S DCB     Y02134 60900002
         IC    RC,DXUKEY                GET CALLER'S KEY         YM1391 60920002
         L     RB,DXUDCBAD              LOAD USER'S DCB ADDRESS  YM3001 60940002
         MODESET EXTKEY=ZERO            ASSUME KEY ZERO          YM1391 60960002
         TM    DCBOFLGS-IHADCB(RB),DCBOPEN  TEST IF OPEN         YM3001 60980002
         BNO   RES14860                 BRANCH IF NOT            YM3001 61000002
         TM    DCBMACRF-IHADCB(RB),DCBMEXCP  TEST FOR EXCP       YM3001 61020002
         BO    RES14880                 BRANCH IF EXCP           YM3001 61040002
         B     RES14870                 BRANCH TO TEST DSORG     YM3001 61060002
RES14860 EQU   *                        TEST ON UNOPEN DCB       YM3001 61080002
         TM    DCBMACR-IHADCB(RB),DCBMEXCP  TEST FOR EXCP        YM3001 61100002
         BO    RES14880                 BRANCH IF EXCP           YM3001 61120002
RES14870 EQU   *                        TEST FOR ACB/AMB         YM3001 61140002
         TM    DCBDSRG2-IHADCB(RB),DCBACBM  TEST FOR ACB/AMB     YM3001 61160002
         BNO   RES14880                 BRANCH IF NOT            YM3001 61180002
         CLI   AMBID-IDAAMB(RB),AMBIDENT  TEST FOR AMB           YM3001 61200002
         BNE   RES14880                 BRANCH IF NOT AMB        YM3001 61220002
         SR    RC,RC                    SET KEY = 0 IN REG       YM1391 61240002
*                                                                YM3001 61260002
RES14880 EQU   *                        PROPER KEY IN REG 12     YM3001 61280002
         SPKA  0(RC)                    ASSUME PROPER KEY        YM3001 61300002
         IC    R0,K0(R2)                GET BYTE                 Y02134 61320002
         MODESET EXTKEY=DATAMGT         KEY OF WORK AREA         Y02134 61340002
         STC   R0,K0(R1)                MOVE BYTE TO WORK AREA   Y02134 61360002
         LA    R1,K1(R1)                POINT TO NEXT SLOT       Y02134 61380002
         LA    R2,K1(R2)                POINT TO NEXT FROM SLOT  Y02134 61400002
         BCT   R3,RES14880              BRANCH IF MORE TO MOVE   YM3001 61420002
         BR    RD                       RETURN                   Y02134 61440002
         EJECT                                                   Y02134 61460002
*                                                                       61480002
*        EXIT ROUTINE FROM INIT                                  Y02134 61500002
*                                                                       61520002
RES14950 EQU   *                        ERROR RETURN             Y02134 61540002
RES14990 EQU   *                        EXIT ROUTINE             Y02134 61560002
         XC    DXWFOUN,DXWFOUN          CLEAR WORK AREA          Y02134 61580002
         XC    DXWDSORG,DXWDSORG        CLEAR WORK AREA          Y02134 61600002
         L     RDCB,DXPDCBAD            ADDRESS OF PROTECTED DCB Y02134 61620002
         L     RES,CVTPTR               ADDRESS OF CVT           Y02080 61640002
         L     RES,CVTDMSR-CVT(,RES)    ADDRESS OF IFG019RA      Y02080 61660002
         BR    RET                      RETURN                   Y02134 61680002
         EJECT                                                          61700002
*********************************************************************** 61720002
*                                                                     * 61740002
*        CONSTANTS                                                    * 61760002
*                                                                     * 61780002
*********************************************************************** 61800002
*                                                                       61820002
ISAM     DEBCHK AM=ISAM,MF=L            ISAM DEB TYPE            YM1240 61840002
*                                                                       61860002
MASKTBLE DS    0F                       TABLE OF POINTERS TO     Y02134 61880002
*                                       TABLES OF BXLE MASKS     Y02134 61900002
         DC    A(RESNOCPY)              ADDR OF MASKS IF NO      Y02134 61920002
*                                       DCB COPY REQUESTED       Y02134 61940002
         DC    A(RESTOWK)               ADDR OF MASKS IF DCB     Y02134 61960002
*                                       COPY IS TO WORKAREA      Y02134 61980002
         DC    A(RESFRWK)               ADDR OF MASKS IF DCB     Y02134 62000002
*                                       COPY IS FROM WORKAREA    Y02134 62020002
RESNOCPY DS    0F                       TABLE OF MASKS: DCB      Y02134 62040002
*                                       COPY NOT REQUESTED       Y02134 62060002
         DC    BL1'01111100',AL3(1)     INVALID                  Y02134 62080002
         DC    BL1'00111000',AL3(1)     INIT, DEB=YES, NOCOPY    Y02134 62100002
         DC    BL1'00011000',AL3(1)     INIT, DEB=NO, NOCOPY     Y02134 62120002
RESTOWK  DS    0F                       TABLE OF MASKS: DCB      Y02134 62140002
*                                       COPY TO WORKAREA         Y02134 62160002
         DC    BL1'01100100',AL3(1)     COPY TOWKAR              Y02134 62180002
         DC    BL1'00100000',AL3(1)     INIT, DEB=YES, COPY      Y02134 62200002
         DC    BL1'00000000',AL3(1)     INIT, DEB=NO, COPY       Y02134 62220002
RESFRWK  DS    0F                       TABLE OF MASKS: DCB      Y02134 62240002
*                                       COPY FROM WORKAREA       Y02134 62260002
         DC    BL1'01101100',AL3(1)     COPY FRWKAR              Y02134 62280002
         DC    BL1'01111100',AL3(1)     INVALID                  Y02134 62300002
         DC    BL1'01111100',AL3(1)     INVALID                  Y02134 62320002
*                                                                       62340002
VTAMDDN  DC    X'FF00000000000000'      VTAM DDNAME TEST         Y02134 62360002
*                                                                Y02134 62380002
*        OCR/MICR DEVICES - FOR DCBCOPY                          Y02134 62400002
*                                                                Y02134 62420002
RESOCMI  EQU   *                        OCR/MICR TABLE           Y02134 62440002
         DC    X'16'                    SENECA                   Y02134 62460002
         DC    X'17'                    SHARK                    Y02134 62480002
         DC    X'18'                    TCR                      Y02134 62500002
         DC    X'1A'                    1285 OPTICAL READER      Y02134 62520002
         DC    X'1B'                    1287 OPTICAL READER      Y02134 62540002
         DC    X'1C'                    1288 OPTICAL READER      Y02134 62560002
         DC    X'1D'                    1419 MICR PRIMARY        Y02134 62580002
         DC    X'1E'                    1419 MICR SECONDARY      Y02134 62600002
         DC    X'1F'                    1275 OPTICAL READER    @ZA03157 62610037
         DC    X'00'                    PATCH                    Y02134 62620002
         DC    X'00'                    PATCH                    Y02134 62640002
RESOCMIE EQU   *                        END OCR/MICR TABLE       Y02134 62660002
         DS    0H                       ALIGN                    Y02134 62680002
         EJECT                                                   YM3066 62700002
*********************************************************************** 95000002
*        PATCH AREA FOR THE SECOND PAGE OF IFG019RA                     95020002
*********************************************************************** 95040002
*                                                                       95050002
         XCTLTABL LENGTH=,PATCH=104,BRT=YES                      YM3138 95060002
         EJECT                                                          95080002
         IECDSECS CVT,PSA,MAIN,PREFX,RRPL,WTG,ACB,UCB,ASCB,      Y02134X95100002
               CDE,LPDE,DCB,                                     Y02134X95120002
               DSAB,QDB,JSCB,TCB,RB,IEZDEB,TIOT,EXPAND=YES       Y02134 95140002
DCBERROP EQU   IHADCB+33                ERROR RECOVERY PROC BITS Y02080 95160002
DCBERPC  EQU   BIT4                     EROPT=C FOR BTAM         Y02080 95180002
         IEFQMIOP                                                Y02134 95200002
QMIEND   DS    0D                                                Y02134 95220002
         EJECT                                                   YM3066 95240002
         IEFJESCT                                                Y02134 95260002
         EJECT                                                   YM1360 95280002
ENQPARMS DSECT                          ENQ PARAMETER LIST DSECT Y02134 95300002
ENQLIST  DS    0C                       ENQ MACRO AREA           Y02134 95320002
         ORG   *+ENQLTH                                          Y02134 95340002
ENQMIN   DS    0CL6                     MINOR NAME               Y02134 95360002
ENQASID  DS    CL2                      ASID AREA                Y02134 95380002
ENQDSABQ DS    CL4                      DSAB QDB ADDRESS AREA    Y02134 95400002
ENQPARML EQU   *-ENQLIST                LENGTH OF ENQPARMS       Y02134 95420002
         SPACE 2                                                 YM3066 95440002
DEQPARMS DSECT                          DEQ PARAMETER LIST DSECT Y02134 95460002
DEQLIST  DS    0C                       DEQ MACRO AREA           Y02134 95480002
         ORG   *+DEQLTH                                          Y02134 95500002
DEQMIN   DS    0CL6                     MINOR NAME               Y02134 95520002
DEQASID  DS    CL2                      ASID AREA                Y02134 95540002
DEQDSABQ DS    CL4                      DSAB QDB ADDRESS AREA    Y02134 95560002
DEQPARML EQU   *-DEQLIST                LENGTH OF DEQPARMS       Y02134 95580002
         EJECT                                                   YM3066 95600002
         IDAAMB                                                  YM1391 95620002
         END                                                            95700002
