         TITLE 'IFG0200V - 2ND INITIAL LOAD AND DIRECT ACCESS STRING'   00200021
IFG0200V CSECT                                                          00800021
*********************************************************************** 01000021
*                                                                     * 01200021
*          VS1 RELEASE 02 CHANGES                                     * 01260002
*0000509000,510431,510475,348689,509964,509968,510988            XM1037 01262002
*0000                                                            X02989 01270002
*0000                                                            XM1010 01280002
*          VS2 RELEASE 01 CHANGES                                     * 01300000
*0000504600,505100                                               YM3055 01350000
*                                                                     * 01400021
*                                                                     * 01600037
*          VS2 RELEASE 03.7 CHANGES/DELETIONS                         * 01640037
*THIS APAR IS ONLY RESHIPPING THIS MODULE. NO CODE WAS CHANGED @ZA12930 01680037
*                                                                     * 01720037
*          VS2 RELEASE 03 CHANGES/DELETIONS                           * 01760037
*0000751120,751700-778000                                      @ZA04398 01800037
*0000535000,535500                                             @ZA06778 02000037
*0000                                                          @ZA07590 02100037
*0000780000-790000                                             @ZA08312 02150037
*0000                                                          @ZA10537 02170037
*                                                                     * 02200037
*          RELEASE 21 DELETIONS/CHANGES                               * 02400021
*0000366000-368000,532000-534000,798000,802000-810000,962000     M0171  02420021
*0000208000,238000-254000,346000,352000,380000,526000,538000,    A38013 02450021
*0000626000-628000,672000-688000,758000,804000,814000,818000,    A38013 02500021
*0000856000,964000                                               A38013 02550021
*0000264000,376000,388000,396000,404000-436000,440000-442000,    A42112 02560021
*0000458000,956000-960000                                        A42112 02570021
*0000164000,342000,510000,516000,518000,537000-538000,586000,    M0115  02582021
*0000596000,598000-624000,750600,752000-762000,838000,           M0115  02584021
*0000846000-848000,852000,858000-870000                          M0115  02586021
*0000                                                            M2557  02596021
*0000                                                            A51461 02598021
*0000374500-376500,                                             A48649  02598121
*                                                                     * 02600021
* MODULE NAME = IFG0200V                                              * 02650002
*                                                                     * 02700002
* DESCRIPTIVE NAME = 2ND INITIAL LOAD AND DIRECT ACCESS STRING        * 02750002
*                                                                     * 02760002
* COPYRIGHT = NONE                                                    * 02770002
*                                                                     * 02780002
* STATUS CHANGE LEVEL 000                                             * 02800021
*                                                                     * 03000021
* FUNCTION -                                                          * 03200021
*    THIS MODULE CONTAINS THE FUNCTION(S) OR PART(S) OF FUNCTION(S)-- * 03400021
*    CLOSE INITIALIZATION FUNCTION.                                   * 03600021
*       THIS FUNCTION STARTS IN MODULE IGC00020.                      * 03800021
*    CLOSE DA READ DSCB FUNCTION.                                     * 04000021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)' FOR DETAILS.         * 04200021
*                                                                     * 04400021
* ENTRY POINTS -                                                      * 04600021
*         IFG0200V - ENTRY POINT VIA AN XCTL FROM THE FOLLOWING--     * 04800021
*             INITIAL ENTRY--                                         * 05000021
*                IGC00020 - CONTINUE PROCESSING INITIALIZATION        * 05200021
*                           FUNCTION.                                 * 05400021
*             SECOND ENTRY--                                          * 05600021
*                IFG0200P - PROCESS DA READ DSCB FUNCTION.            * 05800021
*                                                                     * 06000021
* INPUT -                                                             * 06200021
*    ENTERED IN DATA MANAGEMENT KEY                              Y02082 06250002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 06400021
*                                                                     * 06600021
* OUTPUT -                                                            * 06800021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 06850002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 07000021
*                                                                     * 07200021
* EXTERNAL REFERENCES -                                               * 07400021
*         IFG019RA - OPEN/CLOSE/EOV RESIDENT ROUTINE FOR XCTL AND     * 07600002
*                    WAIT.                                            * 07800021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 08000021
*                                                                     * 08200021
* EXITS, NORMAL -                                                     * 08400021
*    EXIT VIA THE RESIDENT ROUTINE XCTL TO THE FOLLOWING--            * 08600021
*         IFG0200W - PROCESS ACCESS METHOD EXECUTOR INTERFACE FUNCTION* 08800021
*         IFG0200T - IF VSAM ACB                                      * 08850002
*         IFG0200S - IF VSAM CI                                       * 08900002
*         IFG0200U - IF VTAM ACB                                      * 08950002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 09000021
*                                                                     * 09200021
* EXITS, ERROR -                                                      * 09400021
*    EXIT IS TO THE PROBLEM DETERMINATION MODULE IFG0200P, IF AN      * 09600021
*    ABEND SITUATION OCCURS IN THIS MODULE.  REFER TO THE FOLLOWING   * 09800021
*    'FUNCTION PROLOG(S)'.                                            * 10000021
*         IFG0202L - IF ERROR IN VSAM ACB                             * 10050002
*                                                                     * 10200021
* TABLES/WORK AREAS -                                                 * 10400021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 10600021
*                                                                     * 10800021
* ATTRIBUTES -                                                        * 11000021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 11200021
*                                                                     * 11400021
* CHARACTER CODE DEPENDENCY -                                         * 11600021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 11800021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 12000021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 12200021
*                                                                     * 12400021
* NOTES -                                                             * 12600021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 12800021
*                                                                     * 13000021
*********************************************************************** 13200021
         EJECT                                                          13400021
         USING IHADCB,RDCB                                              13600021
         USING FORCORE,RCORE                                            13800021
         USING TCB,RET                                                  14000021
         USING UCBOB,RUCB                                               14200021
         USING CVT,RD                                                   14400021
         USING TIOENTRY,RTIOT                                           14600021
         USING DEB,RDEB                                                 14800021
         USING WTG,RWTG                                                 15000021
         USING WTGENTRY,RWTGC                                           15200021
         BALR  RBASE,0                  ESTABLISH BASE REGISTER         15400021
         USING *,RBASE                                                  15600021
         B     CIN01900(RET)            USE BRANCH TABLE                15800021
CIN01900 EQU   *                                                        16000021
         B     CIN02000                 ENTRY FROM INITIAL LOAD         16200021
         B     CIN03600                 FROM P. D. MOD/READ DSCB  M0115 16400021
         EJECT                                                          16600021
*                                                                     * 16800021
*                          FUNCTION PROLOG                            * 17000021
*                                                                     * 17200021
*********************************************************************** 17400021
*                                                                     * 17600021
* FUNCTION NAME -                                                     * 17800021
*    CLOSE INITIALIZATION FUNCTION.                                   * 18000021
*                                                                     * 18200021
* (STATUS) -                                                          * 18400021
*    NOT APPLICABLE                                                   * 18600021
*                                                                     * 18800021
* FUNCTION -                                                          * 19000021
*    DETERMINE WHICH STRING IS TO CONTINUE PROCESSING.                * 20600021
*    MOVE JFCB INTO THE WORKAREA.                                     * 21000002
*    OBTAIN MAIN STORAGE FOR THE ECBLIST.                             * 21200021
*    INTERFACE WITH THE TRACE INITIALIZATION FUNCTION IF OPTIONAL     * 21400021
*    TRACE FACILITY IS REQUESTED.                                     * 21600021
*    DETERMINE IF SMF DATA SET INFORMATION IS REQUESTED.              * 21700021
*                                                                     * 21800021
* ENTRY POINTS -                                                      * 22000021
*    ENTERED FROM THE FOLLOWING--                                     * 22200021
*    WHEN AN SVC 20 OR A CLOSE MACRO-INSTRUCTION IS ISSUED.           * 22400021
*                                                                     * 22600021
* INPUT -                                                             * 22800021
*    A POINTER IN REGISTER 1 TO THE PARAMETER LIST.                   * 23000021
*                                                                     * 23200021
* OUTPUT -                                                            * 23400021
*    A POINTER TO EACH OF THE FOLLOWING--                             * 23600021
*       CURRENT PARAMETER LIST ENTRY- RPARC                           * 23800021
*       DD ENTRY IN THE TIOT- RTIOT                                   * 24000021
*       WTG TABLE- RWTG                                               * 24200021
*       CURRENT WTG TABLE ENTRY- RWTGC                                * 24400021
*       DCB- RDCB                                                     * 24600021
*       WORK AREA- RCORE                                              * 24800021
*       RESIDENT ROUTINE- RES                                         * 25000021
*       UCB- RUCB                                                     * 25200021
*       DEB- RDEB                                                     * 25400021
*    THE JFCB IS IN THE WORKAREA.                                     * 25600021
*                                                                     * 25800021
* EXTERNAL REFERENCES -                                               * 26000021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 26200021
*                                                                     * 26600021
* EXITS, NORMAL -                                                     * 26800021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 27000021
*    CLOSE TAPE ACCESS METHOD EXECUTOR INTERFACE FUNCTION.            * 27200021
*    CLOSE UNIT RECORD/TELEPROCESSING FUNCTION.                       * 27400021
*    CLOSE DA READ DSCB FUNCTION.                                     * 27600021
*                                                                     * 27800021
* EXITS, ERROR -                                                      * 28000021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 28200021
*    EXIT WITH ONE OF THE FOLLOWING INTERNAL CODES--                  * 28400021
*       112 -           - INVALID CONTROL BLOCK(S) FOUND.             * 28800021
*                                                                     * 29000021
* TABLES/WORK AREAS -                                                 * 29200021
*    THE OPEN, CLOSE, OR EOV WORK AREA AND THE WHERE-TO-GO (WTG)      * 29400021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 29600021
*                                                                     * 29800021
* ATTRIBUTES -                                                        * 30000021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 30200021
*                                                                     * 30400021
* CHARACTER CODE DEPENDENCY -                                         * 30600021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 30800021
*                                                                     * 31000021
* NOTES -                                                             * 31200021
*    NOT APPLICABLE                                                   * 31400021
*                                                                     * 31600021
*********************************************************************** 31800021
         EJECT                                                          32000021
CIN02000 EQU   *                                                        32200021
         L     RPAR,WTGPREFX            GET ADDR BASE PREFX      Y02080 32250002
         L     RPAR,IECUPRML-IECPREFX(,RPAR) ADDR PROT PARM LIST Y02080 32300002
         LR    RPARC,RPAR               SET UP PARM LIST                32400021
         LA    RWTGC,WTGENTRY-WTG(,RWTG)  INITIALIZE CURR WTG POINTER   32600021
CIN02100 EQU   *                                                        33000021
         L     RDCB,PLISTDCB(,RPARC)    GET DCB ADDR                    33200021
         L     RCORE,WTGCORE-1          GET WORKAREA ADDR               33400021
         LA    RCORE,0(RCORE)           CLEAR HIGH ORDER BYTE           33600021
         LTR   RCORE,RCORE              IS WORKAREA PRESENT             33800021
         BZ    CIN02800                 NO, GO CHECK LAST ENTRY         34000021
         LM    RTIOT,RET,DXREG9         RESTORE REG 9 THRU 14    Y02080 34010002
         MVC   WTGIDTTR,DXRETMOD        SET NEXT MODULE          Y02080 34050002
         CLC   WTGIDTTR(K2),PDMOD       WAS ERROR DETECTED       M0115  34200021
         BNE   CIN02102                 NO PROCESSING FOR P.D    Y02080 34400002
         MVC   DXRETMOD,EXITMOD         SET RET FROM P.D.        Y02080 34500002
         MVI   DXRETCOD,K4              RET TO 202L OFFSET       Y02080 34502002
         MVC   DXCALLID,INITMOD         SET 0V AS CALLING MOD    YM6507 34504002
         B     CIN02800                 PROC NEXT ENTRY          Y02080 34510002
CIN02102 EQU   *                        TEST FOR JES ACB         Y02080 34550002
*   TEST IF JES ACB                                                     34820000
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP           34830000
         BO    CIN02110                 YES,GO CHECK FOR SPOOLED DCB    34840000
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB         34850000
         BZ    CIN02110                 NO, GO TO DCB PROCESSING        34860000
         USING IFGACB,RDCB              SET BASE FOR ACB         X02989 34860402
*                                                                Y02004 34864802
* DO NOT READ JFCB FOR VTAM ACB                                  Y02004 34865202
*                                                                Y02004 34865602
         CLI   ACBAMETH,ACBVTAM         IS ACB FOR VTAM?         YM3011 34866002
         BE    CIN02550                 BR IF YES                Y02004 34866102
*                                                                Y02004 34866202
         CLI   ACBAMETH,ACBVSAM         IS ACB FOR VSAM          X02989 34866302
         BNE   CIN02105                 BR IF NO                 X02989 34868102
         TM    ACBINFL,ACBCAT+ACBSCRA+ACBUCRA  VSAM CATLG/CRA? @Y30DSDT 34870237
         BZ    CIN02300                 BR IF NO               @Y30DSDT 34872037
         TM    DXECB,ECBNOERR           TEST FOR READ JFCB ERROR X02989 34875602
         BO    CIN02405                 BR IF NO ERROR           Y02080 34877402
         B     CIN02410                 PROC BAD JFCB            Y02080 34879402
         USING IHADCB,RDCB              REDEFINE BASE TO DCB     X02989 34882802
CIN02105 EQU   *                        TEST FOR SPOOLING        X02989 34884602
         TM    TIOELINK,TIOTSPOL        SPOOLED DATA SET         Y02120 34886402
         BM    CIN02200                 YES READ JFCB            Y02120 34888202
         B     CIN02550                 NO, SKIP READ JFCB       Y02080 34890002
*   IS CONTROL BLOCK A SPOOLEED DCB                                     34900000
CIN02110 TM    TIOELINK,TIOTSPOL        SPOOLED DATA SET         Y02120 34910002
         BM    CIN02200                 YES, BYPASS READ JFCB    Y02120 34920002
*                                                                       34930000
         LTR   RUCB,RUCB                TEST FOR NULL DATA SET          35000021
         BZ    CIN02550                 BRANCH IF YES            Y02080 35200002
CIN02200 EQU   *                                                        37400021
         TM    DEBOPATB,DEBOPOUT        IS IT OPEN FOR INPUT     A48649 37410000
         BNZ   CIN02250                 BRANCH IF NOT            A48649 37420000
         NI    DCBOFLGS,TRLRFLG         TURN OFF TRAILER SWITCH  A48649 37430000
CIN02250 EQU   *                        TEST FOR SYSTEM TASK     A48649 37440002
         CLC   TIOEJFCB(K3),ZEROS       IS THIS SYSTEM TASK             37950000
         BE    CIN02550                 BR YES,DO NOT READ JFCB  Y02080 38000002
CIN02300 EQU   *                        READ JFCB                Y02080 38010002
*                                                                Y02080 38050002
*        READ JFCB                                               Y02080 38100002
*                                                                Y02080 38200002
         LA    RET,TIOEJFCB             PT TO JFCB ADDR          Y02080 38250002
         IECRES LOCJFCB,(RET)           GET ADDR JFCB            Y02080 38300002
         MVC   DXJBF,0(RET)             MOVE JFCB TO WORK AREA   Y02080 38350002
         MVI   DXECB,K32                SET NO ERROR             Y02080 38400002
         TM    JFCBMASK+K6,JFCTRACE     IS TRACE ROUTINE DESIRED?Y02080 38450002
         BZ    CIN02405                 NO,CONTINUE PROCESSING   Y02080 38500002
         OI    WTGPATHS+K1,WTGTRACE     YES, TURN ON TRACE INDR  Y02080 38550002
CIN02405 EQU   *                        CONTINUE                 X02989 50502002
         OI    JFCBMASK+K4,JFCMJMOD     INDICATE JFCB READ       Y02120 50522002
         TM    JFCDSRG2,JFCORGAM        IS DATA SET VSAM         X02989 50532002
         BNO   CIN02500                 BRANCH IF NO             XM1037 50542002
         TM    DEBFLGS1,DEBCIFLG        IS THIS ISAM INTERFACE   XM1037 50544002
         BO    CIN02500                 BRANCH IF YES            XM1037 50546002
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    XM1037 50548002
         BO    CIN02407                 BR IF YES, NOT ACB       XM1037 50548402
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  XM1037 50548802
         BNO   CIN02407                 BRANCH IF NO             XM1037 50549202
         CLI   ACBAMETH-IFGACB(RDCB),ACBVSAM IS ACB FOR VSAM     Y02134 50549602
         BE    CIN02500                 BR TO NEXT ENTRY         Y02134 50549702
CIN02407 EQU   *                        RESET VSAM BIT           X02989 50549802
         NI    JFCDSRG2,ALLBITS-JFCORGAM RESET VSAM BIT IN JFCB  XM1037 50549902
         B     CIN02500                 PROCESS TAPE OR D.A.            50550000
CIN02410 EQU   *                                                        50560000
         XC    DXJBF,DXJBF              CLEAR JFCB AREA                 50600021
         LA    R0,CABD111               ERR- READ JFCB                  50800021
*                                                                X02989 50860002
*  IF VSAM ACB, SET ACB ERROR FLAGS                              X02989 50870002
*                                                                X02989 50880002
         USING IFGACB,RDCB              DEFINE BASE FOR ACB      X02989 50980002
         MVI   ACBERFLG,VSOJFBER        SET READ JFCB ERROR FLAG X02989 50994002
         MVI   JFCDSRG2,JFCORGAM        SET VSAM DATA ORG FLAG   X02989 50996002
         LA    RET,DXIOB                LD ADDR OF WORK AREA     XM1037 50996402
         USING IDAPDPRM,RET             SET BASE FOR PARM LIST   XM1037 50996802
         XC    IDAPDPRM(PDPLNGTH),IDAPDPRM ZERO PARAMETER LIST   X02989 50997202
         MVI   PDPCALL,PDPCLOSE         INDICATE CALLER          X02989 50997602
         MVI   PDPCODE,VSJFBERR         SET INTERNAL ERROR CODE  X02989 50997702
         MVI   PDPFUNC,VSCLOSE          LD FUNCTION CODE         X02989 50998202
         ST    RDCB,PDPACB              LD ADDR OF ACB           X02989 50998602
         ST    RTIOT,PDPTIOT            LD ADDR OF TIOT ENTRY    X02989 50999002
         LR    R1,RCORE                 LD PTR TO WORK AREA      X02989 51045502
         IECRES LOAD,BRANCH=NO,PREFIX=WTGPREFX,MODNM=VSPDMOD     Y02080X51045902
                                        LOAD VSAM P.D. MOD       Y02080 51046302
         L     RF,WTGMODEP              GET EPA                  Y02080 51046702
         XC    WTGMODEP,WTGMODEP        CLEAR NEXT MOD ADDR      Y02080 51046802
         BALR  RET,RF                   BR TO VSAM PD ROUTINE    X02989 51047102
         MVI   JFCDSRG2,JFCORGAM        SET VSAM INDICATOR       X02989 51047902
         NI    ACBOFLGS,X'FF'-DCBOBUSY  TURN OFF BUSY BIT        X02989 51048302
         USING IHADCB,RDCB              REDEFINE BASE TO DCB     X02989 51048802
         USING TCB,RET                                           XM1037 51098802
         MVC   WTGIDTTR,EXITMOD         LD ID TTR OF EXIT MOD    X02989 51099202
         LA    RET,K4                   P.D. ENTRY TO LAST LOAD  Y02080 51099602
         ST    RET,DXREGE               SET FOR P.D.             Y02080 51103202
         B     CIN02800                 BR TO GET NEXT ENTRY     X02989 51109202
CIN02500 EQU   *                                                        52000021
         TM    JFCBMASK+K6,JFCTRACE     OPTIONAL TRACE FACILITY         52400021
         BZ    CIN02550                 BRANCH IF NOT            A38013 52600021
         OI    WTGPATHS+K1,WTGTRACE     IND. OPTIONAL TRACE             52800021
CIN02550 EQU   *                        TEST FOR SMF             A38013 52810002
         L     RD,CVTPTR                GET CVT ADDR             YM3055 52814000
         L     RF,CVTSMCA               GET ADDR OF SMCA         A38013 52820021
         LTR   RF,RF                    TEST FOR AN SMF SYSTEM   A38013 52830021
         BZ    CIN02600                 BRANCH IF NO             A38013 52840021
         USING SMCABASE,RF                                       A38013 52850021
         TM    SMCAOPT,SMCADSA          IS DS INFO DESIRED       A38013 52860021
         BNO   CIN02600                 BRANCH IF NO             A38013 52870021
         TM    SMCAMISC,SMCAUSER+SMCAMAN  SYS1.MAN RECORD NEEDED A38013 52880021
         BNO   CIN02600                 BRANCH IF NO             A38013 52890021
         DROP  RF                                                A38013 52900021
         L     RET,DXTCBADR             CURRENT TCB ADDR         Y02080 52902002
         L     RF,TCBTCT                GET PTR TO TCT           A38013 52910021
         LA    RF,0(RF)                 CLEAR HIGH ORDER BYTE  @ZA07590 52915037
         LTR   RF,RF                    TEST FOR TCT             A38013 52920021
         BZ    CIN02600                 BRANCH IF NO TCT         A38013 52930021
         OI    WTGPATHS,WTGSMF          IND. SMF REQUESTED       A38013 52940021
CIN02600 EQU   *                                                        53000021
         XR    RET,RET                  SET INIT ENTRY TO MOD    Y02080 53050002
         TM    DCBMACRF,DCBMEXCP        CHK IF EXCP              Y02080 53150002
         BO    CIN02620                 BY - YES                 Y02080 53200002
         TM    DCBDSORG+K1,ACBDORGA     CHK IF ACB               Y02080 53250002
         BNO   CIN02620                 NO THEN BR PROC DCB      Y02080 53300002
         USING IFGACB,RDCB              EST ACB ADDRESSABILITY   Y02080 53350002
         LA    RF,VSAMMOD               VSAM MODULE              Y02080 53400002
         CLI   ACBAMETH,ACBVSAM         CHK IF VSAM ACB          Y02080 53450002
         BNZ   CIN02610                 NO,CHECK FOR VTAM      @ZA06778 53500037
         OI    JFCDSRG2,JFCORGAM        INDICATE VSAM IN JFCB  @ZA06778 53520037
         B     CIN02700                 SET NEXT MODULE        @ZA06778 53540037
CIN02610 LA    RF,VTAMMOD               VTAM STRING            @ZA06778 53560037
         CLI   ACBAMETH,ACBVTAM         VTAM ACB?                YM3011 53600002
         BE    CIN02700                 Y - SET NEXT MOD         Y02080 53650002
         USING IHADCB,RDCB              EST DCB ADDRESSABILITY   Y02080 53700002
CIN02620 EQU   *                        TEST FOR SPOOLING        Y02080 53750002
         LA    RET,K8                   OFFSET FOR SPOOLED D.S.  Y02080 53800002
         LA    RF,AMMOD                 NORMAL A.M. MODULE       Y02080 53850002
         TM    TIOELINK,TIOTSPOL        CHK IF SPOOLED D.S.      Y02080 53900002
         BM    CIN02700                 Y - SET NEXT MOD         Y02080 53950002
         SPACE 1                                                 Y02080 53960002
* SINCE IT'S NOT A SUBSYSTEM CI IT MUST BE AN ISAM - CI          Y02080 53960402
         XR    RET,RET                  SET INIT ENTRY           Y02080 53962002
         LA    RF,VSIIMOD               ISAM - CI MOD            Y02080 53970002
         TM    DEBFLGS1,DEBCIFLG        CHK IF ISAM CI           Y02080 53980002
         BO    CIN02700                 Y - SET NEXT MOD         Y02080 53990002
         SPACE 1                                                 Y02080 53992002
         LA    RF,AMMOD                 NORMAL A.M. MODULE       Y02080 54042002
         LTR   RUCB,RUCB                DUMMY DATA SET?          Y02080 54100002
         BZ    CIN02700                 Y - SET NEXT MOD         Y02080 54150002
         SPACE 1                                                 Y02080 54200002
         TM    UCBTBYT3,UCB3DACC        CHK IF DA                Y02080 54250002
         BNO   CIN02700                 NO - SET MOD 200W        Y02080 54300002
         LA    RET,K4                   SET OFFSET ENTRY         Y02080 54350002
         LA    RF,INITMOD               SET THIS MOD AS NEXT     Y02080 54360002
CIN02700 EQU   *                        SET WTG TABLE ID         Y02080 54370002
         MVC   WTGIDTTR,0(RF)           SET NEXT MOD FOR ENTRY   Y02080 54380002
         STM   R0,R1,DXREG0             SAVE REGS 0-1            Y02080 54390002
         STM   RTIOT,RET,DXREGSAV       SAVE REGS 9-14           Y02080 54392002
CIN02800 EQU   *                                                        54400021
         TM    PLISTOPT(RPARC),LASTNTRY  CK LAST ENTRY ON LIST          54600021
         LA    RWTGC,K8(,RWTGC)         NEXT WTG ENTRY                  54800021
         BO    CIN02900                 BRANCH IF LAST ENTRY            55000021
         LA    RPARC,K4(,RPARC)         NEXT DCB ENTRY                  55200021
         B     CIN02100                 BRANCH TO NEXT ENTRY            55400021
CIN02900 EQU   *                                                        55600021
         L     RES,K4(RWTGC)            LOAD RES TO POINT TO RES. RTN   58200021
         L     RPARC,WTGPREFX           GET ADDRESS OF PREFIX    Y02080 58352002
         USING IECPREFX,RPARC                                    Y02080 58354002
         L     RPARC,IECUPRML           GET MOVED PARM LIST PTR  Y02080 58356002
         USING USERPRML,RPARC                                    Y02080 58358002
         LA    RWTGC,WTGENTRY-WTG(,RWTG)  INITIALIZE WTG ENTRY ADDR     58360021
CIN03300 EQU   *                                                        58370021
         L     RCORE,WTGCORE-1          GET WORK AREA ADDR              58380021
         LA    RCORE,0(RCORE)           CLEAR HIGH ORDER BYTE           58390021
         LTR   RCORE,RCORE              WORK AREA ADDR PRESENT          58392021
         BNZ   CIN03400                 BRANCH IF YES            M0115  58394421
         LA    RWTGC,K8(,RWTGC)         GET NEXT ENTRY           M0115  58394821
         B     CIN03300                 LOOP BACK TO CHECK NEXT ENTRY   58394921
CIN03400 EQU   *                                                        58395221
         LM    RTIOT,RET,DXREGSAV       RELOAD REG 9 THRU 14     M0115  58396021
         LM    R0,R1,DXREG0             RELOAD REG 0 AND 1       M0115  58398021
         TM    WTGPATHS+K1,WTGTRACE     OPTIONAL TRACE ON               58400021
         BZ    CIN04100                 BRANCH IF NO TO XCTL     M0115  58600021
         XC    DXDSCB,DXDSCB            CLEAR WORKAREA           M0115  59500021
         XC    DXCCW12,DXCCW12          CLEAR TEMP SAVE AREA     M0115  59560021
         B     CIN04100                 BRANCH TO PROCESS        M0115  59592021
*                                                     SERIALLY   M0115  59642021
         EJECT                                                          63000021
*                                                                     * 63200021
*                          FUNCTION PROLOG                            * 63400021
*                                                                     * 63600021
*********************************************************************** 63800021
*                                                                     * 64000021
* FUNCTION NAME -                                                     * 64200021
*    CLOSE DA READ DSCB FUNCTION.                                     * 64400021
*                                                                     * 64600021
* (STATUS) -                                                          * 64800021
*    NOT APPLICABLE                                                   * 65000021
*                                                                     * 65200021
* FUNCTION -                                                          * 65400021
*    READ DSCB INTO THE WORKAREA FOR OUTPUT AND USER LABEL PROCESSING.* 65600021
*                                                                     * 65800021
* ENTRY POINTS -                                                      * 66000021
*    ENTERED FROM THE FOLLOWING--                                     * 66200021
*    CLOSE INITIALIZATION FUNCTION.                                   * 66400021
*                                                                     * 66600021
* INPUT -                                                             * 66800021
*    A POINTER TO EACH OF THE FOLLOWING--                             * 67000021
*       CURRENT PARAMETER LIST ENTRY- RPARC                           * 67200021
*       DD ENTRY IN THE TIOT- RTIOT                                   * 67400021
*       WTG TABLE- RWTG                                               * 67600021
*       CURRENT WTG TABLE ENTRY- RWTGC                                * 67800021
*       DCB- RDCB                                                     * 68000021
*       WORK AREA- RCORE                                              * 68200021
*       RESIDENT ROUTINE- RES                                         * 68400021
*       UCB- RUCB                                                     * 68600021
*       DEB- RDEB                                                     * 68800021
*                                                                     * 69000021
* OUTPUT -                                                            * 69200021
*    THE DSCB IS IN THE WORKAREA.                                     * 69400021
*                                                                     * 69600021
* EXTERNAL REFERENCES -                                               * 69800021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 70000021
*                                                                     * 70200021
* EXITS, NORMAL -                                                     * 70400021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 70600021
*    CLOSE DA ACCESS METHOD EXECUTOR INTERFACE FUNCTION.              * 70800021
*                                                                     * 71000021
* EXITS, ERROR -                                                      * 71200021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 71400021
*    EXIT WITH ONE OF THE FOLLOWING INTERNAL CODES--                  * 71600021
*       86 - 314 ABEND - I/O ERROR READING DSCB.                      * 71800021
*                                                                     * 72000021
* TABLES/WORK AREAS -                                                 * 72200021
*    THE OPEN, CLOSE, OR EOV WORK AREA AND THE WHERE-TO-GO (WTG)      * 72400021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 72600021
*                                                                     * 72800021
* ATTRIBUTES -                                                        * 73000021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 73200021
*                                                                     * 73400021
* CHARACTER CODE DEPENDENCY -                                         * 73600021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 73800021
*                                                                     * 74000021
* NOTES -                                                             * 74200021
*    NOT APPLICABLE                                                   * 74400021
*                                                                     * 74600021
*********************************************************************** 74800021
         EJECT                                                          75000021
CIN03600 EQU   *                        READ DSCB                M0115  75110002
         MVI   DXECB,ECBCOD7F           SET ERROR IND. OFF       A38013 75112037
         TM    DCBMACRF,DCBMEXCP        IS IT EXCP             @ZA10537 75412037
         BZ    CIN03800                 BRANCH IF NOT EXCP     @ZA10537 75712037
         TM    TIOELINK,TIOTSPOL        CHECK IF SUBSYS        @ZA10537 76012037
         BM    CIN04000                 Y- DON'T READ DSCB     @ZA10537 76312037
         TM    DEBOFLGS,K16             IS RELEASE SPECIFIED   @ZA10537 76612037
         BO    CIN03800                 YES READ DSCB          @ZA10537 76912037
         TM    DCBMCRF1,DCBMDEV       TEST FOR DA DEV DEP SECT @ZA10537 77212037
         BZ    CIN04000                 BRANCH IF NOT PRESENT  @ZA10537 77512037
*                                                              @ZA10537 77812037
CIN03800 EQU   *                                               @ZA10537 78112037
         LA    RUCB,0(,RUCB)            CLEAR HI ORDER BYTE             79200021
         ST    RUCB,DXDEBUCB            WORK AREA DEB TO PROPER UNIT    79400021
         MVC   DXDEBBIN,ACCW3C          ZERO BB                  M0171  79800021
CIN03900 EQU   *                                                        81200021
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 81220002
         BNO   CIN03925                 BR IF NOT                Y02132 81240002
*        READ VIO DSCB FROM SWA                                  Y02132 81260002
         MVC   DXDSCB(DSCEXT2-DSCFMTID),VDSDSCB-VDSUCB+L'JFCBDSNM(RUCB) 81280002
*                                                                Y02132 81300002
         OC    DXDSCB(DSCEXT2-DSCFMTID),DXDSCB IS DSCB ZERO?     Y02132 81320002
         BZ    CIN03935                 BR IF YES, I/O ERROR     Y02132 81340002
*                                                                Y02132 81360002
         XC    DSCEXT2(DSCBEND-DSCEXT2),DSCEXT2 ZERO REMAIN CORE Y02132 81380002
*                                                                Y02132 81400002
         B     CIN03950                 RESUME PROCESSING        Y02132 81420002
CIN03925 EQU   *                        READ DSCB                Y02132 81440002
         STM   RC,RD,DXREGC             SAVE REG.                       81600021
         LR    RC,RDEB                  USE RC FOR WORK REG.     A38013 81800021
         LA    RF,K16                   DISPLACEMENT FACTOR             82000021
         SR    RC,RF                    DISPLACE TO BEGIN OF DEB        82200021
         MVC   DXDAADDR+K1(K7),K1(RC)   MOVE DISK ADDR INTO DXDAADDR    82400021
         BAL   RC,CIN04200              BUILD CHANNEL PROGRAM           82600021
         LM    RC,RD,DXREGC             RESTORE ECBLIST SIZE COUNTER    82800021
         LA    RF,DXDSCB                GET ADDR OF AREA TO READ DSCB   83000021
         ST    RF,DXCCW3                STORE IN CCW                    83200021
         MVI   DXCCW3,CCWMTRD           READ DATA                       83400021
         EXCP  DXIOB                    READ DSCB                       83600021
         IECRES WAIT                    WAIT FOR DSCB            M0115  83800021
         TM    DXECB,ECBNOERR           PERM I/O ERROR                  84000021
         MVC   WTGIDTTR,AMMOD           ID TTR OF A. M. MODULE   M0115  84050021
         BO    CIN03950                 BR IF NO PERM I/O ERROR  Y02144 84200002
CIN03935 EQU   *                        ERROR IN READ DSCB       Y02132 84220002
         LA    R0,CABD086               ERR- READ DSCB                  84400021
         LA    RET,K4                   SET UP FOR BRANCH TABLE  M0115  84450021
         DMABCOND (0),PDMOD,RETURN=AMMOD  ABEND MACRO            M0115  84600021
CIN03950 EQU   *                        SET AUDIT INDICATORS     Y02144 84650002
         OI    DXATDACC,DXATRDDB        DSCB READ                Y02144 84700002
CIN04000 EQU   *                                                        85000021
         LA    RET,K4                   SET UP FOR BRANCH TABLE  M0115  85050021
         MVC   WTGIDTTR,AMMOD           ID TTR OF A. M. MOD.            85200021
CIN04100 EQU   *                                                        85400021
*                                                                       85498402
         IECRES LOAD,BRANCH=QUEUED      XCTL TO RESIDENT ROUTINE Y02080 85500002
         EJECT                                                          87200021
         SPACE 1                                                        87400021
**********                  MACRO                            ********** 87600021
*                                                                     * 87800021
         SPACE 1                                                        88000021
*          CLOSED SUBROUTINE TO SET UP A CHANNEL PROGRAM                88200021
*           TO READ A DIRECT ACCESS DEVICE JFCB OR DSCB                 88400021
*                                                                       88600021
*        ENTRY TO THE ROUTINE IS AS FOLLOWS-                            88800021
*           BAL   RC,CIN04200                                           89000021
*        RETURN TO THE CALLING ROUTINE TAKES PLACE AS FOLLOWS-          89200021
*           BR    RC                                                    89400021
*                                                                       89600021
*        CHANNEL CONTROL WORDS ARE SET UP AS FOLLOWS-                   89800021
*          CCW1  SEARCH = ID   ADDR OF CCHHR  COMM CHAIN  5 CHAR        90000021
*          CCW2  TIC           ADDR OF CCW1   COMM CHAIN                90200021
*          CCW3  READ DATA     ADDR OF DSCB               LEN DSCB      90400021
         SPACE 1                                                        90600021
CIN04200 EQU   *                                                        90800021
         LA    RD,DXDAADDR+K3           PLACE ADDRESS OF CCHHR INTO     91000021
         ST    RD,DXCCW1                FIRST CCW                       91200021
         LA    RD,DXCCW1                PLACE ADDRESS OF SEARCH CCW     91400021
         ST    RD,DXCCW2                INTO TIC CCW                    91600021
         MVI   DXCCW1,CCWSCHID          SEARCH FOR EQUAL ID OP CODE     91800021
         MVC   DXCCW1+K4(K5),ACCW1C     COMMAND CHAIN, 5 CHAR, TIC OP   92000021
         MVC   DXCCW2+K4(K5),ACCW2C     COMMAND CHAIN,READ DATA OP CODE 92200021
         MVC   DXCCW3+K4(K4),ACCW3C     LENGTH OF THE DSCB              92400021
         BR    RC                       RETURN TO CALLER OF SUBROUTINE  92600021
         SPACE 1                                                        92800021
*                                                                     * 93000021
**********                                                   ********** 93200021
         EJECT                                                          93400021
         SPACE 1                                                        93600021
*********************************************************************** 93800021
*                                                                     * 94000021
*                       CONSTANTS                                     * 94200021
*                                                                     * 94400021
*********************************************************************** 94600021
         SPACE 1                                                        94800021
ZEROS    DC    3X'00'                   3 BYTE OF ZEROS                 94900000
ACCW1C   DC    X'6000000508'            COMM CHAIN,SILI,5 CHAR,TIC OP   95000021
ACCW2C   DC    X'4000000086'            COMMAND CHAIN,READ DATA OP CODE 95200021
ACCW3C   DC    X'00000060'              96 CHARACTERS                   95400021
*                                                                       95700021
         XCTLTABL ID=(PDMOD,0P,AMMOD,0W,VTAMMOD,0U,EXITMOD,2L,   Y02080X96200002
               VSPDMOD,IDA0192P,VSAMMOD,0T,VSIIMOD,0S,           Y02080X96210002
               INITMOD,0V),SVC=020,BRT=YES,LENGTH=               Y02080 96210402
         IDDVDSCB                                                Y02132 96231002
TIOTSPOL EQU   X'06'                                                    96245000
ACBMJEP  EQU   X'40'                                                    96254000
TIOTSPOT EQU   X'02'                                                    96263000
*                                                                       96272000
*                                                                       96281000
         IECDSECS CVT,TCB,TIOT,DCB,DEB,UCB,MAIN,WTG,SMF,PREFX,   Y02080*96283002
               ACB,IDAPDPRM,RRPL,EXPAND=YES                      Y02144 96285002
QM0YWRK  EQU   400                      QMNGRIO WORK AREA SIZE          96660000
QM0YREG  EQU   324                      OFFSET TO QM REG SAVE AREA      96680000
         IECEQU  AOS=YES                                                96700000
         END                                                            96800021
