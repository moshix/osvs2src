         TITLE 'IFG0201R - DIRECT ACCESS OUTPUT USER LABEL STRING'      00100002
IFG0201R CSECT                                                          00400021
*********************************************************************** 00500021
*                                                                     * 00600021
*                                                                     * 00700021
*          RELEASE 21.7 DELETIONS/CHANGES                               01150002
*0000049000,088104,088144,088264,088507-088517,088531-088535,   SA53753 01160002
*0000088540,088800-089160                                       SA53753 01170002
*          RELEASE 21 DELETIONS/CHANGES                               * 01200021
*0000088512,088533-088544,088800,088848                          M0194  01205021
*0000088536,088816                                               M0155  01210021
*0000018000,024000,026000,028000-029000,046000,084000-086000,    A38013 01220021
*0000126000-134000,197000,200000,208000,211000,220000-361000,    A38013 01240021
*0000520000,533000-540000,551000-552000                          A38013 01260021
*000089677-089715                                                M2554  01270021
*                                                                     * 01300021
* MODULE NAME = IFG0201R                                              * 01350002
*                                                                     * 01360002
* DESCRIPTIVE NAME = DIRECT ACCESS OUTPUT USER LABEL STRING           * 01370002
*                                                                     * 01380002
* COPYRIGHT = NONE                                                    * 01390002
*                                                                     * 01392002
* STATUS CHANGE LEVEL 000                                             * 01400021
*                                                                     * 01500021
* FUNCTION -                                                          * 01600021
*    THIS MODULE CONTAINS THE FUNCTION(S) OR PART(S) OF FUNCTION(S)-- * 01700021
*    CLOSE DA WRITE DSCB FUNCTION.                                    * 01760021
*    CLOSE DA OUTPUT USER LABELS FUNCTION.                            * 01820021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)' FOR DETAILS.         * 01900021
*                                                                     * 02000021
* ENTRY POINTS -                                                      * 02100021
*         IFG0201R - ENTRY POINT VIA AN XCTL FROM THE FOLLOWING--     * 02200021
*             INITIAL ENTRY--                                         * 02300021
*                IFG0200Y - PROCESS WRITE DSCB FUNCTION.              * 02400021
*             SECOND ENTRY--                                          * 02500021
*                IFG0200P - PROCESS OUTPUT USER LABELS FUNCTION.      * 02600021
*             THIRD ENTRY--                                           * 02700021
*                IFG0200P - CONTINUE PROCESSING OUTPUT USER LABELS    * 03000021
*                           FUNCTION.                                 * 03100021
*                                                                     * 03200021
* INPUT -                                                             * 03300021
*    ENTERED IN DATA MANAGEMENT KEY                              Y02082 03350002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 03400021
*                                                                     * 03500021
* OUTPUT -                                                            * 03600021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 03650002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 03700021
*                                                                     * 03800021
* EXTERNAL REFERENCES -                                               * 03900021
*         IFG019RA - OPEN/CLOSE/EOV RESIDENT ROUTINE FOR XCTL AND     * 04000002
*                    WAIT.                                            * 04100021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 04200021
*                                                                     * 04300021
* EXITS, NORMAL -                                                     * 04400021
*    EXIT VIA THE RESIDENT ROUTINE XCTL TO THE FOLLOWING--            * 04500021
*         IFG0202D - CONTINUE PROCESSING CLOSE DA OUTPUT USER LABELS  * 04700021
*                    FUNCTION.                                        * 04800021
*         IFG0202E - PROCESS CLOSE DA WRITE FILE MARK FUNCTION        * 04900002
*                    AND INTERFACE WITH PARTIAL RELEASE.              * 04950002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 05000021
*                                                                     * 05100021
* EXITS, ERROR -                                                      * 05200021
*    EXIT IS TO THE PROBLEM DETERMINATION MODULE IFG0200P, IF AN      * 05300021
*    ABEND SITUATION OCCURS IN THIS MODULE.  REFER TO THE FOLLOWING   * 05400021
*    'FUNCTION PROLOG(S)'.                                            * 05500021
*                                                                     * 05600021
* TABLES/WORK AREAS -                                                 * 05700021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 05800021
*                                                                     * 05900021
* ATTRIBUTES -                                                        * 06000021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 06100021
*                                                                     * 06200021
* CHARACTER CODE DEPENDENCY -                                         * 06300021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 06400021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 06500021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 06600021
*                                                                     * 06700021
* NOTES -                                                             * 06800021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 06900021
*                                                                     * 07000021
*********************************************************************** 07100021
         EJECT                                                          07200021
         USING IHADCB,RDCB                                              07300021
         USING FORCORE,RCORE                                            07400021
         USING TCB,RET                                                  07500021
         USING UCBOB,RUCB                                               07600021
         USING CVT,RD                                                   07700021
         USING TIOENTRY,RTIOT                                           07800021
         USING DEB,RDEB                                                 07900021
         USING WTG,RWTG                                          A38013 07930021
         USING WTGENTRY,RWTGC                                    A38013 07960021
         BALR  RBASE,0                  ESTABLISH BASE REGISTER         08000021
         USING *,RBASE                                                  08100021
         B     CDA00100(RET)            USE BRANCH TABLE                08200021
CDA00100 EQU   *                                                        08300021
         B     CDA00200                 WRITE DSCB ENTRY         A38013 08400021
         B     CDA00240                 OUTPUT USER LABEL ENTRY  A38013 08500021
         B     CDA01900                 ENTRY FROM P.D. RTN             08700021
         EJECT                                                          08800021
*                                                                     * 08800821
*                          FUNCTION PROLOG                            * 08801621
*                                                                     * 08802421
*********************************************************************** 08803221
*                                                                     * 08804021
* FUNCTION NAME -                                                     * 08804821
*    CLOSE DA WRITE DSCB FUNCTION.                                    * 08805621
*                                                                     * 08806421
* (STATUS) -                                                          * 08807221
*    NOT APPLICABLE                                                   * 08808021
*                                                                     * 08808821
* FUNCTION -                                                          * 08809621
*    WRITE THE UPDATED FORMAT 1 DSCB UNLESS PARTIAL RELEASE IS        * 08810402
*    SPECIFIED.                                                       * 08810802
*                                                                     * 08811221
* ENTRY POINTS -                                                      * 08812021
*    ENTERED FROM THE FOLLOWING--                                     * 08812821
*    CLOSE DA UPDATE DSCB FUNCTION.                                   * 08813621
*                                                                     * 08815221
* INPUT -                                                             * 08816021
*    A POINTER TO EACH OF THE FOLLOWING--                             * 08816821
*       CURRENT PARAMETER LIST ENTRY- RPARC                           * 08817621
*       DD ENTRY IN THE TIOT- RTIOT                                   * 08818421
*       WTG TABLE- RWTG                                               * 08819221
*       CURRENT WTG TABLE ENTRY- RWTGC                                * 08820021
*       DCB- RDCB                                                     * 08820821
*       WORK AREA- RCORE                                              * 08821621
*       RESIDENT ROUTINE- RES                                         * 08822421
*       UCB- RUCB                                                     * 08823221
*       DEB- RDEB                                                     * 08824021
*                                                                     * 08824821
* OUTPUT -                                                            * 08825621
*    DSCB IS WRITTEN BACK UNLESS PARTIAL RELEASE IS SPECIFIED.        * 08826402
*                                                                     * 08827221
* EXTERNAL REFERENCES -                                               * 08828021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 08828821
*                                                                     * 08829621
* EXITS, NORMAL -                                                     * 08830421
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 08831221
*    CLOSE DA OUTPUT USER LABEL FUNCTION.                             * 08832021
*    CLOSE DA EXIT FUNCTION.                                          * 08832821
*                                                                     * 08833621
* EXITS, ERROR -                                                      * 08834421
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 08835221
*    EXIT WITH THE FOLLOWING INTERNAL CODES--                         * 08836021
*       88 - 414 ABEND - I/O ERROR WRITING DSCB.                      * 08836821
*                                                                     * 08837621
* TABLES/WORK AREAS -                                                 * 08838421
*    THE OPEN, CLOSE, OR EOV WORK AREA AND THE WHERE-TO-GO (WTG)      * 08839221
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 08840021
*                                                                     * 08840821
* ATTRIBUTES -                                                        * 08841621
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 08842421
*                                                                     * 08843221
* CHARACTER CODE DEPENDENCY -                                         * 08844021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 08844821
*                                                                     * 08845621
* NOTES -                                                             * 08846421
*    NOT APPLICABLE                                                   * 08847221
*                                                                     * 08848021
*********************************************************************** 08848821
         EJECT                                                          08849621
*                                                                       08850421
CDA00200 EQU   *                                                 A38013 08851800
         L     RDEB,DCBDEBAD            LOAD DEB ADDR FROM DCB   M0194  08852000
         L     RET,DXTCBADR             CVT ADDRESS             Y02134  08852902
*                                                                       08857802
*****    INITIALIZE CONTROL BLOCKS AND CHANNEL PROGRAM TO               08858402
*****    WRITE BACK THE FORMAT 1 DSCB                                   08859002
*                                                                       08859602
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 08860102
         BNO   CDA00210                 BR IF NOT                YM7029 08860202
*        WRITE VIO DSCB TO SWA                                   Y02132 08866202
*                                                                Y02132 08867402
         MODESET EXTKEY=SCHED           ASSUME SCHEDULER KEY     Y02132 08868602
         MVC   VDSDSCB-VDSUCB+L'JFCBDSNM(DSCEXT2-DSCFMTID,RUCB),DXDSCB  08869802
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02132 08871002
         B     CDA00220                 RESUME PROCESSING        Y02132 08872202
CDA00210 EQU   *                        NOT VIO                  YM7029 08872602
         TM    TCBFLG,TCBFA             IS ABEND BIT ON          YM7029 08873202
         BO    CDA00215                 BR IF YES TO WRITE       YM7029 08873602
*                                       BACK FORMAT 1 DSCB       YM7029 08874002
         TM    DEBOFLGS,DEBOFSPL        TEST IF SPLIT CYLIN      YM7029 08874402
         BO    CDA00215                 BR IF YES TO WRITE       YM7029 08874502
*                                       BACK FORMAT 1 DSCB       YM7029 08874702
         TM    DEBOFLGS,DEBOFRLS        TEST FOR PARTIAL RELEASE YM5761 08875202
         BO    CDA00220                 BRANCH IF YES (PARTIAL   YM5761 08875802
*                                       RELEASE WILL WRITE BACK  YM5761 08877002
*                                       THE FORMAT 1 DSCB)       YM5761 08878202
CDA00215 EQU   *                        SET UP CCW'S             YM7029 08878602
         LR    RC,RDEB                  USE RC FOR WORK REG      A38013 08879402
         LA    RF,K16                   DISPLACEMENT FACTOR TO   A38013 08880602
         SR    RC,RF                    POINT TO DSCB SEARCH     A38013 08881802
*                                       ADDR                     A38013 08883002
         MVC   DXDAADDR+1(K7),K1(RC)    BBCCHHR TO WORK AREA     A38013 08884202
         MVI   DXDAADDR,K0              SET M (EXTENT NO.) TO 0  A38013 08885402
         LA    RD,DXDAADDR+K3           PLACE ADDRESS OF CCHHR   A38013 08886602
*                                       INTO                     A38013 08887802
         ST    RD,DXCCW1                FIRST CCW                A38013 08889002
         LA    RD,DXCCW1                PLACE ADDRESS OF SEARCH  A38013 08890202
*                                       CCW                      A38013 08891402
         ST    RD,DXCCW2                INTO TIC CCW             A38013 08892602
         MVI   DXCCW1,CCWSCHID          SEARCH FOR EQUAL ID OP   A38013 08893802
*                                       CODE                     A38013 08895002
         MVC   DXCCW1+K4(K5),ACCW1C     CC, 5 CHAR, TIC OP       A38013 08896202
         MVC   DXCCW2+K4(K5),ACCW2C     CC, READ DATA OP CODE    A38013 08897402
         MVC   DXCCW3+K4(K4),ACCW3C     LENGTH OF THE DSCB       A38013 08898602
         LA    RF,DXDSCB                BUFFER ADDRESS           A38013 08899802
         ST    RF,DXCCW3                STORE IN CCW             A38013 08901002
         MVI   DXCCW3,CCWWRTDA          WRITE DATA               A38013 08902202
         MVC   DXCCW4(K24),DXCCW1       EXTEND CP TO WRITE CHECK A38013 08903402
         LA    RF,DXCCW4                GET ADDR OF CCW4         A38013 08904602
         ST    RF,DXCCW5                TIC BACK TO CCW4         A38013 08905802
         MVI   DXCCW5,CCWTIC            RESTORE TIC OP           A38013 08907002
         MVI   DXCCW6,CCWRDDA           READ DATA OP             A38013 08908202
         OI    DXCCW3+K4,CCWCMDCH       TURN ON CC FLAG IN CCW3  A38013 08909402
         OI    DXCCW6+K4,X'10'          TURN ON SKIP FLAG IN     A38013 08910602
*                                       CCW6                     A38013 08911802
         MVI   DXDCBDEB,K0              CLEAR ERROR INDICATOR    A38013 08913002
*                                                                       08914202
******   WRITE BACK THE FORMAT 1 DSCB AND WAIT                          08915402
*                                                                       08916602
         EXCP  DXIOB                    INITIATE I/O OPERATION   A38013 08917802
         IECRES WAIT                    WAIT FOR COMPLETION      A38013 08919002
*                                                                       08920221
CDA00220 EQU   *                                                 A38013 08924421
         L     RD,CVTPTR                CVT ADDR                 Y02134 08936402
         L     RET,DXTCBADR             CURRENT TCB ADDR         Y02134 08938402
         L     RTIOT,DXTIOTAD            TIOT ADDRESS            Y02134 08941202
         L     RUCB,DXUCBADR            ESTABLISH UCB ADDRESS    Y02134 08949602
         TM    DEBOFLGS,DEBOFRLS        TEST FOR PARTIAL RELEASE        08951602
         BO    CDA00230                 BRANCH IF YES           SA53753 08953602
         LA    RUCB,0(,RUCB)            CLEAR HI-ORDER BYTE      A38013 08953821
         TM    DXECB,ECBNOERR           TEST FOR I/O ERROR       A38013 08958021
         BNO   CDA02320                 YES-BR IF I/O ERROR      A38013 08962221
         OI    DXATDACC,DXATUPDB        SET UPDATED DSCB WRITTEN Y02144 08962602
CDA00230 EQU   *                                                SA53753 08964202
         TM    JFCBLTYP,JFCSL+JFCBUL    CK IF SUL SPECIFIED      A38013 08966421
         BNO   CDA02000                 NO-BR TO GET NEXT DCB    A38013 08970621
         TM    JFCBTSDM,JFCSDS          IS DATA SET SYSOUT       A38013 08974821
         BO    CDA02000                 YES, DO NOT PROCESS UL   A38013 08979021
         TM    DCBDSORG,DCBORGPS        IS DSORG PHYS SEQ        A38013 08983221
         BZ    CDA02000                 NO DO NOT PROCESS UL     A38013 08987421
         EJECT                                                          08991621
*                                                                     * 08995821
*                          FUNCTION PROLOG                            * 09000021
*                                                                     * 09100021
*********************************************************************** 09200021
*                                                                     * 09300021
* FUNCTION NAME -                                                     * 09400021
*    CLOSE DA OUTPUT USER LABELS FUNCTION.                            * 09500021
*                                                                     * 09600021
* (STATUS) -                                                          * 09700021
*    NOT APPLICABLE                                                   * 09800021
*                                                                     * 09900021
* FUNCTION -                                                          * 10000021
*    DETERMINE IF CURRENT VOLUME IS FIRST VOLUME FOR NEW DA DATA SET. * 10100021
*    LOCATE FIRST VOLUME BY SEARCHING THE UCB'S FOR ALL UNITS         * 10200021
*    ALLOCATED TO THE DATA SET.                                       * 10300021
*    READ THE FORMAT 1 DSCB.                                          * 10400021
*    GET AN AREA OF MAIN STORAGE WHICH IS USED AS A                   * 10500021
*    WORKAREA-BUFFER IN WHICH THE USER LABEL RECORDS ARE FORMATTED AND* 10600021
*    AS A SAVE AREA FOR THE REGISTERS OF THE I/O SUPPORT FUNCTION     * 10700021
*    REQUIRING USER LABEL PROCESSING.  THE LAST PART OF THE AREA      * 10800021
*    OBTAINED IS USED FOR A 16-BYTE PARAMETER LIST.                   * 10900021
*    IF A TRACK WAS ALLOCATED FOR USER LBLS,CONTROL IS GIVEN TO THE   * 11000021
*    USER'S LABEL CONSTRUCTION ROUTINE VIA SYNCHRONOUS EXIT (SVC 12). * 11100021
*    ON RETURN FROM THE USER'S ROUTINE, IF A LABEL WAS CONSTRUCTED, IT* 11200021
*    IS WRITTEN FOLLOWED BY 2 FILEMARKS FOR HEADERS (UHL(N+1)), OR    * 11300021
*    ONE FILEMARK FOR TRAILERS (UTL(N+1)).  DEPENDING ON THE RETURN   * 11400021
*    CODE PASSED BY THE USER'S ROUTINE, ANOTHER LABEL IS PROCESSED OR * 11500021
*    CONTROL IS GIVEN BACK TO THE I/O SUPPORT FUNCTION.               * 11600021
*    WRITE UP TO EIGHT USER TRAILER LABELS AS REQUIRED FOR DATA SETS  * 11700021
*    ON DIRECT ACCESS VOLUMES.                                        * 11800021
*                                                                     * 11900021
* ENTRY POINTS -                                                      * 12000021
*    ENTERED FROM THE FOLLOWING--                                     * 12100021
*    CLOSE DA WRITE DSCB FUNCTION.                                    * 12200021
*                                                                     * 12300021
* INPUT -                                                             * 12400021
*    A POINTER TO EACH OF THE FOLLOWING--                             * 12500021
*       CURRENT PARAMETER LIST ENTRY- RPARC                           * 12600021
*       DD ENTRY IN THE TIOT- RTIOT                                   * 12700021
*       WTG TABLE- RWTG                                               * 12800021
*       CURRENT WTG TABLE ENTRY- RWTGC                                * 12900021
*       DCB- RDCB                                                     * 13000021
*       WORK AREA- RCORE                                              * 13100021
*       RESIDENT ROUTINE- RES                                         * 13200021
*       UCB- RUCB                                                     * 13300021
*       DEB- RDEB                                                     * 13400021
*                                                                     * 13500021
* OUTPUT -                                                            * 13600021
*    USER TRAILER LABELS ARE WRITTEN ON THE FIRST VOLUME FOR NEW DA   * 13700021
*    DATA SETS.                                                       * 13800021
*                                                                     * 13900021
* EXTERNAL REFERENCES -                                               * 14000021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 14100021
*    CONVERT ROUTINE TTR TO MBBCCHHR.                                 * 14200021
*    USER'S OUTPUT LABEL EXIT ROUTINES - ENTERED BY MEANS OF          * 14300021
*    SYNCHRONOUS EXIT (SVC 12) WITH THE FOLLOWING INPUT               * 14400021
*       REG 0    CONTAINS NO MEANINGFUL INFO                          * 14500021
*           1    POINTER TO 4 WORD PARAMETER LIST WHICH CONTAINS -    * 14600021
*                POINTER TO LABEL BUFFER                              * 14700021
*                POINTER TO DCB                                       * 14800021
*                FLAG BYTE, PTR TO STATUS INFO (IF PERMANENT ERROR)   * 14900021
*                OR ZERO                                              * 15000021
*                POINTER TO IMAGE AREA (IF TOTALING WAS REQUESTED)    * 15100021
*                OR ZERO                                              * 15200021
*           2-13 CONTENTS OF USER'S REGS BEFORE I/O SUPP              * 15300021
*           14   RETURN ADDRESS                                       * 15400021
*           15   EXIT ADDRESS                                         * 15500021
*                                                                     * 15600021
*    BEFORE EXITING, THIS FUNCTION'S REGISTERS 2-13 ARE SAVED IN THE  * 15700021
*    SVRB EXTENDED SAVE AREA.  THE USER'S REGISTERS 2-13 ARE RESTORED * 15800021
*    FROM THE SVRB.  THE LOCK BIT (BIT 6) IN DCBOFLGS FIELD IS SET TO * 15900021
*    1 TO PREVENT ANOTHER I/O SUPPORT FUNCTION FROM OPERATING ON THIS * 16000021
*    DCB WHILE THE USER IS IN CONTROL.  ON RETURN FROM THE USER'S     * 16100021
*    ROUTINE, THIS BIT IS RESET TO 0.                                 * 16200021
*                                                                     * 16300021
* EXITS, NORMAL -                                                     * 16400021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 16500021
*    CLOSE DA WRITE FILE MARK FUNCTION.                               * 16600021
*                                                                     * 16700021
* EXITS, ERROR -                                                      * 16800021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 16900021
*    EXIT WITH THE FOLLOWING INTERNAL CODES--                         * 17000021
*       89 - 314 ABEND - ERROR IN READING THE FORMAT 1 DSCB FROM      * 17100021
*                        THE FIRST VOLUME.                            * 17200021
*    NO USER LABEL EXTENT EXISTS-THE APPROPRIATE EXIT ROUTINE IS      * 17300021
*    ENTERED WITH THE BUFFER POINTER SET TO ZERO.   OTHER             * 17400021
*    INPUT AS USUAL.                                                  * 17500021
*    I/O ERROR WRITING A USER LABEL - THE USER'S ROUTINE IS ENTERED.  * 17600021
*    AGAIN WITH                                                       * 17700021
*       BIT 0 OF FLAG BYTE SET TO ONE, PTR TO STANDARD                * 17800021
*       STATUS INFORMATION.                                           * 17900021
*    OTHER INPUT AS FOR NORMAL ENTRY.                                 * 18000021
*                                                                     * 18100021
* TABLES/WORK AREAS -                                                 * 18200021
*    THE OPEN, CLOSE, OR EOV WORK AREA AND THE WHERE-TO-GO (WTG)      * 18300021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 18400021
*                                                                     * 18500021
* ATTRIBUTES -                                                        * 18600021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 18700021
*                                                                     * 18800021
* CHARACTER CODE DEPENDENCY -                                         * 18900021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 19000021
*                                                                     * 19100021
* NOTES -                                                             * 19200021
*    NOT APPLICABLE                                                   * 19300021
*                                                                     * 19400021
*********************************************************************** 19500021
         EJECT                                                          19600021
CDA00240 EQU   *                                                 A38013 19700021
         L     RC,DCBEXLST              PICK UP EXIT LIST ADDR FROM DCB 20200021
         LA    RC,0(,RC)                ZERO HIGH ORDER BYTE            20300021
         LTR   RC,RC                    IS THIS EXIT LIST ZERO          20400021
         BZ    CDA02000                 YES, DO NOT PROCESS USER LABELS 20500021
         MODESET KEYADDR=DXUKEY,WORKREG=15 ASSUME USER KEY       Y02082 20500102
         LA    RF,UTLOF                 POINT TO UTL             Y02080 20550102
*                                       OUTPUT CODE-04           Y02080 20560102
CDA00400 EQU   *                                                        20600021
         CLC   0(K1,RC),0(RF)           DO CODE BYTES MATCH             20700021
         BE    CDA00800                 BRANCH TO CHECK UL EXIT  A38013 20800021
*                                       EXIT ADDRESS                    20900021
         CLC   0(K1,RC),K1(RF)          DO CODE BYTES MATCH             21000021
         BE    CDA00800                 BRANCH TO CHECK UL EXIT  A38013 21100021
*                                       EXIT ADDRESS                    21200021
         TM    0(RC),LASTNTRY           IS THIS THE LAST ENTRY          21300021
*                                       IN                              21400021
*                                       EXLST                           21500021
         BO    CDA02000                 YES, CONTINUE CLOSE             21600021
         LA    RC,K4(,RC)               INCRE REG TO POINT TO NEXT ENTR 21700021
         B     CDA00400                 BR TO PROCESS NEXT ENTRY        21800021
         EJECT                                                          21900021
CDA00800 EQU   *                                                        36200021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 36200102
         TM    JFCDSORG,JFCORGDA        IS IT CREATE BDAM MODE          36300021
         BZ    CDA01700                 NO, PROCESS USER LABELS         36400021
*                                                                       36500021
*              FOR NEW DIRECT DATA SETS, DETERMINE IF CURRENT           36600021
*              VOLUME IS FIRST VOLUME.  IF NOT,                         36700021
*              FIND FIRST VOLUME AND READ THE FORMAT 1                  36800021
*              DSCB.                                                    36900021
*                                                                       37000021
         MVC   DXCCW10(K6),JFCBVOLS     GET VOL SER OF 1ST VOLUME       37100021
CDA00900 EQU   *                                                        37400021
*                                                                     * 38800021
*   FOR DIRECT DATA SETS, USER LABELS ARE WRITTEN ONLY ON THE FIRST   * 38900021
*   VOLUME.  WHEN A NEW DIRECT DATA SET IS CLOSED, THE DSCB AND A     * 39000021
*   FILE MARK ARE WRITTEN ON THE LAST VOLUME PROCESSED. THUS, IN      * 39100021
*   ORDER TO WRITE USER LABELS, THE FIRST VOLUME MUST BE LOCATED.     * 39200021
*                                                                     * 39300021
*   THIS SECTION SEARCHS THE UCB'S FOR ALL UNITS ALLOCATED TO THE DATA* 39400021
*   SET TO FIND THE UNIT ON WHICH THE FIRST VOLUME IS MOUNTED.  WHEN  * 39500021
*   THE VOLUME IS FOUND, THE FORMAT 1 DSCB IS READ AND CONTROL IS     * 39600021
*   PASSED TO THE OUTPUT DIRECT ACCESS USER TRAILER LABEL MODULE TO   * 39700021
*   WRITE USER TRAILER LABELS.                                        * 39800021
*                                                                     * 39900021
*   IF THE FIRST VOLUME IS NOT MOUNTED, CLOSE PROCESSING CONTINUES.   * 40000021
*                                                                     * 40100021
         LA    RF,K1                    SET IND. TO FIND 1ST VOL ON     40200021
         SR    RET,RET                  CLEAR REGISTER                  40300021
         IC    RET,TIOELNGH             GET LENGTH OF TIOT ENTRY        40400021
         AR    RET,RTIOT                ADDRESS OF END OF ENTRY         40500021
         LA    R1,TIOEFSRT-K1           ADDRESS OF 2ND UCB PTR   Y02134 40600002
*                                       IN TIOT                  Y02134 40650002
CDA01200 EQU   *                                                        40700021
         L     RUCB,0(R1)               GET UCB ADDRESS                 40800021
         CLC   DXCCW10(K6),UCBVOLI      IS CURRENT VOL 1ST VOL   Y02134 40850002
         BE    CDA01400                 CURR VOL 1ST, PROCESS UL Y02134 40860002
CDA01300 EQU   *                                                        41000021
         LA    R1,K4(R1)                BUMP TO NEXT UCB PTR            41100021
         CR    R1,RET                   CK IF END OF TIOT ENTRY         41200021
         BNE   CDA01200                 NO,BR TO CK NEXT UCB            41300021
*                                                                       41400021
*     FIRST VOLUME IS NOT MOUNTED, CONTINUE CLOSE PROCESSING.  NO       41500021
*     USER TRAILER LABELS WILL BE WRITTEN.                              41600021
*                                                                       41700021
         B     CDA02000                 BRANCH TO FINAL FUNCTION        41800021
*                                                                       41900021
CDA01400 EQU   *                                                        41950002
         LA    RUCB,K0(,RUCB)           CHECK IF CURRENT         YM5764 42000002
         CLM   RUCB,B'0111',DXUCBADR+K1 IS FIRST VOLUME          Y02134 42050002
         BE    CDA01700                 GO PROCESS UL IF YES     Y02134 42200002
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 42205002
         BNO   CDA01500                 BR IF NOT                Y02132 42210002
*        READ VIO DSCB FROM SWA                                  Y02132 42215002
         MVC   DXDSCB(DSCEXT2-DSCFMTID),VDSDSCB-VDSUCB+L'JFCBDSNM(RUCB) 42220002
*                                                                Y02132 42225002
         OC    DXDSCB(DSCEXT2-DSCFMTID),DXDSCB IS DSCB = ZERO?   Y02132 42230002
         BZ    CDA02400                 BR IF YES, I/O ERROR     Y02132 42235002
*                                                                Y02132 42240002
         XC    DSCEXT2(DSCBEND-DSCEXT2),DSCEXT2 ZERO REMAIN CORE Y02132 42245002
*                                                                Y02132 42250002
         B     CDA01700                 RESUME PROCESSING        Y02132 42255002
CDA01500 EQU   *                                                 Y02132 42260002
*                                                                       42300021
*    SET UP CHANNEL PROGRAM TO READ THE FORMAT 1 DSCB ON THE FIRST      42400021
*    VOLUME OF THE DATA SET.                                            42500021
*                                                                       42600021
*              CONVERT VTOC TTR TO FULL MBBCCHHR                        42700021
*                                                                       42800021
         STM   RDCB,RET,DXCCW3          SAVE CLOSE REGISTER 2-14        42900021
         L     R0,UCBVTOC               GET VTOC TTR FROM UCB           43200021
         SRL   R0,K8                    SHIFT N FIELD OUT               43900021
         SLL   R0,K8                    ZERO N FIELD                    44000021
         LA    R1,DXDEB                 ADDRESS OF CLOSE WORK DEB       44100021
         LA    RDCB,DXDAADDR            RESULT GOES IN CLOSE IOB        44200021
         L     RD,CVTPTR                GET POINTER TO CVT              44300021
         L     RF,CVTPCNVT              ENTRY POINT FOR CONVERT ROUTINE 44400021
         BALR  RET,RF                   GO CONVERT VTOC TTR             44500021
         LM    RDCB,RET,DXCCW3          RESTORE CLOSE REGISTERS         44600021
*                                                                       44700021
*              CONSTRUCT CHANNEL PROGRAM-SEARCH AND TIC ALREADY SET UP  44800021
*                                                                       44900021
*              SEARCH ID EQ     IOBDADAD+3   CC     5                   45000021
*              TIC              CCW1         --     -                   45100021
*              SEARCH KEY EQ    DSNAME       CC    44                   45200021
*              TIC              CCW3         --    --                   45300021
*              READ DATA        DXDSCB       --    96                   45400021
*                                                                       45500021
         XC    DXCCW3(DXCCW6-DXCCW3),DXCCW3  CLEAR CHANNEL PGM AREA     45600021
         LA    RF,JFCBDSNM              ADDR OF DSNAME                  45700021
         ST    RF,DXCCW3                IN SEARCH CCW                   45800021
         LA    RF,DXCCW3                ADDR OF SEARCH KEY CCW          45900021
         ST    RF,DXCCW4                IN TIC CCW                      46000021
         LA    RF,DXDSCB                WORK AREA ADDRESS               46100021
         ST    RF,DXCCW5                IN READ CCW                     46200021
         OC    DXCCW3(K24),CLRDDSCB     CP SKELETON OVER CCW'S          46300021
*                                                                       46400021
         ST    RUCB,DXCCW6              MAIN UCB ADDRESS         Y02134 46600002
         MVC   DXDEBUCB+K1(K3),DXCCW6+K1  MAIN UCB ADDR IN WORK DEB     46700021
*                                                                       46800021
*              READ THE FORMAT 1 DSCB FROM 1ST VOLUME                   46900021
*                                                                       47000021
         EXCP  DXIOB                    READ DSCB                       47100021
         IECRES WAIT                    WAIT FOR DSCB                   47200021
         TM    DXECB,ECBNOERR           TEST FOR UNUSUAL I/0 CONDITION  47300021
         BC    12,CDA02400              BRANCH IF ERROR                 47400021
CDA01700 EQU   *                                                        47600021
         MODESET KEYADDR=DXUKEY,WORKREG=1  ASSUME USER KEY       Y02082 47650002
         L     RC,0(,RC)                C(RC)=EXIT LIST ENTRY           47700021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 47750002
         LA    R1,0(,RC)                EXIT ADDRESS IN R1              47800021
         LTR   R1,R1                    CK EXIT ADDRESS FOR ZERO        47900021
         BZ    CDA01800                 ZERO,DON'T PROCESS USER LBLS    48000021
         LA    RF,ULDAOMOD              OUTPUT UL MOD ID                48100021
         B     CDA02100                 BRANCH TO XCTL                  48200021
CDA01800 EQU   *                                                        48300021
         CLM   RUCB,B'0111',DXUCBADR+K1 IS IND ON -  IF NO       Y02134 48400002
         BE    CDA02000                 BRANCH  TO FINAL FUNC    Y02134 48500002
*                                                                       48600021
CDA01900 EQU   *                                                        48700021
         L     RUCB,DXUCBADR            GET CURRENT UCB ADDRESS  Y02134 48800002
         ST    RUCB,DXCCW6              RESTORE CURRENT UCB ADDR Y02134 49000002
         MVC   DXDEBUCB+K1(K3),DXCCW6+K1  VOLUME TO WORK DEB            49100021
CDA02000 EQU   *                                                        49200021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 49250002
         LA    RF,DAFINMOD              LOAD NEXT MOD                   49300021
CDA02100 EQU   *                                                        49400021
         SR    RET,RET                  SET UP FOR BRANCH TABLE         49500021
         IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED       Y02080 49650002
*                                    XCTL TO ULDAMOD OR DAFINMOD Y02080 49660002
         EJECT                                                          51000021
         SPACE 1                                                        51100021
*********************************************************************** 51200021
*                                                                     * 51300021
*                        ERROR PROCESSING                             * 51400021
*                                                                     * 51500021
*********************************************************************** 51600021
         SPACE 1                                                        51700021
CDA02320 EQU   *                                                 A38013 51720021
         LA    R0,CABD088               ERR- WRITE DSCB          A38013 51740021
         LA    RET,K4                   SET BRANCH OFFSET        A38013 51760021
         B     CDA02420                 BRANCH TO ABEND          A38013 51780021
CDA02400 EQU   *                                                        51800021
         LA    R0,CABD089               ERR-READ DSCB                   51900021
         LA    RET,K8                   SET BRANCH OFFSET        A38013 51960021
CDA02420 EQU   *                                                 A38013 52020021
         DMABCOND (0),PDMOD             ABEND MACRO                     52100021
         EJECT                                                          52200021
         SPACE 1                                                        52300021
*********************************************************************** 52400021
*                                                                     * 52500021
*                       CONSTANTS                                     * 52600021
*                                                                     * 52700021
*********************************************************************** 52800021
         SPACE 1                                                        52900021
*                                                                       53000021
*****          DCB EXIT LIST CODE BYTES USED FOR TESTING                53100021
*                                                                       53200021
UTLOF    DC    X'04'                    USER TRAILER LABEL OUTPUT CODE  54100021
*                                       BYTE                            54200021
         DC    X'84'                    USER TRAILER LABEL OUTPUT       54300021
*                                       CODE--LAST                      54400021
ACCW1C   DC    X'6000000508'            CC,SILI,5 CHAR,TIC OP    A38013 54420021
ACCW2C   DC    X'4000000086'            CC,READ DATA OP CODE     A38013 54440021
ACCW3C   DC    X'00000060'              96 CHARACTERS            A38013 54460021
*                                                                       54500021
CLRDDSCB EQU   *                                                        54600021
         DC    X'A90000004000002C'      SEARCH KEY EQ,CC,LENGTH=44      54700021
         DC    X'0800000000000000'      TIC                             54800021
         DC    X'8600000000000060'      READ DATA                       54900021
         LTORG                                                          55000021
         XCTLTABL ID=(DAFINMOD,2E,PDMOD,0P,ULDAOMOD,2D),SVC=020, Y02080X55100002
               BRT=YES,LENGTH=                                   Y02080 55150002
         IECDSECS CVT,TCB,TIOT,DCB,DEB,UCB,MAIN,WTG,EXPAND=YES          55300021
         IDDVDSCB                                                Y02132 55305002
         IECEQU                                                         55400021
         END                                                            55500021
