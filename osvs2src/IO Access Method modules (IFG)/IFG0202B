         TITLE 'IFG0202B - NONSTANDARD LABEL TAPE TRAILER PROCESSING'   00300021
IFG0202B CSECT                                                          01200021
         ENTRY IFG0232Y,IFG0556B,IGG0200B                        Y02080 01250002
IFG0232Y EQU   IFG0202B                 ALLIAS ENTRY POINT       Y02080 01300002
IFG0556B EQU   IFG0202B                 ALLIAS ENTRY POINT       Y02080 01350002
IGG0200B EQU   IFG0202B                 ALLIAS ENTRY POINT       Y02080 01400002
*********************************************************************** 01500021
*                                                                     * 01550002
*                                                                     * 01650002
*          VS2 RELEASE 037 DELETION/CHANGES                           * 01652037
*0000                                                          @ZA09122 01652837
*0000                                                          @ZA07210 01653137
*0000                                                          @ZA07184 01653437
*0000                                                          @ZA05231 01653737
*0000540000-543000                                             @ZA03180 01654037
*0000465000-969000                                             @ZA04212 01656037
*0000                                                          @ZA13589 01657037
*0000                                                          @ZA29604 01657537
*A613000,D608200                                               @ZA31147 01657737
*                                                                     * 01658037
*          VS2 RELEASE 3 DELETION/CHANGES                             * 01660002
*0000687300-687420                                              ZA01504 01662002
*                                                                     * 01670002
*          VS1 RELEASE 2 DELETION/CHANGES                               01700002
*                                                                     * 01750002
*0000895800                                                      XM0476 01760002
*0000                                                           XA00441 01762002
*                                                                     * 01770002
*                                                                     * 01800021
*          VS2 RELEASE 1 DELETIONS/CHANGES                              01900000
*00000532500,760500                                              YM3099 01950000
*                                                                     * 02100021
*          RELEASE 21 DELETIONS/CHANGES                               * 03600021
*0000147000,213000,219000,345000-369000,399000,483000,807000-    A38013 03630021
*0000816000,852000,939000-960000                                 A38013 03660021
*                                                                M0039  03700021
*0000792000,798000                                               M0147  03800021
*D510000,768000                                                 SA53294 03850021
*0000                                                           SA55450 03860002
*          RELEASE 21.7 DELETIONS/CHANGES                             * 03862002
*0000519500,528000-531000,762000-768500,747000-759000           SA55602 03870002
*                                                                     * 03900021
* MODULE NAME = IFG0202B                                              * 03950002
*                                                                     * 04000002
* DESCRIPTIVE NAME = NONSTANDARD LABEL TAPE TRAILER PROCESSING        * 04050002
*                                                                     * 04100002
* COPYRIGHT = NONE                                                    * 04150002
*                                                                     * 04160002
* STATUS CHANGE LEVEL 000                                             * 04200021
*                                                                     * 04500021
* FUNCTION -                                                          * 04800021
*    THIS MODULE CONTAINS THE FUNCTION(S) OR PART(S) OF FUNCTION(S)-- * 05100021
*    CLOSE TAPE NONSTANDARD LABEL FUNCTION.                           * 05400021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)' FOR DETAILS.         * 05700021
*                                                                     * 06000021
* ENTRY POINTS -                                                      * 06300021
*         IFG0202B - ENTRY POINT VIA AN XCTL FROM THE FOLLOWING--     * 06600021
*             INITIAL ENTRY--                                         * 06900021
*                IFG0200Y - PROCESS CLOSE TAPE NONSTANDARD LABEL      * 07200021
*                           FUNCTION.                                 * 07500021
*             SECOND ENTRY--                                          * 07800021
*                NSLETRLI - VIA IFG0552R TO CONTINUE PROCESSING CLOSE * 08100021
*                           TAPE NONSTANDARD LABEL FUNCTION.          * 08400021
*             THIRD ENTRY--                                           * 08700021
*                NSLCTRLO - CONTINUE PROCESSING CLOSE TAPE NONSTANDARD* 09000021
*                           LABEL FUNCTION.                           * 09300021
*             FOURTH ENTRY--                                          * 09370021
*                IFG0202H - PROCESS CLOSE TAPE NONSTANDARD LABEL      * 09440021
*                           FUNCTION.                                 * 09510021
*                                                                     * 09600021
* INPUT -                                                             * 09900021
*    ENTERED IN DATA MANAGEMENT KEY                              Y02082 09950002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 10200021
*                                                                     * 10500021
* OUTPUT -                                                            * 10800021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 10850002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 11100021
*                                                                     * 11400021
* EXTERNAL REFERENCES -                                               * 11700021
*         IFG019RA - OPEN/CLOSE/EOV RESIDENT ROUTINE FOR XCTL AND     * 12000002
*                    WAIT.                                            * 12300021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 12600021
*                                                                     * 12900021
* EXITS, NORMAL -                                                     * 13200021
*    EXIT VIA THE RESIDENT ROUTINE XCTL TO THE FOLLOWING--            * 13500021
*         IFG0202H - PROCESS CLOSE/EOV SMF DATA SET FUNCTION.         * 13600021
*         NSLETRLI - PROCESS DEFER INPUT LABEL PROCESSING FUNCTION.   * 13800021
*         NSLCTRLO - PROCESS OUTPUT LABEL PROCESSING FUNCTION.        * 14100021
*         IFG0232Z - PROCESS TCLOSE TAPE FINAL FUNCTION.              * 14400021
*         IFG0202F - PROCESS CLOSE TAPE VOLUME DISPOSITION FUNCTION.  * 14700021
*         IFG0202J - PROCESS CLOSE FINAL STRING.                      * 15000021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 15300021
*                                                                     * 15600021
* EXITS, ERROR -                                                      * 15900021
*    EXIT IS TO THE PROBLEM DETERMINATION MODULE IFG0200P, IF AN      * 16200021
*    ABEND SITUATION OCCURS IN THIS MODULE.  REFER TO THE FOLLOWING   * 16500021
*    'FUNCTION PROLOG(S)'.                                            * 16800021
*                                                                     * 17100021
* TABLES/WORK AREAS -                                                 * 17400021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 17700021
*                                                                     * 18000021
* ATTRIBUTES -                                                        * 18300021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 18600021
*                                                                     * 18900021
* CHARACTER CODE DEPENDENCY -                                         * 19200021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 19500021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 19800021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 20100021
*                                                                     * 20400021
* NOTES -                                                             * 20700021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 21000021
*    THIS MODULE MUST HAVE A NAME ALIAS OF IGG0200B FOR NON-STANDARD  * 21300021
*    TAPE LABEL ROUTINE INTERFACE.                                    * 21600021
*    THIS MODULE MUST HAVE A NAME ALIAS OF IFG0232Y FOR ENTRY FROM    * 21900021
*    TCLOSE FOR DEFER NSL PROCESSING.                                 * 22200021
*    THIS MODULE MUST HAVE A NAME ALIAS OF IFG0556B FOR ENTRY FROM    * 22300021
*    END-OF-VOLUME AFTER DEFER NSL PROCESSING.                        * 22400021
*                                                                     * 22500021
*********************************************************************** 22800021
         EJECT                                                          23100021
         USING WTG,RWTG                                                 23150037
         USING WTGENTRY,RWTGC                                           23200037
         USING FORCORE,RCORE                                            23250037
         USING USERPRML,RPARC                                           23300037
         USING IHADCB,RDCB                                              23400021
         USING UCBOB,RUCB                                               24000021
         USING DEB,RDEB                                                 24300021
*                                                                       24350037
         BALR  RBASE,0                  ESTABLISH BASE REGISTER         25200021
         USING *,RBASE                                                  25500021
*                                                                       25502037
*     NSL ROUTINES ARE ENTERED IN KEY ZERO, THEREFORE DATA MGT  YA02116 25510002
*     KEY MUST BE RESTORED ON RETURN                            YA02116 25520002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 25550002
*                                                                       25610037
         CLC   WTGMODNM,RETCTRLO        RETURN FROM NSLCTRLO   @ZA04212 25660037
         BE    CCM01000                 BRANCH IF YES          @ZA04212 25710037
         CLC   WTGMODNM,RETETRLI        RETURN FROM NSLETRLI   @ZA04212 25760037
         BE    CCM00500                 BRANCH IF FR IFG0552R  @ZA04212 25770037
*                                                                       25780037
         B     CCM00000(RET)            GO TO PROPER ENTRY     @ZA04212 25790037
CCM00000 EQU   *                        BRANCH TABLE           @ZA04212 25792037
         B     CCM00100                 INITIAL ENTRY          @ZA04212 25794037
         B     CCM00500                 ENTRY FROM IFG0552R    @ZA04212 25796037
         B     CCM01000                 ENTRY FROM NSLCTRLO    @ZA04212 25798037
         B     CCM00200                 ENTRY FR SMF IFG0202H  @ZA04212 25798437
*                                                                       25798837
         EJECT                                                          25800021
*                                                                     * 25850037
*********************************************************************** 25900037
*                                                                     * 26100021
*                          FUNCTION PROLOG                            * 26400021
*                                                                     * 26700021
*********************************************************************** 27000021
*                                                                     * 27300021
* FUNCTION NAME -                                                     * 27600021
*    CLOSE TAPE NONSTANDARD LABEL FUNCTION.                           * 27900021
*                                                                     * 28200021
* (STATUS) -                                                          * 28500021
*    NOT APPLICABLE                                                   * 28800021
*                                                                     * 29100021
* FUNCTION -                                                          * 29400021
*    INTERFACE WITH SMF DATA SET FUNCTION IF THE DATA SET IS NOT      * 29500021
*    SYSIN OR SYSOUT.                                                 * 29600021
*    TEST NONSTANDARD LABEL DCB'S FOR LABEL PROCESSING DEFERRED       * 29700021
*    AT END-OF-DATA TIME. IF THE INPUT TRAILER LABELS WERE NOT        * 30000021
*    PROCESSED, TRANSFER CONTROL TO THE EOV NSLETRLI ROUTINE.         * 30300021
*    FREE EXTRA CORE ACQUIRED FOR DEFER LABEL PROCESSING.             * 30600021
*    TRANSFER CONTROL TO THE CLOSE NSLCTRLO ROUTINE TO PROCESS        * 30900021
*    OUTPUT NONSTANDARD LABELS AND TO PERFORM VOLUME DISPOSITION      * 31200021
*    FOR NSL VOLUME, IF NECESSARY.                                    * 31500021
*    VOLUME DISPOSITION IS PERFORMED AS SPECIFIED IN THE TIOT.        * 31800021
*                                                                     * 32100021
* ENTRY POINTS -                                                      * 32400021
*    ENTERED FROM THE FOLLOWING--                                     * 32700021
*    CLOSE TAPE ACCESS METHOD EXECUTOR INTERFACE FUNCTION.            * 33000021
*    TCLOSE TAPE LABEL FUNCTION.                                      * 33300021
*                                                                     * 33600021
* INPUT -                                                             * 33900021
*    A POINTER TO EACH OF THE FOLLOWING--                             * 34200021
*       CURRENT PARAMETER LIST ENTRY- RPARC                           * 34500021
*       DD ENTRY IN THE TIOT- RTIOT                                   * 34800021
*       WTG TABLE- RWTG                                               * 35100021
*       CURRENT WTG TABLE ENTRY- RWTGC                                * 35400021
*       DCB- RDCB                                                     * 35700021
*       WORK AREA- RCORE                                              * 36000021
*       RESIDENT ROUTINE- RES                                         * 36300021
*       UCB- RUCB                                                     * 36600021
*       DEB- RDEB                                                     * 36900021
*                                                                     * 37200021
* OUTPUT -                                                            * 37500021
*    NONSTANDARD LABELS PROCESSED.                                    * 37800021
*                                                                     * 38100021
* EXTERNAL REFERENCES -                                               * 38400021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 38700021
*                                                                     * 39000021
* EXITS, NORMAL -                                                     * 39300021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 39600021
*    CLOSE/EOV SMF DATA SET FUNCTION.                                 * 39900021
*    CLOSE TAPE VOLUME DISPOSITION FUNCTION.                          * 40200021
*    TCLOSE FINAL FUNCTION.                                           * 40500021
*                                                                     * 40800021
* EXITS, ERROR -                                                      * 41100021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 41400021
*                                                                     * 41700021
* TABLES/WORK AREAS -                                                 * 42000021
*    THE OPEN, CLOSE, OR EOV WORK AREA AND THE WHERE-TO-GO (WTG)      * 42300021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 42600021
*                                                                     * 42900021
* ATTRIBUTES -                                                        * 43200021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 43500021
*                                                                     * 43800021
* CHARACTER CODE DEPENDENCY -                                         * 44100021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 44400021
*                                                                     * 44700021
* NOTES -                                                             * 45000021
*    NOT APPLICABLE                                                   * 45300021
*                                                                     * 45600021
*********************************************************************** 45900021
         EJECT                                                          46200021
*                                                                       46250037
CCM00100 EQU   *                        INITAL ENTRY           @ZA04212 46300037
*                                                                       46350037
*********************************************************************** 46400037
*                                                                     * 46450037
*              SMF TYPE 14 & 15 RECORD DETERMINATION                  * 46500037
*                                                                     * 46550037
*********************************************************************** 46600037
*                                                                       46650037
         TM    WTGPATHS,WTGTCLOS        BYPASS SMF FOR TCLOSE  @ZA05231 46660037
         BO    CCM00200                 BRANCH IF TCLOSE       @ZA05231 46670037
         TM    WTGPATHS,WTGSMF          SMF REQUESTED          @ZA04212 46700037
         BZ    CCM00200                 BRANCH IF NOT          @ZA04212 46750037
         TM    JFCBTSDM,JFCSDS          IS SYSIN/SYSOUT DS     @ZA04212 46800037
         BO    CCM00200                 BRANCH IF YES          @ZA04212 46850037
*                                                                       46900037
         MVC   DXRETMOD,ID2B2B          MOVE IN RETURN IDTTR   @ZA04212 46950037
         IECRES LOAD,MODID=IFG0202H,BRCODE=K0,BRANCH=QUEUED    @ZA04212 47000037
         EJECT                                                          47050037
*                                                                       47100037
CCM00200 EQU   *                        SMF RETURN             @ZA04212 47150037
*                                                                       47200037
*********************************************************************** 47250037
*                                                                     * 47300037
*        COPY THE DCB(S) FROM THE WORK AREA TO USER'S STORAGE           47350037
*                                                                       47400037
*********************************************************************** 47450037
*                                                                       47500037
         IECRES INIT,DCBCOPY=FRWKAR,STM=(3,14,WTGPREFX)        @ZA04212 47550037
*                                                                       47600037
         IECRES SYNCHDCB                                       @ZA04212 47650037
*                                                                       47700037
         MVC   WTGMODNM,THISMOD         INDICATE THIS MOD      @ZA05231 47710037
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX @ZA04212 47750037
         L     RPAR,IECUPRML-IECPREFX(,RF) LOAD PTR TO PARMS   @ZA04212 47800037
         LR    RPARC,RPAR               GET FIRST PARM PTR     @ZA04212 47850037
         LA    RWTGC,WTGENTRY-WTG(,RWTG) PTR TO 1ST WTG ENTRY  @ZA04212 47900037
*                                                                       47950037
CCM00300 EQU   *                        PROCESS DCB            @ZA04212 48000037
*                                                                       48050037
         CLC   WTGIDTTR(K2),ID2B2Y      CHECK IF ENTRY TCLOSE  @ZA05231 48060037
         BNE   CCM00303                 BRANCH IF NOT          @ZA05231 48070037
         MVC   WTGIDTTR,ID2B2B          SET FOR 2B PROCESS     @ZA05231 48080037
CCM00303 EQU   *                        CHECK FOR THIS MOD     @ZA05231 48090037
         CLC   WTGIDTTR(K2),ID2B2B      CHECK FOR THIS MODULE  @ZA04212 48100037
         BNE   CCM00600                 BRANCH IF WRONG MODULE @ZA04212 48150037
*                                                                       48200037
         L     RCORE,WTGCORE-K1         GET WORK AREA PTR      @ZA04212 48250037
         LA    RCORE,FORCORE            CLEAR HI BYTE          @ZA04212 48300037
         LTR   RCORE,RCORE              TEST FOR WORK AREA     @ZA04212 48350037
         BZ    CCM00600                 BRANCH IF INVALID      @ZA04212 48400037
*                                                                       48450037
         L     RTIOT,DXTIOTAD           GET CURRENT TIOT PTR   @ZA04212 48500037
         L     RUCB,DXUCBADR            GET CURRENT UCB ADDR   @ZA04212 48550037
         STM   RTIOT,RUCB,DXREG9        SAVE FOR QUED USE      @ZA04212 48600037
*                                                                       48650037
         LTR   RUCB,RUCB                TEST FOR DUMMY         @ZA04212 48700037
         BZ    CCM00600                 BRANCH IF NOT TAPE     @ZA04212 48750037
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE UNIT     @ZA04212 48800037
         BZ    CCM00600                 BRANCH IF NOT TAPE     @ZA04212 48850037
         TM    UCBTFL1,UCBNSLTP         CHECK FOR NSL          @ZA04212 48900037
         BZ    CCM00600                 BRANCH IF NOT NSL      @ZA04212 48950037
*                                                                       49000037
         MVI   DXRESIND,K0              SET WAIT OFF           @ZA04212 49050037
*                                                                       49100037
         EJECT                                                          49150037
         L     RDCB,DXPDCBAD            LOAD DCB COPY          @ZA04212 49200037
         L     RDEB,DCBDEBAD            LOAD DEB ADDR          @ZA04212 49250037
         MVC   DXDEBUCB,DEBUCBAD        UCB ADDRESS TO DEB     @ZA04212 49300037
*                                                                       49350037
         TM    DEBOFLGS,DEBOFNSL+DEBOFEOF  TEST FOR NSL + EOF  @ZA04212 49400037
         BNO   CCM00600                 SKIP DEFERED EXIT      @ZA04212 49450037
         TM    DCBOFLGS,DCBOWRIT        TEST FOR INPUT         @ZA04212 49500037
         BO    CCM00600                 NO,BR TO CLOSE NSL     @ZA04212 49550037
*                                                                       49600037
         L     RC,DCBEXLST              ADDR OF EXIT LIST      @ZA04212 49650037
         LA    RC,0(,RC)                CLEAR HIGH-ORDER BYTE  @ZA04212 49700037
         LTR   RC,RC                    EXLST SPECIFIED        @ZA04212 49750037
         BZ    CCM00600                 BRANCH IF NOT          @ZA04212 49800037
*                                                                       49850037
*********************************************************************** 49900037
*                                                                       49950037
*        GET LOCAL LOCK TO ACCESS USER MEMORY                           50000037
*                                                                       50050037
*********************************************************************** 50100037
*                                                                       50150037
         L     RF,WTGPREFX              LOAD PREFIX PTR        @ZA04212 50200037
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGS - SETLOCK @ZA04212 50250037
*                                                                       50300037
         MODESET EXTKEY=SUPR            SETLOCK KEY            @ZA04212 50350037
*                                                                       50400037
CCM00305 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND, GET LOCK       @ZA04212X50450037
               RELATED=(LOCAL,IFG0202B(CCM00325))              @ZA04212 50500037
*                                                                       50550037
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGS        @ZA04212 50600037
*                                                                       50650037
         MODESET KEYADDR=DXUKEY,WORKREG=13 USER EXIT LIST      @ZA04212 50700037
*                                                                       50750037
*********************************************************************** 50800037
*                                                                       50850037
*        TEST FOR DEFERRED PROCESSING OF INPUT TRAILER LABELS           50900037
*                                                                       50950037
*********************************************************************** 51000037
*                                                                       51050037
CCM00310 EQU   *                        CHECK EXIT LIST        @ZA04212 51100037
*                                                                       51150037
         CLI   K0(RC),XLDEFNSL          DEFER LABEL PROC       @ZA04212 51200037
         BE    CCM00320                 BRANCH IF YES          @ZA04212 51250037
         CLI   K0(RC),XLDEFNSL+LASTNTRY DEFER + LAST ENTRY     @ZA04212 51300037
         BE    CCM00320                 BRANCH IF YES          @ZA04212 51350037
         TM    K0(RC),LASTNTRY          CHECK FOR LAST ENTRY   @ZA04212 51400037
         LA    RC,K4(,RC)               INCREMENT TO NEXT EXIT @ZA04212 51450037
         BNO   CCM00310                 BRANCH IF MORE         @ZA04212 51500037
         XR    RC,RC                    SET ERROR IND          @ZA04212 51550037
*                                                                       51600037
CCM00320 EQU   *                        RELEASE LOCK           @ZA04212 51650037
*                                                                       51700037
         MODESET EXTKEY=DATAMGT         CLOSE KEY              @ZA04212 51750037
*                                                                       51800037
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGS - SETLOCK @ZA04212 51850037
*                                                                       51900037
         MODESET EXTKEY=SUPR            SETLOCK KEY            @ZA04212 51950037
*                                                                       52000037
CCM00325 SETLOCK RELEASE,TYPE=LOCAL,    FREE LOCK              @ZA04212X52050037
               RELATED=(LOCAL,IFG0202B(CCM00305))              @ZA04212 52100037
*                                                                       52150037
         MODESET EXTKEY=DATAMGT         CLOSE KEY              @ZA04212 52200037
*                                                                       52250037
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGS        @ZA04212 52300037
*                                                                       52350037
         LTR   RC,RC                    CHECK IF EXIT FOUND    @ZA04212 52400037
         BZ    CCM00600                 BRANCH IF NO EXIT      @ZA04212 52450037
         EJECT                                                          52500037
*                                                                       52550037
*********************************************************************** 52600037
*                                                                       52650037
*****          INITIALIZE TO PASS CONTROL TO END-OF-VOLUME NSL          52700037
*****          ROUTINE FOR INPUT TRAILER LABEL PROCESSING               52750037
*                                                                       52800037
*********************************************************************** 52850037
*                                                                       52900037
         L     RPAR,DCBDEBAD            LOAD DEB ADDR          @ZA04212 52950037
         LA    RET,K12                  BRANCH TABLE OFFSET    @ZA04212 53000037
*                                       FOR RETURN FROM        @ZA04212 53050037
*                                       NSLETRLI TO IFG0552R   @ZA04212 53100037
*                                       (ALIAS IGG0550B) WHICH @ZA04212 53150037
*                                       RETURNS TO THIS LOAD   @ZA04212 53200037
*                                       WITH RET SET TO 4      @ZA04212 53250037
*                                                                       53300037
         L     RF,WTGPREFX              LOAD PREFIX POINTER    @ZA04212 53350037
         L     RF,IECRRPRM-IECPREFX(,RF) LOAD RRPLIST          @ZA04212 53400037
         OI    RRFLAGS1-RRPLIST(RF),RRFNSL NSL IN CONTROL      @ZA04212 53450037
         TM    WTGPATHS,WTGTCLOS        TEST FOR TCLOSE        @ZA04212 53500037
         BZ    CCM00340                 BRANCH IF NOT TCLOSE   @ZA04212 53550037
         OI    DXATALL,DXATFC           FORCE CLOSE ON ERROR   @ZA04212 53600037
*                                                                       53650037
CCM00340 EQU   *                        GOTO NSL ROUTINE       @ZA04212 53700037
*                                                                       53750037
         LA    RF,WTGMODNM              LOAD WTG-4             @ZA05231 53752037
         LA    RD,K4                    INTO REG 15            @ZA05231 53754037
         SR    RF,RD                                           @ZA05231 53756037
         MVC   DXXWTOPR(WTGEND-WTGTABLE),WTGWTOPR-WTGTABLE(RF) @ZA05231 53760037
         LA    RWTG,DXXPREFX                                            53770037
         LA    RD,FORCORE               RETURN INDICATOR       @ZA04212 53800037
         MODESET EXTKEY=ZERO            NSL ROUTINE KEY        @ZA04212 53850037
*                                                                       53900037
         IECRES LOAD,MODNM=NSLETRLI,BRCODE=(RET), NSLETRLI     @ZA04212X53950037
               PREFIX=DXXPREFX,BRANCH=DIRECT                   @ZA04212 54000037
         EJECT                                                          54050037
*                                                                       54100037
CCM00500 EQU   *                        RETURN FROM NSLETRLI   @ZA04212 54150037
*                                                                       54200037
*********************************************************************** 54250037
*                                                                       54300037
*        RETURN FROM NSLETRLI VIA IFG0552R                              54350037
*                                                                       54400037
*********************************************************************** 54450037
*                                                                       54500037
         L     RF,DXXPREFX                                     @ZA05231 54510037
         L     RWTG,IECWTGTB-IECPREFX(,RF)                              54520037
         IECRES LOAD,MODNM=THISMOD,PREFIX=WTGPREFX,BRANCH=NO   @ZA04212 54550037
*                                                                       54600037
         XC    WTGMODEP,WTGMODEP        CLEAR BRANCH ADDR      @ZA04212 54650037
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX @ZA04212 54700037
         L     RPAR,IECUPRML-IECPREFX(,RF) LOAD PTR TO PARMS   @ZA04212 54750037
         L     RF,IECRRPRM-IECPREFX(,RF) LOAD RRPLIST          @ZA04212 54800037
         NI    RRFLAGS1-RRPLIST(RF),ALLBITS-RRFNSL RESET NSL   @ZA04212 54850037
         LR    RPARC,RPAR               GET FIRST PARM PTR     @ZA04212 54900037
         LA    RWTGC,WTGENTRY-WTG(,RWTG) PTR TO 1ST WTG ENTRY  @ZA04212 54950037
*                                                                       55000037
CCM00510 EQU   *                        PROCESS DCB            @ZA04212 55050037
*                                                                       55100037
         MVI   DXECB,K32                REINITIALIZE ECB       @ZA29604 55120037
         CLC   WTGIDTTR(K2),ID2B2B      CHECK FOR THIS MODULE  @ZA04212 55150037
         BNE   CCM00550                 BRANCH IF WRONG MODULE @ZA04212 55200037
*                                                                       55250037
         L     RCORE,WTGCORE-K1         GET WORK AREA PTR      @ZA04212 55300037
         LA    RCORE,FORCORE            CLEAR HI BYTE          @ZA04212 55350037
         LTR   RCORE,RCORE              TEST FOR WORK AREA     @ZA04212 55400037
         BZ    CCM00550                 BRANCH IF INVALID      @ZA04212 55450037
*                                                                       55500037
         CR    RD,RCORE                 VERIFY RIGHT AREA      @ZA04212 55550037
         BNE   CCM00550                 BRANCH IF NOT          @ZA04212 55600037
*                                                                       55650037
         L     RTIOT,DXTIOTAD           GET CURRENT TIOT PTR   @ZA04212 55700037
         L     RUCB,DXUCBADR            GET CURRENT UCB ADDR   @ZA04212 55750037
         L     RDCB,DXPDCBAD            LOAD DCB COPY          @ZA04212 55800037
         L     RDEB,DCBDEBAD            LOAD DEB ADDR          @ZA04212 55850037
*                                                                       55900037
         TM    WTGPATHS,WTGTCLOS        TEST FOR TCLOSE        @ZA04212 55950037
         BZ    CCM00600                 BRANCH IF NOT TCLOSE   @ZA04212 56000037
         NI    DXATALL,ALLBITS-DXATFC   RESET NSL BIT          @ZA04212 56050037
         B     CCM00600                 BRANCH TO NEXT DCB     @ZA04212 56100037
*                                                                       56150037
CCM00550 EQU   *                        GET NEXT DCB           @ZA04212 56200037
*                                                                       56250037
         TM    DXDCBLST,LASTNTRY        IS THIS THE LAST DCB   @ZA04212 56300037
         LA    RPARC,DXDCBLST+L'DXDCBLST GET NEXT PARM PTR     @ZA04212 56350037
         LA    RWTGC,WTGENTRY+L'WTGENTRY GET NEXT ENTRY PTR    @ZA04212 56400037
         BNO   CCM00510                 NO, BRANCH             @ZA04212 56450037
         B     CCM00610                 BRANCH OUT IF ALL DONE @ZA04212 56500037
*                                                                       56550037
CCM00600 EQU   *                        GET NEXT DCB           @ZA04212 56600037
*                                                                       56650037
         TM    DXDCBLST,LASTNTRY        IS THIS THE LAST DCB   @ZA04212 56700037
         LA    RPARC,DXDCBLST+L'DXDCBLST GET NEXT PARM PTR     @ZA04212 56750037
         LA    RWTGC,WTGENTRY+L'WTGENTRY GET NEXT ENTRY PTR    @ZA04212 56800037
         BNO   CCM00300                 NO, BRANCH             @ZA04212 56850037
*                                                                       56900037
CCM00610 EQU   *                        PROCESS FOR NSLCTRLO   @ZA04212 56950037
*                                                                       57000037
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX @ZA04212 57050037
         L     RPAR,IECUPRML-IECPREFX(,RF) LOAD PTR TO PARMS   @ZA04212 57100037
         LR    RPARC,RPAR               GET FIRST PARM PTR     @ZA04212 57150037
         LA    RWTGC,WTGENTRY-WTG(,RWTG) PTR TO 1ST WTG ENTRY  @ZA04212 57200037
*                                                                       57250037
CCM00620 EQU   *                        PROCESS DCB            @ZA04212 57300037
*                                                                       57350037
         CLC   WTGIDTTR(K2),ID2B2B      CHECK FOR THIS MODULE  @ZA04212 57400037
         BNE   CCM00700                 BRANCH IF WRONG MODULE @ZA04212 57450037
*                                                                       57500037
         L     RCORE,WTGCORE-K1         GET WORK AREA PTR      @ZA04212 57550037
         LA    RCORE,FORCORE            CLEAR HI BYTE          @ZA04212 57600037
         LTR   RCORE,RCORE              TEST FOR WORK AREA     @ZA04212 57650037
         BZ    CCM00700                 BRANCH IF INVALID      @ZA04212 57700037
*                                                                       57750037
         L     RTIOT,DXTIOTAD           GET CURRENT TIOT PTR   @ZA04212 57800037
         L     RUCB,DXUCBADR            GET CURRENT UCB ADDR   @ZA04212 57850037
         STM   RTIOT,RUCB,DXREG9        SAVE FOR QUED USE      @ZA04212 57900037
*                                                                       57950037
         LTR   RUCB,RUCB                TEST FOR DUMMY         @ZA04212 58000037
         BZ    CCM00700                 BRANCH IF NOT TAPE     @ZA04212 58050037
         TM    UCBTBYT3,UCB3TAPE        TEST FOR TAPE UNIT     @ZA04212 58100037
         BZ    CCM00700                 BRANCH IF NOT TAPE     @ZA04212 58150037
         TM    UCBTFL1,UCBNSLTP         CHECK FOR NSL          @ZA04212 58200037
         BZ    CCM00700                 BRANCH IF NOT NSL      @ZA04212 58250037
*                                                                       58300037
         MVI   DXRESIND,K0              SET WAIT OFF           @ZA04212 58350037
*                                                                       58400037
         L     RDCB,DXPDCBAD            LOAD DCB COPY          @ZA04212 58450037
         L     RDEB,DCBDEBAD            LOAD DEB ADDR          @ZA04212 58500037
         MVC   DXDEBUCB,DEBUCBAD        UCB ADDRESS TO DEB     @ZA04212 58550037
*                                                                       58600037
         TM    DEBOFLGS,DEBOFNSL        CHECK IF NSL OPEN      @ZA04212 58650037
         BNO   CCM00700                 SKIP NSLCTRLO EXIT     @ZA04212 58700037
*                                                                       58750037
         TM    WTGPATHS,WTGTCLOS        TEST FOR TCLOSE        @ZA04212 58800037
         BZ    CCM00630                 BRANCH IF NOT TCLOSE   @ZA04212 58850037
         OI    DXATALL,DXATFC           FORCE CLOSE ON ERROR   @ZA04212 58900037
*                                                                       58950037
CCM00630 EQU   *                        CHECK FOR OUTPUT       @ZA04212 59000037
*                                                                       59050037
         TM    DCBOFLGS,DCBOWRIT        TEST FOR INPUT         @ZA04212 59100037
         BNO   CCM00700                 NO,BR TO CLOSE NSL     @ZA04212 59150037
         OI    DXATOUTA,DXATNSL         SET NSL OUTPUT         @ZA04212 59200037
*                                                                       59250037
CCM00700 EQU   *                        GET NEXT DCB           @ZA04212 59300037
*                                                                       59350037
         TM    DXDCBLST,LASTNTRY        IS THIS THE LAST DCB   @ZA04212 59400037
         LA    RPARC,DXDCBLST+L'DXDCBLST GET NEXT PARM PTR     @ZA04212 59450037
         LA    RWTGC,WTGENTRY+L'WTGENTRY GET NEXT ENTRY PTR    @ZA04212 59500037
         BNO   CCM00620                 NO, BRANCH             @ZA04212 59550037
*                                                                       59600037
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX @ZA04212 59650037
         L     RPAR,IECUPRML-IECPREFX(,RF) LOAD PTR TO PARMS   @ZA04212 59700037
         LR    RPARC,RPAR               GET FIRST PARM PTR     @ZA04212 59750037
         LA    RWTGC,WTGENTRY-WTG(,RWTG) PTR TO 1ST WTG ENTRY  @ZA04212 59800037
*                                                                       59850037
         L     RF,IECRRPRM-IECPREFX(,RF) LOAD RRPLIST          @ZA04212 59900037
         OI    RRFLAGS1-RRPLIST(RF),RRFNSL NSL IN CONTROL      @ZA04212 59950037
*************************************************              @ZA09122 60000037
* MODIFY DXDEBMOD FOR TRAILER LABEL PROCESSING  *              @ZA09122 60004037
*************************************************              @ZA09122 60008037
         MVC   DXDEBMOD(K4),DEBDVMOD    DENS,MODE,UCB ADDR     @ZA09122 60012037
         NI    DXDEBMOD,DX6250          REMOVE USER TRTCH      @ZA09122 60016037
         TM    UCBTBYT2,UCB3TAPE        CHECK FOR 7 TRACK      @ZA09122 60020037
         BZ    CCM00900                 BRANCH, NO.            @ZA09122 60024037
         NI    DXDEBMOD,DXTRTMSK        TURN OFF 6250 BPI BIT  @ZA09122 60028037
CCM00800 EQU   X'28'                    INDICATE TRANSLATOR    @ZA09122 60032037
         OI    DXDEBMOD,CCM00800        SET TRANSLATE MODE     @ZA09122 60036037
CCM00900 EQU   *                        GO TO NSLCTRLO         @ZA09122 60040037
         MODESET EXTKEY=ZERO            NSL ROUTINE KEY        @ZA04212 60050037
*                                                                       60100037
         IECRES LOAD,MODNM=NSLCTRLO,BRCODE=K8,   NSLCTRLO      @ZA07210X60150037
               PREFIX=WTGPREFX,BRANCH=DIRECT                   @ZA04212 60200037
         EJECT                                                          60250037
*                                                                       60300037
CCM01000 EQU   *                        RETURN FROM NSLCTRLO   @ZA04212 60350037
*                                                                       60400037
*********************************************************************** 60450037
*                                                                       60500037
*        RETURN FROM NSLCTRLO                                           60550037
*                                                                       60600037
*********************************************************************** 60650037
*                                                                       60700037
         IECRES LOAD,MODNM=THISMOD,PREFIX=WTGPREFX,BRANCH=NO   @ZA04212 60750037
*                                                                       60800037
         XC    WTGMODEP,WTGMODEP        CLEAR BRANCH ADDR      @ZA04212 60850037
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX @ZA04212 60900037
         L     RPAR,IECUPRML-IECPREFX(,RF) LOAD PTR TO PARMS   @ZA04212 60950037
         L     RF,IECRRPRM-IECPREFX(,RF) LOAD RRPLIST          @ZA04212 61000037
         NI    RRFLAGS1-RRPLIST(RF),ALLBITS-RRFNSL RESET NSL   @ZA04212 61050037
         LR    RPARC,RPAR               GET FIRST PARM PTR     @ZA04212 61100037
         LA    RWTGC,WTGENTRY-WTG(,RWTG) PTR TO 1ST WTG ENTRY  @ZA04212 61150037
*                                                                       61200037
CCM01100 EQU   *                        PROCESS DCB            @ZA04212 61250037
*                                                                       61300037
         MVI   DXECB,K32                RESTORE DXECB          @ZA31147 61320037
         CLC   WTGIDTTR(K2),ID2B2B      CHECK FOR THIS MODULE  @ZA04212 61350037
         BNE   CCM01200                 BRANCH IF WRONG MODULE @ZA04212 61400037
*                                                                       61450037
         L     RCORE,WTGCORE-K1         GET WORK AREA PTR      @ZA04212 61500037
         LA    RCORE,FORCORE            CLEAR HI BYTE          @ZA04212 61550037
         LTR   RCORE,RCORE              TEST FOR WORK AREA     @ZA04212 61600037
         BZ    CCM01200                 BRANCH IF INVALID      @ZA04212 61650037
*                                                                       61700037
         L     RTIOT,DXTIOTAD           GET CURRENT TIOT PTR   @ZA04212 61750037
         L     RUCB,DXUCBADR            GET CURRENT UCB ADDR   @ZA04212 61800037
         MVI   DXRESIND,K0              SET WAIT OFF           @ZA04212 61850037
*                                                                       61900037
         L     RDCB,DXPDCBAD            LOAD DCB COPY          @ZA04212 61950037
         L     RDEB,DCBDEBAD            LOAD DEB ADDR          @ZA04212 62000037
         MVC   DXDEBUCB(K6),DEBUCBAD    UCB ADDRESS TO DEB     @ZA04212 62050037
*                                                                       62100037
         TM    WTGPATHS,WTGTCLOS        CHECK FOR TCLOSE       @ZA04212 62150037
         BZ    CCM01110                 BRANCH IF NOT TCLOSE   @ZA04212 62200037
         MVC   WTGMODNM,TCLOSE          SETUP TO RETURN TCLOSE @ZA04212 62250037
         MVC   WTGIDTTR,IFG0202U        SETUP FOR IFG0232Z     @ZA04212 62300037
         MVC   WTGIDTTR(K2),ID2B2Z      SETUP ALIAS ENTRY      @ZA04212 62350037
         LA    RET,K4                   SET BRANCH TABLE ENTRY @ZA04212 62400037
         B     CCM01150                 BRANCH, CHECK NEXT DCB @ZA04212 62450037
*                                                                       62500037
CCM01110 EQU   *                        CHECK NEXT LOAD        @ZA04212 62550037
*                                                                       62600037
         TM    UCBFL1,UCBNOTRD          CHECK IF VOL MTD       @ZA04212 62650037
         BO    CCM01120                 BRANCH IF NOT MTD      @ZA04212 62700037
         TM    DXDCBLST,PLISTLV         LEAVE OR REREAD        @ZA04212 62750037
         BNZ   CCM01120                 BRANCH IF EITHER       @ZA04212 62800037
*        ASSUME POSITIONING TO BE DONE IN IFG0202F                      62850037
         MVC   WTGIDTTR,IFG0202F        POSITIONING MOD        @ZA04212 62900037
         LA    RET,K4                   BRANCH TABLE ENTRY     @ZA04212 62950037
         B     CCM01150                 BRANCH, CHECK NEXT DCB @ZA04212 63000037
*                                                                       63050037
CCM01120 EQU   *                        CHECK NEXT LOAD        @ZA04212 63100037
*                                                                       63150037
         MVC   WTGIDTTR,IFG0202J        FINISH UP DCB          @ZA04212 63200037
         XR    RET,RET                  BRANCH TABLE ENTRY     @ZA04212 63250037
*                                                                       63300037
CCM01150 EQU   *                        SAVE REGISTERS         @ZA04212 63350037
*                                                                       63400037
         STM   RTIOT,RET,DXREG9         STORE FOR QUEUED PROC  @ZA04212 63450037
*                                                                       63500037
CCM01200 EQU   *                        WRONG MODULE           @ZA04212 63550037
*                                                                       63600037
         TM    DXDCBLST,LASTNTRY        IS THIS THE LAST DCB   @ZA04212 63650037
         LA    RPARC,DXDCBLST+L'DXDCBLST GET NEXT PARM PTR     @ZA04212 63700037
         LA    RWTGC,WTGENTRY+L'WTGENTRY GET NEXT ENTRY PTR    @ZA04212 63750037
         BNO   CCM01100                 NO, BRANCH             @ZA04212 63800037
*                                                                       63850037
         L     RF,WTGPREFX              LOAD POINTER TO PREFIX @ZA04212 63900037
         L     RPAR,IECUPRML-IECPREFX(,RF) LOAD PTR TO PARMS   @ZA04212 63950037
         LR    RPARC,RPAR               GET FIRST PARM PTR     @ZA04212 64000037
         LA    RWTGC,WTGENTRY-WTG(,RWTG) PTR TO 1ST WTG ENTRY  @ZA04212 64050037
         L     RES,CVTPTR               LOAD CVT POINTER       @ZA04212 64100037
         L     RES,CVTDMSR-CVT(,RES)    RESTORE RESIDENT PTR   @ZA04212 64150037
*                                                                       64200037
CCM01500 EQU   *                        NOT LAST DCB           @ZA04212 64250037
*                                                                       64300037
         L     RCORE,WTGCORE-K1         GET WORK AREA PTR      @ZA04212 64350037
         LA    RCORE,FORCORE            CLEAR HI BYTE          @ZA04212 64400037
         LTR   RCORE,RCORE              TEST FOR WORK AREA     @ZA04212 64450037
         BNZ   CCM02000                 BRANCH IF VALID        @ZA04212 64500037
*                                                                       64550037
         TM    DXDCBLST,LASTNTRY        IS THIS THE LAST DCB   @ZA04212 64600037
         LA    RPARC,DXDCBLST+L'DXDCBLST GET NEXT PARM PTR     @ZA04212 64650037
         LA    RWTGC,WTGENTRY+L'WTGENTRY GET NEXT ENTRY PTR    @ZA04212 64700037
         BNO   CCM01500                 NO, BRANCH             @ZA04212 64750037
*                                                                       64800037
CCM02000 EQU   *                        RIGHT MODULE           @ZA04212 64850037
*                                                                       64900037
         L     RDCB,DXPDCBAD            LOAD DCB POINTER       @ZA04212 64950037
         LM    RTIOT,RET,DXREG9         RELOAD                 @ZA07184 65000037
         LM    R0,R1,DXREG0             REGISTERS              @ZA07184 65050037
         IECRES LOAD,BRANCH=QUEUED      GOTO NEXT LOAD         @ZA04212 65100037
*                                                                Y02134 65150037
         EJECT                                                          65200037
*                                                                       65250037
*********************************************************************** 65300037
*                                                                       65350037
*        CONSTANTS                                                      65400037
*                                                                       65450037
*********************************************************************** 65500037
*                                                                       65550037
ID2B2Y   DC    CL2'2Y'                  IFG0232Y ALIAS         @ZA05231 65560037
ID2B2Z   DC    CL2'2Z'                  IFG0202U ALIAS         @ZA04212 65600037
*                                                                       65650037
         XCTLTABL ID=(ID2B2B,2B,,2H,,2F,,2U,,2J,               @ZA04212X65700037
               THISMOD,IFG0202B,TCLOSE,IFG0232Y,               @ZA04212X65750037
               RETETRLI,IFG0556B,RETCTRLO,IGG0200B,            @ZA04212X65800037
               ,NSLETRLI,,NSLCTRLO),                           @ZA04212X65850037
               SVC=020,BRT=YES,LENGTH=                         @ZA04212 65900037
*                                                                       65950037
         IECDSECS CVT,TCB,TIOT,DCB,DEB,UCB,PSA,                @ZA04212X66000037
               MAIN,WTG,PREFX,RRPL,                            @ZA04212X66050037
               EXPAND=YES                                      @ZA04212 66100037
*                                                                       66150037
         IECEQU                                                         66200037
         END                                                            66250037
