         TITLE 'IFG0202F - VOLUME DISPOSITION'                          00100021
IFG0202F CSECT                                                          00400021
*********************************************************************** 00500021
*                                                                     * 00600021
*                                                                     * 00700021
*          RELEASE 21 DELETIONS/CHANGES                               * 01200021
*0000                                                            M1767  01210021
*0000018000,025000,028000,031000,087000,094000-166000,187000,    A38013 01230021
*0000192000-200000,488000,495000,608000,625000                   A38013 01260021
*                                                               SA55570 01270021
*                                                                     * 01300021
* MODULE NAME = IFG0202F                                              * 01350002
*                                                                     * 01360002
* DESCRIPTIVE NAME = VOLUME DISPOSITION                               * 01370002
*                                                                     * 01380002
* COPYRIGHT = NONE                                                    * 01390002
*                                                                     * 01392002
* STATUS CHANGE LEVEL 000                                             * 01400021
*                                                                     * 01500021
* FUNCTION -                                                          * 01600021
*    THIS MODULE CONTAINS THE FUNCTION(S) OR PART(S) OF FUNCTION(S)-- * 01700021
*    CLOSE TAPE VOLUME DISPOSITION FUNCTION.                          * 01900021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)' FOR DETAILS.         * 02000021
*                                                                     * 02100021
* ENTRY POINTS -                                                      * 02200021
*         IFG0202F - ENTRY POINT VIA AN XCTL FROM THE FOLLOWING--     * 02300021
*             INITIAL ENTRY--                                         * 02400021
*                IFG0200Y - PROCESS CLOSE TAPE VOLUME DISPOSITION     * 02500021
*                IFG0202A   FUNCTION.                                 * 02600021
*             SECOND ENTRY--                                          * 02700021
*                IFG0202B - PROCESS CLOSE TAPE VOLUME DISPOSITION     * 02800021
*                           FUNCTION.                                 * 02900021
*             THIRD ENTRY--                                           * 03000021
*                IFG0200Z - PROCESS CLOSE TAPE VOLUME DISPOSITION     * 03100021
*                           FUNCTION.                                 * 03200021
*             FOURTH ENTRY--                                          * 03220021
*                IFG0202H - PROCESS CLOSE TAPE VOLUME DISPOSITION     * 03240021
*                           FUNCTION.                                 * 03260021
*                                                                     * 03300021
* INPUT -                                                             * 03400021
*    ENTERED IN DATA MANAGEMENT KEY                              Y02082 03450002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 03500021
*                                                                     * 03600021
* OUTPUT -                                                            * 03700021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 03750002
*    DATA MANAGEMENT COUNT DECREMENTED                           YM6559 03760002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 03800021
*                                                                     * 03900021
* EXTERNAL REFERENCES -                                               * 04000021
*         IFG019RA - OPEN/CLOSE/EOV RESIDENT ROUTINE FOR XCTL AND     * 04100002
*                    WAIT.                                            * 04200021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 04300021
*                                                                     * 04400021
* EXITS, NORMAL -                                                     * 04500021
*    EXIT VIA THE RESIDENT ROUTINE XCTL TO THE FOLLOWING--            * 04600021
*         IFG0202H - PROCESS CLOSE/EOV SMF DATA SET FUNCTION.         * 04650021
*         IFG0202J - PROCESS CLOSE FINAL STRING.                      * 04900021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 05000021
*                                                                     * 05100021
* EXITS, ERROR -                                                      * 05200021
*    EXIT IS TO THE PROBLEM DETERMINATION MODULE IFG0200P, IF AN      * 05300021
*    ABEND SITUATION OCCURS IN THIS MODULE.  REFER TO THE FOLLOWING   * 05400021
*    'FUNCTION PROLOG(S)'.                                            * 05500021
*                                                                     * 05600021
* TABLES/WORK AREAS -                                                 * 05700021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 05800021
*                                                                     * 05900021
* ATTRIBUTES -                                                        * 06000021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 06100021
*                                                                     * 06200021
* CHARACTER CODE DEPENDENCY -                                         * 06300021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 06400021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 06500021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 06600021
*                                                                     * 06700021
* NOTES -                                                             * 06800021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 06900021
*                                                                     * 07000021
*********************************************************************** 07100021
         EJECT                                                          07200021
         USING IHADCB,RDCB                                              07300021
         USING FORCORE,RCORE                                            07400021
         USING TCB,RET                                                  07500021
         USING UCBOB,RUCB                                               07600021
         USING CVT,RD                                                   07700021
         USING TIOENTRY,RTIOT                                           07800021
         USING DEB,RDEB                                                 07900021
         USING WTG,RWTG                                          A38013 07930021
         USING WTGENTRY,RWTGC                                    A38013 07960021
         BALR  RBASE,0                  ESTABLISH BASE REGISTER         08000021
         USING *,RBASE                                                  08100021
*                                                                       08200021
         MVI   DXCCW5+4,K0              ZERO INDICATOR USED      M1767  08250021
*                                       IN DETERMINING IF        M1767  08260021
*                                       CLOSE SHOULD ABEND       M1767  08270021
         B     CTA06600(RET)            USE BRANCH TABLE                08300021
CTA06600 EQU   *                                                        08400021
         B     CTA06800                 ENTRY FOR VOL DISP.             08500021
         B     CTA08800                 ENTRY FROM NSL RTN              08600021
         B     CTA06700                 ENTRY FROM SL RTN        A38013 08640021
         B     CTA06850                 RETURN FROM SMF RTN      A38013 08680021
         SPACE 3                                                 A38013 08720021
CTA06700 EQU   *                                                 A38013 08760021
         IECRES WAIT                    WAIT FOR TRL2                   08800021
         TM    IOBSTAT0,CSWUNITX        UNIT EXCEPTION                  08900021
         BO    CTA06750                 BRANCH IF YES TO CONTINUEY02144 09000002
         TM    DXECB,ECBNOERR           TEST FOR PERM I/O ERROR         09100021
         BC    12,CTA10600              BRANCH IF ERROR                 09200021
CTA06750 EQU   *                        INDICATE LABELS WRITTEN  Y02144 09250002
         OI    DXATOUTA,DXATTRL2        SHOW TRL2 WRITTEN        Y02144 09260002
         EJECT                                                          09300021
*                                                                     * 16700021
*                          FUNCTION PROLOG                            * 16800021
*                                                                     * 16900021
*********************************************************************** 17000021
*                                                                     * 17100021
* FUNCTION NAME -                                                     * 17200021
*    CLOSE TAPE VOLUME DISPOSITION FUNCTION.                          * 17300021
*                                                                     * 17400021
* (STATUS) -                                                          * 17500021
*    NOT APPLICABLE                                                   * 17600021
*                                                                     * 17700021
* FUNCTION -                                                          * 17800021
*    INTERFACE WITH SMF DATA SET FUNCTION IF THE DATA SET IS NOT      * 17820021
*    SYSIN OR SYSOUT.                                                 * 17840021
*    ISSUE SVC 91 (VOLSTAT) IF THE VOLUME STATISTICS FEATURE IS IN    * 17860021
*    EFFECT.                                                          * 17880021
*    DETERMINE DISPOSITION SPECIFIED AND POSITION TAPE ACCORDINGLY.   * 17900021
*    IF THERE IS NO CLOSE DISPOSITION, THE DISPOSITION IN THE TASK    * 18000021
*    INPUT/OUTPUT TABLE IS TAKEN.  THE TAPE IS REWOUND OR REWOUND AND * 18100021
*    UNLOADED AND AN APPROPRIATE MESSAGE IS ISSUED. IF NO TIOT        * 18200021
*    DISPOSITION IS SPECIFIED, A LEAVE DISPOSITION IS ASSUMED.        * 18300021
*                                                                     * 18400021
* ENTRY POINTS -                                                      * 18500021
*    ENTERED FROM THE FOLLOWING--                                     * 18600021
*    CLOSE TAPE ACCESS METHOD EXECUTOR INTERFACE FUNCTION.            * 18640021
*    CLOSE TAPE STANDARD TRAILER LABEL FUNCTION.                      * 18680021
*    CLOSE TAPE STANDARD USER LABEL FUNCTION.                         * 18720021
*    CLOSE/EOV SMF DATA SET FUNCTION.                                 * 18760021
*    CLOSE TAPE NONSTANDARD LABEL FUNCTION.                           * 18800021
*                                                                     * 18900021
* INPUT -                                                             * 19000021
*    A POINTER TO EACH OF THE FOLLOWING--                             * 19100021
*       CURRENT PARAMETER LIST ENTRY- RPARC                           * 19200021
*       DD ENTRY IN THE TIOT- RTIOT                                   * 19300021
*       WTG TABLE- RWTG                                               * 19400021
*       CURRENT WTG TABLE ENTRY- RWTGC                                * 19500021
*       DCB- RDCB                                                     * 19600021
*       WORK AREA- RCORE                                              * 19700021
*       RESIDENT ROUTINE- RES                                         * 19800021
*       UCB- RUCB                                                     * 19900021
*       DEB- RDEB                                                     * 20000021
*                                                                     * 20100021
* OUTPUT -                                                            * 20200021
*    TAPE POSITIONED ACCORDING TO DISPOSITION.                        * 20300021
*                                                                     * 20400021
* EXTERNAL REFERENCES -                                               * 20500021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 20600021
*                                                                     * 20700021
* EXITS, NORMAL -                                                     * 20800021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 20900021
*    CLOSE FINAL STRING.                                              * 21000021
*                                                                     * 21100021
* EXITS, ERROR -                                                      * 21200021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 21300021
*    EXIT WITH THE FOLLOWING INTERNAL CODE--                          * 21400021
*       65 - 214 ABEND - ERROR IN POSITIONING THE TAPE.               * 21500021
*                                                                     * 21600021
* TABLES/WORK AREAS -                                                 * 21700021
*    THE OPEN, CLOSE, OR EOV WORK AREA AND THE WHERE-TO-GO (WTG)      * 21800021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 21900021
*                                                                     * 22000021
* ATTRIBUTES -                                                        * 22100021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 22200021
*                                                                     * 22300021
* CHARACTER CODE DEPENDENCY -                                         * 22400021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 22500021
*                                                                     * 22600021
* NOTES -                                                             * 22700021
*    NOT APPLICABLE                                                   * 22800021
*                                                                     * 22900021
*********************************************************************** 23000021
         EJECT                                                          23100021
CTA06800 EQU   *                                                 A38013 23106021
         TM    WTGPATHS,WTGSMF          SMF REQUESTED            A38013 23112021
         BZ    CTA06850                 BRANCH IF NOT            A38013 23118021
         SR    RET,RET                  SET BRANCH OFFSET        A38013 23136021
         LA    RF,SMFMOD                SET UP FOR XCTL TO SMF   A38013 23142021
         MVC   DXRETMOD,VOLDPMOD        MOVE IN RETURN IDTTR     A38013 23148021
         B     CTA09525                 BRANCH TO SMF STRING     YM6559 23154002
         SPACE 3                                                 A38013 23160021
CTA06850 EQU   *                                                 A38013 23166021
         L     RDEB,DCBDEBAD            DEB ADDRESS                     23200021
         MVC   DXCCW1(K16),ABSFCCW      SET UP TWO CCW'S                23300021
         MVC   DXDEBUCB(K6),DEBUCBAD    USER'S UCB ADDR TO CLOSE DEB    23400021
         TM    UCBFL1,UCBNOTRD          IS DEVICE READY                 23700021
         BO    CTA09400                 NO, BRANCH TO FINAL PROCESSING  23800021
*                                                                       23900021
         MODESET EXTKEY=SUPR            UCB/TIOT KEY             Y02082 23950002
         NI    UCBWGT,X'FF'-UCBREW      INSURE REWIND BIT OFF    Y02080 24000002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 24050002
         TM    DCBOFLGS,DCBOWRIT        IS TRAILER SWITCH ON            24100021
         BNO   CTA07000                 BR IF TRLR SWITCH OFF           24200021
         EJECT                                                          24300021
*                                                                       24400021
*****   OUTPUT TAPE PROCESSING                                          24500021
*                                                                       24600021
*                                                                       24700021
*        WRITE TWO TAPE MARKS                                           24800021
*        FOR STANDARD LABEL, TAPE MARKS FOLLOW LABEL                    24900021
*        FOR UNLABELED TAPE, TAPE MARKS FOLLOW DATA                     25000021
*                                                                       25100021
         MVI   DXCCW1,CCWWTM            SET UP CCW FOR WTM              25200021
         MVI   DXCCW1+K4,CCWCMDCH+CCWSILI  CHAIN A NOP                  25300021
         MVI   DXCCW2,CCWNOP            SET CCW FOR NOP                 25400021
         LA    RD,K1                    LOAD COUNT FOR BSF              25500021
         BAL   RC,CTA10200              WRITE FIRST TM                  25600021
         OI    DXATOUTA,DXATTTM1        SHOW 1 OF 2 TM'S WRITTEN Y02144 25650002
         BAL   RC,CTA10200              WRITE SECOND TM                 25700021
         OI    DXATOUTA,DXATTTM2        SHOW 2 OF 2 TM'S WRITTEN Y02144 25750002
         LA    RD,K1                    LOAD COUNT FOR BSF              25800021
         BAL   RC,CTA09550              BRANCH TO EXECUTE CHANNEL PGM   25900021
*                                                                       26000021
         TM    PLISTOPT(RPARC),PLISTLV  CK FOR LEAVE DISPOSITION        26300021
         BO    CTA08700                 BRANCH IF LEAVE          YM7526 26400002
         TM    PLISTOPT(RPARC),PLISTRRD CK FOR REREAD DISPSITION YM7526 26500002
         BO    CTA06900                 BRANCH IF REREAD                26600021
         TM    PLISTOPT(RPARC),CLOSEREW TEST FOR REWIND          YM7526 26650002
         BO    CTA09300                 BRANCH IF REWIND         YM7526 26660002
         TM    UCBJBNR,UCBMONT          TEST FOR PASS            YM7526 26700002
         BO    CTA08700                 BRANCH IF PASS           YM7526 26800002
         B     CTA09300                 BRANCH IF DISP/FREE      YM7526 26850002
*                                                                       26900021
CTA06900 EQU   *                                                        27000021
*                                                                       27100021
         LA    RC,K1                    SET COUNT TO ONE         YM7526 27200002
         CH    RC,UCBFSCT               CHECK SEQ FOR FIRST FILE        27300021
         BNL   CTA09300                 BR IF ON FIRST           YM7526 27400002
         B     CTA08300                 BRANCH IF NOT FIRST FILE        27500021
         EJECT                                                          27600021
*                                                                       27700021
*****     INPUT TAPE PROCESSING                                         27800021
*                                                                       27900021
CTA07000 EQU   *                                                        28000021
*                                                                       28100021
         TM    PLISTOPT(RPARC),PLISTLV  CK FOR LEAVE DISPOSITION        28200021
         BO    CTA07100                 BR IF LEAVE SPECIFIED           28300021
         TM    PLISTOPT(RPARC),PLISTRRD  CK FOR REREAD DISPOSITION      28400021
         BO    CTA07900                 BRANCH IF REREAD                28500021
         TM    PLISTOPT(RPARC),CLOSEREW TEST FOR REWIND          YM7526 28600002
         BO    CTA09300                 BRANCH IF REWIND SPECFD  YM7526 28650002
         TM    UCBJBNR,UCBMONT          TEST FOR DISP=PASS       YM7526 28670002
         BNO   CTA09300                 BRANCH IF NOT PASS       YM7526 28680002
*                                                                       28700021
**********************************************************************  28800021
*                                                                       28900021
*****         LEAVE SPECIFIED                                           29000021
*                                                                       29100021
CTA07100 EQU   *                                                        29200021
*                                                                       29300021
         TM    DCBOFLGS,DCBORDBK        TEST FOR READ BACKWARD          29400021
         BO    CTA07600                 BR IF READ BACKWARD             29500021
         TM    DEBOFLGS,DEBOFEOF        TEST IF DEB EOF ON              29600021
         BO    CTA08700                 YES, BR OUT                     29700021
*                                                                       29800021
*****     IF TAPE MARK SENSED, 0 FSF FOR UNLABELED TAPE                 29900021
*****                          1 FSF FOR STANDARD LABELED TAPE          30000021
*****     IF TAPE MARK NOT SENSED, 1 FSF FOR UNLABELED TAPE             30100021
*****                              2 FSF FOR STANDARD LABELED TAPE      30200021
*                                                                       30300021
         SR    RD,RD                    SET COUNT TO ZERO               30400021
         TM    DCBOFLGS,DCBOEOF         CK FOR A TAPE MARK              30500021
         BO    CTA07300                 BR IF TM SENSED                 30600021
*                                                                       30700021
CTA07200 EQU   *                                                        30800021
*                                                                       30900021
         LA    RD,K1(RD)                INCREMENT COUNT BY 1            31000021
*                                                                       31100021
CTA07300 EQU   *                                                        31200021
*                                                                       31300021
         TM    JFCBLTYP,JFCBAL+JFCSL    TEST FOR SL AND AL              31400021
         BZ    CTA07500                 BR IF NOT SL OR AL              31500021
         LA    RD,K1(RD)                INCREMENT COUNT BY 1            31600021
CTA07400 EQU   *                                                        31700021
         LA    RC,CTA08700              SET RETURN ADDR FOR I/O RTN     31800021
         B     CTA09600                 BR TO FSF RTN                   31900021
*                                                                       32000021
CTA07500 EQU   *                        POSITION TAPE                   32100021
*                                                                       32200021
         LTR   RD,RD                    IS COUNT ZERO                   32300021
         BZ    CTA08700                 BR IF YES, DO NOT GO TO FSF     32400021
         B     CTA07400                 BR TO FSF RTN                   32500021
*                                                                       32600021
*****          READ BACKWARDS                                           32700021
*                                                                       32800021
CTA07600 EQU   *                                                        32900021
*                                                                       33000021
         TM    DEBOFLGS,DEBOFEOF        TEST IF DEB EOF ON              33100021
         BO    CTA07800                 YES, BR TO CK LABEL             33200021
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ            33300021
         BO    CTA07700                 YES, BR TO CK LABEL             33400021
         LA    RD,K1                    SET COUNT TO 1                  33500021
         MVI   DXCCW5+K4,K1             SET SW NOT TO ABEND AFTER NOP   33600021
         BAL   RC,CTA09550              BR TO BSF RTN                   33700021
*                                                                       33800021
CTA07700 EQU   *                                                        33900021
*                                                                       34000021
         TM    JFCBLTYP,JFCBAL+JFCSL    TEST FOR SL AND AL              34100021
         BZ    CTA08500                 BRANCH IF NOT STD OR ANSI       34200021
         TM    IOBSENS1,UCBLDPT         CK FOR BOT                      34300021
         BO    CTA10400                 BR TO ABEND-POSITIONING ERROR   34400021
         LA    RD,K1                    SET COUNT TO 1                  34500021
         B     CTA08400                 BR TO BSF RTN                   34600021
*                                                                       34700021
*****         EOF BIT ON                                                34800021
CTA07800 EQU   *                                                        34900021
         TM    JFCBLTYP,JFCBAL+JFCSL    TEST FOR SL AND AL              35000021
         BNZ   CTA09400                 YES, BRANCH OUT                 35100021
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ            35200021
         BO    CTA08600                 YES, BR TO POSITION TAPE        35300021
         B     CTA09400                 BRANCH TO DO NOT PROCESS        35400021
*                                                                       35500021
**********************************************************************  35600021
*                                                                       35700021
*****          REREAD SPECIFIED                                         35800021
*                                                                       35900021
CTA07900 EQU   *                                                        36000021
*                                                                       36100021
         TM    DCBOFLGS,DCBORDBK        IS IT READ BACKWARD             36200021
         BO    CTA08200                 BRANCH IF YES                   36300021
         LA    RC,K1                    SET COUNT TO ONE                36400021
         CH    RC,UCBFSCT               CHECK SEQ FOR FIRST FILE        36500021
         BE    CTA09300                 BRANCH IF FIRST FILE     YM7526 36600002
         TM    DEBOFLGS,DEBOFEOF        TEST IF DEB EOF ON              36700021
         BO    CTA08300                 YES, BR TO CK LABEL             36800021
*                                                                       36900021
*****          NOT FIRST FILE                                           37000021
*                                                                       37100021
*****     IF TAPE MARK SENSED, 2 BSF FOR UNLABELED TAPE                 37200021
*****                          3 BSF FOR STANDARD LABELED TAPE          37300021
*****     IF TAPE MARK NOT SENSED, 1 BSF FOR UNLABELED TAPE             37400021
*****                              2 BSF FOR STANDARD LABELED TAPE      37500021
*                                                                       37600021
*                                                                       37700021
         LA    RD,K1                    SET COUNT TO 1                  37800021
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ            37900021
         BZ    CTA08000                 BR IF NO TAPE MARK WERE READ    38000021
         LA    RD,K1(RD)                INCREMENT COUNT BY 1            38100021
*                                                                       38200021
CTA08000 EQU   *                                                        38300021
*                                                                       38400021
         TM    JFCBLTYP,JFCBAL+JFCSL    TEST FOR SL AND AL              38500021
         BZ    CTA08100                 BR IF NOT SL OR AL              38600021
*                                                                       38700021
*                                                                       38800021
         LA    RD,K1(RD)                INCREMENT COUNT BY 1            38900021
CTA08100 EQU   *                                                        39000021
         B     CTA08400                 BR TO BSF RTN                   39100021
*                                                                       39200021
*****          READ BACKWARDS                                           39300021
*                                                                       39400021
CTA08200 EQU   *                                                        39500021
*                                                                       39600021
*                                                                       39700021
*****     IF TAPE MARK SENSED, 2 FSF FOR UNLABELED TAPE                 39800021
*****                          3 FSF FOR STANDARD LABELED TAPE          39900021
*****     IF TAPE MARK NOT SENSED, 1 FSF FOR UNLABELED TAPE             40000021
*****                              2 FSF FOR STANDARD LABELED TAPE      40100021
*                                                                       40200021
         LA    RD,K1                    SET COUNT TO 1                  40300021
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ            40400021
         BNO   CTA07300                 BR IF NOT                       40500021
         B     CTA07200                 BR TO CHECK LABEL               40600021
         EJECT                                                          40700021
         SPACE 1                                                        40800021
*                                                                       40900021
*****          FUNCTIONS USED BY BOTH INPUT AND OUTPUT PROCESSING       41000021
*                                                                       41100021
CTA08300 EQU   *                                                        41200021
*                                                                       41300021
*****     2 BSF FOR UNLABELED TAPE                                      41400021
*****     4 BSF FOR STANDARD LABELED TAPE                               41500021
*                                                                       41600021
         LA    RD,K2                    SET COUNT TO 2                  41700021
         TM    JFCBLTYP,JFCBAL+JFCSL    TEST FOR SL AND AL              41800021
         BZ    CTA08400                 BR IF NOT SL OR AL              41900021
         LA    RD,K2(RD)                INCREMENT COUNT BY 2            42000021
CTA08400 EQU   *                                                        42100021
         MVI   DXCCW5+K4,K1             SET SW NOT TO ABEND AFTER NOP   42200021
         BAL   RC,CTA09550              BRANCH TO BSF ROUTINE           42300021
CTA08500 EQU   *                                                        42400021
         TM    IOBSENS1,UCBLDPT         CK FOR LOAD POINT               42500021
         BO    CTA09400                 BRANCH IF AT LOAD POINT         42600021
CTA08600 EQU   *                                                        42700021
         LA    RD,K1                    SET COUNT TO 1                  42800021
         LA    RC,CTA09400              SET RETURN ADDR FOR I/O RTN     42900021
         B     CTA09600                 GO TO FSF RTN                   43000021
*                                                                       43100021
*        INCREMENT FILE SEQUENCE NUMBER IN SRT                          43200021
*                                                                       43300021
CTA08700 EQU   *                                                        43400021
*                                                                       43500021
         LH    RF,UCBFSEQ               GET FILE SEQUENCE NUMBER        43600021
         LA    RF,K1(,RF)               INCREMENT FIL SEQ COUNTER       43700021
         MODESET EXTKEY=SUPR            UCB/TIOT KEY             Y02082 43750002
         STH   RF,UCBFSEQ               PUT BACK UPDATED FILE SEQUENCE  43800021
         LH    RF,UCBFSCT               GET FIL SEQ COUNT               43900021
         LA    RF,K1(,RF)               INCR FIL SEQ COUNT              44000021
         STH   RF,UCBFSCT               PUT BACK UPDATED FIL SEQ COUNT  44100021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 44150002
         B     CTA09400                 BRANCH TO FINAL ROUTINE         44200021
*                                                                       44300021
CTA08800 EQU   *                                                        44400021
*                                                                       44900021
*        TEST FOR CLOSE REWIND OPTION-USASI COBOL                       45000021
*                                                                       45100021
         TM    PLISTOPT(RPARC),CLOSEREW  CHECK FOR REWIND OPTION        45200021
         BO    CTA09300                 BRANCH IF REWIND         YM7526 45300002
         TM    UCBJBNR,UCBMONT          TEST FOR DISP=PASS       YM7526 45400002
         BO    CTA09400                 BRANCH IF PASS           YM7526 45450002
*                                                                       45900021
*****          FIRST FILE                                               46000021
*                                                                       48200021
CTA09300 EQU   *                                                        48300021
*                                                                       48400021
         MODESET EXTKEY=ZERO            UCB KEY                  YM7834 48400402
*                                                                YM7834 48400802
         XC    UCBFSCT,UCBFSCT          FORCE REWIND             YM7834 48401202
         XC    UCBFSEQ,UCBFSEQ          CLEAR FILE COUNTERS      YM7834 48401602
*                                                                YM7834 48401702
         MODESET EXTKEY=DATAMGT         DM KEY                   YM7834 48401802
*                                                                YM7834 48401902
         MVC   DXVOLSR1,UCBVOLI         SETUP VOLSER             YM7526 48426002
         MVC   DXRETMOD,FINALMOD        RETURN TO FINAL LOADS    Y02134 48438002
         MVI   DXRETCOD,K0              SET UP RETURN OFFSET     Y02134 48450002
         LA    RET,K4                   LOAD VOLUME DISP OFFSET  Y02134 48780002
         LA    RF,ID2F4A                LOAD VOL DISP ROUTINE    Y02134 48900002
         B     CTA09500                 BRANCH TO XCTL                  49000021
*                                                                       49100021
CTA09400 EQU   *                                                        49200021
         LA    RF,FINALMOD              LOAD ADDR OF FINAL LOAD         49300021
         XR    RET,RET                  SET ENTRY OFFSET         YM7526 49350002
CTA09500 EQU   *                                                        49400021
         MODESET EXTKEY=SUPR            UCB KEY                  YM6559 49450002
         MVI   UCBDMCT,K0               ZERO DATA MANAGEMENT CT  YM6559 49500002
*                                       BEFORE GOING TO 4A OR 2J YM6559 49550002
         MODESET EXTKEY=DATAMGT         RETURN TO D. M. KEY      YM6559 49600002
         OI    DXATEOV,DXATNVOL         INDICATOR TO RECOVERY    YM6559 49610002
CTA09525 EQU   *                        TRANSFER CONTROL         YM6559 49620002
         IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED       Y02080 49650002
*                                     XCTL TO WTOMOD OR FINALMOD Y02080 49660002
         EJECT                                                          49700021
         SPACE 1                                                        49800021
**********                    MACRO                                     49900021
*                                                                       50000021
         SPACE 1                                                        50100021
*          CLOSE SUBROUTINES TO BUILD CHANNEL PROGRAMS                  50200021
*                                                                       50300021
*        ENTRY TO THE ROUTINE IS AS FOLLOWS-                            50400021
*           BAL   RC,CTA09600       OR                                  50500021
*           BAL   RC,CTA09550                                           50600021
*        REGISTERS MUST BE INITIALIZED AS FOLLOWS-                      50700021
*           REG D  COUNT FOR THE OPERATION                              50800021
*        RETURN TO THE CALLING ROUTINE TAKES PLACE AS FOLLOWS-          50900021
*           BR    RC                                                    51000021
*                                                                       51100021
*        THE CONDITION CODE WILL HAVE BEEN SET TO '1' IF AN I/O         51200021
*        ERROR HAS OCCURED.                                             51300021
*        IN CASE OF ERROR CODITION, THIS ROUTINE WILL PASS              51400021
*        CONTROL TO ERROR PROCESSING.                                   51500021
*        ALL CONTROL OPERATION WILL RETURN TO CALLER VIA NOP ROUTINE    51600021
         SPACE 1                                                        51700021
CTA09550 EQU   *                                                        51800021
         MVC   DXCCW1,ABSFCCW           SET UP BSF CCW                  51900021
         B     CTA09700                 GO EXCP                         52000021
CTA09600 EQU   *                                                        52100021
         MVC   DXCCW1,AFSFCCW           SET UP FSF CCW                  52200021
CTA09700 EQU   *                                                        52300021
         ST    RC,DXCCW5                SAVE RETURN ADDR                52400021
CTA09800 EQU   *                                                        52500021
         BAL   RC,CTA10100              GO TO EXECUTE CHANNEL PROGRAM   52600021
         BNO   CTA10400                 BRANCH TO ERROR PROCESSING      52700021
         BCT   RD,CTA09800              REPEAT THE CHANNEL PROGRAM      52800021
         MVI   DXCCW1,CCWNOP            SET UP NOP CCW                  52900021
         BAL   RC,CTA10100              GO TO EXECUTE CHANNEL PROGRAM   53000021
         BNO   CTA10400                 BRANCH TO ERROR PROCESSING      53100021
CTA09900 EQU   *                                                        53200021
         NI    DXCCW5+K4,X'FF'-K1       TURN OFF BYPASS ABEND BIT       53300021
         L     RC,DXCCW5                RESTORE RETURN ADDR             53400021
         BR    RC                       RETURN TO CALLER OF THIS SUBRTN 53500021
         EJECT                                                          53600021
         SPACE 1                                                        53700021
**********                 MACRO                             ********** 53800021
*                                                                     * 53900021
         SPACE 1                                                        54000021
*               CLOSED SUBROUTINE TO ISSUE I/O OPERATIONS               54100021
*                      AND TEST ONLY FOR I/O ERROR                      54200021
*  ( IT IS ASSUMED THAT ALL CONTROL BLOCKS HAVE ALREADY BEEN SET UP )   54300021
*                                                                       54400021
*        ENTRY TO THE SUBROUTINE IS AS FOLLOWS-                         54500021
*           BAL   RC,CTA10100                                           54600021
*        RETURN TO THE CALLING ROUTINE TAKES PLACE AS FOLLOWS-          54700021
*           BR    RC                                                    54800021
*                                                                       54900021
*        THE CONDITION CODE WILL HAVE BEEN SET TO '1' IF AN I/O         55000021
*        ERROR HAS OCCURRED.                                            55100021
         SPACE 1                                                        55200021
CTA10100 EQU   *                                                        55300021
         EXCP  DXIOB                    INITIATE I/O OPERATION          55400021
         IECRES WAIT                    WAIT FOR I/O TO COMPLETE        55500021
         TM    DXECB,ECBNOERR           TEST FOR UNUSUAL I/O CONDITION  55600021
         BR    RC                       RETURN TO CALLER OF SUBROUTINE  55700021
         SPACE 1                                                        55800021
*                                                                     * 55900021
**********                                                   ********** 56000021
         EJECT                                                          56100021
         SPACE 1                                                        56200021
**********                MACROS                             ********** 56300021
*                                                                     * 56400021
         SPACE 1                                                        56500021
*            CLOSED SUBROUTINE TO ISSUE I/O OPERATIONS                  56600021
*            AND TEST FOR UNIT EXCEPTION AND I/O ERROR                  56700021
*            NOTE THAT THIS ROUTINE IS CALLED ONLY TO WRITE     SA56478 56750002
*            TAPEMARKS AT THE END OF A DATA SET, AND FOR THIS   SA56478 56760002
*            REASON ONLY TREATS UNIT EXCEPTION (END-OF-TAPE)    SA56478 56770002
*            AS A NORMAL ACCEPTABLE CONDITION.                  SA56478 56780002
*  ( IT IS ASSUMED THAT ALL CONTROL BLOCKS HAVE ALREADY BEEN SET UP )   56800021
*                                                                       56900021
*        ENTRY TO THE ROUTINE IS AS FOLLOWS-                            57000021
*           BAL   RC,CTA10200                                           57100021
*        RETURN TO THE CALLING ROUTINE TAKES PLACE AS FOLLOWS-          57200021
*           BR    RC             RETURN IF UNIT EXCEPTION       SA56478 57300002
*        OR                                                             57400021
*           BR    RC             RETURN IF NO UNIT EXCEPTION            57500021
*                                                                       57600021
*        IF AN I/O ERROR HAS OCCURED THIS ROUTINE GOES TO THE   SA56478 57850002
*        PROBLEM DETERMINATION EXIT FOR THIS MODULE.            SA56478 57860002
         SPACE 1                                                        57900021
CTA10200 EQU   *                                                        58000021
         EXCP  DXIOB                    INITIATE I/O OPERATION          58100021
         IECRES WAIT                    WAIT FOR I/O TO COMPLETE        58200021
         TM    IOBSTAT0,CSWUNITX        TEST FOR UNIT EXCEPTION CAUSED  58300021
         BCR   K1,RC                    END-OF-TAPE - BR IF YES SA56478 58400002
         TM    DXECB,ECBNOERR           TEST FOR UNUSUAL I/O CONDITION  58500021
         BCR   K1,RC                    RETURN IF NO ERROR      SA56478 58550002
* IF I/O ERROR HAS OCCURED, FALL THRU TO CTA10300               SA56478 58560002
         SPACE 1                                                        58800021
*                                                                     * 58900021
**********                                                   ********** 59000021
         EJECT                                                          59100021
         SPACE 1                                                        59200021
*********************************************************************** 59300021
*                                                                     * 59400021
*                        ERROR PROCESSING                             * 59500021
*                                                                     * 59600021
*********************************************************************** 59700021
         SPACE 1                                                        59800021
CTA10300 EQU   *                                                        59900021
         LA    R0,CABD062               ERR- WRITE TAPE MARK            60000021
         B     CTA10500                 GO TO ERROR EXIT                60100021
CTA10400 EQU   *                                                        60200021
         TM    DXCCW5+K4,K1             IS SW NOT TO ABEND SET ON       60300021
         BO    CTA09900                 YES, RETURN TO CALLER           60400021
         LA    R0,CABD065               ERR- POSITIONING                60500021
*****     SET RETURN ADDRESS TO FINAL PROCESSING                        60600021
CTA10500 EQU   *                                                        60700021
         DMABCOND (0),PDMOD,RETURN=FINALMOD  ABEND MACRO                60900021
CTA10600 EQU   *                                                        61000021
         LA    R0,CABD063               ERR- WRITE TRL2                 61100021
         SR    RET,RET                  SET UP FOR BRANCH TABLE         61200021
         DMABCOND (0),PDMOD             ABEND MACRO                     61300021
         EJECT                                                          61400021
         SPACE 1                                                        61500021
*********************************************************************** 61600021
*                                                                     * 61700021
*                       CONSTANTS                                     * 61800021
*                                                                     * 61900021
*********************************************************************** 62000021
         SPACE 1                                                        62100021
ABSFCCW  DC    X'2F00000020000001'      BACKSPACE FILE, SILI FLAG ON    62200021
AFSFCCW  DC    X'3F00000020000001'      FORWARD SPACE FILE, SILI ON     62300021
         XCTLTABL ID=(FINALMOD,2J,ID2F4A,4A,PDMOD,0P,SMFMOD,2H,  A38013*62460002
               VOLDPMOD,2F),SVC=020,BRT=YES,LENGTH=              Y02080 62520002
         IECDSECS CVT,TCB,TIOT,DCB,DEB,UCB,MAIN,WTG,EXPAND=YES          62600021
         IECEQU                                                         62700021
         END                                                            62800021
