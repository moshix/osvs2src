         TITLE 'IFG0202L                      CLOSE FINAL EXIT MODULE'  00300002
IFG0202L CSECT                                                          01200021
         ENTRY IFG0209L                 ALIAS ENTRY POINT        YM1403 01250002
IFG0209L EQU   IFG0202L                 SECONDARY ENTRY NAME     YM1403 01300002
*                                                                YM1403 01350002
*********************************************************************** 01500021
*                                                                     * 01800021
*          VS1 RELEASE 02 DELETIONS                                   * 01860002
*0000360700,360800,360900,500640-500680,500696-500699            XM1037 01860402
*0000551100-551806                                               XM0478 01862002
*0000                                                            X02989 01870002
*          VS2 RELEASE 01 DELETIONS                                   * 01900000
*                                                                     * 01950000
*0000                                                            YM0954 02000000
*0000                                                            YM2823 02010000
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 02020003
*0000                                                          @ZA07016 02720003
*0000                                                          @ZA09156 03120003
*0000                                                          @ZA09659 03320003
*          RELEASE 21 DELETIONS/CHANGES                               * 03600021
*                                                                M0039  03700021
*0000639992-641940, 666500-682500                                Y02080 03750002
*                                                                     * 03900021
* MODULE NAME = IFG0202L                                              * 03950002
*                                                                     * 04000002
* DESCRIPTIVE NAME = CLOSE FINAL EXIT MODULE                          * 04050002
*                                                                     * 04100002
* COPYRIGHT = NONE                                                    * 04150002
*                                                                     * 04160002
* STATUS CHANGE LEVEL 000                                             * 04200021
*                                                                     * 04500021
* FUNCTION -                                                          * 04800021
*    THIS MODULE CONTAINS THE FUNCTION(S) OR PART(S) OF FUNCTION(S)-- * 05100021
*    CLOSE FINAL TERMINATION FUNCTION.                                * 05400021
*       THIS FUNCTION STARTS IN MODULE IFG0202K.                      * 05700021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)' FOR DETAILS.         * 06000021
*                                                                     * 06300021
* ENTRY POINTS -                                                      * 06600021
*         IFG0202L - ENTRY POINT VIA AN XCTL FROM THE FOLLOWING--     * 06900021
*             INITIAL ENTRY--                                         * 07200021
*                IFG0202K - CONTINUE PROCESSING CLOSE FINAL           * 07500021
*                           TERMINATION FUNCTION.                     * 07800021
*                                                                     * 09600021
* INPUT -                                                             * 09900021
*    ENTERED IN DATA MANAGEMENT KEY                              Y02082 09950002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 10200021
*                                                                     * 10500021
* OUTPUT -                                                            * 10800021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 10850002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 11100021
*                                                                     * 11400021
* EXTERNAL REFERENCES -                                               * 11700021
*         IFG019RA - OPEN/CLOSE/EOV RESIDENT ROUTINE FOR XCTL AND     * 12000002
*                    WAIT.                                            * 12300021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 12600021
*                                                                     * 12900021
* EXITS, NORMAL -                                                     * 13200021
*    EXIT VIA AN XCTL MACRO-INSTRUCTION TO THE FOLLOWING--            * 13500021
*         IGC0001I - FOR CONCATENATION OF UNLIKE ATTRIBUTES.          * 14100021
*    OR A RETURN TO THE CALLING PROGRAM.                         Y02080 14400002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 14700021
*                                                                     * 15000021
* EXITS, ERROR -                                                      * 15300021
*    EXIT IS TO THE PROBLEM DETERMINATION MODULE IFG0200P, IF AN      * 15600021
*    ABEND SITUATION OCCURS IN THIS MODULE.  REFER TO THE FOLLOWING   * 15900021
*    'FUNCTION PROLOG(S)'.                                            * 16200021
*                                                                     * 16500021
* TABLES/WORK AREAS -                                                 * 16800021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 17100021
*                                                                     * 17400021
* ATTRIBUTES -                                                        * 17700021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 18000021
*                                                                     * 18300021
* CHARACTER CODE DEPENDENCY -                                         * 18600021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 18900021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 19200021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 19500021
*                                                                     * 19800021
* NOTES -                                                             * 20100021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 20400021
*                                                                     * 20700021
*********************************************************************** 21000021
         EJECT                                                          21300021
         USING IHADCB,RDCB                                              21600021
         USING FORCORE,RCORE                                            21900021
         USING TCB,RET                                                  22200021
         USING UCBOB,RUCB                                               22500021
         USING CVT,RD                                                   22800021
         USING TIOENTRY,RTIOT                                           23100021
         USING DEB,RDEB                                                 23400021
         USING WTG,RWTG                                                 23700021
         USING WTGENTRY,RWTGC                                           24000021
         USING USERPRML,RPARC           RPARC POINTS TO CURRENT  Y02134 24005002
*                                                                       24300021
         BALR  RBASE,0                  ESTABLISH BASE REGISTER         24600021
         USING *,RBASE                                                  24900021
         EJECT                                                          25200021
*                                                                     * 25500021
*                          FUNCTION PROLOG                            * 25800021
*                                                                     * 26100021
*********************************************************************** 26400021
*                                                                     * 26700021
* FUNCTION NAME -                                                     * 27000021
*    CLOSE FINAL TERMINATION FUNCTION.                                * 27300021
*                                                                     * 27600021
* (STATUS) -                                                          * 27900021
*    NOT APPLICABLE                                                   * 28200021
*                                                                     * 28500021
* FUNCTION -                                                          * 28800021
*    DECREMENT DSAB OPEN COUNT FOR VSAM DATA SETS                Y02134 28850002
*    INTERFACE WITH TRACE TERMINATION FACILITY.                       * 29100021
*    FREE STORAGE FOR IRB, DEB, AND WORKAREA.                    Y02080 29400002
*    RELEASE WTG TABLE USING THE RESIDENT ROUTINE WHO WILL DEQ   Y02134 29700002
*     THE TIOT                                                   Y02134 29750002
*    EXIT TO CALLING PROGRAM OR INITIAL LOAD OF OPEN IF CONCATENATION * 30000021
*    OF UNLIKE ATTRIBUTES IS SPECIFIED.                               * 30300021
*                                                                     * 30600021
* ENTRY POINTS -                                                      * 30900021
*    ENTERED FROM THE FOLLOWING--                                     * 31200021
*    CLOSE FINAL RESTORE SYSTEM FUNCTION.                             * 31500021
*                                                                     * 31800021
* INPUT -                                                             * 32100021
*    A POINTER TO EACH OF THE FOLLOWING--                             * 32400021
*       CURRENT PARAMETER LIST ENTRY.                                 * 32700021
*       DD ENTRY IN THE TIOT.                                         * 33000021
*       WTG TABLE.                                                    * 33300021
*       CURRENT WTG TABLE ENTRY.                                      * 33600021
*       DCB.                                                          * 33900021
*       CLOSE WORK AREA.                                              * 34200021
*       RESIDENT ROUTINE.                                             * 34500021
*       UCB.                                                          * 34800021
*       DEB.                                                          * 35100021
*                                                                     * 35400021
* OUTPUT -                                                            * 35700021
*    ALL STORAGE USED BY CLOSE RELEASED.                              * 36000021
*    RETURN CODE IN REGISTER 15:                                 X02989 36060002
*       0     ALL ENTRIES IN PARAMETER LIST WERE SUCCESSFULLY    X02989 36070002
*             CLOSED.                                            X02989 36072002
*       4     ONE OR MORE ENTRIES IN CLOSE PARAMETER LIST        XM1037 36080002
*             WERE NOT CLOSED SUCCESSFULLY.                      XM1037 36090002
*                                                                     * 36300021
* EXTERNAL REFERENCES -                                               * 36600021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 36900021
*                                                                     * 37200021
* EXITS, NORMAL -                                                     * 37500021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 37800021
*    CALLING PROGRAM.                                                 * 38100021
*    INITIAL LOAD OF OPEN.                                            * 38400021
*                                                                     * 38700021
* EXITS, ERROR -                                                      * 39000021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 39300021
*                                                                     * 39600021
* TABLES/WORK AREAS -                                                 * 39900021
*    THE OPEN, CLOSE, OR EOV WORK AREA AND THE WHERE-TO-GO (WTG)      * 40200021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 40500021
*                                                                     * 40800021
* ATTRIBUTES -                                                        * 41100021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 41400021
*                                                                     * 41700021
* CHARACTER CODE DEPENDENCY -                                         * 42000021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 42300021
*                                                                     * 42600021
* NOTES -                                                             * 42900021
*    NOT APPLICABLE                                                   * 43200021
*                                                                     * 43500021
*********************************************************************** 43800021
         EJECT                                                          44100021
         MVC   WTGIDTTR,EXITMOD         SET UP ALIAS ID          YM1403 44101002
*                                                                YM1403 44103002
         IECRES SYNCHDCB                SYNCH UP TO LAST LOAD    YM1403 44104002
*                                                                YM1403 44105002
         MVI   WTGLNG,K0                SET RETURN CODE TO 0     Y02080 47400002
CFN07600 EQU   *                                                        48300021
         L     RDCB,PLISTDCB(,RPARC)    GET DCB ADDR                    48600021
         L     RCORE,WTGCORE-1          GET WORKAREA ADDR               48900021
         LA    RCORE,0(RCORE)           CLEAR HIGH ORDER BYTE           49200021
         LTR   RCORE,RCORE              WORKAREA ADDR PRESENT           49500021
         BNZ   CFN07700                 BR IF YES                X02989 49950002
         MVI   WTGLNG,K4                SET RETURN CODE TO 4     Y02080 50000002
         B     CFN07900                 BR TO GET NEXT ENTRY     X02989 50050002
CFN07700 EQU   *                        WORK AREA PRESENT        X02989 50060002
         TM    DCBOFLGS,DCBOPEN         IS OPEN BIT ON           XM0478 50062002
         BO    CFN07750                 ERROR - DCB OPEN         Y02134 50066002
*    TEST FOR VTAM ACB AND EXAMINE ERROR FLAGS(ACBERFLG).        YM3011 50066102
*    NON-ZERO ERROR FLAGS CAUSES RETURN CODE SETTING OF 4        YM3011 50066202
         CLC   DCBDDNAM(K8),=X'FF00000000000000'   VTAM ACB?     YM3011 50066602
         BNE   CFN07720                 NO, GO TEST FOR VSAM     YM3011 50066702
         CLI   ACBERFLG-IFGACB(RDCB),K0 ARE ERROR FLAGS ZERO     YM3011 50066902
         BNE   CFN07750                 NO, GO SET RETURN CODE   YM3011 50067002
         B     CFN07775                 CONTINUE                 YM3011 50068402
CFN07720 EQU   *                        TEST FOR VSAM            YM3011 50069802
         TM    JFCDSRG2,JFCORGAM        IS DATA SET VSAM         XM0478 50071202
         BNO   CFN07775                 BR IF NOT                XM0478 50072602
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  XM1037 50074002
         BO    CFN08200                 BR IF YES TO DECREMENT   YM6572 50074402
*                                       DSAB OPEN COUNT -        YM6572 50074802
*                                       RETURN TO CFN07740       YM6572 50075202
         B     CFN07775                 BRANCH IF NO             YM6572 50075402
CFN07740 EQU   *                        SEE IF CLOSE ERROR       YM6572 50075802
         CLI   ACBERFLG-IFGACB(RDCB),K0 ARE ERROR FLAGS SET      XM0478 50076802
         BE    CFN07775                 BR IF NO                 YM6572 50078202
CFN07750 EQU   *                        OPEN BIT ON              XM0478 50079902
         MVI   WTGLNG,K4                SET RETURN CODE TO 4     Y02080 50089902
CFN07775 EQU   *                        TEST OPTIONAL TRACE      XM0478 50093202
         TM    WTGPATHS+K1,WTGTRACE     OPTIONAL TRACE IND. ON          50100021
         BZ    CFN07800                 BRANCH IF NOT                   50400021
         NI    WTGPATHS+K1,X'FF'-WTGTRACE  TURN OFF OPTIONAL TRACE IND  50700021
CFN07800 EQU   *                                                        52800021
*                                                                Y02134 52801002
         L     RB,DXDSABAD              LOAD CURRENT DSAB PTR    Y02134 52806002
         USING DSAB,RB                  RB POINTS TO DSAB        Y02134 52811002
         L     RET,DXTCBADR             GET CURRENT TCB          Y02134 52814802
         TM    TCBFLGS,TCBFA            IS ABEND OCCURRING?      Y02134 52815002
         BO    CFN07900                 BR IF YES-NO CONCATENATE Y02134 52815302
         TM    DCBOFLGS,DCBOLOCK+DCBOCON LOCK & CONCAT BITS ON?  Y02134 52815602
         BNO   CFN07900                 BRANCH IF NOT            Y02134 52815902
         LTR   RB,RB                    RB=0                   @ZA07016 52816003
         BZ    CFN07830                 BRANCH YES             @ZA09659 52816103
         L     RF,DSABFCHN              GET NEXT DSAB            Y02134 52816202
*                                                                Y02134 52817002
*****************************************************************Y02134 52817202
*                                                                Y02134 52817402
*        THERE SHOULD BE ANOTHER DSAB SINCE THE CONCATENATION    Y02134 52817602
*        BIT SHOULDN'T BE ON IF THERE ISN'T.                     Y02134 52817802
*                                                                Y02134 52818002
*****************************************************************Y02134 52818602
*                                                                Y02134 52819602
         LTR   RF,RF                    IS THERE ONE?            Y02134 52820002
         BNZ   CFN07860                 BRANCH IF ANOTHER DSAB   Y02134 52824002
*                                                                Y02134 52825002
*****************************************************************Y02134 52825202
*                                                                Y02134 52825402
*        UNCERIMONIOUSLY TURN OFF CONCATENATION BIT IF THERE'S   Y02134 52826002
*        NOT ANOTHER DSAB                                        Y02134 52828002
*                                                                Y02134 52829002
*****************************************************************Y02134 52829202
*                                                                Y02134 52829402
CFN07830 NI    DCBOFLGS,K255-DCBOCON    TURN OFF CONCAT BIT    @ZA09659 52830003
         B     CFN07900                 GET NEXT ENTRY           Y02134 52832002
*                                                                Y02134 52833002
CFN07860 EQU   *                        INITIALIZE CLOSE WK AREA Y02134 52834002
*                                                                Y02134 52834202
*****************************************************************Y02134 52834302
*                                                                Y02134 52834802
*        INITIALIZE CLOSE WORKAREA FOR OPEN                      Y02134 52835502
*                                                                Y02134 52835702
*****************************************************************Y02134 52835902
*                                                                Y02134 52837202
         LR    RB,RF                    LOAD DSAB BASE POINTER   Y02134 52838202
CFN07880 ST    RB,DXDSABAD              STORE NEXT DSAB        @ZA09156 52838703
         ST    RB,DXDSAB                STORE CURRENT DSAB       Y02134 52840002
         L     RTIOT,DSABTIOT           GET NEXT TIOT ENTRY ADDR Y02134 52842002
         ST    RTIOT,DXTIOTAD           STORE NEXT TIOT ENTRY AD Y02134 52844002
         L     RA,TCBTIO                GET TIOT START ADDR      Y02134 52846002
         LR    RF,RTIOT                 GET TIOT ENTRY ADDR      Y02134 52848002
         SR    RF,RA                    GET TIOT ENTRY OFFSET    Y02134 52848102
         STH   RF,DCBTIOT               STORE IN DCB             Y02134 52848402
         L     RUCB,TIOEFSRT-K1         GET FIRST UCB ADDR       Y02134 52848802
         ST    RUCB,DXUCBADR            STORE IN WORKAREA        Y02134 52849202
*                                                                       55200021
CFN07900 EQU   *                                                        55800021
*                                                                Y02134 55805002
         DROP  RB                       DROP DSAB POINTER        Y02134 55810002
         TM    DXDCBLST,LASTNTRY        TEST FOR LAST ENTRY      Y02134 56100002
         LA    RWTGC,WTGENTRY+L'WTGENTRY NEXT WTG ENTRY          Y02134 56400002
         LA    RPARC,DXDCBLST+L'DXDCBLST NEXT DCB ENTRY          Y02134 56700002
         BZ    CFN07600                 GET NEXT WORKAREA               57000021
         L     RPAR,WTGPREFX            ADDR OF WTG BASE PREFIX  Y02082 57002002
         USING IECPREFX,RPAR                                     Y02082 57004002
         L     RPAR,IECUPRML            GET ADDR OF USERS PARAM  Y02082 57006002
         DROP  RPAR                                              Y02082 57008002
*                                                                       61200021
*        TEST FOR EOVC ON                                               61500021
         L     RDCB,PLISTDCB(,RPAR)     ADDR OF FIRST DCB               61800021
         L     RD,CVTPTR                VECTOR TABLE ADDRESS            62100021
         L     RET,CVTTCBP              POINTER TO TCB                  62400021
         L     RET,K4(,RET)             CURRENT TCB ADDRESS             62700021
         TM    TCBFLGS,TCBFA            IS ABEND BIT ON                 63000021
         BO    CFN08000                 BR IF YES --NO CONCATENATION    63300021
         LA    RWTGC,WTGENTRY-WTG(,RWTG) WTG ENTRY POINTER       YM1109 63350002
         L     RCORE,WTGCORE-K1         GET WORKAREA ADDR        YM3177 63350202
         LA    RCORE,FORCORE            CLEAR HIGH ORDER BYTE    YM3177 63350402
         LTR   RCORE,RCORE              WORKAREA ADDR PRESENT    YM3177 63350602
         BZ    CFN08000                 BRANCH IF NOT            YM3177 63350802
         CLI   WTGIDTTR,K0              IS ENTRY ACTIVE          YM1109 63400002
         BE    CFN08000                 BR NO, NO CONCATENATION  YM1109 63450002
         TM    DCBOFLGS,DCBOLOCK+DCBOCON  CHK LOCK AND EOVC SW'S.       63600021
         BNO   CFN08000                 B, IF BOTH NOT ON               63900021
         OI    DCBOFLGS,DCBOBUSY        SET BUSY BIT ON FOR OPEN Y02082 63902002
         XC    DXDEBXAD,DXDEBXAD        ZERO OUT DEBX PTR        YM7839 63912002
         LR    R1,RPAR                  PT TO PARM LIST FOR OPEN Y02082 63950002
         L     RF,WTGPREFX              GET PREFIX ADDR          Y02144 64000002
         L     RF,IECRRPRM-IECPREFX(RF) GET ADDR OF RECOVERY     Y02144 64050002
         USING RRPLIST,RF               ESTABLISH BASE ADDR      Y02144 64100002
         XC    RRPLIST+K1(K23),RRPLIST+K1  ZERO RECOVERY PARMS   Y02144 64150002
         XC    DXATCOM1(K8),DXATCOM1    EXCEPT RRFUNCTN          Y02144 64200002
         XC    DXATCOM4(K12),DXATCOM4   AND ADDR OF RRPLIST      Y02144 64210002
         DROP  RF                       DROP BASE REG            Y02144 64300002
*                                                                       64310002
*        REFRESH USER DCB TO CLOSED STATUS                              64350002
*                                                                       64400002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(0,14,WTGPREFX) COPYBACK YM8552 64450002
*                                                                       68400021
*        XCTL TO OPEN FOR CONCATENATION OF UNLIKE ATTRIBUTES            68700021
*                                                                       69000021
         IECRES LOAD,MODNM=OPENLD,PREFIX=WTGPREFX,               Y02080*69310002
               BRANCH=DIRECT            XCTL TO OPEN             Y02080 69312002
         EJECT                                                          69900002
CFN08000 EQU   *                                                        70200021
*                                                                Y01018 70494400
         L     RPARC,WTGPREFX           LOAD PREFIX ADDRESS      Y02134 70494702
         L     RPARC,IECUPRML-IECPREFX(,RPARC) PARM LIST POINTER Y02134 70494902
         LA    RWTGC,WTGENTRY-WTG(,RWTG) WTG ENTRY POINTER       Y02134 70495202
*                                                                Y02134 70495702
*****************************************************************Y02134 70495902
*                                                                Y02134 70503902
CFN08005 EQU   *                        COPY BACK DCB            Y01018 70504502
*                                                                Y02134 70505102
         L     RDCB,DXDCBLST            LOAD DCB ADDRESS         Y02134 70505702
         L     RCORE,WTGCORE-K1         GET WORKAREA ADDR        Y02134 70506302
         LA    RCORE,FORCORE            CLEAR HIGH ORDER BYTE    Y02134 70506902
         LTR   RCORE,RCORE              WORKAREA ADDR PRESENT    Y02134 70507502
         BZ    CFN08025                 BRANCH IF NOT            YM1342 70508102
*                                                                       70508702
* AVOID COPYBACK IF DELAYED/IGNORED ABEND IS PENDING OR OPEN BIT IS ON  70508802
         TM    JFCBMASK+K4,JFCMABND     DELAYED ABEND PENDING    Y02144 70510502
         BO    CFN08030                 BR IF YES                Y02144 70511102
         TM    DXATOPEN,DXATIGN         IGNORED ABEND PENDING    Y02144 70511702
         BO    CFN08030                 BR IF YES                Y02144 70512302
         TM    DCBOFLGS,DCBOPEN         IS OPEN BIT ON           YM7304 70512402
         BO    CFN08025                 BRANCH IF ON, DCB ERROR  YM7304 70512502
* COPY THE DCB FROM THE WORK AREA TO USER'S STORAGE              Y02082 70512602
*                                                                Y02082 70512702
         IECRES INIT,DCBCOPY=FRWKAR,STM=(3,14,WTGPREFX)          Y02082 70512902
         TM    JFCDSRG2,JFCORGAM        IS DATA SET VSAM         Y02134 70514702
         BNO   CFN08010                 BRANCH IF NOT VSAM       Y02134 70515302
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  Y02134 70515902
         BNO   CFN08010                 BRANCH IF NO             Y02134 70516502
         CLI   ACBERFLG-IFGACB(RDCB),K0 ARE ERROR FLAGS SET      Y02134 70517102
         BNE   CFN08025                 BRANCH IF YES            Y02134 70517702
         EJECT                                                          70518302
CFN08010 EQU   *                        NOT VSAM ACB             Y02134 70518902
*                                                                Y02134 70519502
         L     RET,DXTCBADR             GET CURRENT TCB          Y02134 70520102
         L     RB,DXDSABAD              LOAD DSAB POINTER        Y02134 70520702
         LTR   RB,RB                    IS THERE A DSAB          YM1342 70521302
         BZ    CFN08025                 BR IF NO                 YM1342 70521902
         USING DSAB,RB                  RB POINTS TO DSAB        Y02134 70522502
*                                                                       70523102
*        IF A CHECKPOINT DATA SET SECURITY INTERFACE EXISTS,     YM3156 70523702
*        UPDATE THE USER'S DCB FROM THE COPIED DCB AND           YM3947 70524302
*        FREE THE CHECKPOINT DCB (KEY 0 DCB).                    YM3947 70524702
*        SUBSEQUENT PROCESSING WILL FREE THE COPIED DCB.         YM3947 70524902
*        IF A SECURITY INTERFACE EXISTS, THERE ARE 3 DCBS, THE   YM3806 70525302
*        USERS IN FETCH PROTECTED CORE KEY OF USER, THE COPIED   YM3806 70525402
*        DCB IN KEY 5, AND THE CHECKPOINT DCB IN FETCH PROTECTED YM3086 70525802
*        CORE KEY ZERO.  THE KEY ZERO DCB REPRESENTS THE USER    YM3806 70527102
*        DCB IS THE CHKPT CODE.  BUT NOW THE TRUE USER'S DCB     YM3806 70527202
*        WILL BE UPDATED WITH THE TRUE COPIED DCB KEY 5.         YM3806 70527302
*                                                                       70527702
         TM    DSABFLG4,DSABCKSI+DSABCKDS  CHKPT SECURITY INT    YM3973 70527802
         BNO   CFN08015                 IF NOT, BRANCH           YM3973 70531002
         L     RC,DXUDCBAD              GET PROT. DCB ADDRESS    Y02083 70531802
         LA    RC,K0(RC)                CLEAR HIGH ORDER BYTE    YM5766 70532002
         LA    RD,K4                    BACKUP PROT. DCB ADDR BY Y02083 70532602
         SR    RC,RD                    4 TO GET USER DCB ADDR   Y02083 70533402
         LR    RF,RC                    SAVE PTR TO CHECKPT DCB  YM3947 70534202
         MODESET EXTKEY=ZERO            GO TO KEY ZERO           YM3806 70535002
         L     RDCB,K0(,RC)             GET USER'S DCB ADDR      Y02083 70535802
         ST    RDCB,DXUDCBAD            UPDATE WA USER DCB ADDR  Y02083 70536602
         ICM   RA,B'0111',DCBEXLSA      SAVE USER EXIT LIST ADDR YM3863 70537402
         L     RC,DXPDCBAD              GET PT TO KEY 5 DCB      YM3806 70538202
         AH    RC,DXUDCBPL              PNT PAST PROT. DCB PREFX Y02083 70539002
         AH    RDCB,DXUDCBPL            PNT PAST USER DCB PREFX  Y02083 70539802
         LH    RD,DXUDCBML              GET DCB MOVE LENGTH      Y02083 70540602
         BCTR  RD,R0                    ADJUST FOR MOVE INSTR    Y02083 70541402
         MODESET KEYADDR=TCBPKF,WORKREG=1 USER KEY               Y02083 70542202
         EX    RD,CFNMOVER              UPDATE USER'S DCB        Y02083 70543002
         SH    RDCB,DXUDCBPL            RESET DCB PTR            YM3863 70543802
         STCM  RA,B'0111',DCBEXLSA      RESTORE USER EXIT ADDR   YM3863 70544602
         MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 70545402
         NI    DSABFLG4,X'FF'-DSABCKSI  RESET S/I INDICATOR      Y02083 70546202
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 70547002
         STC   R1,DXUKEY                RESET TO USER KEY        YM3939 70547802
         L     RDCB,DXPDCBAD            RESTORE COPIED DCB ADDR  Y02083 70548602
*        FREE THE CHECKPOINT DCB                                 YM3947 70549402
         LR    RC,RF                    RESTORE PTR TO KEY 0 DCB YM3947 70550202
         LA    RD,L'CKSITEXT            LENGTH OF EXPLANATORY    YM5766X70552602
                                        TEXT PRECEDING THE DCB   YM5766 70553002
         SR    RC,RD                    POINT TO TRUE W/A START  YM5766 70553402
         LA    RD,K4(RD)                ADD POINTER LENGTH       YM5766 70553802
         AH    RD,DXUDCBPL              + DCB PREFIX LENGTH      YM5766 70554202
         AH    RD,DXUDCBML              + MOVED DCB LENGTH       YM5766 70554602
         IECRES FREE,PREFIX=NO,LV=(RD),A=(RC),SP=252,KEY=0,      YM3947*70554802
               STM=(2,14,WTGPREFX)                               YM3947 70554902
         EJECT                                                          70555402
CFN08015 EQU   *                        CLOSE OPTION FREE        Y02134 70555502
*                                                                       70556302
*        BUILD PARAMETER LIST IF DD ENTRY TO BE UNALLOCATED             70557202
*                                                                       70558102
*        THE PARM LIST IS BUILT FOR EACH DCB REQUESTING THIS            70559002
*        SO THAT IN THE NEXT LOOP THROUGH THE DCB'S, THE TIOT           70559902
*        CAN BE DEQUEUED AND THE PARM LIST WILL STILL HAVE              70560802
*        DDNAME WITHOUT HAVING TO GET IT OUT OF THE TIOT                70561702
*                                                                       70562602
         L     RTIOT,DSABTIOT           GET TIOT ENTRY ADDRESS   Y02134 70563502
         L     RUCB,DXUCBADR            LOAD UCB ADDRESS         Y02134 70564402
         TM    TCBFLGS,TCBFA            IS ABEND OCCURRING?      Y02134 70565302
         BO    CFN08025                 BR IF YES-NO UNALLOCATE  Y02134 70566202
         TM    DXDCBLST,CLOSEREW        IS REWIND SPECIFIED      YM3177 70567102
         BO    CFN08018                 BR IF YES TO TEST DSAB   YM3177 70568002
         TM    DXDCBLST,PLISTLV         IS LEAVE SPECIFIED       YM3177 70568902
         BO    CFN08025                 BR IF YES TO SKIP UNALL  YM3177 70569802
         TM    DXDCBLST,FREE            TEST FOR CLOSE OPT FREE  Y02134 70570702
         BO    CFN08020                 BRANCH TO UNALLOCATE     Y02134 70571602
         TM    DXDCBLST,PLISTOP2        IS DISP SPECIFIED        YM3177 70572502
         BNZ   CFN08025                 BR IF NO TO SKIP UNALL   YM3177 70573402
CFN08018 EQU   *                        TEST DSAB FOR RELEASE    YM3177 70574302
         TM    DSABFLG2,DSABUNAL        TEST FOR RELEASE=CLOSE   Y02134 70575202
         BNO   CFN08025                 NO UNALLOCATION REQUESTD Y02134 70576102
*                                                                Y02134 70577002
CFN08020 EQU   *                        CLOSE OPTION FREE        Y02134 70577902
*                                                                Y02134 70578802
         MODESET EXTKEY=SCHED           DSAB IS SCHEDULER KEY    Y02082 70579702
         NC    DSABOPCT,DSABOPCT        CHECK IF ANY USERS       Y02134 70580602
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGT KEY   Y02082 70581502
         BNZ   CFN08025                 BRANCH IF USERS          Y02134 70582402
         TM    DSABFLG1,DSABCATM        TEST FOR CONCATENATION   Y02134 70583302
         BO    CFN08025                 BRANCH IF CONCATENATION  Y02134 70584202
         DROP  RB                       DSAB ADDRESSABILITY      Y02083 70585102
         XC    DXLBL,DXLBL              ZERO OUT DYN ALLOC PARML Y02134 70586002
         LA    R1,DXLBL                 LOAD POINTER TO PARMS    Y02134 70586902
         USING S99RBP,R1                R1 POINTS TO PARM LIST   Y02134 70587802
         LA    RC,S99RBP+K4             S99RB POINTER            Y02134 70588702
         USING S99RB,RC                 RC POINTS TO S99RB AREA  Y02134 70589602
         LA    RD,S99RBEND              POINTER TO S99TUPL       Y02134 70590502
         USING S99TUPL,RD               RD POINTS TO S99TUPL     Y02134 70591402
         LA    RF,S99TUPL+K8            POINTER TO S99TUNIT      Y02134 70592302
         USING S99TUNIT,RF              RF POINTS TO S99TUNIT    Y02134 70593202
         ST    RC,S99RBPTR              STORE BLOCK POINTER      Y02134 70594102
         OI    S99RBPTR,S99RBPND        SET HI ORDER BIT         Y02134 70595002
         MVI   S99RBLN,S99RBEND-S99RBLN SET LENGTH INDICATOR     Y02134 70595902
         OI    S99VERB,S99VRBUN         INDICATE UNALLOCATE      Y02134 70596802
         ST    RD,S99TXTPP              TEXT BLOCK POINTER       Y02134 70597702
         ST    RF,S99TUPTR              TEXT UNIT POINTER        Y02134 70598602
         MVC   S99TUKEY,DYNPERM         PERMANENT UNALLOCATE     Y02134 70599502
         LA    RF,S99TUENT              NEXT TEXT UNIT           Y02134 70600402
         ST    RF,S99TUPTR+K4           NEXT TEXT UNIT POINTER   Y02134 70601302
         MVI   S99TUPTR+K4,S99TUPLN     END OF TEXT              Y02134 70602202
         MVC   S99TUKEY,DYNDDNAM        SET DDNAME IN TEXT       Y02134 70603102
         MVI   S99TUNUM+K1,K1           INDICATE ONE PARM        Y02134 70604002
         LA    RF,S99TUENT              PARM IN TEXT UNIT        Y02134 70604902
         DROP  RF                                                Y02134 70605802
         USING S99TUFLD,RF              RF POINTS TO PARM        Y02134 70606702
         MVI   S99TULEN+K1,L'TIOEDDNM   DDNAME LENGTH            Y02134 70607602
         MVC   S99TUPRM(K8),TIOEDDNM    TIOT ENTRY DDNAME        Y02134 70608502
         DROP  R1,RC,RD,RF                                       Y02134 70609402
         B     CFN08030                                                 70610302
CFN08025 EQU   *                        NEITHER UNALLOCATE NOR   Y02134 70611202
*                                       DELAY/IGNORE ABEND       Y02134 70612102
         XC    WTGENTRY,WTGENTRY        CLEAR WTG TABLE ENTRY           70613002
*                                                                       70613902
*        WTGENTRY IS NONZERO FOR THE NEXT LOOP THROUGH                  70614802
*        THE DCB'S ONLY IF A DELAY OR IGNORE ABEND IS BEING             70615702
*        PROCESSED OR IF A DYNAMIC UNALLOCATION IS TO                   70616602
*        TAKE PLACE. THESE ARE MUTUALLY EXCLUSIVE SITUATIONS            70617502
*                                                                Y02082 70618402
CFN08030 EQU   *                        CHECK LAST ENTRY         Y02134 70619302
         TM    DXDCBLST,LASTNTRY        TEST FOR LAST ENTRY      Y02134 70620202
         LA    RWTGC,WTGENTRY+L'WTGENTRY NEXT WTG ENTRY          Y02134 70621102
         LA    RPARC,DXDCBLST+L'DXDCBLST NEXT DCB ENTRY          Y02134 70622002
         BZ    CFN08005                 GET NEXT WORKAREA        Y02134 70622902
         EJECT                                                          70623802
         L     RPARC,WTGPREFX           LOAD PREFIX ADDRESS      Y02134 70624702
         L     RPARC,IECUPRML-IECPREFX(,RPARC) PARM LIST POINTER Y02134 70625602
         LA    RWTGC,WTGENTRY-WTG(,RWTG) WTG ENTRY POINTER       Y02134 70626502
CFN08035 EQU   *                        UNALLOCATE IF REQUESTED  Y02134 70627402
         L     RDCB,DXDCBLST            LOAD DCB ADDRESS         Y02134 70628302
         L     RCORE,WTGCORE-K1         GET WORKAREA ADDR        Y02134 70629202
         LA    RCORE,FORCORE            CLEAR HIGH ORDER BYTE    Y02134 70630102
         LTR   RCORE,RCORE              WORKAREA ADDR PRESENT    Y02134 70631002
         BZ    CFN08055                 BRANCH IF NOT            YM1342 70631902
         TM    JFCBMASK+K4,JFCMABND     DELAYED ABEND PENDING    Y02144 70632802
         BO    CFN08055                 BR IF YES                Y02144 70633702
         TM    DXATOPEN,DXATIGN         IGNORED ABEND PENDING    Y02144 70634602
         BO    CFN08055                 BR IF YES                Y02144 70635502
*                                                                       70636402
*        THIS DCB MUST NEED IT'S DD ENTRY UNALLOCATED                   70637302
*                                                                       70638202
         TM    WTGPATHS+K1,WTGTSENQ     ENQ ON TIOT?             YM3160 70639102
         BO    CFN08040                 YES, DEQ TIOT            YM3160 70640002
*                                                                       70640902
*        NO, TEST FOR CALLER ENQ                                 YM3160 70641802
*        WTGTSENQ MAY BE OFF BECAUSE WE HAVE ALREADY DEQED       YM3160 70642702
*        FOR A PREVIOUS DCB IN THIS LOOP, OR BECAUSE THE CALLER  YM3160 70643602
*        OF CLOSE HAS OBTAINED THE TIOT RESOURSE.                YM3160 70644502
*        AN ENQ RET=TEST WILL BE ISSUED. IF THE RESOURSE IS      YM3160 70645402
*        HELD BY THIS TASK, IT MUST BE BECAUSE THE CALLER HAS    YM3160 70646302
*        ENQED. IN THIS CASE THE UNALLOCATE WILL BE BYPASSED.    YM3160 70647202
*        THIS HANDLES AN INNER ACB CLOSE FOR A COMPATIBILITY     YM3159 70648102
*        INTERFACE SITUATION AS THE OUTER CLOSE HAS ENQED ON     YM3159 70649002
*        THE TIOT ALREADY.                                       YM3159 70649902
*                                                                       70650802
         MVC   ENQLIST(ENQLTH),ENQMACRO MOVE IN LIST FORM        YM3160 70651702
         L     RC,DXASCBAD              ASCB ADDRESS             YM3160 70652602
         USING ASCB,RC                                           YM3160 70653502
         MVC   ENQASID,ASCBASID         ASID TO MINOR NAME       YM3160 70654402
         DROP  RC                                                YM3160 70655302
         L     RC,DXTCBADR              CURRENT TCB              YM3160 70656202
         L     RC,TCBJSCB-TCB(,RC)      TCB'S JSCB               YM5333 70658002
         USING IEZJSCB,RC                                        YM3160 70658902
         L     RC,JSCBACT               ACTIVE JSCB              YM3160 70659802
         MVC   ENQDSABQ,JSCDSABQ        DSAB QDB TO MINOR NAME   YM3160 70660702
         DROP  RC                                                YM3160 70661602
         ENQ   (,ENQMIN),MF=(E,ENQLIST)  ENQ TIOT                YM3160 70662502
         LTR   RF,RF                    CALLER ENQUEUED?         YM3160 70663402
         BZ    CFN08045                 USER NOT ENQ, UNALLOC    YM3160 70664302
         CLI   K3(RF),PREVREQ           CALLER OBTAINED RESOURCE YM3160 70665202
         BE    CFN08050                 YES, NO UNALLOC          YM3160 70666102
         B     CFN08045                 UNALLOCATE IF RC=4 SINCE YM3160 70667002
*                                       UNALLOC WILL WAIT FOR IT YM3160 70667902
*                                                                       70668802
PREVREQ  EQU   08                       PREVIOUS REQUEST, RESOR  YM3160 70669702
*                                                                       70670602
CFN08040 EQU   *                        DEQUEUE RESOURCE         YM3160 70671502
*                                                                       70672402
*        THE TIOT RESOURSE WILL BE DEQED BEFORE CALLING          YM3160 70673302
*        DYNAMIC UNALLOCATION.                                   YM3160 70674202
*                                                                       70675102
         L     RC,DXASCBAD              ASCB ADDR                YM3160 70676002
         USING ASCB,RC                                           YM3160 70676902
         MVC   DEQASID,ASCBASID         MOVE ASID TO MIN NAME    YM3160 70677802
         L     RC,DXTCBADR              CURRENT TCB              YM3160 70678702
         L     RC,TCBJSCB-TCB(,RC)      TCB'S JSCB               YM5333 70680502
         USING IEZJSCB,RC                                        YM3160 70681402
         L     RC,JSCBACT               ACTIVE JSCB ADDR         YM3160 70682302
         MVC   DEQDSABQ,JSCDSABQ        MOVE DSAB QDB ADDR TO    YM3160 70683202
*                                       MINOR NAME               YM3160 70684102
         DROP RC                                                 YM3160 70685002
         MVC   DEQLIST(DEQLTH),DEQMACRO  MOVE IN LIST FORM       YM3160 70685902
         DEQ   (,DEQMIN),MF=(E,DEQLIST) DEQ TIOT                 YM3160 70686802
         NI    WTGPATHS+K1,ALLBITS-WTGTSENQ TURN OFF ENQ BIT     YM3160 70687702
CFN08045 EQU   *                                                        70688602
         LA    R1,DXLBL                 LOAD POINTER TO PARMS    Y02134 70689502
         DYNALLOC ,                     INVOKE DYN UNALLOCATION  Y02134 70690402
CFN08050 EQU   *                        END OF S/I PROCESSING    Y02083 70691302
         XC    WTGENTRY,WTGENTRY        CLEAR WTG TABLE ENTRY           70692202
*                                                                Y02082 70693102
CFN08055 EQU   *                        CHECK LAST ENTRY         Y02134 70694002
         TM    DXDCBLST,LASTNTRY        TEST FOR LAST ENTRY      Y02134 70694902
         LA    RWTGC,WTGENTRY+L'WTGENTRY NEXT WTG ENTRY          Y02134 70695802
         LA    RPARC,DXDCBLST+L'DXDCBLST NEXT DCB ENTRY          Y02134 70696702
         BZ    CFN08035                 GET NEXT WORKAREA        Y02134 70697602
*                                                                       70698502
*********************************************************************** 70699402
*                                                                       70700302
*  SEE IF THERE IS A DCB LEFT THAT HAS A DEFERRED ABEND PENDING.        70750302
*                                                                       70800302
         L     RPAR,WTGPREFX            WTG PREFIX ADDR          YM3159 70800902
         L     RPAR,IECUPRML-IECPREFX(,RPAR) GET PARM LIST       YM3159 70801502
         LR    RPARC,RPAR               ADDR OF FIRST DCB ENTRY  Y02144 70850302
         LA    RWTGC,WTGENTRY-WTG(,RWTG) ADDR OF FIRST WTG ENTRY Y02144 70900302
         L     RC,WTGPREFX              GET WTG PREFIX PTR       Y02144 70910302
         L     RC,IECRRPRM-IECPREFX(,RC) GET RRPLIST ADDRESS     Y02144 70920302
         USING RRPLIST,RC                                        Y02144 70930302
*                                                                       70950302
CFN08080 EQU   *                         GET WA ADDR             Y02144 71000302
         L     RCORE,WTGCORE-K1         LOAD MAIN WORK AREA ADDR Y02144 71050302
         LA    RCORE,0(RCORE)           CLEAR HIGH ORDER BYTE    Y02144 71100302
         LTR   RCORE,RCORE              WORK AREA PRESENT        Y02144 71150302
         BZ    CFN08090                 BR IF NO, ADDR CLEARED   Y02144 71200302
         TM    JFCBMASK+K4,JFCMABND     DELAYED ABEND DCB?       Y02144 71250302
         BO    CFN08095                 YES, GO ISSUE ABEND      Y02144 71300302
*                                       NO,MUST BE IGNORED ABEND Y02144 71400302
         CLC   RRMLRTRY,RRFWORK         PRIOR IGNORED ABEND DCB  Y02144 71600302
         BNE   CFN08090                 YES,GO CHK IF LAST ENTRY Y02144 71650302
         STM   RPARC,RWTGC,RRMLRTRY     SAVE CURR DCB ENTRY ADDR Y02144 71700302
*                                       AND CURR WTG ENTRY ADDR  Y02144 71750302
*********************************************************************** 71800302
*                                                                       71850302
*  CHECK FOR END OF LOOP LOOKING FOR A DELAYED/IGNORED ABEND.           71900302
*                                                                       71950302
CFN08090 EQU   *                        LOOK FOR DELAYED ABEND   Y02144 72000302
         TM    PLISTOPT(RPARC),LASTNTRY CHECK FOR LAST DCB ENTRY Y02144 72050302
         LA    RPARC,K4(RPARC)          POINT TO NEXT DCB ENTRY  Y02144 72100302
         LA    RWTGC,L'WTGENTRY(RWTGC)  POINT TO NEXT WTG ENTRY  Y02144 72150302
         BZ    CFN08080                 BR NO TO CHK FURTHER FOR Y02144 72200302
*                                       A DELAYED ABEND DCB      Y02144 72250302
         CLC   RRMLRTRY,RRFWORK         IGNORED ABEND PENDING    Y02144 72300302
         BE    CFN08100                 NO, BR TO FREE WTG TABLE Y02144 72350302
         LM    RPARC,RWTGC,RRMLRTRY     GET CURR DCB ENTRY ADDR  Y02144 72400302
*                                       AND CURR WTG ENTRY ADDR  Y02144 72450302
         LA    RCORE,CFN08100           GET MAINLINE RETRY ADDR  Y02144 72500302
         ST    RCORE,RRMLRTRY           SAVE MAINLINE RETRY ADDR Y02144 72550302
         XC    RRFWORK,RRFWORK          CLEAR RRPLIST WORK WORD  Y02144 72560302
         L     RCORE,WTGCORE-K1         LOAD MAIN WORK AREA ADDR Y02144 72570302
*                                                                       72580302
*********************************************************************** 72590302
*                                                                       72592302
*  DO A DELAYED/IGNORED ABEND ON THIS DCB.  RESTORE REGISTERS FIRST.    72594302
*                                                                       72596302
CFN08095 EQU   *                        DO DELAYED ABEND         Y02144 72598302
         L     RDCB,DXUDCBAD            LOAD CURRENT DCB ADDR    YM5924 72598702
         LM    RTIOT,RET,DXREG9         RESTORE REGISTERS 9-14   Y02144 72599102
         L     R0,DXREG0                RESTORE REGISTER 0       Y02144 72599502
*                                                                Y02144 72599902
         SR    RF,RF                    CLEAR REG                Y02144 74100002
         IC    RF,DXRETCOD              LOAD RETURN CODE         Y02144 74400002
         LH    R1,DXABCODE              LOAD ABEND CODE INTO R1  Y02144 74402002
         SRL   R1,K4                    POSITION THE ABEND CODE  Y02144 74404002
         ABEND (1),DUMP,,SYSTEM,        SYSTEM ABEND WITH A DUMP Y02144*74406002
               DUMPOPT=SNAPLIST                                  Y02144 74416002
*                                                                Y02144 74456002
*****************************************************************Y02134 74506002
*                                                                Y01018 74556002
*        RELEASE WTG TABLE CORE                                  Y01018 74606002
*                                                                Y02134 74656002
*****************************************************************Y02134 74706002
CFN08100 EQU   *                        RELEASE WORK AREAS       Y02144 74716002
*                                                                Y01018 74756002
         SR    R9,R9                    ZERO REGISTER            Y02080 74856002
         IC    R9,WTGLNG                SAVE RETURN CODE         Y02080 74906002
         IECRES FREE,A=(RWTG),PREFIX=WTG  FREE WTG TABLE         Y02080 74956002
         LR    RF,R9                    LOAD RETURN CODE         X02080 75006002
*                                                                Y02080 75056002
*        RETURN TO CALLER                                        Y02080 75106002
*                                                                Y02080 75156002
         IECRES EXIT                    RETURN                   Y02080 75206002
*                                                                Y02080 75256002
         EJECT                                                          75900021
*                                                                       75905002
*        DECREMENT DSAB OPEN COUNT FOR VSAM ACB                  Y02134 75910002
*                                                                       75915002
*        FIRST CHECK IF DSAB EXISTS                              YM3974 75917002
CFN08200 EQU   *                        DECREMENT DSAB OPEN CT   YM3974 75919002
         MVI   DXATCLOS,DXATSABS        START DECREMENTING OPEN  YM3974 75919102
*                                       COUNT IN DSAB(S)         Y02134 75919202
         L     RB,DXDSABAD              GET DSAB                 YM3974 75919402
         LA    RB,K0(,RB)               ZERO HIGH ORDER BYTE     YM3974 75919802
         LTR   RB,RB                    TEST FOR ZERO            YM3974 75922302
         BZ    CFN08550                 IF NO DSAB GO TO RETURN  YM3974 75927502
         MODESET EXTKEY=SCHED           DSAB KEY                 Y02134 75935002
         USING DSAB,RB                                           Y02134 75940002
CFN08300 EQU   *                        DSAB                     Y02134 75945002
         L     RC,DSABOPCT-K2           FULLWORD HOLDING COUNT   Y02134 75955002
         LR    RF,RC                    SAVE FOR CS              Y02134 75960002
         SRDL  RC,K16                   SHIFT COUNT TO RD        Y02134 75965002
         SRA   RD,K16                   PROPOGATE SIGN FOR LTR   Y02134 75970002
         LTR   RD,RD                    MAKE SURE ITS POSITIVE   Y02134 75975002
         BNP   CFN08400                 BRANCH IF NO-NEXT DSAB   Y02134 75980002
         BCTR  RD,R0                    DECREMENT COUNT          Y02134 75985002
         SLL   RD,K16                   SHIFT TO HIGH 16 BITS    Y02134 75990002
         SLDL  RC,K16                   UPDATED FULLWORD IN RC   Y02134 75995002
         CS    RF,RC,DSABOPCT-K2        TRY TO SNEAK IT IN       Y02134 76000002
         BNZ   CFN08300                 BRANCH TO TRY ONCE MORE  Y02134 76005002
CFN08400 EQU   *                        CHECK FOR NEXT DSAB      Y02134 76010002
         L     RB,DSABFCHN              NEXT DSAB                Y02134 76015002
         LTR   RB,RB                    IS THERE ANOTHER         Y02134 76020002
         BZ    CFN08500                 BRANCH IF NO TO EXIT     Y02134 76025002
         L     RTIOT,DSABTIOT           GET TIOT ENTRY           Y02134 76030002
         CLI   TIOEDDNM,C' '            CONCATENATION            Y02134 76035002
         BE    CFN08300                 BRANCH IF YES            Y02134 76040002
CFN08500 EQU   *                        NO MORE DSAB'S           Y02134 76045002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMT KEY  Y02134 76050002
CFN08550 EQU   *                        SET RECOVERY IND         YM3974 76052002
         MVI   DXATCLOS,DXATSABF        FINISHED DECREMENTING    Y02134 76055002
*                                       OPEN COUNT IN DSAB(S)    Y02134 76060002
         L     RTIOT,DXTIOTAD           RELOAD TIOT ADDRESS      Y02134 76065002
         B     CFN07740                 RETURN                   YM6572 76070002
         EJECT                                                          76075002
**********************************************************************  76500021
*                                                                    *  76800021
*                    CONSTANTS                                       *  77100021
*                                                                    *  77400021
**********************************************************************  77700021
         SPACE 1                                                        78000021
CFNMOVER MVC   K0(K0,RDCB),K0(RC)       OBJECT OF EXECUTE INS    Y02083 78000502
DYNDDNAM DC    AL2(DUNDDNAM)            DYN UNALLOC CONSTANT     Y02134 78555002
DYNPERM  DC    AL2(DUNUNALC)            DYN UNALLOC CONSTANT     Y02134 78556002
CKSITEXT DC    CL24'CHECKPOINT PROTECTED DCB'  EXPLANATORY TEXT  YM5766 78557002
*                                                                       78558002
SNAPLIST SNAP  SDATA=TRT,MF=L           READ ONLY SNAP LIST FOR  Y02144*78566002
                                        ABEND OPTION DUMPOPT     Y02144 78576002
*                                                                       78586002
ENQMACRO ENQ   (SYSZTIOT,,S,6,SYSTEM),RET=TEST,MF=L ENQ PARMLIST YM3160 78596002
ENQLTH   EQU   *-ENQMACRO               LENGTH OF PARM LIST      YM3160 78596402
DEQMACRO DEQ   (SYSZTIOT,,6,SYSTEM),RET=HAVE,MF=L DEQ PARMLIST   YM3160 78596802
DEQLTH   EQU   *-DEQMACRO               LENGTH OF PARM LIST      YM3160 78597202
SYSZTIOT DC    CL8'SYSZTIOT'            TIOT ENQ MAJOR NAME      YM3160 78597602
*                                                                       78597702
*********************************************************************** 78598002
*              XCTL TABLE                                             * 78598402
*********************************************************************** 78598802
*                                                                       78599202
         XCTLTABL ID=(EXITMOD,9L,OPENLD,IGC0101I),SVC=020,       YM1403X78600002
               BRT=YES,LENGTH=                                   Y02080 78602002
         IECEQU AOS=YES                                          X02989 78700002
FREE     EQU   X'20'                    CLOSE OPTION FREE        Y02134 78705002
         IEFZB4D0                                                Y02134 78710002
         IEFZB4D2                                                Y02134 78715002
         IECDSECS CVT,TCB,RB,DSAB,TIOT,DCB,ACB,DEB,UCB,          Y02134X78900002
               MAIN,WTG,PREFX,RRPL,JSCB,ASCB,EXPAND=YES          YM3160 78910002
FORCORE  DSECT                          REESTABLISH FORCORE      YM3159 78910602
         ORG   DXCCW                    ENQ DSECT OVER CCW AREA  YM3159 78911202
ENQLIST  DS    0C                       ENQ MACRO AREA           YM3160 79010002
         ORG   *+ENQLTH                                          YM3160 79060002
ENQMIN   DS    0CL6                     MINOR NAME               YM3160 79110002
ENQASID  DS    CL2                      ASID AREA                YM3160 79160002
ENQDSABQ DS    CL4                      DSAB QDB ADDRESS AREA    YM3160 79210002
ENQPARML EQU   *-ENQLIST                LENGTH OF ENQPARMS       YM3160 79260002
         SPACE 2                                                 YM3160 79310002
         ORG   DXCCW                    DEQ DSECT OVER CCW AREA  YM3159 79310602
DEQLIST  DS    0C                       DEQ MACRO AREA           YM3160 79410002
         ORG   *+DEQLTH                                          YM3160 79460002
DEQMIN   DS    0CL6                     MINOR NAME               YM3160 79470002
DEQASID  DS    CL2                      ASID AREA                YM3160 79480002
DEQDSABQ DS    CL4                      DSAB QDB ADDRESS AREA    YM3160 79490002
DEQPARML EQU   *-DEQLIST                LENGTH OF DEQPARMS       YM3160 79492002
         END                                                            79500021
