         TITLE 'IFG0232D - TCLOSE DIRECT ACCESS PROCESSING'      S21940 00200021
IFG0232D CSECT                                                   S21940 00640021
*                                                                       00660021
*********************************************************************** 00680021
*                                                                     * 00700021
*         VS2 RELEASE 03 DELETIONS/CHANGES                            * 00702002
*0000657500                                                     ZA01505 00702402
*0000                                                          @ZA02192 00702802
*                                                                       00704002
*         VS1 RELEASE 02 DELETIONS                                    * 00710002
*                                                                     * 00712002
*0000                                                            XM1011 00714002
*         VS2 RELEASE 02 DELETIONS/CHANGES                            * 00800002
*0000273750                                                     YA03128 00810002
*         RELEASE 21.7 DELETIONS/CHANGES                              * 01450021
*0000128500-128900,135000,198000,198600-200000,274600,414000-   SA58019 01451002
*0000415000,530000,534600-536000                                SA58019 01452002
*0000612000,614000                                              SA57255 01550021
*         RELEASE 21 DELETIONS/CHANGES                                * 01600021
*                                                                A35953 01660021
*0000304800,648000                                               S21940 01720021
*D017200,129000-142000,195000,264100-271100,476000              SA48558 01770021
*                                                                     * 01800021
* MODULE NAME - IFG0232D                                              * 01810002
*                                                                     * 01820002
* DESCRIPTIVE NAME - TCLOSE DIRECT ACCESS PROCESSING                  * 01830002
*                                                                     * 01840002
* COPYRIGHT - NONE                                                    * 01850002
*                                                                     * 01860002
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING THE CSECT CARD.   * 01870002
*                                                                     * 01880002
* STATUS CHANGE LEVEL 000                                             * 01900021
*                                                                     * 02000021
* FUNCTION -                                                          * 02100021
*    THIS MODULE CONTAINS THE FOLLOWING FUNCTIONS-                    * 02200021
*    1. TCLOSE DIRECT ACCESS INPUT FUNCTION.                          * 02300021
*    2. TCLOSE DIRECT ACCESS OUTPUT FUNCTION, PART I.                 * 02400021
*                                                                     * 02500021
* ENTRY POINTS -                                                      * 02600021
*         IFG0232D - REFER TO 'INPUT' FOR A LIST OF CALLING MODULES   * 02700021
*                    AND THEIR RESPECTIVE ENTRY CONDITIONS.           * 02800021
*                                                                     * 02900021
* INPUT -                                                             * 03000021
*    ENTERED IN DATA MANAGEMENT KEY                              Y02082 03050002
*    REGISTER 14 ('RET') WILL CONTAIN ONE OF THE BRANCH TABLE OFFSETS * 03100021
*    LISTED BELOW, THE BRANCH TABLE BEING USED TO DETERMINE AT WHICH  * 03200021
*    POINT PROCESSING IS TO BEGIN-                                    * 03300021
*       0 - ENTRY FROM IGC0002C TO TCLOSE A DATA SET ON A             * 03400021
*           DIRECT ACCESS DEVICE.                                     * 03500021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOGS' FOR ADDITIONAL INPUT.  * 03600021
*                                                                     * 03700021
* OUTPUT -                                                            * 03800021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 03850002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOGS'.                       * 03900021
*                                                                     * 04000021
* EXTERNAL REFERENCES -                                               * 04100021
*         IECPCNVT - A CLOSED SUBROUTINE- RESIDENT IN THE NUCLEUS-    * 04200021
*                    WHICH CONVERTS A RELATIVE TRACK ADDRESS AND      * 04300021
*                    CONCATENATION NUMBER, 'TTRN', TO AN ABSOLUTE     * 04400021
*                    TRACK ADDRESS, 'MBBCCHHR', UTILIZING THE         * 04500021
*                    FOLLOWING REGISTER CONVENTIONS-                  * 04600021
*                    REGISTER  CONTENTS AT ENTRY     CONTENTS AT EXIT * 04700021
*                      0       TTRN TO BE CONVERTED  DESTROYED        * 04800021
*                      1       DEB ADDRESS           TRANSPARENT      * 04900021
*                      2       ADDR OF 8-BYTE AREA   TRANSPARENT      * 05000021
*                              FOR MBBCCHHR                           * 05100021
*                      3-8     IGNORED               TRANSPARENT      * 05200021
*                      9-13    IGNORED               DESTROYED        * 05300021
*                      14      RETURN ADDRESS        TRANSPARENT      * 05400021
*                      15      ENTRY POINT ADDRESS   ERROR CODE       * 05500021
*                    THE ERROR CODE WILL BE '0' IF THE CONVERSION IS  * 05600021
*                    SUCCESSFUL AND '1' IF THE 'TT' EXCEEDS THE       * 05700021
*                    NUMBER OF EXTENTS ASSIGNED TO THE DATA SET.      * 05800021
*         IECPRLTV - A CLOSED SUBROUTINE- RESIDENT IN THE NUCLEUS-    * 05900021
*                    WHICH CONVERTS AN ABSOLUTE TRACK ADDRESS,        * 06000021
*                    'MBBCCHHR', TO A RELATIVE TRACK ADDRESS, 'TTR0', * 06100021
*                    UTILIZING THE FOLLOWING REGISTER CONVENTIONS-    * 06200021
*                    REGISTER  CONTENTS AT ENTRY     CONTENTS AT EXIT * 06300021
*                      0       IGNORED               RESULTANT TTR0   * 06400021
*                      1       DEB ADDRESS           TRANSPARENT      * 06500021
*                      2       ADDR OF MBBCCHHR      DESTROYED        * 06600021
*                              TO BE CONVERTED                        * 06700021
*                      3-8     IGNORED               TRANSPARENT      * 06800021
*                      9-13    IGNORED               DESTROYED        * 06900021
*                      14      RETURN ADDRESS        TRANSPARENT      * 07000021
*                      15      ENTRY POINT ADDRESS   '0'              * 07100021
*         IFG019RA - OPEN/CLOSE/EOV RESIDENT ROUTINE FOR XCTL AND     * 07200002
*                    WAIT.                                            * 07300021
*                                                                     * 07400021
* EXITS, NORMAL -                                                     * 07500021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOGS'.                       * 07600021
*                                                                     * 07700021
* EXITS, ERROR -                                                      * 07800021
*         IFG0230P - WHEN AN ERROR CONDITION OCCURS IN THIS MODULE.   * 07900021
*                    REFER TO 'OUTPUT' IN THE FOLLOWING 'FUNCTION     * 08000021
*                    PROLOGS' FOR A LIST OF ERROR CONDITIONS.         * 08100021
*                                                                     * 08200021
* TABLES/WORK AREAS -                                                 * 08300021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOGS'.                       * 08400021
*                                                                     * 08500021
* ATTRIBUTES -                                                        * 08600021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 08700021
*                                                                     * 08800021
* CHARACTER CODE DEPENDENCY -                                         * 08900021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 09000021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 09100021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 09200021
*                                                                     * 09300021
* NOTES -                                                             * 09400021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 09500021
*                                                                     * 09600021
*********************************************************************** 09700021
         EJECT                                                   S21940 09750021
*                                                                S21940 09800021
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY S21940 09900021
         USING *,RBASE                                           S21940 10000021
*                                                                S21940 10100021
         USING FORCORE,RCORE                                     S21940 10200021
         USING WTG,RWTG                                          Y02080 10250002
         USING IHADCB,RDCB                                       S21940 10300021
         USING IHADEB,RDEB                                       S21940 10400021
         USING TIOENTRY,RTIOT                                    S21940 10500021
         USING UNITABLE,R1                                       S21940 10600021
         USING UCB,RUCB                                          Y02132 10602502
*                                                                       10700021
*****    DETERMINE TYPE OF ENTRY TO MODULE-                             10800021
*****    ALTHOUGH THERE IS ONLY A SINGLE ENTRY POINT TO THIS            10900021
*****    MODULE AT THIS TIME, THE BRANCH TABLE IS UTILIZED TO PERMIT    11000021
*****    ADDITION OF NEW ENTRY POINTS AT A LATER DATE                   11100021
*                                                                       11200021
         B     TCD00050(RET)            DETERMINE TYPE OF ENTRY  S21940 11300021
TCD00050 EQU   *                                                 S21940 11400021
         B     TCD00100                 BR TO PROCESS DA         S21940 11500021
         EJECT                                                          11600021
*********************************************************************** 11700021
*                                                                     * 11800021
*                          FUNCTION PROLOG                            * 11900021
*                                                                     * 12000021
*********************************************************************** 12100021
*                                                                     * 12200021
* FUNCTION NAME - 'TCLOSE DIRECT ACCESS INPUT FUNCTION'               * 12300021
*                                                                     * 12400021
* (STATUS) -                                                          * 12500021
*    NOT APPLICABLE                                                   * 12600021
*                                                                     * 12700021
* FUNCTION -                                                          * 12800021
*    1. TEST THE DCB FOR VALID ATTRIBUTES FOR BOTH INPUT AND OUTPUT   * 12850002
*       DATA SETS - IT MUST BE OPENED FOR PHYSICAL SEQUENTIAL         * 12860002
*       (DSORG=PS) OR PARTITIONED (DSORG=PO) PROCESSING.              * 12870002
*       PROCESSING IS TERMINATED IF EITHER CONDITION IS NOT MET.      * 12880002
*    2. READ THE FORMAT 1 (F1) DATA SET CONTROL BLOCK (DSCB) FOR      * 12900021
*       BOTH INPUT AND OUTPUT PROCESSING.                             * 13000021
*    3. A DATA SET ON A DIRECT ACCESS DEVICE IS 'REPOSITIONED' BY     * 13300021
*       MODIFYING THE 'DCBFDAD' AND IOB SEEK FIELDS AS INDICATED      * 13400021
*       BELOW FOR THE DATA SET ORGANIZATIONS SHOWN.  USE OF TCLOSE    * 13450002
*       FOLLOWING INPUT IS NOT PERMITTED FOR DCBS OPENED TO A MEMBER  * 13500002
*       OF A PARTITIONED DATA SET.  IT IS ALSO RESTRICTED TO PHYSICAL * 13510002
*       SEQUENTIAL DCBS WHICH ARE USED TO PROCESS THE DATA SET        * 13520002
*       ORGANIZATIONS SHOWN BELOW:                                    * 13530002
*       'REREAD'-                                                     * 13550021
*          PS, DA, IS, UNDEFINED (I.E., A VTOC), AND PO NOT OPENED TO * 13600021
*             A MEMBER- POINT TO THE BEGINNING OF THE DATA SET USING  * 13650021
*             THE FIRST EXTENT IN THE DEB. NOTE THAT THIS POSITIONS   * 13700021
*             A PO DATA SET TO THE DIRECTORY.                         * 13750021
*       'LEAVE'-                                                      * 13800021
*          PS AND PO NOT OPENED TO A MEMBER- POINT TO THE FILE MARK   * 13850021
*             THAT DENOTES THE END OF THE DATA SET USING 'DSCLSTAR'   * 13900021
*             AND UPDATE 'DCBTRBAL' FROM 'DSCLSTAR' TO REFLECT THE    * 13950021
*             NUMBER OF BYTES REMAINING ON THE TRACK.                 * 14000021
*       PROCESSING IS TERMINATED FOR ALL OTHER CONDITIONS.            * 14100002
*                                                                     * 14300021
* ENTRY POINTS -                                                      * 14400021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 14500021
*                                                                     * 14600021
* INPUT -                                                             * 14700021
*    1. REGISTER CONTENTS AT ENTRY ARE AS FOLLOWS-                    * 14800021
*       'RDCB' - ADDRESS OF THE DCB BEING PROCESSED.                  * 14900021
*       'RCORE'- ADDRESS OF THE WORK AREA FOR THAT DCB.               * 15000021
*       'RES'  - ADDRESS OF THE OPEN/CLOSE/EOV RESIDENT ROUTINE.      * 15100021
*       'RWTG' - ADDRESS OF THE WHERE-TO-GO TABLE.                    * 15200021
*       'RPARC'- ADDRESS OF THE CURRENT TCLOSE PARAMETER LIST ENTRY.  * 15300021
*       'RWTGC'- ADDRESS OF THE CURRENT WHERE-TO-GO TABLE ENTRY.      * 15400021
*       'RTIOT'- ADDRESS OF THE CURRENT TIOT ENTRY FOR THE DCB.       * 15500021
*       'RUCB' - ADDRESS OF THE CURRENT UCB FOR THE DCB.              * 15600021
*       'RDEB' - ADDRESS OF THE DCB'S DEB.                            * 15700021
*                                                                     * 15800021
* OUTPUT -                                                            * 15900021
*    1. AT EXIT TO IFG0232Z-                                          * 16000021
*       REGISTER CONTENTS ARE THE SAME AS AT ENTRY EXCEPT THAT        * 16100021
*          REGISTER 'RET' CONTAINS A BRANCH TABLE OFFSET OF '4'.      * 16200021
*    2. AT EXIT TO IFG0230P (PROBLEM DETERMINATION)-                  * 16300021
*       REGISTER CONTENTS ARE THE SAME AS AT ENTRY EXCEPT THAT        * 16400021
*          REGISTER 'R0' CONTAINS ONE OF THE FOLLOWING INTERNAL       * 16500021
*          ERROR CODES (THE CORRESPONDING ABEND AND RETURN CODES ARE  * 16600021
*          INDICATED IN PARENTHESES)-                                 * 16700021
*          132 (317/04)- ERROR READING THE DSCB.                      * 16800021
*          142 (---/00)- MESSAGE ONLY- DCB IS NOT PHYSICAL            * 16810002
*                        SEQUENTIAL OR PARTITIONED.                   * 16820002
*          143 (---/04)- MESSAGE ONLY- DCB IS OPENED FOR INPUT TO     * 16830002
*                        A MEMBER OF A PARTITIONED DATA SET.          * 16840002
*                        PROCESSING COULD NOT BE PERFORMED.           * 16850002
*          144 (---/08)- MESSAGE ONLY- 'LEAVE' OPTION SPECIFIED FOR   * 16860002
*                        AN INVALID DATA SET ORGANIZATION.            * 16870002
*                        PROCESSING COULD NOT BE PERFORMED.           * 16880002
*       WORK AREA INDICATORS-                                         * 16900021
*          'DXCCW1'   - CONTAINS A X'FF' WHEN PROCESSING HAS BEEN     * 16950021
*                       TERMINATED ON THE CORRESPONDING DCB.          * 16960021
*          'DXCALLID' - CONTAINS THE 2-BYTE ID OF THIS MODULE.        * 17000021
*          'DXRETMOD' - CONTAINS THE 5-BYTE ID AND TTR OF THE FINAL   * 17050021
*                       LOAD OF TCLOSE WHEN PROCESSING HAS BEEN       * 17060021
*                       TERMINATED ON A DCB.                          * 17070021
*                                                                     * 17100021
* EXTERNAL REFERENCES -                                               * 17200021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 17300021
*                                                                     * 17400021
* EXITS, NORMAL -                                                     * 17500021
*         IFG0232Z - TO PERFORM TCLOSE FINAL PROCESSING.              * 17600021
*                                                                     * 17700021
* EXITS, ERROR -                                                      * 17800021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 17900021
*                                                                     * 18000021
* TABLES/WORK AREAS -                                                 * 18100021
*    THE TCLOSE WORK AREA AND THE WHERE-TO-GO (WTG)                   * 18200021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 18300021
*                                                                     * 18400021
* ATTRIBUTES -                                                        * 18500021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 18600021
*                                                                     * 18700021
* CHARACTER CODE DEPENDENCY -                                         * 18800021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 18900021
*                                                                     * 19000021
* NOTES -                                                             * 19100021
*                                                                     * 19200021
*********************************************************************** 19300021
         EJECT                                                   S21940 19350021
*                                                                       19400021
*****    INSURE THAT THE DCB HAS PROPER ATTRIBUTES FOR TCLOSE   SA48558 19500021
*                                                                       19600021
TCD00100 EQU   *                                                 S21940 19700021
         LA    R1,TABD142               CODE FOR INVALID DCB    SA48558 19750021
         NC    DCBDSORG,DCBDSORG        ANY DSORG SPECIFIED?   @ZA02192 19760002
         BZ    TCD00105                 NO, ASSUME 'PS'        @ZA02192 19770002
         TM    DCBDSORG,DCBORGPS+DCBORGPO  IS DCB 'PS' OR 'PO'  SA58019 19800002
         BZ    TCD01560                 ..BR IF NOT- ERROR      SA48558 19850021
*                                                               SA48558 20050021
*****    PREPARE TO READ THE FORMAT 1 (F1) DSCB                 SA48558 20100021
*                                                               SA48558 20150021
TCD00105 EQU   *                                               @ZA02192 20160002
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 20200002
         BNO   TCD00120                 BR IF NOT                Y02132 20250002
TCD00110 EQU   *                        READ VIO DSCB FROM SWA   YM7525 20300002
         MVC   DXDSCB(DSCEXT2-DSCFMTID),VDSDSCB-VDSUCB+L'JFCBDSNM(RUCB) 20350002
*                                                                Y02132 20400002
         OC    DXDSCB(DSCEXT2-DSCFMTID),DXDSCB IS DSCB ZERO?     Y02132 20450002
         LA    R1,TABD132               INTERNAL I/O ERROR CODE  Y02132 20500002
         BZ    TCD01600                 BR IF YES, I/O ERROR     Y02132 20550002
*                                                                Y02132 20600002
         XC    DSCEXT2(DSCBEND-DSCEXT2),DSCEXT2 ZERO REMAIN CORE Y02132 20650002
*                                                                Y02132 20700002
         B     TCD00140                 RESUME PROCESSING        Y02132 20750002
*                                                                Y02132 20800002
*****    BUILD THE WORK AREA DEB AND THE CHANNEL PROGRAM         Y02132 20900002
*                                                                Y02132 21000002
TCD00120 EQU   *                        BUILD THE WORK AREA DEB  Y02132 21100002
         LA    RC,K16                   SUBTRACT 16 FROM BASE OF DEB    24800021
         SR    RDEB,RC                  TO ESTABLISH BASE OF VTOC TRK   25000021
         MVC   DXDEBBIN(K2),K1(RDEB)    MOVE BIN NR IN WK DEB           25200021
         XC    DXDEBSCC(K4),DXDEBSCC    SET BEGINNING CCHH TO ZERO      25400021
         MVC   DXDEBECC(K6),MAXEXTNT    SET ENDING CCHH AND NO.  S21940 25500021
*                                       ..OF TRACKS TO MAXIMUM   S21940 25600021
*                                       ..POSSIBLE               S21940 25700021
         MVC   DXDAADDR+K1(K7),K1(RDEB)  PLACE SEARCH ADDRESS IN SEEK   25800021
         AR    RDEB,RC                  POINT BACK TO BASIC DEB  S21940 25820021
         LA    RD,DXDAADDR+K3           PLACE ADDRESS OF CCHHR   S21940 25840021
         ST    RD,DXCCW1                ..INTO FIRST CCW         S21940 25860021
         MVI   DXCCW1,CCWSCHID          SET CCW1 TO 'SEARCH      S21940 25880021
*                                       ..ID EQUAL'              S21940 25900021
         LA    RD,DXCCW1                PLACE ADDRESS OF SEARCH  S21940 25920021
         ST    RD,DXCCW2                ..CCW INTO TIC CCW       S21940 25940021
         MVC   DXCCW1+K4(K5),ACCW1CD    SET CMD CHAIN, SILI IND, S21940 25960021
*                                       ..AND LENGTH EQUAL 5 IN  S21940 25980021
*                                       ..CCW1, MAKE CCW2 A TIC  S21940 26000021
         LA    RD,DXDSCB                PLACE ADDR FOR DSCB      S21940 26020021
         ST    RD,DXCCW3                ..INTO THE READ DATA CCW S21940 26040021
         MVC   DXCCW2+K4(K5),ACCW2C     SET CMD CHAIN IN CCW2,   S21940 26060021
*                                       ..MAKE CCW3 'READ DATA'  S21940 26080021
         MVC   DXCCW3+K4(K4),ACCW3C     SET LNG EQ 96 IN CCW3    S21940 26100021
         BAL   RC,TCD01500              GO TO PERFORM READ OF DSCB      26200021
*                                                                       26250002
         LA    R1,TABD132               INTERNAL ERROR CODE      S21940 26270021
         BNO   TCD01600                 BR IF I/O ERROR          S21940 26340021
*                                                                Y02132 26350002
TCD00140 EQU   *                        SET DSCB READ INDICATOR  Y02132 26360002
         OI    DXATDACC,DXATRDDB        DSCB READ                Y02144 26390002
*                                                               SA48558 26730021
*****    DETERMINE THE NEXT REQUIRED PROCESSING                 SA48558 26780021
*                                                               SA48558 26830021
TCD00150 EQU   *                                                        27180021
         TM    DCBOFLGS,DCBOWRIT        WAS OUTPUT PERFORMED-    S21940 27250021
         BO    TCD00800                 ..BR IF YES              S21940 27320021
*                                                                       27325002
*****    TEST FOR VALID OPTIONS FOLLOWING INPUT                 SA58019 27330002
*                                                               SA58019 27335002
         LA    R1,TABD142               LOAD INVALID DCB CODE   SA58019 27340002
         NC    DCBDSORG,DCBDSORG        ANY DSORG SPECIFIED?   @ZA02192 27342002
         BZ    TCD00152                 NO, ASSUME 'PS'        @ZA02192 27344002
         TM    DCBDSORG,DCBORGPS        IS DCB DSORG 'PS'       SA58019 27345002
         BZ    TCD01560                 ..BRANCH IF NOT - ERROR SA58019 27350002
TCD00152 EQU   *                                               @ZA02192 27352002
         LA    R1,TABD143               INVALID POSITIONING     SA58019 27355002
*                                       ..OPTION CODE           SA58019 27360002
         TM    JFCBIND1,JFCPDS          IS DCB OPEN TO A MEMBER SA58019 27365002
*                                       ..OF A PO DATA SET      SA58019 27370002
         BO    TCD00170                 ..YES, BR TO CHECK EOF  YA03128 27375002
*                                                               SA58019 27380002
         TM    PLISTOPT(RPARC),PLISTLV  IS DISPOSITION 'LEAVE'-  S21940 27390021
         BM    TCD00200                 ..BRANCH IF NOT         SA58019 27460002
*                                                                       27530021
*****    PROCESS DATA SETS WITH DISPOSITION OF 'LEAVE'-                 27600021
*****    UPDATE THE DCB FULL DIRECT ADDRESS ('DCBFDAD') TO POINT        27670021
*****    TO THE 'FILE MARK' AND UPDATE THE DCB TRACK BALANCE            27740021
*****    ('DCBTRBAL') TO REFLECT THE NUMBER OF BYTES                    27810021
*****    REMAINING ON THE TRACK                                         27880021
*                                                                       27950021
         LA    R1,TABD144               CODE FOR 'LEAVE' OPTION SA48558 28000021
*                                       ..WITH INVALID DSORG    SA48558 28050021
         NC    DSCFILTY,DSCFILTY        ANY DSORG SPECIFIED?   @ZA02192 28060002
         BZ    TCD00155                 NO, ASSUME 'PS'        @ZA02192 28070002
         TM    DSCFILTY,DS1ORGPS+DS1ORGPO IS DSORG VALID-       SA48558 28100021
         BZ    TCD01560                 ..BR IF NOT- ERROR      SA48558 28150021
*                                                               SA48558 28160021
TCD00155 EQU   *                                               @ZA02192 28170002
         MVC   DCBTRBAL,DSCLSTAR+K3     NUMBER OF BYTES                 28200021
*                                       REMAINING ON TRACK              28400021
         MVI   DSCLSTAR+K3,K0           RESET N OF TTRN                 28600021
         MVC   DXCCW5(K4),DSCLSTAR      PLACE THE TTR0 OF LAST TRACK OF 28800021
         L     R0,DXCCW5                DATA SET USED IN PARAMETER REG  29000021
         LR    R1,RDEB                  DEB ADDR INTO PARM REG          29300021
         LA    RDCB,DCBFDAD             ADDRESS FOR MBBCCHHR TO PARAM   29600021
*                                       REGISTER                        29800021
         STM   RTIOT,RDEB,DXCCW5        SAVE REGISTERS           S21940 29850021
         USING CVT,RF                   ESTABLISH CVT BASE       S21940 29900021
         L     RF,CVTPTR                LOAD CVT ADDRESS         S21940 29950021
         L     RF,CVTPCNVT              LOAD CONVERT RTN ADDR    S21940 30000021
         BALR  RET,RF                   CONVERT TTR TO MBBCCHHR  S21940 30050021
         LM    RTIOT,RDEB,DXCCW5        RESTORE REGISTERS        S21940 30100021
         L     RDCB,0(RPARC)            RESTORE ADDRESS OF CURRENT DCB  30200021
         B     TCD00300                 GO SET CURRENT POSITION IN BSAM 30400021
*                                                                       30410002
TCD00170 EQU   *                        TEST IF EOF REACHED     YA03128 30420002
         TM    DCBOFLGS,DCBOEOF         HAS EOF BEEN REACHED    YA03128 30430002
         BO    TCD00600                 ..YES, GO TO FINAL LOAD YA03128 30440002
         B     TCD01560                 ..NO, ISSUE ERROR MSG   YA03128 30450002
         EJECT                                                   S21940 30480021
*                                                                       30560021
*****    PROCESS DATA SETS WITH DISPOSITION OF 'REREAD'-                30640021
*****    INITIALIZE THE DCB FULL DIRECT ADDRESS ('DCBFDAD') TO          30720021
*****    POINT TO THE BEGINNING OF THE FIRST EXTENT OF THE              30800021
*****    DATA SET AND THE DCB TRACK BALANCE ('DCBTRBAL')                30880021
*****    TO REFLECT A FULL TRACK                                        30960021
*                                                                       31040021
TCD00200 EQU   *                                                        31200021
         XC    DCBFDAD(K8),DCBFDAD      ZERO DISK ADDRESS               31400021
         MVC   DCBFDAD+K1(K6),DEBBINUM  SET BBCCHH TO START OF EXTENT   31600021
*                                       M,R = 0                         31800021
         L     RC,DCBDVTBL              PICK UP BASE OF DEVICE TABLE    32000021
         MVC   DCBTRBAL,UNITTRLN-UNITABLE(RC)  SET REMAINING BYTES=MAX  32200021
*                                                                       32400021
*****    UPDATE THE IOB SEEK ADDRESS TO CORRESPOND TO 'DCBFDAD'         32600021
*                                                                       32800021
TCD00300 EQU   *                                                        33000021
         L     RD,DCBIOBA               ADDR OF PREVIOUS IOB            33200021
         LA    RD,0(,RD)                CLEAR HI ORDER BYTE             33400021
         LR    R0,RD                    SAVE ADDR OF 1ST FOR COMPARE    33600021
         SR    RC,RC                    CLEAR REGISTER                  33800021
         LR    R1,RD                    COPY IOB/ICB ADDR               34000021
         TM    DCBCIND2,DCBOEOF         IS PCI USED                     34200021
         BO    TCD00400                 YES, BRANCH                     34400021
         LA    R1,K8(RD)                ADJUST IOB FOR NORMAL SCHED     34600021
         LA    RC,K8                    OFFSET IN IOB FOR NORMAL SCHED  34800021
TCD00400 EQU   *                        UPDATE FIRST ICB/IOB     Y02082 34850002
         MODESET KEYADDR=DXUKEY,WORKREG=14  IOB IN USER KEY      Y02082 34900002
         MVC   K32(K8,R1),DCBFDAD       UPDATE FIRST ICB/IOB     Y02082 35000002
*                                                                       35200021
TCD00500 EQU   *                                                        35400021
         L     RD,0(,RD)                ADDR OF NEXT ICB/IOB IN CHAIN   35600021
         LA    RD,0(,RD)                CLEAR HIGH ORDER BYTE           35800021
         LA    R1,0(RC,RD)              FORM IOB OR ICB ADDR            36000021
         MVC   K32(K8,R1),DCBFDAD       UPDATE ICB/IOB FDAD             36200021
*                                                                       36400021
         CR    RD,R0                    IS THIS LAST IN CHAIN           36600021
         BNE   TCD00500                 ..BR IF NOT- UPDATE      S21940 36800021
*                                       ..NEXT IOB IN CHAIN      S21940 37000021
         MODESET EXTKEY=DATAMGT         TCLOSE KEY               Y02082 37050002
TCD00600 EQU   *                                                 S21940 37200021
         LA    RF,MOD2D2Z               PT TO ID/TTR OF TCLOSE   S21940 37400021
*                                       ..FINAL FUNCTION         S21940 37600021
         LA    RET,K4                   LOAD BR TABLE OFFSET FOR S21940 37800021
*                                       ..TCLOSE FINAL FUNCTION  S21940 38000021
         B     TCD01400                 ..AND BRANCH TO EXIT     S21940 38200021
         EJECT                                                          38400021
*********************************************************************** 38600021
*                                                                     * 38800021
*                          FUNCTION PROLOG                            * 39000021
*                                                                     * 39200021
*********************************************************************** 39400021
*                                                                     * 39600021
* FUNCTION NAME - 'TCLOSE DIRECT ACCESS OUTPUT FUNCTION', PART I      * 39800021
*                                                                     * 40000021
* (STATUS) -                                                          * 40200021
*    NOT APPLICABLE                                                   * 40400021
*                                                                     * 40600021
* FUNCTION -                                                          * 40800021
*    1. THE DSCB IS UPDATED TO REFLECT THE ADDRESS OF THE LAST        * 41000021
*       RECORD WRITTEN AND THE NUMBER OF BYTES REMAINING ON THE       * 41200021
*       TRACK ('DSCLSTAR'), AND IS THEN REWRITTEN TO THE VTOC.        * 41220002
*       TCLOSE FOLLOWING OUTPUT IS RESTRICTED TO THE FOLLOWING        * 41240002
*       CONDITIONS:                                                   * 41260002
*       - PHYSICAL SEQUENTIAL DCBS PROCESSING PHYSICAL SEQUENTIAL     * 41280002
*         DATA SETS.                                                  * 41300002
*       - PHYSICAL SEQUENTIAL DCBS OPENED TO AN ENTIRE PARTITIONED    * 41320002
*         DATA SET, IN WHICH CASE THE 'REREAD' OPTION REPOSITIONS     * 41340002
*         THE USER TO THE DIRECTORY.                                  * 41360002
*       - PHYSICAL SEQUENTIAL DCBS OPENED TO A MEMBER OF A            * 41380002
*         PARTITIONED DATA SET, FOR WHICH 'LEAVE' IS THE ONLY         * 41400002
*         VALID POSITIONING OPTION.                                   * 41420002
*       - PARTITIONED DCBS PROCESSING PARTITIONED DATA SETS, FOR      * 41440002
*         WHICH 'LEAVE' IS THE ONLY VALID POSITIONING OPTION.         * 41460002
*       PROCESSING IS TERMINATED FOR ALL OTHER CONDITIONS.            * 41480002
*                                                                     * 41600021
* ENTRY POINTS -                                                      * 41800021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 42000021
*                                                                     * 42200021
* INPUT -                                                             * 42400021
*    1. REGISTER CONTENTS AT ENTRY ARE AS FOLLOWS-                    * 42600021
*       'RDCB' - ADDRESS OF THE DCB BEING PROCESSED.                  * 42800021
*       'RCORE'- ADDRESS OF THE WORK AREA FOR THAT DCB.               * 43000021
*       'RES'  - ADDRESS OF THE OPEN/CLOSE/EOV RESIDENT ROUTINE.      * 43200021
*       'RWTG' - ADDRESS OF THE WHERE-TO-GO TABLE.                    * 43400021
*       'RPARC'- ADDRESS OF THE CURRENT TCLOSE PARAMETER LIST ENTRY.  * 43600021
*       'RWTGC'- ADDRESS OF THE CURRENT WHERE-TO-GO TABLE ENTRY.      * 43800021
*       'RTIOT'- ADDRESS OF THE CURRENT TIOT ENTRY FOR THE DCB.       * 44000021
*       'RUCB' - ADDRESS OF THE CURRENT UCB FOR THE DCB.              * 44200021
*       'RDEB' - ADDRESS OF THE DCB'S DEB.                            * 44400021
*                                                                     * 44600021
* OUTPUT -                                                            * 44800021
*    1. AT EXIT TO IFG0232J-                                          * 45000021
*       REGISTER CONTENTS ARE THE SAME AS AT ENTRY EXCEPT THAT        * 45200021
*          REGISTER 'RET' CONTAINS A BRANCH TABLE OFFSET OF '0'.      * 45400021
*    1. AT EXIT TO IFG0232Z-                                          * 45600021
*       REGISTER CONTENTS ARE THE SAME AS AT ENTRY EXCEPT THAT        * 45800021
*          REGISTER 'RET' CONTAINS A BRANCH TABLE OFFSET OF '0'.      * 46000021
*    2. AT EXIT TO IFG0230P (PROBLEM DETERMINATION)-                  * 46200021
*       REGISTER CONTENTS ARE THE SAME AS AT ENTRY EXCEPT THAT        * 46400021
*          REGISTER 'R0' CONTAINS ONE OF THE FOLLOWING INTERNAL       * 46600021
*          ERRORS CODES (THE CORRESPONDING ABEND AND RETURN CODES ARE * 46800021
*          INDICATED IN PARENTHESES)-                                 * 47000021
*          133 (417/04)- ERROR WRITING THE DSCB.                      * 47200021
*          145 (---/0C)- MESSAGE ONLY- OUTPUT PROCESSING REQUESTED    * 47250000
*                        FOR AN INVALID DATA SET ORGANIZATION.        * 47300021
*                        PROCESSING COULD NOT BE PERFORMED.           * 47320002
*          151 (---/10)- MESSAGE ONLY- 'REREAD' OPTION SPECIFIED FOR  * 47340002
*                        AN INVALID DATA SET ORGANIZATION.            * 47360002
*                        PROCESSING COULD NOT BE PERFORMED.           * 47380002
*       WORK AREA INDICATORS-                                         * 47400021
*          'DXCCW1'   - CONTAINS A X'FF' WHEN PROCESSING HAS BEEN     * 47450021
*                       TERMINATED ON THE CORRESPONDING DCB.          * 47500021
*          'DXCALLID' - CONTAINS THE 2-BYTE ID OF THIS MODULE.        * 47600021
*          'DXRETMOD' - CONTAINS THE 5-BYTE ID AND TTR OF THE FINAL   * 47650021
*                       LOAD OF TCLOSE WHEN PROCESSING HAS BEEN       * 47700021
*                       TERMINATED ON A DCB.                          * 47750021
*                                                                     * 47800021
* EXTERNAL REFERENCES -                                               * 48000021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 48200021
*                                                                     * 48400021
* EXITS, NORMAL -                                                     * 48600021
*         IFG0232J - TO CREATE OUTPUT USER TRAILER LABELS.            * 48800021
*         IFG0232Z - TO WRITE A FILE MARK AND THEN PERFORM TCLOSE     * 49000021
*                    FINAL PROCESSING.                                * 49200021
*                                                                     * 49400021
* EXITS, ERROR -                                                      * 49600021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 49800021
*                                                                     * 50000021
* TABLES/WORK AREAS -                                                 * 50200021
*    THE TCLOSE WORK AREA AND THE WHERE-TO-GO (WTG)                   * 50400021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 50600021
*                                                                     * 50800021
* ATTRIBUTES -                                                        * 51000021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 51200021
*                                                                     * 51400021
* CHARACTER CODE DEPENDENCY -                                         * 51600021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 51800021
*                                                                     * 52000021
* NOTES -                                                             * 52200021
*                                                                     * 52400021
*********************************************************************** 52600021
         EJECT                                                   S21940 52650021
*                                                                       52800021
*****    TEST FOR VALID POSITIONING OPTIONS FOLLOWING OUTPUT    SA58019 53000002
*                                                                       53200021
TCD00800 EQU   *                                                        53400021
         LA    R1,TABD145               CODE FOR INVALID DSORG  SA48558 53410021
         NC    DSCFILTY,DSCFILTY        ANY DSORG SPECIFIED?   @ZA02192 53420002
         BZ    TCD00840                 NO, ASSUME 'PS'        @ZA02192 53430002
         TM    DSCFILTY,DS1ORGPS        IS DSORG EQ 'PS'-       SA48558 53450021
         BO    TCD00840                 ..BRANCH IF YES         SA58019 53500002
         TM    DSCFILTY,DS1ORGPO        IS DATA SET ORG 'PO'    SA58019 53550002
         BZ    TCD01560                 ..BRANCH IF NOT - ERROR SA58019 53600002
         TM    DCBDSORG,DCBORGPO        IS DCB DSORG 'PO'       SA58019 53650002
         BO    TCD00820                 ..BRANCH IF YES - TEST  SA58019 53700002
*                                       ..FOR 'LEAVE' OPTION    SA58019 53750002
         TM    JFCBIND1,JFCPDS          IS DCB OPEN TO A MEMBER SA58019 53800002
*                                       ..OF A PO DATA SET      SA58019 53850002
         BZ    TCD00840                 ..BRANCH IF NOT - ALL   SA58019 53900002
*                                       ..OPTIONS ALLOWED       SA58019 53950002
TABD151  EQU   151                      TCLOSE INTERNAL CODE    SA58019 53960002
TCD00820 EQU   *                                                SA58019 54000002
         LA    R1,TABD151               LOAD CODE FOR 'REREAD'  SA58019 54050002
*                                       ..OPTION WITH INVALID   SA58019 54100002
*                                       ..DSORG                 SA58019 54150002
         TM    PLISTOPT(RPARC),PLISTLV  IS DISPOSITION 'LEAVE'  SA58019 54200002
         BM    TCD01560                 ..BRANCH IF NOT - ERROR SA58019 54250002
*                                                               SA58019 54300002
*****    CALCULATE THE 'TTR0' OF THE LAST BLOCK WRITTEN         SA58019 54350002
*                                                               SA58019 54400002
TCD00840 EQU   *                                                SA58019 54450002
         L     RUCB,DXUCBADR            LOAD UCB ADDR FROM TIOT  Y02082 54500002
         STM   RTIOT,RC,DXCCW5          SAVE REGISTERS                  58000021
         LR    R1,RDEB                  ADDRESS OF USER'S DEB TO PARAM  58200021
         LA    RDCB,DCBFDAD             ADDRESS OF MBBCCHHR TO PARAM    58400021
         L     RC,CVTPTR                PICK UP ADDRESS OF CONVERT      58600021
*                                       ROUTINE                         58800021
         L     RF,CVTPRLTV-CVT(0,RC)    FROM COMMUNICATION VECTOR TABLE 59000021
         BALR  RET,RF                   CONVERT MBBCCHHR TO TTR0        59200021
         LM    RTIOT,RC,DXCCW5          RESTORE REGISTERS               59400021
         L     RDCB,0(RPARC)            RESTORE ADDRESS OF              59600021
*                                       THE USER'S DCB                  59800021
         ST    R0,DXCCW5                THE TTR OF LAST TRACK USED      60000021
         MODESET EXTKEY=SCHED           ASSUME KEY ZERO          Y02082 60050002
         NI    TIOERLOC+K1,CHARFF-LASTNTRY  ZERO HI ORDER BIT           60200021
         LTR   R0,R0                    NO DATA IF ZERO                 60400021
         BZ    TCD00900                 BR-NO DATA EXISTS               60600021
         OI    TIOERLOC+K1,LASTNTRY     INDICATE DATA EXISTS            60800021
TCD00900 EQU   *                                                        61000021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 61010002
         OI    DSCDSIND,LASTNTRY        SET LAST VOL INDICATOR  SA57255 61050021
         MVC   DSCLSTAR(K3),DXCCW5      SET LAST BLOCK PTR IN   SA57255 61200021
*                                       F1 DSCB                 SA57255 61250021
         MVC   DSCLSTAR+K3(K2),DCBTRBAL SET TRACK BALANCE       SA57255 61400021
*                                       IN F1 DSCB              SA57255 61450021
         OI    DXATDACC,DXATTRAK        LAST TRK USED AND TRK    Y02144 61460002
*                                       BALANCE FIELDS UPDATED   Y02144 61470002
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 61480002
         BNO   TCD00930                 BR IF NOT                Y02132 61490002
*                                                                Y02132 61500002
         MODESET EXTKEY=SCHED           ASSUME SCHEDULER KEY     Y02132 61510002
*                                                                Y02132 61520002
*        WRITE DSCB OUT TO SWA                                   Y02132 61530002
*                                                                Y02132 61540002
         MVC   VDSDSCB-VDSUCB+L'JFCBDSNM(DSCEXT2-DSCFMTID,RUCB),DXDSCB  61550002
*                                                                Y02132 61560002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02132 61570002
*                                                                Y02132 61580002
         B     TCD00960                 RESUME PROCESSING        Y02132 61590002
*                                                                       61600021
*****    WRITE THE UPDATED DSCB TO THE VTOC                             61800021
*                                                                       62000021
TCD00930 EQU   *                        WRITE UPDATED F1 DSCB    Y02132 62100002
         MVC   DXCCW4(K24),DXCCW1       APPEND WRITE CK CCW'S TO CP     62200021
         LA    RF,DXCCW4                                                62400021
         ST    RF,DXCCW5                TIC BACK TO CCW4                62600021
         MVI   DXCCW5,CCWTIC            RESTORE TIC OP                  62800021
         OI    DXCCW3+K4,HEX40          CC FLAG ON IN WRITE CCW         63000021
         OI    DXCCW6+K4,DCBMRKEY       SKIP FLAG ON IN READ CCW        63200021
         MVI   DXCCW3,CCWWRTDA          WRITE DISK OPERATION CODE       63400021
         BAL   RC,TCD01500              GO TO WRITE THE DSCB            63600021
         LA    R1,TABD133               INTERNAL ERROR CODE      S21940 63680021
         BNO   TCD01600                 BR IF I/O ERROR          S21940 63760021
         OI    DXATDACC,DXATUPDB        UPDATED DSCB WRITTEN     Y02144 63810002
*                                                                       63840021
*****    RESTORE USER'S DEB INFORMATION TO WORK DEB                     63920021
*                                                                       64000021
TCD00960 EQU   *                        UPDATE WORK AREA DEB     Y02132 64050002
         MVC   DXDEBUCB(K6),DEBUCBAD    MOVE USER'S UCB ADDR AND S21940 64080021
*                                       ..BIN NO. TO WORK DEB    S21940 64160021
*                                                                       64240021
*****    DETERMINE WHETHER OR NOT USER LABELS ARE TO BE PROCESSED       64320021
*                                                                       64400021
         LA    RF,MOD2D2Z               PT TO ID/TTR OF FILE     S21940 64480021
*                                       ..MARK MODULE            S21940 64560021
         TM    JFCBLTYP,JFCSUL          WAS 'SUL' SPECIFIED-     S21940 64640021
         BNO   TCD01200                 ..BR IF NOT- BYPASS LBLS S21940 64720021
         TM    JFCBTSDM,JFCSDS          IS DATA SET SYSOUT       S21940 64800021
         BO    TCD01200                 ..BY IF YES- BYPASS LBLS S21940 65000021
         L     RC,DCBEXLST              YES,PICK UP EXIT LIST FROM THE  65200021
         LA    RC,0(RC)                 ZERO OUT HI ORDER BYTE OF EXIT  65400021
         LTR   RC,RC                    IS THE EXIT LIST ZERO           65600021
         BZ    TCD01200                 ..BR IF YES- BYPASS LBLS S21940 65700021
         MODESET KEYADDR=DXUKEY,WORKREG=1 EXIT LIST IN USER KEY ZA01505 65750002
TCD01000 EQU   *                                                 S21940 65800021
         CLI   0(RC),XLOUTL             IS THIS THE CORRECT EXIT S21940 65900021
         BE    TCD01100                 ..BR IF YES- CONTINUE    S21940 66000021
         CLI   0(RC),XLOUTL+LASTNTRY    SEE IF LAST INDICATOR ALSO ON   66400021
         BE    TCD01100                 ..BR IF YES- CONTINUE    S21940 66600021
         TM    0(RC),LASTNTRY           NO,IS THIS THE LAST ENTRY IN EX 66800021
         LA    RC,K4(RC)                INCRE BASE REG TO POINT TO NEXT 67000021
         BNO   TCD01000                 ..BR IF NOT- TEST AGAIN  S21940 67300021
         B     TCD01200                 IGNORE USER LABEL EXIT   XM1011 67350002
TCD01100 EQU   *                                                 S21940 67600021
         L     RC,K0(,RC)               LOAD ENTRY ADDRESS AND   S21940 67900021
         LA    RD,K0(,RC)               ..CLEAR HIGH-ORDER BYTE  S21940 68200021
         LTR   RD,RD                    IS THE ENTRY ADDR ZERO-  S21940 68500021
         BZ    TCD01200                 ..BR IF YES- BYPASS LBLS S21940 68800021
         LA    RF,MOD2D2J               PT TO ID/TTR OF USER     S21940 69100021
*                                       ..LABEL MODULE           S21940 69400021
TCD01200 EQU   *                                                 S21940 69700021
         MODESET EXTKEY=DATAMGT         RET DATAMGT KEY          Y02082 69750002
         SR    RET,RET                  ZERO BR TABLE OFFSET     S21940 70000021
         EJECT                                                          70300021
*********************************************************************** 70600021
*              EXIT                                                   * 70900021
*********************************************************************** 71200021
*                                                                       71500021
TCD01400 EQU   *                                                        72400021
         IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED       Y02080 72602002
         SPACE 2                                                        72610021
*********************************************************************** 72620021
*              SUBROUTINES                                            * 72630021
*********************************************************************** 72640021
*                                                                       72650021
*****    CLOSED SUBROUTINE TO PERFORM I/O OPERATIONS                    72660021
*****       ENTRY IS AS FOLLOWS-                                        72670021
*****          BAL   RC,TCD01500                                        72680021
*****       UPON RETURN TO THE CALLER, THE CONDITION CODE IS SET AS     72690021
*****       FOLLOWS-                                                    72700021
*****          '0'- AN I/O ERROR OCCURRED                               72710021
*****          '1'- THE I/O OPERATION COMPLETED WITHOUT ERROR           72720021
*                                                                       72730021
TCD01500 EQU   *                                                        72800021
         EXCP  DXIOB                                                    73000021
         IECRES WAIT                                                    73200021
         TM    DXECB,ECBNOERR           IS THERE AN UNUSUAL I/O COND    73400021
         BCR   15,RC                    RETURN TO CALLER                73600021
         SPACE 2                                                        73660021
*********************************************************************** 73720021
*              ERROR PROCESSING                                       * 73780021
*********************************************************************** 73840021
*                                                                       73900021
TCD01560 EQU   *                                                SA48558 73950021
         MVI   DXCCW1,ALLBITS           IND THAT PROCESSING     SA48558 73960021
*                                       ..HAS BEEN TERMINATED   SA48558 73970021
         MVC   DXRETMOD,MOD2D2Z         PLACE RETURN ID/TTR     SA48558 73980021
*                                       ..INTO SAVE AREA        SA48558 73990021
         LA    RET,K4                   LD BR TABLE OFFSET FOR  SA48558 73992021
*                                       ..TCLOSE FINAL FUNCTION SA48558 73994021
TCD01600 EQU   *                                                        74000021
         DMABCOND (R1),ABEND2D          PROCESS THE ERROR        S21940 74200021
         EJECT                                                          74260021
*********************************************************************** 74320021
*              CONSTANTS                                              * 74380021
*********************************************************************** 74440021
*                                                                       74500021
ACCW1CD  DC    X'6000000508'            COMM CHAIN,SILI,5 CHAR,TIC OPCD 74600021
ACCW2C   DC    X'4000000086'            COMMAND CHAIN,READ DATA OPCD    74800021
ACCW3C   DC    X'00000060'              96 CHARACTERS                   75000021
MAXEXTNT DC    X'FFFFFFFF7FFF'          HIGHEST POSSIBLE CCHH    S21940 75070021
*                                       ..AND NO. OF TRKS ON A   S21940 75140021
*                                       ..DEVICE                        75210021
         SPACE 2                                                        75280021
*********************************************************************** 75350021
*              XCTL TABLE                                             * 75420021
*********************************************************************** 75490021
*                                                                       75560021
XCTLTB2D XCTLTABL ID=(ABEND2D,0P,MOD2D2J,2J,MOD2D2Z,2Z),SVC=023, Y02080X75630002
               BRT=YES,LENGTH=                                   Y02080 75680002
         SPACE 2                                                        75700021
         IECDSECS CVT,TCB,TIOT,DCB,DEB,MAIN,ICB,UNITTAB,WTG,     Y02080*75800002
               PREFX,UCB,EXPAND=YES                              Y02132 75850002
         IDDVDSCB                                                Y02132 75852502
         IECEQU                                                         76000021
         END                                                            76200021
