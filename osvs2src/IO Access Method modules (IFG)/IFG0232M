         TITLE 'IFG0232M - TCLOSE TAPE STANDARD TRAILER LABEL FUNCTION' 00100021
IFG0232M CSECT                                                          00400021
*                                                                       00500021
*********************************************************************** 00600021
*                                                                     * 00700021
*                                                                     * 00800021
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00900002
*0000295500                                                      YM1456 00901002
*0000247000-252000,296000,297000,351500-357000,562000-564000     YM3000 00902002
*0000279500                                                      YM5314 00903002
*0000                                                            YM5389 00904002
*0000                                                            YM7548 00909002
*          RELEASE 21.7 DELETIONS/CHANGES                             * 01200002
*0000387000-388000,390000                                       SA53865 01220002
*          RELEASE 21 DELETIONS/CHANGES                               * 01300021
*0000160000-162000                                               M0011  01350021
*0000382000-384000,426000-427000                                 M0112  01370021
*                                                                     * 01400021
* MODULE NAME - IFG0232M                                              * 01410002
*                                                                     * 01420002
* DESCRIPTIVE NAME - TCLOSE TAPE STANDARD TRAILER LABEL PROCESSING    * 01430002
*                                                                     * 01440002
* COPYRIGHT - NONE                                                    * 01450002
*                                                                     * 01460002
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING THE CSECT CARD.   * 01470002
*                                                                     * 01480002
* STATUS CHANGE LEVEL 000                                             * 01500021
*                                                                     * 01600021
* FUNCTION -                                                          * 01700021
*    THIS MODULE CONTAINS PART II OF THE 'TCLOSE TAPE STANDARD        * 01800021
*    TRAILER LABEL FUNCTION'. REFER TO THE FOLLOWING 'FUNCTION        * 01900021
*    PROLOG' FOR DETAILS.                                             * 02000021
*                                                                     * 02100021
* ENTRY POINTS -                                                      * 02200021
*         IFG0232M                                                    * 02300021
*                                                                     * 02400021
* INPUT -                                                             * 02500021
*    ENTERED IN DATA MANAGEMENT KEY                              Y02082 02550002
*    REGISTER 14 ('RET') WILL CONTAIN ONE OF THE BRANCH TABLE OFFSETS * 02600021
*    LISTED BELOW, THE BRANCH TABLE BEING USED TO DETERMINE AT WHICH  * 02700021
*    POINT PROCESSING IS TO BEGIN:                                    * 02800021
*       0 - ENTRY FROM MODULE IFG0232G TO FINISH FORMATTING AND       * 02900021
*           WRITE TRAILER LABEL 'EOF2' AND TO PROCESS OUTPUT USER     * 03000021
*           LABELS, AS REQUIRED;                                      * 03100021
*       4 - ENTRY FROM MODULE IGC0002C TO PROCESS DEFERRED            * 03200021
*           INPUT USER LABELS, AS REQUIRED.                           * 03300021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG' FOR ADDITIONAL DETAILS. * 03400021
*                                                                     * 03500021
* OUTPUT -                                                            * 03600021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 03650002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 03700021
*                                                                     * 03800021
* EXTERNAL REFERENCES -                                               * 03900021
*         IFG019RA - OPEN/CLOSE/EOV/DADSM COMMON ROUTINE TO OBTAIN    * 04000002
*                    AND FREE CORE, TO REFRESH THE CALLER'S DCB,      * 04050002
*                    TO XCTL, AND TO WAIT.                            * 04100002
*                                                                     * 04200021
* EXITS, NORMAL -                                                     * 04300021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 04400021
*                                                                     * 04500021
* EXITS, ERROR -                                                      * 04600021
*         IFG0230P - WHEN AN ERROR CONDITION OCCURS IN THIS MODULE.   * 04700021
*                    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.        * 04800021
*                                                                     * 04900021
* TABLES/WORK AREAS -                                                 * 05000021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 05100021
*                                                                     * 05200021
* ATTRIBUTES -                                                        * 05300021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 05400021
*                                                                     * 05500021
* CHARACTER CODE DEPENDENCY -                                         * 05600021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 05700021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 05800021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 05900021
*                                                                     * 06000021
* NOTES -                                                             * 06100021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 06200021
*                                                                     * 06300021
*********************************************************************** 06400021
*                                                                       06500021
*****    TCLOSE INTERNAL ERROR CODES                                    06600021
*                                                                       06700021
TABD141  EQU   141                      ERROR POSITIONING FOLLOWING     06800021
*                                       ..USER LABEL PROCESSING         06900021
*                                                                       07000021
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        07100021
         USING *,RBASE                                                  07200021
         USING FORCORE,RCORE                                            07300021
         USING IHADCB,RDCB                                              07400021
         USING UCB,RUCB                                                 07500021
         USING IHADEB,RDEB                                              07600021
         USING TIOT,RTIOT                                               07700021
         USING WTG,RWTG                                                 07800021
*                                                                       07900021
         B     TCT06000(RET)            DETERMINE TYPE OF ENTRY TO MOD  08000021
TCT06000 EQU   *                                                        08100021
         B     TCT06200                 BR TO FINISH TRLR LABEL 2       08200021
         B     TCT07400                 BR TO PROCESS INPUT LABELS      08300021
         EJECT                                                          08400021
*********************************************************************** 08500021
*                                                                     * 08600021
*                          FUNCTION PROLOG                            * 08700021
*                                                                     * 08800021
*********************************************************************** 08900021
*                                                                     * 09000021
* FUNCTION NAME -                                                     * 09100021
*    'TCLOSE TAPE STANDARD TRAILER LABEL FUNCTION', PART II           * 09200021
*                                                                     * 09300021
* (STATUS) -                                                          * 09400021
*    NOT APPLICABLE                                                   * 09500021
*                                                                     * 09600021
* FUNCTION -                                                          * 09650002
*    1. FINISH FORMATTING AND WRITE END-OF-FILE LABEL 2 (EOF2);       * 09700002
*    2. PROCESS OUTPUT OR DEFERRED INPUT USER LABELS AS REQUIRED;     * 09750002
*       A. A 152 BYTE USER LABEL WORK AREA IS OBTAINED FOR       Y02082 09800002
*          TCLOSE FROM FETCH PROTECTED SUBPOOL 229 IN DATA       Y02082 09850002
*          MANAGEMENT KEY. A 96 BYTE USER LABEL WORK AREA IS     Y02082 09900002
*          OBTAINED FOR THE USER FROM FETCH PROTECTED SUBPOOL    Y02082 09950002
*          229 IN USER KEY.                                      Y02082 10000002
*       B. IF OUTPUT USER LABELS ARE TO BE PROCESSED, THE LABEL       * 10050002
*          IDENTIFIER IS FORMATTED IN A BUFFER AND CONTROL IS PASSED  * 10100002
*          TO THE EXIT FROM IFG019RA THROUGH THE IECRES-UEXIT    Y02082 10150002
*          MACRO. A LABEL IS THEN WRITTEN IF THE USER PASSES     Y02082 10200002
*          A RETURN CODE OF '8'; THIS CONTINUES UNTIL EITHER THE      * 10250002
*          MAXIMUM NUNBER OF LABELS (CURRENTLY 8) HAS BEEN WRITTEN    * 10300002
*          OR UNTIL THE USER INDICATES THAT PROCESSING IS TO          * 10350002
*          TERMINATE.                                                 * 10400002
*       C. IF DEFERRED INPUT USER LABELS ARE TO BE PROCESSED, A       * 10450002
*          LABEL IS READ AND CONTROL IS PASSED TO THE USER FROM  Y02082 10500002
*          IFG019RA THROUGH THE IECRES-UEXIT MACRO.  ADDITIONAL  Y02082 10550002
*          LABELS ARE READ IF THE USER PASSES A RETURN CODE OF '4';   * 10600002
*          THIS CONTINUES UNTIL EITHER THE MAXIMUM NUMBER OF LABELS   * 10650002
*          HAS BEEN READ OR UNTIL THE USER INDICATES THAT PROCESSING  * 10700002
*          IS TO TERMINATE.                                           * 10750002
*       D. THE USER LABEL INTERFACE IS AS FOLLOWS-                    * 10800002
*          REGISTERS ARE INITIALIZED FOR THE USER BY IFG019RA    Y02082 10850002
*          IN THE FOLLOWING MANNER:                              Y02082 10900002
*             1    - ADDRESS OF A 4-WORD USER LABEL PARAMETER LIST;   * 10950002
*             2-13 - USER'S REGISTERS AT ENTRY TO TCLOSE;             * 11000002
*             14   - RETURN ADDRESS                              Y02082 11050002
*             15   - USER'S LABEL EXIT ROUTINE ADDRESS.               * 11100002
*          PARAMETER LIST CONTENTS-                                   * 11150002
*             WORD 1- ADDRESS OF THE USER LABEL BUFFER, OR '0' IF     * 11200002
*                     NO LABELS WERE READ (I.E., TAPE MARK WAS READ); * 11250002
*             WORD 2- ADDRESS OF THE DCB BEING PROCESSED; THE HIGH    * 11300002
*                     ORDER BIT OF THE FIRST BYTE IS ON IF THIS IS    * 11350002
*                     EOF AND IT IS OFF IF THIS IS EOV;               * 11400002
*             WORD 3- '0' IF NO ERRORS WERE ENCOUNTERED; OTHERWISE,   * 11450002
*                     THE ADDRESS OF THE IOB WHICH INCURRED THE ERROR,* 11500002
*                     WITH THE HIGH ORDER BIT OF THE FIRST BYTE ON;   * 11550002
*             WORD 4- '0';                                            * 11600002
*          CONTROL BLOCK INDICATORS-                                  * 11650002
*             'DCBOFLGS' - X'02', OFF - THE 'LOCK' BIT IS TURNED OFF  * 11700002
*                          WHEN CONTROL IS PASSED TO THE USER AND IS  * 11750002
*                          TURNED BACK ON UPON RETURN.                * 11800002
*          USER RETURN CODES (PASSED IN REGISTER 15)-                 * 11850002
*             0 - INPUT - CONTINUE PROCESSING INPUT USER LABELS;      * 11900002
*                 OUTPUT- DISCONTINUE PROCESSING OUTPUT USER LABELS;  * 11950002
*             4 - DISCONTINUE PROCESSING INPUT USER LABELS;           * 12000002
*             8 - CONTINUE PROCESSING OUTPUT USER LABELS.             * 12050002
*                                                                     * 12100002
* ENTRY POINTS -                                                      * 12200002
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 12300002
*                                                                     * 14100021
* INPUT -                                                             * 14200021
*    1. REGISTER CONTENTS AT ENTRY ARE AS FOLLOWS-                    * 14300021
*       'RDCB' - ADDRESS OF THE DCB BEING PROCESSED;                  * 14400021
*       'RCORE'- ADDRESS OF THE WORK AREA FOR THAT DCB;               * 14500021
*       'RES'  - ADDRESS OF THE OPEN/CLOSE/EOV RESIDENT ROUTINE;      * 14600021
*       'RWTG' - ADDRESS OF THE WHERE-TO-GO TABLE;                    * 14700021
*       'RPARC'- ADDRESS OF THE CURRENT TCLOSE PARAMETER LIST ENTRY;  * 14800021
*       'RWTGC'- ADDRESS OF THE CURRENT WHERE-TO-GO TABLE ENTRY;      * 14900021
*       'RTIOT'- ADDRESS OF THE CURRENT TIOT ENTRY FOR THE DCB;       * 15000021
*       'RUCB' - ADDRESS OF THE CURRENT UCB FOR THE DCB;              * 15100021
*       'RDEB' - ADDRESS OF THE DCB'S DEB;                            * 15200021
*                                                                     * 15300021
* OUTPUT -                                                            * 15400021
*    1. AT EXIT TO MODULE IFG0232S-                                   * 15500021
*       REGISTER CONTENTS ARE THE SAME AS AT ENTRY EXCEPT THAT        * 15600021
*          REGISTER 'RET' CONTAINS A BRANCH TABLE OFFSET OF '4';      * 15700021
*       WORK AREA INDICATORS-                                    M0011* 15720021
*          'DXCCW7' - X'FF' - INDICATES THAT DEFERRED USER LABEL M0011* 15740021
*                             PROCESSING OCCURRED (REQUIRED BY   M0011* 15760021
*                             THE TAPE POSITIONING FUNCTION).    M0011* 15780021
*       TAPE POSITION-                                                * 15800021
*          OUTPUT- AT THE INTERBLOCK GAP FOLLOWING THE TRAILER LABELS;* 15900021
*          INPUT - IF DEFERRED USER LABEL PROCESSING HAS BEEN    M0011* 15950021
*                  PERFORMED, AT THE INTERBLOCK GAP FOLLOWING    M0011* 16000021
*                  THE LAST LABEL PROCESSED.                     M0011* 16050021
*                  IF EOF OCCURRED AND USER LABELS WERE NOT      M0011* 16100021
*                  PROCESSED, AT THE INTERBLOCK GAP FOLLOWING    M0011* 16150021
*                  THE TAPE MARK FOLLOWING THE TRAILER LABELS.   M0011* 16200021
*                  IF EOF DID NOT OCCUR, ANYWHERE IN DATA AREA.  M0011* 16250021
*    2. AT EXIT TO PROBLEM DETERMINATION MODULE IFG0230P-             * 16300021
*       REGISTER CONTENTS ARE THE SAME AS AT ENTRY EXCEPT THAT        * 16400021
*          REGISTER 'R0' CONTAINS ONE OF THE FOLLOWING INTERNAL       * 16500021
*          ERROR CODES-                                               * 16600021
*          124- ERROR WRITING END-OF-FILE LABEL 2;                    * 16700021
*          141- ERROR BACKSPACING FOLLOWING USER TRAILER LABEL        * 16800021
*               PROCESSING.                                           * 16900021
*       WORK AREA INDICATORS-                                         * 17000021
*          'DXCALLID' - CONTAINS THE ID OF THIS MODULE.               * 17100021
*                                                                     * 17200021
* EXTERNAL REFERENCES -                                               * 17300021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 17400002
*                                                                     * 17500021
* EXITS, NORMAL -                                                     * 17600021
*         IFG0232S - TO DELIMIT AN OUTPUT DATA SET AND TO POSITION    * 17700021
*                    ACCORDING TO THE TCLOSE POSITIONING OPTION.      * 17800021
*                                                                     * 17900021
* EXITS, ERROR -                                                      * 18000021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 18100002
*                                                                     * 18200021
* TABLES/WORK AREAS -                                                 * 18300021
*    THE TCLOSE WORK AREA AND THE WHERE-TO-GO (WTG)                   * 18400021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 18500021
*                                                                     * 18600021
* ATTRIBUTES -                                                        * 18700021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 18800002
*                                                                     * 18900021
* CHARACTER CODE DEPENDENCY -                                         * 19000021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 19100002
*                                                                     * 19200021
* NOTES -                                                             * 19300021
*                                                                     * 19400021
*********************************************************************** 19500021
*                                                                       19600021
*********************************************************************** 19700021
*              FINISH TRAILER LABEL 2                                 * 19800021
*********************************************************************** 19900021
*                                                                       20000021
TCT06200 EQU   *                                                        20100021
         SH    RTIOT,DCBTIOT            POINT TO BEGINNING OF TIOT      20200021
         MVC   FL2JOBD,TIOCNJOB         PLACE JOB/STEP IDENTIFICATION   20300021
         MVC   FL2STEPD,TIOCSTEP        ..FROM THE TIOT INTO THE LABEL  20400021
         MVI   FL2JSSP,SLASH            INSERT SLASH BETWEEN JOB AND    20500021
*                                       ..STEP NAMES                    20600021
*                                                                       20700021
*****          TAPE RECORDING TECHNIQUE                                 20800021
*                                                                       20900021
         SR    RC,RC                    CLEAR WORK REGISTER AND INSERT  21000021
         IC    RC,JFCTRTCH              ..JFCB TAPE RECORDING TECHNIQUE 21100021
         SRL   RC,K4                    SHIFT OUT HIGH ORDER CHAR OF    21200021
         STC   RC,FL2TRTCH              ..JFCTRTCH AND STORE IN LABEL   21300021
         TR    FL2TRTCH(K1),ATRTCH      TRANSLATE RECORDING TECHNIQUE   21400021
         CLI   JFCTRTCH,JFCTREV         IS THE RECORDING TECHNIQUE BOTH 21500021
*                                       ..TRANSLATION AND EVEN PARITY   21600021
         BNE   TCT06400                 ..BR IF NOT- 2ND CHAR IS BLANK  21700021
         MVI   FL2TRTCH+K1,CHART        ..ELSE SET 2ND CHAR TO 'T'      21800021
*                                                                       21900021
*****          CARRIAGE CONTROL CHARACTER SET                           22000021
*                                                                       22100021
TCT06400 EQU   *                                                        22200021
         TM    JFCRECFM,JFCMAC          DOES JFCB SPECIFY MACHINE CTRL- 22300021
         BNO   TCT06600                 ..BR IF NOT- CHK FOR 'ASA'      22400021
         MVI   FL2CNTRL,CHARM           ..ELSE SET MACHINE CTRL IN LBL  22500021
TCT06600 EQU   *                                                        22600021
         TM    JFCRECFM,JFCASA          DOES JFCB SPECIFY ASA CONTROL-  22700021
         BNO   TCT06800                 ..BR IF NOT- DO NOT SET CONTROL 22800021
         MVI   FL2CNTRL,CHARA           ..ELSE SET ASA CONTROL IN LABEL 22900021
TCT06800 EQU   *                                                        23000021
         TM    SRTESTAB,UCBBSTR         WERE ANSI LABELS SPECIFIED-     23100021
         BNO   TCT06900                 ..BR IF NOT TO CHKPT FLG Y02083 23200002
*                                                                       23300021
*****          BUFFER ALIGNMENT                                         23400021
*                                                                       23500021
         MVC   DXCCW5(K1),JFCBUFOF      GET BUFFER OFFSET LENGTH        23600021
         NI    DXCCW5,X'FF'-LASTNTRY    TURN OFF BIT 0                  23700021
         SR    RC,RC                    CLEAR WORK REGISTER             23800021
         IC    RC,DXCCW5                PLACE BUFFER LENGTH INTO REG    23900021
         CVD   RC,DXCCW5                ..AND CONVERT IT TO DECIMAL,    24000021
         UNPK  FL2BUFOF,DXCCW5          ..THEN UNPACK AND STORE IN LBL  24100021
         OI    FL2BUFOF+K1,ZONEOF       RESET SIGN BITS                 24200021
         MVC   FL1LABI,AEOF1            MOVE IN E-O-F CONSTANT          24300021
*                                                                       24400021
*****          TRANSLATE ANSI DATA BEFORE WRITING LABEL                 24500021
*                                                                       24600021
         XLATE DXLBL,K80,TO=A           TRANSLATE LABEL DATA     YM3000 24700002
*                                                                Y02083 25200002
*****          SET CHECKPOINT D/S INDICATOR IF APPROPRIATE       Y02083 25220002
*                                                                Y02083 25230002
TCT06900 L     RC,DXDSAB                FETCH DSAB ADDRESS       Y02083 25240002
         USING DSAB,RC                  ADDRESS DSAB             Y02083 25250002
         TM    DSABFLG4,DSABCKDS        Q - CHECKPOINT D/S       Y02083 25260002
         BZ    TCT07000                 IF NOT, BRANCH           Y02083 25270002
         DROP  RC                       DSAB ADDRESSABILITY      Y02083 25280002
         MVI   FL2DSIND,FL2CKDS         SET CHKPT LABEL FLAG     Y02083 25290002
*                                                                       25300021
*****          WRITE END OF FILE LABEL 2                                25400021
*                                                                       25500021
TCT07000 EQU   *                                                        25600021
         LA    RD,TABD124               LOAD INTERNAL ERROR CODE        25700021
         BAL   RC,TCT12600              WRITE FILE LABEL 2              25800021
         BNO   TCT12800                 BR IF I/O ERROR                 25900021
         OI    DXATOUTA,DXATTRL2        TRL2 LABEL WRITTEN       Y02144 25950002
         EJECT                                                          26000021
*********************************************************************** 26100021
*              DETERMINE IF USER LABELS ARE TO BE PROCESSED           * 26200021
*********************************************************************** 26300021
*                                                                       26400021
TCT07200 EQU   *                                                        26500021
         TM    JFCBTSDM,JFCSDS          IS DATA SET SYSOUT OR SYSIN-    26600021
         BO    TCT12400                 ..BR IF YES- BYPASS USER LABELS 26700021
         TM    JFCBLTYP,JFCBUL          WERE USER LABELS SPECIFIED-     26800021
         BNO   TCT12400                 ..BR IF NOT- BYPASS USER LABELS 26900021
         LA    RD,EXIT4                 PT TO OUTPUT USER TRLR LBL CODE 27000021
         B     TCT07600                 BR TO TEST FOR USER LABELS      27100021
TCT07400 EQU   *                                                        27200021
         LA    RD,SLPSUP                PT TO DEFERRED USER LABEL       27300021
*                                       ..PROCESSING CODE               27400021
TCT07600 EQU   *                                                        27500021
         L     RC,DCBEXLST              LOAD EXIT LIST ADDR FROM DCB    27600021
         LA    RC,K0(,RC)               ZERO EXIT LIST HIGH-ORDER BYTE  27700021
         LTR   RC,RC                    IS THERE A DCB EXIT LIST-       27800021
         BZ    TCT12400                 ..BR IF NOT                     27900021
         MODESET KEYADDR=DXUKEY,WORKREG=15  ASSUME USER KEY      YM5314 27950002
TCT07800 EQU   *                                                        28000021
         CLC   K0(K1,RC),K0(RD)         DO CODE BYTES MATCH-            28100021
         BE    TCT08000                 ..BR IF YES- PROCESS USER LBLS  28200021
         CLC   K0(K1,RC),K1(RD)         IS 'LAST ENTRY' IND ALSO ON-    28300021
         BE    TCT08000                 ..BR IF YES- PROCESS USER LABEL 28400021
         TM    K0(RC),LASTNTRY          IS THIS LAST EXIT LIST ENTRY-   28500021
         LA    RC,K4(,RC)               POINT TO NEXT ENTRY             28600021
         BNO   TCT07800                 ..BR IF NOT- CHK NEXT ENTRY     28700021
         B     TCT12400                 ..ELSE BR TO POSITION TAPE      28800021
TCT08000 EQU   *                                                        28900021
         LR    RD,RDEB                  SAVE THE DEB ADDRESS            29000021
*                                                                       29100021
*****          RDEB WILL NOW BE USED AS A WORK REGISTER                 29200021
*****          RD WILL NOW BE USED AS THE DEB BASE REGISTER             29300021
*                                                                       29400021
         L     RDEB,K0(,RC)             LOAD EXIT LIST ENTRY            29500021
         NC    K1(K3,RC),K1(RC)         TEST FOR A VALID EXIT    YM3000X29600002
                                        LIST ENTRY ADDRESS       YM3000 29620002
         MODESET EXTKEY=DATAMGT         RETURN TO DATAMGT KEY    YM1456 29650002
         BZ    TCT12400                 BRANCH IF NOT - BYPASS   YM3000X29700002
                                        USER LABEL PROCESSING    YM3000 29750002
*                                                                       29800021
*********************************************************************** 29900021
*              USER TRAILER LABEL PROCESSING                          * 30000021
*********************************************************************** 30100021
*                                                                       30200021
*                                                                Y02082 30250002
*    OBTAIN USER LABEL WORK AREA FOR TCLOSE                      Y02082 30300002
*                                                                Y02082 30350002
         IECRES GET,LV=USERLDM,PREFIX=YES,SP=K229,               Y02082*30400002
               STM=(2,14,WTGPREFX),ID=ULWA                       Y02144 30450002
         USING ULDMWK,R1                                         Y02082 30500002
         STM   RPAR,RC,ULREGSAV         SAVE REGS (INCLUDES DCB EXIT    30600002
*                                       ..LIST ENTRY)                   30700021
         DROP  R1                                                       30800021
         LR    RUCB,R1                  POINT TO USER LABEL WORK AREA   30900021
         USING ULDMWK,RUCB              BASE FOR TCLOSE UL W.A.  Y02082 30910002
*                                                                Y02082 30920002
*    OBTAIN USER LABEL WORK AREA FOR USER                        Y02082 30930002
*                                                                Y02082 30940002
         IECRES GET,LV=USERLU,PREFIX=NO,KEY=USER,SP=K229,        Y02082*30950002
               STM=(2,14,WTGPREFX)                               Y02082 30960002
         USING ULUWK,R9                 BASE FOR USER'S UL W.A.  Y02082 30970002
         LR    R9,R1                    ADDR OF GOTTEN CORE      Y02082 30980002
         MODESET EXTKEY=DATAMGT         RET TO TCLOSE KEY        Y02082 30990002
         LA    R1,CHAR0                 INITIALIZE USER LABEL COUNT     31100021
         STH   R1,ULCNT                 ..AND SAVE FOR LATER USE        31200021
         MVI   ULDMBUFR,BLANK           INIT LABEL BUFFER AREA   Y02082 31250002
         MVC   ULDMBUFR+K1(L'ULDMBUFR-K1),ULDMBUFR TO BLANDS     Y02082 31300002
*                                                                       31420021
*****    INITIALIZE CHANNEL PROGRAM FOR USER LABEL PROCESSING           31440021
*                                                                       31460021
         LA    R1,ULDMBUFR              ADDR OF USER LABEL BUFFERY02082 31510002
         ST    R1,DXCCW1                ..AND STORE IN CHANNEL PROGRAM  31600021
         MVI   DXCCW1,CCWRDTAP          PLACE READ CMD INTO CCW  M0112  31620021
         MVI   DXCCW1+K4,K0             TURN OFF ALL CCW FLAGS   M0112  31640021
         MVI   DXCCW1+K7,ULPARM-ULBUFR  SET LENGTH TO BFR SIZE   M0112  31660021
         TM    ULREG11,XLDEFSL          WAS DEFERRED INPUT LBL PROCESS- 31700021
*                                       ..ING SPECIFIED (TEST REG 11)-  31800021
         BO    TCT09200                 ..BR IF YES                     31900021
*                                                                       32000021
*********************************************************************** 32100021
*              OUTPUT USER LABEL PROCESSING                           * 32200021
*********************************************************************** 32300021
*                                                                       32400021
TCT08200 EQU   *                                                        32500021
         TM    JFCBLTYP,JFCBAL+JFCBUL   WERE ANSI USER LBLS SPECIFIED-  32600021
         BO    TCT08400                 ..BR IF YES- DO NOT COUNT       32700021
         LH    R1,ULCNT                 LOAD PREVIOUS COUNT AND         32800021
         LA    R1,K1(,R1)               ..INCREMENT BY 1                32900021
         STH   R1,ULCNT                 SAVE UPDATED COUNT              33000021
         CLI   ULCNT+K1,MAXNOLAB        HAS THE MAXIMUM NUMBER OF       33100021
*                                       ..USER LABELS BEEN PROCESSED-   33200021
         BH    TCT12200                 ..BR IF YES                     33300021
TCT08400 EQU   *                                                        33400021
         MVC   ULDMBUFR(K3),AUTL        PLACE 'UTL' IN BUFFER    Y02082 33450002
         MVC   ULDMBUFR+K3(K1),ULCNT+K1 ESTAB LABEL NO. IN BUFFERY02082 33500002
         L     R7,ULDMBUFR              SAVE UTLN IN REG         Y02082 33550002
         MODESET KEYADDR=DXUKEY,WORKREG=15 ASSUME USER KEY       Y02082 33600002
         ST    R7,ULBUFR                PUT 'UTLN' IN USER BUFFERY02082 33650002
*    RETURN FROM SYNCH RTN WILL BE IN DATA MANAGEMENT KEY        Y02082 33660002
         BAL   R7,TCT10200              BR TO SYNCH TO USER             33700021
         LTR   RF,RF                    SHOULD THE LABEL BE WRITTEN-    33800021
         BZ    TCT12200                 ..BRANCH IF NOT                 33900021
*                                                                Y02082 33910002
*    COPY LABEL FROM USER'S BUFFER TO TCLOSE'S BUFFER            Y02082 33920002
*                                                                Y02082 33930002
         MODESET EXTKEY=ZERO            ASSUME KEY ZERO          Y02082 33940002
         L     RF,WTGPREFX              POINT TO PREFIX          Y02082 33950002
         STM   R0,RET,IECREGSV-IECPREFX(RF) SAVE REGS THRU LOCK  Y02082 33960002
*    GET LOCAL LOCK                                              Y02082 33970002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02082*33980002
               RELATED=('PREVENT FREE USER CORE-RELEASE BELOW')  Y02082 33990002
         L     RF,WTGPREFX              POINT TO PREFIX          Y02082 34000002
         LM    R0,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         Y02082 34010002
         MODESET KEYADDR=DXUKEY,WORKREG=15 ASSUME USER KEY       Y02082 34020002
*                                                                       34030002
*    VERIFY USER'S USER LABEL WORK AREA STILL HELD BY USER       Y02082 34040002
*                                                                       34050002
         OC    ULUWK(USERLU),ULUWK      PGM CHK IF NOT           Y02082 34060002
*                                                                Y02082 34070002
         MODESET EXTKEY=ZERO            ASSUME KEY ZERO          Y02082 34080002
         MVC   ULDMBUFR,ULBUFR          COPY LABEL FROM USER     Y02082 34090002
         L     RF,WTGPREFX              POINT TO PREFIX          Y02082 34100002
         STM   R0,RET,IECREGSV-IECPREFX(RF) SAVE REGS THRU LOCK  Y02082 34110002
*    RELEASE LOCAL LOCK                                          Y02082 34120002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=('SEE ABOVE')        Y02082 34130002
         L     RF,WTGPREFX              POINT TO PREFIX          Y02082 34140002
         LM    R0,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         Y02082 34150002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 34160002
*                                                                       34170002
*****          INITIALIZE CHANNEL PROGRAM TO WRITE USER LABEL           34180002
*                                                                       34200021
         MVC   ULDMBUFR(K3),AUTL        PUT 'UTL' IN LABEL       Y02082 34250002
         TM    JFCBLTYP,JFCBAL+JFCBUL   WERE ANSI USER LBLS SPECIFIED-  34400021
         BO    TCT08600                 ..BRANCH IF YES                 34500021
         MVC   ULDMBUFR+K3(K1),ULCNT+K1 RESTORE LABEL NO.        Y02082 34550002
TCT08600 EQU   *                                                        34700021
         MVI   DXCCW1,CCWWRTAP          INITLZ CCW FOR WRITE COMMAND    34800021
         MVI   DXCCW1+K4,CCWSILI        SET 'SUPPRESS INCORRECT  M0112  34830021
*                                       ..LENGTH' INDICATOR             34860021
         TM    JFCBLTYP,JFCBAL+JFCBUL   WERE ANSI USER LBLS SPECIFIED-  34900021
         BNO   TCT08800                 ..BR IF NOT- BYPASS TRANSLATE   35000021
*                                                                       35100021
         XLATE ULDMBUFR,K80,TO=A        TRANSLATE LABEL DATA     YM3000 35200002
*                                                                YM3000 35700002
TCT08800 EQU   *                                                        35800021
         BAL   RC,TCT12600              BRANCH TO WRITE LABEL           35900021
         BNO   TCT09000                 BR IF I/O ERROR                 36000021
         CLI   ULRETCOD,WRITNEXT        SHOULD ADD'L LBLS BE PROCESSED- 36100021
         BE    TCT08200                 ..BR IF YES TO CONTINUE         36200021
         B     TCT12200                 ..ELSE PROCESSING IS COMPLETE   36300021
*                                                                       36400021
*****          ERROR WHEN ATTEMPTING TO WRITE LABEL.  SYNCH             36500021
*****          TO USER WITH ERROR INDICATIONS, THEN TERMINATE           36600021
*****          UL PROCESSING ( THE RETURN CODE IS NOT EXAMINED )        36700021
*                                                                       36800021
TCT09000 EQU   *                                                        36900021
         LA    R1,DXIOB                 INSERT POINTER TO STATUS INFO   37000021
         MODESET KEYADDR=DXUKEY,WORKREG=15 ASSUME USER KEY       Y02082 37050002
         ST    R1,ULPARM+K8             ..IN PARAMETER LIST             37100021
         OI    ULPARM+K8,ERROR          FLAG THE ERROR                  37200021
         BAL   R7,TCT10400              BR TO SYNCH TO USER (BUFFER     37300021
*                                       CONTAINS LABEL UNABLE TO WRITE) 37400021
* RETURNS IN DATAMGT KEY                                         Y02082 37450002
         B     TCT12200                 UL PROCESSING COMPLETED         37500021
*                                                                       37600021
*********************************************************************** 37700021
*              INPUT USER LABEL PROCESSING                            * 37800021
*********************************************************************** 37900021
*                                                                       38000021
TCT09200 EQU   *                                                        38100021
         MVI   DXCCW7,ALLBITS           IND DEFERRED USER LABEL  M0011  38130021
*                                       ..PROCESSING TOOK PLACE  M0011  38160021
         OI    DXATALL,DXATFC           FORCE CLOSE ON ERROR     YM7099 38200002
TCT09400 EQU   *                                                        38500021
         BAL   RC,TCT12600              BR AND LINK TO READ A LABEL     38600021
         BNO   TCT11400                 BRANCH IF ERROR         SA53865 38700002
         TM    IOBSTAT0,CSWUNITX        TEST FOR UNIT EXCEPTION SA53865 38800002
         BO    TCT11600                 ..BR IF YES- TAPE MARK READ     38900021
TCT09600 EQU   *                                                        39100021
         TM    JFCBLTYP,JFCBAL+JFCBUL   WERE ANSI USER LBLS SPECIFIED-  39200021
         BNO   TCT09800                 ..BR IF NOT- BYPASS TRANSLATION 39300021
         XLATE ULDMBUFR,K80             TRANSLATE ANSI LABLE     Y02082 39350002
TCT09800 EQU   *                                                        39500021
         CLC   ULDMBUFR(K3),AUHL        WAS USER HEADER LABEL?   Y02082 39550002
         BE    TCT10000                 ..BR IF YES                     39700021
         CLC   ULDMBUFR(K3),AUTL        WAS USER TRAILER LABEL?  Y02082 39750002
         BE    TCT10000                 ..BR IF YES                     39900021
*                                                                       40000021
*              NOTE - INPUT TRAILER LABEL PROCESSING LEAVES THE TAPE    40100021
*              POSITIONED BETWEEN THE FIRST AND SECOND DATA SET         40200021
*              TRAILER LABELS. THE FOLLOWING ALLOWS PROCESSING OF USER  40300021
*              LABELS EVEN THOUGH THE TAPE MAY CONTAIN MORE DATA SET    40400021
*              LABELS THAN CAN CURRENTLY BE CREATED UNDER O/S.          40500021
*                                                                       40600021
         CLC   ULDMBUFR(K3),EOVM        WAS EOV LABEL READ?      Y02082 40650002
         BE    TCT09400                 ..BR IF YES- READ ANOTHER LABEL 40800021
         CLC   ULDMBUFR(K3),AEOF1       WAS EOF LABEL READ?      Y02082 40850002
         BE    TCT09400                 ..BR IF YES- READ ANOTHER LABEL 41000021
         CLC   ULDMBUFR(K3),HDRM        WAS HEADER LABEL READ?   Y02082 41050002
         BE    TCT09400                 ..BR IF YES- READ ANOTHER LABEL 41200021
         MVI   DXCCW1,CCWBSR            INITLZ CCW FOR 'BSR' COMMAND    41300021
         B     TCT12000                 BR- AN 'UNKNOWN' LABEL WAS READ 41400021
TCT10000 EQU   *                                                        41500021
         MVC   ULCNT+K1(K1),ULDMBUFR+K3 SAVE LABEL NUMBER        Y02082 41550002
*                                                                YM7548 41555002
*    COPY THE LABEL FROM TCLOSE'S BUFFER TO THE USER'S BUFFER    YM7548 41560002
*                                                                YM7548 41565002
         L     RF,WTGPREFX              POINT TO PREFIX          YM7548 41570002
         STM   R0,RET,IECREGSV-IECPREFX(RF)  SAVE REGS THRU LOCK YM7548 41575002
         MODESET EXTKEY=ZERO            ASSUME KEY ZERO          YM7548 41580002
*    GET LOCAL LOCK                                              YM7548 41585002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  YM7548*41590002
               RELATED=('PREVENT FREE USER CORE-RELEASED BELOW') YM7548 41595002
*                                                                YM7548 41600002
         LM    R0,RET,IECREGSV-IECPREFX(RF)  RESTORE REGISTERS   YM7548 41605002
*    VERIFY CORE HELD IN USER'S KEY AND MEMORY                   YM7548 41610002
         MODESET KEYADDR=DXUKEY,WORKREG=15  ASSUME USER KEY      YM7548 41615002
         OC    ULUWK(USERLU),ULUWK      PROG CHK IF NOT USER'S   YM7548 41620002
*                                                                YM7548 41625002
         MODESET EXTKEY=ZERO            ASSUME KEY ZERO          YM7548 41630002
*                                                                YM7548 41635002
         MVC   ULBUFR,ULDMBUFR          COPY LABEL FOR USER      YM7548 41640002
*    RELEASE LOCAL LOCK                                          YM7548 41645002
         L     RF,WTGPREFX              POINT TO PREFIX          YM7548 41650002
         STM   R0,RET,IECREGSV-IECPREFX(RF)  SAVE REGS THRU LOCK YM7548 41655002
*                                                                YM7548 41660002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=('SEE ABOVE')        YM7548 41665002
*                                                                YM7548 41670002
         LM    R0,RET,IECREGSV-IECPREFX(RF)  RESTORE REGISTERS   YM7548 41675002
*                                                                YM7548 41680002
         LA    R7,TCT11200              LOAD ADDR FOR RETURN FROM SYNCH 41700021
         MODESET KEYADDR=DXUKEY,WORKREG=15 ASSUME USER KEY       Y02082 41750002
TCT10200 EQU   *                                                        41800021
         XC    ULPARM+K8(K4),ULPARM+K8  ZERO ERROR IND                  41900021
TCT10400 EQU   *                                                        42000021
         LA    R1,ULBUFR                POINT TO LABEL BUFFER           42100021
TCT10600 EQU   *                                                        42200021
         ST    R1,ULPARM                PTR TO LABEL BUFFER      Y02082 42250002
         L     R1,DXUDCBAD              GET USER'S DCB ADDR      Y02082 42300002
         ST    R1,ULPARM+K4             PUT IN PARM LIST         Y02082 42350002
         XC    ULTOTPTR(K4),ULTOTPTR    ZERO USER TOTALING ENTRY        42500021
         MVI   ULDCBPTR,EOFFLG          SET FLAG TO INDICATE EOF M0112  42600021
         TM    DEBOPATB-DEB(RD),DEBOPOUT-DEBOPRBK   IS THE DCB OPENED   42800021
*                                       ..FOR OUTPUT OR 'RDBACK'-       42900021
         BZ    TCT10800                 ..BR IF YES- SKIP USER TOTALING 43000021
         TM    DCBOPTCD,DCBOPTT         WAS USER TOTALING SPECIFIED-    43100021
         BNO   TCT10800                 ..BR IF NOT- SKIP USER TOTALING 43200021
         L     RC,DEBSTRHH-DEB(RD)      LOAD USER TOTALING WK AREA ADDR 43300021
         USING TOTSAVWA,RC              ESTABLISH BASE ADDR FOR WK AREA 43400021
         MVC   ULTOTPTR(K4),TOTEOVPT    MOVE TOTALING PT TO PARM LIST   43500021
         DROP  RC                       DROP USER TOTALING BASE REG     43600021
TCT10800 EQU   *                                                        43700021
         MODESET EXTKEY=DATAMGT         DCB COPY KEY             Y02082 43800002
         NI    DCBOFLGS,X'FF'-DCBOLOCK  IND USER EXIT TAKEN      Y02082 43900002
*                                                                Y02082 44000002
* COPY THE DCB FROM THE WORK AREA TO USER'S STORAGE              Y02082 44100002
*                                                                Y02082 44200002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(3,14,WTGPREFX)          Y02082 44300002
*                                                                Y02082 44400002
         LA    R1,ULPARM                PT TO USER LABEL PARAMETER LIST 44500002
         IECRES UEXIT,EXITAD=ULREG11,STM=(2,13,WTGPREFX)         Y02082 44600002
         STC   RF,ULRETCOD              SAVE USER'S RETURN CODE  YM5389 44650002
         L     RDCB,DXUDCBAD            GET PTR TO USER'S DCB    Y02082 44700002
         MODESET KEYADDR=DXUKEY,WORKREG=1 ASSUME USER'S KEY      Y02082 44800002
         OI    DCBOFLGS,DCBOLOCK        IND RETURN FR USER EXIT  Y02082 44900002
         IC    R1,DCBOFLGS              GET USER'S DCBOFLGS      Y02082 45000002
         MODESET EXTKEY=DATAMGT         RESUME DATA MGT KEY      Y02082 45100002
         L     RDCB,DXPDCBAD            POINT TO COPIED DCB      Y02082 45200002
         LA    R0,DCBOBUSY              SET MASK FOR BUSY BIT    Y02082 45300002
         NR    R1,R0                    SELECT THE BUSY BIT      Y02082 45400002
         IC    R0,DCBOFLGS              COMBINE WITH DCBOFLGS    Y02082 45500002
         OR    R1,R0                    ..FROM COPIED DCB.       Y02082 45600002
         STC   R1,DCBOFLGS              UPDATE DCBOFLGS IN COPY  Y02082 45700002
         OI    DCBOFLGS,DCBOLOCK        IND RETURN FROM USER EXIT       46700021
         BR    R7                       RETURN TO CALLER OF SUBROUTINE  47000021
TCT11200 EQU   *                                                        47100021
         CH    RF,RDLBLCOD              SHOULD ANOTHER LABEL BE READ-   47200021
         BNE   TCT12200                 ..BR IF NOT- ALL DONE           47300021
         TM    JFCBLTYP,JFCBAL+JFCBUL   WERE ANSI USER LBLS SPECIFIED-  47400021
         BO    TCT09400                 ..BR IF YES- READ ANOTHER LABEL 47500021
         CLI   ULCNT+K1,MAXNOLAB        HAS THE MAXIMUM NUMBER OF       47600021
*                                       ..LABELS BEEN PROCESSED-        47700021
         BNL   TCT12200                 ..BR IF YES- ALL DONE           47800021
         B     TCT09400                 ..ELSE BR TO READ ANOTHER LABEL 47900021
*                                                                       48000021
*****          ERROR ENCOUNTERED DURING READ                            48100021
*                                                                       48200021
TCT11400 EQU   *                                                        48300021
         LA    R1,DXIOB                 INSERT POINTER TO STATUS INFO   48400021
         MODESET KEYADDR=DXUKEY,WORKREG=15 ASSUME USER KEY       Y02082 48450002
         ST    R1,ULPARM+K8             ..INTO PARAMETER LIST           48500021
         OI    ULPARM+K8,ERROR          FLAG THE ERROR                  48600021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 48650002
         LH    R1,ULCNT                 LOAD THE CURRENT LABEL NO.,     48700021
         LA    R1,K1(,R1)               ..UPDATE IT BY ONE, THEN        48800021
         STH   R1,ULCNT                 ..SAVE THE UPDATED NUMBER       48900021
         STC   R1,ULDMBUFR+K3           SAVE LABEL NUMBER        Y02082 48950002
*                                       ..WHICH COULD NOT BE READ       49100021
         LA    R7,TCT11200              LOAD ADDR FOR RETURN FROM SYNCH 49200021
         B     TCT10400                 BR TO SYNCH TO USER             49300021
*                                                                       49400021
*              A TAPE MARK HAS BEEN READ. IF USER HAS PREVIOUSLY        49500021
*              PROCESSED ANY LABELS,  REPOSITION TAPE, FREEMAIN,        49600021
*              AND RETURN TO CALLER. IF USER HAS NOT PREVIOUSLY         49700021
*              PROCESSED ANY LABELS, SYNCH TO USER WITH LABEL           49800021
*              BUFFER POINTER SET TO ZERO, THEN REPOSITION              49900021
*              TAPE, FREEMAIN, AND RETURN TO CALLER.                    50000021
*                                                                       50100021
TCT11600 EQU   *                                                        50200021
         CLI   ULCNT+K1,CHAR0           HAVE ANY LABELS BEEN PROCESSED- 50300021
         BH    TCT11800                 ..BRANCH IF YES                 50400021
         TM    JFCBLTYP,JFCBAL+JFCBUL   WERE ANSI USER LBLS SPECIFIED-  50500021
         BO    TCT11800                 ..BRANCH IF YES                 50600021
         MODESET KEYADDR=DXUKEY,WORKREG=15 ASSUME USER KEY       Y02082 50650002
         XC    ULPARM+K8(K4),ULPARM+K8  ZERO ERROR PARAMETER            50700021
         SR    R1,R1                    ZERO BUFFER POINTER             50800021
         BAL   R7,TCT10600              BR AND LINK TO SYNCH TO USER    50900021
* RETURNS IN DATAMGT KEY                                         Y02082 50950002
TCT11800 EQU   *                                                        51000021
         MVI   DXCCW1,CCWBSF            INITLZ CCW FOR BSF COMMAND      51100021
TCT12000 EQU   *                                                        51200021
         LA    RD,TABD141               LOAD INTERNAL ERROR CODE        51300021
         MVC   DXCCW1+K4(K4),CHNCOUNT   CHAIN TO 'NOP', SET CT TO 1     51400021
         MVI   DXCCW2,CCWNOP            INITLZ SECOND CCW FOR NOP CMD   51500021
         MVC   DXCCW2+K4(K4),CHNCOUNT   INITLZ LNG FOR NOP TO 1         51600021
         MVI   DXCCW2+K4,CCWSILI        TURN ON 'SILI' INDICATOR ONLY   51700021
         BAL   RC,TCT12600              BRANCH TO PERFORM BACKSPACE     51800021
         BNO   TCT12800                 BR IF I/O ERROR                 51900021
*                                                                Y02082 51920002
*    FREE USER LABEL WORK AREAS                                  Y02082 51940002
*                                                                Y02082 51960002
TCT12200 EQU   *                                                        52000021
         IECRES FREE,A=(R9),PREFIX=NO,SP=K229,KEY=USER,          Y02082*52020002
               LV=USERLU,STM=(2,14,WTGPREFX)                     Y02082 52040002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 52060002
         LR    R1,RUCB                  POINT TO USER LABEL WORK AREA   52100021
         LM    RPAR,RC,ULREGSAV         RESTORE TCLOSE REGISTER 5-12    52200002
*                                                                       52220002
* RELEASE USER LABEL WORK AREA MAIN STORAGE                      Y02080 52240002
*                                                                       52260002
         IECRES FREE,A=(R1),PREFIX=YES,STM=(2,14,WTGPREFX)       Y02082 52350002
         USING UCB,RUCB                 RE-ESTABLISH BASE REG FOR UCB   52500021
*                                                                       52600021
         EJECT                                                          52700021
*********************************************************************** 52800021
*        INVOKE IECRES MACRO TO TRANSFER CONTROL                      * 52900002
*********************************************************************** 53000021
*                                                                       53100021
TCT12400 EQU   *                                                        53200021
         MODESET EXTKEY=DATAMGT         TCLOSE WORK AREA KEY     Y02082 53250002
         L     RDEB,DCBDEBAD            RESTORE THE DEB ADDRESS         53300021
         IECRES LOAD,MODID=MOD2M2S,BRCODE=K0,BRANCH=QUEUED       Y02080 53450002
         SPACE 2                                                        53500002
*********************************************************************** 53600021
*        CLOSED SUBROUTINE TO PERFORM I/O OPERATIONS                  * 53700002
*********************************************************************** 53800021
*                                                                       53900021
*****          ENTRY TO THE SUBROUTINE IS VIA A 'BAL   RC,TCT12600'     54100021
*                                                                       54200021
TCT12600 EQU   *                                                        54300021
         EXCP  DXIOB                    INITIATE I/O OPERATION          54400021
         IECRES WAIT                    INVOKE IECRES MACRO TO 'WAIT'   54500021
         TM    IOBSTAT0,CSWUNITX        TEST FOR TAPE INDICATE  SA53865 54520002
         BCR   1,RC                     RETURN IF ON            SA53865 54540002
         TM    DXECB,ECBNOERR           TEST FOR SUCCESSFUL COMPLETION- 54600021
         BR    RC                       RETURN TO CALLER WITH           54700021
*                                       ..CONDITION CODE SET            54800021
         SPACE 2                                                        54900021
*********************************************************************** 55000021
*              ERROR PROCESSING                                       * 55100021
*********************************************************************** 55200021
*                                                                       55300021
TCT12800 EQU   *                                                        55400021
         MODESET EXTKEY=DATAMGT         TCLOSE WORK AREA KEY     Y02082 55450002
         DMABCOND (RD),ABEND2M          EXIT TO PROB DETERMINATION RTN  55500021
         EJECT                                                          55600021
*********************************************************************** 55800021
*              CONSTANTS                                              * 55900021
*********************************************************************** 56000021
*                                                                       56100021
RDLBLCOD DC    H'4'                     RET CODE IND 'READ ANOTHER LBL' 56500021
CHNCOUNT DC    X'60000001'              CMD CHAIN, SILI BIT, LNG EQ 1   56600021
EOVM     DC    C'EOV'                   END-OF-VOLUME LABEL IDENTIFIER  56700021
AEOF1    DC    C'EOF'                   END-OF-FILE LABEL IDENTIFIER    56800021
HDRM     DC    C'HDR'                   HEADER LABEL IDENTIFIER         56900021
AUHL     DC    C'UHL'                   USER HEADER LABEL IDENTIFIER    57000021
AUTL     DC    C'UTL'                   USER TRAILER LABEL IDENTIFIER   57100021
ATRTCH   DC    C' CET'                  TRANSLATE TABLE FOR JFCB TAPE   57200021
*                                       ..RECORDING TECHNIQUE           57300021
EXIT4    DC    X'04'                    OUTPUT USER LABEL CODE BYTE     57400021
         DC    X'84'                    SAME AS ABOVE WITH 'LAST ENTRY' 57500021
*                                       ..INDICATOR                     57600021
SLPSUP   DC    X'0C'                    DEFERRED USER LABEL PROCESSING  57700021
*                                       ..CODE                          57800021
         DC    X'8C'                    SAME AS ABOVE WITH 'LAST ENTRY' 57900021
*                                       ..INDICATOR                     58000021
         SPACE 2                                                        58050002
*****************************************************************Y02083 58100002
*              EQUATES                                           Y02083 58150002
*****************************************************************Y02083 58160002
*                                                                Y02083 58170002
FL2CKDS  EQU   C'C'                     TAPE CHKPT D/S INDICATOR Y02083 58180002
         EJECT                                                          58190002
*********************************************************************** 58200021
*              XCTL TABLE                                             * 58300021
*********************************************************************** 58400021
*                                                                       58500021
XCTLTB2M XCTLTABL ID=(ABEND2M,0P,MOD2M2S,2S),SVC=023,            Y02080X58600002
               BRT=YES,LENGTH=                                   Y02080 58650002
         SPACE 2                                                        58700021
         IECDSECS CVT,                                                 C58800021
               TCB,                                                    C58900021
               RB,                                                     C59000021
               TIOT,                                                   C59100021
               DCB,                                                    C59200021
               DEB,                                                    C59300021
               UCB,                                                    C59400021
               DSAB,                                             Y02083C59450002
               MAIN,                                                   C59500021
               USERTOT,                                                C59600021
               UNITTAB,                                                C59700021
               USERLAB,                                                C59800021
               WTG,                                                    C59900021
               PREFX,                                            Y02080*59950002
               PSA,                                              Y02082*59960002
               RRPL,                                             Y02144*59970002
               EXPAND=YES                                               60000021
         IECEQU ,                       INVOKE OPEN/CLOSE/EOV EQUATES   60100021
         SPACE 2                                                        60200021
         END                                                            60300021
