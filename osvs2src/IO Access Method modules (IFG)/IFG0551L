         TITLE '      IFG0551L   END-OF-VOLUME  EXECUTOR (SAM) '        00100002
IFG0551L CSECT                                                          00200002
         ENTRY IFG0551N                 ALIAS ENTRY POINT        Y02080 00210002
*********************************************************************** 00260002
*                                                                     * 00310002
*                                                                     * 00360002
*          VS2 RELEASE 03 CHANGES/DELETIONS                           * 00362037
*0000492000                                                    @ZA01346 00372037
*0000                                                          @ZA08004 00382037
*0000175005,175105                                             @ZA13524 00387037
*0000509000-510000,511000                                      @ZA14615 00388037
*0000                                                          @ZA15980 00388537
*                                                                     * 00389037
*          VS2 RELEASE 02 CHANGES/DELETIONS                           * 00392037
*0000496000-496500                                              ZA00707 00402037
*0000                                                           ZA00020 00412037
*                                                                     * 00460002
*                                                                     * 00510002
*********************************************************************** 00560002
*                                                                     * 00610002
* MODULE NAME = IFG0551L (OS/VS2)                                     * 00660002
*                                                                     * 00710002
* DESCRIPTIVE NAME =                                                  * 00760002
*        END OF VOLUME EXECUTOR (SAM)                                 * 00810002
*                                                                     * 00860002
* COPYRIGHT = NONE                                                    * 00910002
*                                                                     * 00960002
* STATUS = RELEASE 2, LEVEL 0                                         * 01010002
*                                                                     * 01060002
* FUNCTION =                                                          * 01110002
*        THIS MODULE IS ENTERED AS THE LAST EOV MODULE FOR BSAM       * 01160002
*        AND QSAM AFTER SUCCESSFULLY SWITCHING TAPE OR DA VOLUMES,    * 01210002
*        OR OBTAINING ADDITIONAL DIRECT ACCESS SPACE ON THE CURRENT   * 01260002
*        OR NEXT VOLUME, OR COMPLETION OF A CONCATENATION OF TWO      * 01310002
*        DATA SETS OF LIKE ATTRIBUTES.                                * 01360002
*                                                                     * 01362002
*        THE MODULE IS ENTERED FROM THE FOLLOWING MODULES-            * 01364002
*        IFG0552X AFTER COMPLETING UNIT RECORD CONCATENATION.         * 01368002
*        IFG0553Z AFTER MOUNTING A NEW VOLUME FOR DIRECT ACCESS       * 01370002
*              INPUT OR CONCATENATING TWO DIRECT ACCESS DATA SETS.    * 01372002
*        IFG0554B AFTER VBS RECORD FORMAT UPDATE PROCESSING.          * 01374002
*        IFG0555H AFTER MOUNTING A NEW VOLUME OR OBTAINING ADDITIONAL * 01376002
*              SPACE ON THE CURRENT VOLUME FOR DIRECT ACCESS OUTPUT.  * 01378002
*        IFG0552F AFTER MOUNTING A NEW VOLUME FOR TAPE OUTPUT.        * 01380002
*        IFG0553H AFTER MOUNTING A NEW VOLUME FOR TAPE INPUT OR       * 01382002
*              CONCATENATING TWO TAPE DATA SETS.                      * 01384002
*                                                                     * 01394003
*        IF CHKPT=EOV SPECIFIED FOR THIS DATA SET, INVOKES MODULE     * 01404003
*        IFG0558X VIA IECRES LOAD AND SYNCH .                         * 01410003
*                                                                     * 01420003
*        THE USER'S DCB IS REFRESHED FROM THE COPIED DCB.             * 01460002
*        THE EOV WORKAREA IS FREED. THE EOV EXIT IS TAKEN IF IT IS    * 01510002
*        PRESENT. A SMALL EOV WORKAREA IS OBTAINED IN WHICH TO SAVE   * 01560002
*        REGISTERS. CHANNEL PROGRAMS WHICH WERE PURGED ARE RESTARTED. * 01610002
*        A SEPERATE ROUTINE RESTARTS CHAINED SCHEDULING CHANNEL       * 01660002
*        PROGRAMS.                                                    * 01710002
*                                                                     * 01760002
*        ALL WORKAREAS ARE FREED AND THE BSAM/QSAM ACCESS METHOD      * 01810002
*        CALLER OF EOV IS RETURNED CONTROL.                           * 01860002
         EJECT                                                          01910002
* NOTES =                                                             * 01960002
*        UPON ENTRY TO THE USER'S EOV EXIT ROUTINE, THE CONTENTS      * 02010002
*        OF THE REGISTERS ARE AS FOLLOWS -                            * 02060002
*        0 - PARAMETER REGISTER. POINTER TO IMAGE AREA IF USER        * 02110002
*              TOTALING OPTION FOR OUTPUT DATA SETS HAS BEEN          * 02160002
*              SPECIFIED. OTHERWISE ZERO.                             * 02210002
*        1 - PARAMETER REGISTER. POINTER TO USER DCB FOR DATA SET     * 02260002
*              FOR WHICH EOV PROCESSING IS TAKING PLACE.              * 02310002
*        2-13 - USER'S REGISTERS AT ENTRY TO THE ACCESS METHOD        * 02360002
*              GET/PUT/CHECK MACRO INSTRUCTION WHICH CALLED           * 02410002
*              EOV.                                                   * 02460002
*        14 - RETURN ADDRESS.                                         * 02510002
*        15 - ADDRESS OF EOV EXIT ROUTINE.                            * 02560002
*                                                                     * 02610002
*    DEPENDENCIES =                                                   * 02660002
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 02710002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 02760002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 02810002
*                                                                     * 02860002
*    RESTRICTIONS = NONE                                              * 02910002
*                                                                     * 02960002
*    REGISTER CONVENTIONS =                                           * 03010002
*            R2 POINTS TO USER'S DCB                                  * 03060002
*            R4 POINTS TO EOV WORK AREA                               * 03110002
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 03160002
*            R10 POINTS TO THE UCB                                    * 03210002
*                                                                     * 03260002
*    PATCH LABEL = SEE THIRD FROM LAST LABEL BEFORE ORG STATEMENT AT  * 03310002
*                  END OF LISTING.                                    * 03360002
*                                                                     * 03410002
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 03460002
*                                                                     * 03510002
*    PROCESSOR = ASSEMBLER XF                                         * 03560002
*                                                                     * 03610002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 03660002
*                  ORG STATEMENT AT END OF LISTING                    * 03710002
*                                                                     * 03760002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 03810002
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 03860002
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 03910002
         EJECT                                                          03960002
* ENTRY POINT =                                                       * 04010002
*        IFG0551L                                                     * 04060002
*                                                                     * 04110002
*    PURPOSE = SEE FUNCTION                                           * 04160002
*                                                                     * 04210002
*    LINKAGE =                                                        * 04260002
*        THIS MODULE IS GIVEN CONTROL THROUGH THE IECRES-LOAD MACRO.  * 04310002
*                                                                     * 04360002
* INPUT =                                                             * 04410002
*        ENTERED IN DATA MANAGEMENT PROTECT KEY 5.                    * 04460002
*        REGISTER 2 POINTS TO THE COPIED DCB.                         * 04510002
*        REGISTER 4 POINTS TO THE EOV WORKAREA.                       * 04560002
*                                                                     * 04610002
* OUTPUT =                                                            * 04660002
*        ALL BSAM/QSAM CHANNEL PROGRAMS WHICH MUST BE RESTARTED ARE.  * 04662002
*        REGISTER 15 = 0.                                             * 04710002
*                                                                     * 04760002
* EXIT-NORMAL =                                                       * 04810002
*        RETURN TO THE ACCESS METHOD CALLER OF EOV THROUGH THE        * 04860002
*        IECRES-EXIT MACRO.                                           * 04910002
*                                                                     * 04960002
* EXIT-ERROR =                                                        * 05010002
*        NONE                                                         * 05060002
*                                                                     * 05110002
* EXTERNAL REFERENCES = SEE BELOW                                     * 05160002
*                                                                     * 05210002
*    ROUTINES =                                                       * 05260002
*        IFG019RA ENTERED THROUGH IECRES MACRO INSTRUCTION.           * 05310002
*                                                                     * 05312002
*        BSAM/QSAM END OF BLOCK ROUTINE TO SCHEDULE IOBS POINTED TO   * 05314002
*        THE FOLLOWING DCB LABELS -                                   * 05316002
*              DCBEOB - QSAM                                          * 05318002
*              DCBEOBW - BSAM WRITE                                   * 05320002
*              DCBEOBR - BSAM READ                                    * 05322002
*              DCBWRITE - BDAM LOAD MODE                              * 05324002
*                                                                     * 05360002
*    DATA AREAS =                                                     * 05410002
*        EOV WORKAREA.                                                * 05460002
*        SMALL EOV WORKAREA USED TO SAVE REGISTERS, CONTROL BLOCK     * 05510002
*              POINTERS, INDICATORS.                                  * 05560002
*        REGISTER SAVE AREA IN USER KEY TO PASS TO ACCESS METHOD      * 05610002
         EJECT                                                          05660002
*                                                                     * 05710002
*    CONTROL BLOCK =                                                  * 05760002
*        CVT                                                          * 05810002
*        DCB                                                          * 05860002
*        DCB                                                          * 05910002
*        ACCESS METHOD IOBS                                           * 05960002
*        SVRB                                                         * 06010002
*        TCB                                                          * 06060002
*        UCB                                                          * 06110002
*                                                                     * 06160002
* TABLES =                                                            * 06210002
*        NONE.                                                        * 06260002
*                                                                     * 06310002
* MACROS =                                                            * 06360002
*        IECRES LOAD                                                  * 06370003
*        IECRES INIT                                                  * 06410002
*        IECRES FREE                                                  * 06460002
*        IECRES EXIT                                                  * 06510002
*        MODESET                                                      * 06560002
*        SYNCH                                                        * 06610002
*        GETMAIN                                                      * 06660002
*        DEBCHK                                                       * 06710002
*        EXCP                                                         * 06760002
*        FREEMAIN                                                     * 06810002
*                                                                     * 06860002
* CHANGE ACTIVITY =                                                   * 06910002
*        SEE CHANGES/DELETIONS SECTION JUST AFTER CSECT CARD          * 06912002
*                                                                     * 06960002
*********************************************************************** 07010002
         EJECT                                                          07060002
         BALR  RBASE,0                  ESTABLISH BASE                  09450002
         USING EIN21400,RBASE                                           09500002
         USING IHADCB,RDCB                                              09550002
         USING DEB,RDEB                                                 09600002
         USING FORCORE,RCORE                                            09650002
         USING UCB,RUCB                                                 09700002
EIN21400 EQU   *                        BASE ADDRESS                    09750002
*  THE FOLLOWING CODE TESTS FOR REQUEST FOR AN EOV EXIT WHICH IS        09800002
*  IDENTIFIED BY A DCB EXIT-LIST ENTRY CODE OF X'06' OR X'86'.          09850002
*  FOR DIRECT-ACCESS OUTPUT DATA SETS, REG RC NOTES IF                  09900002
*  EXTENDING ON THE SAME VOLUME OR IF A NEW VOLUME WAS MOUNTED.         09950002
*  CURRENT IMPLEMENTATION ALLOWS FOR EXIT IF NEW VOLUME WAS             10000002
*  MOUNTED.                                                           * 10050002
*                                                                     * 10100002
***                                                              Y02082 10150002
*                                                                Y02082 10200002
* ON ENTRY TO THIS ROUTINE THE FOLLOWING WILL OCCUR              Y02082 10250002
*                                                                Y02082 10300002
*        .     THE USER'S DCB WILL BE UPDATED                    Y02082 10350002
*        .     THE EOV WORK AREA WILL BE FREED, SINCE CHECKPOINT Y02082 10400002
*              WILL NOT SAVE THE AREAS IN SP230 AT THE EOV EXIT  Y02082 10450002
*              HENCE THIS ENTIRE LOAD WILL RUN WITHOUT AN EOV    Y02082 10500002
*              WORK AREA.                                        Y02082 10550002
*        .     A SMALL WORK AREA WILL BE GOTTEN FOR REGISTERS    Y02082 10600002
*              OF EOV                                            Y02082 10650002
*        .     A REGISTER SAVE AREA FOR THE USER SYNCH WILL BE   Y02082 10700002
*              GOTTEN                                            Y02082 10750002
*        .     THE ROUTINE WILL RUN IN USER KEY, WORKING ON THE  Y02082 10800002
*              USER'S DCB,IOBS,CCWS,EXIT LIST.                   Y02082 10850002
*              IT WILL BE THE EXCEPTION THAT IT RUNS IN DATAMGT  Y02082 10900002
*              KEY OR ANY OTHER KEY                              Y02082 10950002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(0,14,DXXPREFX)          Y02082 11000002
         BAL   R6,EIN24840              GET SVRB ADDR            Y02082 11050002
         USING RBSECT,RET               SVRB                     Y02082 11100002
         EJECT                                                          11110002
         SR    R6,R6                    ZERO REG. AS INDICATOR  Z30JSFC 11120003
         TM    JFCFLGS1,JFCBCEOV        CHKPT=EOV THIS D/S?     Z30JSFC 11130003
         BZ    EIN21420                 NO - CONTINUE           Z30JSFC 11140003
         LA    RWTG,DXXMODNM            POINT TO WTG TABLE      Z30JSFC 11140103
         MVC   DXXMODNM(K12),IFG0558X   MOVE MOD NAME AND EP    Z30JSFC 11140403
         IECRES LOAD,PREFIX=DXXPREFX,BRANCH=NO                  Z30JSFC 11142003
         L     R6,DXXMODEP              GET ENTRY ADDRESS       Z30JSFC 11142403
EIN21420 EQU   *                        FREE WORK AREAS         Z30JSFC 11144003
         L     RDCB,DXUDCBAD            GET USER'S DCB ADDR      Y02082 11150002
         MODESET EXTKEY=SUPR            RB KEY                   Y02082 11200002
         STM   RDCB,RD,RBEXSAVE         SAVE REGS                Y02082 11250002
         MODESET EXTKEY=DATAMGT         KEY OF EOV WORK AREA     Y02082 11300002
         LR    R8,RET                   SAVE RB ADDR ACROSS FREE Y02082 11350002
         IECRES FREE,A=(RCORE),PREFIX=EOV FREE EOV WORK AREA     Y02082 11400002
         DROP  RCORE                    NO MORE WORK AREA        Y02082 11450002
         LR    RET,R8                   RESTORE SVRB PTR         Y02082 11500002
         LM    RDCB,RD,RBEXSAVE         RESTORE REGS             Y02082 11550002
         DROP  RET                      DROP SVRB ADDR           Y02082 11600002
         L     RCORE,CVTPTR             ADDR CVT                 Y02082 11650002
         L     RCORE,CVTTCBP-CVT(,RCORE) ADDR TCB PTRS           Y02082 11700002
         L     RCORE,K4(,RCORE)         ADDR OF TCB              Y02082 11750002
         USING TCB,RCORE                                         Y02082 11800002
         MODESET EXTKEY=RBT234,WORKREG=14 USER'S KEY             Y02082 11850002
         EJECT                                                          11860002
*                                                                Y02082 11900002
*        RD CONTAINS THE VOLUME 'SWITCH INDICATOR' FOR BDAM/VS   Y02082 11950002
*        RECORDS.  IT WILL NOT BE SAVED IN THE EOVLAST WORK AREA Y02082 12000002
*        UNTIL AFTER THE EOV EXIT                                Y02082 12050002
*                                                                Y02082 12100002
         LR    RES,RDEB                 PUT DEB IN OLD DEB REG          12150002
*                                                                       12152002
*        CHAINED SCHEDULING AND SPANNED RECORDS FEOV             YM1194 12154002
*        REPOSITIONING ARE MUTUALLY EXCLUSIVE                    YM1194 12156002
*                                                                       12158002
         TM    DCBCIND2,DCBC2CHN        IS CHAINED SCHEDULING    YM1194 12160002
*                                       BEING USED               YM1194 12170002
         BO    EIN21450                 BRANCH IF YES-DON'T      YM1194 12180002
*                                       TEST DCBIOBAD            YM1194 12190002
         TM    DCBIOBAD,DCBIOUPD        TEST FOR FREEING FEOV           12200002
         BO    EIN22000                 BRANCH AROUND EXIT TO           12250002
*                                       USER                            12300002
EIN21450 EQU   *                        CHECK IF EXTENDING DA    YM1194 12310002
         TM    DCBDEVT,DCBDEVDA         TEST, BR IF NOT A D.A.          12350002
         BNO   EIN21500                 DEVICE                          12400002
         TM    DCBOFLGS,DCBOWRIT        TEST, BR IF LAST OPERATION      12450002
         BZ    EIN21500                 WAS NOT OUTPUT                  12500002
         LA    RC,K1                                                    12550002
         CR    RD,RC                    TEST, BR IF EXTENDING ON        12600002
         BE    EIN22000                 SAME VOLUME                     12650002
EIN21500 EQU   *                        LOOK FOR EOV EXIT               12700002
         LTR   R6,R6                    CHKPT AT EOV TO BE DONE Z30JSFC 12710003
         BZ    EIN21550                 NO - CONTINUE           Z30JSFC 12720003
         LR    RF,R6                    STORE ADDR. FOR 'SYNCH' Z30JSFC 12740003
         B     EIN21800                 PROCESS AS IF EOV EXIT  Z30JSFC 12742003
EIN21550 EQU   *                        CHKPT NOT = EOV         Z30JSFC 12744003
         L     RF,DCBEXLST              PTR TO DCB EXIT LIST            12750002
         LA    RF,K0(K0,RF)                                             12800002
         LTR   RF,RF                    TEST,BR IF PTR IS ZERO          12850002
         BZ    EIN22000                 (I.E.,NO EXIT LIST EXISTS)      12900002
         EJECT                                                          12910002
EIN21600 EQU   *                        LOOK FOR EOV EXIT IN EXLST      12950002
         CLI   K0(RF),XLEOV             CHK FOR EOV EXIT                13000002
         BE    EIN21700                 BR IF YES                       13050002
         CLI   K0(RF),LASTNTRY+XLEOV    CHK FOR EOV EXIT                13100002
         BE    EIN21700                 BR IF YES                       13150002
         TM    K0(RF),LASTNTRY          TEST,BR IF LAST EXIT LIST       13200002
         BO    EIN22000                 ENTRY HAS BEEN EXAMINED.        13250002
         LA    RF,K4(K0,RF)             INCREMENT PTR TO POINT TO NEXT  13300002
         B     EIN21600                 ENTRY AND EXAMINE IT.           13350002
*                                                                       13400002
EIN21700 EQU   *                        SET UP USER TOTALING            13450002
*                                                                       13500002
*  AN ENTRY FOR AN EOV EXIT HAS BEEN FOUND -                            13550002
*  UPON ENTRY TO THE USER'S EOV EXIT ROUTINE, THE CONTENTS OF           13600002
*  THE REGISTERS ARE AS FOLLOWS-                                        13650002
*        REGISTERS 0,1   PARAMETER REGISTERS                            13700002
*                        0=PTR TO IMAGE AREA IF TOTALING OPTION         13750002
*                          FOR OUTPUT DATA SETS HAS BEEN SPECIFIED.     13800002
*                          OTHERWISE ZERO.                              13850002
*                        1=PTR TO DCB FOR DATA SET FOR WHICH EOV        13900002
*                          PROCESSING IS TAKING PLACE.                  13950002
*                  2-13  USER'S REGS AT ENTRY TO EOV                    14000002
*                  14    RETURN ADDRESS                                 14050002
*                  15    ADDRESS OF EOV EXIT ROUTINE                    14100002
*                                                                       14150002
         L     RF,K0(K0,RF)             ADDRESS OF EOV EXIT ROUTINE     14200002
         SR    R0,R0                    CLEAR PARM REG IN CASE TOTALING 14250002
*                                       NOT SPECIFIED                   14300002
*                                                                       14350002
*   IF USER TOTALING IS SPECIFIED, THE ADDRESS OF THE IMAGE AREA FOR    14400002
*   THE LAST RECORD WRITTEN ON THE OLD VOLUME IS PASSED TO THE USER'S   14450002
*   EXIT ROUTINE IN REGISTER 0.                                         14500002
*                                                                       14550002
         TM    DCBOPTCD,DCBOPTT         TEST IF TOTALING SPECIFIED      14600002
         BZ    EIN21800                 BR IF NO TOTALING               14650002
         TM    DEBOPATB,CCWRDKEY        TEST FOR INPUT/RDBACK           14700002
         BZ    EIN21800                 BR INPUT/RDBACK-NO TOTALING     14750002
*                                                                       14800002
         SR    RET,RET                  CLEAR REGISTER                  14850002
         SR    R1,R1                    CLEAR REGISTER                  14900002
         IC    RET,DEBNMEXT             GET NUMBER OF EXTENTS           14950002
         IC    R1,DEBEXSCL              GET EXTENT SCALE                15000002
         SLL   RET,K0(R1)               COMPUTE LENGTH OF EXTENTS       15050002
         L     R1,K36(RET,RDEB)         GET ADDR TOTALING WORKAREA      15100002
*                                       FROM ACCESS METH PORTION        15150002
*                                       DEB ADDR+32+4+LNGTH EXTNTS      15200002
         L     R0,TOTEOVPT-TOTSAVWA(R1)  IMAGE AREA ADDR FOR LAST       15250002
*                                       RECORD WRITTEN                  15300002
         EJECT                                                          15310002
EIN21800 EQU   *                        SET UP TO TAKE EXIT             15350002
         BAL   R6,EIN24840              BR TO GET SVRB PTR       M0135  15400002
         USING RBSECT,RET                                               15450002
         C     RF,IFG0558X+L'IFG0558X   TEST IF CHKPT=EOV       Z30JSFC 15460003
         BNE   EIN21820                 NO - CONTINUE           Z30JSFC 15470003
         SR    R6,R6                    YES - ZERO REG TO ID SO Z30JSFC 15480003
EIN21820 EQU   *                                                Z30JSFC 15490003
         MODESET EXTKEY=SUPR            RB KEY                   Y02082 15500002
         OI    RBSTAB,RBFTCKPT          INDICATE CHECK POINT            15550002
*                                       CAN BE ISSUED                   15600002
         STM   RDCB,RD,RBEXSAVE         SAVE REGS 2-13 ACROSS           15650002
*                                       EXIT TO THE USER                15700002
         MODESET EXTKEY=RBT234,WORKREG=1 USER KEY                Y02082 15750002
         NI    DCBOFLGS,X'FF'-DCBOLOCK  SET LOCK BIT                    15800002
         LR    R1,RDCB                  DCB ADDRESS                     15850002
         L     RC,RBLINK                GET CALLERS RB           Y02082 15850502
         CLI   RBOPSW+K1-RBBASIC(RC),X80 IS CALLER IN SYSTEM KEY Y02082 15851002
         BNL   EIN21850                 BRANCH IF NOT            Y02082 15851502
         LM    RDCB,RD,RBGRS2           LOAD CALLER'S REGS       Y02082 15852002
         BALR  RET,RF                   TAKE EXIT                Y02082 15852502
         BALR  RET,0                    ESTABLISH BASE           Y02082 15853002
         USING *,RET                    USING FOR 1 INSTRUCTION  Y02082 15853502
         B     EIN21950                 RESTORE REGS             Y02082 15854002
         DROP  RET                                               Y02082 15854502
         USING RBSECT,RET                                        Y02082 15854602
         EJECT                                                          15854702
EIN21850 EQU   *                        GET SVRB                 Y02082 15855002
         L     RC,RBLINK                PTR TO PREVIOUS RB              15900002
         TM    RBSTAB-RBSECT(RC),RBFTSVRB  IS PREVIOUS A PRB            15950002
         BZ    EIN21900                 YES,BRANCH               Y02082 16000002
         LR    RET,RC                   USE PREVIOUS RB                 16050002
         CLM   RCORE,B'0111',RBLINK+K1  IS THERE ANOTHER RB      Y02082 16050502
         BNE   EIN21850                 BRANCH IF YES            Y02082 16051002
         L     RET,TCBRBP               USE CURRENT SVRB         Y02082 16051502
EIN21900 LM    RDCB,RD,RBGRS2           RESTORE USER REGS               16100002
         SYNCH (15)                                                     16150002
*  ALTHOUGH NOT RESTRICTED TO CHECKPOINT/RESTART APPLICATIONS,          16200002
*  THIS X'06' EXIT IS REQUIRED IN SUPPORT OF C/R.  A REQUIREMENT        16250002
*  OF THIS SUPPORT IS THAT ALL 'PERTINENT' REGISTERS BE                 16300002
*  RE-ESTABLISHED AFTER RECEIVING CONTROL BACK FROM THE USER'S          16350002
*  EXIT ROUTINE(TO HANDLE A RESTART-TIME SITUATION).  THE               16400002
*  PERTINENT POINTERS WHICH MUST BE RE-ESTABLISHED INCLUDE              16450002
*  POINTERS TO THE DEB, UCB, TIOT,... (I.E., ANY POINTER TO             16500002
*  SYSTEM QUEUE SPACE MUST BE RE-ESTABLISHED).                          16550002
EIN21950 EQU   *                        RESTORE REGS FROM SVRB          16650002
IFG0551N EQU   EIN21950                 RESTART ENTRY AFTER CKPT Y02080 16660002
         L     RCORE,CVTPTR             ADDR CVT                 Y02082 16700002
         L     RCORE,CVTTCBP-CVT(,RCORE) ADDR TCB PTRS           Y02082 16750002
         L     RCORE,K4(,RCORE)         CURRENT TCB ADDR         Y02082 16800002
         L     RET,K0(,RCORE)           SVRB ADDR                Y02802 16850002
         MODESET EXTKEY=SUPR            RB KEY                   Y02082 17250002
         NI    RBSTABYT(RET),ALLBITS-K4  TURN OFF CHKPT FLAG            17300002
         MODESET EXTKEY=RBT234,WORKREG=1 USER KEY                Y02082 17450502
         LM    RDCB,RBASE,RBEXSAVE      RESTORE REGS 2-3       @ZA13524 17500537
         LM    RES,RD,RBEXSAVE+K12      RESTORE REGS 5-13      @ZA13524 17510537
*                                                                       17520537
         DEBCHK (RDCB)                  VALIDATE DCB             Y01021 17550002
         LR    RDEB,R1                  LOAD VALIDATED DEB ADDR  Y01021 17600002
         DROP  RET                                                      17700002
         OI    DCBOFLGS,DCBOLOCK        UNLOCK DCB                      17750002
         LTR   R6,R6                    TEST IF CHKPT=EOV       Z30JSFC 17800003
         BZ    EIN21550                 YES - GO TEST FOR USER  Z30JSFC 17850003
         EJECT                                                   Y02082 17950002
EIN22000 EQU   *                        GET SMALL EOV WORKAREA          18000002
         BALR  RBASE,0                  RE-ESTABLISH BASE               18050002
         USING *,RBASE                                                  18100002
         GETMAIN R,LV=72,SP=230         USER REG SAVE AREA       Y02082 18150002
         LR    RET,R1                   SAVE ADDR USER SAVE AREA Y02082 18200002
         MODESET EXTKEY=DATAMGT         EOV KEY FOR GETMAIN      Y02082 18250002
         GETMAIN R,LV=92,SP=230         SMALL WORK AREA FOR            *18300002
                                        LAST LOAD - EOVLAST      Y02082 18350002
         LR    RCORE,R1                 WORK AREA ADDR           Y02082 18400002
         USING EOVLAST,RCORE            IFG0551L SPECIAL WORK AR Y02082 18450002
         ST    RDEB,EOVDEBAD            SAVE DEB ADDR            Y02082 18500002
         ST    RD,EOVVOLSW              SAVE VOL 'SWITCH INDR'   Y02082*18550002
                                        FOR BDAM/VS RCDS         Y02082 18600002
         ST    RET,EOVURGSV             SAVE ADDR USER REG SAVE  Y02082 18650002
         BAL   R6,EIN24840              GET SVRB PTR             Y02082 18700002
         USING RBSECT,RET               RB ADDR                  Y02082 18750002
         L     RET,RBLINK               GET PREV RB PTR          Y02082 18800002
         MVC   EOVUKEY,RBOPSW+K1        GET USER KEY             Y02082 18850002
         NI    EOVUKEY,KEYMASK          SAVE KEY ONLY            Y02082 18900002
         DROP  RET                                               Y02082 18950002
         MODESET KEYADDR=EOVUKEY,WORKREG=15 USER'S KEY           Y02082 19000002
         LR    RD,R1                    INIT ADDR EOV REG SV AR  Y02082 19050002
         EJECT                                                          19100002
         NI    DCBCIND2,ALLBITS-DCBCNWR0 TURN OFF INDICATOR WHICH       19200002
*                                       CAUSES LOAD MODE TO GO TO       19250002
*                                       NEXT TRACK                      19260002
         SR    RC,RC                    INITIALIZE                      19300002
         SR    R7,R7                                                    19350002
         NI    DCBIFLGS,ALLBITS-DCBIFPIO CLEAR ERROR CONDITION DCB      19400002
         NI    DCBCIND1,ALLBITS-DCBCNEVB TURN OFF VOLUNE FULL BIT       19450002
         TM    DCBDEVT,DCBDEVDA         DIRECT ACCESS DEVICE            19500002
         BNO   EIN22300                 NO BRANCH                       19550002
*                                                                       19600002
*                                                                       19650002
         L     RUCB,DEBUCBAD            YES LOAD MAIN UCB ADDR.         19700002
         LA    RUCB,K0(RUCB)            CLEAR HI BYTE                   19750002
         MVC   DCBDEVT(K1),UCBTBYT3     STORE DEVICE CLASS              19800002
         OC    DCBDEVT(K1),UCBTBYT4     STORE DEVICE NUMBER             19850002
*                                                                       19900002
         USING CVT,RET                                                  19950002
         L     RET,CVTPTR(,R0)          GET CVT ADDRESS                 20000002
         L     RET,CVTZDTAB             DEV CHAR TABLE ADDRESS          20050002
         IC    R1,DCBDEVT               GET DEVICE NUMBER               20100002
         LA    R8,K15                   MASK OUT HIGH-ORDER ...         20150002
         NR    R1,R8                    28 BITS                         20200002
         IC    R1,0(R1,RET)             ADD ID TO TABLE ADDRESS         20250002
         LA    RET,0(R1,RET)            PT TO ENTRY FOR THIS DEV.       20300002
         IC    R1,DCBDVTBL              SAVE RECORD NUMBER              20350002
         ST    RET,DCBDVTBL             ADDR OF ENTRY IN DEV. TAB.      20400002
         STC   R1,DCBDVTBL              RESTORE RECORD NUMBER           20450002
         IC    R1,K8(K0,RET)            GET KEY OVHEAD CONSTANT         20500002
         CLI   DCBKEYLE,K1              KEYS SPECIFIED                  20550002
         BC    10,EIN22200              YES, BRANCH AROUND STORE        20600002
         STC   R1,DCBKEYCN              UPDATE DCB KEY OVHEAD CON       20650002
EIN22200 EQU   *                        INIT DCBTRBAL                   20700002
         L     RUCB,DCBDVTBL            GET DEVICE CONSTANTS            20710002
         MVC   DCBTRBAL(K2),K4(RUCB)    INITAILIZE TRACK BALANCE        20750002
         EJECT                                                          20800002
EIN22300 EQU   *                        GET CURRENT IOB, ERROR IOB      20950002
         L     RET,DCBIOBA              GET CURR IOB IN USE             20960002
         LA    RET,K0(RET)              CLEAR HI BYTE                   21000002
         L     R1,K4(RET)               IOB IN ERROR                    21050002
         LA    R1,K0(R1)                HI BYTE ZEROED                  21100002
*                                                                       21102002
*        CHAINED SCHEDULING AND SPANNED RECORDS FEOV             YM1194 21104002
*        REPOSITIONING ARE MUTUALLY EXCLUSIVE                    YM1194 21106002
*                                                                       21108002
         TM    DCBCIND2,DCBC2CHN        PCI BEING USED           YM1194 21110002
         BO    EIN25300                 YES, BRANCH              YM1194 21120002
         TM    DCBIOBAD,DCBIONOT        FREEING DEB FEOV                21150002
         BO    EIN26520                 YES, BRANCH              Y02082 21200002
         TM    DCBIOBAD,DCBIOUPD        IS QSAM EOV                     21250002
*                                       REPOSITIONING                   21300002
         BO    EIN26550                 YES, BRANCH              Y02082 21350002
*                                                                       21400002
*                                       PCI/FEOV REPOS NOT USED  YM1194 21500002
*                                                                       21600002
EIN22310 EQU   *                        GET END OF BLOCK ADDR    M0135  21650002
         TM    DCBCIND2,DCBC2QSM        QSAM BEING USED                 21700002
         BO    EIN22400                 YES, GET EOB ADDRESS            21750002
*                                       BSAM                            21800002
         L     RF,DCBEOBW               GET WRITE EOB RT ADDRESS        21850002
         B     EIN22500                 BRANCH SET IOB COMPLETE         21900002
EIN22400 EQU   *                        QSAM                            21950002
         L     RF,DCBEOB                QSAM EOB ROUTINE ADDRESS        22000002
EIN22500 EQU   *                        CHECK STATUS                    22050002
         MVI   K4(R1),ECBCOD7F          SET IOB COMPLETE NO ERROR       22060002
*                                                                       22100002
         TM    K0(R1),IOBWRITE          IS IT WRITE STATUS              22150002
*                                                                       22200002
         BO    EIN22600                 YES, BRANCH                     22250002
*                                                                       22300002
         TM    DEBOPATB,K7              CHECK IF OUTPUT STATUS          22350002
         BNO   EIN23100                 NO BRANCH                       22400002
*                                                                       22450002
EIN22600 EQU   *                        CHECK FEOV                      22500002
*                                                                       22550002
         TM    DCBCIND2,DCBC2FEO        OUR WE IN FEOV MODE             22600002
         BO    EIN26550                 YES, BRANCH              Y02082 22650002
         EJECT                                                          22700002
EIN22700 EQU   *                        TAPE TEST                       22750002
         TM    DCBDEVT,DCBDEVTP         DCB USING TAPE                  22760002
         BZ    EIN22800                 NO,BRANCH                       22800002
*                                                                       22850002
         CR    RET,R1                   ARE THEY THE SAME               22900002
         BE    EIN26550                 YES, BRANCH              Y02082 22950002
*                                                                       23000002
         L     R1,K0(K0,R1)             PICK UP THE NEXT IOB            23050002
         LA    R1,K0(K0,R1)             CLEAR THE HI ORDER BYTE         23100002
*                                                                       23150002
EIN22800 EQU   *                        UPDATE BDAM LOAD DCB            23200002
*                                                                       23250002
         TM    DCBCIND2,DCBC2QSM        DCB FOR QSAM                    23300002
         BO    EIN22900                 YES BRANCH                      23350002
*                                                                       23400002
         TM    DCBMACRF+K1,DCBMLOC      FOR LOADMODE WRITE              23450002
         BZ    EIN22900                 NO, BRANCH                      23500002
*                                                                       23550002
         TM    DCBRECFM,DCBRECTK        IS DATA SET TRK OVERFLO         23600002
         BZ    EIN22850                 IF NOT,DON'T UPDATE WCP         23650002
         SR    RF,RF                    CLEAR REG                       23700002
         IC    RF,DCBFDAD               INSERT NO. OF EXTENTS           23750002
         SLL   RF,K4                    MULTIPLY BY 16                  23800002
         AR    RF,RDEB                  ADD DEB ADDR TO OFFSET          23850002
         MVC   DCBWCPO(K2),K46(RF)      ST NO. TRKS IN NEW EXTENT       23900002
EIN22850 EQU   *                        SET FIRST ENTRY BIT             23950002
         L     RF,DCBWRITE              GET LOADMODE WRT RT ADDRESS     24000002
         LA    RF,K4(RF)                ADD 4 FOR EOV ENTRY             24050002
         MODESET EXTKEY=DATAMGT         EOV AREA                 Y02082 24100002
         MVI   EOVENT1,ALLBITS          SET 1ST ENTRY BIT        Y02082 24150002
         EJECT                                                          24200002
EIN22900 EQU   *                        SAVE REGS ACCROSS SYNCH/BALR    24300002
         MODESET EXTKEY=DATAMGT         EOV KEY                  Y02082 24350002
         STM   RDCB,R1,K0(RD)           SAVE 16 REGISTERS               24400002
*                                                                       24450002
         MODESET KEYADDR=EOVUKEY,WORKREG=7                       Y02082 24500002
         SR    R7,R7                                                    24550002
         IC    R7,DCBOFFSW              GET WRT CCW OFFSET              24600002
         MVC   DCBIOBA+K1(K3),K61(RD)   MOVE IOB FROM SAVE TO DCB       24650002
*                                       PROTECT INTEGRITY OF FLAG BYTE  24700002
*                                       THE SLOT FOR CURRENT IOB        24750002
         TM    DCBOPTCD,DCBOPTT         TEST FOR USER TOTALING          24800002
         BZ    EIN23000                 BR IF NOT SPECIFIED             24850002
*                                                                       24900002
         SR    R8,R8                    CLEAR THIS REG                  24950002
         SR    RC,RC                    CLEAR THIS REG                  25000002
         IC    R8,DEBNMEXT              GET NUMBER OF EXTENTS           25050002
         IC    RC,DEBEXSCL              GET SCALING FACTOR              25100002
         SLL   R8,K0(RC)                MULT TO GET DD SEC LEN          25150002
         L     RC,K36(RDEB,R8)          GET POINTER TO SAVE WA          25200002
         OI    K0(RC),LASTNTRY          SET SW IN SAVE AREATO           25300002
*                                       STOP SAVE OF IMAGE AREA         25350002
EIN23000 EQU   *                        SYMBOLIC ADDR                   25450002
*                                                                       25500002
*                                                                       25550002
*                                                                       25600002
         BAL   R5,EIN24820              GO TO SET UP FOR BR TO   M0135  25650002
*                                       WRT                      M0135  25700002
         TM    DCBMACRF+K1,DCBMLOC      IS THIS BDAM CREATE    SA53790  25750002
         BZ    EIN23050                 NO, BRANCH AROUND NEXT SA53790  25800002
         MODESET EXTKEY=DATAMGT         EOV WORK AREA            Y02082 25850002
         MVI   EOVENT1,K0               SET FIRST ENTRY SW OFF   Y02082 25900002
         MODESET KEYADDR=EOVUKEY,WORKREG=5 RET TO USER KEY       Y02082 25950002
         EJECT                                                          25960002
EIN23050 EQU   *                        MORE IOBS               SA53790 26000002
*                                                                       26050002
*  NOTE- IF USER TOTALING WAS SPECIFIED, THE COMMUNICATIONS BIT         26100002
*        IN TOTALING WORK AREA IS TURNED OFF BY IGG019AX                26150002
*                                                                       26200002
*                                                                       26250002
         CR    R1,RET                   ARE THERE MORE TO SCHEDULE      26300002
         BE    EIN26550                 NO, BRANCH               Y02082 26350002
         L     R1,0(R1)                 RE SCHEDULE NEXT IOB            26400002
         LA    R1,0(R1)                 CLEAR HI BYTE                   26450002
         B     EIN22900                 BRANCH TO PROCESS NEXT IOB      26500002
*                                                                       26550002
*********************************************************************** 26600002
*                                                                       26650002
*                                                                       26700002
*                                                                       26750002
*              READ  STATUS WHEN EOV OCCURED                            26800002
*                                                                       26850002
*                                                                       26900002
*                                                                       26950002
*********************************************************************** 27000002
*                                                                       27050002
EIN23100 EQU   *                        CHECK FOR DA                    27100002
*                                                                       27150002
         TM    DCBDEVT,DCBDEVDA         USING DIRECT ACCESS      A45048 27200002
*                                       DEVICE                   A45048 27250002
         BNO   EIN23700                 NO, BRANCH               A45048 27300002
*                                                                       27350002
*                                                                       27400002
EIN23200 EQU   *                        GET CCW OFFSET                  27450002
*                                                                       27500002
         TM    DEBOPATB,DEBOPUPD        UPDATE MODE SPECIFIED           27550002
         BNO   EIN23500                 NO, BRANCH                      27600002
         TM    DEBOPATB,ALLBITS-DEBOPUPD-ZONEOF  ONLY UPDATE SPECIFIED  27650002
         BNZ   EIN23500                 NO, BRANCH                      27700002
         SR    R8,R8                    CLEAR REG                       27750002
         IC    R8,DCBOFFSR              GET RD DATA CCW ADDRESS         27800002
         LR    RUCB,R1                  COPY IOB ADDRESS                27850002
*                                                                       27900002
EIN23300 EQU   *                        GET CCW ADDRESS                 27950002
         AR    R8,RUCB                  GET RD DATA CCW THIS IOB        28000002
         CLI   K8(R8),CCWRDSEC          IS RPS USED                     28050002
         BNE   EIN23400                 BRANCH IF NO                    28100002
         LA    R8,K8(R8)                INCR PAST RD SEC CCW            28150002
         EJECT                                                          28160002
EIN23400 EQU   *                        UPDATE FDAT                     28200002
         MVC   K8(K8,R8),DCBFDAD        UPDATE SPECIAL FDAD             28250002
         SR    R8,RUCB                  GET OFFSET IN RA TO CCW         28300002
         L     RUCB,0(RUCB)             LINK TO NEXT IOB                28350002
         LA    RUCB,0(RUCB)             HI BYTE CLEARED                 28400002
         CR    RUCB,R1                  HAVE ALL IOBS BEEN SET TO MBB   28450002
         BNE   EIN23300                 NO, BRANCH                      28500002
         NI    DCBCIND2,ALLBITS-DCBCNCLO TURN OFF BUFFERS FLUSHED IND.  28550002
EIN23500 EQU   *                        UPDATE IOBSEEK                  28700002
         MVC   K40(K8,R1),DCBFDAD       ESTABLISH NEW MBB---R IN IOB    28750002
         L     RUCB,0(R1)               GET NEXT IOB ADDRESS            28800002
EIN23600 EQU   *                        SEE IF MORE IOBS                28850002
         LA    RUCB,0(RUCB)             HI BYTE CLEARED                 28900002
         CR    RUCB,R1                  HAVE ALL IOBS BEEN SET TO MBB   28950002
         BE    EIN23700                 YES, BRANCH                     29000002
*                                                                       29050002
         MVC   K40(K8,RUCB),DCBFDAD     STORE PROPER MBB IN IOB         29100002
         L     RUCB,0(RUCB)             LINK TO NEXT IOB                29150002
         B     EIN23600                 BRANCH TO PROCESS NEXT IOB      29200002
*                                                                       29250002
EIN23700 EQU   *                        GET END OF BLOCK ADDR           29300002
*                                                                       29350002
         TM    DCBCIND2,DCBC2QSM        DCB USING QSAM                  29400002
         BO    EIN24300                 YES, BRANCH                     29450002
*                                                                       29500002
         TM    DCBCIND2,DCBC2FEO        ARE WE IN FEOV MODE             29550002
         BO    EIN26550                 YES, BRANCH              Y02082 29600002
*                                                                       29650002
         L     RF,DCBEOBR               GET READ EOB RT ADDDRESS        29700002
*                                                                       29750002
EIN24000 EQU   *                        SAVE REGS ACROSS SYNCH          29800002
         MODESET EXTKEY=DATAMGT         EOV WORK AREA            Y02082 29850002
         STM   RDCB,R1,0(RD)            SAVE 16 REGISTERS               29900002
         MODESET KEYADDR=EOVUKEY,WORKREG=7                       Y02082 29950002
         EJECT                                                          30000002
         TM    DCBCIND2,DCBC2FEO        WAS ENTRY CAUSED BY FEOV        30050002
         BZ    EIN24100                 NO,BRANCH.                      30100002
*                                                                       30150002
         TM    DCBMACRF,DCBMPMOV+DCBMSUB  YES, IS THIS LOCATE MODE      30200002
         BM    EIN24100                 IF NOT MOVE OR SUBSTITUTE MODE, 30250002
*                                         ASSUME LOCATE AND FALL THRU.  30300002
         CR    R1,RET                   IS THIS THE LAST IOB            30350002
         BE    EIN26550                 IF SO, DON'T SCHEDULE IT Y02082 30400002
*                                                                       30450002
EIN24100 EQU   *                        UPDATE DCBIOBA                  30500002
         SR    R7,R7                    CLEAR REG                       30550002
         IC    R7,DCBOFFSR              GET READ CCW OFFSET             30600002
*                                                                       30650002
         MVC   DCBIOBA+K1(K3),K61(RD)   MOVE IOB FROM SAVE TO DCB       30700002
*                                       TO  BE SCHEDULED IN SLOT FOR    30750002
*                                       CURRENT IOB                     30800002
         LA    R1,K0(,R1)               ZERO HIGH-ORDER BYTE OF IOB     30850002
         BAL   R5,EIN24820              GO TO SET UP FOR BR TO   M0135  30900002
*                                       EOBRD                    M0135  30950002
*                                                                       31000002
         CR    RET,R1                   ARE THERE MORE IOBS TO SCHEDULE 31050002
         BE    EIN26550                 NO, BRANCH               Y02082 31100002
EIN24200 EQU   *                        RESCHEDULE NEXT IOB             31150002
         L     R1,0(R1)                 GET NEXT IOB                    31200002
         LA    R1,0(R1)                 CLEAR HI BYTE                   31250002
         B     EIN24000                 RE SCHEDULE                     31400002
         EJECT                                                          31450002
EIN24300 EQU   *                        QSAM INPUT PROCESSING           31600002
         L     RF,DCBEOB                GET EOB RT ADDRESS              31750002
         TM    DCBCIND2,DCBC2FEO        ARE WE IN FEOV MODE             31800002
         BZ    EIN24000                 NO BRANCH                       31850002
         MVC   DCBRECAD(K4),DCBEOBAD    FORCE END OF BLOCK CONDITION    31900002
         TM    DCBMACRF,DCBMLOC         LOCATE MODE                     31950002
         BZ    EIN24200                 NO BRANCH                       32000002
EIN24400 EQU   *                        FEOV LOCATE MODE PROCESSING     32050002
         L     R1,0(R1)                 GET NEXT IOB                    32200002
         LA    R1,0(R1)                 CLEAR HI BYTE                   32250002
         CR    RET,R1                   ARE THERE MORE IOBS TO SCHEDULE 32300002
         BE    EIN26550                 NO, BRANCH               Y02082 32350002
         MODESET EXTKEY=DATAMGT         EOV EORK AREA            Y02082 32400002
         STM   RDCB,R1,0(RD)            SAVE 16 REGISTERS               32450002
         MODESET KEYADDR=EOVUKEY,WORKREG=5                       Y02082 32500002
         IC    R7,DCBOFFSR              GET READ CCW OFFSET             32550002
         BAL   R5,EIN24820              GO TO SET UP FOR BR TO   M0135  32600002
*                                       EOBWRT                   M0135  32650002
         B     EIN24400                 BRANCH TO DO NEXT IOB           32700002
         EJECT                                                          33050002
*********************************************************************** 33100002
*********************************************************************** 33150002
*                                                                       33200002
*        THE FOLLOWING ROUTINE DETERMINES IF A SYNCH OR BALR SHOULD BE  33250002
*        TAKEN TO THE EOB/WRITE ROUTINE AND TAKES IT.  THE DECISION IS  33300002
*        MADE ON THE BASIS OF THE CALLING RB. IF IT IS IN KEY 0-7,      33350002
*        BALR IS USED IN CALLER'S KEY. IF IT IS USER KEY,               33400002
*        KEY IS CHANGED TO THAT OF THE USER VIA A SYNCH MACRO.  BEFORE  33450002
*        THE SYNCH, A GETMAIN WAS ISSUED TO GET A SAVEAREA FOR THE I/O  33500002
*        ROUTINE IN SP 230.   ALL REGISTERS                             33550002
*        HAVE BEEN SAVED BEFORE BRANCHING TO THIS ROUTINE.  RETURN IS   33600002
*        MADE VIA REG 5.                                                33650002
*                                                                       33700002
*********************************************************************** 33750002
*********************************************************************** 33760002
EIN24820 EQU   *                        SAVE ROUTINE'S RETURN    M0135  33850002
         BAL   R6,EIN24840              BR TO GET SVRB PTR       M0135  33900002
         USING RBSECT,RET                                        M0135  33950002
         MODESET EXTKEY=DATAMGT         EOV WORK AREA            Y02082 34000002
         ST    R5,K12(RD)               ST RETURN ADDR IN EOV    M0135  34050002
*                                       SAVE                     M0135  34100002
         MODESET EXTKEY=SUPR            RB KEY                   Y02082 34150002
         ST    RD,RBEXSAVE+K4           SAVE R13 USER SAVEAREA   M0135  34200002
         L     R5,EOVDEBAD              GET DEB ADDR IN REG 5   YM0992  34450002
         L     RC,RBLINK                PTR TO PREVIOUS RB       M0135  34550002
         L     RD,EOVURGSV              USER REG SAVE AREA       Y02082 34550502
         MODESET KEYADDR=EOVUKEY,WORKREG=14 ASSUME USER KEY     YA02114 34560502
*        TURN OFF BUSY BIT SO DCB CAN BE CLOSED IF              YA02114 34562502
*        'SOMETHING' HAPPENS IN THE EXIT                        YA02114 34564502
         NI    DCBOFLGS,ALLBITS-DCBOBUSY TURN OFF BUSY BIT      YA02114 34570502
         CLI   RBOPSW+K1-RBSECT(RC),X80 IS PREVIOUS RB IN        Y02082 34600002
*                                       SYSTEM KEY               Y02082 34650002
         BNL   EIN24830                 NO, BRANCH TO SYNCH      Y02082 34700002
         LR    RBASE,R1                 PUT IOB ADDR IN REG 3    M0135  34750002
         BALR  RET,RF                   BR TO EOB IN SUPER STATE Y02082 34800002
         BALR  RET,0                    ESTABLISH ADDRESSABILITY Y02082 35100002
         USING *,RET                    BASE FOR 2 INSTRUCTIONS         35100402
EIN24825 LA    R6,EIN24870              RETURN ADDR FROM SVRB    Y02082 35100502
*                                       ROUTINE                  Y02082 35101002
         B     EIN24840                 RESTORE REGS             Y02082 35101502
         DROP  RET                                                      35151502
         USING RBSECT,RET                                        M0135  35153502
         EJECT                                                          35201502
EIN24830 EQU   *                        SYNCH INTO USER KEY      M0135  35600002
         LR    RBASE,R1                 PUT IOB IN R3 FOR BRANCH Y02082 35700002
         SYNCH  (15)                    GO TO EOV/WRITE ROUTINE  M0135  35800002
         BALR  R6,0                     PUT CURRENT ADDR IN R6   M0135  35850002
         USING *,R6                     BASE FOR NEXT INSTRUCTION       35860002
EIN24835 LA    R6,EIN24870              ESTABLISH BRANCHING      M0135  35900002
*                                       ADDR TO BE TAKEN WITH R6 FROM   35950002
*                                       SVRB SUBROUTINE                 36000002
         DROP  R6                                                       36050002
*********************************************************************** 36100002
*        THE FOLLOWING ROUTINE CHAINS DOWN THE CVT, TCB AND RB TO PICK  36150002
*        UP THE CURRENT SVRB, WHICH IS PASSED BACK TO THE MAIN ROUTINE  36200002
*        IN REG 14.  RETURN ADDRESS IN IN REG 6.                        36250002
*********************************************************************** 36300002
EIN24840 EQU   *                        GET SVRB ADDR IN RET     M0135  36400002
         L     RET,CVTPTR               PTR TO CVT               M0135  36450002
         L     RET,K0(K0,RET)           PTR TO TCB PTRS          M0135  36500002
         L     RET,K4(K0,RET)           PTR TO TCB               M0135  36550002
         L     RET,K0(K0,RET)           PTR TO SVRB              M0135  36600002
         BR    R6                       RETURN WITH SVRB IN R14  M0135  36650002
*********************************************************************** 36700002
EIN24870 EQU   *                        VERIFY DEB               M0135  36800002
         L     RD,RBEXSAVE+K4           LOAD R13 THAT WAS SAVED  M0135  36900002
         LM    RDCB,RA,0(RD)            RESTORE REGS FOR DEBCHK  Y01021 37050002
         OI    DCBOFLGS,DCBOBUSY        TURN BUSY BIT BACK ON   YA02114 37100002
         DEBCHK  (RDCB)                 VERIFY DEB               Y01021 37300002
         LR    RDEB,R1                  LOAD VERIFIED DEB        Y01021 37350002
         LM    RC,R1,K40(RD)            RESTORE OTHER REGS       Y01021 37400002
         MODESET EXTKEY=DATAMGT         EOV WORK AREA            Y02082 37450002
         ST    RDEB,EOVDEBAD            SAVE DEB                 Y02082 37500002
         MODESET KEYADDR=EOVUKEY,WORKREG=6 USER KEY              Y02082 37550002
         BR    R5                       RETURN TO MAIN ROUTINE   M0135  37650002
         DROP  RET                                               M0135  37700002
         EJECT                                                   Y02082 37850002
*        FOR DATA SETS PROCESSED USING CHAINED SCHEDULING,              42550002
*        THIS ROUTINE WILL HONOR ALL PREVIOUS REQUESTS THAT WERE        42600002
*        PURGED OR ANY PRIMING THAT MUST BE DONE.                       42650002
*                                                                       45500002
*        RESTORE CHAIN SCHEDULING IOBS                           Y02082 45550002
*                                                                       45600002
EIN25300 EQU   *                        GET MAIN IOB                    45650002
*                                                                       45660002
*        RC = IOB PTR                                            Y02082 45700002
*                                                                       45750002
         SR    RF,RF                                                    45800002
         L     R8,DCBIOBAD              GET MAINIOB                     45850002
         IC    RF,K3(R8)                GET OUTPUT NOP OFFSET           45900002
         TM    K0(R1),IOBWRITE          IS THIS OUTPUT                  45950002
         BO    EIN25400                 YES,  GO ON                     46000002
         IC    RF,K2(R8)                GET INPUT NOP OFFSET            46050002
         TM    K0(R1),IOBREAD           IS THIS INPUT           ZA00707 46100002
         BO    EIN25400                 YES, GO ON              ZA00707 46150002
         IC    RF,K3(R8)                GET OUTPUT NOP OFFSET   ZA00707 46160002
         TM    DCBOFLGS,DCBOWRIT        IS THIS OUTPUT          ZA00707 46170002
         BO    EIN25400                 YES, GO ON              ZA00707 46180002
         IC    RF,K2(R8)                GET INPUT NOP OFFSET    ZA00707 46190002
EIN25400 EQU   *                        COPY ICB ADDRESS                46200002
         TM    DCBCIND2,DCBC2FEO        IS THIS FEOV            ZA00020 46250002
         BZ    EIN25450                 NO, GO AROUND           ZA00020 46300002
         L     R1,K0(R1)                GET NEXT ICB ADDRESS    ZA00020 46310002
         LA    R1,K0(R1)                CLEAR HI ORDER BYTE     ZA00020 46320002
EIN25450 EQU   *                                                ZA00020 46330002
         LR    R7,R1                                                    46350002
*                                                                       46450002
*        FALL INTO LOOP TO CHANGE ALL NOPS TO TICS.                     46500002
*                                                                       46600002
EIN25500 EQU   *                        ZERO ECB FOR INPUT/NOT FEOV     46650002
         TM    DCBMACRF,DCBMLOC         LOCATE MODE            @ZA08004 46750037
         BZ    EIN25525                 NO BRANCH              @ZA08004 46760037
         CR    R7,RET                   ALL ICBS UPDATED       @ZA08004 46770037
         BNE   EIN25525                 NO,CONTINUE            @ZA08004 46780037
         TM    DCBCIND2,DCBC2FEO        IS THIS FEOV           @ZA08004 46780637
         BNO   EIN25525                 NO,  GO AROUND         @ZA08004 46781237
         TM    DCBDEVT,DCBDEVDA         DIRECT ACCESS DEVICE   @ZA08004 46782037
         BZ    EIN25650                 NO,BRANCH OUT OF LOOP  @ZA08004 46784037
         CLI   DCBIOBL,X'08'            ICB LENGTH >8 DW ?     @ZA15980 46784637
         BNH   EIN25650                 NO, GO UPDATE SECTOR   @ZA15980 46785237
         CLI   K8(RC),CCWRDSEC          RPS USED               @ZA08004 46786037
         BNE   EIN25650                 NO,BRANCH OUT OF LOOP  @ZA08004 46788037
EIN25525 LA    RC,0(RF,R7)              GET TO NOP CCW         @ZA08004 46790037
         TM    K0(R7),IOBWRITE          IS THIS OUTPUT                  46800002
         BO    EIN25600                 YES,BR TO GET NEXT ICB          46850002
         TM    K0(R7),IOBREAD           IS THIS INPUT           ZA00707 46860002
         BO    EIN25550                 YES, GO ON              ZA00707 46870002
         TM    DCBOFLGS,DCBOWRIT        IS THIS OUTPUT          ZA00707 46880002
         BO    EIN25600                 YES, BR TO GET NEXT ICB ZA00707 46890002
EIN25550 EQU   *                                                ZA00707 46892002
         TM    DCBCIND2,DCBC2FEO        IS THIS FEOV                    46900002
         BNO   EIN25600                 NO,  GO AROUND                  46950002
         MVC   DCBRECAD(K4),DCBEOBAD    FORCE EOB CONDITION    @ZA08004 47000037
         L     RWTG,K12(R7)             GET ECB POINTER                 47050002
         MVI   K0(RWTG),K0              ZERO ECB                        47100002
EIN25600 EQU   *                        SEE IF ALL ICBS SCHEDULED       47150002
         MVI   K0(RC),CCWTIC            STORE TIC                       47200002
         L     RWTG,K0(R7)              GET TO NEXT ICB                 47300002
         MVC   K1(K3,RC),K25(RWTG)      STORE NEXT ICBS CP ADDRESS      47350002
         CR    R7,RET                   HAVE ALL ICBS BEEN UPDATED      47500002
         BE    EIN25650                 YES,BRANCH OUT OF LOOP          47550002
         L     R7,K0(R7)                LINK TO NEXT ICB TO UPDATE      47700002
         LA    R7,K0(R7)                CLEAR HI BYTE                   47750002
         B     EIN25500                 BR TO PROCESS ICB               47850002
         EJECT                                                          47900002
EIN25650 EQU   *                        UPDATE READ SECTOR FOR RPS      47950002
         TM    DCBDEVT,DCBDEVDA         DIRECT ACCESS DEVICE    OZ04912 47960037
         BZ    EIN25700                 NO, BRANCH              OZ04912 47970037
         CLI   DCBIOBL,X'08'            ICB LENGTH >8 ?        @ZA15980 47980037
         BNH   EIN25700                 NO, GO STORE NOP       @ZA15980 47990037
         CLI   K8(RC),CCWRDSEC          RPS USED                OY00283 48000002
         BNE   EIN25700                 BRANCH NO                       48050002
         LA    RPARC,K8(RC)             RD SECTOR ADDR          OY00283 48100002
         ST    RPARC,K0(RC)             IN CHP                  OY00283 48150002
         MVI   K0(RC),CCWNOTIC          PUT IN NOPTIC CMND      OY00283 48200002
         B     EIN25750                 AROUND NEXT                     48250002
*                                                                       48300002
EIN25700 EQU   *                        STORE NOP IN LAST ICB           48350002
*                                                                       48400002
         MVI   K0(RC),CCWNOP                                            48450002
EIN25750 EQU   *                        UPDATE MAIN IOB LAST NOP PTR    48500002
*                                                                       48550002
         ST    RC,K12(R8)               STORE LAST NOP PTR IN MAINIOB   48600002
         MVI   K12(R8),IOBCEXCP         INDICATE EXCP NEEDED     YM6583 48610002
*                                                                       48650002
         LR    R7,RET                   COPY FIRST ICB TO LOOP ON       48700002
*                                                                       48750002
         TM    DCBDEVT,DCBDEVDA         DIRECT ACCESS DEVICE USED       48800002
         BZ    EIN26000                 NO BRANCH                       48850002
*                                                                       48950002
EIN25800 EQU   *                        UPDATE MAIN IOBSEEK             49000002
         MVC   K48(K8,R8),DCBFDAD       UPDATE MAIN IOB                 49050002
EIN25900 EQU   *                        UPDATE ICBSEEKS                 49100002
*                                                                       49150002
         MVC   K32(K8,R7),DCBFDAD       UPDATE MBBCCHHR IN ICB @ZA01346 49200037
         L     R7,K0(R7)                GET NEXT ICB                    49250002
         LA    R7,K0(R7)                CLEAR HI BYTE                   49300002
         CR    R7,RET                   HAVE ALL ICB BEEN UPDATED       49350002
         BNE   EIN25900                 NO BRANCH                       49400002
*                                                                       49450002
EIN26000 EQU   *                        SET TAPE OUTPUT NOP             49500002
*                                                                       49550002
         TM    K0(R1),IOBREAD           DCB IN READ STATUS      ZA00707 49600002
         BO    EIN26200                 YES,BRANCH              ZA00707 49650002
         TM    K0(R1),IOBWRITE          DCB IN WRITE STATUS     ZA00707 49660002
         BO    EIN26050                 YES, BRANCH             ZA00707 49670002
         TM    DCBOFLGS,DCBOWRIT        DCB IN OUTPUT STATUS    ZA00707 49680002
         BZ    EIN26200                 NO, BRANCH              ZA00707 49690002
EIN26050 EQU   *                                                ZA00707 49692002
*                                                                       49700002
         TM    DCBDEVT,DCBDEVTP         DCB USING TAPE                  49750002
         BZ    EIN26100                 NO BRANCH                       49800002
*                                                                       49850002
*                                                                       49900002
*                                                                       49950002
*                                                                       50000002
         MVI   K40(R1),CCWNOP           ERROR ICB WROTE OVER TAPE IND   50050002
         TM    DCBCIND2,DCBC2FEO        ARE WE IN FEOV          ZA00020 50060002
         BO    EIN26500                 YES, DON'T SCHEDULE     ZA00020 50070002
         CR    R1,RET                   WAS THIS ONLY REQUEST ON Q      50100002
*                                                                       50150002
         BE    EIN26500                 YES  BRANCH                     50200002
         L     R1,K0(R1)                GET NEXT ICB                    50250002
         B     EIN26200                 START UP THE MAIN IOB           50300002
         EJECT                                                          50350002
EIN26100 EQU   *                        GET END OF BLOCK ADDR           50500002
*                                                                       50550002
         TM    DCBDEVT,DCBDEVDA         DCB USING DISK OR DRUM          50600002
         BZ    EIN26200                 NO BRANCH                       50650002
*                                                                       50700002
         TM    DCBCIND2,DCBC2FEO        ARE WE IN FEOV                  50750002
         BO    EIN26500                 YES,  DON'T SCHEDULE            50800002
*                                                                       50850002
         L     RF,DCBEOBW               GET BSAM EOB RT ADDRESS@ZA14615 50900037
         TM    DCBCIND2,DCBC2QSM        QSAM BEING USED        @ZA14615 50950037
         BZ    EIN26800                 NO, BRANCH             @ZA14615 51000037
*                                                                       51050037
         L     RF,DCBEOB                GET QSAM EOB RT ADDRESS@ZA14615 51100037
         B     EIN26800                 GO BACK TO COMMON CODE          51150002
*                                                                       51200002
*                                                                       51250002
EIN26200 EQU   *                        UPDATE FIRST ICB ADDR           51300002
*                                                                       51350002
         L     R0,K24(R1)               GET C P STARTAD                 51400002
         ST    R1,K8(R8)                STORE 1ST ICB PTR IN MAINIOB    51450002
         L     R1,K12(R1)               GET ECB PTR                     51500002
         MVI   K0(R1),K0                SET ECB TO ZERO                 51550002
*                                                                       51600002
         TM    DCBDEVT,DCBDEVDA         DCB USING DISK OR DRUM          51650002
         BZ    EIN26300                 NO BRANCH                       51700002
         CLI   K56(R8),CCWSTSEC         IS RPS USED              M0919  51750002
         BNE   EIN26250                 BRANCH NO                       51800002
         ST    R0,K80(R8)               PUT IN TIC ADDR                 51850002
         MVI   K80(R8),CCWTIC           RESTORE TIC CMND                51900002
         B     EIN26400                 GO DO IT                        51950002
EIN26250 EQU   *                        FIRST ICB ADDR-NOT RPS          52000002
         ST    R0,K72(R8)               STORE FIRST ICB CP IN TIC       52050002
         MVI   K72(R8),CCWTIC           RESTORE TIC OP CODE             52100002
         B     EIN26400                 BR TO ISSUE SVC EXCP            52150002
*                                                                       52200002
*                                                                       52250002
EIN26300 EQU   *                        FIRST ICB ADDR-NOT DA           52300002
*                                                                       52350002
         ST    R0,K32(R8)               STORE FIRST ICBS CP IN MAIN IOB 52400002
         EJECT                                                          52450002
EIN26400 EQU   *                        EXCP IF NOT BSAM FEOV           52550002
*                                                                       52600002
         TM    DCBCIND2,DCBC2FEO        ARE WE IN FEOV           A44081 52650002
         BNO   EIN26450                 NO, CONTINUE             A44081 52700002
         TM    DCBCIND2,DCBC2QSM        QSAM BEING USED          A44081 52750002
         BNO   EIN26500                 NO, SKIP EXCP            A44081 52800002
EIN26450 EQU   *                        EXCP MAIN IOB                   52850002
         MVI   K12(R8),K0               RESET EXCP NEEDED BIT    YM6583 52860002
         LA    R8,K16(R8)               GET IOS IOB                     52900002
         EXCP  (R8)                     START UP THE MAIN IOB           52950002
         B     EIN26550                 BR TO FREECORE                  53000002
*                                                                       53050002
*                                                                       53100002
EIN26500 EQU   *                        POST ECB                        53150002
         MVI   K4(R8),ECBCOD7F          POST ECB COMPLETE               53200002
         B     EIN26550                 BR TO FREE WKAREA        M0135  53250002
         SPACE 2                                                 Y02082 53300002
***                                                              Y02082 53350002
*        CLEAR IOB FIELD, FREE WKAREA AND EXIT                   Y02082 53400002
***                                                              Y02082 53450002
EIN26520 EQU   *                        SPANNED UPDATE INDICATOR M0135  53500002
         XC    DCBIOBAD,DCBIOBAD        CLEAR IOB FIELD          M0135  53550002
         OI    DCBIOBAD+K3,K1           TURN ON NO UPDATE BIT    M0135  53600002
         EJECT                                                   Y02082 53650002
***                                                              Y02082 53700002
*        FREE WKAREA AND EXIT                                    Y02082 53750002
***                                                              Y02082 53800002
EIN26550 EQU   *                        SWAP USER/SVRB REGS IF NOT FEOV 53850002
*                                                                       54750002
         TM    DCBCIND2,DCBC2FEO        TEST FOR FEOV MODE              54800002
         BO    EIN26600                 YES BRANCH                      54850002
         BAL   R6,EIN27400              GO GET SVRB PTR          M0135  54900002
         L     RD,K84(RET)              GET USER SAVE AREA              54950002
         LR    R1,RCORE                 ADDR EOV SPEC AREA       Y02082 55000002
         LM    RCORE,RC,K32(RET)        GET USER REGISTERS              55050002
         MODESET EXTKEY=SUPR            RB KEY                   Y02082 55100002
         MVC   K32(K36,RET),K28(RD)     REST CALLER REGS 0-8     Y02082 55150002
         MODESET KEYADDR=EOVUKEY-EOVLAST(R1),WORKREG=15          Y02082*55200002
                                        USER KEY                 Y02082 55250002
         STM   RCORE,RC,K28(RD)         STORE USERS REGISTERS IN SAVE A 55300002
         LR    RCORE,R1                 RESTORE EOV WORK AREA    Y02082 55350002
EIN26600 EQU   *                        RESET FEOV/BUSY BITS            55400002
         NI    DCBCIND2,ALLBITS-DCBC2FEO  TURN OFF FEOV FLAGS           55450002
         TM    DCBCIND2,DCBC2PUT        EOV ENTERED FROM                55500002
*                                       CLOSE                           55550002
         BO    EIN26700                 YES,  BR                        55600002
*                                                                       55650002
         NI    DCBOFLGS,ALLBITS-DCBOBUSY  RESET I/O SUPPORT BIT         55700002
         EJECT                                                          55710002
EIN26700 EQU   *                        EXIT                     Y02080 55750002
         L     R1,EOVURGSV              ADDR USER REG SAVE AREA  Y02082 55800002
         FREEMAIN R,LV=72,A=(1),SP=230 FREE USER REG SAVE AREA   Y02082 55850002
         MODESET EXTKEY=DATAMGT         KEY OF EOV EORK AREA     Y02082 55900002
         FREEMAIN R,LV=92,A=(RCORE),SP=230 FREE EOV SPEC W/A     Y02082 55950002
         LR    R1,RDCB                  GET DCB ADDRESS                 56000002
         SR    RF,RF                    INDICATE NO PERM ERRORS         56050002
*                                                                Y02080 56100002
*        RETURN TO CALLER                                        Y02080 56150002
*                                                                Y02080 56200002
         IECRES EXIT                    RETURN                   Y02080 56250002
         EJECT                                                   Y02082 56450002
EIN26800 EQU   *                        GO TO EOB ROUTINE               56500002
*********************************************************************** 56502002
*********************************************************************** 56504002
*                                                                       56506002
*        THE FOLLOWING ROUTINE DETERMINES IF A SYNCH OR BALR SHOULD BE  56508002
*        TAKEN TO THE EOB/WRITE ROUTINE AND TAKES IT.  THE DECISION IS  56510002
*        MADE ON THE BASIS OF THE CALLING RB. IF IT IS KEY 0-7,         56512002
*        BALR IS USED IN CALLER'S KEY. IF IT IS USER KEY,               56514002
*        KEY IS CHANGED TO THAT OF THE USER VIA A SYNCH MACRO.  BEFORE  56516002
*        THE SYNCH, A GETMAIN WAS ISSUED TO GET A SAVEAREA FOR THE I/O  56518002
*        ROUTINE IN SP 230.   ALL REGISTERS                             56520002
*        HAVE BEEN SAVED BEFORE COMING TO THIS ROUTINE                  56522002
*                                                                       56524002
*********************************************************************** 56524402
*********************************************************************** 56526002
         SPACE                                                          56528002
         MODESET EXTKEY=DATAMGT         EOV WORK AREA            Y02082 56550002
         STM   RDCB,R1,K0(RD)           SAVE 16 REGISTERS               56600002
         MODESET KEYADDR=EOVUKEY,WORKREG=7 USER KEY              Y02082 56650002
*                                                                       56700002
         SR    R7,R7                    CLEAR REG                       56750002
         IC    R7,DCBOFFSW              GET WRT CCW OFFSET              56800002
         MVC   DCBIOBA+K1(K3),K61(RD)   MOVE IOB FROM SAVE AREA         56850002
*                    TO DCB PROTECT INTEGRITY OF FLAG BYTE              56900002
*                                       THE SLOT FOR CURRENT IOB        56950002
         TM    DCBOPTCD,DCBOPTT         TEST FOR USER TOTALING          57000002
         BZ    EIN27000                 BR IF NOT SPECIFIED             57050002
*                                                                       57100002
         SR    RWTG,RWTG                CLEAR THIS REG                  57150002
         SR    RC,RC                    CLEAR THIS REG                  57200002
         IC    RWTG,DEBNMEXT            GET NUMBER OF EXTENTS           57250002
         IC    RC,DEBEXSCL              GET SCALING FACTOR              57300002
         SLL   RWTG,K0(RC)              MULT TO GET DD SEC LEN          57350002
         L     RC,K36(RDEB,RWTG)        GET POINTER TO SAVE WA          57400002
         OI    K0(RC),LASTNTRY          SET SW IN SAVE AREATO           57500002
*                                       STOP SAVE OF IMAGE AREA         57550002
         EJECT                                                          57552002
EIN27000 EQU   *                        ISSUE SYNCH OR BALR      M0135  58350002
         BAL   R6,EIN27400              BR TO GET SVRB PTR       M0135  58400002
         USING RBSECT,RET                                        M0135  58450002
         MODESET EXTKEY=SUPR            RB KEY                   Y02082 58500002
         ST    RD,RBEXSAVE              ST SAVEAREA PTR IN SVRB  M0135  58550002
         L     RC,RBLINK                PTR TO PREVIOUS RB       M0135  58600002
         L     RD,EOVURGSV              PUT SAVEAREA PTR IN R13  Y02082 58600502
         MODESET KEYADDR=EOVUKEY,WORKREG=14 USER KEY            YA02114 58610502
*        TURN OFF BUSY BIT SO DCB CAN BE CLOSED IF              YA02114 58620502
*        'SOMETHING' HAPPENS IN THE EXIT                        YA02114 58630502
         NI    DCBOFLGS,ALLBITS-DCBOBUSY TURN OFF BUSY BIT      YA02114 58640502
         CLI   RBOPSW+K1-RBSECT(RC),X80 IS PREVIOUS RB IN        Y02082 58650002
*                                       SYSTEM KEY               Y02082 58700002
         BNL   EIN27100                 NO, BRANCH TO SYNCH      Y02082 58750002
         LR    RBASE,R1                 PUT IOB ADDR IN REG 3    M0135  58800002
         BALR  RET,RF                   NO, BR TO EOB IN SUPER   M0135  58850002
*                                       STATE                    M0135  58900002
         BALR  RET,0                    ESTABLISH ADDRESSABILITY Y02082 58950002
         USING *,RET                    BASE REG FOR NEXT 2             58950402
*                                       INSTRUCTIONS                    58950702
EIN27050 LA    R6,EIN27220              RETURN ADDR FROM SVRB    Y02082 58951202
*                                       ROUTINE                  Y02082 58951802
         B     EIN27400                 BRANCH TO RESTORE REGS   Y02082 58952002
         DROP  RET                                                      59050002
         USING RBSECT,RET                                        M0135  59052002
EIN27100 EQU   *                        SYNCH                    M0135  59100002
         LR    RBASE,R1                 PUT IOB ADDR IN R3 FOR   M0135  59150002
*                                       BRANCH                   M0135  59200002
         SYNCH  (15)                    GO TO EOB ROUTINE        M0135  59300002
         BALR  R6,0                     PUT CURRENT ADDR IN R6   M0135  59350002
         USING *,R6                     BASE FOR LA                     59352002
         LA    R6,EIN27220              SET UP R6 TO BR OUT OF   M0135  59400002
*                                       SVRB SUBROUTINE                 59450002
         DROP  R6                                                       59500002
         EJECT                                                          59502002
*********************************************************************** 59550002
*        THE FOLLOWING ROUTINE CHAINS DOWN THE CVT, TCB AND RB TO PICK  59600002
*        UP THE CURRENT SVRB, WHICH IS PASSED BACK TO THE MAIN ROUTINE  59650002
*        IN REG 14.  RETURN ADDRESS IN IN REG 6.                        59700002
*********************************************************************** 59750002
EIN27400 EQU   *                        GET SVRB IN RET          M0135  59850002
         L     RET,CVTPTR               PTR TO CVT               M0135  59900002
         L     RET,K0(K0,RET)           PTR TO TCB PTRS          M0135  59950002
         L     RET,K4(K0,RET)           PTR TO TCB               M0135  60000002
         L     RET,K0(K0,RET)           PTR TO SVRB              M0135  60050002
         BR    R6                       RETURN WITH SVRB IN R14  M0135  60100002
EIN27220 EQU   *                        RESTORE REG 13           M0135  60300002
         L     RD,RBEXSAVE              LOAD R13 THAT WAS SAVED  M0135  60400002
         DROP  RET                                               M0135  60450002
*                                                                       60650002
*  NOTE - IF TOTALING WAS SPECIFIED, THE COMMUNICAT&ONS BIT             60700002
*        IN TOTALING WORK AREA IS TURNED OFF BY IGG019AX                60750002
*                                                                       60850002
EIN27300 EQU   *                        VERIFY DEB               M0135  60900002
         LM    RDCB,RA,0(RD)            RESTORE REGS FOR DEBCHK  Y01021 61150002
         OI    DCBOFLGS,DCBOBUSY        TURN BUSY BIT BACK ON   YA02114 61160002
         DEBCHK (RDCB)                  VERIFY DEB               Y01021 61200002
         LR    RDEB,R1                  LOAD VERIFIED DEB        Y01021 61250002
         LM    RC,R1,K40(RD)            RESTORE OTHER REGS       Y01021 61300002
         MODESET EXTKEY=DATAMGT         EOV WORK AREA            Y02082 61350002
         ST    RDEB,EOVDEBAD            STORE VERIFIED DEB ADDR  Y02082 61400002
         MODESET KEYADDR=EOVUKEY,WORKREG=6 RET USER KEY          Y02082 61450002
         CR    R1,RET                   ARE THERE MORE TO SCHEDULE      61550002
         BE    EIN26550                 NO BRANCH                       61600002
         L     R1,0(R1)                 RE SCHEDULE NEXT IOB            61650002
         LA    R1,0(R1)                 CLEAR HI BYTE                   61700002
         B     EIN26800                 BR TO PROCESS NEXT IOB          61750002
         EJECT                                                          62200002
*        EQUATED NAMES                                           YM6583 62202002
IOBCEXCP EQU   X'80'                    INDICATES EXCP NEEDED    YM6583 62210002
CCWNOTIC EQU   X'88'                    INDICATES NOP/TIC COMM   YM6583 62220002
*        NOTE - IFG0558X MUST BE LINK EDITED WITH IFG0551L      Z30JSFC 62230003
XCTLTA1B XCTLTABL ID=(,IFG0558X),SVC=055,BRT=YES,LENGTH=        Z30JSFC 62250003
         EJECT                                                          62300002
         IECDSECS  CVT,RB,DCB,UCB,DEB,MAIN,TIOT,TCB,WTG,PREFX,   Y02080*62350002
               USERTOT,EOVLAST,                                  Y02082*62400002
               EXPAND=YES                                        Y02080 62450002
         IECEQU                                                         62500002
         END                                                            62550002
