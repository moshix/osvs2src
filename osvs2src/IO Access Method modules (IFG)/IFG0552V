         TITLE 'IFG0552V - EOV TAPE INPUT VOLUME POSITIONING FUNCTION'  00010002
         COPY  LCGASMSW                                                 00050000
IFG0552V CSECT                                                          00400021
*********************************************************************** 00450002
*          VS2 RELEASE 03 DELETIONS                                   * 00500037
*0000                                                          ZA09140* 00550037
*          VS2 RELEASE 02 DELETIONS                                   * 00600002
*                                                                     * 00650002
*                                                                     * 00700002
*********************************************************************** 00750002
*                                                                     * 00800002
* MODULE NAME = IFG0552V (OS/VS2)                                     * 00850002
*                                                                     * 00900002
* DESCRIPTIVE NAME = INPUT TAPE - VOLUME POSITIONING FUNCTION         * 00950002
*                                                                     * 01000002
* COPYRIGHT = NONE                                                    * 01050002
*                                                                     * 01100002
* STATUS = RELEASE 2, LEVEL 0                                         * 01150002
*                                                                     * 01200002
* FUNCTION =                                                          * 01250002
*        1) IF THE DCB CONTAINS A TAPE DEVICE DEPENDENT SECTION,      * 01300002
*        THE BLOCK COUNT IS ZEROED.                                   * 01350002
*        2) THE VOLUME SEQUENCE COUNT IN THE DEB IS INCREMENTED       * 01400002
*        (READ FORWARD) OR DECREMENTED (READ BACKWARD) BY ONE.        * 01450002
*        3) FOR READ BACKWARD, IF THE NEXT VOLUME IS THE LAST ONE,    * 01500002
*        (IE. FIRST PHYSICAL VOLUME OF THE DATA SET), THE FILE        * 01550002
*        SEQUENCE NUMBER SAVED IN THE WORK AREA IS SET EQUAL TO       * 01600002
*        THE FILE SEQUENCE COUNT.                                     * 01650002
*        4) IF ONLY ONE UNIT IS ALLOCATED TO THE DATA SET, GO         * 01700002
*        TO (7) BELOW.                                                * 01750002
*        5) THE TAPE IS POSITIONED ACCORDING TO OPTIONS SELECTED      * 01800002
*        BY FEOV, OPEN, OR DISP PARAMETER IN DD CARD IN THAT          * 01850002
*        ORDER OF PRECEDENCE.                                         * 01900002
*        6) THIS FUNCTION PERFORMS ALL VOLUME POSITIONING FOR DATA    * 01950002
*        SETS AT EOV OR EOF (WHEN CONCATENATION IS TAKING PLACE) ON   * 02000002
*        AL, NL, AND SL TAPES; NSL VOLUMES CAN ONLY BE UNLOADED.      * 02050002
*        THE FOLLOWING TERMINOLOGY APPLIES:                           * 02100002
*             LOGICAL END OF DATA SET-                                * 02150002
*             FOR READ FORWARD- THE INTERBLOCK GAP FOLLOWING          * 02200002
*             EITHER THE TAPE MARK FOLLOWING THE DATA (NL) OR         * 02250002
*             THE TAPE MARK FOLLOWING THE DATA SET TRAILER LABELS     * 02300002
*             (AL AND SL).                                            * 02350002
*             FOR READBACK- THE INTERBLOCK GAP PRECEDING EITHER       * 02400002
*             THE FIRST DATA RECORD (NL) OR HEADER LABEL 1 (AL,SL).   * 02450002
*             LOGICAL BEGINNING OF DATA SET-                          * 02500002
*             FOR READ FORWARD- SAME AS FOR READBACK ABOVE.           * 02550002
*             FOR READBACK- SAME AS READ FORWARD ABOVE.               * 02600002
*        6A) POSITION ACCORDING TO ANY FEOV OPTIONS:                  * 02650002
*           REWIND- REWIND THE TAPE.                                  * 02700002
*           LEAVE- POSITION THE TAPE TO THE LOGICAL END OF            * 02750002
*           THE DATA SET.                                             * 02800002
*        6B) POSITION ACCORDING TO ANY POSITIONING OPTION SPECIFIED   * 02850002
*           IN THE OPEN MACRO:                                        * 02900002
*           REREAD- POSITION TAPE TO LOGICAL BEGINNING OF DATA SET    * 02950002
*           LEAVE- POSITION TAPE TO LOGICAL END OF DATA SET.          * 03000002
*           DISP- REFER TO 6C) BELOW.                                 * 03050002
*        6C) IF THERE ARE NONE OF THE ABOVE OPTIONS OR IF THE OPEN    * 03100002
*        POSITIONING OPTION IS DISP, POSITIONING TAKES PLACE          * 03150002
*        AS FOLLOWS:                                                  * 03200002
*           PASSED DATA SET- POSITION TO LOGICAL END OF D.S.          * 03250002
*           NOT PASS, PUBLIC VOL- REWIND THE TAPE                     * 03300002
*           NOT PASS, PRIVATE VOL- UNLOAD THE TAPE                    * 03350002
*        7) INCREMENT THE UCB FILE SEQUENCE COUNT AND NUMBER BY       * 03400002
*        ONE EACH WHEN THE TAPE IS POSITIONED TO THE PHYSICAL END OF  * 03450002
*        THE DATA SET, AND ZERO THE DATA MANAGEMENT COUNT IN THE UCB. * 03500002
*        8) IF THERE ARE CONCATENATED DATA SETS, FORWARD CHAIN TO THE * 03550002
*        NEXT DSAB AND UPDATE THE WORKAREA POINTERS REFLECTING THE    * 03600002
*        NEW DSAB AND TIOT ENTRY, UPDATE THE DCB,DEB, UCB,AND DSABS   * 03650002
*        (DECREMENT OPEN COUNT IN OLD DSAB, INCREMENT IN NEW DSAB) AND* 03700002
*        DEB EXTENSION.                                               * 03750002
*        9) TRANSFER CONTROL TO THE EOV INITIAL FUNCTION TO CONTINUE  * 03800002
*        CONCATENATION (IFG0551F).                                    * 03850002
*        10) FOR NON-CONCATENATED DATA SETS, UPDATE THE VOLUME        * 03900002
*        SEQUENCE NUMBER IN THE WORK AREA AND TRANSFER CONTROL        * 03950002
*        TO IFG0554A TO PERFORM MOUNT/VERIFY FUNCTION FOR NEXT        * 04000002
*        VOLUME. SET UP FOR RETURN TO IFG0553F.                       * 04050002
*                                                                     * 04100002
* NOTES = SEE BELOW                                                   * 04150002
*                                                                     * 04200002
*    DEPENDENCIES =                                                   * 04250002
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 04300002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 04350002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 04400002
*                                                                     * 04450002
*    RESTRICTIONS = NONE                                              * 04500002
*                                                                     * 04550002
*    REGISTER CONVENTIONS =                                           * 04600002
*            R2 POINTS TO DCB                                         * 04650002
*            R4 POINTS TO OPEN WORK AREA                              * 04700002
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 04750002
*            R6 POINTS TO THE WTG TABLE                               * 04800002
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 04850002
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 04900002
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 04950002
*            R10 POINTS TO THE UCB                                    * 05000002
*                                                                     * 05050002
*    PATCH LABEL = SEE THIRD FROM LAST LABEL BEFORE ORG STATEMENT AT  * 05100002
*                  END OF LISTING.                                    * 05150002
*                                                                     * 05200002
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 05250002
*                                                                     * 05300002
*    PROCESSOR = ASSEMBLER XF                                         * 05350002
*                                                                     * 05400002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 05450002
*                  ORG STATEMENT AT END OF LISTING                    * 05500002
*                                                                     * 05550002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 05600002
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 05650002
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 05700002
*                                                                     * 05750002
* ENTRY POINT =                                                       * 05800002
*        IFG0552V                                                     * 05850002
*                                                                     * 05900002
*    PURPOSE = SEE FUNCTION                                           * 05950002
*                                                                     * 06000002
*    LINKAGE =                                                        * 06050002
*        THIS MODULE IS TRANSFERRED CONTROL THROUGH THE IECRES-LOAD   * 06100002
*        MACRO INSTRUCTION.                                           * 06150002
*                                                                     * 06200002
* INPUT =                                                             * 06250002
*        GIVEN CONTROL IN PROTECT KEY 5.                              * 06300002
*        REGISTER 2 POINTS TO THE COPIED DCB.                         * 06350002
*        DEBDCBAD POINTS TO THE COPIED DCB.                           * 06400002
*        REGISTER 4 POINTS TO THE EOV WORKAREA                        * 06450002
*                                                                     * 06500002
* OUTPUT =                                                            * 06550002
*        THE NEXT MODULE IS GIVEN CONTROL IN PROTECT KEY 5 WITH       * 06600002
*        REGISTER 2 POINTING TO THE COPIED DCB,                       * 06650002
*        DEBDCBAD POINTING TO THE COPIED DCB,                         * 06660002
*        AND REGISTER 4 POINTING TO THE EOV WORKAREA,                 * 06670002
*                                                                     * 06680002
* EXIT-NORMAL =                                                       * 06690002
*        IFG0551F - LIKE ATTRIBUTE CONCATENATION                      * 06692002
*        IFG0554A - MOUNT/VERIFY FUNCTION                             * 06694002
*           RETURN MODULE - IFG0553F                                  * 06696002
*                                                                     * 06698002
* EXIT-ERROR =                                                        * 06698402
*        IFG0550P - PROBLEM DETERMINATION                             * 06698802
*             INTERNAL CODE = 151, POSITIONING ERROR FOR LEAVE        * 06699202
*             INTERNAL CODE = 152, POSITIONING ERROR FOR REREAD       * 06699602
*             INTERNAL CODE = 153, POSITIONING ERROR FOR PASS         * 06699702
*             INTERNAL CODE = 155, POSITIONING ERROR FOR REWIND       * 06699802
*                                                                     * 06699902
* EXTERNAL REFERENCES = SEE BELOW                                     * 06733202
*                                                                     * 06743202
*    ROUTINES =                                                       * 06753202
*        IFG019RA THROUGH THE IECRES MACRO.                           * 06763202
*                                                                     * 06765202
*    DATA AREAS =                                                     * 06765602
*        EOV WORKAREA.                                                * 06766002
*                                                                     * 06766402
*    CONTROL BLOCK =                                                  * 06766502
*        DSAB                                                         * 06766602
*        DEB                                                          * 06777702
*        JFCB                                                         * 06787702
*        TCB                                                          * 06788102
*        UCB                                                          * 06788502
*        TIOT                                                         * 06788602
*                                                                     * 06788702
* TABLES =                                                            * 06788802
*                                                                     * 06792502
* MACROS =                                                            * 06794502
*        IECRES LOAD                                                  * 06794902
*        DMABCOND                                                     * 06795302
*                                                                     * 06795702
* CHANGE ACTIVITY =                                                   * 06796102
*        SEE CHANGES/DELETIONS SECTION JUST AFTER CSECT CARD.         * 06796202
*                                                                     * 06822102
*********************************************************************** 06832102
         EJECT                                                          06842102
*                                                                       06848202
*****    INTERNAL ERROR CODES                                           06874102
*                                                                       06900021
EABD151  EQU   151                      ERROR POSITIONING FOR LEAVE     07000021
EABD152  EQU   152                      ERROR POSITIONING FOR REREAD    07100021
EABD153  EQU   153                      ERROR POSITIONING FOR 'PASS'    07200021
EABD155  EQU   155                      ERROR REWINDING FOR COBOL       07400021
*                                       ..REWIND OR 'DELETE'            07500021
*                                                                       07600021
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        07700021
         USING *,RBASE                                                  07800021
         USING FORCORE,RCORE                                            07900021
         USING IHADCB,RDCB                                              08000021
         USING UCB,RUCB                                                 08100021
         USING TIOENTRY,RTIOT                                           08200021
         USING DEB,RDEB                                                 08300021
         USING WTG,RWTG                                                 08400021
*                                                                       08500021
         B     ETI08000(RET)            DETERMINE WHERE TO CONT PROCESS 08600021
ETI08000 EQU   *                        BRANCH TABLE                    08700002
         B     ETI08100                 BR IF NORMAL ENTRY (0)          08800002
         B     ETI08100                 BR IF RETURN FROM SMF (4)       08900002
         EJECT                                                          09000021
*                                                                       16200021
*********************************************************************** 16300021
*              COMPLETE PROCESSING ON CURRENT VOLUME                  * 16400021
*********************************************************************** 16500021
*                                                                       16600021
ETI08100 EQU   *                        CURRENT VOLUME PROC             16650002
         L     RUCB,DXUCBADR            LOAD UCB ADDRESS         Y02134 16700002
         TM    DCBMACRF,DCBMEXCP        IS THE ACCESS METHOD EXCP-      16800021
         BZ    ETI08200                 ..BR IF NOT TO ZERO BLK CT      16900021
         TM    DCBMACRF+K1,DCBMDEV      IS THERE A TAPE DEPEND SECTION- 17000002
         BZ    ETI08300                 ..BR IF NONE- CAN'T ZERO BLK CT 17100021
ETI08200 EQU   *                        NOT EXCP                        17200002
         XC    DCBBLKCT,DCBBLKCT        ZERO BLOCK COUNT IN DCB         17300021
ETI08300 EQU   *                        CHECK FOR CONCATENATION         17400002
         TM    DCBOFLGS,DCBOCON         IS CONCATENATION IN PROGRESS-   17500021
         BO    ETI08600                 ..BR IF YES TO POSITION VOL     17600021
         TM    DCBOFLGS,DCBORDBK        TEST FOR READ BACK       Y02134 17650002
         BO    ETI08400                 BRANCH IF RDBACK         Y02134 17660002
         LH    RC,DXVOLSEQ              LOAD VOLUME SEQUENCE     Y02134 17700002
         LA    RC,K1(RC)                INCREMENT BY ONE         Y02134 17750002
         STH   RC,DEBTVLSQ              ..STORE IT BACK IN DEB          18100021
         B     ETI08500                 BR TO POSITION VOL AT E-O-V     18200021
ETI08400 EQU   *                        READ BACK PROCESSING            18300002
         LH    RC,DXVOLSEQ              LOAD VOLUME SEQUENCE     Y02134 18350002
         BCTR  RC,R0                    DECREMENT BY ONE         Y02134 18352002
         STH   RC,DEBTVLSQ              ..STORE IT BACK IN DEB   Y02134 18360002
         CLI   DEBTVLSQ+K1,K1           IS THE NEXT VOL THE LAST ONE-   18700002
         BNE   ETI08500                 ..BR IF NOT TO POSITION VOL     18800021
         MVC   DXCCW7+K4(K2),DXCCW7+K6  ..YES- MOVE FILE SEQ NO. TO     18900002
*                                       ..FILE SEQ CT IN WORK AREA      19000021
*********************************************************************** 33300021
*              CURRENT VOLUME POSITIONING                             * 33400021
*********************************************************************** 33500021
*                                                                       33600021
ETI08500 EQU   *                        POSITION CURRENT VOLUME         33700002
         CLI   DXNOUNIT+K1,K1           IS ONE UNIT ALLOCATED TO DS-    33800002
         BE    ETI11000                 ..BR IF YES- NO POSITIONING     33900021
ETI08600 EQU   *                        MORE THAN ONE UNIT              34000002
         TM    UCBFL2,UCBNOTRD          IS THE UNIT 'READY'-            34100021
         BO    ETI11000                 ..BR IF NOT                     34200021
         TM    JFCBLTYP,JFCNSL          WAS NSL SPECIFIED-              34300021
         BO    ETI09600                 ..BR IF YES TO AVOID FEOV POS   34400021
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 34450002
         NI    UCBWGT,ALLBITS-UCBREW    TURN OFF THE UCB RWD BIT Y02080 34500002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 34550002
         MVI   DXCCW1,CCWFSF            INITLZ CCW FOR FWD SPACE FILE   34600021
*                                                                       34700021
*********************************************************************** 34800021
*              POSITIONING FOR FEOV                                   * 34900021
*********************************************************************** 35000021
*                                                                       35100021
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP           SA59750 35150002
         BO    ETI09600                 BRANCH IF EXCP          SA59750 35160002
         TM    DCBCIND2,DCBC2FEO        IS THIS AN FEOV ENTRY-          35200021
         BNO   ETI09600                 ..BR IF NOT TO CONTINUE         35300021
         L     RD,DXXPREFX              LOAD PREFX ADDRESS       Y02080 35350002
         USING IECPREFX,RD              PREFIX ADDRESSABILITY    Y02080 35360002
         L     RD,IECUPRML              LOAD PARMLIST ADDRESS    Y02080 35370002
         USING USERPRML,RD              PARM LIST ADDRESSABILITY Y02080 35380002
         TM    DXDCBLST,PLISTLV         TEST FOR COBOL/FEOV OPTIONS-    35400021
         DROP  RD                                                Y02080 35450002
         BM    ETI09100                 ..BR IF FEOV 'REWIND'           35500021
         BO    ETI08700                 ..BR IF COBOL/FEOV 'LEAVE'      35600021
         TM    DEBOPATB,DEBOPLV         IS THERE AN 'OPEN' POS OPTION-  35700021
         BZ    ETI10500                 ..BR IF NOT                     35800021
         BM    ETI09200                 ..BR IF 'REREAD'                35900021
*                                                                       36000021
*****          POSITION FOR LEAVE FOLLOWING FORWARD READ                36100021
*                                                                       36200021
ETI08700 EQU   *                        LEAVE POSITIONING               36300002
         LA    RD,EABD151               LOAD INTERNAL ERROR CODE        36400021
         BAL   RC,ETI11500              INCREMENT THE FILE SEQUENCE     36500021
*                                       ..COUNT AND NUMBER IF REQ'D     36600021
         TM    DCBOFLGS,DCBORDBK        TEST FOR 'RDBACK' PROCESSING-   36700021
         BO    ETI08900                 ..BR IF YES TO HANDLE 'RDBACK'  36800021
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ-           36900021
         BO    ETI08800                 ..BR IF YES- BYPASS FIRST FSF   37000021
         BAL   RC,ETI11700              BR AND LINK TO FSF PAST TM      37100021
*                                       ..WHICH FOLLOWS DATA            37200021
ETI08800 EQU   *                        TAPE MARK READ                  37300002
         TM    JFCBLTYP,JFCBAL+JFCSL    WAS AL OR SL SPECIFIED-         37400021
         BZ    ETI10400                 ..BR IF NOT                     37500021
         B     ETI10300                 ..ELSE BR TO PERFORM 'FSF' CMD  37600021
*                                                                       37700021
*****          POSITION FOR LEAVE FOLLOWING 'RDBACK'                    37800021
*                                                                       37900021
ETI08900 EQU   *                        LEAVE POSITIONING               38000002
         MVI   DXCCW1,CCWBSF            INITLZ CCW FOR 'BSF' COMMAND    38100021
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ-           38200021
         BO    ETI09000                 ..BR IF YES                     38300021
         BAL   RC,ETI11700              BR AND LINK TO PERFORM 'BSF'    38400021
ETI09000 EQU   *                        TAPE MARK READ                  38500002
         TM    JFCBLTYP,JFCBAL+JFCSL    WAS AL OR SL SPECIFIED-         38600021
         BZ    ETI10300                 ..BR IF NOT TO FSF              38700021
         BAL   RC,ETI11700              BR AND LINK TO PERFORM 'BSF'    38800021
         B     ETI10300                 BR TO PERFORM LAST FSF          38900021
*                                                                       39000021
*****          POSITION FOR COBOL/FEOV 'REWIND'                         39100021
*                                                                       39200021
ETI09100 EQU   *                        COBOL/FEOV POSITIONING          39300002
*                                                                YM7834 39400002
         MODESET EXTKEY=ZERO            UCB KEY                  YM7834 39450002
*                                                                YM7834 39500002
         XC    UCBFSCT,UCBFSCT          FORCE REWIND             YM7834 39550002
         XC    UCBFSEQ,UCBFSEQ          CLEAR FILE COUNTERS      YM7834 39600002
*                                                                YM7834 39650002
         MODESET EXTKEY=DATAMGT         DM KEY                   YM7834 39700002
*                                                                YM7834 39750002
         B     ETI11000                 BR- POSITIONING COMPLETE Y02134 40400002
*                                                                       40500021
*****          POSITION FOR 'REREAD' FOLLOWING FORWARD READ             40600021
*                                                                       40700021
ETI09200 EQU   *                        REREAD POSITIONING              40800002
         LA    RD,EABD152               REREAD POSITIONING ERROR CODE   40900021
         TM    DCBOFLGS,DCBORDBK        IS THE DCB OPENED FOR 'RDBACK'- 41000021
         BO    ETI09400                 ..BR IF YES                     41100021
         MVI   DXCCW1,CCWBSF            INITLZ CCW FOR BSF COMMAND      41200021
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ-           41300021
         BNO   ETI09300                 ..BR IF NOT                     41400021
         BAL   RC,ETI11700              BR AND LINK TO BSF              41500021
ETI09300 EQU   *                        CHECK FOR SL/AL                 41600002
         TM    JFCBLTYP,JFCBAL+JFCSL    WAS SL OR AL SPECIFIED-         41700021
         BZ    ETI10000                 ..BR IF NOT TO PERFORM 1 BSF    41800021
         B     ETI09900                 ..ELSE BR TO PERFORM 2 BSF      41900021
*                                                                       42000021
*****          POSITION FOR 'REREAD' FOLLOWING 'RDBACK'                 42100021
*                                                                       42200021
ETI09400 EQU   *                        REREAD POSITIONING              42300002
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ-           42400021
         BNO   ETI09500                 ..BR IF NOT-BYPASS 1ST FSF      42500021
         BAL   RC,ETI11700              BR AND LINK TO FSF              42600021
ETI09500 EQU   *                        INCREMENT UCB FILE SEQ          42700002
         BAL   RC,ETI11600              INCREMENT UCB FILE SEQ  SA56485 42750000
*                                       COUNT AND NO.           SA56485 42760000
         TM    JFCBLTYP,JFCBAL+JFCSL    WAS SL OR AL SPECIFIED-         42800021
         BZ    ETI10300                 ..BR IF NOT- DO 1 FSF           42900021
         BAL   RC,ETI11700              BR AND LINK TO FSF              43000021
         B     ETI10300                 BR TO TO SECOND FSF             43100021
         EJECT                                                          43200021
*********************************************************************** 43300021
*              POSITION ACCORDING TO 'OPEN' OPTION 2                  * 43400021
*********************************************************************** 43500021
*                                                                       43600021
ETI09600 EQU   *                        OPEN 2 POSITIONING              43700002
         TM    DEBOPATB,DEBOPLV         TEST FOR 'OPEN' OPTION 2        43800021
         BZ    ETI10500                 ..BR IF NONE SPECIFIED          43900021
         TM    JFCBLTYP,JFCNSL          WAS NSL SPECIFIED-              44000021
         BO    ETI11000                 ..BR IF YES- DON'T POS FOR NSL  44100021
         TM    DEBOPATB,DEBOPLV         WAS 'REREAD' SPECIFIED-         44200021
         BM    ETI09700                 ..BR IF YES                     44300021
*                                                                       44400021
*****          POSITION FOR 'OPEN' OPTION 2 'LEAVE'                     44500021
*                                                                       44600021
ETI09650 EQU   *                        OPEN 2 LEAVE                    44700002
         BAL   RC,ETI11500              BR AND LINK TO INCR SEQ CT/NO.  44800021
*                                       ..IF IN READ FORWARD MODE       44900021
         TM    JFCBLTYP,JFCBAL+JFCSL    WAS SL OR AL SPECIFIED-         45000021
         BM    ETI11000                 ..BR IF YES- POS COMPLETE       45100021
         TM    DCBOFLGS,DCBORDBK        IS THE DCB OPENED FOR 'RDBACK'- 45200021
         BZ    ETI11000                 ..BR IF NOT- POS COMPLETE       45300021
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ-           45400021
         BZ    ETI11000                 ..BR IF NOT- POS COMPLETE       45500021
         B     ETI10300                 BR TO FSF PAST LEADING TAPE MK  45600021
*                                                                       45700021
*****          POSITION FOR 'OPEN' OPTION 2 'REREAD' FOLLOWING FWD READ 45800021
*                                                                       45900021
ETI09700 EQU   *                        OPEN 2 REREAD                   46000002
         LA    RD,EABD152               LOAD INTERNAL ERROR CODE        46100021
         TM    DCBOFLGS,DCBORDBK        IS THE DCB OPENED FOR 'RDBACK'- 46200021
         BO    ETI10200                 ..BR IF YES                     46300021
         LA    RF,K1                    CHECK FOR FIRST FILE     YM7526 46350002
         CH    RF,UCBFSCT               CHECK IF ON FIRST        YM7526 46360002
         BNL   ETI09100                 BRANCH TO REWIND         YM7526 46370002
         MVI   DXCCW1,CCWBSF            INITLZ CCW FOR BACKSPACE FILE   46400021
         TM    JFCBLTYP,JFCBAL+JFCSL    WAS AL OR SL SPECIFIED-         46500021
         BZ    ETI09900                 ..BR IF NOT TO DO 2 BSF         46600021
         BAL   RC,ETI11700              BR AND LINK TO BACKSPACE FILE   46700021
ETI09800 EQU   *                        BSF                             46800002
         BAL   RC,ETI11700              BR AND LINK TO BACKSPACE FILE   46900021
ETI09900 EQU   *                        BSF                             47000002
         BAL   RC,ETI11700              BR AND LINK TO BACKSPACE FILE   47100021
ETI10000 EQU   *                        BSF                             47200002
         BAL   RC,ETI11700              BR AND LINK TO BACKSPACE FILE   47300021
ETI10100 EQU   *                        NOP                             47400002
         MVI   DXCCW1,CCWNOP            INITLZ CCW FOR 'NOP'            47500021
         BAL   RC,ETI11700              BR AND LINK TO PERFORM 'NOP'-   47600021
*                                       ..(DETECT 'BOT' ON LAST 'BSF')  47700021
         TM    IOBSENS1,UCBLDPT         IS TAPE NOW AT LOAD POINT-      47800021
         BO    ETI11000                 ..BR IF YES- POS COMPLETE       47900021
         B     ETI10300                 ..BR IF NOT TO BYPASS LEAD TM   48000021
*                                                                       48100021
*****          POSITION FOR 'OPEN OPTION 2' 'REREAD' FOLLOWING 'RDBACK' 48200021
*                                                                       48300021
ETI10200 EQU   *                        INCREMENT FILE SEQ CT/NO.       48400002
         BAL   RC,ETI11600              BR AND LINK TO INCR SEQ CT/NO.  48500021
         MVI   DXCCW1,CCWFSF            INITLZ CCW FOR 'FSF' COMMAND    48600021
         TM    JFCBLTYP,JFCBAL+JFCSL    WAS AL OR SL SPECIFIED-         48700021
         BZ    ETI10250                 ..BR IF NOT- BYPASS FIRST FSF   48800021
         BAL   RC,ETI11700              BR AND LINK TO FWD SPACE FILE   48900021
ETI10250 EQU   *                        CHECK TAPE MARK READ            49000002
         TM    DCBOFLGS,DCBOEOF         WAS A TAPE MARK READ-           49100021
         BNO   ETI10300                 ..BR IF NOT- BYPASS FSF         49200021
         BAL   RC,ETI11700              BR AND LINK TO FSF              49300021
ETI10300 EQU   *                        FSF                             49400002
         MVI   DXCCW1,CCWFSF            INITLZ CCW FOR 'FSF' COMMAND    49500021
*                                       ..(ENTRY MAY FOLLOW 'BSF' CMD)  49600021
         BAL   RC,ETI11700              BR AND LINK TO FWD SPACE FILE   49700021
         TM    IOBSENS1,UCBLDPT         WAS THE TAPE AT LOAD POINT-     49800021
*                                       ..(THIS CAN OCCUR IF THIS FSF   49900021
*                                       ..FOLLOWS THE BSF FOR FEOV NL   50000021
*                                       ..'LEAVE' FOLLOWING 'RDBACK')   50100021
         BO    ETI11000                 ..BR IF YES- POS COMPLETE       50200021
ETI10400 EQU   *                        NOP                             50300002
         MVI   DXCCW1,CCWNOP            INITLZ CCW FOR 'NOP' CMD        50400021
         BAL   RC,ETI11700              BR AND LINK TO PERFORM 'NOP'    50500021
*                                       (DETECT ERR ON LAST 'FSF' CMD)  50600021
         B     ETI11000                 BR- POSITIONING COMPLETE        50700021
*                                                                       50800021
*********************************************************************** 50900021
*              POSITION ACCORDING TO DATA SET DISPOSITION-            * 51000021
*              NO 'OPEN' OPTION 2 WAS SPECIFIED                       * 51100021
*********************************************************************** 51200021
*                                                                       51300021
ETI10500 EQU   *                        CHECK FOR RESERVED VOLUME       51400002
         TM    SRTEJBNR,UCBMONT         IS DISPOSITION 'PASS'    Y02134 51900002
         BNO   ETI09100                 ..BR IF NOT              YM7526 52000002
*                                                                       52100021
*****          POSITION A DATA SET WITH DISPOSITION 'PASS' OR           52200021
*****          A DATA SET ON A RESERVED VOLUME                          52300021
*                                                                       52400021
ETI10600 EQU   *                        CHECK FOR NSL                   52500002
         LA    RD,EABD153               LOAD INTERNAL ERROR CODE        52600021
         TM    JFCBLTYP,JFCNSL          WAS NSL SPECIFIED-              52700021
         BO    ETI11000                 ..BR IF YES- ALL DONE           52800021
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP           SA59750 52850002
         BO    ETI09650                 BRANCH IF EXCP          SA59750 52860002
         TM    DCBCIND2,DCBC2FEO        WAS 'FEOV' ISSUED-              52900021
         BO    ETI08700                 ..BR IF YES TO FINISH FEOV POS  53000021
         B     ETI09650                 ..ELSE BR TO FINISH EOV POS     53100021
*                                                                       56200021
*********************************************************************** 56300021
*              EXITS                                                  * 56400021
*********************************************************************** 56500021
*                                                                       57900021
*****          PREPARE TO XCTL TO NEW-VOLUME MOUNTING MODULE            58000021
*****          OR TO INITIALIZATION MODULE ( CONCATENATED DATA SETS )   58100021
*                                                                       58200021
ETI11000 EQU   *                        DECREMENT DATA MGT COUNT        58300002
*                                                                Y02134 58660002
*****************************************************************Y02134 58670002
*                                                                Y02134 58680002
*        DECREMENT DM COUNT                                      Y02134 58690002
*                                                                Y02134 58692002
*****************************************************************Y02134 58694002
*                                                                Y02134 58696002
         MODESET EXTKEY=SUPR            ASSUME KEY ZERO          Y02082 58746002
         MVI   UCBDMCT,K0               SET DM COUNT TO ZERO     Y02134 58788602
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 58788702
         OI    DXATEOV,DXATNVOL         INDIC CURR UNIT INACTIVE YM6520 58788802
         TM    DCBOFLGS,DCBOCON         IS CONCATENATION IN PROGRESS-   58788902
         BZ    ETI11400                 ..BR IF NOT TO EXIT             58800021
*                                                                       58900021
*****          COMPLETE CONCATENATION PROCESSING                        59000021
*                                                                       59100021
ETI11200 EQU   *                        CONCATENATION PROCESSING        59200002
*                                                                       60000021
*****          INITIALIZE DCB AND DEB FOR CONCATENATED DATA SET         60100021
*                                                                       60200021
*                                                                Y02134 60550002
         L     RC,DXDSABAD              GET CURRENT DSAB         Y02134 60730002
         USING DSAB,RC                                           Y02134 60740002
* UPDATE WORKAREA, DCB, DEB WITH NEW DSAB/TIOT ENTRY AND         Y02134 60940002
* INCREMENT DSAB OPEN COUNT                                      Y02134 60950002
         L     RC,DSABFCHN              GET NEXT DSAB ADDRESS    Y02134 60960002
         ST    RC,DXDSABAD              STORE IN WORKAREA        Y02134 60970002
         ST    RC,DXDSAB                CURRENT DSAB             Y02134 60980002
         L     RTIOT,DSABTIOT           NEXT TIOT ENTRY          Y02134 60990002
         ST    RTIOT,DXTIOTAD           SAVE IN WORKAREA         Y02134 61000002
         L     RF,DXTCBADR              GET CURRENT TCB          Y02134 61010002
         L     RF,TCBTIO-TCB(RF)        TIOT START ADDRESS       Y02134 61020002
         SR    RTIOT,RF                 RTIOT IS NEW TIOT OFFSET Y02134 61030002
         STH   RTIOT,DCBTIOT            UPDATE DCBTIOT           Y02134 61040002
         L     RTIOT,DXTIOTAD           RESTORE RTIOT            Y02134 61050002
         MODESET EXTKEY=SCHED           ASSUME KEY ONE           Y02082 61100002
         OI    DSABFLG2,DSABOPEN        SET OPEN BIT IN NEW DSAB Y02134 61240002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 61242002
         DROP  RC                                                Y02134 61250002
         L     RC,DXDEBXAD              GET DEB EXTENSION ADD    Y02134 61260002
         USING DEBXTN,RC                                         Y02134 61270002
         MVC   DEBXDSAB,DXDSABAD        UPDATE DSAB PTR IN DEBX  Y02134 61280002
         MVC   DXVOLSEQ(2),ONE          INITIALIZE VOLSEQ       ZA09140 61300037
         MVC   DEBTVLSQ(2),DXVOLSEQ     UPDATE THE DEB          ZA09140 61310037
         LA    RF,ID2V1F                INIT CONCATENATION       Y02134 61330002
         IECRES LOAD,MODID=(RF),BRCODE=K8,BRANCH=QUEUED          YM1277 61360002
*                                                                Y02134 61390002
ETI11400 EQU   *                        TEST FOR READBACK               61400002
*                                                                       61598021
         LH    R1,DXVOLSEQ              GET VOL SEQ              Y02134 61598802
*                                                                Y02134 61599202
         TM    DCBOFLGS,DCBORDBK        TEST FOR READ BACK       Y02134 61599702
         BO    ETI11450                 BRANCH IF READ BACK      Y02134 61600102
*                                                                Y02134 61600502
         LA    R1,K1(R1)                INCREMENT BY ONE         Y02134 61601302
         B     ETI11460                 BRANCH TO UPDATE VOL SEQ Y02134 61603302
*                                                                Y02134 61605302
ETI11450 EQU   *                        READ BACK                Y02134 61607302
*                                                                Y02134 61607702
         BCTR  R1,R0                    DECREMENT BY ONE         Y02134 61607802
*                                                                Y02134 61607902
ETI11460 EQU   *                        UPDATE VOLUME SEQ        Y02134 61608002
*                                                                Y02134 61608202
         STH   R1,DXVOLSEQ              UPDATE VOL SEQ           Y02134 61608402
*                                                                Y02134 61608802
         LA    RF,ID2V4A                SET UP FOR MOUNT/VERIFY  Y02134 61610002
         MVC   DXRETMOD,ID2V3F          SET UP RETURN MOD        Y02134 61612002
*                                                                Y02134 61614002
ETI11470 EQU   *                                                SA47382 61616002
*                                                                Y02134 61618002
         IECRES LOAD,MODID=(RF),BRCODE=K0,BRANCH=QUEUED          Y02134 61620002
*                                                                       61650000
         EJECT                                                          61700021
*********************************************************************** 61800021
*              SUBROUTINES                                            * 61900021
*********************************************************************** 62000021
*                                                                       62100021
*****          INCREMENT THE UCB FILE SEQUENCE COUNT AND NUMBER         62200021
*                                                                       62300021
ETI11500 EQU   *                        CHECK FOR READBACK              62400002
         TM    DCBOFLGS,DCBORDBK        IS THE DCB OPENED FOR 'RDBACK'- 62500021
         BCR   1,RC                     ..BR IF YES TO RET TO CALLER    62600021
ETI11600 EQU   *                        NOT READBACK                    62700002
         L     RF,SRTEFSCT              LD THE UCB FILE SEQ CT AND NO., 62800021
         A     RF,CNST0101              ..INCR EACH NUMBER BY 1, THEN   62900021
         MODESET EXTKEY=SUPR            TIOT/UCB KEY             Y02082 62950002
         ST    RF,SRTEFSCT              ..STORE THEM BACK IN THE UCB    63000021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 63050002
         BR    RC                       RETURN TO CALLER                63100021
         SPACE 2                                                        63200021
*                                                                       63300021
*****          CLOSED SUBROUTINE TO PERFORM I/O OPERATIONS              63400021
*****          ENTRY TO THE SUBROUTINE IS VIA A 'BAL  RC,ETI11700'      63500021
*                                                                       63600021
ETI11700 EQU   *                        I/O SUBROUTINE                  63700002
         OI    DXATALL,DXATFC           FORCE CLOSE ON ERROR     YM7099 63750002
         EXCP  DXIOB                    PERFORM I/O OPERATION           63800021
         IECRES WAIT                    INVOKE IECRES MACRO TO 'WAIT'   63900021
         TM    DXECB,ECBNOERR           WAS THERE A PERMANENT I/O ERR-  64000021
         BCR   1,RC                     ..BR IF NOT- RETURN TO CALLER   64100021
         TM    IOBSENS1,UCBLDPT         IS THE TAPE AT 'LOAD POINT'-    64200021
         BCR   1,RC                     ..BR IF YES- RETURN TO CALLER   64300021
*                                       ..ELSE DROP THROUGH TO ERR RTN  64400021
         SPACE 2                                                        64500021
*********************************************************************** 64600021
*              ERROR PROCESSING                                       * 64700021
*********************************************************************** 64800021
*                                                                       64900021
ETI11800 EQU   *                        ISSUE ABEND                     65000002
         DMABCOND (RD),ABEND2V          EXIT TO PROB DETERMINATION RTN  65100021
         EJECT                                                          65200021
*********************************************************************** 65300021
*              CONSTANTS                                              * 65400021
*********************************************************************** 65500021
*                                                                       65600021
CLCOMBSF CCW   X'2F',0,X'20',1          BACKSPACE FILE CCW              65700021
CNST0101 DC    F'65537'                 THE HEXADECIMAL FULLWORD '00010 65800021
AEOF13   DC    C'EOF'                   E-O-F LABEL IDENTIFIER          65900021
EOVMARK  DC    C'EOV'                   'EOV' TRAILER LABEL IDENTIFIER  66000021
ONE      DC    X'0001'                                                  66100037
         SPACE 2                                                        66300021
*********************************************************************** 66400021
*              XCTL TABLE                                             * 66500021
*********************************************************************** 66600021
*                                                                       66700021
XCTLTB2V XCTLTABL ID=(ABEND2V,0P,ID2V1F,1F,ID2V4A,4A,ID2V3F,3F), Y02134X66800002
               SVC=055,BRT=YES,LENGTH=                           Y02080 66900002
         SPACE 2                                                        67000021
         IECDSECS TIOT,                                                C67100021
               DCB,                                                    C67200021
               DEB,                                                    C67300021
               DEBX,                                             Y02134*67310002
               UCB,                                                    C67400021
               MAIN,                                                   C67500021
               WTG,                                                    C67600021
               PREFX,                                            Y02080*67650002
               DSAB,                                             Y02134*67660002
               TCB,                                              Y02134*67670002
               EXPAND=YES                                               67700021
         IECEQU ,                       INVOKE OPEN/CLOSE/EOV EQUATES   67800021
         SPACE 2                                                        67900021
         END                                                            68000021
