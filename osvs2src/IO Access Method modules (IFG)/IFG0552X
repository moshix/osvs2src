         TITLE 'IFG0552X - EOV INPUT END-OF-DATA FUNCTION'              00100021
IFG0552X CSECT                                                          00400021
*********************************************************************** 00450002
*                                                                     * 00500002
*                                                                     * 00500402
*          VS2 RELEASE 02 DELETIONS                                   * 00500802
*          VS2 RELEASE 03 DELETIONS                                   * 00504502
*0000338500                                                     ZA00120 00509602
*0000655000                                                     ZA01289 00514502
*          VS2 RELEASE 04 DELETIONS/CHANGES                           * 00516003
*0000483020-483160,483300-465500                               @ZA01344 00517003
*0000                                                          @ZA06440 00519003
*                                                                     * 00521202
*                                                                     * 00526102
*********************************************************************** 00531002
*                                                                     * 00535902
* MODULE NAME = IFG0552X (OS/VS2)                                     * 00540802
*                                                                     * 00545702
* DESCRIPTIVE NAME = EOV INPUT END-OF-DATA FUNCTION                   * 00550602
*                                                                     * 00555502
* COPYRIGHT = NONE                                                    * 00560402
*                                                                     * 00565302
* STATUS = RELEASE 4, LEVEL 0                                         * 00570203
*                                                                     * 00575102
* FUNCTION =                                                          * 00580002
*        1. DETERMINES WHETHER END-OF-DATA (EOD) HAS BEEN REACHED OR  * 00584902
*        IF THERE ARE CONCATENATED DATA SETS TO BE PROCESSED.         * 00589802
*        AT ENTRY WITH THE TIOT INDICATING A SPOOLED DATA SET OR      * 00594702
*        WITH REG 14 ZERO, END OF DATA/CONCATENATION IS INDICATED.    * 00599602
*                                                                     * 00604502
*        1A. IF EOD HAS BEEN REACHED, THE USER'S EODAD ADDRESS IS     * 00609402
*        PLACED IN THE RESUME (OLD) PSW, AND CONTROL IS RETURNED      * 00614302
*        TO THE USER                                                  * 00619202
*                                                                     * 00624102
*        1B. IF THERE ARE CONCATENATED DATA SETS WITH UNLIKE          * 00629002
*        ATTRIBUTES, CONTROL IS TRANSFERRED TO THE FIRST LOAD OF      * 00633902
*        CLOSE TO CLOSE THE DCB AND THEN REOPEN IT WITH NEW           * 00638802
*        ATTRIBUTES.                                                  * 00643702
*                                                                     * 00648602
*        1C. IF THERE ARE CONCATENATED DATA SETS WITH LIKE ATTRIBUTES,* 00653502
*        THIS FUNCTION FIRST DETERMINES WHETHER OR NOT SMF RECORDS    * 00658402
*        ARE TO BE WRITTEN, TRANSFERRING CONTROL TO THE CLOSE SMF     * 00663302
*        PROCESSING MODULE IF REQUIRED. THAT MODULE RETURNS CONTROL   * 00713302
*        TO THIS MODULE (WITH REGISER 14 CONTAINING 4)                * 00773302
*        UNLESS THE DATA SET AT EOF IS ON A TAPE VOLUME               * 00783302
*        IN WHICH CASE CONTROL IS RETURNED TO THE EOV TAPE INPUT      * 00813302
*        VOLUME POSITIONING FUNCTION. IF SMF RECORDS ARE NOT REQUIRED * 00863302
*        AND THE CURRENT DATA SET IS ON TAPE, CONTROL IS TRANSFERRED  * 00913302
*        DIRECTLY TO THE VOLUME POSITIONING FUNCTION. FOLLOWING SMF   * 00963302
         EJECT                                                          00964502
*        UPON RETURN FROM SMF PROCESSING FOR NON-TAPE DEVICES,        * 00965302
*        OR IF THAT IS NOT REQUIRED, THE NEXT DSAB                    * 01013302
*        IS OBTAINED BY FORWARD CHAINING FROM THE CURRENT DSAB;       * 01063302
*        WORKAREA POINTERS, THE USER'S DCB, DEB, DEB EXTENSION        * 01113302
*        AND UCB ARE UPDATED TO REFLECT THE CONCATENATED DATA SET AND * 01163302
*        CONTROL IS TRANSFERRED TO THE INITIALIZATION FUNCTION TO     * 01213302
*        BEGIN PROCESSING THE CONCATENATED DATA SET.                  * 01263302
*                                                                     * 01264302
*        2. IF ENTRY IS FROM THE INITIAL FUNCTION WITH THE CONCAT.    * 01363302
*        BIT ON IN FIELD 'DCBOFLGS' (INDICATED BY REG 14 CONTINING    * 01423302
*        16 AT ENTRY), THEN VARIOUS RETURN INDICATORS                 * 01433302
*        ARE SET AND CONTROL IS PASSED TO THE USER VIA SVC 3 (EXCP)   * 01463302
*        OR TO THE EOV ACCESS METHOD EXECUTOR (BSAM OR QSAM           * 01513302
*        ACCESS METHOD) TO READ THE CONCATENATED DATA SET.            * 01563302
*        NOTE- THIS ENTRY CAN ONLY OCCUR WHEN THE CONCATENATED DATA   * 01613302
*        SET RESIDES ON/IN A UNIT RECORD DEVICE.                      * 01663302
*                                                                     * 01713302
*        3. IF ENTRY IS FROM THE PROBLEM DETERMINATION FUNCTION,      * 01763302
*        (INDICATED BY THE BUSY BIT, DCBOBUSY IN DCBOFLGS, SET TO 0), * 01783302
*        AN ERROR HAS PREVIOUSLY OCCURRED IN SOME EOV FUNCTION AND THE* 01813302
*        USER HAS INDICATED THAT IT IS TO BE IGNORED. EOV WILL THEN   * 01863302
*        CLOSE THE DCB AS IN THE CASE OF CONCATENATION WITH UNLIKE    * 01913302
*        ATTRIBUTES (REFER TO (3) ABOVE), AND CLOSE WILL EXIT TO THE  * 01963302
*        USER.                                                        * 02013302
*                                                                     * 02673302
*        BEFORE EITHER EXITING TO THE USER OR TRANSFERRING       Y02082 02713302
*        CONTROL TO IFG0551L OR IGC01020, THE DCB ADDRESS IN THE Y02082 02763302
*        DEB (DEBDCBAD) IS SET TO POINT TO THE USER'S DCB.       Y02082 02813302
*                                                                     * 02863302
* NOTES = SEE BELOW                                                   * 02913302
*                                                                     * 02963302
*    DEPENDENCIES =                                                   * 03013302
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 03063302
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 03113302
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 03163302
*                                                                     * 03213302
*    RESTRICTIONS = NONE                                              * 03263302
         EJECT                                                          03313302
*    REGISTER CONVENTIONS =                                           * 03363302
*            R2 POINTS TO COPIED DCB                                  * 03413302
*            R4 POINTS TO OPEN WORK AREA                              * 03463302
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 03513302
*            R6 POINTS TO THE WTG TABLE                               * 03563302
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 03613302
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 03663302
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 03713302
*            R10 POINTS TO THE UCB                                    * 03763302
*            R11 POINTS TO THE DEB                                    * 03813302
*                                                                     * 04163302
*    PATCH LABEL = SEE THIRD FROM LAST LABEL BEFORE ORG STATEMENT AT  * 04213302
*        END OF LISTING.                                              * 04263302
*                                                                     * 04313302
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 04363302
*                                                                     * 04413302
*    PROCESSOR = ASSEMBLER XF                                         * 04463302
*                                                                     * 04513302
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 04563302
*                  ORG STATEMENT AT END OF LISTING                    * 04613302
*                                                                     * 04663302
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 04713302
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 04763302
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 04813302
*                                                                     * 04863302
* ENTRY POINT = IFG0552X FROM (REG 14 ENTRY POINT IN PARENTHESIS)     * 04913302
*               IFG0551F - INITIAL READ JFCB FUNCTION (SPOOLED TIOT)  * 04963302
*               IFG0551H DEVICE TYPE DETERMINATION (0,16)             * 05013302
*               IFG0552R TAPE INPUT STANDARD TRAILER LABEL (0)        * 05063302
*               IFG0552T TAPE INPUT VOLUME POSITIONING (0)            * 05113302
*               IFG0553P DA INPUT INITAL MODULE (0)                   * 05163302
*               IFG0194A VOLUME MOUNTING MODULE (0)                   * 05173302
*               IFG0559E PROBLEM DETERMINATION MODULE (BUSY BIT ZERO) * 05193302
*               IFG0553B SMF MODULE (4)                               * 05203302
*                                                                     * 05213302
*    PURPOSE = SEE FUNCTION                                           * 05263302
*                                                                     * 05313302
*    LINKAGE =                                                        * 05363302
*        TRANSFERRED CONTROL THROUGH IECRES MACRO                     * 05373302
         EJECT                                                          05413302
* INPUT =                                                             * 05463302
*        CONTROL PASSED IN PROTECT KEY 5                              * 05465302
*        REGISTER 2 POINTS TO COPIED DCB                              * 05473302
*        DEBDCBAD POINTS TO COPIED DCB EXCEPT FOR SPOOLED DCB         * 05475302
*        REGISTER 4 POINTS TO EOV WORKAREA                            * 05483302
*        REGISTER 14 CONTAINS ENTRY BRANCH OFFSET                     * 05493302
*              0 - TO PROCESS EOF                                     * 05505302
*              4 - RETURN FROM SMF                                    * 05507302
*              16 - TO FINISH UNIT RECORD CONCATENATION               * 05509302
*        BUSY BIT IN DCBOFLGS INDICATES ENTRY FROM PROBLEM            * 05512102
*              DETERMINATION.                                         * 05512502
*        SPOOLED BITS IN TIOT INDICATES ENTRY FROM IFG0551F.          * 05512902
*                                                                     * 05513302
* OUTPUT =                                                            * 05563302
*        RESUME PSW IN SVRB POINTING TO EODAD ADDRESS. REGISTERS IN   * 05565302
*        THE SVRB HAVE ALREADY BEEN SWAPPED TO BE THE USER'S REGS.    * 05565403
*        REGISTERS AT EXIT TO USER'S EODAD ROUTINE -                  * 05565503
*            0-1 - RESERVED                                           * 05565603
*           2-13 - CONTENTS BEFORE EXECUTION OF GET, CHECK, FEOV, OR  * 05565703
*                  EOV (EXCP)                                         * 05565803
*             14 - RETURN ADDRESS FOR GET OR CHECK MACRO INSTRUCTION, * 05565903
*                  OR CONTENTS BEFORE EXECUTION OF FEOV OR EOV (EXCP) * 05566003
*             15 - RESERVED                                           * 05566103
*        EOV WORKAREA AND ALL OTHER WORKAREAS FREED.                  * 05566403
*        USER DCB UPDATED FROM PROTECTED DCB.                         * 05566502
*              EODAD EXIT                                             * 05567302
*        REGISTER 2 POINTS TO COPIED DCB                              * 05573302
*              IFG0551L                                               * 05583302
*              IFG0551F                                               * 05603302
*              IFG0553B                                               * 05605302
*              IFG0552V                                               * 05607302
*        REGISTER 2 POINTS TO USER'S DCB AND                     YM3190 05609302
*        USER DCB UPDATED FROM PROTECTED DCB.                    YM3190 05609702
*              IGC00020 (ENTRY POINT IGC01020)                        * 05611302
*        REGISTER 4 POINTS TO EOV WORKAREA AND CONTROL PASSED         * 05611702
*        IN PROTECT KEY 5                                             * 05611802
*              ALL MODULES TRANSFERRED CONTROL                        * 05612102
*        DXRETMOD INDICATING RETURN MODULE ID FOR IFG0552X OR         * 05612502
*        IFG0552V                                                     * 05612802
*              IFG0553B                                               * 05612902
*        DXRETCOD INDICATING RETURN CONTENTS OF REGISTER 14           * 05613102
*              IFG0553B - 4                                           * 05613202
*        REGISTER 0 CONTAINING INTERNAL ABEND CODE                    * 05639902
*              IFG0550P                                               * 05641902
*        DEBDCBAD POINTING TO USER DCB                                * 05646302
*              IFG0551L                                               * 05646402
*              IGC00020 (ENTRY POINT IGC01020)                        * 05646502
*        DXDSABAD, DXDSAB, DXTIOTAD, DEB EXTENSION DSAB ADDRESS       * 05652102
*        UPDATED TO NEXT CONCATENATED DATA SET                        * 05654102
*              IFG0551F                                               * 05656102
*        DCBOCON BIT SET IN DCBOFLGS INDICATING CONCATENATION         * 05656902
*              IFG0551F                                               * 05657302
*              IFG0552V                                               * 05657402
*              IGC00020 (ENTRY POINT IFG01020)                        * 05657502
         EJECT                                                          05657702
* EXIT-NORMAL = IFG0551L SAM EOV EXECUTOR, TO COMPLETE UR CONCAT.     * 05663302
*               IGC00020 (ENTRY POINT IGC01020) FOR UNLIKE ATTRUBUTES * 05723302
*               CONCATENATION, OR IF THE IGNORE OPTION WERE CHOSEN    * 05733302
*               FROM AN EOV ABEND EXIT.                               * 05753302
*               IFG0551F INITIAL READ JFCB OR CONCAT. OF LIKE ATTRIB. * 05763302
*               IFG0553B SMF RECORD PROCESSING                        * 05813302
*               IFG0552V TAPE INPUT VOLUME POSITIONING                * 05863302
*               RETURN TO CALLER                                      * 05913302
*                                                                     * 05963302
* EXIT-ERROR =                                                        * 06013302
*        IFG0550P PROBLEM DETERMINATION WITH ONE OF THE FOLLOWING     * 06073302
*        INTERNAL ABEND CODES IN REGISTER 0                           * 06123302
*                                                                     * 06173302
*        174-CAUSING 337-04 ABEND, NO FOUNDATION EXTENSION IN EXCP    * 06223302
*        DCB OR NO EODAD ROUTINE AT END OF DATA.                      * 06233302
*                                                                     * 06243302
*        176-CAUSING 637-0C ABEND, CONCATENATION OF UNLIKE DEVICES    * 06253302
*        AND THE UNLIKE ATTRIBUTES BIT NOT SET IN THE DCBOFLGS.       * 06255302
*                                                                     * 06263302
* EXTERNAL REFERENCES = SEE BELOW                                     * 06313302
*                                                                     * 06363302
*    ROUTINES =                                                       * 06413302
*        IFG019RA THROUGH THE IECRES MACRO.                           * 06423302
*                                                                     * 06463302
*    DATA AREAS =                                                     * 06513302
*        EOV WORKAREA.                                                * 06523302
*                                                                     * 06563302
*    CONTROL BLOCK =                                                  * 06613302
*        CVT                                                          * 06623302
*        TCB                                                          * 06633302
*        SVRB                                                         * 06643302
*        DCB                                                          * 06653302
*        TIOT                                                         * 06655302
*        DEB                                                          * 06657302
*        DEB EXTENSION                                                * 06659302
*        DSAB                                                         * 06661302
*        UCB                                                          * 06661702
*        VDSCB                                                        * 06662102
         EJECT                                                          06663302
* TABLES =                                                            * 06713302
*        NONE.                                                        * 06723302
*                                                                     * 06763302
* MACROS =                                                            * 06813302
*        MODESET                                                      * 06823302
*        SETLOCK                                                      * 06833302
*        DMABCOND                                                     * 06843302
*        WICLOSE                                                      * 06853302
*        IECRES LOAD                                                  * 06855302
*        IECRES INIT                                                  * 06857302
*        IECRES FREE                                                  * 06859302
*        IECRES EXIT                                                  * 06861302
*        XCTLTABL                                                     * 06861702
*        IECDSECS                                                     * 06862102
*        IECEQU                                                       * 06862502
*                                                                     * 06863302
* CHANGE ACTIVITY =                                                   * 06913302
*        SEE 'CHANGES/DELETIONS' SECTION JUST AFTER CSECT CARD        * 06923302
*                                                                     * 06963302
*********************************************************************** 07063302
         EJECT                                                          07113302
*                                                                       21400021
*****    INTERNAL ERROR CODES                                           21500021
*                                                                       21600021
EABD174  EQU   174                      NO EOD ADDRESS WAS PROVIDED     21700021
EABD176  EQU   176                      CONCATENATION OF DATA SETS WITH 21800021
*                                       ..LIKE ATTRIBUTES WAS SPECIFIED 21900021
*                                       ..BUT UNLIKE DEV WERE ALLOCATED 22000021
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        22100021
         USING *,RBASE                                                  22200021
*                                                                       22300003
         USING FORCORE,RCORE                                            22400021
         USING WTG,RWTG                 BASE FOR WTG TABLE       Y02080 22450002
         USING TIOENTRY,RTIOT                                           22600021
         USING DEBBASIC,RDEB                                     Y02134 22700002
         USING IHADCB,RDCB                                              22800021
         USING UCB,RUCB                                                 22900021
*                                                                       23000021
*****          POINT TO THE SVRB FOR LATER PROCESSING                   23100021
*                                                                       23200021
         L     RC,CVTPTR                LOAD ADDRESS OF CVT      M0017  23260021
         USING CVT,RC                   ESTABLISH CVT BASE ADDR  M0017  23320021
         L     RC,CVTTCBP               LOAD ADDR OF TCB POINTERS       23400021
         DROP  RC                                                M0017  23450021
         L     RC,K4(,RC)               LOAD ADDR OF ACTIVE TCB         23500021
         USING TCB,RC                   ESTABLISH TCB ADDRESSABILITY    23600021
         L     R0,TCBTIO                LOAD TIOT PTR                   23640000
         L     RC,TCBRBP                LOAD ADDRESS OF CURRENT SVRB    23700021
         USING RBSECT,RC                ESTABLISH RB ADDRESSABILITY     23800021
         TM    DCBMACRF,DCBMEXCP        EXCP ACCESS METHOD              23808000
         BO    ECM60050                 YES BYPASS SPOOL TEST           23812000
         LH    RTIOT,DCBTIOT            GET TIOT OFFSET          Y02120 23816002
         AR    RTIOT,R0                 GET TIOT ENTRY           Y02120 23816402
         TM    TIOELINK,TIOESYIN+TIOESYOT  SPOOLED DCB?          Y02120 23816503
         BZ    ECM60050                 NO, CONTINUE NORMAL PROCESS     23820000
         OI    DCBOFLGS,DCBOBUSY        SET BUSY BIT ON                 23868000
         L     RDCB,DXUDCBAD            USER DCB ADDRESS         YM7883 23870002
         MODESET KEYADDR=DXUKEY,WORKREG=10 ASSUME USER KEY       YM7883 23872002
         OI    DCBOFLGS,DCBOBUSY        SET BUSY BIT ON          YM7883 23874002
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       YM7883 23876002
         L     RDCB,DXPDCBAD            DCB COPY ADDRESS         YM7883 23878002
         SR    RUCB,RUCB                SET UCB REG TO 0                23880000
         B     ECM60400                 BR TO CONTINUE                  23892000
         EJECT                                                          23894002
*                                                                       23900021
*****          DETERMINE TYPE OF ENTRY TO MODULE IF NOT SPOOLED         24000002
*                                                                       24100021
ECM60050 EQU   *                        SEE IF PROBLEM DETERMINATION    24140002
*                                       ENTRY - IGNORE ABEND PROCESSING 24192002
         TM    DCBOFLGS,DCBOBUSY        TEST FOR ENTRY FROM PROBLEM     24200021
*                                       ..DETERMINATION FUNCTION-       24300021
         BO    ECM60100(RET)            ..BR IF NO TO CONTINUE   YM3970 24400002
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          YM3970 24450002
         OI    DCBOFLGS,DCBOBUSY        TURN ON THE BUSY BIT   @ZA06440 24550003
         NI    DCBOFLGS,ALLBITS-DCBOCON TURN OFF CONCAT BIT    @ZA06440 24650003
         B     ECM61800                 BRANCH TO CLOSE DCB      YM3970 24900002
*                                                                       24950002
ECM60100 EQU   *                        BRANCH TABLE                    25000002
         B     ECM60200                 0-BR IF ENTERED TO PROCESS EOF  25100002
         B     ECM61200                 4-RETURN FROM SMF MODULE Y02134 25200002
         B     *                        NEVER ENTERED. WAS ENTRY TRACE  25300002
*                                       ..TERMINATION MODULE            25400021
         B     *                        NEVER ENTERED. WAS ENTRY Y02082 25450002
*                                       FOR ANSI HEADER MSG      Y02082 25500002
         B     ECM61600                 16-BR IF ENTERED FOR     M0015  25630002
*                                       ..UNIT RCD CONCATENATION M0015  25660021
         EJECT                                                          25698002
*                                                                       25700021
*********************************************************************** 25800021
*              END-OF-FILE FROCESSING                                 * 25900021
*********************************************************************** 26000021
*                                                                       26100021
ECM60200 EQU   *                        REG 14 = 0 ENTRY POINT          26200002
*               TURN ON DEB EOF INDICATORS                       Y02080 26250002
         OI    DEBOFLGS,DEBOFEOF                                 Y02080 26700002
*    INDICATE THAT DEFERRED USER LBL PROCESSING CAN TAKE PLACE   Y02080 26750002
         OI    DEBFLGS1,DEBF1EOF                                 Y02080 26800002
         TM    DCBMACRF,DCBMEXCP        IS EXCP BEING USED?             27040000
         BO    ECM60400                 ..BRANCH IF NOT                 27060000
         TM    DCBCIND2,DCBC2FEO        IS THIS AN FEOV ENTRY-          27100021
         BNO   ECM60400                 ..BR IF NOT FEOV                27200021
*               TURN OFF DEB EOF INDICATORS                      Y02080 27250002
         NI    DEBOFLGS,X'FF'-DEBOFEOF                           Y02080 27300002
         NI    DEBFLGS1,X'FF'-DEBF1EOF                           Y02080 27400002
*                                                                       27500021
*****          TEST FOR CONCATENATED DATA SETS                          27600021
*                                                                       27700021
ECM60400 EQU   *                        SPOOLED DCB ENTRY               27800002
         L     R1,DXDSABAD              GET CURRENT DSAB         Y02134 27900002
         USING DSAB,R1                                           Y02134 27950002
         L     R1,DSABFCHN              GET NEXT (CONCATENATED?) Y02134 28000002
*                                       DSAB                            28050002
         LTR   R1,R1                    IS THERE ANOTHER ONE?    Y02134 28100002
         BZ    ECM60500                 NO MORE-NO CONCATENATION Y02134 28150002
         L     R1,DSABTIOT              GET NEXT TIOT ENTRY      Y02134 28200002
         LR    RD,R1                    SAVE NEXT TIOT ENTRY     Y02134 28250002
         CLI   TIOEDDNM-TIOENTRY(R1),BLANK TEST FOR A BLANK DDNAME      28400021
         BE    ECM60850                 ..BR IF BLANK- CONCAT    Y02083 28500002
         EJECT                                                          28600021
*********************************************************************** 28700021
*              END-OF-DATA PROCESSING                                 * 28800021
*********************************************************************** 28900021
*                                                                       29000021
ECM60500 EQU   *                        ABEND IF NO EODAD               29100002
         NI    DXATALL,X'FF'-DXATFC     RESET FORCE CLOSE INDIC  YM7099 29150002
         LA    R0,EABD174               LOAD INTERNAL ERROR CODE        29200003
         TM    DCBMACRF,DCBMEXCP        IS THE ACCESS METHOD EXCP-      29300021
         BZ    ECM60600                 ..BRANCH IF NOT                 29400021
         TM    DCBMACRF,DCBMFOUN        IS FOUNDATION EXT PRESENT-      29500021
         BZ    ECM62800                 ..BR IF NOT TO ERROR RTN        29600021
ECM60600 EQU   *                        IS EODAD SPECIFIED              29700002
         L     RF,DCBEODAD              LOAD ADDRESS OF EODAD RTN       29800021
         LA    RF,0(,RF)                CLEAR THE HIGH-ORDER BYTE       29900021
         CH    RF,HALFWD1               IS THERE AN EODAD RTN ADDR-     30000021
         BE    ECM62800                 ..BR IF NOT TO ERROR RTN        30100021
         TM    DCBMACRF,DCBMEXCP        IS THE ACCESS METHOD EXCP-      30200021
         BO    ECM60700                 ..BRANCH IF YES                 30300021
         TM    DCBCIND2,DCBC2QSM        IS THE ACCESS METHOD QSAM-      30400021
         BZ    ECM60650                 ..BR IF NO-BSAM DOESN'T YA02398 30500002
*                                       ..REQUIRE THE FOLLOWING INST    30600021
         TM    TIOELINK,TIOESYIN+TIOESYOT  TEST FOR SPOOLED      Y02120 30650003
         BM    ECM60700                 BRANCH IF SPOOLED        Y02120 30660002
         L     RF,DCBIOBA               LOAD IOB ADDRESS FROM DCB       30700021
         MODESET KEYADDR=DXUKEY,WORKREG=1 USER KEY FOR IOB       Y02082 30750002
         L     RF,K0(,RF)               LOAD ADDRESS OF NEXT IOB        30800021
         MVI   K4(RF),PUTCCODE          INDICATE IN SECOND IOB THAT     30900021
*                                       ..EODAD EXIT WAS TAKEN          31000021
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGT KEY   Y02082 31050002
         B     ECM60700                 SET UP EODAD ADDR       YA02398 31052002
         EJECT                                                          31060002
ECM60650 EQU   *                        TEST FOR PS, DA         YA02398 31061002
*                                                                       31062002
*        RESET CURRENT (LAST SCHEDULED) BSAM IOB ADDR TO THE    YA02398 31063002
*        IOB IN ERROR IF MORE THAN ONE IOB, DSORG PS, AND DA.   YA02398 31064002
*        RESET DCBFDAD TO MBBCCHHR OF 'FILE MARK'.              YA02398 31065002
*                                                                       31066002
         TM    DCBDEVT,DCBDEVDA         IS IT DA DEVICE         YA02398 31067002
         BNO   ECM60700                 BRANCH IF NO            YA02398 31068002
         TM    DCBDSORG,DCBORGPS        PHYSICAL SEQUENTIAL     YA02398 31069002
         BNO   ECM60700                 BRANCH IF NOT           YA02398 31070002
         CLI   DCBNCP,K1                IS THERE ONE CHAN PGM   YA02398 31071002
         BNH   ECM60700                 BRANCH IF YES           YA02398 31072002
         L     RD,DCBIOBA               GET LAST SCHED. IOB     YA02398 31073002
         LA    RD,K0(,RD)               CLEAR HIGH BYTE FOR CR  YA02398 31074002
         MODESET KEYADDR=DXUKEY,WORKREG=1 ASSUME USER KEY       YA02398 31075002
         L     RUCB,K4(,RD)             GET IOB IN ERROR        YA02398 31076002
         LA    RUCB,K0(,RUCB)           CLARE HIGH BYTE FOR CR  YA02398 31077002
         CR    RUCB,RD                  IS ERROR IOB CURRENT    YA02398 31078002
         BE    ECM60700                 BRANCH IF YES           YA02398 31079002
*                                                                       31080002
*        MOVE ERROR IOB/ICBSEEK TO DCBFDAD                      YM05966 31081002
*                                                                       31082002
         TM    DCBCIND2,DCBC2CHN        CHAINED SCHEDULING      YM05966 31082202
         BZ    ECM60660                 BRANCH IF NO            YM05966 31082402
         LM    R0,R1,K32(RUCB)          GET ICBSEEK IN R0, R1   YM05966 31082602
         B     ECM60670                 UPDATE DCBFDAD          YM05966 31082802
ECM60660 EQU   *                        GET IOBSEEK             YM05966 31082902
         LM    R0,R1,K40(RUCB)          GET IOBSEEK IN R0, R1   YA02398 31083002
ECM60670 EQU   *                        UPDATE DCBFDAD          YM05966 31083202
         MODESET EXTKEY=DATAMGT         RETURN TO D. M. KEY     YA02398 31084002
         STCM  R0,B'1111',DCBFDAD       STICK IN FIRST 4 BYTES  YA02398 31085002
         STCM  R1,B'1111',DCBFDAD+K4    STICK IN LAST 4 BYTES   YA02398 31086002
         ST    RUCB,DCBIOBA             CURRENT IOB = ERROR IOB YA02398 31087002
         LR    RD,RUCB                  ERROR IOB IN RD         YA02398 31088002
         SR    RUCB,RUCB                ZERO RUCB FOR IC        YA02398 31089002
         IC    RUCB,DCBFDAD+K7          GET R FROM FDAD         YA02398 31090002
         LA    RUCB,K1(,RUCB)           INCREMENT R BY 1        YA02398 31091002
         STC   RUCB,DCBFDAD+K7          STORE R+1               YA02398 31092002
         MODESET KEYADDR=DXUKEY,WORKREG=1 GET IN USER KEY       YA02398 31093002
         L     RD,K0(,RD)               GET NEXT IOB            YA02398 31094002
         TM    DCBCIND2,DCBC2CHN        CHAINED SCHEDULING      YM05966 31094202
         BZ    ECM60680                 BRANCH IF NO            YM05966 31094402
         MVC   K32(L'DCBFDAD,RD),DCBFDAD PUT FILE MARK ADDR IN  YM05966 31094602
*                                       NEXT ICB                YM05966 31094702
         B     ECM60690                 CONTINUE                YM05966 31094802
ECM60680 EQU   *                        UPDATE IOBSEEK          YM05966 31094902
         MVC   K40(L'DCBFDAD,RD),DCBFDAD PUT FILE MARK ADDR IN  YA02398 31095002
*                                       NEXT IOB                YA02398 31096002
ECM60690 EQU   *                        GET IOBSEEK             YM05966 31096202
         EJECT                                                          31097002
*                                                                       31100021
*****          SET UP 'EOV' RETURN INDICATOR                            31200021
*                                                                       31300021
ECM60700 EQU   *                        SET EOV RETURN CODE             31400002
         MODESET EXTKEY=DATAMGT         GET IN KEY 5            YA02398 31401002
         SR    RUCB,RUCB                SET THE RETURN CODE TO ZERO     31500021
         CLC   FL1LABI(K3),EOVMARK      WAS ANY LABEL PROCESSED-        31600021
         BNE   ECM60800                 ..BR IF NOT- RETURN CODE EQ 0   31700021
         LA    RUCB,K4(,RUCB)           SET THE RETURN CODE TO 4        31800021
ECM60800 EQU   *                        PUT EODAD ADDRESS IN RESUME PSW 31900002
*                                                                       31950003
         L     RD,RBLINK                LOAD USER'S PRB ADDR FROM SVRB  32000021
         MODESET EXTKEY=SUPR            SUPERVISOR KEY           Y02082 32050002
         MVC   RBOPSW+K5-RBSECT(K3,RD),DCBEODAD+K1  MOVE EOD ADDR INTO  32600002
*                                       ..ADDR PORTION OF OLD PSW       32700021
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 32750002
         TM    DCBMACRF,DCBMEXCP        EXCP BEING USED?                32840000
         BO    ECM62000                 ..BRANCH IF YES                 32860000
*                                                                       32860503
*  SET UP REG 14 FOR EODAD EXIT AS GET OR CHECK RETURN ADDR.            32861003
*  ALREADY OK FOR EXCP AND FEOV.                                        32861503
*                                                                       32862003
         TM    DCBCIND2,DCBC2FEO        WAS FEOV ISSUED        @ZA01344 32862503
         BO    ECM60810                 BR IF YES, REG 14 OK   @ZA01344 32863003
         L     RET,RBGRS13              ADDR OF USER SAVE AREA @ZA01344 32863503
         MODESET KEYADDR=DXUKEY,WORKREG=15  ASSUME USER KEY    @ZA01344 32864003
         L     RET,K20(,RET)            COPY REG 14 FROM       @ZA01344 32865003
*                                       USER SAVE AREA         @ZA01344 32866003
         MODESET EXTKEY=SUPR            SVRB KEY               @ZA01344 32867003
         ST    RET,RBGRS14              TO RB RESUME REG 14    @ZA01344 32868003
         MODESET EXTKEY=DATAMGT         RESUME DATA MGT KEY    @ZA01344 32869003
ECM60810 EQU   *                                               @ZA01344 32869203
*                                                                       32869503
         TM    DCBCIND2,DCBC2CHN        CHAINED SCHEDULING      ZA01289 32870002
         BZ    ECM60820                 BRANCH IF NO            ZA01289 32880002
*                                                                       32890002
         L     RD,DCBIOBAD              GET CHAIN SCH IOB       ZA01289 32892002
         MODESET KEYADDR=DXUKEY,WORKREG=1  USER KEY             ZA01289 32894002
         OI    IOBCNOPA-IOBPREFX(RD),ALLOWIO SET TO RESTART I/O ZA01289 32894402
         MODESET EXTKEY=DATAMGT         GET IN KEY 5            ZA01289 32894802
*                                                                       32896002
ECM60820 EQU   *                        CONTINUE EOF            ZA01289 32898002
*                                                                       32898402
         TM    DCBCIND2,DCBC2QSM        IS THE ACCESS METHOD QSAM-      32900021
         BZ    ECM62000                 ..BRANCH IF NOT                 33000021
         OI    DCBIFLGS,DCBIFPIO        TURN ON PERM ERROR IND IN DCB   33100021
         B     ECM62000                 BR TO RETURN TO CALLER          33200021
         EJECT                                                          33201002
*****************************************************************Y02083 33202002
*        CONCATENATION-CHECK FOR CHECKPOINT DATA SET PROCESSING  Y02083 33203002
*****************************************************************Y02083 33204002
*                                                                Y02083 33205002
ECM60850 EQU   *                        CHECKPOINT BIT IN DSAB   Y02083 33205402
         L     R1,DXDSABAD              FETCH CURRENT DSAB ADDR  Y02083 33206002
         TM    DSABFLG4-DSAB(R1),DSABCKDS TEST FOR CHKPT D/S     Y02083 33207002
         BZ    ECM60900                 IF NOT, CONTINUE         Y02083 33208002
         L     R1,DSABFCHN-DSAB(R1)     FETCH NEXT DSAB ADDRESS  Y02083 33209002
         MODESET EXTKEY=SCHED           DSAB KEY                 Y02083 33210002
         OI    DSABFLG4-DSAB(R1),DSABCKDS PROPAGATE CHKPT STATUS Y02083 33211002
         MODESET EXTKEY=DATAMGT         BACK TO D/M KEY          Y02083 33212002
*********************************************************************** 33400021
*              CONCATENATED DATA SET PROCESSING                       * 33500021
*********************************************************************** 33600021
*                                                                       33700021
ECM60900 EQU   *                        RESET INDICATOR BITS            33800002
         OI    DCBOFLGS,DCBOCON         TURN ON EOV CONCATENATION IND   33900021
*                                                                       33920000
         TM    DCBOFLGS,DCBOUNLK        TEST FOR UNLIKE ATTRIBUTES-     34000021
         BO    ECM61900                 ..BR IF YES TO CLOSE DCB M0018  34100021
*                                                                       34105003
* TEST FOR JES SPOOLED SYSIN DATA SETS, MUST TREAT AS UNLIKE            34115003
* ATTRIBUTES IF ONE DATA SET IN A CONCATENTATED GROUP IS SPOOLED.       34120003
* NOTE THAT INPUT CONCATENATION TO SYSOUT IS INVALID, BUT               34125003
* IT IS ALLOWED TO SLIP THROUGH AND WILL BE ABENDED IN OPEN.            34130003
*                                                                       34135003
* TEST CURRENT DATA SET FOR SPOOLED INDICATOR                           34140003
         TM    TIOELINK,TIOESYIN+TIOESYOT  IS CURRENT SYSIN OR SYSOUT   34145003
         BM    ECM61900                 BR IF YES TO CLOSE AND OPEN     34150003
* TEST NEXT DATA SET                                                    34155003
         LR    R1,RD                    STEP TO NEXT ENTRY       Y02134 34160003
         TM    TIOELINK-TIOENTRY(R1),TIOESYIN+TIOESYOT  SYSIN OR SYSOUT 34165003
         BM    ECM61900                 BR IF YES TO CLOSE AND OPEN     34170003
*                                                                       34175003
         L     RET,TIOESTTB-TIOENTRY(,R1) LOAD NEXT UCB ADDRESS         34200021
         LA    RET,K0(,RET)             ZERO HIGH BYTE           YM5364 34250002
         LTR   RET,RET                  IS THE NEXT UCB A 'DUMMY'-      34300021
         BNZ   ECM61000                 ..BRANCH IF NOT                 34400021
         NI    DCBOFLGS,X'FF'-DCBOCON   TURN OFF CONCATENATION SWITCH   34500021
         B     ECM60500                 BR TO PROCESS AS EOD            34600021
         EJECT                                                          34700002
*********************************************************************** 34800021
*              PROCESS CONCATENATED DATA SETS WITH LIKE ATTRIBUTES    * 34900021
*********************************************************************** 35000021
*                                                                       35100021
ECM61000 EQU   *                        TURN OFF INDICATOR FOR EOD      35200002
         NI    DEBFLGS1,X'FF'-DEBF1EOF                           Y02080 35250002
         NI    DEBOFLGS,ALLBITS-DEBOFEOF TURN OFF EOF INDIC     ZA00120 35300002
*                                                                       36100003
         LA    R0,EABD176               LOAD INTERNAL ERROR CODE        36200003
         CLC   UCBTBYT3(K1),UCBTBYT3-UCB(RET) TEST FOR UNLIKE DEVICES-  36300021
         BNE   ECM62800                 ..BRANCH IF UNLIKE              36400021
*                                                                       36500021
         TM    UCBTBYT3,UCB3TAPE+UCB3DACC IS THIS A UNIT RECORD DEVICE- 36800021
         BZ    ECM61400                 ..BR IF YES- BYPASS SMF         36900021
*                                                                       36950021
*****          DETERMINE WHETHER OR NOT SMF PROCESSING IS REQUIRED      37000021
*                                                                       37050021
ECM61080 EQU   *                        GO TO SMF MODULE         M1782  37100002
         TM    DXXPATHS,WTGSMF          IS SMF PROCESSING REQ'D- A38013 37600021
         BNO   ECM61200                 ..BR IF NOT TO CONTINUE  A38013 38300021
         LA    RF,MODSMF2X              PT TO SMF MODULE'S NAME         39100021
         LA    RET,K4                   LD BR TABLE OFFSET FOR THAT MOD 39200021
         MVC   DXRETMOD,MOD2X2X         MOVE THIS MODULE'S ID/TTR       39300003
*                                       ..INTO RETURN ADDRESS SAVE AREA 39400021
         TM    UCBTBYT3,UCB3TAPE        IS THIS A TAPE DEVICE-          39500021
         BZ    ECM62300                 ..BR IF NOT TO GO TO SMF MODULE 39600021
         MVC   DXRETMOD,MOD2V2X         MOVE POSITIONING MOD ID/TTR     39700003
*                                       ..INTO RETURN ADDRESS SAVE AREA 39800021
         B     ECM62300                 BR TO LEAVE THIS MOD            39900021
*                                                                       40000021
*****          CONTINUE CONCATENATION FOLLOWING SMF PROCESSING          40100021
*                                                                       40200021
ECM61200 EQU   *                        REG 14 = 4 ENTRY - SMF RETURN   40500002
         LA    RF,MOD2V2X               PT TO POSITIONING MOD ID/TTR    40600021
         SR    RET,RET                  LD BR TABLE OFFSET FOR THAT MOD 40700021
         TM    UCBTBYT3,UCB3TAPE        IS THIS A TAPE DEVICE-          40800021
         BO    ECM62300                 ..BR IF YES- GO TO TAPE POS MOD 40900021
         L     RUCB,DXUCBADR            LOAD CURRENT UCB ADDRESS Y02134 41000002
         EJECT                                                          41050002
*****************************************************************Y02134 41150002
*                                                                Y02134 41200002
*        DECREMENT DATA MANAGEMENT COUNT                         Y02134 41250002
*                                                                Y02134 41300002
*****************************************************************Y02134 41500002
*                                                                Y02134 41550002
         L     R0,UCBOB+(((UCBDMCT-UCBOB)/K4)*K4) ALLIGN & LOAD  Y02134 41700002
*                                                                Y02134 41750002
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 41800002
*                                                                Y02134 41810002
         L     RF,DXXPREFX              LOAD PREFIX POINTER      Y02134 41812002
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE 15 REGS          Y02134 41814002
*                                                                Y02134 41816002
ECM61300 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02134X41820002
               RELATED=(LOCAL,IFG0552X(ECM61380))                Y02134 41830002
*                                                                Y02135 41840002
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 41842002
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGS          Y02134 41844002
         BZ    ECM61320                 BRANCH, NO ERROR         Y02134 41846002
*                                                                Y02134 41848002
         DMABCOND PCK,SETLOCK           SETLOCK ERROR            Y02134 41848402
*                                                                Y02134 41850002
ECM61320 EQU   *                        DECREMENT COUNT          Y02134 41900002
*                                                                Y02134 41950002
         LR    RF,R0                    SAVE CS OPERAND          Y02134 42000002
         SLL   RF,K25                   LEAVE ONLY UCBDMCT COUNT Y02134 42050002
         LTR   RF,RF                    TEST FOR COUNT OF 0      Y02134 42100002
         BZ    ECM61340                 BRANCH IF ALREADY 0      Y02134 42150002
*                                                                Y02134 42200002
         LR    R1,R0                    LOAD OLD VALUE TO MODIFY Y02134 42250002
         SH    R1,HALFWD1               ADD DECREMENT TO COUNT   Y02134 42300002
         CS    R0,R1,UCBOB+(((UCBDMCT-UCBOB)/K4)*K4) UPDAT COUNT Y02134 42350002
         BNE   ECM61320                 BRANCH IF NOT THE SAME   Y02134 42400002
         OI    DXATEOV,DXATNVOL         INDIC CURR UNIT INACTIVE YM6520 42410002
         EJECT                                                          42450002
ECM61340 EQU   *                        LOCAL LOCK STILL HELD    Y02134 42460002
*                                                                       42461002
*        WICLOSE VIO UNIT IF D. M. COUNT NOW ZERO                Y02132 42462002
*                                                                       42470002
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02134 42470402
         BNO   ECM61360                 BRANCH IF NOT VIO        Y02134 42470802
*                                                                Y02134 42471202
         TM    UCBDMCT,UCBDMC           TEST FOR ANY USERS       Y02134 42471602
         BNZ   ECM61360                 BRANCH IF STILL IN USE   Y02134 42471702
         L     RD,DXXPREFX              LOAD SAVE AREA POINTER   Y02134 42474202
         LA    RD,IECREGSV-IECPREFX(,RD) PT TO REGSAVE AREA      Y02132 42474302
         LA    R1,VDSUCB-VDSCB(,RUCB)   GET VDSCB POINTER        Y02134 42474402
*                                                                Y02134 42474502
         WICLOSE VDSCB=(1)              CALL VIO CLOSE           Y02134 42474802
*                                                                Y02134 42475602
ECM61360 EQU   *                        RELEASE LOCK             Y02134 42475702
*                                                                Y02134 42475902
         L     RF,DXXPREFX              LOAD PREFIX POINTER      Y02134 42476302
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE 15 REGS          Y02134 42476702
*                                                                Y02134 42477102
ECM61380 SETLOCK RELEASE,TYPE=LOCAL,                             Y02134X42478002
               RELATED=(LOCAL,IFG0552X(ECM61300))                Y02134 42478402
*                                                                Y02135 42478802
         LTR   RD,RD                    TEST FOR SETLOCK ERROR   Y02134 42479202
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGS          Y02134 42479602
         BZ    ECM61390                 BRANCH, NO ERROR         Y02134 42479702
*                                                                Y02134 42479902
         DMABCOND PCK,SETLOCK           SETLOCK ERROR            Y02134 42480002
*                                                                Y02134 42483202
ECM61390 EQU   *                        RETURN TO DM KEY         Y02134 42485202
*                                                                Y02134 42485602
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 42486702
*                                                                Y02134 42490002
         EJECT                                                          42494002
*                                                                M0071  42500021
*****          INITIALIZE DCB AND DEB FOR NEW DATA SET           M0071  42550021
*                                                                M0071  42600021
         SR    RD,RD                    CLEAR WORK REGISTER             42700021
         IC    RD,DEBNMEXT              LOAD TOTAL NO. OF EXTENTS       42800021
         SLL   RD,K4                    CALC LENGTH OF THESE EXTENTS    43000021
         AR    RD,RDEB                  ..AND ADD DEB BASE ADDRESS      43100021
         MVI   DEBBASND-DEBBASIC+(DEBVOLSQ-DEBACSMD)+K1(RD),K1   Y02134 43200002
*                                       SET DEB VOLUME SEQ. TO 1 Y02134 43220002
*                                                                       43250003
ECM61400 EQU   *                        GET CURRENT DSAB ADDRESS        43300002
         L     R1,DXDSABAD              GET CURRENT DSAB         Y02134 43420002
         USING DSAB,R1                                           Y02134 43440002
*                                                                       43860002
*   CHAIN TO NEXT DSAB: UPDATE WORKAREA POINTERS, DCB,DEB, DEBX  Y02134 43880002
*                                                                       43900002
         L     R1,DSABFCHN              GET NEXT DSAB            Y02134 43920002
         ST    R1,DXDSABAD              STORE IN WORKAREA        Y02134 43940002
         ST    R1,DXDSAB                CURRENT DSAB ADDR        Y02134 43960002
         L     RTIOT,DSABTIOT           NEW TIOT ENTRY ADDR      Y02134 43980002
         ST    RTIOT,DXTIOTAD           STORE IN WORKAREA        Y02134 44000002
         L     RUCB,TIOESTTB            GET FIRST UCB ADDR       YM5741 44050002
         LA    RUCB,K0(,RUCB)           CLEAR HIGH BYTE          YM5741 44060002
         ST    RUCB,DXUCBADR            UPDATE UNIT ADDRESS      YM5741 44070002
         L     RF,DXDEBXAD              GET DEB EXTENSION        Y02134 44080002
         USING DEBXTN,RF                                         Y02134 44100002
         MVC   DEBXDSAB,DXDSABAD        UPDATE DEB EXTENSION'S   Y02134 44120002
*                                       DSAB ADDRESS             Y02134 44140002
         DROP  RF                                                Y02134 44160002
         L     RF,DXTCBADR              GET CURRENT TCB ADD      Y02134 44180002
         L     RF,TCBTIO-TCB(RF)        START OF TIOT ADDRESS    Y02134 44200002
         SR    RTIOT,RF                 NEW TIOT ENTRY OFFSET    Y02134 44220002
         STH   RTIOT,DCBTIOT            STORE IN DCB             Y02134 44240002
         L     RTIOT,DXTIOTAD           RESTORE TIOT ADDRESS     Y02134 44260002
         MODESET EXTKEY=SCHED           ASSUME SCHED KEY         Y02082 44650002
         OI    DSABFLG2,DSABOPEN        SET OPEN BIT IN DSAB     Y02134 44680002
         MODESET EXTKEY=DATAMGT         ASSUME DATA MGT KEY      Y02082 44730002
         LA    RF,MOD1F2X               PT TO INITIAL MODULE'S ID/TTR   44900021
         LA    RET,K8                   BR TABLE ENTRY           YM5364 45000002
         B     ECM62300                 BR TO RETURN TO INITIAL ROUTINE 45100021
*                                       ..TO INITIALIZE WORK AREA FOR   45200021
*                                       ..CONCATENATED DCB              45300021
         EJECT                                                          45350002
*                                                                       45400021
*****          RETURN FROM THE INITIAL ROUTINE- COMPLETE PROCESSING     45500021
*****          ON UNIT RECORD CONCATENATION                             45550002
*****          AND RETURN TO THE CALLER OR THE ACCESS METHOD EXECUTOR   45600021
*                                                                       45700021
ECM61600 EQU   *                        REG 14 = 16 ENTRY               45800002
         NI    DEBOFLGS,X'FF'-DEBOFEOF  RESET DEB EOF INDICATOR         45900021
         L     RTIOT,DXTIOTAD           GET CURRENT TIOT ENTRY   YM1278 45950002
         MVC   DEBSUCBA+K1(L'TIOEFSRT),TIOEFSRT PLACE NEW UNIT   YM1278 45960002
*                                       ADDRESS IN DEB           YM1278 45970002
         NI    DCBOFLGS,X'FF'-DCBOCON   CLEAR CONCATENATION INDICATOR   46100021
         TM    DCBMACRF,DCBMEXCP        IS THE ACCESS METHOD EXCP-      46200021
         BO    ECM62000                 ..BR IF YES TO RETURN TO CALLER 46300021
         MVC   DXXMODID,MOD1L2X         MOVE ACCESS METHOD EXECUTOR     46400003
*                                       ..ID INTO WTG TABLE      Y02080 46500002
         MVC   DXXMODEP+K1(K3),MOD1L2X+K2 MOVE ACCESS METHOD EX. Y02080 46550003
*                                       ..EPA INTO WTG TABLE     Y02080 46560002
         B     ECM62200                 BR TO XCTL TO A/M EXECUTOR      46600002
         EJECT                                                          47800002
*                                                                       47920021
*********************************************************************** 47940021
*              MODIFY THE USER'S RESUME PSW SO THAT AN 'EXIT' IS TO   * 47960021
*              TO THE USER RATHER THAN AN ACCESS METHOD MODULE        * 47980021
*********************************************************************** 48000021
*                                                                       48020021
ECM61800 EQU   *                        BUSY BIT OFF ENTRY/RETURN       48040002
*                                       FROM IFG0554J ENTRY             48054002
         TM    DCBMACRF,DCBMEXCP        IS THIS AN EXCP DCB-     A45247 48060021
         BO    ECM61900                 ..BR IF YES- RESUME PSW  A45247 48080021
*                                       ..ADDRESS IS CORRECT     A45247 48100021
         TM    DCBCIND2,DCBC2FEO        WAS FEOV ISSUED-         A45247 48120021
         BO    ECM61900                 ..BR IF YES- RESUME PSW  A45247 48140021
*                                       ..ADDRESS IS CORRECT     A45247 48160021
         L     RD,RBLINK                PT TO THE PREVIOUS REQUEST BLK  48300021
         L     RC,RBGRS13               USER SAVE AREA ADDRESS  YA01870 48318002
         MODESET KEYADDR=DXUKEY,WORKREG=15 ASSUME USER KEY      YA01870 48320002
         L     RC,K20(,RC)              REG 14 IN USER SAVEAREA YA01870 48322002
         MODESET EXTKEY=SUPR            SVRB KEY                YA01870 48324002
         STCM  RC,B'0111',RBOPSW+K5-RBSECT(RD) STORE RETURN     YA01870 48326002
*                                       ADDR IN RESUME PSW      YA01870 48328002
         EJECT                                                          48600003
ECM61900 EQU   *                        UNLIKE ATTRIBUTES CONCATENATION 49700002
         MODESET EXTKEY=DATAMGT         ASSUME DATA MGT KEY     YA01870 49702002
         L     RF,DXXPREFX              GET PTR TO PREFIX        Y02082 49999702
         USING IECPREFX,RF              DEFINE WORK AREA PREFIX  Y02080 50049702
         L     R1,IECUPRML              CLOSE PARM LIST PT IN R1 Y02080 50099702
         L     RF,IECRRPRM-IECPREFX(RF) GET ADDR OF RECOVERY     Y02144 50109702
         USING RRPLIST,RF               ESTABLISH BASE           Y02144 50119702
         XC    RRPLIST+K1(K23),RRPLIST+K1  ZERO RECOVERY PARMS   Y02144 50129702
         XC    DXATCOM1(K8),DXATCOM1    EXCEPT RRFUNCTN          Y02144 50139702
         XC    DXATCOM4(K12),DXATCOM4   AND ADDR OF RRPLIST      Y02144 50141702
         DROP  RF                                                Y02080 50149702
*                                                                Y02082 50150102
*****    SET UP FOR ENTRY TO THE 'CLOSE' ROUTINE AT SECONDARY    Y02082 50150502
*****    ENTRY POINT IGC01020.  BIT 7 OF DCBOFLGS IS NOT RESET.  Y02082 50150902
*                                                                Y02082 50151402
         MVC   DXXMODNM(K12),CONLOAD    MOVE MODULE NAME AND EPA Y02082 50153602
         OI    DXATCOM2,DXATCCAT        EOV GOING TO CLOSE       Y02144 50201702
         B     ECM62200                 BR TO GO TO 'CLOSE'      Y02082 51700002
*                                                                Y02082 51710002
         USING UCB,RUCB                 ESTABLISH UCB ADDRESSABILITY    51800021
         EJECT                                                          51900021
*********************************************************************** 52000021
*              EXITS                                                  * 52100021
*********************************************************************** 52200021
*                                                                       52300021
*****          EXIT TO THE USER                                         52400021
*                                                                       52500021
ECM62000 EQU   *                        FREE WORKAREA                   52600002
*                                                                Y02080 52753202
         TM    TIOELINK,TIOESYIN+TIOESYOT  TEST FOR SPOOLED DS   YM1306 52763603
         BM    ECM62050                 AVOID POINTING DEB       YM1306 52764002
*                                                                Y02080 52765202
         MVC   DEBDCBAD+K1(L'DEBDCBAD-K1),DXUDCBAD+K1 POINT DEB  Y02082*52766202
                                        TO USER DCB              Y02082 52767202
         L     RF,DXDEBXAD              GET PTR TO DEB EXTN      YM1272 52787202
         NI    DEBXFLG1-DEBXTN(RF),ALLBITS-DEBXCDCB DEB PT USER  YM1272 52797202
ECM62050 EQU   *                        REFRESH USER DCB         Y01018 52817202
         NI    DCBOFLGS,X'FF'-DCBOBUSY  RESET I/O SUPPORT BIT IN DCB    53200021
         IECRES INIT,DCBCOPY=FRWKAR,STM=(3,14,DXXPREFX)          Y02082 53210002
         IECRES FREE,A=(RCORE),PREFIX=EOV RELEASE EOV WORK AREA  Y02080 53250002
         LR    RF,RUCB                  PLACE RET CODE IN REG 15 (ONLY  53260002
*                                       ..MEANINGFUL FOR THE EOD EXIT)  53270002
         IECRES EXIT                    RETURN                   Y02080 53460002
         EJECT                                                          53470002
*                                                                Y02080 53490002
*****          XCTL TO THE 'CLOSE' ROUTINES TO CLOSE THE DATA SET       54300021
*                                                                       54400021
ECM62200 EQU   *                        UPDATE DEBDCBAD IF NOT SPOOLED  54500002
         TM    TIOELINK,TIOESYIN+TIOESYOT  CHECK FOR SPOOLED     YM1272 54550003
         BM    ECM62250                 BR IF SPOOLED            YM1272 54560002
         MVC   DEBDCBAD+K1(L'DEBDCBAD-K1),DXUDCBAD+K1 POINT DEB  YM1272*54570002
                                        TO USER DCB              YM1272 54580002
         L     RF,DXDEBXAD              GET PTR TO DEB EXTN      YM1272 54590402
         NI    DEBXFLG1-DEBXTN(RF),ALLBITS-DEBXCDCB DEB PT USER  YM1272 54590802
ECM62250 EQU   *                        ENTER CLOSE              YM1272 54591202
*                                                                       54591602
*        COPY BACK PROTECTED DCB TO USER DCB TO UPDATE THE       YM3190 54642002
*        USER DCB WITH THE MODIFICATIONS MADE TO IT BY EOV,      YM3190 54692002
*        SUCH AS THE CONCATENATION BIT IN DCBOFLGS               YM3190 54694002
*                                                                       54696002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(0,14,DXXPREFX)          YM3190 54698002
*                                                                       54698802
*        GIVE CLOSE CONTROL                                      YM3190 54699202
*                                                                       54699602
         IECRES LOAD,PREFIX=DXXPREFX,BRANCH=DIRECT               YM3190 54699702
         EJECT                                                          54700002
*                                                                       54800021
*****          XCTL TO ANOTHER END-OF-VOLUME MODULE                     54900021
*                                                                       55000021
ECM62300 EQU   *                        GO TO NEXT MODULE               55100002
         IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED       Y02080*55250002
                                     INVOKE IECRES MACRO TO XCTL Y02080 55260002
         SPACE 2                                                        55300002
*                                                                       61200002
*****          ERROR PROCESSING EXIT                                    61300002
*                                                                       61500021
ECM62800 EQU   *                        GO TO PROBLEM DETERMINATION     61600002
         DMABCOND (0),ABEND2X           INVOKE ERROR PROCESSING RTNS    61700003
         EJECT                                                          61800002
*********************************************************************** 61900021
*              CONSTANTS                                              * 62000021
*********************************************************************** 62100021
*                                                                       62200021
HALFWD1  DC    H'1'                     EXIT LIST AND DM COUNT   Y02132 62300002
EOVMARK  DC    C'EOV'                   END-OF-VOLUME LABEL IDENTIFIER  62700021
         EJECT                                                          63900021
*********************************************************************** 64000021
*              XCTL TABLE                                             * 64100021
*********************************************************************** 64200021
*                                                                       64300021
XCTLTB2X XCTLTABL ID=(ABEND2X,0P,MOD1F2X,1F,MOD1L2X,1L,MOD2V2X,2V,     C64530000
               MOD2X2X,2X,MODSMF2X,3B,CONLOAD,IGC01020),         Y02082C64540002
               SVC=055,BRT=YES,LENGTH=                           Y02082 64542002
         SPACE 2                                                        64600021
         IECDSECS CVT,                                                 C64700021
               TCB,                                                    C64800021
               RB,                                                     C64900021
               TIOT,                                                   C65000021
               DCB,                                                    C65200021
               IEZDEB,                                           Y02134*65300002
               UCB,                                                    C65400021
               (MAIN,(IOB,NO)),                                 ZA01289X65500002
               IOB,                                             ZA01289X65550002
               WTG,                                                    C65600021
               DSAB,                                             Y02134*65620002
               PREFX,                                            Y02080*65650002
               PSA,                                              Y02132*65650202
               RRPL,                                             Y02144*65660202
               EXPAND=YES                                               65700021
         IDDVDSCB                                                Y02132 65700202
ALLOWIO  EQU   X'80'                    ALLOW CHAINED SCHED I/O ZA01289 65932002
         IECEQU IEZDEB=YES                                       Y02134 65950003
         END                                                            66100021
