         TITLE 'IFG0553P                      EOV INPUT DA INITIAL MODUL00400002
               LE'                                               Y02134 00450002
IFG0553P CSECT                                                          00650002
*********************************************************************** 00700002
*                                                                     * 00750002
*                                                                     * 00800002
*          VS2 RELEASE 03 DELETIONS                                   * 00810037
*0000450420,451960,457800                                      @ZA01342 00820037
*0000                                                          @ZA08315 00830037
*0000                                                          @ZA13566 00840037
*A45190803,45190804                                            @ZA33029 00845037
*          VS2 RELEASE 02 DELETIONS                                   * 00850002
*                                                                     * 00900002
*                                                                     * 00950002
*********************************************************************** 01000002
*                                                                     * 01050002
* MODULE NAME = IFG0553P (OS/VS2)                                     * 01100002
*                                                                     * 01150002
* DESCRIPTIVE NAME = EOV INPUT DA INITIAL MODULE                      * 01200002
*                                                                     * 01250002
* COPYRIGHT = NONE                                                    * 01300002
*                                                                     * 01350002
* STATUS = RELEASE 2, LEVEL 0                                         * 01400002
*                                                                     * 01450002
* FUNCTION =                                                          * 01500002
*        ENTERED FROM IFG0551H - EOV INITIALIZATION                   * 01550002
*        IFG0554L - RETURN FROM USER TRAILER LABEL PROCESSING         * 01600002
*        IFG0202I - RETURN FROM SMF PROCESSING                        * 01650002
*                                                                     * 01700002
*        1) SETUP WORKAREA DEB REFLECTING UNIT CURRENTLY              * 01750002
*        BEING PROCESSED.                                             * 01800002
*                                                                     * 01850002
*        2) EXIT TO IFG0554L TO PROCESS USER TRAILER LABELS,          * 01900002
*        SETTING BITS 5 AND 6 OF JFCBMASK+5 TO ONE. USER LABEL        * 01950002
*        PROCESSING IS BYPASSED IF FEOV, DCBDSORG IS NOT PS, OR       * 02000002
*        USER LABELS HAVE ALREADY BEEN PROCESSED IN A                 * 02050002
*        PREVIOUS PASS THROUGH EOV FOR VBS UPDATE.                    * 02100002
*                                                                     * 02150002
*        IFG0554L IS GIVEN CONTROL IF -                               * 02200002
*        AN 03 EXIT EXISTS IN THE EXIT LIST AND EITHER AN             * 02250002
*        EOF CONDITION IS NOT PRESENT, OR AN EOF CONDITION IS         * 02300002
*        PRESENT AND AN 0C EXIT DOES NOT EXIST.                       * 02350002
*        AN 0C EXIT EXISTS IN THE EXIT LIST AND AN 03 EXIT DOES       * 02400002
*        NOT EXIST.                                                   * 02450002
*                                                                     * 02500002
*        3) AFTER RETURNING FROM IFG0554L OR IF USER LABEL            * 02550002
*        PROCESSING IS NOT REQUIRED, AN EXIT IS MADE TO IFG0552X      * 02600002
*        IF NO MORE VOLUMES ARE PRESENT IN THE JFCB OR, AFTER         * 02650002
*        READING THE FORMAT 1 DSCB, IF THE LAST VOLUME BIT (BIT 0     * 02700002
*        IN DSCDSIND) IS ON IN THE DSCB.                              * 02750002
*                                                                     * 02760002
*        4) IF NOT EOF AND SMF PROCESSING IS REQUIRED, MODULE         * 02800002
*        IFG0553B (ALIAS NAME FOR IFG0202H) IS GIVEN CONTROL.         * 02850002
         EJECT                                                          02900002
*        5) AFTER RETURNING FROM SMF PROCESSING (MODULE IFG0202I)     * 02950002
*        OR IF SMF PROCESSING IS NOT REQUIRED, THE DATA MANAGEMENT    * 03000002
*        COUNT IN THE CURRENT VOLUME'S UNIT IS DECREMENTED.           * 03050002
*        IF THE DATA MANAGEMENT COUNT DROPS TO ZERO FOR A VIO         * 03050202
*        UNIT, A WICLOSE IS ISSUED.                                   * 03050402
*                                                                     * 03060002
*        6) DXVOLSEQ IS INCREMENTED BY ONE AND MODULE IFG0554A (ALIAS * 03100002
*        NAME FOR IFG0194A) IS GIVEN CONTROL TO MOUNT AND VERIFY THE  * 03150002
*        NEXT VOLUME AND READ THE DSCB(S), AND PASS CONTROL TO        * 03200002
*        MODULE IFG0553X.                                             * 03250002
*                                                                     * 03300002
* NOTES = SEE BELOW                                                   * 03350002
*                                                                     * 03400002
*    DEPENDENCIES =                                                   * 03450002
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 03500002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 03550002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 03600002
*                                                                     * 03650002
*    RESTRICTIONS = NONE                                              * 03700002
*                                                                     * 03750002
*    REGISTER CONVENTIONS =                                           * 03800002
*            R2 POINTS TO DCB                                         * 03850002
*            R4 POINTS TO OPEN WORK AREA                              * 03900002
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 03950002
*            R6 POINTS TO THE WTG TABLE                               * 04000002
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 04050002
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 04100002
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 04150002
*            R10 POINTS TO THE UCB                                    * 04200002
*                                                                     * 04250002
*    PATCH LABEL = SEE THIRD FROM LAST LABEL BEFORE ORG STATEMENT AT  * 04300002
*                  END OF LISTING.                                    * 04350002
*                                                                     * 04400002
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 04450002
*                                                                     * 04500002
*    PROCESSOR = ASSEMBLER XF                                         * 04550002
*                                                                     * 04600002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 04650002
*                  ORG STATEMENT AT END OF LISTING                    * 04700002
*                                                                     * 04750002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 04800002
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 04850002
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 04900002
*                                                                     * 04950002
* ENTRY POINT = IFG0553P                                              * 05000002
*                                                                     * 05050002
*    PURPOSE = SEE FUNCTION                                           * 05100002
*                                                                     * 05150002
*    LINKAGE =                                                        * 05200002
*        THIS MODULE IS PASSED CONTROL THROUGH THE IECRES-LOAD MACRO. * 05250002
         EJECT                                                          05300002
* INPUT =                                                             * 05350002
*        ENTERED IN PROTECT KEY 5.                                    * 05400002
*        REGISTER 2 POINTS TO THE COPIED DCB.                         * 05450002
*        REGISTER 4 POINTS TO THE EOV WORKAREA.                       * 05500002
*        THE DEBDCBAD POINTS TO THE COPIED DCB.                       * 05550002
*        JFCBMASK+5 BITS 5 AND 6 SET TO ONE IF RETURN FROM IFG0554L.  * 05600002
*        REGISTER 14 CONTAINS ENTRY CODE -                            * 05650002
*              0 - ENTERED FROM IFG0551H.                             * 05700002
*              4 - RETURN FROM SMF PROCESSING MODULE IFG0202I.        * 05750002
*                                                                     * 05800002
* OUTPUT =                                                            * 05850002
*        CURRENT VOLUME'S DSCB READ (EXCEPT TO IFG0552X)              * 05900002
*        DXVOLSEQ UPDATED (IFG0554A)                                  * 05950002
*        DATA MANAGEMENT COUNT DECREMENTED ON CURRENT                 * 06000002
*              VOLUME AND WICLOSE IF VIO (IFG0554A)                   * 06050002
*        REGISTER 14 CONTAINING ENTRY CODE -                          * 06100002
*              IFG0552X - 0                                           * 06150002
*              IFG0553B - 4, ALSO USED AS RETURN CONTENTS OF REG 14   * 06200002
*        DXRETMOD INDICATING IFG0553P (IFG0554L, IFG0553B)            * 06250002
*        DXRETMOD INDICATING IFG0553X (IFG0554A)                      * 06300002
*                                                                     * 06350002
* EXIT-NORMAL =                                                       * 06400002
*        IFG0552X - END OF FILE CONDITION.                            * 06450002
*        IFG0554L - USER TRAILER LABEL PROCESSING.                    * 06500002
*        IFG0553B - SMF PROCESSING.                                   * 06550002
*        IFG0554A - MOUNT AND VERIFY NEXT VOLUME.                     * 06600002
*                                                                     * 06650002
* EXIT-ERROR =                                                        * 06700002
*        IFG0550P - PROBLEM DETERMINATION WITH INTERNAL ABEND CODE    * 06750002
*        IN REGISTER 0 -                                              * 06800002
*        175 - INDICATING 737-14 ABEND, I/O ERROR READING DSCB.       * 06850002
         EJECT                                                          06900002
* EXTERNAL REFERENCES = SEE BELOW                                     * 06950002
*                                                                     * 07000002
*    ROUTINES = IFG019RA THROUGH IECRES MACRO.                        * 07050002
*                                                                     * 07100002
*    DATA AREAS =                                                     * 07150002
*        EOV WORKAREA.                                                * 07200002
*                                                                     * 07250002
*    CONTROL BLOCK =                                                  * 07300002
*        DEB                                                          * 07350002
*        UCB                                                          * 07400002
*        CVT                                                          * 07450002
*        DCB                                                          * 07500002
*        VDSCB                                                        * 07550002
*                                                                     * 07600002
* TABLES =                                                            * 07650002
*        DEVICE CHARACTERISTICS TABLE                                 * 07700002
*        DCB EXIT LIST                                                * 07750002
*                                                                     * 07800002
* MACROS =                                                            * 07850002
*        MODESET                                                      * 07900002
*        EXCP                                                         * 07950002
*        IECRES WAIT                                                  * 08000002
*        IECRES-LOAD                                                  * 08050002
*        DMABCOND                                                     * 08100002
*        XCTL                                                         * 08150002
*        IECDSECS                                                     * 08200002
*        IECEQU                                                       * 08250002
*        IDDVDSCB                                                     * 08300002
*                                                                     * 08350002
* CHANGE ACTIVITY =                                                   * 08400002
*        SEE CHANGES/DELETIONS SECTION JUST AFTER CSECT CARD          * 08450002
*                                                                     * 08500002
*********************************************************************** 08550002
         EJECT                                                          08600002
ERR175   EQU   175                      ABEND CODE - 737-04             08650002
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        31200021
         USING FORCORE,RCORE                                            31400021
         USING WTG,RWTG                 BASE FOR WTG TABLE       Y02080 31450002
         USING TIOENTRY,RTIOT                                           31600021
         USING UCB,RUCB                                                 31800021
         USING DEB,RDEB                                                 32000021
         USING IHADCB,RDCB                                              32200021
         USING *,RBASE                                                  32400021
         SPACE 2                                                        32450002
         L     RDEB,DCBDEBAD            ADDRESS OF USER'S DEB           32600021
         TM    JFCBMASK+K5,K6           TEST,BR IF RETURNING FROM       32800021
         BO    EDI00600                 UL PROCESSING                   33000021
         B     EDI00000(RET)            BR, ACCORDING TO RETURN CODE    33200021
EDI00000 B     EDI00050                 FROM EOV BASIC                  33400021
         B     EDI01450                 FROM SMF                        33600021
EDI00050 EQU   *                        INITIAL ENTRY                   33800002
         L     RUCB,DXUCBADR            LOAD CURRENT UCB         Y02134 34200002
         SPACE 1                                                        34400021
*                                                                       39000021
*                   SET UP THE WORK AREA DEB FOR OTHER DA DEVICES       39200021
*                                                                       39400021
         MVC   DXDEBUCB+K1(K3),DXUCBADR+K1                       Y02134 39800002
*                                       PLACE UCB ADDRESS IN WORK DEB   40000021
         MVC   DXDEBSCC(K10),COLCDU0I   CREATE DUMMY EXTENT IN WORK DEB 40200021
         L     R7,CVTPTR                GET CVT ADDRESS          M0983  40250021
         L     R7,CVTZDTAB-CVT(,R7)     GET ADDR OF I/O DEVICE   M0983  40300021
*                                       TABLE                    M0983  40350021
         XR    R1,R1                    CLEAR REG FOR OFFSET     M0983  40352021
         IC    R1,UCBTBYT4              GET UCB DEVICE TYPE      M0983  40360021
         IC    R1,0(R1,R7)              INDEX TO DEVICE OFFSET   M0983  40370021
*                                       BYTE                     M0983  40380021
         AR    R7,R1                    ADDR OF DEVICE ENTRY IN  M0983  40390021
*                                       TABLE                    M0983  40392021
         MVC   DXDEBECC(K4),0(R7)       SET MAX EXTENT FROM      M0983  40394021
*                                       DEVICE TABLE             M0983  40396021
         EJECT                                                          40446002
*                                                                       41000021
*****    FORCE END VOLUME PROCESS - SKIP USER LABEL PROCESSING          41200002
*                                                                       41400021
         TM    DCBMACRF,DCBMEXCP        TEST FOR EXCP           SA59750 41450002
         BO    EDI00075                 BRANCH IF EXCP          SA59750 41500002
         TM    DCBCIND2,DCBC2FEO        IS THIS FEOV- FORCE END OF VOL  41800021
         BO    EDI00800                 YES,GO TO EOV                   42000021
*                                                                       43200021
***********    USER TRAILER LABEL PROCESSING SECTION                    43400021
*                                                                       43600021
*        DCBIOBAD CAN BE TESTED ONLY IF NOT CHAINED SCHEDULING   YM1194 43650002
*        AND NOT EXCP                                            YM1194 43700002
*                                                                       43710002
         TM    DCBCIND2,DCBC2CHN        CHAINED SCHEDULING TEST  YM1194 43770002
         BO    EDI00075                 BRANCH IF YES            YM1194 43780002
         CLC   DCBIOBAD,MASKFL0I        HAS UL BEEN PROCESSED           43800021
         BNE   EDI00800                 BRANCH IF YES                   44000021
EDI00075 EQU   *                        TEST FOR USER LABELS     YM1194 44050002
         TM    JFCBLTYP,JFCSUL          TEST,BR IF USER HAS NOT         44200021
*                                       SPECIFIED                       44400021
         BNO   EDI00800                 'SUL' LABEL TYPE                44600021
         TM    DCBMACRF,DCBMEXCP        IS IT EXCP               YM1194 44610002
         BNO   EDI00077                 BRANCH IF NO             YM1194 44620002
         TM    DCBMACRF,DCBMRFE         IS DCBEXLST PRESENT      Y02080 44630002
         BNO   EDI00800                 BRANCH IF NO             Y02080 44640002
         TM    DCBMACRF,DCBMRCI         IS DSORG PRESENT         YM1194 44650002
         BO    EDI00080                 BRANCH IF NO             YM1194 44700002
EDI00077 EQU   *                        SUL ONLY FOR PS          YM1194 44750002
         TM    DCBDSORG,DCBORGPS        TEST,BR IF DSORG IS NOT         44800021
         BZ    EDI00800                 PHYSICAL SEQUENTIAL             45000021
         EJECT                                                          45000302
*                                                                       45001102
*        USER LABEL PROCESSING - CHECK FOR END OF FILE                  45001402
*                                                                       45001702
EDI00080 EQU   *                        EOF TEST                 YM1194 45002002
*                                                                Y02134 45030002
         CLC   JFCBNVOL,DXVOLSEQ+K1     CHECK FOR EOF            Y02134 45040002
         BNH   EDI00235                 BRANCH IF EOF          @ZA01342 45042037
EDI00150 EQU   *                        NOT EOF                  Y01234 45049802
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 45064802
         BNO   EDI00175                 BR IF NOT                Y02132 45067802
*        CALL SUBROUTINE TO READ VIO DSCB FROM SWA               Y02132 45070802
         BAL   RD,EDI01250              GO READ VIO DSCB         Y02132 45073802
*                                                                Y02132 45076802
         B     EDI00200                 CONTINUE PROCESSING      Y02132 45077402
EDI00175 EQU   *                        READ REAL DSCB           Y02132 45078002
*                                                                Y02134 45079802
         BAL   RD,EDI02200              BUILD CHANNEL PROGRAM   SA57255 45170021
*                                       TO READ F1 DSCB         SA57255 45180021
         BAL   RD,EDI01200              READ F1 DSCB            SA57255 45190021
         BNO   EDI01300                 BR IF I/O ERROR ON READ SA57255 45190421
EDI00200 EQU   *                        SEE IF LAST VOLUME       Y02132 45190502
         OI    DXATDACC,DXATRDDB        SHOW DSCB READ           Y02144 45190802
         CLI   DSCFMTID,CHAR4           CHECK IF OPEN TO VTOC  @ZA33029 45191237
         BE    EDI00240                 TREAT AS EOV IF YES    @ZA33029 45191637
         TM    DSCDSIND,LASTNTRY        TEST LAST VOLUME BIT    SA57255 45192021
*                                       TO DETERMINE EOF OR EOV SA57255 45194021
         BNO   EDI00240                 IF NOT LAST VOL-EOV    @ZA01342 45196037
EDI00235 EQU   *                                               @ZA01342 45196437
         L     R1,DXDSABAD              GET CURRENT DSAB       @ZA01342 45196837
         USING DSAB,R1                                         @ZA01342 45197237
         L     R1,DSABFCHN              GET NEXT DSAB          @ZA01342 45197637
         LTR   R1,R1                    IS THERE ANOTHER DSAB? @ZA01342 45197737
         BZ    EDI00250                 NO, BR (EOF)           @ZA01342 45197837
         L     R1,DSABTIOT              GET NEXT TIOT ENTRY    @ZA01342 45197937
         CLI   TIOEDDNM-TIOENTRY(R1),BLANK IS DDNAME BLANK?    @ZA01342 45231537
         BNE   EDI00250                 NO, BR (EOF)           @ZA01342 45251537
         TM    TIOELINK-TIOENTRY(R1),TIOESYIN+TIOESYOT IS IT   @ZA01342 45261537
*                                       A SPOOLED DATA SET?    @ZA01342 45263537
         BM    EDI00250                 YES, BR (EOF)          @ZA01342 45265537
         TM    DCBOFLGS,DCBOUNLK        UNLIKE CONCATENATION?  @ZA01342 45276737
         BO    EDI00250                 YES, BR (EOF)          @ZA01342 45286737
         L     RF,TIOESTTB-TIOENTRY(R1) GET CONC UCB ADDR      @ZA01342 45287137
         LA    RF,K0(RF)                CLEAR HIGH ORDER BYTE  @ZA01342 45287537
         LTR   RF,RF                    DUMMY DATA SET?        @ZA01342 45287937
         BZ    EDI00250                 YES, BR (EOF)          @ZA01342 45291637
EDI00240 EQU   *                                               @ZA01342 45293637
*                                                                       45295537
*        NOT EOF - SETUP TO SEARCH FOR 03 EXIT, THEN 0C                 45299237
*                                                                       45332837
         LA    RF,EDI01000              RETURN ADDR IF NOT SUR EXIT 03  45366437
         LA    R7,ULEXIT                ADDR OF UL EXIT CODE BYTE 03    45400021
         LA    R1,EDI00500              EXIT ADDR IF CODE MATCH         45600021
         LA    RET,K2                   SET INCR VALUE TO 1     SA55619 45650002
         B     EDI00300                 BR TO TEST UL EXIT      SA55619 45700000
*                                                                       45710002
*        EOF - SETUP TO SEARCH FOR 0C EXIT, THEN 03                     45720002
*                                                                       45730002
EDI00250 EQU   *                        SETUP IF EOF            SA55619 45750002
         LA    RF,EDI01000              RETURN ADDR IF          SA55619 45760000
*                                       NOT UL EXIT             SA55619 45762000
         LA    R7,SULDFR0I              ADDR OF UL DEFER CODE   SA55619 45770000
         LA    R1,EDI00900              EXIT ADDR IF CODE MATCH@ZA01342 45780037
         LA    RET,K2                   SET INCR VALUE TO -2    SA55619 45790002
         LNR   RET,RET                                          SA55619 45792000
         EJECT                                                          45794002
EDI00300 EQU   *                        GET EXIT LIST ENTRIES FOR       45800021
*                                       COMPARE                         46000021
         L     RC,DCBEXLST              PICK UP EXIT LIST FROM DCB      46200021
         LA    RC,0(,RC)                ZERO HI ORDER BYTE OF EXIT LIST 46400021
         LTR   RC,RC                    IS EXIT LIST ZERO               46600021
         BZ    EDI00800                 YES, BRANCH             SA57255 46800021
EDI00400 EQU   *                        TRY TO FIND EXIT LIST ENTRY     47000002
         MODESET KEYADDR=DXUKEY,WORKREG=13 GET INTO USER KEY     Y02082 47050002
         CLC   K0(K1,RC),K0(R7)         DO CODE BYTES MATCH             47200021
         BE    EDI00430                 BRANCH YES             @ZA13566 47400037
         CLC   K0(K1,RC),K1(R7)         DO CODE BYTES MATCH-LST         47500037
*                                       ON EXL                          47600037
         BE    EDI00430                 BRANCH YES             @ZA13566 47700037
         B     EDI00450                 GO CHECK FOR LAST ENTRY@ZA13566 47800037
EDI00430 BR    R1                       GO TO EXIT ADDR        @ZA08315 47900037
EDI00450 TM    0(RC),LASTNTRY           IS THIS LAST ENTRY IN LIST      48600037
         LA    RC,K4(,RC)               POINT TO NEXT ENTRY             48800002
         BZ    EDI00400                 CHECK NEXT ENTRY                49000021
         BR    RF                       EXIT TO CALLER SPECIFIED        49200002
*                                       ADDR                            49400021
*                                                                       49600021
EDI00500 EQU   *                        SEE IF EXIT ADDR SPECIFIED      49800002
         L     RC,K0(,RC)               PICK UP USER'S EXIT ADDR        50000002
         LR    R7,RC                                                    50200021
         LA    R7,K0(,R7)               CLEAR HIGH ORDER BYTE           50400002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGT KEY   Y02082 50450002
         LTR   R7,R7                    IS EXIT ADDRESS ZERO            50600021
         BZ    EDI00800                 YES, BYPASS USER LABEL PROC     50800021
         EJECT                                                          50850002
*                                                                       50900002
*        USER LABELS TO BE PROCESSED - ENSURE DSCB READ                 50950002
*                                                                       51000021
         CLI   DSCFMTID,CHAR1           HAS F1 DSCB BEEN READ   SA57255 51050021
         BE    EDI00550                 YES, DO NOT REREAD      SA57255 51100021
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 51150002
         BNO   EDI00525                 BR IF NOT                Y02132 51200002
*        CALL SUBROUTINE TO READ VIO DSCB FROM SWA               Y02132 51250002
         BAL   RD,EDI01250              GO READ VIO DSCB         Y02132 51300002
*                                                                Y02132 51350002
         B     EDI00535                 CONTINUE PROCESSING      Y02132 51400002
EDI00525 EQU   *                        READ READ DSCB           Y02132 51450002
         BAL   RD,EDI02200              BRANCH TO BUILD CHANNEL SA57255 51850021
*                                       PROGRAM TO READ DSCB    SA57255 51900021
         BAL   RD,EDI01200              READ DSCB                       57400021
         BNO   EDI01300                 BR IF I/O ERROR-ABEND 737       57600021
EDI00535 EQU   *                        DSCB IN WORKAREA         Y02132 57615002
         OI    DXATDACC,DXATRDDB        SHOW DSCB READ           Y02144 57650002
*                                                                       57800021
EDI00550 EQU   *                        SET INPUT TO SUL MOD    SA57255 57850002
         MVC   DXRETMOD(K5),LOAD553P    SET RETURN ID                   58000021
         OI    JFCBMASK+K5,K6           SET FLAGS TO INDICATE EOV ENTRY 58200021
         LA    RF,LOAD554L              ID AND TTR                      58400021
         B     EDI02000                 GO TO RESIDENT ROUTINE          58600021
EDI00600 EQU   *                        RETURN FROM USER LABEL MODULE   58800002
         NI    JFCBMASK+K5,K255-K6      TURN OFF EOV-UL ENTRY FLAGS     58850002
         EJECT                                                          58900002
*                                                                       58950002
*        USER LABELS NOT PROCESSED OR RETURED FROM PROCESSING           58960002
*                                                                       58970002
EDI00800 EQU   *                        CONT. IF NO USER LABELS SA57255 59000002
         TM    DCBOFLGS,DCBOCON         CONCAT IN PROCESS       SM5271  59050002
         BO    EDI01400                 YES, PROCESS EOV        SM5271  59100002
*                                                                       59200021
*****    TEST EOV/EOF                                                   59400021
*                                                                       59600021
         MODESET EXTKEY=DATAMGT         DATA MGT KEY FROM NOW ON Y02082 59650002
*                                                                Y02134 60050002
         CLC   JFCBNVOL,DXVOLSEQ+K1     CHECK FOR EOF            Y02134 60200002
         BNH   EDI00900                 GO TO EOF PROCESSING     Y02134 60400002
*                                                                Y02134 60440402
EDI00820 EQU   *                        NOT EOF - TEST DSCB TO VERIFY   60442002
         CLI   DSCFMTID,CHAR1           HAS F1 DSCB BEEN READ   SA57255 60450021
         BE    EDI00850                 YES, DO NOT REREAD      SA57255 60500021
         TM    UCBJBNR,UCBVRDEV         TEST FOR VIO UCB         Y02132 60510002
         BNO   EDI00835                 BR IF NOT                Y02132 60520002
*        CALL SUBROUTINE TO READ VIO DSCB FROM SWA               Y02132 60530002
         BAL   RD,EDI01250              GO READ VIO DSCB         Y02132 60540002
*                                                                Y02132 60550002
         B     EDI00845                 CONTINUE PROCESSING      Y02132 60560002
EDI00835 EQU   *                        READ READ DSCB           Y02132 60570002
         BAL   RD,EDI02200              BUILD CHANNEL PROGRAM   SA57255 60600021
*                                       TO READ DSCB            SA57255 60650021
         BAL   RD,EDI01200              READ F1 DSCB            SA57255 60700021
         BNO   EDI01300                 BRANCH TO ABEND IF I/O  SA57255 60710021
*                                       ERROR ON READ           SA57255 60720021
EDI00845 EQU   *                        DSCB IN WORKAREA         Y02132 60720602
         OI    DXATDACC,DXATRDDB        SHOW DSCB READ           Y02144 60722002
*                                                                Y02144 60724002
EDI00850 EQU   *                        SEE IF LAST VOLUME      SA57255 60730002
         TM    DSCDSIND,LASTNTRY        TEST LAST VOLUME BIT    SA57255 60750021
*                                       TO DETERMINE EOF OR EOV SA57255 60800021
*                                       IF MORE VOLS SPECIFIED  SA57255 60850021
*                                                               SA57255 60860021
         BNO   EDI01400                 IF BIT IS OFF, BRANCH   SA57255 60900021
*                                       TO INITIATE EOV PROC    SA57255 60950021
*****    END OF FILE PROCESS                                            61200021
*                                                                       61400021
EDI00900 EQU   *                        GO TO END OF FILE MODULE        61600002
         MODESET EXTKEY=DATAMGT         RETURN TO DM KEY       @ZA13566 61700037
         LA    RF,LOAD552X              LOAD ADDRESS OF 552X            61800002
         B     EDI02000                 BRANCH TO RES                   62000021
         EJECT                                                          62050002
EDI01000 EQU   *                        RESET REGS IF EXIT NOT FOUND    62200002
*                                                                       62210002
*        IF 03 OR 0C EXIT NOT FOUND, LOOK FOR THE OTHER                 62250002
*                                                                       62300002
         LA    RF,EDI00800              RETURN ADDR IF NOT UL   SA57255 64600021
*                                       DEFER CD                        64800021
         LA    R7,K0(RET,R7)            ADDR OF NEXT UL CODE    SA55619 64850000
         LA    R1,EDI00500              EXIT ADDR IF CODE MATCH SA55619 64900000
         B     EDI00300                 GO CHECK FOR UL EXIT            65400021
         SPACE 2                                                        65450002
*                                                                       65600021
*   THIS SUBROUTINE ISSUES I/O OPERATIONS                               65800021
*                                                                       66000021
EDI01200 EQU   *                        EXCP, RETURN IF NO I/O ERROR    66200002
         EXCP  DXIOB                    EXECUTE CHANNEL PROGRAM         66400021
         BAL   RET,EDI02050             GO SET UP REG RWTG AND RWTGC    66600021
         IECRES WAIT                    SEND TO RES FOR WAIT            66800021
*                                                                       67000021
         TM    DXECB,ALLBITS-DCBMEXCP   WAS THERE AN I/O ERROR          67200021
         BR    RD                       RETURN TO CALLING POINT         67400021
         EJECT                                                          67410002
*                                                                Y02132 67415002
*        SUBROUTINE TO 'READ' VIO FORMAT ONE DSCB                Y02132 67430002
*                                                                Y02132 67445002
EDI01250 EQU   *                        MOVE VDSCB TO WORKAREA   Y02132 67460002
         MVC   DXDSCB(DSCEXT2-DSCFMTID),VDSDSCB-VDSUCB+L'JFCBDSNM(RUCB) 67475002
*                                                                Y02132 67490002
         OC    DXDSCB(DSCEXT2-DSCFMTID),DXDSCB IS DSCB = ZERO?   Y02132 67505002
         BZ    EDI01300                 BR IF YES, I/O ERROR     Y02132 67520002
*                                                                Y02132 67535002
         XC    DSCEXT2(DSCBEND-DSCEXT2),DSCEXT2 ZERO REMAIN CORE Y02132 67550002
*                                                                Y02132 67565002
         BR    RD                       RETURN                   Y02132 67580002
         SPACE 2                                                        67630002
*                                                                       67800021
*                   ABNORMAL END OF TASK                                68000021
*                                                                       68050002
EDI01300 EQU   *                        GO TO PROBLEM DETERMINATION     68400002
         BAL   RET,EDI02050             GO SET UP REG RWTG AND RWTGC    68600021
         DMABCOND ERR175,LOAD0P                                         68800021
         SPACE 2                                                        69000002
*                                                                       69050002
*        COMMENCE EOV PROCESSING                                        69100002
*                                                                       69200021
*        THIS SECTION DETERMINES IF SMF RECORDS REQUIRED              * 69400021
*                                                                       69600021
EDI01400 EQU   *                        RETURN IF SMF NOT REQUIRED      69800002
         TM    DXXPATHS,WTGSMF          IS SMF REQUIRED FOR DATA A38013 70700021
*                                       SET                      A38013 71600021
         BNO   EDI01450                 NO, CONTINUE PROCESSING  A38013 72500021
         LA    RF,LOAD200I                                              73400021
         LA    RET,K4                   SET RETURN INDICATOR            73600021
         MVC   DXRETMOD,LOAD553P        XCTL TO SMF MODULE              73800021
         B     EDI02025                 GO TO SMF LOAD                  74000021
         EJECT                                                          74010002
*********************************************************************** 74100002
*                                                                       74150002
*        DECREMENT DM COUNT - WICLOSE IF VIO AND COUNT GOES ZERO        74160002
*                                                                       74170002
*****************************************************************Y02134 74180002
*                                                                Y02134 74190002
EDI01450 EQU   *                        INCREMENT DXVOLSEQ       YM7099 74192002
         LH    R1,DXVOLSEQ              LOAD VOL SEQ             YM7099 74193002
         LA    R1,K1(R1)                INCREMENT TO NEXT VOL    YM7099 74194002
         STH   R1,DXVOLSEQ              SAVE SEQUENCE NUMBER     YM7099 74195002
*                                                                       74195102
*        GET LOCAL LOCK                                                 74195202
*                                                                       74195302
         L     RF,DXXPREFX              GET PREFIX ADDR          YM7883 74195402
         USING IECPREFX,RF              USING FOR PREFIX         YM7883 74195502
         STM   RB,RET,IECREGSV          SAVE SETLOCK REGS        YM7883 74195602
         MODESET EXTKEY=SUPR            SETLOCK KEY              YM7883 74195702
EDI01455 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  YM7883*74195802
               RELATED=(LOCAL,IFG0553P(EDI01466)) GET LOCAL LOCK YM7883 74195902
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       YM7883 74196002
         LM    RB,RET,IECREGSV          RESTORE REGS             YM7883 74196102
*                                                                       74196202
         LA    RF,K1                    LOAD DECREMENT VALUE     Y02134 74196302
*                                                                       74196402
*        SHIFT DECREMENT TO USE WITH CS INSTRUCTION              Y02134 74198002
*                                                                       74198102
         SLL   RF,K24-(K8*((UCBDMCT-UCB)-(((UCBDMCT-UCB)/4)*4))) Y02134 74198402
         L     R0,UCB+(((UCBDMCT-UCB)/K4)*K4) ALIGN & LOAD WORD  Y02134 74198802
         EJECT                                                          74199202
EDI01460 EQU   *                        DECREMENT IF NONZERO     Y02134 74199602
         LR    RET,R0                   SAVE CS OPERAND          Y02134 74199802
         SLL   RET,K25                  LEAVE ONLY UCBDMCT COUNT Y02134 74199902
         LTR   RET,RET                  TEST FOR COUNT OF 0      Y02134 74249902
         BZ    EDI01464                 BRANCH IF ALREADY 0      Y02134 74259902
         LR    R1,R0                    LOAD OLD VALUE TO MODIFY Y02134 74279902
         SR    R1,RF                    ADD DECREMENT TO COUNT   Y02134 74289902
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 74293902
*                                                                Y02134 74294302
         CS    R0,R1,UCB+(((UCBDMCT-UCB)/K4)*K4) STORE NEW COUNT Y02134 74295902
*                                                                Y02134 74296302
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 74297902
         BNE   EDI01460                 BRANCH IF NOT THE SAME   Y02134 74298702
         TM    UCBJBNR,UCBVRDEV         IS IT VIO UNIT           YM7883 74299002
         BZ    EDI01464                 BRANCH IF NO             YM7883 74300002
*                                                                       74750002
*        VIO UNIT - WICLOSE IF DATA MANAGEMENT COUNT NOW ZERO    YM7883 74800002
*                                                                       74850002
         SLL   R1,K25                   GET COUNT IN REG         YM7883 74900002
         LTR   R1,R1                    IS COUNT ZERO            YM7883 74950002
         BNZ   EDI01464                 BRANCH IF NOT            YM7883 75000002
         LA    R1,VDSUCB-VDSCB(,RUCB)   GET VDSCB ADDR           YM7883 75050002
         L     RD,DXXPREFX              GET PREFIX ADDR          YM7883 75100002
         LA    RD,IECREGSV-IECPREFX(,RD) GET REG SAVE AREA       YM7883 75150002
         MODESET EXTKEY=SUPR            GET IN KEY ZERO          YM7883 75200002
         WICLOSE VDSCB=(1)              WICLOSE DATA SET         YM7883 75250002
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       YM7883 75300002
         EJECT                                                          75300202
EDI01464 EQU   *                        RELEASE LOCK             YM7883 75350002
         OI    DXATEOV,DXATNVOL         INDIC CURR UNIT INACTIVE YM6520 75350202
         L     RF,DXXPREFX              GET PREFIX ADDR          YM7883 75400002
         STM   RB,RET,IECREGSV          SAVE MODESET REGS        YM7883 75450002
         MODESET EXTKEY=SUPR            GET IN KEY ZERO          YM7883 75500002
EDI01466 SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       YM7883*75550002
               RELATED=(LOCAL,IFG0553P(EDI01455))                YM7883 75600002
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       YM7883 75650002
         LM    RB,RET,IECREGSV          RESTORE MODESET REGS     YM7883 75700002
         DROP  RF                                                YM7883 75750002
         SPACE 2                                                        75750102
*                                                                       75750202
*        DATA MANAGEMENT COUNT DECREMENTATION COMPLETED                 75750402
*                                                                       75750602
         LA    RF,ID3P4A                SET UP FOR MOUNT VERIFY  Y02134 78151502
         MVC   DXRETMOD,ID3P3X          SET UP IFG0553X RETURN   Y02134 78152002
*                                                                Y02134 78152502
EDI02000 EQU   *                        ENTRY CODE 0 FOR NEXT MODULE    89000002
         SR    RET,RET                  SET RETURN CODE TO ZERO         89200021
EDI02025 EQU   *                        GIVE NEXT MODULE CONTROL        89400002
         LA    RWTGC,DXXENTRY           NEXT MODULE ID/TTR              89600021
         LA    RWTG,DXXAREA             CURRENT MODULE IN WORKAREA      89800021
         IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED       Y02080*90050002
                                        ENTER RESIDENT ROUTINE   Y02080 90100002
         EJECT                                                          90200002
EDI02050 EQU   *                        SUBROUTINE TO RELOAD REGS 6, 7  90400002
         LA    RWTGC,DXXENTRY           NEXT MODULE ID/TTR              90600021
         LA    RWTG,DXXAREA             CURRENT MODULE IN WORKAREA      90800021
         BR    RET                      RETURN TO CALLER                91000021
         SPACE 2                                                        91010002
*                                                                       91012002
*        READ DSCB FROM VTOC USING BBCCHHR IN DEB                       91014002
*                                                                       91016002
EDI02200 EQU   *                        SUBROUTINE ENTRY POINT  SA57255 91020002
         LA    R1,K15                   DECREMENT FROM DEB      SA57255 91050021
*                                       ADDR TO DSCB BBCCHHR    SA57255 91060002
         SR    RDEB,R1                  ADDR IN PREFIX PORTION  SA57255 91100021
         MVC   DXDAADDR+K1(K7),0(RDEB)  TRK ADDR OF DSCB IN IOB SA57255 91150021
         MVI   DXDAADDR,K0              SET M=0                 SA57255 91160021
*                                                               SA57255 91170021
*   THE FOLLOWING SUBROUTINE SETS UP A CHANNEL PROGRAM TO READ  SA57255 91180021
*   THE DSCB OR VOLUME LABEL INTO THE WORKAREA.                 SA57255 91190021
*   IN THIRD CCW.                                               SA57255 91194021
*                   SEARCH ID EQUAL     IOBDADAD+3   C,SILI   5 SA57255 91196021
*                   TIC                 *-8         -         - SA57255 91198021
*                   READ DATA           WORKAREA    -        96 SA57255 91304702
*                                                               SA57255 91309721
*                                                               SA57255 91314721
*                                                               SA57255 91319721
         XC    DXCCW1(K24),DXCCW1       CLEAR 3 CCW'S           SA57255 91324721
         LA    R0,DXDAADDR+K3           ADDRESS OF IOBDADAD+3   SA57255 91329721
         ST    R0,DXCCW1                SEARCH ADDR IN CCW1     SA57255 91334721
         LA    R0,DXCCW1                ADDR SEARCH CCW         SA57255 91339721
         ST    R0,DXCCW2                PUT IN CCW2             SA57255 91344721
         ST    RCORE,DXCCW3             WORKAREA ADDR IN CCW3   SA57255 91349721
         MVI   DXCCW1,CCWSCHID          SEARCH ID COMMAND CODE  SA57255 91354721
         MVC   DXCCW1+K4(K5),ACCW10I    REST OF CCW1 AND TIC    SA57255 91359721
*                                       COMMAND                 SA57255 91364721
         MVI   DXCCW3,CCWMTRD           READ DATA COMMAND       SA57255 91369721
         MVI   DXCCW3+K7,K96            LENGTH IS 96 BYTES      SA57255 91374702
         L     RDEB,DCBDEBAD            RESTORE USER'S DEB      SA57255 91384721
*                                       ADDRESS                 SA57255 91389721
*                                                               SA57255 91405921
         BR    RD                       RETURN TO CALLER        SA57255 91406921
         EJECT                                                          91456902
*                                                                       91506902
*        CONSTANTS                                                      91556902
*                                                                       91606902
         DS    0F                                                       91800021
ACCW10I  DC    X'6000000508'            SILI,COMMAND CHAIN,5 CHAR,TIC O 92200021
COLCDU0I DC    X'000000007FFF7FFF7FFF'  EXTENT TO COVER ENTIRE DISK     92400002
MASKFL0I DC    F'1'                     MASK TO TEST DCBIOBAD           94000021
ULEXIT   DC    X'03'                    UTL EXIT LIST CODE BYTE         94200021
         DC    X'83'                    UTL EXIT LIST CODE BYTE         94400021
*                                       + LAST                          94600021
SULDFR0I DC    X'0C'                    DEFER UTL PROC CODE BYTE        94800021
         DC    X'8C'                    DEFER UTL PROC CODE BYTE        95000021
*                                       +LAST                           95200021
         EJECT                                                          95250002
         XCTLTABL ID=(LOAD553P,3P,LOAD554L,4L,LOAD0P,0P,         Y02080X95600002
               LOAD552X,2X,ID3P4A,4A,ID3P3X,3X,LOAD200I,3B),     Y02134X95800002
               SVC=055,BRT=YES,LENGTH=                           Y02080 95850002
         IECDSECS TIOT,DCB,DEB,UCB,MAIN,WTG,PREFX,CVT,PSA,       YM7883*96000002
               DSAB,EXPAND=YES                                 @ZA01342 96000237
         IDDVDSCB                                                Y02132 96015002
         IECEQU                                                         96200021
         END                                                            96400021
