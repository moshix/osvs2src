         TITLE 'IFG0553X                      EOV DA INPUT - BUILD NEW D00200002
               DEB MODULE'                                       Y02134 00250002
IFG0553X CSECT                                                          00450002
*********************************************************************** 00500002
*                                                                     * 00502002
*                                                                     * 00502102
*        VS2 RELEASE 02 DELETIONS                                     * 00502402
*                                                                     * 00504002
*        VS2 RELEASE 3 DELETIONS                               @ZM30032 00504403
*0000008553,743003,743050-743150,804000                        @Y30LSBS 00504803
*0000                                                          @ZA18313 00505437
*C742938-743820,811200,931200                                  @ZA19720 00505724
*                                                                     * 00506002
*        VS2 RELEASE 037 DELETIONS                                      00508024
*0000                                                          @ZA02204 00510024
*0000                                                          @ZA10274 00512024
*0000                                                          @ZA13569 00514024
*        VS2 RELEASE 037 CHANGES AND ADDITIONS                          00516024
*0000                                                          @ZA15655 00518024
*D74296903-74297400,74299237,74299337                          @ZA16059 00520024
*D742961                                                       @ZA28613 00522024
*AXXXXXX                                                       @ZA28613 00524024
*C743355,743369,743376,743390,743411,743425                    @ZA28613 00526024
*********************************************************************** 00530037
*                                                                     * 00550002
* MODULE NAME = IFG0553X (OS/VS2)                                     * 00600002
*                                                                     * 00650002
* DESCRIPTIVE NAME = EOV DA INPUT - BUILD NEW DEB MODULE              * 00700002
*                                                                     * 00750002
* COPYRIGHT = NONE                                                    * 00760002
*                                                                     * 00770002
* STATUS = RELEASE 2, LEVEL 0                                         * 00780002
*                                                                     * 00790002
* FUNCTION =                                                          * 00792002
*        ENTERED FROM IFG0554C (ALIAS NAME FOR IFG0194C) AFTER        * 00792102
*        MOUNTING NEW DIRECT ACCESS VOLUME AND READING DSCB(S) ON     * 00792202
*        THE NEW VOLUME.                                              * 00792302
*                                                                     * 00792402
*        1) THE DEB IS PAGE FREED IF IT HAD BEEN PAGE FIXED.          * 00792502
*        SAVE OLD DEB IN WORK AREA, AND DELETE IT FROM THE TCB-DEB    * 00792802
*        CHAIN.                                                       * 00792902
*                                                                     * 00793202
*        2A) IF RECORD FORMAT IS NOT VBS AND NOT OPEN FOR UPDATE -    * 00795202
*        VERIFY THAT THE EOV OCCURRED IN THE SAME TASK AS THE OPEN    * 00803202
*        BY CHECKING THAT THE TCB ADDRESS IN THE DEB IS THE SAME AS   * 00803602
*        THE CURRENT TCB ADDRESS, AND IF IT IS,REMOVE THE DEB FROM    * 00803702
*        THE DEBTABLE BY USING THE DEBCHK MACRO. IF RUNNING UNDER     * 00803802
*        ANOTHER TCB, SEARCH THE DEBTABLE FOR THE OLD DEB ADDRESS,    * 00805902
*        (IF IT IS NOT FOUND, CALL PROBLEM DETERMINATION FOR AN       * 00809502
*        437-0C ABEND) AND SAVE THE OFFSET INTO THE DEB TABLE OF THE  * 00811602
*        DEB ADDRESS IN THE DEB TABLE.                                * 00812002
*                                                                     * 00813602
*        2B) IF RECORD FORMAT IS VBS AND OPEN FOR UPDATE THE DEB      * 00815602
*        ADDRESS IS SAVED IN DCBIOBAD, AND THE DEB IS MADE            * 00815702
*        UN-EXCPABLE BY FLIPPING THE LOW ORDER BIT OF THE DEBDCBAD    * 00817702
*        FIELD IN THE DEB AFTER POINTING DEBDCBAD TO THE USER DCB.    * 00819702
         EJECT                                                          00820702
*        3) GET CORE FOR AND BUILD NEW DEB. MERGE IN FIELDS FROM THE  * 00823902
*        DSCB AND THE OLD DEB IN THE WORK AREA. CALCULATE THE BEGINN- * 00825902
*        ING AND ENDING ADDRES AND THE NUMBER OF TRACKS FOR EACH      * 00827902
*        EXTENT AND STORE IN THE NEW DEB.                             * 00829902
*                                                                     * 00830902
*        4) VERIFY THAT THE EOV OCCURRED IN THE SAME TASK AS THE OPEN * 00833902
*        BY CHECKING THAT THE TCB ADDRESS IN THE DEB IS THE SAME AS   * 00835902
*        THE CURRENT TCB ADDRESS.                                     * 00837902
*                                                                     * 00839302
*        4A) IF THE TCB ADDRESSES ARE EQUAL, CHAIN IT TO THE TCB DEB  * 00839702
*        CHAIN OF THE CURRENT TCB. ADD THE DEB TO THE DEBTABLE BY     * 00839902
*        USING THE DEBCHK MACRO.                                      * 00841902
*                                                                     * 00843002
*        4B) IF THE TCB ADDRESSES ARE NOT EQUAL, AND IF THE OLD       * 00845102
*        DEB WAS NOT SAVED (UNDER 2B ABOVE), CHAIN THE DEB TO         * 00845302
*        THE DEB CHAIN OF THE TCB THE DCB WAS OPENED UNDER.           * 00845502
*        MODIFY THE OLD DEB'S DEB TABLE ENTRY TO POINT TO THE NEW     * 00845802
*        DEB.                                                         * 00846202
*                                                                     * 00846602
*        4C) IF THE TCB ADDRESSES ARE NOT EQUAL, AND IF THE OLD DEB   * 00847002
*        WAS SAVED (UNDER 2B ABOVE), CHAIN THE DEB TO THE CURRENT TCB * 00847402
*        DEB CHAIN (NOT THE ONE THE DCB WAS OPENED UNDER), ADD THE    * 00847802
*        DEB TO THE DEB TABLE USING THE DEBCHK-ADD MACRO, UNCHAIN THE * 00847902
*        DEB FROM THE CURRENT TCB'S DEB CHAIN, AND CHAIN THE DEB TO   * 00848002
*        THE TCB DEB CHAIN OF THE TCB THE DCB WAS OPENED UNDER.       * 00848102
*                                                                     * 00848202
*        5) UPDATE DEBVOLSQ AND DEBVOLNM                              * 00848402
*                                                                     * 00848502
*        6) GIVE CONTROL NEXT TO IFG0553Z.                            * 00848602
         EJECT                                                          00849002
* NOTES =                                                             * 00849402
*        1) IF THE DEB IS NOT CHAINED OFF THE CURRENT TCB'S DEB CHAIN,* 00849802
*        THE DEBCHK-DELETE, DEBCHK-ADD LOGIC IS AVOIDED BECAUSE       * 00850302
*        DEBCHK-ADD REQUIRES THE DEB TO BE CHAINED OFF THE CURRENT    * 00850702
*        TCB'S DEB CHAIN.                                             * 00851102
*                                                                     * 00851202
*        2) THE OLD DEB IS SAVED IN DCBIOBAD IF DCBRECFM IS VBS AND   * 00851602
*        THE DCB IS OPENED FOR UPDATE AND A SPANNED RECORD WAS BEING  * 00852002
*        READ WHEN EOV OCCURRED. ONCE EOV IS COMPLETE AND THE         * 00852402
*        COMPLETED RECORD IS PASSED TO THE USER, HE MAY UPDATE AND    * 00852802
*        PUTX IT. THE FIRST SEGMENT OF THE RECORD ON THE PREVIOUS     * 00852902
*        VOLUME MUST BE REWRITTEN. A SPECIAL REPOSITIONING CALL OF    * 00853002
*        FEOV IS INVOKED WHICH REESTABLISHES THE OLD DEB AND FREES    * 00853102
*        THE THEN CURRENT DEB.                                        * 00853202
*                                                                     * 00853502
*        3) A DIRECTED FREEMAIN/GETMAIN IS USED TO FREE THE OLD DEB & * 00853602
*        OBTAIN CORE FOR THE NEW DEB SO THE CORE IS ATTACHED TO THE   * 00853902
*        TCB UNDER WHICH THE DEB WAS OPENED AND WILL BE FREED DURING  * 00854102
*        CLOSE. THIS TCB'S ADDRESS IS IN DEBTCBAD.                    * 00854502
*                                                                     * 00854902
*        4) UPON COMPLETION OF THE DEB, A LOOP THROUGH ITS EX-        * 00855003
*        TENT LIST IS MADE IF IT IS DISCOVERED THAT THE DATA          * 00855103
*        SET RESIDES ON MSS VIRTUAL DASD.  THE DEB EXTENTS ARE        * 00855203
*        USED TO BUILD A PARAMETER LIST THAT WILL BE USED BY          * 00855303
*        THE ICBACREL MACRO TO ACQUIRE DASD SPACE.                    * 00855403
*                                                                     * 00855503
*    DEPENDENCIES =                                                   * 00855603
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 00855702
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 00855902
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 00857902
         EJECT                                                          00859902
*    RESTRICTIONS = NONE                                              * 00861902
*                                                                     * 00863902
*    REGISTER CONVENTIONS =                                           * 00865902
*            R2 POINTS TO DCB                                         * 00867902
*            R4 POINTS TO EOV WORK AREA                               * 00869902
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 00879902
*            R6 POINTS TO THE WTG TABLE                               * 00889902
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 00893902
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 00895902
*            R10 POINTS TO THE UCB                                    * 00897902
*            R11 POINTS TO USER'S DEB                                 * 00898002
*            R14 RETURN ADDRESS OR ENTRY INDICATOR                    * 00898102
*            DCB,DEB,IOB,AND JFCB IN THE EOV WORK AREA                * 00898202
*                                                                     * 00898302
*    PATCH LABEL = SEE THIRD FROM LAST LABEL BEFORE ORG STATEMENT AT  * 00898702
*                  END OF LISTING.                                    * 00899102
*                                                                     * 00899502
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 00899602
*                                                                     * 00899702
*    PROCESSOR = ASSEMBLER XF                                         * 00899802
*                                                                     * 00933202
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 00943202
*                  ORG STATEMENT AT END OF LISTING                    * 00953202
*                                                                     * 00963202
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 00965202
*                  PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY, * 00965602
*                  LINK PACK AREA RESIDENT/PAGEABLE                   * 00966002
*                                                                     * 00966402
* ENTRY POINT = IFG0553X FROM:                                        * 00966502
*               IFG0554C - MOUNT VERIFY                               * 00977502
*                                                                     * 00984302
*    PURPOSE = SEE FUNCTION                                           * 00987602
*                                                                     * 00988002
*    LINKAGE = REGISTERS AS DEFINED IN REGISTER CONVENTIONS AND       * 00988402
*              CONTROL BLOCKS IN WORK AREA.                           * 00988502
*                                                                     * 00990502
* INPUT = REGISTERS AND WORK AREA                                     * 00992502
*         REGISTER 2 POINTS TO COPIED DCB                             * 00992902
*         REGISTER 4 POINTS TO EOV WORKAREA                           * 00993302
*         FORMAT 1 DSCB IN DXDSCB IN EOV WORKAREA                     * 00993702
*         FORMAT 3, IF PRESENT, POINTED TO BY DSCCORE                 * 00994102
*         DEB POINTING TO COPIED DCB                                  * 00994202
*                                                                     * 00994502
* OUTPUT = NEW DEB ON THE TCB-DEB CHAIN AND IN THE DEBTABLE           * 00994902
*          DEB POINTS TO COPIED DCB                                   * 00995002
*          REGISTER 2 POINTING TO COPIED DCB                          * 00995102
*          REGISTER 4 POINTING TO EOV WORKAREA                        * 00995202
         EJECT                                                          00995302
* EXIT-NORMAL = IFG0553Z DA INPUT FINAL EXIT MODULE                   * 00995702
*                                                                     * 00996102
* EXIT-ERROR = IFG0550P PROBLEM DETERMINATION IF THE OLD DEB WAS NOT  * 00996202
*              IN THE DEBTABLE.                                       * 01002002
*              INTERNAL ABEND CODE 199 CAUSING A 437-0C SYSTEM ABEND  * 01004002
*              IS PASSED TO IFG0550P.                                 * 01008002
*                                                                     * 01009602
*              INTERNAL ABEND CODE 111 CAUSES A 737-34 SYSTEM  @Y30LSBS 01011903
*              ABEND WHEN THE ICBACREL MACRO DETECTS AN ERROR. @Y30LSBS 01012303
*                                                                     * 01013803
*              DMABCOND PCK IF PAGE FREE ERROR                   YM5929 01018203
*                                                                     * 01022403
* EXTERNAL REFERENCES = SEE BELOW                                     * 01026603
*                                                                     * 01030803
*    ROUTINES = IFG019RA                                              * 01035003
*                                                                     * 01039203
*               IEAVPSIB VIA CVTVPSIB TO PAGE FREE DEB           YM5929 01043403
*               R0 = 0, NO ECB ADDRESS                           YM5929 01047603
*               R1 = X'20', DEB PREFIX ADDRESS, START OF PGFREE  YM5929 01051803
*               R2 = ADDR OF LAST BYTE OF DEB + 1, END OF FREE   YM5929 01056003
*               R4 = TCB ADDRESS FROM DEBTCBAD                   YM5929 01060203
*                                                                     * 01064403
*    DATA AREAS =                                                     * 01068603
*        EOV WORKAREA                                                 * 01072802
*                                                                     * 01122802
*    CONTROL BLOCK =                                                  * 01172802
*        DEB                                                          * 01182802
*        CURRENT TCB AND/OR TCB UPON WHICH DEB IS CHAINED             * 01192802
*        DCB                                                          * 01202802
*        ACCESS METHOD IOB                                            * 01212802
*        CVT                                                          * 01214802
*        DEB TABLE                                                    * 01216802
*        JSCB                                                         * 01218802
*                                                                     * 01222802
* TABLES = NONE                                                       * 01272802
*                                                                     * 01322802
* MACROS =                                                            * 01372802
*        MODESET                                                      * 01382802
*        SETLOCK                                                      * 01392802
*        DEBCHK                                                       * 01402802
*        DMABCOND                                                     * 01412802
*        FREEMAIN                                                     * 01414802
*        GETMAIN                                                      * 01416802
*        IECRES-GET/FREE                                              * 01417203
*        IECRES-LOAD                                                  * 01418802
*        IECRES-LOCJFCB                                               * 01419802
*        XCTLTABL                                                     * 01420802
*        IECDSECS                                                     * 01421202
*        IECEQU                                                       * 01421602
*        ICBACREL                                                     * 01421703
*                                                                     * 01422802
* CHANGE ACTIVITY =                                                   * 01472802
*        SEE 'CHANGES/DELETIONS' SECTION JUST AFTER CSECT CARD        * 01482802
*                                                                     * 01522802
*********************************************************************** 01572802
         EJECT                                                          01622802
ERR199   EQU   199                      ABEND CODE                      23800002
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        24000021
         USING FORCORE,RCORE                                            24200021
         USING WTG,RWTG                 BASE FOR WTG TABLE       Y02080 24250002
         USING TIOENTRY,RTIOT                                           24400021
         USING UCBOB,RUCB                                               24600021
         USING DEBBASIC,RDEB                                     YM1272 24800002
         USING IHADCB,RDCB                                              25000021
         USING CVT,RF                                                   25200021
         USING *,RBASE                                                  25400021
*                                                                       25600021
*                                                                       25800021
         OI    DXATALL,DXATFC           FORCE CLOSE ON ERROR     YM7099 25900002
         L     RDEB,DCBDEBAD            REESTABLISH DEB ADDRESS         26000021
         LA    RDEB,DEBBASIC            CLEAR HIGH BYTE          YM5929 26010002
         MVC   DXCCW10(K8),JFCBELNM     SAVE MEMBER NAME FOR BLDL IF,PO 26200021
         MVC   DXCCW11(K1),DSCFILTY     SAVE DSCB DSORG                 26400021
         MVC   DXCCW11+K1(K1),JFCBIND1  SAVE PDS MEMBER IND IN THE JFCB 26600021
         MVC   DXCCW11+K2(K6),DSCEXTYP  SAVE EXTENT FROM F1 DSCB FOR UL 26800021
*                                       PROCESSING                      27000021
*                                                                       27200021
*        SAVING OLD DEB IN WORK AREA                                    27400021
*                                                                       27600021
         MVC   DXCCW12+K4(K1),JFCBLTYP  SAVE LABL TYPE FOR UL           27800021
         L     RF,DEBAPPAD              AVT ADDRESS              YM5929 27800302
         SH    RDEB,COLC0036            SUBTRACT 36 (PREF + APP)        28000021
         TM    DEBSIOAB-DEBAVT(RF),X10  IS DEB FIXED             YM5929 28010002
         BZ    EDI09440                 BRANCH IF NOT            YM5929 28020002
         XR    RF,RF                    CLEAR FOR IC             YM5929 28030002
         IC    RF,DEBLNGTH-DEBAVT(RDEB) LENGTH OF DEB IN DWORDS  YM5929 28040002
         SLL   RF,K3                    LENGTH OF DEB IN BYTES   YM5929 28050002
         AR    RF,RDEB                  END OF DEB + 1           YM5929 28060002
         LR    R1,RDEB                  START OF DEB             YM5929 28070002
*        PGFREE R,A=(1),EA=(15)         PAGE FREE DEB            YM5929 28070302
         LA    R2,K0(,RF)               END ADDRESS OF PGFREE    YM5929 28070602
         L     RF,DXXPREFX              PREFIX ADDRESS           YM5929 28070902
         STM   RDEB,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS  YM5929 28071202
         MODESET EXTKEY=SUPR            SETLOCK, PGFREE KEY      YM5929 28071502
EDI09430 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  YM5929*28071802
               RELATED=(LOCAL,IFG0553X(EDI09435)) GET LOCAL LOCK YM5929 28072102
         LM    RDEB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS       YM5929 28072702
         EJECT                                                          28073002
         XR    R0,R0                    NO ECB                   YM5929 28073302
         ICM   R1,B'1000',=AL1(X20)     PGFREE BIT               YM5929 28073602
         LR    RDEB,RCORE               SAVE RCORE               YM5929 28073902
         L     RCORE,DEBTCBAD-DEB(,R1)  PGFREE BY TCB            YM5929 28074202
         L     RF,CVTPTR                CVT                      YM5929 28074502
         L     RF,CVTVPSIB-CVT(,RF)     IEAVPSIB ENTRY           YM5929 28074802
         BALR  RET,RF                   REGS 0-14 UNCHANGED      YM5929 28075102
         LTR   RF,RF                    ERROR IN PGFREE          YM5929 28075402
         BNZ   EDI10782                 BRANCH IF YES            YM5929 28075702
         LR    RCORE,RDEB               RESTORE RCORE            YM5929 28076002
         L     RDCB,DXPDCBAD            RESTORE DCB ADDRESS      YM5929 28076302
         L     RDEB,DCBDEBAD            RESTORE DEB ADDRESS      YM5929 28076602
         L     RF,DEBAPPAD              DEB AVT ADDR             YM5929 28076902
         NI    DEBSIOAB-DEBAVT(RF),K255-X10 ZERO DEB FIXED BIT   YM5929 28077202
         LA    RDEB,DEBBASIC            CLEAR HIGH BYTE          YM5929 28077502
         SH    RDEB,COLC0036            SUBTRACT 36 (PREF + APP) YM5929 28077602
         L     RF,DXXPREFX              PREFIX ADDRESS           YM5929 28077802
         STM   RDEB,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS  YM5929 28078102
EDI09435 SETLOCK RELEASE,TYPE=LOCAL,                             YM5929*28078402
               RELATED=(LOCAL,IFG0553X(EDI09430)) RELEASE LOCK   YM5929 28078702
         LM    RDEB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS       YM5929 28079302
         MODESET EXTKEY=DATAMGT         RETURN TO D M KEY        YM5929 28079902
         EJECT                                                          28092002
EDI09440 EQU   *                        SAVE DEB IN WORKAREA     YM5929 28100002
         MVC   JFCBDSNM(K74),DEBBASIC   SAVING PREF,BASIC,EXT    YM1272 28200002
         LA    RDEB,K36(,RDEB)          RESET DEB REGISTER              28400021
         MVC   JFCBDSNM+K68(K6),DXDEBUCB  PICK UP UCBADDR AND BB        28600021
         MVC   JFCBDSNM+K23(K5),DXCCW7  SAVE DSCB COUNT                 28800021
         MVC   JFCBDSNM+K21(K2),ZEROI   INSURE BB OF ZERO               29200021
*                                                                       30400021
*                                       SUBROUTINE IDS IN SAVE AREA     30600002
*                                                                       30800021
         SR    R1,R1                    ZEROS IN RF                     31000021
         IC    R1,DEBNMEXT              PICK UP NUMBER OF EXTENTS       31200021
         SLL   R1,K4                    MULTIPLY BY 16                  31400021
         AR    R1,RDEB                  ADD DEB ADDRESS                 31600021
         LA    R1,K32(,R1)              ADD THIRTY TWO                  31800021
         SR    R7,R7                    ZEROS IN R7                     32000021
         IC    R7,DEBNMSUB              PICK UP NUMBER OF SUBROUTINES   32200021
         SLL   R7,K1                    MULTIPLY BY 2                   32400021
         SR    RF,RF                    CLEAR WORK REGISTER             32600021
         IC    RF,DEBAMLNG              LEN FOR MEMBER NAME,VOL  YM1272 32800002
         AR    R7,RF                    SEQUENCE NUM AND NUM OF VOLUMES 33000021
         EX    R7,EDI10500              SAVING VOLSQ,VOLNM,SUBRTINE     33200021
         L     RD,DEBTCBAD              TCB FROM WHICH TO        Y02082 33210002
*                                       UNCHAIN THE DEB          Y02082 33220002
         BAL   RET,EDI10750             UNCHAIN DEB FROM TCB     Y02082 33230002
         EJECT                                                          35600002
         TM    K12(RDEB),K4             IS THIS UPDATE MODE             35800021
         BZ    EDI09500                 NO,FREE DEB                     36000021
         TM    K12(RDEB),DEBOPOUT-DEBOPUPD  TEST FURTHER FOR UPDATE     36200021
         BNZ   EDI09500                 BRANCH IF NOT UPDATE            36400021
*                                                                       36500021
         TM    DCBMACRF,DCBMEXCP        IS THIS AN EXCP DCB-     A37815 36600021
         BO    EDI09500                 ..BR IF YES- NO IOB ADDR A37815 36700021
*        SPAN RECORD TEST ONLY IF NOT CHAINED SCHEDULING         YM1194 36800002
         TM    DCBCIND2,DCBC2CHN        CHAINED SCHEDULING TEST  YM1194 36850002
         BO    EDI09500                 BRANCH IF YES            YM1194 36860002
         L     R8,DCBIOBA               LOAD ADDR OF IOB PREFIX  S21940 36900021
         MODESET KEYADDR=DXUKEY,WORKREG=1 KEY OF IOB             YM1134 36950002
         L     R8,K0(R8)                LOAD ADDR OF IOB TO BE          37000021
*                                       TESTED                          37200021
         TM    K0(R8),K4                IS THIS A SPAN RECORD           37400021
         BZ    EDI09500                 NO,FREE DEB                     37600021
         EJECT                                                          37601002
         MODESET EXTKEY=DATAMGT         RETURN TO O/C/E KEY      Y02082 37810002
         STCM  RDEB,B'0111',DCBIOBAD+K1 OLD DEB ADDR IN DCBIOBAD YM3909 37812002
*                                                                       37820002
*        SAVE OLD DEB AND INVALIDATE IT TO PREVENT IT'S BEING           37830002
*        USED FOR AN EXCP BY FLIPPING THE LOW ORDER BIT OF DEBDCBAD     37840002
*                                                                       37850002
         XI    DXUDCBAD+K3,K1           FLIP LAST BIT            YM3909 37852002
         MVC   DEBDCBAD+K1(L'DEBDCBAD-K1),DXUDCBAD+K1 POINT DEB  Y02082*37860002
                                        TO USER DCB              Y02082 37870002
         XI    DXUDCBAD+K3,K1           FLIP LAST BIT            YM3909 37880002
         L     R1,DXDEBXAD              PT TO DEB EXTENSION      YM1272 37890002
         NI    DEBXFLG1-DEBXTN(R1),ALLBITS-DEBXCDCB DEB PT USER  YM1272 37892002
         MVI   DXCCW6+K4,CHARFF         INDICATE DEBCHK ADD      YM2133 37910000
         OI    DCBIOBAD,DCBIODEB        TURN ON SAVE DEB                38000021
*                                       INDICATOR                       38200021
         L     RF,DXXPREFX              GET PREFIX               Y02080 38201002
         STM   R0,RF,IECREGSV-IECPREFX(RF)  SAVE REGS            Y02080 38202002
         MODESET  EXTKEY=ZERO           SUPERVISOR KEY           Y02080 38203002
EDI09450 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND, GET LOCAL LOCK   Y02080*38204002
               RELATED=(LOCAL,IFG0553X(EDI09650))                Y02080 38205002
         MODESET  EXTKEY=DATAMGT        DATA MANAGEMENT KEY      Y02080 38206002
         LM    R0,RF,IECREGSV-IECPREFX(RF)  RESTORE REGS         Y02080 38207002
         LR    RA,RF                    PUT PREFIX ADDR IN RA    YM3909 38257002
*                                       FOR SUBSEQUENT LM        YM3909 38307002
         LA    R1,K1                    LOAD REGISTER FOR COMPARE       38400021
         CH    R1,DXNOUNIT              IS THERE ONLY ONE DEVICE        38600021
         BNE   EDI09600                 NO,MORE THAN ONE DEVICE         38800021
         OI    DCBIOBAD,DCBIOONE        TURN ON FLAG IN DCBIOBAD        39000021
         B     EDI09600                 BRANCH TO COMPARE LNGTH         39200021
*                                       OF DEB                          39400021
         EJECT                                                          39450002
*                                                                       39600002
*        DELETE DEB FROM DEB TABLE                                      40200002
*                                                                       40400021
EDI09500 EQU   *                        DEBCHK IF DEB ON CURRENT TCB    40450002
*                                                                     * 40452002
         MODESET EXTKEY=DATAMGT         RETURN TO O/C/E KEY      YM1134 40454002
         L     R1,DEBTCBAD              TCB ADDRESS              YM2133 40460000
         CLM   R1,B'0111',DXTCBADR+K1   IS DEB ON CURRENT TCB    YM2133 40470002
         BNE   EDI09550                 NO - BYPASS DEBCHK DLTE  YM2133 40490000
         L     R1,DXPDCBAD              POINT TO COPIED DCB      Y02082 40492002
         DEBCHK (R1),TYPE=DELETE        DELETE OLD DEB           Y01021 40500002
         L     RF,DXXPREFX              GET PREFIX               Y02080 40500402
         STM   R0,RF,IECREGSV-IECPREFX(RF)  SAVE REGS            Y02080 40500802
         MODESET  EXTKEY=ZERO           SUPERVISOR KEY           Y02080 40500902
EDI09525 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND, GET LOCAL LOCK   Y02080*40501202
               RELATED=(LOCAL,IFG0553X(EDI09650))                Y02080 40501602
         MODESET  EXTKEY=DATAMGT        DATA MANAGEMENT KEY      Y02080 40501702
         LM    R0,RF,IECREGSV-IECPREFX(RF)  RESTORE REGS         Y02080 40501802
         B     EDI09580                 BYPASS DEBTABLE SEARCH   YM2133 40502000
         EJECT                                                          40502402
*                                                                YM2133 40504000
*        SEARCH DEBTABLE FOR OLD DEB ADDRESS AND INVALIDATE      YM2133 40506002
*        IT BY FLIPPING LOW ORDER BIT OF DEB ADDRESS IN DEB TABLE       40506402
*                                                                YM2133 40508000
EDI09550 EQU   *                        SAVE DEB TABLE OFFSET    YM2133 40508402
         USING TCB,R1                   R1 CONTAINS DEB TCB ADDR YM2133 40508800
         L     RC,TCBJSCB               ADDR OF JOB STEP JSCB    YM2133 40509200
         DROP  R1                                                YM2133 40509600
         L     R1,DCBDEBAD              GET ADDRESS OF DEB       Y02082 40509702
         LA    R1,0(,R1)                CLEAR HIGH ORDER BYTE    Y02082 40513002
         BCTR  R1,R0                    POINT TO                 YM2133 40516602
         BCTR  R1,R0                    DEBTBLOF FLD IN DEB PFX  YM2133 40519902
         LH    R1,K0(R1)                GET TABLE OFFSET         Y02080 40525202
         SLL   R1,K2                    MPY BY ENTRY LENGTH      YM2133 40533200
         ST    R1,DXCCW6+K4             SAVE DEB TABLE OFFSET    Y02080 40533602
         L     RF,DXXPREFX              GET PREFIX               Y02080 40533802
         STM   R0,RF,IECREGSV-IECPREFX(RF)  SAVE REGS            Y02080 40533902
         MODESET  EXTKEY=ZERO           SUPERVISOR KEY           Y02080 40534002
EDI09555 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080X40534302
               RELATED=(LOCAL,IFG0553X(EDI09565,EDI09650))       Y02080 40534402
         MODESET  EXTKEY=DATAMGT        DATA MANAGEMENT KEY      Y02080 40534502
         LM    R0,RF,IECREGSV-IECPREFX(RF)  RESTORE REGS         Y02080 40535002
         EJECT                                                          40535102
EDI09560 EQU   *                        DEBTABLE SEARCH          YM2133 40535202
         USING IEZJSCB,RC               ADDRESSABILITY FOR JSCB  YM2133 40535600
         L     R8,JSCBDBTB              DEB TABLE ADDRESS        YM2133 40536000
         LA    RF,K0(R1,R8)             POINT TO ENTRY           YM2133 40536400
         CLM   RDEB,B'0111',K1(RF)      CORRECT ENTRY            Y02082 40536502
         BE    EDI09570                 YES - CONTINUE           YM2133 40536600
         L     RF,DXXPREFX              GET PREFIX                      40536802
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGS             Y02080 40537002
         MODESET  EXTKEY=ZERO           KEY 0                    Y02080 40537602
EDI09565 SETLOCK RELEASE,TYPE=LOCAL,                             Y02080X40546602
               RELATED=(LOCAL,IFG0553X(EDI09555))                Y02080 40556602
         MODESET  EXTKEY=DATAMGT        DATA MANAGEMENT KEY      Y02080 40556802
         LM    R0,RF,IECREGSV-IECPREFX(RF)  RESTORE REGS         Y02080 40559602
*                                                                       40560602
*        REREAD JFCB TO REFRESH WORKAREA OVERLAID BY DEB         YM3116 40561602
*                                                                       40562602
         L     RTIOT,DXTIOTAD           GET TIOT ENTRY ADDR      YM3116 40563602
         LA    RF,TIOEJFCB              GET JFCB ADDRESS ADDRESS YM3116 40564602
         IECRES LOCJFCB,(RF)            LOCATE JFCB ADDRESS      YM3116 40565602
         MVC   DXJBF(JFCBLGTH),INFMJFCB-INFMJFCB(RF) MOVE JFCB   YM3116 40566602
*                                                                       40567602
         LA    RWTGC,DXXENTRY           SET RWTGC FOR RES RTN    YM2133 40571100
         LA    RWTG,DXXAREA             POINT TO EOV WTG         YM2133 40571500
         DMABCOND ERR199,LOAD0P         LOAD ERROR CODE          YM2133 40571902
         EJECT                                                          40572102
EDI09570 EQU   *                        CONTINUE                 YM2133 40572702
         MODESET EXTKEY=ZERO            KEY OF DEB TABLE         Y02082 40574702
         OI    K3(RF),K1                INVALIDATE OLD ENTRY     YM2133 40577200
         MODESET EXTKEY=DATAMGT         RETURN TO O/C/E KEY      Y02082 40577902
EDI09580 EQU   *                        CONT AFTER DEBTABLE SRCH YM2133 40579202
         SR    RF,RF                                             YM0856 40581900
         LR    R1,RDEB                                                  40600021
         SH    R1,COLC0036                                              40800021
         IC    RF,DEB+K32-DEB(,R1)      PUT DEB LENGTH IN DOUBLE WORD   41000021
         SLL   RF,K3                    MULTIPLY BY 8                   41200021
         LR    R0,RF                    GET LENGTH OF DEB        Y02080 41250002
         L     RF,DXXPREFX              PREFIX ADDR              Y02080 41450002
         STM   R0,RET,IECREGSV-IECPREFX(RF) SAVE REGS            Y02080 41500002
         LR    RA,RF                    SAVE PREFIX ADDR         Y02080 41550002
         MODESET EXTKEY=SUPR            FREEMAIN KEY             Y02080 41600002
         L     R7,DXASCBAD              ASCB ADDR FOR FREEMAIN   Y02080 41630002
         L     RCORE,DEBTCBAD-DEB(R1)   TCB ADDR FOR FREEMAIN    Y02080 41640002
         LA    RCORE,K0(,RCORE)         CLEAR HIGH BYTE          Y02080 41642002
         FREEMAIN RU,LV=(0),A=(1),SP=230,KEY=5,BRANCH=YES        Y02080 41644002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02080 41646002
         LM    RBASE,R7,IECREGSV-IECPREFX+RBASE*K4(RA) GET 3,4,7 Y02080 41648002
         OI    DXATEOV,DXATDFRE         SHOW DEB CORE FREED      Y02144 41650002
         EJECT                                                          41660002
*                                                                Y02144 41700002
*        COMPUTING LENGTH OF NEW DEB                                    41800021
*                                                                       42000021
EDI09600 EQU   *                        BUILD NEW DEB                   42200021
         SR    RET,RET                  ZEROS IN RD                     42400021
         IC    RET,DSCNOEXT             PICK UP NUMBER OF EXT IN DSCB   42600021
         LTR   RET,RET                   ANY EXTENTS           @ZA02204 42601037
         BNZ   EDI09625                  YES, BRANCH           @ZA02204 42602037
         LA    RET,K1                    SET NO EXTENTS TO ONE @ZA02204 42603037
         TM    DCBMACRF,DCBMEXCP         EXCP DCB              @ZA02204 42604037
         BO    EDI09625                  YES, BRANCH           @ZA02204 42605037
         OI    DCBCIND1,DCBCNEVB         SET VOL FULL          @ZA02204 42606037
EDI09625 EQU   *                                               @ZA02204 42607037
         STC   RET,JFCBDSNM+K52         SAVING NUMBER OF EXT            42800021
         SLL   RET,K4                   MULTIPLY BY 16                  43000021
         AR    RET,R7                   ADD VOLSEQ,VOLNM,SUBRTINES      43200021
*                                                                       43400021
*        GET CORE FOR NEW DEB                                           43600021
*                                                                       43800021
         LA    R0,K69(K0,RET)           ADD LENGTH OF APPENDAGE  Y02080 44000002
*                                       + BASIC DEB              Y02080 44050002
         ST    R0,IECREGSV-IECPREFX+RET*K4(,RA) SAVE LENGTH OF   YM3909 44100002
*                                       GETMAIN WHERE RET WILL   YM3909 44150002
*                                       BE RESTORED              YM3909 44200002
         L     R7,DXASCBAD              ASCB ADDR FOR GETMAIN    Y02080 44250002
         L     RCORE,JFCBDSNM+(DEBTCBAD-DEB) TCB ADD FOR GETMAIN Y02080 44300002
         LA    RCORE,K0(,RCORE)         CLEAR HIGH BYTE          Y02080 44400002
         MODESET EXTKEY=SUPR            GETMAIN KEY              Y02080 44410002
         GETMAIN RU,LV=(0),SP=230,KEY=5,BRANCH=YES GET NEW DEB   Y02080 44420002
         EJECT                                                          44421002
         MODESET EXTKEY=SUPR            SETLOCK KEY              Y02080 44430002
EDI09650 SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCAL LOCK       Y02080*44440002
               RELATED=(LOCAL,IFG0553X(EDI09525,EDI09555,EDI09450))     44442002
         LM    R2,RET,IECREGSV-IECPREFX+R2*K4(RA) GET ALL REGS   Y02080 44444002
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGT. KEY  Y02080 44446002
         OI    DXATEOV,DXATDNEW         SHOW NEW DEB CORE GOTTEN Y02144 44450002
         EJECT                                                          44460002
*                                                                Y02144 44500002
*        BUILDING NEW DEB                                               44600021
*                                                                       44800021
*        MERGE OLD/NEW DEB AND UPDATING OF BASIC PORTION                45000021
*                                                                       45200021
         LR    RDEB,R1                  UPDATE DEB REGISTER             45400021
         MVC   DEBBASIC(K74),JFCBDSNM   MOVE PREF,BASIC,EXT PART YM1272 45600002
*                                                                       45800021
*        COMPUTING DEB LENGTH IN DOUBLE WORD                            46000021
*                                                                       46200021
         LA    RDEB,K32(K0,RDEB)        ADD 32 IN DEB REGISTER          46400021
         LR    R0,RET                   SAVE NUMBER OF OBTAINED BYTES   46600021
         LA    RET,K7(,RET)             ADD K7                          46800021
         SRL   RET,K3                   DIVIDING BY K8                  47000021
         STC   RET,0(,RDEB)             LENGTH IN DOUBLE WORDS TO DEB   47200021
         LA    RDEB,K4(,RDEB)           RESET DEB REGISTER TO POINT TO  47400021
         ST    R1,DEBAPPAD              ADDRESS OF APP POINTERS TO NEW  47600021
         NI    DEBOFLGS,K255-DEBOFEOF   SET EOF INDICATOR OFF    Y02080 47800002
         TM    DSCDSIND,UCBMOUNT        IS LAST VOLIND ON IN DSCB       48000021
         BZ    EDI09700                 NO BYPASS SET OF EOF IN         48200021
*                                       NEW DEB                         48400021
         OI    DEBOFLGS,DEBOFEOF        SET EOF IN DEBOFLGS             48600021
EDI09700 EQU   *                        CONT UPDATING NEW DEB           48800002
         MVI   DEBEXSCL,DCBOEOF         ESTABLISH LEN OF DEVICE  YM1272 49000002
*                                       DEPENDENT SECTION               49200021
         ST    RDEB,JFCINTVL            STORE NEW DEB ADDRESS           49400021
         SR    R0,R7                                                    49600021
         AR    R1,R0                    ADD NEW DEB ADDRESS             49800021
         BCTR  R1,K0                    ADD 1 TO LENGTH OF SUBROUTINE   50000021
         EX    R7,EDI10600              MOVE VOLSEQ,VOLNUM,IDS          50200002
         EJECT                                                          50250002
*                                                                       50400021
*        MERGE DSCB EXTENTS/NEW DEB                                     50600021
*                                                                       50800021
*        COMPUTING # OF TRACKS                                          51000021
*                                                                       51200021
*        CONVERT ROUTINE MBBCCHHR TO TTR                                51400021
*                                                                       51600021
         LR    R7,RCORE                 SET RG AS CORE REGISTER         51800021
         ST    R7,DXWORK1               SAVE FORMAT 1 POINTER    Y02134 51850002
         LA    R7,K56+K1(,R7)           POINT TO START OF EXTENT ENTRY  52000002
         LA    R8,DEBBASND              PT TO DA SECT            YM1272 52200002
         USING DEBDASD,R8               BASE FOR DA SECTION      YM1272 52250002
         SR    RC,RC                    CLEAR REGISTER                  52400021
         ST    RC,DXCCW5                SET -M- OF SEARCH TO ZERO       52600021
EDI09800 TM    DSCBEXTY-DXDSCB(R7),HEX40 USER LABEL EXTENT       Y02134 52800002
         BO    EDI10400                 IF UL EXTENT,BR TO SET INDIC    53000021
         MVC   DEBDVMOD(K6),JFCBDSNM+K68                         YM1272 53200002
         MVI   DEBDVMOD,X40+X10         INHIBIT WRITE COMMANDS & YM1272 53400002
*                                       PERMIT SEEK HH COMMANDS         53600021
         TM    JFCBDSNM+K48,DEBOPIO     INOUT OR OUTIN                  53800021
         BO    EDI09900                 YES, BRANCH                     54000021
         TM    JFCBDSNM+K48,DEBOPRBK    IS DEBOPATB FLD INPUT OR UPDATE 54200021
         BO    EDI10000                 NO, BRANCH                      54400021
         TM    JFCBDSNM+K48,DEBOPUPD    IS DEBOPATB FIELD = UPDATE      54600021
         BZ    EDI10000                 NO, BRANCH                      54800021
EDI09900 EQU   *                        INOUT OR OUTIN                  55000002
         MVI   DEBDVMOD,DEBOPRRD        PERMIT SEEK HH COMM      YM1272 55200002
EDI10000 CLI   DSCBEXTY-DXDSCB(R7),X'81' IS THIS CYLINDER ALLOC  Y02134 55400002
         BE    EDI10100                 YES,FILE MASK IS ALREADY SET    55800021
         OI    DEBDVMOD,DEBOFDCB        NO,INHIBIT ALL SEEK CMNDSYM1272 56000002
EDI10100 EQU   *                        FILE MASK SETTING NOW COMPLETE  56200021
         MVC   DEBSTRCC(K8),DSCBLLMT-DXDSCB(R7) LOWR+UPPR        YM1272 56400002
         EJECT                                                          56450002
*                                                                       56600021
*        SETTING MBBCCHHR                                               56800021
*                                                                       57000021
*        FOR BEGINNING OF EXTENT                                        57200021
*                                                                       57400021
         ST    RDCB,DXCCW7                                              57600021
         STM   RTIOT,RD,DXCCW7+K4                                       57800021
         L     RF,CVTPTR                ADDR OF COMMU VECTOR TABLE      58000021
         USING CVT,RF                   CVT ADDRESSABILITY       Y02080 58050002
         L     RF,CVTPRLTV              ENTRY POINT OF CONVERT ROUTINE  58200021
         LA    RDCB,DXCCW5              LOAD MBBCCHHR ADDRESS           58400021
         LA    R1,DXDEB                 LOAD DUMMY DEB ADDRESS          58600021
         MVC   DXCCW5+K1(K2),JFCBDSNM+K72  UPDATE BB                    58800021
         MVC   DXCCW5+K3(K4),DSCBLLMT-DXDSCB(R7) LOWR LIMIT CCHH Y02134 59000002
         MVI   DXCCW5+K7,K0             SET R=0                         59200021
         BALR  RET,RF                   MBBCCHHR TO TTR CONVERT ROUTINE 59400021
*                                                                       59600021
*        FOR END OF EXTENT                                              59800021
*                                                                       60000021
         ST    R0,DXCCW4                SAVE BEGINNING OF EXTENT TTR0   60200021
         MVC   DXCCW5+K3(K4),DSCBULMT-DXDSCB(R7) UPPR LIMIT CCHH Y02134 60400002
         L     RF,CVTPTR                ADDR OF COMMU VECTOR TABLE      60600021
         L     RF,CVTPRLTV              LOAD ENTRY POINT OF CONVERT ROU 60800021
         BALR  RET,RF                   MBBCCHHR TO TTR CONVERT ROUTINE 61000021
         L     RDCB,DXCCW7              RESTORE ADDRESS OF USER'S DCB   61200021
         LM    RTIOT,RD,DXCCW7+K4                                       61400021
         LA    RC,K1(,RC)                                               61600021
         EJECT                                                          61650002
*                                                                       61800021
*        COMPUTING # OF TRACKS                                          62000021
*                                                                       62200021
         S     R0,DXCCW4                SUBTRACT BEGINNING TTR0 FROM EN 62400021
         SRL   R0,K16                   RIGHT JUSTIFY TO REMOVE RECORD  62600021
         LR    R1,R0                    PICK UP NUMBER OF TRACKS MINUS  62800021
         LA    R1,K1(,R1)               ADD 1 TO NUMBER OF TRACKS       63000002
         STH   R1,DEBNMTRK              STORE # TRKS IN EXTENT   YM1272 63200002
         NC    DEBSTRCC(K8),DEBSTRCC     ANY EXTENTS           @ZA02204 63201037
         BNZ   EDI10150                  YES, BRANCH           @ZA02204 63202037
         MVC   DEBSTRCC(K4),FOXES        SET INVALID EXTENT    @ZA02204 63203037
EDI10150 EQU   *                                               @ZA02204 63204037
         SR    R1,R1                    ZEROS IN RF                     63400021
         IC    R1,DEBNMEXT              NUMBER EXTNTS IN NEW DEB        63600021
         CR    R1,RC                    IS LAST EXTENT                  63800021
         BE    EDI10700                 YES                             64000021
         LA    R8,K16(,R8)              ADD 16                          64200021
         DROP  R8                                                YM1272 64250002
EDI10200 LA    R7,K10(,R7)              ADD 10                          64400021
         LA    R1,K3                    IF NO UL, 3 EXTENTS IN F1       64600021
         CLI   DXCCW12+K3,CSWUNITX      CK IF WAS UL EXTENT             64800021
         BNE   EDI10300                 NO, BRANCH                      65000021
         BCTR  R1,K0                    UL EXTNT, ONLY 2 EXTNTS IN F1   65200021
EDI10300 EQU   *                        UL17                            65400021
         CR    R1,RC                    CK IF LAST EXTNT FROM F1 IN DEB 65600021
         BNE   EDI09800                 NO, MERGE NEXT EXTENT           65800021
*                                                                Y02134 66010002
         L     R1,DXWORK1               GET PTR TO DSCB          Y02134 66050002
         L     R7,CORECH(,R1)           LOAD POINTER TO F3       Y02134 66100002
         LA    R1,L'JFCBDSNM(,R7)       BUMP PASSED KEY          Y02134 66150002
         ST    R1,DXWORK1               SAVE F3 PTR              Y02134 66160002
*                                       CCHHR OF FORMAT 3 FROM FORMAT1  67000021
         MVC   DSCBFMID+K44-DXDSCB(K91,R7),DSCBFMID+K45-DXDSCB(R7)      69000002
*                                       CONCATENATE THE EXTENTS  Y02134 69002002
         B     EDI09800                 GO TO SET UP ENTENTS IN THE NEW 69600021
*                                                                       69800021
EDI10400 EQU   *                        UL EXTENT                       70000002
         MVI   DXCCW12+K3,CSWUNITX      SET UL EXTENT INDICATOR         70200021
         B     EDI10200                 BR TO GET NEXT EXTENT           70400021
         SPACE 1                                                        70600021
EDI10500 EQU   *                        USED IN EX INSTRUCTION          70800002
         MVC   JFCBDSNM+K74(K0),K0(R1)                                  71000021
EDI10600 EQU   *                        USED IN EX INSTRUCTION          71200002
         MVC   K0(K0,R1),JFCBDSNM+K74                                   71400021
         EJECT                                                          71450002
*                                                                       71600021
*        INCLUDE NEW DEB IN THE CHAINING                                71800021
*                                                                       72000021
EDI10700 L     R1,DEBTCBAD              ADDR OF THE TCB FOR THIS TASK   72200021
         LA    RDEB,K0(,RDEB)           CLEAR HI-ORDER BYTE      Y02082 72250002
         STCM  RDEB,B'0111',DCBDEBAD+K1 PUT DEBAD IN COPY DCB    Y02082 72400002
         L     RET,DXUDCBAD             ADDR USER DCB            Y02082 72420002
         MODESET KEYADDR=DXUKEY,WORKREG=13 KEY USER DCB          YM5305 72420402
         DROP  RDCB                                              Y02082 72422002
         USING IHADCB,RET               USER DCB BASE            Y02082 72424002
         STCM  RDEB,B'0111',DCBDEBAD+K1 PUT DEBAD IN USER DCB    Y02082 72430002
         DROP  RET                                               Y02082 72440002
         USING IHADCB,RDCB              REESTABLISH COPY BASE    Y02082 72440402
         MODESET EXTKEY=DATAMGT         BACK TO EOV KEY          Y02082 72442002
         CLM   R1,B'0111',DXTCBADR      DOES DEB POINT TO        Y02082 72452002
*                                       CURRENT TCB              Y02082 72462002
         BE    EDI10702                 BRANCH IF YES - CHAIN    Y02082 72472002
*                                       DEB TO CURRENT TCB       Y02082 72482002
         CLI   DXCCW6+K4,CHARFF         WAS OLD DEB SAVED        Y02082 72492002
         BNE   EDI10702                 BRANCH IF NO TO CHAIN    Y02082 72502002
*                                       DEB TO DEBTCBAD TCB      Y02082 72522002
         L     R1,DXTCBADR              CHAIN DEB TO CURRENT TCB Y02082 72532002
*                                       SO DEBCHK-ADD WORKS      Y02082 72542002
         EJECT                                                          72543002
EDI10702 EQU   *                        CHAIN DEB TO R1'S TCB    Y02082 72552002
         BAL   RET,EDI10780             GO TO DEB CHAIN SUBRTN.  Y02082 72562002
         L     R1,DEBTCBAD              TCB WHICH DEB SHOULD BE  Y02082 72572002
*                                       CHAINED TO               Y02082 72582002
         L     RET,DXDEBXAD             GET DEB EXTENSION ADDR   Y02134 72952002
         USING DEBXTN,RET                                        Y02134 72954002
         MVC   DEBXDBPR,JFCINTVL        MOVE DEB ADDR TO DEBX    Y02134 72956002
         DROP  RET                                               Y02134 72958002
         LA    RWTGC,DXXENTRY           CURRENT MODULE NAME             72968002
         LA    RWTG,DXXAREA             NEXT MODULE NAME                72978002
         MVC   JFCBLTYP,DXCCW12+K4      RESTORE LABEL TYPE FOR UL       73200021
         MVC   JFCBELNM(K8),DXCCW10     RESTORE MEMBER FOR BLDL         73400021
         MVC   DSCFILTY(K1),DXCCW11     RESTORE DSCB DSORG              73600021
         MVC   JFCBIND1,DXCCW11+K1      RESTORE PDS MEM IND IN THE JFCB 73800021
         MVC   DSCEXTYP(K6),DXCCW11+K2                                  74000002
*        CHECK FOR DEB CHAINED TO CURRENT TCB                    YM2133 74070000
*                                                                YM2133 74080000
         L     RF,CVTADDR               CVT ADDRESS              YM2133 74092000
         L     RF,CVTTCBP-CVT(RF)       ADDR TCB PTRS            Y02080 74092402
         L     RF,K4(RF)                ADDRESS OF CURRENT TCB   YM2133 74094000
         LA    RF,K0(RF)                ZERO HIGH ORDER BYTE     YM2133 74096000
         LA    R1,K0(R1)                ZERO HIGH ORDER BYTE     YM2133 74098000
*                                                                YM2133 74098400
*        THE EOV WAS ISSUED FROM A TASK DIFFERENT THAN THE ONE   YM2133 74098800
*        IN WHICH THE DEB WAS CREATED IF THE TCB ADDRESS IN THE  YM2133 74099200
*        DEB IS NOT THE SAME AS THE CURRENT TCB ADDRESS.         YM2133 74099300
*                                                                YM2133 74099600
         CLR   R1,RF                    IS DEB ON THIS TCB       YM2133 74099700
         BE    EDI10705                 YES - ISSUE DEBCHK       YM2133 74099800
         CLI   DXCCW6+K4,CHARFF         SPAN RCD IN UPDATE MODE  YM2133 74099900
         BNE   EDI10710                 NO - BYPASS DEBCHK ADD   YM2133 74107000
*                                                                YM2133 74114500
*        EOV IN SAME TASK AS OPEN, OR IN DIFFERENT TASK BUT      YM2133 74121602
*        OLD DEB SAVED - ISSUE DEBCHK ADD                        Y02082 74123602
*                                                                YM2133 74128700
         EJECT                                                          74129702
EDI10705 EQU   *                        INITIALIZE DEB PREFIX    YM2133 74130702
         L     RD,DEBTCBAD              GET DEB'S TCB ADDR       Y02082 74131702
         MVC   DEBTCBAD+K1(K3),DXTCBADR+K1 POINT DEB TO CURRENT  Y02082 74132702
*                                       TCB FOR DEBCHK           Y02082 74133702
         LA    RET,K3                   NEGATIVE OFFSET OF       Y01021 74135800
*                                       DEBAMTYP                 Y01021 74142900
         SR    RDEB,RET                 ADDRESS AMTYPE           Y01021 74150000
         IC    RET,K0(R0,RDEB)          GET ACCESS METHOD TYPE   Y01021 74160000
         XC    K0(K3,RDEB),K0(RDEB)     ZERO DEBAMTYP & DEBTBLOF Y01021 74170002
         L     R1,DXPDCBAD              POINT TO PROTECTED DCB   Y02082 74190002
         DEBCHK (R1),TYPE=ADD,AM=((RET))     ADD DEB TO DEBTABLE Y01021 74192002
         LR    RDEB,R1                  RESTORE DEB ADDRESS      Y01021 74194000
         STCM  RD,B'0111',DEBTCBAD+K1   REPLACE DEB'S TCB ADDR   Y02082 74195002
         CLC   DEBTCBAD+K1(K3),DXTCBADR+K1 IS DEB ON CURRENT TCB Y02082 74204002
         BE    EDI10720                 BRANCH IF YES            Y02082 74224002
*                                                                       74234002
*        DEB IS CHAINED ON WRONG TCB BECAUSE OLD DEB WAS SAVED   Y02082 74244002
*        TO SUPPORT VBS UPDATE - DEB NOW IN DEB TABLE SO UNCHAIN Y02082 74254002
*        FROM CURRENT TCB AND CHAIN TO CORRECT (DEBTCBAD) TCB    Y02082 74264002
*                                                                       74266002
         L     RD,DXTCBADR              CURRENT TCB              Y02082 74266402
         BAL   RET,EDI10750             UNCHAIN FROM CURRENT TCB Y02082 74266802
         L     R1,DEBTCBAD              CORRECT TCB              Y02082 74267202
         BAL   RET,EDI10780             CHAIN TO CORRECT TCB     Y02082 74267302
         B     EDI10720                 GO TO NEXT MODULE        YM2133 74267402
         EJECT                                                   YM2133 74269402
*                                                                YM2133 74271402
*        THE FOLLOWING CODE IS EXECUTED IN LIEU OF DEBCHK        YM2133 74273402
*        WHENEVER THE DEB IS CHAINED TO A TCB DIFFERENT THAN     YM2133 74273802
*        THE CURRENT ONE.  THIS IS ACCOMPLISHED BY REPLACING     YM2133 74274202
*        THE EXISTING DEBTABLE ENTRY WITH THE NEW DEB ADDRESS.   YM2133 74274602
*                                                                YM2133 74275400
EDI10710 EQU   *                        OBTAIN LOCK FOR DEBTABLE YM2133 74275802
         L     RF,DXXPREFX              GET PREFIX               Y02080 74276802
         STM   R0,RF,IECREGSV-IECPREFX(RF)  SAVE REGS            Y02080 74277802
         MODESET  EXTKEY=ZERO           KEY 0                    Y02080 74278802
EDI10712 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080X74286702
               RELATED=(LOCAL,IFG0553X(EDI10714))                Y02080 74286802
         MODESET  EXTKEY=DATAMGT        DATA MANAGEMENT KEY      Y02080 74286902
         LM    R0,RF,IECREGSV-IECPREFX(RF)  RESTORE REGS         Y02080 74287202
         L     RF,DXTCBADR              GET CURRENT TCB ADDR     Y02080 74287902
         USING TCB,RF                   ESTABLISH TCB ADDR       Y02080 74288002
         L     RF,TCBJSCB               GET ADDR OF JSCB         Y02080 74288102
         DROP  RF                                                Y02080 74288202
         USING IEZJSCB,RF               ESTABLISH JSCB ADDR      Y02080 74288302
         L     R1,JSCBDBTB              GET ADDR OF DEB TBL      Y02080 74288402
         DROP  RF                                                Y02080 74288502
         L     RF,DXCCW6+K4             GET SAVED OFFSET         Y02080 74288602
         LA    RDEB,K0(RDEB)            ZERO HIGH ORDER BYTE     YM2133 74288702
         MODESET EXTKEY=ZERO            KEY OF DEB TABLE         Y02082 74289702
         ST    RDEB,K0(RF,R1)           PLACE NEW ADDR IN TABLE  Y02080 74290702
         EJECT                                                          74290802
         L     RF,DXXPREFX              GET PREFIX               Y02080 74290902
         STM   R0,RF,IECREGSV-IECPREFX(RF)  SAVE REGS            Y02080 74291102
EDI10714 SETLOCK RELEASE,TYPE=LOCAL,                             Y02080X74291702
               RELATED=(LOCAL,IFG0553X(EDI10712))                Y02080 74291902
         MODESET EXTKEY=DATAMGT         RET EOV KEY              Y02082 74292002
         LM    R0,RF,IECREGSV-IECPREFX(RF)  RESTORE REGS         Y02080 74293202
         EJECT 1                                               @Y30LSBS 74293303
*                                                              @Y30LSBS 74293403
*        CHECK THE UCB FOR AN MSS SUBSYTEM VIRTUAL DASD AND    @Y30LSBS 74293603
*        CREATE A PARAMETER LIST FROM THE DEB EXTENTS TO       @ZA19720 74293824
*        ACQUIRE STAGING SPACE UP TO THE LAST WRITTEN RECORD   @Y30LSBS 74293924
*        ALL SUCH EXTENTS ARE STAGED.                          @ZA19720 74294024
*                                                              @ZA19720 74294124
*        IF THE DATA SET HAS BEEN OPENED WITH THE INOUT OPTION,@ZA19720 74294224
*        IT IS POSSIBLE FOR THE USER TO READ TO EOF,TCLOSE     @ZA19720 74294324
*        AND THEN START WRITING. IF THE USER DOES THIS, WE WILL@ZA19720 74294424
*        CYLINDER FAULT FOR ALL CYLINDERS BEYOND EOF.          @ZA19720 74294524
*                                                              @ZA19720 74294624
EDI10720 EQU   *                        VIRTUAL DASD ROUTINE   @Y30LSBS 74294724
         LA    RC,DEBBASND              EXTENT ADDRESSABILITY  @ZA19720 74294824
         USING DEBDASD,RC                                      @ZA19720 74294924
         L     RUCB,DEBUCBAD            POINTER TO THE UCB     @ZA19720 74295024
         TM    UCBTBYT2,UCBRVDEV        IS IT VIRTUAL          @Y30LSBS 74295124
         BNO   EDI1074D                 NO, CONTINUE MAINLINE  @Y30LSBS 74295224
         CLC   DEBSTRCC,FOXES           YES,VALID EXTENT?      @ZA19720 74295324
         BE    EDI1074D                 NO, CONTINUE MAINLINE  @ZA19720 74295424
         DROP  RTIOT                                           @ZA19720 74295524
         LA    RTIOT,DXJBF              ESTABLISH ACQUIRE LIST @ZA19720 74295624
         USING ACQLST,RTIOT                                    @ZA19720 74295724
         XC    ACQLST(ACQPLN+8),ACQLST  ZERO OUT A WORK AREA   @ZA19720 74295824
*                                       PARM LIST + MBBCC SAVE @ZA19720 74295924
         MVI   ACQLST+3,ACQPLN          MOVE IN LIST LENGTH    @ZA19720 74296024
         MVC   ARVOL,UCBVOLI            MOVE IN THE VOLID      @ZA19720 74296224
         CLC   DSCLSTAR(K5),ZEROI       IS TTRLL = 0           @Y30LSBS 74296324
         MVI   MCCSAVE,X7F              MAKE M = X'7F00'       @ZA19720 74296424
         BE    EDI10730                 BYPASS TTR CNVT        @ZA19720 74296524
         MVI   MCCSAVE,K0               MAKE M = X'00XX'       @ZA28613 74298524
*                                                              @Y30LSBS 74300703
*        DETERMINE WHERE AND IN WHAT EXTENT LAST RECORD WAS    @Y30LSBS 74300803
*        WRITTEN                                               @Y30LSBS 74306903
*                                                              @Y30LSBS 74307603
EDI10727 EQU   *                                               @Y30LSBS 74308303
         L     RF,DXXPREFX              GET PREFIX             @Y30LSBS 74309003
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE ALL REGS       @Y30LSBS 74309703
         SR    R0,R0                    ZERO                   @Y30LSBS 74310403
         ICM   R0,B'1110',DSCLSTAR      GET THE TTR            @ZA19720 74311124
         LA    R1,R0(RB)                POINT TO THE DEB       @Y30LSBS 74311624
         LA    R2,MCCSAVE+1             MBBCCHHR SAVE AREA     @ZA19720 74312124
         L     RF,CVTADDR               POINT TO CVT           @Y30LSBS 74313203
         L     RF,CVTPCNVT-CVT(RF)      POINT TO TTR CNVT RTN  @Y30LSBS 74313903
         BALR  RET,RF                   GO TO CONVERT ROUTINE  @ZM30032 74314603
         L     RF,DXXPREFX              POINT TO PREFIX        @Y30LSBS 74315303
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGS        @Y30LSBS 74316003
*                                                              @Y30LSBS 74317403
*        M = X'7F00' - NOT LAST VOLUME OF DATA SET             @ZA19720 74318124
*                                                              @ZA19720 74318824
*        M = X'00XX' - THE EXTENT WHERE THE LAST RECORD WAS    @Y30LSBS 74319524
*                      WRITTEN FOR A PHYS. SEQ. DATA SET       @ZA19720 74320224
*                      'M' IS FOLLOWED BY THE BBCCHH. R IS NOT @ZA19720 74320924
*                      NEEDED.                                 @ZA19720 74321624
*                                                              @Y30LSBS 74324403
EDI10730 EQU   *                                               @Y30LSBS 74325103
         SR    RF,RF                    ZERO A REG             @Y30LSBS 74325803
         LR    RET,RF                   ZERO ANOTHER           @Y30LSBS 74326503
         IC    RET,DEBNMEXT             GET NUMBER OF EXTENTS  @Y30LSBS 74327203
*                                                              @Y30LSBS 74329303
*        CREATE THE PARAMETER LIST FOR THE ACQUIRE             @Y30LSBS 74330003
*                                                              @Y30LSBS 74330703
EDI10734 EQU   *                                               @ZA19720 74334124
         MVC   AREXT(2),DEBSTRCC        MOVE IN THE LO CC      @ZA19720 74334824
         CH    RF,JFCTRKBL              EXTENT OF LAST PHYS REC@ZA28613 74335524
         BNE   EDI10745                 NO, GET THE HI CC      @ZM30032 74336124
         LH    R1,JFCRECFM              GET THE CC OF LAST REC @ZA28613 74336724
         CLC   JFCBLKSI(2),DEBENDHH     LAST TRACK OF DS ON CYL@ZA28613 74337324
         BL    EDI10736                 NO, JUST GET UP TO CYL @ZM30032 74337924
         CH    R1,DEBENDCC              LAST CYL OF EXTENT     @ZA28613 74338524
         BE    EDI10738                 YES,GO SEE IF ANOTHER  @ZA19720 74339124
*                                       DEB EXTENT             @ZA19720 74339724
         LA    R1,1(,R1)                INSURE EOF MARK GOTTEN @ZA28613 74340324
EDI10736 EQU   *                                               @Y30LSBS 74340924
         STH   R1,AREXT+2               CC IS THE LAST STAGED  @ZA28613 74341524
         LA    RF,K1(RF)                NUMBER OF EXTENTS      @Y30LSBS 74343224
         B     EDI10749                 GO SAVE NUM OF EXTENTS @ZA19720 74343924
EDI10738 EQU   *  EOF MAY NOT BE ON CYL CONTAING LAST REC      @ZA19720 74344624
         STH   R1,AREXT+2               ENDING CYL OF THIS EXT @ZA19720 74345324
         LA    RF,1(RF)                 COUNT THIS EXTENT      @ZA19720 74346024
         BCTR  RET,0                    IS THERE ANOTHER EXTENT@ZA19720 74346724
         BZ    EDI10749                 NO,GO ISSUE ACQUIRE    @ZA19720 74347424
         LA    RTIOT,L'AREXT(RTIOT)     YES,POINT TO NEXT      @ZA19720 74348124
         LA    RC,DEBEXTLN              EXTENT IN DEB AND ACQ  @ZA19720 74348824
         MVC   AREXT(2),DEBSTRCC        EOF MAY BE ON THE FIRST@ZA19720 74349524
         MVC   AREXT+2(2),DEBSTRCC      TRACK OF THIS CYLINDER @ZA19720 74350224
         LA    RF,1(RF)                 ACCOUNT FOR THIS EXTENT@ZA19720 74350924
         B     EDI10749                 GO ISSUE ACQUIRE       @ZA19720 74351624
EDI10745 EQU   *                                               @Y30LSBS 74352324
         MVC   AREXT+2(2),DEBENDCC      GET HI CC              @ZA19720 74353024
EDI10746 EQU   *                                               @Y30LSBS 74353724
         LA    RTIOT,L'AREXT(RTIOT)     POINT TO NEXT LIST ENT @ZA19720 74354424
         LA    RF,K1(RF)                INCREMENT COUNTER      @Y30LSBS 74355124
EDI10747 EQU   *                                               @Y30LSBS 74355824
         LA    RC,DEBEXTLN              POINT TO NEXT DEB EXT  @ZA19720 74356524
         BCT   RET,EDI10734             RETURN FOR MORE EXTENTS@ZA19720 74357224
*                                                              @Y30LSBS 74357924
*        ISSUE ICBACREL                                        @ZA19720 74358624
*                                                              @Y30LSBS 74359324
EDI10749 EQU   *                                               @Y30LSBS 74360024
         LA    RTIOT,DXJBF                                     @ZA19720 74360724
         STC   RF,ARNMEXTS              ST NUMBER OF EXTENTS   @ZA19720 74361424
         LR    R1,RTIOT                                        @ZA19720 74362124
         DROP  RTIOT                                           @ZA19720 74362824
         USING ACQLST,R1                                       @ZA19720 74363524
         MVI   ACQLST+K4,K2                                    @ZA28613 74363824
         ICBACREL TYPE=ACQ,MF=(E,ACQLST) ACQUIRE THE SPACE     @ZM30032 74364224
         DROP  R1                                              @ZA19720 74364924
         LTR   RF,RF                    ANY ERRORS             @Y30LSBS 74365624
         BZ    EDI1074D                 NO                     @ZA19720 74366324
*        ACQUIRE FAILED - ABEND                                @Y30LSFY 74375503
ERR111   EQU   111                      IDMS FAILURE CODE      @Y30LSFY 74376203
         LR    RB,R1                    PASS PARM LIST PTR     @Y30LSFY 74376903
         LA    RWTGC,DXXENTRY           SET RWTGC FOR RES RTN  @Y30LSFY 74377603
         LA    RWTG,DXXAREA             POINT TO EOV WTG       @Y30LSFY 74378303
         DMABCOND ERR111,LOAD0P         XCTL TO PROB DET       @Y30LSFY 74379003
         DROP  RC                                              @ZA19720 74381024
         USING TIOENTRY,RTIOT                                  @ZA19720 74381524
         EJECT 1                                               @Y30LSBS 74383903
*                                                                       74384603
*        REREAD JFCB TO REFRESH WORKAREA OVERLAID BY DEB         YM3116 74385303
*                                                                       74386003
EDI1074D EQU   *                        RETURN TO RES ROUTINE  @Y30LSBS 74386703
         L     RTIOT,DXTIOTAD           GET TIOT ENTRY ADDR      YM3116 74387403
         LA    RET,TIOEJFCB             GET JFCB ADDRESS ADDRESS YM3116 74388103
         IECRES LOCJFCB,(RET)           LOCATE JFCB ADDRESS      YM3116 74388803
         MVC   DXJBF(JFCBLGTH),INFMJFCB-INFMJFCB(RET) MOVE JFCB  YM3116 74389503
*                                                                       74390203
*        SETUP NEW DEBVOLSQ AND DEBVOLNM                         YM5340 74390903
*        DEBVOLNM CHANGES IF CONCATENATION OF LIKE ATTRIBUTES    YM5340 74391603
*                                                                       74392303
         XR    RET,RET                  ZERO FOR IC              YM5340 74393003
         IC    RET,DEBNMEXT             NUMBER OF 16-BYTE EXTNTS YM5340 74393703
         SLL   RET,K4                   LENGTH OF EXTENTS        YM5340 74394403
         LA    RET,DEBBASND-DEBBASIC(RET,RDEB) RET POINTS TO     YM5340 74395103
*                                       ACCESS METHOD SECTION    YM5340 74395803
         USING DEBACSMD,RET                                      YM5340 74396503
         MVC   DEBVOLSQ,DXVOLSEQ        UPDATE DEBVOLSQ          YM5340 74397203
         MVC   DEBVOLNM+K1(K1),JFCBNVOL UPDATE DEBVOLNM          YM5340 74397903
         DROP  RET                                               YM5340 74398603
         LA    RET,K0                   SET RETURN CODE                 74399303
         LA    RF,LOA5553Z                                              74400021
         IECRES LOAD,MODID=(RF),BRCODE=(RET),BRANCH=QUEUED       Y02080 74650002
         EJECT                                                          74800002
*                                                                       74810002
*        SUBROUTINE TO UNCHAIN DEB FROM TCB                      Y02082 74820002
*        ENTERED IN KEY 5 - EXIT IN KEY 5                        Y02082 74830002
*              RDEB POINTS TO DEB                                Y02082 74840002
*              RD POINTS TO TCB                                  Y02082 74850002
*              RET IS RETURN ADDRESS                             Y02082 74860002
*        REGS 0-14 WILL BE SAVED IN THE WORKAREA PREFIX AND      Y02082 74870002
*        WILL BE RETURNED                                        Y02082 74880002
*        RF WILL BE DESTROYED                                    Y02082 74890002
*                                                                       74900002
EDI10750 EQU   *                        UNCHAIN DEB              Y02082 74910002
         L     RF,WTGPREFX              PT TO PREFIX             Y02082 74920002
         USING IECPREFX,RF                                       Y02082 74930002
         STM   R0,RET,IECREGSV          SAVE REGS THRU LOCK      Y02082 74940002
         MODESET EXTKEY=SUPR            SUPERVISOR KEY           Y02082 74950002
*                                       OBTAIN LOCAL LOCK        Y02082 74960002
EDI10755 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02082*74970002
               RELATED=(LOCAL,IFG0553X(EDI10775))                Y02082 74980002
         LM    R0,RET,IECREGSV          RESTORE REGS             Y02082 74990002
EDI10760 EQU   *                        LOAD REGISTERS           Y02082 75000002
         LR    RC,RDEB                  PRIME WITH DEB ADDR      Y02082 75010002
         LA    R1,K4(,RD)               TCB ADDRESS + 4          Y02082 75020002
EDI10765 EQU   *                        CHECK FOR CORRECT DEB    YM1482 75030002
         CLM   RC,B'0111',DEBDEBAD+K1-DEBBASIC(R1) EQUAL?        YM1482 75040002
         BE    EDI10770                 BRANCH, IF YES                  75050002
         L     R1,DEBDEBAD-DEBBASIC(,R1) GET CORRECT DEB         YM1482 75060002
         B     EDI10765                 BRANCH TO TEST FOR CORRECT DEB  75070002
EDI10770 EQU   *                        CORRECT DEB DELETE IT    Y02082 75080002
         L     R8,DEBDEBAD              PTR TO NEXT DEB          Y02082 75090002
         ICM   R8,B'1000',DEBDEBAD-DEBBASIC(R1) PRIME HI BYTE    YM1482 75100002
         ICM   RC,B'1000',DEBDEBAD-DEBBASIC(R1)                  YM1482 75110002
         CS    RC,R8,DEBDEBAD-DEBBASIC(R1) DECHAIN DEB           YM1482 75120002
         BNZ   EDI10760                 BR IF NOT SUCCESSFUL     Y02082 75130002
         OI    DXATEOV,DXATDCHN         SHOW DEB DECHAINED       Y02144 75140002
         EJECT                                                          75142002
EDI10775 SETLOCK RELEASE,TYPE=LOCAL,                             Y02082*75150002
               RELATED=(LOCAL,IFG0553X(EDI10755))                Y02082 75160002
         LM    R0,RET,IECREGSV          RESTORE REGS             Y02082 75170002
         MODESET EXTKEY=DATAMGT         DATA MANAGEMENT KEY      Y02082 75180002
         BR    RET                      RETURN TO CALLER         Y02082 75190002
         DROP  RF                                                Y02082 75200002
         SPACE 2                                                        75202002
*                                                                       75204002
*        SUBROUTINE TO CHAIN DEB TO TCB                          Y02082 75206002
*        ENTERED IN KEY 5, EXIT IN KEY 5                         Y02082 75208002
*              RDEB POINTS TO DEB                                Y02082 75208402
*              R1 POINTS TO TCB                                 Y02082  75208802
*              RET POINTS TO RETURN ADDRESS                      Y02082 75209202
*              RD WILL BE DESTROYED IN THIS SUBROUTINE           Y02082 75209602
*                                                                       75209702
EDI10780 EQU   *                        CHAIN DEB TO TCB         Y02082 75210002
         USING TCB,R1                                                   75212002
         LA    RDEB,K0(,RDEB)           CLEAR HIGH BYTE          Y02082 75214002
         L     RD,TCBDEB                PT TO FIRST DEB          Y02080 75220002
         MVC   DEBDEBAD+K1(K3),TCBDEB+K1 DEB POINTER FROM TCB    Y02082 75230002
         MODESET EXTKEY=SUPR            TCB MODIFIED             Y02082 75240002
         CS    RD,RDEB,TCBDEB           CHAIN NEW DEB            Y02082 75250002
         MODESET EXTKEY=DATAMGT         EOV KEY                  Y02082 75260002
         BNZ   EDI10780                 BR IF NOT SUCCESSFUL     Y02082 75270002
         NI    DXATEOV,X'FF'-DXATDCHN   SHOW DEB CHAINED         Y02144 75280002
         BR    RET                      RETURN TO CALLER                75290002
         SPACE 2                                                        75290102
EDI10782 DMABCOND PCK,PGFREE            PGFREE ERROR             YM5929 75290302
         EJECT                                                          75300002
*                                                                       79450002
*                   CONSTANTS                                           79500002
*                                                                       79550002
         SPACE 1                                                        79600002
         DS    0F                                                       79650002
COLC0036 DC    H'36'                    CONSTANT 36                     80200021
FOXES    DC    X'FFFFFFFF'              INVALID EXTENT         @Y30LSBS 80230003
ZEROI    DC    X'0000000000'            ZEROS                  @Y30LSBS 80250003
*                                                              @Y30LSBS 80280003
*        SOME MSS  EQUATES                                     @Y30LSBS 80310003
*                                                              @Y30LSBS 80340003
ACQPLN   EQU   96                       PARM LIST LENGTH       @Y30LSBS 80370003
ACQOP    EQU   X'02'                    ACQUIRE OP CODE        @Y30LSBS 80370103
X7F      EQU   X'7F'                    A VERY HIGH 'M' VALUE  @Y30LSBS 80586003
         EJECT                                                          80600002
         XCTLTABL ID=(LOA5553Z,3Z,LOAD0P,0P),                    Y02134X80800002
               SVC=055,BRT=YES,LENGTH=                           Y02080 80810002
         IECDSECS CVT,TCB,TIOT,DCB,UCB,MAIN,WTG,PREFX,IEZDEB,    YM1272*81000002
               JSCB,PSA,EXPAND=YES                               Y02134 81050002
DEBEXTLN EQU    DEBNMTRK+L'DEBNMTRK                            @ZA19720 81120024
         IECEQU IEZDEB=YES                                       Y02134 81170024
ACQLST   DSECT                                                 @Y30LSFY 81220024
         ICBACREL TYPE=ACQ,MF=L         LIST FORM OF ACQUIRE   @Y30LSBS 81270024
MCCSAVE  DS    CL9                                             @ZA19720 81320024
         END                                                            81370024
