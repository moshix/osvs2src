         TITLE 'IFG0554B                      FEOV DIRECT ACCESS VBS UP*00200002
               DATE REPOSITIONING/FREE DEB FUNCTION'             Y02082 00250002
IFG0554B CSECT                                                          00300002
*********************************************************************** 00350002
*                                                                     * 00400002
*                                                                     * 00450002
*          VS2 RELEASE 03 DELETIONS                                   * 00460002
*0000                                                          @ZM33024 00470002
*0000                                                          @ZA02522 00480002
*0000                                                          @ZA02528 00480102
*          VS2 RELEASE 02 DELETIONS                                   * 00500002
*                                                                     * 00550002
*                                                                     * 00600002
*********************************************************************** 00650002
*                                                                     * 00700002
* MODULE NAME = IFG0554B (OS/VS2)                                     * 00750002
*                                                                     * 00800002
* DESCRIPTIVE NAME =                                                  * 00850002
*        FEOV DIRECT ACCESS VBS UPDATE REPOSITIONING/FREE DEB FUNCTION* 00900002
*                                                                     * 00950002
* COPYRIGHT = NONE                                                    * 01000002
*                                                                     * 01050002
* STATUS = RELEASE 2, LEVEL 0                                         * 01100002
*                                                                     * 01150002
* FUNCTION =                                                          * 01200002
*        ENTERED FROM IFG0551H IF BIT 3 IN DCBIOBAD IS SET TO 1       * 01250002
*        AND FEOV WAS ISSUED FOR A DIRECT ACCESS UPDATE DATA SET      * 01300002
*        PROCESSING VARIABLE BLOCKED SPANNED RECORDS.                 * 01350002
*                                                                     * 01400002
*        THIS MODULE HAS TWO FUNCTIONS-                               * 01450002
*                                                                     * 01460002
*        1) (CALLED THE 'FREE OLD DEB' FUNCTION) FREE THE DEB         * 01500002
*        WHOSE ADDRESS HAS BEEN SAVED IN DCBIOBAD.                    * 01550002
*        THIS INVOLVES REMOVING IT FROM THE DEB TABLE AND FREEING THE * 01600002
*        VIRTUAL STORAGE IT OCCUPIES.                                 * 01650002
*                                                                     * 01660002
*        2) (CALLED THE 'REPOSITION' FUNCTION) REESTABLISH THE        * 01700002
*        DEB WHOSE ADDRESS HAS BEEN SAVED IN DCBIOBAD (CHAIN IT TO    * 01750002
*        THE TCB DEB CHAIN AND ENSURE THE VOLUME IT REPRESENTS IS     * 01800002
*        MOUNTED BY GIVING IFG0554A CONTROL) AND FREEING THE CURRENT  * 01850002
*        DEB WHICH DCBDEBAD POINTS TO.                                * 01900002
         EJECT                                                          01950002
*        THE 'REPOSITION' FUNCTION IS IMPLEMENTED AS FOLLOWS-         * 02000002
*                                                                     * 02050002
*        R1) THE CURRENT DEB IS PAGE FREED IF IT HAD BEEN PAGE FIXED. * 02060002
*        THE LOCAL LOCK IS OBTAINED AND THE CURRENT DEB (POINTED      * 02100002
*        TO BY DCBDEBAD) IS DELETED FROM THE TCB DEB CHAIN OF THE TCB * 02150002
*        IN DEBTCBAD.                                                 * 02200002
*                                                                     * 02250002
*        R2) STILL HOLDING THE LOCK, THE BRANCH ENTRY TO THE DEB      * 02300002
*        VALIDITY CHECK ROUTINE IS ENTERED TO VERIFY THAT THE OLD DEB * 02350002
*        POINTED TO BY DCBIOBAD IS IN THE DEB TABLE. IT IS VERIFIED   * 02400002
*        THAT THE DEBDCBAD OF THE OLD DEB POINTS TO THE USER'S DCB    * 02450002
*        WITH ITS LOW ORDER BIT FLIPPED. IF EITHER OF THESE TESTS     * 02500002
*        FAIL, PROBLEM DETERMINATION IS GIVEN CONTROL CAUSING A       * 02550002
*        937-1C ABEND. THE LOCAL LOCK IS RELEASED.                    * 02600002
*                                                                     * 02650002
*        R3) THE OLD DEB IS POINTED TO THE COPIED DCB AND THE         * 02700002
*        COPIED DCB IS POINTED TO THE OLD DEB.                        * 02750002
*                                                                     * 02800002
*        R4) THE OLD DEB IS CHAINED TO THE TCB DEB CHAIN OF THE       * 02850002
*        TCB IN ITS DEBTCBAD.                                         * 02900002
*                                                                     * 02950002
*        R5) THE DEB EXTENSION IS POINTED TO THE OLD DEB.             * 03000002
*                                                                     * 03050002
*        R6) THE CURRENT DEB IS SAVED IN DCBIOBAD. THE CURRENT DEB    * 03100002
*        IS NOW CONSIDERED THE DEB TO BE FREED AND THE 'FREE OLD DEB' * 03150002
*        LOGIC IS ENTERED AS F3) BELOW.                               * 03200002
         EJECT                                                          03250002
*        THE 'FREE OLD DEB' FUNCTION IS IMPLEMENTED AS FOLLOWS-       * 03300002
*                                                                     * 03350002
*        F1) THE LOCAL LOCK IS OBTAINED AND THE BRANCH ENTRY TO THE   * 03400002
*        DEB VALIDITY CHECK ROUTINE IS ENTERED TO VERIFY THAT THE DEB * 03450002
*        TO BE FREED (POINTED TO BY DCBIOBAD) IS IN THE DEB TABLE.    * 03500002
*        IF IT IS NOT CONTROL IS GIVEN TO F4 BELOW, CAUSING A 16E     * 03550002
*        ABEND WHEN AN ATTEMPT IS MADE TO DELETE THE DEB FROM THE DEB * 03600002
*        TABLE USING THE DEBCHK-DELETE MACRO. THE LOCAL LOCK IS       * 03650002
*        RELEASED.                                                    * 03700002
*                                                                     * 03750002
*        F2) IT IS VERIFIED THAT THE DEB TO BE FREED HAS THE ADDRESS  * 03800002
*        OF THE USER'S DCB IN DEBDCBAD WITH THE LOW ORDER BIT         * 03850002
*        FLIPPED. IF NOT CONTROL IS PASSED TO F4 BELOW CAUSING        * 03900002
*        A 16E ABEND.                                                 * 03950002
*                                                                     * 04000002
*        F3) THE DEBDCBAD FIELD OF THE DEB TO BE FREED IS POINTED     * 04050002
*        TO THE COPIED DCB-16 (DCB-(DCBDEBAD-DCBIOBAD)). THIS         * 04100002
*        ADDRESS AT OFFSET DCBDEBAD POINTS TO THE DCBIOBAD WHICH      * 04150002
*        WILL ALLOW DEBCHK-DELETE TO REMOVE THE DEB ADDRESS FROM THE  * 04200002
*        DEB TABLE.                                                   * 04250002
*                                                                     * 04300002
*        F4) DEBCHK-DELETE IS INVOKED PASSING AS A DCB ADDRESS THE    * 04350002
*        ADDRESS OF THE COPIED DCB-16. DEBCHK WILL FIND AT OFFSET     * 04400002
*        DCBDEBAD THE ADDRESS OF THE DEB TO BE FREED, AND THE         * 04450002
*        DEBDCBAD OF THIS DEB POINTS BACK TO THE 'DCB' (DCB-16).      * 04500002
*        THUS, DEBCHK WILL PROCEDE WITH ITS FUNCTION.                 * 04550002
*                                                                     * 04600002
*        F5) THE DEB TO BE FREED IS FREEMAINED USING A DIRECTED       * 04650002
*        BRANCH ENTRY TO FREEMAIN DIRECTED TO THE TCB IN DEBTCBAD.    * 04700002
         EJECT                                                          04750002
*        IF THE 'FREE OLD DEB' FUNCTION WAS INVOKED, BITS 2 AND 3 IN  * 04800002
*        DCBIOBAD ARE SET TO 1 AND MODULE IFG0551L IS GIVEN CONTROL   * 04850002
*        TO COMPLETE EOV PROCESSING.                                  * 04900002
*                                                                     * 04950002
*        IF THE 'REPOSITION' FUNCTION WAS INVOKED, BIT 2 OF DCBIOBAD  * 05000002
*        IS SET TO 1 AND THE FOLLOWING FUNCTION IS PERFORMED-         * 05050002
*                                                                     * 05100002
*        THE DATA MANAGEMENT COUNT OF THE UCB OF THE DEB WHICH WAS    * 05150002
*        FREED IS DECREMENTED. DXVOLSEQ IS DECREMENTED AND MODULE     * 05200002
*        IFG0554A IS GIVEN CONTROL TO MOUNT AND VERIFY THE PREVIOUS   * 05250002
*        VOLUME (THE VOLUME OF THE NOW-CURRENT DEB) AND READ THE      * 05300002
*        DSCB(S).                                                     * 05350002
*                                                                     * 05400002
*        UPON RETURN FROM IFG0554A THE NOW-CURRENT DEB'S EXTENTS ARE  * 05450002
*        VERIFIED TO BE IDENTICAL TO THOSE OF THE DSCB(S) READ. THE   * 05500002
*        UCB ALSO IS VERIFIED TO BE IDENTICAL, AND THE NUMBER OF      * 05550002
*        EXTENTS IN THE DEB AND DSCB MUST BE EQUAL. IF ANY OF THESE   * 05600002
*        CHECKS FAIL, PROBLEM DETERMINATION IS GIVEN CONTROL TO       * 05650002
*        CAUSE A 937-1C ABEND.                                        * 05700002
*                                                                     * 05750002
*        IF THE VERIFICATION IS SUCCESSFUL, MODULE IFG0551L IS GIVEN  * 05800002
*        CONTROL.                                                     * 05850002
*                                                                     * 05900002
* NOTES =                                                             * 05950002
*        THE 'FREE OLD DEB' FUNCTION IS INVOKED BY THE SEQUENTIAL     * 06000002
*        ACCESS METHOD AFTER AN EOV HAS OCCURRED IN THE MIDDLE OF     * 06050002
*        OBTAINING THE SEGMENTS OF A VBS LOGICAL RECORD WHOSE         * 06100002
*        SEGMENTS SPAN TWO VOLUMES WHEN THE PROCESSING IS UPDATE. THE * 06150002
*        OLD DEB ALLOWING ACCESS TO THE FIRST SEGMENT(S) OF THE       * 06200002
*        LOGICAL RECORD HAS NEITHER BEEN FREED NOR DELETED FROM THE   * 06250002
*        DEB TABLE BY EOV, BUT ITS DEBDCBAD HAS HAD ITS LOW ORDER     * 06300002
*        BIT FLIPPED TO PREVENT ITS BEING EXCP-ED. THE DEB'S ADDRESS  * 06350002
*        HAS BEEN SAVED IN DCBIOBAD. IF THE LOGICAL RECORD WHICH      * 06400002
*        SPANS VOLUMES IS NOT UPDATED BY THE USER, A FEOV IS ISSUED   * 06450002
*        CAUSING THIS MODULE TO GAIN CONTROL IN ORDER TO FREE THE     * 06500002
*        OLD DEB AS IT IS NOT NEEDED ANY LONGER. THIS FUNCTION IS     * 06550002
*        INDICATED BY BIT 1 IN DCBIOBAD BEING SET TO 1.               * 06600002
*                                                                     * 06650002
*        THE 'REPOSITION' FUNCTION IN INVOKED UNDER THE SAME          * 06700002
*        CIRCUMSTANCES AS THE 'FREE OLD DEB' FUNCTION EXCEPT THAT THE * 06750002
*        USER HAS REQUESTED THAT THE LOGICAL RECORD WHICH SPANS       * 06800002
*        VOLUMES BE UPDATED. A FEOV CAUSES THIS MODULE TO GAIN        * 06850002
*        CONTROL IN ORDER TO REESTABLISH THE OLD DEB SO THAT THE      * 06900002
*        FIRST SEGMENT(S) OF THE LOGICAL RECORD MAY BE UPDATED.       * 06950002
         EJECT                                                          07000002
*    DEPENDENCIES =                                                   * 07050002
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 07100002
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 07150002
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 07200002
*                                                                     * 07250002
*    RESTRICTIONS = NONE                                              * 07300002
*                                                                     * 07350002
*    REGISTER CONVENTIONS =                                           * 07400002
*            R2 POINTS TO DCB                                         * 07450002
*            R4 POINTS TO OPEN WORK AREA                              * 07500002
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 07550002
*            R6 POINTS TO THE WTG TABLE                               * 07600002
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 07650002
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 07700002
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 07750002
*            R10 POINTS TO THE UCB                                    * 07800002
*                                                                     * 07850002
*    PATCH LABEL = SEE THIRD FROM LAST LABEL BEFORE ORG STATEMENT AT  * 07900002
*                  END OF LISTING.                                    * 07950002
*                                                                     * 08000002
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 08050002
*                                                                     * 08100002
*    PROCESSOR = ASSEMBLER XF                                         * 08150002
*                                                                     * 08200002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 08250002
*                  ORG STATEMENT AT END OF LISTING                    * 08300002
*                                                                     * 08350002
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 08400002
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 08450002
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 08500002
*                                                                     * 08550002
* ENTRY POINT =                                                       * 08600002
*        IFG0554B                                                     * 08650002
*                                                                     * 08700002
*    PURPOSE = SEE FUNCTION                                           * 08750002
*                                                                     * 08800002
*    LINKAGE =                                                        * 08850002
*        THIS MODULE IS TRANSFERRED CONTROL THROUGH THE IECRES-LOAD   * 08900002
*        MACRO INSTRUCTION.                                           * 08950002
         EJECT                                                          09000002
* INPUT =                                                             * 09050002
*        GIVEN CONTROL IN PROTECT KEY 5.                              * 09100002
*        REGISTER 2 POINTS TO THE COPIED DCB.                         * 09150002
*        DEBDCBAD POINTS TO THE COPIED DCB IF 'REPOSITION' FUNCTION.  * 09200002
*        DEBDCBAD POINTS TO USER DCB IF 'FREE OLD DEB' FUNCTION.      * 09210002
*        REGISTER 4 POINTS TO THE EOV WORKAREA                        * 09250002
*                                                                     * 09300002
*        DCBIOBAD POINTS TO A DEB TO BE FREED OR REESTABLISHED.       * 09350002
*        IF BIT 1 IN DCBIOBAD IS SET TO ONE THE DEB POINTED TO BY     * 09400002
*        DCBIOBAD IS FREED. OTHERWISE THE DEB POINTED TO BY DCBIOBAD  * 09450002
*        WILL BE REESTABLISHED.                                       * 09500002
*                                                                     * 09550002
*        REG 14 CONTAINS ENTRY CODE-                                  * 09600002
*        0 - ENTRY FROM IFG0551H.                                     * 09650002
*        4 - RETURN FROM IFG0554A WITH PREVIOUS VOLUME MOUNTED AND    * 09700002
*        DSCB(S) READ.                                                * 09750002
*                                                                     * 09800002
* OUTPUT =                                                            * 09850002
*        THE NEXT MODULE IS GIVEN CONTROL IN PROTECT KEY 5 WITH       * 09900002
*        REGISTER 2 POINTING TO THE COPIED DCB,                       * 09950002
*        AND REGISTER 4 POINTING TO THE EOV WORKAREA,                 * 10000002
*                                                                     * 10050002
*        IFG0554A -                                                   * 10100002
*        DXRETMOD CONTAINS ID-VCON OF IFG0554B, DXRETCOD = 4.         * 10150002
*        DXVOLSEQ DECREMENTED BY 1 TO VOLUME SEQUENCE OF PREVIOUS     * 10200002
*        VOLUME IN THE JFCB TO BE MOUNTED, AND DSCB(S) TO BE READ.    * 10250002
*                                                                     * 10300002
*        IFG0551L -                                                   * 10350002
*        DCBIOBAD DEB HAS BEEN FREED OR REESTABLISHED.                * 10400002
*        DEBDCBAD POINTS TO USER'S DCB.                               * 10450002
*        BITS 2 & 3 IN DCBIOBAD SET TO 1 IF 'FREE OLD DEB' FUNCTION   * 10500002
*        COMPLETED.                                                   * 10550002
*        BIT 2 IN DCBIOBAD SET TO 1 IF 'REPOSITION' FUNCTION          * 10600002
*        COMPLETED.                                                   * 10650002
*                                                                     * 10700002
*        IFG0550P (PROBLEM DETERMINATION) -                           * 10750002
*        REGISTER 0 CONTAINS 245 CAUSING 937-1C ABEND IF -            * 10800002
*        1) 'REPOSITION' FUNCTION AND DEB POINTED TO BY DCBIOBAD      * 10850002
*        EITHER IS NOT IN THE DEB TABLE OR ITS DEBDCBAD DOES NOT      * 10900002
*        POINT TO THE USER'S DCB WITH ITS LOW ORDER BIT FLIPPED.      * 10950002
*        2) 'REPOSITION' FUNCTION AND OLD DEB EXTENTS DO NOT MATCH    * 11000002
*        THOSE OF THE DSCB(S) READ.                                   * 11050002
         EJECT                                                          11100002
* EXIT-NORMAL =                                                       * 11150002
*        IFG0554A TO MOUNT AND VERIFY DXVOLSEQ VOLUME AND READ        * 11200002
*        DSCB(S).                                                     * 11250002
*        IFG0551L TO COMPLETE EOV PROCESSING.                         * 11300002
*                                                                     * 11350002
* EXIT-ERROR =                                                        * 11400002
*        IFG0550P (PROBLEM DETERMINATION) WITH AN INTERNAL ABEND CODE * 11450002
*        IN REGISTER 0 -                                              * 11500002
*        245 CAUSING 937-1C ABEND.                                    * 11550002
*                                                                     * 11550102
*        DMABCOND PCK IF ERROR FROM PAGE FREE ROUTINE            YM5929 11550502
*                                                                     * 11600002
* EXTERNAL REFERENCES = SEE BELOW                                     * 11650002
*                                                                     * 11700002
*    ROUTINES =                                                       * 11750002
*        IFG019RA THROUGH THE IECRES MACRO.                           * 11800002
*                                                                     * 11850002
*        IEAVPSIB THROUGH CVTVPSIB TO PAGE FREE DEB              YM5929 11850102
*        R0 = 0, NO ECB ADDRESS                                  YM5929 11850202
*        R1 = X'20', ADDRESS OF DEB PREFIX, START OF DEB PGFREE  YM5929 11850302
*        R2 = ADDRESS OF LAST BYTE OF DEB + 1, END OF PGFREE     YM5929 11850402
*        R4 = TCB ADDRESS IN DEBTCBAD                            YM5929 11850902
*                                                                     * 11851402
*        IFGDEBVR POINTED TO BY CVTDEBVR IN VS2 CVT EXTENSION IN      * 11900002
*        ORDER TO VERIFY THAT A DEB ADDRESS IS IN THE DEB TABLE.      * 11950002
*        CALLING SEQUENCE IS AS FOLLOWS -                             * 12000002
*        CALLED IN PROTECT KEY ZERO WITH LOCAL LOCK HELD.             * 12050002
*        REG 1 POINTS TO DEB TO BE VERIFIED.                          * 12100002
*        REG 10 POINTS TO TCB.                                        * 12150002
*        REG 11 WILL BE DESTROYED.                                    * 12200002
*        REG 14 CONTAINS RETURN ADDRESS.                              * 12250002
*        REG 15 CONTAINS ENTRY POINT TO IFGDEBVR.                     * 12300002
*                                                                     * 12350002
*    DATA AREAS =                                                     * 12400002
*        EOV WORKAREA.                                                * 12450002
         EJECT                                                          12500002
*    CONTROL BLOCK =                                                  * 12550002
*        DCB                                                          * 12600002
*        TCB                                                          * 12650002
*        CVT                                                          * 12700002
*        DEB                                                          * 12750002
*        DEB EXTENSION                                                * 12800002
*                                                                     * 12850002
* TABLES =                                                            * 12900002
*        NONE.                                                        * 12950002
*                                                                     * 13000002
* MACROS =                                                            * 13050002
*        MODESET                                                      * 13100002
*        SETLOCK                                                      * 13150002
*        DEBCHK                                                       * 13200002
*        FREEMAIN                                                     * 13250002
*        IECRES-LOAD                                                  * 13300002
*        DMABCOND                                                     * 13350002
*        XCTLTABL                                                     * 13400002
*        IECDSECS                                                     * 13450002
*        IECEQU                                                       * 13500002
*                                                                     * 13550002
* CHANGE ACTIVITY =                                                   * 13600002
*        SEE CHANGES/DELETIONS SECTION JUST AFTER CSECT CARD.         * 13650002
*                                                                     * 13700002
*********************************************************************** 13750002
         EJECT                                                          13800002
ERR245   EQU   245                      937-1C INTERNAL ABCODE   Y02082 13850002
*                                                                       13900002
***** INITIALIZE EOV REGISTERS                                    ***** 24200021
*                                                                     * 24400021
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        24800021
         USING FORCORE,RCORE                                            25000021
         USING WTG,RWTG                 BASE FOR WTG TABLE       Y02080 25050002
         USING TIOENTRY,RTIOT                                           25200021
         USING DEBBASIC,RDEB                                     YM5929 25400002
         USING IHADCB,RDCB                                              25600021
         USING *,RBASE                                                  25800021
         USING UCB,RUCB                                                 26000021
         USING CVT,RF                                                   26200021
*                                                                       26400021
         L     RDEB,DCBDEBAD            ADDRESS OF USER'S DEB           26600021
*                                                                       26800021
         B     EDI12400(RET)            BR, ACCORDING TO RETURN CODE    27000021
EDI12400 EQU   *                        BRANCH TABLE                    27200002
         B     EDI12500                 REGULAR PROCESSING              27400021
         B     EDI14000                 RETURNING FROM MOUNT     Y02082 27600002
*                                                                     * 28000021
*        SEE IF FREE OLD DEB OR REPOSITION FUNCTION                     28200002
*                                                                     * 28400021
EDI12500 EQU   *                        TEST DCBIOCOM                   28600002
         TM    DCBIOBAD,DCBUPDCM        CAN THIS DEB BE FREED    YM5370 28605002
         BO    EDI13000                 BRANCH TO FREE DEB              28800021
         EJECT                                                          28840002
*                                                                       28850002
*        REPOSITION FUNCTION                                            28860002
*                                                                       28860502
*        PAGE FREE DEB IF IT HAD BEEN PAGE FIXED                        28861002
*                                                                       28861502
         L     RF,DEBAPPAD              AVT ADDRESS              YM5929 28862002
         TM    DEBSIOAB-DEBAVT(RF),X10  WAS DEB FIXED            YM5929 28863002
         BZ    EDI12502                 BRANCH IF NOT            YM5929 28863502
         LA    RF,DEBBASIC              START OF DEB             YM5929 28863602
         SH    RF,CONST36               DEB PREFIX               YM5929 28863702
         XR    R1,R1                    CLEAR FOR IC             YM5929 28864002
         IC    R1,DEBLNGTH-DEBAVT(RF)   DEB LENGTH IN DWORDS     YM5929 28864502
         SLL   R1,K3                    DEB LENGTH IN BYTES      YM5929 28865002
         AR    RF,R1                    END OF DEB + 1           YM5929 28865502
         ICM   R1,B'0111',DEBAPPB       START OF DEB             YM5929 28866002
*        PGFREE R,A=(1),EA=(15)         PAGE FREE DEB            YM5929 28866502
         LA    R2,K0(,RF)               END ADDRESS OF PGFREE    YM5929 28867002
         L     RF,DXXPREFX              PREFIX ADDRESS           YM5929 28867502
         STM   RDEB,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS  YM5929 28867602
         MODESET EXTKEY=SUPR            SETLOCK, PGFREE KEY      YM5929 28867702
EDI12501 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  YM5929*28867802
               RELATED=(LOCAL,IFG0554B(EDI12503)) GET LOCAL LOCK YM5929 28868302
         LM    RDEB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS       YM5929 28868402
         EJECT                                                          28868502
         XR    R0,R0                    NO ECB                   YM5929 28868602
         ICM   R1,B'1000',=AL1(X20)     PGFREE BIT               YM5929 28868702
         LR    RDEB,RCORE               SAVE RCORE               YM5929 28868802
         L     RCORE,DEBTCBAD-DEB(,R1)  PGFREE BY TCB            YM5929 28868902
         L     RF,CVTPTR                CVT                      YM5929 28869002
         L     RF,CVTVPSIB-CVT(,RF)     IEAVPSIB ENTRY           YM5929 28869102
         BALR  RET,RF                   REGS 0-14 UNCHANGED      YM5929 28869302
         LTR   RF,RF                    ERROR IN PGFREE          YM5929 28869402
         BNZ   EDI14902                 BRANCH IF YES            YM5929 28869502
         LR    RCORE,RDEB               RESTORE RCORE            YM5929 28869602
         L     RDCB,DXPDCBAD            RESTORE DCB ADDRESS      YM5929 28869702
         L     RDEB,DCBDEBAD            RESTORE DEB ADDRESS      YM5929 28870102
         L     RF,DEBAPPAD              DEB AVT ADDR             YM5929 28870602
         NI    DEBSIOAB-DEBAVT(RF),K255-X10 ZERO DEB FIXED BIT   YM5929 28870702
         L     RF,DXXPREFX              PREFIX ADDRESS           YM5929 28870802
         STM   RDEB,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS  YM5929 28870902
EDI12503 SETLOCK RELEASE,TYPE=LOCAL,                             YM5929*28871002
               RELATED=(LOCAL,IFG0554B(EDI12501)) RELEASE LOCK   YM5929 28871102
         LM    RDEB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS       YM5929 28871302
         MODESET EXTKEY=DATAMGT         RETURN TO D M KEY        YM5929 28871502
         EJECT                                                          28871702
EDI12502 EQU   *                        UNCHAIN DEB              YM5929 28871802
*                                                                       28871902
*              UNCHAIN CURRENT DEB FROM DEBTCBAD'S TCB DEB CHAIN        28872002
*                                                                       28874002
         L     RF,WTGPREFX              PT TO PREFIX             Y02082 28880002
         USING IECPREFX,RF                                       Y02082 28920002
         STM   R0,RET,IECREGSV          SAVE REGS THRU LOCK      Y02082 28960002
         MODESET EXTKEY=SUPR            SETLOCK KEY              Y02082 28970002
*                                                                       28980002
*     OBTAIN LOCAL LOCK TO                                       Y02082 29000002
*              UNCHAIN CURRENT DEB FROM TCB DEB CHAIN                   29002002
*              BRANCH ENTER DEBCHK ROUTINE TO VERIFY OLD DEB            29004002
*                                                                       29010002
EDI12505 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02082*29040002
               RELATED=(LOCAL,IFG0554B(EDI12600,EDI12903))       Y02082 29080002
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       Y02082 29090002
         LM    R0,RET,IECREGSV          RESTORE REGS             Y02082 29120002
         EJECT                                                          29125002
*                                                                       29130002
*        LOCK STILL HELD                                                29135002
*                                                                       29140002
*        UNCHAIN CURRENT DEB FROM TCB                                   29145002
*                                                                       29150002
         LR    R7,RDEB                  SAVE DEBAD FOR CS        Y02082 29170002
EDI12510 EQU   *                        REMOVE DEB               Y02082 29200002
         L     R1,DEBTCBAD              GET PTR TO TCB           Y02082 29240002
         LA    R1,K4(,R1)               ADJUST FOR COMPARE       Y02082 29280002
EDI12520 EQU   *                        PROCESS DEB              Y02082 29320002
         CLC   DCBDEBAD+1(K3),DEBDEBB-DEBBASIC(R1) CORRECT DEB?  YM5929 29360002
         BE    EDI12530                 YES, GO DECHAIN          Y02082 29400002
         L     R1,DEBDEBAD-DEBBASIC(,R1) POINT TO NEXT DEB       YM5929 29440002
         LA    R1,K0(,R1)               CLEAR HI BYTES           Y02082 29480002
         B     EDI12520                 GO CHECK NEXT DEB        Y02082 29600002
*                                                                       29600402
EDI12530 EQU   *                        COMPLETE REMOVAL         Y02082 29640002
         L     R8,DEBDEBAD              PTR TO DEB               Y02082 29680002
         ICM   R8,K8,DEBDEBAD-DEBBASIC(R1) PRIME HI-ORDER BYTE   YM5929 29720002
         ICM   R7,K8,DEBDEBAD-DEBBASIC(R1) PRIME HI-ORDER BYTE   YM5929 29760002
         MODESET EXTKEY=ZERO            KEY ZERO FOR CS          Y02082 29770002
         CS    R7,R8,DEBDEBAD-DEBBASIC(R1) DECHAIN DEB           YM5929 29800002
         MODESET EXTKEY=DATAMGT         RETURN TO KEY 5          Y02082 29810002
         BZ    EDI12535                 BR IF SUCCESSFUL         Y02144 29840002
         LR    R7,RDEB                  RESTORE DEB ADDR         Y02082 29880002
         B     EDI12510                 GO TRY AGAIN             Y02082 29920002
EDI12535 EQU   *                        DEB REMOVED              Y02144 29930002
         OI    DXATEOV,DXATDCHN         SHOW DEB DECHAINED       Y02144 29940002
         EJECT                                                          29960002
*                                                                       29965002
*        LOCK STILL HELD                                                29970002
*                                                                Y02134 34610002
*        VERIFY OLD DEB BY BRANCH ENTERING DEBCHK ROUTINE               34620002
*                                                                Y02134 34658102
         L     R1,DCBIOBAD              R1 = OLD DEB ADDRESS     Y02082 34659202
         LA    R1,K0(R1)                CLEAR HIGH ORDER BYTE  @ZM33024 34661202
         L     RF,CVTPTR                LOAD CVT ADDRESS         Y01021 34661602
         USING CVT,RF                   CVT ADDRESSABILITY       Y02080 34663602
         L     RUCB,CVTTCBP             RUCB = TCB POINTERS      Y01021 34664002
         L     RUCB,K4(R0,RUCB)         RUCB = TCB ADDRESS       Y01021 34666402
         L     RF,CVTEXT2               LOAD CVT EXTENSION ADDR  Y01021 34668802
         USING CVTXTNT2,RF              RF = CVT EXTENSION ADDR  Y01021 34671202
         L     RF,CVTDEBVR              RF = DEBCHK ADDRESS      Y01021 34673602
         MODESET EXTKEY=SUPR            KEY ZERO FOR DEBCHK      Y02082 34675602
         LR    R9,RDEB                  SAVE RDEB ACCROSS DEBCHK Y02082 34675802
         BALR  RET,RF                   BRANCH TO DEBCHK ROUTINE Y01021 34676002
*                                                                Y02134 34676102
*        DEBCHK GOOD RETURN TO NEXT INSTRUCTION                  Y02134 34676402
*                                                                       34676602
         B     EDI12902                 CHECK ADDR OF OLD DCB    Y02082 34676802
*                                                                       34677002
*        DEBCHK BAD RETURN - GO TO PROBLEM DETERMINATION         Y02082 34677202
*                                                                       34678202
EDI12550 EQU   *                        RELEASE LOCK             Y02082 34678802
         LR    RDEB,R9                  RESTORE CURRENT RDEB     Y02082 34679002
         L     RF,DXXPREFX              PREFIX ADDRESS           Y02082 34679202
         STM   RB,RET,IECREGSV-IECPREFX(RF) SAVE SETLOCK REGS    Y02082 34679602
EDI12600 SETLOCK RELEASE,TYPE=LOCAL,    RELEASE LOCK             Y02082*34680002
               RELATED=(LOCAL,IFG0554B(EDI12505))                Y02082 34680402
         MODESET EXTKEY=DATAMGT         RETURN TO KEY 5          Y02082 34680502
         LM    RB,RET,IECREGSV-IECPREFX(RF) RESTORE REGS         Y02082 34680902
         LA    RWTGC,DXXENTRY           INITIALIZE RWTGC       @ZA02522 34681002
         B     EDI14715                 GO TO PROBLEM DET.       Y02082 34681302
         EJECT                                                          34681402
*                                                                       34681602
*    LOCK STILL HELD                                                    34681702
*                                                                       34682702
*    IF THE DEB CHECK WAS SUCCESSFUL, CHECK THE DCB ADDRESS.     Y02082 34685502
*    FLIP THE LAST BIT IN THE DCB ADDR (DXUDCBAD) AND COMPARE    Y02082 34687502
*    TO THE ALTERED DCB ADDR IN THE OLD DEB                      Y02082 34689502
*                                                                       34689602
EDI12902 EQU   *                        TEST DCB ADDR            Y02082 34689902
         LR    RDEB,R9                  RESTORE CURRENT DEBAD    Y02082 34690102
         L     RF,DXXPREFX              LOAD POINTER TO PREFIX   Y02080 34690602
         STM   R0,RF,IECREGSV-IECPREFX(RF) SAVE REGISTERS        Y02134 34691102
*                                                                Y02134 34691602
EDI12903 SETLOCK RELEASE,TYPE=LOCAL,                             Y02080*34692102
               RELATED=(LOCAL,IFG0554B(EDI12505)) RELEASE LOCK   Y02080 34692602
         MODESET EXTKEY=DATAMGT         RETURN TO KEY 5          Y02082 34693102
         LM    R0,RF,IECREGSV-IECPREFX(RF) RESTORE REGISTERS     Y02134 34693602
         XI    DXUDCBAD+K3,K1           FLIP LAST BIT            Y02082 34694902
         CLC   DXUDCBAD+K1(K3),DEBDCBB-DEBBASIC(R1)              YM5929 34696902
         BE    EDI12905                 BRANCH IF OK             Y02082 34698902
         XI    DXUDCBAD+K3,K1           RESET LAST BIT           Y02082 34700902
         B     EDI14715                 ABEND                    Y02082 34702902
EDI12905 EQU   *                        RESET BIT & DCBDEBAD     Y02082 34704902
         XI    DXUDCBAD+K3,K1           RESET LAST BIT           Y02082 34706902
         STCM  R1,B'0111',DCBDEBAD+K1   PUT OLD DEB IN DCB COPY  Y02082 34708902
         MVC   DEBDCBB-DEBBASIC(K3,R1),DXPDCBAD+K1 POINT OLD DEB YM5929 34710902
*                                       TO COPIED DCB            Y02082 34712902
         EJECT                                                          34724602
*                                                                       34725002
*     CHAIN OLD DEB BACK AGAIN                                   Y02082 34765302
*                                                                       34765702
         LR    R7,R1                    OLD DEB ADDR             Y02082 34767302
         L     R1,DEBTCBAD-DEBBASIC(,R1) ADDR OF TCB IN OLD DEB  YM5929 34769302
EDI12950 EQU   *                        CHAIN DEB                Y02082 34771302
         L     R8,TCBDEB-TCB(,R1)       PT TO FIRST DEB          Y02080 34771702
         STCM  R8,B'0111',DEBDEBB-DEBBASIC(R7) NEXT DEB ADDR     YM5929 34772102
         ICM   R7,B'1000',TCBDEB-TCB(R1) GET FRONT BYTE          YM5929 34772202
         MODESET EXTKEY=ZERO            KEY ZERO FOR CS          Y02082 34772502
         CS    R8,R7,TCBDEB-TCB(R1)     CHAIN DEB                Y02082 34772602
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       Y02082 34772902
         BNZ   EDI12950                 TRY AGAIN IF NO SUCCESS  Y02082 34773102
         DROP  RF                                                Y02082 34773202
         NI    DXATEOV,X'FF'-DXATDCHN   SHOW DEB CHAINED         Y02144 34778502
         L     R7,DXDEBXAD              GET DEB EXTENSION ADDR   Y02134 34780002
         USING DEBXTN,R7                                         Y02134 34783302
         MVC   DEBXDBPR+K1(K3),DCBDEBAD+K1 PUT OLD DEBAD IN DEBX Y02082 34793302
         DROP  R7                                                Y02134 34795302
         STCM  RDEB,B'0111',DCBIOBAD+K1 SAVE CURRENT DEB AS THE         34800002
*                                       DEB TO BE FREED                 34805002
         L     RDEB,DCBDEBAD            LOAD OLD DEB ADDRESS -   Y02082 34950002
*                                       IT'S NOW THE CURRENT DEB        34955002
         SR    R1,R1                                                    35200021
         IC    R1,DEBNMEXT              GET NO. IF EXTENTS              35400002
         SLL   R1,K4                    MULTIPLY BY 16                  35600021
         LH    R7,DXVOLSEQ              GET CURRENT VOL SEQUENCE Y02134 35800002
         BCTR  R7,K0                    DECREMENT DEB VOL SEQ NO        36000021
         STH   R7,DEBSUCBA+(DEBVOLSQ-DEBACSMD)(R1) UPDATE VOLSEQ YM5929 36200002
         L     R1,DCBIOBAD              GET ADDR OF OLD DEB      Y02082 36250002
         B     EDI13020                 GO TO FREE OLD DEB       Y02082 36300002
         EJECT                                                          36300402
*                                                                       36300802
*        FREE OLD DEB FUNCTION ENTRY                                    36301202
*                                                                Y02082 36350002
EDI13000 EQU   *                        VERIFY AND FREE OLD DEB  Y02082 36450002
         L     R1,DCBIOBAD              GET ADDR OF OLD DEB      Y02082 36500002
         LA    R1,K0(,R1)               CLEAR HIGH BYTE          YM5370 36502002
         LR    R9,RDEB                  SAVE CURRENT DEBAD       Y02082 36505002
*                                       ACCROSS SETLOCK, DEBCHK  Y02082 36510002
         L     RF,CVTPTR                GET CVT ADDRESS          Y02082 36552002
         USING CVT,RF                   ESTABLISH CVT ADDR.      Y02082 36554002
         L     RUCB,CVTTCBP             GET TCB POINTERS         Y02082 36556002
         L     RUCB,K4(,RUCB)           GET ADDR OF TCB          Y02082 36558002
         L     RF,CVTEXT2               GET ADDR OF CVT EXT      Y02082 36558402
         USING CVTXTNT2,RF              ESTABLISH ADDR.          Y02082 36558802
*        GET LOCAL LOCK TO BRANCH ENTER DEBCHK                          36558902
         MODESET EXTKEY=SUPR            SETLOCK,DEBCHK KEY       Y02082 36559002
         L     RF,CVTDEBVR              GET ADDR DEBCHK MACRO    Y02082 36559202
EDI13002 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02082*36559302
               RELATED=(IFGDEBVR,IFG0554B(EDI13010,EDI13040))    Y02082 36559402
         BALR  RET,RF                   VERIFY OLD DEB           Y02082 36559602
         DROP  RF                                                Y02082 36559702
*                                                                       36563002
*    SUCCESSFUL DEBCHK-RETURN TO NEXT INSTRUCTION                Y02082 36566602
*                                                                       36567602
         B     EDI13010                 GO CHECK ADDR OF OLD DEB Y02082 36569902
*                                                                       36570902
*    ERROR, OLD DEB NOT IN TABLE. RETURN TO NEXT+4               Y02082 36573202
*                                                                       36578202
         B     EDI13040                 ERROR,DON'T CHECK ADDR   Y02082 36583202
*                                                                Y02082 36585202
*                                                                Y02082 36585602
EDI13010 SETLOCK RELEASE,TYPE=LOCAL,                             Y02082*36586002
               RELATED=(IFGDEBVR,IFG0554B(EDI13002))             Y02082 36586102
         LR    RDEB,R9                  RESTORE CURRENT DEBAD    Y02082 36586802
         MODESET EXTKEY=DATAMGT         RETURN TO KEY 5          Y02082 36587502
         EJECT                                                          36588202
         XI    DXUDCBAD+K3,K1           FLIP LAST BIT            Y02082 36588902
*    COMPARE DCB ADDR IN DEB AND IN WORK AREA                    Y02082 36589602
         CLC   DXUDCBAD+K1(K3),DEBDCBB-DEBBASIC(R1)              YM5929 36590302
         BNE   EDI13030                 ERROR,DCB'S UNEQUAL      Y02082 36591002
         XI    DXUDCBAD+K3,K1           RESTORE LAST BIT         Y02082 36593002
EDI13020 EQU   *                        DELETE DEB               Y02082 36595002
*                                                                       36595202
*    SET THE DCB ADDR IN THE DEB (DEBDCBAD) AND RF TO POINT TO   Y02082 36595402
*    THE COPIED DCB-16. THUS,DCBIOBAD (THE POINTER TO THE DEB TO Y02082 36595502
*    BE DELETED) WILL LOOK LIKE DCBDEBAD FOR THE DEBCHK MACRO.   Y02082 36645502
*    NOTE - AT THIS POINT R1 POINTS TO THE DEB TO BE FREED, AND  Y02082 36655502
*    RDEB POINTS TO THE DEB TO BE KEPT.                          Y02082 36665502
*                                                                       36670502
         LR    RF,RDCB                  GET DCB ADDR             Y02082 36675502
         LA    RET,DCBDEBAD-DCBIOBAD    CALC OFFSET-CURRENTLY 16 Y02082 36685502
         SR    RF,RET                   POINT TO DCB-16          Y02082 36687502
         STCM  RF,B'0111',DEBDCBB-DEBBASIC(R1)                   YM5929 36689502
EDI13025 EQU   *                        REMOVE DEB FROM DEBTABLE Y02082 36691502
         DEBCHK (RF),TYPE=DELETE                                 Y02082 36692502
         B     EDI13050                 BRANCH TO FREEMAIN       Y02082 36693502
EDI13030 EQU   *                        FLIP BIT                 Y02082 36693902
         XI    DXUDCBAD+K3,K1           FLIP BIT                 Y02082 36694302
         B     EDI13045                 BRANCH AROUND SETLOCK    Y02082 36694402
EDI13040 SETLOCK RELEASE,TYPE=LOCAL,    DEBCHK ERROR             Y02082*36694502
               RELATED=(IFGDEBVR,IFG0554B(EDI13002))             Y02082 36694602
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       Y02082 36694702
         LR    RDEB,R9                  RESTORE CURRENT DEBAD    Y02082 36694802
EDI13045 EQU   *                        DCB AD FOR DEBCHK DELETE Y02082 36695002
         LR    RF,RDCB                  GET DCB ADDR             Y02082 36695202
         LA    RET,DCBDEBAD-DCBIOBAD    CALC OFFSET-CURRENTLY 16 YM5370 36695302
         SR    RF,RET                   POINT TO DCB-16          Y02082 36695402
         B     EDI13025                 DEBCHK WILL CAUSE ABEND  Y02082 36695502
         EJECT                                                          36695702
EDI13050 EQU   *                        FREE MAIN OF DELETED DEB Y02082 36800402
         SH    R1,CONST36               GET ADDR OF DEB APPENDAGE TABLE 36800802
         SR    R0,R0                    CLEAR REGISTER                  36801202
         IC    R0,DEBLNGTH-DEBAVT(R1)   LENGTH OF DEB IN DBLWD   YM5929 37000002
         SLL   R0,K3                    LENGTH OF DEB IN BYTES          37200002
         L     RA,DXXPREFX              PREFIX ADDRESS           Y02082 37450002
         STM   R0,RF,IECREGSV-IECPREFX(RA) SAVE REGS             Y02082 37450402
         MODESET EXTKEY=SUPR            SETLOCK,FREEMAIN KEY     Y02082 37450802
EDI13060 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02082*37451202
               RELATED=(FREEMAIN,IFG0554B(EDI13070))             Y02082 37451602
         L     R7,DXASCBAD              ASCB ADDR FOR FREEMAIN   Y02082 37452002
         L     RCORE,K36(,R1)           TCB ADDR FROM DEB        Y02082 37452402
         FREEMAIN RU,A=(1),LV=(0),SP=230,KEY=5,BRANCH=YES        YM5725 37452802
         MODESET EXTKEY=SUPR            SETLOCK KEY              Y02082 37453202
EDI13070 SETLOCK RELEASE,TYPE=LOCAL,                             Y02082*37453602
               RELATED=(FREEMAIN,IFG0554B(EDI13060))             Y02082 37454002
         LM    R0,RF,IECREGSV-IECPREFX(RA) RESTORE REGS          Y02082 37454402
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       Y02082 37454502
         L     RDEB,DCBDEBAD            REESTABLISH DEB ADDRESS  Y02082 37454802
         OI    DXATEOV,DXATDFRE         SHOW DEB FREED           Y02144 37550002
         EJECT                                                          37555002
*                                                                       37560002
*        SET DCBIOBAD BITS AND EXIT IF FREE OLD DEB FUNCTION            37565002
*                                                                       37570002
         TM    DCBIOBAD,DCBUPDCM        IS UPDATE TAKING PLACE   YM5370 37600002
         BZ    EDI13100                 YES, CONTINUE PROCESSING        37800021
         OI    DCBIOBAD,DCBNUPD         CLEAR IOBAD FIELD        YM5370 38000002
         B     EDI14700                 BRANCH                          38200021
EDI13100 EQU   *                        TURN ON BIT                     38400002
         OI    DCBIOBAD,DCBUPDT         CLEAR IOBAD FIELD        YM5370 38405002
         SPACE 2                                                        41250002
*                                                                Y02134 41300002
*****************************************************************Y02134 41350002
*                                                                Y02134 41360002
*        DECREMENT DM COUNT                                      Y02134 41370002
*        WICLOSE NOT NEEDED AS VIO DATA SET CAN'T BE MULTIVOLUME YM5929 41372002
*                                                                Y02134 41380002
*****************************************************************Y02134 41390002
*                                                                Y02134 41392002
EDI13300 EQU   *                        DECREMENT DM COUNT       Y02134 41394002
         L     RUCB,DXUCBADR            LOAD UCB ADDRESS         Y02082 41394402
*                                                                Y02134 41396002
         LA    RF,K1                    LOAD DECREMENT VALUE     Y02134 41398002
*        SHIFT DECREMENT TO USE WITH CS INSTRUCTION              Y02134 41398402
         SLL   RF,K24-(K8*((UCBDMCT-UCB)-(((UCBDMCT-UCB)/4)*4))) Y02134 41398802
         L     R0,UCB+(((UCBDMCT-UCB)/K4)*K4) ALLIGN & LOAD WORD Y02134 41399202
*                                                                Y02134 41399602
EDI13400 EQU   *                        STORE DM COUNT           Y02134 41399702
*                                                                Y02134 41399802
         LR    RET,R0                   SAVE CS OPERAND          Y02134 41399902
         SLL   RET,K25                  LEAVE ONLY UCBDMCT COUNT Y02134 41449902
         LTR   RET,RET                  TEST FOR COUNT OF 0      Y02134 41459902
         BZ    EDI13500                 BRANCH IF ALREADY 0      Y02134 41469902
*                                                                Y02134 41479902
         LR    R1,R0                    LOAD OLD VALUE TO MODIFY Y02134 41489902
         SR    R1,RF                    ADD DECREMENT TO COUNT   Y02134 41491902
*                                                                Y02134 41493902
         MODESET EXTKEY=SUPR            UCB KEY                  Y02082 41495902
         CS    R0,R1,UCB+(((UCBDMCT-UCB)/K4)*K4) STORE NEW COUNT Y02134 41497902
         MODESET EXTKEY=DATAMGT         RETURN TO DATA MGMNT KEY Y02082 41498302
*                                                                Y02134 41498702
         BNE   EDI13400                 BRANCH IF NOT THE SAME   Y02134 41499102
         NI    DXATGENS,X'FF'-DXATDMCT  SHOW DM CNT DECREMENTED  Y02144 41499202
         EJECT                                                          41499502
EDI13500 EQU   *                        DECREMENT VOL SEQ AND    Y02134 41499602
*                                       BRANCH QUEUED            Y02134 41499702
         LH    R1,DXVOLSEQ              LOAD VOL SEQ             Y02134 41499802
         BCTR  R1,0                     DECREMENT BY ONE         Y02134 41566502
         STH   R1,DXVOLSEQ              SAVE SEQUENCE NUMBER     Y02134 41588402
*                                                                Y02134 41588802
         MVI   DXRETCOD,K4              SET UP RETURN OFFSET     Y02134 41592502
         MVC   DXRETMOD,ID4B4B          SET UP IFG0554B RETURN   Y02134 41594502
*                                                                Y02134 41594902
         BAL   RET,EDI14900             SET UP REGISTERS         Y02134 41644902
         IECRES LOAD,MODID=ID4B4A,BRCODE=K0,BRANCH=QUEUED        Y02134 41645702
*                                                                Y02134 41695702
         EJECT                                                          41745702
EDI14000 EQU   *                        RETURN FROM MOUNT        Y02082 41795702
         L     RF,DEBAPPAD              GET DEB APPENDAGE ADDR   Y02082 41845702
         MVC   K23(K5,RF),DXCCW7        MOVE CCHHR OF DSCB1      Y02082 41895702
*    VERIFY ALL EXTENTS IN DSCB AND DEB                          Y02082 41945702
         CLC   DEBNMEXT(K1),DSCNOEXT    COMPARE NO. OF EXTENTS   Y02082 41995702
         BNE   EDI14715                 ERROR, ABEND             Y02082 42045702
         LA    R1,K1                    INITIALIZE EXTENT CTR.   Y02082 42095702
         LA    RET,DEBSUCBA             INITILIZE DEB PTR.       YM5929 42145702
*                                       TO FIRST EXTENT          YM5929 42155702
         LA    RF,DSCEXTYP              INITIALIZE DSCB PTR      Y02082 42195702
EDI14710 EQU   *                        COMPARE LOOP FOR EXTENTS Y02082 42245702
*    INSURE CORRECT UCB ADDRESS IN EACH DEB EXTENT SECTION       Y02082 42295702
         MVC   DEBSUCBB-DEBSUCBA(K3,RET),DXUCBADR+K1             YM5929 42345702
*    COMPARE DEB AND DSCB EXTENTS                                Y02082 42395702
         CLC   DEBSTRCC-DEBDASD(K8,RET),DSCLOWLM-DSCEXTYP(RF)    YM5929 42445702
         BE    EDI14720                 CONTINUE COMPARE LOOP    Y02082 42495702
EDI14715 EQU   *                        PROBLEM DETERMINATION    Y02082 42545702
         DMABCOND ERR245,LOAD0P         ABEND                    Y02082 42550702
EDI14720 EQU   *                        TEST FOR ALL EXTENTS     Y02082 42595702
         CLM   R1,B'0001',DSCNOEXT      WAS THIS LAST EXTENT     Y02082 42645702
         BE    EDI14700                 YES, GO CHECK TRACE      Y02082 42695702
         CLM   R1,B'0001',CONST3        WAS THIS EXTENT 3        Y02082 42745702
         BNE   EDI14725                 GO CHECK FOR EXTENT 7    Y02082 42795702
         L     RF,CORECH(,RCORE)        POINT TO DSCB 3          Y02082 42845702
         LA    RF,K4(RF)                SKIP OVER KEY ID         Y02082 42895702
         B     EDI14740                 INCREMENT REGS           Y02082 42900702
EDI14725 EQU   *                        ADJUST DSCB PTR IF EXT 7 Y02082 42945702
         CLM   R1,B'0001',CONST7        WAS THIS EXTENT 7        Y02082 42995702
         BNE   EDI14730                 GO TO BUMP PTRS          Y02082 43045702
         LA    RF,K1(RF)                SKIP OVER DSCB ID BYTE   Y02082 43095702
EDI14730 EQU   *                        BUMP PTR'S               Y02082 43145702
         LA    RF,K10(RF)               BUMP DSCB EXTENT PTR     Y02082 43146102
EDI14740 EQU   *                        BUMP EXTENT CTR, PTR     Y02082 43146502
         LA    R1,K1(R1)                BUMP EXTENT PTR          Y02082 43195702
         LA    RET,K16(RET)             BUMP DEB EXTENT PTR      Y02082 43245702
         B     EDI14710                 RETURN TO COMPARE        Y02082 43345702
         EJECT                                                          43350702
*                                                                       43355702
*        EXIT TO IFG0551L                                               43360702
*                                                                       43365702
EDI14700 EQU   *                        TURN OFF TRACE BIT              69800002
         TM    DXXPATHS+K1,WTGTRACE     IS TRACE ACTIVE                 70000021
         BZ    EDI14750                 NO, BRANCH                      70200021
         NI    DXXPATHS+K1,ALLBITS-WTGTRACE  IND TRACE END              70400021
EDI14750 EQU   *                        SET UP MODULE NAME              70405002
         BAL   RET,EDI14900             SET UP REGISTERS         XM0246 70450002
*                                                                Y02134 71350002
*        DEB ALREADY POINTS TO USER DCB IF FREE-OLD-DEB FUNCTION YM5370 71400002
         MVC   DEBDCBAD+K1(K3),DXUDCBAD+K1 POINT DEB TO USER DCB Y02082 71400402
         MVC   DXXMODID(K2),LOAD1L                               Y02080 73400002
*                                       MOVE ID TO WORKAREA             73600021
         MVC   DXXMODEP+K1(K3),LOAD1L+K2                         Y02080 73800002
*                                       MOVE TTR TO WORKAREA            74000021
         IECRES LOAD,PREFIX=DXXPREFX,BRANCH=DIRECT               Y02080 74450002
         SPACE 2                                                        74600002
EDI14900 EQU   *                        SETUP REGISTERS                 74800002
         LA    RWTGC,DXXENTRY           CURRENT MODULE NAME             75000021
         LA    RWTG,DXXAREA             NEXT MODULE NAME                75200021
         L     RTIOT,DXTIOTAD           GET TIOT ENTRY ADDR    @ZA02528 75250002
         BR    RET                      RETURN TO CALLER                75400021
         SPACE 2                                                        75400502
EDI14902 DMABCOND PCK,PGFREE            PAGEFREE ERROR           YM5929 75401002
         EJECT                                                          75405002
*                                                                       75410002
*        CONSTANTS                                                      75415002
*                                                                       75800002
CONST36  DC    H'36'                    CONSTANT 36                     78800021
CONST3   DC    X'03'                    CONSTANT 3               Y02082 78850002
CONST7   DC    X'07'                    CONSTANT 7               Y02082 78900002
         SPACE 2                                                        79000002
         XCTLTABL ID=(LOAD0P,0P,LOAD1L,1L,ID4B4B,4B,ID4B4A,4A),  Y02134X79510002
               SVC=055,BRT=YES,LENGTH=                           Y02080 79520002
*                                                                Y02134 79550002
         IECDSECS CVT,TCB,TIOT,IEZDEB,                           YM5929X79600002
               DCB,UCB,MAIN,                                     YM5929X79800002
               UNITTAB,WTG,PREFX,PSA,EXPAND=YES                  YM5929 80000002
         IECEQU IEZDEB=YES                                       YM5929 80200002
         END                                                            80400021
