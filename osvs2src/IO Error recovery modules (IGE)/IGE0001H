         TITLE '3851 ERP LOAD 1 (IGE0001H) VS2'                         00050003
         MACRO                                                          00060003
         DATEM                                                          00070003
         LCLC  &FILL                                                    00080003
&FILL    SETC  'CL8'.''''.'&SYSDATE'.''''                               00090003
         DC    &FILL                                                    00092003
         MEND                                                           00094003
IGE0001H START X'00'                                                    00100003
*                                                                       00150003
***************************************************************@Y30LB10 00200003
*                                                              @Y30LB10 00250003
*01 MODULE-NAME = IGE0001H                                     @Y30LB10 00300003
*                                                              @Y30LB10 00350003
*01 DESCRIPTIVE NAME = 3851 ERROR RECOVERY PROCEDURES          @Y30LB10 00400003
*                                                              @Y30LB10 00450003
*01 COPYRIGHT = NONE                                           @Y30LB10 00500003
*                                                              @Y30LB10 00550003
*01 STATUS = VS2 REL 3.0 VERSION 1.                            @Y30LB10 00600003
*                                                              @Y30LB10 00650003
*01 FUNCTION =                                                 @Y30LB10 00700003
*   THE ERP WILL TEST STATUS AND SENSE BITS BY PRIORITY AND    @Y30LB10 00750003
*   DO THE ACTION DESCRIBED BY THE HARDWARE ERROR RECOVERY     @Y30LB10 00800003
*   PROCEDURES.                                                @Y30LB10 00810003
*                                                              @Y30LB10 00850003
*01 NOTES                                                      @Y30LB10 00900003
*                                                              @Y30LB10 00950003
*02    DEPENDENCIES =                                          @Y30LB10 01000003
*      THE ABNORMAL END APPENDAGE WILL CALL THE ERP FOR COND   @Y30LB10 01050003
*      CODE 3.                                                 @Y30LB10 01100003
*                                                              @Y30LB10 01150003
*02    RESTRICTIONS = NONE                                     @Y30LB10 01160003
*                                                              @Y30LB10 01300003
*02    REGISTER CONVENTIONS =                                  @Y30LB10 01350003
*      REG0      0    WORK REG                                 @Y30LB10 01400003
*      IOSBPTR   1    IOSB POINTER                             @Y30LB10 01450003
*      REG2      2    WORK REG                                 @Y30LB10 01500003
*      REG3      3    WORK REG                                 @Y30LB10 01550003
*      CSDPTR    3    CSD POINTER                              @Y30LB10 01600003
*      CVTXTN    4    CVT EXTENTION POINTER                    @Y30LB10 01650003
*      CVTREG    5    CVT POINTER                              @Y30LB10 01700003
*      EWAPTR    6    EWA POINTER                              @Y30LB10 01750003
*      PRIUCB    7    ADDRESS OF PRIMARY UCB                   @Y30LB10 01800003
*      REG7      7    WORK REG FOR IOSGEN MACRO                @Y30LB10 01810003
*      ALTUCB    8    ADDRESS OF ALTERNATE UCB                 @Y30LB10 01850003
*      CCWPTR    9    ADDRESS OF CCW IN ERROR                  @Y30LB10 01900003
*      CTLPTR    10   SSC CONTROL BLOCK POINTER                @Y30LB10 01950003
*      BASEREG   11   BASE REG                                 @Y30LB10 02000003
*      REGC      12   WORK REG                                 @Y30LB10 02050003
*      REGD      13   WORK REG                                 @Y30LB10 02100003
*      BALRREG   14   BRANCH REG                               @Y30LB10 02150003
*      REGF      15   WORK REG                                 @Y30LB10 02200003
*                                                              @Y30LB10 02250003
*02    PATCH LABEL = ERPMAINT                                  @Y30LB10 02300003
*                                                              @Y30LB10 02350003
*01 MODULE TYPE = LOAD MODULE                                  @Y30LB10 02400003
*                                                              @Y30LB10 02450003
*02    PROCESSER = ASSEMBLER XF                                @Y30LB10 02500003
*                                                              @Y30LB10 02550003
*02    MODULE SIZE = 4096 BYTES                                @Y30LB10 02600003
*                                                              @Y30LB10 02650003
*02    ATTRIBUTES = RE-ENTRANT, PRIVILEGED                     @Y30LB10 02700003
*                                                              @Y30LB10 02750003
*01 ENTRY POINT = IGE0001H                                     @Y30LB10 02800003
*                                                              @Y30LB10 02850003
*02    PURPOSE =                                               @Y30LB10 02900003
*      1. INITIAL CALL OF THE ERP FOR A ERROR CONDITION.       @Y30LB10 02950003
*      2. RETURN FROM A ERP RETRY SIO.                         @Y30LB10 03000003
*                                                              @Y30LB10 03050003
*02    LINKAGE = IOS WILL CALL THE ERP WITH REG 1 = POINTER    @Y30LB10 03100003
*      TO IOSB AND REG 15 = BASE ADDRESS OF THE MODULE.        @Y30LB10 03150003
*                                                              @Y30LB10 03200003
*01 INPUT = CONTROL BLOCKS 'IOSB', 'EWA' AND THE 'UCB' WILL    @Y30LB10 03250003
*   BE INITIALIZED BY IOS PRIOR TO ENTRY.                      @Y30LB10 03300003
*                                                              @Y30LB10 03350003
*01 OUTPUT = NONE                                              @Y30LB10 03400003
*                                                              @Y30LB10 03450003
*01 EXIT NORMAL = IOSB FLAGS 'ERR' AND 'EX' WILL BE SET TO;    @Y30LB10 03500003
*   1. 'ERR' = 1, 'EX' = 1 TO DO A ERP RETRY SIO.              @Y30LB10 03550003
*   2. 'ERR' = 0, 'EX' = 1 TO EXIT PERMANENT ERROR.            @Y30LB10 03600003
*   3. 'ERR' = 0, 'EX' = 0 TO EXIT RECOVERED ERROR.            @Y30LB10 03650003
*   EXIT TO;                                                   @Y30LB10 03660003
*   XCTL TO WTO (IGE0025C) TO PRINT MESSAGES.                  @Y30LB10 03670003
*   XCTL TO OBR (IGE0025F) TO RECORD ON SYS1.LOGREC.           @Y30LB10 03680003
*   SVC-15, SVC-3 RETURN TO IOS.                               @Y30LB10 03690003
*                                                              @Y30LB10 03700003
*01 EXIT ERROR = NONE                                          @Y30LB10 03750003
*                                                              @Y30LB10 03800003
*01 EXTERNAL REFERENCES =                                      @Y30LB10 03850003
*                                                              @Y30LB10 03900003
*02    ROUTINES = SVC 35 (WRITE TO OPERATOR SVC), IGE0025C     @Y30LB10 03950003
*      (SYSTEM WTO ROUTINE) AND IGE0025F (OBR ROUTINE).        @Y30LB10 04000003
*                                                              @Y30LB10 04050003
*02    DATA AREAS = NONE                                       @Y30LB10 04100003
*                                                              @Y30LB10 04150003
*02    CONTROL BLOCKS = CVT, UCB, IOSB, EWA AND IEZSSC.        @Y30LB10 04200003
*                                                              @Y30LB10 04250003
*01 TABLES = NONE                                              @Y30LB10 04300003
*                                                              @Y30LB10 04350003
*01 MACROS = WTO AND TIME.                                     @Y30LB10 04400003
*                                                              @Y30LB10 04450003
*01 CHANGE ACTIVITY = Y30LB10                                  @Y30LB10 04500003
*   CHANGE FOR DCR 184                                         @YD00184 04550003
*   CHANGE FOR WTO                                             @ZA00663 04560003
*   CHANGE FOR ICBR BIT TEST BEFORE HOST READY                 @ZM31093 04572003
*   CHANGE FOR ICBI BIT TEST BEFORE HOST INIT.                 @ZM31094 04574003
*   CHANGE TO LOG ALL COMMAND REJECT'S MESSAGE CODE 6          @ZM31098 04576003
*   CHANGE TO SUPPORT FCR 378                                  @ZM31108 04578003
*   CHANGE FOR CHAN. RESTART                                   @ZUP0988 04578403
*   CHANGE FOR ERROR PRIORITY TESTING                          @OZ00682 04578803
*   CHANGE FOR AS12579  CORRECT ALT PATH ADDRESS               @OZ05073 04580003
*   CHANGE TO SUPPORT INT REQ OR ENV DATA DURRING SWAP         @OZ00688 04582003
*   CHANGE FOR FCR450. HANDLE DIAG CCWS AS NORMAL CCWS.        @ZA05140 04584003
*   CHANGE TO CORRECT CCW PTR IF ERROR AFTER SUSPEND           @ZA05141 04586003
*   CHANGE TO ADD NOOP CCW + PREVENT SWAP CCWS BEING DESTROYED @ZA05142 04588003
*   ADD FICHE FLAGS TO FORMAT SENSE HOOK CODE                  @Y40LB02 04588403
*   CHANGE FORMAT 0, MSG CODE 06, TERM 3F DESTINATION          @ZA09552 04592003
*   CHANGE FORMAT 0, MSG CODE 06, TERM 25 DESTINATION          @ZA10999 04594003
*   CHANGE TO EXIT PERM ERROR ON INCORRECT LENGTH ERROR     *  @OZ11017 04596003
*   CHANGE TO LOG ALL 06XX ERRORS AND EXIT PERM ERROR          @ZA13053 04598003
*   ON PROTECTION OR PROGRAM CHECK                             @ZA13053 04598403
*   CHANGE TO HANDLE ERRORS DURING IPL                         @ZA13054 04598803
*   PROPERLY HANDLE CHAINING OF 06-26 WHEN 26 IS               @ZA13055 04599203
*   UNIT CHECKED                                               @ZA13055 04599603
*   CHANGE FOR FCR 588 ADD FORMAT1 AS VALID SUU FORMAT         @ZA14725 04616403
*   DELETE 06CA AND 06CB REASON CODES (PTM  VS44017)           @G24LB22 04626400
*   ATTACHED PROCESSOR SUPPORT                                 @G24LB05 04636400
*   CHANGE FOR IOSINTRP MACRO                                  @ZA20273 04638424
*   CHANGE 23 06/16/77  SWAP ON 0630 ERR                       @ZA24432 04640424
*   CHANGE 24 10/20/77  ADD ASSOCAITE COMMAND ON INIT OF MP    @ZA28260 04640824
*   CHANGE 25 11/22/77  LEAVE UCB ONLINE ON A MOD 0630 ERR     @ZA27590 04641224
*   CHANGE 26 02/10/78  FIX INVALID SWAP CODE IN PTF UZ13257   @ZA30113 04641424
*   CHANGE 27 06/02/78  LCH POINTER NOT SWAPPED DURING MSC SWAP@ZA32810 04641524
**************************************************************@Y30LB10  04641603
         EJECT                                                          04650003
*                                                              @Y30LB10 04700003
*              GENERAL REGISTER EQUATES                        @Y30LB10 04750003
*                                                              @Y30LB10 04800003
REG0     EQU   0                       WORK REG                @Y30LB10 04850003
IOSBPTR  EQU   1                       IOSB POINTER            @Y30LB10 04900003
REG2     EQU   2                       WORK REG                @Y30LB10 04950003
REG3     EQU   3                       WORK REG                @Y30LB10 05000003
SAVEPTR  EQU   4                       USER START SAVE POINTER @ZM30721 05100003
CVTREG   EQU   5                       CVT POINTER             @Y30LB10 05150003
EWAPTR   EQU   6                       EWA POINTER             @Y30LB10 05200003
PRIUCB   EQU   7                       PRIMARY UCB POINTER     @Y30LB10 05250003
REG7     EQU   7                       IOSGEN MACRO WORK REG   @Y30LB10 05260003
ALTUCB   EQU   8                       ALTERNATE UCB POINTER   @Y30LB10 05300003
CCWPTR   EQU   9                       USER CCW POINTER        @Y30LB10 05350003
CTLPTR   EQU   10                      SSC CTL BLOCK POINTER   @Y30LB10 05400003
BASEREG  EQU   11                      BASE REG                @Y30LB10 05450003
REGC     EQU   12                      WORK REG                @Y30LB10 05500003
REGD     EQU   13                      WORK REG                @Y30LB10 05550003
BALRREG  EQU   14                      BR REG                  @Y30LB10 05600003
REGF     EQU   15                      WORK REG                @Y30LB10 05650003
         EJECT                                                          05700003
***************************************************************@Y30LB10 05710003
*  EWA3SAV - SET ON WHEN THE ERP MUST DO I/O TO A CCW BUILT    @Y30LB10 05720003
*  IN THE ERP FOR RECOVERY. THE USER FAILING CCW ADDRESS IS    @Y30LB10 05730003
*  SAVED PRIOR TO THE I/O AND RESTORED ON THE NEXT ERP         @Y30LB10 05740003
*  ENTRY.                                                      @Y30LB10 05742003
*                                                              @Y30LB10 05744003
*  EWA3SWAP - SET ON WHEN UCB'S HAVE BEEN SWAPPED TO NOTE THE  @Y30LB10 05746003
*  ERP IS IN THE SWAP FUNCTION.                                @Y30LB10 05748003
*                                                              @Y30LB10 05749703
*  EWA3CCH - USED AS THE CCH ERROR COUNTER.                    @Y30LB10 05749803
*                                                              @Y30LB10 05754003
*                                                              @Y30LB10 05766603
*  EWA3MSC - SET ON WHEN A SWAP IS CAUSED BY THE MSC           @Y30LB10 05768603
*                                                              @Y30LB10 05770603
***************************************************************@Y30LB10 05772603
* NOTINIT - SET ON WHEN THE ERP DETECTS THE MSC IS NOT         @Y30LB10 05774603
*  INITIALIZED AND WILL ISSUE THE SWITCH CCW,S WITHOUT         @Y30LB10 05775003
*  SWITCHING THE UCB,S.                                        @Y30LB10 05775403
***************************************************************@Y30LB10 05782603
*                                                              @Y30LB10 05783003
*        IOSB FLAG C BIT MEANINGS                              @Y30LB10 05783303
*        EWA   EWAFLAG3 3851 FLAG BIT MEANINGS                 @Y30LB10 05850003
EWA3SAVE EQU   X'80'                   ERP USER CCW SAVE FLAG  @Y30LB10 05900003
EWA3SWAP EQU   X'40'                   ERP SWAP IN PROCESS     @Y30LB10 05950003
NOTINIT  EQU   X'20'                   MSC NOT INITIALIZED FLG @ZM30721 06000003
EWA3CCH  EQU   X'10'                   ERP CCH ERROR CNTR      @Y30LB10 06050003
SPARE    EQU   X'08'                   UNUSED BIT POSITION     @ZA05141 06100003
EWA3MSC  EQU   X'02'                   MSC SWITCH              @YD00155 06110003
         SPACE 1                                                        06150003
*         ERROR COUNTER THREE EQUATES                          @YD00155 06160003
SECENTRY EQU   X'80'                   SECOND ENTRY TO ERP     @YD00155 06170003
SECERR   EQU   X'40'                   SECOND CC=3 ERROR       @YD00155 06180003
TRDERR   EQU   X'20'                   THIRD CC=3 ERROR        @YD00155 06190003
         SPACE 1                                                        06192003
*        ALTERNATE UCB OFFSETS                                 @Y30LB10 06200003
ALTSTAT  EQU   3                       UCBSTAT EQUATE          @Y30LB10 06250003
ALTFLA   EQU   6                       UCBFLA EQUATE           @Y30LB10 06300003
ALTCHAN  EQU   4                       UCBCHAN EQUATE          @Y30LB10 06350003
ALTLCI   EQU   10                      UCBLCI  EQUATE          @ZA32810 06370024
ALTNAME  EQU   13                      UCBNAME EQUATE          @Y30LB10 06400003
         SPACE   3                                                      06450003
*        GENERAL PROGRAM EQUATES                               @Y30LB10 06500003
A3OP     EQU   X'A3'                   SUSPEND OP CODE         @Y30LB10 06550003
NOOP     EQU   X'03'                   NOP CCW OP CODE         @ZM31093 06560003
C0       EQU   0                       COUNT OF 0              @Y30LB10 06600003
C1       EQU   1                       COUNT OF 1              @Y30LB10 06650003
C2       EQU   2                       COUNT OF 2              @Y30LB10 06700003
C3       EQU   3                       COUNT OF 3              @Y30LB10 06750003
C4       EQU   4                       COUNT OF 4              @Y30LB10 06800003
C5       EQU   5                       COUNT OF 5              @ZA28260 06810024
C7       EQU   7                       COUNT OF 7              @Y30LB10 06850024
C8       EQU   8                       COUNT OF 8              @Y30LB10 06890024
C10      EQU   10                      COUNT OF 10             @YD00156 06930024
C12      EQU   12                      COUNT OF 12             @ZA28260 06970024
C24      EQU   24                      COUNT OF 24             @Y30LB10 07050003
C32      EQU   32                      COUNT OF 32             @Y30LB10 07100003
C37      EQU   37                      COUNT OF 37             @Y30LB10 07200003
C48      EQU   48                      COUNT OF 48             @Y30LB10 07300003
C57      EQU   57                      COUNT OF 57             @YD00156 07320003
C62      EQU   62                      COUNT OF 62             @YD00156 07330003
C63      EQU   63                      COUNT OF 63             @YD00156 07340003
CCC      EQU   X'04'                   CHANNEL CONTROL CHK     @Y30LB10 07350003
CDC      EQU   X'08'                   CHANNEL DATA CHK        @Y30LB10 07400003
CEE      EQU   X'EE'                   INVALID OP CODE FOR ERP @YD00155 07410003
CHN      EQU   X'01'                   CHAINING CHECK          @Y30LB10 07450003
CMDCHN   EQU   X'40'                   COMMAND CHAIN FLAG      @Y30LB10 07500003
COD41    EQU   X'41'                   COMPLETION CODE 41      @Y30LB10 07550003
CUBZY    EQU   X'50'                   STS MOD AND BUSY BITS   @Y30LB10 07600003
CEDEUC   EQU   X'0E'                   CH END,DEV END,UNIT CK  @OZ00688 07610003
EOT      EQU   X'FF'                   END OF TABLE INDICATOR  @Y30LB10 07650003
EXEC     EQU   X'87'                   EXECUTE COMND OP CODE   @Y30LB10 07700003
FIFTEEN  EQU   15                      SVC 15 CODE             @Y30LB10 07750003
FIVE     EQU   X'05'                   COUNT OF 5              @Y30LB10 07800003
ICC      EQU   X'02'                   INTERFACE CONTROL CHK   @Y30LB10 07850003
ILI      EQU   X'40'                   INCORRECT LENGTH        @Y30LB10 07900003
INTCOD44 EQU   X'44'                   INTERCEPT CODE 44       @Y30LB10 07950003
INTCOD7E EQU   X'7E'                   INTERCEPT CODE 7E       @Y30LB10 08000003
LOC10    EQU   16                      ADDR OF CVT             @Y30LB10 08050003
NOTON    EQU   8                       BR ZERO CODE            @Y30LB10 08150003
NONSNS   EQU   X'0A'                   SNS EXPECTED TO BE 0    @OZ00682 08160003
OBRRTN   EQU   256                     OBR RTN CALL CODE       @Y30LB10 08200003
OF       EQU   X'0F'                   MASK OF  ZERO-FOX       @Y30LB10 08250003
OPERSWAP EQU   X'FF'                   OP CODE OF X'FF'        @Y30LB10 08300003
PGM      EQU   X'20'                   PROGRAM CHK             @Y30LB10 08350003
PROT     EQU   X'10'                   PROTECTION CHK          @Y30LB10 08400003
SNSOP    EQU   X'04'                   OP CODE FOR SENSE       @Y30LB10 08450003
SUSPEND  EQU   X'06'                   DEV END + UNIT CHK      @Y30LB10 08500003
READBL   EQU   X'06'                   READ COMMAND            @ZA13055 08510003
THREE    EQU   3                       SVC 3 CODE              @Y30LB10 08550003
TIC      EQU   X'08'                   OP CODE OF TIC COMND    @Y30LB10 08600003
MSCOPVAR EQU   X'80'                   UCB OPER VARY FLAG      @YD00155 08610003
UNCK     EQU   X'02'                   UNIT CHK                @Y30LB10 08650003
WTORTN   EQU   253                     WTO RTN CALL CODE       @Y30LB10 08700003
X40      EQU   X'40'                   HEX BYTE OF 40          @Y30LB10 08750003
ZERO     EQU   X'00'                   BYTE OF ZERO            @Y30LB10 08800003
FSLD3RTN EQU   3018                    LD1 FS RTN CALL CODE    @Y40LB02 08810002
         EJECT                                                          08850003
         USING IOSB,IOSBPTR            USING REG 1             @Y30LB10 08900003
         USING EWA,EWAPTR              USING REG 6             @Y30LB10 08950003
         USING UCB,PRIUCB              USING REG 7             @Y30LB10 09000003
         USING CVTMAP,CVTREG           USING REG 5             @Y30LB10 09050003
         USING CVTXTNT2,CTLPTR         USING REG 10            @ZM30721 09100003
         USING *,BASEREG               USING REG 11            @Y30LB10 09250003
*******************                                            @Y30LB10 09300003
*  SET UP REGS FOR BASE AND CONTROL BLOCK POINTERS.            @Y30LB10 09350003
*  GET CCW IN ERROR ADDRESS.                                   @Y30LB10 09400003
*******************                                            @Y30LB10 09450003
ERR000   EQU   *                                               @Y30LB10 09500003
         LR    BASEREG,REGF            GET BASE REG            @Y30LB10 09550003
         B     ERR001                                          @ZM31108 09600003
         DC    C'IGE0001H'                                     @ZM31108 09650003
         DATEM                                                          09660003
ERR001   EQU   *                                               @Y30LB10 09700003
         L     PRIUCB,IOSUCB           GET UCB ADDR            @Y30LB10 09750003
         SH    PRIUCB,H512             POINT TO PREFIX         @Y30LB10 09800003
         L     EWAPTR,IOSERP           GET EWA ADDR            @Y30LB10 09850003
         L     CCWPTR,IOSCC            GET ERROR CCW ADDR      @Y30LB10 09900003
         LA    CCWPTR,C0(CCWPTR)       ZERO HI ORDER BYTE      @Y30LB10 09950003
         TM    IOSCC,IOSCC3            IS IT A COND CODE 3 ?   @ZM31108 09960003
         BO    ERR002                  YES CC-3 CCW OK AS IS   @ZM31108 09970003
         SH    CCWPTR,H8               POINT TO ERROR CCW      @Y30LB10 10000003
ERR002   EQU   *                                               @ZM31108 10010003
         L     CVTREG,LOC10            GET ADR OF CVT          @Y30LB10 10050003
         L     CTLPTR,CVTEXT2          GET ADDR OF CVT EXT     @Y30LB10 10100003
         L     CTLPTR,CVTICB           GET ADDR OF SSC CTL BLK @Y30LB10 10150003
         DROP  CTLPTR                  DROP REG 10             @ZM30721 10160003
         USING ICB2SSCB,CTLPTR         USING REG 10            @ZM30721 10170003
         L     ALTUCB,ICBAUCB          GET ADDR OF ALT UCB     @Y30LB10 10200003
         EJECT                                                          10750003
*******************                                            @Y30LB10 10800003
*  INSURE THAT MSG AND LOG ARE ZEROED                          @Y30LB10 10850003
*  SET SECOND ERP ENTRY SWITCH ON                              @Y30LB10 10860003
*******************                                            @Y30LB10 10900003
ERR010   EQU   *                                               @Y30LB10 10950003
         NI    IOSFLB,X'FF'-IOSMSG-IOSLOG  ZERO LOG AND MSG    @Y30LB10 11000003
         OI    EWACNTR3,SECENTRY  SET 2ND ENTRY SWITCH         @ZM31108 11010003
         SPACE 1                                                        11050003
*******************                                            @Y30LB10 11100003
*  IS THIS THE FIRST ENTRY TO THE ERP                          @Y30LB10 11150003
*  IF YES CLEAR ALL ERP FLAGS EXCEPT LOOP. RESET THE ERROR     @Y30LB10 11200003
*  COUNTERS AND SET THE ERP IN CONTROL.                        @Y30LB10 11250003
*******************                                            @Y30LB10 11300003
         TM    IOSFLA,IOSERR           1ST ENTRY TO ERP        @Y30LB10 11350003
         BO    ERR020                  BR NO                   @Y30LB10 11400003
*********                                                      @Y30LB10 11450003
         MVI   EWAFLG3,ZERO           CLR ALL                  @Y30LB10 11500003
         XC    EWACNTR2(C2),EWACNTR2   ZERO ERP COUNTERS       @ZM02150 11510003
ERR020   EQU   *                                               @Y30LB10 11600003
         OI    IOSFLA,IOSERR+IOSEX     SET ERP IN CONTROL      @Y30LB10 11650003
         SPACE 1                                                        11700003
*******************                                            @Y30LB10 11750003
*  IS UNIT CHECK ON. IF YES, WE HAVE SENSE AND A ERR CONDITION.@Y30LB10 11800003
*******************                                            @Y30LB10 11850003
         TM    IOSTSA,UNCK             IS UNIT CHK ON          @Y30LB10 11900003
         BO    ERR040                  BR YES                  @Y30LB10 11950003
         SPACE 1                                                        12000003
*******************                                            @Y30LB10 12050003
*  IF UNIT CHK IS NOT ON, DO WE HAVE A CONTROL UNIT BUSY COND. @Y30LB10 12100003
*  IF YES GO TO REISSUE THE OPERATION.                         @Y30LB10 12150003
*******************                                            @Y30LB10 12200003
         TM    IOSTSA,CUBZY            IS IT CU BUSY           @Y30LB10 12250003
         BO    ERR2000                 BR YES TO EXIT          @Y30LB10 12300003
         SPACE 1                                                        12350003
*******************                                            @Y30LB10 12400003
*  WE DONT HAVE UNIT CHECK OR A CU BUSY SO ZERO THE SENSE AREA.@Y30LB10 12450003
*******************                                            @Y30LB10 12500003
ERR030   EQU   *                                               @Y30LB10 12550003
         XC    EWASNS(C32),EWASNS      ZERO SENSE AREA         @Y30LB10 12600003
         SPACE 1                                                        12650003
*******************                                            @Y30LB10 12700003
*  DID WE SAVE THE USER CCW ADDRESS. IF YES, RESTORE THE IOSB  @Y30LB10 12750003
*  WITH THAT ADDRESS.                                          @Y30LB10 12800003
*******************                                            @Y30LB10 12850003
ERR040   EQU   *                                               @Y30LB10 12900003
         TM    EWAFLG3,EWA3SAVE        DID WE SAVE USERS CCW   @Y30LB10 12950003
         BZ    ERR050                  BR NO                   @Y30LB10 13000003
         L     REG2,UCBDEV+C4          GET SAVED CCW ADDR      @Y30LB10 13050003
         ST    REG2,IOSVST             STORE VIRT ADDR         @Y30LB10 13100003
         LRA   REG2,C0(REG2)           CONVERT TO REAL         @Y30LB10 13150003
         ST    REG2,IOSRST             STORE REAL ADDR         @Y30LB10 13200003
         NI    EWAFLG3,X'FF'-EWA3SAVE  SET SAVE FLAG OFF       @Y30LB10 13250003
         SPACE 1                                                        13300003
*******************                                            @Y30LB10 13350003
*  IF SWAP IS ON WE ARE RETURNING FROM ISSUEING THE INVALID OP @Y30LB10 13400003
*  CODE OF X'EE' OR THE SWITCH CCW'S, GO TO SWITCH CODE.       @Y30LB10 13450003
*  IF LOOP IS ON WE HAVE ISSUED THE SWITCH CCW,S FOR THE       @Y30LB10 13500003
*  MSC NOT BEING INITIALIZED ONCE AND WILL GO TO PERM ERR.     @Y30LB10 13510003
*******************                                            @Y30LB10 13550003
ERR050   EQU   *                                               @Y30LB10 13600003
         TM    EWAFLG3,NOTINIT+EWA3SWAP IS MSC INITALIZED      @ZA24432 13610024
         BC    5,ERR600                BR IF ONES OR MIXED     @ZA24432 13620024
         EJECT                                                          13850003
********************                                           @Y30LB10 13900003
*  IS IT A INTERCEPT CONDITION. IF YES GO TO PERM ERR          @Y30LB10 13950003
********************                                           @Y30LB10 14000003
         CLI   IOSCOD,INTCOD7E         IS IT A INTERCEPT       @Y30LB10 14050003
         BE    ERR440                  BR YES TO PERM ERR      @Y30LB10 14100003
         SPACE 1                                                        14150003
*******************                                            @Y30LB10 14200003
*  WAS THE CSW ADDRESS ZERO. IF YES, GO TO PERMANENT ERROR.    @Y30LB10 14250003
*******************                                            @Y30LB10 14300003
ERR060   EQU   *                                               @Y30LB10 14350003
         LTR   CCWPTR,CCWPTR           IS CCW ADDR ZERO        @Y30LB10 14400003
         BM    ERR500                  BR YES                  @Y30LB10 14450003
         SPACE 1                                                        14500003
*******************                                            @Y30LB10 14550003
*  IF COMMAND CHAINING, DID THE CCW STRING BREAK IN A          @Y30LB10 14600003
*  DIFFERENT SPOT. IF YES, RESET THE ERROR COUNTERS AND SAVE   @Y30LB10 14650003
*  THE NEW CCW IN ERROR ADDRESS.                               @Y30LB10 14700003
*  DO NOT CHANGE ANYTHING IF IT IS A INTERFACE SUSPEND COND    @ZA05141 14702003
*  OR AN 'A3' COMMAND                                          @ZA05141 14710003
*******************                                            @Y30LB10 14750003
         C     CCWPTR,IOSVST           CHAIN BREAK IN NEW SPOT @Y30LB10 14800003
         BE    ERR070                  BR NO                   @Y30LB10 14850003
         CLI   C0(CCWPTR),A3OP         TEST FOR 'A3' CMD       @ZA05141 14900003
         BE    ERR070                  BRANCH IF A3            @ZA05141 14950003
         CLI   C0(CCWPTR),READBL       TEST FOR '06' CMD       @ZA05141 14960003
         BE    ERR070                  BRANCH IF 06            @ZA05141 14970003
ERR065   EQU   *                                               @YD00154 14996003
         NI    EWAFLG3,X'FF'-EWA3CCH  CLR CCH CNTR             @Y30LB10 15000003
         MVI   EWACNTR2,ZERO           CLR ERR CNTR            @Y30LB10 15050003
         ST    CCWPTR,IOSVST           STORE NEW ADDR IN VIRT  @Y30LB10 15100003
         LRA   REG2,C0(CCWPTR)         GET REAL ADDR           @Y30LB10 15150003
         ST    REG2,IOSRST             STORE IN REAL           @Y30LB10 15200003
         SPACE 1                                                        15250003
*******************                                            @Y30LB10 15600003
*    IS IT COND CODE 3.                                        @YD00155 15610003
*    IF YES AND ITS THE 1ST TIME, TRY ONCE MORE FOR ALT PATH   @YD00155 15620003
*   RETRY. IF ITS THE 2ND TIME GO TO SWITCH THE MSC;S          @YD00155 15630003
*******************                                            @Y30LB10 15700003
ERR070   EQU   *                                               @ZA05141 15710003
         TM    IOSCC,IOSCC3            IS IT COND CODE 3       @Y30LB10 15750003
         BNO   ERR071                  BR NO TO CCC, ICC       @OZ00682 15800003
         TM    EWACNTR3,SECERR         IS IT 2ND ERR           @YD00155 15810003
         BO    ERR565                  BR YES TO SWITCH        @ZA00663 15820003
         OI    EWACNTR3,SECERR         NO, SET 2ND ERR         @YD00155 15830003
         B     ERR2000                 GO RETRY                @YD00155 15840003
         SPACE 1                                                        15890003
*******************                                            @Y30LB10 15892003
*  IS IT A CCH (ICC/CCC) ERROR. IF YES, GO TO CCH CODE.        @Y30LB10 15894003
*******************                                            @Y30LB10 15896003
ERR071   TM    IOSTSB,ICC+CCC          IS IT CCH ERR           @Y30LB10 15898003
         BNZ   ERR300                  BR YES TO CCH CODE      @Y30LB10 15898403
         SPACE 1                                                        15898803
*******************                                            @Y30LB10 15899203
*  IS IT CHANNEL DATA CHECK . IF YES, GO RETRY.                @OZ00682 15899603
*******************                                            @OZ00682 15899903
         TM    IOSTSB,CDC              CHAN DATA CK ?          @OZ00682 15900003
         BNZ   ERR400                  BR YES CDC              @OZ00682 15903203
*******************                                            @Y30LB10 15903302
*  IS IT UNUSED SENSE BITS???                                  @OZ00682 15903402
*******************                                            @OZ00682 15903502
         TM    EWOSNS0,NONSNS          ARE UNUSED SENSE ON?    @OZ00682 15903603
         BNZ   ERR500                  SET PERM ,LOG, & MSG ON @OZ00682 15904002
         SPACE 1                                                        15905203
*******************                                            @Y30LB10 15906703
* IS IT A COMMAND REJECT. IF YES, CONTINUE.                    @Y30LB10 15910003
*******************                                            @Y30LB10 16100003
ERR072   EQU   *                                               @YD00155 16110003
         TM    EWOSNS0,EWOCREJ         IS IT COMND REJ         @Y30LB10 16150003
         BZ    ERR080                  BR NO                   @Y30LB10 16200003
         SPACE 1                                                        16250003
* IF ITS NOT FORMAT 0, GO TO PERM                              @OZ00682 16302003
         TM    EWOSNS3,EWOFOR0         IS IT FORMAT 0          @Y30LB10 16310003
         BZ    ERR078                  BR NO                   @OZ00682 16320003
         SPACE 1                                                        16320103
* IF ITS MSG '02' GO ISSUE THE SWITCH CCW,S WITHOUT SWITCHING  @YD00155 16320203
*  THE UCB,S.                                                  @YD00155 16320303
         CLI   EWOSNS11,EWOMSG02       IS IT MSG 02            @YD00155 16323103
         BE    ERR545                  BR YES TO SW            @YD00155 16325103
         SPACE 1                                                        16326003
* IS IT A INTERFACE SUSPEND, MSG X'0B'                         @ZM02150 16328803
* IF ITS MSG X'0B' AND ERR IN ERP, GO TO SUSPEND NORMAL.       @ZM02150 16331603
* IF ITS MSG X'0B' AND USER ERR, GO TO SUSPEND 1ST CCW.        @ZM02150 16334403
         CLI   EWOSNS11,EWOMSG0B       IS IT MSG '0B'          @ZM02150 16337203
         BNE   ERR075                  BR NO                   @ZM02150 16340003
         TM    EWACNTR3,SECENTRY       THIS 1ST ENTRY TO ERP   @ZM02150 16342003
         BO    ERR205                  BR NO TO SUSPEND        @ZM02150 16344003
         LRA   REG3,C0(CCWPTR)         GET ADR OF ERR CCW      @ZM02150 16346003
         B     ERR210                  BR TO SUSPEND           @ZM02150 16350003
         SPACE 1                                                        16352003
ERR075   EQU   *                                               @YD00133 16360003
*  IF ITS MSG CODE '0A' ITS A SWAP CONDITION                   @YD00155 16365203
         CLI   EWOSNS11,EWOMSG0A       IS IT MSG '0A'          @YD00155 16367203
         BE    ERR550                  BR YES TO SWAP          @YD00155 16367603
         SPACE 1                                                        16369203
* IF MSG 1,2,3 OR 4, CALL PERM ERR, PRT MSG WITH NO LOG        @YD00133 16372803
         CLI   EWOSNS11,EWOMSG04       IS IT MSG 1,2,3,4       @YD00133 16376403
         BNH   ERR495                  BR IF YES               @YD00133 16380003
         SPACE 1                                                        16380403
* IF ITS NOT MSG 6 CALL PERM ERR, PRT MSG WITH LOG             @YD00133 16382003
         CLI   EWOSNS11,EWOMSG06       IS IT MSG 6             @YD00133 16390003
         BNE   ERR500                  BR NO                   @YD00133 16392003
         SPACE 1                                                        16392103
* MSG 6- IF CODE IS FOR SWAP, GO TO SWAP CODE.                 @YD00155 16392203
*        IF CODE IS NOT '80', PERM ERR, PRT MSG WITH LOG       @ZM31098 16456503
         CLI   EWOSNS12,EWOCOD80       IS IT FOR SWAP          @YD00155 16466503
         BE    ERR550                  BR YES TO SWAP          @YD00155 16473003
         CLI   EWOSNS12,EWOCOD30       IS IT FOR SWAP          @ZA24432 16483024
         BE    ERR550                  BR YES TO SWAP          @ZA24432 16493024
         CLI   EWOSNS12,EWOCOD25       IS IT TERM CODE 25      @ZA13053 16523003
         BE    ERR500                  BR TO LOG IT WITH MSG   @ZA13053 16573003
         CLI   EWOSNS12,EWOCOD2D       IS IT TERM CODE 2D      @ZA13053 16575003
         BE    ERR500                  BR TO LOG IT WITH MSG   @ZA13053 16577003
         CLI   EWOSNS12,EWOCOD3F       IS IT TERM CODE 3F      @ZA28260 16579024
         BE    ERR500                  BR TO LOG IT WITH MSG   @ZA28260 16580024
         CLI   EWOSNS12,EWOCOD57       IS IT TERM CODE 57      @ZA28260 16581024
         BE    ERR077                  BR TO TEST FOR MP       @ZA28260 16582024
         CLI   EWOSNS12,EWOCODCA       IS IT TERM CODE CA      @G24LB22 16589924
         BE    ERR510                  BR TO LOG IT            @G24LB22 16591924
         CLI   EWOSNS12,EWOCODCB       IS IT TERM CODE CB      @G24LB22 16593924
         BE    ERR510                  BR TO LOG IT            @G24LB22 16595924
         CLI   EWOSNS12,EWOCODC0       IS IT TERM CODE C0      @YD00155 16597924
         BNL   ERR500                  BR TO LOG IT WITH MSG   @ZA13053 16599924
         B     ERR510                  BR TO LOG THE REST      @ZA13053 16601924
ERR077   EQU   *                                               @ZA28260 16602324
         TM    ICBFG1,ICBR             IS READY SET            @ZA28260 16602724
         BO    ERR510                  BR YES TO LOG IT        @ZA28260 16603124
ERR078   EQU   *                                                        16603924
         NI    IOSFLA,X'FF'-IOSERR     SET TO PERMANENT ERR    @OZ00682 16605903
         B     EXIT                    PERM ERR, NO MSG OR LOG @OZ00682 16615903
         SPACE 1                                                        16625903
*******************                                            @Y30LB10 16950003
ERR080   EQU   *                                               @Y30LB10 16960003
*  IS IT A SENSE FAILURE. IF YES CALL THE EQ CHK A PERM ERR.   @Y30LB10 17000003
*******************                                            @Y30LB10 17050003
ERR090   EQU   *                                               @Y30LB10 17100003
         TM    EWOSNS0,EWOEQU          IS IT EQ CHK            @Y30LB10 17150003
         BZ    ERR100                  BR NO                   @Y30LB10 17200003
         CLI   C0(CCWPTR),SNSOP        IS IT A SNS OP CODE     @Y30LB10 17250003
         BE    ERR500                  BR YES TO PERM ERR      @Y30LB10 17300003
         SPACE 1                                                        17750003
ERR100   EQU   *                                               @ZM31108 17760003
*******************                                            @Y30LB10 17800003
*  IS IT HOST RETRY. IF YES RETRY THE OPERATION.               @Y30LB10 17850003
*******************                                            @Y30LB10 17900003
         TM    EWOSNS0,EWOHRET         IS IT HOST RETRY        @Y30LB10 17950003
         BO    ERR530                  BR YES TO RETRY         @ZM31108 18000003
         SPACE 1                                                        18050003
*******************                                            @Y30LB10 18400003
*  IS IT INTERVENTION REQUIRED OR ENVIROMENTAL DATA. IF YES,   @Y30LB10 18450003
*  GO SEE IF IT IS A SUSPEND CONDITION.                        @Y30LB10 18500003
*******************                                            @Y30LB10 18550003
ERR120   EQU   *                                               @Y30LB10 18600003
         TM    EWOSNS0,EWOINT+EWOENV   INT REQ OR ENV DATA     @Y30LB10 18650003
         BNZ   ERR200                  BR IF EITHER ON         @Y30LB10 18700003
         SPACE 1                                                        18750003
*******************                                            @Y30LB10 18800003
*  IS IT EQUIPMENT CHECK OR BUS OUT. IF YES, GO ATTEMPT A      @Y30LB10 18850003
*  RETRY.                                                      @Y30LB10 18900003
*******************                                            @Y30LB10 18950003
         TM    EWOSNS0,EWOEQU+EWOBUSO  EQ CHK OR BUS OUT       @Y30LB10 19000003
         BNZ   ERR400                  BR IF EITHER ON         @Y30LB10 19050003
         SPACE 1                                                        19100003
*******************                                            @Y30LB10 19150003
*  IS IT CHAINING CHECK. IF YES, GO RETRY.                     @OZ00682 19200003
*******************                                            @Y30LB10 19300003
         TM    IOSTSB,CHN              IS IT CHAINING CHK?     @OZ00682 19350003
         BNZ   ERR400                  BR YES CHAINING CHK     @OZ00682 19360003
         SPACE 1                                                        19450003
*******************                                            @Y30LB10 19500003
*  IS IT PROGRAM CHECK, PROTECTION CHECK OR INCORRECT LENGTH.  @Y30LB10 19550003
*  IS YES, GO TO PERMANENT ERROR.                              @Y30LB10 19600003
*******************                                            @Y30LB10 19650003
         TM    IOSTSB,PGM+PROT+ILI     PGM CK, PROT CK         @ZA13053 19700003
         BNZ   ERR078                  BR IF ANY BIT ON        @ZA13053 19750003
         SPACE 1                                                        19800003
*******************                                            @Y30LB10 19850003
*  NO ERRORS HAVE BEEN FOUND. IF UNIT CHK IS ON,               @Y30LB10 19900003
*  GO TO PERM ERROR.                                           @Y30LB10 19950003
*******************                                            @Y30LB10 20000003
         TM    IOSTSA,UNCK             IS UNIT CHK ON          @Y30LB10 20050003
         BO    ERR500                  BR YES TO PERM ERR      @Y30LB10 20100003
         SPACE 1                                                        20150003
*******************                                            @Y30LB10 20200003
*  NO STATUS OR SENSE ERRORS HAVE BEEN FOUND. CALL THE         @Y30LB10 20250003
*  ERROR RECOVERED AND EXIT THE ERP.                           @Y30LB10 20300003
*******************                                            @Y30LB10 20350003
ERR130   EQU   *                                               @Y30LB10 20400003
         MVI   EWAFLG3,ZERO           CLR ERP FLAGS            @Y30LB10 20450003
         XC    EWACNTR2(C2),EWACNTR2   ZERO ERR CNTRS          @Y30LB10 20460003
         NI    IOSFLA,X'FF'-IOSERR-IOSEX  SET ERR RECOVERED    @Y30LB10 20550003
         B     ERR2000                 BR TO EXIT              @Y30LB10 20600003
         EJECT                                                          20650003
*******************                                            @Y30LB10 20700003
*  IS IT A SUSPEND CONDITION (DEV END + UNIT CHK ONLY).        @Y30LB10 20750003
*  IF NO, GO CHECK FURTHER. IF YES, BUILD THE SUSPEND CCW.     @Y30LB10 20800003
*  IF THE COMMAND WAS CHAINED, TIC TO THE NEXT USER CCW.       @Y30LB10 20850003
*  IF NO CHAINING, ISSUE THE 'A3' UNCHAINED.                   @Y30LB10 20860003
*******************                                            @Y30LB10 20950003
ERR200   EQU   *                                               @Y30LB10 21000003
         CLI   IOSTSA,SUSPEND          IS IT A SUSPEND COND    @Y30LB10 21050003
         BNE   ERR240                  BR NO                   @Y30LB10 21100003
ERR205   EQU   *                                               @ZM02150 21102003
         LRA   REG3,C8(CCWPTR)         GET ADR OF ERR CCW+8    @ZM02150 21104003
ERR210   EQU   *                                               @Y30LB10 21110003
         OI    EWAFLG3,EWA3SAVE        SET SAVE ON             @ZA05141 21150003
         MVC   EWOCCW3(C8),CCWSUS1     MOVE SUSPEND CCW TO EWA @ZM02151 21200003
         LRA   REG2,C0(CCWPTR)         GET REAL ERR CCW ADR    @Y30LB10 21250003
         ST    REG2,EWOCCW3            ERR CCW ADR IN A3 CMD   @ZM02151 21300003
         MVC   UCBDEV+C4(C4),IOSVST    SAVE USER CCW ADR       @Y30LB10 21400003
         LA    REG2,EWOCCW1            GET VIRT ADR OF CCWS    @Y30LB10 21450003
         ST    REG2,IOSVST             PUT IN IOSB             @Y30LB10 21500003
         LRA   REG2,EWOCCW1            GET REAL CCW ADDR       @Y30LB10 21550003
         ST    REG2,IOSRST             SET IN IOSB START FIELD @Y30LB10 21600003
         TM    C4(CCWPTR),CMDCHN       IS ERR CCW CHAINED      @ZM02151 21650003
         BO    ERR217                  BRANCH YES              @ZA05142 21660003
         MVC   EWOCCW2(C8),CCWNOOP     MOVE IN NOOP CCW        @ZA05142 21670003
         B     ERR235                                          @ZA05142 21680003
ERR217   EQU   *                                               @ZA05142 21690003
         CLI   C0(CCWPTR),A3OP         WAS A3 FAILING CMD?     @ZA05142 21692003
         BE    ERR235                  BR TO BUILD A3 ONLY     @ZA05142 21694003
         CLI   C8(CCWPTR),TIC          IS CCW+8 A TIC          @Y30LB10 21700003
         BNE   ERR230                  BR NO                   @ZM02151 21900003
ERR220   EQU   *                                               @Y30LB10 21950003
         L     REG3,C8(CCWPTR)         GET THE TIC TO ADR      @ZM02151 22000003
ERR230   EQU   *                                               @Y30LB10 22050003
         ST    REG3,EWOCCW2            TIC TO ADR IN SUS TIC   @ZM02151 22100003
         MVI   EWOCCW2,TIC             TIC OP CODE BACK IN CCW @ZM02151 22150003
         MVC   EWOCCW2+C4(C4),CCWEND   MOVE RIGHT HALF OF CCW  @ZM02151 22152003
         SPACE 1                                                        22200003
ERR235   EQU   *                                               @Y30LB10 22210003
         MVI   EWOCCW3,A3OP            SET A3 OP CODE IN CCW   @ZM02151 22210403
         MVC   EWOCCW1(C8),EWOCCW3     MOVE CCWS TO START ADR  @ZM02151 22212003
         TM    EWOSNS0,EWOCREJ         IS IT COMND REJ         @Y30LB10 22220003
         BO    ERR520                  BR YES                  @Y30LB10 22230003
         SPACE 1                                                        22240003
*******************                                            @Y30LB10 22250003
*  IS IT INTERVENTION REQUIRED. IF YES, GO TO PRINT MSG        @Y30LB10 22300003
*  AND RETRY. IF NO, ITS ENVIROMENTAL DATA, GO RECORD          @Y30LB10 22350003
*  AND RETRY.                                                  @Y30LB10 22400003
*******************                                            @Y30LB10 22450003
ERR240   EQU   *                                               @Y30LB10 22500003
         TM    EWOSNS0,EWOINT          IS IT INT REQ           @Y30LB10 22550003
         BNO   ERR410                  BR NO                   @ZM31108 22600003
         OI    IOSFLB,IOSLOG           SET LOG ON              @ZM31108 22650003
         B     WTOOUT                  YES INT REQ,EXIT WTO    @ZM31108 22660003
         EJECT                                                          22700003
*******************                                            @Y30LB10 22750003
*  CCH CODE.                                                   @Y30LB10 22800003
*  IS THIS THE SECOND TIME FOR THIS ERROR. IF YES, GO TO       @Y30LB10 22850003
*  PERMANENT ERROR.                                            @Y30LB10 22900003
*******************                                            @Y30LB10 22950003
ERR300   EQU   *                                               @Y30LB10 23000003
         TM    EWAFLG3,EWA3CCH        2ND TIME FOR THIS ERR    @Y30LB10 23050003
         BO    ERR380                  BR YES                  @Y30LB10 23100003
         SPACE 1                                                        23150003
*******************                                            @Y30LB10 23200003
*  WAS ERROR ON A TIO, HIO OR IS THE NO RETRY BIT ON IN ERPIB. @Y30LB10 23250003
*  IF ANY, GO TO PERMANENT ERROR.                              @Y30LB10 23300003
*******************                                            @Y30LB10 23350003
         TM    EWARGFG1,EWACTIO+EWACHIO+EWANORTY   HIO,TIO OR? @Y30LB10 23400003
         BNZ   ERR380                  BR IF ANY BITS ON       @Y30LB10 23450003
         SPACE 1                                                        23500003
*******************                                            @Y30LB10 23550003
*  WAS THE ERROR ON A INTERRUPT OR A COND CODE 1. IF NEITHER   @Y30LB10 23600003
*  OR BOTH, GO TO PERMANENT ERROR.                             @Y30LB10 23650003
*******************                                            @Y30LB10 23700003
         TM    EWARGFG1,EWACSIO+EWACINT  ERR ON SIO OR INTERR  @Y30LB10 23750003
         BO    ERR380                  BR BOTH ON              @Y30LB10 23800003
         BZ    ERR380                  BR NEITHER ON           @Y30LB10 23850003
         SPACE 1                                                        23900003
*******************                                            @Y30LB10 23950003
*  IS IT A COND CODE 1. IF YES, THE CCW CAN BE RESTARTED SO    @Y30LB10 24000003
*  BYPASS SOME ERROR TESTING.                                  @Y30LB10 24050003
*******************                                            @Y30LB10 24100003
         TM    IOSCC,IOSCC1            IS IT COND CODE 1       @Y30LB10 24150003
         BO    ERR330                  BR YES                  @Y30LB10 24200003
         SPACE 1                                                        24250003
*******************                                            @Y30LB10 24300003
*  ARE VALIDITY BITS ALL ON. IF ANY OFF, GO TO PERM ERROR.     @Y30LB10 24350003
*******************                                            @Y30LB10 24400003
         TM    EWAXCSW1,EWACSQV+EWACUNS+EWACCMD SEQ,STS,CMD OK @Y30LB10 24450003
         BNO   ERR380                  BR IF ANY OFF           @Y30LB10 24500003
         SPACE 1                                                        24550003
*******************                                            @Y30LB10 24600003
*  ONLY TERM CODES OF 0 OR 1 ARE RETRIABLE. IF TERM CODE IS    @Y30LB10 24650003
*  2 OR 3 GO TO PERM ERROR.                                    @Y30LB10 24700003
*******************                                            @Y30LB10 24750003
ERR330   EQU   *                                               @Y30LB10 24800003
         TM    EWAXCSW2,EWATER3        IS TERM CODE 3          @Y30LB10 24850003
         BO    ERR380                   BR YES                 @Y30LB10 24900003
         TM    EWAXCSW2,EWATER2        IS TERM CODE 2          @Y30LB10 24950003
         BO    ERR380                  BR YES                  @Y30LB10 25000003
         SPACE 1                                                        25050003
*******************                                            @Y30LB10 25100003
*  ONLY  SEQ CODE OF 1,2 OR 3 ARE RETRIABLE. IF IT IS SEQ      @Y30LB10 25150003
*  CODE 0,4,5,6 OR 7 GO TO PERM ERROR.                         @Y30LB10 25200003
*******************                                            @Y30LB10 25250003
         TM    EWAXCSW2,EWASEQ4        IS SEQ CODE 4,5,6,7     @Y30LB10 25300003
         BO    ERR380                  BR YES                  @Y30LB10 25350003
         TM    EWAXCSW2,EWASEQ7        IS SEQ CODE 0           @Y30LB10 25400003
         BZ    ERR380                  BR YES                  @Y30LB10 25450003
         SPACE 1                                                        25500003
*******************                                            @Y30LB10 25550003
*  ZERO THE ERPIB, SET THE CCH COUNTER BIT ON AND GO TO        @Y30LB10 25600003
*  RETRY THE OPERATION.                                        @Y30LB10 25650003
*******************                                            @Y30LB10 25700003
ERR360   EQU   *                                               @Y30LB10 25750003
         XC    EWAERPIB(C8),EWAERPIB   ZERO ERPIB              @Y30LB10 25800003
         OI    EWAFLG3,EWA3CCH        SET CCH CNTR ON          @Y30LB10 25850003
         B     ERR2000                 BR                      @Y30LB10 25900003
         SPACE 1                                                        25950003
*******************                                            @Y30LB10 26000003
*  ZERO THE ERPIB AND GO TO PERM ERROR.                        @Y30LB10 26050003
*******************                                            @Y30LB10 26100003
ERR380   EQU   *                                               @Y30LB10 26150003
         XC    EWAERPIB(C8),EWAERPIB   ZERO ERPIB              @Y30LB10 26200003
         B     ERR500                  BR                      @Y30LB10 26250003
         EJECT                                                          26300003
*******************                                            @Y30LB10 26350003
*  IS THE ERROR COUNTER = 5. IF NO, GO ATTEMPT A RETRY.        @Y30LB10 26400003
*  IF YES, SEE IF A SWAP IS REQUIRED.                          @Y30LB10 26450003
*******************                                            @Y30LB10 26500003
ERR400   EQU   *                                               @Y30LB10 26550003
         CLI   EWACNTR2,FIVE           IS ERR EQUAL TO FIVE    @Y30LB10 26600003
         BE    ERR470                  BR YES                  @Y30LB10 26650003
         SPACE 1                                                        26700003
*******************                                            @Y30LB10 26750003
*  STEP THE ERROR COUNTER BY ONE.                              @Y30LB10 26800003
*******************                                            @Y30LB10 26850003
         IC    REG2,EWACNTR2           GET ERR CNTR            @Y30LB10 26900003
         LA    REG2,C1(REG2)           STEP BY ONE             @Y30LB10 26950003
         STC   REG2,EWACNTR2           PUT BACK                @Y30LB10 27000003
         SPACE 1                                                        27050003
*******************                                            @Y30LB10 27100003
*  IS IT EQ CHK OR ENVIROMENTAL DATA. IF NEITHER GO RETRY.     @Y30LB10 27150003
*  IF EITHER GO CHECK FOR CEM AND SUU.                         @Y30LB10 27200003
*******************                                            @Y30LB10 27250003
ERR410   EQU   *                                               @Y30LB10 27300003
         TM    EWOSNS0,EWOENV          IS IT ENV DATA          @Y30LB10 27350003
         BO    ERR420                  BR YES                  @Y30LB10 27400003
         TM    EWOSNS0,EWOEQU          IS IT EQ CHK            @Y30LB10 27450003
         BZ    ERR2000                 NO TO EXIT SVC 15 RETRY @Y30LB10 27500003
         SPACE 1                                                        27550003
*******************                                            @Y30LB10 27600003
*  IF NOT CEM GO TO RETRY. IF CEM                              @ZA28260 27650024
*  THE ERP WILL PRINT THE MESSAGE. THEN GO RETRY.              @ZA28260 27690024
*******************                                            @Y30LB10 27730024
         TM    EWOSNS1,EWOCEM          IS CE MSG ON            @ZA28260 27770024
         BZ    ERR530                  BR IF NEITHER ON        @ZM31108 27810024
         MVC   EWOMSG(C37),WTOMSG      MOVE MSG TO EWA         @ZA28260 27850024
         MVC   EWOWTOB(C3),MSGCEM      MOVE CEM TO MSG         @ZA28260 27890024
         BAL   REG3,MSG100             GO PRT CEM MSG          @ZA28260 27930024
         B     ERR520                  TO WTO TO PRT EQ CK MSG @Y30LB10 27970024
         SPACE 1                                                        28010024
*******************                                            @Y30LB10 28050024
*  IS IT SUU. IF SO ERP WILL PRINT SUU THEN GO RETRY.          @ZA28260 28090024
*******************                                            @Y30LB10 28130024
ERR420   EQU   *                                               @Y30LB10 28170024
         TM    EWOSNS1,EWOSUU+EWOCEM   IS IT SUU OR CEM        @ZA28260 28210024
         BZ    ERR530                  IF OFF GO TO RETRY      @ZA28260 28260024
         B     ERR520                  IF EITHER ON GO TO WTO  @ZA28260 28310024
         SPACE 1                                                        28600003
*******************                                            @Y30LB10 28650003
*  SET INTERCEPT TO PERM ERROR.                                @Y30LB10 28700003
********************                                           @Y30LB10 28750003
ERR440   EQU   *                                               @Y30LB10 28800003
         MVI   IOSCOD,INTCOD44         SET INTERCEPT PERM ERR  @Y30LB10 28850003
         SPACE 1                                                        28900003
*********************                                          @Y30LB10 28950003
*  SET PERMANENT ERROR ON                                      @Y30LB10 29000003
*********************                                          @Y30LB10 29050003
ERR450   EQU   *                                               @Y30LB10 29100003
         NI    IOSFLA,X'FF'-IOSERR     SET PERM ERR            @Y30LB10 29150003
         B     ERR530                  SET LOG ON & EXIT OBR   @ZM31108 29160003
         SPACE 1                                                        29200003
*******************                                            @Y30LB10 29650003
*  IS IT EQUIPMENT CHECK OR BUS OUT. IF EITHER, SET UP TO      @Y30LB10 29700003
*  GO TO THE SWAP CODE. IF NEITHER  EXIT PERM ERROR.           @Y30LB10 29750003
*******************                                            @Y30LB10 29800003
ERR470   EQU   *                                               @Y30LB10 29850003
         TM    EWOSNS0,EWOEQU+EWOBUSO  EQ CHK OR BUS OUT       @Y30LB10 29900003
         BZ    ERR500                  BR IF NEITHER ON        @Y30LB10 29950003
         SPACE 1                                                        30000003
*******************                                            @Y30LB10 30050003
*  SET MSG ON. IF CEM ON GO PRINT CEM MESSAGE.                 @Y30LB10 30100003
*******************                                            @Y30LB10 30150003
         OI    IOSFLB,IOSMSG           SET MSG ON              @Y30LB10 30200003
         MVC   EWOMSG(C37),WTOMSG      MOVE MSG TO EWA         @ZA28260 30210024
         MVC   EWOWTOB(C3),MSGCEM      MOVE CEM TO MSG         @ZA28260 30220024
         BAL   REG3,MSG100             GO PRT CEM MSG          @ZA28260 30230024
         SPACE 1                                                        30300003
********************                                           @Y30LB10 30600003
*  IT IS EQ CHK OR BUSOUT AND WE WANT TO SWAP                           30650003
*******************                                            @Y30LB10 30800003
ERR480   EQU   *                                               @Y30LB10 30850003
         B     ERR560                  BR TO SWAP              @YD00155 31200003
         SPACE 1                                                        31250003
*********************                                          @YD00133 32310003
* SET TO PERMANENT ERROR, SET MSG ON, GO TO WTO                @YD00133 32320003
********************                                           @YD00133 32330003
ERR495   EQU   *                                               @YD00133 32340003
         OI    IOSFLB,IOSMSG           SET MSG ON              @YD00133 32342003
         NI    IOSFLA,X'FF'-IOSERR     SET PERM ERR            @YD00133 32344003
         B     EXIT                    GO TO WTO               @ZM31108 32348003
         SPACE 1                                                        32348403
*******************                                            @Y30LB10 32350003
*  SET MSG ON.                                                 @Y30LB10 32400003
*******************                                            @Y30LB10 32450003
ERR500   EQU   *                                               @Y30LB10 32500003
         OI    IOSFLB,IOSMSG           SET MSG ON              @Y30LB10 32550003
         SPACE 1                                                        32600003
*******************                                            @Y30LB10 32650003
*  SET ERP TO PERMANENT ERROR.                                 @Y30LB10 32700003
*******************                                            @Y30LB10 32750003
ERR510   EQU   *                                               @Y30LB10 32800003
         NI    IOSFLA,X'FF'-IOSERR SET ERR TO PERMANENT        @Y30LB10 32850003
         B     ERR530                  BR                      @Y30LB10 32900003
         SPACE 1                                                        32950003
*******************                                            @Y30LB10 33000003
*  SET MSG ON.                                                 @Y30LB10 33050003
*******************                                            @Y30LB10 33100003
ERR520   EQU   *                                               @Y30LB10 33150003
         OI    IOSFLB,IOSMSG           SET MSG ON              @Y30LB10 33200003
         SPACE 1                                                        33250003
*******************                                            @Y30LB10 33300003
*  SET LOG ON.                                                 @Y30LB10 33350003
*******************                                            @Y30LB10 33400003
ERR530   EQU   *                                               @Y30LB10 33450003
         OI    IOSFLB,IOSLOG           SET LOG ON              @Y30LB10 33500003
         SPACE 1                                                        33550003
*******************                                            @Y30LB10 33600003
*  GO TO COMMON EXIT ROUTINE.                                  @ZM31108 33650003
*******************                                            @Y30LB10 33700003
         B     EXIT                                            @ZM31108 33850003
         SPACE 1                                                        33900003
********************                                           @YD00155 33910003
*  THE MSC IS NOT INITIALIZIED. SET FLAG AND GO TO ISSUE THE   @YD00155 33912003
*  SWITCH CCW,S WITHOUT SWITCHING THE UCB,S.                   @YD00155 33914003
********************                                           @YD00155 33920003
ERR545   EQU   *                                               @YD00155 33930003
         OI    IOSFLB,IOSMSG+IOSLOG    SET MSG & LOG ON        @YD00155 33940002
         OI    EWAFLG3,NOTINIT         SET MSC NOT INIT ON     @ZM30721 33942003
         MVI   EWACNTR2,C0             ZERO ERR CNTR           @ZM30721 33944003
         NI    EWACNTR3,X'FF'-SECERR   SET OFF 2ND ERR         @ZM30721 33944403
         B     ERR660                  GO ISSUE CCW,S          @ZM30721 33944803
         SPACE 1                                                        33946003
********************                                           @YD00155 33948003
*  SET MSC SWITCH ON                                           @YD00155 33948403
********************                                           @YD00155 33949203
ERR550   EQU   *                                               @YD00155 33949603
ERR555   EQU   *                                               @YD00155 33978603
         OI    EWAFLG3,EWA3MSC         SET MSC SW ON           @YD00155 33980603
         SPACE 1                                                        33982603
ERR560   EQU   *                                               @Y30LB10 34200003
         OI    IOSFLB,IOSMSG           SET MSG ON              @YD00155 34210003
ERR565   EQU   *                                               @YD00155 34220003
         OI    IOSFLB,IOSLOG           SET LOG ON              @YD00155 34230003
ERR570   EQU   *                                               @YD00155 34240003
         B     ERR600                  GO TO SWITCH CODE       @YD00155 34242003
         EJECT                                                          34350003
*******************                                            @Y30LB10 35350003
*  COMPLETE THE ERROR MESSAGE. AND DO A WTO.                   @Y30LB10 35400003
*******************                                            @Y30LB10 35450003
MSG100   EQU   *                                               @Y30LB10 35500003
       TM   CVTOPTA,CVTNIP             SEE IF ITS IPL TIME     @ZA13054 35550003
         BO    NOMSG                   BRANCH IF SO            @ZA13054 35552003
         UNPK  EWOWORK1(C4),EWACHA(C3) GET DEV ADDRESS         @OZ05073 35560003
         TR    EWOWORK1(C3),TRTABLE-240 MAKE IT PRINTABLE      @OZ05073 35570003
         MVC   EWOWTOA(C3),EWOWORK1    MOVE DEV ADR TO MSG     @OZ05073 35580003
         SPACE 1                                                        35600003
         LR    REG2,IOSBPTR            SAVE IOSB REG           @Y30LB10 35650003
         TIME  DEC                                             @Y30LB10 35700003
         LR    IOSBPTR,REG2            RESTORE REG 1           @Y30LB10 35750003
         SPACE 1                                                        35800003
         ST    REG0,EWOWORK1           STORE TIME IN EWA       @Y30LB10 35850003
         OI    EWOWORK1+C3,OF          SET IN SIGN             @Y30LB10 35900003
         UNPK  EWOWORK1(C7),EWOWORK1(C4) UNPACK TO PRTABLE HEX @Y30LB10 35950003
         MVC   EWOWTOC(C2),EWOWORK1    MOVE IN HOUR            @YD00156 36000003
         MVC   EWOWTOE(C2),EWOWORK1+C2  MOVE MINS TO MSG       @YD00156 36050003
         MVC   EWOWTOF(C2),EWOWORK1+C4  MOVE SECS TO MSG       @YD00156 36100003
         SPACE 1                                                        36150003
         LR    REG2,IOSBPTR            SAVE REG 1              @YD00156 36200003
         LA    IOSBPTR,EWOMSG          ADDR OF MESSAGE         @YD00156 36250003
         WTO   MF=(E,(1))                                      @YD00156 36300003
         LR    IOSBPTR,REG2            RESTORE REG 1           @YD00156 36350003
         SPACE 1                                                        36400003
NOMSG    EQU   *                                               @ZA13054 36410003
         BR    REG3                    RETURN TO CALLER        @Y30LB10 36450003
         EJECT                                                          36500003
************************************************************** @Y30LB10 36510003
************************************************************** @Y30LB10 36520003
*        CONTROL UNIT SWAP CODE                                @Y30LB10 36550003
*                                                              @Y30LB10 36600003
************************************************************** @Y30LB10 36610003
************************************************************** @Y30LB10 36620003
*  IF 'SWAP' IS ON;                                            @YD00155 36630003
*    IF THE CCW OP CODE IS 'EE' GO SWITCH THE UCB,S            @YD00155 36640003
*    IF THE CCW OP CODE IS NOT 'EE' GO CHK FOR SWITCH ERRS.    @YD00155 36642003
*  IF 'SWAP' IS NOT ON;                                        @YD00155 36644003
*    IF 'LOOP' IS ON GO ISSUE THE SWITCH CCW,S.                @YD00155 36646003
*    IF 'LOOP' IS OFF GO ISSUE THE INVALID OP CCW.             @YD00155 36648003
********************                                           @YD00155 36648403
ERR600   EQU   *                                               @Y30LB10 36650003
         TM    CVTOPTA,CVTNIP          IS NIP IN CONTROL       @ZA28260 36651424
         BO    ERR890                  BR YES                  @ZA28260 36652124
         LR    REGD,PRIUCB             GET PRIMARY UCB ADDR    @ZA24432 36653624
         AH    REGD,H512               ADD HEX 200 TO UCB ADDR @ZA24432 36654824
         CLR   REGD,ALTUCB             IS IT BACKUP MSC        @ZA24432 36656224
         BE    ERR510                  BR YES TO PREM ERROR    @ZA24432 36657624
         TM    EWAFLG3,NOTINIT         IS MSC INITIALIZED      @ZA24432 36659024
         BO    ERR700                  BR NO SET               @ZM31094 36660424
         TM    ICBFG1,ICBI             HAS MSSC SET INIT ON?   @ZM31094 36661824
         BNO   ERR450                  BR NO SET               @ZM31094 36663224
         TM    EWAFLG3,EWA3SWAP        ARE WE IN SWAP NOW      @YD00155 36664624
         BZ    ERR603                  BR NO CHK FOR LOOP      @YD00155 36666024
         CLI   C0(CCWPTR),CEE          IS IT INVALID OP        @YD00155 36667424
         BE    ERR610                  BR YES TO ISSUE CCWS    @YD00155 36668824
         B     ERR700                  BR NO CHK FOR ERRS      @YD00155 36670224
ERR603   EQU   *                                               @YD00155 36671624
         MVI   EWACNTR2,C0             ZERO ERR CNTR           @YD00155 36673024
         NI    EWACNTR3,X'FF'-SECERR   SET OFF 2ND ERR         @YD00155 36674424
         SPACE 1                                                        36675824
*******************                                            @YD00155 36677224
*  WE MUST SWAP SO WE WILL INSURE THAT THE MSG AND LOGGING     @YD00155 36678624
*  REQUIRED IS DONE BEFOR THE UCBS ARE SWAPPED.                @YD00155 36680003
*  WE ISSUE A ERP CCW WITH OP CODE OF X'EE' TO FORCE A RETURN  @YD00155 36694003
*  FROM WTO/OBR.                                               @YD00155 36696003
*  WE WILL EXIT THRU OBR/WTO AND IOS WILL CALL US BACK BECAUSE @YD00155 36698003
*  THE ERP IS STILL IN CONTROL. THE ERP WILL                   @YD00155 36698403
*  LOOK FOR THE LOOP BIT ON WHEN IT IS CALLED AND GO           @YD00155 36698803
*  TO DO THE SWAP.                                             @YD00155 36699203
*******************                                            @YD00155 36699603
ERR605   EQU   *                                               @YD00155 36699703
         OI    EWAFLG3,EWA3SAVE+EWA3SWAP  SET SAVE+SWAP        @YD00155 36709703
         MVC   EWOCCW1(C8),CCWERP      MOVE ERP CCW TO EWA     @YD00155 36719703
         MVC   UCBDEV+C4(C4),IOSVST    SAVE USERS CCW ADDR     @YD00155 36728603
         LA    REG2,EWOCCW1            GET VIRT ADR OF ERP CCW @YD00155 36730603
         ST    REG2,IOSVST             STORE IN IOSB           @YD00155 36732603
         LRA   REG2,EWOCCW1            GET REAL ADDR OF ERP CCW@YD00155 36733003
         ST    REG2,IOSRST             STORE IN IOSB           @YD00155 36733103
         B     EXIT                    BR     TO WTO           @ZM31108 36883103
         SPACE 1                                                        37250003
********************                                           @Y30LB10 37300003
*  IS THE ALERNATE CONTROL UNIT 'GENED', 'ONLINE' AND 'READY'. @Y30LB10 37350003
*  BRANCH IF NOT TO PRINT 'SWAP IMPOSSIBLE'.                   @Y30LB10 37400003
********************                                           @Y30LB10 37450003
ERR610   EQU   *                                               @Y30LB10 37500003
         LTR   ALTUCB,ALTUCB           IS ALT UCB GENED        @Y30LB10 37550003
         BZ    ERR850                  BR NO                   @Y30LB10 37600003
         TM    ALTSTAT(ALTUCB),UCBONLI  IS ALT UCB ONLINE      @Y30LB10 37650003
         BZ    ERR850                  BR NO TO PRT MSG        @Y30LB10 37700003
         TM    ALTFLA(ALTUCB),UCBNRY    IS ALT UCB READY       @Y30LB10 37750003
         BO    ERR850                  BR NO TO PRT MSG        @Y30LB10 37800003
         SPACE 1                                                        37850003
********************                                           @Y30LB10 37900003
*  SET 'SWAP IN PROCESS' ON.                                   @Y30LB10 37950003
********************                                           @Y30LB10 38000003
         OI    EWAFLG3,EWA3SWAP SET SWAP IN PROCESS ON         @Y30LB10 38050003
         SPACE 1                                                        38100003
********************                                           @Y30LB10 38150003
*  FIND THE ALTERNATE AND PRIMARY UCB SLOTS IN THE UCB LOOKUP  @Y30LB10 38200003
*  TABLE. SWAP THE CONTENTS OF THESE SLOTS.                    @Y30LB10 38250003
********************                                           @Y30LB10 38300003
         L     REG2,CVTILK2            GET ADR OF LOOKUP TABLE @Y30LB10 38350003
         LR    REGD,PRIUCB             GET PRIMARY UCB ADDR    @Y30LB10 38450003
         AH    REGD,H512               ADD HEX 200 TO UCB ADDR @Y30LB10 38500003
         SPACE 1                                                        38550003
********************                                           @Y30LB10 38600003
*  FIND UCB LOOKUP SLOT FOR ALTERNATE FIRST                    @Y30LB10 38650003
********************                                           @Y30LB10 38750003
ERR620   EQU   *                                               @Y30LB10 38800003
         CLM   ALTUCB,C3,C0(REG2)      'TO' UCB LOOKUP SLOT    @Y30LB10 38850003
         BNE   ERR630                  BR NO CHK NEXT          @YD00137 38860003
         STH   REGD,C0(REG2)           STORE PRI IN ALT SLOT   @YD00137 39120003
         B     ERR640                  GO CHK NEXT SLOT        @YD00137 39130003
         SPACE 1                                                        39150003
********************                                           @Y30LB10 39200003
*  FIND UCB LOOKUP SLOT FOR PRIMARY NOW                        @Y30LB10 39250003
********************                                           @Y30LB10 39350003
ERR630   EQU   *                                               @Y30LB10 39400003
         CLM   REGD,C3,C0(REG2)       'FROM' UCB LOOKUP SLOT   @Y30LB10 39450003
         BNE   ERR640                  BR NO CHK NEXT          @YD00137 39460003
         STH   ALTUCB,C0(REG2)         STORE ALT IN PRI SLOT   @YD00137 39720003
********************                                           @YD00137 39730003
*  STEP TO NEXT SLOT AND TEST FOR END OF TABLE                 @YD00137 39732003
********************                                           @YD00137 39734003
ERR640   EQU   *                                               @YD00137 39736003
         LA    REG2,C2(REG2)           STEP TO NEXT SLOT       @Y30LB10 39740003
         TM    C1(REG2),EOT            IS IT END OF TABLE      @Y30LB10 39742003
         BNO   ERR620                  BR NO TO NEXT TEST      @YD00137 39742403
         SPACE 1                                                        39750003
********************                                           @Y30LB10 40150003
*  SWAP THE FOLLOWING CONTENTS OF THE PRIMARY AND ALTERNATE    @Y30LB10 40200003
*  UCBS. 'UCBNAME' (DEVICE ADDR IN BCD) AND 'UCBCHAN' (DEVICE  @Y30LB10 40250003
*  ADDR IN HEX).                                               @Y30LB10 40300003
********************                                           @Y30LB10 40350003
ERR650   EQU   *                                               @Y30LB10 40400003
         LH    REGC,UCBCHAN           GET HEX CUU OF PRIMARY   @Y30LB10 40450003
         LH    REGD,ALTCHAN(ALTUCB)  GET HEX CUU OF ALTERNATE  @Y30LB10 40500003
         STH   REGC,ALTCHAN(ALTUCB)  SWAP PRIMARY AND ALTERNATE@Y30LB10 40550003
         STH   REGD,UCBCHAN            UCB HEX CUU ADDRS       @Y30LB10 40600003
         IC    REGC,UCBLCI             GET LCH INDEX           @ZA32810 40610024
         IC    REGD,ALTLCI(ALTUCB)     GET ALT LCH INDEX       @ZA32810 40620024
         STC   REGC,ALTLCI(ALTUCB)     SAVE OLD LCI INDEX      @ZA32810 40630024
         STC   REGD,UCBLCI             SAVE NEW LCI INDEX      @ZA32810 40640024
         MVC   EWOWORK1(C3),UCBNAME    SAVE PRIMARY UCB BCD CUU@Y30LB10 40650003
         MVC   UCBNAME(C3),ALTNAME(ALTUCB)  ALT BCD CUU TO     @Y30LB10 40700003
         MVC   ALTNAME(C3,ALTUCB),EWOWORK1                     @Y30LB10 40750003
         SPACE 1                                                        40850003
***************************************************************@Y30LB10 40900003
***************************************************************@Y30LB10 40950003
*  PRINT MESSAGE;                                              @Y30LB10 41000003
*  'SYS SWITCH FROM XXX TO ZZZ STARTED, XXX OFFLINE'           @YD00156 41010003
*  'MSC SWITCH FROM XXX TO ZZZ STARTED, XXX OFFLINE'           @YD00156 41012003
*  ZZZ IS THE 'NEW' PRIMARY DEVICE                             @Y30LB10 41100003
*  XXX IS THE 'NEW' ALTERNATE DEVICE.                          @Y30LB10 41150003
********************                                           @Y30LB10 41200003
         MVC   EWOMSG(C63),WTOMSGD     MOVE MSG TO EWA         @YD00156 41250003
         MVC   EWOWTOK(C3),ALTNAME(ALTUCB)  ALT UCB CUU TO MSG @YD00156 41350003
         NI    ALTSTAT(ALTUCB),X'FF'-UCBONLI  NEW ALT OFFLINE  @YD00155 41354403
         BAL   REGC,SWAPMSG            GO PRT MSG              @YD00156 41360003
         SPACE 1                                                        41600003
********************                                           @Y30LB10 41650003
*  MOVE THE 4 'SWAP' CCWS TO THE EWA AND SET UP TO SIO TO      @ZA05142 41700003
*  THEM. THE CCWS ARE CHAINED 'SWITCH', INITIALIZE', 'HOST     @Y30LB10 41750003
*  READY FOR MESSAGES', AND 'NOOP'                             @ZA05142 41800003
********************                                           @Y30LB10 41850003
ERR660   EQU   *                                               @Y30LB10 41900003
         OI    EWAFLG3,EWA3SAVE+EWA3SWAP  SET SAVE+SWAP        @YD00155 41910003
         MVC   UCBDEV+C4(C4),IOSVST    SAVE USER VIRT ADR      @Y30LB10 42000003
         MVC   EWOCCW1(C24),CCWSW      MOVE SWAP CCWS TO EWA   @ZA05142 42050024
         MVC   EWOINIT(C4),INIT        MOVE INIT DATA TO EWA   @Y30LB10 42100003
         MVC   EWOHRM(C4),HRM          MOVE HRM DATA TO EWA    @Y30LB10 42150003
         LRA   REG2,EWOINIT            REAL ADDR OF INIT DATA  @Y30LB10 42200003
         ST    REG2,EWOCCW2            STORE ADDR IN CCW       @Y30LB10 42250003
         MVI   EWOCCW2,EXEC            RESTORE CCW OP CODE     @Y30LB10 42300003
         LRA   REG2,EWOHRM             REAL ADDR OF HRM DATA   @Y30LB10 42350003
         ST    REG2,EWOCCW3            STORE ADDR IN CCW       @Y30LB10 42400003
         MVI   EWOCCW3,EXEC            RESTORE CCW OP CODE     @Y30LB10 42450003
         LA    REG2,EWOCCW1            GET ADR OF 1ST SWAP CCW @Y30LB10 42500003
         ST    REG2,IOSVST             VIRT CCW ADR IN IOSB    @Y30LB10 42550003
         LRA   REG2,C0(REG2)           GET REAL ADR            @Y30LB10 42600003
         ST    REG2,IOSRST             REAL CCW ADR IN IOSB    @Y30LB10 42650003
         TM    ICBFG1,ICBR             HAS MSSC SET READY ON?  @ZM31093 42652003
         BO    ERR670                  BR YES READY IS SET     @ZM31093 42654003
         MVI   EWOCCW3,NOOP            MAKE HRM CCW NOP        @ZM31093 42656003
ERR670   EQU   *                                               @ZM31093 42658003
*******************                                            @Y30LB10 42660003
*  SET THE INITIALIZE COMMAND DATA UP FOR SINGLE CPU OR        @Y30LB10 42670003
*  MP COUPLED CPUS. USED FOR SWAPS.                            @Y30LB10 42680003
*******************                                            @Y30LB10 42690003
         TM    ICBFG1,ICBMSCMP         IS THIS MP              @G24LB05 42698142
         BZ    EXIT                    BR NO                   @G24LB05 42698442
         MVI   EWOINIT+C2,X40          SET COUPLED MP BIT ON   @Y30LB10 42698803
         MVC   EWOCCW4(C8),EWOCCW3     MOVE LAST CCW DOWN 1    @ZA28260 42740624
         MVC   EWOCCW3(C8),CCWASSOC    PUT ASSOC CCW IN CHAIN  @ZA28260 42750624
         LRA   REG2,EWOASSOC           GET ADDR OF ASSOC ORDER @ZA28260 42760624
         ST    REG2,EWOCCW3            PUT ADDR OF ORDER IN CCW@ZA28260 42770624
         MVI   EWOCCW3,EXEC            RESTORE OP CODE         @ZA28260 42780624
         MVC   EWOASSOC(C12),ASSOC     MOVE ASSOC ORDER TO EWO @ZA28260 42790624
         MVC   EWOASSOC+C4(C5),ICBCPUID PUT CPUID IN ORDER     @ZA28260 42800624
         B     EXIT                    SVC 15-3 EXIT           @ZM31108 42866424
         SPACE 1                                                        42908224
         EJECT                                                          42950003
********************                                           @Y30LB10 43000003
*  HAVE WE COMPLETED THE SWAP WITHOUT ERROR.                   @Y30LB10 43050003
*  IS IT CONDITION CODE 3 OR UNIT CHECK.                       @Y30LB10 43100003
*  BRANCH YES, TO HANDLE SWAP FAILURE.                         @Y30LB10 43150003
********************                                           @Y30LB10 43200003
ERR700   EQU   *                                               @Y30LB10 43250003
         TM    IOSCC,IOSCC3            IS IT COND CODE 3       @Y30LB10 43300003
         BNO   ERR710                  BR NO TO ERR CHK        @YD00155 43350003
         TM    EWACNTR3,SECERR         HAVE WE TRIED ONCE      @YD00155 43360003
         BO    ERR705                  BR YES                  @YD00155 43370003
         OI    EWACNTR3,SECERR         SET COUNT ON            @YD00155 43380003
         B     ERR660                  BR TO REISSUE           @YD00155 43390003
ERR705   EQU   *                                               @YD00155 43392003
         TM    EWACNTR3,TRDERR         IS IT THE 3RD ERR       @YD00155 43394003
         BO    ERR890                  BR YES TO PERM ERR      @YD00155 43396003
         OI    EWACNTR3,TRDERR         SET COUNT ON            @YD00155 43398003
         B     ERR800                  BR TO PRT MSG           @YD00155 43398403
ERR710   EQU   *                                               @Y30LB10 43400003
         CLC   IOSTSA(C2),STATOK       CSW STATUS CHAN-DEV END @Y30LB10 43450003
         BE    ERR713                  BR OK TO SWAP END MSG   @OZ00688 43500003
         TM    IOSTSA,X'FF'-CEDEUC     IS IT C.E.-D.E.-U.C.?   @OZ00688 43510003
         BNZ   ERR800                  ONES OR MIXED TO ERR CK @OZ00688 43530003
         TM    IOSTSB,X'FF'            ANY CH STATUS ON?       @OZ00688 43542003
         BNZ   ERR800                  ONES OR MIXED TO ERR CK @OZ00688 43544003
         TM    IOSTSA,UNCK             IS UNIT CHECK ON?       @OZ00688 43546003
         BZ    ERR800                  NO UNIT CHECK TO ERR CK @OZ00688 43548003
         TM    EWOSNS0,EWOCREJ+EWOHRET IS HOST RETRY OR        @OZ00688 43548403
*                                      COMMAND REJECT ON?      @OZ00688 43548803
         BNZ   ERR800                  ONES OR MIXED TO ERR CK @OZ00688 43549603
         TM    EWOSNS0,EWOINT+EWOENV   IS IT INT. REQ. OR ENV. @OZ00688 43549703
         BZ    ERR800                  BR NO TO ERR CK.        @OZ00688 43549803
         OI    EWAFLG3,EWA3SAVE        SET SAVE ON             @OZ00688 43549903
         ST    CCWPTR,IOSVST          PUT V START ADDR IN IOSB @OZ00688 43566603
         LRA   REG2,C0(CCWPTR)         CONVERT TO REAL         @OZ00688 43576603
         ST    REG2,IOSRST            PUT R START ADDR IN IOSB @OZ00688 43578603
         CLI   IOSTSA,SUSPEND          IS IT D.E. + U.C. ONLY? @OZ00688 43580603
         BNE   ERR240                  GO SET UP FOR MSG & LOG @OZ00688 43582603
         MVI   0(CCWPTR),A3OP          SET A3 IN CCW           @OZ00688 43583003
         B     ERR240                  GO SET UP FOR MSG & LOG @OZ00688 43583103
         SPACE 1                                                        43583303
***************************************************************@Y30LB10 43600003
***************************************************************@Y30LB10 43650003
*  PRINT MESSAGE;                                              @Y30LB10 43700003
*  'SYS SWITCH FROM XXX TO ZZZ ENDED'                          @YD00156 43710003
*  'MSC SWITCH FROM XXX TO ZZZ ENDED'                          @YD00156 43712003
*  XXX IS THE 'NEW' ALTERNATE DEVICE                           @YD00156 43730003
*  ZZZ IS THE 'NEW' PRIMARY DEVICE.                            @YD00156 43800003
********************                                           @Y30LB10 43850003
ERR713   TM    EWAFLG3,NOTINIT         IS MSC INITIALIZED      @OZ00688 43860003
         BNO   ERR715                  BR YES                  @ZM30721 43870003
         NI    EWAFLG3,X'FF'-NOTINIT   SET FLAG - MSC NOT INIT @ZM30721 43880003
         NI    EWAFLG3,X'FF'-EWA3SWAP  SET SWAP OFF            @ZM30721 43890003
         B     ERR730                  BR                      @ZM30721 43892003
ERR715   EQU   *                                               @ZM30721 43894003
         MVC   EWOMSG(C48),WTOMSGA     MOVE MSG TO EWA         @YD00156 43900003
         BAL   REGC,SWAPMSG            GO PRT MSG              @YD00156 43950003
         SPACE 1                                                        44200003
********************                                           @Y30LB10 44900003
*  GO TO DO A SVC 15, SVC 3.                                   @Y30LB10 44950003
********************                                           @Y30LB10 45000003
ERR730   EQU   *                                               @Y30LB10 45050003
         MVI   EWACNTR2,C1            SET ERR CNTR TO 1        @Y30LB10 45100003
         B     ERR900                  BR TO EXIT              @YD00155 45200003
         EJECT                                                          45250003
***************************************************************@Y30LB10 46100003
***************************************************************@Y30LB10 46150003
*  PRINT MESSAGE;                                              @Y30LB10 46200003
*  'SYS SWITCH FROM XXX TO ZZZ FAILED, ZZZ OFFLINE'            @YD00156 46210003
*  'MSC SWITCH FROM XXX TO ZZZ FAILED, ZZZ OFFLINE'            @YD00156 46212003
*  XXX IS THE 'NEW' ALTERNATE DEVICE                           @YD00156 46270003
*  ZZZ IS THE 'NEW' PRIMARY DEVICE.                            @Y30LB10 46300003
********************                                           @Y30LB10 46350003
ERR800   EQU   *                                               @YD00155 46400003
         TM    EWAFLG3,NOTINIT         IS MSC INITIALIZED      @ZM30721 46410003
         BO    ERR810                  BR YES NOT INIT         @ZM30721 46420003
         MVC   EWOMSG(C62),WTOMSGC     MOVE MSG TO EWA         @YD00156 46450003
         MVC   EWOWTOJ(C3),UCBNAME     MOVE DEV ADDR TO MSG    @YD00156 46500003
         BAL   REGC,SWAPMSG            GO PRT MSG              @YD00156 46550003
*                                                              @Y30LB10 46800003
         NI    UCBSTAT,X'FF'-UCBONLI   SET PRIMARY UCB OFFLINE @Y30LB10 46810003
         TM    IOSCC,IOSCC3            COND CODE 3             @YD00155 46820003
         BNO   ERR810                  BR NO                   @YD00155 46830003
         MVI   IOSCOD,COD41            SET COMP CODE TO 41     @YD00155 46840003
         B     ERR814                  BR ON                   @YD00155 46842003
ERR810   EQU   *                                               @YD00155 46844003
         OI    IOSFLB,IOSMSG+IOSLOG    SET MSG + LOG ON        @YD00155 46846003
ERR814   EQU   *                                               @YD00155 46849903
         NI    IOSFLA,X'FF'-IOSERR     SET PERM ERR            @YD00155 46850003
         B     EXIT                    GO XCTL TO WTO          @ZM31108 46900003
***************************************************************@Y30LB10 47350003
***************************************************************@Y30LB10 47400003
*  PRINT MESSAGE;                                              @Y30LB10 47450003
*  'SYS SWITCH FROM AAA TO BBB, BBB NOT AVAIL'                 @YD00156 47460003
*  'SYS SWITCH FROM AAA TO ALT, ALT NOT AVAIL'                 @YD00156 47470003
*  'MSC SWITCH FROM AAA TO BBB, BBB NOT AVAIL'                 @YD00156 47472003
*  'MSC SWITCH FROM AAA TO ALT, ALT NOT AVAIL'                 @YD00156 47474003
*  AAA IS THE 'CURRENT' PRIMARY DEVICE                         @YD00156 47492003
*  BBB IS THE 'CURRENT' ALTERNATE DEVICE                       @YD00156 47494003
*  IF THE ALTERNATE IS NOT GENED THE ZZZ WILL BE 'ALT'         @Y30LB10 47550003
*******************                                            @Y30LB10 47600003
ERR850   EQU   *                                               @Y30LB10 47650003
         MVC   EWOMSG(C57),WTOMSGB     MOVE MSG TO EWA         @YD00156 47700003
         MVC   EWOWTOE(C3),UCBNAME     SET IN PRI ADR          @YD00156 47750003
ERR860   EQU   *                                               @YD00156 48000003
         MVC   EWOWTOI(C3),MSGALT      MOVE 'ALT' TO MSG       @YD00156 48050003
         MVC   EWOWTOG(C3),MSGALT      MOVE 'ALT' TO MSG       @YD00156 48060003
         LTR   ALTUCB,ALTUCB           IS ALT UCB AVALI        @Y30LB10 48100003
         BZ    ERR870                  BR IF NOT GENED         @Y30LB10 48150003
         MVC   EWOWTOI(C3),ALTNAME(ALTUCB)   MOVE ALT DEV ADDR @YD00156 48200003
         MVC   EWOWTOG(C3),ALTNAME(ALTUCB)   MOVE ALT DEV ADDR @YD00156 48210003
ERR870   EQU   *                                               @Y30LB10 48250003
         BAL   REGC,SWAPSVC            GO PRT MSG              @YD00156 48260003
         CLI   EWOSNS11,EWOMSG06       IS IT MSG CODE 06       @ZA27590 48290024
         BNE   ERR880                  BRANCH NO               @ZA27590 48320024
         CLI   EWOSNS12,EWOCOD30       IS IT ERROR CODE 30     @ZA27590 48350024
         BNE   ERR880                  BRANCH NO               @ZA27590 48380024
         LTR   ALTUCB,ALTUCB           IS ALT UCB AVAILABLE    @ZA27590 48410024
         BZ    ERR890                  BR IF NOT GENNED        @ZA27590 48440024
         SPACE 1                                                        48500003
*******************                                            @Y30LB10 48550003
*  SET PRIMARY UCB 'OFFLINE'                                   @Y30LB10 48600003
*  SET 'PERMANENT ERROR' IN IOSB                               @Y30LB10 48650003
*******************                                            @Y30LB10 48800003
ERR880   EQU   *                                               @Y30LB10 48850003
         NI    UCBSTAT,X'FF'-UCBONLI   SET PRI UCB OFFLINE     @Y30LB10 49000003
ERR890   EQU   *                                               @Y30LB10 49050003
         NI    IOSFLA,X'FF'-IOSERR     SET TO PERM ERR         @Y30LB10 49100003
         SPACE 3                                                        49102003
ERR900   EQU   *                                               @YD00155 49104003
         NI    EWAFLG3,X'FF'-EWA3SWAP-EWA3CCH                  @YD00155 49110003
         NI    EWAFLG3,X'FF'-NOTINIT   SET FLAG - MSC NOT INIT @ZM30721 49120003
         EJECT                                                          49200003
EXIT     TM    IOSFLB,IOSMSG           IS MSG ON ?             @ZM31108 49210003
         BO    WTOOUT                  YES TO TO WTO           @ZM31108 49220003
         TM    IOSFLB,IOSLOG           IS LOG ON ?             @ZM31108 49230003
         BO    OBROUT                  YES TO TO OBR           @ZM31108 49240003
         B     ERR2000                 GO TO SVC 15-3 EXIT     @ZM31108 49242003
*******************                                            @Y30LB10 49250003
*  OBR EXIT                                                    @ZM31108 49300003
*******************                                            @Y30LB10 49350003
OBROUT   EQU   *                                               @ZM31108 49360003
         LA    REGD,OBRRTN             GET OBR CODE            @ZM31108 49370003
         B     XCTLOUT                 GO TO OBR               @ZM31108 49380003
*******************                                            @Y30LB10 49390003
*  WTO EXIT                                                    @ZM31108 49392003
*******************                                            @Y30LB10 49394003
WTOOUT   EQU   *                                               @ZM31108 49396003
         LA    REGD,WTORTN             GET WTO CODE            @ZM31108 49398003
*******************                                            @Y40LB02 49398103
*  IF ITS FORMAT 0 - GO TO FORMAT SENSE XCTL                   @Y40LB02 49398203
*******************                                            @Y40LB02 49398303
         TM    EWOSNS3,EWOFOR0         IS IT FORMAT 0?         @Y40LB02 49398403
         BO    ERR1100                 BRANCH YES              @Y40LB02 49401424
*******************                                            @Y40LB02 49404603
*  IF ITS FORMAT 3 - GO TO FORMAT SENSE XCTL                   @Y40LB02 49407003
*******************                                            @Y40LB02 49409403
         TM    EWOSNS3,EWOFOR3         IS IT FORMAT 3?         @Y40LB02 49411803
         BO    ERR1100                 BRANCH YES              @Y40LB02 49414203
*******************                                            @Y40LB02 49416603
         TM    EWOSNS3,EWOFOR4         IS IT FORMAT 4?         @Y40LB02 49419003
         BO    ERR1100                 BRANCH YES              @Y40LB02 49421403
*******************                                            @Y40LB02 49423803
*  IF ITS FORMAT 5 - GO TO FORMAT SENSE XCTL                   @Y40LB02 49426203
*******************                                            @Y40LB02 49428603
         TM    EWOSNS3,EWOFOR5         IS IT FORMAT 5?         @Y40LB02 49431003
         BO    ERR1100                 BRANCH YES              @Y40LB02 49433403
*******************                                            @Y40LB02 49435403
*  IF ITS FORMAT 1 - GO TO FORMAT SENSE XCTL                   @ZA14725 49435503
*******************                                            @ZA14725 49435603
         TM    EWOSNS3,EWOFOR1         IS IT FORMAT 1?         @ZA14725 49435703
         BO    ERR1100                 BRANCH YES              @ZA14725 49442103
         SPACE 1                                                        49448803
XCTLOUT  EQU   *                                               @Y30LB10 49455203
*******************                                                     49461603
****************************************************************        49468003
*    SYSTEM WTO/OBR XCTL                                                49474403
****************************************************************        49480803
         BAL   REG3,ERR3000            GO TEST FOR QUISCE      @YD00136 49487203
         L     BALRREG,CVTXTLER        GET XCTL RTN ADDR       @Y30LB10 49493603
         BR    BALRREG                 XCTL TO NEXT RTN        @Y30LB10 49500003
         SPACE 4                                                        49550003
************************************************************** @Y40LB02 49560003
*    FORMAT SENSE XCTL                                         @Y40LB02 49570003
*************************************************************  @Y40LB02 49580003
ERR1100  BAL   REG3,ERR3000            GO TEST FOR QUISCE      @Y40LB02 49590003
         LA    REGD,FSLD3RTN           FMT SNS ROUTING ID      @Y40LB02 49592003
         L     BALRREG,CVTXTLER        GET XCTL RTN ADDR       @Y40LB02 49594003
         BR    BALRREG                 XCTL TO NEXT RTN        @Y40LB02 49596003
***************************************************************@X04AC10 49598002
*******************                                            @Y30LB10 49600003
*  EXIT SVC-15  SVC-3                                          @Y30LB10 49650003
*******************                                            @Y30LB10 49700003
ERR2000  EQU   *                                               @Y30LB10 49750003
         BAL   REG3,ERR3000            GO TEST FOR QUISCE      @YD00136 49760003
         SVC   FIFTEEN                                         @Y30LB10 49800003
         SVC   THREE                                           @Y30LB10 49850003
         SPACE 3                                                        49860003
*********************                                          @YD00136 49870003
* IF ERP IS EXITING PERMANENT OR RECOVERED ERROR AND THE       @YD00136 49880003
* DRIVER IS EXCP THEN SET THE QUISCE BITS IN THE IOSB AND      @YD00136 49886903
* UCB OFF.                                                     @YD00136 49890703
*********************                                          @YD00136 49892603
ERR3000  EQU   *                                               @YD00136 49894503
         LR    REGC,REGD               SAVE REG 13             @YD00136 49896403
         LA    REGD,EWOMSG             SAVE AREA FOR IOSGEN    @YD00136 49898303
         TM    IOSFLA,IOSERR+IOSEX     ERP IN CONTROL          @YD00136 49900203
         BO    ERR3010                 BR YES                  @YD00136 49902103
         TM    IOSOPT,IOSQISCE         IS QUISCE ON?           @ZUP0988 49904003
         BZ    ERR3010                 BR NO                   @YD00136 49905903
         NI    IOSOPT,X'FF'-IOSQISCE   SET IOSB QUISCE BIT OFF @YD00136 49907803
         L     REG2,IOSUCB             GET UCB ADDRESS         @ZA00663 49909703
         IOSGEN  UCBFLG,UCB=(REG2),VAR=OFF,TABLE=UCBQISCE      @ZA00663 49909903
         SR    REG7,REG7               ZERO REGISTER           @ZUP0988 49912303
         L     REG2,IOSUCB             GET UCB ADDRESS         @ZUP0988 49922303
         IOSINTRP UCB=(REG2),BRANCH=YES                        @ZA20273 49925924
ERR3010  EQU   *                                               @YD00136 49928603
         LR    REGD,REGC               RESTORE REG 13          @YD00136 49930603
         BR    REG3                    RETURN                  @YD00136 49932603
         EJECT                                                          49933303
********************                                           @YD00156 49935303
*  SET PRIMARY DEVICE ADDRESS IN MSG AT 'ZZZ' AND ALTERNATE    @YD00156 49937303
*  DEVICE ADDRESS IN MSG AT 'XXX'.                             @YD00156 49939303
********************                                           @YD00156 49941303
SWAPMSG  EQU   *                                               @YD00156 49943303
         MVC   EWOWTOG(C3),UCBNAME     SET IN PRI DEV ADDR     @YD00156 49949903
         MVC   EWOWTOE(C3),ALTNAME(ALTUCB)  SET IN ALT DEV ADR @YD00156 49978603
         SPACE 1                                                        49979003
********************                                           @YD00156 49979403
*  SET EITHER 'SYS SWITCH' OR 'MSC SWITCH' IN MSG              @YD00156 49979503
********************                                           @YD00156 49980203
SWAPSVC  EQU   *                                               @YD00156 49980603
         MVC   EWOWTOA(C10),MSGSYS     SET IN ' SYS SWAP'      @YD00156 49982203
SWAP010  EQU   *                                               @YD00156 49982303
         TM    EWAFLG3,EWA3MSC         IS IT A MSC SWITCH      @YD00156 49982403
         BZ    SWAP020                 BR NO                   @YD00156 49982503
         MVC   EWOWTOA(C10),MSGMSC     MOVE MSC TO MSG         @YD00156 49989203
SWAP020  EQU   *                                               @YD00156 49991203
         LR    REG2,IOSBPTR            SAVE REG 1              @YD00156 49996403
         LA    IOSBPTR,EWOMSG          ADDR OF MESSAGE         @YD00156 50003103
         WTO   MF=(E,(1))                                      @YD00156 50009803
         LR    IOSBPTR,REG2            RESTORE REG 1           @YD00156 50016503
         BR    REGC                    RETURN TO CALLER        @YD00156 50023203
         EJECT                                                          50029903
*--------------------------------------------------------------@Y30LB10 50036603
CCWSW    CCW   X'44',0,X'60',1                                 @Y30LB10 50043303
CCWINIT  CCW   X'87',INIT,X'60',4                              @Y30LB10 50050003
CCWHRM   CCW   X'87',HRM,X'20',4                               @ZA28260 50100024
CCWASSOC CCW   X'87',ASSOC,X'60',12                            @ZA28260 50120024
CCWNOOP  CCW   X'03',0,X'20',1                                 @ZA28260 50140024
CCWERP   CCW   X'EE',0,X'00',0                                 @ZM30721 50160024
*--------------------------------------------------------------@Y30LB10 50180024
INIT     DC    X'10000000'                                     @Y30LB10 50200024
ASSOC    DC    X'2C0080000000000000000000'                     @ZA28260 50220024
HRM      DC    X'20000000'                                     @Y30LB10 50300003
*--------------------------------------------------------------@Y30LB10 50350003
CCWSUS1  CCW   X'A3',0,X'60',1                                 @ZA05142 50400003
CCWEND   DC    X'00000001'        2ND HALF OF TIC CCW          @ZM02151 50450003
*--------------------------------------------------------------@Y30LB10 50500003
         DS    0F                                              @Y30LB10 50550003
H8       DC    H'8'                                            @Y30LB10 50650003
H512     DC    H'512'                                          @Y30LB10 50700003
STATOK   DC    X'0C00'                                         @Y30LB10 50750003
TRTABLE  DC    CL16'0123456789ABCDEF'                          @OZ05073 50760003
*--------------------------------------------------------------@Y30LB10 50800003
         DS    0F                                              @Y30LB10 50850003
WTOMSGA  DS    0F                                              @Y30LB10 50900003
         DC    AL2(MSGENDA-MSGNOA)                             @Y30LB10 50950003
         DC    X'8000'                                         @Y30LB10 51000003
MSGNOA   DC    C'IEA000I YYYYYYYYYY FROM XXX TO ZZZ ENDED'     @YD00156 51010024
         DC    X'10004040'                                     @Y30LB10 51100003
MSGENDA  EQU   *                                               @Y30LB10 51150003
*--------------------------------------------------------------@Y30LB10 51200003
*                                                              @Y30LB10 51250003
WTOMSGB  DS    0F                                              @Y30LB10 51300003
         DC    AL2(MSGENDB-MSGNOB)                             @Y30LB10 51350003
         DC    X'8000'                                         @Y30LB10 51400003
MSGNOB   DC    C'IEA000I ZA27590YYY FROM AAA TO BBB, '         @YD00156 51410024
         DC    C'BBB NOT AVAIL'                                @YD00156 51420003
         DC    X'10004040'                                     @Y30LB10 51500003
MSGENDB  EQU   *                                               @Y30LB10 51550003
*--------------------------------------------------------------@Y30LB10 51600003
WTOMSGC  DS    0F                                              @Y30LB10 51650003
         DC    AL2(MSGENDC-MSGNOC)                             @Y30LB10 51700003
         DC    X'8000'                                         @Y30LB10 51750003
MSGNOC   DC    C'IEA000I YYYYYYYYYY FROM XXX TO ZZZ FAILED, '  @YD00156 51760024
         DC    C'ZZZ OFFLINE'                                  @YD00156 51770003
         DC    X'10004040'                                     @Y30LB10 51850003
MSGENDC  EQU   *                                               @Y30LB10 51900003
*--------------------------------------------------------------@Y30LB10 51950003
*                                                              @Y30LB10 52000003
WTOMSGD  DS    0F                                              @Y30LB10 52050003
         DC    AL2(MSGENDD-MSGNOD)                             @Y30LB10 52100003
         DC    X'8000'                                         @Y30LB10 52150003
MSGNOD   DC    C'IEA000I ZA27590YYY FROM XXX TO ZZZ STARTED, ' @YD00156 52160024
         DC    C'XXX OFFLINE'                                  @YD00156 52170003
         DC    X'10004040'                                     @Y30LB10 52250003
MSGENDD  EQU   *                                               @Y30LB10 52300003
*--------------------------------------------------------------@Y30LB10 52350003
*                                                              @Y30LB10 52400003
WTOMSG   DS    0F                                              @Y30LB10 52450003
         DC    AL2(MSGEND-MSGNO)                               @Y30LB10 52500003
         DC    X'8000'                                         @Y30LB10 52550003
MSGNO    DC    C'IEA000I '                                     @Y30LB10 52600003
MSGTXTA  DC    C'XXX ZZZ'                                      @Y30LB10 52650003
MSGTXTB  DC    C',,,,,,'                                       @Y30LB10 52700003
MSGTXTC  DC    C'XX.XX.XX'                                     @Y30LB10 52750003
ROUTE    DC    X'10004040'                                     @Y30LB10 52800003
MSGEND   EQU   *                                               @Y30LB10 52850003
*--------------------------------------------------------------@Y30LB10 52900003
MSGALT   DC    C'ALT '                                         @Y30LB10 52950003
MSGCEM   DC    C'CEM '                                         @Y30LB10 53050003
MSGSYS   DC    C'SYS SWITCH'                                   @YD00156 53160003
MSGMSC   DC    C'MSC SWITCH'                                   @YD00156 53170003
*--------------------------------------------------------------@Y30LB10 53200003
ERPMAINT EQU   *                                               @Y30LB10 53250003
         DC    AL2(MAINTEND-ERPMAINT)                          @Y30LB10 53300003
         ORG   ERR000+4080                                     @Y30LB10 53350003
         DC    C'IGE0001H //END//'                             @Y30LB10 53400003
MAINTEND EQU   *                                               @Y30LB10 53450003
         EJECT                                                          53500003
         IECDIOSB                                                       53550003
         EJECT                                                          53600003
         IECDERWA                                                       53650003
         SPACE 3                                                        53700003
*//////////////////////////////////////////////////////////////@Y30LB10 53750003
*                                                              @Y30LB10 53800003
*//////////////////////////////////////////////////////////////@Y30LB10 53850003
         ORG   EWAIERP                                         @Y30LB10 53900003
EWOSNS   DS    XL32                    3851 SENSE              @Y30LB10 53950003
         ORG   EWOSNS                                          @Y30LB10 54000003
EWOSNS0  DS    XL1                     SENSE BYTE 0            @Y30LB10 54050003
EWOCREJ  EQU   X'80'                   COMMAND REJECT          @Y30LB10 54100003
EWOINT   EQU   X'40'                   INTERVENTION REQUIRED   @Y30LB10 54150003
EWOBUSO  EQU   X'20'                   BUS OUT CHECK           @Y30LB10 54200003
EWOEQU   EQU   X'10'                   EQUIPMENT CHECK         @Y30LB10 54250003
EWO4     EQU   X'08'                   SPARE                   @Y30LB10 54300003
EWOHRET  EQU   X'04'                   HOST RETRY              @Y30LB10 54350003
EWOPERR  EQU   X'02'                   PERMANENT ERROR         @Y30LB10 54400003
EWOENV   EQU   X'01'                   ENVIROMENTAL DATA       @Y30LB10 54450003
EWOSNS1  DS    XL1                     SENSE BYTE 1            @Y30LB10 54500003
EWOCEM   EQU   X'80'                   CE MESSAGE              @Y30LB10 54550003
EWOSUU   EQU   X'40'                   SUBSYSTEM UNIT UNUSABLE @Y30LB10 54600003
EWOSNS2  DS    XL1                     SENSE BYTE 2            @Y30LB10 54650003
EWOSNS3  DS    XL1                     SENSE BYTE 3            @Y30LB10 54700003
EWOFOR0  EQU   X'80'                   FORMAT 0                @Y30LB10 54710003
EWOFOR1  EQU   X'40'                   FORMAT 1                @Y30LB10 54750003
EWOFOR2  EQU   X'20'                   FORMAT 2                @Y30LB10 54800003
EWOFOR3  EQU   X'10'                   FORMAT 3                @Y30LB10 54810002
EWOFOR4  EQU   X'08'                   FORMAT 4                @Y30LB10 54820002
EWOFOR5  EQU   X'04'                   FORMAT 5                @Y30LB10 54830002
EWOSNS4  DS    XL1                     SENSE BYTE 4            @Y30LB10 54850003
EWOSNS5  DS    XL1                     SENSE BYTE 5            @Y30LB10 54900003
EWOSNS6  DS    XL1                     SENSE BYTE 6            @Y30LB10 54950003
EWOSNS7  DS    XL1                     SENSE BYTE 7            @Y30LB10 55000003
EWOSNS8  DS    XL1                     SENSE BYTE 8            @Y30LB10 55050003
EWOSNS9  DS    XL1                     SENSE BYTE 9            @Y30LB10 55100003
EWOSNS10 DS    XL1                     SENSE BYTE 10           @Y30LB10 55150003
EWOSNS11 DS    XL1                     SENSE BYTE 11           @Y30LB10 55200003
EWOMSG02 EQU   X'02'                   MESSAGE '02'            @YD00133 55200403
EWOMSG04 EQU   X'04'                   MESSAGE '04'            @YD00133 55202003
EWOMSG06 EQU   X'06'                   MESSAGE '06'            @YD00133 55204003
EWOMSG0A EQU   X'0A'                   MESSAGE '0A'            @YD00133 55206003
EWOMSG0B EQU   X'0B'                   MESSAGE '0B'            @Y30LB10 55210003
EWOSNS12 DS    XL1                     SENSE BYTE 12           @Y30LB10 55250003
EWOCOD25 EQU   X'25'                   CODE '25'               @ZA10999 55250403
EWOCOD2D EQU   X'2D'                   CODE '2D'               @ZA13053 55250803
EWOCOD3F EQU   X'3F'                   CODE '3F'               @ZA09552 55252003
EWOCOD57 EQU   X'57'                   CODE '57'               @ZA28260 55254024
EWOCOD80 EQU   X'80'                   CODE '80'               @YD00133 55260003
EWOCOD30 EQU   X'30'                   CODE '30'               @ZA24432 55262024
EWOCOD8F EQU   X'8F'                   CODE '8F'               @YD00133 55270003
EWOCODC0 EQU   X'C0'                   CODE 'C0'               @YD00133 55280003
EWOCODCA EQU   X'CA'                   CODE 'CA'               @G24LB22 55290042
EWOCODCB EQU   X'CB'                   CODE 'CB'               @G24LB22 55292042
EWOSNS13 DS    XL1                     SENSE BYTE 13           @Y30LB10 55300003
EWOSNS14 DS    XL1                     SENSE BYTE 14           @Y30LB10 55350003
EWOSNS15 DS    XL1                     SENSE BYTE 15           @Y30LB10 55400003
EWOSNS16 DS    XL1                     SENSE BYTE 16           @Y30LB10 55450003
EWOSNS17 DS    XL1                     SENSE BYTE 17           @Y30LB10 55500003
EWOSNS18 DS    XL1                     SENSE BYTE 18           @Y30LB10 55550003
EWOSNS19 DS    XL1                     SENSE BYTE 19           @Y30LB10 55600003
EWOSNS20 DS    XL1                     SENSE BYTE 20           @Y30LB10 55650003
EWOSNS21 DS    XL1                     SENSE BYTE 21           @Y30LB10 55700003
EWOSNS22 DS    XL1                     SENSE BYTE 22           @Y30LB10 55750003
EWOSNS23 DS    XL1                     SENSE BYTE 23           @Y30LB10 55800003
EWOSNS24 DS    XL1                     SENSE BYTE 24           @Y30LB10 55850003
EWOSNS25 DS    XL1                     SENSE BYTE 25           @Y30LB10 55900003
EWOSNS26 DS    XL1                     SENSE BYTE 26           @Y30LB10 55950003
EWOSNS27 DS    XL1                     SENSE BYTE 27           @Y30LB10 56000003
EWOSNS28 DS    XL1                     SENSE BYTE 28           @Y30LB10 56050003
EWOSNS29 DS    XL1                     SENSE BYTE 29           @Y30LB10 56100003
EWOSNS30 DS    XL1                     SENSE BYTE 30           @Y30LB10 56150003
EWOSNS31 DS    XL1                     SENSE BYTE 31           @Y30LB10 56200003
*                                                              @Y30LB10 56250003
EWOMSG   DS    XL63                    ERP MSG AREA            @DCRXXXX 56800003
         ORG   EWOMSG                                          @Y30LB10 56850003
EWOWTO   DS    XL12                    ERP MSG                 @Y30LB10 56900003
EWOWTOA  DS    XL4                     ERP MSG                 @Y30LB10 56950003
EWOWTOB  DS    XL9                     ERP MSG                 @Y30LB10 57000003
EWOWTOC  DS    XL2                     ERP MSG                 @Y30LB10 57050003
EWOWTOD  DS    XL1                     ERP MSG                 @Y30LB10 57100003
EWOWTOE  DS    XL3                     ERP MSG                 @Y30LB10 57150003
EWOWTOF  DS    XL4                     ERP MSG                 @Y30LB10 57200003
EWOWTOG  DS    XL3                     ERP MSG                 @Y30LB10 57250003
EWOWTOH  DS    XL2                     ERP MSG                 @ZM02153 57300003
EWOWTOI  DS    XL7                     ERP MSG                 @ZM02153 57310003
EWOWTOJ  DS    XL1                     ERP MSG                 @DCRXXXX 57320003
EWOWTOK  DS    XL11                    ERP MSG                 @DCRXXXX 57330003
EWOWTORT DS    XL4                     ERP MSG                 @Y30LB10 57350003
*                                                              @Y30LB10 57400003
EWOSPARE DS    XL1                     EWA SPARE               @ZM02153 57450003
EWOWORK1 DS    XL4                     ERP WORK AREA 1         @ZA05142 57452024
EWOWORK2 DS    XL4                     ERP WORK AREA 2         @ZA05142 57454024
         ORG   EWOMSG                                          @ZA05142 57460024
EWOCCWS  DS    XL32                    ERP CCWS                @ZA05142 57470003
         ORG   EWOCCWS                                         @ZA05142 57480003
EWOCCW1  DS    XL8                     ERP CCW 1               @ZA05142 57490003
EWOCCW2  DS    XL8                     ERP CCW 2               @ZA05142 57492003
EWOCCW3  DS    XL8                     ERP CCW 3               @ZA05142 57494003
EWOCCW4  DS    XL8                     ERP CCW 4               @ZA05142 57496003
EWOINIT  DS    XL4                     INIT CCW DATA           @ZA05142 57498803
EWOASSOC DS    XL12                    ASSOC CCW DATA          @ZA28260 57498924
EWOHRM   DS    XL4                     HRM CCW DATA            @ZA05142 57499124
RSVD     DS    XL44                    EWO SPARE               @ZA28260 57499324
EWOEND   EQU   *                       EWA END                 @Y30LB10 57500003
         EJECT                                                          57550003
         IEFUCBOB                      PREFIX=YES,LIST=YES              57600003
         EJECT                                                          57650003
         CVT   DSECT=YES,LIST=NO                                        57700003
         EJECT                                                          57750003
         IEZSSC                                                         57800003
         EJECT                                                          57800403
         IHAPSA                                                         57860003
         EJECT                                                          57870003
         IHALCCA                                                        57930003
         EJECT                                                          57940003
         IECDIRT                                                        57942003
         EJECT                                                          57942403
         IECDIOCM                                                       57944003
         EJECT                                                          57946003
         IECDIOCX                                                       57948003
         END                                                            57950003
