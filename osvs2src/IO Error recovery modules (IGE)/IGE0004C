         TITLE 'IGE0004C - BSC ERP CONTROL MODULE'                      00100002
IGE0004C CSECT                                                          00150002
*********************************************************************** 00200002
*                                                                     * 00250002
* MODULE NAME:                                                        * 00300002
*    IGE0004C                                                         * 00350002
*                                                                     * 00400002
* DESCRIPTIVE NAME:                                                   * 00450002
*    BTAM BSC CONTROL ERP                                             * 00500002
*                                                                     * 00550002
* COPYRIGHT:                                                          * 00600002
*    NONE                                                             * 00650002
*                                                                     * 00700002
* STATUS:                                                             * 00750002
*    CHANGE LEVEL 001                                                 * 00800002
*                                                                     * 00850002
* FUNCTION:                                                           * 00900002
*    THIS ROUTINE IS THE FIRST LOAD OF EACH ERP RETRY ATTEMPT.        * 00950002
*    IT ROUTINE PERFORMS THE FOLLOWING FUNCTIONS:                     * 01000002
*        * PROVIDES LINKAGE TO PROPER ERP ROUTINE FOR TYPE OF         * 01050002
*          ERROR ENCOUNTERED.                                         * 01100002
*        * DETERMINES IF ERP RETRIES ARE SUCCESSFUL.                  * 01150002
*        * MAINTAINS SOR TABLE FOR TEMPORARY ERRORS.                  * 01200002
*                                                                     * 01250002
* NOTES:                                                              * 01300002
*    DEPENDENCIES:                                                    * 01350002
*        NONE                                                         * 01400002
*    RESTRICTIONS:                                                    * 01450002
*        THIS ERP IS ONLY FOR DEVICES SUPPORTED BY BTAM.              * 01500002
*    REGISTER CONVENTIONS:                                            * 01550002
*        SEE 'REGISTER DEFINITION' BELOW                              * 01600002
*                                                                     * 01650002
* PATCHLABEL:                                                         * 01700002
*    PACHAREA (100 BYTES)                                             * 01750002
*                                                                     * 01800002
* MODULE TYPE:                                                        * 01850002
*    PROCEDURE                                                        * 01900002
*    PROCESSOR:                                                       * 01950002
*        BAL                                                          * 02000002
*    MODULE SIZE:                                                     * 02050002
*        980 BYTES                                                    * 02100002
*    ATTRIBUTES:                                                      * 02150002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD.  * 02200002
*                                                                     * 02250002
* ENTRY POINT:                                                        * 02300002
*    IGE0004C                                                         * 02350002
*    PURPOSE:                                                         * 02400002
*        SEE 'FUNCTION'                                               * 02450002
*    LINKAGE:                                                         * 02500002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 02550002
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 02600002
*    INPUT:                                                           * 02650002
*        REG 1 = ADDRESS OF IOSB                                      * 02700002
*    OUTPUT:                                                          * 02750002
*        ALTERED CHANNEL PROGRAM                                      * 02800002
*        SETS INDICATOR IN DECERRST FOR SHOULD NOT OCCUR ERROR        * 02850002
*                                                                     * 02900002
* EXITS-NORMAL:                                                       * 02950002
*    APPROPRIATE BTAM ERROR HANDLER VIA BRANCH ENTRY TO XCTL.         * 03000002
*        ALL LOADS START WITH IGE0. THE FIRST LOAD IS IGE0004A.       * 03050002
*        SUBSEQUENT LOADS ARE NUMBERED 1000 HIGHER THAN THE PREVIOUS  * 03100002
*        LOAD. THE ELEVENTH LOAD IS IGE0004B AND ALL SUBSEQUENT       * 03150002
*        LOADS ARE 1000 GREATER.                                      * 03200002
*        NO REGISTERS ARE SAVED BY THE ERROR ROUTINES AND ONLY        * 03250002
*        REGISTER 1 MAINTAINS TRANSPARENCY BETWEEN LOADS.             * 03300002
*                                                                     * 03350002
* EXITS-ERROR:                                                        * 03400002
*    NONE                                                             * 03450002
*                                                                     * 03500002
* EXTERNAL REFERENCES:                                                * 03550002
*    ROUTINES:                                                        * 03600002
*        IOS INTERPRETER                                              * 03650002
*        IECVTCCW (IOS CCW TRANSLATOR)                                * 03700002
*    DATA AREAS                                                       * 03750002
*        IOB (MAPPED BY IEZIOB)                                       * 03800002
*        VIRTUAL CHANNEL PROGRAM                                      * 03850002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 03900002
*    CONTROL BLOCKS                                                   * 03950002
*        DCB                                                          * 04000002
*        DECB                                                         * 04050002
*        IOSB         (MAPPED BY IECDIOSB)                            * 04100002
*        CVT          (MAPPED BY CVT)                                 * 04150002
*        IOB          (MAPPED BY IEZIOB)                              * 04200002
*        RQE          (MAPPED BY IECDRQE)                             * 04250002
*        TCCW         (MAPPED BY IECDTCCW)                            * 04300002
*        IOCOM        (MAPPED BY IECDIOCM)                            * 04350002
*                                                                     * 04400002
* TABLES-WORKAREAS:                                                   * 04450002
*    ERP WORKAREA                                                     * 04500002
*    IOB CHANNEL PROGRAM AREA IN IOB BTAM EXTENSION                   * 04550002
*                                                                     * 04600002
* MACROS:                                                             * 04650002
*    NONE                                                             * 04700002
*                                                                     * 04750002
* CHANGE ACTIVITY:                                                    * 04800002
*    YM02595K (9/20/73)                                               * 04850002
*    YM02594K (9/24/73)                                               * 04900002
*    YM05652K (1/24/74)                                               * 04910002
*    YM05680K (1/24/74)                                               * 04920002
*    YM07711  (4/2/74)                                                * 04930000
*    YM08278 (4/16/74)                                                * 04940000
*    ZA02815  (01/17/75)                 ZM00634  (01/27/75)          * 04942000
*    AZ04166  (08/25/75)          AZ04681  (08/26/75)                 * 04943000
*    AZ04868  (08/27/75)          AZ04869  (08/27/75)                 * 04953000
*    AZ09345  (04/08/76)                                              * 04963000
*    AZ09351  (04/08/76)  DELETES APAR AZ04869                        * 04973000
*    AZ10030  (04/12/76)                                              * 04983000
*    AZ24270  (09/29/77)                                              * 04991000
*    AZ28893   12/20/77                                               * 04992000
*    AZ31667   04/06/78                                               * 04993000
*********************************************************************** 05000002
         EJECT                                                          05050002
         USING *,BASEREG                                                05100002
         LR    BASEREG,ERREG5      SET BASE REG                         05150002
         USING RQE,ERREG5                                               05200002
         USING IECTDECB,DECBRG                                          05250002
         USING IHADCB,DCBREG                                            05300002
         USING IOSB,IOSBREG                                             05350002
         USING IOBSTDRD,IOBRG                                           05400002
         USING EWA,EWAREG                                               05450000
         B     BEGIN               BRANCH AROUND ID                     05460000
         DC    C'IGE0004C'         MODULE ID                            05470000
         DC    XL3'017983'         PTF NUMBER                           05476000
         DC    CL8'&SYSDATE'                                            05482000
         DS    0H                                                       05490000
BEGIN    EQU   *                                                        05492000
         L     ERREG5,IOSUSE       BASE RQE                             05500002
         L     EWAREG,IOSERP       BASE ERP WORKAREA                    05550002
         L     IOBRG,RQEIOB        BASE IOB                             05600002
         L     DECBRG,IOBECBPT     BASE DECB                            05650002
         L     DCBREG,IOBDCBPT     BASE DCB                             05700002
         L     ERREG1,CVTPTR       BASE CVT                    YM02594K 06100002
         USING CVTMAP,ERREG1                                   YM02594K 06150002
         L     ERREG1,CVTIXAVL     POINT TO IOCOM              YM02594K 06200002
         DROP  ERREG1                                          YM02594K 06250002
         USING IOCOM,ERREG1                                    YM02594K 06300002
         L     ERREG1,IOCTCCW      POINT TO TRANSLATE ROUTINE  YM02594K 06350002
         ST    ERREG1,EWAITRAN     SAVE FOR DURATION OF ERROR  YM02594K 06400002
         DROP  ERREG1                                          YM02594K 06450002
         CLI   IOSDVRID,IOSXCPID   EXCP I/O                             06460002
         BNE   BSCUET09            NO, GET OUT                          06470002
         CLI   EWAIND1,EWAILD00    DIRECT ENTRY FROM OTHER ERP YM05680K 06472002
         BE    ERRBSC1             YES                         YM05680K 06474002
         TM    IOSFLA,IOSERR       FIRST ENTRY                          06480002
         BO    NOTFIRST            NO                                   06490002
         XC    EWASTUP(L2),EWASTUP   CLEAR STAT UPDATE DATA AREA        06492002
         XC    EWAITCCW(L124),EWAITCCW   CLEAR EWA USER AREA            06494002
         MVC   EWAIOVST(L4),IOSVST   SAVE ADDRESS              YM02594K 06496002
*        ONE LINE OF CODE DELETED BY-------------------->      @ZA04681 06500000
         B     FIRST               BRANCH AROUND IOBCSW MAP             06550002
NOTFIRST EQU   *                                                        06600002
         L     CCWREG,IOSCC        LOAD CSW                    YM02594K 06650002
         LA    CCWREG,ZERO(CCWREG)   CLEAR OUT CONDITION CODE  YM02594K 06700002
*                                                                       06750000
*              ONE LINE DELETED FOR ----->                  LD @ZM00634 06760000
*                                                                       06770000
         LR    ERREG3,CCWREG       SET PARAMETER REG           YM02594K 06800002
         LR    ERREG1,IOSBREG      SAVE IOSB BASE              YM02594K 06850002
         DROP  IOSBREG                                         YM02594K 06900002
         TM    EWAIND0,EWAIPMAP    PARALLEL MAPPING DONE       YM02594K 06950002
         BNO   HISTCCW             NO                          YM02594K 07000002
         L     IOSBREG,EWAITCCW    BASE MY TCCW                YM02594K 07050002
         B     GOTRANS             GO TO TRANSLATOR            YM02594K 07100002
HISTCCW  EQU   *                                               YM02594K 07150002
         L     IOSBREG,RQETCCW     GET IOS TCCW                YM02594K 07200002
GOTRANS  EQU   *                                               YM02594K 07210000
         TM    RQETYPE,RQE1TO1     DOES V EQUAL R ?            @ZA04166 07220000
         BZ    GETLOCK             NO GO MAP IOBCSW            @ZA04166 07250000
         USING IOSB,ERREG1         SET IOSB ADDRESSIBLITY      @ZA04166 07260000
         MVC   IOBCSW(L7),IOSCSW  MOVE CSW FROM IOSB TO IOB    @ZA04166 07270000
         DROP  ERREG1                                          @ZA04166 07280000
         LR    IOSBREG,ERREG1   REINITILIZE IOSB REG           @ZA10030 07285000
         B     FIRST               BRANCH AROUND IOBCSW MAP    @ZA04166 07290000
         DROP  ERREG5                                          YM02594K 07300002
GETLOCK  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        *07310000
               RELATED=(ERP,IGE0004C(FREELOCK))             LD @ZA02815 07320000
         USING TCCW,IOSBREG                                    YM02594K 07350002
         MVI   TCCWOPTN,ZERO       CLEAR OUT OPTION FIELD      YM02594K 07400002
         OI    TCCWOPTN,TCCWCSWX   SET FOR CSW BACK TRANS      YM02594K 07450002
         L     ERREG5,EWAITRAN     POINT TO IECVTCCW           YM02594K 07500002
         BALR  ERRETR,ERREG5       GO TO TRANSLATOR            YM02594K 07550002
FREELOCK SETLOCK RELEASE,TYPE=LOCAL,                                   *07560000
               RELATED=(ERP,IGE0004C(GETLOCK))              LD @ZA02815 07570000
         LR    CCWREG,ERREG3       LOAD FOR LOAD ADDR          YM02594K 07600002
*              ONE LINE DELETED FOR ----->                  LD @ZM00634 07660000
         ST    CCWREG,EWAISAVE     SET CCW ADDRESS IN AREA     YM02594K 07700002
         MVC   IOBCMDA(L3),EWAISAVE+L1   MOVE TO CSW           YM02594K 07750002
         DROP  IOSBREG                                         YM02594K 07800002
         LR    IOSBREG,ERREG1      REBASE IOSB                 YM02594K 07850002
         USING IOSB,IOSBREG                                    YM02594K 07900002
         MVC   IOBSTBYT(L4),IOSTATUS   MOVE STATUS AND COUNT   YM02594K 07950002
FIRST    EQU   *                                                        08000002
         MVC   IOBSENS0(L2),IOSSNS   MOVE SENSE IOSB TO IOB             08050002
         MVC   IOBSIOCC(L1),IOSCC   MOVE SIO CC IOSB TO IOB             08100002
         MVC   IOBECBCC(L1),IOSCOD   MOVE ECB CC IOSB TO IOB            08150002
ERRBSC1  EQU   *                                                        08200002
         OI    IOSFLA,IOSEX        INSURE FLAG IS ON                    08250002
         OI    IOBFLAG1,IOBIOERR   ALSO IN IOB                          08300002
         SR    ERREG6,ERREG6       CLEAR WORK REGISTER                  08350002
         LA    ERREG2,ERRRTCON     SET UP FOR INDEXING                  08400002
         SR    ERREG1,ERREG1       CLEAR LINKAGE REGISTER               08450002
         SR    ERREG4,ERREG4       ZERO ERROR IN CONTROL                08500002
         TM    DCBOFLGS,X11        IS CLOSE IN PROCESS                  08550002
         BO    BSCCT025            IF SO, BRANCH                        08600002
         TM    IOBCSW+L4,CSWCCK    CHAN OR INTERFACE CTL CHECK          08650002
         BZ    NOTCHAN             NO CONTINUE                 @ZA31667 08700000
         BCT   ERREG1,BSCCT016     SUBTRACT 1 FROM REG 9       @ZA31667 08710000
NOTCHAN  L     CCWREG,IOBFL3       ADDRESS OF CCW              @ZA31667 08750000
         LA    CCWREG,ZERO(CCWREG)   CLEAR HI ORDER BYTE                08800002
         SH    CCWREG,ERRCN8       ADJUST TO FAILING CCW                08850002
         OI    IOSFLB,IOSMSG       INDICATE I/O ERR TO MSG WT           08900002
         MVC   IOBWORK(L1),TPOPCODE(CCWREG)   SETUP WORK AREA           08950002
         NI    IOBWORK,L255-HIBIT  CLEAR UNUSED BITS                    09000002
         CLI   DECTYPE+1,RDINIT    READ INITIAL ?              @ZA28893 09001000
         BNE   ERRESTPL            NO, BRANCH                  @ZA28893 09002000
         TM    IOBFLAG2,RESETPL    RESETPL ISSUED ?            @ZA28893 09003000
         BNO   ERRESTPL            NO, BRANCH                  @ZA28893 09004000
         MVI   IOBERRCT,ERRMAXCT   SET RETRY TO MAX            @ZA28893 09005000
ERRESTPL EQU   *                                               @ZA28893 09006000
         TM    IOSFLA,IOSERR       ERP ROUTINE IN CONTROL               09050002
         BNO   BSCSAVE             NO,  SAVE SENSE, CSW INFO            09100002
         TM    IOBCSW+L3,CSWUCK    UNIT CHECK OCCUR                     09150002
         BO    BSCCT003            YES CONTINUE FLOW                    09200002
         STH   ERREG6,IOBSENS0     CLEAR SENSE INFO                     09250002
BSCCT003 EQU   *                                                        09300002
         IC    ERREG6,IOBERRCT+L1  BRANCH OFFSET TO LOADS               09350002
         LTR   ERREG6,ERREG6       ERROR RETURN                         09400002
         BP    BSCCT008(ERREG6)    YES, GO THERE                        09450002
         CLI   L5(CCWREG),ZERO     ANY TP OP CODE                       09500002
         BNE   BSCCT002            YES                                  09550002
         TM    IOBCSW+L3,XF3       ANYTHING OTHER THAN CE/DE            09600002
         BNZ   BSCCT002            YES                                  09650002
         TM    IOBCSW+L3,CSWCDE    CHECK FOR BOTH CE AND DE             09700002
         BO    SETMAX              IF BOTH ON SET MAX RETRY             09750002
BSCCT002 OI    IOSFLA,IOSEX+IOSERR   INDICATE ERP IN CONTROL            09800002
         OI    IOBFLAG1,IOBERRTN+IOBIOERR   ALSO IN IOB                 09850002
         CLC   IOSSNS(L2),SCC3SNS   SIO CC3 SENSE                       09900002
         BNE   NOSIOCC3            NO                                   09950002
         TM    IOSCC,IOSCC3        SIO CC 3                    @ZA09345 10000000
         BO    BSCCT005            YES, BRANCH                 @ZA09345 10050000
NOSIOCC3 EQU   *                                                        10100002
         TM    IOSCC,IOSCC1        SIO COND CODE 1                      10150002
         BO    BSCCT016            YES                                  10200002
         TM    IOBCSW+L3,CSWASCB   ATTEN, STATUS MOD, CONTROL UNIT END  10250002
*                                  OR BUSY INDICATED                    10300002
         BNZ   BSCCT008            YES, SNO & ERROR POST                10350002
         TM    IOSTSA,CSWUCK       UNIT CHECK                           10400002
         BO    BSCCT009            YES                                  10450002
         TM    IOSTSB,CSWCHAIN     CHAINING CHECK                       10500002
         BO    BSCS001             YES                                  10550002
         TM    IOSTSB,CSWPROG      PROGRAM CHECK                        10600002
         BO    BSCS001             YES                                  10650002
         TM    IOSTSB,CSWPROT      PROTECTION CHECK                     10700002
         BO    BSCS001             YES                                  10750002
         TM    IOSTSA,CSWUNITE     UNIT EXCEPTION                       10800002
         BO    BSCUE0AA            YES                                  10850002
         TM    IOSTSB,CSWCDC       CHANNEL DATA CHECK                   10900002
         BO    BSCCT016            YES                                  10950002
BSCS002  LTR   ERREG4,ERREG4       FIRST TIME THRU ERP (SET BY BSCSAVE) 11000002
         BZ    BSCCT004            NO, POST  NORMAL RETURN              11050002
         OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR                 11100002
BSCS001  OI    IOSFLB,IOSLOG       INDICATE OBR RECORDING               11150002
         B     BSCCT022            LINK TO ERROR POST                   11200002
SETMAX   MVI   IOBERRCT,ERRMAXCT   SET RETRY TO MAX                     11250002
         OI    DECERRST,DECSNO     SET SHOULD NOT OCCUR                 11300002
         B     BSCCT022            LINK TO ERROR POST                   11350002
BSCCT025 NI    IOSFLA,L255-IOSERR  TURN OFF IOB EXCEPTION               11400002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     11450002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 11460002
         B     RETRY               ERROR EXCP                           11500002
BSCCT004 NI    IOSFLA,L255-IOSEX-IOSERR   TURN OFF ERP CONTROL INDS.    11550002
         NI    IOBFLAG1,L255-IOBERRTN-IOBIOERR   ALSO IN IOB            11600002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 11602002
         NI    EWASTUP,FIRSTBIT    TEST AND SET X'80'                   11610002
         BZ    RETRY               NO, POST COMPLETE                    11620002
         MVI   IOBSENS0,ZERO                                            11650002
         OI    IOSFLB,IOSLOG       SET LOGOUT REQUIRED                  11700002
         MVI   EWAIND1,EWAISTAT    STAT UPDATE EXIT            YM05652K 11710002
RETRY    EQU   *                                                        11750002
         L     NAMEREG,TRANSRTN    LOAD NAME FOR 904B          YM02594K 11800002
         B     XCTLOUT             XCTL                                 11850002
BSCSAVE  MVC   IOBERCCW+L16(L1),IOBSENS0   MOVE SENSE INFO TO AREA      11900002
         MVC   IOBERCCW+L17(L7),IOBCSW   MOVE CSW TO AREA               11950002
         XC    IOBWORK+L1(L3),IOBWORK+L1   CLEAR WORK AREA              12000002
         XC    IOBERCCW(L8),IOBERCCW   CLEAR ERP CCW AREA               12050002
         LR    ERREG4,IOBRG                                             12100002
         B     BSCCT002            SET ERP IN CONTROL                   12150002
BSCCT005 EQU   *                                              LD YM8278 12160000
         L     ERREG2,IOSUCB       GET ADDR OF UCB            LD YM8278 12190000
         LA    ERREG2,ZERO(ERREG2) CLEAR HIGH ORDER BYTE      LD YM8278 12192000
         LR    ERREG1,IOSBREG      SAVE IOSB ADDR             LD YM8278 12194000
         MVC   EWAIEXIT(L16),EXITADDR MOVE ESTAE LIST         LD YM8278 12196000
         LA    PARMREG,EWAIEXIT    POINT TO ESTAE LIST        LD YM8278 12196400
         ESTAE MF=(E,(1))          SETUP RECOVERY RTN         LD YM8278 12196800
         L     ERREG3,SAVE         SUBPOOL AND LENGTH         LD YM8278 12197200
*                                  GET STORAGE FOR PARM WORD  LD YM8278 12197600
         GETMAIN R,LV=(0)          AND SAVEAREA               LD YM8278 12198000
         LA    NAMEREG,L4(PARMREG) ADDRESS OF SAVEAREA        LD YM8278 12198400
         ST    ERREG2,ZERO(PARMREG) INITIALIZE PARM WORD      LD YM8278 12198600
         LINK  EPLOC=IECVIOPM      LINK TO CHECK ALT PATH      @ZA09351 12207700
*                                            ALT. PATH                  12215700
         LR    ERREG4,ERREG5       SAVE RETURN CODE           LD YM8278 12226600
*                                  FREE STORAGE FOR PARM      LD YM8278 12227000
         L     ERREG3,SAVE         SUBPOOL AND LENGTH         LD YM8278 12227400
         FREEMAIN R,LV=(0),A=(1)   AND SAVEAREA               LD YM8278 12228600
         ESTAE 0                   CLEAR OUT RECOVERY RTN      @ZA04868 12230600
         LR    IOSBREG,ERREG1      RESTORE IOSB REG           LD YM8278 12232600
         LTR   ERREG4,ERREG4       CHECK FOR 0 RTN CODE       LD YM8278 12233000
         BZ    RETRY               RC=0, RETRY ON NEW PATH    LD YM8278 12233100
         LH    NAMEREG,ERLOD16     INT REQ MSG WRITER ADDRESS           12233300
         B     XCTLOUT             LINK TO MSG WRITER                   12250002
BSCCT009 TM    IOBCSW+L3,CSWCDE    BOTH CHAN AND DEV END OFF            12300002
         BZ    BSCCT016            INITIAL SELECTION                    12350002
BSCCT012 EQU   *                                                        12400002
         L     ERREG5,CVTPTR       POINT TO CVT                         12450002
         USING CVTMAP,ERREG5                                            12500002
         L     ERREG5,CVTXITP      POINT TO INTERPRETER                 12550002
         DROP  ERREG5                                                   12600002
BSCCT014 BALR  ERRETR,ERREG5       EXIT TO INTERPRETER RTNE             12650002
         DC    X'03'                         EQUIPMENT CHECK            12700002
         DC    AL1(BSCCT016-BSCCT014-2)                                 12750002
         DC    X'06'                         LOST DATA                  12800002
         DC    AL1(BSCCT018-BSCCT014-4)                                 12850002
         DC    X'07'                         TIME OUT                   12900002
         DC    AL1(BSCCT020-BSCCT014-6)                                 12950002
         DC    X'01'                         INTERVENTION REQUIRED      13000002
         DC    AL1(BSCCT021-BSCCT014-8)                                 13050002
         DC    X'02'                         BUS-OUT CHECK              13100002
         DC    AL1(BSCCT017-BSCCT014-10)                                13150002
         DC    X'04'                         DATA CHECK                 13200002
         DC    AL1(BSCCT023-BSCCT014-12)                                13250002
         DC    X'05'                         OVERRUN                    13300002
         DC    AL1(BSCCT017-BSCCT014-14)                                13350002
         DC    X'00'                         COMMAND REJECT             13400002
         DC    AL1(BSCCT016-BSCCT014-16)                                13450002
         DC    X'2F'                         END OF TEST                13500002
         DC    AL1(BSCCT008-BSCCT014-18)                                13550002
BSCCT008 OI    DECERRST,CSWSNO     SET SHOULD NOT OCCUR ERR             13600002
BSCCT016 AR    ERREG1,ERREG2       ENTRY EQUIP CHECK                    13650002
BSCCT017 AR    ERREG1,ERREG2       ENTRY BUSOUT OVERRUN                 13700002
BSCCT018 AR    ERREG1,ERREG2       ENTRY LOST DATA                      13750002
         NOP   ZERO                NO OPERATION INSTRUCTION   LD YM7711 13760000
         OC    EWASTUP(L1),IOBSENS0   SET FOR STAT UPDATE               13800002
BSCCT019 AR    ERREG1,ERREG2       ENTRY SPEC RETURN                    13850002
BSCCT020 AR    ERREG1,ERREG2       ENTRY 2ND LOAD T/O RTN               13900002
BSCCT021 AR    ERREG1,ERREG2       ENTRY INTERVENTION REQ               13950002
BSCCT022 AR    ERREG1,ERREG2       ENTRY ERROR POST                     14000002
BSCCT023 LA    NAMEREG,BSCLOD1(ERREG1)  ENTRY DATA CHECK                14050002
         B     XCTLOUT             LINK TO NEXT ERP MODULE              14100002
BSCUE0AA CLI   ZERO(CCWREG),CCWREAD   IS THIS READ OPERATION            14150002
         BNE   BSCUE0TP            NO                                   14200002
         LTR   ERREG4,ERREG4       FIRST TIME THRU ERP                  14250002
         BZ    BSCEREAD            NO, CHECK TP-OP CODE                 14300002
         CLI   IOBWORK,X11         READ TEXT                            14350002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              14400002
         LH    ERREG4,L6(CCWREG)   PICK UP ORIG CT                      14450002
         BCTR  ERREG4,ZERO         SUBTRACT ONE                         14500002
         CH    ERREG4,IOBCSW+L5    THIS COUNT = RESIDUAL COUNT          14550002
         BNE   CHKSOHR             NO, CHK FOR SOH%R MSG                14600002
         L     ERREG4,ZERO(CCWREG)   ENQ POINTER                        14650002
         CLC   ZERO(L1,ERREG4),DCBBSENQ   ENQ RECEIVED                  14700002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              14750002
         TM    DCBBFTEK,DYNBUF     DYNAMIC BUFFER                       14800002
         BO    BSCUET09            YES, POST WITH ERROR                 14850002
         CLI   DECTYPE+L1,X13      RD CONT/GRAPHICS                     14900002
         BE    BSCUETAB            YES, BRANCH                          14950002
         CLI   DECTYPE+L1,X17      RD REPEAT/GRAPHICS                   15000002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              15050002
BSCUETAB SH    CCWREG,ERRCN16      BACK UP TO WR GRAPHICS               15100002
         B     BSCUETA7            BRANCH TO EXECUTE                    15150002
CHKSOHR  L     ERREG4,IOBERINF     GET ADDR OF INPUT AREA               15200002
         TM    DCBXCODE,ASCII      IS IT ASCII XMISSION CODE            15250002
         BO    USEASCII            YES, TEST FOR SOH%R IN ASCII         15300002
         CLC   ZERO(SOHRLNG,ERREG4),EBCSOHR   IS IT AN EBCDIC SOH%R     15350002
*                                  MESSAGE                              15400002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              15450002
         ST    ERREG4,IOBERINF     SAVE ADDR OF SOH%R MSG               15500002
         B     XFERCTL             YES, SET UP TO TRANSFER              15550002
*                                  CONTROL TO ERROR POST                15600002
USEASCII CLC   ZERO(SOHRLNG,ERREG4),ASCSOHR   IS IT ASCII SOH%R MSG     15650002
         BNE   BSCUE0A1            NO, LOAD UNIT EXCEPTION              15700002
XFERCTL  L     NAMEREG,LOAD3270    LOAD ADDR OF 3270 ERROR POST         15750002
         B     XCTLOUT             EXIT VIA XCTL ROUTINE                15800002
BSCUE0A1 L     NAMEREG,ERLOD904                                         15850002
         B     XCTLOUT                                                  15900002
BSCUE0TP CLI   IOBWORK,TPOPERP     THIS ERP WR CCW                      15950002
         BNE   BSCUE0A1            NO, GO TO UNIT EXCEPTION             16000002
         L     ERREG4,ZERO(CCWREG)   GET WR CHAR                        16050002
         CLC   ZERO(L1,ERREG4),DCBBSENQ   IS THIS ERP WR ENQ            16100002
         BNE   BSCUE02G            CHECK FOR NAK                        16150002
         MVI   IOBWORK+L1,RTRNCD3   SET SP RETURN                       16200002
         B     BSCUET2A            COMPLETE RD SKIP CHAN PROG           16250002
BSCUE02G CLC   ZERO(L1,ERREG4),DCBBSNAK   IS THIS ERP WR NAK            16300002
         BNE   BSCUE0A1            NO, GO TO UNIT EXCEPTION             16350002
         MVI   IOBWORK+L1,RTRNCD8   SET SP RETURN              @ZA24270 16400000
BSCUET2A LA    ERREG5,CCWNOP       SET 2ND COMMAND FOR NO-OP            16450002
BSCUE02B LA    ERREG2,IOBWORK+L2   DATA ADDRESS                         16500002
         LA    ERREG4,CCWREAD      SET FIRST COMMAND FOR READ           16550002
BSCUET04 EQU   *                                                        16600002
BSCUET05 ST    ERREG2,IOBERCCW     STORE DATA ADDR IN CHAN PROG         16650002
         STC   ERREG4,IOBERCCW     STORE COMMAND IN 1ST CCW             16700002
BSCUET06 ST    ERREG4,IOBERCCW+L4   PUT COUNT IN CCW                    16750002
         CLI   IOBWORK+L1,ZERO                                          16800002
         BE    BSCUETA6                                                 16850002
         MVI   IOBERRCT+L1,RTRNSPCD                                     16900002
BSCUETA6 EQU   *                                                        16950002
         CLI   IOBWORK+L1,RTRNCD8   SPEC RETURN OF 88          @ZA24270 17000000
         BNE   BSCUE02H            BRANCH IF NOT                        17050002
BSCUE02J MVI   IOBERCCW+L4,X70     COM CH, SLI, SKIP                    17100002
         B     BSCUE02F                                                 17150002
BSCUE02H CLI   IOBWORK+L1,RTRNCD3   SPEC RETURN OF 83                   17200002
         BE    BSCUE02J            BRANCH IF YES                        17250002
         ST    CCWREG,IOBERCCW+L8   STORE TIC ADDR                      17300002
         MVI   IOBERCCW+L4,CHAINCDE   COM CH, SLI                       17350002
BSCUE02F STC   ERREG5,IOBERCCW+L8   STORE COMMAND IN 2ND CCW            17400002
         ST    ERREG4,IOBERCCW+L12   PUT COUNT IN CCW                   17450002
         LA    CCWREG,IOBERCCW     ADDR OF NEW CHAN PROG                17550002
         B     BSCUETA7            RETRY ERROR                          17600002
BSCEREAD EQU   *                                                        17650002
         CLI   L5(CCWREG),ZERO     IS THIS ERP CCW                      17700002
         BNE   BSCCT004            NO, POST NORMAL                      17750002
         L     CCWREG,IOBERCCW+L8   ADDRESS FAILING CCW                 17800002
BSCUETA7 ST    CCWREG,IOBSTART                                          17900002
BSCUET08 CLI   IOBERRCT,ERRMAXCT   RETRIES EXHAUSTED                    18050002
         BNL   BSCUET09            YES SET PERM ERROR                   18100002
         IC    ERREG1,IOBERRCT     PICK UP RETRY COUNT                  18150002
         LA    ERREG1,L1(ERREG1)   BUMP BY ONE                          18200002
         STC   ERREG1,IOBERRCT     RESTORE NEW COUNT                    18250002
         MVI   EWAIND1,EWAISVCF    SVC 15                      YM05652K 18260002
         B     RETRY               SET FOR EXIT                         18300002
BSCUET09 NI    IOSFLA,L255-IOSERR   INDICATE PERM ERROR                 18350002
         NI    IOBFLAG1,L255-IOBERRTN   ALSO IN IOB                     18400002
BSCUET0A LA    NAMEREG,BSCLOD2     ADDRESS OF ERROR POST                18450002
XCTLOUT  EQU   *                                                        18500002
         L     ERRETR,CVTPTR       POINT TO CVT                         18550002
         USING CVTMAP,ERRETR                                            18600002
         L     ERRETR,CVTXTLER     POINT TO XCTL ROUITNE                18650002
         DROP  ERRETR                                                   18700002
         BR    ERRETR              EXIT VIA XCTL ROUTINE                18750002
         EJECT                                                          18752000
**********                                                    LD YM8278 18760000
*                                                             LD YM8278 18770000
*        ESTAE EXIT ROUTINE                                   LD YM8278 18780000
*                                                             LD YM8278 18790000
**********                                                    LD YM8278 18792000
         SPACE 2                                                        18794000
EXITRTN  EQU   *                                              LD YM8278 18796000
         DROP  BASEREG                                        LD YM8278 18798000
         BALR  BASEREG,ZERO                                   LD YM8278 18798400
         USING *,BASEREG           ROUTINE ADDRESSABILITY     LD YM8278 18798800
*              PROCEED WITH ABEND                             LD YM8278 18799200
         SETRP                                                LD YM8278 18799600
         BR    ERRETR              RETURN TO TASK RECOVERY    LD YM8278 18799700
         EJECT                                                          18800002
**********                                                              18850002
*                                                                       18900002
*        CONSTANTS                                                      18950002
*                                                                       19000002
**********                                                              19050002
         SPACE 2                                                        19060000
EXITADDR ESTAE EXITRTN,MF=L                                   LD YM8278 19070000
         SPACE 2                                                        19080000
TRANSRTN DC    F'9042'             NAME OF BTAM TRANSLATE ROUTINE       19100002
ERLOD904 DC    F'9043'                                                  19150002
LOAD3270 DC    F'7042'             3270 ERROR POST IDENT                19200002
ERRCN16  DC    H'16'                                                    19250002
ERRCN8   DC    H'8'                                                     19300002
ERLOD16  DC    H'6042'             WTOR ERP I.D.                        19350002
SCC3SNS  DC    X'10FE'             SPECIAL SENSE FOR SIOCC=3            19400002
EBCSOHR  DC    X'016CD9'           SOH%R SEQUENCE - EBCDIC              19450002
ASCSOHR  DC    X'012552'           SOH%R SEQUENCE - ASCII               19500002
         DS    0F                                                       19510000
SAVE     DC    X'FF00004C'         SUBPOOL 255 AND LENGTH     LD YM8278 19520000
IECVIOPM DC    C'IECVIOPM'                                    LD YM8278 19530000
PACHAREA DC    25C'004C'           PATCH AREA FOR MAINTENANCE           19550002
**********                                                              19600002
*                                                                       19650002
*        MISCELLANEOUS EQUATES                                          19700002
*                                                                       19750002
**********                                                              19800002
DYNBUF   EQU   X'08'               DYNAMIC BUFFERING                    19850002
DECSNO   EQU   X'40'               SHOULD NOT OCCUR FLAG                19900002
L255     EQU   X'FF'               AND MASK                             19950002
BSCLOD1  EQU   1043                BSC ERP BASE IDENT                   20000002
BSCLOD2  EQU   2043                BSC ERROR POST IDENT                 20050002
CSWCHAIN EQU   X'01'               CHAINING CHECK                       20100002
CSWPROG  EQU   X'20'               PROGRAM CHECK                        20150002
CSWPROT  EQU   X'10'               PROTECTION CHECK                     20200002
CSWUNITE EQU   X'01'               UNIT EXCEPTION                       20250002
CSWCDC   EQU   X'08'               CHANNEL DATA CHECK                   20300002
CSWASCB  EQU   X'F0'               ATTEN,STATUS,CTL UNIT,BUSY           20350002
CSWCCK   EQU   6                   CHAN CTL AND INTF CTL CHECK          20400002
CCWREAD  EQU   2                                                        20450002
RESETPL  EQU   X'01'                                           @ZA28893 20453000
RDINIT   EQU   X'01'                                           @ZA28893 20456000
CSWCDE   EQU   X'0C'               CHANNEL AND DEVICE END               20500002
CSWSNO   EQU   X'40'               SHOULD NOT OCCUR                     20550002
CSWUCK   EQU   X'02'               UNIT CHECK                           20600002
ERRRTCON EQU   1000                ERP LOAD MODULE INCREMENT            20650002
SIOCODE1 EQU   X'10'               START I/O CODE 1                     20700002
ZERO     EQU   X'00'               LENGTH AND DISPLACEMENT              20750002
L1       EQU   1                   LENGTH AND DISPLACEMENT              20800002
L2       EQU   2                   LENGTH AND DISPLACEMENT              20850002
L3       EQU   3                   LENGTH AND DISPLACEMENT              20900002
L4       EQU   4                   LENGTH AND DISPLACEMENT              20950002
L5       EQU   5                   LENGTH AND DISPLACEMENT              21000002
L6       EQU   6                   LENGTH AND DISPLACEMENT              21050002
L7       EQU   7                   LENGTH AND DISPLACEMENT              21100002
L8       EQU   8                   LENGTH AND DISPLACEMENT              21150002
L12      EQU   12                  LENGTH AND DISPLACEMENT              21200002
L16      EQU   16                  LENGTH AND DISPLACEMENT              21250002
L17      EQU   17                  LENGTH AND DISPLACEMENT              21300002
L124     EQU   124                 LENGTH AND DISPLACEMENT              21350002
XF3      EQU   X'F3'               ANYTHING OTHER THAN CE/DE            21400002
X11      EQU   X'11'               CLOSE FLAG                           21450002
X13      EQU   X'13'               READ CONTINUE/GRAPHICS               21500002
X17      EQU   X'17'               READ REPEAT/GRAPHICS                 21550002
X70      EQU   X'70'               ERROR CCW FLAGS                      21600002
CCWNOP   EQU   3                                                        21650002
CHAINCDE EQU   X'60'                                                    21700002
RTRNSPCD EQU   X'14'                                                    21750002
RTRNCD3  EQU   X'83'                                                    21800002
RTRNCD8  EQU   X'88'                                           @ZA24270 21850000
TPOPERP  EQU   X'00'                                                    21900002
WLR      EQU   X'40'               SLI FLAG                             21950002
TPOPCODE EQU   5                                                        22000002
HIBIT    EQU   X'C0'                                                    22050002
ERRMAXCT EQU   X'07'                                                    22100002
ASCII    EQU   X'14'               BIT SETTING FOR ASCII                22150002
FIRSTBIT EQU   X'7F'               FIRST BIT OF EWASTUP                 22160002
SOHRLNG  EQU   3                   3 CHARS ARE NEEDED TO RECOGNIZE      22200002
*                                  SOH%R MSG                            22250002
**********                                                              22300002
*                                                                       22350002
*        REGISTER DEFINITIONS                                           22400002
*                                                                       22450002
**********                                                              22500002
ERREG3   EQU   0                   WORK REG                             22550002
IOSBREG  EQU   1                   IOSB BASE/PARAMETER REG              22600002
PARMREG  EQU   IOSBREG             PARM REG FOR IECVIOPM      LD YM8278 22610000
ERREG2   EQU   2                   WORK REG                             22650002
ERREG4   EQU   3                   WORK REG                             22700002
CCWREG   EQU   4                   CCW ADDRESS REG                      22750002
DECBRG   EQU   5                   DECB BASE                            22800002
DCBREG   EQU   6                   DCB BASE                             22850002
EWAREG   EQU   7                   ERP WORKAREA BASE                    22900002
BASEREG  EQU   8                   PROGRAM BASE                         22950002
ERREG1   EQU   9                   WORK REG                             23000002
IOBRG    EQU   10                  IOB BASE                             23050002
ERREG6   EQU   11                  WORK REG                             23100002
ERRLNK   EQU   12                  LINK REG                             23150002
NAMEREG  EQU   13                  LINK REG                             23200002
ERRETR   EQU   14                  LINK REG                             23250002
ERREG5   EQU   15                  LINK REG/WORK REG                    23300002
         EJECT                                                          23350002
         IECTDECB                                                       23400002
         EJECT                                                          23450002
         DCBD  DSORG=BX,DEVD=BS              DCB DESECT MACRO           23500002
         EJECT                                                          23550002
         IECDRQE                                                        23600002
         EJECT                                                          23650002
         IEZIOB                                                         23700002
         EJECT                                                          23750002
CVT      DSECT                                                          23800002
         CVT                                                            23850002
         EJECT                                                          23900002
         IECDERWA                                                       23950002
**********                                                              24000002
*                                                                       24050002
*        THE FOLLOWING DEFINITIONS ARE LOCAL FOR BTAM ERPS ONLY.        24100002
*                                                                       24150002
**********                                                              24200002
         ORG   EWAIERP                                                  24250002
EWAITRAN DS    F                   ADDRESS OF IECVTCCW         YM02594K 24300002
EWAITCCW DS    F                   PARALLEL TCCW               YM02594K 24350002
EWAIOVST DS    F                   ORIGINAL IOSVST CONTENTS    YM02594K 24400002
EWAIND0  DS    B                   FLAG BYTE                            24450002
EWAIVISR EQU   X'10'               V=R REQUEST                          25050002
EWAIPMAP EQU   X'08'               PARALLEL MAPPING DONE       YM02594K 25100002
EWAIGPRO EQU   X'04'               GETMAIN IN PROCESS          YM02594K 25150002
EWAIFPRO EQU   X'02'               FREEMAIN IN PROCESS         YM02594K 25200002
EWAIND1  DS    B                   FLAG BYTE                            25250002
EWAILD00 EQU   X'80'               EXIT TO 004C                YM02594K 25300002
EWAILD15 EQU   X'40'               EXIT TO LOAD 15             YM02594K 25350002
EWAIWTOL EQU   X'20'               EXIT TO IOS WTO             YM02594K 25400002
EWAISTAT EQU   X'10'               EXIT TO STAT UPDATE         YM05652K 25410002
EWAISVCF EQU   X'08'               SVC 15/SVC 3                YM05652K 25420002
EWAIND2  DS    B                   FLAG BYTE                            25450002
EWAIND3  DS    B                   FLAG BYTE                            25500002
EWAIAREA DS    20F                 SAVE AREA FOR MA OR AREA FOR WTO     25550002
EWAISAVE DS    2F                  TEMPORARY SAVE AREA                  25600002
EWAIEXIT DS    4F                  ESATE PARAMETER LIST                 25650002
*********  END OF BTAM LOCAL DEFINITIONS **********                     25700002
         EJECT                                                          25750002
         IHAPSA                                                         25760000
         EJECT                                                          25770000
         IECDTCCW                                                       25800002
         EJECT                                                          25850002
         IECDIOCM                                                       25900002
         EJECT                                                          25950002
         IECDIOSB                                                       26000002
         EJECT                                                          26010000
         IHASDWA                                                        26020000
         END                                                            26050002
