004H     TITLE ' IGE0004H - TCAM/EXCP BSC ERP CONTROL MODULE '          00100010
IGE0004H CSECT                                                          00200010
*A000000-999999                                                @Y02X6E0 00202010
*CHANGE ACTIVITY= AS FOLLOWS:                                    S21903 00205010
*A312050-312100,440300-440600,450500                             S22026 00210010
*D545000                                                         S22026 00220010
*C312000                                                         A42406 00250010
*A116000,137000,144000,151000,552000                             S21903 00252010
*C327000,414000,461000                                           S21903 00254010
*D139000,261000,295000,306000,416000,425000-427000,430000-431000 S21903 00256010
*D437000-438000,464000-465000,486000,488000-489000,491000-492000 S21903 00258010
*D495000,498000,503000,511000-512000,524000-527000,530000-531000 S21903 00260010
*D534000,536000-537000,541000,545000                             S21903 00262010
*C204000,223000,382000,465000,466000,471000,472000               S22025 00270010
*C402500                                                        SA58994 00280010
*C007000,332000                                                @Z30AAEE 00280110
*A144796-144814,308200-311800,552030                           @ZA00227 00286010
*D144850                                                       @ZA00227 00292010
*A151000                                                       @SA72456 00296010
*A144770                                                       @ZA02622 00297010
*A326000                                                       @ZA02613 00298010
*A232000                                                       @SA74968 00299010
*C316000                                                       @OS76278 00299110
*C232000-232800                                                @OY12439 00299210
*A194000                                                       @OY14057 00299310
* A120000,129500,135100,144060,144240,144330                   @G36XREV 00299410
* C002020,007000,144180,144300                                 @G36XREV 00299510
* D142230,144030,144270,144796                                 @G36XREV 00299610
*A313800                                                       @OY18043 00299810
*                                                                     * 00300010
*********************************************************************** 00400010
*                                                                S21903 00500010
*MODULE-NAME= IGE0004H                                           S21903 00510010
*                                                                S21903 00520010
*DESCRIPTIVE-NAME= TCAM BSC ERROR RECOVERY (FIRST LOAD)          S21903 00530010
*                                                                S21903 00540010
*COPYRIGHT= 'NONE'                                               S21903 00550010
*                                                                     * 00600010
*STATUS -- CHANGE LEVEL 10                                     @G36XREV 00700010
*                                                                     * 00800010
*FUNCTION -- ALL ERP MLDULES ATTEMPT TO RECOVER FROM ALL ERRORS.      * 00900010
*   CERTAIN TEXT ERRORS REQUIRE RETURN TO LINE END TO SCHEDULE A      * 01000010
*   SUBSEQUENT RECALL OPERATION.                                      * 01100010
*                                                                     * 01200010
*ENTRY POINTS -- FIRST EXECUTABLE INSTRUCTION.                        * 01300010
*                                                                     * 01400010
*INPUT --                                                             * 01500010
*   R1 - POINTER TO I/O SUPERVISOR BLOCK                         Y02027 01600010
*   R15 - ENTRY POINT ADDRESS                                         * 01700010
*                                                                     * 01800010
*OUTPUT -- R1 POINTS TO I/O SUPERVISOR BLOCK                     Y02027 01900010
*                                                                     * 02000010
*EXTERNAL ROUTINES -- NONE                                            * 02100010
*                                                                     * 02200010
*EXITS-NORMAL -- R1 POINTS TO I/O SUPERVISOR BLOCK               Y02027 02300010
*        SVC   15   'ERP IN CONTROL (IOSERR)' AND 'EXCEPTIONAL   Y02027 02360010
*                CONDITION(IOSEX)'. RETURN TO IOS TO RETRY THE   Y02027 02420010
*                   ERROR.                                       Y02027 02480010
*        SVC   15   'NO ERROR FLAGS'. RETURN TO LINE END         Y02027 02540010
*                   APPENDAGE. ERROR CLEARED                     Y02027 02600010
*EXITS-ERROR -- R1 POINTS TO I/O SUPERVISOR BLOCK                Y02027 02660010
*        SVC   15   'EXCEPTIONAL CONDITION(IOSEX)'. RETURN TO    Y02027 02720010
*                   LINE END APPENDAGE. ERROR PERMANENT.         Y02027 02780010
*                                                                     * 02900010
*   TO SCHEDULE NEXT LOAD OF ERP                                      * 03000010
*        L     13,DECIMAL VALUE OF NEXT LOAD                          * 03100010
*        L   14,X'10'    CVT ADDRESS                                  * 03200010
*        L     14,X'2C'(14)    ADDRESS OF XCTL ROUTINE                * 03300010
*        BR    14   EXIT TO XCTL                                      * 03400010
*                                                                     * 03500010
*EXITS-ERROR -- R1 POINTS TO REQUEST ELEMENT                          * 03600010
*        SVC   15  LCBFLAG1 X'C6'                                     * 03700010
*        SVC   3                                                      * 03800010
*                                                                     * 03900010
*        L     13,DECIMAL VALUE OF NEXT LOAD                          * 04000010
*        L   14,X'10'    CVT ADDRESS                                  * 04100010
*        L     14,X'2C'(14)    ADDRESS OF XCTL ROUTINE                * 04200010
*        BR    14   EXIT TO XCTL                                      * 04300010
*                                                                     * 04400010
*   TO SCHEDULE ERROR POST                                            * 04500010
*                                                                     * 04600010
*TABLES/WORK AREAS --                                                 * 04700010
*   TAVTD                                                             * 04800010
*   TTRMD                                                             * 04900010
*   TCCWD                                                             * 05000010
*   TLCBD                                                             * 05100010
*   DCBD                                                              * 05200010
*   TSCBD                                                             * 05300010
*                                                                     * 05400010
*ATTRIBUTES -- SERIALLY REUSABLE, REFRESHABLE, SUPERVISOR KEY,   Y02027 05500010
*              SUPERVISOR MODE, ENABLED                          Y02027 05550010
*                                                                     * 05600010
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 05700010
*   PARTICUALR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER      * 05800010
*   SET.                                                              * 05900010
*                                                                     * 06000010
*   R1 REMAINS TRANSPARENT TO ALL LOADS OF ERP.                       * 06100010
*                                                                     * 06200010
*   EXIT FROM ERP IS MADE WHENEVER THE RETRY COUNT IS EXHAUSTED, OR   * 06300010
*   A SHOULD NOT OCCUR ERROR IS PRESETNED.  TEXT ERRORS NOT           * 06400010
*   RECOVERABLE BY ERP ARE POSTED TO LINE END APPENDAGE WITH ERROR    * 06500010
*   (VIA SVC 15).                                                     * 06600010
*                                                                     * 06700010
*   IF ANOTHER ERP LOAD IS PERFORMING INTERMITTENT ERP RECOVERY, EXIT * 06800010
*   IS MADE TO THE SPECIAL RETURN ERP LOADS.  THIS IS INDICATED BY A  * 06900010
*   NON-ZERO VALUE IN LCBINCAM+1.  RETRY COUNT IS MAINTAINED IN       * 07000010
*   LCBINCAM.                                                         * 07100010
*                                                                     * 07200010
*   ON FIRST OCCURRENCE OF AN ERROR, THE CSW, SENSE BYTE, AND TP OP   * 07300010
*   CODE ARE SAVED IN LCBCSWSV, LCBSENS1, AND LCBRESTR+1              * 07400010
*   RESPECTIVELY.  IF THE ERROR IS CLEARED THROUGH ERP ACTION, THE    * 07500010
*   TEMPORARY ERROR COUNTER IN THE TERMINAL ENTRY IS UPDATED.  FOR    * 07600010
*   2740/2, THE LEADING GRAPHIC RESPONSE IS SAVED IN LCBSENS1.        * 07700010
*                                                                     * 07800010
*   THE USER HAS THE OPTION TO RECORD THESE INTERMITTENT ERRORS VIA   * 07900010
*   THE OPERATOR CONTROL FACILITY WHCIH SETS THE MASK IN LCBERMSK     * 08000010
*   (LINE BASIS) OR TRMSENSE (TERMINAL BASIS).  LINE MASK TAKES       * 08100010
*   PRECEDENCE OVER TERMINAL MASK.  THE LOW ORDER 4 BITS INDICATE     * 08200010
*   THE NUMBER OF RECORDINGS TO BE PERFORMED FOR THIS TYPE OF ERROR.  * 08300010
*   (THE COUNT IS DECREMENTED FOR EACH RECORDING.)                    * 08400010
*                                                                     * 08500010
*   THE RECORDING MASK IS AS FOLLOWS:                                 * 08600010
*   X'10' - TIME OUT                                                  * 08700010
*   X'20' - LOST DATA                                                 * 08800010
*   X'30' - OVERRUN                                                   * 08900010
*   X'40' - DATA CHECK                                                * 09000010
*   X'50' - EQUIPMENT CHECK                                           * 09100010
*   X'60' - BUSOUT CHECK                                              * 09200010
*   X'70' - INTERVENTION REQUIRED                                     * 09300010
*   X'80' - COMMAND REJECT                                            * 09400010
*   X'90' - UNIT EXCEPTION                                            * 09450010
*   X'F0' - INTENSIVE MODE (ANY OF ABOVE)                             * 09500010
*   X'A0' - 2740/2 GRAPHIC RESPONSE                                   * 09600010
*   PARAMETERS PASSED TO OBR/SDR RECORDING MODULE:                    * 09700010
*   LCBERCCW+16 - 1 BYTE INDICATES TYPE OF RECORDING                  * 09800010
*      X'00' - OBR                                                    * 09900010
*      X'80' - RECORD INTERMITTENT ERROR                              * 10000010
*      X'40' - OVERFLOW OF SIO COUNTER OR TEMPORARY ERROR COUNTER     * 10100010
*      X'20' - 2740/2 RECORDING                                       * 10200010
*   LCBERCCW+17 - 3 BYTES ADDRESS OF TERMINAL COUNTERS                * 10300010
*   LCBERCCW+20 - 1 BYTE - SIZE OF TERMINAL NAME                      * 10400010
*   LCBERCCW+21 - 3 BYTES - ADDRESS OF TERMINAL NAME                  * 10500010
*                                                                     * 10600010
*   NOTE THAT ANY CHANGES IN THE OFFSET FROM LCBFLAG1 TO LCBERCCW+16  * 10700010
*   MUST BE PRESENTED TO THE OWNERS OF OBR/SDR MODULES.               * 10800010
*********************************************************************** 10900010
         EJECT                                                          11000010
         USING IEDQCCW,RCCW                                             11100010
         USING LCBFLAG1,RLCB                                            11200010
         USING IHADCB,RDCB                                              11300010
         USING IEDQAVTD,RAVT                                            11400010
         USING IEDQSCB,RSCB                                             11500010
         USING IEDQTRM,RTERM                                            11600010
         USING IOSB,RIOSB                                        Y02027 11620010
         USING CVTDSECT,RCVT                                     Y02027 11650010
         USING EWA,RERPWA                                        Y02027 11720010
*              REGISTERS                                                11800010
R0       EQU   0                                                        11900010
RIOSB    EQU   1                        ADDR OF I/O SUPVR BLK    Y02027 12000010
RPARM    EQU   1                        PARAMETER REG          @G36XREV 12100010
RUCB     EQU   3                        UCB REGISTER                    12200010
RLCB     EQU   2                        LCB ADDRESS              X02004 12300010
RDEB     EQU   3                        DEB ADDRESS              X02004 12350010
RDCB     EQU   4                        DCB ADDRESS              X02004 12400010
RCCW     EQU   5                        CCW ADDRESS              X02004 12450010
RWKA     EQU   6                        WORK REGISTER                   12500010
RSUB     EQU   6                        REAL-TO-VIRTUAL SUBROUTINE      12530010
*                                       ADDRESS.                        12560010
RWKB     EQU   7                        WORK REGISTER                   12600010
RTST     EQU   7                         ADDRESS OF RQE          Y02027 12650010
RTERM    EQU   8                        TERMINAL BASE                   12700010
*                                       IN CCW CONVERT SUB-ROUTING      12730010
RCCW2    EQU   8                        SECOND CCW ADDRESS.             12760010
RWKC     EQU   9                        WORK REGISTER                   12800010
RWKD     EQU   10                       WORK REGISTER                   12900010
RCVT     EQU   10                       ADDR OF CVT              Y02027 12950010
R10      EQU   10                       WORK REG               @G36XREV 12970010
RAVT     EQU   11                       AAVT BASE                       13000010
RBASE    EQU   12                       BASE REGISTER.                  13100010
RLINK    EQU   13                       LINKAGE FOR SUBSEQUENT LOAD     13200010
RSAVE    EQU   13                       SAVE REGISTER FOR IOSB   Y02027 13250010
RXCTL    EQU   14                       XCTL REGISTER                   13300010
*                                       ALSO, RETURN ADDRESS FROM       13330010
*                                       'IEAPTRV'.                      13360010
RERPWA   EQU   14                       ADDR OF ERP WORK AREA    Y02027 13380010
R15      EQU   15                       ADDRESSABILITY REGISTER         13400010
*                                       LINK-TO ADDRESS OF IEAPTRV.     13500010
RSCB     EQU   15                       SCB REGISTER                    13510010
RNTRY    EQU   15                       ENTRY REG              @G36XREV 13515010
         EJECT                                                          13520010
         USING *,R15                    TEMPORARY BASE.          X02004 13530010
IGE0004H IEDHJN ID                                               X02004 13540010
         L     RTST,IOSUSE               PICKUP ADDR OF RQE      Y02027 13584010
         LM    RLCB,RDEB,IOBPTR(RTST)   PICKUP DEB AND LCB PTRS  Y02027 13588010
*                                       FROM THE RQE             Y02027 13592010
         L     RDCB,LCBDCBPT            PICKUP ADDR OF DCB       Y02027 13596010
         LA    R15,ZERO(RDEB)           COPY DEB ADDRESS         X02004 13600010
         LA    RDEB,DEBNMSUB-DEBEOEA    OFFSET TO DEB START      X02004 13610010
         SR    R15,RDEB                 ADDRESS OF SIO APPENDAGE X02004 13620010
         L     R15,SIOPTR(,R15)         SIO APPENDAG ADDRESS     X02004 13640010
SETERP   SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=CHANNEL PROGRAM,X13660010
               IGE0004G(SETERP),IGG019QE(SETERP),IEDQGT(SETTRAN),      X13663010
               IEDQGA(SETASSC,SETCONC),'PCI LINEEND,AND START I/O      X13666010
               APPENDAGES ARE LOCKED ON THIS RESOURCE THRU THE EXCP    X13669010
               PROCESSOR ISSUING SETLOCK (ERP,BUFFER ASSOCIATION AND   X13672010
               TRANSPARENT CCW BUILD MUST ISSUE SETLOCK'                13675010
         BAL   RBASE,INTENTRY(R15)      LINK TO SIO APPENDAGE    X02004 13680010
*                                       + FOUR TO CONVERT REAL   X02004 13700010
*                                       TO VIRTUAL.              X02004 13720010
         SPACE 1                                                 X02004 13740010
         USING *,RBASE                  USE NEW BASE REGISTER    X02004 13760010
         SH    RLCB,LCBSIZE             BACKUP TO LCB            Y02027 13886810
         USING IEDQLCB,RLCB                                      Y02027 13986810
**************************************************************** Y02027 14202010
*        THE FOLLOWING CODE MAPS THE NECESSARY FIELDS FROM THE   Y02027 14204010
*        I/O SUPERVISOR BLOCK TO THE LINE CONTROL BLOCK FOR EXCP Y02027 14206010
*        COMPATABILITY DURING RETRY I/O OPERATIONS FROM ERP      Y02027 14208010
**************************************************************** Y02027 14210010
         MVC   LCBCSW(SEVEN),IOSCSW     MAP CSW FROM IOSB TO LCB Y02027 14212010
         MVC   LCBSENS0(TWO),IOSSNS     MAP SENSE INFO FROM IOSB Y02027 14214010
*                                       TO LCB                   Y02027 14216010
         MVC   LCBSIOCC(ONE),IOSCC      MAP START I/O CONDITION  Y02027 14218010
*                                       CODE FROM IOSB TO LCB    Y02027 14220010
         LR    RWKA,RBASE               SAVE BASE OVER SETLOCK @ZM46665 14223010
         LA    R0,LOAD904G              SET BRANCH REGISTER      Y02027 14226010
         L     RCVT,CVTPTR              CVT ADDRESS              Y02027 14227010
         L     RDEB,CVTAQAVT            TCX ADDRESS              Y02027 14228010
         L     RDEB,0(,RDEB)            AVT ADDRESS              Y02027 14229010
         CLI   LCBINCAM+1,AVTEFF        CLOSE DOWN ENTRY                14230010
         BE    NOTRACE                  BRANCH YES               Y02027 14260010
         LA    R0,CONTINUE              SET BRANCH REGISTER      Y02027 14280010
         TM    IOSFLA,IOSERR            ERP ALREADY IN CONTROL   Y02027 14300010
         BNO   NOTRACE                  BRANCH NOT ERP           Y02027 14400010
         LA    R0,SPECIAL               SET BRANCH REGISTER      Y02027 14406010
         SLR   RNTRY,RNTRY              CLEAR HI BYTE FOR Q0   @G36XREV 14412010
         ICM   RNTRY,AD,AVTIOT+1-IEDQAVTD(RDEB) I/O TRACE ACTIVE Y02027 14418010
         BZ    NOTRACE                  BRANCH NO                Y02027 14421010
         OI    LCBFLAG1,IOSERR+IOSEX    SET FOR IGG019Q0         Y02027 14424010
         LR    R10,RIOSB                SAVE IOSB ADDR         @G36XREV 14424710
         L     RPARM,IOSUSE             CLEAR HI BYTE          @G36XREV 14425410
         LA    RPARM,0(RPARM)           CLEAR HI BYTE          @G36XREV 14426110
         BALR  RXCTL,RNTRY              LINK TO IGG019Q0         Y02027 14430010
         SPACE 1                                                 Y02027 14433010
         LR    RIOSB,R10                RESTORE IOSB BASE      @G36XREV 14434010
         NI    LCBFLAG1,X'FF'-(IOSERR+IOSEX) RESET FLAGS         Y02027 14436010
         SPACE 1                                                 X02004 14450010
NOTRACE  EQU   *                                                 X02004 14470010
RESETERP SETLOCK RELEASE,TYPE=LOCAL,RELATED=CHANNEL PROGRAM,           X14473010
               IGE0004H(SETERP)                                         14476010
         LR    RBASE,RWKA               RESTORE BASE AFTER LOCK@ZM46665 14476510
         OI    IOSFLA,IOSERR+IOSEX      INDICATE ERP IN CONTROL  Y02027 14477010
         L     RCVT,CVTPTR              RELOAD CVT POINTER     @ZA02622 14478010
         LR    RAVT,RDEB                AVT ADDRESS TO RAVT      Y02027 14479010
         TM    LCBSIOCC,CC3             SIO COMP 3             @ZA00227 14480210
         BO    PATHAVAL                 YES, CHECK ALT. PATH   @ZA00227 14480810
NOPATH   EQU   *                                               @ZA00227 14481410
         SR    RLINK,RLINK              SET FOR INDEXING         Y02027 14482010
         L     RUCB,IOSUCB              UCB ADDRESS              Y02027 14488010
         LR    R15,R0                   SET BRANCH REGISTER      Y02027 14491010
         BR    R15                      TO PROPER ROUTINE        Y02027 14494010
SPECIAL  EQU   *                                                 Y02027 14497010
         SPACE                                                          14500010
         TM    LCBINCAM+1,AVTEFF        SPECIAL RETURN                  14600010
         SPACE                                                          14800010
         BNZ   LOAD404H                 OTHER INTERMEDIATE ERPN         14900010
         SPACE                                                          15000010
CONTINUE EQU   *                                                        15100010
         MVI   LCBINCAM+1,AVTEZERO      ZERO RETURN INDICATOR  @SA72456 15105010
         L     RERPWA,IOSERP            PICKUP ADDR OF ERP WORK  Y02027 15110010
*                                       AREA                     Y02027 15120010
         L     RSCB,LCBSCBA-1           SCB BASE                 S21903 15150010
         CLI   LCBECBCC,HIO             WAS HIO DONE                    15200010
         BE    HIORET                   YES, RETURN TO NORMAL END       15300010
         TM    LCBSIOCC,CC3             SIO COMP CODE 3                 15500010
         BO    LOAD204G                 YES-CONTROL UNIT NOT UP         15600010
         SPACE                                                          15700010
         BZ    CHECKCAT                 BRANCH CC=0 CONTINE TESTING     15800010
         SPACE                                                          15900010
         OI    EWTCFLG,EWTCSEL          INDICATE INTIAL          Y02027 15930010
*                                       SELECTION ERROR          Y02027 15960010
         L     RWKA,LCBSTART-1          START ADDRESS                   16000010
         LA    RWKA,EIGHT(R0,RWKA)      BUMP BY 8                       16100010
         STCM  RWKA,SEVEN,LCBCSW         TRUE FAILING CCW + 8    Y02027 16200010
CHECKCAT EQU   *                        CATASTROPIC ERRORS              16300010
         SR    RCCW,RCCW                 CLEAR FOR ICM           Y02027 16400010
         ICM   RCCW,SEVEN,LCBCSW         ADDRESS FAILURE CCW + 8 Y02027 16450010
         SH    RCCW,H8                  BACK UP TO FAILURE CCW          16500010
         LA    RCCW,0(,RCCW)            CLEAR HI ORDER BYTE             16600010
         LA    RWKA,LCBCPA              START OF CHAN PROGRAM AREA      16900010
         SR    RWKA,RCCW                INTERRUPT BEFORE LCBCPA         17000010
         BP    TEXTCCW                  BRANCH FOR TEXT CCW             17100010
         SPACE                                                          17200010
         SR    RWKB,RWKB                CLEAR WORK REGISTER             17300010
         IC    RWKB,DCBEIOBX            SIZE OF AN LCB                  17400010
         LA    RWKB,ZERO(RLCB,RWKB)     POINT TO END OF LCBCPA          17500010
         SR    RWKB,RCCW                INTERRUPT OUT OF LCBCPA         17600010
         BNP   TEXTCCW                  BRANCH FOR TEXT CCW             17700010
         SPACE                                                          17800010
         LPR   RWKA,RWKA                MAKE DIFFERENCE POSITIVE        17900010
         SRL   RWKA,THREE               DIVIDE BY 8 FOR INDEXING        18000010
         IC    RWKA,LCBTPCD(RWKA)       CORRESPONDING TP OF CODE        18100010
         STC   RWKA,LCBRESTR            SAVE TP OP CODE                 18200010
         B     TESTCAT                  TEST CATASTROPHIC ERRORS        18300010
TEXTCCW  EQU   *                                                        18400010
         MVI   LCBRESTR,TPTEXT          INDICATE TEXTS CCW              18500010
TESTCAT  EQU   *                                                        18600010
         CLI   LCBINCAM,AVTEZERO        RETRY COUNT EQ 0                18700010
         BNE   NOT1ST                   NO                              18800010
         SPACE                                                          18900010
         MVC   LCBRESTR+1(1),LCBRESTR   SAVE TP OP CODE-1ST FAILURE     19000010
         IC    RWKA,LCBSENS0            CURRENT SENSE BYTE              19100010
         STC   RWKA,LCBSNSV             SAVE FOR RECORDING              19200010
         MVC   LCBCSWSV,LCBCSW          SAVE CURRENT CSW                19300010
         MVC   EWTCCSW(SEVEN),LCBCSW    MOVE CSW INTO THE ERP    Y02027 19320010
*                                       WORK AREA                Y02027 19340010
         MVC   EWTCCCW(EIGHT),ZERO(RCCW) MOVE CCW INTO THE ERP   Y02027 19360010
*                                       WORK AREA                Y02027 19380010
NOT1ST   EQU   *                                                        19400010
         CLI   LCBTPCD+3,TPRS3270       RESET 3270             @OY14057 19430010
         BE    PERMEXIT                 YES,TREAT AS PERM ERROR@OY14057 19460010
         TM    LCBCSW+4,CONTCHK+INTCHK  SEVERE CHANNEL ERRORS           19500010
         BNZ   LOAD804H                 YES SEVERE ERRORS               19600010
         TM    LCBCSW+4,CHDATCHK        CHANNEL DATA CHECK              19700010
         BO    UNUSUAL                  YES                             19800010
         TM    LCBCSW+3,ATSMCUBY        ATTENTION,STATUS MODIRIER,      19900010
*                                         CONTROL UNIT END, BUSY        20000010
         BZ    TRYNEXT                  BRANCH NONE OF THESE            20100010
UNUSUAL  EQU   *                                                        20200010
         OI    LCBINCAM+1,X04           INDICATE UNUSUAL STATUS         20300010
         B     LOAD504H                 EXIT TO ERROR POST MOD   S22025 20400010
TRYNEXT  EQU   *                        TEST 2ND STATUS BYTE            20500010
         TM    LCBCSW+4,CHCKPROT        CHAINING CECK ,PROT CHECK       20600010
         BNZ   UNUSUAL                  YES                             20700010
         SPACE                                                          20800010
         TM    LCBCSW+4,PC              PROGRAM CHECK                   20900010
         BZ    NOPC                     NO                              21000010
         CLI   CCWOPCDE,CCWTIC          TIC                             21100010
         BNE   UNUSUAL                  NO                              21200010
         SPACE                                                          21300010
         SH    RCCW,H8                  BACK UP TO TEST CCW             21400010
NOPC     EQU   *                                                        21500010
         SPACE                                                          21600010
         TM    LCBCSW+3,UNITCHK         UNIT CHECK                      21700010
         BZ    TRYUNEX                  BRANCH NO                       21800010
         SPACE                                                          21900010
         CLI   CCWOPCDE,CCWREAD         READ OR WRITE CCW               22000010
         BH    TESTPOLL                 FALL THROUGH-READ OR WRITE      22100010
         CLI   LCBRESTR,TPRDRESP        RESPONSE TO POLLING             22200010
         BNE   NOPOLRSP                 BRANCH IF NO             S22025 22300010
         CLI   LCBCPA+24,CCWPOLL        THIS RESPONSE TO AUTOPOLL       22400010
         BE    LOAD404G                 USE AUTOPOLL ERP                22500010
NOPOLRSP EQU   *                                                        22600010
         LR    R0,RCCW                  ASSUME RESTART ON FAILING       22700010
         TM    LCBSENS0,EQCHK+LOSTD     EQUIPMENT CHECK,LOST DATA       22800010
         BNZ   LOAD104H                 BRANCH EITHER                   22900010
         TM    LCBSENS0,TIMEOUT         TIMEOUT SET                     23000010
         SPACE                                                          23100010
         BNZ   RDWRTO                   YES, BRANCH            @OY12439 23200010
         TM    LCBSENS0,INTREQ+BUSOUT   INTERVENTION REQ OR BUSOUT      23300010
         BNZ   LOAD104H                 EITHER OR BOTH                  23400010
         SPACE                                                          23500010
         B     LOAD204H                 DATA CHECK,OVERRUN,CMD REJ      23600010
         SPACE                                                          23700010
         SPACE                                                          23800010
TESTPOLL EQU   *                                                        23900010
         CLI   CCWOPCDE,CCWPOLL         POLL COMMAND                    24000010
         BE    LOAD404G                 BRANCH YES NEXT LOAD            24100010
         SPACE                                                          24200010
         B     LOAD304G                 HANDLE UNIT CHECKS FOR NON      24300010
*                                         READ, WRITE, POLL CCW'S       24400010
         SPACE 3                                                        24500010
TRYUNEX  EQU   *                                                        24600010
         TM    LCBCSW+3,UNEX            UNIT EXCEPTION SET              24700010
         BZ    ERRCLEAR                 NO, ERROR IS CLEARED            24800010
         CLI   CCWOPCDE,CCWREAD         READ COMMAND                    24900010
         BE    ERRCLEAR                 YES                             25000010
         BL    LOAD104H                 UNIT EXCEIPTION ON EIRTE        25100010
         SPACE                                                          25200010
         CLI   CCWOPCDE,CCWPOLL         POLL COMMAND                    25300010
         BE    LOAD404G                 YES                             25400010
         SPACE                                                          25500010
         B     LOAD304G                 NON READ WRITE OR POLL CCW      25600010
         SPACE                                                          25700010
RDWRTO   EQU   *                                                        25800010
         CLI   LCBRESTR,TPRDRESP        RESPONSE TO POLLING             25900010
         BNE   CHKRDENQ                 RESPONSE TO POLLING/ENQ         26000010
         L     R0,LCBSTART-1            RESTART FROM TOP                26200010
         B     TRYRETRY                 TEST RETRY COUNT                26300010
         SPACE                                                          26400010
CHKRDENQ EQU   *                                                        26500010
         CLI   LCBRESTR,TPRDENQ         READ ENQ COMMAND                26600010
         BNE   TRYIDAK                  NO                              26700010
         CLI   LCBINCAM,2               RD ENQ RETRY LIMIT              26800010
         BL    TRYRETRY           NO                                    26900010
*        TIME OUT  ON READ ENQ ON DIAL IS NORMAL - NO OBR OR            27000010
* ERROR MESSAGE                                                         27100010
         NI    IOSFLA,AVTEFF-IOSERR     POST PERMANENT ERROR TO  Y02027 27200010
*                                       ABNORMAL END APPENDAGE   Y02027 27300010
         B     NOTRETRY                 RETURN                   Y02027 27400010
TRYIDAK  EQU   *                                                        27600010
         CLI   LCBRESTR,TPRDIDAK        READ ID ACK                     27700010
         BNE   TRYRSPQ                  NO,                             27800010
         SPACE                                                          27900010
         LA    R0,LCBCPA+40             CPU ID ENQ                      28000010
         B     TRYRETRY                 ATTEMPT RETRY                   28100010
TRYRSPQ  EQU   *                                                        28200010
         SPACE                                                          28300010
         CLI   LCBRESTR,TPRSPENQ        RESPONSE TO ENQ                 28400010
         BE    BACKUP                   BACK UP TO WRITE ENQ            28500010
         SPACE                                                          28600010
         CLI   LCBRESTR,TPRDIDNQ        READ ID ENQ                     28700010
         BNE   LOAD104H                 EXIT FOR OTHER TIME OUT         28800010
         B     TRYRETRY                 RETRY READ ID Q                 28900010
         SPACE                                                          29000010
         SPACE                                                          29100010
BACKUP   EQU   *                                                        29200010
         LR    R0,RCCW                  COPY CCW ADDRES                 29300010
         SH    R0,H8                    BACK UP TO PREVIOUS             29400010
         SPACE                                                          29600010
         SPACE                                                          29700010
TRYRETRY EQU   *                                                        29800010
         CLI   LCBINCAM,RETRY           RETRY LIMIT REACHED             29900010
         BE    PERMEXIT                 YES, EXIT TO POST ERROR         30000010
         MVI   LCBSENS0,AVTEZERO        CLEAR SENSE FRO RETRY           30100010
         SR    RWKB,RWKB                CLEAR WORK REGISTER             30200010
         IC    RWKB,LCBINCAM            RETRY COUNT                     30300010
         LA    RWKB,1(,RWKB)            BUMP                            30400010
         STC   RWKB,LCBINCAM            SAVE BACK                       30500010
         ST    R0,LCBSTART-1            RESTART ADDRESS                 30700010
         B     APPRET                   RETRY THE OPERATION      Y02027 30800010
PATHAVAL EQU   *                                               @ZA00227 30820010
         L     RUCB,CVTAQAVT            PICK UP TCX            @ZA00227 30840010
         USING IEDQTCX,RUCB                                    @ZA00227 30860010
CC3LOOP  EQU   *                                               @ZA00227 30880010
         TS    TCXCC3TS                 RESERVE SAVE AREA IN TCXOZ00227 30900010
         BNZ   CC3LOOP                  LOOP TILL TCX AVAILABLE@ZA00227 30920010
         STM   R15,RIOSB,TCXERPSV       SAVE REGS DESTROYED    @ZA00227 30940010
         LA    RLINK,TCXESAVE           SAVE AREA FOR IECVIOPM @ZA00227 30960010
         L     RIOSB,IOSUCB             UCB ADDRESS            @ZA00227 30980010
         LA    RIOSB,ZERO(RIOSB)        CLEAR HIGH BYTE        @ZA00227 31000010
         ST    RIOSB,TCXERPPM           SET PARM LIST          @ZA00227 31020010
         LA    RIOSB,TCXERPPM           ADDRESS OF PARM LIST   @ZA00227 31040010
         LINK     EP=IECVIOPM,MF=(E,(1)) CHECK AVAIL PATHS     @ZA00227 31060010
         LTR   R15,R15                  PATH AVAILABLE         @ZA00227 31080010
         LM    R15,RIOSB,TCXERPSV       RESTORE REGS           @ZA00227 31100010
         MVI   TCXCC3TS,AVTEZERO        CLEAR TS LOCK          @ZA00227 31120010
         BNZ   NOPATH                   NO,BRANCH              @ZA00227 31140010
         NI    LCBSIOCC,AVTEFF-CC3      RESET CONDITION CODE   @ZA00227 31160010
         B     APPRET                                          @ZA00227 31180010
ERRCLEAR EQU   *                                                        31200010
         TM    LCBFLAG3,LCBOBRRD        PROCESSING TPER RECORD   S22026 31205010
         BO    LOAD904H                 YES, LOAD TPER INTERFACE S22026 31210010
         MVI   LCBSENS0,AVTEZERO        CLEAR SENSE BYTE SINCE E A42406 31220010
*                                         IS CLEARED AND PREVENT        31240010
*                                         INVALID ERROR MASK AT         31260010
*                                         INMSG/OUTMSG TIME             31280010
         NI    IOSFLA,AVTEFF-(IOSERR+IOSEX) RESET ' ERP IN CTL'  Y02027 31300010
*                                       AND 'PERMANENT ERROR'    Y02027 31303010
*                                       INDICATORS               Y02027 31306010
         TM    LCBSTAT1,LCBRECVN        RECEIVE STAT0E                  31310010
         BZ    RESET                    NO                              31320010
         CLI   LCBRESTR,TPTEXT          TEXT ERROR                      31330010
         BE    NORESET                  IF YES, LINE AND WILL RESET     31340010
*                                         RETRY COUNT - PREVENT LOOP    31350010
*                                         FOR CASE OF CONTINUOUS        31360010
*                                         INVALID START OR END          31370010
*                                         CHARACTER                     31380010
         CLI   LCBRESTR,TPRDIDNQ        READ ID AND ENQ?       @OY18043 31382010
         BNE   RESET                    NO- BRANCH             @OY18043 31384010
         MVI   LCBTSTSW,AVTEZERO        TSTSW 0 IF INCAM 0     @OY18043 31386010
RESET    EQU   *                                                        31390010
         MVI   LCBINCAM,AVTEZERO        CLEAR RETRY OCUNT               31400010
NORESET  EQU   *                                                        31450010
         TM    LCBCSWSV+3,UNITCHK+UNEX  UNIT CHECK OR UNIT EXCEPTION    31500010
         BZ    APPRET                   BRANCH NO              @OS76278 31600010
         SR    RWKD,RWKD                CLEAR WORK REGISTER             31700010
         CH    RWKD,LCBTTCIN            SPECIFIC CONNECTION             31800010
         BNE   TERM                     BRANCH IF LINE ENRTY            31900010
         TM    LCBSTAT2,LCBDIAL         DIAL LINE                       32000010
         BZ    USEUCB                   BRANCH NO                       32100010
         LH    RWKC,LCBLNENT            LINE ENTRY USED                 32200010
         LTR   RWKC,RWKC                LINE ENTRY PRESENT              32300010
         BNZ   TERM1                    BRANCH NOT DIAL                 32400010
         SPACE                                                          32500010
USEUCB   EQU   *                                                        32600010
         L     RCVT,CVTPTR              CVT ADDRESS            @ZA02613 32630010
         LA    RWKA,THREE               UNITNAME LENGTH        @ZA02613 32660010
         L     RTERM,CVTSTB             STATISTICS TABLE ADDRESS S21903 32700010
         SR    RWKC,RWKC                CLEAR FOR INDEX                 32800010
         L     RWKB,UCBEXTPT-UCBOB(,RUCB) UCB EXTENSION          Y02027 32900010
         IC    RWKC,UCBSTI-UCBCMEXT(,RWKB) STATAB INDEX          Y02027 32950010
         LR    RWKB,RTERM               COPY TABLE ADDRESS              33000010
LOOP1    EQU   *                                                        33100010
         CLM   RUCB,THREE,ZERO(RWKB)    COMPARE UCB ADDRESSES  @Z30AAEE 33200010
         BC    4,LOOP2                  YES                             33300010
         SPACE                                                          33400010
         LA    RWKB,2(,RWKB)            NEXT ENTRY                      33500010
         LA    RWKC,256(,RWKC)          NEXT NEXT STAT TABLE IN         33600010
*                                         NEXT ENTRY                    33700010
         B     LOOP1                    CHECK THIS ENTRY                33800010
         SPACE                                                          33900010
LOOP2    EQU   *                                                        34000010
         MH    RWKC,H10                 MULTIPLY BY 10                  34100010
         AR    RTERM,RWKC               STAT TABLE ADDRESS SET          34200010
         LA    RWKC,UCBNAME-UCBOB(,RUCB) EBCIDIC NAME            Y02027 34300010
         B     TCOMMON                  USE COMMON COD                  34500010
TERM     EQU   *                                                        34600010
         LH    RWKC,LCBTTCIN            CURRENTLY CONNECTED             34700010
TERM1    EQU   *                                                        34800010
         L     RWKB,AVTRNMPT            ADDR OF TERM NAME CODE   Y02027 34900010
         USING IEDQTNTD,RWKB                                     Y02027 34920010
         BAL   RWKA,TNTDCODE            LOCATE ADDRESS OF THE    Y02027 34940010
*                                       TERMINAL TABLE ENTRY.           34960010
         LA    RWKA,THREE               SIZE OF UCB NAME         Y02027 34980010
         LA    RTERM,TRMSIO             RESTET BASE  ADJUST FOR DIAL    35000010
         USING TRMSIO,RTERM                                             35100010
         IC    RWKA,TNTENLEN            SIZE OF EACH NAME        Y02027 35200010
         LA    RWKC,79(RWKB,RWKC)       ADDRESS OF TERM ADDRESS         35400010
         SR    RWKC,RWKA                SUB SIZE TO GET ADDRESS  Y02027 35500010
*                                       OF NAME                  Y02027 35550010
TCOMMON  EQU   *                                                        35600010
         MVI   EWTCTRM,BLANK                                     Y02027 35700010
         MVC   EWTCTRM+ONE(SEVEN),EWTCTRM BLANK OUT TERMINAL     Y02027 35720010
*                                       NAME FIELD IN EWA        Y02027 35740010
         BCTR  RWKA,ZERO                REDUCE NAME CONT BY ONE  Y02027 35760010
*                                       FOR EXECUTE INSTRUCTION  Y02027 35800010
         EX    RWKA,MOVENAME            MOVE THE TERMINAL NAME   Y02027 35830010
*                                       TO THE ERP WORK AREA     Y02027 35860010
         CLC   1(1,RTERM),2(RTERM)      CHECK COUNTS                    35920010
         BH    NOADD                    OKAY                            35940010
         MVC   1(1,RTERM),2(RTERM)      SET REALISTIC COUNT             35960010
NOADD    EQU   *                                                        35980010
         SR    RWKD,RWKD                CLEAR WORK REGISTER             36040010
         IC    RWKA,TRMTEMPR            COUNT FO TEMP ERRORS            36100010
         LA    RWKA,1(,RWKA)            BUMP COUNT                      36200010
         STC   RWKA,TRMTEMPR            DAVE BACK                       36300010
         IC    RWKD,LCBERMSK            ASSUME LINE MASK USED           36400010
         LA    RWKB,LCBERMSK            ASSUME LINE MASK                36500010
         TM    LCBERMSK,X0F             LINE MASK SET                   36600010
         BNZ   UPDATE                   BRANCH YES                      36700010
         SPACE                                                          36800010
         IC    RWKD,TRMSENSE            MASK BYTE                       36900010
         LA    RWKB,TRMSENSE            ADJUST FOR TERMINAL LMASK       37000010
UPDATE   EQU   *                                                        37100010
         TM    0(RWKB),X0F              ANY RECORDING TO BE DONE        37200010
         BZ    NORECORD                 BRANCH NO                       37300010
         STC   RWKD,LCBERCCW            SAVE MASK IN WORK AREA          37400010
         TM    0(RWKB),ANYERR           INTENSIVE MOSDE SET             37500010
         BZ    NORECORD                 BRANCH NO MASK SET              37600010
         SPACE                                                          37700010
         BO    GOSDR                    BRANCH INTENSIVE                37800010
         SPACE                                                          37900010
         NI    LCBERCCW,XF0             CLEAR COUNT FIELD               38000010
         CLI   LCBERCCW,UNEXMSK         IS UNEX OR UNIT CHECK CHOSEN    38100010
         BH    NORECORD                 NO RECORDING TO BE DONE  S22025 38200010
         SPACE                                                          38300010
         LR    RWKA,RWKD                SAVE MASK                       38400010
         BL    TESTUNCK                 TEST SENSE BYTE                 38500010
         SPACE                                                          38600010
         TM    LCBCSWSV+3,UNEX          UNIT EXCEPTION ERROR            38700010
         BZ    NORECORD                 BRANCH NO                       38800010
         SPACE                                                          38900010
         B     GOSDR                    RECORD ERROR                    39000010
TESTUNCK EQU   *                                                        39100010
         SRL   RWKA,4                   AHKFT MASK FOR INDEX            39200010
         IC    RWKA,TABLE-1(RWKA)       GET ASSOCIATED SENSE MASK       39300010
         EX    RWKA,TMMASK              THIS THE ERROR                  39400010
         BZ    NORECORD                 BRANCH NO                       39500010
GOSDR    EQU   *                                                        39600010
         MVC   LCBRESTR(1),LCBRESTR+1   TP OP CODE OF 1ST FAILURE       39700010
         BCTR  RWKD,0                   DECREMENT RECORDING COUNT       39800010
         STC   RWKD,0(RWKB)             SAVE MASK BACK                  39900010
         SPACE                                                          40000010
         STC   RWKD,EWTCMSK             MOVE RECORDING MASK TO   Y02027 40100010
*                                       RECORD                   Y02027 40130010
         OI    EWTCFLG,EWTCTEM          INDICATE TEMPORARY ERROR Y02027 40160010
LOADSDR  EQU   *                                                        40200010
         MVC   EWTCSIO(THREE),TRMSIO    MOVE START I/O AND TEMP  Y02027 40250010
*                                       ERROR COUNTERS TO THE    Y02027 40252010
*                                       ERP WORK AREA            Y02027 40254010
         XC    TRMSIO(THREE),TRMSIO     CLEAR ERROR COUNTERS IN  Y02027 40256010
*                                       THE TERMINAL TABLE       Y02027 40258010
         MVC   EWTCTPF(ONE),LCBRESTR    MOVE 1ST TP OP CODE TO   Y02027 40260010
*                                       OBR/SDR RECORD           Y02027 40262010
         MVC   EWTCTPL(ONE),LCBRESTR+ONE MOVE LAST TP OP CODE TO Y02027 40264010
*                                       OBR/SDR RECORD           Y02027 40266010
         MVC   EWTCSNF(ONE),LCBSNSV     MOVE 1ST BYTE OF SENSE   Y02027 40268010
*                                       DATA TO OBR/SDR RECORD   Y02027 40270010
         MVC   EWTCSNL(ONE),LCBSENS0    MOVE LAST BYTE OF SENSE  Y02027 40272010
*                                       DATA TO OBR/SDR DATA     Y02027 40274010
         LA    RWKA,EWTCSIO             INDICATE ADDR OF START   Y02027 40276010
         STCM  RWKA,SEVEN,EWADDISP      DEVICE DEPENDENT INFO    Y02027 40278010
*                                       FOR OBR/SDR              Y02027 40280010
         MVI   EWADCNT,OBRDATA          INDICATE SIZE OF DEVICE  Y02027 40282010
*                                       DEPENDENT DATA FOR OBR   Y02027 40284010
         OI    IOSFLB,IOSLOG            INDICATE REQUEST FOR     Y02027 40286010
*                                       OBR/SDR                  Y02027 40288010
         LA    RLINK,SDRLOAD            SDR ID                          40300010
         L     RCVT,CVTPTR              CVT ADDRESS              Y02027 40400010
         L     RXCTL,CVTXTLER           XCTL ROUTINE             Y02027 40405010
HIOSUB   EQU   *                                                 Y02027 40410010
**************************************************************** Y02027 40415010
*        THE FOLLOWING CODE MAPS THE NECESSARY FIELDS FROM THE   Y02027 40420010
*        LINE CONTROL BLOCK TO THE I/O SUPERVISOR BLOCK FOR EXCP Y02027 40425010
*        COMPATABILITY DURING RETRY OPERATIONS FROM ERP          Y02027 40430010
**************************************************************** Y02027 40435010
         MVC   IOSCSW(SEVEN),LCBCSW     MAP CSW FROM LCB TO IOSB Y02027 40440010
         MVC   IOSSNS(TWO),LCBSENS0     MAP SENSE INFO FROM LCB  Y02027 40445010
*                                       INTO IOSB                Y02027 40450010
         MVC   IOSCC(ONE),LCBSIOCC      MAP START I/O CONDITION  Y02027 40455010
*                                       CODE FROM LCB TO IOSB    Y02027 40460010
         CLI   LCBECBCC,HIOCC           IOHALT ISSUED            Y02027 40465010
         BNER  RXCTL                    BRANCH NO - RETURN       Y02027 40470010
         NI    IOSFLA,X'FF'-(IOSERR+IOSEX) RESET ERP IN CTL      Y02027 40475010
         MVI   LCBINCAM+1,HIOCC         SET FOR LINEEND          Y02027 40480010
         BR    RXCTL                    LINK/RETURN TO CALLER           40485010
         SPACE                                                          40500010
NORECORD EQU   *                                                        40600010
         CLI   TRMTEMPR,AVTEFF          OVERFLOW CONDITION              40700010
         BE    OVERFL                   BRANCH YES                      40750010
         CLC   TRMSIO,AVTCLRHI+2        SIO COUNTER OVERFLOW     S21903 40800010
         BNE   APPRET                   BRANCH NO                       40850010
         SPACE                                                          40900010
OVERFL   EQU   *                                                        41000010
         OI    EWTCFLG,EWTCOVF          INDICATE SIO COUNTER     Y02027 41100010
*                                       OVERFLOW                 Y02027 41150010
         B     LOADSDR                  USE COMMON CODE                 41200010
HIORET   EQU   *                                                        41300010
         NI    IOSFLA,X'FF'-(IOSERR+IOSEX) RESET ERP IN CTL      Y02027 41500010
APPRET   EQU   *                                                        41700010
         BAL   RXCTL,HIOSUB             CHECK FOR IOHALT                41703010
*********************************************************************** 41706010
*                                                                     * 41709010
*        THE FOLLOWING CODE IS ADDED FOR AOS.                         * 41712010
*                                                                     * 41715010
         TM    IOSFLA,IOSERR+IOSEX      ARE WE DOING A RETRY     Y02027 41718010
         BNO   NOTRETRY                 BRANCH IF NO.            X01004 41721010
         L     RTST,IOSUSE              PICKUP ADDR OF RQE       Y02027 41724010
         LR    RSAVE,RIOSB              SAVE IOSB ADDRESS        Y02027 41727010
         L     RLCB,IOBOFFST(,RTST)     GET IOB ADDRESS FROM RQE Y02027 41730010
*                                       FOR USE BY SIO APPENDAGE.X01004 41733010
         L     RTERM,EIGHT(,RTST)       GET DEB ADDRESS FROM RQE X01004 41736010
         LA    R15,DEBNMSUB-IEDQDEB     GET APDG. TABLE SIZE     Y02027 41739010
         SLR   RTERM,R15                POINT TO APDG. TABLE     Y02027 41742010
         L     RTERM,SIOPTR(,RTERM)     GET ADDRESS OF SIO APDG. X01004 41745010
*                                       FROM APDG. VECTOR TABLE. X01004 41748010
         SR    R15,R15                  CLEAR R15 TO TELL SIO    X01004 41751010
*                                       APDG. IT'S A SUBROUTINE. X01004 41754010
         BAL   RXCTL,SIOENTRY(,RTERM)   LINK TO SIO APPENDAGE AT X01004 41757010
*                                       OFFSET +16 TO CONVERT    X01004 41760010
*                                       CCW'S TO REAL.           X01004 41763010
         LR    RIOSB,RSAVE              RESTORE IOSB ADDR        Y02027 41766010
*                                                                     * 41769010
*        END OF CODE ADDED FOR AOS.                                   * 41772010
*                                                                     * 41775010
*********************************************************************** 41778010
NOTRETRY EQU   *                                                 X01004 41781010
         SVC   EREXCP                                                   41800010
         SPACE                                                          41900010
         SVC   RETURN                                                   42000010
         SPACE 2                                                        42100010
PERMEXIT EQU   *                                                        42200010
         MVI   LCBINCAM+1,POPERM        RETURN TO 504H                  42300010
         B     LOAD504H                 NEXT MODULE                     42400010
         SPACE 2                                                        42800010
         SPACE                                                          43600010
* THE VALUE OF RLINK INDICATES TO IOS THE NEXT ERP MODULE TO BE         43900010
* LOADED                                                                44000010
LOAD904H EQU   *                                                 S22026 44030010
         LA    RLINK,D1000(,RLINK)      INDEX TO NEXT MODULE     S22026 44060010
LOAD804H EQU   *                                                        44100010
         LA    RLINK,3000(,RLINK)       INDEX FOR NEXT MODULE           44200010
LOAD504H EQU   *                                                        44300010
         LA    RLINK,D1000(,RLINK)      INDEX - NIEXT LOAD              44400010
LOAD404H EQU   *                                                        44500010
         LA    RLINK,2000(,RLINK)       INDEX FOR NEXT LOAD             44600010
LOAD204H EQU   *                                                        44700010
         LA    RLINK,D1000(,RLINK)      INDEX NEXT LOAD                 44800010
LOAD104H EQU   *                                                        44900010
         LA    RLINK,D1000+X4H(,RLINK)  INDEX + ERP ID                  45000010
         NI    LCBFLAG3,AVTEFF-LCBOBRRD RESET TPER FLAG          S22026 45050010
         B     NEXTLOAD                 USE COMMON CODE                 45100010
LOAD904G EQU   *                                                        45200010
         LH    RLINK,FIVEK              INITAL VALUE FOR 904G           45300010
LOAD404G EQU   *                                                        45400010
         LA    RLINK,D1000(R0,RLINK)    INDEX-NEXT LOAD                 45500010
LOAD304G EQU   *                                                        45600010
         LA    RLINK,D1000(R0,RLINK)    INDEX-NEXT LOAD                 45700010
LOAD204G EQU   *                                                        45800010
         LA    RLINK,2047(,RLINK)       INDEX + ERP ID                  45900010
NEXTLOAD EQU   *                                                        46000010
         L     RCVT,CVTPTR              PICKUP ADDR OF CVT       Y02027 46050010
         L     RXCTL,CVTXTLER           XCTL ROUTINE ADDRESS     S21903 46100010
         BR    RXCTL                    CALL NEXT ERP LOAD              46200010
         EJECT                                                          46230010
*              CONSTANTS                                                46260010
LCBSIZE  DC    AL2(LCBFLAG1-IEDQLCB)    AIZE OF LCB UP TO IOB           46300010
H8       DC    H'8'                     SIZE OF CCW              S22025 46600010
TMMASK   EQU   *                                                        46700010
         TM    LCBSNSV,ZERO             TEST FOR RECORDING              46800010
MOVENAME MVC   EWTCTRM(ZERO),ZERO(RWKC) MOVE TERMINAL NAME INTO  Y02027 46900010
*                                       THE ERP WORK AREA        Y02027 47000010
FIVEK    DC    AL2(5000)                INITIAL VALUE FOR 904G   S22025 47100010
H10      DC    H'10'                    STAT TABLE INDEX         S22025 47200010
TABLE    EQU   *                                                        47300010
         DC    X'01'                    TIME OUT                        47400010
         DC    X'02'                    LOST DATA                       47500010
         DC    X'04'                    OVERRUN                         47600010
         DC    X'08'                    DATA CHECK                      47700010
         DC    X'10'                    EQUIPMENT CHECK                 47800010
         DC    X'20'                    BUS OUT                         47900010
         DC    X'40'                    INTERVENTION REQUIRED           48000010
         DC    X'80'                    COMMAND REJECT                  48100010
         SPACE 3                                                        48104010
* EQUATES.                                                              48108010
         SPACE                                                          48112010
AD       EQU   7                        MASK FOR ICM             Y02027 48116010
SEVEN    EQU   7                        ADDRESSING               X01004 48120010
IOBPTR   EQU   4                        OFFSET OF IOB ADDRESS IN        48124010
THIRTY2  EQU   32                                                       48128010
*                                       RQE.                            48132010
FF       EQU   X'FF'                                                    48136010
NINE     EQU   9                        OFFSET OF WRITE IDLES           48148010
*                                       LOOP IN LCBCPA.                 48152010
REALTIC  EQU   X'80'                    FLAG INDICATING THAT A TIC      48156010
*                                       CCW HAS A REAL ADDRESS.         48160010
INVALID  EQU   X'07'                    INVALID TIC FLAG.               48164010
LCBSZOFF EQU   36                       OFFSET OF LCB SIZE FIELD IN     48168010
*                                       DCB.                            48172010
X00      EQU   X'00'                                                    48176010
ALL      EQU   15                       ICM MASK - ALL 4 BYTES.         48180010
RECORD   EQU   X'80'                    FLAG FOR SDR TO RECORD          48200010
*                                         SIO AND ERROR COUNTERS        48300010
OVERFLOW EQU   X'40'                    FLAG FOR SDR TO RECORD *        48400010
SDRLOAD  EQU   256                      SDR MODULE ID                   48500010
X04      EQU   X'04'                    'UNUSUAL' RETURN TO 504H        48700010
XF0      EQU   X'F0'                    UCB CONTROL UNIT MASK           49000010
RETRY    EQU   6                        RETRY COUNT                     49300010
IOBOFFST EQU   4                        IOB OFFSET IN RQE               49600010
ERPCTL   EQU   X'24'                    MASK ERP IN CONTROL             49700010
X0F      EQU   X'0F'                    WORK MASK FOR RECORDING         50000010
ANYERR   EQU   X'F0'                    MASK FOR INTENSIVE MODE         50100010
UNEXMSK  EQU   X'90'                    UNIT CHECK UNEX RECORD MASK     50200010
CHDATCHK EQU   X'08'                    MASK-CHANNEL DATA CHECK         50400010
CONTCHK  EQU   X'04'                    MASK-CHANNEL CONTROL CHECK      50500010
INTCHK   EQU   X'02'                    MASK-INTERFACE CHECK            50600010
ATSMCUBY EQU   X'F0'                    MASK-UNUSUAL STATUS             50700010
UNITCHK  EQU   X'02'                    UNIT CHECK MASK IN CSW          50800010
UCBOFFST EQU   2                        OFFSET TO UCB ADDRESS -RQE      50900010
EIGHT    EQU   8                                                        51000010
THREE    EQU   3                                                        51300010
CC3      EQU   X'30'                    SIO CONDITION CODE TEST         51400010
ZERO     EQU   0                                                        51500010
UNEX     EQU   X'01'                    UNIT EXCEPTION-CSW STATUS       51600010
EREXCP   EQU   15                       ERROR EXCP                      51700010
CHCKPROT EQU   X'11'                    CHAING OR PROT CHECK            51800010
PC       EQU   X'20'                    PROGRAM CHECK                   51900010
RETURN   EQU   3                        MASK FOR RETURN SVC             52200010
D1000    EQU   1000                                                     52300010
INTREQ   EQU   X'40'                    MASK FOR INTERVENTION REQ       52800010
BUSOUT   EQU   X'20'                    MASK FOR BUSOUT                 52900010
TIMEOUT  EQU   X'01'                    TIMEOUT MASK I SENSE            53200010
EQCHK    EQU   X'10'                    EQUIPMENT CHECK MSSK            53300010
LOSTD    EQU   X'02'                    LOST DATA MASK                  53500010
POPERM   EQU   8                        INDEX FOR 504H RETURN           53800010
HIO      EQU   X'48'                    ECB COMPLETION FOR HIO          54000010
X4H      EQU   48                       INDEX VALUE FOR BSC ERP         54200010
ONE      EQU   1                        CONSTANT OD 1            Y02027 54203010
TWELVE   EQU   12                        CONSTANT OF 12          Y02027 54206010
BLANK    EQU   X'40'                                             Y02027 54209010
OBRDATA  EQU   18                       SIZE OF DEVICE DEPENDENT Y02027 54212010
*                                       DATA FOR OBR/SDR         Y02027 54215010
SIOPTR   EQU   4                        LOCATION OF SIO APPENDAGEX02004 54220010
TWO      EQU   2                                                 Y02027 54226010
DEBPTR   EQU   9                        OFFSET OF DEB ADDR. IN RQE.     54232010
*                                       ADDRESS IN VECTOR TABLE  X02004 54240010
INTENTRY EQU   4                        OFFSET INTO IGG019QE OF  X02004 54260010
*                                       CCW TRANSLATION LOGIC    X02004 54280010
SIOENTRY EQU   34                       OFFSET OF SUBRTNE. ENTRY Y02027 54285010
*                                       POINT IN SIO APPENDAGE.         54290010
HIOCC    EQU   X'48'                    HALT I/O COMPLETION      Y02027 54295010
         EJECT                                                          54300010
         TTNTD                                                          54400010
         EJECT                                                          54460010
         TDEBD                          X02004                          54520010
         TCCWD                                                          54600010
         TLCBD                                                          54700010
         DCBD  DSORG=TX                                                 54800010
         TTRMD                                                          54900010
         TSCBD                                                          55000010
         TAVTD                                                          55100010
         TTPD                                                           55200010
         TTCXD                                                 @ZA00227 55203010
         IECDIOSB                                                Y02027 55207010
         IHAPSA                                                         55214010
         IECDERWA EWTC                                                  55221010
         EJECT                                                          55230010
CVTDSECT CVT   DSECT=YES                                                55260010
         EJECT                                                          55300010
         DSECT                                                          58300010
         IEFUCBOB                                                       61300010
         END                                                            64300010
