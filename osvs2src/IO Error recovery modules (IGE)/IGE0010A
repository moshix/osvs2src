         TITLE 'IGE0010A LOCAL 2250 ERROR RECOVERY PROCEDURE'           00100000
IGE0010A CSECT                                                          00200000
*********************************************************************** 00300000
*                                                                     * 00400000
* MODULE NAME:                                                        * 00500000
*    IGE0010A                                                         * 00600000
*                                                                     * 00700000
* DESCRIPTIVE NAME:                                                   * 00800000
*    LOCAL 2250 ERROR RECOVERY PROCEDURE                              * 00900000
*                                                                     * 01000000
* COPYRIGHT:                                                          * 01100000
*    NONE                                                             * 01200000
*                                                                     * 01300000
* STATUS:                                                             * 01400000
*    CHANGE LEVEL 000                                                 * 01500000
*                                                                     * 01600000
* FUNCTION:                                                           * 01700000
*    THIS MODULE IS THE ERP FOR LOCALLY ATTACHED  DEVICES OF THE      * 01800000
*    2250 DISPAY SYSTEM. THE MODULE IS SCHEDULED BY IOS.              * 01900000
*    THE FOLLOWING FUNCTIONS ARE PERFORMED BY THIS MODULE:            * 02000000
*        * DETERMINES IF AN ERROR IS RETRYABLE BY THE ERP AND RETRIES * 02100000
*          THOSE THAT ARE.                                            * 02200000
*        * DETERMINES IF ERP RETRIES ARE SUCCESSFUL.                  * 02300000
*        * MAINTAINS THE STATISTICS TABLE FOR THE DEVICE.             * 02400000
*        * REQUESTS OBR LOGOUT WHEN REQUIRED.                         * 02500000
*        * REQUESTS INT REQ OR PERM ERROR MESSAGES WHEN REQUIRED.     * 02600000
*                                                                     * 02700000
* NOTES:                                                              * 02800000
*    DEPENDENCIES:                                                    * 02900000
*        NONE                                                         * 03000000
*    RESTRICTIONS:                                                    * 03100000
*        THIS ERP IS FOR LOCALLY ATTACHED DEVICES ONLY USING EXCP     * 03200000
*    REGISTER CONVENTIONS:                                            * 03300000
*        SEE 'REGISTER DEFINITIONS' BELOW                             * 03400000
*                                                                     * 03500000
* PATCH LABEL:                                                        * 03600000
*    PACHAREA (80 BYTES)                                              * 03700000
*                                                                     * 03800000
* MODULE TYPE:                                                        * 03900000
*    PROCEDURE                                                        * 04000000
*    PROCESSOR:                                                       * 04100000
*        BAL                                                          * 04200000
*    MODULE SIZE:                                                     * 04300000
*        784 BYTES                                                    * 04400000
*    ATTRIBUTES:                                                      * 04500000
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 04600000
*                                                                     * 04700000
* ENTRY POINT:                                                        * 04800000
*    IGE0010A                                                         * 04900000
*    PURPOSE:                                                         * 05000000
*        THIS MODULE IS ENTERED WHEN ONE OR MORE OF THE FOLLOWING     * 05100000
*        CONDITIONS IS ENCOUNTERED:                                   * 05200000
*            UNIT CHECK                                               * 05300000
*            UNIT EXCEPTION                                           * 05400000
*            INVALID COMMAND SEQUENCE                                 * 05500000
*            INCORRECT LENGTH                                         * 05600000
*            PROGRAM CHECK                                            * 05700000
*            PROTECTION CHECK                                         * 05800000
*            CHAINING CHECK                                           * 05900000
*            CHANNEL DATA CHECK                                       * 06000000
*            INTERFACE CONTROL CHECK                                  * 06100000
*            CHANNEL CONTROL CHECK                                    * 06200000
*            COMMAND REJECT                                           * 06300000
*    LINKAGE:                                                         * 06400000
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 06500000
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 06600000
*    INPUT:                                                           * 06700000
*        REG 1 = ADDRESS OF IOSB                                      * 06800000
*    OUTPUT:                                                          * 06900000
*        RECOVERABLE ERRORS:                                          * 07000000
*            IOSERR IS SET ON FOR RETRY                               * 07100000
*            IF A MESSAGE IS TO BE ISSUED, EXIT IS MADE TO IGE0025C   * 07200000
*            IF NO MESSAGE, SVC 15 IS ISSUED, THEN EXIT IS VIA SVC 3  * 07300000
*        CORRECTED ERRORS:                                            * 07400000
*            IOSEX AND IOSERR ARE SET OFF                             * 07500000
*            IOSB IS CLEANED UP                                       * 07600000
*            EXIT IS TO IGE0025D TO UPDATE STATISTICS TABLE           * 07700000
*        PERMANENT ERRORS:                                            * 07800000
*            AN OBR LOGOUT IS SCHEDULED                               * 07900000
*            A STATISTIC TABLE UPDATE IS SCHEDULED                    * 08000000
*            IOSEX IS SET ON                                          * 08100000
*            IOSERR IS SET OFF                                        * 08200000
*            EXIT IS TO IGE0025C TO ISSUE PERM ERROR MESSAGE          * 08300000
*        PROGRAMMING ERRORS:                                          * 08400000
*            SVC 15 IS ISSUED                                         * 08500000
*            IOSEX IS SET ON                                          * 08600000
*            IOSERR IS SET OFF                                        * 08700000
*            EXIT IS VIA SVC 3                                        * 08800000
*                                                                     * 08900000
* EXITS-NORMAL:                                                       * 09000000
*    SUPERVISOR VIA SVC 3                                             * 09100000
*    STATISTICS UPDATE ROUTINE (IGE0025D) VIA BRANCH ENTRY TO XCTL    * 09200000
*    IOS-WTO ROUTINE (IGE0025C) VIA BRANCH ENTRY TO XCTL              * 09300000
*                                                                     * 09400000
* EXITS-ERROR:                                                        * 09500000
*    NONE                                                             * 09600000
*                                                                     * 09700000
* EXTERNAL REFERENCES:                                                * 09800000
*    ROUTINES:                                                        * 09900000
*        SVC 15 ERROR EXCP                                            * 10000000
*    DATA AREAS                                                       * 10100000
*        CHANNEL PROGRAM                                              * 10200000
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 10300000
*    CONTROL BLOCKS                                                   * 10400000
*        UCB          (MAPPED BY IEFUCBOB)                            * 10500000
*        IOSB         (MAPPED BY IECDIOSB)                            * 10600000
*        CVT          (MAPPED BY CVT)                                 * 10700000
*        RQE          (MAPPED BY IECDRQE)                             * 10800000
*        IOB          (MAPPED BY IEZIOB)                              * 10900000
*        DCB          (MAPPED BY DCBD)                                * 11000000
*                                                                     * 11100000
* TABLES-WORKAREAS:                                                   * 11200000
*    ERP WORKAREA                                                     * 11300000
*                                                                     * 11400000
* MACROS:                                                             * 11500000
*    NONE                                                             * 11600000
*                                                                     * 11700000
* CHANGE ACTIVITY:                                                    * 11800000
*    YM02594K (11/6/73)                                               * 11900000
*    ZA14030  (10/7/76)                                     D11       * 12000000
*                                                                     * 12100000
*********************************************************************** 12200000
         EJECT                                                          12300000
*/*IGE0010A: CHART */                                                   12400000
*/* E IGE0010A */                                                       12500000
*/* D (YES,,NO,PERMER) EXCP */                                          12600000
*/* D (YES,,NO,START) FIRST ENTRY */                                    12700000
*/* P CLEAR EWASTUP */                                                  12800000
*/*START: P SET ERP IN CONTROL */                                       12900000
*/* D (YES,RECOVER,NO,) ICC OR CCC */                                   13000000
*/* D (YES,SEROUT,NO,) BAD STATUS */                                    13100000
*/* D (YES,MODEL23,NO,) MOD 2 OR 3 */                                   13200000
*/* D (YES,,NO,SEROUT) MOD 1 */                                         13300000
*/* D (YES,SEROUT,NO,) BAD MOD 1 STATUS */                              13400000
*/*MODEL23: D (YES,SEROUT,NO,) BAD MOD 2 OR 3 STATUS */                 13500000
*/*ER224: D (YES,MAINER,NO,) UNIT CHECK */                              13600000
*/*TESTST: D (YES,TESTCONT,NO,) CDC */                                  13700000
*/* D (YES,WTORTN,NO,) CDC RETRIED */                                   13800000
*/* P (,RETRY) INDICATE CDC RETRIED */                                  13900000
*/*TESTCONT: D (YES,,NO,PERMER) PROG OR PROT CHECK */                   14000000
*/* D (YES,,NO,CLEARUC) INCORRECT LENGTH */                             14100000
*/* P (,PERMER) RESET ERP ENTERED IN IOB */                             14200000
*/*CLEARUC: P (,NOERR) RESET UNIT CHECK IN IOSB */                      14300000
*/*NOERR: P (,RESET) RESET IOB AND IOSB ERP FLAGS */                    14400000
*/*MAINER: P RESET ERROR CORRECTION FLAGS IN DCB */                     14500000
*/* D (YES,SEROUT,NO,) IOSB INTERCEPT */                                14600000
*/* D (YES,MODL23,NO,) MOD 2 OR 3 */                                    14700000
*/* D (YES,,NO,SEROUT) MOD 1 */                                         14800000
*/* D (YES,MOD1BSC,NO,) BAD SENSE BYTE 1 */                             14900000
*/* D (YES,SEROUT,NO,NEXT) BAD SENSE BYTE 2 */                          15000000
*/*MODL23: D (YES,CKINTREQ,NO,) BAD SENSE BYTE 1 */                     15100000
*/* D (YES,SEROUT,NO,) BAD SENSE BYTE 2 */                              15200000
*/*NEXT: D (YES,SEROUT,NO,) COM REJ AND BUF RUN */                      15300000
*/* D (YES,ISCEDE,NO,) CHAN END AND DEV END */                          15400000
*/* D (YES,NOERR,NO,) ATTENTION */                                      15500000
*/* D (YES,BO1CHK,NO,) BUS OUT CHK */                                   15600000
*/* D (YES,PERMER,NO,) COM REJ, BUF RUN, DATA CHK */                    15700000
*/* D (YES,MOD1BSC,NO,) EQUIP CHECK */                                  15800000
*/* D (YES,SEROUT,NO,TESTST) INPUT/OUTPUT CHECK */                      15900000
*/*BO1CHK: D (YES,WTORTN,NO,) BUSOUT RETRIED */                         16000000
*/* P (,RETRY) SET BUSOUT RETRIED */                                    16100000
*/*ISCEDE: D (YES,BUSERR,NO,) BUS ERR */                                16200000
*/* D (YES,DATACX,NO,) DATA CHECK */                                    16300000
*/* D (YES,MODTWO,NO,TESTST) MOD 2 OR 3 */                              16400000
*/*DATACX: D (YES,WTORTN,NO,) DATA CHK RETRIED */                       16500000
*/* P (,RETRY) SET DATA CHECK RETRIED */                                16600000
*/*BUSERR: D (YES,WTORTN,NO,) BUS ERR RETRIED */                        16700000
*/* P (,RETRY) SET BUS ERR RETRIED */                                   16800000
*/*MODTWO: D (YES,INPERR,NO,) INPUT ERROR */                            16900000
*/* D (YES,OUTERR,NO,) OUTPUT ERROR */                                  17000000
*/* D (YES,,NO,TESTST) EQUIP CHECK */                                   17100000
*/* D (YES,WTORTN,NO,) ERROR RETRIED */                                 17200000
*/* P (,RETRY) SET EQUIP CHECK RETRIED */                               17300000
*/*RETRY: S SVC 15: ERROR EXCP */                                       17400000
*/* R SVC 3 */                                                          17500000
*/*INPERR: D (YES,WTORTN,NO,) INPUT ERR RETRIED */                      17600000
*/* P (,RETRY) SET INPUT ERR RETRIED */                                 17700000
*/*OUTERR: D (YES,WTORTN,NO,) OUTPUT ERR RETRIED */                     17800000
*/* P (,RETRY) SET OUTPUT ERR RETRIED */                                17900000
*/*SEROUT: P INDICATE LOGOUT REQUIRED */                                18000000
*/*PERMER: P INDICATE PERMANENT ERROR */                                18100000
*/*RESET: P CLEAR ALL RETRY FLAGS */                                    18200000
*/* P (,XCTL) LOAD STAT UPDATE ROUTINE NAME */                          18300000
*/*MOD1BSC: D (YES,,NO,CKINTREQ) EQUIP CHECK */                         18400000
*/* D (YES,NOERR,NO,WTORTN) ATTENTION */                                18500000
*/*CKINTREQ: D (YES,WTORTN,NO,SEROUT) INT REQ */                        18600000
*/*RECOVER: D (YES,ASROUT,NO,) ICC OR CCC RETRIED */                    18700000
*/* D (YES,ASROUT,NO,) IOSB INTERCEPT */                                18800000
*/* D (YES,ASROUT,NO,) UNCOND NO RETRY */                               18900000
*/* D (YES,MORETEST,NO,RETRY2) ERPIB CODE 2 */                          19000000
*/*RETRY2: P SET ICC OR CCC RETRIED */                                  19100000
*/* P (,RETRY) ZERO OUT ERPIB */                                        19200000
*/*MORETEST: D (YES,SIOTST,NO,) SIO */                                  19300000
*/* D (YES,,NO,ASROUT) VALID COMMAND */                                 19400000
*/* P FIND PREVIOUS CCW */                                              19500000
*/* D (YES,ASROUT,NO,) PAST START OF CCWS */                            19600000
*/*CONTCCW: D (YES,ASROUT,NO,) READXY */                                19700000
*/* D (YES,ASROUT,NO,RETRY2) READMI */                                  19800000
*/*SIOTST: P (,CONTCCW) POINT TO SIO CCW AND IOSB */        D11 ZA14030 19900000
*/*ASROUT: P (,WTORTN) ZERO ERPIB */                                    20000000
*/*WTORTN: D (YES,SEROUT,NO,) OP CONSOLE */                             20100000
*/* P SET PERM ERROR AND LOGOUT REQUIRED */                             20200000
*/* P CLEAR RETRY INDICATORS */                                         20300000
*/* P (,XCTL) LOAD WTO ROUTINE NAME */                                  20400000
*/*XCTL: P MOVE SENSE TO STAT ROUTINE FIELD IN IOSB */                  20500000
*/* R BRANCH REG 14 */                                                  20600000
         EJECT                                                          20700000
         USING *,BASERG                                                 20800000
         LR    BASERG,ERREG2       BASE PROGRAM                         20900000
         USING EWA,ERPWAREG                                             21000000
         USING CVTMAP,CVTREG                                            21100000
         USING IOSB,IOSBREG                                             21200000
         USING UCBSET,UCBREG                                            21300000
         USING IOBSTDRD,IOBREG                                          21400000
         USING RQE,RQEREG                                               21500000
         LR    IOSBREG,PARMREG          LOAD IOSB POINTER               21600000
         L     CVTREG,CVTPTR            LOAD CVT POINTER                21700000
         L     UCBREG,IOSUCB            BASE UCB                        21800000
         L     ERPWAREG,IOSERP          LOAD ERP WORKAREA POINTER       21900000
         L     RQEREG,IOSUSE            BASE RQE                        22000000
         L     IOBREG,RQEIOB            BASE IOB                        22100000
         DROP  RQEREG                                                   22200000
         CLI   IOSDVRID,IOSXCPID        EXCP I/O                        22300000
         BNE   PERMER                   NO,PERM ERROR                   22400000
         TM    IOSFLA,IOSERR           FIRST ENTRY                      22500000
         BO    START                   NO                               22600000
         XC    EWASTUP(N2),EWASTUP     CLEAR STAT UPDATE AREA           22700000
START    EQU   *                                                        22800000
         OI    IOSFLA,IOSERR+IOSEX      TURN ON ERROR BITS IN IOSB      22900000
         OI    IOBFLAG1,IOBERRTN+IOBIOERR   ALSO IN IOB                 23000000
         OI    IOBERRCT,HEX01+HEX02     FLAGS FOR CHANNEL END APPENDAGE 23100000
         TM    IOSTSB,ASRCHK            TEST FOR CCC OR ICC             23200000
         BNZ   RECOVER                  ANY OR ALL ON                   23300000
         TM    IOSTSB,CHAIN             SHOULD NOT OCCUR STATUS         23400000
         BNZ   SEROUT                   BRANCH IF ANY OR ALL SET        23500000
         TM    UCBTBYT1,MODEL2          2250 MODEL 2 OR 3               23600000
         BO    MODEL23                  YES                             23700000
         TM    UCBTBYT1,MODEL1          2250 MODEL 1                    23800000
         BNO   SEROUT                   NO                              23900000
         TM    IOSTSA,BADSTAT1          BAD STATUS FOR MOD 1            24000000
         BNZ   SEROUT                   BRANCH IF ANY OR ALL            24100000
MODEL23  EQU   *                                                        24200000
         TM    IOSTSA,BADSTAT2          BAD STATUS FOR MOD 2/3          24300000
         BNZ   SEROUT                   BRANCH IF ANY OR ALL            24400000
         TM    IOSTSB,CDCBIT            CHECK IF CHAN RETRY POSSIBLE    24500000
         BNO   ER224                    IF CHANNEL OK, CONTINUE         24600000
         OI    EWASTUP+N1,HEX01         SET CDC FOR STAT UPDATE         24700000
ER224    EQU   *                                                        24800000
         TM    IOSTSA,UNITCK            UC PRIORITY OVER CDC            24900000
         BO    MAINER                   BRANCH IF UNIT CHECK PRESENT    25000000
TESTST   EQU   *                                                        25100000
         TM    IOSTSB,CDCBIT            CHECK IF CHAN RETRY POSSIBLE    25200000
         BNO   TESTCONT                 IF CHANNEL OK, CONTINUE         25300000
         TM    EWACNTR2,CDCIND          FIRST RETRY                     25400000
         BO    WTORTN                   IF NOT, NOTIFY OPERATOR         25500000
         OI    EWACNTR2,CDCIND          IF YES, SET SWITCH              25600000
         B     RETRY                    RESTART CHANNEL                 25700000
TESTCONT EQU   *                                                        25800000
         TM    IOSTSB,ST2ALL            PROGRAM CHECK/PROTECTION CHECK  25900000
         BNZ   PERMER                   BRANCH IF ANY OR ALL PRESENT    26000000
         TM    IOSTSB,INCLEN            INCORRECT LENGTH                26100000
         BNO   CLEARUC                  NO                              26200000
         NI    IOBERRCT,N255-HEX02      RESET ERP ENTERED               26300000
         B     PERMER                   GO SET REST OF INDICATORS       26400000
CLEARUC  EQU   *                                                        26500000
         NI    IOSTSA,N255-UNITCK       RESET UNIT CHECK STATUS         26600000
NOERR    EQU   *                                                        26700000
         NI    IOSFLA,N255-IOSEX-IOSERR   CLEAR IOSB ERROR FLAGS        26800000
         NI    IOBFLAG1,N255-IOBERRTN-IOBIOERR   ALSO IN IOB            26900000
         NI    IOSFLB,N255-IOSMSG-IOSLOG   CLEAR IOSB ERROR FLAGS       27000000
         NI    IOBERRCT,N255-HEX02      RESET ERP ENTERED               27100000
         B     RESET                    LEAVE                           27200000
MAINER   EQU   *                                                        27300000
         USING IHADCB,ERREG5                                            27400000
         L     ERREG5,IOBDCBPT          BASE DCB                        27500000
         NI    DCBIFLGS,N255-DCBIFEC    RESET ERROR CORRECTION FLAGS    27600000
         DROP  ERREG5                                                   27700000
         CLI   IOSCOD,IOSFINTC          IOSB INTERCEPT                  27800000
         BE    SEROUT                   IF YES TAKE BRANCH              27900000
         TM    UCBTBYT1,MODEL2          2250 MOD 2 OR 3                 28000000
         BO    MODL23                   YES                             28100000
         TM    UCBTBYT1,MODEL1          2250 MOD 1                      28200000
         BNO   SEROUT                   NO                              28300000
         TM    IOSSNS,SNOCUR            SHOULD NOT OCCUR SENSE          28400000
         BNZ   MOD1BSC                  TEST FOR EC OR IR               28500000
         TM    IOSSNS+N1,SNOCUR12       SHOULD NOT OCCUR MOD 1 SENSE    28600000
         BNZ   SEROUT                   BRANCH IF ANY OR ALL PRESENT    28700000
         B     NEXT                     CONTINUE TESTING                28800000
MODL23   EQU   *                                                        28900000
         TM    IOSSNS,SNOCUR2           TEST FOR SHOULD NOT OCCUR       29000000
         BNZ   CKINTREQ                 ANY OR ALL PRESENT              29100000
         TM    IOSSNS+N1,SNOCUR22       TEST FOR SHOULD NOT OCCUR       29200000
         BNZ   SEROUT                   ANY OR ALL PRESENT              29300000
NEXT     EQU   *                                                        29400000
         TM    IOSSNS,CRJBRN            COMMAND REJECT/BUFFER RUNNING   29500000
         BO    SEROUT                   BRANCH IF BOTH PRESENT          29600000
         TM    IOSTSA,CHNEND+DEVEND     CHAN END/DEV END                29700000
         BO    ISCEDE                   BRANCH IF YES                   29800000
         TM    IOSTSA,ATTENT            TEST FOR ATTENTION              29900000
         BO    NOERR                    BRANCH IF PRESENT               30000000
         TM    IOSSNS,BUSOUT            TEST FOR BUS OUT CHECK          30100000
         BO    BO1CHK                   BRANCH IF PRESENT               30200000
         TM    IOSSNS,CRJBRN+DATACK     COMMAND REJECT/DATA CHECK       30300000
*                                       OR BUFFER RUNNING               30400000
         BNZ   PERMER                   BRANCH ANY OR ALL PRESENT       30500000
         TM    IOSSNS,EQPCHK            EQUIPMENT CHECK                 30600000
         BO    MOD1BSC                  YES                             30700000
         TM    IOSSNS+N1,INCHK+OUTCHK   INPUT/OUTPUT CHECK              30800000
         BNZ   SEROUT                   BRANCH ANY OR ALL PRESENT       30900000
         B     TESTST                   BRANCH                          31000000
BO1CHK   EQU   *                                                        31100000
         TM    EWACNTR1,BO1IND          HAS ERROR BEEN RETRIED          31200000
         BO    WTORTN                   BRANCH IF YES                   31300000
         OI    EWACNTR1,BO1IND          SET RETRY INDICATOR             31400000
         B     RETRY                    BRANCH TO RETRY EXIT            31500000
ISCEDE   EQU   *                                                        31600000
         TM    IOSSNS,BUSOUT            TEST FOR BUS OUT                31700000
         BO    BUSERR                   BRANCH IF YES                   31800000
         TM    IOSSNS,DATACK            TEST FOR DATA CHECK             31900000
         BO    DATACX                   BRANCH IF YES                   32000000
         TM    UCBTBYT1,MODEL2          2250 MODEL 2 OR 3               32100000
         BO    MODTWO                   YES                             32200000
         B     TESTST                   BRANCH                          32300000
DATACX   EQU   *                                                        32400000
         TM    EWACNTR1,DC1IND          HAS ERROR BEEN RETRIED          32500000
         BO    WTORTN                   BRANCH IF YES                   32600000
         OI    EWACNTR1,DC1IND          SET RETRY INDICATOR             32700000
         B     RETRY                    BRANCH                          32800000
BUSERR   EQU   *                                                        32900000
         TM    EWACNTR1,BO2IND          HAS ERROR BEEN RETRIED          33000000
         BO    WTORTN                   BRANCH IF YES                   33100000
         OI    EWACNTR1,BO2IND          TURN ON RETRY INDICATOR         33200000
         B     RETRY                    BRANCH                          33300000
MODTWO   EQU   *                                                        33400000
         TM    IOSSNS+N1,INCHK          TEST FOR INPUT CHECK            33500000
         BO    INPERR                   BRANCH IF PRESENT               33600000
         TM    IOSSNS+N1,OUTCHK         TEST FOR OUTPUT CHECK           33700000
         BO    OUTERR                   BRANCH IF PRESENT               33800000
         TM    IOSSNS,EQPCHK            TEST FOR EQUIPMENT CHECK        33900000
         BZ    TESTST                   BRANCH IF NOT EQUIPMENT CHECK   34000000
         TM    EWACNTR1,ECIND           HAS ERROR BEEN RETRIED          34100000
         BO    WTORTN                   BRANCH IF YES                   34200000
         OI    EWACNTR1,ECIND           SET RETRY INDICATOR             34300000
RETRY    EQU   *                                                        34400000
         SVC   EXCPER                   ERROR EXECUTE CHANNEL PROGRAM   34500000
         SVC   RETURN                   RETURN TO SUPERVISOR            34600000
INPERR   EQU   *                                                        34700000
         TM    EWACNTR1,INPIND          HAS ERROR BEEN RETRIED          34800000
         BO    WTORTN                   BRANCH IF YES                   34900000
         OI    EWACNTR1,INPIND          SET RETRY INDICATOR             35000000
         B     RETRY                    BRANCH TO RETRY EXIT            35100000
OUTERR   EQU   *                                                        35200000
         TM    EWACNTR1,OUTIND          HAS ERROR BEEN RETRIED          35300000
         BO    WTORTN                   BRANCH IF YES                   35400000
         OI    EWACNTR1,OUTIND          SET RETRY INDICATOR             35500000
         B     RETRY                    BRANCH TO RETRY EXIT            35600000
SEROUT   EQU   *                                                        35700000
         OI    IOSFLB,IOSLOG            LOGOUT REQUIRED                 35800000
PERMER   EQU   *                                                        35900000
         NI    IOSFLA,N255-IOSERR       PERMANENT ERROR                 36000000
         NI    IOBFLAG1,N255-IOBERRTN   ALSO IN IOB                     36100000
RESET    EQU   *                                                        36200000
         XC    EWACNTR1(N2),EWACNTR1    RESET RETRY INDICATORS          36300000
         LA    ERREG3,ERRNM1            LOAD STAT ROUTINE ID            36400000
         B     XCTL                     GO TO XCTL TO STAT ROUTINE      36500000
MOD1BSC  EQU   *                                                        36600000
         TM    IOSSNS,N255-ECIND        EQUIPMENT CHECK                 36700000
         BNZ   CKINTREQ                 IF NOT GO CHECK INT. REQ.       36800000
         TM    IOSTSA,ATTENT            TEST FOR ATTENTION              36900000
         BO    NOERR                    IF PRESENT TAKE BRANCH          37000000
         B     WTORTN                   SET AS PERMANENT ERROR          37100000
CKINTREQ EQU   *                                                        37200000
         TM    IOSSNS,INTREQ            INTERVENTION REQUIRED           37300000
         BNO   SEROUT                   IF NOT GO LOG ERROR             37400000
         B     WTORTN                   PERMANENT ERROR AND MESSAGE     37500000
RECOVER  EQU   *                                                        37600000
         TM    EWACNTR2,ICCCCC          HAS OPERATION BEEN RETRIED      37700000
         BO    ASROUT                   GO TO PERM ERROR IF YES         37800000
         CLI   IOSCOD,IOSFINTC          IOSB INTERCEPT                  37900000
         BE    ASROUT                   YES, GO POST IT AS PERM         38000000
         TM    EWARGFG1,EWANORTY        IS NO RETRY BIT SET             38100000
         BO    ASROUT                   YES, PERM ERROR                 38200000
         TM    EWAXCSW2,HEX80           CODE GREATER THAN OR EQUAL 2    38300000
         BO    MORETEST                 IF YES, TEST FURTHER            38400000
RETRY2   EQU   *                                                        38500000
         OI    EWACNTR2,ICCCCC          TURN ON RETRY BIT               38600000
         XC    EWAERPIB(N8),EWAERPIB    ZERO ERPIB                      38700000
         B     RETRY                    GO RETRY OPERATION              38800000
MORETEST EQU   *                                                        38900000
         TM    EWARGFG1,HEX80           TEST FOR START I/O              39000000
         BO    SIOTST                   YES, GET START CCW ADR          39100000
         TM    EWAXCSW1,HEX04           CHECK FOR VALID COMMAND         39200000
         BNO   ASROUT                   NOT VALID, NO RETRY             39300000
         L     CCWREG,IOSCC             GET CCW ADDR                    39400000
         LA    CCWREG,ZERO(CCWREG)      GET RID OF UNWANTED BYTE        39500000
         SH    CCWREG,EIGHT             SUBRACT 8                       39600000
         LTR   CCWREG,CCWREG            ADDRESS NEGATIVE                39700000
         BM    ASROUT                   YES, ERROR                      39800000
CONTCCW  EQU   *                                                        39900000
         CLI   ZERO(CCWREG),READXY      CHECK FOR READXY COMMAND        40000000
         BE    ASROUT                   NO RETRY IF YES                 40100000
         CLI   ZERO(CCWREG),READMI      CHECK FOR READMI COMMAND        40200000
         BE    ASROUT                   NO RETRY IF YES                 40300000
         OI    EWAFLG2,EWAWTEMP         INDICATE WRITE FOR UPDATE RTN   40400000
         B     RETRY2                   GO RETRY OPERATION              40500000
SIOTST   EQU   *                                                        40600000
         L     CCWREG,IOSRST            LOAD ADDRESS OF SIO CCW         40700000
         LR    PARMREG,CCWREG      SET AS PARAMETER            YM02594K 40800000
         L     ERREG2,CVTPTRV      POINT TO TRANSLATOR         YM02594K 40900000
         BALR  RTNREG,ERREG2       REAL TO VIRTUAL             YM02594K 41000000
         LTR   ERREG2,ERREG2       GOOD COMPLETION             YM02594K 41100000
         BNZ   SEROUT              NO, PERM ERROR              YM02594K 41200000
         LR    CCWREG,PARMREG      RESET CCW REG               YM02594K 41300000
         LR    PARMREG,IOSBREG     RESET PARMREG TO IOSB    D11 ZA14030 41400000
         B     CONTCCW                  CHECK CCW              YM02594K 41500000
ASROUT   EQU   *                                                        41600000
         XC    EWAERPIB(N8),EWAERPIB    CLEAR ERPIB                     41700000
WTORTN   EQU   *                                                        41800000
         TM    UCBSTAT,UCBSYSR          OPERATOR CONSOLE                41900000
         BO    SEROUT                   YES                             42000000
         OI    IOSFLB,IOSMSG+IOSLOG     PERM ERROR MSG AND LOGOUT       42100000
         NI    IOSFLA,N255-IOSERR       PERMANENT ERROR                 42200000
         NI    IOBFLAG1,N255-IOBERRTN   ALSO IN IOB                     42300000
         XC    EWACNTR1(N2),EWACNTR1    CLEAR RETRY INDICATORS          42400000
         LA    ERREG3,WTO               LOAD WTO ID                     42500000
XCTL     EQU   *                                                        42600000
         L     RTNREG,CVTXTLER          BRANCH ENTRY POINT OF XCTL      42700000
         BR    RTNREG                   BRANCH TO TRANSFER CONTROL      42800000
         EJECT                                                          42900000
**********                                                              43000000
*                                                                       43100000
*        CONSTANTS                                                      43200000
*                                                                       43300000
**********                                                              43400000
EIGHT    DC    H'8'                     EIGHT                           43500000
PACHAREA EQU   *                                                        43600000
         DC    20C'010A'               PATCH AREA FOR MAINTENANCE       43700000
         SPACE 2                                                        43800000
**********                                                              43900000
*                                                                       44000000
*        REGISTER DEFINITIONS                                           44100000
*                                                                       44200000
**********                                                              44300000
ERREG4   EQU   0                        WORK REG                        44400000
PARMREG  EQU   1                        PARAMETER REG                   44500000
ERREG1   EQU   3                        WORK REG                        44600000
CVTREG   EQU   4                        CVT BASE                        44700000
ERREG5   EQU   5                        WORK REG                        44800000
IOBREG   EQU   6                        IOB BASE                        44900000
ERPWAREG EQU   7                        ERP WORKAREA BASE               45000000
RQEREG   EQU   8                        RQE BASE                        45100000
CCWREG   EQU   9                        CHANNEL STATUS WORD REG         45200000
IOSBREG  EQU   10                       IOSB BASE                       45300000
UCBREG   EQU   11                       UCB BASE                        45400000
BASERG   EQU   12                       PROGRAM BASE                    45500000
ERREG3   EQU   13                       WORK REG                        45600000
RTNREG   EQU   14                       EXIT REG                        45700000
ERREG2   EQU   15                       WORK REG                        45800000
         SPACE 2                                                        45900000
**********                                                              46000000
*                                                                       46100000
*        MISCELLANEOUS EQUATES                                          46200000
*                                                                       46300000
**********                                                              46400000
ZERO     EQU   0                        ZERO                            46500000
N1       EQU   1                        ONE                             46600000
N2       EQU   2                        TWO                             46700000
N8       EQU   8                        EIGHT                           46800000
N9       EQU   9                        NINE                            46900000
N255     EQU   255                      MASK FOR AND IMMEDIATE          47000000
EXCPER   EQU   15                       ERROR EXCP (SVC 15)             47100000
RETURN   EQU   3                        RETURN TO SUPERVISOR (SVC 3)    47200000
WTO      EQU   253                      WRITE TO OPERATOR ROUTINE       47300000
ERRNM1   EQU   254                      STATICS UPDATE ROUTINE          47400000
HEX01    EQU   X'01'                    MASK                            47500000
HEX02    EQU   X'02'                    MASK                            47600000
HEX04    EQU   X'04'                    MASK                            47700000
HEX7D    EQU   X'7D'                    MASK                            47800000
HEX80    EQU   X'80'                    MASK                            47900000
         SPACE 2                                                        48000000
**********                                                              48100000
*                                                                       48200000
*        STATUS FLAGS                                                   48300000
*                                                                       48400000
**********                                                              48500000
ATTENT   EQU   X'80'                    ATTENTION                       48600000
STATSMOD EQU   X'40'                    STATUS MODIFIER                 48700000
CONTUEND EQU   X'20'                    CONTROL UNIT END                48800000
CHNEND   EQU   X'08'                    CHANNEL END                     48900000
DEVEND   EQU   X'04'                    DEVICE END                      49000000
UNITCK   EQU   X'02'                    UNIT CHECK                      49100000
UNITEXCP EQU   X'01'                    UNIT EXECPTION                  49200000
BADSTAT1 EQU   STATSMOD+CONTUEND+UNITEXCP   BAD STATUS MODEL 1          49300000
BADSTAT2 EQU   UNITEXCP                 BAD STATUS MODEL 2 OR 3         49400000
INCLEN   EQU   X'40'                    INCORRECT LENGTH                49500000
PROGCK   EQU   X'20'                    PROGRAM CHECK                   49600000
PROTCK   EQU   X'10'                    PROTECTION CHECK                49700000
CHAIN    EQU   X'01'                    CHAINING CHECK                  49800000
ST2ALL   EQU   PROGCK+PROTCK            PROGRAM AND PROTECTION CHECK    49900000
ASRCHK   EQU   X'06'                    TOTAL OF INTERFACE AND          50000000
*                                       CHANNEL CONTROL CHECKS          50100000
CDCBIT   EQU   X'08'                    CHANNEL DATA CHECK              50200000
         SPACE 2                                                        50300000
**********                                                              50400000
*                                                                       50500000
*        SENSE BITS                                                     50600000
*                                                                       50700000
**********                                                              50800000
COMREJ   EQU   X'80'                    COMMAND REJECT                  50900000
BUSOUT   EQU   X'20'                    BUS OUT                         51000000
EQPCHK   EQU   X'10'                    EQUIPMENT CHECK                 51100000
DATACK   EQU   X'08'                    DATA CHECK                      51200000
BUFRUN   EQU   X'02'                    BUFFER RUNNING                  51300000
CRJBRN   EQU   COMREJ+BUFRUN            COMMAND REJECT+BUFFER RUNNING   51400000
INTREQ   EQU   X'40'                    INTERVENTION REQUIRED           51500000
SNOCUR   EQU   X'55'                    BAD SENSE BYTE 0 MODEL 1        51600000
SNOCUR12 EQU   X'1F'                    BAD SENSE BYTE 1 MODEL 1        51700000
SNOCUR2  EQU   X'45'                    BAD SENSE BYTE 0 MODEL 2 OR 3   51800000
SNOCUR22 EQU   X'19'                    BAD SENSE BYTE 1 MODEL 2 OR 3   51900000
INCHK    EQU   X'02'                    2840 INPUT CHECK                52000000
OUTCHK   EQU   X'04'                    2840 OUTPUT CHECK               52100000
         SPACE 2                                                        52200000
**********                                                              52300000
*                                                                       52400000
*        ERROR RETRY INDICATORS                                         52500000
*                                                                       52600000
**********                                                              52700000
BO1IND   EQU   X'80'                    BUS OUT 1                       52800000
BO2IND   EQU   X'40'                    BUS OUT 2                       52900000
DC1IND   EQU   X'20'                    DATA CHECK 1                    53000000
ECIND    EQU   X'10'                    EQUIPMENT CHECK                 53100000
INPIND   EQU   X'08'                    2840 INPUT CHECK                53200000
OUTIND   EQU   X'04'                    2840 OUTPUT CHEK                53300000
ICCCCC   EQU   X'80'                    ICC AND CCC                     53400000
CDCIND   EQU   X'40'                    CHANNEL DATA CHECK              53500000
         SPACE 2                                                        53600000
**********                                                              53700000
*                                                                       53800000
*       MODEL TYPES USED WITH UCBTBYT1                                  53900000
*                                                                       54000000
**********                                                              54100000
MODEL1   EQU   X'31'                    2250 MODEL 1 ID                 54200000
MODEL2   EQU   X'32'                    2250 MODEL 2 ID                 54300000
         SPACE 2                                                        54400000
**********                                                              54500000
*                                                                       54600000
*        COMMAND CODES                                                  54700000
*                                                                       54800000
**********                                                              54900000
READXY   EQU   X'12'                    READ X - Y REGISTERS            55000000
READMI   EQU   X'0E'                    READ MANUAL INPUT               55100000
         EJECT                                                          55200000
CVTSET   DSECT                                                          55300000
         CVT                                                            55400000
         EJECT                                                          55500000
         IECDIOSB                                                       55600000
         EJECT                                                          55700000
UCBSET   DSECT                                                          55800000
         IEFUCBOB                                                       55900000
         EJECT                                                          56000000
         IEZIOB                                                         56100000
         EJECT                                                          56200000
         IECDRQE                                                        56300000
         EJECT                                                          56400000
         IECDERWA                                                       56500000
         EJECT                                                          56600000
         DCBD                                                           56700000
         END                                                            56800000
