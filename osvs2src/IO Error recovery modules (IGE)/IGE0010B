         TITLE 'IGE0010B - LOCAL 2260 ERROR RECOVERY PROCEDURE'         00100000
IGE0010B CSECT                                                          00200000
*********************************************************************** 00300000
*                                                                     * 00400000
* MODULE NAME:                                                        * 00500000
*    IGE0010B                                                         * 00600000
*                                                                     * 00700000
* DESCRIPTIVE NAME:                                                   * 00800000
*    LOCAL 2260 ERROR RECOVERY PROCEDURE                              * 00900000
*                                                                     * 01000000
* COPYRIGHT:                                                          * 01100000
*    NONE                                                             * 01200000
*                                                                     * 01300000
* STATUS:                                                             * 01400000
*    CHANGE LEVEL 000                                                 * 01500000
*                                                                     * 01600000
* FUNCTION:                                                           * 01700000
*    THIS MODULE IS THE ERP FOR LOCALLY ATTACHED DEVICES OF THE       * 01800000
*    2260 DISPAY SYSTEM. THE MODULE IS SCHEDULED BY IOS.              * 01900000
*    THE FOLLOWING FUNCTIONS ARE PERFORMED BY THIS MODULE:            * 02000000
*        * DETERMINES IF AN ERROR IS RETRYABLE BY THE ERP AND RETRIES * 02100000
*          THOSE THAT ARE.                                            * 02200000
*        * DETERMINES IF ERP RETRIES ARE SUCCESSFUL.                  * 02300000
*        * MAINTAINS THE STATISTICS TABLE FOR THE DEVICE.             * 02400000
*        * REQUESTS OBR LOGOUT WHEN REQUIRED.                         * 02500000
*        * REQUESTS INT REQ OR PERM ERROR MESSAGES WHEN REQUIRED.     * 02600000
*                                                                     * 02700000
* NOTES:                                                              * 02800000
*    DEPENDENCIES:                                                    * 02900000
*        NONE                                                         * 03000000
*    RESTRICTIONS:                                                    * 03100000
*        THIS ERP IS FOR LOCALLY ATTACHED DEVICES ONLY USING EXCP     * 03200000
*    REGISTER CONVENTIONS:                                            * 03300000
*        SEE 'REGISTER DEFINITION' BELOW                              * 03400000
*                                                                     * 03500000
* PATCH LABEL:                                                        * 03600000
*    PACHAREA (88 BYTES)                                              * 03700000
*                                                                     * 03800000
* MODULE TYPE:                                                        * 03900000
*    PROCEDURE                                                        * 04000000
*    PROCESSOR:                                                       * 04100000
*        BAL                                                          * 04200000
*    MODULE SIZE:                                                     * 04300000
*        882 BYTES                                                    * 04400000
*    ATTRIBUTES:                                                      * 04500000
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE, NO LOCKS HELD   * 04600000
*                                                                     * 04700000
* ENTRY POINT:                                                        * 04800000
*    IGE0010B                                                         * 04900000
*    PURPOSE:                                                         * 05000000
*        THIS MODULE IS ENTERED WHEN ONE OR MORE OF THE FOLLOWING     * 05100000
*        CONDITIONS IS ENCOUNTERED:                                   * 05200000
*            UNIT CHECK                                               * 05300000
*            UNIT EXCEPTION                                           * 05400000
*            INVALID COMMAND SEQUENCE                                 * 05500000
*            INCORRECT LENGTH                                         * 05600000
*            PROGRAM CHECK                                            * 05700000
*            PROTECTION CHECK                                         * 05800000
*            CHAINING CHECK                                           * 05900000
*            CHANNEL DATA CHECK                                       * 06000000
*            INTERFACE CONTROL CHECK                                  * 06100000
*            CHANNEL CONTROL CHECK                                    * 06200000
*            COMMAND REJECT                                           * 06300000
*    LINKAGE:                                                         * 06400000
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 06500000
*        SUPERVISOR. IT RUNS UNDER AN SIRB.                           * 06600000
*    INPUT:                                                           * 06700000
*        REG 1 = ADDRESS OF IOSB                                      * 06800000
*    OUTPUT:                                                          * 06900000
*        RECOVERABLE ERRORS:                                          * 07000000
*            IOSERR IS SET ON FOR RETRY                               * 07100000
*            IF A MESSAGE IS TO BE ISSUED, EXIT IS MADE TO IGE0025C   * 07200000
*            IF NO MESSAGE, SVC 15 IS ISSUED, THEN EXIT IS VIA SVC 3  * 07300000
*        CORRECTED ERRORS:                                            * 07400000
*            IOSEX AND IOSERR ARE SET OFF                             * 07500000
*            IOSB IS CLEANED UP                                       * 07600000
*            EXIT IS TO IGE0025D TO UPDATE STATISTICS TABLE           * 07700000
*        PERMANENT ERRORS:                                            * 07800000
*            AN OBR LOGOUT IS SCHEDULED                               * 07900000
*            A STATISTIC TABLE UPDATE IS SCHEDULED                    * 08000000
*            IOSEX IS SET ON                                          * 08100000
*            IOSERR IS SET OFF                                        * 08200000
*            EXIT IS TO IGE0025C TO ISSUE PERM ERROR MESSAGE          * 08300000
*        PROGRAMMING ERRORS:                                          * 08400000
*            SVC 15 IS ISSUED                                         * 08500000
*            IOSEX IS SET ON                                          * 08600000
*            IOSERR IS SET OFF                                        * 08700000
*            EXIT IS VIA SVC 3                                        * 08800000
*                                                                     * 08900000
* EXITS-NORMAL:                                                       * 09000000
*    SUPERVISOR VIA SVC 3                                             * 09100000
*    STATISTICS UPDATE ROUTINE (IGE0025D) VIA BRANCH ENTRY TO XCTL    * 09200000
*    IOS-WTO ROUTINE (IGE0025C) VIA BRANCH ENTRY TO XCTL              * 09300000
*                                                                     * 09400000
* EXITS-ERROR:                                                        * 09500000
*    NONE                                                             * 09600000
*                                                                     * 09700000
* EXTERNAL REFERENCES:                                                * 09800000
*    ROUTINES:                                                        * 09900000
*        SVC 15 ERROR EXCP                                            * 10000000
*    DATA AREAS                                                       * 10100000
*        CHANNEL PROGRAM                                              * 10200000
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 10300000
*    CONTROL BLOCKS                                                   * 10400000
*        UCB          (MAPPED BY IEFUCBOB)                            * 10500000
*        CVT          (MAPPED BY CVT)                                 * 10600000
*        IOSB         (MAPPED BY IECDIOSB)                            * 10700000
*        RQE          (MAPPED BY IECDRQE)                             * 10800000
*        IOB          (MAPPED BY IEZIOB)                              * 10900000
*                                                                     * 11000000
* TABLES-WORKAREAS:                                                   * 11100000
*    ERP WORKAREA                                                     * 11200000
*                                                                     * 11300000
* MACROS:                                                             * 11400000
*    NONE                                                             * 11500000
*                                                                     * 11600000
* CHANGE ACTIVITY:                                                    * 11700000
*A188000-190500,A215000-217500                              D11 YM02594 11800000
*A149200                                                    D11 ZA10438 11900000
*                                                                     * 12000000
*********************************************************************** 12100000
         EJECT                                                          12200000
*/*IGE0010B: CHART */                                                   12300000
*/* E IGE0010B */                                                       12400000
*/* D (YES,,NO,PERMER) EXCP */                                          12500000
*/* D (YES,,NO,START) FIRST ENTRY */                                    12600000
*/* P CLEAR EWASTUP */                                                  12700000
*/*START: P SET ERP IN CONTROL FLAGS */                                 12800000
*/* D (YES,RECOVER,NO,) CCC OR ICC */                                   12900000
*/* D (YES,SEROUT,NO,) INVALID STATUS */                                13000000
*/* D (YES,SEROUT,NO,) UNIT EXCEPTION */                                13100000
*/*TESTUC: D (YES,MAINER,NO,TESTST) UNIT CHECK */                       13200000
*/*TESTST: D (YES,TESTCONT,NO,) CHANNEL OK */                           13300000
*/* D (YES,WTORTN,NO,) CDC RETRIED */                                   13400000
*/* P (,RECOVER) SET CDC RETRIED */                                     13500000
*/*TESTCONT: D (YES,PERMER,NO,) PROT OR PROG CHECK */                   13600000
*/* D (YES,SEROUT,NO,) OUR CHAN PRG RUNNING */                          13700000
*/* D (YES,,NO,NOERRS) INT REQ */                                       13800000
*/* D (YES,NOERRS,NO,) INT REQ RETRIED */                               13900000
*/* P (,RETRY) SET INT REQ RETRIED */                                   14000000
*/*MAINER: D (YES,IS2260,NO,) DEVICE A 2260 */                          14100000
*/* D (YES,,NO,SEROUT) DEVICE A 1053 */                                 14200000
*/* D (YES,SEROUT,NO,AROUND) BAD SENSE */                               14300000
*/*IS2260: D (YES,CKINTREQ,NO,) BAD SENSE BYTE 1 */                     14400000
*/* D (YES,SEROUT,NO,AROUND) BAD SENSE BYTE 2 */                        14500000
*/*AROUND: D (YES,ISCEDE,NO,) CHAN END AND DEV END */                   14600000
*/* D (YES,PERMER,NO,) COMM REJECT */                                   14700000
*/* D (YES,,NO,CKBUSOUT) INT REQ */                                     14800000
*/* D (YES,WTORTN,NO,) 1053 INT REQ RETRIED */                          14900000
*/* P (,WTOIR) SET 1053 INT REQ RETRIED */                              15000000
*/*CKBUSOUT: D (YES,BO1,NO,TESTST) BUS OUT CHECK */                     15100000
*/*BO1: D (YES,WTORTN,NO,) BUSOUT RETRIED */                            15200000
*/* P (,RETRY) SET BUS OUT RETRIED */                                   15300000
*/*RETRY: S SVC 15: ERROR EXCP */                                       15400000
*/* R SVC 3 */                                                          15500000
*/*ISCEDE: D (YES,ISBUSOUT,NO,) BUSOUT CHECK */                         15600000
*/* D (YES,,NO,TESTST) EQUIP CHECK */                                   15700000
*/* D (YES,WTORTN,NO,) RETRIED */                                       15800000
*/* P (,RECOVER) SET EQUIP CHECK RETRIED */                             15900000
*/*ISBUSOUT: D (YES,WTORTN,NO,) BUSERR RETRIED */                       16000000
*/* P (,RECOVER) SET BUS ERROR RETRIED */                               16100000
*/*SEROUT: P (,PERMER) INDICATE LOGOUT REQUIRED */                      16200000
*/*PERMER: P (,RESET) INDICATE PERMANENT ERROR */                       16300000
*/*RESET: P (,POST) CLEAR RETRY FLAGS */                                16400000
*/*POST: P (,XCTLOUT) LOAD STAT TABLE UPDATE ROUTINE ID */              16500000
*/*NOERRS: P CLEAR ERROR FLAGS IN IOSB AND IOB */                       16600000
*/* P (,RESET) CLEAR STATUS INDICATORS */                               16700000
*/*WTORTN: D (YES,SEROUT,NO,) OP CONSOLE */                             16800000
*/* P CLEAR RETRY FLAGS */                                              16900000
*/* P (,WOPOST) SET PERM ERROR MESSAGE AND PERM ERROR */                17000000
*/*WOPOST: P (,WTOIR) INDICATE LOGOUT NEEDED */                         17100000
*/*WTOIR: P (,XCTLOUT) LOAD WTO ROUTINE ID */                           17200000
*/*XCTLOUT: P MOVE SENSE INTO STAT ROUTINE COMM AREA */                 17300000
*/* R BRANCH REG 14 */                                                  17400000
*/*CKINTREQ: D (YES,WTORTN,NO,SEROUT) INT REQ */                        17500000
*/*RECOVER: D (YES,,NO,RESET1) IOSB INTERCEPT */                        17600000
*/* P (,ZERERPIB) RESET CODE TO X7F */                                  17700000
*/*RESET1: D (YES,ZERERPIB,NO,) UNCOND NO RETRY */                      17800000
*/* D (YES,ZERERPIB,NO,) ICC OR CCC RETRIED */                          17900000
*/* D (YES,RETRYB,NO,) SIO ERROR */                                     18000000
*/* D (YES,CAVALID,NO,ZERERPIB) RETRY CODE VALID */                     18100000
*/*CAVALID: P GET STARTING CCW */                                       18200000
*/* D (YES,SETSW,NO,) VALID ADDRESS */                                  18300000
*/* D (YES,ZERERPIB,NO,) CHAINING */                                    18400000
*/* S GETCMD: GET COMMAND CODE */                                       18500000
*/* P (,RTRY14) CHECK CODE */                                           18600000
*/*SETSW: S GETCMD: GET COMMAND CODE */                                 18700000
*/*RTRY14: D (YES,RETRYA,NO,) RETRY CODE 1 OR 4 */                      18800000
*/* D (YES,ZERERPIB,NO,) READ MI */                                     18900000
*/* D (YES,ZERERPIB,NO,) SHORT READ MI */                               19000000
*/* D (YES,,NO,RETRYA) WRITE BUFFER */                                  19100000
*/* D (YES,RETRYA,NO,) 1053 WRITE */                                    19200000
*/* D (YES,,NO,ZERERPIB) COMMAND CHAINED */                             19300000
*/* P POINT TO START OF CHANNEL PROGRAM */                              19400000
*/* D (YES,ZERERPIB,NO,TICTEST) IS FAILING CCW FIRST CCW */             19500000
*/*TICTEST: D (YES,TICTEST2,NO,) IS IT A TIC */                         19600000
*/* P (,TICTEST1) POINT TO NEXT CCW */                                  19700000
*/*TICTEST1: D (YES,TICTESTX,NO,TICTEST) FOUND FAILING CCW */           19800000
*/*TICTEST2: P (,TICTEST1) POINT TO NEXT CCW */                         19900000
*/*TICTESTX: P GET PREVIOUS CCW */                                      20000000
*/* D (YES,,NO,ZERERPIB) IS PREVIOUS AN ERASE COMMAND */                20100000
*/* P (,RETRYA) RESTORE FAILING CCW ADDRESS */                          20200000
*/*RETRYA: D (YES,,NO,RETRYB) COMMAND CHAINED */                        20300000
*/* P (,RETRYB) STORE BAD CCW AS RESTART ADDRESS */                     20400000
*/*RETRYB: D (YES,,NO,RETRY) ICC OR CCC */                              20500000
*/* P ZERO ERPIB */                                                     20600000
*/* P (,RETRY) SET ICC AND CCC RETRIED */                               20700000
*/*ZERERPIB: P (,WTORTN) ZERO ERPIB */                                  20800000
*/*GETCMD: E GETCMD */                                                  20900000
*/* P GET COMMAND ADDR FROM CSW */                                      21000000
*/* P SUBTRACT 8 FROM COMMAND ADDRESS */                                21100000
*/* D (YES,ZERERPIB,NO,) PAST CCW 1 */                                  21200000
*/* P MOVE COMMAND CODE TO WORK AREA */                                 21300000
*/* R BRANCH REG */                                                     21400000
         EJECT                                                          21500000
         USING *,BASERG                                                 21600000
         LR    BASERG,ERREG15      BASE MODULE                          21700000
         USING EWA,EWAREG                                               21800000
         USING UCBSET,UCBREG                                            21900000
         USING CVTMAP,CVTREG                                            22000000
         USING IOSB,IOSBREG                                             22100000
         USING RQE,ERREG2                                               22200000
         USING IOBSTDRD,IOBREG                                          22300000
         LR    IOSBREG,PARMREG     BASE IOSB                            22400000
         L     CVTREG,CVTPTR       BASE CVT                             22500000
         L     UCBREG,IOSUCB       BASE UCB                             22600000
         L     EWAREG,IOSERP       BASE EWA                             22700000
         L     ERREG2,IOSUSE       BASE RQE                             22800000
         L     IOBREG,RQEIOB       BASE IOB                             22900000
         DROP  ERREG2                                                   23000000
         CLI   IOSDVRID,IOSXCPID   EXCP I/O                             23100000
         BNE   PERMER              NO, PERM ERROR                       23200000
         TM    IOSFLA,IOSERR       FIRST TIME THROUGH                   23300000
         BO    START               NO                                   23400000
         XC    EWASTUP(N2),EWASTUP   CLEAR OUT STAT UPDATE DATA         23500000
START    EQU   *                                                        23600000
         OI    IOSFLA,IOSERR+IOSEX   ERP IN CONTROL AND PERMANENT ERROR 23700000
         OI    IOBFLAG1,IOBERRTN+IOBIOERR   ALSO IN IOB                 23800000
         OI    IOBERRCT,HEX01+HEX02   FLAGS FOR CHANNEL END APPENDAGE   23900000
         TM    IOSTSB,ASRCHK       TEST FOR CCC OR ICC                  24000000
         BNZ   RECOVER             ANY OR ALL ON                        24100000
         TM    IOSTSB,CHAIN        SHOULD NOT OCCUR STATUS              24200000
         BO    SEROUT              BRANCH IF PRESENT                    24300000
         TM    IOSTSA,UNTEXC       UNIT EXCEPTION                       24400000
         BO    SEROUT              BRANCH IF PRESENT                    24500000
         TM    IOSTSB,CDCBIT       CHECK IF CHANNEL RETRY POSSIBLE      24600000
         BNO   TESTUC              IF CHANNEL OK, CONTINUE              24700000
         OI    EWASTUP+N1,X01      SET CDC IN STAT UPDATE DATA          24800000
TESTUC   EQU   *                                                        24900000
         TM    IOSTSA,UNITCK       UNIT CHECK                           25000000
         BO    MAINER              BRANCH IF YES                        25100000
TESTST   EQU   *                                                        25200000
         TM    IOSTSB,CDCBIT       CHECK IF CHANNEL RETRY POSSIBLE      25300000
         BNO   TESTCONT            IF CHANNEL OK, CONTINUE              25400000
         TM    EWACNTR1,CDCIND     FIRST RETRY                          25500000
         BO    WTORTN              NO                                   25600000
         OI    EWACNTR1,CDCIND     IF YES, SET SWITCH                   25700000
         B     RECOVER             CHECK FOR RETRY                      25800000
TESTCONT EQU   *                                                        25900000
         TM    IOSTSB,PROGCK+PROTCK  PROGRAM AND PROTECTION CHECK       26000000
         BNZ   PERMER              BRANCH IF PRESENT                    26100000
         TM    EWACNTR1,ECRTRY     IS ERR RTN CHAN PRG IN CONTROL       26200000
         BO    SEROUT              YES                                  26300000
         TM    IOBERRCT+N1,INTREQFD   WAS INTERVENTION                  26400000
*                                  REQUIRED FOUND                       26500000
         BZ    NOERRS              NO                                   26600000
         TM    IOBERRCT+N1,INTREQRY   HAS INTERVENTION                  26700000
*                                  REQUIRED BEEN RETRIED                26800000
         BO    NOERRS              YES                                  26900000
         OI    IOBERRCT+N1,INTREQRY   SET INTERVENTION                  27000000
*                                  REQUIRED RETRY SWITCH                27100000
         B     RETRY               GO RETRY                             27200000
MAINER   EQU   *                                                        27300000
         CLI   UCBTBYT4,A2260      IS DEVICE A 2260                     27400000
         BE    IS2260              YES                                  27500000
         CLI   UCBTBYT4,A1053      IS DEVICE A 1053                     27600000
         BNE   SEROUT              NO                                   27700000
         TM    IOSSNS,SNOCUR3      SHOULD NOT OCCUR 1053 SENSE          27800000
         BNZ   SEROUT              BRANCH IF ANY OR ALL PRESENT         27900000
         TM    IOSSNS+N1,SNOCUR32   SHOULD NOT OCCUR SECOND BYTE SENSE  28000000
         BNZ   SEROUT              BRANCH IF ANY OR ALL PRESENT         28100000
         B     AROUND              BRANCH                               28200000
IS2260   EQU   *                                                        28300000
         TM    IOSSNS,SNOCUR0      SHOULD NOT OCCUR 2260 SENSE          28400000
         BNZ   CKINTREQ            BRANCH IF ANY OR ALL                 28500000
         TM    IOSSNS+N1,SNOCUR02   SHOULD NOT OCCUR SECOND BYTE SENSE  28600000
         BNZ   SEROUT              BRANCH IF ANY OR ALL PRESENT         28700000
AROUND   EQU   *                                                        28800000
         TM    IOSTSA,CHNEND+DEVEND  CHANNEL END AND DEVICE END         28900000
         BO    ISCEDE              BRANCH IF BOTH PRESENT               29000000
         TM    IOSSNS,CMDREJ       COMMAND REJECT                       29100000
         BO    PERMER              BRANCH IF PRESENT                    29200000
         TM    IOSSNS,INTREQ       INTERVENTION REQUIRED                29300000
         BNO   CKBUSOUT            NO                                   29400000
         TM    IOBERRCT+N1,INTREQRY   PREVIOUS INTERVENTION             29500000
*                                  REQUIRED RETRIED ON 1053             29600000
         BO    WTORTN              YES                                  29700000
         OI    IOBERRCT+N1,INTREQFD   SET FOUND FLAG FOR                29800000
*                                  INTERVENTION REQUIRED                29900000
         B     WTOIR               GO NOTIFY OPERATOR                   30000000
CKBUSOUT EQU   *                                                        30100000
         TM    IOSSNS,BUSOUT       BUS OUT CHECK                        30200000
         BNO   TESTST              NO                                   30300000
BO1      EQU   *                                                        30400000
         TM    EWACNTR1,BO1IND     HAS ERROR BEEN RETRIED               30500000
         BO    WTORTN              YES                                  30600000
         OI    EWACNTR1,BO1IND     SET RETRY INDICATOR                  30700000
RETRY    EQU   *                                                        30800000
         LR    PARMREG,IOSBREG     RESTORE POINTER TO IOSB  D11 ZA10438 30900000
         SVC   EXCPER              ERROR EXECUTE CHANNEL PROGRAM        31000000
         SVC   EXIT                RETURN TO IOS                        31100000
ISCEDE   EQU   *                                                        31200000
         TM    IOSSNS,BUSOUT       BUS OUT CHECK                        31300000
         BO    ISBUSOUT            YES                                  31400000
         TM    IOSSNS,EQPCHK       EQUIPMENT CHECK                      31500000
         BNO   TESTST              NO                                   31600000
         TM    EWACNTR1,IOBEC      PREVIOUS RETRY                       31700000
         BO    WTORTN              YES                                  31800000
         OI    EWACNTR1,IOBEC      TURN ON RETRY FLAG                   31900000
         B     WTORTN              CONTINUE                             32000000
ISBUSOUT EQU   *                                                        32100000
         TM    EWACNTR1,BO2IND     PREVIOUS RETRY                       32200000
         BO    WTORTN              YES                                  32300000
         OI    EWACNTR1,BO2IND     SET RETRY INDICATOR                  32400000
         B     RECOVER             CHECK FOR RETRY                      32500000
SEROUT   EQU   *                                                        32600000
         OI    IOSFLB,IOSLOG       INDICATE LOG OUT REQUIRED            32700000
PERMER   EQU   *                                                        32800000
         NI    IOSFLA,N255-IOSERR   INDICATE PERMANENT ERROR            32900000
         NI    IOBFLAG1,N255-IOBERRTN   ALSO IN IOB                     33000000
RESET    EQU   *                                                        33100000
         MVI   IOBERRCT+N1,ZERO    RESET INTERVENTION REQUIRED FLAGS    33200000
         MVI   EWACNTR1,ZERO       RESET RETRY INDICATORS               33300000
         MVI   EWACNTR2,ZERO       RESET RETRY INDICATORS               33400000
POST     EQU   *                                                        33500000
         LA    ERREG13,ERRNM1      LOAD STAT UPDATE ROUTINE ID          33600000
         B     XCTLOUT             XCTL TO IT                           33700000
NOERRS   EQU   *                                                        33800000
         NI    IOSFLA,N255-IOSEX-IOSERR   CLEAR ERROR FLAGS IN IOSB     33900000
         NI    IOBFLAG1,N255-IOBERRTN-IOBIOERR   ALSO IN IOB            34000000
         NI    IOSFLB,N255-IOSLOG-IOSMSG   CLEAR ERROR FLAGS IN IOSB    34100000
         NI    IOSTSA,UCUEXFC      CLEAR STATUS                         34200000
         NI    IOSTSB,ILXBF        CLEAR STATUS                         34300000
         NI    IOBERRCT,N255-HEX02   RESET ERP ENTERED                  34400000
         B     RESET               BRANCH                               34500000
WTORTN   EQU   *                                                        34600000
         TM    UCBSTAT,UCBSYSR     IS THIS AN OPERATOR'S CONSOLE        34700000
         BO    SEROUT              YES                                  34800000
         MVI   IOBERRCT+N1,ZERO    RESET INTERVENTION REQUIRED FLAGS    34900000
         MVI   EWACNTR2,ZERO       RESET RETRY INDICATORS               35000000
         MVI   EWACNTR1,ZERO       RESET RETRY INDICATORS               35100000
         NI    IOSFLA,N255-IOSERR   INDICATE PERMANENT ERROR            35200000
         NI    IOBFLAG1,N255-IOBERRTN   ALSO IN IOB                     35300000
         OI    IOSFLB,IOSMSG       INDICATE PERM ERROR MESSAGE          35400000
WOPOST   EQU   *                                                        35500000
         OI    IOSFLB,IOSLOG       INDICATE LOGOUT NEEDED               35600000
WTOIR    EQU   *                                                        35700000
         LA    ERREG13,WTO         LOAD WTO ROUTINE ID                  35800000
XCTLOUT  EQU   *                                                        35900000
         L     RTNREG,CVTXTLER     LOAD ADDRESS OF XCTL                 36000000
         BR    RTNREG              BRANCH TO XCTL                       36100000
CKINTREQ EQU   *                                                        36200000
         TM    IOSSNS,N255-INTREQ   INTERVENTION REQUIRED ONLY          36300000
         BNZ   SEROUT              NO                                   36400000
         B     WTORTN              YES, GO POST AS PERMANENT ERROR      36500000
RECOVER  EQU   *                                                        36600000
         NI    EWACNTR1,N255-SWITCH   RESET SWITCH FOR CHAINING         36700000
         CLI   IOSCOD,IOSFINTC     INTERCEPT CONDITION                  36800000
         BNE   RESET1              NO                                   36900000
         MVI   IOSCOD,IOSNRMC      RESET TO X'7F'                       37000000
         B     ZERERPIB            EXIT                                 37100000
RESET1   EQU   *                                                        37200000
         TM    EWARGFG1,EWANORTY   IS NO RETRY SET                      37300000
         BO    ZERERPIB            YES, PERMANENT ERROR                 37400000
         TM    EWACNTR2,ICCCCC     PREVIOUS RETRY ICC/CCC               37500000
         BO    ZERERPIB            YES, PERMANENT ERROR                 37600000
         TM    IOSCC,SIOINSTR      ERROR ON SIO                         37700000
         BO    RETRYB              YES, GO ZERO ERPIB AND RETRY         37800000
         TM    EWAXCSW1,ERPVRTRY   IS RETRY CODE VALID                  37900000
         BZ    ZERERPIB            NO                                   38000000
         TM    EWAXCSW2,RETRY7     IS RETRY CODE ZERO                   38100000
         BZ    ZERERPIB            YES                                  38200000
         BO    CAVALID             IF SEVEN TAKE BRANCH                 38300000
         TM    EWAXCSW2,RETRY6     IS RETRY CODE SIX                    38400000
         BO    ZERERPIB            YES, PERMANENT ERROR                 38500000
CAVALID  EQU   *                                                        38600000
         L     PARMREG,IOSRST      GET STARTING CCW            YM02594K 38700000
         L     ERREG15,CVTPTRV     POINT TO TRANSALTOR         YM02594K 38800000
         BALR  RTNREG,ERREG15      REAL TO VIRTUAL             YM02594K 38900000
         LTR   ERREG15,ERREG15     GOOD COMPLETION             YM02594K 39000000
         BNZ   SEROUT              NO, PERM ERROR              YM02594K 39100000
         LR    ERREG8,PARMREG      SET FOR TESTS               YM02594K 39200000
         TM    EWAXCSW1,ERPVCMAD   IS COMMAND ADDRESS VALID             39300000
         BO    SETSW               YES                                  39400000
         TM    N4(ERREG8),CCWCHAIN   CHAINING ON                        39500000
         BNZ   ZERERPIB            YES                                  39600000
         BAL   RTNREG,GETCMD       GET COMMAND CODE                     39700000
         B     RTRY14              RETRY                                39800000
SETSW    EQU   *                                                        39900000
         BAL   RTNREG,GETCMD       GET COMMAND CODE                     40000000
         LA    ERREG8,ZERO(ERREG8)   CLEAR HI-ORDER BYTE                40100000
         CR    ERREG8,ERREG6       START CCW EQUAL FAILING CCW          40200000
         BE    RTRY14              YES                                  40300000
         OI    EWACNTR1,SWITCH     SET SWITCH FOR RESTART               40400000
RTRY14   EQU   *                                                        40500000
         TM    EWAXCSW2,RETRY1     RETRY CODE 1                         40600000
         BZ    RETRYA              YES                                  40700000
         TM    EWAXCSW2,RETRY4     RETRY CODE OF FOUR                   40800000
         BZ    RETRYA              YES                                  40900000
         CLI   EWACNTR3,RDMI       COMMAND READ MI                      41000000
         BE    ZERERPIB            YES                                  41100000
         CLI   EWACNTR3,SRDMI      COMMAND SHORT RD MI                  41200000
         BE    ZERERPIB            YES                                  41300000
         CLI   EWACNTR3,WRTDSB     COMMAND WRITE BUFFER                 41400000
         BNE   RETRYA              NO                                   41500000
         CLI   UCBTBYT4,A1053      IS WRITE TO 1053                     41600000
         BE    RETRYA              IF YES CHECK CHAINING                41700000
         TM    EWAXCSW2,HEX01      IS RETRY CODE TWO                    41800000
         BZ    RETRYA              YES                                  41900000
         TM    EWACNTR1,SWITCH     IS COMMAND CHAINED                   42000000
         BZ    ZERERPIB            NO CHAINING, PERMANENT ERROR         42100000
*                                  THE FOLLOWING CODE PERFORMS          42200000
*                                  A ONE CCW BACK UP FUNCTION TO        42300000
*                                  TEST THE CCW IN FRONT OF THE         42400000
*                                  FAILING ONE                          42500000
         L     RTNREG,IOSVST       POINT TO START OF CCWS               42600000
         CLC   ZERO(N8,RTNREG),ZERO(ERREG6)   FIRST COMMAND             42700000
         BE    ZERERPIB            YES, NO ERASE COMMAND                42800000
TICTEST  EQU   *                                                        42900000
         CLI   ZERO(RTNREG),TIC    TIC                                  43000000
         BE    TICTEST2            YES                                  43100000
         LR    ERREG7,RTNREG       SAVE OLD ADDRESS                     43200000
         LA    RTNREG,N8(RTNREG)   POINT TO NEXT CCW                    43300000
TICTEST1 EQU   *                                                        43400000
         CLC   ZERO(N8,RTNREG),ZERO(ERREG6)   FOUND FAILING             43500000
         BE    TICTESTX            YES, CHECK PREVIOUS FOR ERASE        43600000
         B     TICTEST             RESET, AND GO                        43700000
TICTEST2 EQU   *                                                        43800000
         L     RTNREG,ZERO(RTNREG)   POINT TO NEXT CCW                  43900000
         LA    RTNREG,ZERO(RTNREG)   CLEAR OUT OP CODE                  44000000
         LR    PARMREG,RTNREG      SET AS PARAMETER            YM02594K 44100000
         L     ERREG15,CVTPTRV     POINT TO TRANSLATOR         YM02594K 44200000
         BALR  RTNREG,ERREG15      REAL TO VIRTUAL             YM02594K 44300000
         LTR   ERREG15,ERREG15     GOOD COMPLETION             YM02594K 44400000
         BNZ   SEROUT              NO, PERM ERROR              YM02594K 44500000
         LR    RTNREG,PARMREG      RESET CCW REG               YM02594K 44600000
         B     TICTEST1            CHECK IT                             44700000
TICTESTX EQU   *                                                        44800000
         CLI   ZERO(ERREG7),ERASECMD   IS THIS AN ERASE COMMAND         44900000
         BNE   ZERERPIB            NO                                   45000000
         L     ERREG6,IOSCC        GET COMMAND POINTER                  45100000
         LA    ERREG6,ZERO(ERREG6)   CLEAR HIGH BYTE                    45200000
         SH    ERREG6,EIGHT        RESTORE FAILING CCW ADDRESS          45300000
RETRYA   EQU   *                                                        45400000
         TM    EWACNTR1,SWITCH     IS COMMAND CHAINED                   45500000
         BZ    RETRYB              NO, GO RETRY                         45600000
         LRA   ERREG6,ZERO(ERREG6)   GET REAL ADDRESS FOR IOS           45700000
         ST    ERREG6,IOSRST       STORE RESTART ADDRESS                45800000
RETRYB   EQU   *                                                        45900000
         TM    IOSTSB,ASRCHK       ICC OR CCC                           46000000
         BZ    RETRY               NO, JUST RETRY                       46100000
         XC    EWAERPIB(N8),EWAERPIB   ZERO ERPIB                       46200000
         OI    EWACNTR2,ICCCCC     SET ICC/CCC RETRY INDICATORS         46300000
         B     RETRY               RETRY                                46400000
GETCMD   EQU   *                                                        46500000
         L     ERREG6,IOSCC        GET COMMAND POINTER                  46600000
         LA    ERREG6,ZERO(ERREG6)   CLEAR HIGH BYTE                    46700000
         SH    ERREG6,EIGHT        GET FAILING CCW                      46800000
         LTR   ERREG6,ERREG6       ADDRESS NEGATIVE                     46900000
         BM    ZERERPIB            YES, ERROR                           47000000
         MVC   EWACNTR3(N1),ZERO(ERREG6)   GET CMD CODE                 47100000
         NI    EWACNTR3,CMDMASK    RID UNWANTED BITS                    47200000
         BR    RTNREG              RETURN GOODIES TO MAINLINE           47300000
ZERERPIB EQU   *                                                        47400000
         XC    EWAERPIB(N8),EWAERPIB   ZERO ERPIB                       47500000
         B     WTORTN              GO TO PERMANENT ERROR                47600000
         EJECT                                                          47700000
**********                                                              47800000
*                                                                       47900000
*        CONSTANTS                                                      48000000
*                                                                       48100000
**********                                                              48200000
EIGHT    DC    H'8'                EIGHT                                48300000
PACHAREA EQU   *                                                        48400000
         DC    22X'FF'             PATCH AREA               D11         48500000
         SPACE 2                                                        48600000
**********                                                              48700000
*                                                                       48800000
*        REGISTER DEFINITION                                            48900000
*                                                                       49000000
**********                                                              49100000
ERREG0   EQU   0                   WORK REGISTER                        49200000
PARMREG  EQU   1                   INPUT PARAMETER REGISTER             49300000
ERREG2   EQU   2                   WORK REGISTER                        49400000
CVTREG   EQU   3                   CVT BASE                             49500000
IOBREG   EQU   4                   IOB BASE                             49600000
EWAREG   EQU   5                   ERP WORKAREA BASE                    49700000
ERREG6   EQU   6                   WORK REGISTER                        49800000
ERREG7   EQU   7                   WORK REGISTER                        49900000
ERREG8   EQU   8                   WORK REGISTER                        50000000
ERREG9   EQU   9                   WORK REG                             50100000
IOSBREG  EQU   10                  IOSB BASE                            50200000
UCBREG   EQU   11                  UCB BASE                             50300000
BASERG   EQU   12                  PROGRAM BASE                         50400000
ERREG13  EQU   13                  WORK REGISTER                        50500000
RTNREG   EQU   14                  RETURN REGISTER                      50600000
ERREG15  EQU   15                  WORK REG                             50700000
         SPACE 2                                                        50800000
**********                                                              50900000
*                                                                       51000000
*        SENSE INDICATORS                                               51100000
*                                                                       51200000
**********                                                              51300000
CMDREJ   EQU   X'80'               COMMAND REJECT                       51400000
INTREQ   EQU   X'40'               INTERVENTION REQUIRED                51500000
BUSOUT   EQU   X'20'               BUS OUT CHECK                        51600000
EQPCHK   EQU   X'10'               EQUIPMENT CHECK                      51700000
SNOCUR0  EQU   X'4F'               SHOULD NOT OCCUR 2260 FIRST BYTE     51800000
SNOCUR3  EQU   X'1F'               SHOULD NOT OCCUR 1053 FIRST BYTE     51900000
SNOCUR02 EQU   X'FF'               SHOULD NOT OCCUR 2260 SECOND BYTE    52000000
SNOCUR32 EQU   X'FF'               SHOULD NOT OCCUR 1053 SECOND BYTE    52100000
         SPACE 2                                                        52200000
**********                                                              52300000
*                                                                       52400000
*        CSW STATUS INDICATORS                                          52500000
*                                                                       52600000
**********                                                              52700000
CHNEND   EQU   X'08'               CHANNEL END                          52800000
DEVEND   EQU   X'04'               DEVICE END                           52900000
UNITCK   EQU   X'02'               UNIT CHECK                           53000000
UNTEXC   EQU   X'01'               UNIT EXCEPTION                       53100000
PROGCK   EQU   X'20'               PROGRAM CHECK                        53200000
PROTCK   EQU   X'10'               PROTECTION CHECK                     53300000
CDCBIT   EQU   X'08'               CHANNEL DATA CHECK                   53400000
ASRCHK   EQU   X'06'               INTERFACE/CHANNEL CONTROL CHECK      53500000
CHAIN    EQU   X'01'               CHAINING CHECK                       53600000
ILXBF    EQU   X'BF'               INCORRECT LENGTH                     53700000
UCUEXFC  EQU   X'FC'               UNIT EXCEPTION/UNIT CHECK            53800000
         SPACE 2                                                        53900000
**********                                                              54000000
*                                                                       54100000
*        RETRY INDICATORS                                               54200000
*                                                                       54300000
**********                                                              54400000
BO1IND   EQU   X'80'               BUS OUT 1                            54500000
BO2IND   EQU   X'40'               BUS OUT 2                            54600000
ECRTRY   EQU   X'02'               ERP CHANNEL PROGRAM                  54700000
IOBEC    EQU   X'10'               EQUIPMENT CHECK                      54800000
SWITCH   EQU   X'08'               COMMAND CHAINING FOUND               54900000
CDCIND   EQU   X'04'               CHANNEL DATA CHECK                   55000000
ICCCCC   EQU   X'80'               ICC/CCC                              55100000
INTREQFD EQU   X'40'               INTERVENTION REQUIRED                55200000
*                                  PREVIOUSLY FOUND FOR 1053            55300000
INTREQRY EQU   X'20'               INTERVENTION REQUIRED RETRIED ONCE   55400000
*                                  AFTER DEVICE WAS MADE READY          55500000
         SPACE 2                                                        55600000
**********                                                              55700000
*                                                                       55800000
*         FLAGS USED WITH UCBTBYT4                                      55900000
*                                                                       56000000
**********                                                              56100000
A2260    EQU   X'03'               2260                                 56200000
A1053    EQU   X'04'               1053                                 56300000
         SPACE 2                                                        56400000
**********                                                              56500000
*                                                                       56600000
*        MISCELLANEOUS                                                  56700000
*                                                                       56800000
**********                                                              56900000
TIC      EQU   X'08'               TIC OP CODE                          57000000
EXCPER   EQU   15                  ERROR EXCP (SVC 15)                  57100000
EXIT     EQU   3                   RETURN TO SUPERVISOR (SVC 3)         57200000
NOTUSE   EQU   X'7F'               BIT NOT USED IN STAT TABLE           57300000
ZERO     EQU   0                   ZERO                                 57400000
N255     EQU   X'FF'               AND MASK                             57500000
N1       EQU   1                   ONE                                  57600000
N2       EQU   2                   TWO                                  57700000
N4       EQU   4                   FOUR                                 57800000
N8       EQU   8                   EIGHT                                57900000
WTO      EQU   253                 WTO ROUTINE ID                       58000000
ERRNM1   EQU   254                 STAT TABLE UPDATE ROUTINE ID         58100000
HEX01    EQU   X'01'               '00000001'                           58200000
HEX02    EQU   X'02'               '00000002'                           58300000
RETRY1   EQU   6                   RETRY CODE 1                         58400000
RETRY4   EQU   3                   RETRY CODE 4                         58500000
RETRY6   EQU   6                   RETRY CODE 6                         58600000
RETRY7   EQU   7                   RETRY CODE 7                         58700000
SIOINSTR EQU   X'10'               SIO FAIL MASK                        58800000
ERPVRTRY EQU   X'10'               RETRY CODE VALID                     58900000
ERPVCMAD EQU   X'04'               COMMAND ADDRESS VALID                59000000
X01      EQU   X'01'               STAT UPDATE CDC BIT                  59100000
         SPACE 2                                                        59200000
**********                                                              59300000
*                                                                       59400000
*        COMMAND CODES                                                  59500000
*                                                                       59600000
**********                                                              59700000
CCWCHAIN EQU   X'40'               COMMAND CHAINING                     59800000
CMDMASK  EQU   X'0F'               ZERO OUT KEYBOARD/UNLOCK             59900000
RDMI     EQU   X'02'               READ MI                              60000000
SRDMI    EQU   X'0A'               SHORT READ MI                        60100000
WRTDSB   EQU   X'01'               WRITE DSB                            60200000
ERASECMD EQU   X'07'               ERASE                                60300000
         EJECT                                                          60400000
         IECDIOSB                                                       60500000
         EJECT                                                          60600000
UCBSET   DSECT                                                          60700000
         IEFUCBOB                                                       60800000
         EJECT                                                          60900000
         IECDERWA                                                       61000000
         EJECT                                                          61100000
CVTSET   DSECT                                                          61200000
         CVT                                                            61300000
         EJECT                                                          61400000
         IEZIOB                                                         61500000
         EJECT                                                          61600000
         IECDRQE                                                        61700000
         END                                                            61800000
