         TITLE 'IGE0010E - LOCAL 3270 ERROR RECOVERY PROCEDURE'         00150002
IGE0010E CSECT                                                          00200002
*                                                              @YA02128 00210002
*        FOLLOWING CHANGES APPLIED:                            @YA02128 00220002
*              YA02128   OCT 1973                              @YA02128 00230002
*              YM2594    OCT 1973                              @YM2594K 00232002
*              YA01064   OCT 1973                              @YA01064 00234002
*              YA02456   OCT 1973                              @YA02456 00236002
*              YA00844   OCT 1973                              @YA00844 00238002
*              YA01061   NOV 1973                              @YA01061 00238402
*              YA02483   NOV 1973                              @YA02483 00238802
*              YA02484   NOV 1973                              @YA02484 00239202
*              YA03227   NOV 1973                              @YA03227 00239602
*              YM5690    JAN 1974                              @YM5690K 00239700
*              YA03250   JAN 1974                              @YA03250 00239800
*         ZA02301    JAN 1975          ZA02807    JAN 1975            * 00241800
*         ZA02808    JAN 1975          ZA02809    JAN 1975            * 00243800
*         ZA02815  (01/20/75)          ZA02841  (03/03/75)            * 00245800
*         ZA03552  (03/03/75)          ZA03553  (03/03/75)            * 00247800
*         AZ03951  (04/29/75)          AZ04166  (08/25/75)            * 00249800
*         AZ06396  (11/07/75)          AZ11043  (06/01/76)            * 00251800
*         AZ15403  (11/17/76)          AZ25106  (08/19/77)            * 00253800
*         AZ25738  (08/19/77)          AZ27951  (11/09/77)            * 00254801
*         AZ27984  (11/10/77)          AZ25921  (12/27/77)            * 00255801
*         (AZ30723-(03/06/78)G51AKXX-(05/24/77))                      * 00259800
*         AZ30908  (06/07/78)                                         * 00261800
*                                                                     * 00268400
*********************************************************************** 00285502
*                                                                     * 00300002
* MODULE NAME:                                                        * 00350002
*    IGE0010E                                                         * 00400002
*                                                                     * 00450002
* DESCRIPTIVE NAME:                                                   * 00500002
*    LOCAL 3270 ERROR RECOVERY PROCEDURE                              * 00550002
*    ALSO USED FOR GRAPHIC CONSOLES                         D11       * 00570000
*                                                                     * 00600002
* COPYRIGHT:                                                          * 00650002
*    NONE                                                             * 00700002
*                                                                     * 00750002
* STATUS:                                                             * 00800002
*    CHANGE LEVEL 000                                                 * 00850002
*                                                                     * 00900002
* FUNCTION:                                                           * 00950002
*    THIS MODULE IS THE ERP FOR LOCALLY ATTACHED  DEVICES OF THE      * 01000002
*    3270 DISPLAY SYSTEM, AND IS ALSO USED FOR GRAPHIC CONSOLES       * 01050001
*    OF THE 3270 SYSTEM , 3056 AND 3036 CONSOLES.            @G51AKXX * 01060001
*    THE MODULE IS SCHEDULED BY IOS.                                  * 01070000
*    THE FOLLOWING FUNCTIONS ARE PERFORMED BY THIS MODULE:            * 01100002
*        * DETERMINES IF AN ERROR IS RETRYABLE BY THE ERP AND RETRIES * 01150002
*          THOSE THAT ARE.                                            * 01200002
*        * DETERMINES IF ERP RETRIES ARE SUCCESSFUL.                  * 01250002
*        * MAINTAINS THE STATISTICS TABLE FOR THE DEVICE.             * 01300002
*        * REQUESTS OBR LOGOUT WHEN REQUIRED.                         * 01350002
*        * REQUESTS INT REQ OR PERM ERROR MESSAGES WHEN REQUIRED.     * 01400002
*                                                                     * 01450002
* NOTES:                                                              * 01500002
*    DEPENDENCIES:                                                    * 01550002
*        NONE                                                         * 01600002
*    RESTRICTIONS:                                                    * 01650002
*        THIS ERP IS FOR LOCALLY ATTACHED DEVICES ONLY USING EXCP     * 01700002
*    REGISTER CONVENTIONS:                                            * 01750002
*        SEE 'REGISTER EQUATES' BELOW                                 * 01800002
*                                                                     * 01850002
* PATCH LABEL:                                                        * 01900002
*    PACHAREA (140 BYTES)                                             * 01950002
*                                                                     * 02000002
* MODULE TYPE:                                                        * 02050002
*    PROCEDURE                                                        * 02100002
*    PROCESSOR:                                                       * 02150002
*        BAL                                                          * 02200002
*    MODULE SIZE:                                                     * 02250002
*        APPROX. 1800 BYTES                                           * 02300002
*    ATTRIBUTES:                                                      * 02350002
*        REENTRANT, ENABLED, KEY 0, SUPERVISOR STATE,LOCAL LOCK HELD  * 02400000
*                                                                     * 02450002
* ENTRY POINT:                                                        * 02500002
*    IGE0010E                                                         * 02550002
*    PURPOSE:                                                         * 02600002
*        THIS MODULE IS ENTERED WHEN ONE OR MORE OF THE FOLLOWING     * 02650002
*        CONDITIONS IS ENCOUNTERED:                                   * 02700002
*            UNIT CHECK                                               * 02750002
*            UNIT EXCEPTION                                           * 02800002
*            INVALID COMMAND SEQUENCE                                 * 02850002
*            INCORRECT LENGTH                                         * 02900002
*            PROGRAM CHECK                                            * 02950002
*            PROTECTION CHECK                                         * 03000002
*            CHAINING CHECK                                           * 03050002
*            CHANNEL DATA CHECK                                       * 03100002
*            INTERFACE CONTROL CHECK                                  * 03150002
*            CHANNEL CONTROL CHECK                                    * 03200002
*            COMMAND REJECT                                           * 03250002
*    LINKAGE:                                                         * 03300002
*        THIS MODULE IS SCHEDULED FOR EXECUTION BY THE INPUT/OUTPUT   * 03350002
*        SUPERVISOR. IT RUNS UNDER AN SIRB WITH ADDRESSABILITY TO     * 03400002
*        THE APPLICATION'S ADDRESS SPACE.                             * 03420002
*    INPUT:                                                           * 03450002
*        REG 1 = ADDRESS OF IOSB                                      * 03500002
*        REG 15= ADDRESS OF ENTRY POINT                               * 03510002
*    OUTPUT:                                                          * 03550002
*      REG 1 = ADDRESS OF IOSB AND,                                   * 03560002
*        RECOVERABLE ERRORS:                                          * 03600002
*            IOSERR IS SET ON FOR RETRY                               * 03650002
*            IF A MESSAGE IS TO BE ISSUED, EXIT IS MADE TO IGE0025C   * 03700002
*            IF NO MESSAGE, SVC 15 IS ISSUED, THEN EXIT IS VIA SVC 3  * 03750002
*        CORRECTED ERRORS:                                            * 03800002
*            IOSEX AND IOSERR ARE SET OFF                             * 03850002
*            IOSB IS CLEANED UP                                       * 03900002
*            EXIT IS TO IGE0025D TO UPDATE STATISTICS TABLE           * 03950002
*        PERMANENT ERRORS:                                            * 04000002
*            AN OBR LOGOUT IS SCHEDULED                               * 04050002
*            A STATISTIC TABLE UPDATE IS SCHEDULED                    * 04100002
*            IOSEX IS SET ON                                          * 04150002
*            IOSERR IS SET OFF                                        * 04200002
*            EXIT IS TO IGE0025C TO ISSUE PERM ERROR MESSAGE          * 04250002
*        PROGRAMMING ERRORS:                                          * 04300002
*            SVC 15 IS ISSUED                                         * 04350002
*            IOSEX IS SET ON                                          * 04400002
*            IOSERR IS SET OFF                                        * 04450002
*            EXIT IS VIA SVC 3                                        * 04500002
*                                                                     * 04550002
* EXITS-NORMAL:                                                       * 04600002
*    SUPERVISOR VIA SVC 3                                             * 04650002
*    STATISTICS UPDATE ROUTINE (IGE0025D) VIA BRANCH ENTRY TO XCTL    * 04700002
*    IOS-WTO ROUTINE (IGE0025C) VIA BRANCH ENTRY TO XCTL              * 04750002
*                                                                     * 04800002
* EXITS-ERROR:                                                        * 04850002
*    NONE                                                             * 04900002
*                                                                     * 04950002
* EXTERNAL REFERENCES:                                                * 05000002
*    ROUTINES:                                                        * 05050002
*        SVC 15 ERROR EXCP                                            * 05100002
*    DATA AREAS                                                       * 05150002
*        CHANNEL PROGRAM                                              * 05200002
*        ERP WORKAREA (MAPPED BY IECDERWA)                            * 05250002
*    CONTROL BLOCKS                                                   * 05300002
*        UCB          (MAPPED BY IEFUCBOB)                            * 05350002
*        DCB          (MAPPED BY DCBD)                                * 05400002
*        IOSB         (MAPPED BY IECDIOSB)                            * 05450002
*        CVT          (MAPPED BY CVT)                                 * 05500002
*        IOB          (MAPPED BY IEZIOB)                              * 05550002
*        RQE          (MAPPED BY IECDRQE)                             * 05600002
*                                                                     * 05650002
* TABLES-WORKAREAS:                                                   * 05700002
*    ERP WORKAREA                                                     * 05750002
*                                                                     * 05800002
* MACROS:                                                             * 05850002
*    NONE                                                             * 05900002
*                                                                     * 05950002
*********************************************************************** 06150002
         EJECT                                                          06200002
*/*IGE0010E: CHART (AREF) */                                            06250002
*/* HEADER                                                              06260002
*/*    LOCAL 3270 ERP ROUTINE FOR BTAM AND DIDOCS (OS/VS2 REL. 037)     06270001
*/*0)                    JUNE 30, 1977                 PAGE # */        06275001
*/* E IGE0010E */                                                       06300002
*/* D (YES,,NO,RETEXIT) EXCP METHOD (IOSDVRID) */                       06410000
*/* P SET ERP IN CONTROL (IOB + IOSB) */                                06412000
*/* D (YES,,NO,CHKCLOS) FIRST TIME THROUGH (EWACNTR2 ) */               06420002
*/* P SET 1ST TIME FLAG (EWA) AND RESET ERROR CNT (IOBERRCT) */         06430000
*/* P RESET BITS FOR STAT UPDATE (EWASTUP) */                           06432002
*/* D (YES,,NO,UNREC1) SUPPORTED GRAPHICS DEVICE (UCBTYP)*/ E12 ZA15403 06450000
*/*CHKCLOS: D (YES,SNOEXIT,NO,) CLOSE IN PROCESS (DCBOFLGS) */          06700002
*/* D (YES,ANALINT,NO,) IOSB INTERCEPT (X'7E' COMP) */                  06750000
*/* D (YES,,NO,CHKINT) IOSSNS = X'10FE' */                              06760000
*/* D (YES,SNOEXIT,NO,) SIO CC=3 (IOSCC) */                             06770000
*/*CHKINT: D (YES,ANALCHAN,NO,) CHANNEL ERROR (CDC,CCC,ICC)*/           06780000
*/*CHKUCK: D (YES,ANALUCK,NO,) UNIT CHECK */                            06850002
*/* D (YES,ANALUEX,NO,) UNIT EXCEPTION */                               06900002
*/* D (YES,UNREC1,NO,) OTHER STATUS ERRORS */                           06950002
*/* D (YES,SNOEXIT,NO,) INVALID SIOCC FOR STATUS */         E12 ZA25738 06970000
*/*NOERR: P RESET IOSB AND IOB ERROR FLAGS */                           07000002
*/* P RESET IOSMSG, IOSLOG, FLAGS FOR APPENDAGE */                      07010002
*/* P (,CHKSTAT) RESET DCB ERROR INDICATORS (DCBIFLGS) */               07050002
*/*ANALINT: D (YES,,NO,SNOEXIT) UNIT CHECK STATUS */                    07070000
*/* D (YES,SNOEXIT,NO,) EWA SHOW BAD SENSE RECEIVED */                  07090000
*/* D (YES,SETEC,NO,) EQUIP CHECK (IOSSNS) */                           07110000
*/* D (YES,,NO,SNOEXIT) DATA CK,UNIT SPEC? */               E12 ZA15403 07130000
*/*SETDCUS: P (,SNOEXIT)  SET DC,US FOR STAT UPDATE */                  07150000
*/*SNOEXIT: N */                                                        07170000
*/*UNREC1: P (,SETPER) INDICATE LOGOUT REQUIRED (IOSLOG) */             07190000
*/*SETPER: P (,CHKSTAT) INDICATE PERMANENT ERROR IN IOB + IOSB */       07300002
*/*CHKSTAT: D (YES,STATEXIT,NO,) LOGOUT NEEDED (IOSLOG) */              07400000
*/* D (YES,STATEXIT,NO,CHKMULTI) SINGLE BIT ENTRIES (EWASTUP) */        07450002
*/*CHKMULTI: D (YES,,NO,RETEXIT) MULTI BIT ENTRIES (EWASTUP + 1) */     07500002
*/*STATEXIT: P LOAD STAT UPDATE ROUTINE ID (IGE0025D) */                07550002
*/* N (,XCTLEXIT) IF IOSLOG=1, STAT UPDATE ALWAYS GOES TO OBR           07560002
*/*(IGE0025F) */                                                        07570002
*/*RTYCNT: D (YES,PERMEXIT,NO,) RETRY COUNT AT MAX (MAX = 3) */         07650002
*/* P UP RETRY COUNT BY ONE (IOBERRCT) */                               07700000
*/* S GETCMD: GET FAILING AND RESTART CCW ADDR. */                      07704000
*/* D (NO,,YES,RESTART) FAILING CCW ERASE WRITE ? */                    07708000
*/* D (NO,,YES,RESTART) FAILING CCW ER/WRT ALT ? */         E12 ZA25921 07709001
*/* D (NO,,YES,PERMEXIT) D.C. U.S. IN SENSE ? */                        07712000
*/* D (NO,,YES,EWAFLGOF) FAILING CCW A READ */                          07716000
*/* D (NO,,YES,RESTART) FAILURE ON SELECT CCW */                        07720000
*/* D (NO,,YES,RESTART) ERASE ALL UNPROTECTED */                        07724000
*/* D (NO,,YES,WRITECHK) FAILING CCW A WRITE (X'01') */                 07728000
*/* D (NO,SNOEXIT,YES,RESTART) FAILURE ON A NOP */                      07732000
*/*EWAFLGOF: P (,RESTART) TURN OFF BIT 1 IN EWAFLG2 */                  07736000
*/*WRITECHK: D (NO,,YES,RESTART) CHANNEL END IN STATUS */               07740000
*/* D (NO,,YES,CHKSBA) CONTROL CHECK IN SENSE */                        07744000
*/* D (NO,PERMEXIT,YES,) E.C. U.S. IN SENSE */                          07748000
*/*CHKSBA: D (NO,PERMEXIT,YES,) SBA FOLLOWING THE WCC */                07752000
*/*RESTART: P CHANGE VIRTUAL RESTART ADDR. TO REAL */                   07756000
*/* P STORE RESTART ADDR. IN IOSRST */                                  07760000
*/* S XLATEVTV: XLATE VIRTUAL REAL TO VIRTUAL VIRTUAL */                07764000
*/* P (,CHKSTAT) STORE RESTART ADDR. IN IOBSTART */                     07768000
*/*RETEXIT: S SVC 15: ERROR EXCP (REG 1 = @IOSB) */                     07783302
*/* R SVC 3 */                                                          07800002
*/*PERMEXIT: P INDICATE LOGOUT REQUIRED (IOSLOG) */            @YA02128 07810002
*/*PERMNOBR: D (YES,UNREC1,NO,) OP CONSOLE (UCB) */            @YA02128 07850002
*/* P (,WTOEXIT) SET PERM ERROR (IOB + IOB) AND ERROR MESSAGE (IOSMSG)  08050002
*/**/                                                                   08060002
*/*WTOEXIT: P LOAD WTO ROUTINE ID (IGE0025C) */                         08100002
*/* N IF IOSLOG=1, WTO GOES TO OBR OR STAT UPDATE */                    08150002
*/*XCTLEXIT: N WTO, STAT UPDATE OR OBR WILL DO THE SVC 15, SVC 3 */     08160002
*/* R BRANCH TO XCTL ROUTINE */                                         08200002
*/*ANALUCK: D (YES,UNREC1,NO,)  IOSSNS = X'10FC'*/                      08250000
*/* S STATUP: SET APPROPRIATE BITS FOR STAT UPDATE */                   08253000
*/*CHKIR: D (YES,INTVREQ,NO,) INT REQ (IOSSNS) */             @YA02128  08260000
*/* D (NO,,YES,RTYCNT) CONTROL CK. IN SENSE ? */                        08310000
*/* D (NO,,YES,RTYCNT) D.C., U.S. IN SENSE ? */                         08350000
*/* D (NO,,YES,EWAFLGON) DATA CHECK IN SENSE ? */                       08390000
*/* D (NO,,YES,RTYCNT) B.O.C. IN SENSE ? */                             08430000
*/* D (NO,SNOEXIT,YES,RTYCNT) E.C., U.S. IN SENSE ? */                  08470000
*/*EWAFLGON: P (,RTYCNT) TURN ON BIT 1 IN EWAFLG2 */                    08510000
*/*ANALUEX: D (YES,CKCECMDS,NO,) CHAN END AND DEV END */                10550000
*/* D (YES,CKDECMDS,NO,SNOEXIT) DEV END ALONE */                        10600002
*/*CKCECMDS: P GET FIRST REAL CCW (IOSRST) */                           10650002
*/* S TRANSRTV: GET VIRTUAL ADDRESS OF REAL CCW */                      10660002
*/* D (YES,SNOEXIT,NO,RETEXIT) SENSE OR NO-OP CCW */                    10700000
*/*CKDECMDS: P GET FIRST REAL CCW (IOSRST) */                           10850002
*/* S TRANSRTV: GET VIRTUAL ADDRESS OF REAL CCW */                      10900002
*/* D (YES,RETEXIT,NO,SNOEXIT) SELECT OR ERASE UNPROT CCW */            10950000
*/*INTVREQ: D (YES,,NO,IRPERM) 3284 OR 3286 DEVICE (UCBTYP) */ @YA02128 12970000
*/*TESTCONS: D (YES,IRMSG,NO,) OP CONSOLE (UCB) */             @YA02128 12990000
*/*IRPERM: P TURN OFF UCBIVRR + UCBIVRS (UCBFLC) */                     12990201
*/* D (YES,SNOEXIT,NO,) BTAM OPEN CCW? (TP OP CODE AT IOB+ X'45' */     12990401
*/* P (,PERMNOBR) SET 'DEVICE NOT READY' FLAG (UCBGRAF) */     @YA02128 12990601
*/*IRMSG: D (NO,IRRETRY,YES,) DEVICE END ONLY? */                       12990801
*/* S GETCMD: GET FAILING AND RESTART CCW ADDR. */                      12991001
*/* D (YES,DEIRRTY,NO,) WRITE CCW */                           @YA02484 12991201
*/* D (YES,,NO,UNREC1) ERASE WRITE OR EWA CCW */            E12 ZA25921 12992001
*/*MAKEWRT: P CHANGE CCW CMD TO WRT */                      E12 ZA25921 12994001
*/*DEIRRTY: P CHANGE RESTART VIRTUAL ADDR. TO REAL */                   13009700
*/* P SET TO RETRY WITH RESTART CCW (IOSRST) */                         13029700
*/* S XLATEVTV: XLATE VIRTUAL REAL TO VIRTUAL VIRTUAL */                13049700
*/* P SET IOBSTART TO RESTART ADDR. */                                  13069700
*/*IRRETRY: P (,WTOEXIT) SET FOR INT REQ MESSAGE (IOSMSG = 0) */        13089700
*/*ANALCHAN: D (NO,CHECKCHN,YES,) CDC ?*/                               13109700
*/* S (,RTYCNT) STATUP: SET CDC FOR STAT UPDATE */                      13129700
*/*CHECKCHN: D (NO,,YES,UNREC1) IS THE ERPIB ZERO */                    13149700
*/* D (YES,,NO,UNREC1) CAN RETRY BE DONE*/                              13169700
*/* D (YES,,NO,UNREC1) INTER @, SEQ CODE & CHAN @ VALID*/               13300000
*/* D (NO,,YES,UNREC1) HALT I/O OR TEST I/O*/                           13350000
*/* D (YES,,NO,TSTRESET) START I/O*/                                    13400000
*/* D (YES,,NO,UNREC1) DEVICE ADDRESS VALID*/                           13450000
*/*TSTRESET: D (NO,,YES,SNOEXIT) SYSTEM RESET*/                         13500000
*/* D (NO,,YES,SNOEXIT) SEQUENCE CODE 0*/                               13550000
*/* D (NO,,YES,SNOEXIT) SEQUENCE CODE 6*/                               13600000
*/* D (NO,,YES,SNOEXIT) SEQUENCE CODE 7*/                               13650000
*/* D (NO,,YES,UNREC1) SIO COND CODE 3*/                                13700000
*/* D (YES,,NO,CKCMDVAL) SIO COND CODE 1*/*                             13750000
*/* P (,SEQ5CHK) GET ADDR OF FAILING CCW FROM IOSVST*/                  13800000
*/*CKCMDVAL: D (YES,,NO,UNREC1) COMMAND ADDRESS VALID*/                 13850000
*/* S GETCMD: GET ADDRESS OF FAILING COMMAND*/                          13900000
*/*SEQ5CHK: D (NO,,YES,SEQ5PROC) SEQUENCE CODE 5*/                      13950000
*/* D (NO,,YES,SEQ4PROC) SEQUENCE CODE 4*/                              14000000
*/* D (NO,,YES,SEQ3PROC) SEQUENCE CODE 3*/                              14050000
*/* D (NO,,YES,SNOEXIT) COMMAND A TIC*/                                 14100000
*/* D (NO,,YES, SEQ2PROC) SEQUENCE CODE 2*/                             14150000
*/*SEQ1PROC: D (NO,,YES,CONDRTRY) TERMINATION CODE 2*/                  14200000
*/*SEQ1TRM1: D (YES,SNOEXIT,NO,RETRY) TERMINATION CODE 1*/              14250000
*/*SEQ2PROC: D (YES,RETRY,NO,SEQ1TRM1) TERMINATION CODE 2*/             14300000
*/*SEQ3PROC: D (NO,,YES,SNOEXIT) SELECT*/                               14350000
*/* D (NO,,YES,SNOEXIT) ERASE ALL UNPROTECTED*/                         14400000
*/* D (NO,RETRY,YES,SNOEXIT) NO-OP*/                                    14402000
*/*SEQ4PROC: D (NO,,YES,CONDRTRY) TERMINATION CODE 2*/                  14402400
*/*RETRY: D (YES,,NO,RTYERR) WRITE COMMAND*/                            14402800
*/* D (YES,,NO,UNREC1) 2ND BYTE OF WRITE DATA AN SBA*/                  14403200
*/*RTYERR: D (NO,,YES,PERMEXIT) IS RETRY COUNT MAX*/                    14403300
*/* P (,RESTART) INCR RETRY COUNT BY ONE */                             14403400
*/*CONDRTRY: D (NO,,YES,UNREC1) IS FAILING COMMAND 1ST CCW*/            14403800
*/* D (NO,RETRY,YES,UNREC1) IS FAILING COMMAND CHAINED*/                14403900
*/*SEQ5PROC: D (NO,,YES,SEQ3PROC) CSW STORED AFTER SIO*/                14404000
*/* D (YES,,NO,UNREC1) CSW STORED AFTER INTERRUPT*/                     14405000
*/* M CLEAR RETRY FIELDS*/                                              14407000
*/* M (,RETEXIT) TURN OFF ERP IN CONTROL (IOB & IOSB) */                14407400
*/* E TRANSRTV */                                                       14407902
*/* S IEAPTRV: TRANSLATE TO VIRTUAL ADDRESS */                 @YM2594K 14410002
*/* D (YES,,NO,UNREC1) RETURN CODE = 0 */                     @YM2594K  14412000
*/* R TO CALLER */                                                      14414002
*/* E GETCMD */                                                         14416000
*/* P GET CCW ADDR FROM IOSCSW & CLEAR HI ORDER BYTE */                 14418000
*/* D (NO,,YES,CHKDE) IS THE CCW ADDR 0 */                              14420000
*/* P SUBTRACT 8 TO POINT TO FAILING CCW */                             14422000
*/* D (NO,SNOEXIT,YES,GETSTART) IS THE ADDRESS VALID ? */               14424000
*/*CHKDE: D (NO,,YES,SNOEXIT) CHNL. END IN CSW STATUS */                14426000
*/* D (YES,,NO,SNOEXIT) DVC. END IN CSW STATUS */                       14428000
*/*GETSTART: P GET START OF CHANNEL PROG. (IOSVST) */                   14430000
*/*CHNLOOP: D (NO,,YES,FOUNDCMD) FAILING CCW ? */                       14432000
*/* D (NO,,YES,TICRTN) IS THIS A TIC CCW ? */                           14434000
*/* D (YES,,NO,TSTCMDCH) IS THE CCW DATA CHAINED */                     14436000
*/* P (,CHNLOOP) ADD 8 TO FAILING CCW ADDRESS */                        14438000
*/*TSTCMDCH: D (YES,,NO,SEEIFDE) IS CCW CMD. CHAINED */                 14440000
*/* P (,CHNLOOP) ADD 8 TO FAIL CCW ADDR. AND UPDATE RST ADDR. */        14442000
*/*SEEIFDE: D (YES,FOUNDCMD,NO,SNOEXIT) IS CSW ADDR. ZERO */            14444000
*/*TICRTN: S TRANSRTV: XLATE TICED TO ADDR. REAL TO VIRTUAL */          14446000
*/* D (NO,,YES,TICTOADR) IS PREVIOUS CCW DATA CHAINED */                14448000
*/* P SET RESTART ADDR. TO ADDR. TICED TO */                            14450000
*/*TICTOADR: P (,CHNLOOP) FAILING CCW ADDR. TO CCW TICED TO */          14452000
*/*FOUNDCMD: D (YES,,NO,CMDOUT) IS RESTART CCW A TIC */                 14454000
*/* S TRANSRTV: GET VIRTUAL ADDR. OF CCW TICED TO */                    14456000
*/* P SET RESTART ADDR. TO ADDR. TICED TO */                            14458000
*/*CMDOUT: R RETURN TO CALLER */                                        14460000
*/* E XLATEVTV */                                                       14462000
*/* P PUT CCW ADDR. TO BE TRANSLATED IN REG. ZERO */                    14464000
*/* P GET ADDR. OF TCCW OUT OF RQETCCW & PUT IN REG. ONE */             14466000
*/* P SET TCCWOPTN TO X'04' */                                          14468000
*/* P GET ADDR. OF IOCOM OUT OF CVT (CVTIXAVL) */                       14477700
*/* P GET ADDR. OF TRANSLATE ROUTINE OUT OF IOCOM (IOCTCCW) */          14478400
*/* S IECVTCCW: LINK TO TRANSLATE ROUTINE */                            14479100
*/* D (YES,,NO,UNREC1) RETURN CODE ZERO */                              14479800
*/* R RETURN TO CALLER */                                               14480500
*/* E STATUP */                                                         14484300
*/* D (NO,,YES,UNREC1) C.R. OR OP. CK. */                               14485100
*/* D (NO,,YES,CHKIRUS) U.S. IN STATUS ? */                             14485900
*/* D (NO,,YES,SETCDC) CHNL DATA CHECK IN STATUS */                     14486700
*/* P (,STATRTN) OR SENSE BYTE IN EWASTUP FOR STAT UPDATE */            14487500
*/*CHKIRUS: D (YES,,NO,CKIRECUS) IR,US IN SENSE ? */                    14488300
*/* P (,STATRTN) OR ON BIT 4 EWASTUP+1 */                               14489100
*/*CKIRECUS: D (YES,,NO,CHKDCUS) IR, EC, US ? */                        14502800
*/* P (,STATRTN) OR ON BIT 5 IN EWASTUP+1 */                            14504800
*/*CHKDCUS: D (YES,,NO,CHKECUS) DC, US ? */                             14506800
*/* P (,STATRTN) OR ON BIT 3 IN EWASTUP+1 */                            14508800
*/*CHKECUS: D (YES,,NO,STATRTN) EC, US ? */                             14510800
*/* P (,STATRTN) OR ON BIT 6 IN EWASTUP+1 */                            14512800
*/*SETCDC: P OR ON BIT 7 IN EWASTUP+1 */                                14514800
*/*STATRTN: R RETURN TO CALLER */                                       14516800
*/*IGE0010E: END */                                                     14522700
         EJECT                                                          14526600
         USING IOSB,IOSBREG                                             14538302
         USING UCBSET,UCBREG                                            14550002
         USING CVTMAP,CVTREG                                            14600002
         USING RQE,DCBREG                                               14650002
         USING IOBSTDRD,IOBREG                                          14700002
         USING EWA,EWAREG                                               14750002
         USING START,BASREG                                    @ZA04166 14800000
START    B     CONTIN                  BRANCH AROUND ID        @YA02128 14810000
         DC    CL8'IGE0010E'             MODULE ID             @YA02128 14820002
         DC    X'8158'                     AND DATE            @ZA30908 14830000
         DC    C'&SYSDATE'          DATE LAST ASSEMBLY                  14832002
CONTIN   DS    0H                                              @YA02128 14840002
         LR    IOSBREG,PARMREG          BASE IOSB                       14850002
         CLI   IOSDVRID,IOSXCPID        EXCP I/O               @YM5690K 14860000
         BNE   RETEXIT                  NO, PERM ERROR         @YM5690K 14870000
         L     UCBREG,IOSUCB            BASE UCB                        14900002
         L     EWAREG,IOSERP            BASE ERP WORKAREA               14950002
         L     CVTREG,CVTPTR            BASE CVT               @YM2594K 15000002
         L     DCBREG,IOSUSE            BASE RQE                        15050002
         L     IOBREG,RQEIOB            BASE IOB                        15100002
         DROP  DCBREG                                                   15150002
         USING IHADCB,DCBREG                                            15200002
         L     DCBREG,IOBDCBPT          BASE DCB                        15250002
         OI    IOSFLA,IOSERR+IOSEX      INDICATE ERP IN CONTROL         15310002
         OI    IOBFLAG1,IOBERRTN+IOBIOERR      ALSO IN IOB              15320002
*              2 LINES MOVED TO NEAR LINE 148500               @YM5690K 15370000
         TM    EWACNTR2,FIRSTFLG        FIRST TIME THRU ERP             15450002
         BO    CHKCLOS                  NO, CONTINUE                    15500002
         MVI   EWACNTR1,ZERO            RESET COUNTER                   15550002
         OI    EWACNTR2,FIRSTFLG        FIRST TIME THRU ERP             15600002
         XC    EWASTUP,EWASTUP         RESET INTERFACE TO STAT UPDATE   15610002
         MVI   IOBERRCT+ONE,HEX07       FLAGS FOR CHANNEL END APPENDAGE 15650002
*   TEN LINES OF CODE REDUCED TO FOUR BY APAR------------->    @ZA15403 15700000
         CLC   UCBTBYT3(2),LOWDVC       IS DEVICE 3270         @ZA15403 15750000
         BL    UNREC1                   NO EXIT WITH ERROR     @ZA15403 15850000
         CLC   UCBTBYT3(2),HIGHDVC    MAYBE TEST FURTHER       @G51AKXX 15900001
         BH    UNREC1                   NO EXIT WITH ERROR     @ZA15403 15950000
CHKCLOS  EQU   *                                                        16200002
         TM    DCBOFLGS,DCBOFOPN+DCBOFIOF   IS CLOSE IN PROGRESS        16250002
         BO    SNOEXIT                  YES, EXIT WITH ERROR            16300002
*              7 LINES DELETED                                 @YM5690K 16310000
         CLI   IOSCOD,IOSFINTC          IS I/O REQUEST INTERCEPTED      16350002
         BE    ANALINT                  YES, ANALYZE                    16400002
         TM    EWAFLG1,EWABDSNS        TEST BAD SENSE          @YM5690K 16402000
         BO    CHKINT                   TO ELEMINATE SIO CC=3  @YM5690K 16404000
         CLC   IOSSNS(TWO),CC3SNS       SENSE FOR SIOCC=3      @YM5690K 16410000
         BNE   CHKINT                   NO                     @YM5690K 16420000
         TM    IOSCC,IOSCC3             SIOCC=3                @YM5690K 16430000
         BO    SNOEXIT            YES, PERM ERROR, NO MESSAGE  @YM5690K 16440000
CHKINT   DS    0H                                              @YM5690K 16442000
         TM    IOSTSB,CATCHAN           ANY CHANNEL ERRORS              16450002
         BNZ   ANALCHAN                 YES, CHECK THEM                 16500002
CHKUCK   EQU   *                                                        16550002
         TM    IOSTSA,CSWUCK            UNIT CHECK                      16600002
         BO    ANALUCK                  IF YES-ANALYZE                  16650002
         TM    IOSTSA,CSWUEX            UNIT EXCEPTION                  16700002
         BO    ANALUEX                  YES, ANALYZE                    16750002
         TM    IOSTSB,CATERR            ANY OTHER STATUS ERRORS         16800002
         BNZ   UNREC1                   YES, EXIT WITH ERROR            16850002
         TM    IOSCC,IOSCC3       NON-ZERO SIOCC            E12 ZA25738 16860000
         BNZ   NOERR                 YES,RETURN TO IOS      E12 ZA25738 16870000
         TM    IOSTATUS,CSWSMBSY        STAT MOD OR BUSY    E12 ZA25738 16880000
         BNZ   SNOEXIT             SNO FOR SIOCC=0          E12 ZA25738 16890000
NOERR    EQU   *                                                        16900002
         NI    IOSFLA,N255-IOSERR-IOSEX   CLEAR IOSB ERROR FLAGS        16950002
         NI    IOBFLAG1,N255-IOBERRTN-IOBIOERR    ALSO IN IOB           16960002
         NI    IOSFLB,N255-IOSMSG-IOSLOG   CLEAR IOSB ERROR FLAGS       17000002
         NI    IOBERRCT+ONE,N255-HEX07   RESET APPENDAGE FLAGS          17050002
         NI    DCBIFLGS,N255-DCBIFEC    CLEAR DCB ERROR FLAGS           17100002
***** THE FOLLOWING LINE OF CODE DELETED. *****************    @ZA03951 17105000
******   XC    UCBSNS(TWO),UCBSNS       CLEAR SENSE         LD @ZA02807 17110000
         B     CHKSTAT                  EXIT TO STAT UPDATE OR RETURN   17150002
ANALINT  EQU   *                                                        17200002
         TM    IOSTSA,CSWUCK       UNIT CHECK SENSE?           @YM5690K 17202000
         BNO   SNOEXIT            NO, PERM ERROR (ONLT LIKELY) @YM5690K 17204000
         TM    EWAFLG1,EWABDSNS        BAD SENSE               @YM2594K 17210002
         BO    SNOEXIT                 YES,  GET OUT           @YM2594K 17220002
         CLI   IOSSNS,SENEC             EQUIP CHECK                     17250002
         BE    SETEC                   YES, STAT UPDATE, RETRY          17300002
         CLI   IOSSNS,SENDCUS          DATA CHK, UNIT SPECIFY           17310002
*    TWO LINES REDUCED TO ONE AND THREE MOVED HERE BY APAR-->  @ZA15403 17320000
         BNE   SNOEXIT                 NO, EXIT WITH ERROR     @ZA15403 17326000
SETDCUS  DS    0H                                                       17332000
         OI    EWASTUP+ONE,STDCUS      INDICATE DC, US IN STAT TABLE    17338000
         B     SNOEXIT                 EXIT WITH ERROR                  17344000
SETEC    EQU   *                                                        17350002
         OI    EWASTUP,STATEC          INDICATE EC IN          @YA01061 17360002
*                                                STAT TABLE    @YA01061 17370002
         MVI   IOSCOD,IOSNRMC           CLEAR INTCPT INDICATOR          17400002
         NI    IOSFLA,N255-IOSEX        CLEAR PER FLAG                  17450002
         NI    IOBFLAG1,N255-IOBIOERR            ALSO IN IOB            17460002
         MVI   IOSSNS,ZERO              CLEAR SENSE                     17500002
         MVI   IOBSENS0,ZERO               ALSO IN IOB                  17510002
         NI    IOBERRCT+ONE,N255-HEX07   RESET APPENDAGE FLAGS          17550002
         NI    DCBIFLGS,N255-DCBIFEC    CLEAR DCB ERROR FLAGS           17600002
         B     RETEXIT                  EXIT TO RETRY                   17650002
*                                                                       17660002
ANALUCK  EQU   *                                                        19950002
         TM    EWAFLG1,EWABDSNS         BAD SENSE                       20000002
         BO    UNREC1                   YES, EXIT WITH ERROR            20050002
         CLI   IOSSNS,SENIR             INTER. REQ. SENSE?  E12 ZA27951 20052001
         BNE   CONTUC                   NO DON'T TEST FLAG  E12 ZA27951 20054001
         TM    UCBGRAF,UCBDWNR          FLAG SET            E12 ZA27951 20056001
         BO    INTVREQ                  YES,RECORD AND POST E12 ZA27951 20058001
*         TWO LINES OF CODE DELETED BY APAR ---------------->  @ZA06396 20060000
CONTUC   TM    IOSTSA,CSWCDE            CHAN END AND D. E.  E12 ZA27951 20100001
         BO    CHKCESNS                 YES, CHECK CE SENSE COND        20150002
         TM    IOSTSA,CSWDVE            DEVICE END ALONE                20200002
         BO    ANALDERR                 YES                             20250002
*              2 LINES MOVED TO NEAR LINE 200500               @YM5690K 20300000
         BAL   LNKREGB,CHKDIAG          CHECK FOR DIAG CMD              20400002
         B     BRTAB3(IXREG)            DIAG CHK RTN BR TBL             20450002
BRTAB3  EQU   *                                                         20500002
         B     PERMEXIT                 DIAG CMD, PERM ERR EXIT         20550002
         CLI   IOSSNS,SENBOC            BUS OUT CHECK                   20600002
         BNE   CHKCR                   NO, CHECK FOR CR                 20650002
         OI    EWASTUP,STATBOC    YES, SET BOC FOR STAT UPDATE @YA01061 20660002
*     ONE LINE DELETED AND ELEVEN MOVED HERE BY APAR------>    @ZA15403 20670000
RTYCNT   EQU   *                                                        20680000
         CLI   EWACNTR1,THREE           RETRY COUNT AT MAX              20690000
         BNL   PERMEXIT                 MAX CNT-PER ERR EXIT            20700000
         SR    ICREG,ICREG              CLEAR REG                       20705000
         IC    ICREG,EWACNTR1           PICK UP COUNT                   20710000
         LA    ICREG,ONE(ICREG)         BUMP BY ONE                     20715000
         STC   ICREG,EWACNTR1           SAVE COUNT                      20720000
RETEXIT  EQU   *                                                        20725000
         LR    PARMREG,IOSBREG     RESTORE REG 1 TO IOSB ADDR  @YM2594K 20730000
         SVC   EREXCP                   ERROR EXCP                      20735000
         SVC   RETURN                   RETURN TO SVPR                  20740000
CHKCR    EQU   *                                                        20750002
         CLI   IOSSNS,SENCR             COMMAND REJECT                  20800002
         BE    UNREC2                   YES                             20850002
         CLI   IOSSNS,SENIR            INTERVENTION REQ        @ZA06396 20860000
*    TWO LINES REDUCED TO ONE AND FIFTY ONE MOVED HERE BY ---> @ZA15403 20870000
         BNE   UNREC1                NO UNRECOV ERROR          @ZA15403 20880000
         EJECT                                                          20890000
*                                                              @YA02128 20900000
*              HANDLE INTERVENTION REQUIRED AS                 @YA02128 20910000
*              PERMANENT ERRORS                                @YA02128 20920000
*              EXCEPT THAT THE 3284 AND 3286 PRINTERS          @YM5690K 20930000
*              WILL BE PROCESSED FOR INTERVENTION REQUIRED     @YM5690K 20940000
*              IF BEING USED AS CONSOLES                       @YM5690K 20950000
*                                                              @YA02128 20960000
INTVREQ  DS    0H                                              @YM5690K 20970000
         BAL   LNKREGB,CHKDIAG          CHECK FOR DIAG CMD     @YA02128 20980000
         B     BRTAB1(IXREG)    DIAG CHECK RETURN BRANCH TABLE @YA02128 20990000
BRTAB1   EQU   *                                               @YA02128 21000000
         B     SNOEXIT          DIAGNOSE COMMAND PERM ERROR    @YM5690K 21010000
         OI    EWASTUP,STATIR          SET IR FOR STAT UPDATE  @YA02128 21020000
*      FIVE LINES OF CODE REMOVED BY APAR------------------>   @ZA15403 21030000
TESTCONS EQU   *                                               @YA02128 21040000
         TM    SRTESTAT,UCBONLI+UCBSYSR   DEV. AN ONLINE       @YA02128 21050000
*                                             ACTIVE CONSOLE   @YA02128 21060000
         BNO   IRPERM             NO,SET PERM ERROR         E12 ZA25106 21062000
         CLI   UCBTBYT4,DEV3284    HARDCOPY CONSOLE         E12 ZA25106 21064000
         BE    IRMSG                YES, EXIT IR MESSAGE    E12 ZA25106 21066000
         CLI   UCBTBYT4,DEV3286     HARDCOPY CONSOLE        E12 ZA25106 21068000
         BE    IRMSG                 IF YES-EXIT IR MESSAGE E12 ZA25106 21070000
IRPERM   DS    0H                                              @YM5690K 21080000
         NI    UCBFLC,N255-(UCBIVRR+UCBIVRS)    TURN OFF       @YM5690K 21090000
*                                             SINCE NO IR MSG  @YM5690K 21100000
         MVC   IOBWORK(ONE),IOBCPA+FIVE  SET UP TP CODE...  LD @ZA02301*21110000
                                   ...IN WORK AREA.         LD @ZA02301 21120000
         NI    IOBWORK,N255-(CCWCD+CCWCC) CLEAR UNUSED BITS LD @ZA02301 21130000
         CLI   IOBWORK,BTAMOPEN    OPEN TP OP CODE          LD @ZA02301 21140000
         BE    SNOEXIT             OPEN, PERMANENT ERROR... LD @ZA02301*21150000
                                   ...NO MSG OR LOG.        LD @ZA02301 21160000
*     THE FOLLOWING CODE CHANGED DUE TO BTAM READYQ CHANGE  E12 ZA27984 21161001
*  ERP SHOULD NOT SET UCBDWNR SINCE BTAM IS THE ONLY USER   E12 ZA27984 21162001
* BTAM WILL NOW BE RESPONSIBLE TO SET AND RESET IT. IF ANY  E12 ZA27984 21163001
*  OTHER ACCESS METHODS OR APPLICATIONS USE THIS THEY MUST  E12 ZA27984 21164001
*  SET AND RESET IT ALSO. IT IS ONLY VALID FOR INTERVENTION E12 ZA27984 21165001
*  REQUIRED SITUATIONS. AS AN INTERM MEASURE THE FOLLOWING  E12 ZA27984 21166001
*  BRANCH MAY BE NO-OPED TO ALLOW ERP TO SET IT.            E12 ZA27984 21167001
         B     PERMNOBR                                     E12 ZA27984 21168001
         OI    UCBGRAF,UCBDWNR       SET FAILED FLAG IN GCB    @YA02128 21170000
         B     PERMNOBR                                        @YA02128 21180000
IRMSG    EQU   *                                               @YM5690K 21190000
         TM    IOSTSA,CSWDVE       DEVICE END?                 @YM5690K 21200000
         BNO   IRRETRY             NO, SHOULD BE SIO CC=1      @YM5690K 21210000
         TM    IOSTSA,CSWCHE       CHANNEL END                 @YM5690K 21220000
         BO    IRRETRY     YES, ERROR BEFORE BUFFER COMPLETE   @YM5690K 21230000
*                    NO, ERROR WHILE PRINTER DUMPING BUFFER    @YM5690K 21240000
         BAL   LNKREG,CMDSRCH           FIND LAST COMMAND               21250000
         CLI   CCWCMD(CCWREG),CCWWRT    WRITE                           21260000
         BE    DEIRRTY                  YES-RETRY WCC ONLY              21270000
         CLI   CCWCMD(CCWREG),CCWEWR    ERASE WRITE                     21280000
         BE    MAKEWRT                  YES, CHANGE TO WRT  E12 ZA25921 21283001
         CLI   CCWCMD(CCWREG),CCWEWA    ER/WRT ALTERNATE    E12 ZA25921 21284001
         BNE   UNREC1                  NO-SNO, LOG             @YM5690K 21290000
MAKEWRT  EQU   *                                            E12 ZA25921 21295001
         MVI   CCWCMD(CCWREG),CCWWRT   CHANGE TO WRITE         @YM5690K 21300000
DEIRRTY  EQU   *                                                        21310000
         LA    WKREG1,ONE               PICK UP RTY BYTE CNT            21320000
         STH   WKREG1,CCWCNT(CCWREG)    SET CNT TO RETRY WCC            21330000
         NI    CCWFLGS(CCWREG),N255-CCWCD   NO DATA CHAINING   @YM5690K 21340000
         LRA   CCWREG,ZERO(CCWREG)      SET REAL ADDRESS FOR IOS        21350000
         ST    CCWREG,IOSRST            RETRY LAST/ONLY CMD             21360000
IRRETRY  DS    0H                                              @YM5690K 21370000
         NI    IOBERRCT+ONE,N255-HEX07   RESET APPENDAGE FLAGS @YM5690K 21380000
         NI    IOSFLB,N255-IOSMSG       INT REQ MSG INDICATOR           21390000
         B     WTOEXIT                  EXIT TO WTO AND RETRY           21400000
CHKCESNS EQU   *                                                        21800002
         BAL   LNKREGB,CHKDIAG          CHECK FOR DIAG CMD              21850002
         B     BRTAB2(IXREG)            DIAG CMD RTN BR TBL             21900002
BRTAB2   EQU   *                                                        21950002
         B     PERMEXIT                 DIAG CMD, PER ERR EXIT          22000002
         SR    CCWREG,CCWREG            GET CCW ADDR WITH      @ZA15403 22050000
         ICM   CCWREG,M7,IOSCSWCA       HI BYTE CLEAR          @ZA15403 22100000
         SH    CCWREG,CONEIGHT          FAILING CCW ADDR                22150002
         BNP   UNREC1               BRANCH IF ADDRESS WAS ZERO @YA03250 22250000
         CLI   IOSSNS,SENBOC            BUS OUT CHECK                   22300002
         BE    BOCCMDS                  YES-CHECK CMDS                  22350002
         CLI   IOSSNS,SENDC             DATA CHECK                      22400002
         BE    CMDCHK                   YES-CHECK CMDS                  22450002
         CLI   IOSSNS,SENCC             CONTROL CHECK                   22500002
         BE    CMDCHK                   YES-CHECK CMDS                  22550002
         CLI   IOSSNS,SENDCUS           DATA CHK,UNIT SPECIFY           22600002
         BE    CMDCHK                   YES-CHECK CMDS                  22650002
         CLI   IOSSNS,SENOC             OPERATION CHECK                 22700002
         BNE   UNREC1                   NO                     @YA03250 22750000
         CLI   CCWCMD(CCWREG),CCWWRT    WRITE                           22800002
         BE    UNREC2                   YES                             22850002
*          *****LINES 228600-228700 REMOVED BY ZA02841****  L5 @ZA02841 22870000
         CLI   CCWCMD(CCWREG),CCWEWR    ERASE WRITE                     22900002
         BE    UNREC2                   YES,USER RETRYABLE  E12 ZA25921 22910001
         CLI   CCWCMD(CCWREG),CCWEWA    ER/WRT ALTERNATE?   E12 ZA25921 22920001
*   TWO LINES REDUCED TO ONE AND THREE MOVED HERE BY APAR--->  @ZA15403 22950000
         BNE   UNREC1                   NO, EXIT WITH ERROR    @ZA15403 22980000
UNREC2   EQU   *                                                        23010000
         NI    IOBERRCT+ONE,N255-HEX01  INDICATE USER RETRYABLE         23040000
         B     SETPER                   EXIT                            23070000
BOCCMDS  EQU   *                                                        23100002
         CLI   CCWCMD(CCWREG),CCWWRT    WRITE                           23150002
         BE    UNREC1                   YES, EXIT                       23200002
         CLI   CCWCMD(CCWREG),CCWEWR    ERASE WRITE                     23250002
         BE    BOCSTAT                  YES,SET STAT FLAG   E12 ZA25921 23260001
         CLI   CCWCMD(CCWREG),CCWEWA    ER/WRT ALTERNATE?   E12 ZA25921 23270001
         BNE   UNREC1                   NO, EXIT WITH ERR      @YA03250 23300000
BOCSTAT  EQU   *                                            E12 ZA25921 23320001
         OI    EWASTUP,STATBOC         SET BOC FOR STAT UPDATE @YA01061 23350002
         B     RTYCNT                   RETRY CHAN PGM                  23400002
CMDCHK   EQU   *                                                        23450002
         CLI   CCWCMD(CCWREG),CCWWRT    WRITE                           23550002
         BE    CKFSTCCW                 YES, IS FST IS EWR  L5 @ZA02841 23600000
*      ****LINES 236100-236200 REMOVED BY ZA02841*****      L5 @ZA02841 23630000
         CLI   CCWCMD(CCWREG),CCWEWR    ERASE WRITE                     23650002
         BE    RECRTY                   YES-RETRY                       23700002
         CLI   CCWCMD(CCWREG),CCWEWA   ER/WRT ALTERNATE?    E12 ZA25921 23710001
         BE    RECRTY                  YES, RETRY           E12 ZA25921 23720001
         CLI   CCWCMD(CCWREG),CCWSEL    SELECT                          23750002
         BE    RECRTY                   YES-RETRY                       23800002
         CLI   CCWCMD(CCWREG),CCWEUP    ERASE UNPROTECTED               23850002
         BE    RECRTY                   YES-RETRY                       23900002
         CLI   IOSSNS,SENDCUS           DATA CHK,UNIT SPECIFY           24000002
         BE    RDERR                    YES-CHK RD CMDS                 24050002
         CLI   CCWCMD(CCWREG),CCWRDM    READ MODIFIED                   24100002
         BE    CHKWRCMD                 YES-CHECK CHAN PGN              24150002
         CLI   CCWCMD(CCWREG),CCWRDB    READ BUFFER                     24200002
         BE    CHKWRCMD                LOOK FOR WRITE       L5 @ZA02841 24250000
*                                      BEFORE FAILING       L5 @ZA02841 24260000
         TM    CCWFLGS(CCWREG),CCWCD   DATA CHAIN?          L5 @ZA02841 24270000
         BZ    UNREC1                  NO,SET UNRECOVERABLE L5 @ZA02841 24280000
CKFSTCCW EQU   *                                            L5 @ZA02841 24282000
         L     PARMREG,IOSRST          REAL ADDR FST CCW    L5 @ZA02841 24284000
         BAL   ICREG,TRANSRTV          GET VIRT ADDR REAL   L5 @ZA02841 24286000
         LA    CCWREG,ZERO(PARMREG)    INTO CORRECT REG     L5 @ZA02841 24288000
         CLI   CCWCMD(CCWREG),CCWEWR   IS IT EWR?           L5 @ZA02841 24290000
         BE    RECRTY                  YES,RETRY CHAN PROG  L5 @ZA02841 24292000
         CLI   CCWCMD(CCWREG),CCWEWA    ER/WRT ALTERNATE?   E12 ZA25921 24292901
         BE    RECRTY                   YES RETRY CHA PROG  E12 ZA25921 24293501
*  ONE LINE DELETED AND NINETEEN MOVED HERE BY APAR-------->   @ZA15403 24294800
UNREC1   EQU   *                                                        24295000
         OI    IOSFLB,IOSLOG            INDICATE OBR LOGOUT             24295200
SNOEXIT  EQU   *                                                        24295400
         NI    IOBERRCT+ONE,N255-HEX04   RESET APPENDAGE CORRECTABLE    24295600
SETPER   EQU   *                                                        24295800
         NI    IOSFLA,N255-IOSERR       INDICATE PER IN IOSB FLAGS      24296000
         NI    IOBFLAG1,N255-IOBERRTN     ALSO IN IOB                   24296200
CHKSTAT  EQU   *                                                        24296400
         MVI   EWACNTR1,ZERO            CLEAR RETRY COUNT               24296600
         TM    IOSFLB,IOSLOG            OBR LOGOUT REQUIRED             24296800
         BO    STATEXIT                 IF YES-EXIT TO STAT UPDATE      24297000
         CLI   EWASTUP,ZERO            CHECK FOR SINGLE BIT ENTRIES     24297200
         BNE   STATEXIT                 IF PRESENT, EXIT TO STAT UPDATE 24297400
CHKMULTI EQU   *                                                        24297600
         CLI   EWASTUP+ONE,ZERO         CHECK FOR MULTI BIT ENTRIES     24297800
         BE    RETEXIT                  IF NONE, STAT UPDATE NOT REQD   24298000
STATEXIT EQU   *                                                        24298200
         LA    LDNAMREG,STATUP          ADDRESS OF STAT UPDATE ROUTINE  24298400
         B     XCTLEXIT                 EXIT VIA XCTL BRANCH ENTRY      24298600
CHKWRCMD EQU   *                                                        24300002
         LA    CMDREG,CCWWRT            WRITE CMD                       24350002
         BAL   LNKREG,CHKCMD            LINK TO CHK CHAN PGM            24400002
         B     BRTAB5(IXREG)            RETURN BRANCH TABLE             24450002
BRTAB5   EQU   *                                                        24500002
         B     UNREC1                   WRT IN CHAN PGM-EXIT            24550002
         CLI   IOSSNS,SENDC            DATA CHECK                       24560002
         BE    SETDC                 YES, SET DATA CHK ERR     @ZA15403 24570000
         OI    EWASTUP,SENCC           NO, SET CC FOR STAT UPDATE       24580002
         B     RTYCNT                   RETRY CHAN PGM                  24600002
*   THREE LINES DELETED BY APAR----------------------------->  @ZA15403 24610000
*                                                                       24642002
RECRTY   EQU   *                                                        24644002
         CLI   IOSSNS,SENDC            DATA CHECK                       24646002
         BE    SETDC                   YES, SET ERROR                   24648002
         CLI   IOSSNS,SENCC            CTRL CHK                         24648402
         BE    SETCC                   YES, SET CC                      24648802
         OI    EWASTUP+ONE,STDCUS      SET DC, US FOR STAT UPDATE       24649602
         B     RTYCNT                  RETRY CHANNEL PROG               24649702
*                                                                       24649802
SETDC    EQU   *                                                        24649902
         OI    EWASTUP,STATDC          SET DC FOR STAT UPDATE  @YA01061 24666602
         B     RTYCNT                  RETRY CHAN PROG                  24676602
*                                                                       24678602
SETCC    EQU   *                                                        24680602
         OI    EWASTUP,SENCC           SET CC FOR STAT UPDATE           24682602
         B     RTYCNT                  RETRY                            24683002
*                                                                       24683102
RDERR    EQU   *                                                        24683302
         CLI   CCWCMD(CCWREG),CCWRDM    READ MODIFIED                   24700002
         BE    UNREC1                   YES-EXIT WITH ERROR             24750002
         CLI   CCWCMD(CCWREG),CCWRDB    READ BUFFER                     24800002
         BE    UNREC1                   YES-EXIT WITH ERROR             24850002
         B     UNREC1                   EXIT                   @YA03250 24900000
ANALUEX  EQU   *                                                        24950002
         BAL   LNKREGB,CHKDIAG          CHECK FOR DIAG CMD              25000002
         B     BRTAB4(IXREG)            DIAG CHK RTN BR TBL             25050002
BRTAB4   EQU   *                                                        25100002
         B     PERMEXIT                 DIAG CMD-PER ERR EXIT           25150002
*  THREE LINES MOVED HERE BY APAR-------------------------->   @ZA15403 25160000
         L     PARMREG,IOSRST      REAL ADDRESS OF FIRST CCW   @YM2594K 25170000
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDRESS OF REAL @YM2594K 25180000
         LA    CCWREG,ZERO(PARMREG)    INTO CORRECT REG        @YM2594K 25190000
         TM    IOSTSA,CSWCDE            CHANNEL END AND DEVICE END      25200002
         BO    CKCECMDS                 YES-CHECK FIRST CMD ON CE/DE    25250002
         TM    IOSTSA,CSWDVE            DEVICE END ALONE                25300002
         BNO   SNOEXIT                  EXIT                            25350002
*  ONE LINE DELETED AND SEVEN MOVED HERE BY APAR------------>  @ZA15403 25360000
CKDECMDS EQU   *                                                        25850002
*    THREE LINES DELETED BY APAR--------------------------->   @ZA15403 25855000
         CLI   CCWCMD(CCWREG),CCWSEL    SELECT                          25950002
         BE    UERETRY                  YES                             26000002
         CLI   CCWCMD(CCWREG),CCWEUP    ERASE UNPROTECTED               26100002
         BE    UERETRY                  YES                             26150002
         B     SNOEXIT                  EXIT                            26250002
CKCECMDS EQU   *                                                        26255000
         CLI   CCWCMD(CCWREG),CCWSNS    SENSE                           26260000
         BE    SNOEXIT                  EXIT                            26265000
         CLI   CCWCMD(CCWREG),CCWNOP    NO-OP                           26270000
         BE    SNOEXIT                  EXIT                            26275000
UERETRY  EQU   *                                                        26280000
         OI    IOBERRCT+ONE,UEXRETRY    UNIT EXCEPTION RETRIED          26285000
*                                      ONE LINE DELETED        @YA02483 26290000
         B     RETEXIT                  EXIT TO RETRY                   26295000
ANALDERR EQU   *                                                        26300002
         BAL   LNKREGB,CHKDIAG          CHECK FOR DIAG CMD              26350002
         B     BRTABLE1(IXREG)          DIAG CMD RTN BR TBL             26400002
BRTABLE1 EQU   *                                                        26450002
         B     PERMEXIT                 DIAG CMD-PER ERR EXIT           26500002
         LA    IXREG,4            SET NOSELECT RETRY           @YA02456 26510002
         SR    CCWREG,CCWREG      GET FAILING CCW ADDRESS      @ZA15403 26520000
         ICM   CCWREG,M7,IOSCSWCA WITH ERROR FLAGS CLEAR       @ZA15403 26530000
         SH    CCWREG,CONEIGHT    BACK UP ONE CCW              @YA02456 26540002
         BNP   ANDERCNT           IF NOT VALID ADDRESS,        @YA02456 26542002
*                                 GO CHECK LAST CCW            @YA02456 26544002
         L     PARMREG,IOSRST      REAL ADDRESS OF FIRST CCW   @YM2594K 26544402
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDRESS OF REAL @YM2594K 26544802
         LA    WKREG1,ZERO(PARMREG)    INTO CORRECT REG        @YM2594K 26545202
         CR    CCWREG,WKREG1      FAILING IS FIRST?            @YA02456 26548402
         BNE   ANDERCNT           NO,CHECK LAST                @YA02456 26548802
         CLI   CCWCMD(CCWREG),CCWSEL FAIL ON SELECT?           @YA02456 26549202
         BNE   ANDERCNT           NO,CHECK LAST                @YA02456 26549602
         LA    IXREG,0            SET RETRY SELSCT             @YA02456 26549702
ANDERCNT EQU   *                  RETRY SELECT ARGUMENT SET    @YA02456 26549802
*              2 LINES DELETED                                 @YM5690K 26550000
         CLI   IOSSNS,SENIR    INTV REQ WITH DE UC STATUS IS   @ZA06396 26580000
         BE    IRMSG                   ASYNC ERROR - RETRY     @ZA06396 26610000
         CLI   IOSSNS,SNIRECUS          IR,EQUIP CHK,UNIT SP            26650002
         BE    CHKEC(IXREG)             YES-CHECK CHAN PGM     @YA02456 26700002
         CLI   IOSSNS,SENECUS           EQUIP CHK,UNIT SP               26750002
         BE    CHKEC(IXREG)             YES-CHECK CHAN PGM     @YA02456 26800002
         CLI   IOSSNS,SENDC             DATA CHECK                      26850002
         BE    ANALCMD(IXREG)           YES-CHECK CHAN PGM     @YA02456 26900002
         CLI   IOSSNS,SENCC             CONTROL CHECK                   26950002
         BE    ANALCMD(IXREG)           YES-CHECK CHAN PGM     @YA02456 27000002
         CLI   IOSSNS,SENDCUS           DATA CHK,UNIT SPECIFY           27050002
         BE    ANALCMD(IXREG)           YES-CHECK CHAN PGM     @YA02456 27100002
         B     UNREC1                   EXIT                   @YA03250 27150000
*              22 LINES MOVED TO NEAR LINE 314465 OR DELETED   @YM5690K 27200000
CHKEC    EQU   *                                                        27900002
         B     RECRTY1            RETRY THE SELECT             @YA02456 27910002
         BAL   LNKREG,CMDSRCH           FIND LAST COMMAND               27950002
         CLI   CCWCMD(CCWREG),CCWWRT    WRITE                           28050002
         BE    PERMEXIT                 YES-PER ERROR EXIT              28100002
         CLI   CCWCMD(CCWREG),CCWEWR    ERASE WRITE                     28150002
         BE    PERMEXIT                 YES PER ERROR EXIT  E12 ZA25921 28160001
         CLI   CCWCMD(CCWREG),CCWEWA     ER/WRT ALTERNATE?  E12 ZA25921 28170001
*     TWO LINES REDUCED TO ONE AND SIXTEEN MOVED HERE BY APAR  @ZA15403 28200000
         BNE   UNREC1                   NO, EXIT WITH ERROR    @ZA15403 28207000
PERMEXIT EQU   *                                                        28214000
         OI    IOSFLB,IOSLOG            INDICATE OBR LOGOUT    @YA02128 28221000
PERMNOBR DS    0H                                              @YA02128 28228000
         TM    SRTESTAT,UCBONLI+UCBSYSR   DEV. AN ONLINE ACTIVE CONSOLE 28235000
         BO    UNREC1                   IF YES-LOG WITHOUT ERROR MSG    28242000
         NI    IOBERRCT+ONE,N255-HEX04   RESET USER CORRECTABLE         28249000
         MVI   EWACNTR1,ZERO            CLEAR RETRY COUNT               28256000
*              1 LINE MOVED                                    @YA02128 28263000
         NI    IOSFLA,N255-IOSERR       INDICATE PER IN IOSB FLAGS      28270000
         NI    IOBFLAG1,N255-IOBERRTN      ALSO IN IOB                  28277000
         OI    IOSFLB,IOSMSG            PERM ERROR MSG REQUIRED         28284000
WTOEXIT  EQU   *                                                        28291000
         LA    LDNAMREG,IOSWTO          ADDRESS OF IOS WTO ROUTINE      28298000
XCTLEXIT EQU   *                                                        28305000
         LR    PARMREG,IOSBREG     RESTORE REG 1 TO IOSB ADDR  @YM2594K 28312000
         L     RETREG,CVTXTLER          POINT TO BRANCH ENTRY           28319000
         BR    RETREG                   EXIT VIA XCTL BRANCH ENTRY      28326000
ANALCMD  EQU   *                                                        28350002
         B     RECRTY1            RETRY THE SELECT             @YA02456 28360002
         BAL   LNKREG,CMDSRCH           FIND LAST COMMAND               28400002
         CLI   CCWCMD(CCWREG),CCWWRT    WRITE                           28500002
         BE    UNREC1                   YES-EXIT WITH ERROR             28550002
         CLI   CCWCMD(CCWREG),CCWEWR    ERASE WRITE                     28600002
         BE    RECRTY1                  YES-RETRY                       28650002
         CLI   CCWCMD(CCWREG),CCWEWA   ER/WRT ALTERNATE?    E12 ZA25921 28680001
         BE    RECRTY1                 YES RETRY            E12 ZA25921 28690001
         CLI   CCWCMD(CCWREG),CCWSEL    SELECT                          28750002
         BE    CHKRTY                   YES-CHECK FOR RETRY             28800002
         CLI   CCWCMD(CCWREG),CCWEUP    ERASE UNPROTECTED               28850002
         BNE   UNREC1                   NO, EXIT               @YA03250 28900000
CHKRTY   EQU   *                                                        29000002
         CLI   IOSSNS,SENDCUS           DATA CHK,UNIT SPECIFY           29050002
         BE    UNREC1                   YES-EXIT WITH ERROR             29100002
RECRTY1  EQU   *                                                        29110002
         CLI   IOSSNS,SENDC            DATA CHECK?                      29120002
         BE    SETDC1                  YES,SET ERROR                    29130002
         CLI   IOSSNS,SENCC            CTRL CHK?                        29140002
         BE    SETCC1                  YES, SET CC                      29142002
         OI    EWASTUP+ONE,STDCUS      SET DC, US FOR STAT UPDATE       29144002
*     ONE LINE DELETED AND FOUR MOVED HERE BY APAR------->     @ZA15403 29150000
STORCCW  EQU   *                                                        29152000
         LRA   CCWREG,ZERO(CCWREG)      GET REAL ADDRESS FOR IOS        29154000
         ST    CCWREG,IOSRST            RETRY CCW ADDR                  29156000
         B     RTYCNT                                                   29158000
*                                                                       29160002
SETDC1   EQU   *                                                        29170002
         OI    EWASTUP,STATDC          SET DC FOR STAT UPDATE  @YA01061 29180002
         B     STORCCW                 RETRY CCW ADDR                   29190002
*                                                                       29192002
SETCC1   EQU   *                                                        29194002
         OI    EWASTUP,SENCC           SET CC FOR STAT UPDATE           29196002
         B     STORCCW                 RETRY CCW ADDR                   29198002
CDCERR   EQU   *                                                        29700002
         L     CCWREG,IOSCC             ADDR OF CCW                     29750002
         LA    CCWREG,ZERO(CCWREG)      CLEAR HI BYTE                   29800002
         SH    CCWREG,CONEIGHT          FAILING CCW ADDR                29850002
         BNP   UNREC1              BRANCH IF ADDRESS WAS ZERO  @YA03250 29950000
         TM    CCWCMD(CCWREG),CCWX07    TIC COMMAND                     30000002
         BNZ   CDCNTIC                 CAN NOT BE A TIC        @YA01064 30010002
         TM    CCWCMD(CCWREG),CCWTIC   TIC BIT PRESENT         @YA01064 30020002
         BO    UNREC1                   YES-UNREC EXIT         @YA01064 30050002
CDCNTIC  DS    0H                                              @YA01064 30100002
         CLI   CCWCMD(CCWREG),CCWWRT    WRITE                           30150002
         BE    UNREC1                   YES-UNREC EXIT                  30200002
         CLI   CCWCMD(CCWREG),CCWEWR    ERASE WRITE                     30250002
         BE    CHKCHAIN                 YES-CHECK CHAINING              30300002
         CLI   CCWCMD(CCWREG),CCWEWA    ER/WRT ALTERNATE?   E12 ZA25921 30330001
         BE    CHKCHAIN                 YES CHECK CHAINING  E12 ZA25921 30340001
         CLI   CCWCMD(CCWREG),CCWRDM    READ MODIFIED                   30400002
         BE    CHKWRTCM                 YES-CHECK CHAN PGM FOR WRITE    30450002
         CLI   CCWCMD(CCWREG),CCWRDB    READ BUFFER                     30500002
         BE    CHKWRTCM                 YES-CHECK CHAN PGM FOR WRITE    30550002
RTYCCW   EQU   *                                                        30560002
         OI    EWASTUP+ONE,STCDC       SET CDC FOR STAT UPDATE          30570002
         B     STORCCW                  RETRY FAILING CMD               30600002
CHKCHAIN EQU   *                                                        30650002
         TM    IOSFLA,IOSDCHN           DATA CHAIN IN CH PGM            30700002
         BO    RTYCHPGM                 YES-RETRY CHAN PGM              30750002
         B     RTYCCW                   NO-RETRY FAILING CMD            30800002
CHKWRTCM EQU   *                                                        30850002
         LA    CMDREG,CCWWRT            ANY WRITE CMD                   30900002
         BAL   LNKREG,CHKCMD            LINK TO CHK CHAN PGM            30950002
         B     BRTABLE3(IXREG)          RETURN BRANCH TABLE             31000002
BRTABLE3 EQU   *                                                        31050002
         B     UNREC1                   WRT IN CHAN PGM-EXIT            31100002
RTYCHPGM EQU   *                                                        31110002
         OI    EWASTUP+ONE,STCDC       SET CDC FOR STAT UPDATE          31120002
         B     RTYCNT                   RETRY CHAN PGM                  31150002
         SPACE 3                                                        31352002
*                                                           LD @ZA02809 31354002
ANALCHAN EQU   *                                                        31354600
         BAL   LNKREGB,CHKDIAG          CHECK FOR DIAG CMD              31355200
         B     BRTABLE2(IXREG)          DIAG CMD RTN BR TBL             31356000
BRTABLE2 EQU   *                                                        31356500
         B     PERMEXIT                 DIAG CMD-PER ERR EXIT           31357000
         TM    IOSTSB,CSWCDC            CHANNEL DATA CHECK              31357500
         BO    CDCERR                   YES-CHECK FOR RETRY             31358000
         TM    IOSTSB,CSWCCC+CSWICC     CCC OR ICC                      31358400
         BZ    SNOEXIT                  NO, EXIT                        31358800
         TM    CVTOPTA,CVTCCH      CCH IN SYSTEM            LD @ZA02809 31359200
*   TWO LINES REDUCED TO ONE AND TWELVE MOVED HERE BY APAR-->  @ZA15403 31359700
         BNO   PERMEXIT                  NO-PER ERR EXIT       @ZA15403 31359900
*                                                           LD @ZA02809 31360000
*              PROCESS CHANNEL ERRORS (ICC AND CCC)         LD @ZA02809 31360100
*                                                           LD @ZA02809 31360200
*                                                           LD @ZA02809 31360300
CHKCHAN  EQU   *                                            LD @ZA02809 31360400
         MVC   ERPIBTRM(ONE),EWAXCSW2  MOVE TRM CODE        LD @ZA02809 31360500
         NI    ERPIBTRM,EWACTEC    CLEAR UNWANTED BITS      LD @ZA02809 31360600
         MVC   ERPIBSEQ(ONE),EWAXCSW2  MOVE SEQ CODE        LD @ZA02809 31360700
         NI    ERPIBSEQ,EWACSEQ    CLEAR UNWANTED BITS      LD @ZA02809 31360800
         TM    EWARGFG1,EWANORTY   CAN RETRY BE DONE        LD @ZA02809 31361702
         BO    UNREC1              NO, UNREC                LD @ZA02809 31362102
         TM    EWAXCSW1,EWACSQV+EWACCHV  SEQ CODE AND...    LD @ZA02809*31362502
                                   ...CHAN ADDR VALID ?     LD @ZA02809 31362902
         BNO   UNREC1              NO, UNREC                LD @ZA02809 31363302
         TM    EWARGFG1,EWACTIO+EWACHIO  HALT I/O OR...     LD @ZA02809*31363402
                                   ...TEST I/O ?            LD @ZA02809 31363502
         BM    UNREC1              YES, UNREC               LD @ZA02809 31363602
         TM    EWARGFG1,EWACSIO    START I/O ?              LD @ZA02809 31363702
         BZ    TSTRESET            NO, BRANCH               LD @ZA02809 31363802
         TM    EWAXCSW1,EWACDAV    DEVICE ADDR VALID ?      LD @ZA02809 31363902
         BNO   UNREC1              NO, UNREC                LD @ZA02809 31364002
TSTRESET EQU   *                                            LD @ZA02809 31364102
         CLI   ERPIBTRM,EWATER3    SYSTEM ERROR ?           LD @ZA02809 31364202
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31364302
         CLI   ERPIBSEQ,EWASEQ0    SEQ CODE 0 ?             LD @ZA02809 31364402
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31364502
         CLI   ERPIBSEQ,EWASEQ6    SEQ CODE 6 ?             LD @ZA02809 31364602
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31364702
         CLI   ERPIBSEQ,EWASEQ7    SEQ CODE 7 ?             LD @ZA02809 31364802
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31364902
         TM    IOSCC,IOSCC3        SIO COND CODE 3 ?        LD @ZA02809 31365002
         BO    UNREC1              YES, UNREC               LD @ZA02809 31365102
         TM    IOSCC,IOSCC1        SIO COND CODE 1 ?        LD @ZA02809 31365302
         BNO   CKCMDVAL            NO, BRANCH               LD @ZA02809 31365702
         L     PARMREG,IOSRST      REAL ADDR OF CCW         LD @ZA02809 31366102
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDR OF REAL LD @ZA02809 31366502
         LA    CCWREG,ZERO(PARMREG)  INTO CORRECT REG       LD @ZA02809 31366902
         B     SEQ5CHK             BRANCH                   LD @ZA02809 31367002
CKCMDVAL EQU   *                                            LD @ZA02809 31367102
         TM    EWAXCSW1,EWACCMD    CMD ADDR VALID ?         LD @ZA02809 31369002
         BNO   UNREC1              NO, UNREC                LD @ZA02809 31369402
         BAL   LNKREG,GETCMD       GET ADDR OF...           LD @ZA02809*31371402
                                   ...FAILING CCW           LD @ZA02809 31371802
SEQ5CHK  EQU   *                                            LD @ZA02809 31372202
         CLI   ERPIBSEQ,EWASEQ5    SEQ CODE 5 ?             LD @ZA02809 31372302
         BE    SEQ5PROC            YES, HANDLE              LD @ZA02809 31372402
         CLI   ERPIBSEQ,EWASEQ4    SEQ CODE 4 ?             LD @ZA02809 31372502
         BE    SEQ4PROC            YES, HANDLE              LD @ZA02809 31372902
         CLI   ERPIBSEQ,EWASEQ3    SEQ CODE 3 ?             LD @ZA02809 31373302
         BE    SEQ3PROC            YES, HANDLE              LD @ZA02809 31373702
         CLI   ZERO(CCWREG),CCWTIC CMD A TIC ?              LD @ZA02809 31373802
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31373902
         CLI   ERPIBSEQ,EWASEQ2    SEQ CODE 2 ?             LD @ZA02809 31374302
         BE    SEQ2PROC            YES,HANDLE               LD @ZA02809 31374702
SEQ1PROC EQU   *                                            LD @ZA02809 31375102
         CLI   ERPIBTRM,EWATER2    SELECTIVE RESET          LD @ZA02809 31375202
         BE    CONDRTRY            YES, MAY BE RETRIED      LD @ZA02809 31375302
SEQ1TRM1 EQU   *                                            LD @ZA02809 31375702
         CLI   ERPIBTRM,EWATER3-EWATER2  NORMAL TERMINATION LD @ZA02809 31376102
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31376502
         B     RETRY               NO, RETRY                LD @ZA02809 31376602
SEQ2PROC EQU   *                                            LD @ZA02809 31376702
         CLI   ERPIBTRM,EWATER2    SELECTIVE RESET          LD @ZA02809 31378502
         BE    RETRY               YES, RETRY               LD @ZA02809 31378902
         B     SEQ1TRM1            NO, BRANCH               LD @ZA02809 31379302
SEQ3PROC EQU   *                                            LD @ZA02809 31379702
         CLI   ZERO(CCWREG),CCWSEL SELECT CMD ?             LD @ZA02809 31380102
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31380202
         CLI   ZERO(CCWREG),CCWEUP ERASE ALL UNPROCTECTED ? LD @ZA02809 31380602
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31381002
         CLI   ZERO(CCWREG),CCWNOP NO-OP ?                  LD @ZA02809 31381402
         BE    SNOEXIT             YES, SNO                 LD @ZA02809 31381502
         B     RETRY               NO, RETRY                LD @ZA02809 31381602
SEQ4PROC EQU   *                                            LD @ZA02809 31381702
         CLI   ERPIBTRM,EWATER2    SELECTIVE RESET          LD @ZA02809 31381802
         BE    CONDRTRY            YES, MAY BE RETRIED      LD @ZA02809 31381902
RETRY    EQU   *                                            LD @ZA02809 31382002
         CLI   ZERO(CCWREG),CCWWRT WRITE CMD ?              LD @ZA02809 31382102
         BNE   RTYERR              NO, BRANCH               LD @ZA02809 31382502
         L     PARMREG,ZERO(CCWREG)    GET REAL DATA ADDR   L5 @ZA03552 31382900
         BAL   ICREG,TRANSRTV          GET VIRT DATA ADDR   L5 @ZA03552 31383000
         LA    ICREG,ZERO(PARMREG)     INTO CORRECT REG     L5 @ZA03552 31383100
         CLI   SBABYTE(ICREG),SBA  2ND BYTE AN SBA ?        LD @ZA02809 31383302
         BNE   UNREC1              NO, UNREC                LD @ZA02809 31383402
RTYERR   EQU   *                                            LD @ZA02809 31383802
         LRA   CCWREG,ZERO(CCWREG) SET REAL ADDR FOR IOS    LD @ZA02809 31384102
         ST    CCWREG,IOSRST       POINT TO FAILING CMD     LD @ZA02809 31384502
         B     RTYCNT              GO RETRY                 LD @ZA02809 31384902
CONDRTRY EQU   *                                            LD @ZA02809 31385002
         L     PARMREG,IOSRST      REAL ADDR OF 1ST CCW     LD @ZA02809 31385102
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDR OF REAL LD @ZA02809 31385502
         LA    ICREG,ZERO(PARMREG)  INTO CORRECT REG        LD @ZA02809 31385902
         CR    ICREG,CCWREG        IS FAILING CMD 1ST...    LD @ZA02809*31386302
                                   ...IN STRING ?           LD @ZA02809 31386802
         BE    UNREC1              YES, UNREC               LD @ZA02809 31387202
         B     RETRY               GO RETRY                 LD @ZA02809 31387602
SEQ5PROC EQU   *                                            LD @ZA02809 31387702
         TM    EWARGFG1,EWACSIO    CSW STORE AFTER SIO ?    LD @ZA02809 31387802
         BO    SEQ3PROC            YES, HANDLE AS SEQ 3     LD @ZA02809 31387902
         B     RETRY               NO, RETRY                LD @ZA02809 31388102
         SPACE 3                                                        31388502
*********************************************************************** 31388602
*                                                                     * 31389002
*                  GETCMD SUBROUTINE                                  * 31389402
*                                                                     * 31390002
*        THIS SUBROUTINE STORES THE ADDR OF FAILING                   * 31390102
*        COMMAND IN CCWREG, IF THE FAILING CCW HAS DATA               * 31390202
*        CHAINIG ON, THIS ROUTINE BACKS UP THE ADDR TO                * 31390602
*        THE 1ST CCW IN THE STRING WITH DATA CHAINING.                * 31390702
*        IF THE FAILING CCW IS A TIC, THE ADDRESS OS THE              * 31390802
*        CCW TIC'ED TO IS USED.                                       * 31390902
*        NOTE: IF THE CSW ADDRESS IS ZERO AND DEVICE END,             * 31391302
*        THE FAILING CCW IS THE LAST IN THE CHAIN.                    * 31392002
*                                                                     * 31392802
*********************************************************************** 31393402
         SPACE 2                                                        31393502
GETCMD   EQU   *                                            LD @ZA02809 31393802
         SR    ICREG,ICREG         GET CCW ADDR FR CSW WITH    @ZA15403 31395200
         ICM   ICREG,M7,IOSCSWCA   HIGH BYTE CLEAR             @ZA15403 31395300
         LTR   ICREG,ICREG         IS ADDR ZERO ?           LD @ZA02809 31395402
         BZ    CHKDE               YES,SEE IF DE WITHOUT CE LD @ZA02809 31395502
         SH    ICREG,CONEIGHT      NO, BACK UP TO...        LD @ZA02809*31395602
                                   ...FAILING CCW.          LD @ZA02809 31395702
         BNP   SNOEXIT             IF BAD, GET OUT          LD @ZA02809 31395802
         B     GETSTART            GO TO GET CPA ADDR       LD @ZA02809 31395902
CHKDE    EQU   *                                            LD @ZA02809 31396002
         TM    IOSTSA,CSWCHE       IS CHAN END ON ?         LD @ZA02809 31396100
         BO    SNOEXIT             ADDR SHOULD NOT BE ZERO  LD @ZA02809 31396302
         TM    IOSTSA,CSWDVE       IS DVC END ON ?          LD @ZA02809 31396702
         BNO   SNOEXIT             NO, SHOULDN'T OCCUR.     LD @ZA02809 31396802
GETSTART EQU   *                                            LD @ZA02809 31396902
         LR    WKREG1,ICREG        SAVE CCW ADDR            LD @ZA02809 31397002
         L     PARMREG,IOSRST      SET PARM FOR TRANSLATION LD @ZA02809 31397100
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDR OF REAL LD @ZA02809 31397202
         LA    CCWREG,ZERO(PARMREG)  INTO CORRECT REG.      LD @ZA02809 31397302
         LR    ICREG,WKREG1        RESTORE CCW ADDRESS      LD @ZA02809 31397702
         LR    WKREG1,CCWREG                                LD @ZA02809 31398102
CHNLOOP  EQU   *                                            LD @ZA02809 31398202
         CR    WKREG1,ICREG        IS THIS THE FAILING CCW  LD @ZA02809 31398602
         BE    FOUNDCMD            YES, BRANCH              LD @ZA02809 31398702
         CLI   CCWCMD(WKREG1),CCWTIC  IS THIS CCW A TIC ?   LD @ZA02809 31398802
         BE    TICRTN              YES, HANDLE              LD @ZA02809 31398902
         TM    CCWFLGS(WKREG1),CCWCD IS THIS CCW DATA CHN'D LD @ZA02809 31400002
         BNO   TSTCMDCH            NO,CONTINUE CHECKING     LD @ZA02809 31402402
         AH    WKREG1,CONEIGHT     UP FAILING CCW ADDR      LD @ZA02809 31402802
         B     CHNLOOP             CHECK NEXT CCW           LD @ZA02809 31403202
TSTCMDCH EQU   *                                            LD @ZA02809 31403302
         TM    CCWFLGS(WKREG1),CCWCC IS THIS CCW CMD CHN'D  LD @ZA02809 31403402
         BNO   SEEIFDE             NO, END OF CHAN PGM      LD @ZA02809 31403500
         AH    WKREG1,CONEIGHT     UPDATE FAILING CCW...    LD @ZA02809*31403600
                                   ...ADDR AND              LD @ZA02809 31404102
         LR    CCWREG,WKREG1       RESTART ADDR             LD @ZA02809 31404502
         B     CHNLOOP             CHECK NEXT CCW           LD @ZA02809 31404902
SEEIFDE  EQU   *                                            LD @ZA02809 31405002
         LTR   ICREG,ICREG         IS CSW ADDR ZERO ?       LD @ZA02809 31405102
         BNZ   SNOEXIT             NO, SHOULD HAVE FOUND... LD @ZA02809*31405402
                                   ...FAILING CCW.          LD @ZA02809 31405802
         B     FOUNDCMD            YES, FOUND               LD @ZA02809 31406202
TICRTN   EQU   *                                            LD @ZA02809 31406302
         SH    WKREG1,CONEIGHT     BACK UP TO PREV. CCW     LD @ZA02809 31406402
         TM    CCWFLGS(WKREG1),CCWCD  IS IT DATA CHN'D ?    LD @ZA02809 31406502
         BO    TICTOADR            YES, BRANCH              LD @ZA02809 31406602
         LR    WKREG7,ICREG             SAVE ICREG          L5 @ZA03552 31406700
         L     PARMREG,ZERO(CCWREG)   GET REAL TICD TO ADDR L5 @ZA03552 31407400
         BAL   ICREG,TRANSRTV          GET VIRT TICD ADDR   L5 @ZA03552 31408100
         LA    CCWREG,ZERO(PARMREG)    INTO CORRECT REG     L5 @ZA03552 31410100
         LR    ICREG,WKREG7            RESTORE ICREG        L5 @ZA03552 31412100
TICTOADR EQU   *                                            LD @ZA02809 31413202
         AH    WKREG1,CONEIGHT     GET FAILING TIC ADDR     LD @ZA02809 31413902
         LR    WKREG7,ICREG            SAVE ICREG           L5 @ZA03552 31414600
         L     PARMREG,ZERO(WKREG1)   GET REAL TICD TO ADDR L5 @ZA03552 31415300
         BAL   ICREG,TRANSRTV         GET VIRT TICD TO ADDR L5 @ZA03552 31416000
         LA    WKREG1,ZERO(PARMREG)    INTO CORRECT REG     L5 @ZA03552 31416400
         LR    ICREG,WKREG7            RESTORE ICREG        L5 @ZA03552 31416500
         B     CHNLOOP             CONTINUE                 LD @ZA02809 31416702
FOUNDCMD EQU   *                                            LD @ZA02809 31417402
         CLI   ZERO(WKREG1),CCWTIC IS RESTART CCW A TIC ?   LD @ZA02809 31418102
         BNE   CMDOUT              NO, RETURN               LD @ZA02809 31418802
         SH    WKREG1,CONEIGHT     BACK UP TO PREV. CCW     LD @ZA02809 31419502
         TM    CCWFLGS(WKREG1),CCWCD  DATA CHAINED ?        LD @ZA02809 31420202
         BO    CMDOUT              YES,RETURN               LD @ZA02809 31420902
         L     PARMREG,EIGHT(WKREG1)  GET REAL TICD TO ADDR L5 @ZA03552 31421600
         BAL   ICREG,TRANSRTV         GET VIRT TICD TO ADDR L5 @ZA03552 31422300
         LA    CCWREG,ZERO(PARMREG)    INTO CORRECT REG     L5 @ZA03552 31423000
CMDOUT   EQU   *                                            LD @ZA02809 31423702
         BR    LNKREG              RETURN TO CALLER         LD @ZA02809 31424402
         EJECT                                                          31521900
*********************************************************************** 31522700
*              CHKDIAG SUBROUTINE                                     * 31526600
*        THIS  SUBROUTINE PLACES A DIAGNOSTIC WRITE / DIAGNOSTIC READ * 31538302
*        COMMAND CODE IN CMDREG AND LINKS TO THE CHKCMD SUBRTN. THE   * 31550002
*        CHKCMD SUBRTN CHECKS IF EITHER COMMAND IS CONTAINED IN THE   * 31600002
*        CHANNEL PROGRAM.THE RETURN CODE RETURNED BY THE CHKCMD SUBRTN* 31650002
*        IS PASSED BACK TO THE CALLER.                                * 31700002
*********************************************************************** 31750002
CHKDIAG  EQU   *                                                        31800002
         LA    CMDREG,CCWDWR            DIAG WRITE CMD                  31850002
         BAL   LNKREG,CHKCMD            LINK TO CHECK CMD               31900002
         B     BRTABD(IXREG)            RETURN BRANCH TABLE             31950002
BRTABD   EQU   *                                                        32000002
         BR    LNKREGB                  DWR FOUND-RETURN                32050002
         NOPR  TEMPREG                  PAD FOR RET CODE INDEX          32100002
         LA    CMDREG,CCWDRD            DIAG READ CMD                   32150002
         BAL   LNKREG,CHKCMD            LINK TO CHECK CMD               32200002
         BR    LNKREGB                  RETURN WITH RET CODE            32250002
         SPACE 3                                                        32260000
*********************************************************************** 32300002
*              CHKCMD SUBROUTINE                                      * 32350002
*        THIS SUBROUTINE COMPARES THE COMMAND CODE OF EACH CCW IN A   * 32400002
*        CHANNEL PROGRAM TO THE COMMAND CODE CONTAINED IN CMDREG.     * 32450002
*        IF THE COMMAND IS FOUND,A RETURN CODE OF ZERO IS PLACED IN   * 32500002
*        IXREG. IF IT IS NOT FOUND,THE RETURN CODE IS FOUR.           * 32550002
*********************************************************************** 32600002
CHKCMD   EQU   *                                                        32650002
         L     PARMREG,IOSRST      REAL ADDRESS OF FIRST CCW   @YM2594K 32660002
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDRESS OF REAL @YM2594K 32670002
         LA    CCWREG,ZERO(PARMREG)    INTO CORRECT REG        @YM2594K 32680002
         SR    IXREG,IXREG              CLEAR FOR CMD          @YM2594K 32750002
CMDLOOP  EQU   *                                                        32800002
         IC    IXREG,CCWCMD(CCWREG)     PICK UP COMMAND        @YM2594K 32850002
         CLR   CMDREG,IXREG             CHECK FOR COMMAND      @YM2594K 32900002
         BE    SETCFND                  YES-SET COMMAND FOUND RET CODE  32950002
         CLI   CCWCMD(CCWREG),CCWTIC   IS IT TIC?           L5 @ZA02841 33000000
         BE    ADJADR1                 YES                  L5 @ZA02841 33050000
CMDNOTIC EQU   *                                                        33200002
         TM    CCWFLGS(CCWREG),CCWCC+CCWCD CHAINING INDICATED           33250002
         BZ    SETCNFND                 NO-SET CMD NOT FOUND RET CODE   33300002
         LA    CCWREG,EIGHT(CCWREG)     YES-INCR TO NEXT CCW            33350002
         CLM   CCWREG,SEVEN,IOSCSWCA   IS NXT CCW FAIL CCW? L5 @ZA02841 33360000
*  TWO LINES REDUCED TO ONE AND THREE MOVED HERE BY APAR-->    @ZA15403 33370000
         BNE   CMDLOOP                 NO  CONTINUE CHECKING   @ZA15403 33380000
SETCNFND EQU   *                                                        33390000
         LA    IXREG,FOUR               SET CMD NOT FOUND RC            33400000
         BR    LNKREG                   RETURN TO CALLER                33410000
ADJADR1  EQU   *                                                        33450002
         L     PARMREG,ZERO(CCWREG)     PICK UP NEXT CCW ADDR  @YM2594K 33500002
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDRESS OF REAL @YM2594K 33520002
         LA    CCWREG,ZERO(PARMREG)    INTO CORRECT REG        @YM2594K 33530002
         B     CMDLOOP                  CONTINUE TO CHECK COMMAND       33550002
SETCFND  EQU   *                                                        33750002
         LA    IXREG,ZERO               SET CMD FOUND RC                33800002
         BR    LNKREG                   RETURN TO CALLER                33850002
         SPACE 3                                                        33860000
*********************************************************************** 33900002
*              CMDSRCH SUBROUTINE                                     * 33950002
*        THE CMDSRCH SUBROUTINE SEARCHS A CHANNEL PROGRAM,BEGINNING   * 34000002
*        WITH THE ADDRESS IN IOBSTART,TO FIND THE ADDRESS OF THE LAST * 34050002
*        COMMAND IN THE CHANNEL PROGRAM. THAT IS,THE LAST CCW THAT IS * 34100002
*        NOT A TIC AND DOES NOT HAVE THE COMMAND CHAINING FLAG ON.    * 34150002
*        WHEN CONTROL IS RETURNED TO THE CALLER,THE LAST COMMAND      * 34200002
*        ADDRESS IS IN CCWREG.                                        * 34250002
*********************************************************************** 34300002
CMDSRCH  EQU   *                                                        34350002
         L     PARMREG,IOSRST      REAL ADDRESS OF FIRST CCW   @YM2594K 34360002
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDRESS OF REAL @YM2594K 34370002
         LA    CCWREG,ZERO(PARMREG)    INTO CORRECT REG        @YM2594K 34380002
         LR    WKREG1,CCWREG            ESTABLISH WORK REG              34500002
CHKLOOP  EQU   *                                                        34550002
         TM    CCWFLGS(WKREG1),CCWCC    CMD CHAINING                    34600002
         BO    NEXTCCWA                 YES-CHECK NEXT CCW              34650002
         TM    CCWFLGS(WKREG1),CCWCD    DATA CHAINING                   34700002
         BO    NEXTCCWB                 YES-CHECK NEXT CCW              34750002
         TM    CCWCMD(WKREG1),CCWX07    LOW ORDER BITS 0'S     @YA01064 34760002
         BNZ   NOTICCMD                 BRANCH IF NOT          @YA01064 34770002
         TM    CCWCMD(WKREG1),CCWTIC    TIC COMMAND            @YA01064 34780002
         BO    ADJADR2                  YES-ADJUST ADDR        @YA01064 34790002
NOTICCMD EQU   *                                               @YA01064 34792002
         BR    LNKREG                   NO-LAST FOUND,RETURN            34900002
NEXTCCWA EQU   *                                                        34950002
         LA    WKREG1,EIGHT(WKREG1)     NEXT CCW ADDR                   35000002
         LR    CCWREG,WKREG1            MAINTAIN LAST CMD ADR           35050002
         B     CHKLOOP                  CONTINUE CHAINING CHK           35100002
NEXTCCWB EQU   *                                                        35150002
         LA    WKREG1,EIGHT(WKREG1)     NEXT CCW ADDR                   35200002
         B     CHKLOOP                  CONTINUE CHAINING CHK           35250002
ADJADR2  EQU   *                                                        35300002
         L     PARMREG,ZERO(WKREG1)      NEXT CCW ADDR         @YM2594K 35350002
         BAL   ICREG,TRANSRTV      GET VIRTUAL ADDRESS OF REAL @YM2594K 35370002
         LA    WKREG1,ZERO(PARMREG)    INTO CORRECT REG        @YM2594K 35380002
         LR    CCWREG,WKREG1            MAINTAIN LAST CMD ADR           35400002
         B     CHKLOOP                  CONTINUE CHAINING CHK           35450002
         SPACE 3                                                        35450100
*********************************************************************** 35450402
*                                                                       35452002
*              TRANSLATE REAL TO VIRTUAL SUBROUTINE                     35454002
*        HANDLES INTERFACE TO THE PAGE SUPERVISOR'S ROUTINE WHICH       35456002
*        TRANSLATES REAL ADDRESS INTO VIRTUAL ADDRESSES                 35458002
*                                                                       35458402
*        NOTE THAT THIS DESTROYS WKREG7 (REG 7) AS WELL AS THE          35458802
*        INTERFACE REGS USED GOING TO IEAPTRV AND ICREG (REG 9)         35459202
*        WHICH IS USED AS A RETURN REG.                                 35459602
*                                                                       35459702
*********************************************************************** 35462202
TRANSRTV DS    0H                     ENTER TRANSLATE ROUTINE  @YM2594K 35465002
         LA    PARMREG,ZERO(PARMREG)   CLEAR BYTE ZERO         @YM2594K 35467502
*                                                                       35469500
*              1 LINE DELETED FOR ----->                    LD @ZA02815 35471500
*                                                                       35471900
         STM   ICREG,BASREG,EWAIERP+16  SAVE REGS              @ZA11043 35473900
         SR    WKREG7,WKREG7                                   @ZA11043 35474700
         USING RQE,RQEBASE             BASE RQE                @ZA04166 35475500
         L     RQEBASE,IOSUSE          LOAD RQE BASE REG       @ZA04166 35476300
         TM    RQETYPE,RQE1TO1         DOES V EQUAL R ?        @ZA04166 35477100
         BO    TRRETRN           YES RETURN NO TRANSLATION     @ZA11043 35477900
         DROP  RQEBASE                                         @ZA04166 35478700
         L     BASREG,CVTPTRV          GET ENTRY TO TRANSLATE  @YM2594K 35480002
*                                              REAL TO VIRTUAL @YM2594K 35490002
*        GETLOCK SETLOCK OBTAIN DELETED BY APAR-------->    E12 ZA30908 35490400
         BALR  EWAREG,BASREG           GO DO TRANSLATION       @YM2594K 35492002
         LR    WKREG7,BASREG       SAVE RETURN CODE         LD @ZA02815 35492400
*                                                                       35492800
*              2 LINES DELETED FOR ----->                   LD @ZA02815 35494000
*                                                                       35494400
*        FREELOCK SETLOCK RELEASE DELETED BY APAR---------> E12 ZA30908 35496800
         USING START,BASREG                                    @ZA04166 35497200
         L     EWAREG,IOSERP           RESTORE BASE FOR EWA LD @ZA02815 35497300
TRRETRN  LM    ICREG,BASREG,EWAIERP+16  RESTORE REGS           @ZA11043 35497600
         LTR   WKREG7,WKREG7       CHECK RETURN CODE...     LD @ZA02815*35498100
                                   ...FROM CCW TRANSLATOR.  LD @ZA02815 35498200
         BNZ   UNREC1                  BRANCH ON BAD           @YA03250 35498400
*                                                TRANSLATION   @YM2594K 35498802
         BR    ICREG                   RETURN TO CALLER        @YM2594K 35499202
         EJECT                                                          35500002
**********                                                              35550002
*                                                                       35600002
*        REGISTER DEFINITIONS                                           35650002
*                                                                       35700002
**********                                                              35750002
TEMPREG  EQU   0                        SELDOM USED WORKREG             35800002
PARMREG  EQU   1                        INPUT PARAMETER REG             35850002
IOSBREG  EQU   2                        IOSB ADDRESS                    35900002
DCBREG   EQU   3                        DCB ADDRESS                     35950002
UCBREG   EQU   4                        UCB ADDRESS                     36000002
CVTREG   EQU   5                        CVT ADDRESS                     36050002
CCWREG   EQU   6                        CCW ADDRESS                     36100002
WKREG7   EQU   7                        WORK REG                        36150002
WKREG1   EQU   8                        WORK REG                        36200002
CMDREG   EQU   WKREG1                   COMMAND REG                     36250002
ICREG    EQU   9                        CHAR REG                        36300002
LNKREG   EQU   10                       LINK REG                        36350002
IXREG    EQU   11                       INDEX REG                       36400002
LNKREGB  EQU   12                       SECOND LINK REG                 36450002
LDNAMREG EQU   13                       NEXT LOAD MODULE NAME           36500002
IOBREG   EQU   LDNAMREG                 IOB BASE                        36550002
RETREG   EQU   14                       BRANCH ENTRY ADDR TO XCTL       36600002
EWAREG   EQU   RETREG                   ERP WORKAREA BASE               36650002
BASREG   EQU   15                       ERP BASE REG                    36700002
RQEBASE  EQU   ICREG                                           @ZA11043 36720000
         SPACE 2                                                        36750002
**********                                                              36800002
*                                                                       36850002
*        DEVICE TYPE FLAGS USED WITH UCBTBYT4                           36900002
*                                                                       36950002
**********                                                              37000002
DEV3277  EQU   X'09'                    3277 DEVICE                     37050002
DEV3284  EQU   X'0A'                    3284 DEVICE                     37100002
DEV3286  EQU   X'0B'                    3286 DEVICE                     37150002
DEV3158  EQU   X'0C'                    3158 DEVICE                     37200002
         SPACE 2                                                        37250002
**********                                                              37300002
*                                                                       37350002
*        CSW  FLAGS                                                     37400002
*                                                                       37450002
**********                                                              37500002
CSWATTN  EQU   X'80'                    ATTENTION           E12 ZA25738 37508000
CSWSTMOD EQU   X'40'                    STATUS MODIFIER     E12 ZA25738 37516000
CSWCUE   EQU   X'20'                    CONTROL UNIT END    E12 ZA25738 37524000
CSWBUSY  EQU   X'10'                    BUSY                E12 ZA25738 37532000
CSWSMBSY EQU   CSWSTMOD+CSWBUSY         ST. MOD. AND BUSY   E12 ZA25738 37540000
CSWCHE   EQU   X'08'                    CHANNEL END                     37550002
CSWDVE   EQU   X'04'                    DEVICE END                      37600002
CSWCDE   EQU   CSWCHE+CSWDVE            CHANNEL END AND DEVICE END      37650002
CSWUCK   EQU   X'02'                    UNIT CHECK                      37700002
CSWUEX   EQU   X'01'                    UNIT EXCEPTION                  37750002
CSWIL    EQU   X'40'                    INCORRECT LENGTH                37800002
CSWPGC   EQU   X'20'                    PROGRAM CHECK                   37850002
CSWPTC   EQU   X'10'                    PROTECTION CHECK                37900002
CSWCDC   EQU   X'08'                    CHANNEL DATA CHECK              37950002
CSWCCC   EQU   X'04'                    CHANNEL CONTROL CHECK           38000002
CSWICC   EQU   X'02'                    INTERFACE CONTROL CHECK         38050002
CSWCCK   EQU   X'01'                    CHAINING CHECK                  38100002
CATCHAN  EQU   CSWCDC+CSWCCC+CSWICC     CATASTROPHIC CHANNEL ERRORS     38150002
CATERR   EQU   CSWIL+CSWPGC+CSWPTC+CSWCCK STATUS ERRORS                 38200002
         SPACE 2                                                        38250002
**********                                                              38300002
*                                                                       38350002
*        SENSE FLAGS                                                    38400002
*                                                                       38450002
**********                                                              38500002
SENCR    EQU   X'80'                    COMMAND REJECT                  38550002
SENIR    EQU   X'40'                    INTERVENTION REQUIRED           38600002
SENBOC   EQU   X'20'                    BUS OUT CHECK                   38650002
SENEC    EQU   X'10'                    EQUIPMENT CHECK                 38700002
SENDC    EQU   X'08'                    DATA CHECK                      38750002
SENCC    EQU   X'02'                    CONTROL CHECK                   38800002
SENOC    EQU   X'01'                    OPERATION CHECK                 38850002
SENDCUS  EQU   X'0C'                  DATA CHECK,UNIT SPECIFY  @YA00844 38900002
SNIRECUS EQU   X'54'                    INT REQ,EQUIP CHK,UNIT SPECIFY  38950002
SENECUS  EQU   X'14'                    EQUIP CHECK,UNIT SPECIFY        39000002
         SPACE 2                                                        39050002
*                                                              @YA01061 39060002
*        THE FOLLOWING FLAGS ARE USED TO SET THE PROPER BITS   @YA01061 39070002
*        IN EWASTUP (INTERFACE TO STATISTICS TABLE UPDATE      @YA01061 39080002
*        ROUTINE) SO THERE WILL BE PROPER EDITING AND PRINTING @YA01061 39090002
*        WHEN IFCEREP0 PRINTS SYS1.LOGREC.                     @YA01061 39092002
*                                                              @YA01061 39094002
STATDC   EQU   X'80'                   DATA CHECK              @YA03227 39096002
STATEC   EQU   X'10'                   EQUIPMENT CHECK         @YA03227 39098002
STATBOC  EQU   X'20'                   BUS OUT CHECK           @YA03227 39098402
STATIR   EQU   X'40'                   INTERVENTION REQUIRED   @YA03227 39098802
**********                                                              39100002
*                                                                       39150002
*        STATISTICS TABLE MULTI BIT SENSE FLAGS                         39200002
*                                                                       39250002
**********                                                              39300002
STDCUS   EQU   X'10'                    DATA CHECK,UNIT SPECIFY         39350002
STCDC    EQU   X'01'                    CHANNEL DATA CHECK              39400002
STIRUS   EQU   X'08'                    INT REQ,UNIT SPECIFY            39450002
STIRECUS EQU   X'04'                    INT REQ,EQUIP CHK,UNIT SPECIFY  39500002
STECUS   EQU   X'02'                    EQUIP CHECK,UNIT SPECIFY        39550002
         SPACE 2                                                        39700002
**********                                                              39750002
*                                                                       39800002
*        CCW COMMAND CODES , DEFINITIONS AND FLAGS                      39850002
*                                                                       39900002
**********                                                              39950002
CCWCPY   EQU   X'07'                    COPY                            39960002
CCWWRT   EQU   X'01'                    WRITE                           40000002
CCWEWR   EQU   X'05'                    ERASE WRITE                     40050002
CCWRDM   EQU   X'06'                    READ MODIFIED                   40100002
CCWSNS   EQU   X'04'                    SENSE                           40150002
CCWNOP   EQU   X'03'                    NO-OP                           40200002
CCWRDB   EQU   X'02'                    READ BUFFER                     40250002
CCWDWR   EQU   X'09'                    DIAGNOSTIC WRITE                40300002
CCWDRD   EQU   X'0A'                    DIAGNOSTIC READ                 40350002
CCWSEL   EQU   X'0B'                    SELECT                          40400002
CCWEWA   EQU   X'0D'                    ER/WRT ALTERNATE    E12 ZA25921 40410001
CCWEUP   EQU   X'0F'                    ERASE ALL UNPROTECTED           40450002
CCWCC    EQU   X'40'                    COMMAND CHAINING                40500002
CCWCD    EQU   X'80'                    DATA CHAINING                   40550002
CCWTIC   EQU   X'08'                    TIC OP CODE                     40600002
CCWX07   EQU   X'07'                    TIC ISOLATER                    40650002
CCWCMD   EQU   0                        COMMAND FIELD                   40700002
CCWFLGS  EQU   4                        FLAGS FIELD                     40750002
CCWCNT   EQU   6                        COUNT FIELD                     40800002
         SPACE 2                                                        40850002
**********                                                              40900002
*                                                                       40950002
*        MISC   DEFINITIONS,FLAGS AND CONSTANTS                         41000002
*                                                                       41050002
**********                                                              41100002
FIRSTFLG EQU   X'80'                    FIRST TIME FLAG                 41110002
INTRETRY EQU   X'10'                    AEA FLAG                        41120002
UEXRETRY EQU   X'20'                   AEA FLAG                         41130002
ZERO     EQU   0                        ZERO                            41150002
ONE      EQU   1                        ONE                             41200002
TWO      EQU   2                        TWO                             41250002
THREE    EQU   3                        THREE                           41300002
FOUR     EQU   4                        FOUR                            41350002
FIVE     EQU   5                   FIVE                        @YM5690K 41360000
EIGHT    EQU   8                        EIGHT                           41400002
NINE     EQU   9                        NINE                            41450002
IOSWTO   EQU   253                      IOS WTO ROUTINE ID              41550002
STATUP   EQU   254                      STATISTICS UPDATE ROUTINE ID    41600002
RETURN   EQU   3                        RETURN SVC                      41700002
EREXCP   EQU   15                       ERROR SVC                       41750002
N255     EQU   255                      AND MASK                        41800002
HEX01    EQU   X'01'                    APPENDAGE FLAG                  41900002
HEX04    EQU   X'04'                    APPENDAGE FLAG                  41950002
HEX07    EQU   X'07'                    APPENDAGE FLAG                  42000002
BTAMOPEN EQU   X'24'       TP OP-CODE USED BY BTAM OPEN        @YM5690K 42010000
SBABYTE  EQU   1           DISP OF SBA IN DATA STREAM.      LD @ZA02809 42020002
SBA      EQU   X'11'       SET BUFFER ADDRESS CHAR          LD @ZA02809 42040002
SEVEN    EQU   7                       VALUE OF SEVEN       L5 @ZA02841 42042000
HIGHDVC  DC    X'100D'            HIGH DEVICE TYPE SUPPORTED   @ZA30723 42044000
LOWDVC   DC    X'1009'             LOW DEVICE TYPE SUPPORTED   @ZA15403 42046000
M7       EQU   7              MASK VALUE OF SEVEN              @ZA15403 42048000
         SPACE 2                                                        42050002
**********                                                              42100002
*                                                                       42150002
*        CONSTANTS                                                      42200002
*                                                                       42250002
**********                                                              42300002
CONEIGHT DC    H'8'                     CONSTANT EIGHT                  42400002
CC3SNS   DC    XL2'10FE'                SPECIAL SENSE FOR SIOCC=3       42410002
PACHAREA EQU   *                                                        42450002
         DC    35C'010E'                PATCH AREA FOR MAINTENANCE      42500002
         EJECT                                                          42550002
UCBSET   DSECT                                                          42600002
         IEFUCBOB                                                       42650002
         EJECT                                                          42700002
CVTSET   DSECT                                                          42710002
         CVT                                                            42750002
         EJECT                                                          42800002
         IEZIOB                                                         42850002
ERPIBTRM EQU   IOBWORK             TERM CODE FROM ERPIB     LD @ZA02809 42860002
ERPIBSEQ EQU   IOBWORK+ONE         SEQ CODE FROM ERPIB      LD @ZA02809 42870002
         EJECT                                                          42900002
         IECDRQE                                                        42950002
         EJECT                                                          43000002
         IECDERWA  (NONE)                                               43050002
         EJECT                                                          43100002
         IECDIOSB                                                       43150002
         EJECT                                                          43200002
         DCBD  DSORG=CX                                                 43250001
         EJECT                                                          43252000
         IHAPSA                                                         43260000
         END                                                            43300002
