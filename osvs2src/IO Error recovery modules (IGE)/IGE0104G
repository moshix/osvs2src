104G     TITLE 'UNIT CHECK (EXCEPT TIME OUT) ON READ/WRITE CCWS - ERP'  00200022
IGE0104G CSECT                                                          00300022
*A-000000-999999                                               @Y02X6E0 00320008
         SPACE 3                                                        00350022
*CHANGE ACTIVITY= AS FOLLOWS:                                           00400022
*A677300                                                         S22029 00400122
*D678000-686000                                                  S22029 00400222
*C212000-224000                                                  A48248 00400322
*A443100                                                         S22025 00400422
*C002000,014000-018000,242000                                    S22025 00400522
*D228000-230000,382000-421300,496000-564000,776000,786000-788000 S22025 00400622
*C065000,682000,683000,778000-787000                             S22025 00400722
*C251000                                                         A47148 00400822
*A168000,720000,853600                                           A47148 00400922
*A440000                                                         A44916 00401022
*A853600                                                         CLUP21 00401122
*C048000,062000-068000,102000,114000,138000,148000-150000        CLUP21 00401222
*C160000,162000,178000,196000-200000,204000-206000,216000,230000 CLUP21 00401322
*C250000,258000,272000,282000,286000,290000-292000,308000,326000 CLUP21 00401422
*C330000,344000-346000,356000-358000,362000-368000,382000,386000 CLUP21 00401522
*C392000-394000,398000,402000,414000,420500,420620-420980,421000 CLUP21 00401622
*C454000,458000-464000,468000,480000-482000,492000-494000,518400 CLUP21 00401722
*C556000,564000,582000,598600,602000,640226,620430,620452,620458 CLUP21 00401822
*C670000-672000,676400-676500,677500,678000-680000,704000        CLUP21 00401922
*C740000-742000                                                  CLUP21 00402022
*D268000,318000,572000,798000-800000,806000,832000,842000-844000 CLUP21 00402122
*C184000-186000,394000,460000,480000-484000,490000,498000         M5576 00402222
*C504000-508000,606080,606200                                     M5576 00402322
*A420500                                                          M6239 00402422
*D420960                                                          M6239 00402522
*C014000,016000                                                  S21903 00402622
*440000                                                         SA59015 00402722
*C251000,296000                                                 SA57694 00402822
*A441500,760000,816000                                          SA57694 00402922
*A677000,677280                                                 SA61794 00403052
*C194000-196000,677240-677245,677270                             X02004 00453005
*A677030-677060,853610-853620,853907-853984                      X02004 00503005
*D677120,677190                                                  X02004 00553005
*C014000,016000                                                  S21903 00603005
*A440200-440300                                                  A59015 00653005
*A 338100-339200,390000-424100,853610,853908-853988              X01004 00653106
*C 194000-196000,282000,306000,332000-335000,374000-377000       X01004 00653206
*C 442900-445600,620120,708000                                   X01004 00653306
*D 283000-284000,308000-314000,336000,378000,426000-442000       X01004 00653406
*D 710000-712000,754000-760000                                   X01004 00653506
*A047000,048100,054500,074000,092500,096500,137000,154600-155200,Y02027 00653606
*A165000,171000,331000,367000,677010,870900                      Y02027 00653706
*C032000,038000,046000,046700,354000,072000-073000,096000,142000,Y02027 00653806
*C372000,396000-412000,422000,422200-422300,423700               Y02027 00653906
*C018000,172000                                                @Z30AAEE 00654008
*D838000                                                       @Z30AAEE 00654108
*A677340                                                       @SA61084 00703961
*A677260                                                       @SA74549 00712909
*D677360,677380                                                @SA74549 00721909
*C332000                                                       @SA73344 00730909
*A442900                                                       @SA73344 00739909
*C442960                                                       @YA10251 00748909
*   PACKAGING PROBLEM                                          @OZ09954 00749091
*D677005,A677060                                               @OZ09950 00749191
*C677060,D677340                                               @OZ24139 00754100
*C677050,D677065-677090                                        @OY19517 00756100
*C677060                                                       @OZ31467 00756286
*C677050,677053-677055                                         @OZ29398 00756386
         SPACE 3                                                        00760022
*********************************************************************** 00800020
*                                                                     * 01000020
*MODULE-NAME= IGE0104G                                           S21903 01400022
*                                                                S21903 01460022
*DESCRIPTIVE-NAME= START/STOP ERP (SECOND LOAD)                  S21903 01520022
*                                                                S21903 01580022
*COPYRIGHT= 'NONE'                                               S21903 01640022
*                                                                     * 01700022
*  STATUS: CHANGE LEVEL 8                                      @Z30AAEE 01800008
*                                                                     * 02000020
*FUNCTION -- TO ATTEMPT RETRY ON START STOP READ/WRITE CCW'S          * 02200020
*                                                                     * 02400020
*ENTRY POINTS -- FIRST EXECUTABLE INSTRUCTION.                        * 02600020
*                                                                     * 02800020
*INPUT --                                                             * 03000020
*   R1 - POINTER TO I/O SUPERVISOR BLOCK                         Y02027 03200006
*   R15 - ENTRY POINT ADDRESS                                         * 03400020
*                                                                     * 03600020
*OUTPUT -- R1 POINTS TO I/O SUPERVISOR BLOCK                     Y02027 03800006
*                                                                     * 04000020
*EXTERNAL ROUTINE -- IGG019QE (AOS/TCAM SIO APPENDAGE) -- TO CONVERT  * 04200006
*   VIRTUAL CCW ADDRESSES TO REAL BEFORE RETRY.                       * 04300006
*                                                                     * 04400020
*EXITS-NORMAL -- R1 POINTS TO I/O SUPERVISOR BLOCK               Y02027 04600006
*        SVC   15   'ERP IN CONTROL (IOSERR)' AND 'EXCEPTIONAL   Y02027 04660006
*                CONDITION(IOSEX)'. RETURN TO IOS TO RETRY THE   Y02027 04720006
*                   ERROR.                                       Y02027 04800006
*        SVC   3                                                      * 05000020
*                                                                     * 05200020
*        SVC   15   'NO ERROR FLAGS'. RETURN TO LINE END         Y02027 05400006
*                   APPENDAGE. ERROR CLEARED                     Y02027 05500006
*        SVC   3                                                      * 05600020
*                                                                     * 05800020
*   TO SCHEDULE NEXT LOAD OF ERP                                      * 06000020
*        LH    13,FIELD                 FIELD HAS DECIMAL VALUE  CLUP21 06200021
*                                         OF NEXT LOAD           CLUP21 06300021
*        L     14,CVTPTR                ADDRESS OF CVT           CLUP21 06400021
*        L     14,44(14)                BRANCH-AND-LINK ENTRY    S22025 06500022
*                                         TO XCTL ROUTINE        CLUP21 06600021
*        BR    14                       ENTER XCTL ROUTINE       CLUP21 06700021
*                                                                     * 07000020
*EXITS-ERROR -- R1 POINTS TO I/O SUPERVISOR BLOCK                Y02027 07200006
*        SVC   15   'EXCEPTIONAL CONDITION(IOSEX)'. RETURN TO    Y02027 07300006
*                   LINE END APPENDAGE. ERROR PERMANENT.         Y02027 07400006
*        SVC   3                                                      * 07600020
*                                                                     * 07800020
*TABLES/WORK AREAS --                                                 * 08000020
*   TAVTD                                                             * 08200020
*   TTRMD                                                             * 08400020
*   TCCWD                                                             * 08600020
*   TLCBD                                                             * 08800020
*   DCBD                                                              * 09000020
*   TSCBD                                                             * 09200020
*   IECDIOSB                                                     Y02027 09300006
*                                                                     * 09400020
*ATTRIBUTES -- SERIALLY REUSABLE, REFRESHABLE, SUPERVISOR KEY,   Y02027 09600006
*              SUPERVISOR MODE, ENABLED                          Y02027 09700006
*                                                                     * 09800020
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 10000020
*   PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER CLUP21 10200021
*   SET.                                                              * 10400020
*                                                                     * 10600020
*   R1 REMAINS TRANSPARENT TO ALL LOADS OF ERP.                       * 10800020
*                                                                     * 11000020
*   EXIT FROM ERP IS MADE WHENEVER THE RETRY COUNT IS EXHAUSTED, OR   * 11200020
*   A 'SHOULD-NOT-OCCUR' ERROR IS DETECTED. TEXT ERRORS NOT      CLUP21 11400021
*   RECOVERABLE BY ERP ARE POSTED TO LINE END APPENDAGE WITH ERROR    * 11600020
*   (VIA SVC 15).                                                     * 11800020
*                                                                     * 12000020
*********************************************************************** 12200020
         EJECT                                                          12400020
         USING *,R15                                                    12600020
         USING IEDQLCB,RLCB                                             12800020
         USING IEDQCCW,RCCW                                             13000020
         USING IEDQAVTD,RAVT                                            13200020
         USING IEDQSCB,RSCB                                             13400020
         USING IHADCB,RDCB                                              13600020
         USING IOSB,RIOSB                                        Y02027 13700006
         SPACE 1                                                        13800021
*        REGISTER USAGE                                          CLUP21 13900021
R0       EQU   0                                                        14000020
RIOSB    EQU   1                        ADDR OF I/O SUPVR BLOCK  Y02027 14200006
R2       EQU   2                        WORK REGISTER                   14400020
RUCB     EQU   3                        UCB REGISTER                    14600020
RLCB     EQU   4                        LCB REGISTER             CLUP21 14800021
RSCB     EQU   5                        SCB REGISTER             CLUP21 15000021
RCCW     EQU   6                        CCW REGISTER                    15200020
RWKA     EQU   7                        WORK REGISTER                   15400020
RTST     EQU   8                        ADDR OF REQUEST QUEUE    Y02027 15460006
*                                       ELEMENT                  Y02027 15520006
RWKC     EQU   8                        WORK REGISTER                   15600020
RWKB     EQU   9                        WORK REGISTER                   15800020
RDCB     EQU   10                       DCB REGISTER             CLUP21 16000021
RAVT     EQU   11                       AVT REGISTER             CLUP21 16200021
RLINK    EQU   13                       LINKAGE FOR SUBSEQUENT LOAD     16400020
RSAVE    EQU   13                       SAVE REGISTER FOR IOSB   Y02027 16500006
RXCTL    EQU   14                       XCTL REGISTER                   16600020
R15      EQU   15                       ADDRESSABILITY REGISTER         16800020
IGE0104G IEDHJN DATE                    MODULE ID AND DATE       S22025 16840022
         EJECT                                                          17000020
         L     RTST,IOSUSE              PICKUP ADDR OF RQE       Y02027 17100006
         L     RUCB,IOSUCB              ADDRESS OF UCB         @Z30AAEE 17200008
         L     RLCB,IOBOFFST(R0,RTST)   ADDRESS OF IOB                  17400020
         SH    RLCB,LCBBKUP             BACK UP TO LCB                  17600020
         MVI   LCBCSW+5,AVTEZERO        1ST BYTE OF RESIDUAL CNT CLUP21 17800021
*                                         UNPREDICATABLE-PROGRAM CK     18000020
         L     RDCB,LCBDCBPT            DCB BASE                        18200020
         MVC   LCBERCCW+7(1),D19(RUCB)  ADAPTER TYPE              M5576 18400020
         NI    LCBERCCW+7,XF0           CLEAR CONTROL UNIT TYPE   M5576 18450020
         L     RSCB,LCBSCBA-1           SCB BASE SET                    18800020
         TM    SCBQTYPE,SCBCONC         CONC                     S22026 18840022
         BZ    NOCONC                   BRANCH IF NO             S22026 18880022
         L     RSCB,LCBSCBDA-1          SET LINE SCB ADDR        S22026 18920022
NOCONC   EQU   *                                                 S22026 18960022
         L     RCCW,LCBCSW-1            FAILING CCW+8                   19000020
         SH    RCCW,H8                  ADJUST TO ENDING CCW            19200020
         SPACE                                                          19300021
         TM    CCWOPCDE,SEVEN           TIC (CHANNEL PROGRAM     X01004 19400005
*                                         CHECK)                 X01004 19500005
         BNZ   NOPC                     BRANCH IF NO.            X01004 19600005
         SPACE                                                          19700021
         SH    RCCW,H8                  BACK UP TO TEXT CCW      CLUP21 19800021
         MVI   LCBCSW+6,AVTEZERO        CLEAR RESIDUAL COUNT     CLUP21 19900021
         SPACE                                                          20000021
NOPC     EQU   *                                                        20200020
         L     RWKB,LCBSTART-1          ASSUME RESTART FROM FIRSTCLUP21 20400021
         L     RAVT,CVTPTR              PICK UP CVT ADDRESS      CLUP21 20600021
         L     RAVT,AVTCVTPT(,RAVT)     LOAD LIST                       20800020
         L     RAVT,0(,RAVT)            AVT BASE                        21000020
         CLI   LCBINCAM+1,AVTEZERO      TEST INDEX BYTE          A48248 21200022
         MVI   LCBINCAM+1,AVTEZERO      CLEAR INDEX BYTE         A48248 21600022
         BNE   TXTERR                   TEXT ERROR RETRY         A48248 22000022
         SPACE                                                          22500021
         SPACE                                                          23200020
         TM    LCBSENS0,EQUIPCHK        EQUIPMENT CHECK SET             23400020
         BO    SNO                      YES, TREAT AS PERMANENT         23600020
         SPACE                                                          23800020
         TM    LCBSENS0,LOSTDATA        LOST DATA SET                   24000020
         BZ    TRYIR                    NO TRY INTERVENTION REQ  S22025 24200022
         SPACE                                                          24400020
         TM    CCWOPCDE,CCWWRITE        WRITE COMMAND                   24600020
         BO    SNO                      BRANCH YES                      24800020
         SPACE                                                          25000021
         CLI   LCBERCCW+7,TWX          TWX                      SA57694 25100022
         BNE   NOTTWX                   BRANCH NO                       25200020
         SPACE                                                          25400020
         CLI   LCBRESTR,TPTWXID         TWX ID                          25600020
         BNE   NOTTWX                   BRANCH IF NO             CLUP21 25800021
         SPACE                                                          25900021
REDIAL   EQU   *                                                        26000020
         LA    RWKB,LCBCPA+16           RE-DIAL                         26200020
         B     CHKCOUNT                 CHECK RETRY COUNT               26400020
         SPACE                                                          26500021
NOTTWX   EQU   *                                                        26600020
         CLI   LCBRESTR,TPRDRPEB        TEXT RESPONSE                   27000020
         BE    NORETRY                  BRANCH IF YES            CLUP21 27200021
         SPACE                                                          27300021
         CLI   LCBRESTR,TPRDSKIP        TEXT RELATED CCW                27400020
         BL    CHKCOUNT                 BRANCH NO                       27600020
         SPACE                                                          27800020
         OI    LCBCHAIN,LCBNORTY        NO RETRY POSSIBLE               28000020
         LH    RWKA,LCBCSW+5            PICK UP RESIDUAL COUNT   CLUP21 28200021
         SPACE 1                                                        28300021
         LTR   RWKA,RWKA                IS IT ZERO                      28400020
         BNZ   CHKRETRY                 NO, READ SKIP NOT NEEDED CLUP21 28600021
         SPACE                                                          28700021
SKIPEXIT EQU   *                                                        28800020
         MVI   LCBINCAM+1,RDSKIP        SET RETURN FOR IGE0504G  CLUP21 29000021
         ST    RLCB,LCBERCCW            SET ANY VALID ADDRESS    CLUP21 29200021
         MVI   LCBERCCW,CCWREAD         SET COMMAND CODE                29400020
         MVC   LCBERCCW+4(4),FLAGCNT    SET FLAGS AND COUNT             29600020
COMMON   EQU   *                                                SA57694 29650022
         SPACE                                                          29700021
         MVC   LCBSNSV,LCBSENS0         SAVE CURRENT SENSE              30000020
         MVC   LCBCSWSV,LCBCSW          SAVE CURRENT CSW                30200020
         LA    RWKB,LCBERCCW            START ADDRESS                   30400020
         B     NOSTOP                   BRANCH TO SET UP FOR RETRY.     30600006
         SPACE 2                                                        31600020
CHKRETRY EQU   *                                                        32000020
         OI    SCBERR4,SCBTXTTN         TEXT ERROR                      32200020
         SPACE                                                          32300021
         CLI   LCBINCAM,RETRY           RETRY LIMIT REACHED             32400020
         BE    PERMEXIT                 BRANCH IF YES            CLUP21 32600021
         SPACE                                                          32800020
         NI    IOSFLA,AVTEFF-IOSERR     INDICATE PERMANENT ERROR Y02027 33000006
         B     CONVERT                  POST TO LINEEND        @SA73344 33200009
         SPACE 2                                                        33800020
TRYRETRY EQU   *                                                        34000020
         CLI   LCBRESTR,TPTWXID         TWX ID                          34200020
         BE    REDIAL                   BRANCH YES               CLUP21 34400021
         SPACE                                                          34500021
         TM    LCBCPA+16,DIAL           DIAL INITIAL CONTACT     CLUP21 34600021
         BZ    CHKCOUNT                 BRANCH NO                       34800020
         SPACE                                                          35000020
         LA    RWKB,LCBCPA+32           SKIP TO WRITE COMMAND           35200020
         SPACE                                                          35300021
CHKCOUNT EQU   *                                                        35400020
         CLI   LCBINCAM,RETRY           RETRY LIMIT REACHED      CLUP21 35600021
         BNL   PERMEXIT                 BRANCH IF YES            CLUP21 35800021
         SPACE                                                          36000020
         IC    RWKA,LCBINCAM            GET RETRY COUNT          CLUP21 36200021
         LA    RWKA,1(,RWKA)            INCREMENT                CLUP21 36300021
         STC   RWKA,LCBINCAM            AND SAVE                 CLUP21 36400021
         SPACE                                                          36500021
NOSTOP   EQU   *                                                 Y02027 36700006
         ST    RWKB,LCBSTART-1          START ADDRESS                   37000020
         MVI   LCBSENS0,AVTEZERO        CLEAR FOR RETRY                 37200020
         B     CONVERT                  GO CONVERT CCW ADDRESSES TO     37400006
*                                       REAL FOR RETRY.                 37600006
         SPACE 2                                                        42140021
TRYIR    EQU   *                                                        42600020
         TM    LCBSENS0,INTREQ          INTERVETNION REQUIRED           42800020
         BZ    BOERR                    NO, MUST BE BUSOUT              43000020
         SPACE                                                          43200020
         CLI   LCBRESTR,TPRDSKIP        TEXT RELATED CCW                43400020
         BNL   CKTSO                    BRANCH IF TEXT RELATED          43600020
         SPACE                                                          43700021
         CLI   LCBRESTR,TPRDRPEB        RESPONSE TO TEXT                43800020
         BE    NORETRY                  BRANCH YES                      44000020
         SPACE 1                                                        44010022
         CLI   CCWOPCDE,CCWREAD         READ COMMAND            SA59015 44020022
         BNE   NORETRY                  BR NO, FORGET RETRY     SA59015 44030022
         SPACE                                                          44050021
         MVI   LCBCSWSV,AVTEFF          SET SENSE INDICATOR FOR  A44916 44100021
*                                         STOPLINE               A44916 44150021
         CLI   LCBERCCW+7,TWX          TWX                      SA57694 44160022
         BE    BREAK                   BREAK COMMAND            SA57694 44170022
         B     TRYRETRY                 ATTEMPT RETRY                   44200020
         SPACE                                                          44205021
CKTSO    EQU   *                                                 CLUP21 44210021
*        INTERVENTION REQUIRED ON WRITE TEXT IS NORMAL FOR TSO          44220020
         SPACE                                                          44225021
         TM    LCBTSOB,LCBTSBUF         TSO IN CONTROL                  44230020
         BZ    NORETRY                  BRANCH IF NO                    44240020
         SPACE                                                          44250020
         CLI   CCWOPCDE,CCWWRITE        WRITE COMMAND                   44260020
         BNE   NORETRY                  BRANCH IF NOT WRITE TEXT        44270020
         SPACE                                                          44275021
         CLI   LCBRESTR,TPTEXT          TEXT CCW                        44280020
         BNE   NORETRY                  BRANCH IF NOT TEXT TRANSFER     44290020
         NI    IOSFLA,AVTEFF-(IOSERR+IOSEX)  SET NORMAL ENDING @SA73344 44293009
         NI    LCBCSW+3,AVTEFF-X'02'    RESET U.C. FLAG        @YA10251 44296009
*********************************************************************** 44300006
*                                                                     * 44300906
*        THE FOLLOWING CODE IS ADDED FOR AOS.                         * 44301806
*                                                                     * 44302706
CONVERT  EQU   *                                                        44303606
**************************************************************** Y02027 44304506
*        THE FOLLOWING CODE MAPS THE NECESSARY FIELDS FROM THE   Y02027 44305406
*        LINE CONTROL BLOCK TO THE I/O SUPERVISOR BLOCK FOR EXCP Y02027 44306306
*        COMPATABILITY DURING RETRY OPERATIONS FROM ERP          Y02027 44307206
**************************************************************** Y02027 44308106
         MVC   IOSCSW(SEVEN),LCBCSW     MAP CSW FROM LCB TO IOSB Y02027 44309006
         MVC   IOSSNS(TWO),LCBSENS0     MAP SENSE INFO FROM LCB  Y02027 44309906
*                                       INTO IOSB                Y02027 44310806
         MVC   IOSCC(ONE),LCBSIOCC      MAP START I/O CONDITION  Y02027 44311706
*                                       CODE FROM LCB TO IOSB    Y02027 44312606
         CLI   LCBECBCC,HIOCC           IOHALT ISSUED            Y02027 44313506
         BNE   SVCS                     BRANCH NO                Y02027 44314406
         MVI   LCBINCAM+1,HIOCC         SET FOR LINEEND          Y02027 44315306
         NI    IOSFLA,X'FF'-(IOSERR+IOSEX) PREVENT RETRY         Y02027 44316206
SVCS     EQU   *                                                 Y02027 44317106
         TM    IOSFLA,IOSERR+IOSEX      ARE WE DOING A RETRY     Y02027 44318006
         BNO   NOTRETRY                 BRANCH IF NO.            X01004 44318906
         L     RTST,IOSUSE              PICKUP ADDR OF RQE       Y02027 44319806
         LR    RSAVE,RIOSB              SAVE IOSB ADDRESS        Y02027 44320706
         L     R2,IOBOFFST(,RTST)       GET IOB ADDRESS FROM RQE X01004 44321606
*                                       FOR USE BY SIO APPENDAGE.       44322506
         L     RWKC,DEBPTR(,RTST)       GET DEB ADDRESS FROM RQE X01004 44323406
         LA    R15,DEBNMSUB-IEDQDEB     GET APDG. TABLE SIZE     Y02027 44324306
         SLR   RWKC,R15                 POINT TO APDG. TABLE     Y02027 44325206
         L     RWKC,SIOPTR(ZERO,RWKC)   GET ADDR OF SIO APPEND-  X01004 44326106
*                                       AGE FROM APPENDAGE VECTOR       44327006
*                                       TABLE.                          44327906
         SR    R15,R15                  CLEAR R15 TO TELL SIO AP-       44328806
*                                       PENDAGE IT'S A SUBROUTINE.      44329706
         BAL   RXCTL,SIOENTRY(ZERO,RWKC)  LINK TO SIO APPNDG AT  X01004 44330606
*                                       OFFSET +16 TO CONVERT CCW'S     44331506
*                                       FROM VIRTUAL TO REAL.           44332406
         LR    RIOSB,RSAVE              RESTORE IOSB ADDR        Y02027 44333306
*                                                                     * 44334206
*        END OF CODE ADDED FOR AOS.                                   * 44335106
*                                                                     * 44336006
*********************************************************************** 44336906
NOTRETRY EQU   *                                                 X01004 44337806
         SVC   EREXCP                                            S22025 44340022
         SVC   RETURN                                            S22025 44370022
         SPACE                                                          44400021
BOERR    EQU   *                                                        44600020
         OI    SCBERR4,SCBCHANN         SET CHANNEL ERROR               44800020
         LR    RWKB,RCCW                RESTART ON FAILING              45000020
         SPACE                                                          45100021
         TM    LCBSIOCC,SIOCC1          SIO COND CODE=1                 45200020
         BO    CHKCOUNT                 BRANCH YES TO RETRY      CLUP21 45400021
         SPACE                                                          45500021
         TM    CCWOPCDE,CCWREAD         READ COMMAND                    45600020
         BO    SNO                      BRANCH YES               CLUP21 45800021
         SPACE                                                          45900021
         CLI   LCBERCCW+7,WTTA          WTTA                     CLUP21 46000021
         BE    CHKRETRY                 BRANCH YES TO RETRY      CLUP21 46100021
         SPACE                                                          46200021
         TM    CCWOPCDE+8,CCWREAD       NEXT CCW A READ                 46600020
         BO    SKIPEXIT                 BRANCH YES               CLUP21 46800021
         SPACE                                                          47000020
         CLI   LCBRESTR,TPRDRPEB        RESPONSE TO TEXT                47200020
         BE    NORETRY                  BRANCH IF YES                   47400020
         SPACE                                                          47500021
         CLI   LCBRESTR,TPRDSKIP        TEXT RELATED CCW                47600020
         BNL   NORETRY                  BRANCH IF YES                   47800020
         SPACE                                                          47900021
         MVC   LCBERCCW+7(1),D19(RUCB)  ADAPTER TYPE              M5576 48000020
         NI    LCBERCCW+7,XF0           CLEAR CONTR UNIT BITS     M5576 48050020
         SPACE                                                          48070021
         CLI   LCBERCCW+7,X20           TYPE ONE OR TWO           M5576 48100020
         BNH   SKIPEXIT                 BRANCH EITHER                   48600020
         SPACE                                                          48800020
         CLI   LCBERCCW+7,X80           TYPE THREE ADAPTER        M5576 49000020
         BE    SKIPEXIT                 BRANCH YES               CLUP21 49200021
         SPACE                                                          49300021
         B     CHKRETRY                 ELSE RETRY               CLUP21 49400021
         SPACE                                                          49500021
         SPACE                                                          56600021
SNO      EQU   *                                                        56800020
         OI    SCBERR4,SCBCTLUN         CONTROL UNIT ERROR              57000020
         MVI   LCBINCAM+1,POSNO         SET RETURN                      57400020
         B     LOADSDR                  USE COMMON CODE                 57600020
         SPACE                                                          57800020
PERMEXIT EQU   *                                                        58000020
         MVI   LCBINCAM+1,POPERM        SET RETURN TO IGE0504G   CLUP21 58200021
         SPACE                                                          58300021
LOADSDR  EQU   *                                                        58400020
         LH    RLINK,POSTMOD            POST MODULE                     58600020
         L     RXCTL,CVTPTR             CVT ADDRESS                     58800020
         L     RXCTL,XCTLADD(,RXCTL)    XCTL ROUTINE ADDRESS            59000020
         BR    RXCTL                    EXIT                            59200020
         SPACE                                                          59400021
TXTERR   EQU   *                                                        59600020
         CLI   LCBINCAM,RETRY           RETRY LIMIT REACHED      CLUP21 59860021
         BNL   PERMEXIT                 BRANCH IF YES                   59920020
         SPACE                                                          59960021
         TM    LCBSTAT1,LCBRECVN        RECEVING                        60000020
         BZ    CHKRETRY                 BRANCH NO                CLUP21 60200021
         SPACE                                                          60300021
         TM    LCBCSW+3,UNEX            UNIT EXCEPTION                  60400020
         BNZ   NORETRY                  YES, RETRY NOT POSSIBLE         60600020
         SPACE                                                          60604020
         CLI   LCBERCCW+7,TYPE3         2260 REMOTE, TYPE 3 ADPTR M5576 60608020
         BE    GORETRY                  BRANCH IF YES                   60612020
         SPACE                                                          60616020
         CLI   LCBERCCW+7,TYPE1         TYPE ONE ADAPTER          M5576 60620020
         BNE   NORETRY                  BRANCH IF NO                    60640020
         SPACE                                                          60660020
         TM    LCBTSOB,LCBTSBUF         IF TSO USE, ALLOW NO RETRY      60680020
         BO    NORETRY                  BRANCH IF YES                   60700020
         SPACE                                                          60720020
         CLI   UCBTYP(RUCB),T1060       IS IT A 1060                    60740020
         BE    NORETRY                  BRANCH IF YES                   60760020
         SPACE                                                          60780020
GORETRY  EQU   *                                                        60790020
         CLI   LCBRESTR,TPRDSKIP        TEXT RELATED ERROR              60800020
         BE    NORETRY                  YES, NO RETRY FOR READ SKIP     61000020
         SPACE                                                          61100021
         USING IEDQPRF,RWKA                                             61200020
         LA    RCCW,0(,RCCW)            THIS THE INTERRUPT              61400020
         L     RWKB,LCBCPA+12           POSSIBLE RESTART TEXT CCW       61600020
         L     RWKA,LCBLSPCI-1          BUFFER ADDRESS                  62000020
         SPACE                                                          62001021
         TM    PRFSTAT1,PRFNHDRN        IS IT HEADER                    62003020
         BO    NOTFIRST                 BRANCH IF NO                    62006020
         SPACE                                                          62009020
         CLM   RWKB,SEVEN,LCBLSPCI      DID WE START ON 1ST UNIT X01004 62012006
         BNE   NOTFIRST                 NO, WE ALREADY RCV'D A BLK      62015020
         SPACE                                                          62018020
*        I/O GENERATOR TURNS OFF SLI BIT ON CONTINUES OPERATIONS        62021020
         SPACE                                                          62022021
         TM    PRFFLAGS,CCWSLI          RECEIVE A BLOCK IN HEADER       62024020
         BO    BLDBUFF                  BRANCH IF WE ARE ON 1ST BLK     62027020
         SPACE                                                          62030020
NOTFIRST EQU   *                                                        62042020
         LA    RWKB,AVTEZERO(,RWKB)     CLEAR HI ORDER BYTE             62042220
         SPACE                                                          62042321
LOOPBUFF EQU   *                                                        62042420
         LA    RWKA,AVTEZERO(,RWKA)     CLEAR HIGH ORDER BYTE    CLUP21 62042621
*                                                                       62042720
*              RWKB POINTS TO FIRST CCW IN CHAIN AFTER LAST EOB         62042820
*        RESTART. IT MIGHT HAVE BEEN FREED BY PCI. A TEST IS ALSO       62043021
*        MADE TO DETERMINE IF IT HAS BEEN FREED AND RE-ASSIGNED.        62043220
*                                                                       62043320
         CLR   RWKB,RWKA                LAST EOB RESTART THIS BUFFER    62043420
         BE    TESTWRAP                 BRANCH IF YES, SEE IF IT        62043620
*                                         HAS BEEN RE-ASSIGNED          62043820
         SPACE                                                          62044020
         CLR   RWKA,RCCW                END OF SEARCH (RESTART CCW      62044220
*                                         NO LONGER IN BUFFER CHAIN     62044420
         BE    CHKRETRY                 BRANCH IF YES, CHECK RETRIES    62044620
         SPACE                                                          62044820
         L     RWKA,PRFTIC              GET NEXT UNIT (BUFFER)          62045020
         B     LOOPBUFF                 TEST NEXT CCW IN CHAIN   CLUP21 62045221
         SPACE                                                          62045421
TESTWRAP EQU   *                                                        62045620
*              THE FOLLOWING TEST CHECKS IF RESTART CCW HAS BEEN CLUP21 62045821
*        RE-ASSIGNED.                                                   62046020
         SPACE                                                          62046121
         TM    CCWFLAGS-CCW(RWKB),CCWSLI I/O GENERATOR TURNS OFF SLI    62046220
*                                         ON A RESTART OR RECALL        62046420
         BO    CHKRETRY                 BRANCH IF BUFFER HAS BEEN       62046620
*                                       RE-USED. A RE-CALL IS NEEDED    62046820
         SPACE                                                          62047020
         B     WRNAK                    ATTEMPT RETRY                   62047220
         SPACE                                                          62047421
BLDBUFF  EQU   *                                                        62180020
         SPACE                                                          66800020
*              HEADER BUFFER MUST BE RECONSTRUCTED TO ACCOUNT    CLUP21 67000021
*        FOR POLLING, IDLES, AND LCIN.                           CLUP21 67100021
         SPACE                                                          67200021
         SR    RWKC,RWKC                CLEAR WORK REGISTER             67400020
         IC    RWKC,LCBISZE             IDLES                           67600020
         SPACE                                                          67605021
         CLI   LCBCPA+24,CCWPREP        CONTENTION                      67610020
         BE    NOBUMP                   BRANCH YES                      67620020
         SPACE                                                          67630020
         TM    LCBSTAT2,LCBDIAL         DIAL LINE                CLUP21 67640021
         BZ    NOTDIAL                  BRANCH NO                CLUP21 67650021
         SPACE                                                          67660020
         CLI   LCBCPA+40,CCWPREP        DIAL CONTENTION                 67670020
         BE    NOBUMP                   BRANCH YES                      67680020
         SPACE                                                          67690020
NOTDIAL  EQU   *                                                        67700020
         SR    RWKB,RWKB                CLEAR WORK REGISTER     SA61794 67701052
         IC    RWKB,LCBUCBX             RLN-1                   SA61794 67702052
         SLL   RWKB,X4                  MULTIPLY BY FOUR        SA61794 67703052
         L     RWKB,DCBINVLI(RWKB)      INVLIST ADDRESS         SA61794 67704052
         L     RTST,IOSUSE              GET RQE ADDRESS        @OY19517 67705086
         L     R2,DEBPTR(,RTST)         GET DEB ADDR FROM RQE  @OY19517 67705186
         LA    R0,DEBNMSUB-IEDQDEB      GET APDG TABLE SIZE    @OZ29398 67705286
         SLR   R2,R0                    POINT TO APDG TABLE    @OZ29398 67705386
         TM    AUTOFLG(RWKB),AUTOPL     AUTOPOLL SPECIFIED     @OZ29398 67705486
         BO    OWNMH                    BRANCH YES             @OZ31467 67706086
         L     RTST,IOSUSE              GET RQE ADDRESS        @OZ09950 67706591
         LH    RWKB,LCBTTCIN            GET CONNECTED INDEX      S22029 67710022
         LTR   RWKB,RWKB                IS IT ZERO               S22029 67711022
         BZ    OWNMH                    BRANCH IF INDEX IS ZERO  S22029 67713022
         LR    R0,RWKA                  SAVE BUFFER ADDRESS      S22029 67714022
         L     RWKA,AVTRNMPT            GET TNT CODE BASE        S22029 67715022
         LH    RWKB,LCBTTCIN            GET CONNECTED INDEX      S22029 67716022
         BAL   RCCW,TNTDCODE-IEDQTNTD(RWKA) GET TERM TABLE ENTRY S22029 67717022
         L     RWKC,AVTEZERO(RWKC)      GET DEST QCB ADDRESS     S22029 67718022
         LR    RWKA,R0                  RESTORE BUFFER ADDRESS   S22029 67720022
         TM    QCBDSFLG-IEDQQCB(RWKC),QCBALTMH IS TERMINAL       S22029 67721022
*                                       CONNECTED TO ALTMH       S22029 67722022
         BZ    OWNMH                    NO - USE OWNING MH LC    S22029 67723022
         LA    R2,ONE(,R2)              SET TO ALTERNATE MH      X02004 67724005
*                                         OPTION BITS                   67724505
OWNMH    SR    RWKC,RWKC                CLEAR WORK REGISTER      S22029 67725022
         IC    RWKC,LCBISZE             GET IDLES COUNT          S22029 67726022
         CLI   LCBERCCW+7,TYPE3         ISIT 2260              @SA74549 67726209
         BNE   NOT2260                  BRANCH NO              @SA74549 67726409
         BCTR  RWKC,0                   DECREMENT ISIZE        @SA74549 67726609
NOT2260  EQU   *                                               @SA74549 67726809
         TM    0(R2),LCIN               LCIN SPECIFIED           X02004 67727005
         BZ    NOBUMP                   BRANCH NO, IT'S LC=OUT   S22029 67728022
         SPACE                                                          67740020
         LA    RWKC,1(,RWKC)            BUMP IDLES, DON'T        CLUP21 67750021
*                                         OVERLAY THE EOA        CLUP21 67753021
         SPACE                                                          67756021
NOBUMP   EQU   *                                                        67760020
         LA    RWKC,PRFSHDR-PRFSUNIT(,RWKC)                             68800020
         SPACE                                                          68900021
         LH    RWKB,AVTKEYLE            GET UNIT SIZE                   69200020
         CH    RWKB,DCBBUFSI            COMPARE WITH BUFFER SIZEE       69400020
         BNH   SETSIZE                  BRANCH LESS OR EQUAL            69600020
         SPACE                                                          69700021
         LH    RWKB,DCBBUFSI            GET BUFFER SIZE                 69800020
         SPACE                                                          69900021
SETSIZE  EQU   *                                                        70000020
         SR    RWKB,RWKC                SET COUNT                       70200020
         STH   RWKB,PRFCOUNT            AND SAVE                 CLUP21 70400021
         LA    RWKC,PRFSUNIT-IEDQPRF(RWKC,RWKA)                         70600020
         STCM  RWKC,SEVEN,PRFIOADR      SET ADDRESS.             X01004 70800006
         LR    RWKB,RWKA                GET BUFFER ADDRESS              71400020
         SPACE                                                          71500021
WRNAK    EQU   *                                                        71600020
         SR    RWKC,RWKC                CLEAR WORK REGISTER             71800020
         L     R2,DCBSCTAD-1            SCT ADDRESS                     72000020
         IC    RWKC,NAKCH(,R2)          GET NAK ADDR OFFSET      A47148 72600021
         SPACE                                                          73200020
         LA    RWKC,1(RWKC,R2)          GET NAK ADDRESS                 73400020
         ST    RWKC,LCBCPA+16           SET WRITE NAK ADDDRESS          73600020
         MVI   LCBCPA+16,CCWWRITE       SET WRITE COMMAND               73800020
         MVI   LCBCPA+20,CCWCC+CCWSLI   SET FLAGS                CLUP21 74000021
         MVI   LCBCPA+23,X01            SET COUNT                CLUP21 74200021
         ST    RWKB,LCBCPA+24           SET TIC ADDRESS                 74400020
         MVI   LCBCPA+24,CCWTIC         SET TIC COMMAND                 74600020
         LA    RWKB,LCBCPA+16           RESTART ADDRESS                 74800020
         MVI   LCBTPCD+2,TPWRAKNK       SET TP OP CODE                  75000020
         B     CHKCOUNT                 CHECK RETRY COUNT               75200020
         SPACE                                                          75300021
NORETRY  EQU   *                                                        75400020
         OI    LCBCHAIN,LCBNORTY        SET NO RETRY POSSIBLE           75800020
         B     PERMEXIT                 PERM ERROR                      76000020
BREAK    EQU   *                                                SA57694 76010022
         ST    RLCB,LCBERCCW           VALID ADDRESS FOR BREAK  SA57694 76020022
         MVI   LCBERCCW,CCWBREAK       COMMAND CODE             SA57694 76030022
         MVC   LCBERCCW+4(4),BRKFLGCT  SET FLAGS & COUNT        SA57694 76040022
         MVI   LCBINCAM+1,BRKRET       SET RETURN INDEX         SA57694 76050022
         B     COMMON                  BRANCH TO COMMON IO      SA57694 76060022
BRKFLGCT DC    AL1(CCWSLI),AL2(0),XL1'30'  COUNT=48             SA57694 76070022
         EJECT                                                          76100020
         SPACE                                                          77400020
FLAGCNT  DC    AL1(CCWSKIP),XL1'0',X'FFFF' FLAG/CT FOR READ/SKIP S22025 77800022
LCBBKUP  DC    AL2(LCBFLAG1-IEDQLCB)    OFFSET FROM LCB TO IOB   S22025 78100022
H8       DC    H'8'                     SIZE OF CCW              S22025 78400022
POSTMOD  DC    AL2(5047)                ERROR POST 504G          S22025 78700022
X01      EQU   X'01'                    FLAG TO CALL OBR MODULE         79000020
FOUR     EQU   4                        DECIMAL FOUR             S22029 79100022
LOSTDATA EQU   X'02'                    LOST DATA MASK                  79200020
INTREQ   EQU   X'40'                    INTERVENTION REQUIRED           79600020
RETRY    EQU   X'02'                    RETRY LIMIT                     80200020
CVTPTR   EQU   X'10'                    CVT LOCATION POINTER            80400020
D19      EQU   19                                                       80800020
X80      EQU   X'80'                    MASK TYPE 3 ADAPTER             81000020
X20      EQU   X'20'                    MASK TYPE 2 ADAPTER             81200020
XF0      EQU   X'F0'                    USED TO MASK OFF CONTROL        81400020
*                                         UNIT YTPE                     81600020
BRKRET   EQU   8                                                SA57694 81900022
RDSKIP   EQU   4                        SKIP RETURN TO 504G             82200020
UNEX     EQU   X'01'                    UNIT E CEPTION MASK             82400020
XCTLADD  EQU   X'2C'                    OFFSET IN CVT-XCTL ROUTINE      82600020
EREXCP   EQU   15                       ERROR EXCP                      83000020
LCIN     EQU   X'80'                    MASK FOR LCBIN ON MH QCB        83300020
RETURN   EQU   3                        ETURN SVC FOR TRANSIENT S       83400020
EQUIPCHK EQU   X'10'                    MASK FOR EQUIPMENT CHECK        83600020
IOBOFFST EQU   4                        IOB OFFSET IN RQE               84000020
POPERM   EQU   20                       RETURN INDICATOR FOR 504G       85000020
POSNO    EQU   16                       RETURN INDICATOR FOR 504G       85200020
SIOCC1   EQU   X'10'                    SIO CONDITON CODE 1             85300020
TYPE1    EQU   X'10'                    TYPE 1 ADAPTER MASK INUCB       85320020
TYPE3    EQU   X'80'                    MASK FOR TYPE 3 ADAPTER         85330020
UCBTYP   EQU   X'10'                    UCB TYPE OFFSET IN UCB          85340020
T1060    EQU   X'52'                    UCB TYPE MASK FRO 1060          85360020
ZERO     EQU   0                        LENGTH EQUATE FOR ADDR   X01004 85361005
ONE      EQU   1                        INCREMENT VALUE FOR MH   X02004 85362005
TWO      EQU   2                                                 Y02027 85362306
HIOCC    EQU   X'48'                    HALT I/O COMPLETION CODE Y02027 85362606
NAKCH    EQU   6                        INDEX TO SEQUENCE IN SCT CLUP21 85363021
DIAL     EQU   X'20'                    TO TEST FOR DIAL LCB     CLUP21 85366021
TWX      EQU   X'50'                    TO TEST FOR TWX DEVICE   CLUP21 85372021
WTTA     EQU   X'60'                    TO TEST FOR WTTA DEVICE  CLUP21 85378021
PERMERR  EQU   X'DF'                    TO SET PERMANENT ERROR   CLUP21 85390021
DEBPTR   EQU   8                        OFFSET OF DEB ADDR IN RQEX01004 85390105
SIOPTR   EQU   4                        OFFSET OF SIO APDG. ADDR.X01004 85390505
*                                       IN APDG. VECTOR TABLE.   X01004 85390605
SIOENTRY EQU   34                       OFFSET OF SUBRTNE. ENTRY Y02027 85390706
*                                       POINT IN SIO APPENDAGE.  X01004 85390805
RETRYFLG EQU   X'24'                    RETRY FLAG IN LCBFLAG1.  X01004 85390905
SEVEN    EQU   7                                                 X01004 85391005
THREE    EQU   3                                                 X01004 85391105
FIVE     EQU   5                                                 X01004 85391205
X4       EQU   2                        MULTIPLE OF FOUR        SA61794 85392052
AUTOFLG  EQU   3                        OFFSST IN INVLIST       SA61794 85394052
AUTOPL   EQU   1                        FLAG FOR AUTO POLL      SA61794 85396052
         EJECT                                                          85397006
         TDEBD                          DEB DSECT                       85398006
         EJECT                                                          85400020
         DCBD  DSORG=TX                                                 85800020
         TPRFD                                                          86000020
         TLCBD                                                          86200020
         TCCWD                                                          86400020
         TAVTD                                                          86600020
         TSCBD                                                          86800020
         TTPD                                                           87000020
         TQCBD                                                   S22029 87060022
         IECDIOSB                                                Y02027 87090006
         TTNTD                                                   S22029 87120022
         END                                                            87200020
