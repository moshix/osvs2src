         TITLE 'IGE0204G TCAM CONTROL UNIT NOT OPERATIONAL && START/STOC00600010
               P UNIT EXCEPTION && TIME OUT ERP'                        01200010
IGE0204G CSECT                                                          02000010
*A-000000-999999                                               @Y02X6E0 02020010
*CHANGE ACTIVITY= AS FOLLOWS:                                           02050010
******************** MICROFICHE FLAGS *********************** SUPT CODE 02070010
*A744770-744820,755930-755960,756966-756984                      A48248 02100010
*A300000,431000-435000,490300-492700,580400-581600               S22025 02100110
*A740060-748940,755000-758700                                    S22025 02100210
*C010000,060000-110000,220000                                    S22025 02100310
*C742040,742340,743720,745880,755700,756500,757100-758100        S22025 02100410
*C757990                                                        SA55420 02100510
*C741020,741080,755800                                          SA55958 02100610
*A741080,741110,755850                                          SA55958 02100710
*C055000,060000                                                  S21903 02100810
*D491200,748160,755600                                           S21903 02100910
*A740660,744780,755850                                          SA59006 02101010
*C744780                                                        SA59006 02101110
*D740900-740960                                                 SA59006 02101210
*A212000,213000-213500,252000,307000,315000,434100,482000-484000,Y02027 02101310
*A567000,710300,775000                                           Y02027 02101410
*C150000,180000,212500,218000-220000,240000,246000,310000,450000,Y02027 02101510
*C710000,712000,712700-713000,717800,746096-746104,748520        Y02027 02101610
*C741460                                                        OY00469 02101710
*C070000,580000                                                @Z30AAEE 02101810
*D530000                                                       @Z30AAEE 02101910
*A744900                                                       @SA70884 02102010
*A580000,581600                                                @SA74263 02102110
*D740300                                                       @SA74263 02102210
*C744784                                                       @YA10219 02102310
*C746104                                                       @OZ07810 02102410
*C744784-744790                                                @OY12267 02102510
*C596000                                                       @OY14092 02102610
         SPACE 3                                                        03900210
*********************************************************************** 04000010
*                                                                     * 05000010
*MODULE-NAME= IGE0204G                                           S21903 05500010
*                                                                S21903 05700010
*DESCRIPTIVE-NAME= START/STOP ERP (THIRD LOAD)                   S21903 05900010
*                                                                S21903 06100010
*COPYRIGHT= 'NONE'                                               S21903 06300010
*                                                                     * 06500010
*  STATUS: CHANGE LEVEL 8                                      @Z30AAEE 07000010
*                                                                     * 07500010
* FUNCTION -- TO ISSUE WTO REFLECTING CONTROL UNIT STATUS.  FOR  S22025 08000010
*   UNIT EXCEPTIONS, TO ATTEMPT TO CLEAR ERROR SITUATION BY      S22025 08500010
*   ISSUING A BREAK COMMAND OR READ SKIP.  THE ACTION TAKEN IS   S22025 09000010
*   DEVICE DEPENDENT.  FOR TIME OUTS, ACTION IS ALSO DEVICE AND  S22025 09500010
*   OPERATION DEPENDENT.  THE FAILING CCW MAY BE RETRIED OR A    S22025 10000010
*   BREAK COMMAND MAY BE ISSUED.                                 S22025 10500010
*                                                                     * 11000010
*ENTRY POINTS -- FIRST EXECUTABLE INSTRUCTION.                        * 12000010
*                                                                     * 13000010
*INPUT --                                                             * 14000010
*   R1 - POINTER TO I/O SUPERVISOR BLOCK                         Y02027 15000010
*   R15 - ENTRY POINT ADDRESS                                         * 16000010
*                                                                     * 17000010
*OUTPUT -- R1 POINTS TO I/O SUPERVISOR BLOCK                     Y02027 18000010
*                                                                     * 19000010
*EXTERNAL ROUTINES - 'WTO' - FOR MESSAGE TO SYSTEM CONSOLE            * 20000010
*                  - IGG019QE (AOS/TCAM SIO APPENDAGE) - TO CONVERT   * 20300010
*   VIRTUAL CCW ADDRESSES TO REAL BEFORE RETRY.                       * 20600010
*                                                                     * 21000010
*EXITS-NORMAL -- R1 POINTS TO I/O SUPERVISOR BLOCK               Y02027 21200010
*        SVC   15   'ERP IN CONTROL (IOSERR)' AND 'EXCEPTIONAL   Y02027 21250010
*                CONDITION(IOSEX)'. RETURN TO IOS TO RETRY THE   Y02027 21300010
*                   ERROR.                                       Y02027 21350010
*                SVC  3                                          S22025 21400010
*                                                                     * 21600010
*        SVC   15   'NO ERROR FLAGS'. RETURN TO LINE END         Y02027 21800010
*                   APPENDAGE. ERROR CLEARED                     Y02027 21900010
*        SVC   3                                                 Y02027 22000010
*   TO SCHEDULE NEXT LOAD OF ERP                                 S22025 22200010
*        L     R13,DECIMAL VALUE OF NEXT LOAD                    S22025 22400010
*        L     R14,X'10'      CVT ADDRESS                        S22025 22600010
*        L     R14,X'2C'(14)  ADDRESS OF XCTL ROUTINE            S22025 22800010
*        BR    R14            EXIT TO XCTL                       S22025 23000010
*EXITS-ERROR -- R1 POINTS TO I/O SUPERVISOR BLOCK                Y02027 24000010
*        SVC   15   'EXCEPTIONAL CONDITION(IOSEX)'. RETURN TO    Y02027 24600010
*                   LINE END APPENDAGE. ERROR PERMANENT.         Y02027 25200010
*        SVC   3                                                      * 26000010
*                                                                     * 27000010
*TABLES/WORK AREAS --                                                 * 28000010
*   TAVTD                                                             * 29000010
*   TLCBD                                                             * 30000010
*   TCCWD                                                        S22025 30200010
*   TTRMD                                                        S22025 30400010
*   TSCBD                                                        S22025 30600010
*   IECDIOSB                                                     Y02027 30700010
*                                                                     * 30800010
*ATTRIBUTES -- SERIALLY REUSABLE, REFRESHABLE, SUPERVISOR KEY,   Y02027 31000010
*              SUPERVISOR MODE, ENABLED                          Y02027 31500010
*                                                                     * 32000010
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 33000010
*   PARTICUALR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER      * 34000010
*   SET.                                                              * 35000010
*                                                                     * 36000010
*   R1 REMAINS TRANSPARENT TO ALL LOADS OF ERP.                       * 37000010
*                                                                     * 38000010
*********************************************************************** 39000010
         EJECT                                                          40000010
         USING *,R15                                                    42000010
         USING IEDQLCB,RLCB                                             43000010
         USING IEDQAVTD,RAVT                                     S22025 43100010
         USING IEDQCCW,RCCW                                      S22025 43200010
         USING IEDQSCB,RSCB                                      S22025 43300010
         USING IHADCB,RDCB                                       S22025 43400010
         USING IOSB,RIOSB                                        Y02027 43410010
         SPACE 2                                                        43420010
*        EQUATES                                                        43440010
         SPACE 1                                                        43460010
         SPACE 2                                                        43500010
R0       EQU   0                        WORK REGISTER            Y02027 44000010
RIOSB    EQU   1                        ADDR OF I/O SUPVR BLOCK  Y02027 45000010
RIOB     EQU   2                        IOB REGISTER - REQUIRED BY      45300010
*                                       SIO APPENDAGE.                  45600010
RUCB     EQU   3                        UCB REGISTER                    46000010
RLCB     EQU   4                        LCB REG.                        47000010
RWKA     EQU   7                        WORK REGISTER                   48000010
RTST     EQU   7                        ADDR OF REQUEST QUEUE    Y02027 48200010
*                                       ELEMENT                  Y02027 48400010
RSIO     EQU   8                        SIO APPENDAGE ADDRESS.          48600010
RWKB     EQU   9                        WORK REGISTER                   49000010
RSAVE    EQU   13                       REGISTER FOR SAVING RQE         49010010
*                                       ADDRESS.                        49020010
RAVT     EQU   2                        AVT BASE REGISTER        S22025 49030010
REG5     EQU   5                        WORK REGISTER            S22025 49060010
RCCW     EQU   6                        POINTER TO FAILING CCW   S22025 49090010
REG8     EQU   8                        WORK REGISTER            S22025 49150010
RSCB     EQU   10                       SCB BASE REGISTER        S22025 49180010
RDCB     EQU   11                       DCB BASE REGISTER        S22025 49210010
RLINK    EQU   13                       WORK REGISTER            S22025 49240010
RXCTL    EQU   14                       REGISTER FOR XCTL ADD    S22025 49270010
         SPACE 7                                                        49300010
R15      EQU   15                       ADDRESSABILITY REGISTER         50000010
EREXCP   EQU   15                       ERROR EXCP                      51000010
RETURN   EQU   3                        ETURN SVC FOR TRANSIENT S       52000010
IOBOFFST EQU   4                        IOB OFFSET IN RQE               54000010
X20      EQU   X'20'                    ERP IN CONTROL                  55000010
EIGHT    EQU   8                   CONSTANT FOR CSW                     55500010
IGE0204G IEDHJN BEGIN                   MODULE ID AND DATE       S22025 56000010
         EJECT                                                          56500010
         L     RTST,IOSUSE              PICKUP ADDR OF RQE       Y02027 56700010
         L     RLCB,IOBOFFST(R0,RTST)   ADDRESS OF IOB                  57000010
         SH    RLCB,LCBBKUP             SET LCB BASE                    57500010
         L     RUCB,IOSUCB              ADDRESS OF UCB         @Z30AAEE 58000010
         L     RSCB,LCBSCBA-1           SET SCB BASE           @SA74263 58020010
         TM    LCBSIOCC,CC3             IS CONTROL UNIT UP       S22025 58040010
         BNO   UNEXUNCK                 BRANCH IF CONT UNIT IS   S22025 58080010
*                                       UP - MUST BE UNIT CHK OR S22025 58120010
*                                       UNIT EXCEPTION           S22025 58160010
         OI    SCBERR4,SCBCTLUN         SET CONTROL UNIT ERROR @SA74263 58180010
         OI    LCBCHAIN,LCBNORTY        SET NO RTRY POSSIBLE            58200010
         L     RWKA,LCBSTART-1          START ADDRESS                   58400010
         LA    RWKA,EIGHT(,RWKA)        BUMP BY 8                       58600010
         ST    RWKA,LCBCSW-1            SET FOR LINEEND                 58800010
         NI    LCBSIOCC,AVTEFF-CC3      TURN OFF CONTROL UNIT    Y02027 58860010
*                                         BUSY FOR LINEEND       Y02027 58920010
         CLI   LCBTPCD,TPOPEN           OPEN OR START LINE              59000010
         BNE   NOTOPEN                  BRANCH IF NO                    59200010
         SPACE                                                          59400010
         NI    LCBSTAT1,LCBOCNI+LCBOCWTN RESET ALL BUT OPCTL   @OY14092 59600010
*                                         FORCE  STOPLINE               59800010
NOTOPEN  EQU   *                                                        60000010
         MVC   WTO+22(3),13(RUCB)       LINE ID FROM UCB                64000010
         LR    RWKA,RIOSB               SAVE IOSB                Y02027 65000010
         LR    RWKB,R15                 SAVE BASE                       66000010
WTO      WTO   'IED064I  LINE     CONTROL UNIT NOT OPERATIONAL',       X67000010
               ROUTCDE=(8),DESC=4                                       68000010
         LR    RIOSB,RWKA        N      RESTORE IOSB             Y02027 69000010
         LR    R15,RWKB                 RESTORE BASE                    70000010
         NI    IOSFLA,AVTEFF-IOSERR     POST PERMANENT ERROR     Y02027 71000010
*                                       TO ABNORMAL END APPENDAG Y02027 71030010
*********************************************************************** 71060010
*                                                                     * 71090010
*        THE FOLLOWING CODE HAS BEEN ADDED FOR AOS.                   * 71120010
*                                                                     * 71150010
SVCS     EQU   *                                                        71180010
         CLI   LCBECBCC,HIOCC           IOHALT ISSUED            Y02027 71181010
         BNE   HIOSUB                   BRANCH NO                Y02027 71182010
         SPACE 1                                                 Y02027 71183010
         NI    IOSFLA,X'FF'-(IOSERR+IOSEX) RESET ERP IN CTL      Y02027 71184010
         MVI   LCBINCAM+1,HIOCC         SET FOR LINEEND          Y02027 71185010
HIOSUB   EQU   *                                                 Y02027 71186010
**************************************************************** Y02027 71187010
*        THE FOLLOWING CODE MAPS THE NECESSARY FIELDS FROM THE   Y02027 71188010
*        LINE CONTROL BLOCK TO THE I/O SUPERVISOR BLOCK FOR EXCP Y02027 71189010
*        COMPATABILITY DURING RETRY OPERATIONS FROM ERP          Y02027 71190010
**************************************************************** Y02027 71191010
         MVC   IOSCSW(SEVEN),LCBCSW     MAP CSW FROM LCB TO IOSB Y02027 71192010
         MVC   IOSSNS(TWO),LCBSENS0     MAP SENSE INFO FROM LCB  Y02027 71193010
*                                       INTO IOSB                Y02027 71194010
         MVC   IOSCC(ONE),LCBSIOCC      MAP START I/O CONDITION  Y02027 71195010
*                                       CODE FROM LCB TO IOSB    Y02027 71196010
         TM    IOSFLA,IOSERR+IOSEX      ARE WE DOING A RETRY     Y02027 71210010
         BNO   NOTRETRY                 BRANCH IF NO.            X01004 71240010
         LR    RSAVE,RIOSB              SAVE IOSB ADDRESS        Y02027 71270010
         L     RTST,IOSUSE              PICKUP ADDR OF RQE       Y02027 71300010
         SR    RIOB,RIOB                CLEAR FOR ICM.                  71330010
         ICM   RIOB,7,IOBPTR(RTST)      GET IOB ADDRESS FROM RQE.       71360010
*                                       FOR USE BY SIO APPENDAGE.       71390010
         SR    RSIO,RSIO                CLEAR FOR ICM.                  71420010
         ICM   RSIO,7,DEBPTR(RTST)      GET DEB ADDRESS FROM RQE.       71450010
         LA    R15,DEBNMSUB-IEDQDEB     GET APDG. TABLE SIZE     Y02027 71480010
         SLR   RSIO,R15                 POINT TO APDG. TABLE     Y02027 71510010
         L     RSIO,SIOPTR(ZERO,RSIO)   GET ADDR. OF SIO APPEND- X01004 71540010
*                                       AGE FROM APPENDAGE VECTOR       71570010
*                                       TABLE.                          71600010
         SR    R15,R15                  CLEAR R15 TO TELL SIO AP-       71630010
*                                       PENDAGE IT'S A SUBROUTINE.      71660010
         BAL   RXCTL,SIOENTRY(ZERO,RSIO) LNK TO SIO APPENDAGE AT X01004 71690010
*                                       OFFSET +16 TO CONVERT CCW'S     71720010
*                                       FROM VIRTUAL TO REAL.           71750010
         LR    RIOSB,RSAVE              RESTORE IOSB ADDR        Y02027 71780010
*                                                                     * 71810010
*        END OF CODE ADDED FOR AOS.                                   * 71840010
*                                                                     * 71870010
*********************************************************************** 71900010
NOTRETRY EQU   *                                                 X01004 71930010
         SVC   EREXCP                   CONTROL TO NORMAL LINEEND       72000010
         SPACE                                                          73000010
         SVC   RETURN                   FREE TRANSIENT AREA             74000010
         SPACE 5                                                        74006010
UNEXUNCK EQU   *                                                        74012010
         L     RWKB,LCBSTART-1          ASSUME RESTART FROM      S22025 74018010
*                                       FAILING CCW              S22025 74024010
         L     RCCW,LCBCSW-1            GET FAILING CCW+8        S22025 74036010
         SH    RCCW,H8                  ADJUST TO FAILING CCW    S22025 74042010
         L     RAVT,CVTPTR              GET CVT ADDRESS          S22025 74048010
         L     RAVT,AVTCVTPT(,RAVT)     GET LOAD LIST            S22025 74054010
         L     RAVT,0(,RAVT)            SET UP AVT BASE          S22025 74060010
         SPACE 2                                                        74066010
         MVC   LCBERCCW+7(1),D19(RUCB)  MOVE ADAPTER TYPE        S22025 74068010
         NI    LCBERCCW+7,X'F0'         CLEAR CONT UNIT TYPE     S22025 74070010
         TM    LCBCSW+3,UNITCHK         IS IT TIMEOUT ?                 74072010
         BO    TIMEOUT                  BRANCH = YES, ELSE FALL  S22025 74078010
*                                       THROUGH FOR UNIT EXCPTN  S22025 74084010
         CLI   LCBERCCW+7,TTYTYPE1     TTY TYPE 1 ADAPTER       SA55958 74102010
         BE    BREAK                   BRANCH = YES             SA55958 74105010
         CLI   LCBERCCW+7,TTYTYPE2     TTY TYPE 2 ADAPTER       SA55958 74108010
         BE    BREAK                   BRANCH = YES             SA55958 74111010
         MVC   LCBERCCW+7(1),D19(RUCB)  MOVE ADAPTER TYPE        S22025 74114010
         NI    LCBERCCW+7,X0F           CLEAR ADAPTER TYPE       S22025 74120010
         CLI   LCBERCCW+7,X02           2701 CONTROL UNIT ?      S22025 74126010
         BE    SKIPEXIT                 IF YES, BRANCH TO READ   S22025 74132010
*                                       SKIP                     S22025 74138010
         SPACE 2                                                        74144010
         TM    LCBTSOB,LCBTSBUF         TSO SESSION ?            S22025 74145010
         BO    CHKCOUNT                 YES - CHECK RETRY COUNT  Y00469 74146010
         TM    LCBTSOB,LCB2741N         IS THIS A 2741 TERMINAL  S22025 74147010
         BNO   GORETRY                  BRANCH IF NO             S22025 74148010
         TM    LCBSTAT1,LCBSENDN        WAS LINE SENDING  ?      S22025 74149010
         BNO   BREAK                    BRANCH IF NO             S22025 74150010
         ST    RLCB,LCBERCCW+8          GET ANY VALID ADDRESS    S22025 74151010
         MVI   LCBERCCW+8,CCWBREAK      SET BREAK COMMAND CODE   S22025 74152010
         MVC   LCBERCCW+12(12),UNXFLCNT SET FLAGS AND COUNT FOR  S22025 74153010
*                                       BREAK AND WRITE CIRC D   S22025 74154010
         LA    REG5,LCBERCCW            GET DATA ADD FOR CIRC D  S22025 74155010
         ST    REG5,LCBERCCW+16         MOVE ADDRESS INTO CCW           74156010
         MVI   LCBERCCW+16,CCWWRITE     SET WRITE COMMAND CODE   S22025 74157010
         MVC   LCBERCCW(2),EOASHFT      SET UP EOA AND SHIFT     S22025 74158010
         LA    REG5,LCBERCCW+8          SET UP ADDRESS FOR EXCP  S22025 74159010
         MVI   LCBINCAM+1,BRKRET        RETURN INDEX FOR 504G    S22025 74160010
         B     BREAK3                   GO EXCP                  S22025 74161010
         SPACE 2                                                        74162010
GORETRY  EQU   *                                                 S22025 74168010
         CLI   LCBINCAM,RETRY           RETRY LIMIT REACHED ?    S22025 74174010
         BNE   TRYRETRY                 BRANCH = NO              S22025 74180010
         OI    SCBERR3,SCBXCEPN         TURN ON UNIT EXCPTN BIT  S22025 74186010
         TM    LCBTSOB,LCBTSBUF         IS THIS  TSO ?           S22025 74192010
         BZ    SKIPEXIT                 BRANCH = NO              S22025 74198010
         B     PERMEXIT                 DON'T SET NORETRY FLAG          74204010
         SPACE 2                                                        74210010
NORETRY  EQU   *                                                 S22025 74216010
         OI    LCBCHAIN,LCBNORTY        SET ON NORETRY FLAG      S22025 74222010
PERMEXIT EQU   *                                                 S22025 74228010
         MVI   LCBINCAM+1,PERMRET       SET INDICATOR FOR 504G   S22025 74234010
LOADSDR  EQU   *                                                 S22025 74240010
         LH    RLINK,POSTMOD            POST MODULE              S22025 74246010
         L     RXCTL,CVTPTR             GET CVT POINTER          S22025 74252010
         L     RXCTL,XCTLADD(,RXCTL)    GET XCTL ROUTINE ADDRESS S22025 74258010
         BR    RXCTL                    EXIT TO 504G             S22025 74264010
         SPACE 2                                                        74270010
SKIPEXIT EQU   *                                                        74276010
         MVI   LCBINCAM+1,RDSKIP        SET INDEX CODE FOR 504G  S22025 74282010
         ST    RLCB,LCBERCCW            USE LCB ADDRESS          S22025 74288010
         MVI   LCBERCCW,CCWREAD         SET UP READ CCW          S22025 74294010
         MVC   LCBERCCW+4(4),FLAGCNT    SET UP FLAG AND COUNT    S22025 74300010
         B     COMMON                   ISSUE EXCP               S22025 74306010
         SPACE 2                                                        74312010
TIMEOUT  EQU   *                                                        74318010
         TM    CCWOPCDE,CCWWRITE        WRITE CCW ?              S22025 74324010
         BZ    TOREAD                   BRANCH IF NO             S22025 74330010
         MVC   LCBERCCW+7(1),D19(RUCB)  MOVE ADAPTER TYPE        S22025 74336010
         NI    LCBERCCW+7,X'F0'         CLEAR CONT UNIT TYPE     S22025 74342010
         CLI   LCBERCCW+7,X'80'         TYPE 3 ADAPTER (2260 R)  S22025 74348010
         BNE   SNO                      BRANCH = NO, SHOULD      S22025 74354010
*                                       NOT OCCUR                S22020 74360010
         MVC   LCBERCCW(16),BRK2848     SET 2848 BREAK SEQUENCE  S22025 74366010
         B     BREAK2                   GO EXCP                  S22025 74372010
         SPACE 2                                                        74378010
SNO      EQU   *                                                 S22025 74384010
         OI    SCBERR4,SCBCTLUN         SET CONTROL UNIT ERROR   S22025 74390010
         MVI   LCBINCAM+1,POSNO         SET RETURN CODE FOR 504G S22025 74396010
         B     LOADSDR                  EXIT TO 504G             S22025 74402010
         SPACE 2                                                        74408010
TOREAD   EQU   *                                                        74414010
         CLI   LCBRESTR,TPRDSKIP        TEXT RELATED CCW ?       S22025 74420010
         BNL   TRY2741                  YES, SEE IF TERM IS 2741 S22025 74426010
         CLI   LCBRESTR,TPRDRPEB        TEXT RESPONSE ?          S22025 74432010
         BE    NORETRY                  BRANCH IF YES            S22025 74438010
         CLI   LCBRESTR,TPRDRSPD        READ RESP TO ADDRESSING  S22025 74444010
         BE    CHKCOUNT                 BRANCH =YES, GO CHECK    S22025 74450010
*                                       RETRY AND REDIAL         S22025 74456010
         CLI   LCBRESTR,TPRDRESP        POLLING RESPONSE ?       S22025 74462010
         BNE   TRYRETRY                 BRANCH IF NO             S22025 74468010
         SPACE 1                                                        74474010
         TM    LCBTSOB,LCB2741N         2741 TERMINAL ?          S22025 74475010
         BO    CHK2741                  BRANCH IF YES            S22025 74476010
         CLI   LCBERCCW+7,TYPE1         TYPE 1 ADAPTER           A48248 74477010
         BE    NOTTWX                   BR YES, CANNOT BE TWX   SA59006 74478010
         CLI   LCBERCCW+7,TYPE5         DIAL TWX ADAPTER        SA59006 74478210
         BNE   NOTTWX                   NO,BRANCH              @OY12267 74478410
         TM    LCBTSOB,LCBTSBUF         TSO SESSION            @OY12267 74478610
         BZ    CHKCOUNT                 NO,RETRY               @OY12267 74478810
         B     NORETRY                  ALLOW HANG UP          @OY12267 74479010
NOTTWX   EQU   *                                               @OY12267 74479210
         CLI   D16(RUCB),T2740          2740 TERMINAL          @OY12267 74479410
         BNE   TRYRETRY                 BRANCH IF NOT            A48248 74480010
         TM    D17(RUCB),STATION+TRANSMIT     BASIC 2740         A48248 74481010
         BNZ   TRYRETRY                 BRANCH IF NOT            A48248 74482010
         B     CHKCLS                   PREPARE TO RETURN TO     S22025 74483010
*                                       LINE END APPENDAGE       S22025 74484010
*                                       OR TO RETRY CCW          S22025 74485010
         SPACE 2                                                        74486010
CHK2741  EQU   *                                                 S22025 74487010
         TM    LCBTSOB,LCBTSBUF         TSO SESSION ?            S22025 74488010
         BO    CHKCLS                   BRANCH IF YES            S22025 74490010
         TM    LCBSTAT2,LCBDIAL         IS IT DIAL?            @SA70884 74490610
         BO    NORETRY                  ALLOW TO HANG-UP       @SA70884 74491210
         ST    RCCW,LCBSTART-1          ASSUME RETRY ON FAILING  S22025 74492010
*                                       CCW                      S22025 74498010
         TM    SCBSTATE,SCBLCK1N+SCBMSGLN    IS TERM IN LOCK OR  S22025 74504010
*                                            EXTENDED LOCK MODE? S22025 74510010
         BNZ   SVCS                     BRANCH IF EITHER OR BOTH S22025 74516010
         SPACE 1                                                        74522010
         TM    AVTBIT1,AVTDLAYN+AVTCLOSN  CLOSEDOWN REQUESTED ?  S22025 74528010
         BNZ   BREAK                    IF YES, BRANCH TO BREAK  S22025 74534010
         SPACE 1                                                        74540010
         TM    LCBSTAT1,LCBOCNI         STOPLINE COMPLETE REQ ?  S22025 74546010
         BNZ   BREAK                    IF YES, BRANCH TO BREAK  S22025 74552010
         SPACE 1                                                        74558010
         LA    REG5,LCBSTCBA-1          SET UP TO TEST FOR       S22025 74564010
         L     REG8,LCBSTCBA-1             RECEIVE OR SEND       S22025 74570010
         LA    REG8,0(,REG8)                  SCHEDULER          S22025 74576010
         CR    REG5,REG8                         IN LCB          S22025 74582010
         BNE   ITS2741                  BRANCH IF SEND SCHEDULER S22025 74585010
*                                       IN LCB - GO ISSUE BREAK  S22025 74588010
*                                       TO PREPARE CONTROL UNIT  S22025 74591010
*                                       AND TERMINAL TO RECEIVE  S22025 74594010
*                                       OUTPUT                   S22025 74597010
         B     SVCS                     ISSUE EREXCP             Y01004 74600010
CHKCLS   EQU   *                                                 S22025 74606410
         MVI   LCBCSW+3,NORMAL          SET NORMAL ENDING STATUS S22025 74606810
         TM    AVTBIT1,AVTDLAYN+AVTCLOSN  CLOSEDOWN REQUESTED ?  S22025 74607210
         BNZ   GOODEXIT                 BRANCH IF YES            S22025 74607610
         LR    RWKB,RCCW                RESTART ON READ RESPONSE S22025 74608010
         TM    LCBSTAT1,LCBOCNI         STOPLINE COMPLETE REQ ?  S22025 74608410
         BZ    NOSTOP                   BRANCH IF NO             S22025 74608810
GOODEXIT EQU   *                                                 S22025 74609210
         NI    IOSFLA,AVTEFF-(IOSERR+IOSEX) SET NORMAL ENDING    Y02027 74609610
*                                       STATUS                   Y02027 74610010
         B     SVCS                                            @OZ07810 74610410
         SPACE 2                                                        74610810
         SPACE 2                                                        74612010
TRY2741  EQU   *                                                 S22025 74618010
         TM    LCBTSOB,LCB2741N         2741 TERMINAL ?          S22025 74624010
         BNO   NORETRY                  BRANCH IF NO             S22025 74630010
ITS2741  EQU   *                                                 S22025 74636010
         OI    LCBCHAIN,LCBNORTY        SET NO RETRY FLAG        S22025 74642010
         MVI   LCBINCAM,RTRYMAX         SET MAXIMUM RETRY COUNT  S22025 74648010
         SPACE 2                                                        74654010
BREAK    EQU   *                                                 S22025 74660010
         ST    RLCB,LCBERCCW            USE LCB ADDRESS          S22025 74666010
         MVI   LCBERCCW,CCWBREAK        SET UP BREAK CCW         S22025 74672010
         MVC   LCBERCCW+4(4),FLGCT41    SET UP FLAGS AND COUNT   S22025 74678010
*                                       FOR 2741 BREAK           S22025 74684010
         TM    LCBTSOB,LCB2741N         2741 TERMINAL ?          S22025 74690010
         BO    BREAK2                   BRANCH IF YES            S22025 74696010
         MVC   LCBERCCW+4(4),BRKFLGCT   SET UP FLAGS AND COUNT   S22025 74702010
*                                       FOR TELETYPE BREAK       S22025 74708010
BREAK2   MVI   LCBINCAM+1,BRKRET        RETURN INDEX FOR 504G    S22025 74714010
COMMON   EQU   *                                                 S22025 74720010
         LA    REG5,LCBERCCW            SAVE EXCP START ADDRESS  S22025 74722010
BREAK3   EQU   *                                                 S22025 74724010
         MVC   LCBSNSV,LCBSENS0         SAVE CURRENT SENSE       S22025 74726010
         MVC   LCBCSWSV,LCBCSW          SAVE CURRENT CSW         S22025 74732010
         LR    RWKB,REG5                SET START ADDRESS        S22025 74738010
         B     NOSTOP                   GO EXCP                  S22025 74744010
         SPACE 2                                                        74750010
         SPACE 2                                                        74756010
TRYRETRY EQU   *                                                 S22025 74762010
         CLI   LCBRESTR,TPTWXID         TWX ID ?                 S22025 74768010
         BE    REDIAL                   BRANCH = YES             S22025 74774010
         TM    LCBCPA+16,X'20'          DIAL INITIAL CONTACT     S22025 74780010
         BZ    CHKCOUNT                 BRANCH IF NO             S22025 74786010
         LA    RWKB,LCBCPA+32           SKIP TO WRITE COMMAND    S22025 74792010
CHKCOUNT EQU   *                                                 S22025 74798010
         CLI   LCBINCAM,RETRY           RETRY LIMIT REACHED ?    S22025 74804010
         BNL   PERMEXIT                 BRANCH IF YES            S22025 74810010
         IC    RWKA,LCBINCAM            INSERT RETRY COUNT       S22025 74822010
         LA    RWKA,1(,RWKA)            ADD ONE                  S22025 74828010
         STC   RWKA,LCBINCAM            SAVE COUNT IN LCB        S22025 74834010
NOSTOP   EQU   *                                                 S22025 74840010
         ST    RWKB,LCBSTART-1          SET START ADDRESS        S22025 74846010
         MVI   LCBSENS0,AVTEZERO        CLEAR SENSE FOR RETRY    Y02027 74852010
         B     SVCS                     ISSUE EREXCP             Y01004 74858010
         SPACE 2                                                        74870010
REDIAL   EQU   *                                                 S22025 74876010
         LA    RWKB,LCBCPA+16           SET UP TO REDIAL         S22025 74882010
         B     CHKCOUNT                 GO CHECK RETRY COUNT     S22025 74888010
         SPACE 5                                                        74894010
         EJECT                                                          75000010
LCBBKUP  DC    AL2(LCBFLAG1-IEDQLCB)    TO ADJUST LCB BASE              75500010
BRKRET   EQU   8                        RETURN INDEX FOR 504G    S22025 75510010
RDSKIP   EQU   4                        RETURN INDEX FOR 504G    S22025 75520010
CC3      EQU   X'30'                    FLAG = CONTROL UNIT NOT  S22025 75530010
*                                       UP                       S22025 75540010
UNITCHK  EQU   X'02'                    UNIT CHECK MASK          S22025 75550010
H8       DC    H'8'                     TO ADJUST CCW POINTER           75570010
ONE      EQU   1                                                 Y02027 75572010
TWO      EQU   2                                                 Y02027 75574010
SEVEN    EQU   7                                                 Y02027 75576010
HIOCC    EQU   X'48'                    IOHALT COMPLETION CODE   Y02027 75578010
TTYTYPE1 EQU   X'40'                   TTY TYPE 1 ADAPTER FLAG  SA55958 75580010
TTYTYPE2 EQU   X'50'                   TTY TYPE 2 ADAPTER FLAG  SA55958 75585010
TYPE5    EQU   X'50'                    DIAL TWX ADAPTER        SA59006 75587010
D19      EQU   19                                                       75590010
D16      EQU   16                       UCB INDEX TO TERM TYPE   A48248 75593010
D17      EQU   17                       AND TO TERM FEATURES     A48248 75596010
RTRYMAX  EQU   X'02'                    MAXIMUM RETRY COUNT      S22025 75600010
X0F      EQU   X'0F'                    MASK OFF ADAPTER TYPE    S22025 75610010
X02      EQU   X'02'                    MASK FOR 2701            S22025 75620010
RETRY    EQU   X'02'                    MAXIMUM RETRY COUNT      S22025 75630010
PERMRET  EQU   20                       RETURN INDEX FOR 504G    S22025 75640010
POSTMOD  DC    AL2(5047)                POST MODULE                     75650010
NORMAL   EQU   X'0D'                    NORMAL ENDING STATUS     S22025 75660010
POSNO    EQU   16                       RETURN INDEX FOR 504G    S22025 75670010
CVTPTR   EQU   X'10'                    CVT ADDRESS              S22025 75680010
XCTLADD  EQU   X'2C'                    CVT-XCTL ROUTINE OFFSET  S22025 75690010
EOASHFT  DC    X'169C'                  EOA AND SHIFT CHARACTER  S22025 75693010
*        TO INSURE PROPER CONTROL UNIT AND TERMIANL SETTINGS     S22025 75696010
T2740    EQU   X'54'                    UCB TYPE MASK FOR 2740   A48248 75696610
STATION  EQU   X'08'                    STATION CONTROL          A48248 75697210
TRANSMIT EQU   X'04'                    TRANSMIT CONTROL         A48248 75697810
TYPE1    EQU   X'10'                    TYPE 1 ADAPTER MASK      A48248 75698410
ERPOFF   EQU   X'DB'                    TO RESET ERP FLAG        S22025 75699010
ZERO     EQU   0                                                 X01004 75699110
IOBPTR   EQU   5                        OFFSET OF IOB ADDR. IN RQE.     75699210
DEBPTR   EQU   9                        OFFSET OF DEB ADDR. IN RQE.     75699310
SIOPTR   EQU   4                        OFFSET OF SIO APDG. ADDRESS     75699610
*                                       IN APDG. VECTOR TABLE.          75699710
SIOENTRY EQU   34                       OFFSET OF SUBRTNE. ENTRY Y02027 75699810
*                                       POINT IN SIO APPENDAGE.         75699910
         SPACE 2                                                        75700010
***      FLAGS AND COUNT FOR TELETYPE BREAK CCW              *** S22025 75709010
BRKFLGCT DC    AL1(CCWSLI),AL2(0),XL1'30'                        S22025 75718010
***      FLAGS AND COUNT FOR 2741 BREAK CCW IF TIME OUT      *** S22025 75727010
FLGCT41  DC    AL1(CCWSLI),AL2(0),XL1'05'                        S22025 75736010
***      FLAGS AND COUNT FOR 2741 BREAK CCW IF UNIT EXCPTN   *** S22025 75745010
UNXFLCNT DC    AL1(CCWCC+CCWSLI),AL2(0),XL1'05'                  S22025 75754010
         DC    XL1'01',AL3(0),AL1(CCWSLI),AL2(0),XL1'02'         S22025 75763010
***      FLAGS AND COUNT FOR READ SKIP                       *** S22025 75772010
FLAGCNT  DC    AL1(CCWSKIP),XL1'0',X'FFFF'                       S22025 75781010
***      FLAGS AND COUNT FOR 2260 REMOTE BREAK SEQUENCE      *** S22025 75790010
BRK2848  DC    X'42000001',AL1(CCWCC+CCWSLI+CCWSKIP),X'0003C0'  SA55420 75799010
         DC    X'41000001',AL1(CCWSLI),X'0003E8'                 S22025 75808010
         EJECT                                                          75809010
         TDEBD                          DEB DSECT                       75810010
         EJECT                                                          75811010
         SPACE 3                                                        75812010
         TTPD                                                           75816010
         TCCWD                          S22025                          75820010
         TTRMD                                                          75830010
         TTNTD                                                          75840010
         TQCBD                                                          75850010
         TSCBD                                                          75860010
         DCBD  DSORG=TX                                                 75870010
         TAVTD                                                          76000010
         TLCBD                                                          77000010
         IECDIOSB                                                Y02027 77500010
         END                                                            78000010
