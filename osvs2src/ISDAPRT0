         TITLE 'SDA PRINT ROUTINE FOR SYSPRINT                         *00001000
                        '                                               00002000
ISDAPRT0 CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL2(@EP00001-@MAINENT)                                   00007000
         DC    AL1(8)                                              0001 00008000
         DC    C'ISDAPRT0'                                         0001 00009000
ISDAPRTO DS    0H                                                  0001 00010000
         USING *,@15                                               0001 00011000
         B     @PROLOG                                             0001 00012000
         DC    AL2(@EP00056-ISDAPRTO)                                   00013000
         ENTRY ISDAPRTO                                                 00014000
ISDAPRTC DS    0H                                                  0001 00015000
         USING *,@15                                               0001 00016000
         B     @PROLOG                                             0001 00017000
         DC    AL2(@EP00105-ISDAPRTC)                                   00018000
         ENTRY ISDAPRTC                                                 00019000
ISDAPRTH DS    0H                                                  0001 00020000
         USING *,@15                                               0001 00021000
         B     @PROLOG                                             0001 00022000
         DC    AL2(@EP00130-ISDAPRTH)                                   00023000
         ENTRY ISDAPRTH                                                 00024000
         DROP  @15                                                      00025000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00026000
         BALR  @12,0                                               0001 00027000
@PSTART  DS    0H                                                  0001 00028000
         USING @PSTART,@12                                         0001 00029000
         L     @00,@SIZDATD                                        0001 00030000
         ISDAPSPC R,LV=(0)                                              00031000
         LR    @11,@01                                             0001 00032000
         USING @DATD,@11                                           0001 00033000
         ST    @13,@SA00001+4                                      0001 00034000
         LM    @15,@01,16(@13)                                     0001 00035000
         ST    @11,8(,@13)                                         0001 00036000
         LR    @13,@11                                             0001 00037000
         AH    @15,4(,@15)                                         0001 00038000
         BR    @15                                                 0001 00039000
@EP00001 MVC   @PC00001(4),0(@01)                                  0001 00040000
*/* RETCODE=0 = OPEN AND WRITE SUCCESSFUL                    @Y30LB55*/ 00041000
*/* RETCODE=4 = OPEN FAILED. MISSING DD CARD                 @Y30LB55*/ 00042000
*/* RETCODE=24 = NO SPACE FOR WORKAREA                       @Y30LB55*/ 00043000
*/* USER ABEND 112 = WRITE ERROR ON OUTPUT                   @Y30LB55*/ 00044000
*                                                                  0011 00045000
*   CVTPTR=WORKPTR;                 /* SET LOCAL PTR TO CVT  @Y30LB55*/ 00046000
         L     @10,@PC00001                                        0011 00047000
         L     CVTPTR,WORKPTR(,@10)                                0011 00048000
*   RETCODE=0;                      /* INIT RETCODE          @Y30LB55*/ 00049000
         SLR   @10,@10                                             0012 00050000
         LR    RETCODE,@10                                         0012 00051000
*   PRTWKPTR=PRT00PTR;              /* SET LOCAL PTR TO PRTWORK    0013 00052000
*                                                            @Y30LB55*/ 00053000
         L     PRTWKPTR,PRT00PTR(,CVTPTR)                          0013 00054000
*   IF PRTWKPTR^=0 THEN             /* HAVE WORKAREA         @Y30LB55*/ 00055000
         CR    PRTWKPTR,@10                                        0014 00056000
         BE    @RF00014                                            0014 00057000
*     DO;                           /* YES                   @Y30LB55*/ 00058000
*                                                                  0015 00059000
*       /*************************************************************/ 00060000
*       /*                                                           */ 00061000
*       /* ROUTINE TO PRINT A LINE ON SYSPRINT                       */ 00062000
*       /*                                                           */ 00063000
*       /*************************************************************/ 00064000
*                                                                  0016 00065000
*       ANSISAVE=ANSI;              /* SAVE PRINT CONTROL    @Y30LB55*/ 00066000
         MVC   ANSISAVE(1,PRTWKPTR),ANSI(CVTPTR)                   0016 00067000
*       IF ANSI=PSKIP|LINENO>PGSKIP THEN/* PAGE SKIP OR MAX LINE   0017 00068000
*                                      COUNT                 @Y30LB55*/ 00069000
         CLI   ANSI(CVTPTR),C'1'                                   0017 00070000
         BE    @RT00017                                            0017 00071000
         LH    @10,LINENO(,PRTWKPTR)                               0017 00072000
         CH    @10,@CH00164                                        0017 00073000
         BNH   @RF00017                                            0017 00074000
@RT00017 DS    0H                                                  0018 00075000
*         DO;                       /* YES, PRINT SDA TOP TITLE    0018 00076000
*                                                            @Y30LB55*/ 00077000
*                                                                  0018 00078000
*           /*********************************************************/ 00079000
*           /*                                                       */ 00080000
*           /* PRINT TOP TITLE                                       */ 00081000
*           /*                                                       */ 00082000
*           /*********************************************************/ 00083000
*                                                                  0019 00084000
*           LINENO=1;               /* RESET LINE COUNT      @Y30LB55*/ 00085000
         LA    @10,1                                               0019 00086000
         STH   @10,LINENO(,PRTWKPTR)                               0019 00087000
*           PAGENO=PAGENO+1;        /* INCREMENT PAGE COUNT  @Y30LB55*/ 00088000
         AH    @10,PAGENO(,PRTWKPTR)                               0020 00089000
         STH   @10,PAGENO(,PRTWKPTR)                               0020 00090000
*           ANSI=LSKIP2;            /* SET SKIP 1 LINE       @Y30LB55*/ 00091000
         MVI   ANSI(CVTPTR),C'0'                                   0021 00092000
*           CVD(PAGENO,TEMP8);      /* CONVERT PAGE NUMBER   @Y30LB55*/ 00093000
         CVD   @10,TEMP8(,PRTWKPTR)                                0022 00094000
*           PAGEC=EDPAT3;           /* MOVE EDIT PATTERN     @Y30LB55*/ 00095000
         MVC   PAGEC(4,PRTWKPTR),EDPAT3                            0023 00096000
*           ED(PAGEC,TEMP78);       /* EDIT PAGE NUMBER      @Y30LB55*/ 00097000
         ED    PAGEC(4,PRTWKPTR),TEMP78(PRTWKPTR)                  0024 00098000
*           IF SDARPTID^=ZEROID THEN /* REPORT ID TO MOVE    @ZM30730*/ 00099000
         CLC   SDARPTID(3,CVTPTR),@CB00150                         0025 00100000
         BE    @RF00025                                            0025 00101000
*             HEADERID=SDARPTID;    /* YES, MOVE REPORT ID   @ZM30730*/ 00102000
         MVC   HEADERID(3,PRTWKPTR),SDARPTID(CVTPTR)               0026 00103000
*           ELSE;                   /* NO, NOTHING TO MOVE   @ZM30730*/ 00104000
@RF00025 DS    0H                                                  0028 00105000
*           RFY                                                    0028 00106000
*            (R6,                                                  0028 00107000
*             R7) RSTD;                                    /*@Y30LB55*/ 00108000
*           R6=ADDR(PRINTDCB);      /* SET ADDR DCB          @Y30LB55*/ 00109000
         LA    R6,PRINTDCB(,PRTWKPTR)                              0029 00110000
*           R7=ADDR(HEADER);        /* SET ADDR OF LINE      @Y30LB55*/ 00111000
         LA    R7,HEADER(,PRTWKPTR)                                0030 00112000
*           GEN(PUT (R6),(R7) )                                    0031 00113000
*           FLOWS(EOD);                                    /*@Y30LB55*/ 00114000
         PUT (R6),(R7)                                                  00115000
*           RFY                                                    0032 00116000
*            (R6,                                                  0032 00117000
*             R7) UNRSTD;                                  /*@Y30LB55*/ 00118000
*         END;                      /* END PUT TITLE CODE    @Y30LB55*/ 00119000
*       ELSE                                                       0034 00120000
*         ;                         /* NO TITLE YET          @Y30LB55*/ 00121000
@RF00017 DS    0H                                                  0035 00122000
*                                                                  0035 00123000
*       /*************************************************************/ 00124000
*       /*                                                           */ 00125000
*       /* PRINT OUTPUT LINE                                         */ 00126000
*       /*                                                           */ 00127000
*       /*************************************************************/ 00128000
*                                                                  0035 00129000
*       I=0;                        /* SET LINE INC TO 0     @Y30LB55*/ 00130000
         SLR   I,I                                                 0035 00131000
*       IF ANSI=LSKIP1 THEN         /* 1 LINE SKIP           @Y30LB55*/ 00132000
         CLI   ANSI(CVTPTR),C' '                                   0036 00133000
         BNE   @RF00036                                            0036 00134000
*         I=1;                      /* INC LINE COUNT BY 1   @Y30LB55*/ 00135000
         LA    I,1                                                 0037 00136000
*       ELSE                        /* NO, CHECK FOR 2       @Y30LB55*/ 00137000
*         IF ANSI=LSKIP2 THEN       /* 2 LINE SKIP           @Y30LB55*/ 00138000
         B     @RC00036                                            0038 00139000
@RF00036 CLI   ANSI(CVTPTR),C'0'                                   0038 00140000
         BNE   @RF00038                                            0038 00141000
*           I=2;                    /* INC LINE COUNT BY 2   @Y30LB55*/ 00142000
         LA    I,2                                                 0039 00143000
*         ELSE                      /* NO, CHECK 3           @Y30LB55*/ 00144000
*           IF ANSI=LSKIP3 THEN     /* 3 LINE SKIP           @Y30LB55*/ 00145000
         B     @RC00038                                            0040 00146000
@RF00038 CLI   ANSI(CVTPTR),C'-'                                   0040 00147000
         BNE   @RF00040                                            0040 00148000
*             I=3;                  /* INC LINE COUNT BY 3   @Y30LB55*/ 00149000
         LA    I,3                                                 0041 00150000
*           ELSE                                                   0042 00151000
*             ;                     /* NO LINE COUNT INCREMENT     0042 00152000
*                                                            @Y30LB55*/ 00153000
@RF00040 DS    0H                                                  0043 00154000
*       LINENO=LINENO+I;            /* INCREMENT LINE COUNT  @Y30LB55*/ 00155000
@RC00038 DS    0H                                                  0043 00156000
@RC00036 LR    @10,I                                               0043 00157000
         AH    @10,LINENO(,PRTWKPTR)                               0043 00158000
         STH   @10,LINENO(,PRTWKPTR)                               0043 00159000
*       RFY                                                        0044 00160000
*        (R6,                                                      0044 00161000
*         R7) RSTD;                                        /*@Y30LB55*/ 00162000
*       R6=ADDR(PRINTDCB);          /* SET ADDR OF DCB       @Y30LB55*/ 00163000
         LA    R6,PRINTDCB(,PRTWKPTR)                              0045 00164000
*       R7=ADDR(OUTLINE);           /* SET ADDR OF OUTLINE   @Y30LB55*/ 00165000
         LA    R7,OUTLINE(,CVTPTR)                                 0046 00166000
*       GEN(PUT   (R6),(R7) )                                      0047 00167000
*       FLOWS(EOD);                                        /*@Y30LB55*/ 00168000
         PUT   (R6),(R7)                                                00169000
*       RFY                                                        0048 00170000
*        (R6,                                                      0048 00171000
*         R7) UNRSTD;                                      /*@Y30LB55*/ 00172000
*       ANSI=ANSISAVE;              /* RESTORE PRINT CONTROL @Y30LB55*/ 00173000
         MVC   ANSI(1,CVTPTR),ANSISAVE(PRTWKPTR)                   0049 00174000
*     END;                          /* END PRINT CODE        @Y30LB55*/ 00175000
*   ELSE                            /* NO WORKAREA           @Y30LB55*/ 00176000
*     RETCODE=24;                   /* SET NO SPACE RETURN   @Y30LB55*/ 00177000
         B     @RC00014                                            0051 00178000
@RF00014 LA    RETCODE,24                                          0051 00179000
*   RETURN CODE(RETCODE);           /* RETURN WITH CONDCODE  @Y30LB55*/ 00180000
*                                                                  0052 00181000
@RC00014 L     @13,4(,@13)                                         0052 00182000
         L     @00,@SIZDATD                                        0052 00183000
         LR    @01,@11                                             0052 00184000
         ISDAFSPC R,LV=(0),A=(1)                                        00185000
         LR    @15,@04                                             0052 00186000
         L     @14,12(,@13)                                        0052 00187000
         LM    @00,@12,20(@13)                                     0052 00188000
         BR    @14                                                 0052 00189000
*   /*****************************************************************/ 00190000
*   /*                                                               */ 00191000
*   /* EOD - SYNAD RETURN FROM PUT                                   */ 00192000
*   /*                                                               */ 00193000
*   /*****************************************************************/ 00194000
*                                                                  0053 00195000
*EOD:                                                              0053 00196000
*   RETCODE=12;                     /* SET SYNAD RETURN CODE @Y30LB55*/ 00197000
EOD      LA    RETCODE,12                                          0053 00198000
*   GEN( ABEND  112,DUMP);          /* ABEND WITH USER CODE 112    0054 00199000
*                                                            @Y30LB55*/ 00200000
          ABEND  112,DUMP                                               00201000
*   RETURN CODE(RETCODE);           /* RETURN BAD CONDCODE   @Y30LB55*/ 00202000
         L     @13,4(,@13)                                         0055 00203000
         L     @00,@SIZDATD                                        0055 00204000
         LR    @01,@11                                             0055 00205000
         ISDAFSPC R,LV=(0),A=(1)                                        00206000
         LR    @15,@04                                             0055 00207000
         L     @14,12(,@13)                                        0055 00208000
         LM    @00,@12,20(@13)                                     0055 00209000
         BR    @14                                                 0055 00210000
*                                                                  0056 00211000
*   /*****************************************************************/ 00212000
*   /*                                                               */ 00213000
*   /* ENTRY TO OPEN SYSPRINT                                        */ 00214000
*   /*                                                               */ 00215000
*   /*****************************************************************/ 00216000
*                                                                  0056 00217000
*ISDAPRTO:                                                         0056 00218000
*   ENTRY(WORKPTR);                 /* ENTRY TO OPEN SYSPRINT@Y30LB55*/ 00219000
@EP00056 MVC   @PC00001(4),0(@01)                                  0056 00220000
*   CVTPTR=WORKPTR;                 /* SET LOCAL PTR TO CVT  @Y30LB55*/ 00221000
         L     @10,@PC00001                                        0057 00222000
         L     CVTPTR,WORKPTR(,@10)                                0057 00223000
*   RETCODE=0;                      /* INIT RETCODE          @Y30LB55*/ 00224000
*                                                                  0058 00225000
         SLR   @10,@10                                             0058 00226000
         LR    RETCODE,@10                                         0058 00227000
*   /*****************************************************************/ 00228000
*   /*                                                               */ 00229000
*   /* GET CORE FOR ISDAPRT0 WORKAREA                                */ 00230000
*   /*                                                               */ 00231000
*   /*****************************************************************/ 00232000
*                                                                  0059 00233000
*   IF PRT00PTR=0 THEN              /* NO WORKAREA           @Y30LB55*/ 00234000
         C     @10,PRT00PTR(,CVTPTR)                               0059 00235000
         BNE   @RF00059                                            0059 00236000
*     DO;                           /* NONE, GET IT          @Y30LB55*/ 00237000
*       CORELEN=LENGTH(PRTWORK);    /* SET AREA LENGTH       @Y30LB55*/ 00238000
         MVC   CORELEN(3,CVTPTR),@CF00201+1                        0061 00239000
*       SPNO=PRTSPNO;               /* SET SUBPOOL NUMBER    @Y30LB55*/ 00240000
         MVI   SPNO(CVTPTR),X'00'                                  0062 00241000
*       RFY                                                        0063 00242000
*         R1 RSTD;                                         /*@Y30LB55*/ 00243000
*       R1=ADDR(WORKCALL);          /* R1 -> WORKPTR         @Y30LB55*/ 00244000
         LA    R1,WORKCALL(,CVTPTR)                                0064 00245000
*       CALL ISDAGET1;              /* GET CORE              @Y30LB55*/ 00246000
         L     @15,@CV00111                                        0065 00247000
         BALR  @14,@15                                             0065 00248000
*       RFY                                                        0066 00249000
*         R15 RSTD;                                        /*@Y30LB55*/ 00250000
*       RETCODE=R15;                /* SAVE GET1 RETURN CODE @Y30LB55*/ 00251000
         LR    RETCODE,R15                                         0067 00252000
*       RFY                                                        0068 00253000
*        (R1,                                                      0068 00254000
*         R15) UNRSTD;              /* RELEASE REGS          @Y30LB55*/ 00255000
*       PRT00PTR=COREADDR;          /* STORE ADDR IN ISDACVT @Y30LB55*/ 00256000
         L     @10,COREADDR(,CVTPTR)                               0069 00257000
         ST    @10,PRT00PTR(,CVTPTR)                               0069 00258000
*       PRTWKPTR=PRT00PTR;          /* SET LOCAL PTR TO PRTWORK    0070 00259000
*                                                            @Y30LB55*/ 00260000
         LR    PRTWKPTR,@10                                        0070 00261000
*       IF RETCODE=0 THEN           /* GOT CORE              @Y30LB55*/ 00262000
         LTR   RETCODE,RETCODE                                     0071 00263000
         BNZ   @RF00071                                            0071 00264000
*         DO;                       /* YES, INITIALIZE PRTWORK     0072 00265000
*                                                            @Y30LB55*/ 00266000
*           PRINTDCB=DCBSTAT;       /* MOVE DCB INTO WORKAREA@Y30LB55*/ 00267000
         MVC   PRINTDCB(96,PRTWKPTR),DCBSTAT                       0073 00268000
*           OPENLIST=OPENSTAT;      /* MOVE OPEN LIST INTO WORKAREA     00269000
*                                                            @Y30LB55*/ 00270000
         MVC   OPENLIST(4,PRTWKPTR),OPENSTAT                       0074 00271000
*           CLOSLIST=CLOSSTAT;      /* MOVE CLOSE LIST INTO WORKAREA    00272000
*                                                            @Y30LB55*/ 00273000
         MVC   CLOSLIST(4,PRTWKPTR),CLOSSTAT                       0075 00274000
*           HEADER(1)=PSKIP;        /* SET HEADER ANSI TO PAGE SKIP     00275000
*                                                            @Y30LB55*/ 00276000
         MVI   HEADER(PRTWKPTR),C'1'                               0076 00277000
*         END;                      /* END INITIALIZE        @Y30LB55*/ 00278000
*       ELSE                        /* BAD RETURN FROM ISDAGET1    0078 00279000
*                                                            @Y30LB55*/ 00280000
*         RETCODE=24;               /* SET RETURN CODE TO NO CORE  0078 00281000
*                                                            @Y30LB55*/ 00282000
         B     @RC00071                                            0078 00283000
@RF00071 LA    RETCODE,24                                          0078 00284000
*     END;                          /* END GET CORE SECTION  @Y30LB55*/ 00285000
*   ELSE                            /* YES, HAVE WORKAREA    @Y30LB55*/ 00286000
*     PRTWKPTR=PRT00PTR;            /* SET LOCAL PTR TO PRTWORK    0080 00287000
*                                                            @Y30LB55*/ 00288000
         B     @RC00059                                            0080 00289000
@RF00059 L     PRTWKPTR,PRT00PTR(,CVTPTR)                          0080 00290000
*   IF RETCODE=0 THEN               /* HAVE WORKAREA         @Y30LB55*/ 00291000
@RC00059 SLR   @10,@10                                             0081 00292000
         CR    RETCODE,@10                                         0081 00293000
         BNE   @RF00081                                            0081 00294000
*     DO;                           /* YES                   @Y30LB55*/ 00295000
*                                                                  0082 00296000
*       /*************************************************************/ 00297000
*       /*                                                           */ 00298000
*       /* OPEN SYSPRINT                                             */ 00299000
*       /*                                                           */ 00300000
*       /*************************************************************/ 00301000
*                                                                  0083 00302000
*       IF OFLAGS(4)^='1'B THEN     /* IS DCB OPEN           @Y30LB55*/ 00303000
         TM    OFLAGS(PRTWKPTR),B'00010000'                        0083 00304000
         BO    @RF00083                                            0083 00305000
*         DO;                       /* NO, OPEN SYSPRINT     @Y30LB55*/ 00306000
*           PAGENO=1;               /* INIT PAGE COUNT       @Y30LB55*/ 00307000
         MVC   PAGENO(2,PRTWKPTR),@CH00082                         0085 00308000
*           LINENO=0;               /* INIT LINE COUNT       @Y30LB55*/ 00309000
         STH   @10,LINENO(,PRTWKPTR)                               0086 00310000
*           RFY                                                    0087 00311000
*            (R1,                                                  0087 00312000
*             R6) RSTD;                                    /*@Y30LB55*/ 00313000
*           R1=ADDR(OPENLIST);      /* R1 -> OPENLIST        @Y30LB55*/ 00314000
         LA    R1,OPENLIST(,PRTWKPTR)                              0088 00315000
*           R6=ADDR(PRINTDCB);      /* R6 -> DCB             @Y30LB55*/ 00316000
         LA    R6,PRINTDCB(,PRTWKPTR)                              0089 00317000
*           GEN( OPEN  ((R6),OUTPUT),MF=(E,(R1)))                  0090 00318000
*           FLOWS(BLOCKFIX,EOD);                           /*@Y30LB55*/ 00319000
          OPEN  ((R6),OUTPUT),MF=(E,(R1))                               00320000
*           RFY                                                    0091 00321000
*            (R1,                                                  0091 00322000
*             R6) UNRSTD;                                  /*@Y30LB55*/ 00323000
*           IF OFLAGS(4)='1'B THEN  /* DID SYSPRINT OPEN     @Y30LB55*/ 00324000
         TM    OFLAGS(PRTWKPTR),B'00010000'                        0092 00325000
         BNO   @RF00092                                            0092 00326000
*             RETCODE=0;            /* OPEN OK               @Y30LB55*/ 00327000
         SLR   RETCODE,RETCODE                                     0093 00328000
*           ELSE                    /* NO, SYSPRINT DID NOT OPEN   0094 00329000
*                                                            @Y30LB55*/ 00330000
*             RETCODE=4;            /* MISSING DD CARD       @Y30LB55*/ 00331000
         B     @RC00092                                            0094 00332000
@RF00092 LA    RETCODE,4                                           0094 00333000
*         END;                      /* END OPEN CODE         @Y30LB55*/ 00334000
*       ELSE                        /* YES, SYSPRINT OPEN    @Y30LB55*/ 00335000
*         RETCODE=0;                /* SYSPRINT ALREADY OPEN @Y30LB55*/ 00336000
         B     @RC00083                                            0096 00337000
@RF00083 SLR   RETCODE,RETCODE                                     0096 00338000
*     END;                          /* END OPEN CODE         @Y30LB55*/ 00339000
*   ELSE                                                           0098 00340000
*     ;                             /* NO WORKAREA           @Y30LB55*/ 00341000
@RF00081 DS    0H                                                  0099 00342000
*   RETURN CODE(RETCODE);           /* RETURN TO ISDASDA0    @Y30LB55*/ 00343000
*                                                                  0099 00344000
@RC00081 L     @13,4(,@13)                                         0099 00345000
         L     @00,@SIZDATD                                        0099 00346000
         LR    @01,@11                                             0099 00347000
         ISDAFSPC R,LV=(0),A=(1)                                        00348000
         LR    @15,@04                                             0099 00349000
         L     @14,12(,@13)                                        0099 00350000
         LM    @00,@12,20(@13)                                     0099 00351000
         BR    @14                                                 0099 00352000
*   /*****************************************************************/ 00353000
*   /*                                                               */ 00354000
*   /* BLOCKFIX - EXITLIST PROC TO ADD DEFAULT BLKSIZE               */ 00355000
*   /*                                                               */ 00356000
*   /*****************************************************************/ 00357000
*                                                                  0100 00358000
*BLOCKFIX:                                                         0100 00359000
*   PROC OPTIONS(NOSAVE);           /* EXITLIST PROC         @Y30LB55*/ 00360000
BLOCKFIX DS    0H                                                  0101 00361000
*   IF DCBBLKSI=ZERO2 THEN          /* WAS BLKSIZE SUPPLIED IN DD  0101 00362000
*                                      STATEMENT             @Y30LB55*/ 00363000
         CLC   DCBBLKSI(2,PRTWKPTR),@CB00148                       0101 00364000
         BNE   @RF00101                                            0101 00365000
*     DCBBLKSI=BLKSIZED;            /* NO, MOVE IN DEFAULT   @Y30LB55*/ 00366000
         MVC   DCBBLKSI(2,PRTWKPTR),@CH00152                       0102 00367000
*   ELSE                                                           0103 00368000
*     ;                             /* YES, BLKSIZE OK       @Y30LB55*/ 00369000
@RF00101 DS    0H                                                  0104 00370000
*   END BLOCKFIX;                   /* RETURN TO OPEN        @Y30LB55*/ 00371000
@EL00002 DS    0H                                                  0104 00372000
@EF00002 DS    0H                                                  0104 00373000
@ER00002 BR    @14                                                 0104 00374000
*   /*****************************************************************/ 00375000
*   /*                                                               */ 00376000
*   /* ISDAPRTC - ENTRY TO CLOSE SYSPRINT                            */ 00377000
*   /*                                                               */ 00378000
*   /*****************************************************************/ 00379000
*                                                                  0105 00380000
*ISDAPRTC:                                                         0105 00381000
*   ENTRY(WORKPTR);                 /* ENTRY TO CLOSE SYSPRINT     0105 00382000
*                                                            @Y30LB55*/ 00383000
@EP00105 MVC   @PC00001(4),0(@01)                                  0105 00384000
*   CVTPTR=WORKPTR;                 /* SET PTR TO ISDACVT    @Y30LB55*/ 00385000
         L     @10,@PC00001                                        0106 00386000
         L     CVTPTR,WORKPTR(,@10)                                0106 00387000
*   IF PRT00PTR^=0 THEN             /* HAVE WORKAREA         @Y30LB55*/ 00388000
         L     @10,PRT00PTR(,CVTPTR)                               0107 00389000
         LTR   @10,@10                                             0107 00390000
         BZ    @RF00107                                            0107 00391000
*     DO;                           /* YES, FREE IT          @Y30LB55*/ 00392000
*                                                                  0108 00393000
*       /*************************************************************/ 00394000
*       /*                                                           */ 00395000
*       /* CLOSE SYSTERM                                             */ 00396000
*       /*                                                           */ 00397000
*       /*************************************************************/ 00398000
*       PRTWKPTR=PRT00PTR;          /* SET LOCAL WORK PTR    @Y30LB55*/ 00399000
         LR    PRTWKPTR,@10                                        0109 00400000
*       IF OFLAGS(4)='1'B THEN      /* DCB OPEN              @Y30LB55*/ 00401000
         TM    OFLAGS(PRTWKPTR),B'00010000'                        0110 00402000
         BNO   @RF00110                                            0110 00403000
*         DO;                       /* YES, CLOSE IT         @Y30LB55*/ 00404000
*           RFY                                                    0112 00405000
*            (R1,                                                  0112 00406000
*             R6) RSTD;                                    /*@Y30LB55*/ 00407000
*           R1=ADDR(CLOSLIST);      /* R1 -> CLOSLIST        @Y30LB55*/ 00408000
         LA    R1,CLOSLIST(,PRTWKPTR)                              0113 00409000
*           R6=ADDR(PRINTDCB);      /* R6 -> DCB             @Y30LB55*/ 00410000
         LA    R6,PRINTDCB(,PRTWKPTR)                              0114 00411000
*           GEN( CLOSE ((R6)),MF=(E,(R1)));                /*@Y30LB55*/ 00412000
          CLOSE ((R6)),MF=(E,(R1))                                      00413000
*           RFY                                                    0116 00414000
*            (R1,                                                  0116 00415000
*             R6) UNRSTD;                                  /*@Y30LB55*/ 00416000
*         END;                      /* END CLOSE DCB         @Y30LB55*/ 00417000
*       ELSE                                                       0118 00418000
*         ;                         /* DCB NOT OPEN          @Y30LB55*/ 00419000
*                                                                  0118 00420000
@RF00110 DS    0H                                                  0119 00421000
*       /*************************************************************/ 00422000
*       /*                                                           */ 00423000
*       /* FREE PRTWORK                                              */ 00424000
*       /*                                                           */ 00425000
*       /*************************************************************/ 00426000
*       CORELEN=LENGTH(PRTWORK);    /* MOVE LENGTH OF PRTWORK@Y30LB55*/ 00427000
         MVC   CORELEN(3,CVTPTR),@CF00201+1                        0119 00428000
*       SPNO=PRTSPNO;               /* MOVE SUBPOOL NUMBER   @Y30LB55*/ 00429000
         MVI   SPNO(CVTPTR),X'00'                                  0120 00430000
*       COREADDR=PRT00PTR;          /* MOVE ADDRESS OF AREA  @Y30LB55*/ 00431000
         MVC   COREADDR(4,CVTPTR),PRT00PTR(CVTPTR)                 0121 00432000
*       RFY                                                        0122 00433000
*         R1 RSTD;                                         /*@Y30LB55*/ 00434000
*       R1=ADDR(WORKCALL);          /* R1 -> WORKPTR         @Y30LB55*/ 00435000
         LA    R1,WORKCALL(,CVTPTR)                                0123 00436000
*       CALL ISDAFREE;              /* FREE PRTWORK          @Y30LB55*/ 00437000
         L     @15,@CV00112                                        0124 00438000
         BALR  @14,@15                                             0124 00439000
*       RFY                                                        0125 00440000
*         R1 UNRSTD;                                       /*@Y30LB55*/ 00441000
*       PRT00PTR=0;                 /* ZERO PRT00PTR IN ISDACVT    0126 00442000
*                                                            @Y30LB55*/ 00443000
         SLR   @10,@10                                             0126 00444000
         ST    @10,PRT00PTR(,CVTPTR)                               0126 00445000
*     END;                          /* END CLOSE AND FREE    @Y30LB55*/ 00446000
*   ELSE                                                           0128 00447000
*     ;                             /* NO WORK AREA          @Y30LB55*/ 00448000
@RF00107 DS    0H                                                  0129 00449000
*   RETURN;                         /* RETURN TO ISDASDA0    @Y30LB55*/ 00450000
@EL00001 L     @13,4(,@13)                                         0129 00451000
@EF00001 L     @00,@SIZDATD                                        0129 00452000
         LR    @01,@11                                             0129 00453000
         ISDAFSPC R,LV=(0),A=(1)                                        00454000
@ER00001 LM    @14,@12,12(@13)                                     0129 00455000
         BR    @14                                                 0129 00456000
*                                                                  0130 00457000
*   /*****************************************************************/ 00458000
*   /*                                                               */ 00459000
*   /* ISDAPRTH - ENTRY TO SAVE SDA HEADER                           */ 00460000
*   /*                                                               */ 00461000
*   /*****************************************************************/ 00462000
*                                                                  0130 00463000
*ISDAPRTH:                                                         0130 00464000
*   ENTRY(WORKPTR);                 /* SAVE HEADER ENTRY     @Y30LB55*/ 00465000
@EP00130 MVC   @PC00001(4),0(@01)                                  0130 00466000
*   CVTPTR=WORKPTR;                 /* SET LOCAL PTR TO CVT  @Y30LB55*/ 00467000
         L     @10,@PC00001                                        0131 00468000
         L     CVTPTR,WORKPTR(,@10)                                0131 00469000
*   RETCODE=0;                      /* THIS ENTRY HAS NO ERROR CODES    00470000
*                                                            @Y30LB55*/ 00471000
         SLR   @10,@10                                             0132 00472000
         LR    RETCODE,@10                                         0132 00473000
*   PRTWKPTR=PRT00PTR;              /* SET LOCAL PTR TO PRTWORK    0133 00474000
*                                                            @Y30LB55*/ 00475000
         L     PRTWKPTR,PRT00PTR(,CVTPTR)                          0133 00476000
*   IF PRTWKPTR^=0 THEN             /* HAVE WORKAREA         @Y30LB55*/ 00477000
         CR    PRTWKPTR,@10                                        0134 00478000
         BE    @RF00134                                            0134 00479000
*     HEADER(2:133)=LINE;           /* YES, MOVE HEADER LINE @Y30LB55*/ 00480000
         MVC   HEADER+1(132,PRTWKPTR),LINE(CVTPTR)                 0135 00481000
*   ELSE                            /* NO WORKAREA           @Y30LB55*/ 00482000
*     RETCODE=24;                   /* SET NO CORE RETURN    @Y30LB55*/ 00483000
         B     @RC00134                                            0136 00484000
@RF00134 LA    RETCODE,24                                          0136 00485000
*   RETURN CODE(RETCODE);           /* RETURN TO ISDASDA0    @Y30LB55*/ 00486000
*                                                                  0137 00487000
@RC00134 L     @13,4(,@13)                                         0137 00488000
         L     @00,@SIZDATD                                        0137 00489000
         LR    @01,@11                                             0137 00490000
         ISDAFSPC R,LV=(0),A=(1)                                        00491000
         LR    @15,@04                                             0137 00492000
         L     @14,12(,@13)                                        0137 00493000
         LM    @00,@12,20(@13)                                     0137 00494000
         BR    @14                                                 0137 00495000
*   /*****************************************************************/ 00496000
*   /*                                                               */ 00497000
*   /* GENERATE DATA                                                 */ 00498000
*   /*                                                               */ 00499000
*   /*****************************************************************/ 00500000
*                                                                  0138 00501000
*   GENERATE DATA DEFS(DCBSTAT,OPENSTAT,CLOSSTAT,EXITLIST);/*@Y30LB55*/ 00502000
*   END ISDAPRT0                                           /*@Y30LB55*/ 00503000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 00504000
*/*%INCLUDE SYSLIB  (ISDACVT )                                        * 00505000
*;                                                                 0139 00506000
         B     @EL00001                                            0139 00507000
@DATA    DS    0H                                                       00508000
@CH00082 DC    H'1'                                                     00509000
@CH00164 DC    H'58'                                                    00510000
@CH00152 DC    H'1197'                                                  00511000
@DATD    DSECT                                                          00512000
         DS    0F                                                       00513000
@SA00001 DS    18F                                                      00514000
@PC00001 DS    1F                                                       00515000
ISDAPRT0 CSECT                                                          00516000
         DS    0F                                                       00517000
@CF00201 DC    F'250'                                                   00518000
@DATD    DSECT                                                          00519000
         DS    0D                                                       00520000
ISDAPRT0 CSECT                                                          00521000
         NOPR  ((@ENDDATD-@DATD)/161*16)                                00522000
         DS    0F                                                       00523000
@SIZDATD DC    AL1(0)                                                   00524000
         DC    AL3(@ENDDATD-@DATD)                                      00525000
@CV00111 DC    V(ISDAGET1)                                              00526000
@CV00112 DC    V(ISDAFREE)                                              00527000
@CV00110 DC    V(ISDAGET0)                                              00528000
         DS    0D                                                       00529000
@CB00150 DC    X'000000'                                                00530000
@CB00148 EQU   @CB00150                                                 00531000
EDPAT3   DC    X'40202120'                                              00532000
PATCH    DC    50X'00'                                                  00533000
ISDAPRT0 CSECT                                                          00534000
DCBSTAT  DCB   DSORG=PS,MACRF=PM,DDNAME=SYSPRINT,SYNAD=EOD,LRECL=133, XX00535000
               RECFM=FBA,EXLST=EXITLIST                                 00536000
OPENSTAT OPEN  (0,OUTPUT),MF=L                                          00537000
CLOSSTAT CLOSE (0),MF=L                                                 00538000
         DS    0F                                                       00539000
EXITLIST DC    XL1'85'                 FLAG FOR DCB  EXIT               00540000
         DC    AL3(BLOCKFIX)           ADDR OF BLOCKFIX ENTRY           00541000
@DATD    DSECT                                                          00542000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00543000
@ENDDATD EQU   *                                                        00544000
ISDAPRT0 CSECT                                                          00545000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00546000
@01      EQU   01                                                       00547000
@02      EQU   02                                                       00548000
@03      EQU   03                                                       00549000
@04      EQU   04                                                       00550000
@05      EQU   05                                                       00551000
@06      EQU   06                                                       00552000
@07      EQU   07                                                       00553000
@08      EQU   08                                                       00554000
@09      EQU   09                                                       00555000
@10      EQU   10                                                       00556000
@11      EQU   11                                                       00557000
@12      EQU   12                                                       00558000
@13      EQU   13                                                       00559000
@14      EQU   14                                                       00560000
@15      EQU   15                                                       00561000
RETCODE  EQU   @04                                                      00562000
I        EQU   @05                                                      00563000
PRTWKPTR EQU   @03                                                      00564000
CVTPTR   EQU   @02                                                      00565000
R1       EQU   @01                                                      00566000
R6       EQU   @06                                                      00567000
R7       EQU   @07                                                      00568000
R15      EQU   @15                                                      00569000
ISDACVT  EQU   0                                                        00570000
CVTPTRS0 EQU   ISDACVT                                                  00571000
PRT00PTR EQU   CVTPTRS0+28                                              00572000
WORKCALL EQU   CVTPTRS0+96                                              00573000
GET0CALL EQU   ISDACVT+100                                              00574000
SPNOLEN  EQU   GET0CALL                                                 00575000
SPNO     EQU   SPNOLEN                                                  00576000
CORELEN  EQU   SPNOLEN+1                                                00577000
COREADDR EQU   GET0CALL+4                                               00578000
HEXPCALL EQU   ISDACVT+108                                              00579000
PRT0CALL EQU   ISDACVT+120                                              00580000
OUTLINE  EQU   PRT0CALL                                                 00581000
ANSI     EQU   OUTLINE                                                  00582000
LINE     EQU   OUTLINE+1                                                00583000
SDARPTID EQU   PRT0CALL+133                                             00584000
SDADATD  EQU   ISDACVT+256                                              00585000
PRTDATD  EQU   ISDACVT+416                                              00586000
PRTWORK  EQU   0                                                        00587000
TEMP8    EQU   PRTWORK                                                  00588000
TEMP68   EQU   TEMP8+5                                                  00589000
TEMP78   EQU   TEMP68+1                                                 00590000
OPENLIST EQU   PRTWORK+8                                                00591000
CLOSLIST EQU   PRTWORK+12                                               00592000
PAGENO   EQU   PRTWORK+16                                               00593000
LINENO   EQU   PRTWORK+18                                               00594000
PRINTDCB EQU   PRTWORK+20                                               00595000
OFLAGS   EQU   PRINTDCB+48                                              00596000
DCBBLKSI EQU   PRINTDCB+62                                              00597000
HEADER   EQU   PRTWORK+116                                              00598000
HEADERID EQU   HEADER+1                                                 00599000
ANSISAVE EQU   PRTWORK+249                                              00600000
WORKPTR  EQU   0                                                        00601000
PAGEC    EQU   HEADER+124                                               00602000
*                                      START UNREFERENCED COMPONENTS    00603000
@NM00005 EQU   HEADER+4                                                 00604000
@NM00004 EQU   HEADER                                                   00605000
@NM00003 EQU   PRINTDCB+64                                              00606000
@NM00002 EQU   PRINTDCB+49                                              00607000
@NM00001 EQU   PRINTDCB                                                 00608000
TEMP1    EQU   TEMP68                                                   00609000
TEMP5    EQU   TEMP8                                                    00610000
PRTSA001 EQU   PRTDATD                                                  00611000
SDATEMPS EQU   SDADATD+136                                              00612000
SDASA002 EQU   SDADATD+76                                               00613000
SDAPC001 EQU   SDADATD+72                                               00614000
SDASA001 EQU   SDADATD                                                  00615000
DUMPIDNO EQU   HEXPCALL+8                                               00616000
DUMPLEN  EQU   HEXPCALL+4                                               00617000
DUMPADDR EQU   HEXPCALL                                                 00618000
GEN00PTR EQU   CVTPTRS0+92                                              00619000
CNFG0PTR EQU   CVTPTRS0+88                                              00620000
PWR00PTR EQU   CVTPTRS0+84                                              00621000
APR00PTR EQU   CVTPTRS0+80                                              00622000
DRC00PTR EQU   CVTPTRS0+76                                              00623000
DAT00PTR EQU   CVTPTRS0+72                                              00624000
CSB00PTR EQU   CVTPTRS0+68                                              00625000
DCK00PTR EQU   CVTPTRS0+64                                              00626000
EQC00PTR EQU   CVTPTRS0+60                                              00627000
FSC00PTR EQU   CVTPTRS0+56                                              00628000
DHE00PTR EQU   CVTPTRS0+52                                              00629000
SUM00PTR EQU   CVTPTRS0+48                                              00630000
PAD00PTR EQU   CVTPTRS0+44                                              00631000
DCS00PTR EQU   CVTPTRS0+40                                              00632000
LOG00PTR EQU   CVTPTRS0+36                                              00633000
HIST0PTR EQU   CVTPTRS0+32                                              00634000
GET00PTR EQU   CVTPTRS0+24                                              00635000
TYPE0PTR EQU   CVTPTRS0+20                                              00636000
PARM0PTR EQU   CVTPTRS0+16                                              00637000
SDA00PTR EQU   CVTPTRS0+12                                              00638000
PARMPTR  EQU   CVTPTRS0+8                                               00639000
SDATAPTR EQU   CVTPTRS0+4                                               00640000
DATAPTR  EQU   CVTPTRS0                                                 00641000
*                                      END UNREFERENCED COMPONENTS      00642000
@RC00071 EQU   @RC00059                                                 00643000
@RC00083 EQU   @RC00081                                                 00644000
@RC00092 EQU   @RC00083                                                 00645000
@ENDDATA EQU   *                                                        00646000
         END   ISDAPRT0,(C'PLS0141',0603,75313)                         00647000
