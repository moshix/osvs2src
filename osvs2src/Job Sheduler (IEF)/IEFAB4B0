         TITLE 'IEFAB4B0 - DISPOSITION MESSAGE ROUTINE                 *00001000
                        '                                               00002000
IEFAB4B0 CSECT ,                                                01S0001 00003000
@MAINENT DS    0H                                               01S0001 00004000
         USING *,@15                                            01S0001 00005000
         B     @PROLOG                                          01S0001 00006000
         DC    AL1(16)                                          01S0001 00007000
         DC    C'IEFAB4B0  73.338'                              01S0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                  01S0001 00010000
         BALR  @12,0                                            01S0001 00011000
@PSTART  DS    0H                                               01S0001 00012000
         USING @PSTART,@12                                      01S0001 00013000
         L     @00,@SIZDATD                                     01S0001 00014000
         MODESET EXTKEY=SCHED,SAVEKEY=(2)                               00015000
         GSPACE  R,LV=(0)                                               00016000
         LR    @11,@01                                          01S0001 00017000
         USING @DATD,@11                                        01S0001 00018000
         ST    @13,@SA00001+4                                   01S0001 00019000
         STC   @02,@OLDKEY                                      01S0001 00020000
         MODESET KEYADDR=(2)                                            00021000
         LM    @00,@02,20(@13)                                  01S0001 00022000
         ST    @11,8(,@13)                                      01S0001 00023000
         LR    @13,@11                                          01S0001 00024000
         MODESET EXTKEY=ZERO                                            00025000
         MVC   @PC00001(20),0(@01)                              01S0001 00026000
         MODESET EXTKEY=SCHED                                           00027000
*MSGBUFFR = '';                        /*BLANK ENTIRE BUFFER         */ 00028000
         MVI   MSGBUFFR,C' '                                    01S0026 00029000
         MVC   MSGBUFFR+1(73),MSGBUFFR                          01S0026 00030000
*DSPIDPTR = ADDR(DSPTAB) + DOFFSET(DISPID); /*ADDR DISP ID ENTRY     */ 00031000
         L     DSPIDPTR,@CA00129                                01S0027 00032000
         L     @10,@PC00001                                     01S0027 00033000
         SLR   @15,@15                                          01S0027 00034000
         IC    @15,DISPID(,@10)                                 01S0027 00035000
         MH    @15,@CH00085                                     01S0027 00036000
         L     @14,@CA00131                                     01S0027 00037000
         LA    @01,0(@15,@14)                                   01S0027 00038000
         AL    @01,@CF00196                                     01S0027 00039000
         AH    DSPIDPTR,DOFFSET-DSPIDTAB(,@01)                  01S0027 00040000
*DSPTXTLN = DTOTLNTH(DISPID) - DFLGLNTH(DISPID); /*LENGTH DISP FIELD */ 00041000
         LA    @01,0(@15,@14)                                   01S0028 00042000
         AL    @01,@CF00197                                     01S0028 00043000
         LH    DSPTXTLN,DTOTLNTH-DSPIDTAB-2(,@01)               01S0028 00044000
         AL    @14,@CF00198                                     01S0028 00045000
         SH    DSPTXTLN,DFLGLNTH-DSPIDTAB-4(@15,@14)            01S0028 00046000
*/********************************************************************/ 00047000
*/*                                                                  */ 00048000
*/* SEGMENT NAME - SETMFLGS                                          */ 00049000
*/*                                                                  */ 00050000
*/* DESCRIPTIVE NAME - SET MESSAGE FLAGS                             */ 00051000
*/*                                                                  */ 00052000
*/* FUNCTION -                                                       */ 00053000
*/*   THIS ROUTINE SETS UP THE MCS FLAGS, AND THE ROUTING AND        */ 00054000
*/*   DESCRIPTOR CODES FOR THE DISPOSITION MESSAGE TO BE ISSUED.     */ 00055000
*/*   INDICATORS IN THE INPUT MSGFLGS FIELD ARE USED TO DETERMINE    */ 00056000
*/*   THE SETTINGS OF THE MESSAGE FLAGS. THIS DATA IS USED AS THE    */ 00057000
*/*   INTERFACE TO THE SYSTEM MESSAGE INTERFACE ROUTINE, IEFAB4FD.   */ 00058000
*/*                                                                  */ 00059000
*/* ENTRY - IN-LINE SEGMENT                                          */ 00060000
*/*   PURPOSE - SEE FUNCTION                                         */ 00061000
*/*   INPUT -                                                        */ 00062000
*/*     MSGFLGS -                                                    */ 00063000
*/*       BIT 0 - MESSAGE GOES TO SYSTEM OUTPUT DATA SET             */ 00064000
*/*       BIT 1 - MONITOR STATUS IS ACTIVE                           */ 00065000
*/*       BIT 2 - MESSAGE GOES TO SYSTEM OPERATOR (IMPLIES TAPE OR   */ 00066000
*/*               DIRECT ACCESS POOL ALSO)                           */ 00067000
*/*                                                                  */ 00068000
*/* EXITS -                                                          */ 00069000
*/*   CONDITION - FLAGS SET                                          */ 00070000
*/*     OUTPUT -                                                     */ 00071000
*/*       FDCNMAP - FUNCTION MAP FOR IEFAB4FD                        */ 00072000
*/*         MSGTYPE FIELD IS PRESENT (IF MN STATUS IS ACTIVE)        */ 00073000
*/*         ROUTING/DESCRIPTOR CODES FIELD PRESENT (ALWAYS SET)      */ 00074000
*/*         LMSGFLGS - THE FOLLOWING INDICATORS MAY BE SET           */ 00075000
*/*           ROUTING CODES -                                        */ 00076000
*/*             11 - PROGRAMMER INFORMATION                          */ 00077000
*/*             2  - MASTER CONSOLE                                  */ 00078000
*/*             3  - TAPE POOL                                       */ 00079000
*/*             4  - DIRECT ACCESS POOL                              */ 00080000
*/*           DESCRIPTOR CODES -                                     */ 00081000
*/*             4  - SYSTEM STATUS MESSAGE                           */ 00082000
*/*         MESSAGE TYPE FLAG                                        */ 00083000
*/*           2 - MONITOR STATUS                                     */ 00084000
*/*     RETURN CODES - NONE                                          */ 00085000
*/********************************************************************/ 00086000
*FDFCNMAP = ZERO;                      /*INIT FUNCTION MAP FOR 'FD'  */ 00087000
         MVI   FDFCNMAP,X'00'                                   02S0029 00088000
*LMSGFLGS = LMSGFLGS && LMSGFLGS;      /*CLEAR LOCAL MSG FLAGS       */ 00089000
         XC    LMSGFLGS(6),LMSGFLGS                             02S0030 00090000
*RDCODES = ON;                         /*ROUTE/DESC CODES PRESENT    */ 00091000
         OI    RDCODES,B'10000000'                              02S0031 00092000
*IF MSGMSTAT = YES THEN                /*MONITOR STATUS ACTIVE       */ 00093000
         TM    MSGMSTAT(@10),B'01000000'                        02S0032 00094000
         BNO   @RF00032                                         02S0032 00095000
*  DO;                                                          02S0033 00096000
*    MSGTYFLG = ON;                    /*MSGTYPE FIELD EXISTS        */ 00097000
         OI    MSGTYFLG,B'01000000'                             02S0034 00098000
*    LMSGTYPB = ON;                    /*SET LCL MSGTYPE FIELD       */ 00099000
         OI    LMSGTYPB,B'01000000'                             02S0035 00100000
*  END;                                                         02S0036 00101000
*LMSGDESC = DSPDESC;                   /*DISP TAB CODES TO LCL AREA  */ 00102000
@RF00032 LR    @10,DSPIDPTR                                     02S0037 00103000
         ALR   @10,DSPTXTLN                                     02S0037 00104000
         MVC   LMSGDESC(2),DSPDESC(@10)                         02S0037 00105000
*LMSGRTC = DSPRTCDE;                   /*ROUTE CODES TO LOCAL AREA   */ 00106000
         MVC   LMSGRTC(2),DSPRTCDE(@10)                         02S0038 00107000
*IF MSGTPGMR = NO THEN                 /*MESSAGE NOT GOING TO PROG'MR*/ 00108000
         L     @10,@PC00001                                     02S0039 00109000
         TM    MSGTPGMR(@10),B'10000000'                        02S0039 00110000
         BNZ   @RF00039                                         02S0039 00111000
*  LMSGRTCK = OFF;                     /*RESET WTP INDICATOR         */ 00112000
         NI    LMSGRTCK,B'11011111'                             02S0040 00113000
*IF MSGTOPER = ON THEN                 /*MSG GOES TO SYST. OPERATOR  */ 00114000
@RF00039 L     @10,@PC00001                                     02S0041 00115000
         TM    MSGTOPER(@10),B'00100000'                        02S0041 00116000
         BNO   @RF00041                                         02S0041 00117000
*  DO;                                                          02S0042 00118000
*    LMSGRTCB = ON;                    /*MSG TO MASTER CONSOLE       */ 00119000
         OI    LMSGRTCB,B'01000000'                             02S0043 00120000
*    LMSGDSCD = ON;                    /*SYSTEM STATUS INDICATOR     */ 00121000
         OI    LMSGDSCD,B'00010000'                             02S0044 00122000
*    IF MSGTPEDS = YES THEN            /*TAPE DATA SET               */ 00123000
         TM    MSGTPEDS(@10),B'00000100'                        02S0045 00124000
         BNO   @RF00045                                         02S0045 00125000
*      LMSGRTCC = ON;                  /*ROUTE MSG TO TAPE POOL      */ 00126000
         OI    LMSGRTCC,B'00100000'                             02S0046 00127000
*    ELSE                                                       02S0047 00128000
*      LMSGRTCD = ON;                  /*ROUTE MSG TO D.A. POOL      */ 00129000
         B     @RC00045                                         02S0047 00130000
@RF00045 OI    LMSGRTCD,B'00010000'                             02S0047 00131000
*  END;                                                         02S0048 00132000
@RC00045 DS    0H                                               02S0049 00133000
*MSGLNTH = LINE1LEN + DSPTXTLN;        /*SET LENGTH OF LINE 1        */ 00134000
@RF00041 LA    @10,55                                           01S0049 00135000
         ALR   @10,DSPTXTLN                                     01S0049 00136000
         ST    @10,MSGLNTH                                      01S0049 00137000
*MSGIDENT = MSGIDTAB(MSGID);           /*MESSAGE ID TO TEXT BUFFER   */ 00138000
         MVI   MSGIDENT+8,C' '                                  01S0050 00139000
         MVI   MSGIDENT+9,C' '                                  01S0050 00140000
         L     @10,@PC00001                                     01S0050 00141000
         SLR   @15,@15                                          01S0050 00142000
         IC    @15,MSGID(,@10)                                  01S0050 00143000
         SLA   @15,3                                            01S0050 00144000
         L     @10,@CA00140                                     01S0050 00145000
         ALR   @10,@15                                          01S0050 00146000
         AL    @10,@CF00204                                     01S0050 00147000
         MVC   MSGIDENT(8),MSGIDTAB-MSGIDTAB(@10)               01S0050 00148000
*MSGDSNM  = DSNAME;                    /*DATA SET NAME TO BUFFER     */ 00149000
         L     @10,@PC00001+8                                   01S0051 00150000
         L     @10,DSNPTR(,@10)                                 01S0051 00151000
         MVC   MSGDSNM(44),DSNAME(@10)                          01S0051 00152000
*MSGDISP = DSPTXT(1:DSPTXTLN);         /*DATA SET DISPOSITION TO BUFF*/ 00153000
         MVI   MSGDISP+1,C' '                                   01S0052 00154000
         MVC   MSGDISP+2(11),MSGDISP+1                          01S0052 00155000
         LR    @10,DSPTXTLN                                     01S0052 00156000
         BCTR  @10,0                                            01S0052 00157000
         EX    @10,@SM00205                                     01S0052 00158000
*IF ERRCODE ^= ZERO THEN               /*DISP PROCESSING ERROR       */ 00159000
         L     @10,@PC00001+12                                  01S0053 00160000
         L     @10,ERRCODE(,@10)                                01S0053 00161000
         LTR   @10,@10                                          01S0053 00162000
         BZ    @RF00053                                         01S0053 00163000
*  MSGERCDE = ERCDETAB(ERRCODE);       /*EBCDIC ERROR CODE TO BUFFER */ 00164000
         LA    @01,ERCDETAB-1(@10)                              01S0054 00165000
         MVC   MSGERCDE(1),0(@01)                               01S0054 00166000
*CALL WRITEMSG;                        /*COMPLETE PARM LIST & CALL      00167000
*                                        SYST. MSG INTERFACE RTN     */ 00168000
@RF00053 BAL   @14,WRITEMSG                                     01S0055 00169000
*MSGL2TXT(1:VTXTLNTH) = VLINETXT(1:VTXTLNTH);  /*FIXED TEXT TO BUFFER*/ 00170000
         L     @10,@CA00141                                     01S0056 00171000
         LH    @05,VTXTLNTH-VLINENT(,@10)                       01S0056 00172000
         BCTR  @05,0                                            01S0056 00173000
         EX    @05,@SM00207                                     01S0056 00174000
*ENTCTR = ONE;                         /*INIT VOL LIST ENTRY COUNTER */ 00175000
         LA    ENTCTR,1                                         01S0057 00176000
*DO WHILE (MSGNOVOL = NO &             /*BUILD VOLSERS LINE(S) OF MSG*/ 00177000
*   ENTCTR <= VLENTNO);                                         01S0058 00178000
         B     @DE00058                                         01S0058 00179000
@DL00058 DS    0H                                               01S0059 00180000
*  MSGTXT(VTXTLNTH+1:LENGTH(MSGTXT)) = BLANKS;/*CLEAR FROM FIXED        00181000
*                                        TEXT TO END                 */ 00182000
         L     @10,@CA00141                                     01S0059 00183000
         LH    @10,VTXTLNTH-VLINENT(,@10)                       01S0059 00184000
         LA    @03,MSGTXT(@10)                                  01S0059 00185000
         LCR   @10,@10                                          01S0059 00186000
         AH    @10,@CH00195                                     01S0059 00187000
         EX    @10,@SM00209                                     01S0059 00188000
*  BUFFCTR = ONE;                      /*INIT CNTR OF SERS IN LINE   */ 00189000
         LA    BUFFCTR,1                                        01S0060 00190000
*  MSGSERP = ADDR(MSGL2SER);           /*INIT PTR TO SERS IN LINE    */ 00191000
         LA    MSGSERP,MSGL2SER                                 01S0061 00192000
*  DO VOLCTR = ENTCTR TO VLENTNO                                01S0062 00193000
*     WHILE(BUFFCTR ^> FIVE);          /*BUILD ONE VOLSERS LINE      */ 00194000
         LR    VOLCTR,ENTCTR                                    01S0062 00195000
         B     @DE00062                                         01S0062 00196000
@DL00062 CH    BUFFCTR,@CH00150                                 01S0062 00197000
         BH    @DC00062                                         01S0062 00198000
*    IF MSGFLGS(4:5) = NOCDECHK |         /*RETURN CODE CHECK NOT NEEDE 00199000
**/     (PR0CODES = YES &                 /*USE ENTRIES WITH ZERO CODES 00200000
**/      VLRTNCDE(VOLCTR) = ZERO) |       /*CURRENT CODE IS ZERO        00201000
**/     (PRERCDES = YES &                 /*USE ENTRIES WITH ERROR CODE 00202000
**/      VLRTNCDE(VOLCTR) ^= ZERO) THEN/*                       01S0063 00203000
*                                        USE CURRENT VOL LIST ENTRY  */ 00204000
         L     @10,@PC00001                                     01S0063 00205000
         TM    MSGFLGS(@10),B'00011000'                         01S0063 00206000
         BZ    @RT00063                                         01S0063 00207000
         TM    PR0CODES(@10),B'00010000'                        01S0063 00208000
         BNO   @GL00001                                         01S0063 00209000
         LR    @10,VOLCTR                                       01S0063 00210000
         MH    @10,@CH00105                                     01S0063 00211000
         L     @15,@PC00001+4                                   01S0063 00212000
         L     @01,VLSTPTR(,@15)                                01S0063 00213000
         SLR   @00,@00                                          01S0063 00214000
         IC    @00,VLRTNCDE-12(@10,@01)                         01S0063 00215000
         CH    @00,@CH00110                                     01S0063 00216000
         BE    @RT00063                                         01S0063 00217000
@GL00001 L     @10,@PC00001                                     01S0063 00218000
         TM    PRERCDES(@10),B'00001000'                        01S0063 00219000
         BNO   @RF00063                                         01S0063 00220000
         LR    @10,VOLCTR                                       01S0063 00221000
         MH    @10,@CH00105                                     01S0063 00222000
         L     @15,@PC00001+4                                   01S0063 00223000
         L     @01,VLSTPTR(,@15)                                01S0063 00224000
         SLR   @00,@00                                          01S0063 00225000
         IC    @00,VLRTNCDE-12(@10,@01)                         01S0063 00226000
         CH    @00,@CH00110                                     01S0063 00227000
         BE    @RF00063                                         01S0063 00228000
@RT00063 DS    0H                                               01S0064 00229000
*      DO;                                                      01S0064 00230000
*        MSGVLSER = VLSERNO(VOLCTR);   /*VOLSER TO TEXT BUFFR        */ 00231000
         LR    @10,VOLCTR                                       01S0065 00232000
         MH    @10,@CH00105                                     01S0065 00233000
         L     @15,@PC00001+4                                   01S0065 00234000
         L     @15,VLSTPTR(,@15)                                01S0065 00235000
         ST    @10,@TF00001                                     01S0065 00236000
         ALR   @10,@15                                          01S0065 00237000
         AL    @10,@CF00196                                     01S0065 00238000
         MVC   MSGVLSER(6,MSGSERP),VLSERNO-6(@10)               01S0065 00239000
*        IF PRERCDES = YES THEN        /*PRINT ENTRIES WITH ERR CODE */ 00240000
         L     @10,@PC00001                                     01S0066 00241000
         TM    PRERCDES(@10),B'00001000'                        01S0066 00242000
         BNO   @RF00066                                         01S0066 00243000
*          DO;                                                  01S0067 00244000
*            MSGVLCDE =                /*EBCDIC ERROR CODE TO BUFFER */ 00245000
*               ERCDETAB(VLRTNCDE(VOLCTR));                     01S0068 00246000
         LA    @10,MSGDLIM(,MSGSERP)                            01S0068 00247000
         L     @14,@TF00001                                     01S0068 00248000
         SLR   @01,@01                                          01S0068 00249000
         IC    @01,VLRTNCDE-12(@14,@15)                         01S0068 00250000
         LA    @15,ERCDETAB-1(@01)                              01S0068 00251000
         MVC   MSGVLCDE(1,@10),0(@15)                           01S0068 00252000
*            MSGDLIM2 = COMMA;         /*DELIMITER TO BUFFER         */ 00253000
         MVI   MSGDLIM2(@10),C','                               01S0069 00254000
*            MSGSERP = MSGSERP + ERRSERLN;/*POINT TO NEXT SLOT IN       00255000
*                                        BUFFER                      */ 00256000
         SLR   @10,@10                                          01S0070 00257000
         IC    @10,ERRSERLN                                     01S0070 00258000
         ALR   MSGSERP,@10                                      01S0070 00259000
*          END;                                                 01S0071 00260000
*        ELSE                                                   01S0072 00261000
*          DO;                                                  01S0072 00262000
         B     @RC00066                                         01S0072 00263000
@RF00066 DS    0H                                               01S0073 00264000
*            MSGDLIM1 = COMMA;         /*DELIMITER AFTER SER IN BUFF */ 00265000
         LA    @10,MSGDLIM(,MSGSERP)                            01S0073 00266000
         MVI   MSGDLIM1(@10),C','                               01S0073 00267000
*            MSGSERP = MSGSERP + SERENTLN; /*POINT TO NEXT SLOT IN      00268000
*                                        BUFFER                      */ 00269000
         SLR   @10,@10                                          01S0074 00270000
         IC    @10,SERENTLN                                     01S0074 00271000
         ALR   MSGSERP,@10                                      01S0074 00272000
*          END;                                                 01S0075 00273000
*        BUFFCTR = BUFFCTR + ONE;      /*INCR. BUFFER COUNTER        */ 00274000
@RC00066 AH    BUFFCTR,@CH00049                                 01S0076 00275000
*      END;                                                     01S0077 00276000
*  END;                                                         01S0078 00277000
@RF00063 AH    VOLCTR,@CH00049                                  01S0078 00278000
@DE00062 L     @10,@PC00001+4                                   01S0078 00279000
         L     @10,VLSTPTR(,@10)                                01S0078 00280000
         CH    VOLCTR,VLENTNO(,@10)                             01S0078 00281000
         BNH   @DL00062                                         01S0078 00282000
@DC00062 DS    0H                                               01S0079 00283000
*  ENTCTR = VOLCTR;                    /*ADJUST CNTR FOR NEXT ENTRY  */ 00284000
         LR    ENTCTR,VOLCTR                                    01S0079 00285000
*  IF ENTCTR > VLENTNO THEN            /*AT END OF VOL LIST          */ 00286000
         L     @10,@PC00001+4                                   01S0080 00287000
         L     @10,VLSTPTR(,@10)                                01S0080 00288000
         CH    ENTCTR,VLENTNO(,@10)                             01S0080 00289000
         BNH   @RF00080                                         01S0080 00290000
*    EVAL(MSGSERP - 1) -> MSGEND = PERIOD; /*SET END OF MSG DELIMITER*/ 00291000
         LR    @10,MSGSERP                                      01S0081 00292000
         BCTR  @10,0                                            01S0081 00293000
         MVI   MSGEND(@10),C'.'                                 01S0081 00294000
*  IF PRERCDES = YES THEN                                       01S0082 00295000
@RF00080 L     @10,@PC00001                                     01S0082 00296000
         TM    PRERCDES(@10),B'00001000'                        01S0082 00297000
         BNO   @RF00082                                         01S0082 00298000
*    MSGLNTH = LNE2LEN2;               /*LENGTH INCLUDES ERROR CODES */ 00299000
         MVC   MSGLNTH(4),@CF00156                              01S0083 00300000
*  ELSE                                                         01S0084 00301000
*    MSGLNTH = LNE2LEN1;               /*LENGTH OF LINE SANS CODES   */ 00302000
         B     @RC00082                                         01S0084 00303000
@RF00082 MVC   MSGLNTH(4),@CF00154                              01S0084 00304000
*  CALL WRITEMSG;                      /*COMPLETE MSG & INVOKE SYST.    00305000
*                                        MSG INTERFACE RTN           */ 00306000
@RC00082 BAL   @14,WRITEMSG                                     01S0085 00307000
*END;                                                           01S0086 00308000
@DE00058 L     @10,@PC00001                                     01S0086 00309000
         TM    MSGNOVOL(@10),B'00000010'                        01S0086 00310000
         BNZ   @DC00058                                         01S0086 00311000
         L     @10,@PC00001+4                                   01S0086 00312000
         L     @10,VLSTPTR(,@10)                                01S0086 00313000
         CH    ENTCTR,VLENTNO(,@10)                             01S0086 00314000
         BNH   @DL00058                                         01S0086 00315000
@DC00058 DS    0H                                               01S0087 00316000
*RETURN;                               /*RETURN TO CALLER            */ 00317000
@EL00001 IC    @02,@OLDKEY                                      01S0087 00318000
         L     @13,4(,@13)                                      01S0087 00319000
@EF00001 L     @00,@SIZDATD                                     01S0087 00320000
         LR    @01,@11                                          01S0087 00321000
         FSPACE   R,LV=(0),A=(1)                                        00322000
         MODESET KEYADDR=(2)                                            00323000
@ER00001 LM    @14,@12,12(@13)                                  01S0087 00324000
         BR    @14                                              01S0087 00325000
*/********************************************************************/ 00326000
*/*                                                                  */ 00327000
*/* SEGMENT NAME - WRITEMSG                                          */ 00328000
*/*                                                                  */ 00329000
*/* DESCRIPTIVE NAME - WRITE DISPOSITION MESSAGE LINES               */ 00330000
*/*                                                                  */ 00331000
*/* FUNCTION -                                                       */ 00332000
*/*   THIS ROUTINE COMPLETES THE INTERFACE TO THE SYSTEM MESSAGE     */ 00333000
*/*   INTERFACE ROUTINE,IEFAB4FD AND INVOKES THAT ROUTINE.           */ 00334000
*/*                                                                  */ 00335000
*/* ENTRY - IN-LINE SEGMENT                                          */ 00336000
*/*   PURPOSE - SEE FUNCTION                                         */ 00337000
*/*   INPUT -                                                        */ 00338000
*/*     MSGBUFFR - MESSAGE BUFFER TO BE WRITTEN                      */ 00339000
*/*     MSGLNTH - LENGTH OF MESSAGE TEXT + MESSAGE ID                */ 00340000
*/*     LMSGFLGS - WORK COPY OF MESSAGE FLAGS/CODES                  */ 00341000
*/* EXIT -                                                           */ 00342000
*/*   CONDITION - MESSAGE ISSUED                                     */ 00343000
*/*     OUTPUT - DISPOSITION MESSAGE                                 */ 00344000
*/*                                                                  */ 00345000
*/*     RETURN CODES - NONE                                          */ 00346000
*/********************************************************************/ 00347000
*WRITEMSG:                                                      02S0088 00348000
*  PROC;                                                        02S0088 00349000
WRITEMSG STM   @14,@12,@SA00002                                 02S0088 00350000
*FLAGLNTH = DFLGLNTH(DISPID);          /*SET LENTH OF FLAGS AREA     */ 00351000
         L     @10,@PC00001                                     02S0089 00352000
         SLR   @15,@15                                          02S0089 00353000
         IC    @15,DISPID(,@10)                                 02S0089 00354000
         MH    @15,@CH00085                                     02S0089 00355000
         L     @10,@CA00131                                     02S0089 00356000
         AL    @10,@CF00198                                     02S0089 00357000
         LH    @10,DFLGLNTH-DSPIDTAB-4(@15,@10)                 02S0089 00358000
         ST    @10,FLAGLNTH                                     02S0089 00359000
*MSGFLAGS = LMSGFLGS;                  /*MOVE FLAGS TO END OF TEXT   */ 00360000
         L     @15,MSGLNTH                                      02S0090 00361000
         LA    @14,MSGBUFFR                                     02S0090 00362000
         ALR   @14,@15                                          02S0090 00363000
         MVC   MSGFLAGS(6,@14),LMSGFLGS                         02S0090 00364000
*MSGLNTH = MSGLNTH + LENGTH(LMSGDESC) + LENGTH(LMSGRTC);        02S0091 00365000
         AH    @15,@CH00124                                     02S0091 00366000
         ST    @15,MSGLNTH                                      02S0091 00367000
*IF MSGTYFLG = YES THEN                /*MSG TYPE FIELD NEEDED       */ 00368000
         TM    MSGTYFLG,B'01000000'                             02S0092 00369000
         BNO   @RF00092                                         02S0092 00370000
*  DO;                                                          02S0093 00371000
*    MSGLNTH = MSGLNTH + LENGTH(LMSGMTYP);                      02S0094 00372000
         LA    @14,2                                            02S0094 00373000
         ALR   @15,@14                                          02S0094 00374000
         ST    @15,MSGLNTH                                      02S0094 00375000
*    FLAGLNTH = FLAGLNTH + LENGTH(LMSGMTYP);                    02S0095 00376000
         ALR   @10,@14                                          02S0095 00377000
         ST    @10,FLAGLNTH                                     02S0095 00378000
*  END;                                                         02S0096 00379000
*CALL IEFAB4FD                         /*SYSTEM MESSAGE INTERFACE RTN*/ 00380000
*    (FDFCNMAP,ADDR(MSGBUFFR),MSGLNTH,FLAGLNTH,JSCBPTR);        02S0097 00381000
@RF00092 LA    @10,FDFCNMAP                                     02S0097 00382000
         ST    @10,@AL00001                                     02S0097 00383000
         LA    @10,MSGBUFFR                                     02S0097 00384000
         ST    @10,@TF00001                                     02S0097 00385000
         LA    @10,@TF00001                                     02S0097 00386000
         ST    @10,@AL00001+4                                   02S0097 00387000
         LA    @10,MSGLNTH                                      02S0097 00388000
         ST    @10,@AL00001+8                                   02S0097 00389000
         LA    @10,FLAGLNTH                                     02S0097 00390000
         ST    @10,@AL00001+12                                  02S0097 00391000
         L     @10,@PC00001+16                                  02S0097 00392000
         ST    @10,@AL00001+16                                  02S0097 00393000
         L     @15,@CV00130                                     02S0097 00394000
         LA    @01,@AL00001                                     02S0097 00395000
         BALR  @14,@15                                          02S0097 00396000
*RETURN;                               /*RETURN TO CALLER            */ 00397000
@EL00002 DS    0H                                               02S0098 00398000
@EF00002 DS    0H                                               02S0098 00399000
@ER00002 LM    @14,@12,@SA00002                                 02S0098 00400000
         BR    @14                                              02S0098 00401000
*END WRITEMSG;                                                  02S0099 00402000
*END IEFAB4B0                                                   01S0100 00403000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 00404000
*/*%INCLUDE SYSLIB  (A4B0SPEC)                                        * 00405000
*/*%INCLUDE SYSLIB  (A4B0DATA)                                        * 00406000
*/*%INCLUDE SYSLIB  (SETMFLGS)                                        * 00407000
*/*%INCLUDE SYSLIB  (MFLGSPEC)                                        * 00408000
*/*%INCLUDE SYSLIB  (WRITEMSG)                                        * 00409000
*/*%INCLUDE SYSLIB  (WMSGSPEC)                                        * 00410000
*;                                                              01S0100 00411000
@DATA    DS    0H                                                       00412000
@CH00110 DC    H'0'                                                     00413000
@CH00049 DC    H'1'                                                     00414000
@CH00124 DC    H'4'                                                     00415000
@CH00150 DC    H'5'                                                     00416000
@CH00085 DC    H'6'                                                     00417000
@CH00105 DC    H'12'                                                    00418000
@CH00195 DC    H'63'                                                    00419000
@SM00205 MVC   MSGDISP(0),DSPTXT(DSPIDPTR)                              00420000
@SM00207 MVC   MSGL2TXT(0),VLINETXT-VLINENT(@10)                        00421000
@SM00209 MVC   0(0,@03),BLANKS                                          00422000
@DATD    DSECT                                                          00423000
         DS    0F                                                       00424000
@SA00001 DS    18F                                                      00425000
@PC00001 DS    5F                                                       00426000
@SA00002 DS    0F                                                       00427000
         DS    15F                                                      00428000
@AL00001 DS    5A                                                       00429000
@TF00001 DS    F                                                        00430000
IEFAB4B0 CSECT                                                          00431000
         DS    0F                                                       00432000
@CF00154 DC    F'58'                                                    00433000
@CF00156 DC    F'68'                                                    00434000
@CF00204 DC    F'-8'                                                    00435000
@CF00196 DC    F'-6'                                                    00436000
@CF00197 DC    F'-4'                                                    00437000
@CF00198 DC    F'-2'                                                    00438000
@DATD    DSECT                                                          00439000
         DS    0D                                                       00440000
FLAGLNTH DS    F                                                        00441000
MSGLNTH  DS    F                                                        00442000
FDFCNMAP DS    BL1                                                      00443000
         ORG   FDFCNMAP                                                 00444000
RDCODES  DS    BL1                                                      00445000
MSGTYFLG EQU   FDFCNMAP+0                                               00446000
         ORG   FDFCNMAP+1                                               00447000
LMSGFLGS DS    CL6                                                      00448000
         ORG   LMSGFLGS                                                 00449000
LMSGDESC DS    CL2                                                      00450000
         ORG   LMSGDESC                                                 00451000
@NM00002 DS    BL1                                                      00452000
LMSGDSCD EQU   LMSGDESC+0                                               00453000
         ORG   LMSGFLGS+2                                               00454000
LMSGRTC  DS    CL2                                                      00455000
         ORG   LMSGRTC                                                  00456000
@NM00003 DS    BL1                                                      00457000
LMSGRTCB EQU   LMSGRTC+0                                                00458000
LMSGRTCC EQU   LMSGRTC+0                                                00459000
LMSGRTCD EQU   LMSGRTC+0                                                00460000
@NM00004 EQU   LMSGRTC+0                                                00461000
LMSGRTCK EQU   LMSGRTC+1                                                00462000
         ORG   LMSGFLGS+4                                               00463000
LMSGMTYP DS    CL2                                                      00464000
         ORG   LMSGMTYP                                                 00465000
@NM00005 DS    BL1                                                      00466000
LMSGTYPB EQU   LMSGMTYP+0                                               00467000
         ORG   LMSGFLGS+6                                               00468000
         DS    CL1                                                      00469000
MSGBUFFR DS    CL74                                                     00470000
         ORG   MSGBUFFR                                                 00471000
MSGIDENT DS    CL10                                                     00472000
MSGTXT   DS    CL64                                                     00473000
         ORG   MSGBUFFR+74                                              00474000
PRLINESW DS    BL1                                                      00475000
@OLDKEY  DS    AL1                                                      00476000
IEFAB4B0 CSECT                                                          00477000
         DS    0F                                                       00478000
@SIZDATD DC    AL1(230)                                                 00479000
         DC    AL3(@ENDDATD-@DATD)                                      00480000
@CA00129 DC    A(DSPTAB)                                                00481000
@CV00130 DC    V(IEFAB4FD)                                              00482000
@CA00131 DC    A(DSPIDTAB)                                              00483000
@CA00140 DC    A(MSGIDTAB)                                              00484000
@CA00141 DC    A(VLINENT)                                               00485000
         DS    0D                                                       00486000
ERRSERLN DC    AL1(6+3)                                                 00487000
SERENTLN DC    AL1(6+1)                                                 00488000
BLANKS   DC    CL74' '                                                  00489000
ERCDETAB DC    CL1'1'                                                   00490000
         DC    CL1'2'                                                   00491000
         DC    CL1'3'                                                   00492000
         DC    CL1'4'                                                   00493000
         DC    CL1'5'                                                   00494000
         DC    CL1'6'                                                   00495000
         DC    CL1'7'                                                   00496000
         DC    CL1'8'                                                   00497000
         DC    CL1'9'                                                   00498000
         DC    CL1'A'                                                   00499000
         DC    CL1'B'                                                   00500000
         DC    CL1'C'                                                   00501000
         DC    CL1'D'                                                   00502000
         DC    CL1'E'                                                   00503000
         DC    CL1'F'                                                   00504000
IEFAB4B0 CSECT                                                          00505000
         DS   0H                                                        00506000
A4B0PTCH DC (50)X'00'                                                   00507000
@DATD    DSECT                                                          00508000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00509000
@ENDDATD EQU   *                                                        00510000
IEFAB4B0 CSECT                                                          00511000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00512000
@01      EQU   01                                                       00513000
@02      EQU   02                                                       00514000
@03      EQU   03                                                       00515000
@04      EQU   04                                                       00516000
@05      EQU   05                                                       00517000
@06      EQU   06                                                       00518000
@07      EQU   07                                                       00519000
@08      EQU   08                                                       00520000
@09      EQU   09                                                       00521000
@10      EQU   10                                                       00522000
@11      EQU   11                                                       00523000
@12      EQU   12                                                       00524000
@13      EQU   13                                                       00525000
@14      EQU   14                                                       00526000
@15      EQU   15                                                       00527000
VOLCTR   EQU   @03                                                      00528000
ENTCTR   EQU   @04                                                      00529000
DSPTXTLN EQU   @02                                                      00530000
BUFFCTR  EQU   @05                                                      00531000
MSGSERP  EQU   @02                                                      00532000
DSPIDPTR EQU   @03                                                      00533000
         EXTRN DSPTAB                                                   00534000
         EXTRN DSPIDTAB                                                 00535000
         EXTRN MSGIDTAB                                                 00536000
         EXTRN VLINENT                                                  00537000
DSNAME   EQU   0                                                        00538000
MSGFLAGS EQU   0                                                        00539000
MSGSERS  EQU   0                                                        00540000
MSGVLSER EQU   MSGSERS                                                  00541000
MSGEND   EQU   MSGVLSER                                                 00542000
MSGDLIM  EQU   MSGSERS+6                                                00543000
MSGDLIM1 EQU   0                                                        00544000
ERSEREND EQU   0                                                        00545000
MSGVLCDE EQU   ERSEREND+1                                               00546000
MSGDLIM2 EQU   ERSEREND+2                                               00547000
VOLLIST  EQU   0                                                        00548000
VLENTNO  EQU   VOLLIST                                                  00549000
VLSTENT  EQU   VOLLIST+2                                                00550000
VLSERNO  EQU   VLSTENT+4                                                00551000
@NM00009 EQU   VLSTENT+10                                               00552000
VLRTNCDE EQU   @NM00009+1                                               00553000
DSPIDENT EQU   0                                                        00554000
DSPTXT   EQU   DSPIDENT                                                 00555000
DSPFLGS  EQU   0                                                        00556000
DSPDESC  EQU   DSPFLGS                                                  00557000
DSPRTCDE EQU   DSPFLGS+2                                                00558000
DOFFSET  EQU   DSPIDTAB                                                 00559000
DTOTLNTH EQU   DSPIDTAB+2                                               00560000
DFLGLNTH EQU   DSPIDTAB+4                                               00561000
VTXTLNTH EQU   VLINENT                                                  00562000
VLINETXT EQU   VLINENT+2                                                00563000
MSGDATA  EQU   0                                                        00564000
MSGID    EQU   MSGDATA                                                  00565000
MSGFLGS  EQU   MSGDATA+1                                                00566000
MSGTPGMR EQU   MSGFLGS                                                  00567000
MSGMSTAT EQU   MSGFLGS                                                  00568000
MSGTOPER EQU   MSGFLGS                                                  00569000
PR0CODES EQU   MSGFLGS                                                  00570000
PRERCDES EQU   MSGFLGS                                                  00571000
MSGTPEDS EQU   MSGFLGS                                                  00572000
MSGNOVOL EQU   MSGFLGS                                                  00573000
DISPID   EQU   MSGDATA+2                                                00574000
VLSTPTR  EQU   0                                                        00575000
DSNPTR   EQU   0                                                        00576000
ERRCODE  EQU   0                                                        00577000
JSCBPTR  EQU   0                                                        00578000
MSGLINE1 EQU   MSGTXT                                                   00579000
MSGDSNM  EQU   MSGLINE1                                                 00580000
MSGDISP  EQU   MSGLINE1+45                                              00581000
MSGERCDE EQU   MSGDISP+12                                               00582000
MSGLINE2 EQU   MSGTXT                                                   00583000
MSGL2TXT EQU   MSGLINE2                                                 00584000
MSGL2SER EQU   MSGLINE2+13                                              00585000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00586000
@NM00007 EQU   MSGDISP                                                  00587000
@NM00006 EQU   MSGLINE1+44                                              00588000
@NM00001 EQU   MSGFLGS                                                  00589000
@NM00010 EQU   @NM00009                                                 00590000
VLDEV    EQU   VLSTENT                                                  00591000
@NM00008 EQU   ERSEREND                                                 00592000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00593000
@PB00002 EQU   @EL00001                                                 00594000
@ENDDATA EQU   *                                                        00595000
         END   IEFAB4B0                                                 00596000
