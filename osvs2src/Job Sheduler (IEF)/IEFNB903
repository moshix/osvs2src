*****************************************************************Y02668 00201002
*                                                                       00202002
*                                                                       00203002
*  MODULE NAME - IEFNB903                                               00204002
*                                                                       00205002
*                                                                       00206002
*  DESCRIPTIVE NAME - INTERPRETER INITIALIZATION ROUTINE                00207002
*                                                                       00208002
*                                                                       00209002
*  COPYRIGHT - N/A                                                      00210002
*                                                                       00211002
*                                                                       00212002
*  STATUS - VS2 SU16 -IN THIS MODULE, SU 16 SUPPORTS           @G16AP2F 00213003
*           VPSS SUPPORT (SU 29 - @G29AN2F).                   @G16AP2F 00213303
*           MERGE SU4,10,16 CODE TO REL 037 PTF                @ZA27750 00213603
*                                                                       00214002
*                                                                       00215002
*  FUNCTION - THIS ROUTINE GETS AND PARTIALLY INITIALIZES INTERPRETER   00216002
*             WORK AREAS AND CONTROL BLOCKS.                            00217002
*                                                                       00218002
*     OPERATION - . SAVES CALLER'S REGISTERS AND BEGINS INITIALIZATION  00219002
*                 . CORE IS GOTTEN AND INITIALIZED FOR THE INTERPRETER  00220002
*                   WORK AREA(IWA), I/O BUFFER, JMR, LOCAL WORK AREA    00221002
*                   (MAPPED BY EWA,DWA,JWA), DSENQ TABLE, AND SYSOUT    00222002
*                   MESSAGE BUFFER.   REG12 IS SET TO POINT TO THE      00223002
*                   IWA FOR THE LIFE OF THE INTERPRETER.                00224002
*                 . A REG SAVE AREA IS GOTTEN, CHAINED AND THE          00225002
*                   POINTER TO IT SAVED IN THE IWA.                     00226002
*                 . A PTR TO THE INTERPRETER TERMINATION RTN IS         00227002
*                   SAVED IN THE IWA.                                   00228002
*                 . THE QMPA PASSED BY THE CALLER IS MOVED INTO THE     00229002
*                   IWA.                                                00230002
*                 . IF USING SMF THE JMR IS MOVED FROM THE CALLER'S     00231002
*                   CORE.                                               00232002
*                 . THE UNIQUE DSN FIELD (FOR TEMP DATA SET NAMES) IS   00233002
*                   INITIALIZED IN THE IWA.                             00234002
*                 . SCONS FOR THE KEYWORD SERVICE RTNS ARE CALCULATED   00235002
*                   AND SAVED IN THE IWA.                               00236002
*                 . AN ESTAE ENVIRONMENT IS ESTABLISHED FOR THE         00237002
*                   INTERPRETER.                                        00238002
*                 . SWA SUPPORT - THE NEL EXIT LIST IS SCANNED @G29AN2F 00239003
*                   FOR AN ALTERNATE SWA MANAGER MOVE MODE AND @G29AN2F 00239803
*                   LOCATE MODE ENTRY POINTS.                  @G29AN2F 00240603
*                   AN ALTERNATE ENTRY FOR THE MOVE MODE       @G29AN2F 00241403
*                   POINTS TO THE JOURNAL MERGE INTERFACE ROUTINE.      00243002
*                   IF THE ENTRY DOES NOT EXIST NO JOURNAL              00244002
*                   MERGE CAN TAKE PLACE.   IF THE ENTRY IS FOUND       00245002
*                   THE JOURNAL MERGE RTN IS LOADED AND ITS ADDR        00246002
*                   SAVED IN THE IWA.   IEFVHQ TESTS THIS ADDR FIELD    00247002
*                   AND IF INITIALIZED, EXITS TO IT INSTEAD OF GOING    00248002
*                   DIRECTLY TO THE SWA MANAGER.   THE JOURNAL MERGE    00249002
*                   RTN IS DELETED BY IEFVHN AT TERMINATION.            00250002
*                   AN ALTERNATE ENTRY FOR THE LOCATE MODE     @G29AN2F 00250103
*                   CAUSES THE ROUTINE TO BE LOADED AND ITS    @G29AN2F 00250203
*                   ADDR SAVED IN THE COMWA. IEFVHQ TESTS THIS @G29AN2F 00250303
*                   ADDR FIELD AND IF INITIALIZED, EXITS TO IT @G29AN2F 00250403
*                   INSTEAD OF GOING DIRECTLY TO THE SWA MNGR  @G29AN2F 00250503
*                   FOR LOCATE MODE. THE ALTERNATE SWA MANAGER @G29AN2F 00250603
*                   LOCATE MODE IS DELETED BY IEFVHN AT TERMIN-@G29AN2F 00250703
*                   ATION.                                     @G29AN2F 00250803
*                                                                       00251002
*                                                                       00252002
*  NOTES -                                                              00253002
*                                                                       00254002
*     DEPENDENCIES - NONE                                               00255002
*     CHARACTER-CODE DEPENDENCIES - EBCDIC                              00256002
*     RESTRICTIONS - NONE                                               00257002
*     REGISTER CONVENTIONS - REG 11 - MODULE BASE                       00258002
*                            REG 12 - IWA PTR                           00259002
*                            REG 13 - REG SAVE AREA PTR                 00260002
*     PATCH-LABEL - PATCH                                               00261002
*                                                                       00262002
*                                                                       00263002
*  MODULE TYPE - PLS                                                    00264002
*     PROCESSOR - PLSII COMPILER                                        00265002
*     ATTRIBUTES - REFRESHABLE, PRIVILEGED, REENTRANT, KEY 0,           00266002
*                  PAGEABLE LPA                                         00267002
*                                                                       00268002
*                                                                       00269002
*  ENTRY POINT - IEFNB903 FROM IEFIB600 (SWA CREATE)                    00270002
*     PURPOSE - TO HAVE INTERPRETER CREATE JOB CONTROL BLOCKS IN        00271002
*               SWA.                                                    00272002
*     LINKAGE - LINK                                                    00273002
*     INPUT - R1 - PTR TO NEL, R13 - PTR TO REG SAVE AREA               00274002
*     REGISTERS SAVED - REG14-REG12                                     00275002
*     REGISTER USAGE -                                                  00276002
*                     R0  - WORK REG                                    00277002
*                     R1  - WORK REG                                    00278002
*                     R2  - WORK REG( ADDRESSES SEVERAL CONTROL         00279002
*                           BLOCKS AT DIFFERENT TIMES)                  00280002
*                     R3  - POINTS TO NEL                               00281002
*                     R4  - WORK REG                                    00282002
*                     R5  - WORK REG                                    00283002
*                     R6  - UNUSED                                      00284002
*                     R7  - UNUSED                                      00285002
*                     R8  - UNUSED                                      00286002
*                     R9  - UNUSED                                      00287002
*                     R10 - LINKAGE REG                                 00288002
*                     R11 - MODULE BASE                                 00289002
*                     R12 - PTR TO IWA                                  00290002
*                     R13 - REG SAVE AREA PTR                           00291002
*                     R14 - LINKAGE AND WORK REG                        00292002
*                     R15 - LINKAGE AND WORK REG                        00293002
*     REGISTERS RESTORED - NONE                                         00294002
*                                                                       00295002
*                                                                       00296002
*  EXIT - NORMAL  - IEFVHE                                              00297002
*     CONDITIONS - INITIALIZATION COMPLETE AND READY TO GET             00298002
*                  FIRST TEXT STRING                                    00299002
*     OUTPUT - REG 12 - PTR TO IWA, REG 13 - PTR TO REG SAVE AREA       00300002
*     RETURN CODES - NONE                                               00301002
*                                                                       00302002
*                                                                       00303002
*  EXIT - ERROR - NONE                                                  00304002
*                                                                       00305002
*                                                                       00306002
*  EXTERNAL REFERENCES -                                                00307002
*     ROUTINES - IEFVHQ (TO ASSIGN SVA'S)                               00308002
*                IEFVHN (TO GET TERM RTN ADDR AND SAVE IN IWA)          00309002
*     DATA AREAS - IWA, LWA, QMPA                                       00310002
*     CONTROL BLOCKS - JMR, JCT, SCT                                    00311002
*     TABLES - INTERNAL KEYS (IEFVKEYS)                                 00312002
*     MACROS - LOAD, GETMAIN, FREEMAIN, IEFVMIWA, IEFVMDWA,             00313002
*              IEFVMEWA, IEFVMJWA, IEFJMR, IEFAJCTB, IEFASCTB,          00314002
*              IEFNEL, IEFQMNGR                                         00315002
*     SERIALIZATION - NONE                                              00316002
*                                                                       00317002
*                                                                       00318002
*  CHANGE ACTIVITY - Z40MPTH,Z40RPSM,@G29AN2F,ZA27750          @ZA27750 00319003
*                                                                       00320002
*                                                                       00321002
*  MESSAGES - NONE                                                      00322002
*                                                                       00323002
*                                                                       00324002
*****************************************************************Y02668 00325002
         EJECT                                                          00326002
         SPACE 5                                                        00400002
JCTD     DSECT                                                          00600002
         IEFAJCTB                                                       00800002
         EJECT                                                          00900002
JCTXD    DSECT                                                 @Z40RPSM 00907003
         IEFJCTX                                               @Z40RPSM 00914003
         EJECT                                                          00921003
         IEFCOMWA                                                       00930002
         IEFVMIWA                                                       00960002
         SPACE 5                                                        01000002
NEL      DSECT                                                          01200002
         IEFNEL  SUBCOM=I,EXITS=(QEP,SMF,RTN)                           01400002
         SPACE 5                                                        01600002
         IFGRPL                                                         01800002
         SPACE 5                                                        02000002
SCTD     DSECT                                                          02200002
         IEFASCTB                                                       02400002
         SPACE 5                                                        02600002
         IEFVMEWA NA                                           @Z40MPTH 02800003
         SPACE 5                                                        03000002
         IEFVMJWA  NA                                                   03200002
         SPACE 5                                                        03400002
         IEFVMDWA  NA                                                   03600002
ENDWA    EQU   *                                               @Z40MPTH 03640003
         SPACE 5                                                        03680003
AWA      DSECT               ADDRESSABILITY TO AWA....         @Z40MPTH 03720003
         IEFVMAWA                                              @Z40MPTH 03760003
         SPACE 5                                                        03800002
         IEFQMNGR                                                       04000002
         SPACE 5                                                        04200002
         IEFJMR                                                         04400002
         SPACE 5                                                        04600002
         IEFZB9RD                                                       04660002
         SPACE 5                                                        04720002
         IEFVKEYS                                                       04800002
         SPACE 5                                                        05000002
         SPACE 5                                                        05400002
GENDSNAM DSECT                                                   Y02668 05600002
PREFIX   DS    CL3                                               Y02668 05800002
DATE     DS    CL5                                               Y02668 06000002
PERIOD   DS    CL1                                               Y02668 06200002
PREFIX1  DS    CL1                                               Y02668 06400002
TIME     DS    CL6                                               Y02668 06600002
PERIOD2  DS    CL1                                               Y02668 06800002
DSTYPE   DS    CL1                                               Y02668 07000002
SYSTYPE  DS    CL1                                               Y02668 07200002
FILLER   DS    CL3                                               Y02668 07400002
PERIOD3  DS    CL1                                               Y02668 07600002
         EJECT                                                          07800002
IEFNB903 CSECT                                                          08000002
         ENTRY TRACE                                                    08200002
         STM   14,12,12(13)        SAVE CALLER'S REGS            Y02668 08400002
         BALR  RB,0                MODULE BASE REG               Y02668 08600002
         USING *,RB                GET ADDRESSABILITY            Y02668 08800002
         B     NB903BGN            BYPASS DECLARED STORAGE       Y02668 09000002
         MODID BR=NO                                             Y02668 09100002
*        DC    C'SU16'            FUNCTION ID                  @G16AP2F 09200003
*        DC    C'01'              LEVEL # (SU16)               @G16AP2F 09250003
         DC    C'02'   LEV # (MERGE SU4,10,16 CODE TO 037 PTF) @ZA27750 09300003
NB903BGN DS    0H                                                Y02668 09800002
*                                                                Y02668 10000002
*  INITIALIZE INTERPRETER                                        Y02668 10200002
*                                                                Y02668 10400002
         SPACE 2                                                 Y02668 10600002
         LR    R3,R1               SAVE NEL ADDR BECAUSE R1      Y02668 10800002
         USING NEL,R3              IS CLOBBERED BY GETMAIN       Y02668 11000002
         EJECT                                                   Y02668 11200002
*****************************************************************Y02668 11400002
*                                                               *Y02668 11600002
*  GET CORE FOR WORK AREAS AND INITIALIZE                       *Y02668 11800002
*                                                               *Y02668 12000002
*****************************************************************Y02668 12200002
         SPACE 2                                                 Y02668 12400002
         IEFSAVER  ,               GET INTERPRETER SAVE AREA     Y02668 12600002
         LA    R0,WALTH            LOAD WORK AREA LENGTH.        Y02668 12700002
         BAL   RA,VHEGAC           GET CORE FOR IWA AND CLEAR IT.Y02668 13000002
         LR    RC,R1               INITIALIZE REG12 TO POINT TO  Y02668 19000002
*                                  IWA. R12  POINTS TO IWA THRU  Y02668 19200002
*                                  LIFE OF INTERPRETER           Y02668 19400002
         XC    BUFADDR(4),BUFADDR  INIT TO 0 FOR INTERP *TEMP****Y02668 19600002
         LA    R0,WALTH            LOAD WORK AREA LENGTH.        Y02668 19800002
         ST    R0,IWAL             SAVE LENGTH IN FIRST WORD     Y02668 20000002
         MVC   IWAID,ID            INITIALIZE IWA IDENTIFIER     Y02668 20200002
         ST    R3,WANELPTR         SAVE NEL PTR IN IWA           Y02668 20400002
         ST    RD,SAVEPTR          SAVE PTR TO CURRENT SAVE AREA Y02668 20600002
         MVC   IWASAVPT(WORDLEN),WORDLEN(RD)   SAVE PTR TO       Y02668 20660002
*                                  CALLER'S SAVE AREA            Y02668 20720002
         L     R0,IEFVHNV          GET PTR TO INTERPRETER        Y02668 20800002
*                                  TERMINATION ROUTINE           Y02668 21000002
         ST    R0,TERMRTN          SAVE IN IWA FOR C/I COMMON    Y02668 21200002
*                                  SERVICE RTNS                  Y02668 21400002
         MVC   IWACONID(WORDLEN),NELCOMID UNCONDITIONALLY MOVE   Y02668 21600002
*                                  CONSOLE ID TO IWA - ZERO VALUEY02668 21800002
*                                  RESULTS IN A DEFAULT TO THE   Y02668 22000002
*                                  MASTER CONSOLE - USED BY WTO  Y02668 22200002
*        CALCULATE THE LONGEST WORKAREA AND GETCORE FOR THAT   @Z40MPTH 22400003
*        LENGTH...                                             @Z40MPTH 22410003
         SPACE 1                                                        22420003
         LA    R0,LJWA            LENGTH OF JWA                @Z40MPTH 22430003
         LA    R5,LEWA            LENGTH OF EWA                @Z40MPTH 22440003
         CR    R0,R5              IS EWA LONGER THAN JWA?      @Z40MPTH 22450003
         BH    NB9JWA             JWA IS LONGER,LEAVE R0 SAME  @Z40MPTH 22460003
         LR    R0,R5              R5(EWA) GREATER THAN R0(JWA) @Z40MPTH 22470003
NB9JWA   EQU   *                                               @Z40MPTH 22480003
         LA    R5,LDWA            LENGTH OF DWA                @Z40MPTH 22490003
         CR    R0,R5              IS DWA LONGER THAN  R0 LENTH @Z40MPTH 22500003
         BH    NB9GET             R0 LENGTH IS GREATER,ADD AWA @Z40MPTH 22510003
         LR    R0,R5              DWA LONGER THAN LENGTH IN R0.@Z40MPTH 22520003
NB9GET   EQU   *                  LENGTH OF AWA ADDED TO LENGTH@Z40MPTH 22530003
*                                 OF LONGEST WORKAREA.         @Z40MPTH 22540003
         LA    R5,LNGTHAWA        LENGTH OF AWA                @Z40MPTH 22550003
         AR    R0,R5              ADD AWA LEN TO LONGEST WKAREA@Z40MPTH 22560003
         ST    R0,IWALWLGN      STORE LWA LENGTH INTO IWA FOR  @Z40MPTH 22570003
*                                 IEFVHN TO FREE IT WITH       @Z40MPTH 22580003
         BAL   RA,VHEGAC           GET CORE FOR LOCAL WORK AREA  Y02668 22600002
*                                  AND CLEAR IT                  Y02668 22800002
         ST    R1,CTRLWAP          SAVE PTR TO LWA IN IWA        Y02668 23000002
         EJECT                                                          23400002
*****************************************************************Y02653 23405002
*                                                                Y02653 23410002
* SETUP ESTAE ENVIRONMENT OVER INTERPRETER                       Y02653 23415002
*                                                                Y02653 23420002
*****************************************************************Y02653 23425002
        SPACE 1                                                         23430002
         L     R0,LENESTAE         GET CORE FOR ESTAE LIST FORM  Y02653 23435002
         BAL   RA,VHEGAC           GET CORE SUBROUTINE           Y02653 23440002
         LR    R5,R1               ADDRESSABILITY FOR ESTAE LIST Y02653 23445002
         L     R4,LENESTAE         LENGHT OF LIST FORM FOR MOVE  Y02653 23450002
         BCTR  R4,0          DECREMENT FOR MOVE INTO CORE.      YM02681 23452002
         EX    R4,MOVESTAE         MOVE LIST TO GOTTEN CORE      Y02653 23455002
         LA    R0,EREPLEN          LENGTH OF USER PARAMETER AREA Y02653 23460002
         BAL   RA,VHEGAC           GET CORE SUBROUTINE           Y02653 23465002
         LR    R4,R1               ADDRESSABILITY TO PARAM AREA  Y02653 23470002
         ST    R4,AOSTAPRM         ADDRESS OF USER PARAM AREA    Y02653 23475002
         USING EREPL,R4      ADDRESSABILITY TO USER PARMAETERS   Y02653 23480002
         ST    RC,EREPLIWA         IWA ADDR IN PARAM AREA ESTAE  Y02653 23485002
         MVC   EREPLRSV(LEN4),IWASAVPT   CALLERS S/A PTR TO EREPLY02653 23490002
         DROP  R4                  DROP ADDRESSABILITY PARAM AREAY02653 23495002
         L     R6,IEFNB9IR         ADDRESS OF ESTAE EXIT         Y02653 23500002
*                                                                Y02653 23505002
         ESTAE (6),PARAM=(4),MF=(E,(5))                          Y02653 23510002
         LTR   RF,RF          WAS ESTAE SUCCESSFUL?              Y02653 23515002
         BZ    NB903ES       YES,CONTINUE NORMALLY               Y02653 23520002
*        IF ESTAE WAS NOT SUCCESSFUL,FREE THE USER PARAMETER     Y02653 23525002
*        AREA AND ZERO THE POINTER TO IT IN THE IWA.             Y02653 23530002
         L     R1,AOSTAPRM        ADDRESS OF USER AREA GOTTEN    Y02653 23535002
         LA    R0,EREPLEN         LENGTH OF USER AREA            Y02653 23540002
         FREEMAIN R,LV=(0),A=(1)  FREE USER PARAMETER LIST       Y02653 23545002
         XC    AOSTAPRM(4),AOSTAPRM  ZERO USER PARAM PTR.        Y02653 23550002
NB903ES  DS    0H                                                Y02653 23555002
*        FREE ESTAE EXIT LIST IN GOTTEN CORE                            23560002
         LR    R1,R5              ADDRESS OF LIST IN CORE        Y02653 23565002
         L     R0,LENESTAE        LENGTH OF LIST IN CORE         Y02653 23570002
         FREEMAIN R,LV=(0),A=(1)   FREE CORE                     Y02653 23575002
         EJECT                                                          23585002
*****************************************************************Y02668 23600002
*                                                               *Y02668 23800002
*  SET UP QMPA, JMR AND DSENQ TABLE IN INTERPRETER'S  CORE      *Y02668 24000002
*  LOAD IEFUJV                                                  *YM0581 24100002
*                                                               *Y02668 24200002
*****************************************************************Y02668 24400002
         SPACE 2                                                 Y02668 24600002
         L     R1,NELQMPA          GET PTR TO QMPA PASSED BY     Y02668 24800002
*                                  THE INTERPRETER'S CALLER      Y02668 25000002
         MVC   QPARM(QMPALEN),NONE(R1)  MOVE CALLER'S QMPA       Y02668 25200002
*                                  INTO INTERPRETER WORK AREA    Y02668 25400002
*                                  THIS ALLOWS CALLER TO SPECIFY Y02668 25600002
*                                  SWA SUBPOOL FOR INTERPRETER   Y02668 25800002
         TM    NELOPSWT,NELSMF     IS SMF BEING USED             Y02668 26000002
         BZ    VHEDSENQ            NO, BYPASS JMR PROCESSING     Y02668 26200002
         LA    R0,TABLEN           GET LENGTH OF JMR             Y02668 26400002
         BAL   RA,VHEGAC           GET CORE AND CLEAR FOR JMR    Y02668 26600002
         ST    R1,IWAJMRPT         SAVE JMR PTR IN IWA           Y02668 26800002
         USING JMR,R1              ADDRESS NEWLY GOTTEN CORE     Y02668 27000002
         L     RE,NELJMR           GET PTR TO CALLER'S JMR       Y02668 27200002
         MVC   JMRJOB(JESSJMR),NONE(RE)  MOVE JMR INTO           Y02668 27400002
*                                  INTERPRETER'S CORE-SO THE USERY02668 27600002
*                                  CANNOT ACCESS JESS CORE       Y02668 27800002
         LOAD  EP=IEFUJV           LOAD USER ROUTINE.           YM00581 27860002
         L     R1,IWAJMRPT         RESTORE R1,DESTROYED BY LOAD YM00581 27900002
         ST    R0,JMRUJVP                                       YM00581 27940002
         LA    R2,JCT              GET JCT PTR                  YM00388 28000002
         USING JCTD,R2             ADDRESS JCT                   Y02668 28200002
         MVC   JCTJMROP(1),JMROPT  PUT SMF OPTIONS IN JCT        Y02668 28400002
         DROP  R2                                                       28600002
         DROP  R1                                                Y02668 28800002
VHEDSENQ DS    0H                                                Y02668 29000002
         LA    R0,TABLEN           GET DSENQ TABLE LENGTH        Y02668 29200002
         BAL   RA,VHEGAC           GET AND CLEAR CORE FOR TABLE  Y02668 29400002
         ST    R1,DSENQTP          SAVE DSENQ TABL PTR IN IWA    Y02668 29600002
         EJECT                                                   Y02668 29800002
*****************************************************************Y02668 30000002
*                                                               *Y02668 30200002
*  GET I/O BUFFERS AND INITIALIZE PTRS IN IQA                   *Y02668 30400002
*                                                               *Y02668 30600002
*****************************************************************Y02668 30800002
         SPACE 2                                                 Y02668 31000002
         LH    R0,TXTBUFLT         GET LENGTH OF TEXT BUFFER     Y02668 31200002
         BAL   RA,VHEGAC           GET AND CLEAR CORE FOR        Y02668 31400002
*                                  INTERNAL TEXT BUFFER          Y02668 31600002
         LH    R0,TXTBUFLT         GET TEXT BUFFER LENGTH AGAIN  Y02668 31800002
         ST    R0,NONE(R1)         PUT LENGTH IN HEADER          Y02668 31880002
         MVC   WORDLEN(WORDLEN,R1),TEXTID PUT ID IN TEXT BUF     Y02668 31960002
         LA    R1,DBLEWORD(R1)     ALLOW FOR DOUBLE WORD HEADER  Y02668 32040002
         ST    R1,TEXTBUFP         SAVE PTR TO 1ST AVAILABLE BYTEY02668 32120002
         LA    R0,AOWBFLTH         GET LENGTH OF SYSTEM OUTPUT   Y02668 32200002
*                                  BUFFER                        Y02668 32400002
         BAL   RA,VHEGAC           GET CORE FOR BUFFER AND CLEAR Y02668 32600002
         ST    R1,AOWSTMT          SAVE BUFFER PTR IN IWA        Y02668 32800002
         LA    R0,MSBUFLEN         GET MSG BUFFER LENGTH         Y02668 32840002
         BAL   RA,VHEGAC           GET AND CLEAR CORE FOR MSG    Y02668 32880002
*                                  BUFFER FOR VGM                Y02668 32920002
         ST    R1,WAMSGBUF         SAVE MSG BUF PTR IN IWA       Y02668 32960002
         EJECT                                                   Y02668 33000002
*****************************************************************Y02668 33200002
*                                                               *Y02668 33400002
*  CREATE UNIQUE DSN QUALIFIER - USED FOR SYSTEM GENERATED DSNS *Y02668 33600002
*                                                               *Y02668 33800002
*****************************************************************Y02668 34000002
         SPACE 2                                                 Y02668 34200002
         LA    R2,UNQNAME          GET PTR TO UNIQUE NAME FIELD  Y02668 34400002
*                                  IN IWA                        Y02668 34600002
         USING GENDSNAM,R2         ADDRESS GENERATED DSNAME      Y02668 34800002
*                                  STRUCTURE AND MAP IT INTO IWA Y02668 35000002
         MVC   PREFIX,SYS          INSERT PREFIX INTO NAME(SYS)  Y02668 35200002
         SPACE 1                                                 Y02668 35400002
*****************************************************************Y02668 35600002
*                                                               *Y02668 35800002
* GET DATE AND TIME BY ISSUING TIME MACRO-                      *Y02668 36000002
*                     R0 RETURNS WITH TIME                      *Y02668 36200002
*                     R1 RETURNS WITH DATE                      *Y02668 36400002
*                                                                Y02668 36600002
*****************************************************************Y02668 36800002
         SPACE 1                                                 Y02668 37000002
         LA    R0,DBLEWORD         GET WORK AREA FOR UNPACK      Y02668 37200002
         BAL   RA,VHEGAC           INSTRUCTION                   Y02668 37400002
         LR    R4,R1               SAVE WORK AREA ADDRESS        Y02668 37600002
         SR    R0,R0               ????  TEMP ***********        Y02668 37800002
         TIME  DEC                 IN DECIMAL, READY TO UNPACK   Y02668 38000002
         ST    R1,NONE(R4)         PREPARE TO UNPACK DATE IN WORKY02668 38200002
*                                  AREA                          Y02668 38400002
         UNPK  NONE(LEN8,R4),NONE(LEN4,R4) UNPACK DATE           Y02668 38600002
         OI    SIGNDIGT(R4),SIGN   CHANGE SIGN DIGIT             Y02668 38800002
         MVC   DATE(LEN5),DATEDSPL(R4) DATE TO NAME FIELD        Y02668 39000002
         MVI   PERIOD,DOT          INSERT QUALIFYING PERIOD      Y02668 39200002
*  TIME                                                          Y02668 39400002
         XC    NONE(LEN8,R4),NONE(R4) ZERO WORK AREA FOR NEXT    Y02668 39600002
*                                  UNPACK                        Y02668 39800002
         ST    R0,NONE(R4)         SET UP TO UNPACK TIME         Y02668 40000002
         MVI   PREFIX1,T           MOVE TIME PREFIX(T) TO NAME   Y02668 40200002
         OI    DISPL3(R4),BSIGN    SIGN LAST DIGIT               Y02668 40400002
         UNPK  NONE(LEN8,R4),NONE(LEN4,R4) UNPACK TIME           Y02668 40600002
         MVC   TIME(LEN6),1(R4)    MOVE TIME INTO NAME           Y02668 40800002
         MVI   PERIOD2,DOT         INSERT SECOND QUALIFYING      Y02668 41000002
*                                  PERIOD                        Y02668 41200002
         MVI   DSTYPE,R            INDICATE SYSIN D.S.-VDA CAN   Y02668 41400002
*                                  CHANGE                        Y02668 41600002
         MVI   SYSTYPE,A           INDICATE AOS OR VIRTUAL SYSTEMY02668 41800002
         MVC   FILLER(LEN3),ZEROS  SUPPLY FILLER                 Y02668 42000002
         MVI   PERIOD3,DOT         INSERT 3RD AUALIFYING PERIOD  Y02668 42200002
         LR    R1,R4               SET UP TO FREE UNPACK WORK    Y02668 42400002
*                                  AREA                          Y02668 42600002
         FREEMAIN R,LV=DBLEWORD,A=(1) FREE IT                    Y02668 42800002
         DROP  R2                                                Y02668 43000002
         EJECT                                                   Y02668 43200002
*****************************************************************Y02668 43400002
*                                                               *Y02668 43600002
*  SCONS FOR CONTROL BLOCKS IN IWA                              *Y02668 43800002
*                                                               *Y02668 44000002
*****************************************************************Y02668 44200002
         LH    R4,SCONREG2         SET UP SCON BASED ON IWA(R12)        44400002
         LA    R5,JCT-COMWA        RELATIVE PTR TO JCT.          Y02668 44600002
         OR    R5,R4               CREATE JCT SCON                      44800002
         STH   R5,JCTS             SAVE IN IWA                          45000002
         LA    R5,JCTX-COMWA       RELATIVE PTR TO JCTX        @Z40RPSM 45050003
         OR    R5,R4               CREATE JCTX SCON            @Z40RPSM 45100003
         STH   R5,JCTXS            SAVE IN IWA                 @Z40RPSM 45150003
         LA    R5,SCT-COMWA        RELATIVE PTR TO SCT.          Y02668 45200002
         OR    R5,R4               CREATE SCT SCON                      45400002
         STH   R5,SCTS             SAVE IN IWA                          45600002
         LA    R5,DSNAME-COMWA     RELATIVE PTR TO DSN TABLE.    Y02668 45800002
         OR    R5,R4               CREATE DSN TABLE SCON                46000002
         STH   R5,DSNAMES          SAVE IN IWA                          46200002
         LA    R5,SREFB-COMWA      RELATIVE PTR TO 1ST REFERBACK.Y02668 46400002
*                                  DICTIONARY                           46600002
         OR    R5,R4               CREATE DICTIONARY SCON               46800002
         STH   R5,SREFBS           SAVE IN IWA                          47000002
         LA    R5,DREFB-COMWA      RELATIVE PTR TO 2ND REFERBACK.Y02668 47200002
*                                  DICTIONARY                           47400002
         OR    R5,R4               CREATE DICTIONARY SCON               47600002
         STH   R5,DREFBS           SAVE IN IWA                          47800002
*                                                                       48000002
         LH    R4,SCONREG1         SET UP SCON BASED ON LWA(R10)        48200002
         SR    R5,R5               CLEAR REGS                           48400002
         OR    R5,R4               CREATE SCON FOR SWITCHES             48600002
         STH   R5,JEDSWS           SAVE IN IWA                          48800002
         LA    R5,LNGJACT+LNGTHAWA RELATIVE PTR TO JACT                 49000002
         OR    R5,R4               CREATE SCON FOR JACT                 49200002
         STH   R5,JACTS            SAVE IN IWA.                  Y02668 49400002
         LA    R5,LNGTHACT+LNGTHAWA  RELATIVE PTR TO STEP ACT. @Z40MPTH 49600003
         OR    R5,R4               CREATE SCON FORACT                   49650003
         STH   R5,ACTS             SAVE IN IWA                          49700003
         LA    R5,LNGORTAB+LNGTHAWA  RELATIVE PTR TO ORIDE TAB.@Z40MPTH 49750003
         OR R5,R4                  CREATE O'RIDE TABLE SCON             50400002
         STH   R5,POVRRDS          SAVE IN IWA                          50600002
         LA    R5,LNGSIOT+LNGTHAWA RELATIVE PTR TO SIOT                 50800002
         OR    R5,R4               CREATE SIOT SCON                     51000002
         STH   R5,SIOTS            SAVE IN IWA                          51200002
         LA    R5,LNGJFCB+LNGTHAWA RELATIVE PTR TO JFCB                 51400002
         OR    R5,R4               CREATE JFCBX SCON                    51600002
         STH   R5,JFCBS            SAVE IN IWA                          51800002
         LA    R5,LNGJFCBX+LNGTHAWA RELATIVE PTR TO JFCBX               52000002
         OR    R5,R4               CREATE JFCBX SCON                    52200002
         STH   R5,JFCBXS           SAVE IN IWA                          52400002
         LA    R5,LNGJFCBE+LNGTHAWA  RELATIVE PTR TO JFCBE.    @Z40MPTH 52450003
         OR    R5,R4              CREATE JFCB SCON             @Z40MPTH 52500003
         STH   R5,JFCBES          STORE INTO IWA...            @Z40MPTH 52550003
         LA    R5,QPARM            INITIALIZE PTR TO                    52600002
         ST    R5,QPARMP           SWA-MANAGER PARM AREA                52800002
         EJECT                                                          53000002
*****************************************************************       53200002
*                                                               *       53400002
*  ASSIGN SVA'S FOR INTERPRETER CONTROL BLOCKS RESIDING IN SWA  *       53600002
*                                                               *       53800002
*****************************************************************       54000002
         SPACE 2                                                        54200002
         L     R2,QPARMP           GET PTR TO SWA MANAGER               54400002
*                                  PARAMETER AREA                       54600002
         USING IOPARAMS,R2         ADDRESS QMPA                         54800002
         L     RA,CTRLWAP          GET LOCAL WORK AREA PTR       Y02668 55000002
         USING AWA,RA        ADDRESS AWA FOR PARMLIST          @Z40MPTH 55200003
*                                  CONTAINS EXTERNAL PARM LIST   Y02668 55250003
*                                  FOR SWA MANAGER               Y02668 55300003
         XC    QLINKWA(32),QLINKWA ZERO AREA                   @Z40RPSM 55350003
         LA    R5,QLINKWA          GET PTR TO SWA MANAGER               56000002
*                                  EXTERNAL(USER) PARM LIST             56200002
         ST    R5,QMPCL            TELL SWA MANAGER WHERE IT IS         56400002
*                                  BY INITIALIZING FIELD IN QMPA        56600002
         MVI   QMPOP,QMASGS        INDICATE ASSIGN STARTS ARE TO Y02668 56800002
*                                  BE DONE                              57000002
         MVI   QMPCM,RECNO         INDICATE NUMBER OF RECORDS           57200002
*                                  TO ASSIGN                            57400002
         DROP  R2                                                       57600002
         L     RF,IEFVHQV          PTR TO SWA-MNGR INTERFACE RTN        57800002
         BALR  RE,RF               GO TO ASSIGN RECORDS                 58000002
         EJECT                                                   Y02668 58200002
*****************************************************************       58400002
*  INITIALIZE CONTROL BLOCKS/WORK AREAS WITH SVA'S ASSIGNED     *       58600002
*****************************************************************       58800002
         SPACE 1                                                        59000002
         LA    R2,JCT              PTR TO JCT                           59200002
         USING JCTD,R2             ADDRESS JCT                          59400002
         MVC   JCTDSKAD(SVALEN),NONE(R5) MOVE 1ST SVA TO JCT            59600002
         MVC   JCTJCTX(WORDLEN),DISPL28(R5)  MOVE 8TH SVA      @Z40RPSM 59650003
*                               INTO PTR TO JCTX.              @Z40RPSM 59700003
         TM    NELOPSWT,NELSMF     IS SMF BEING USED            YM01587 59750003
         BZ    NB9NOSMF            NO, DON'T INIT JCT WITH JMR  YM01587 59800003
*                                  SVA                          YM01587 59850003
         MVC   JCTJMR(SVALEN),DISPL20(R5) USE 7TH  SVA RETURNED         59900003
*                                  FOR JMR - PUT IT IN JCT              60000002
NB9NOSMF DS    0H                                               YM01587 60100002
         DROP  R2                                                       60200002
         LA    R2,SCT              PTR TO SCT                           60400002
         USING SCTD,R2             ADDRESS SCT                          60600002
         MVC   SCTANSCT(SVALEN),WORDLEN(R5) MOVE 2ND SVA TO SCT         60800002
         DROP  R2                                                       61000002
         MVC   TNEXT(WORDLEN*2),DISPL8(R5)  MOVE 3RD AND 4TH SVA        61200002
*                                  TO IWA TO BE USED LATER              61400002
         MVC   TSIOT(WORDLEN),DISPL16(R5) MOVE 5TH SVA TO IWA TO Y02668 61600002
*                                  LATER BE USED FOR SIOT               61800002
         MVC   IWANXTSV(WORDLEN),DISPL24(R5) MOVE 7TH SVA TO    YM02716*61860002
                                   IWA FOR LATER USE IN DSENQT  YM02716*61900002
                                   AND REFERBACK DICT.          YM02716 61940002
         LA    R2,JCTX            PTR TO JCTX.                 @Z40RPSM 61950003
         USING JCTXD,R2          ADDRESS JCTX.                 @Z40RPSM 61960003
         MVC   JCTXDSKA(WORDLEN),DISPL28(R5)  MOVE 8TH SVA     @Z40RPSM 61970003
*                                  INTO JCTX SELF PTR.         @Z40RPSM 61980003
         DROP  R2                                              @Z40RPSM 61990003
         EJECT                                                          62000002
*****************************************************************       62200002
*                                                               *       62400002
*  EXIT LIST PROCESSING                                         *       62600002
*                                                               *       62800002
*****************************************************************       63000002
         SPACE 2                                                        63200002
VHEEXLST DS    0H                                                       63400002
         L     R2,NELEXLST        LOAD POINTER TO EXIT LIST      Y02621 63420002
         LTR   R2,R2               DOES EXIT LIST EXIST FOR NEL  Y02621 63440002
         BZ    VHEEXOUT            NO,EXIT LIST PROCESSING BYPASSY02621 63460002
         USING NELEXITS,R2                                              63480002
         LH    R4,NELEXLEN         LENGTH OF EXIT LIST           Y02621 63500002
         DROP  R2                                                       63520002
         SRA   R4,3(0)             SHIFT DIVIDEND INTO REGISTER 5Y02621 63540002
         BCTR  R4,0       DECREMENT 1 FOR HEADER,INCLUDED IN LEN Y02621 63560002
*        REGISTER 4 NOW HAS NUMBER OF ENTRIES IN THE EXIT LIST.  Y02621 63580002
         SPACE 1                                                        63600002
VHELOOP1 LA    R2,LEN8(R2)         LOOK AT FIRST EXIT LIST ENTRY Y02621 63620002
         USING NELEXENT,R2                                              63640002
*                                                                       63660002
*   EXIT LIST SEARCH                                                    63680002
*                                                                       63700002
         CLI   NELEXID,NELQEPEX   IS IT JOURNAL MERGE ENTRY?     Y02621 63720002
         BE    VHEJRNLX           YES,PROCESS THE ENTRY          Y02621 63740002
         CLI   NELEXID,NELQLPEX   QUEUE MNGR LOC MODE ENTRY?   @G29AN2F 63746003
         BE    VHEQLPEX           YES, PROCESS THE ENTRY       @G29AN2F 63752003
VHENXTEX BCT   R4,VHELOOP1        CHECK NEXT ENTRY               Y02621 63760002
         B     VHEEXOUT           NO JOURNAL MERGE ENTRY FOUND   Y02621 63780002
         SPACE  2                                                       63800002
VHEJRNLX DS    0H    JOURNAL MERGE EXIT PROCESSING               Y02621 63820002
         CLI   NELEXLK,NELEXNOP   SHOULD ENTRY BE IGNORED?       Y02621 63840002
         BE    VHENXTEX           YES,DO NOT PROCESS ENTRY.    @G29AN2F 63860003
         CLI   NELEXLK,NELEXNAM   ENTRY HAVE 6 BYTE NAME?        Y02621 63880002
         BNE   VHEXTADD           THEN CONTAINS ADDR OF LOAD.    Y02621 63900002
         MVC   AOJRNLEX(6),NELEXEP  MOVE NAME INTO FIELD TO LOAD Y02621 63920002
         MVC   AOJRNLEX+6(2),BLANK2 BLANK TRAILING 2 BYTES.      Y02621 63940002
         LA    R6,AOJRNLEX        ADDRESS OF NAME PARAMETER      Y02621 63960002
         LOAD  EPLOC=(6)          LOAD JOURNAL MERGE ROUTINE.    Y02621 63980002
         ST    R0,AOJMRGEP        EP ADDRESS INTO IWA FIELD      Y02621 64000002
         EJECT                                                          64002002
*****************************************************************Y02668 64004002
*                                                               *Y02668 64006002
*   EXIT TO START PROCESSING TEXT                               *Y02668 64008002
*                                                               *Y02668 64010002
*****************************************************************Y02668 64012002
         SPACE 5                                                        64014002
         B     VHELSTMV           MOVE WHOLE EXIT LIST ENTRY     Y02621 64020002
VHEXTADD MVC   AOJMRGEP(4),NELEXEPA  MOVE ADDRESS TO IWA         Y02621 64040002
VHELSTMV MVC   AOJRNLEX(8),NELEXLK  MOVE EXIT LIST ENTRY TO IWA  Y02621 64060002
         B     VHENXTEX            PROCESS NEXT ENTRY,IF ANY     Y02621 64080002
         SPACE 1                                                        64100002
VHEQLPEX DS    0H                QUEUE MNGR LOCATE MODE EXIT   @G29AN2F 64101003
         CLI   NELEXLK,NELEXNOP  SHOULD ENTRY BE IGNORED?      @G29AN2F 64102003
         BE    VHENXTEX          YES, DO NOT PROCESS ENTRY     @G29AN2F 64103003
         CLI   NELEXLK,NELEXNAM  ENTRY HAVE 6 BYTE NAME?       @G29AN2F 64104003
         BNE   VHEQLADD          THEN CONTAINS ADDR OF LOAD    @G29AN2F 64105003
         MVC   AOQLOCEX(6),NELEXEP MOVE NAME TO IWA FIELD      @G29AN2F 64106003
         MVC   AOQLOCEX+6(2),BLANK2 BLANK TRAILING 2 BYTES     @G29AN2F 64107003
         LA    R6,AOQLOCEX       GET ADDR OF NAME OF EXIT      @G29AN2F 64108003
         LOAD  EPLOC=(6)         LOAD QUEUE MNGR LOC ROUTINE   @G29AN2F 64109003
         ST    R0,AOQLOCEP       EP ADDR INTO COMWA FIELD      @G29AN2F 64110003
         B     VHELOCMV          MOVE WHOLE EXIT LIST ENTRY    @G29AN2F 64111003
VHEQLADD MVC   AOQLOCEP(4),NELEXEPA MOVE ADDR TO COMWA         @G29AN2F 64112003
VHELOCMV MVC   AOQLOCEX(8),NELEXLK  MOVE EXIT LIST ENTRY TO IWA@G29AN2F 64113003
         B     VHENXTEX          PROCESS NEXT ENTRY, IF ANY    @G29AN2F 64114003
VHEEXOUT DS    0H       EXIT LIST PROCESSING FINISHED            Y02621 64120002
         DROP  R2                                                Y02621 64140002
         EJECT                                                          64160002
         L     RF,IEFVHEV          ADDR OF INTERP ROUTER         Y02668 64200002
         BR    RF                  EXIT TO GET 1ST TEXT STRING   Y02668 64400002
         EJECT                                                          64600002
*****************************************************************Y02668 64800002
*                                                               *Y02668 65000002
*  ROUTINE TO GET AND CLEAR CORE                                *Y02668 65200002
*                                                               *Y02668 65400002
*****************************************************************Y02668 65600002
         SPACE 2                                                 Y02668 65800002
VHEGAC   DS    0H                                                Y02668 66000002
         STM   R4,R7,12(RD)        SAVE REGS CLOBBERED BY MVCL   Y02668 66100002
         LR    R5,R0               PUT LENGTH IN ODD REG FOR MVCLY02668 66200002
         GETMAIN  R,LV=(0)         GET REQUESTED CORE            Y02668 66300002
         LR    R4,R1               SET UP TARGET OF MVCL AND     Y02668 66400002
*                                  PRESERVE REG1 FOR RETURN      Y02668 66500002
         SR    R7,R7               INDICATE PADDING CHAR OF 0    Y02668 66600002
*                                  FOR MVCL AND OBJECT COUNT OF 0Y02668 66700002
         SR    R6,R6               INDICATE NO MVCL OBJECT ADDR  Y02668 66800002
         MVCL  R4,R6               CLEAR REQUESTED CORE          Y02668 66900002
         LM    R4,R7,12(RD)        RESTORE REGS CLOBBERED        Y02668 67100002
*                                  BY MOVE CHAR LONG(MVCL)       Y02668 67300002
         BR    RA                                                Y02668 67600002
         EJECT                                                          67800002
*****************************************************************Y02668 68000002
*   DECLARED  STORAGE                                           *Y02668 68200002
*****************************************************************Y02668 68400002
MOVESTAE MVC   LEN0(LEN0,R5),NB9ESTAE    MOVE LIST FORM TO AREA  Y02653 68500002
ID       DC    X'11111111'         IDENTIFIER                    Y02668 68600002
BLANK2   DC    X'4040'             TWO BLANKS FOR PADDING        Y02621 68700002
TXTBUFLT DC    H'8192'             8K INTERNAL TEXT BUFFER       Y02668 68800002
TEXTID   DC    X'EEEEEEEE'         TEXT BUFFER IDENTIFIER        Y02668 68900002
SYS      DC    C'SYS'                                            Y02668 69000002
ZEROS    DC    X'F0F0F0'                                         Y02668 69200002
SCONREG1 DC    XL2'A000'           LOCAL WORK AREA BASE          Y02668 69400002
SCONREG2 DC    XL2'C000'           IWA BASE                      Y02668 69600002
IEFVHEV  DC    V(IEFVHE)           INTERPRETER ROUTER            Y02668 69800002
IEFVHNV  DC    V(IEFVHN)           INTERPRETER TERMINATION RTN   Y02668 70000002
IEFVHQV  DC    V(IEFVHQ)           SWA MANGER INTERFACE RTN             70200002
IEFNB9IR DC    V(IEFNB9IR)         ESTAE RECOVERY EXIT ROUTINE   Y02653 70240002
         SPACE 1                                                        70280002
NB9ESTAE ESTAE XCTL=NO,PURGE=NONE,ASYNCH=YES,RECORD=YES,MF=L            70320002
LENESTAE DC    A(*-NB9ESTAE)       LENGTH OF ESTAE LIST MACRO    Y02653 70360002
PATCH    DC    25F'0'                                                   70400002
         EJECT                                                          70600002
*****************************************************************Y02668 70800002
*                                                               *Y02668 71000002
*                        EQUATES                                *Y02668 71200002
*                                                               *Y02668 71400002
*****************************************************************Y02668 71600002
         SPACE 2                                                 Y02668 71800002
MSBUFLEN EQU   160        MSG BUFFER LENGTH FOR VGM              Y02668 72060002
LNGTHAWA EQU   ENDAWA-QLINKWA                                    Y02668 73200002
LDWA     EQU   ENDWA-DWA                                       @Z40MPTH 73250003
LNGJACT  EQU   JACT-JASW1                                        Y02668 73400002
LNGSIOT  EQU   SIOT-DWA                                          Y02668 73600002
LNGJFCB  EQU   JFCB-DWA                                          Y02668 73800002
LNGJFCBX EQU   JFCBX-DWA                                         Y02668 74000002
LNGORTAB EQU   EAORTABL-EWA       DISPLACEMENT OF ORIDE TABLE  @Z40MPTH 74050003
LNGTHACT EQU   ACT-EWA            DISPLACEMENT OF ACT IN EWA.  @Z40MPTH 74100003
LNGJFCBE EQU   JFCBEX-DWA         DISPLACEMENT OF JFCBE IN DWA.@Z40MPTH 74150003
WORDLEN  EQU   4                                                 Y02668 75000002
QMPALEN  EQU   32                                                Y02668 75200002
NONE     EQU   0                                                 Y02668 75400002
JESSJMR  EQU   56                  LENGTH OF JESS JMR            Y02668 75600002
TABLEN   EQU   176                                               Y02668 75800002
AOWBFLTH EQU   90                                                Y02668 76200002
DBLEWORD EQU   8                                                 Y02668 76400002
SIGNDIGT EQU   7                                                 Y02668 76600002
BYTE0    EQU   0                                                 Y02668 76800002
HEX00    EQU   0                                                 Y02668 77000002
NEXT     EQU   1                                                 Y02668 77200002
SIGN     EQU   X'F0'                                             Y02668 77400002
DATEDSPL EQU   3                                                 Y02668 77600002
DOT      EQU   C'.'                                              Y02668 77800002
T        EQU   C'T'                                              Y02668 78000002
R        EQU   C'R'                                              Y02668 78200002
A        EQU   C'A'                                              Y02668 78400002
BSIGN    EQU   X'0F'                                             Y02668 78600002
LEN0     EQU   0                                                 Y02653 78700002
LEN3     EQU   3                                                 Y02668 78800002
LEN4     EQU   4                                                 Y02668 79000002
LEN5     EQU   5                                                 Y02668 79200002
LEN6     EQU   6                                                 Y02668 79400002
LEN8     EQU   8                                                 Y02668 79600002
RECNO    EQU   X'80'               RECORD NUMBER               @Z40RPSM 79800003
SVALEN   EQU   3                   SWA VIRTUAL ADDR LENGTH              80000002
DISPL20  EQU   20                                                       80200002
DISPL24  EQU   24                                                       80300002
DISPL3   EQU   3                                                 Y02668 80400002
DISPL8   EQU   8                                                        80600002
DISPL16  EQU   16                                                       80800002
DISPL28  EQU   28                                              @Z40RPSM 80850003
         EJECT                                                          81000002
TRACE    DS    0H                                                       81200002
         BALR  15,0                SET BASE REG.                        81400002
         USING *,15                                                     81600002
****************************************************************YM08105 81700002
         B     TRNOP               DEACTIVATE TRACE             YM08105 81800002
*                                  ZAP THIS INSTR TO '47000000' YM08105 81900002
*                                  TO TRACE MODULE FLOW.        YM08105 82000002
****************************************************************YM08105 82100002
         STM   11,1,TRSAVE         SAVE CALLER'S REGS.                  82600002
*  REGISTER 12 CONTAINS ADDRESS OF WORK AREA.                    Y02668 82800002
         L     1,BUFADDR           LOAD CONTENTS.                       83200002
         LTR   1,1                 TRACE BUFFER OBTAINED ?              83400002
         BNZ   TR5                 BRANCH YES.                          83600002
* TRACE BUFFER NOT YET OBTAINED.                                        83800002
         LR    11,15               SAVE BASE REGISTER.                  84000002
         LH    0,BUFLTH            LOAD BUF LENTH.                      84200002
         GETMAIN  R,LV=(0)                                              84400002
         LR    15,11               RESTORE BASE REGISTER.               84600002
         ST    1,BUFADDR           SAVE BUFFER ADDRESS.                 84800002
         ST    1,NEXTPTR           INIT NEXT ENTRY PTR.                 85000002
         AH    1,BUFLTH            ADD LENGTH TO                        85200002
         ST    1,BUFEND            COMPUTE BUFFER END ADDR.             85400002
* TRACE BUFFER EXISTS AND PTRS ARE INITIALIZED.                         85600002
TR5      DS    0H                                                       85800002
         CLC   NEXTPTR(4),BUFEND   IS BUFFER FILLED ?                   86000002
         BNE   TR10                BRANCH NO.                           86200002
* BUFFER HAS BEEN FILLED. START OVER.                                   86400002
         MVC   NEXTPTR(4),BUFADDR  SET NEXT ENTRY TO START OF BUF.      86600002
TR10     DS    0H                                                       86800002
         L     1,NEXTPTR           LOAD PTR TO NEXT ENTRY.              87000002
         L     14,TRSAVE+12        LOAD ADDR OF CALLER.                 87200002
         MVC   0(4,1),4(14)        MOD ID IS 2ND WD AFTER CALLING      *87400002
                                   ADDR. MOVE ID TO BUF.                87600002
         LA    1,4(1)              SET ENTRY PTR TO NEXT LOC AND        87800002
         ST    1,NEXTPTR           SAVE.                                88000002
         LM    11,1,TRSAVE         RESTORE REGS.                        88200002
TRNOP    DS    0H                                               YM08105 88300002
         LA    14,8(14)            PT LINK REG BEYOND PARM LIST.        88400002
         BR    14                  RETURN TO NEXT EXECUTABLE INSTR.     88600002
         SPACE 2                                                        88800002
         DS    0H                                                       89000002
BUFLTH   DC    AL2(2048)           BUFFER LENGTH.                       89200002
         EJECT                                                          90000002
         END   IEFNB903                                                 90200002
