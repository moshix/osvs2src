*/********************************************************************/ 00050002
*/*                                                                  */ 00100002
*/* MODULE NAME=IEFRPREP                                             */ 00150002
*/*                                                                  */ 00200002
*/* DESCRIPTIVE NAME=RESTART PREPARATION ROUTINE                     */ 00250002
*/*                                                                  */ 00300002
*/* COPYRIGHT=NONE                                                   */ 00350002
*/*                                                                  */ 00400002
*/* STATUS=00                                                        */ 00450002
*/*                                                                  */ 00500002
*/* FUNCTION=                                                        */ 00550002
*/*      - TO DETERMINE IF A JOBSTEP TASK WHICH HAS ABENDED CAN BE   */ 00600002
*/*        RESTARTED AND TO PREPARE FOR RESTART                      */ 00650002
*/*      OPERATION=                                                  */ 00700002
*/*         - TEST FOR RESTART REQUEST                               */ 00750002
*/*         - TEST FOR CHECKPOINT TAKEN                              */ 00800002
*/*         - VERIFY ABEND CODE ELIGIBILITY                          */ 00850002
*/*         - TEST FOR JOURNAL ERROR                                 */ 00900002
*/*         - TEST FOR NO JOURNAL                                    */ 00950002
*/*         - REQUEST OPERATOR AUTHORIZATION                         */ 01000002
*/*         - IF INELIGIBLE FOR RESTART:                             */ 01050002
*/*011000                                                    @YM07085*/ 01100002
*/*           - SET NO RESTART BIT IN JCT                            */ 01150002
*/*           - ZERO ABEND CODE FIELD IN JCT                         */ 01200002
*/*           - SET JCTABEND ON IN JCT                               */ 01250002
*/*           - ZERO EIGTH CONDITION CODE SLOT IN SCT                */ 01300002
*/*           - SET SCTABEND ON IN SCT                               */ 01350002
*/*           - JOURNAL JCT AND SCT                                  */ 01400002
*/*           -SET JOURNAL OVERRIDE BIT ON                           */ 01420002
*/*         - IF RESTART IS TO OCCUR:                                */ 01450002
*/*           - TURN OFF JOURNAL OVERRIDE BIT IF WARM START          */ 01500002
*/*           - ZERO ABEND CODE FIELD IN JCT                         */ 01550002
*/*           - SAVE RESTART INDICATORS                              */ 01600002
*/*           - SAVE FAILING STEP NO.                                */ 01650002
*/*           - SAVE DISPOSITION INDICATORS BASED ON RESTART TYPE    */ 01700002
*/*           - SET ON JOB IN EXECUTION BITS                         */ 01800002
*/*           - SET OFF JOB IN TERMINATION BITS                      */ 01850002
*/*           - JOURNAL UPDATED JCT                                  */ 01900002
*/*           - SET JOURNAL OVERRIDE BIT ON                          */ 01920002
*/*         - RETURN TO IEFBB410                                     */ 01950002
*/*                                                                  */ 02000002
*/* NOTES=                                                           */ 02050002
*/*     CHARACTER-CODE DEPENDENCIES=TYPE C                           */ 02100002
*/*     DEPENDENCIES=SWA MANAGER                                     */ 02150002
*/*     RESTRICTIONS=NONE                                            */ 02200002
*/*     REGISTER-CONVENTIONS=STANDARD LINKAGE CONVENTIONS            */ 02250002
*/*     PATCH-LABEL=PATCH,50 BYTES                                   */ 02300002
*/*                                                                  */ 02350002
*/* MODULE TYPE=PROCEDURE                                            */ 02400002
*/*     PROCESSOR=BAL                                                */ 02450002
*/*     MODULE SIZE=470 BYTES (HEX)                                  */ 02500002
*/*     ATTRIBUTES=REENTRANT,ONE PSW PROTECT KEY                     */ 02550002
*/*                                                                  */ 02600002
*/* ENTRY POINT=IEFRPREP                                             */ 02650002
*/*     PURPOSE=MODULE IEFBB410 CALLS THIS ROUTINE WHENEVER JOB IS   */ 02700002
*/*             ABENDED,TO DETERMINE WHETHER THIS JOB CAN BE         */ 02750002
*/*             RESTARTED                                            */ 02800002
*/*     LINKAGE=VIA BALR INSTRUCTION                                 */ 02850002
*/*     INPUT DATA=REGISTER 1 POINTED TO LCT                         */ 02900002
*/*     REGISTER SAVED=ALL                                           */ 02950002
*/*     REGISTER CONTENTS DURING PROCESSING=                         */ 03000002
*/*          REG10=JCT BASE                                          */ 03050002
*/*          REG11=SCT BASE                                          */ 03100002
*/*          REG12=LCT BASE                                          */ 03150002
*/*          REG3=JSCB BASE                                          */ 03200002
*/*     REGISTER STORED=ALL                                          */ 03250002
*/*                                                                  */ 03300002
*/* EXIT-NORMAL=                                                     */ 03350002
*/*     CONDITIONS=RETURN TO CALLER VIA RETURN MACRO                 */ 03400002
*/*     OUTPUT DATA=NONE                                             */ 03450002
*/*     RETURN CODES=NONE                                            */ 03500002
*/*                                                                  */ 03550002
*/* EXIT-ERROR=                                                      */ 03600002
*/*     CONDITIONS=RETURN TO CALLER VIA RETURN MACRO                 */ 03650002
*/*     OUTPUT DATA=NO RESTART BITS IN JCT WAS SET                   */ 03700002
*/*     RETURN CODES=NONE                                            */ 03750002
*/*                                                                  */ 03800002
*/* EXTERNAL REFERENCES=                                             */ 03850002
*/*     ROUTINES=IEFXB603 CONTAINS MSG TEXT FOR IEF167I & IEF168I    */ 03950002
*/*             =IEFVRCDS CONTAINS TABLE OF ELIGIBLE ABEND CODES     */ 04000002
*/*     DATA AREAS=NONE                                              */ 04050002
*/*     CONTROL BLOCKS=                                              */ 04100002
*/*          USED=CVT,TCB,LCT,SCT.                                   */ 04150002
*/*          MODIFIED=JCT,JSCB,SCT                                   */ 04200002
*/*     TABLES=NONE                                                  */ 04250002
*/*     MACROS=IEFQMREQ,WTOR,WTP,GETMAIN,FREEMAIN,LOAD,DELETE        */ 04300002
*/*     CHANGE LEVEL=N/A                                             */ 04350002
*/*                                                                  */ 04400002
*/* MESSAGES=                                                        */ 04450002
*/*     IEF225D RESULT FROM JOB STEP ELIGIBLE FOR RESTART.           */ 04500002
*/*     IEF167I RESULT FROM NO JOB JOURNAL.                          */ 04650002
*/*     IEF168I RESULT FROM JOB JOURNAL ERROR                        */ 04700002
*/*                                                                  */ 04750002
*/* CHANGE ACTIVITY=                                                 */ 04758002
*/*     S/D CODE=Y02641                                              */ 04766002
*/*     PTM=Y02788,                                          @YM02788*/ 04774002
*/*         Y05553,                                          @YM05553*/ 04779002
*/*         Y03406                                           @YM03406*/ 04784002
*/*         Y07085,                                          @YM07085*/ 04787002
*/*         Y06095                                           @YM06095*/ 04788002
*/*                                                                  */ 04790002
*/* ABEND-CODES=NONE                                                 */ 04800002
*/*                                                                  */ 04850002
*/********************************************************************/ 04900002
         EJECT                                                          04950002
IEFRPREP CSECT                                                          05000002
R0       EQU   0                                                        05050002
R1       EQU   1                                                        05100002
R2       EQU   2         WORK REGS                                      05150002
R3       EQU   3         JSCB BASE                               Y02641 05200002
R4       EQU   4           *                                            05250002
R5       EQU   5           *                                            05300002
R6       EQU   6           *                                            05350002
R7       EQU   7           *                                            05400002
R8       EQU   8           *                                            05450002
R9       EQU   9         PROGRAM BASE                                   05500002
RA       EQU   10        JCT BASE                                       05550002
RB       EQU   11        SCT BASE                                       05600002
RC       EQU   12        LCT BASE                                       05650002
RD       EQU   13                                                       05700002
RE       EQU   14                                                       05750002
RF       EQU   15                                                       05800002
*                                                                       05850002
*                                                                       05900002
         SAVE  (14,12)                                                  05950002
         BALR  R9,R0              ESTABLISH                             06000002
         USING *,R9                    ADDRESSABILITY                   06050002
         LR    RC,R1                                             Y02641 06060002
         GETMAIN R,LV=72,SP=230        GETMAIN FOR SAVE AREA     Y02641 06110002
         XC     0(72,R1),0(R1)         CLEAR SAVE AREA           Y02641 06120002
         ST     13,4(0,1)              CHAIN SAVE AREA TOGATHER  Y02641 06130002
         ST     R1,8(0,RD)             CHAIN SAVE AREA TOGATHER  Y02641 06140002
         LR     RD,R1                  PTR TO SAVE AREA          Y02641 06142002
         MODID BRANCH=YES                                        Y01886 06150002
*********************************************************************** 06200002
*                                                                       06250002
*             INITIALIZATION  AND RESTART VERIFICATION                  06300002
*              VERIFICATION INCLUDES-                                   06350002
*               -TESTING RESTART STATUS AS REQUESTED VIA THE JOB AND/OR 06400002
*                EXEC STATEMENT                                         06450002
*               -DETERMINING IF ABEND CODE IS ELIGIBLE FOR RESTART-THAT 06500002
*                IS,CONTAINED IN A SYSGEN TABLE OF RESTARTABLE ABEND    06550002
*                CODES                                                  06600002
*               -REQUESTING AUTHORIZATION FROM THE SYSTEM OPERATOR FOR  06650002
*                RESTART                                                06700002
*                                                                       06750002
*                                                                       06800002
*********************************************************************** 06850002
         USING LCT,RC         LCT  BASE                                 06950002
         L     RA,LCTJCTAD    SETUP JCT BASE REGISTER                   07000002
* 15100018                                                       Y02641 07050002
         USING JCT,RA                                                   07100002
         L     RB,LCTSCTAD                                              07150002
         USING     SCT,RB                                               07200002
* 04000000 - 04050000                                            Y02641 07250002
         TM    JCTRSW2,JCTNORST    IS JOB TO BE RESTARTED               07300002
         BO   RP950                     BCH NO TO EXIT ... W/O SAVE     07350002
         TM    JCTRSW2,JCTNARST    IS JOB RESTARTABLE            Y02641 07400002
         BO    RP950                                             Y02641 07450002
         TM    JCTRSW2,JCTRESTT   IS BIT ON FOR RSTRT TO OCCUR          07500002
         USING CVT,R5                                                   07550002
         BO    RP075              YES - BR AROUND CHECKPT CHECK  Y02641 07600002
         TM    JCTRSW1,JCTCKFT    NO - WERE CHKPTS TAKEN                07650002
         BZ    CABEND1            NO - SET BITS FOR NORST AND EXIT      07700002
*                                                                       07750002
* 04500000 - 04750000                                            Y02641 07800002
*                                                                       07850002
* * *    CHECK TO SEE IF ABEND CODE IS PERMITTED TO RESTART             07900002
*                                           *                           07950002
RP075    DS    0H                                                       08000002
         L     R4,LCTTCBAD             GET TCB ADDR FROM LCT            08050002
*                                                                       08100002
         USING TCB,R4                                                   08150002
         L     R3,LCTJSCB                                        Y02641 08200002
         USING IEZJSCB,R3              R3 CONTAINS JSCB PTR      Y02641 08250002
         L     R3,JSCBACT         OBTAIN DAUGTHER TASK JSCB      Y02641 08400002
JNL04   MVC    JCTACODE+ONE(THREE),FZERO  ZERO ABEND CODE        Y02641 08450002
* 085000-086100                                                @YM07085 08500002
        B      JNL03              TO CHECK VALID CODE          @YM02788 08630002
*****************************************************************Y02641 08650002
*     CHECK TO SEE IF THERE IS A JOURNAL DATA SET OR IF THERE IS Y02641 08700002
*     ERROR ON JOURNAL . NO RESTART IS THERE IS NO JOURNAL OR    Y02641 08750002
*     ERROR HAS OCCURED.                                         Y02641 08800002
*****************************************************************Y02641 08850002
RP100    EQU   *                                                        08900002
         GETMAIN R,LV=200,SP=230  GET CORE FOR MSG               Y02641 08950002
         LR    R8,R1               ADDRESS MSG AREA                     09000002
         USING IEZJSCB,R3                                        Y02641 09050002
         TM    JSCBJJSB,JSCBJNLF  TEST FOR NO JOURNAL            Y02641 09100002
         BZ    JNL01              CHECK FOR NO JNL               Y02641 09150002
         MVC   ZERO(FOUR,R8),MSG2 MSG ID                         Y02641 09200002
         B     JNL02              ISSUE JNL ERR MSG TO PGMR      Y02641 09250002
JNL01    TM    JSCBJJSB,JSCBJNLE  TEST FOR JNL ERR               Y02641 09300002
         BZ    RP101              RESTART IS TO OCCUR          @YM02788 09350002
         MVC   ZERO(FOUR,R8),MSG1 MSG ID                         Y02641 09400002
JNL02    LOAD  EP=IEFXB603        LOAD MSG MODULE                Y02641 09450002
         LR    R6,R0              SAVE MSG MOD PTR               Y02641 09500002
         LA    R5,FOUR(R8)        GETMAIN ADDR FOR MSG TEXT      Y02641 09550002
         LA    R6,24(R6)          SKIP MOD IDENTIFICATION        Y02641 09600002
SEARCH   CLC   0(4,R6),0(R8)      COMPARE THE ID                 Y02641 09650002
         BE    FOUND              MSG FOUND                      Y02641 09700002
         LA    R6,8(R6)           BUMP TO NXT MSG ID             Y02641 09750002
         B     SEARCH             MSG NOT FOUND                  Y02641 09800002
FOUND    L     R6,4(R6)           OBTAIN ADDR OF MSG TEXT        Y02641 09850002
         MVC   0(80,R5),0(R6)     MOVE MSG TEXT TO GETMAIN AREA  Y02641 09900002
         WTO   MF=(E,(R5))        ISSUE THE MSG                  Y02641 09950002
         DELETE EP=IEFXB603       DELETE MSG MODULE              Y02641 10000002
         B     RP150                                             Y02641 10050002
**************************************************************** Y02641 10056002
*                                                                Y02641 10062002
*  FOLLOWING CODE CHECKS THE ABEND CODE AGAINST VALID ABEND CODE Y02641 10068002
*  TABLE...IF VALID-JOB RESTARTABLE....IF NOT VALID-JOB NOT      Y02641 10074002
*  RESTARTABLE.                                                  Y02641 10080002
*                                                                Y02641 10086002
***************************************************************  Y02641 10092002
JNL03    L     R4,TCBCMP          PICK UP ABEND CODE             Y02641 10100002
         DROP  R4                                                       10150002
*                                                                       10200002
         LA    R4,ZERO(R4)        CLEAR HI ORDER BYTE                   10250002
         SRDL  R4,TWLVE           SHIFT USER CODE TO REG5 - IF ANY      10300002
*                                                                       10350002
         L     R2,VCONDS           ESTABLISH POINTER TO BEGIN OF        10400002
         LR    R1,R2              VALID RESTART CODES - SYSTEM - AND    10450002
         AH    R1,ZERO(R2)        TO END OF VALID SYSTEM RESTART CODES  10500002
         LTR   R4,R4              IS IT A SYSTEM ABEND CODE             10550002
         BNE   CABEND0            YES - BRANCH TO PROCESS IT            10600002
         SLDL  R4,TWLVE           NO - SHIFT USER CODE BACK INTO R4     10650002
         LR    R2,R1              LOAD END SYSTEM RESTART CODE TABLE    10700002
         AH    R1,ZERO(R2)        ADD LENGTH USER CODE TABLE - TO       10750002
*                                 POINT TO THE END OF THE TABLE         10800002
CABEND0  DS    0H                                                       10850002
         LA    R2,TWO(R2)         POINT TO NEXT VALID ABEND CODE        10900002
         CR    R2,R1              END OF TABLE                          10950002
         BE    CABEND1              YES      NO RESTART        @YM05553 11000002
*                                   NO                                  11050002
         CH    R4,ZERO(R2)         VALID ABEND CODE FOR RESTART         11100002
         BNE   CABEND0              NO       CONTINUE SEARCH            11150002
         B     RP100              YES    RESTARTABLE           @YM02788 11200002
***************************************************************  Y02641 11206002
*                                                                Y02641 11212002
*   JOB NOT RESTARTABLE...                                       Y02641 11218002
*     TURN OFF ALL RESTART BITS IN JCT                           Y02641 11224002
*     WRITE JCT AND SCT TO SWA                                   Y02641 11230002
*                                                                Y02641 11236002
**************************************************************** Y02641 11242002
CABEND1  DS    0H                                                       11250002
         GETMAIN R,LV=200,SP=230                                 Y02641 11300002
         LR    R8,R1                                             Y02641 11350002
CABEND2  DS    0H                                                Y02641 11400002
         OI    JCTJSTAT,JCTABEND  TURN ON ABEND BIT              Y02641 11450002
         OI    SCTABCND,SCTABEND  TURN ON ABEND BIT              Y02641 11500002
         NI    SCTABCND,MASK-SCTONLYC  TURN OFF COND=ONLY BIT    Y02641 11550002
         OI    JCTRSW2,JCTNORST   SET NO RESTART SWITCH                 11600002
* NEED TO TURN OFF THESE BITS IN SWITCH 1 AS THIS IS A COMMON EXIT PATH 11650002
         NI    JCTRSW1,OFFSW1                                           11700002
         LR    R7,R8                                             Y02641 11750002
         LA    R4,QMGR1            QMPA ADDR                     Y02641 11800002
         USING IOPARAMS,R4                                       Y02641 11850002
         MVI   QMPOP,QMWRTE        WRITE TO SWA                  Y02641 11900002
         OI    QMSTA,QMSJNL                                      Y02641 11950002
         ST    R7,QMPCL            LOAD EPA PTR IN QMPA          Y02641 12000002
         OI    QMPNC,X'02'         WRITE TWO RECORDS             Y02641 12050002
         USING ZB506,R7                                          Y02641 12100002
         ST    RA,SWBUFPTR      LOAD JCT ADDR                    Y02641 12110002
         MVC   SWROWVA(THREE),JCTDSKAD  LOAD JCT SVA             Y02641 12150002
         MVI   SWWRTID,X'00'       LOAD BLOCK ID                 Y02641 12200002
         LA    R7,8(R7)            MOVE TO NXT EPA ENTRY         Y02641 12250002
         ST    RB,SWBUFPTR      LOAD SCT ADDR                    Y02641 12260002
         MVC   SWROWVA(THREE),SCTDISKA LOAD SCT ADDR             Y02641 12300002
         MVI   SWWRTID,X'02'       LOAD BLOCK ID                 Y02641 12350002
         LR    R1,R4                                             Y02641 12400002
         IEFQMREQ                                                Y02641 12450002
         NI    QMSTA,MASK-QMSJNL  TURN OFF QMSJNL BIT          @YM03406 12500002
         B     RP899              GO TO EXIT                     Y02641 12550002
*********************************************************************** 12600002
*             REQUEST OPERATOR AUTHORIZATION OF JOB RESTART             12650002
*             ALL REGISTERS ARE FREE FOR USE                            12700002
*             .CREATE INTERFACE FOR GENERATE-WTO MSG MODULE             12750002
*             .WAIT ON REPLY                                            12800002
*********************************************************************** 12850002
*                                                                       12900002
*********************************************************************** 12950002
*        RESTART IS TO OCCUR IF OPER REPLIES-YES OR HOLD         Y02641 12960002
*        NOT RESTARTED IF OPER REPLIED-NO                        Y02641 12970002
*        R1 MUST BE SAVED THROUGHOUT FORMATTING THE MESSAGE.            13000002
*        IT POINTS TO THE GOTTEN CORE.                                  13050002
*        R8 IS THE REG USED TO POSITION THE DATA IN THE MESSAGE.        13100002
*********************************************************************** 13150002
RP101    XC    ZERO(200,R8),ZERO(R8) CLEAR GETMAIN AREA          Y02641 13200002
          LR   R1,R8                                             Y02641 13250002
         USING MSG,R8                                                   13300002
         SR    R2,R2              SUBTRACT OUT INDEX REG                13350002
         MVC   MSGWTOR(MSGLN),MESS1 MOVE LIST DATA TO GOTTEN CORE       13400002
         MVC   MSGJOB,JCTJNAME    INSERT JOBNAME INTO MESSAGE           13450002
         MVC   MSGSTEP,SCTSNAME   INSERT STEPNAME                       13500002
         CLI   SCTSCLPC,BLANK     Q. IS THERE A CALLING STEPNAME        13550002
         BE    RP110                BR NO                               13600002
         MVI   MSGPT2,PERIOD      MOVE DELIMITER TO MSG                 13650002
         MVC   MSGSTEP,SCTSCLPC   INSERT CALLING STEPNAME IN MSG        13700002
         MVC   MSGPROC,SCTSNAME    RE INSERT STEPNAME                   13750002
         B     RP115              B TO CHECK RESTART CODE               13800002
RP110    DS    0H                                                       13850002
         LA    R7,NINE            LOAD 9 AND SUBTRACT IT FROM           13900002
         LA    R2,NINE(R2)        ADD IN INDEX                          13950002
         SR    R8,R7                 FROM MSG BASE REGISTER             14000002
RP115    DS    0H                                                       14050002
         TM    JCTRSW1,JCTCKFT  WAS CHECKPT TAKEN FOR THIS STEP         14100002
         BZ    RP117              NO - GO TO FLAG STEP RSTRT            14150002
         OI    JCTRSW1,JCTCKPTR   INTRA-STEP RESTART FLAG               14200002
         MVC   MSGCHKID,JCTCKIDT  MOVE CHECKID TO MSG                   14250002
         B     RP119              BR TO PUT IN REST OF MESSAGE          14300002
RP117    OI    JCTRSW1,JCTSTEPR   SET THE STEP RESTART BIT ON IN JCT    14350002
         LA    R7,CON17           LOAD 17 TO SUBTRACT FROM MSG BASE     14400002
         LA    R2,CON17(R2)       ADD IN INDEX TO GET TO SECOND PART    14450002
         SR    R8,R7              TO POSITION SECOND PART OF MSG        14500002
RP119    DS    0H                                                       14550002
         LA    R7,MSGMSG1(R2)     POINT TO SECOND PART OF MSG           14600002
         MVC   MSGMSG1(TWLVE),ZERO(R7) MOVE SECOND PART OF MSG          14650002
         LA    R5,MSGMCS           THIS POINTS TO END OF MSG.     M0092 14700002
*        R1 CONTAINS ORIGINAL POINTER TO GOTTEN CORE.                   14750002
         LR    R8,R1              RESET BASE REG TO ORIG ADDRESS        14800002
         LA    R1,MSGHDR                                                14850002
         SR    R5,R1              SUBTRACT BEG OF MSG FROM END          14900002
         STH   R5,MSGHDR          STORE MSG LENGTH                      14950002
         LA    R2,MSGREPLY         LOAD REPLY ADDRESS                   15000002
         ST    R2,MSGREPL          SAVE IN PARM LIST                    15050002
         MVI   MSGREPL,REPLEN4    INSERT MAX REPLY LENGTH               15100002
         LA    R2,MSGECB           LOAD ECB ADDRESS                     15150002
         ST    R2,MSGECBAD         SAVE IN PARM LIST                    15200002
RP130    EQU   *                                                        15250002
         LA    R1,MSGREPL          POINT TO MSG BUFFER                  15300002
         MVI   MSGREPLY,BLANK     BLANK OUR REPLY AREA                  15350002
         MVC   MSGREPLY+ONE(L3),MSGREPLY  REPLY AREA IN CASE OF REISSUE 15400002
         XC    MSGECB,MSGECB      CLEAR THE ECB                         15450002
         WTO   MF=(E,(1))          WRITE MESSAGE TO CONSOLE             15500002
*                                                                       15550002
         WAIT  ECB=(2)                                                  15600002
*                                                                       15650002
         LR    R7,R8              SAVE POINTER TO GOTTEN CORE           15700002
*********************************************************************** 15750002
*        R7 MUST BE SAVED THROUGH ALL FURTHER PROCESSING.               15800002
*        IT CONTAINS THE ADDRESS OF THE GOTTEN CORE.                    15850002
*********************************************************************** 15900002
         OC    MSGREPLY(FOUR),BLANKS  FOLD REPLY TO CAPS          M0115 15950002
         CLC   MSGREPLY,NO        NO - MEANING CANCEL                   16000002
         BE    CABEND2            TAKE NO RESTART PATH           Y02641 16050002
         CLC   MSGREPLY,YES       YES - MEANING IMMEDIATE RESTART/      16100002
         BE    RP160              TAKE RESTART TO OCCUR PATH            16150002
         CLC   MSGREPLY,HOLD      HOLD - MEANING PUT IN HOLD QUEUE      16200002
         BE    RP155              TAKE HOLD PATH WITH CHECK FOR PCP     16250002
         B     RP130               BAD REPLY - GO RETRY MESSAGE         16300002
*                                                                       16350002
*             NO MEANS CANCEL WHICH SETS THE NO RESTART INDICATOR FOR   16400002
*              THIS JOBSTEP                                             16450002
*                                                                       16500002
RP150    EQU   *                                                        16550002
         NI    JCTRSW1,OFFSW1                                           16600002
         OI    JCTRSW2,JCTNORST                                         16650002
         B     RP899              TO FREE MSG BUFFER AND EXIT           16700002
*                                                                       16750002
*             HOLD MEANS OPERATOR DEFERRED RESTART-GO THRU THE MOTIONS  16800002
*              OF RESTART THEN ENQ JOB ON THE HOLD QUEUE                16850002
*                                                                       16900002
RP155    EQU   *                                                        16950002
         L     R5,CVTPTR          PICK UP CVT POINTER                   17000002
         CLI   CVTDCB,PCPSYS      ENVIRONMENT TEST HOLD IN PCP          17050002
         BE    RP150                   MEANS CANCEL                     17100002
         MVI   JCTQIDNT,HOLDQ     INDICATE HOLD QUEUE IN JCT            17150002
         B     RP850              GO TO NORMAL PROCESSING        Y02641 17200002
*                                                                       17250002
*             YES MEANS RESTART - ENQ JOB ON THE INPUT QUEUE            17300002
*                                                                       17350002
RP160    EQU   *                                                        17400002
         MVI   JCTQIDNT,JOBQ                                            17450002
RP850    MVC   JCTSCT(1),SCTSNUMB   INSERT FAILING STEP NUMBER   Y02641 17500002
         MVC   JCTSNUMB(1),SCTSNUMB                            @YM06095 17520002
*                                                                       17550002
         DROP  R8                                                       17600002
*                                                                       17650002
*130000-133500                                                   Y02641 17700002
*                                                                       17750002
         MVC   JCTSSTR,SCTDISKA   RESTART THIS STEP              Y02641 17800002
*135000-213500                                                   Y02641 17850002
         NI    JCTJSB,MASK-JCTJSBTM    TURN OFF TERM BIT IN JCT  Y02641 17900002
         OI    JCTJSB,JCTJSBEX    TURN ON EXEC BIT IN JCT        Y02641 17950002
         LA    R4,QMGR1           LOCATE QUEUE PARAM AREA        Y02641 18000002
         USING IOPARAMS,R4                                       P17035 18050002
         MVI   QMPOP,QMWRTE       WRITE TO SWA                   Y02641 18100002
         OI    QMSTA,QMSJNL       TO JNL JCT AT ANY STATE        Y02641 18150002
         ST    R7,QMPCL           ADDR TO EPA                    Y02641 18200002
         USING ZB506,R7                                          Y02641 18250002
         ST    RA,SWBUFPTR        LOAD JCT ADDR                  Y02641 18260002
         MVC   SWROWVA(THREE),JCTDSKAD  LOAD JCT SVA             Y02641 18300002
         MVI   SWWRTID,X'00'      LOAD BLOCK ID                  Y02641 18350002
         OI    QMPCL,X'01'        WRITE ONE RECORD               Y02641 18400002
         LR    R1,R4              REG 1 POINT TO QMPA            Y02641 18550002
         IEFQMREQ                 SWA MNGR                       Y02641 18600002
         NI    QMSTA,MASK-QMSJNL  TURN OFF QMSJNL BIT          @YM03406 18650002
         TM    JSCBJJSB,JSCBJNLE  TEST FOR JNL ERR               Y02641 18700002
         LR    R8,R7              PTR TO GTMAIN AREA             Y02641 18750002
         MVC   0(FOUR,R8),MSG1    ID OF MSG TO BE ISSUED         Y02641 18800002
         BO    JNL02              TO ISSUE MSG FOR JNL ERR       Y02641 18850002
         MODESET EXTKEY=SUPR      CHANGE KEY TO ZERO             Y02641 18860002
         OI    JSCBJJSB,JSCBJNLN  TURN ON JNL OVERRIDE           Y02641 18900002
         NI    JSCBJJSB,MASK-JSCBJSBT  TURN OFF TERM BIT IN JSCB Y02641 18950002
         OI    JSCBJJSB,JSCBJSBX  TURN ON EXEC BIT IN JSCB       Y02641 19000002
         MODESET EXTKEY=SCHED      RESTORE KEY TO ONE            Y02641 19010002
         OI    QMSTA,X'10'         TURN ON REINTERPRETATION SW   P17035 19050002
* 648723                                                         Y02641 19100002
***************************************************************  Y02641 19108002
*                                                                Y02641 19116002
*   CLEAN UP BEFORE EXIT                                         Y02641 19124002
*                                                                Y02641 19132002
**************************************************************   Y02641 19140002
RP899    DS    0H                 ENTRY TO FREE MSG BUFFER              19150002
         LR    R1,R8              POINTER TO AREA TO R1          Y02641 19200002
         FREEMAIN R,LV=200,A=(1),SP=230  FREE WORK CORE          Y02641 19250002
RP950      DS    0H                                                     19300002
         LR    R1,RD                                                    19310002
         L     RD,4(0,RD)              RESTORE CALLER'S SAVE AREA       19320002
         FREEMAIN R,LV=72,A=(1),SP=230                           Y02641 19330002
         RETURN (14,12),T                                               19400002
HOLDQ    EQU   X'01'                                                    19450002
JOBQ     EQU   X'02'                                                    19500002
MESS1    WTOR  'IEF225D SHOULD         .                               *19550002
                   RESTART',REPLYARE,4,ECBSELF,MF=L,ROUTCDE=(1),       $19600002
               DESC=(2)                                                 19650002
REPLYARE DS    CL4                 REPLY AREA FOR MCS WTOR              19700002
ECBSELF  DS    F                  ECB FOR MOVE TO GOTTEN CORE           19750002
MESS2    EQU   *                                                        19800002
MSGLN    EQU   MESS2-MESS1                                              19850002
ERRMSG1  WTO   'IEF228I          RESTART CANCELED - I/O ERROR SCHEDULER*19900002
                WORK AREA',MF=L,ROUTCDE=(2,11),DESC=(6)                 19950002
ERRMSG2  EQU   *                                                        20000002
ERRMSGLN  EQU  ERRMSG2-ERRMSG1                                          20050002
FZERO    DC    F'0'               WORD OF ZEROS FOR COMPARE             20100002
IEFSQCBS DC    C'SYSIEFSD'        MAJOR NAME                            20150002
IEFQ5QCB DC    C'Q5'              MINOR NAME                            20200002
* 202500                                                                20250002
VCONDS   DC    V(IEFYRCDS)        VCON FOR TABLE OF ELIGIBLE CODES      20300002
* 203500                                                         Y02641 20350002
NO       DC    C'NO  '            CONSTANTS TO                          20400002
YES      DC    C'YES '            COMPARE AGAINST                       20450002
HOLD     DC    C'HOLD'            OPERATOR REPLIES                      20500002
* 205500 - 206000                                                Y02641 20550002
MSG1     DC    C'MG05'            MSG ID FOR JNL ERROR           Y02641 20650002
MSG2     DC    C'MG04'            MSG ID FOR NO JNL              Y02641 20700002
BLANKS   DC    C'    '            FOLDER FOR REPLY                M0115 20750002
PATCH    DC    50C' '             RESERVED PATCH AREA            Y02641 20770002
FOUR     EQU   4                                                  M0115 20800002
ZERO     EQU   0                                                        20850002
ONE      EQU   1                                                        20900002
L1       EQU   1                                                        20950002
TWO      EQU   2                                                        21000002
THREE    EQU   3                                                        21050002
L3       EQU   3                                                        21100002
NINE     EQU   9                                                        21150002
RSTRT    EQU   8                                                        21200002
ZEROES   EQU   8                                                        21250002
TWLVE    EQU   12                                                       21300002
CON17    EQU   17                                                       21350002
L86      EQU   86                                                       21400002
BLANK    EQU   C' '                                                     21450002
PERIOD   EQU   C'.'                                                     21500002
REPLEN4  EQU   4                                                        21550002
OFFSW1   EQU   X'F3'         MASK TO TURN OFF RESTART BITS IN SW1       21600002
MASK     EQU   X'FF'         MASK TO TURN OFF RESTART SWITCHES   Y02641 21650002
*                                                                       21750002
*                                                                       21800002
*                                                                       21850002
         EJECT                                                          21900002
         DS    0D                                                       21950002
MSG      DSECT                                                          22000002
MSGWTOR  DS    CL12               WTOR HEADER AREA                      22050002
         ORG   MSGWTOR            ORG BACK TO DIVIDE AREA               22100002
MSGREPL DS     1C                  REPLY LENGTH                         22150002
MSGREPAD DS    3C                  REPLY AREA ADDRESS                   22200002
MSGECBAD DS   F                    REPLY ECB ADDRESS                    22250002
MSGHDR   DS   F                    MESSAGE HEADER                       22300002
MSGBUF   DS   15C                  1ST OF MESSAGE 'IEF225A SHOULD'      22350002
MSGJOB   DS   CL8                  JOBNAME                              22400002
MSGPT1   DS    C                  SEPARATOR .                           22450002
MSGSTEP  DS   CL8                 STEPNAME                              22500002
MSGPT2   DS    C                  SEPARATOR .                           22550002
MSGPROC  DS   CL8                 PROCSTEP                              22600002
         DS    C                  SEPARATOR                             22650002
MSGCHKID DS    CL16               CHECKPOINT ID                         22700002
         DS    C                  SEPARATOR                             22750002
MSGMSG1  DS    CL7                 'RESTART'                      M0092 22800002
MSGMCS   DS    CL4                 MCS ROUTING AND DEXC CODES     M0092 22850002
MSGREPLY DS    F                   REPLY AREA                     M0092 22900002
MSGLGT   EQU   MSGREPLY-MSGBUF     MESSAGE LENGTH                       22950002
MSGECB   DS    F                   REPLY ECB                            23000002
         DS    0D                                                       23050002
ERRMSG   DSECT                                                          23100002
ERRHDR   DS    F                  MSG LEN + HALFWORD OF ZEROES          23150002
         ORG   ERRHDR             ORG BACK TO DIVIDE HEADER             23200002
         DS    C                  DISPLACEMENT TO LENGTH OF MSG         23250002
ERRLEN   DS    C                  LENGTH OF MESSAGE                     23300002
         DS    H                  MCSFLAG GO HERE                       23350002
ERRMSGID DS    CL8                'IEF228I '                            23400002
ERRJNAME DS    CL8                'JOBNAME '                            23450002
ERRMSGP2 DS    CL50               ' RESTART CANCELLED - IOERR...'       23500002
         DS    0D                                                       23550002
RPCORE   DSECT                                                          23600002
QMRWL    DS    F                  DSECT OF EXTERNAL                     23650002
QMRWT    DS    F                  PARAMETERS FOR                        23700002
TTRSAVE  DS    F                  QUEUE MANAGER                         23750002
READIN   EQU   *                                                        23800002
* 238500 - 239000                                                Y02641 23850002
         EJECT                                                          23950002
LCT      DSECT                                                          24000002
         IEFALLCT                                                       24050002
         EJECT                                                          24100002
JCT      DSECT                                                          24150002
         IEFAJCTB                                                       24200002
         EJECT                                                          24250002
SCT      DSECT                                                          24300002
         IEFASCTB                                                       24350002
         EJECT                                                          24400002
* 2750000 - 2755000                                              Y02641 24450002
* 245000 - 246000                                                Y02641 24500002
CVT      DSECT                                                          24650002
         CVT                                                            24700002
PCPSYS   EQU   X'40'                                                    24750002
         EJECT                                                          24800002
* 248500 - 249500                                                Y02641 24850002
IKJTCB   DSECT                                                   Y02641 25000002
         IKJTCB                                                  Y02641 25050002
         EJECT                                                   Y02641 25100002
* 76130018 - 76170018                                            Y02641 25150002
JSCB     DSECT                                                   Y02641 25200002
         IEZJSCB                                                 Y02641 25250002
         EJECT                                                   Y02641 25300002
         IEFQMNGR                                                Y02641 25350002
         EJECT                                                   Y02641 25400002
JESCT    DSECT                                                   Y02641 25450002
         IEFJESCT                                                Y02641 25500002
         EJECT                                                   Y02641 25550002
         IEFZB506                                                Y02641 25600002
         END                                                            25650002
