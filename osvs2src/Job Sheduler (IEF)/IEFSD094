         TITLE 'IEFSD094 - MVT SYSOUT WRITER JOB SEPARATOR'             00100020
*********************************************************************** 00200020
*                                                                       00300020
*          RELEASE 22 DELETIONS/CHANGES                                 00400020
*          RELEASE 21 DELETIONS/CHANGES                                 00500020
* 109760                                                         A64011 00600020
* 069067                                                         Y00188 00700020
*3524                                                            M3018  00800020
*3524                                                            A41000 00900020
*          RELEASE 20 DELETIONS/CHANGES                                 01000020
*1043                                                            A32649 01100020
* 015000-036000,040612-040760,045200-048400,048600-052600        MAPMAC 01200020
* 066640,066720,067600,068000,109520,109760                      MAPMAC 01300020
* 066440-066900,067200-068200,069005-069027,109280-109920        A32649 01400020
*1043                                                            A35780 01500020
*1043066200,069080                                               M2204  01600020
*                                                                       01700020
*********************************************************************** 01800020
*                                                                     * 01900020
*                                                                     * 02000020
*TITLE-- IEFSD094 - SYSOUT WRITER JOB SEPARATOR ROUTINE               * 02100020
*                                                                     * 02200020
*STATUS CHANGE LEVEL 006                                                02300020
*FUNCTION/OPERATION--                                                 * 02400020
*   THIS ROUTINE AND ITS LOAD MODULE IS USED IN PCP.               SM0I 02500020
*   THIS ROUTINE SEPARATES JOBS IN ONE OF TWO WAYS DEPENDING ON THE   * 02600020
*   OUTPUT DATA SET TYPE :                                            * 02700020
*        1.PRINTER TYPE --- THE JOBNAME AND CLASS WILL BE PRINTED IN  * 02800020
*          BLOCK FORMAT ON TNREE PAGES AND A LINE OF ASTERISKS WILL   * 02900020
*          BE PRINTED TWICE ( OVER PRINTED ) ON THE FOLD PRECEEDING   * 03000020
*          EACH PAGE AND AFTER THE THIRD PAGE CONTAINING THE BLOCK    * 03100020
*          FORM OUTPUT .                                              * 03200020
*        2.PUNCH TYPE --- THE JOBNAME AND CLASS WILL BE PUNCHED IN    * 03300020
*          THE MIDDLE OF THREE CARDS .                                * 03400020
*                                                                     * 03500020
*OPERATION OF THIS MODULE--                                           * 03600020
*ENTRY POINT--                                                        * 03700020
*   IEFSD094 WHICH IS LINKED TO FROM IEFSD078 WHEN A JOB SEPARATOR IS * 03800020
*   SPECIFIED .                                                       * 03900020
*                                                                     * 04000020
*INPUT--                                                              * 04100020
*   REGISTER 1 POINTS TO THE PARAMETER LIST CONTAINING SWITCHES ,     * 04200020
*   ADDRESS OF OUTPUT DCB , ADDRESS OF 8 CHARACTER JOBNAME FIELD ,    * 04300020
*   AND THE ADDRESS OF 1 CHARACTER SYSOUT CLASS .                     * 04400020
*   REGISTER 6 POINTS TO PARLIST WHEN NOT PCP SYSTEM.              SM0I 04500020
*                                                                     * 04600020
*EXIT POINT 0.5 --                                                 VS0H 04700020
*   BRANCH TO IEFSDXXX IF OUTPUT TO BE SPANNED.                    VS0H 04800020
*OUTPUT AT EXIT POINT 0.5 --                                       VS0H 04900020
*        REGISTER 7 POINTS TO THE WORK LIST USED BY DSB AND SMB    VS0H 05000020
*        ROUTINE.                                                  VS0H 05100020
*        REGISTER 8 POINTS TO THE PARAMETER LIST GIVEN TO SMB AND  VS0H 05200020
*        DSB PROCESSING ROUTINES.                                  VS0H 05300020
*                                                                  VS0H 05400020
*EXIT POINT 1 --                                                      * 05500020
*   BRANCH TO IEFSD088 TO DO THE START TRANSITION ROUTINE             * 05600020
*                                                                     * 05700020
*OUTPUT AT EXIT POINT 1 --                                            * 05800020
*   REGISTER 7 POINTS TO THE WORK LIST USED BY DSB AND SMB ROUTINE    * 05900020
*   REGISTER 8 POINTS TO THE WORK AREA FOR STANDARD OUTPUT ROUTINE    * 06000020
*                                                                     * 06100020
*EXIT POINT 2 --                                                      * 06200020
*   BRANCH TO IEFSD089 TO DO THE PUT FOR EACH RECORD                  * 06300020
*                                                                     * 06400020
*OUTPUT AT EXIT POINT 2 --                                            * 06500020
*   REGISTER 7 POINTS TO THE WORK LIST USED BY DSB AND SMB ROUTINE    * 06600020
*   REGISTER 8 POINTS TO THE WORK AREA FOR STANDARD OUTPUT ROUTINE    * 06700020
*                                                                     * 06800020
*EXIT POINT 3 --                                                      * 06900020
*                                                                     * 07000020
*OUTPUT AT EXIT POINT 3 --                                            * 07100020
*   REGISTER 7 POINTS TO THE WORK LIST USED BY DSB AND SMB ROUTINE    * 07200020
*   REGISTER 8 POINTS TO THE WORK AREA FOR STANDARD OUTPUT ROUTINE    * 07300020
*                                                                     * 07400020
*EXIT POINT 4 --                                                      * 07500020
*   BRANCH TO IEFSD095 TO DO THE BLOCK LETTER ROUTINE                 * 07600020
*                                                                     * 07700020
*OUTPUT AT EXIT POINT 4 --                                            * 07800020
*   REGISTER 1 POINTS TO THE PARAMETER LIST CONTAINING THE ADDRESS OF * 07900020
*   CHARACTER TO BE PIT OUT,THE ADDRESS OF THE LINE COUNT,            * 08000020
*   THE ADDRESS OF THE CONSTRUCTION AREA,  AND THE ADDRESS OF THE     * 08100020
*   NUMBER OF CHARACTERS .                                            * 08200020
*                                                                     * 08300020
*EXIT POINT 5 --                                                      * 08400020
*   RETURN TO IEFSD078 IF SYSOUT WORK DONE                            * 08500020
*                                                                     * 08600020
*OUTPUT AT EXIT POINT 5 --                                            * 08700020
*   THE REGISTERS ARE RESTORED TO THERE CONTENTS AS THEY WERE ON      * 08800020
*   LEAVING IEFSD078 EXCEPT REGISTER 15 CONTAINS A RETURN CODE -0-FOR * 08900020
*   CORRECT OPERATION OR -8-FOR UNRECOVERABLE OUTPUT ERROR            * 09000020
*                                                                     * 09100020
*EXTERNAL ROUTINES --                                                 * 09200020
*                                                                     * 09300020
*   IEFSD088   THE TRANSITION ROUTINE                                 * 09400020
*   IEFSD089   THE OUTPUT ROUTINE                                     * 09500020
*   IEFSD89M   MESSAGES FOR IEFSD089                                  * 09600020
*   IEFSD078   SYSOUT WRITER LINK-TO-JOB SEPARATOR-OR-TO-DSB/SMB      * 09700020
*   IEFSD095   BLOCK LETTER ROUTINE                                   * 09800020
*   IEFSDXXX   SPANNED DATASETS ROUTINE                            VS0H 09900020
*                                                                     * 10000020
*                                                                     * 10100020
*                                                                     * 10200020
*                                                                     * 10300020
*ATTRIBUTES - REENTRANT                                               * 10400020
*                                                                     * 10500020
*********************************************************************** 10600020
*                        NEEDED DSECTS                                  10700020
*                                                                       10800020
IEFSD094 CSECT                     FOR EQUATES                   Y00188 10900020
R0       EQU   0                                                        11000020
R1       EQU   1                                                        11100020
R2       EQU   2                                                        11200020
R3       EQU   3                                                        11300020
R4       EQU   4                                                        11400020
R5       EQU   5                                                        11500020
R6       EQU   6                                                        11600020
R7       EQU   7                                                        11700020
R8       EQU   8                                                        11800020
R9       EQU   9                                                        11900020
R10      EQU   10                                                       12000020
R11      EQU   11                                                       12100020
R12      EQU   12                                                       12200020
R13      EQU   13                                                       12300020
R14      EQU   14                                                       12400020
R15      EQU   15                                                       12500020
*DEFINE DCB                                                        VS0H 12600020
         DCBD  DSORG=PS                                            VS0H 12700020
         IEFSDPAR                                                MAPMAC 12800020
JSPARMS  DSECT                                                          12900020
*THE PARMAMETER LIST INPUT TO THIS MODULE                               13000020
PARMLJS  DS    0F                                                       13100020
JSSWTCHS DS    C                       SWITCHES                         13200020
         DS    0F                                                       13300020
JSDCBOUT DS    F                       OUTPUT DCB ADDRESS               13400020
JSNAMEAD DS    F                       JOBNAME FIELD ADDRESS            13500020
JSSYSCLA DS    F                       JOB CLASS ADDRESS                13600020
JSENT078 EQU   JSSWTCHS+1         X'FF' IF ENTRY FROM IEFSD078   A32649 13700020
ENTRY078 EQU   X'FF'              ENTRY SWITCH                   A32649 13800020
JSEND    EQU   *                       END OF PARM LIST                 13900020
         IEFSDWKT                                                MAPMAC 14000020
*THE AREA USED TO BUILD JOB SEPARATOR OUTPUT                     F40172 14100020
OUTAREAS DS    0F                                                F40172 14200020
         DS    30F                                               F40172 14300020
SAVER131 DS    F                   SAVE R13 FOR ENT TO TRAN1     F40172 14400020
SAVER132 DS    F                   SAVE R13 FOR ENT TO PUT       F40172 14500020
SAVER133 DS    F                   SAVE R13 FOR ENT TO TRANS2    F40172 14600020
SAVER134 DS    F                                                 F40172 14700020
SAVETRAN DS    18F                                               F40172 14800020
SAVEPUT  DS    18F                                               F40172 14900020
SAVETRA2 DS    18F                                               F40172 15000020
SAVEPUT2 DS    18F                                               F40172 15100020
ADR3     DS    F                                                 F40172 15200020
ADR11    DS    F                                                 F40172 15300020
OUTAREND EQU   *                        END OF AREA               TTE0K 15400020
         IEFSDSDR                                                MAPMAC 15500020
*EQUATES                                                                15600020
SKIPONE  EQU   9                  MACHINE C/C SINGLE SPACE       F40172 15700020
ASASW    EQU   4                   ASA CONTROL CHARACTER                15800020
MACSW    EQU   2                   MACHINE CONTROL CHARACTER            15900020
VARSW    EQU   64                  VARIABLE SWITCH WHEN NOT FIXED       16000020
FIXSW    EQU   128                 FIXED SWITCH WHEN NOT VARIABLE       16100020
UNKSW    EQU   VARSW+FIXSW         UNKNOWN SWITCH                       16200020
*                                                                     * 16300020
*                   THIS ROUTINE IS THE STANDARD JOB SEPARATOR        * 16400020
*                   ROUTINE WHICH MAY BE USED TO SEPARATE JOBS        * 16500020
*                   IN THE OUTPUT STREAM . IT RECEIVES A FOUR         * 16600020
*                   WORD REGISTER SAVE AREA THE ADDRESS OF            * 16700020
*                   WHICH IS IN REGISTER 1 . THE AREA HAS THE         * 16800020
*                   FOLLOWING APPEARANCE .                            * 16900020
*                                                                     * 17000020
*                    *************************************            * 17100020
*                    *        *        *        *        *            * 17200020
*                    *SWITCHES*        *        *        *            * 17300020
*                    *        *        *        *        *            * 17400020
*                    *************************************            * 17500020
*                    *                                   *            * 17600020
*                    *        ADDRESS OF OUTPUT DCB      *            * 17700020
*                    *                                   *            * 17800020
*                    *************************************            * 17900020
*                    *                                   *            * 18000020
*                    *  ADDRESS OF 8 CHAR. JOBNAME FIELD *            * 18100020
*                    *                                   *            * 18200020
*                    *************************************            * 18300020
*                    *                                   *            * 18400020
*                    *  ADDRESS OF 1 CHAR. CLASS FIELD   *            * 18500020
*                    *                                   *            * 18600020
*                    *************************************            * 18700020
*                                                                     * 18800020
*                   SWITCHES ARE AS FOLLOWS .                         * 18900020
*                                                                     * 19000020
*                    LEFT MOST BIT (128) IS ON IF THE OUTPUT          * 19100020
*                    UNIT IS A 1442 PUNCH                             * 19200020
*                                                                     * 19300020
*                    NEXT BIT (64) IS ON IF THE OUTPUT UNIT           * 19400020
*                    IS A PUNCH OR IF IT IS A TAPE WHICH HAS          * 19500020
*                    A PUNCH AS ITS ULTIMATE DESTINATION              * 19600020
*                                                                     * 19700020
*                    NEXT BIT (32) IS ON IF THE OUTPUT UNIT           * 19800020
*                    IS A PRINTER OR A PUNCH                          * 19900020
*   BRANCH TO IEFSD088 TO DO THE END TRANSITION ROUTINE               * 20000020
*                                                                     * 20100020
*                   A USER MAY WRITE A ROUTINE TO USE INSTEAD         * 20200020
*                   OF THIS . HE WILL HAVE THE ROUTINE IN THE         * 20300020
*                   LINK LIBRARY AND THE PROGRAM NAME IN THE          * 20400020
*                   PARM FIELD OF THE EXEC STATEMENT AND BY           * 20500020
*                   SPECIFYING THE REQUIRED PROCEEDURE NAME           * 20600020
*                   IN THE START COMMAND FOR THE SYSOUT               * 20700020
*                   WRITER . SEE JCL PUBLICATION .                    * 20800020
*                                                                     * 20900020
*                   THE USER MUST FREE ANY CORE HE OBTAINED           * 21000020
*                   DURING THE OPERATION OF HIS ROUTINE . HE          * 21100020
*                   MUST SET UP HIS OWN SYNCHRONOUS ERROR EXIT        * 21200020
*                   ROUTINE AND PLACE ITS ADDRESS IN THE              * 21300020
*                   DCBSYNAD FIELD OF THE OUTPUT DCB . HE MUST        * 21400020
*                   SAVE REGISTERS 0 TO 12 AND 14 IN THE 15 WORD      * 21500020
*                   AREA WHICH STARTS 12 BYTES BEYOND THE LOCATION    * 21600020
*                   IN REGISTER 13 . HE MUST ALSO SAVE REGISTER 13 .  * 21700020
*                                                                     * 21800020
*INITIALIZE                                                             21900020
IEFSD094 CSECT                                                          22000020
*3656065500                                                        SM0I 22100020
* 042600-045000,066600,067000,067800,109400-109800               F40172 22200020
         SAVE  (14,12)             SAVE REGISTERS                       22300020
         BALR  R9,0                SET BASE REGISTER                    22400020
         USING *,R9                                                     22500020
         LPR   R5,R1                    SAVE PARM REGISTER       M22040 22600020
*                                       A3578                    M2204  22700020
         USING PARMLJS,R5                                               22800020
*GET CORE FOR WORK AREA                                          A32649 22900020
         LA    R0,WKSOE-WKSOR+OUTAREND-OUTAREAS+WORKEND-WORKLST  A32649 23000020
*                                  GET SIZE OF WORK AREAS        A32649 23100020
         GETMAIN R,LV=(0)          GET CORE                      A32649 23200020
         USING PARLIST,R6                                          VS0H 23300020
         LR    R8,R1              ESTABLISH WORKSOR ADDRESS      A32649 23400020
         LA    R1,WKSOE-WKSOR(R8) ESTABLISH OUTAREA ADDRESS      A32649 23500020
         LA    R7,OUTAREND-OUTAREAS+WKSOE-WKSOR(R8)              A32649 23600020
*                                 ESTABLISH WORKLIST ADDRESS     A32649 23700020
         USING WKSOR,R8                                          A32649 23800020
         USING OUTAREAS,R1                                       A32649 23900020
         USING WORKLST,R7                                        A32649 24000020
         XC    WORKLST(WORKEND-WORKLST),WORKLST  CLEAR CORE      M2204  24100020
         ST    R13,WOSAP                                                24200020
         XC    16(4,R13),16(R13)                                        24300020
         ST    R13,SRETR           SAVE RETURN REGISTER                 24400020
         LA    R13,SMSVA           GET SAVE AREA ADDRESS                24500020
*IS ENTRY FROM IEFSD078                                          A32649 24600020
         XC    WOXXX(8),WOXXX     CLEAR SPANNING ADDRESSES       A32649 24700020
         TM    JSENT078,ENTRY078  IS ENTRY FROM IEFSD078         A32649 24800020
         BNO   PCP20              NO BYPASS SPANNING CHECK       A32649 24900020
*SAVE THE ADDRESS OF THE SPANNING MODULE AND GOT CORE              VS0H 25000020
         MVC   WOXXX(8),PARXXX                                     VS0H 25100020
*                                                                F40172 25200020
*           INITIALIZE CONTROL CHARACTERS                        F40172 25300020
*                                                                F40172 25400020
         MVI   SAVEC,SKIPONE      INITIALIZE SAVEC               F40172 25500020
         MVI   SAVED,SKIPONE      INITIALIZE SAVED               F40172 25600020
         ST    R6,WOSPS                 SAVE PARLIST ADDRESS     A32649 25700020
PCP20    EQU   *                                                   VS0H 25800020
         LR    R6,R1                                               VS0H 25900020
         DROP  R1                                                  VS0H 26000020
         USING OUTAREAS,R6                                         VS0H 26100020
*CLEAR TRANSITION WRITE SWITCH                                          26200020
         MVI   BCTSW,X'00'         PUT COUNT TO ZERO                    26300020
*TURN OFF SWITCHES                                                      26400020
         MVI   SEGIN,0                 INDICATE FIRST SEGMENT      VS0H 26500020
         MVI   SORS1,0                                                  26600020
         MVI   SORS2,0                  TURN OFF SWITCH          A35780 26700020
         L     R0,JSDCBOUT                                              26800020
         ST    R0,DCBOT                STORE OUTPUT DCB ADDR            26900020
         L     R0,JSSWTCHS                                              27000020
         ST    R0,VARBA                STORE OUTPUT TYPE                27100020
*IS VARIABLE SPANNED OUTPUT                                        VS0H 27200020
         L     R15,WOXXX                GET SPANNED MODULE ADDRESS VS0H 27300020
         LTR   R15,R15                  IF A MODULE NOT PRESENT    VS0H 27400020
         BZ    GOTON                    THEN DONT ENTER IT         VS0H 27500020
*BRANCH TO THE SPANNING MODULE                                     VS0H 27600020
         O     R15,BTWLV                USE 12 TO INDICATE MESSAGE VS0H 27700020
         BALR  R14,R15                  GO TO SPANNING MODULE      VS0H 27800020
GOTON    EQU   *                                                   VS0H 27900020
*DO TRANSITION  ROUTINE                                                 28000020
         ST    R13,SAVER131                                             28100020
         LA    R13,SAVETRAN                                             28200020
         STM   14,12,12(13)                                             28300020
         L     R13,SAVER131                                             28400020
         L     R15,SD88EXIT        GET ADDRESS FOR EXIT                 28500020
         BALR  R14,R15                                                  28600020
         LA    R13,SAVETRAN                                             28700020
         LM    14,12,12(13)                                             28800020
         L     R13,SAVER131                                             28900020
*IS THERE AN UNRECOVERABLE ERROR                                        29000020
         L     R10,WOSAP           GET ADDRESS ERROR RETURN PUT AT      29100020
         TM    19(R10),X'FF'       TEST FOR ERROR IF SO                 29200020
         BNE   UNREIOER            BRANCH TO FREE WORK AREAS            29300020
*IS THERE AN UNOPENED DATA SET                                          29400020
         TM    SORS1,LRERS+INERS   TEST FOR UNOPENED DATA SET           29500020
         BO    SD94EOFX            IF SO BRANCH TO END OF FILE          29600020
*IS THIS PRINTER TYPE UNIT                                              29700020
         TM    VARBA,PUNSH         TEST FOR PUNCH IF SO                 29800020
         BO    PCHRT               BRANCH TO PUNCH ROUTINE              29900020
         L     R2,ONE              SET R2 TO ONE                        30000020
         LR    R3,R2               SET R3 TO ONE                        30100020
         LR    R12,R2              SET R12 TO ONE                       30200020
BACK     LR    R1,R12              IS R12 EVEN IF SO                    30300020
         N     R1,ONE              THIS IS NOT JOBNAME                  30400020
         BM    AROUND                                                   30500020
         L     R10,JSSYSCLA                                             30600020
         L     R11,ONE             GET NUMBER OF CHARACTERS             30700020
         LA    R4,OUTAREAS+54      GET OUT AREA                         30800020
         B     GO                                                       30900020
AROUND   L     R10,JSNAMEAD                                        4686 31000020
         L     R11,EIGHT           GET NUMBER OF CHARACTERS             31100020
         LA    R4,OUTAREAS+10      GET OUT AREA                         31200020
GO       MVI   OUTAREAS,C' '                                            31300020
         MVC   OUTAREAS+1(119),OUTAREAS                                 31400020
         ST    R3,ADR3                                                  31500020
         LA    R3,ADR3                                                  31600020
         ST    R11,ADR11                                                31700020
         LA    R11,ADR11                                                31800020
         GETMAIN  R,LV=24                                          4686 31900020
         ST    R2,16(R1)           SAVE REGISTER TWO               4686 32000020
         LR    R2,R1               SAVE REGISTER ONE               4686 32100020
         CALL  IEFSD095,((10),(3),(4),(11)),MF=(E,(1))             4686 32200020
         LR    R1,R2               RESTORE REGISTER ONE            4686 32300020
         L     R2,16(R1)           RESTORE REGISTER TWO            4686 32400020
* END                                                                   32500020
         FREEMAIN  R,LV=24,A=(1)                                   4686 32600020
         L     R3,ADR3                                             4686 32700020
         L     R11,ADR11                                                32800020
         CR    R3,R2               COMPARE R3 TO 1 IF NOT EQUAL         32900020
         BNE   ARND                BRANCH AROUND                        33000020
*IS THIS JOBNAME                                                        33100020
         LR    R1,R12              IS (R12) EVEN IF SO                  33200020
         N     R1,ONE              THIS IS NOT JOBNAME SO               33300020
         BZ    ARND1               BRANCH AROUND                        33400020
         MVI   CONCH,C'9'               SKIP TO CHANNEL 9 AND WRITE CC  33500020
ASK      L     R1,OTWY                  GET 120                         33600020
         ST    R1,INLSF                 SET LENGTH OF INPUT             33700020
         LA    R1,FANFOLD               GET ADDR OF ASTERISKS           33800020
         ST    R1,INLOC                 SET INPUT ADDR                  33900020
         OI    SORS1,OLDSW              TURN ON OLD SWITCH              34000020
         ST    R13,SAVER132             SAVE R13                        34100020
         LA    R13,SAVEPUT              GET ADDR OF SAVE AREA           34200020
         STM   14,12,12(13)             SAVE REG.S                      34300020
         L     R13,SAVER132             RESTORE R13                     34400020
         L     R15,SD89EXIT             GET ADDR OF PUT ROUTINE         34500020
         BALR  R14,R15                  GO TO PUT OUT ASTERISKS         34600020
         LA    R13,SAVEPUT              GET ADDR OF SAVE AREA           34700020
         LM    14,12,12(13)             RESTORE REG.S                   34800020
         L     R13,SAVER132             RESTORE R13                     34900020
         L     R10,WOSAP                GET ADDR ERROR RETURN PUT AT    35000020
         TM    19(R10),X'FF'            TEST FOR ERROR IF SO            35100020
         BNE   UNREIOER                 BRANCH TO FREE WORK AREAS       35200020
*IS PERMANENT IO ERROR SWITCH ON                                        35300020
         TM    SORS1,INERS              TEST FOR IO ERROR IF SO         35400020
         BO    SD94EOFX                 BRANCH TO END OF FILE           35500020
         TM    CONCH,C'+'               HAS LINE OF ASTERISKS BEEN      35600020
*                                       OVER PRINTED   IF SO            35700020
         BO    WAY                      BRANCH TO OUTPUT JOBNAME AND    35800020
*                                       CLASS IN BLOCK FORM             35900020
         MVI   CONCH,C'+'               NO SKIP AND WRITE CC            36000020
         B     ASK                      GO BACK AND OVER PRINT LINE     36100020
*                                       OF ASTERISKS                    36200020
WAY      MVI   CONCH,C'1'               SKIP TO CHANNEL 1 AND WRITE CC  36300020
         B     OUT                 AND BRANCH OUT                       36400020
ARND1    MVI   CONCH,C'-'          SET CC TO SKIP 3                     36500020
         B     OUT                 AND BRANCH OUT                       36600020
ARND     MVI   CONCH,C' '          SET CC TO SKIP 1                     36700020
OUT      L     R1,OTWY             GET 120                              36800020
         ST    R1,INLSF            SET LENGTH OF INPUT                  36900020
         LA    R1,OUTAREAS         GET INPUT ADDRESS                    37000020
         ST    R1,INLOC            SET ADDRESS OF INPUT                 37100020
         OI    SORS1,OLDSW         TURN ON OLD SWITCH                   37200020
         ST    R13,SAVER132                                             37300020
         LA    R13,SAVEPUT                                              37400020
         STM   14,12,12(13)                                             37500020
         L     R13,SAVER132                                             37600020
         L     R15,SD89EXIT        GET ADDRESS FOR EXIT                 37700020
         BALR  R14,R15                                                  37800020
         LA    R13,SAVEPUT                                              37900020
         LM    14,12,12(13)                                             38000020
         L     R13,SAVER132                                             38100020
*IS THERE AN UNRECOVERABLE ERROR                                        38200020
         L     R10,WOSAP           GET ADDRESS ERROR RETURN PUT AT      38300020
         TM    19(R10),X'FF'       TEST FOR ERROR IF SO                 38400020
         BNE   UNREIOER            BRANCH TO FREE WORK AREAS            38500020
*IS PERMANENT IO INPUT ERROR SWITCH ON                                  38600020
         TM    SORS1,INERS         TEST FOR IO ERROR IF NOT             38700020
         BZ    CONT                BRANCH TO CONT                       38800020
*TURN ON OLD SWITCH                                                     38900020
SD94EOFX OI    SORS1,OLDSW                                              39000020
*FIX NUMBER OF TRANSITION WRITES                                        39100020
         MVI   BCTSW,1             PUT IN ONE FOR PRINTER               39200020
         TM    VARBA,PUNSH         TEST FOR PUNCH IF NOT                39300020
         BZ    DOTRAN              BRANCH TO DO TRANSITION              39400020
         MVI   BCTSW,3             PUT IN 3 FOR PUNCH                   39500020
*DO TRANSITION ROUTINE                                                  39600020
DOTRAN   ST    R13,SAVER133                                             39700020
         LA    R13,SAVETRA2                                             39800020
         STM   14,12,12(13)                                             39900020
         L     R13,SAVER133                                             40000020
         L     R15,SD88EXIT                                             40100020
         BALR  R14,R15                                                  40200020
         LA    R13,SAVETRA2                                             40300020
         LM    14,12,12(13)                                             40400020
         L     R13,SAVER133                                             40500020
*IS DCB SET UP FOR EXCP                                            CC0H 40600020
         L     R1,DCBOT                 GET DCB ADDRESS            CC0H 40700020
         TM    DCBMACRF-IHADCB(R1),X'80' TEST FOR EXCP. IF NOT     CC0H 40800020
         BZ    UNREIOER                 BRANCH AROUND FAKE TRUNC   CC0H 40900020
*FAKE TRUNCATE                                                     CC0H 41000020
         SR    R15,R15                  INDICATE FAKE TRUNC        CC0H 41100020
         L     R4,WOSPS                                          M3018  41200020
         USING PARLIST,R4                                        M3018  41300020
         XC    PARWKSOR,PARWKSOR        TO BYPASS XYZ CC TEST    M3018  41400020
         DROP  R4                                                M3018  41500020
         L     R11,48(0,R1) LOAD REG 11 FROM DCB                   CC0H 41600020
         BALR  R14,R11 LINK TO FAKE PUT ROUTINE                    CC0H 41700020
*DID TRUNC FAIL                                                    CC0H 41800020
         LTR   R1,R1                    TEST FOR ERROR             CC0H 41900020
         BNZ   UNREIOER                 IF NOT BRANCH TO DONE      CC0H 42000020
*PUT IN ERROR INDICATION                                           CC0H 42100020
         L     R10,WOSAP                GET ADDRESS OF ERROR RETURNCC0H 42200020
         MVI   19(R10),8                UNRECOVERABLE ERROR        CC0H 42300020
         B     UNREIOER            BRANCH TO FREE WORK AREAS            42400020
CONT     AR    R3,R2               R3=R3+1                              42500020
         C     R3,THIR             IF R3 IS NOT EQUAL TO 13             42600020
         BNE   BACK                BRANCH TO BACK                       42700020
         L     R3,ONE              SET R3 TO 1                          42800020
         AR    R12,R2              R12=R12+1                            42900020
         C     R12,SEVN            IF R12 IS NOT EQUAL TO SEVEN         43000020
         BNE   BACK                BRANCH BACK                          43100020
         MVI   CONCH,C'9'               SKIP TO CHANNEL 9 AND WRITE CC  43200020
ASK1     L     R1,OTWY                  GET 120                         43300020
         ST    R1,INLSF                 SET LENGTH OF INPUT             43400020
         LA    R1,FANFOLD               GET ADDR OF ASTERISKS           43500020
         ST    R1,INLOC                 SET INPUT ADDR                  43600020
         OI    SORS1,OLDSW              TURN ON OLD SWITCH              43700020
         ST    R13,SAVER132             SAVE R13                        43800020
         LA    R13,SAVEPUT              GET ADDR OF SAVE AREA           43900020
         STM   14,12,12(13)             SAVE REG.S                      44000020
         L     R13,SAVER132             RESTORE R13                     44100020
         L     R15,SD89EXIT             GET ADDR OF PUT ROUTINE         44200020
         BALR  R14,R15                  GO TO PUT OUT ASTERISKS         44300020
         LA    R13,SAVEPUT              GET ADDR OF SAVE AREA           44400020
         LM    14,12,12(13)             RESTORE REG.S                   44500020
         L     R13,SAVER132             RESTORE R13                     44600020
*IS THERE AN UNCORRECTABLE ERROR                                        44700020
         L     R10,WOSAP                GET ADDR ERROR RETURN PUT AT    44800020
         TM    19(R10),X'FF'            TEST FOR ERROR IF SO            44900020
         BNE   UNREIOER                 BRANCH TO FREE WORK AREAS       45000020
*IS PERMANENT IO ERROR SWITCH ON                                        45100020
         TM    SORS1,INERS              TEST FOR IO ERROR IF SO         45200020
         BO    SD94EOFX                 BRANCH TO END OF FILE           45300020
         TM    CONCH,C'+'               HAS LINE OF ASTERISKS BEEN      45400020
*                                       OVER PRINTED   IF SO            45500020
         BO    SD94EOFX                 BRANCH TO END OF FILE           45600020
         MVI   CONCH,C'+'               NO SKIP AND WRITE CC            45700020
         B     ASK1                     GO BACK AND OVER PRINT LINE     45800020
*                                       OF ASTERISKS                    45900020
*DO PUNCH TYPE                                                          46000020
PCHRT    L     R2,ONE              SET R2 TO 1                          46100020
         LR    R3,R2               SET R3 TO 1                          46200020
BACK1    MVI   OUTAREAS,C' '       MOVE BLANKS INTO OUTAREAS            46300020
         MVC   OUTAREAS+1(79),OUTAREAS                                  46400020
         L     R1,8(R5)                 GET ADDRESS OF JOBNAME          46500020
         MVC   OUTAREAS+35(8),0(R1)     MOVE IN JOBNAME                 46600020
         L     R1,12(R5)                GET ADDRESS OF CLASS            46700020
         MVC   OUTAREAS+45(1),0(R1)     MOVE IN CLASS NAME              46800020
         MVI   CONCH,C'V'               MOVE IN CC (STACKER 1)          46900020
         LA    R1,OUTAREAS              GET INPUT ADDRESS               47000020
         ST    R1,INLOC                 SET ADDR OF INPUT               47100020
         OI    SORS1,OLDSW              TURN ON OLD SWITCH              47200020
         L     R1,ETY                   GET LENGTH OF INPUT             47300020
         ST    R1,INLSF                 SET LENGTH OF INPUT             47400020
         ST    R13,SAVER134                                             47500020
         LA    R13,SAVEPUT2                                             47600020
         STM   14,12,12(13)                                             47700020
         L     R13,SAVER134                                             47800020
         L     R15,SD89EXIT             GET ADDR FOR EXIT               47900020
         BALR  R14,R15                                                  48000020
         LA    R13,SAVEPUT2                                             48100020
         LM    14,12,12(13)                                             48200020
         L     R13,SAVER134                                             48300020
*IS THERE AN UNRECOVERABLE ERROR                                        48400020
         L     R10,WOSAP                GET ADDR ERROR RETURN PUT AT    48500020
         TM    19(R10),X'FF'            TEST FOR ERROR IF SO            48600020
         BNE   UNREIOER                 BRANCH TO FREE WORK AREAS       48700020
*IS PERMANENT INPUT ERROR SWITCH ON                                     48800020
         TM    SORS1,INERS              TEST FOR ERROR IF NOT           48900020
         BZ    CONT1                    BRANCH TO CONT1                 49000020
         B     SD94EOFX                 IF SO BRANCH TO EOF             49100020
CONT1    AR    R3,R2                    R3=R3+1                         49200020
         C     R3,FOR                   IF R3 IS NOT EQUAL TO 4         49300020
         BNE   BACK1                    BRANCH TO BACK1                 49400020
         B     SD94EOFX                                                 49500020
*FREE WORK AREAS                                                        49600020
UNREIOER L     R13,SRETR                GET RETURN REGISTER             49700020
         LA    R0,WKSOE-WKSOR+OUTAREND-OUTAREAS+WORKEND-WORKLST  A32649 49800020
         FREEMAIN R,LV=(0),A=(8)  FREE WORK AREAS                A32649 49900020
         DROP  R8,R6,R7                 WKSOR OUTAREAS WORKLST   A64011 50000020
*INDICATE NO SYNAD ROUTINE                                              50100020
         L     R1,JSDCBOUT              GET OUTPUT DCB ADDRESS   A64011 50200020
         USING IHADCB,R1                DCB ADDRESSABILITY       A41000 50300020
         MVC   DCBSYNAD+1(3),ONE+1      PUT ONE IN SYNAD ADDRESS A41000 50400020
*SAVE RETURN INDICATION                                                 50500020
         RETURN (14,12)                 RETURN TO IEF078                50600020
*CONSTANTS                                                              50700020
         DS    0F                                                       50800020
ONE      DC    F'1'                                                     50900020
OTWY     DC    F'120'                                                   51000020
THIR     DC    F'13'                                                    51100020
SEVN     DC    F'7'                                                     51200020
EIGHT    DC    F'8'                                                     51300020
ETY      DC    F'80'                                                    51400020
FOR      DC    F'4'                                                     51500020
BTWLV    DC    X'0C000000'              TO INDICATE MESSAGE INPUT  VS0H 51600020
SD89EXIT DC    V(IEFSD089)              OUTPUT ROUTINE                  51700020
SD88EXIT DC    V(IEFSD088)              TRANSITION ROUTINE              51800020
FANFOLD  DC    120C'*'                                                  51900020
         DS    0F                                                A27785 52000020
         DC    C'SUPERZAP'                                              52100020
         DC    C'SUPERZAP'                                              52200020
         DC    C'SUPERZAP'                                              52300020
         DC    C'SUPERZAP'                                              52400020
         DC    C'SUPERZAP'                                              52500020
         DC    C'SUPERZAP'                                              52600020
         DC    C'SUPERZAP'                                              52700020
         END                                                            52800020
