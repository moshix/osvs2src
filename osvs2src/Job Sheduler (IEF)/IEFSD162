         TITLE 'IEFSD162, DEVICE ALLOCATION INTERFACE ROUTINE'          00050002
IEFSD062 CSECT                                                          00250000
*        SEE CHANGE LEVEL IN PROLOG FOR FLAGGING INFORMATION.           00300002
*                                                                       00340040
* D-STATEMENTS NEAR LABEL SKIPKEY                              @ZA03944 00380040
* C-STATEMENTS NEAR LABEL SKIPKEY                              @ZA03944 00420040
* A-STATEMENTS NEAR LABEL NOTREAL                              @ZA03944 00460040
* C-STATEMENTS NEAR LABEL IEFSD030                             @ZA05831 00500040
* M STATEMENTS FOR PROCESSING UNSUCCESSFUL OPENING OF CATALOGS @ZA07506 00540040
* A STATEMENTS IN OPEN JOBLIB OR STEPLIB AND OPEN FETCHLIB     @ZA07506 00580040
* A STATEMENTS FOR PROCESSING UNSUCCESSFUL OPENING OF CATALOGS @ZA07506 00620040
*   JOBLIBS - STEPLIBS AND FETCHLIBS WITH NEW MSG IEF689I      @ZA07506 00660040
* IEFSD005 C - WRITE TO THE JOURNAL REGARDLESS OF THE ALLOCA-  @ZA08701 00700040
*              TION RETURN CODE FOR SWA CREATE AT WARMSTART.   @ZA08701 00740040
* ALLOCATE C - MOVE CURRENT STEP NUMBER FROM LCT TO JSCBSTEP   @ZA10117 00760040
* A STATEMENTS NEAR LABEL IEFSD035                             @ZA11857 00780040
* A STATEMENTS NEAR LABEL NOTREAL                              @ZA11857 00800040
* DELETED STATEMENTS THAT WERE ADDED FOR @ZA11857              @ZA16879 00830040
* ADDED STATEMENTS NEAR LABEL ALLOCATE                         @ZA16879 00850040
* ADDED STATEMENTS NEAR LABELS SKIPKEY                         @ZA16879 00880040
**********************************************************************  03750002
*                                                                       03800002
*   MODULE NAME= IEFSD062 (IEFSD162)                                    03850002
*                                                                       03900002
*   DESCRIPTIVE NAME= DEVICE ALLOCATION INTERFACE ROUTINE               03910002
*                                                                       03920002
*   COPYRIGHT= NONE                                                     03930002
*                                                                       03940002
*   STATUS = SU7 PTF                                           @ZA16879 03941040
*                                                                       03944002
*   FUNCTION= THIS MODULE INVOKES DEVICE ALLOCATION FOR THE STEP        03946002
*   BEING INITIATED AND OPENS JOBLIB, STEPLIB, AND FETCHLIB.            03946102
*                                                                       03946402
*      OPERATION=                                                       03948002
*      1. CALCULATE THE STEP TIME LIMIT.                                03948102
*                                                                       03948202
*      2. SKIP TO STEP 3 IF NOT A STARTED PROBLEM PROGRAM OR            03948602
*      SYSTEM TASK. THE FOLLOWING PROCESSING IS DONE SO A               03948702
*      STARTED TASK CAN BE CANCELED WHILE IN ALLOCATION.                03949102
*                                                                       03949502
*         A. IF A TASKNAME (ID) WAS SPECIFIED ON THE START              03949902
*         COMMAND, MOVE THAT ID FROM THE SCT PROCSTEP NAME              03954102
*         FIELD TO THE SCT STEPNAME FIELD AND CLEAR THE SCT             03956102
*         PROCSTEP NAME FIELD. THEN CONTINUE WITH STEP 3.               03958202
*                                                                       03961002
*         B. IF NO ID WAS SPECIFIED (INDICATED BY A PROCSTEP            03963002
*         NAME OF STARTING) READ IN THE SIOT'S FOR THE STEP UNTIL       03965002
*         AN IEFRDER SIOT IS FOUND. IF NO IEFRDER SIOT IS FOUND,        03967002
*         SKIP TO STEP D. IF AN IEFRDER SIOT IS FOUND BUT IT            03967402
*         CONTAINS NO UNIT TYPE, CONTINUE WITH STEP D.                  03967802
*                                                                       03968202
*         C. IF A UNIT TYPE IS FOUND IN THE IEFRDER SIOT, MOVE          03968602
*         THE UNIT TYPE TO THE SCT STEPNAME FIELD AND TO CHKEY.         03968702
*         CONTINUE WITH STEP E.                                         03968802
*                                                                       03968902
*         D. MOVE THE JOBNAME FROM THE JCT TO CHKEY AND TO THE          03969102
*         SCT STEPNAME FIELD.                                           03969202
*                                                                       03969302
*         E. CLEAR THE SCT PROCSTEP NAME FIELD. SET AN                  03969402
*         INDICATOR IN THE LCT WHICH MEANS THAT A TASKNAME WAS          03969502
*         NOT ON THE COMMAND. MOVE THE VALUE IN CHKEY TO THE            03969602
*         CURRENT TASK'S TIOT'S STEPNAME FIELD. (CHKEY IS SET           03969702
*         EITHER IN STEP C OR D.)                                       03969802
*                                                                       03969903
*      2A.  CALL THE SUBSYSTEM TO NOTIFY OF STEP INITIATION.   @Y02BPSR 03971203
*      IF THE REGISTER 15 RETURN CODE DOES NOT INDICATE        @Y02BPSR 03980803
*      'SUCCESSFUL CALL' OR ' FUNCTION NOT SUPPORTED BY        @Y02BPSR 03985803
*      SUBSYSTEM', ISSUE 0BA ABEND.                            @Y02BPSR 03990803
*                                                                       03996103
*      3. TO PERFORM PROCESSING REQUIRED FOR CHECKPOINT          Y02641 03996603
*      RESTART, CALL IEFXB604. IEFXB604 WILL SET JOB STATUS      Y02641 03997103
*      BITS AS REQUIRED TO INDICATE THE STEP HAS ENTERED         Y02641 03997603
*      ALLOCATION AND WRITE THE STEP HEADER RECORD.              Y02641 03998603
*                                                                       03999003
*      4. GET STORAGE FOR A 72-BYTE SAVEAREA AND A 24-BYTE              03999703
*      PARAMETER AREA FOR ALLOCATION.  MOVE THE STEP NUMBER TO @ZA10117 04000040
*      JSCBSTEP FROM LCTSNUMB.                                 @ZA10117 04000340
*                                                                       04001303
*      5. BALR TO DEVICE ALLOCATION (IEFW21SD). IF NOT ALREADY @Z40FPPJ 04001840
*      CANCELABLE, MARK THE CSCB CANCELABLE BEFORE THE LINK AND         04003303
*      RESTORE IT AFTER CONTROL IS RETURNED. UPON RETURN, FREE          04003803
*      THE SAVEAREA.                                                    04004303
*                                                                       04005303
*      6. IF THE RETURN CODE FROM ALLOCATION IS NON-ZERO, SET           04006303
*      THE ALLOCATION ERROR CODE IN THE IEL.                            04006840
*                                                                       04007340
*                                                                       04007440
*         A. TURN OFF THE 'NO JOURNALING' SWITCH IN THE JSCB   @ZA08701 04007540
*            (IN CASE IT IS ON).                               @ZA08701 04007640
*                                                                       04007740
*         B. CALL THE JOURNAL WRITE ROUTINE (IEFXB500) TO      @ZA08701 04008240
*            JOURNAL THE CONTROL BLOCKS FOR THE JOB STEP.      @ZA08701 04008340
*            STEPS THAT ARE NOT EXECUTED MUST BE JOURNALED     @ZA08701 04008440
*            AS WELL AS STEPS THAT ARE EXECUTED SO THAT THE    @ZA08701 04008540
*            JOURNAL MERGE ROUTINE (IEFXB601) CAN RESOLVE THE  @ZA08701 04008640
*            ADDRESSES IN THE NEW SWA.                         @ZA08701 04009240
*                                                                       04009340
*         C. THEN CONTINUE WITH STEP 23.                         Y02665 04009440
*                                                                       04009540
*                                                                       04009640
*      7. IF NOT A STARTED TASK, SKIP TO STEP 8. THE FOLLOWING          04010240
*      DESCRIBES HOW CHKEY IS SET UP SO THAT THE TASK CAN BE            04010303
*      CANCELED WHILE IT IS RUNNING.                                    04011303
*                                                                       04011803
*         A. SCAN THE NEWLY CREATED TIOT FOR AN IEFRDER ENTRY.          04012303
*         IF NO IEFRDER IS FOUND, SKIP TO STEP C. IF AN IERFRDER        04013303
*         IS FOUND, MOVE THE UCB NAME TO CHUNIT.                        04014303
*                                                                       04015303
*         B. IF THE LCT SWITCH INDICATES A TASKNAME WAS                 04015803
*         SPECIFIED ON THE START COMMAND, CONTINUE WITH STEP 8.         04016303
*         OTHERWISE, MOVE THE UCB NAME TO CHKEY. CONTINUE WITH          04017303
*         STEP D.                                                       04018003
*                                                                       04018703
*         C. CONTINUE WITH STEP 8 IF THE LCT INDICATES A                04019403
*         TASKNAME WAS SPECIFIED ON THE START COMMAND.                  04020103
*         OTHERWISE, MOVE CHCLS TO CHKEY.                               04020803
*                                                                       04021503
*         D. MOVE THE ID AT CHKEY TO THE STEPNAME FIELD OF BOTH         04022203
*         THE CURRENT AND NEW TIOT'S.                                   04022903
*                                                                       04023603
*      8. THE FOLLOWING PROCESSING IS PERFORMED TO SUPPORT       Y02641 04025803
*      CHECKPOINT/RESTART:                                       Y02641 04025903
*                                                                       04026703
*         A. TURN OFF THE JOB STATUS INDICATORS IN THE JCT AND   Y02641 04027540
*         JSCB AND SET JCTJSBX AND JSCBJSBX TO INDICATE THAT THE Y02641 04033303
*         JOB STEP HAS COMPLETED ALLOCATION.                     Y02641 04034403
*                                                                       04034903
*      8A. IF THE LCT INDICATES 'DISALLOW CHECKPOINT RESTART,'   Y02641 04035503
*      CONTINUE WITH STEP 9 (BECAUSE ANY SPECIAL PROCESSING      Y02641 04036603
*      REQUIRED SHOULD HAVE ALREADY BEEN DONE). OTHERWISE, TURN  Y02641 04037703
*      OFF THE TCB FLAG WHICH INDICATES 'SUPPRESS CHECKPOINTS.'  Y02641 04038203
*      (THE INDICATOR MAY HAVE BEEN SET IN THE INITIATOR TCB FOR Y02641 04038803
*      THE PREVIOUS STEP.) IF THE SCT INDICATES THAT CHECKPOINTS Y02641 04039903
*      ARE TO BE SUPPRESSED FOR THIS STEP, THEN SET THE          Y02641 04041003
*      CORRESPONDING INDICATOR IN THE TCB. (THE INDICATOR WILL   Y02641 04041503
*      BE PROPOGATED TO THE JOB STEP TCB BY ATTACH.)             Y02641 04042103
*                                                                       04043203
*      9. WRITE THE JCT AND SCT TO SWA (LOCATE MODE), SO THEY   YM01566 04043703
*      WILL BE JOURNALED.                                       YM01566 04044303
*                                                                       04045403
*      10. READ THE SCT EXTENSION BLOCK (WHICH CONTAINS THE USER        04046503
*      PARM FIELD).                                                     04047003
*                                                                       04047603
*      11. GET STORAGE FOR THE ATTACH PARAMETER LIST AND                04048703
*      IEFPARAM. AFTER INITIALIZING IEFPARAM (INCLUDING THE P/P  Y02653 04049803
*      TIOT POINTER, STORE A POINTER TO IEFPARAM IN THE STAE     Y02653 04050303
*      EXIT PARAMETER LIST.                                      Y02653 04050903
*                                                                       04052003
*      12. PUT THE JOB STEP TIOT POINTER IN THE INITIATOR TCB.          04052503
*      CLEAR THE INDICATORS IN THE STEPL WHICH TELL WHETHER      Y02653 04053103
*      JOBLIB, STEPLIB OR FETCHLIB WAS THE LAST LIBRARY OPENED.  Y02653 04054203
*                                                                       04055303
*      13. IF JSCBPCC IS ZERO, SKIP TO STEP 14. (IF THERE ARE NO Y02665 04055803
*      PCCB'S AT THIS POINT, THERE WILL BE NO CATALOGS TO OPEN.) Y02665 04056403
*      IF THERE ARE PCCB'S, CALL IEFICATL TO INVOKE IEFAB4F5 TO  Y02665 04057503
*      OPEN CATALOGS AND UPDATE THE PCCB CHAIN.                  Y02665 04058603
*                                                                       04059403
*      13A. IF THE RETURN CODE IN REGISTER 15 IS NON-ZERO, THEN  Y02665 04059703
*      DO THE FOLLOWING PROCESSING FOR A CATALOG ERROR. (A       Y02665 04060803
*      CATALOG ERROR IS TREATED THE SAME AS AN ALLOCATION        Y02665 04061303
*      ERROR.)                                                   Y02665 04061903
*                                                                       04063003
*         A. RESTORE THE INITIATOR TIOT POINTER.                 Y02665 04064103
*                                                                       04064603
*         B. FREE IEFPARAM AND THE ATTACH PARAMETER LIST.        Y02665 04065203
*                                                                       04066303
*         C. FREE THE STORAGE USED FOR THE USER PARMS.           Y02665 04067403
*                                                                       04067903
*         D. SET THE ALLOCATION ERROR RETURN CODE IN THE IEL     Y02665 04068503
*         AND THE ALLOCATION ERROR INDICATOR IN THE LCT.         Y02665 04069603
*                                                                       04070103
*         E. SET THE JOB FAILED INDICATOR IN THE LCT.            Y02665 04070703
*                                                                       04071803
*         F. CONTINUE WITH STEP 23.                              Y02665 04072903
*                                                                       04073403
*      14. OPEN THE DCB'S FOR JOBLIB, STEPLIB, AND FETCHLIB AS          04074003
*      FOLLOWS. WHEN OPENING ANY LIBRARY, INDICATE IN THE STEPL  Y02653 04075103
*      THAT THE LAST LIBRARY OPENED WAS JOBLIB, STEPLIB, OR      Y02653 04076203
*      FETCHLIB. THIS IS SO IEFIB621 CAN SET THE CORRESPONDING   Y02653 04076703
*      INDICATOR IN IELRTNCD IF THERE WAS AN ABEND RESULTING     Y02653 04077303
*      FROM AN OPEN.                                             Y02653 04078403
*                                                                       04078903
*         A. OPEN STEPLIB OR JOBLIB IF PRESENT (IF BOTH EXIST,          04079503
*         ONLY STEPLIB IS OPENED).                                      04080603
*                                                                       04081703
*         B. OPEN FETCHLIB IF PRESENT.                                  04082203
*                                                                       04082803
*      14A. IF THE OPEN BIT IS NOT SET UPON RETURN FROM THE    @ZA07506 04082940
*      SVC, MESSAGE IEF689I WILL BE ISSUED TO THE PROGRAMMER   @ZA07506 04083040
*      AND THE JOB WILL BE FAILED.                             @ZA07506 04083140
*                                                                       04083240
*      14B. RESTORE TIOT POINTER IN THE INITIATOR'S TCB TO SAME         04083340
*      CONDITION AS BEFORE THE OPEN'S.                                  04085003
*                                                                       04085503
*      15. FREE THE 24-BYTE PARAMETER LIST GOTTEN FOR ALLOCATION.       04086103
*                                                                       04087203
*      16. IF THE LCT INDICATES THAT ONE OR MORE SPECIAL         Y02656 04087703
*      PROPERTIES HAVE BEEN ASSIGNED TO THE                      Y02656 04088303
*      JOB STEP, AND A JOBLIB OR STEPLIB IS PRESENT, CHECK THE   Y02656 04089403
*      DEB TO DETERMINE WHETHER THE LIBRARY IS DEFINED TO        Y02656 04090603
*      CONTAIN AUTHORIZED PROGRAMS. IF NOT AUTHORIZED,           Y02656 04090803
*      SUBSTITUTE THE 'NORMAL' PROBLEM PROGRAM ATTRIBUTES FOR    Y02656 04091603
*      THE FOLLOWING SPECIAL PROPERTIES:                         Y02656 04092703
*         NON-CANCELABLE                                         Y02656 04093803
*         REQUIRES SPECIAL PROTECT KEY                           Y02656 04094303
*         AUTHORIZED TO BE NON-SWAPPABLE                         Y02656 04094903
*         PRIVILEGED                                             Y02656 04096003
*         SYSTEM TASK                                            Y02656 04096503
*         NO DATA SET INTEGRITY                                  Y02656 04097103
*         CPU-TASK AFFINITY                                      Y02651 04098203
*         BYPASS PASSWORD PROTECTION                             Y02656 04099303
*         AUTHORIZED TO USE PREFERRED STORAGE (FIRST,SECOND,   @ZA16879 04099440
*              NOT SECOND LEVELS)                              @ZA16879 04099540
*                                                                       04099803
*      IF NOT AUTHORIZED,                                               04100403
*      SET THE INDICATOR IN THE LCT WHICH INDICATES THIS         Y02656 04101503
*      MODULE SHOULD ISSUE MESSAGE IEF188I PROBLEM PROGRAM       Y02656 04102603
*      ATTRIBUTES ASSIGNED.                                      Y02656 04103103
*                                                                       04103703
*      17. IF THE TASK IS A SYSTEM TASK (INDICATED BY THE LCT)   Y02652 04104803
*      SET THE LCT INDICATOR WHICH MEANS 'DON'T TIME THIS TASK.' Y02652 04105303
*                                                                       04105903
*      18. IF THE LCT INDICATES 'DON'T TIME THIS TASK,' SET      Y02652 04107003
*      THE TIME LIMIT IN LCTTMWRK+4 TO THE EQUIVALENT OF 24      Y02652 04108103
*      HOURS. (THE LCT INDICATOR MAY HAVE BEEN SET WHEN THE      Y02652 04108603
*      IEL OPTION SWITCHES WERE MOVED TO THE LCT OR IN STEP 17   Y02652 04109203
*      ABOVE.)                                                   Y02652 04110303
*                                                                       04111403
*      19. IF THE LCT INDICATES 'NO DATA SET INTEGRITY,' ISSUE   Y02652 04111903
*      GENERIC DEQ TO ELIMINATE DATA SET INTEGRITY FOR THAT JOB. Y02652 04112503
*                                                                       04113603
*      20A.  IF BYPASS PASSWORD PROTECTION IS REQUIRED, SET    @ZA03944 04117540
*      THE INDICATOR IN THE JSCB. (THE JSCBPASS BIT.)          @ZA03944 04117640
*                                                                       04117740
*      21. IF THE CORRESPONDING INDICATOR IN THE LCT IS ON,      Y02656 04118003
*      ISSUE MESSAGE IEF188I PROBLEM PROGRAM ATTRIBUTES          Y02656 04119103
*      ASSIGNED.                                                 Y02656 04120203
*                                                                       04120703
*      22. EXIT TO IEFSD103.                                            04121303
*                                                                       04122403
*      23. FREE THE GETPART WORK TABLE IF IT EXISTS. THEN EXIT   Y02665 04122903
*      TO IEFSD164.                                              Y02665 04123503
*                                                                       04124603
*   NOTES                                                               04125703
*                                                                       04126203
*      CHARACTER CODE DEPENDENCIES= NONE                                04126803
*                                                                       04127803
*      DEPENDENCIES= NONE                                               04129003
*                                                                       04129503
*      RESTRICTIONS= NONE                                               04130103
*                                                                       04131203
*      REGISTER CONVENTIONS= STANDARD                                   04131703
*                                                                       04132303
*      PATCH-LABEL= PATCH                                               04133403
*                                                                       04134503
*   MODULE TYPE= PROCEDURE                                              04135003
*                                                                       04135603
*      PROCESSOR= ASSEMBLER (XF)                                        04136703
*                                                                       04137803
*      MODULE SIZE= 4096 BYTES                                          04138303
*                                                                       04138903
*      ATTRIBUTES= PAGED LPA, ZERO PSW PROTECT KEY, REENTRANT           04140003
*      REUSABLE, REFRESHABLE, SUPERVISOR STATE                          04140503
*                                                                       04141103
*   ENTRY POINT= IEFSD062                                               04142203
*                                                                       04143303
*      PURPOSE= SAME AS FUNCTION                                        04143803
*                                                                       04144403
*      LINKAGE= FROM IEFSD102 VIA BRANCH                                04145503
*                                                                       04146603
*      INPUT DATA=                                                      04147103
*      REGISTER 1 POINTS TO LCT                                         04147703
*      JSCB (POINTED TO BY LCT)                                         04148803
*      JCT (POINTED TO BY LCT)                                          04149303
*      SCT (POINTED TO BY LCT)                                          04149903
*      DEB (POINTED TO BY DCB)                                          04151003
*                                                                       04152103
*      REGISTERS SAVED= NONE                                            04152603
*                                                                       04153203
*      REGISTER CONTENTS DURING PROCESSING=                             04154303
*      REGISTER 8 POINTS TO LCT                                         04155403
*                                                                       04155903
*      REGISTERS RESTORED= NONE                                         04156503
*                                                                       04157603
*   EXIT - NORMAL= TO IEFSD103, VIA BALR                                04158103
*                                                                       04158703
*      CONDITIONS= ALWAYS, UNLESS NON-ZERO RETURN CODE FROM             04159803
*      ALLOCATION                                                       04160903
*                                                                       04161303
*      OUTPUT DATA= REGISTER 1 POINTS TO IEFPARAM, WHICH CONTAINS       04162003
*      THE FOLLOWING INFORMATION:                                       04163103
*         POINTER TO USER PARM FIELD                                    04164203
*         POINTER TO EMPTY ATTACH LIST                                  04164703
*         POINTER TO TIOT POINTER                                       04165303
*         POINTER TO CURRENT TCB                                        04166403
*         POINTER TO LCT                                                04166903
*         ECB LIST                                                      04167503
*         POINTER TO FETCHLIB DCB                                       04168603
*      THE LCT CONTAINS A POINTER TO THE OPEN JOBLIB/STEPLIB DCB        04169803
*      JOB STATUS BITS ARE SET IN THE JCT AND JSCB               Y02641 04169903
*      THE JOURNAL OF THE STEP'S CONTROL BLOCKS IS CREATED BY    Y02641 04170703
*         THE SUBROUTINES IEFXB604 AND IEFXB500                  Y02641 04171503
*                                                                       04172303
*      RETURN CODES= NONE                                               04173103
*                                                                       04174003
*   EXIT - ERROR=                                                       04175203
*                                                                       04175703
*      TO IEFSD164 VIA BRANCH                                           04176303
*                                                                       04177403
*      CONDITIONS= NON-ZERO RETURN CODE FROM ALLOCATION                 04178503
*      OR IEFICATL, THE ALLOCATE CATALOG CONTROL INTERFACE       Y02665 04179003
*      ROUTINE.                                                  Y02665 04179603
*                                                                       04180703
*      OUTPUT DATA=                                                     04181803
*      RETURN CODE SET IN IEL TO INDICATE ALLOC. ERROR.                 04182303
*      ALLOC. ERROR INDICATOR IS SET IN LCTOPSW3.                       04182903
*      THE PARAMETER LIST RETURNED FROM ALLOC. IS PASSED IN             04183903
*         REGISTER 1. (FIRST WORD OF LIST POINTS TO LCT.)               04184903
*      IF A CATALOG FAILURE, THE JOB FAILED INDICATOR IN THE     Y02665 04185103
*         LCT IS SET.                                            Y02665 04186203
*                                                                       04187303
*   EXTERNAL REFERENCES=                                                04187803
*                                                                       04188403
*      ROUTINES=                                                        04189503
*      IEFXB604, TO WRITE STEP HEADER RECORD                     Y02641 04190603
*      INPUT IS LCT POINTER                                      Y02641 04191103
*      LINKAGE IS VIA BALR                                       Y02641 04191703
*                                                                       04192803
*      IEFW21SD, DEVICE ALLOCATION                                      04193303
*      INPUT IS A 24-BYTE PARAMETER LIST POINTED TO DIRECTLY BY         04193903
*         REGISTER 1, WHICH CONTAINS POINTERS TO THE LCT AND JCT        04195003
*      LINKAGE IS VIA BALR IF SU 4 IS INSTALLED                @ZA16879 04195540
*      LINKAGE IS VIA LINK IF SU4 IS NOT INSTALLED             @ZA16879 04195840
*                                                                       04196803
*      IEFQMRAW, TO READ SIOT AND SCTX                                  04197603
*      INPUT IS QMPA                                                    04198403
*      LINKAGE IS VIA BALR                                              04199203
*                                                                       04200003
*      IEFXB500, TO JOURNAL THE JOB STEP'S CONTROL BLOCKS WHEN   Y02641 04200803
*         ALLOCATION IS COMPLETE                                 Y02641 04201603
*      INPUT IS A LIST CONTAINING                                Y02641 04202403
*         AN INDICATOR TO 'JOURNAL A CHAIN OF CONTROL BLOCKS'    Y02641 04203203
*         POINTER TO LCT                                         Y02641 04204003
*      LINKAGE IS VIA BALR                                       Y02641 04204803
*                                                                       04205603
*      IEFICATL, TO HAVE CATALOGS OPENED                         Y02665 04206602
*      INPUT IS A POINTER TO THE INITIATOR'S JSCB                Y02665 04208602
*      LINKAGE IS VIA BALR                                       Y02665 04210602
*                                                                       04212602
*      SWA MANAGER LOCATE MODE, TO WRITE THE JCT AND SCT        YM01566 04214602
*      INPUT IS A CODE OF WL AND AN EPA PTR.                    YM01566 04215002
*      LINKAGE IS VIA THE JESCT                                 YM01566 04215402
*                                                                       04215603
*      SUBSYSTEM INTERFACE TO NOTIFY THE SUBSYSTEM OF STEP     @Y02BPSR 04215903
*         INITIATION                                           @Y02BPSR 04219203
*      INPUT IS AN 'SI' SSOB                                   @Y02BPSR 04221403
*      LINKAGE IS VIA IEFSSREQ                                 @Y02BPSR 04223403
*                                                                       04225803
*      DATA AREAS= IEFIB650 (CONTAINS MESSAGE TEXTS), JESCT      Y02656 04226903
*         SSOB                                                 @Y02BPSR 04229103
*                                                                       04230103
*      CONTROL BLOCKS= DCB, CSCB, IEZATTCH, LCT, JCT, SCT, TIOT,        04232403
*      UCB, SIOT, TCB, JSCB, IEL, ASCB                           Y02665 04235703
*                                                                       04241203
*      TABLES=                                                          04243203
*      IEFPARAM (PARAMETER LIST BETWEEN INITIATOR MODULES)              04246603
*      STEPL (STAE EXIT PARAMETER LIST, FOR INITIATOR ESTAE)     Y02653 04248603
*      QMPA                                                             04253003
*      GETPART WORK TABLE (GWT)                                         04255003
*                                                                       04257703
*      MACROS= GETMAIN, FREEMAIN, DEQ, OPEN, IEFSSREQ,         @ZA16879 04259740
*              LINK (USED IN NON SU 4 ENVIRONMENT ONLY)        @ZA16879 04260740
*                                                                       04264403
*      ENQUEUE RESOURCES=                                               04267103
*      GENERIC DEQ IS ISSUED AGAINST SYSDSN IF DATA SET          Y02652 04271803
*      INTEGRITY IS TO BE TURNED OFF.                            Y02652 04273803
*                                                                       04276503
*      CHANGE LEVEL= SEE MODID MACRO                                    04281203
*      CODE HAS BEEN ADDED FOR THE FOLLOWING SUPPORT CODES:             04285903
*                                                                Y02641 04287903
*                                                                Y02652 04290603
*                                                                Y02653 04295303
*                                                                Y02656 04297303
*                                                                Y02665 04300003
*                                                                Y02669 04302003
*                                                                Y02651 04304003
*                                                              @Y02BPSR 04306003
*                                                              @Z40FPPJ 04307040
*                                                                       04308003
*      CODE HAS BEEN ADDED FOR THE FOLLOWING APARS:                     04308240
*                                                              @ZA03944 04308440
*                                                              @ZA05831 04308640
*                                                              @ZA07506 04308840
*                                                              @ZA08701 04309040
*                                                              @ZA10117 04309240
*                                                              @ZA11857 04309440
*                                                              @ZA16879 04309840
*   MESSAGES= IEF188I PROBLEM PROGRAM ATTRIBUTES ASSIGNED        Y02656 04310003
*             IEF689I JOB JJJJJJJJ FAILED DDDDDDDD DID NOT     @ZA07506 04310640
*                     OPEN                                     @ZA07506 04311240
*   CODES = 0BA                                                @Y02BPSR 04312003
*                                                                       04314003
**********************************************************************  04316003
         EJECT                                                          04318003
R0       EQU   0                                                        04320003
R1       EQU   1                                                        04322003
R2       EQU   2                                                        04324003
R3       EQU   3                                                        04326003
R4       EQU   4                                                        04328003
R5       EQU   5                                                        04330003
R6       EQU   6                                                        04332003
R7       EQU   7                                                        04350000
R8       EQU   8                                                        04400000
R9       EQU   9                                                        04450000
R10      EQU   10                                                       04500000
R11      EQU   11                                                       04550000
R12      EQU   12                                                       04600000
R13      EQU   13                                                       04650000
R14      EQU   14                                                       04700000
R15      EQU   15                                                       04750000
         EJECT                                                          04800000
         BALR  R12,0                                                    04850000
         USING IOPARAMS,R9                                              04900000
         USING  IEFLOT,R8                                               04950000
         USING IEFJCT,R7                                                05000000
         USING IEFSCT,R6                                                05050000
         USING IEFCSCB,R5                                               05100000
         USING *,R12                                                    05150000
IEFSD162 MODID                                                   Y01886 05200000
*********************************************************************** 05250000
         EJECT                                                          05300000
         LR    R8,R1                    ADDRESS OF LCT                  05900000
         L     R6,LCTSCTAD              ADDR OF SCT.               CR17 05950000
         L     R7,LCTJCTAD         JCT ADDRESS FROM LCT            I272 06000000
         LA    R9,QMGR1                LOAD ADDR OF QMGR PARAM AREA     06050000
*                                                                       06750000
*THE FOLLOWING SECTION OF CODE WHICH CALCULATES THE STEP TIME    A41879 06800000
*HAS BEEN MOVED FROM A POSITION AFTER THE LINK TO ALLOCATION     A41879 06850000
*TO THIS POSITION BEFORE THE LINK. IEFVKIMP NEEDS THE            A41879 06900000
*INFORMATION CALCULATED BY THIS ROUTINE FOR PART OF ITS          A41879 06950000
*DETERMINATION IF THE PRESENT STEP SHOULD BE RUN.                A41879 07000000
STEPTIME LA    R1,LCTTMWRK+4     2ND WORD OF TIMER AREA          A41879 07050000
*        CLEAR THE TIME USED FIELDS IN THE LCT IN CASE THEY     YM08110 07053002
*        ARE NOT RE-INITIALIZED IN THE NORMAL MANNER. THIS      YM08110 07056002
*        COULD HAPPEN IN ONE OF THE FOLLOWING WAYS:             YM08110 07059002
*              - A STEP IS NOT TIMED                            YM08110 07062002
*              - A STEP IS NOT ATTACHED BECAUSE OF A GETPART    YM08110 07065002
*                ERROR                                          YM08110 07068002
*              - NORMAL PROCESSING IS SKIPPED BECAUSE THE       YM08110 07071002
*                ESTAE EXIT ROUTINE RECEIVES CONTROL FOR SOME   YM08110 07074002
*                REASON.                                        YM08110 07077002
*        (CURRENTLY IEFSD161 CLEARS THE TASK TIME BETWEEN       YM08110 07080002
*        JOBS. IEFSD263 CLEARS THE TASK TIME BETWEEN STEPS      YM08110 07083002
*        FOR THE FIRST 2 CASES, BUT NOT THE THIRD CASE.         YM08110 07086002
*        WITHOUT THIS FIX, THE SRB TIME WOULD NOT BE CLEARED    YM08110 07089002
*        FOR ANY OF THESE SITUATIONS.)                          YM08110 07092002
         XR    R5,R5                                            YM08110 07095002
         ST    R5,LCTTSTU4                                      YM08110 07100002
         ST    R5,LCTTSRB4                                      YM08110 07110002
         CLC   SCTSTIME,CF0      IS THIS A PROC STEP             A41879 07120002
         BE    STEPLEFT          THE USER SPECIFIED TIME=        A41879 07150000
*                                FOR THE WHOLE PROC. THAT        A41879 07200000
*                                APPLIED TO 1ST STEP. NOW        A41879 07250000
*                                WE SHALL USE WHAT IS LEFT.      A41879 07300000
         MVC   1(3,R1),SCTSTIME  ELSE MOVE IN TIME               A41879 07350000
STEPLEFT EQU   *                                                 A41879 07400000
         MVC   SCTSTIME(3),1(R1) MOVE TIME REMAINING TO SCT      A41879 07450000
         MVI   LCTTMWRK+DEC8,HEX00  IND THAT TIME VALUE IS       A41879 07500000
*                                   FOR STEP                     A41879 07550000
         L     R14,JCTJMRTL      GET JOB TIME LIMIT              A41879 07600000
         SRL   R14,DEC8                                          A41879 07650000
         LTR   R14,R14           IS THERE A JOB TIME LIMIT       A41879 07700000
         BZ    IEFSD022          NO,USE STEP TIME IN SCT         A41879 07750000
         CL    R14,HOURS24       DOES ORIG JOB TIME=1440         A41879 07800000
         BE    LONGJOB           YES                             A41879 07850000
         S     R14,LCTTMWRK      GET JOB TIME LEFT               A41879 07900000
         BNM   NOTMINUS          SET TO ZERO IF MINUS            A41879 07950000
         SR    R14,R14                                           A41879 08000000
NOTMINUS EQU   *                                                 A41879 08050000
         CL    R14,LCTTMWRK+DEC4  JOB TIME LEFT GT STEP          A41879 08100000
*                                 TIME NEEDED                    A41879 08150000
         BNL   IEFSD022          YES,USE STEP TIME FROM SCT      A41879 08200000
LONGJOB  EQU   *                                                 A41879 08250000
         ST    R14,DEC0(R1)      NO-USE JOB TIME LEFT            A41879 08300000
         MVI   LCTTMWRK+DEC8,HEX80  IND THAT TIME IS FOR JOB     A41879 08350000
*****************************************************************       08360002
*                                                                       08400000
*        FOR STARTED TASKS, SET THE SCT STEPNAME FIELD IN CHKEY         08410002
*        SO THAT THE TASK CAN BE CANCELED WHILE IN ALLOCATION.          08420002
*                                                                       08430002
*****************************************************************       08440002
IEFSD022 EQU   *                                                        08450000
         L     R5,LCTQDRTY        ADDRESS OF CSCB                  I272 08500000
         CLI   CHVCD,MOUNTCMD      CHECK FOR MOUNT COMMAND       Y02652 08550002
         BE    STARTING            SO IT CAN BE CANCELED DURING  Y02652 08600002
*                                  ALLOCATION, A MOUNT COMMAND   Y02652 08610002
*                                  MUST BE TREATED THE SAME AS A Y02652 08620002
*                                  START COMMAND                 Y02652 08630002
         CLI   CHVCD,SPROGRAM      IS THIS A STARTED TASK         20032 08650000
         BNE   IEFSD024            BRANCH NOT STARTED TASK        20032 08700000
STARTING EQU   *                                                  M3431 08750000
         CLC   SCTSCLPC(X8),ACSTARTG  TASKNAME ON COMMAND          I272 08800000
         BNE   SKIPSCAN           TASK SPECIFIED SKIP SCAN         I272 08850000
         LA    R0,X256            GET CORE  8 BYTES FOR PARM,      I272 08900000
         GETMAIN  R,LV=(0)        176 BYTES FOR READ AREA, 72 RSA  I272 08950000
         LR    R3,R1              ADDRESS OFEXTERNAL LIST          I272 09000000
         LA    R10,X8(R3)          ADDRESS OF READ IN AREA         I272 09050000
         LA    R13,X184(R3)       ADDRESS OF REG SAVE AREA              09100000
         USING SIOT,R10           TEMP SIOT BASE                   I272 09150000
         ST    R10,X0(R3)          ADDRESS OF READ IN AREA         I272 09200000
         MVC   X4(X4,R3),SCTFSIOT  TTR OF SIOT FROM SCT            I272 09250000
         CLC   SCTLSIOT(LRBA),CF0  CHECK WHETHER ANY SIOTS EXIST Y02670 09300002
         BE    NODDRDER             BRANCH NO SIOTS                I272 09350002
         ST    R3,QMPCM            PARM LIST                       I272 09500000
         MVI   QMPCM,ONEREC        READ ONE RECORD                 I272 09550000
         MVI   QMPOP,READCODE      READ OP CODE                    I272 09600000
REREAD   L     R15,IEFQMGRV       ADDRESS OF IEFQMRAW              I272 09650000
         LR    R1,R9              ADDRESS OF QMPA                  I272 09700000
         BALR  R14,R15                                             I272 09750000
         CLC   SCTDDNAM(X8),IEFRDER  IS DDNAME IEFRDER             I272 09900000
         BE    DDRDER             BRANCH YES                       I272 09950000
         CLC   SCTLSIOT(LRBA),SIOTDSKA  CHECK FOR LAST SIOT      Y02670 10000002
         BNE   NEXTTTR             NOT LAST, GET NEXT SIOT       Y02670 10050002
         B     NODDRDER           IEFRDER NOT FOUND DEFAULT PROC   I272 10060002
NEXTTTR  MVC   X4(X4,R3),SCTPSIOT  TTR OF NEXT TTR IN CHAIN        I272 10100000
         B     REREAD                                              I272 10150000
NODDRDER MVC   CHKEY(X8),JCTJNAME MOVE PROC TO CSCB AS TASK NAME   I272 10200000
         MVC   SCTSNAME(X8),JCTJNAME  MAKE JOBNAME STEPNAME        I272 10250000
         B     IEF16205                                            I272 10300000
SKIPSCAN MVC   SCTSNAME(X8),SCTSCLPC  MOVE TASKNAME TO STEP NAME   I272 10350000
         MVI   SCTSCLPC,BLANK      INSERT BLANK                    I272 10400000
         MVC   SCTSCLPC+X1(X7),SCTSCLPC  BLANK STEP                I272 10450000
         B     IEFSD024                                            I272 10500000
DDRDER   CLC   SCTUTYPE(X4),BLANKFW  IS UNIT TYPE SPECIFIED        I272 10550000
         BE    NODDRDER            BRANCH ON NO UNIT               I272 10600000
         MVC   SCTSNAME(X8),SCTUTYPE  SAVE UNIT NAME IN SCT        I272 10650000
         MVC   CHKEY(X8),SCTUTYPE  SAVE UNIT WANTED IN CSCB        I272 10700000
IEF16205 EQU   *                                                   I272 10750000
         MVI   SCTSCLPC,BLANK      INSERT BLANK                    I272 10800000
         MVC   SCTSCLPC+X1(X7),SCTSCLPC  BLANK STEP THAT CALLED    I272 10850000
         DROP R10                                                       10900000
         OI    LCTINTSW,LCTSTART  SET SWITCH                       I272 10950000
         L     R10,LCTTCBAD       ADDRESS OF INIT'S TCB            I272 11000000
         USING TCB,R10                 TCB ADDRESSABILITY         20029 11050000
         L     R10,TCBTIO              ADDRESS OF TIOT            20029 11100000
         DROP  R10                                                20029 11150000
         USING IEFTIOT,R10             TIOT ADDRESSABILITY        20029 11200000
         MVC   TIOCSTEP(X8),CHKEY TIOT STEP NAME = CHKEY           I272 11250000
         LR    R1,R3              SET UP TO FREE READIN AREA       I272 11300000
         LA R0,X256               LENGTH TO BE FREED               I272 11350000
         FREEMAIN  R,LV=(0),A=(1) FREE CORE                        I272 11400000
         DROP  R10                                             @Y02BPSR 11400103
IEFSD024 EQU   *                                                   I272 11405203
*****************************************************************       11410603
*                                                                       11415703
*        CALL THE SUBSYSTEM TO NOTIFY OF STEP INITIATION       @Y02BPSR 11420803
*                                                                       11427203
*****************************************************************       11433003
         LA    R13,REGSAVE                                     @Y02BPSR 11436003
         L     R2,LCTSSOBA         POINT TO SSOB HEADER        @Y02BPSR 11444003
         USING SSOB,R2                                         @Y02BPSR 11447003
         LA    R3,LCTIWORK         USE BEGINNING OF INIT.      @Y02BPSR 11453003
*                                  WORK AREA AS THE SSOB       @Y02BPSR 11459003
*                                  FUNCTIONAL SECTION          @Y02BPSR 11462003
         USING SSOBEXT,R3                                      @Y02BPSR 11468003
         XC    SSSIBGN(SSSISIZE),SSSIBGN CLEAR FUNCTIONAL      @Y02BPSR 11474003
*                                  SECTION                     @Y02BPSR 11477003
         LA    R1,SSOBNSSI         SET FUNCTION ID IN HEADER   @Y02BPSR 11483003
         STH   R1,SSOBFUNC                                     @Y02BPSR 11492003
         XR    R1,R1               CLEAR SSI RETURN CODE       @Y02BPSR 11496003
         ST    R1,SSOBRETN                                     @Y02BPSR 11500003
         ST    R3,SSOBINDV         POINT HEADER TO THE         @Y02BPSR 11505003
*                                  FUNTIONAL SECTION           @Y02BPSR 11510003
         LA    R1,SSSISIZE         SET SIZE OF FUNCTIONAL      @Y02BPSR 11515003
*                                  SECTION                     @Y02BPSR 11520003
         STH   R1,SSSILEN                                      @Y02BPSR 11525003
*        PASS PTR. TO NAME ON THE EXEC PGM=   STATEMENT        @Y02BPSR 11530003
         LA    R1,SCTSNAME                                     @Y02BPSR 11535003
         ST    R1,SSSIPSNM                                     @Y02BPSR 11540003
*        PASS PTR. TO NAME ON THE EXEC PROC=   STATEMENT       @Y02BPSR 11545003
         LA    R1,SCTSCLPC                                     @Y02BPSR 11550003
         ST    R1,SSSIPPSN                                     @Y02BPSR 11555003
*        PASS PTR. TO STEP NUMBER                              @Y02BPSR 11560003
         LA    R1,SCTSNUMB                                     @Y02BPSR 11565003
         ST    R1,SSSIPSNO                                     @Y02BPSR 11570003
*        SAVE THE PROTECT KEY FROM THE CURRENT TCB AND SET THE @Y02BPSR 11575003
*        TCB KEY TO 1. THIS IS DONE IN CASE THE SUBSYSTEM USES @Y02BPSR 11580003
*        THE TCB KEY TO DETERMINE THE KEY TO BE ASSIGNED TO    @Y02BPSR 11585003
*        GOTTEN STORAGE.                                       @Y02BPSR 11590003
         L     R10,LCTTCBAD                                    @Y02BPSR 11595003
         USING TCB,R10                                         @Y02BPSR 11600003
         MVC   LCTPARM2(L'TCBPKF),TCBPKF                       @Y02BPSR 11605003
         MVI   TCBPKF,KEYSCHED                                 @Y02BPSR 11610003
*        SET UP THE PARAMETER LIST AND CALL THE SUBSYSTEM      @Y02BPSR 11615003
         ST    R2,LCTPARM1                                     @Y02BPSR 11620003
         OI    LCTPARM1,HEX80      MARK END OF LIST            @Y02BPSR 11622003
         LA    R1,LCTPARM1                                     @Y02BPSR 11625003
         SPACE 1                                               @Y02BPSR 11630003
         IEFSSREQ                                              @Y02BPSR 11635003
         SPACE 1                                               @Y02BPSR 11640003
         MVC   TCBPKF,LCTPARM2     RESTORE THE TCB PROTECT KEY @Y02BPSR 11645003
         DROP  R10                                             @Y02BPSR 11650003
*        CHECK THE RETURN CODE FROM THE SSI                    @Y02BPSR 11655003
         LA    R1,SSRTOK                                       @Y02BPSR 11660003
         CR    R1,R15                                          @Y02BPSR 11665003
         BE    SSCALLOK            SUCCESSFUL CALL             @Y02BPSR 11670003
         LA    R1,SSRTNSUP                                     @Y02BPSR 11675003
         CR    R1,R15                                          @Y02BPSR 11680003
         BE    SSCALLOK            OK, THIS FUNCTION IS NOT    @Y02BPSR 11685003
*                                  SUPPORTED BY ALL SUBSYSTEMS @Y02BPSR 11690003
*        FOR OTHER RETURN CODES FROM SSI, ABEND WITH THE SSI   @Y02BPSR 11695003
*        COMPLETION CODE (0BA)                                 @Y02BPSR 11700003
         L     R1,ABENCODE                                     @Y02BPSR 11705003
         ABEND (1),,,SYSTEM                                    @Y02BPSR 11710003
SSCALLOK EQU   *                                               @Y02BPSR 11715003
*        CLEAR PART OF THE SSOB HEADER, TO AVOID POSSIBLE      @Y02BPSR 11720003
*        CONFUSION                                             @Y02BPSR 11725003
         XC    SSOBFUNC,SSOBFUNC                               @Y02BPSR 11730003
         XC    SSOBRETN,SSOBRETN                               @Y02BPSR 11735003
         XC    SSOBINDV,SSOBINDV                               @Y02BPSR 11740003
         DROP  R2                                              @Y02BPSR 11745003
         DROP  R3                                              @Y02BPSR 11750003
*****************************************************************       11755003
*                                                                       11760003
*        PRE-ALLOCATION CHECKPOINT RESTART PROCESSING                   11765003
*                                                                       11770003
*****************************************************************       11775003
*        SET UP TO PASS PARAMETERS TO IEFZB604, A PLS MODULE     Y02641 11780003
         ST    R8,LCTPARM2         PASS LCT PTR. (AS PARAMETER)  Y02641 11785003
         LA    R1,LCTPARM2         GET POINTER TO PARAMETER      Y02641 11790003
         ST    R1,LCTPARM1                                       Y02641 11795003
         LA    R1,LCTPARM1         PASS PTR. TO PARM LIST        Y02641 11800003
         LA    R13,REGSAVE         PASS REGISTER SAVE AREA       Y02641 11805003
         L     R15,VCON604         CALL IEFXB604, WHICH WILL     Y02641 11810003
*                                  WRITE THE STEP HEADER RECORD  Y02641 11815003
*                                  TO THE JOURNAL AND SET JOB    Y02641 11820003
*                                  STATUS BITS TO INDICATE THE   Y02641 11825003
*                                  STEP HAS ENTERED ALLOCATION   Y02641 11830003
         BALR  R14,R15             CALL IEFXB604                 Y02641 11835003
*********************************************************************** 11840003
*                                                                     * 11845003
*        INVOKE DEVICE ALLOCATION                                       11850003
*                                                                     * 11855003
*********************************************************************** 11860003
*  THE FOLLOWING SECTION OF CODE BRANCHES TO THE ALLOCATE SUBROUTINE  * 11865003
*  AND,UPON ALLOCATE'S RETURN, CHECKS A RETURN CODE IN R15. IF R15 IS * 11870003
*  ZERO, PROCESSING CONTINUES NORMALLY. IF R15 IS NOT ZERO, THE       * 11875003
*  ATTACH MODULE (IEFSD263) IS BYPASSED                               * 11880003
         L     R2,LCTPARM3         SAVE GWT ADDRESS IN REG         I272 11885003
         LA    R0,X96              GETMAIN SIZE                  Y02652 11900002
         LA    R1,TCORE           LOAD SUBPOOL                     I272 11950000
         SLL   R1,X24             SUBPOOL IN HIGH ORDER BYTE       I272 12000000
         OR    R0,R1              SUBPOOL AND LENGTH               I272 12050000
         GETMAIN  R,LV=(0)        72 BYTE SAVE AREA 24 PARM AREA   I272 12300000
         LA    R13,X24(R1)        ADDRESS OF SAVE AREA             I272 12350000
         L     R3,LCTJCTAD              JCT ADDRESS FROM LCT            12400000
         ST    R3,4(0,R1)               TO PARAMETER LIST               12450000
         ST    R8,0(0,R1)               LCT ADDRESS TO PAR LST          12500000
         LR    R3,R1              SAVE PARM REGISTER               M069 13250000
*        SET CANCELABLE IN CASE NOT CANCELABLE                          13300002
         OI    CHACT,CHCL       SET CANCELABLE BIT                 M069 13450000
ALLOCATE EQU   *                                                   M069 13500000
         L     R9,LCTJSCB          GET JSCB POINTER            @ZA10117 13550040
         USING IEZJSCB,R9          SET JSCB ADDRESSABILITY     @ZA10117 13600040
         MVC   JSCBSTEP,LCTSNUMB   MOVE STEP NUMBER TO JSCB    @ZA10117 13650040
         SR    R4,R4               CLEAR REGISTER FOR SWITCH        O99 15950000
         SPACE 2                                                        15960002
         L     R14,CVTPTR(0,0)     ESTABLISH ADDR.             @ZA16879 15960740
         USING CVTMAP,R14          TO CVT                      @ZA16879 15961440
         L     R10,CVTIHASU        GET ADDR OF INSTALLED       @ZA16879 15962140
         USING SUBITS,R10          SU BIT STRING               @ZA16879 15962840
         TM    SUBYTE1,SU4BIT      IS SU4 IN THIS SYSTEM?      @ZA16879 15963540
         BO    IEFSD003            YES, SKIP LINK              @ZA16879 15964240
         LINK  EP=IEFW21SD,MF=(E,(1))                          @ZA16879 15964940
         B     IEFSD004            CONTINUE                    @ZA16879 15965640
         DROP  R10                                             @ZA16879 15966340
         DROP  R14                                             @ZA16879 15967040
         SPACE 2                                                        15967740
IEFSD003 EQU   *                   SET UP FOR BALR             @ZA16879 15968440
         L     R15,CVTPTR          GET PTR TO CVT              @Z40FPPJ 15970040
         USING CVTMAP,R15                                      @Z40FPPJ 15980040
         L     R15,CVTJESCT        GET PTR TO JESCT            @Z40FPPJ 15988040
         DROP  R15                                             @Z40FPPJ 15996040
         USING JESCT,R15                                       @Z40FPPJ 16004040
         L     R15,JESALLOC        GET ADDRESS OF ALLOC        @Z40FPPJ 16012040
         BALR  R14,R15             GO TO DEVICE ALLOC          @Z40FPPJ 16020040
         DROP  R15                                             @Z40FPPJ 16028040
*                                                                   O99 16050000
IEFSD004 EQU   *                                               @ZA16879 16100040
         ST    R2,LCTPARM3         RESTORE SAVED GWT ADDRESS       I272 16150000
         LR    R3,R15                   SAVE RETURN CODE                16200000
         LR    R2,R1                    SAVE NEW PARAMETER LIST ADDRESS 16250000
         OI    LCTERR,LCTACOMP     TURN ON THE ALLOCATION COMP  YM07219 16260002
*                                  FLAG USED FOR ESTAE RETRY    YM07219 16270002
         TM    LCTOPSW1,LCTCANF   TEST FOR CANCELABLE TASK         I272 16300000
         BZ    IEFSD005           BRANCH IF CANCELABLE TASK        I272 16350000
         NI    CHACT,X255-CHCL     RESET TO NON-CANCELLABLE        I272 16400000
IEFSD005 EQU   *                                                    O99 16450002
         LR    R1,R13                   RESTORE ARSA POINTER.      CR17 24550000
         FREEMAIN R,LV=N72,A=(1),SP=TCORE  FREE SAVE AREA        Y02652 24600002
*********************************************************************** 24604040
*                                                                       24608040
*        POST ALLOCATION JOURNAL PROCESSING                             24612040
*                                                                       24616040
*********************************************************************** 24620040
         NI    JSCBJJSB,X'FF'-JSCBJNLN  TURN OFF 'NO JOURNAL'  @ZA08701 24632040
         LA    R1,LCTPARM1              USE LCTPARM1 AND 2     @ZA08701 24636040
         USING JNLPARM,R1               SET ADDRESSABILITY     @ZA08701 24640040
         XR    R14,R14                                         @ZA08701 24644040
         ST    R14,JNLPCALL             CLEAR FIRST WORD       @ZA08701 24648040
         MVI   JNLPCALL,JNLINIT    INDICATE INITIATOR CALL     @ZA08701 24652040
*                                  AFTER ALLOCATION            @ZA08701 24656040
         ST    R8,JNLPPTRX         PASS LCT POINTER            @ZA08701 24660040
         ST    R1,LCTPARM4         PASS POINTER TO PARAMETER   @ZA08701 24664040
         LA    R1,LCTPARM4         LOAD PARM PTR REG           @ZA08701 24668040
         LA    R13,REGSAVE         PASS REGISTER SAVE AREA     @ZA08701 24672040
         L     R15,VCON500         GET ADDRESS OF IEFXB500     @ZA08701 24676040
         BALR  R14,R15             CALL JOURNAL WRITE ROUTINE  @ZA08701 24680040
         LTR   R3,R3                    SHOUD ATTACH BE BYPASSED.  CR17 24700000
         BZ    IEFSD010                 NO.                        CR17 24750000
         L     R14,LCTENTR         ADDRESS OF IEL                 20032 24800000
         USING IEZIEL,R14          IEL ADDRESSABILITY             20032 24850000
         L     R14,IELEXIT         ADDRESS OF EXIT LIST           20032 24900000
         USING IELEXITS,R14        EXIT LIST ADDRESSABILITY       20032 24950000
*        IF A STEP IS BEING BYPASSED BECAUSE OF CONDITION       YA02927 24956002
*        CODES, DO NOT SET THE ALLOCATION ERROR RETURN CODE     YA02927 24962002
*        IN THE IEL. THIS IS TO PREVENT STC FROM WRITING A      YA02927 24968002
*        MESSAGE INDICATING AN ALLOCATION ERROR IN THAT         YA02927 24974002
*        SITUATION.                                             YA02927 24980002
         TM    LCTERR,LCTSFAIL                                  YA02927 24986002
         BO    BYPASS1            SKIP SETTING RETURN CODE      YA02927 24992002
         CLI   IELRTNCD,IELRTGD    HAS RET CD ALREADY BEEN SET   Y02652 25000002
         BNE   BYPASS1             YES, DONT DESTROY IT           M0397 25050000
         MVI   IELRTNCD,IELRTALC   ALLOC ERROR RETURN CODE       Y02652 25100002
         MVI   IELRCXT,IELINIT     SET RETURN CODE ORIGIN OF     Y02668 25110002
*                                  'INITIATOR'                   Y02669 25120002
         DROP  R14                                                20032 25150000
BYPASS1  EQU   *                                                  M0397 25200000
         OI    LCTOPSW3,LCTALERR   INDICATE ALLOC ERR TO 164      M0475 26750002
         B     EXIT164             CALL SUBROUTINE TO TAKE       Y02665 26800002
*                                  ERROR EXIT                    Y02665 26900002
****************************************************************** CR17 26950000
*                                                                  CR17 27000000
*        FOR STARTED TASKS, SET UP CHUNIT AND CHKEY SO THE TASK         27050002
*        CAN BE CANCELED. ALSO SET THE CURRENT AND NEW TIOTS'           27060002
*        STEPNAME FIELDS TO THE VALUE AT CHKEY.                         27070002
*                                                                  CR17 27100000
****************************************************************** CR17 27150000
IEFSD010 EQU    *                                                  CR17 27200000
         CLI   CHVCD,SPROGRAM     CHECK FOR STARTED PROGRAM        I272 27250000
         BNE   IEFSD011           BRANCH NOT A STARTED TASK        I272 27300000
         L     R10,12(R2)         LOAD TIOT LIST PTR               I272 27350000
         L     R10,0(R10)         PTR TO TIOT                      I272 27400000
         USING IEFTIOT,R10                                     @Y02BPSR 27420003
TIOTSRCH CLC   TIOEDDNM(X8),IEFRDER  IS DDNAME IEFRDER             I272 27450000
         BE    UCBADDR            BRANCH YES                       I272 27500000
         SR    R3,R3              ZERO REGISTER                    I272 27550000
         IC    R3,TIOELNGH        LENGTH OF TIOT ENTRY             I272 27600000
         LTR   R3,R3              TEST FOR END OF TIOT             I272 27650000
         BZ    NORDER             BRANCH END OF TIOT               I272 27700000
         AR    R10,R3             ADD ENTRY LENGTH TO BASE         I272 27750000
         B     TIOTSRCH           TEST NEXT DD ENTRY               I272 27800000
UCBADDR  L     R3,TIOESTTB        LOAD UCB POINTER                 I272 27850000
         LA    R3,X0(R3)           ZERO HIGH ORDER BYTE            I272 27900000
         LTR   R3,R3              TEST FOR ZERO UCB REQUEST FOR    I272 27950000
*                                 DUMMY DEVICE                     I272 28000000
         BZ    NORDER             BRANCH IF ZERO                   I272 28050000
         USING UCBOB,R3           ADDRESSABILITY FOR UCB           I272 28100000
MOVENAME MVC   CHUNIT(X3),UCBNAME  MOVE UCB NAME INTO CSCB         I272 28250000
         TM    LCTINTSW,LCTSTART  WAS TASK NAME ON COMMAND         I272 28300000
         BZ    IEFSD011           BRANCH NAME SPECIFIED            I272 28350000
         MVI   CHKEY,BLANK        MOVE IN BLANK                    I272 28400000
         MVC   CHKEY+X1(X7),CHKEY BLANK CHKEY FIELD                I272 28450000
         MVC   CHKEY(X3),UCBNAME  MOVE UCB NAME INTO CSCB          I272 28500000
         B     TIOTKEY                                             I272 28550000
         DROP  R3                                                  I272 28600000
NORDER   TM    LCTINTSW,LCTSTART  WAS TASK NAME ON COMMAND         I272 29000000
         BZ    IEFSD011           BRANCH NAME SPECIFIED            I272 29050000
         MVC   CHKEY(X8),CHCLS    MOVE PROC NAME INTO ID FIELD     I272 29100000
         DROP  R10                                             @Y02BPSR 29120003
TIOTKEY  L     R10,LCTTCBAD       ADDRESS OF INIT'S TCB            I272 29150000
         USING TCB,R10                 TCB ADDRESSABILITY         20029 29200000
         L     R10,TCBTIO              ADDRESS OF TIOT            20029 29250000
         DROP  R10                                                20029 29300000
         USING IEFTIOT,R10             TIOT ADDRESSABILITY        20029 29350000
         MVC   TIOCSTEP(X8),CHKEY TIOT STEP NAME = CHKEY           I272 29400000
         L     R10,12(R2)         LOAD TIOT LIST POINTER           I272 29450000
         L     R10,X0(R10)        PTR TO TIOT                      I272 29500000
         MVC   TIOCSTEP(X8),CHKEY TIOT STEP NAME = CHKEY           I272 29550000
         DROP  R10                                             @Y02BPSR 29551003
*****************************************************************       29552002
*                                                                       29560002
*        POST-ALLOCATION CHECKPOINT RESTART PROCESSING                  29570002
*                                                                       29580002
*****************************************************************       29590002
IEFSD011 EQU   *                                                   I272 29600000
         NI    JCTJSB,X'FF'-(JCTJSBIN+JCTJSBAL+JCTJSBTM)         Y02641 30200002
*                                  TURN OFF ALL JOB STATUS BITS  Y02641 30250002
*                                  (EXCEPT PERHAPS JCTJSBEX)     Y02641 30260002
         OI    JCTJSB,JCTJSBEX     INDICATE JOB HAS COMPLETED    Y02641 30270002
*                                  ALLOCATION                    Y02641 30280002
         NI    JSCBJJSB,X'FF'-(JSCBJSBI+JSCBJSBA+JSCBJSBT)  TURN Y02641 30300002
*                                  OFF ALL JOB STATUS BITS       Y02641 30350002
*                                  (EXCEPT PERHAPS JSCBJSBX)     Y02641 30360002
         OI    JSCBJJSB,JSCBJSBX   INDICATE JOB HAS COMPLETED    Y02641 30400002
*                                  ALLOCATION                    Y02641 30450002
         DROP  R9                                                Y02641 30500002
         TM    LCTOPSW2,LCTCRF     CHECK 'DISALLOW C/R' INDIC.   Y02641 30550002
         BO    SKPNOCKP            SKIP SETTING 'NO CHECKPOINT'  Y02641 30600002
*                                  INDICATOR IF LCT INDICATOR IS Y02641 30610002
*                                  ON, BECAUSE THE SPECIAL       Y02641 30620002
*                                  PROCESSING REQUIRED HAS       Y02641 30642002
*                                  ALREADY BEEN DONE             Y02641 30644002
         L     R4,LCTTCBAD         POINT TO INIT TCB             Y02641 30646002
         USING TCB,R4                                            Y02641 30648002
         NI    TCBABF,X'FF'-TCBNOCHK  TURN OFF INDICATOR WHICH   Y02641 30648402
*                                  SUPPRESSES CHECKPOINTS IN     Y02641 30648802
*                                  CASE IT HAD BEEN SET FOR THE  Y02641 30649202
*                                  PREVIOUS STEP                 Y02641 30649602
         TM    SCTSSTAT,SCTNOCKP   CHECK WHETHER THE STEP        Y02641 30649702
*                                  REQUESTED BYPASSING           Y02641 30649802
*                                  CHECKPOINTS                   Y02641 30649902
         BZ    SKPNOCKP            NO, DO NOT SET INDICATOR      Y02641 30666602
         OI    TCBABF,TCBNOCHK     SET 'NO CHECKPOINT' INDIC.    Y02641 30676602
         DROP  R4                                                Y02641 30677002
SKPNOCKP EQU   *                                                 Y02641 30678602
         OI    SCTSTEND,STEPSTRT        SET STEP STARTED BIT IN THE SCT 31050002
         NI    JCTRSW2,X'FF'-(CRMASK+JCTNARST)  TURN OFF BITS    Y02641 31800002
*                                  WHICH WILL BE PROPOGATED FROM Y02641 31810002
*                                  THE SCT AND A BIT WHICH MUST  Y02641 31820002
*                                  BE CLEARED BETWEEN STEPS      Y02641 31830002
         LA    R4,CRMASK           GET MASK OF BITS TO BE        Y02641 31840002
*                                  PROPOGATED FROM THE SCT       Y02641 31842002
         SR    R10,R10             ZERO REGISTER,                  CR17 31850000
         IC    R10,SCTSSTAT        LOAD STATUS INDICATORS          CR17 31900000
         NR    R10,R4              GET RID OF ALL BITS BUT C/R     CR17 31950000
         EX    R10,SETBITS         EXEC INSTRUCTION TO SET BITS    CR17 32000000
*                                                               YM01566 32010002
*        BUILD EPA'S AND INVOKE SWA MANAGER WRITE LOCATE FOR    YM01566 32050002
*        THE JCT AND SCT, TO CAUSE THE INFORMATION IN THE JCT   YM01566 32100002
*        AND SCT TO BE JOURNALED.                               YM01566 32150002
         LA    R13,REGSAVE         REGISTER SAVE AREA           YM01566 32160002
         LA    R1,REGSAVE+72       USE SECOND REGISTER SAVE     YM01566 32200002
*                                  AREA IN LCT TO BUILD THE     YM01566 32250002
*                                  INTERFACE FOR THE SWA MGR.   YM01566 32300002
         USING SMPARMS,R1                                       YM01566 32350002
         LA    R15,SMEPAPTR                                     YM01566 32360002
         ST    R15,SMPARM1         SET POINTER TO FIRST         YM01566 32370002
*                                  PARAMETER (EPA PTR.)         YM01566 32380002
         LA    R15,SMCODE                                       YM01566 32390002
         ST    R15,SMPARM2         SET POINTER TO SECOND        YM01566 32392002
*                                  PARAMETER (CODE OF WL)       YM01566 32394002
         LA    R15,SMEPA1                                       YM01566 32396002
         ST    R15,SMEPAPTR        SET POINTER TO FIRST EPA     YM01566 32398002
         MVC   SMCODE,WL           SET CODE FOR WRITE LOCATE    YM01566 32398402
         XC    SMEPA1(SMEND-SMEPA1),SMEPA1 CLEAR EPA'S          YM01566 32398802
         LA    R14,SMEPA1          INITIALIZE FIRST EPA (TO     YM01566 32399202
*                                  WRITE JCT)                   YM01566 32399302
         USING ZB505,R14                                        YM01566 32399602
         ST    R7,SWBLKPTR                                      YM01566 32399702
         MVC   SWVA,LCTJCTVA                                    YM01566 32399802
         LA    R15,SWLGTH                                       YM01566 32399902
         ST    R15,SWLNGTH                                      YM01566 32449902
         LA    R15,SMEPA2                                       YM01566 32459902
         ST    R15,SWCHNPTR                                     YM01566 32469902
*        INITIALIZE SECOND (AND LAST) EPA (TO WRITE SCT)        YM01566 32479902
         LA    R14,SMEPA2                                       YM01566 32489902
         USING ZB505,R14                                        YM01566 32491902
         ST    R6,SWBLKPTR                                      YM01566 32493902
         MVC   SWVA,LCTSCTVA                                    YM01566 32495902
         LA    R15,SWLGTH                                       YM01566 32497902
         ST    R15,SWLNGTH                                      YM01566 32498302
         DROP  R14                                              YM01566 32498702
*        GET ENTRY POINT OF SWA MANAGER LOCATE MODE             YM01566 32499102
         L     R15,CVTPTR                                       YM01566 32499502
         USING CVTMAP,R15                                       YM01566 32499602
         L     R15,CVTJESCT                                     YM01566 32499702
         USING JESCT,R15                                        YM01566 32499802
         L     R15,JESWAA                                       YM01566 32549802
         DROP  R15                                              YM01566 32559802
*        INVOKE THE SWA MANAGER                                 YM01566 32569802
         BALR  R14,R15                                          YM01566 32579802
         DROP  R1                                               YM01566 32589802
****************************************************************** CR17 32599802
*                                                                  CR17 38150000
* GET CORE FOR THE USER PARAM LIST,BUILD PARAM LIST,SET UP THE PRO CR17 38200000
* INTERFACE AND SAVE THE ADDR IN REGISTER 4.                       CR17 38250000
*                                                                  CR17 38300000
****************************************************************** CR17 38350000
         USING IHADCB,R3                                           I272 38450000
         LH    R3,SCTSEXEC              GET CORE FOR THE NO.OF USE CR17 38500000
         LA    R0,8(0,R3)              PLUS 8 FOR GETMAIN         18428 38550000
*        THE EXTRA 8 BYTES ARE USED AS FOLLOWS:                  Y02652 38560002
*              FIRST WORD - POINTER TO LENGTH                    Y02652 38570002
*              SECOND WORD - LENGTH (IMMEDIATELY BEFORE PARM)    Y02652 38580002
         LA    R14,TCORE                                           CR17 38600000
         SLL   R14,24                                              CR17 38650000
         OR    R0,R14                                              CR17 38700000
         GETMAIN    R,LV=(0)            GET USER PARAMS CORE.      CR17 38750000
         LR    R4,R1                    SAVE ADDR IN REG 4.        CR17 38800000
         ST    R3,4(0,R1)              LENGTH TO LIST             18428 38850000
         LA    R0,4(R1)                 ADDR OF LENGTH FIELD IN LI CR17 38900000
         ST    R0,0(R1)                                            CR17 38950000
         OI    0(R1),128                SET HIGH ORDER BIT TO 1.   CR17 39000000
         LA    R9,QMGR1                 Q MNGR PARAMETER AREA      CR17 39050000
         USING IOPARAMS,R9                                      YM01566 39060002
         BCTR  R3,0                                                CR17 39100000
         LTR   R3,R3                                               CR17 39150000
         BM    SD06220                                             CR17 39200000
         LA    R0,176                                              CR17 39250000
         GETMAIN R,LV=(0)               GEYMAIN FOR READ BUFFER    CR17 39300000
         LR    R5,R1                    SAVE FOR FREEMAIN          CR17 39350000
         LA    R13,REGSAVE              REGISTER SAVE AREA         CR17 39400000
         LA    R1,REGSAVE+72           REMOTE PARAMETER AREA       CR17 39450000
         ST    R1,QMPCL                STORE ADDR OF REMOTE PARAM  CR17 39500000
         MVI   QMPOP,4                  READ INDICATOR             CR17 39550000
         MVI   QMPNC,X'01'              READ ONE RECORD            CR17 39600000
         ST    R5,0(0,R1)              STORE BUFFER ADDRESS        CR17 39650000
         MVC   4(4,R1),SCTXBTTR        MOVE TTR                    CR17 39700000
         LR    R1,R9                    ADDRESS OF Q MGR PARAMETER CR17 39750000
         L     R15,IEFQMGRV             ADDRESS OF Q MNGR          CR17 39800000
         BALR  R14,R15                  READ THE RECORD.           CR17 39850000
         EX    R3,IEFMOVE1                                         CR17 39900000
         LR    R1,R5                   RESTORE POINTER             CR17 39950000
         LA    R0,176                                              CR17 40000000
         FREEMAIN R,LV=(0),A=(1)                                   CR17 40050000
SD06220  EQU   *                                                   CR17 40100000
         USING IEFPARAM,R11                                        M069 41200000
*                                                                     * 41250000
*********************************************************************** 41300000
*                                                                       41350002
*        GET STORAGE FOR IEFPARAM AND THE ATTACH PARAMETER LIST.        41400002
*        THE ATTACH PARAMETER LIST IS INITIALIZED BY IEFSD103.          41450002
*                                                                       41500002
*********************************************************************** 41550000
         LA    R0,LISTSIZE        SIZE OF PARMETER LISTS           I270 41600000
         LA    R13,LISTSIZE-1     SIZE OF PARM AREA LESS ONE       I270 41650000
         LA    R1,TCORE           SUBPOOL 253                      I270 41700000
         SLL   R1,X24             SP IN LIGH ORDER BYTE            I270 41750000
         OR    R0,R1              SP AND LENGTH IN REG 0           I270 41800000
         GETMAIN R,LV=(0)                                          I270 41850000
         EX    R13,CLEARCOR       ZERO GOTTON CORE                 I270 41900000
         LR    R11,R1             EST ADDRESSABILITY OF PARM ARE   I270 41950000
         ST    R4,IEFUSADD        ADDRESS OF USER PARMS            I272 42000000
         LA    R0,IEFPSIZE(R11)   ADDRESS OF ATTACH PARM LIST      I270 42050000
         ST    R0,IEFREMLS        ADDR OF ATTACH LIST IN PARM LT   I270 42100000
         L     R3,12(0,R2)              TIOTLIST POINTER                42250000
         ST    R3,IEFTIOTA              PLACE IN PARAMETER LIST         42300000
         L     R5,LCTQDRTY              GET CSCB BASE REGISTER          42350000
         L     R4,LCTTCBAD        ADDRESS OF INIT'S TCB            I272 42400000
         ST    R4,IEFTCBAD              PLACE IN PARAMETER LIST         42450000
         USING TCB,R4                  TCB ADDRESSABILITY         20029 42500000
         ST    R8,IEFLCTAD              PLACE LCT POINTER INTO PAR LST  43400000
         L     R9,LCTSTEPL         GET POINTER TO STAE EXIT      Y02653 43410002
*                                  PARAMETER LIST                Y02653 43420002
         LTR   R9,R9               CHECK WHETHER PRESENT         Y02653 43430002
         BZ    NOSTEPL             SKIP PROCESSING               Y02653 43444002
         USING STEPL,R9                                          Y02653 43446002
         ST    R11,STEPARAM        SAVE POINTER TO IEFPARAM FOR  Y02653 43448002
*                                  IEFIB620                      Y02653 43448402
NOSTEPL  EQU   *                                                 Y02653 43448802
         LA    R3,IEFAECB               ADDRESS OF ATTACH ECB           43498802
         ST    R3,ATTECBAD        ADDRESS OF ATTACH ECB           20030 43548802
         DROP  R4                                                Y02652 43558802
         LA    R4,CHCECB                                           I272 43598802
         ST    R4,CANECBAD        ADDRESS OF CANCEL ECB           20030 43648802
         OI    CANECBAD,HEX80     INDICATE END OF ECB LIST       Y02652 43698802
*****************************************************************       44252002
*                                                                       44254002
*        OPEN CATALOGS, JOBLIB, STEPLIB, OR FETCHLIB, AS NECESSARY      44256002
*                                                                       44258402
*****************************************************************       44258802
*        WHEN JOBLIB AND CATALOGS ARE OPENED, THE CURRENT TCB           44260002
*        MUST POINT TO THE P/P TIOT.                                    44270002
*        (WHEN ENTERED, THE INITIATOR RECOVERY ROUTINE WILL      Y02652 44282002
*        RESTORE THE POINTER IF PARTIOTB IS NOT 0.)              Y02652 44284002
         L     R4,LCTTCBAD                                       Y02652 44288002
         USING TCB,R4                                            Y02652 44288402
         MVC   PARTIOTB,TCBTIO     SAVE PTR. TO INIT. TIOT       Y02652 44290402
         L     R15,IEFTIOTA        GET PTR. TO TIOT PTR.         Y02652 44290802
         MVC   TCBTIO,0(R15)       MOVE P/P TIOT PTR. TO INIT.   Y02652 44292002
*                                  TCB                           Y02652 44294002
*        REG 9 WAS INITIALIZED TO POINT TO THE STEPL JUST        Y02653 44296002
*        BEFORE LABEL NOSTEPL.                                   Y02653 44298002
         LTR   R9,R9               CHECK WHETHER A STEPL EXISTS  Y02653 44298402
         BZ    NOSTEPL2            SKIP PROCESSING IF NO STEPL   Y02653 44298802
         NI    STEFLAGS,X'FF'-(STEJOBLB+STESTPLB+STEFCHLB) TURN  Y02653 44299202
*                                  OFF ANY LIBRARY INDICATOR     Y02653 44299602
*                                  WHICH MAY HAVE BEEN SET FOR   Y02653 44299802
*                                  THE PREVIOUS STEP             Y02653 44299902
NOSTEPL2 EQU   *                                                 Y02653 44316602
*****************************************************************       44326602
*                                                                       44328602
*        OPEN CATALOGS                                                  44330602
*                                                                       44332602
*****************************************************************       44333002
         L     R15,LCTJSCB         POINT TO P/P JSCB             Y02665 44333102
         USING IEZJSCB,R15                                       Y02665 44333202
         L     R14,JSCBPCC         CHECK WHETHER PCCB'S EXIST    Y02665 44338802
*                                  (CHAINED OFF P/P JSCB)        Y02665 44339202
         LTR   R14,R14                                           Y02665 44340802
         BZ    NOPCCBS             NO, NO CATALOGS TO OPEN       Y02665 44342802
         DROP  R15                                               Y02665 44343202
         L     R1,TCBJSCB          POINT TO INITIATOR JSCB       Y02665 44343602
         ST    R1,LCTPARM2         PASS POINTER AS A PARAMETER   Y02665 44344002
         LA    R1,LCTPARM2                                       Y02665 44344102
         ST    R1,LCTPARM1         PASS POINTER TO PARAMETER     Y02665 44344202
         LA    R1,LCTPARM1         POINT TO PARAMETER LIST       Y02665 44344302
         LA    R13,REGSAVE         PASS REG. SAVE AREA PTR.      Y02665 44354302
         L     R15,VCONCATL                                      Y02665 44358202
         BALR  R14,R15             INVOKE IEFICATL               Y02665 44368202
         LTR   R15,R15             CHECK RETURN CODE             Y02665 44370202
         BNZ   OPENERR3            BRANCH IF ERROR             @ZA07506 44370440
NOPCCBS  EQU   *                                                 Y02665 44507202
*****************************************************************       44510002
*                                                                       44512802
*        OPEN JOBLIB OR STEPLIB                                         44515602
*                                                                       44518402
*****************************************************************       44521202
         L     R10,TCBTIO              GET TIOT ADDRESS           20029 44524002
         USING IEFTIOT,R10                                        M3140 44540702
         DROP  R4                                                 20029 44590702
         TM    SCTSTAT2,SCTSTPLB       IS STEPLIB PRESENT         17052 45400000
         BZ    IEFJOBLB                NO, CHECK JOBLIB           17052 45450000
         LA    R0,IEFDCBN-IEFDCBS  DCB LENGTH                     17052 45550000
         LR    R4,R0               SUBTRACT ONE                   17052 45600000
         BCTR  R4,0                TO EXECUTE MOVE INSTRUCTION    17052 45650000
         LA    R14,TCORE           SUBPOOL NUMBER                 17052 45700000
         SLL   R14,24              TO HIGH-ORDER BYTE             17052 45750000
         OR    R0,R14              OF LENGTH FIELD                17052 45800000
*                                                                       45850000
         GETMAIN R,LV=(0)          GET DCB CORE                   17052 45900000
*                                                                       45950000
         LR    R3,R1               ADDR TO DCB BASE REGISTER      17052 46000000
         EX    R4,MOVEDCB          MOVE REMOTE DCB TO GOTTEN CORE 17052 46050000
         MVC   DCBDDNAM,STEPLIB        PUT STEPLIB DDNAME INTO DCB17052 46100000
         B     IEFJSOPE                OPEN  STEPLIB  DCB         17052 46150000
IEFJOBLB TM    JCTJSTAT,JOBLIB         WAS JOBLIB SPECIFIED IN    17052 46200000
*                                       JOB                             46250000
         BZ    IEFSD030                 NO, CHECK FOR FETCH             46300000
         LA    R0,IEFDCBN-IEFDCBS       NO.  LENGTH OF DCB.        CR17 46350000
         LR    R4,R0                    LENGTH OF DCB - 1               46400000
         BCTR  R4,0                     TO EXECUTE                      46450000
         LA    R14,TCORE                SUBPOOL NUMBER                  46500000
         SLL   R14,24                   TO HIGH ORDER BYTE              46550000
         OR    R0,R14                   OF LENGTH FIELD                 46600000
         GETMAIN R,LV=(0)               GETMAIN FOR DCB                 46650000
         LR    R3,R1                    ADDRESS OF REMOTE DCB           46700000
         EX    R4,MOVEDCB               MOVE DCB TO GOTTEN CORE         46750000
         MVC   DCBDDNAM(8),TIOEDDNM     PUT THE DDNAME IN THE DCB       46800000
IEFJSOPE EQU   *                                                        46900002
         LTR   R9,R9               CHECK WHETHER A STEPL EXISTS  Y02653 46950002
         BZ    NOSTEPL3            NONE, BRANCH AROUND           Y02653 47000002
         TM    SCTSTAT2,SCTSTPLB   CHECK WHETHER IT IS JOBLIB    Y02653 47010002
*                                  OR STEPLIB                    Y02653 47020002
         BZ    SETJOBLB            GO SET JOBLIB INDICATOR       Y02653 47030002
         OI    STEFLAGS,STESTPLB   SET STEPLIB INDICATOR         Y02653 47040002
*        THE INDICATORS ARE SET SO THAT IN CASE OF AN OPEN       Y02653 47042002
*        ABEND, IEFIB621 CAN SET THE CORRESPONDING OPEN ERROR    Y02653 47044002
*        RETURN CODE IN THE IXL.                                 Y02653 47046002
         B     NOSTEPL3            BRANCH AROUND ELSE CLAUSE     Y02653 47048002
SETJOBLB EQU   *                                                 Y02653 47048402
         OI    STEFLAGS,STEJOBLB   SET JOBLIB INDICATOR          Y02653 47048802
NOSTEPL3 EQU   *                                                 Y02653 47049202
         LR    R1,R2                   ALLOCATE PARMLIST         A16531 47050002
         MVI   0(R1),X'80'              INDICATE END OF LIST            47150000
         OPEN ((3),INPUT),MF=(E,(1))    OPEN THE DCB                    47200000
         USING IHADCB,R3                                       @ZA07506 47230040
         TM    DCBOFLGS,DCBOFOPN        WAS OPEN SUCCESSFUL    @ZA07506 47260040
         BZ    OPENERR2                 NO GO TO ERROR ROUTINE @ZA07506 47290040
         ST    R3,LCTJOBLB              SAVE JOBLIB DCB POINTER         47350000
IEFSD030 TM    SCTSTYPE,SCTGOSTP       WAS FETCHLIB SPECIFIED? @ZA05831 47850040
         BZ    IEFSD035               NO, DON'T  OPEN FETCHLIB @ZA05831 47860040
*****************************************************************       47902002
*                                                                       47904002
*        OPEN FETCHLIB                                                  47906002
*****************************************************************       47908402
         LA    R0,IEFDCBN-IEFDCBS       DCB LENGTH                      47950001
         LR    R4,R0                    DECREMENT BY ONE                48000001
         BCTR  R4,0                     FOR EXECUTING MOVE              48050001
         LA    R14,TCORE                SUBPOOL NUMBER                  48100001
         SLL   R14,24                   TO HIGH ORDER BYTE              48150001
         OR    R0,R14                   OF LENGTH FIELD                 48200001
         GETMAIN R,LV=(0)               GET DCB CORE                    48250001
         LR    R3,R1                    PLACE ADDRESS IN R3             48300001
         EX    R4,MOVEDCB               MOVE DCB TO GOTTEN CORE         48400000
         MVC   DCBDDNAM,SDFETCH    PLACE PGM=*.DD IN DCB       @ZA05831 48450040
         LTR   R9,R9               CHECK WHETHER STEPL EXISTS    Y02653 48460002
         BZ    NOSTEPL4            NONE, BRANCH AROUND           Y02653 48470002
         NI    STEFLAGS,X'FF'-(STEJOBLB+STESTPLB)  TURN OFF      Y02653 48480002
*                                  JOBLIB OR STEPLIB INDICATOR   Y02653 48490002
*                                  IN CASE ONE WAS SET           Y02653 48492002
         OI    STEFLAGS,STEFCHLB   SET STEPLIB INDICATOR         Y02653 48494002
NOSTEPL4 EQU   *                                                 Y02653 48496002
         LR    R1,R2                    ADDRESS OF REMOTE LIST          48500000
         MVI   0(R1),X'80'              INDICATE END OF LIST            48550000
         OPEN ((3),INPUT),MF=(E,(1))    OPEN THE DCB                    48600000
         TM    DCBOFLGS,DCBOFOPN       WAS OPEN SUCCESSFUL?    @ZA07506 48650040
         BZ    OPENERR1                NO GO TO OPEN ROUTINE   @ZA07506 48700040
         ST    R3,IEFDCBAD        DCB ADDRESS IN PARM LIST         I270 48750000
         DROP  R3                                                Y02652 48800002
IEFSD035 EQU   *                                                        52250000
*        RESTORE THE INITIATOR TIOT POINTER TO THE INITIATOR TCB Y02652 52300002
         L     R4,IEFTCBAD             GET ADDRESS OF INITIATOR'S TCB   52410002
         USING TCB,R4                                            Y02652 52420002
         MVC   TCBTIO,PARTIOTB     RESTORE TIOT PTR.             Y02652 52450002
         XR    R1,R1                                             Y02652 52460002
         ST    R1,PARTIOTB         CLEAR SO THE INITIATOR        Y02652 52470002
*                                  RECOVERY ROUTINE WILL NOT     Y02652 52480002
*                                  ATTEMPT TO RESORE THE PTR.    Y02652 52490002
         XC    LCTPARM1(X4),LCTPARM1 ZERO FIELD                    I272 52750000
         LR    R1,R2                    ADDRESS OF INPUT LIST           54400000
         FREEMAIN  R,LV=24,A=(1),SP=TCORE                               54450000
         L     R9,LCTASCBA                                       Y02656 54460002
         USING ASCB,R9                                           Y02656 54470002
*********************************************************************** 54500002
*                                                                     * 54550002
*        IF SPECIAL PROPERTIES WERE REQUESTED AND A JOBLIB OR           54560002
*        STEPLIB IS PRESENT, THE LIBRARY MUST BE CHECKED FOR            54570002
*        AUTHORIZATION BEFORE ANY SPECIAL PROPERTIES ARE GIVEN          54572002
*        TO THE JOB STEP.                                               54574002
*                                                                     * 54580002
*********************************************************************** 54590002
         TM    LCTINTSW,LCTINPPT   WAS PGM. NAME IN PPT          Y02656 54592002
         BZ    NOCHECK             NO, DO NOT CHECK JOBLIB       Y02656 54594002
         L     R14,LCTJOBLB        A DCB POINTER WILL EXIST ONLY Y02656 54596002
*                                  IF JOBLIB OR STEPLIB IS       Y02656 54598002
*                                  PRESENT                       Y02656 54598402
         LTR   R14,R14                                           Y02656 54598802
         BZ    NOCHECK             NO LIBRARY TO CHECK           Y02656 54599202
         USING IHADCB,R14                                        Y02656 54599602
         L     R14,DCBDEBAD                                      Y02656 54599702
         USING DEBBASIC,R14                                      Y02656 54599802
         TM    DEBFLGS1,DEBAPFIN   1 MEANS AUTHORIZED            Y02656 54599902
         BO    NOCHECK             LEAVE PROPERTIES              Y02656 54616602
*        TURN OFF ALL PROPERTIES WHICH MAY HAVE BEEN ASSIGNED IN Y02656 54626602
*        IEFSD101                                                Y02656 54628602
         NI    LCTOPSW1,X'FF'-LCTCANF  TURN OFF 'CANCEL ONLY AT  Y02656 54630602
*                                  ALLOCATION'                   Y02656 54632602
         OI    CHACT,CHCL          MAKE CANCELABLE               Y02656 54633002
*        TURN OFF SPECIAL PROTECT KEY                            Y02656 54634302
         TM    SCTSSTAT,EAADDRBT   CHECK FOR V=R                 Y02656 54637002
         BNO   VIRTKEY             NOT V=R, SET V=V KEY          Y02656 54638302
         MVC   TCBPKF,JCTJSRNO     MOVE UNIQUE KEY FOR V=R       Y02656 54639602
         B     SKIPKEY             BRANCH AROUND 'ELSE' CLAUSE   Y02656 54640902
VIRTKEY  EQU   *                                                 Y02656 54642802
         MVI   TCBPKF,KEYVIRT      SET V=V KEY                   Y02656 54643502
         DROP  R4                                                       54644140
SKIPKEY  EQU   *                                                 Y02656 54644802
         NI    LCTPUBYT,X'FF'-(LCT1LPU+LCT2LPU+LCTN2LP+LCTNSWP)         54645140
*                                  TURN OFF PREFERRED USAGE INDICATORS  54645440
*                                  AND 'AUTHORITY TO BE NON-SWAPPABLE'  54645740
*                                                              @ZA16879 54646640
         NI    LCTINTSW,X'FF'-LCTPRIV  TURN OFF 'PRIVILEGED'     Y02656 54658202
         NI    LCTINTS2,X'FF'-LCTSYS  TURN OFF 'SYSTEM TASK'     Y02652 54668202
         NI    LCTINTSW,X'FF'-LCTNDSI  TURN OFF NDSI             Y02656 54670202
         MVC   ASCBAFFN,NOAFFIN    TURN OFF CPU-TASK AFFINITY    Y02651 54670302
         NI    LCTINTS2,X'FF'-LCTBPPAS TURN OFF BYPASS PASSWORD         54670840
*                                  PROTECTION                  @ZA03944 54671340
         OI    LCTINTSW,LCTPPAA    SET SWITCH TO INDICATE MSG.   Y02656 54674602
*                                  IEF188I                       Y02656 54676402
*****************************************************************       54678202
*                                                                       54680002
*        COMPLETE ASSIGNMENT OF SPECIAL PROPERTIES               Y02652 54681802
*                                                                       54683602
*****************************************************************       54685402
NOCHECK  EQU   *                                                 Y02656 54687202
         TM    LCTINTS2,LCTSYS     CHECK FOR SYSTEM TASK         Y02652 54689002
         BNO   LVTIME1             BRANCH AROUND 'THEN' CLAUSE   Y02652 54690802
         OI    LCTOPSW2,LCTTIMEF   SET 'NOT TO BE TIMED'         Y02652 54692602
LVTIME1  EQU   *                                                 Y02652 54694402
         TM    LCTOPSW2,LCTTIMEF   CHECK WHETHER JOB IS TO BE    Y02652 54696202
*                                  TIMED                         Y02652 54698002
*        (THE LCT BIT MAY HAVE BEEN PROPAGATED FROM A BIT IN     Y02652 54699802
*        IELOPSW2.)                                              Y02652 54701602
         BNO   LVTIME2             BRANCH AROUND 'THEN' CLAUSE   Y02652 54703402
         MVC   LCTTMWRK+DEC4,HOURS24  INDICATE STEP IS NOT TO BE Y02652 54705202
*                                  TIMED                         Y02652 54707002
         MVI   LCTTMWRK+DEC8,HEX80 INDICATE TIME OF 24 HOURS IS  Y02652 54708802
*                                  FOR ENTIRE JOB                Y02652 54710602
LVTIME2  EQU   *                                                 Y02652 54712402
*                                                                       54714202
*        ASSIGN 'NO DATA SET INTEGRITY' (NDSI)                   Y02652 54716002
*                                                                       54717802
         TM    LCTINTSW,LCTNDSI                                  Y02652 54719602
         BZ    NONDSI              NDSI WAS NOT INDICATED        Y02652 54721402
         L     R10,LCTPARM3        SAVE PTR. TO GWT              Y02652 54723202
         MVC   LCTPARM1(GENLNGTH),GENERIC MOVE THE DEQ PARAMETER Y02652 54725002
*                                  LIST TO LCTPARM1-3            Y02652 54726802
*        (THE LIST CANNOT BE LEFT IN THE MODULE BECAUSE DEQ      Y02652 54728602
*        STORES A RETURN CODE INTO THE LIST AND THIS MODULE      Y02652 54730402
*        MUST BE READ-ONLY.)                                     Y02652 54732202
         DEQ   MF=(E,LCTPARM1)                                   Y02652 54734002
         ST    R10,LCTPARM3        RESTORE GWT PTR WHEN DEQ      Y02652 54735802
*                                  IS COMPLETE                   Y02652 54737602
         XR    R15,R15                                                  54737902
         ST    R15,JCTDETDA        CLEAR THE POINTER TO THE     YM04256 54738202
*                                  DS ENQ TABLE                 YM04256 54738502
*        (IF THE POINTER IS NOT CLEARED HERE, PROBLEMS MIGHT    YM04256 54738802
*        OCCUR WHEN DYNAMIC ALLOCATION ATTEMPTED TO DEQ FROM    YM04256 54739102
*        A DATA SET TO CHANGE IT'S ATTRIBUTES FROM SHR TO       YM04256 54739402
*        EXCLUSIVE.) THIS WILL ALSO IMPROVE PERFORMANCE, BY     YM04256 54741202
*        ELIMINATING THE DEQ BY UNALLOCATION.                   YM04256 54742202
NONDSI   EQU   *                                                 Y02652 54743202
         L     R15,LCTJSCB                                     @ZA03944 54755740
         USING IEZJSCB,R15                                     @ZA03944 54755840
         TM    LCTINTS2,LCTBPPAS        WAS BYPASS PASSWORD    @ZA03944 54755940
*                                       PROTECTION SPECIFED?   @ZA03944 54756040
         BNO   NOPASS                   DON'T BYPASS PASSWORD  @ZA03944 54756140
*                                       PROTECTION             @ZA03944 54756240
         OI    JSCBSWT1,JSCBPASS        SET BYPASS PASSWORD    @ZA03944 54756340
         DROP  R15                                             @ZA03944 54756440
NOPASS   EQU   *                        PROTECTOIN IN JSCB     @ZA03944 54756540
*****************************************************************       54757440
*                                                                       54759202
*        ISSUE MESSAGE IEF188I IF INDICATED                      Y02656 54761002
*                                                                       54762802
*****************************************************************       54764602
         TM    LCTINTSW,LCTPPAA    SHOULD MESSAGE BE WRITTEN     Y02656 54766402
         BNO   NOMSG               NO, BRANCH AROUND 'THEN'      Y02656 54768202
*                                  CLAUSE                        Y02656 54770002
         L     R14,LCTIMSG         GET POINTER TO MESSAGE MODULE Y02656 54771802
*                                  (IEFIB650)                    Y02656 54773602
         LA    R15,MSG6(0,R14)     GET POINTER TO ENTRY FOR THIS Y02656 54775602
*                                  MESSAGE IN TABLE AT BEGINNING Y02656 54776802
*                                  OF IEFIB650                   Y02656 54777802
         AH    R14,X2(0,R15)       POINT TO MESSAGE              Y02656 54780702
         WTO   MF=(E,(R14))                                      Y02656 54782702
NOMSG    EQU   *                                                 Y02656 54784702
*****************************************************************       54785702
*                                                                       54788502
*        NORMAL EXIT                                                    54789502
*                                                                       54790502
*****************************************************************       54791502
         LR    R1,R11                   POINT TO PARAMETER LIST         54792502
         L     R15,IEFV103         ADDRESS OF PRE-ATTACH RTN      20032 54793502
         BR    R15                 GO TO PRE-ATTACH ROUTINE       20032 54800002
***************************************************************@ZA07506 54802040
*                                                              @ZA07506 54804040
*        PROCESSING FOR UNSUCCESSFUL OPENING OF                @ZA07506 54806040
*        JOBLIBS - STEPLIBS AND FETCHLIBS                      @ZA07506 54808040
*                                                              @ZA07506 54810040
***************************************************************@ZA07506 54812040
OPENERR1 LA    R14,SDFETCH         POINT TO FETCHLIB FOR       @ZA07506 54814040
         B     PUTMSG              THE PUT MESSAGE ROUTINE     @ZA07506 54816040
         USING STEPL,R9                                        @ZA07506 54818040
OPENERR2 TM    STEFLAGS,STEJOBLB   IS IT JOBLIB OR STEPLIB     @ZA07506 54820040
         BZ    OPSTEPER            STEPLIB                     @ZA07506 54822040
         LA    R14,JOBCONS         POINT TO JOBLIB FOR THE     @ZA07506 54824040
         B     PUTMSG              PUT MESSAGE ROUTINE         @ZA07506 54826040
OPSTEPER LA    R14,STEPLIB         POINT TO STEPLIB FOR        @ZA07506 54828040
PUTMSG   NI    STEFLAGS,X'FF'-(STEFCHLB+STEJOBLB+STESTPLB)     @ZA07506 54830040
         DROP  R9                                              @ZA07506 54832040
         LA    R0,80                   SIZE OF GETMAIN         @ZA07506 54834040
         GETMAIN R,LV=(0)              GETMAIN FOR MESSAGE     @ZA07506 54836040
         LR    R9,R1                   SAVE CORE PTR FOR FREE  @ZA07506 54838040
         LR    R7,R0                   SAVE SIZE FOR FREEMAIN  @ZA07506 54840040
         L     R3,LCTIMSG              POINT TO MESSAGE MODULE @ZA07506 54842040
         AH    R3,MSGF+X2(0,R3)        POINT TO MESSAGE        @ZA07506 54844040
         LH    R4,0(0,R3)              GET LENGTH OF MESSAGE   @ZA07506 54846040
         LA    R4,3(0,R4)              ADD LENGTH OF DESCRIPTOR@ZA07506 54850040
         EX    R4,MESMOV               EXECUTE MOVE MESSAGE    @ZA07506 54850140
         MVC   32(8,R1),0(R14)         MOVE PROPER DD IDENT    @ZA07506 54850240
         USING PSA,0                   ADDRESSABILITY FOR THE PSA       54850340
         L     R14,PSATOLD             GET THE CURRENT TCB     @ZA07506 54850440
         USING TCB,R14                 ADDRESSABILITY TO TCB   @ZA07506 54850540
         L     R14,TCBTIO              GET THE TIOT FROM TCB   @ZA07506 54850640
         USING TIOT1,R14               ADDRESSABILITY TO TIOT  @ZA07506 54850740
         MVC   16(8,R1),TIOCNJOB       MOVE JOBNAME TO MESSAGE @ZA07506 54850840
         DROP R14                      DROP MACRO REG          @ZA07506 54850940
         WTO   MF=(E,(R1))             WRITE THE MESSAGE       @ZA07506 54851040
         LR    R0,R7                   RESTORE SIZE FOR FREE   @ZA07506 54851140
         LR    R1,R9                   RESTORE PTR FOR FREE    @ZA07506 54851240
         FREEMAIN R,LV=(0),A=(R1)      FREE THE CORE           @ZA07506 54851340
*********************************************************************** 54851440
*                                                              @ZA07506 54851540
*        PROCESSING FOR UNSUCCESSFUL OPENING OF CATALOGS       @ZA07506 54851640
*        JOBLIBS - STEPLIBS AND FETCHLIBS                      @ZA07506 54851740
*                                                              @ZA07506 54851840
*********************************************************************** 54851940
         L     R4,LCTTCBAD         RESTORE TCB REG BEFORE MOVE @ZA07506 54852040
         USING TCB,R4                                                   54852140
OPENERR3 MVC   TCBTIO,PARTIOTB     RESTORE INITIATOR TIOT PTR. @ZA07506 54852240
         DROP  R4                                                Y02665 54852340
         XR    R1,R1                                             Y02665 54852440
         ST    R1,PARTIOTB         CLEAR SO THE INITIATOR        Y02665 54852540
*                                  RECOVERY ROUTINE WILL NOT     Y02665 54852640
*                                  ATTEMPT TO RESTORE THE PTR.   Y02665 54852740
*        FREE IEFPARAM AND THE ATTACH PARAMETER LIST (THEY WERE  Y02665 54852840
*        GOTTEN CONTIGUOUSLY WITH THE SAME GETMAIN.)             Y02665 54852940
         LA    R0,LISTSIZE         GET SIZE OF IEFPARAM AND      Y02665 54853040
*                                  ATTACH PARAMETER LIST         Y02665 54853140
         O     R0,SUBPOOL                                        Y02665 54853240
         FREEMAIN R,LV=(0),A=(11)                                Y02665 54853340
*                                                                Y02665 54853440
*        FREE STORAGE USED FOR USER PARMS                        Y02665 54853540
         LH    R14,SCTSEXEC        GET SIZE OF USER PARMS        Y02665 54853640
         LA    R0,HEADER(0,R14)    ADD SIZE OF HEADER            Y02665 54853740
         O     R0,SUBPOOL                                        Y02665 54853840
         L     R1,IEFUSADD         GET POINTER TO PARMS          Y02665 54853940
         XR    R15,R15                                           Y02665 54854040
         ST    R15,IEFUSADD        CLEAR PTR. TO PARMS           Y02665 54854140
         FREEMAIN R,LV=(0),A=(1)                                 Y02665 54854240
         L     R14,LCTENTR         ADDRESS OF IEL                Y02665 54854340
         USING IEZIEL,R14                                        Y02665 54854440
         L     R14,IELEXIT         ADDRESS OF EXIT LIST          Y02665 54854540
         USING IELEXITS,R14                                      Y02665 54854640
         CLI   IELRTNCD,IELRTGD    CHECK FOR PREVIOUS ERROR      Y02665 54854740
         BNE   BYPASS2             DO NOT DESTROY OLD CODE       Y02665 54854840
         MVI   IELRTNCD,IELRTALC   ALLOC ERROR RETURN CODE       Y02665 54854940
         MVI   IELRCXT,IELINIT     SET ORIGIN OF 'INITIATOR'     Y02665 54855040
         DROP  R14                                               Y02665 54855140
BYPASS2  EQU   *                                                 Y02665 54855240
         OI    LCTOPSW3,LCTALERR   INDICATE ALLOC. ERROR TO      Y02665 54855340
*                                  IEFSD164                      Y02665 54855440
         OI    LCTERR,LCTJFAIL     SET LCT JOB FAILED BIT        Y02665 54855540
         ST    R8,0(0,R2)          RESTORE LCT PTR IN PARMLIST @ZA07506 54855640
         SPACE 5                                                        54855740
*****************************************************************       54860002
*                                                                       54870002
*        ERROR EXIT                                                     54880002
*                                                                       54890002
*****************************************************************       54892002
EXIT164  EQU   *                                                 Y02665 54894002
         L     R1,LCTPARM3        LOAD ADDRESS OF GWT              I272 54900002
         LA    R1,0(0,R1)          CLEAR HIGH ORDER BYTE (TCB    Y02665 54910002
*                                  PRIORITY MAY HAVE BEEN SAVED  Y02665 54920002
*                                  THERE)                        Y02665 54930002
         LTR   R1,R1               CHECK WHETHER GWT EXISTS      Y01054 54950002
         BZ    NOGWT               DOES NOT EXIST, DON'T ATTEMPT Y01054 55000002
*                                  TO FREE IT                    Y01054 55050002
         L     R0,GETMAIN1         GET SUBPOOL AND SIZE          Y01054 55100002
         FREEMAIN  R,LV=(0),A=(1)      FREE ITS CORE               LS17 55150002
NOGWT    EQU   *                                                 Y01054 55200002
         L     R15,IEFSD64V        STEP DELETE RTN               S21474 55250002
         LR    R1,R2                    RESTORE PARAM LIST PTR.    CR17 55300002
         BR    R15                 GO TO IEFSD164                S21474 55310002
         EJECT                                                          55350002
IEFMOVE1 MVC   8(0,R4),4(R5)       MOVE USER PARAMS FROM BUFFER   18428 55400002
CLEARCOR XC    X0(X0,R1),X0(R1)                                    I270 55450002
SETBITS  OI    JCTRSW2,X'00'       PUT C/R BITS IN JCT             CR17 55460002
MOVEDCB  MVC   0(0,R3),IEFDCBS          MOVE DCB TO GOTTN CORE          55470002
MESMOV   MVC   0(0,R1),0(R3)       MOVE FOR EXECUTE IEF689     @ZA07506 55471040
NOAFFIN  DC    X'FFFF'             TO TURN OFF CPU-TASK AFFINITY Y02651 55472002
         SPACE                                                          55474002
IEFRDER  DC    CL8'IEFRDER'                                        I272 55480002
JOBCONS  DC    CL8' JOBLIB '            DDNAME FOR MESSAGE 689 @ZA07506 55485040
STEPLIB  DC    CL8'STEPLIB '            DDNAME FOR DCB             OC42 55490002
SDFETCH  DC    CL8'PGM=*.DD'       DDNAME FOR FETCHLIB         @ZA05831 55491040
SYSDSN   DC    CL8'SYSDSN'                                       Y02652 55494002
ACSTARTG DC    C'STARTING'                                         I272 55496002
BLANKFW  DC    C'    '                                                  55498402
WL       DC    C'WL'               CODE FOR SWA MANAGER WRITE   YM01566 55498502
*                                  LOCATE MODE                  YM01566 55498602
         SPACE                                                          55498802
CF0      DC    F'0'                     WORD OF ZEROES FOR COMPARES     55500000
HOURS24  DC    F'8640000'              1440 MIN IM HUNDREDTH OF SEC.    55700000
GETMAIN1 DS    0F                  TO FREE GWT                   Y01054 55750002
         DC    AL1(TCORE)          SUBPOOL                       Y01054 55760002
         DC    AL3(GPSIZE)         SIZE                          Y01054 55770002
SUBPOOL  DS    0F                                                Y02665 55772002
         DC    AL1(TCORE)                                        Y02665 55774002
         DC    AL3(0)                                            Y02665 55776002
ABENCODE DC    X'000000BA'         SSI ABEND CODE              @Y02BPSR 55778003
         SPACE                                                          55780002
IEFQMGRV DC    V(IEFQMRAW)                                              55800000
IEFV103  DC    V(IEFSD103)         ADDRESS OF PRE-ATTACH RTN      20032 56400000
IEFSD64V DC    V(IEFSD064)         ADDR OF STEP DELETE RTN       S21474 56450000
VCON604  DC    V(IEFXB604)                                       Y02641 56850002
VCON500  DC    V(IEFXB500)         JOURNAL WRITE ROUTINE         Y02652 56852002
VCONCATL DC    V(IEFICATL)                                       Y02665 56852102
         SPACE                                                          56860002
GENERIC  DEQ   (SYSDSN,,,SYSTEM),RET=HAVE,GENERIC=YES,MF=L       Y02652 56910002
GENLNGTH EQU   *-GENERIC                                         Y02652 56920002
         SPACE                                                          56960002
PATCH    DC    25F'0'              PATCH AREA                    Y02652 57010002
         EJECT                                                          57410002
TCORE    EQU   253                                                      57450000
N0       EQU   0                                                    O99 57550000
N1       EQU   1                                                    O99 57600000
N4       EQU   4                                                    O99 57750000
N72      EQU   72                                                   O99 58000000
JOBLIB   EQU   X'80'                                                    58050002
X0       EQU   0                                                   I272 58700000
X1       EQU   1                                                   I272 58750000
X3       EQU   3                                                   I272 58800000
X4       EQU   4                                                   I272 58850000
X7       EQU   7                                                   I272 58950000
X8       EQU   8                   DISPLACEMENT                    I272 59000002
X24      EQU   24                                                  I272 59150000
X96      EQU   96                                                  I272 59200000
X184     EQU   184                                                 I272 59250000
X255     EQU   255                 USED IN MASK                    I272 59300000
X256     EQU   256                                                 I272 59350000
BLANK    EQU   C' '                                                I272 59400000
NOSIOTS  EQU   X'00'                                               I272 59500000
ONEREC   EQU   X'01'                                               I272 59550000
READCODE EQU   X'04'                                               I272 59600000
RTNCODE4 EQU   X'04'                                               I272 59750000
SPROGRAM EQU   X'04'              VERB CODE FOR STARTED PROGRAM    I272 59850000
MOUNTCMD EQU   X'0C'              VERB CODE FOR MOUNT COMMAND    Y02652 59900002
NO       EQU   0                                                   M069 60500000
KEYVIRT  EQU   X'80'                                             Y02656 60510002
KEYSCHED EQU   X'10'               STORAGE KEY 1               @Y02BPSR 60515003
X2       EQU   2                                                 Y02656 60520002
MSG6     EQU   20                  DISPLACEMENT OF INDEX TO MSG. Y02656 60530002
MSGF     EQU   56                                              @ZA07506 60535040
*                                  IEF188I                       Y02656 60540002
HEX00    EQU   X'00'                   HEX EQUATE                       60542002
DEC8     EQU   8                       NUMERIC EQUATE                   60544002
DEC4     EQU   4                       NUMERIC EQUATE                   60546002
DEC0     EQU   0                       NUMERIC EQUATE                   60548002
HEX80    EQU   X'80'                   HEX EQUATE                       60548402
LRBA     EQU   3                   LENGTH OF AN RBA              Y02670 60548802
STEPSTRT EQU   X'80'                                             Y02652 60549202
HEADER   EQU   8                   LENGTH OF HEADER OF USER PARM Y02665 60566102
*                                  LIST (CONTAINS POINTER TO     Y02665 60576102
*                                  PARMS AND LENGTH)             Y02665 60578102
SWLGTH   EQU   176                 LENGTH OF JCT OR SCT         YM01566 60580102
         EJECT                                                          60583102
IEFDCBS  DS    0F                                                       60600000
         DCB DSORG=PO,MACRF=E                                           60650000
         EJECT                                                          60700000
IEFDCBN  EQU   *                                                        60750000
         DCBD  DSORG=(PO,XE)                                            60800000
         EJECT                                                          60850000
SMPARMS  DSECT                     USED TO INVOKE SWA MANAGER   YM01566 60854402
*                                  LOCATE MODE                  YM01566 60856402
SMPARM1  DS    F                   PTR. TO EPAPTR               YM01566 60858402
SMPARM2  DS    F                   PTR. TO CODE                 YM01566 60860402
SMEPAPTR DS    F                   PTR. TO EPA                  YM01566 60860502
SMCODE   DS    CL2                 CODE FOR LOCATE MODE         YM01566 60860602
SMEPA1   DS    4F                  FIRST EPA                    YM01566 60860702
SMEPA2   DS    4F                  SECOND EPA                   YM01566 60861402
SMEND    EQU   *                                                YM01566 60861802
         SPACE 4                                                        60862202
         IEFZB507                                                       60863002
         SPACE 4                                                        60865202
         IEFZB505                                                       60869602
         SPACE 4                                                        60874002
         IEFZB630                                                       60878402
         SPACE 4                                                        60882802
IEFLOT   DSECT                                                          60887202
         IEFALLCT                                                       60891602
         SPACE 4                                                        60896002
         IEFZB600                                                Y01054 60900402
         SPACE 4                                                        60904802
         IEFZB622                                                       60909202
         SPACE 4                                                        60913602
         IEZATTCH                                                  I270 60918002
LISTSIZE EQU   IEFPSIZE+ATLSTSIZ                                   I270 60922402
         SPACE 4                                                        60926802
IEFJCT   DSECT                                                          60931202
         IEFAJCTB                                                       60935602
JCTDETDA EQU   IEFJCT+88           SVA OF DSENQ DABLE           YM04256 60936602
*        (INCLUDED IN THE MACRO AS A COMMENT ONLY)              YM04256 60937602
         SPACE                                                          60940002
CRMASK   EQU   JCTNORST+JCTNOCKP+JCTRESTT  MASK OF BITS TO BE    Y02641 60944402
*                                  PROPOGATED FROM THE SCT TO    Y02641 60948802
*                                  THE JCT FOR                   Y02641 60953202
*                                  CHECKPOINT/RESTART            Y02641 60957602
         SPACE 4                                                        60962002
IEFSCT   DSECT                                                          60966402
         IEFASCTB                                                       60970802
SCTSTEND EQU   INSMSCT+172         THIS FIELD IS IN THE SCT AS   Y02652 60975202
*                                  A COMMENT                     Y02652 60979602
         SPACE 4                                                        60984002
IEFTIOT  DSECT                                                          60988402
         IEFTIOT1                                                       60992802
         SPACE 4                                                        60997202
UCB      DSECT                                                     I272 61001602
         IEFUCBOB                                                  I272 61006002
         SPACE 4                                                        61010402
SIOT     DSECT                                                     I272 61014802
         IEFASIOT                                                  I272 61019202
         SPACE 4                                                        61023602
         IHAASCB                                                        61028002
         SPACE 4                                                        61032402
IEFCSCB  DSECT                                                          61036802
         IEECHAIN                                                       61041202
         SPACE 4                                                        61045602
         IEFQMNGR                                                       61050002
         SPACE 4                                                        61100002
         IKJTCB                                                   20029 64600000
         SPACE 4                                                        64650002
         IEZJSCB                                                   I272 64700000
         SPACE 4                                                        64750002
IEZIEL   DSECT                                                    20032 65150000
         IEZIEL    EXITS=RTN                                            65220002
         SPACE 4                                                        65222002
         IEZDEB                                                         65242002
         SPACE 4                                                        65244802
         CVT   DSECT=YES                                                65246002
         SPACE 4                                                        65248002
         IEFJESCT                                                       65248402
         SPACE 4                                                        65248802
         IEFJSSOB SI,CONTIG=NO                                 @Y02BPSR 65249203
         SPACE 4                                                        65249603
         IHAPSA                     FOR PSATOLD DEFINITION     @ZA07506 65249840
         SPACE 4                                                        65249940
         IHASUBIT                                              @ZA16879 65250040
         END                                                            65300040
