         TITLE 'IEFSD164 VMS STEP DELETE'                               00050000
IEFSD064 CSECT                                                          00100000
* SD064214 C - NEAR LABEL SD064214 ADD PUT ENDREQ SYSTEM MSGS  @ZA09487 00120040
* SD16447 C - BEFORE LABEL SD16447 ADD SET ABEND INDICATOR     @ZA17354 00130040
*********************BEGINNING OF SPECIFICATION********************     00150002
*                                                                       00200002
*   MODULE NAME=IEFSD064 (IEFSD164)                                     00250002
*                                                                       00300002
*   DESCRIPTIVE NAME=STEP DELETE                                        00350002
*                                                                       00400002
*   COPYRIGHT=NONE                                                      00450002
*                                                                       00500002
*   STATUS=OS/VS2 OZ09487                                      @ZA09487 00520040
*                                                                       00600002
*   FUNCTION=CLOSE JOBLIB,STEPLIB,AND FETCHLIB DCBS AND FREE            00650002
*        THE DCB CORE,READ THE JCT AND SCT FROM SWA,PERFORM             00700002
*        JOB AND JOB STEP TIMING,PERFORM WARMSTART PROCESSING           00750002
*        AND JOURNAL THE JCT AND SCT,PERFORM  STAE                      00760002
*        PROCESSING, GET CORE AND INITIALIZE A DUMMY TCB,               00850002
*        GO TO TERMINATION,AND READ/LOCATE THE SCT FOR THE NEXT         00900002
*        STEP OF THE JOB.                                               00950002
*                                                                       01000002
*   OPERATION= WHEN IEFSD164 GETS CONTROL, IT WILL CHECK IN-     Y02641 01050002
*        DICATORS IN THE JCT AND LCT TO DETERMINE IF IT IS       Y02641 01100002
*        BEING ENTERED FOR WARMSTART PROCESSING OR BECAUSE OF    Y02641 01150002
*        AN ERROR DURING ALLOCATION. IF EITHER OF THESE CON-     Y02641 01200002
*        DITIONS IS TRUE, ALL DCB PROCESSING,READING THE JCT     Y02641 01250002
*        AND SCT FROM SWA, AND JOB AND STEP TIMING PROCESSING    Y02641 01300002
*        WILL BE BY-PASSED.                                      Y02641 01350002
*                                                                       01355002
*        IF NEITHER OF THE ALTERNATE PATH INDICATORS IS                 01360002
*        ON, THE ADDRESS OF THE FETCHLIB DCB IN THE ATTACH              01400002
*        PARAMETER LIST IS CHECKED TO DETERMINE IF ONE EXISTS.          01450002
*        IF ONE DOES EXIST,CLOSE THE FETCHLIB DCB AND FREE ITS          01480002
*        CORE.                                                          01510002
*                                                                       01650002
*        THE JOBLIB/STEPLIB DCB POINTER IN THE LCT IS CHECKED           01700002
*        TO DETERMINE IF ONE EXISTS. IF ONE DOES EXIST,CLOSE            01750002
*        THE DCB AND FREE ITS CORE.                                     01800002
*                                                                       01850002
*        THE AMOUNT OF SRB TIME USED BY THE STEP IS SAVED IN THE Y02652 01870002
*        SCT AND THE ACCUMULATED SRB TIME FOR THE JOB IS CALCU - Y02652 01890002
*        LATED AND SAVED IN THE JCT.THESE VALUES WILL BE PRESER- Y02652 01892002
*        VED WHEN  THE SCT AND JCT ARE JOURNALED .               Y02652 01896002
*                                                                       01898002
*        IEFSD164 NOW GETS CORE FOR THE JOB/STEP ACT AND READ           01900002
*        THE ACT INTO CORE. THE AMOUNT OF TIME IT TOOK THE JOB          01950002
*        STEP TO EXECUTE IS CALCULATED AND STORED IN THE STEP           02000002
*        ACT AND THE ACT IS WRITTEN TO SWA. THE JACT IS READ     Y02621 02050002
*        INTO CORE,THE AMOUNT OF JOB TIME ELAPSED AND JOB TIME          02100002
*        REMAINING IS CALCULATED AND STORED IN THE JACT.                02150002
*                                                                       02155002
*        THE JACT IS WRITTEN TO SWA.                             Y02621 02160002
*                                                                       02165002
*        THE JOB/STEP ACT CORE IS THEN FREED.                           02170002
*                                                                       02210002
*        THE IEFPARAM PARAMETER LIST IS NOW FREED AND THE PTR    Y02653 02250002
*        TO IEFPARAM IN THE STAE EXIT PARAMETER LIST IS ZEROED.  Y02653 02300002
*                                                                       02350002
*        CORE IS NOW GOTTEN FOR A DUMMY TCB TO BE USED BY TERM-         02400002
*        INATION AND THE TCB STATUS AND PROGRAM COMPLETION              02450002
*        CODES ARE MOVED TO IT.                                         02500002
*        A. IF JOB IS 'IN EXEC' THEN SET 'IN TERM' IN JCT,       Y02641 02500402
*           ELSE GO TO G.                                       YM02685 02500802
*        B. MOVE ABEND CODE FROM LCT TO JCT AND DUMMY TCB.       Y02641 02501202
*        C. MOVE COMPLETION CODE INTO THE SCT                    Y02641 02501602
*        D. SET 'QMSJNL'  INDICATOR IN THE QMPA                  Y02641 02501702
*        E. WRITE JCT AND SCT TO SWA                             Y02641 02501802
*        F. SET 'IN TERM' IN JSCB.                              YM02685 02501902
*        G. IF JCTWARMS ON AND JOB 'IN TERM' AND NO ABEND        Y02641 02510802
*           CODE, SET CONTINUE RESTART INDICATOR IN JCT.         Y02641 02516802
*        H. CALL UNALLOCATION                                    Y02641 02522802
*                                                                Y02641 02528802
*                                                                Y02641 02536002
*        CORE IS GOTTEN FOR A REGISTER SAVE AREA AND CON-               02700002
*        TROL IS PASSED TO TERMINATION.                                 02750002
*                                                                       02800002
*        UPON RETURN FROM TERMINATION THE DUMMY TCB IS FREED,   YM07604 02850002
*        THE SCT IS WRITTEN TO THE JOURNAL,THE REGISTER SAVE-   YM07604 02870002
*        AREA IS FREED,AND THE TERMINATION PARAMETER LIST IS    YM07604 02890002
*        FREED.                                                 YM07604 02910002
*                                                                       02950002
*        IEFSD164 NOW CHECKS THE RETURN CODE FROM TERMINATION           03000002
*        TO DETERMINE IF THE LAST STEP OF THE JOB TERMINATED,           03050002
*        WHETHER ANOTHER STEP IS TO BE INITIATED, OR WHETHER            03100002
*        THE JOB IS TO BE SUSPENDED.                                    03150002
*                                                                       03151002
*        IF 'JCTCONTR OR JCTSTEPR OR JCTCKPTR' IS ON             Y02641 03152002
*        CALL JOB SUSPENSION. IF JCTWARMS IS ON CALL             Y02641 03154002
*        JOB DELETE.                                             Y02641 03156002
*                                                                       03166002
*        IF THERE IS ANOTHER STEP IN THE JOB AND JCTCONTR IS NOT ON,    03180002
*        ISSUE ENDREQ MACRO USING THE SYSTEM MESSAGE RPL       @ZA09487 03181040
*        POINTED TO BY THE JSCBSMLR TO FLUSH THE JES BUFFERS   @ZA09487 03182040
*        OF SYSTEM MESSAGES FOR THE PREVIOUS STEP,             @ZA09487 03183040
*        CLEAR THE JSCB DEB POINTER, CLEAR JSCB SHARE INDICATOR AND     03186002
*        TURN OFF THE AUTHORIZED FLAG IN THE JSCB.              YM01497 03192002
*        THE SCT FOR THE STEP IS READ INTO CORE AND                     03200002
*        CONTROL IS PASSED TO IEFSD101. IF THE LAST STEP OF THE         03250002
*        JOB HAS TERMINATED CONTROL IS PASSED TO IEFSD166.              03300002
*                                                                       03305002
*        ALSO IF THE JOB IS TO BE SUSPENDED,CONTROL IS           Y02652 03310002
*        PASSED TO IEFSD166.                                     Y02652 03320002
*                                                                       03400002
*   NOTES=THIS MODULE CALLS IEFSD101 AND IEFSD166 AND DOES NOT          03410002
*        NOT RECEIVE CONTROL BACK.                                      03420002
*        CHARACTER CODE DEPENDENCIES=NONE                               03430002
*        RESTRICTIONS=NONE                                              03440002
*        REGISTER CONVENTIONS=STANDARD                                  03442002
*        PATCH LABEL=PATCH                                              03446002
*                                                                       03448002
*   MODULE TYPE=CSECT                                                   03448402
*        PROCESSOR=ASSEMBLER                                            03449202
*        MODULE SIZE=LESS THAN 4K                                       03449602
*        ATTRIBUTES=PAGED LPA,REENTRANT,ZERO PROTECT KEY,               03449702
*             REFRESHABLE,SUPV STATE                                    03449802
*                                                                       03449902
*   ENTRY POINT=IEFSD064                                                03466602
*        PURPOSE=(SAME AS FUNCTION)                                     03476602
*        LINKAGE=:                                                      03478602
*        A. VIA BRANCH FROM IEFSD161 FOR WARMSTART                      03480602
*        B. VIA BRANCH FROM IEFSD162 IF ERROR OCCURRED IN               03482602
*             ALLOCATION                                                03483002
*        C. VIA BRANCH FROM IEFSD263 FROM JOB STEP EXECUTION            03483102
*        INPUT DATA=R1 POINTS TO IEFPARAM                               03483202
*        REGISTERS SAVED=NONE                                           03488802
*        REGISTER CONTENTS DURING PROCESSING=N/A                        03490802
*        REGISTERS RESTORED=NONE                                        03492802
*                                                                       03493202
*   EXIT-NORMAL=:                                                       03493602
*        A.IEFSD101 (VIA BRANCH)                                        03494002
*        CONDITIONS=TO INITIATE THE NEXT STEP OF THE JOB                03494102
*        OUTPUT DATA=R1 POINTS TO LCT,THE SCT FOR THE NEXT IS           03494202
*             IN CORE                                                   03494302
*        RETURN CODES=NONE                                              03508202
*        B. IEFSD166 (VIA BRANCH)                                       03518202
*        CONDITIONS= FOR JOB DELETE OR JOB SUSPENSION                   03520202
*        OUTPUT DATA=R1 POINTS 2 WORD PARAMETER LIST                    03520602
*                THE FIRST WORDS POINTS TO THE LCT THE SECOND           03520702
*                CONTAINS THE FUNCTION CODE                             03520802
*        RETURN CODES (FUNCTION CODE)=:                                 03521002
*        4-IF THE JOB IS TO BE DELETED                                  03521402
*        8-IF THE JOB IS TO BE SUSPENDED                                03521802
*                                                                       03521902
*   EXIT-ERROR=NONE                                                     03522002
*        CONDITIONS=N/A                                                 03522102
*        OUTPUT DATA=N/A                                                03526702
*        RETURN CODES=N/A                                               03528702
*                                                                       03530702
*   EXTERNAL REFERENCES:                                                03531102
*        ROUTINES=:                                                     03531202
*        A. TERMINATION TO PERFORM STEP AND JOB UNALLOCATION            03538102
*        B. SWA MANAGER TO READ AND WRITE SWA CONTROL BLOCKS            03540102
*        DATA AREAS=STAE EXIT PARAMETER LIST AND TERMINATION            03541202
*             PARAMETER LIST                                            03546102
*        CONTROL BLOCKS=LCT,SCT,JCT,TCB,QMPA,IEL,JSCB,ACT,JACT          03551002
*                       JESCT                                  @Z40FPPJ 03553040
*        TABLES=NONE                                                    03555902
*        MACROS=GETMAIN,FREEMAIN,CLOSE,ENDREQ                  @ZA09487 03557940
*                                                                       03565702
*   CHANGE LEVEL=Y02621,Y02641,Y02652,Y02653,YM02685,YM01497,           03567702
*                YM02479,YM06015,YM06443,YM07604,YM06095,YM07219        03568702
*                @Z40FPPJ,OZ17354                              @ZA17354 03569240
*                OZ09487                                       @ZA09487 03569440
*                                                                       03569702
*   MESSAGES=NONE                                                       03570602
*                                                                       03575502
********************END OF SPECIFICATION**************************      03580402
         EJECT                                                          03585302
         BALR  12,0                                                     03590202
         USING *,12                                                     03595102
         USING IEFSCT,R5                                                03600000
         USING IEFLOT,R11                                               03650000
         USING IEFPARAM,R2                                              03700000
         USING IHADCB,9                                                 03750000
*********************************************************************** 03800000
*        THIS CODE WILL CAUSE THIS MODULE TO BE MORE EASILY IDENTIFIED* 03850000
*        IN A CORE DUMP.                                              * 03900000
*********************************************************************** 03950000
IEFSD164 MODID                                                   Y01886 04000000
         LR    R2,R1                   SAVE INPUT PARAM LIST PTR        04050000
         L     R11,LCTADDR             GET LCT ADDR               M0138 04100000
         USING IOPARAMS,10                                       S21474 04150000
         LA    R10,QMGR1                ADDRESS OF QUEUE MANAGER S21474 04200000
*                                       PARAMETER AREA           S21474 04250000
         LA    R13,REGSAVE      GET REGSAVE ADDR                VS20443 04250402
*********************************************************************** 04252002
* IF IEFSD164 IS BEING ENTERED FOR WARMSTART PROCESSING OR BECAUSE      04254002
* OF AN ERROR IN ALLOCATION, THEN BY-PASS DCB AND TIME PROCESSING.      04256002
*********************************************************************** 04258002
         USING IEFJCT,R4                                         Y02641 04260002
         L     R4,LCTJCTAD         GET ADDR OF JCT               Y02641 04270002
         LA    R4,D0(R4)           CLEAR THE HIGH ORDER BYTE     Y02641 04272002
         LTR   R4,R4               IS THERE AN IN-CORE JCT       Y02641 04280002
         BZ    SD164009            NO,DO NOT CHECK FOR WARMSTART Y02641 04290002
         TM    JCTRSW1,JCTWARMS    IS 164 BEING ENTERED FOR WARM Y02641 04292002
*                                  START PROCESSING              Y02641 04294002
         BO    SD16446             YES,BYPASS DCB AND TIME PROC- Y02641 04296002
*                                  ESSING                        Y02641 04298002
SD164009 EQU   *                                                 Y02641 04298802
         TM    LCTOPSW3,LCTALERR   ERROR DURING ALLOCATION        M0475 04300000
         BO    SD16446             YES, BYPASS DCB PROCESSING     M0475 04350000
         L     R8,IEFTCBAD        ADDRESS OF INIT TCB             20030 04450000
         USING TCB,R8                  TCB ADDRESSABILITY         20029 04500000
*********************************************************************** 04550002
* WHEN FETCHLIB, JOBLIB/STEPLIB ARE CLOSED, THE CURRENT TCB MUST        04600002
* POINT TO THE P/P TIOT.                                                04650002
* IF ENTERED, THE INITIATOR RECOVERY ROUTINE WILL RESTORE THE           04670002
* POINTER(P/P TIOT) IF PARTIOTB IS NOT ZERO.                            04680002
*********************************************************************** 04690402
         MVC PARTIOTB,TCBTIO       SAVE INIT TIOT PTR            Y02653 04692002
         L     R6,IEFTIOTA             GET ADDRESS OF TIOT LIST         04700000
         L     R6,0(R6)                GET ADDRESS OF JOB STEP TIOT     04750000
         ST    R6,TCBTIO               PUT PTR TO JOB STEP TIOT IN20029 04800000
*                                      INITIATOR'S TCB SO CLOSE CAN     04850000
*                                      REFERENCE IT                     04900000
*********************************************************************** 05250002
*     CHECK THE FETCH DCB POINTER IN THE SUPERVISOR   LIST. IF IT IS  * 05300002
*     NON-ZERO,CLOSE THE FETCH DCB AND FREE UP ITS CORE               * 05350002
*********************************************************************** 05400002
         L     R1,IEFREMLS        ADDRESS OF ATTACH LIST          20030 05550000
         USING ATTCHLST,R1                                              05600000
         L     R5,ATDCBADA        ADDRESS OF FETCH DCB            20030 05650000
         DROP  R1                                                 20030 05700000
         LA    R5,0(R5)                ZERO OUT HIGH ORDER BYTE    CR17 05750000
         LTR   R5,R5                    IS THERE A FETCH DCB ?          05800000
         BZ    SD64010                  NO                              05850000
         MVI   REGSAVE,X'80'            INDICATE LIST END               05900000
         LA    R1,REGSAVE               ADDRESS OF REMOTE LIST          05950000
         CLOSE  ((5)),MF=(E,(1))        CLOSE THE FETCH DCB             06000000
         LR    R1,R5                    ADDRESS OF DCB                  06050000
         LA    R0,DCBEND-IHADCB         LENGTH OF DCB                   06100000
         LA    R14,TCORE                SUBPOOL NUMBER                  06150000
         SLL   R14,24                   TO HIGH ORDER BYTE OF           06200000
         OR    R0,R14                   LENGTH REGISTER                 06250000
         FREEMAIN  R,LV=(0),A=(1)       FREE THE FETCH DCB              06300000
SD64010  EQU   *                                                        06350000
*********************************************************************** 06400000
*        THIS CODE WILL GETMAIN FOR THE JCT,SCT AND THE PARAMETER LIST* 06450000
*        REQUIRED BY TERMINATE. THE JCT AND SCT WILL BE READ INTO CORE* 06500000
*        AND THE PARAMETER LIST BUILT FOR TERMINATE.                  * 06550000
*********************************************************************** 06600000
         GETMAIN    R,LV=24,SP=TCORE    TERMINATE PARAM LIST CORE  CR17 06650000
         LR    R3,R1               SAVE ADDR OF PARMLIST                06700002
         L     R4,LCTJCTAD         GET ADDR OF JCT             YM01566  06750002
         L     R5,LCTSCTAD         GET ADDR OF SCT             YM01566  06800002
*********************************************************************** 06900000
*        BUILD PARAMETER LIST                                         * 06950000
*********************************************************************** 07000000
         MVC   ZERO(D4,R3),LCTADDR  MOVE LCT ADDR TO PARM LIST    M0138 07050000
         MVC   12(4,R3),IEFTIOTA        TIOT ADDRESS TO PARM LIST       07100000
         SR    R6,R6                                                    07150000
         ST    R6,16(R3)               STORE ZERO INTO PARAM LIST TO    07200000
*                                      MAINTAIN OLD INTERFACE FOR     * 07250000
*                                      INDICATIVE DUMP                * 07300000
         ST    R4,4(R3)                STORE POINTER TO JCT INTO        07350000
*                                      PARAM LIST                     * 07400000
         ST    R5,8(R3)                STORE POINTER TO SCT INTO        07450000
*                                      PARAM LIST                     * 07500000
*******************************************************************OC42 11350000
*        CLOSE AND FREEMAIN FOR JOBLIB OR STEPLIB DCB, IF ANY    *      11400000
*******************************************************************OC42 11450000
         L     R7,LCTJOBLB                                         CR17 11550000
         LTR   R7,R7                   WAS JOBLIB OR STEPLIB      17052 11600000
         BZ    SD064022                 NO.                        CR17 11650000
         LA    R1,REGSAVE               YES. REMOTE LIST.          CR17 11700000
         MVI   0(R1),X'80'              INDICATE END OF LIST            11750000
         CLOSE  ((7)),MF=(E,(1))        CLOSE THE DCB                   11800000
         LA    R0,DCBEND-IHADCB         LENGTH OF DCB                   11850000
         LA    R14,TCORE                SUBPOOL NUMBER                  11900000
         SLL   R14,24                   TO HIGH ORDER BYTE              11950000
         OR    R0,R14                   OF LENGTH REGISTER              12000000
         LR    R1,R7                    ADDRESS OF DCB                  12050000
         FREEMAIN  R,LV=(0),A=(1)       FREE THE DCB CORE               12100000
         XC    LCTJOBLB(4),LCTJOBLB     ZERO OUT DCB PTR IN LCT    CR17 12150000
SD064022 EQU   *                                                        12200000
         LA    R13,REGSAVE                                              12250002
         DROP  R8                                                       12500000
         LA    R7,LCTTMWRK              ADDRESS OF TIMER WORK AREA      12550002
         L     R8,LCTTSRB4          GET SRB TIME FOR STEP        Y02652 12560002
         ST    R8,SCTSRBT           PUT SRB STEP TIME IN SCT     Y02652 12570002
         L     R14,JCTSRBT         GET PREVIOUS SRB TIME FOR JOB YO2652 12580002
         AR    R14,R8               ADD IN CURRENT SRB STEP TIME Y02652 12590002
         ST    R14,JCTSRBT          PUT NEW SRB JOB TIME IN JCT  Y02652 12592002
         L     R8,D12(R7)          TIME USED                     Y02652 12600002
         MVC   D4(D4,R7),D8(R7)    NEW INITIAL STEP TIME         Y02652 12650002
         L     R14,0(0,R7)              JOB RUNNING TIME                13450000
         AR    R14,R8                   TOTAL JOB TIME                  13500000
         ST    R14,0(0,R7)              PUT BACK IN TWA                 13550000
         LA    R8,12(0,R7)              IN SYSGEN SLOT                  13650000
         GETMAIN R,LV=176               GET CORE FOR STEP-JOB ACTS      13700000
         SR    R9,R9                    INDICATE 1ST TIME THROUGH       13750000
         LR    R7,R1                    SAVE ACT ADDRESS                13800000
         LA    R6,REGSAVE+72       ADDR OF REMOTE LIST                  13810002
         MVC   4(3,R6),32(R5)           ADDRESS OF STEP ACT             13850000
SD064028 EQU   *                                                        13860002
         LA    R1,REGSAVE+72       ADDR OF REMOTE LIST                  13870002
         ST    R1,QMPCL            PUT ADDR OF REMOTE LIST IN PARM      13880002
         MVI   QMPCL,X'01'              INDICATE 1 OPERATION            13900002
         MVI   QMPOP,X'04'              INDICATE READ                   13950000
         ST    R7,0(0,R6)               ACT CORE ADDRESS TO QMPA        14000000
         LR    R1,R10                   ADDRESS OF QMPA TO R1           14050000
         L     R15,QMGRVCON             ADDRESS OF Q MGR                14100000
         BALR  R14,R15                  GO TO Q MGR                     14150000
         TM    SCTSSTAT,X'04'      IS THIS STEP DSDRP              CR17 14550000
         BO    FREECORE            YES, DONT PUT TIME IN ACT       CR17 14600000
         LTR   R9,R9               IS THIS FIRST PASS              CR17 14650000
         BNZ   SD16435             NO, BRANCH                      CR17 14700000
         MVC   28(3,R7),1(R8)      PUT TIME IN STEP ACT            CR17 14750000
         B     SD16436                                             CR17 14800000
SD16435  EQU   *                                                   CR17 14850000
         L     R8,0(R8)            LOAD TIME USED                  CR17 14900000
         LA    R8,0(R8)            CLEAR HIGH ORDER BYTE           CR17 14950000
         L     R14,28(R7)          LOAD TOTAL TIME USED            CR17 15000000
         SRDL  R14,8               RIGHT ADJUST AND                CR17 15050000
*                                  SAVE LOW ORDER BYTE             CR17 15100000
         AR    R14,R8              ADD STEP TIME TO TOTAL TIME     CR17 15150000
         SLDL  R14,8               RESTORE LOW ORDER BYTE          CR17 15200000
         ST    R14,28(R7)          PUT TOTAL TIME IN JOB ACT       CR17 15250000
SD16436  EQU   *                                                   CR17 15300000
         OI    QMSTA,QMSJNL        JOURNAL STEP AND JOB ACT      Y02641 15310002
         MVC   4(4,R6),0(R7)            MOVE ACT TTR TO REMOTE LIST     15350000
         LR    R1,R10                   ADDRESS OF Q MGR PARAM AREA     15400000
         MVI   QMPOP,X'03'              INDICATE WRITE                  15450000
         L     R15,QMGRVCON             ADDRESS OF Q MGR                15500000
         BALR  R14,R15                  GO TO Q MGR                     15550000
         LTR   R9,R9                    IS THIS FIRST TIME THRU ?       15950000
         BP    FREECORE                 NO                              16000000
         LA    R9,1                     INDICATE 2ND PASS               16050000
         MVC   4(3,R6),40(R4)           TTR OF JOB ACT                  16100000
         B     SD064028                 GET JOB ACT                     16150000
FREECORE LR    R1,R7                    ADDRESS OF ACT                  16200000
         FREEMAIN R,LV=176,A=(1)        FREE CORE FOR ACT TABLES        16250000
         NI    QMSTA,FF-QMSJNL     TURN OFF JOURNAL INDICATOR    Y02641 16300002
*********************************************************************** 16502002
* RESTORE THE INITIATORS TIOT POINTER TO THE INITIATORS TCB             16510002
*********************************************************************** 16522002
         L     R7,IEFTCBAD        ADDRESS OF INIT TCB             20030 16550000
         USING TCB,R7                  TCB ADDRESSABILITY         20029 16600000
         MVC   TCBTIO,PARTIOTB     RESTORE INITS TIOT PTR        Y02653 16610002
         XC    PARTIOTB,PARTIOTB   CLEAR PTR IN IEFPARAM         Y02653 16620002
         DROP  R7                                                 20029 16700000
         USING STEPL,R1                                          Y02653 16750002
         L     R1,LCTSTEPL         GET ADDR OF STEPL             Y02653 16800002
         LTR   R1,R1               DOES A STEPL EXIST            Y02653 16850002
         BZ    SD16443             NO, NO NEED TO CLEAR PTR      Y02653 16900002
         XC    STEPARAM,STEPARAM   YES, CLEAR PTR TO IEFPARAM IN Y02653 16950002
*                                  THE STEPL                     Y02653 17000002
SD16443  EQU   *                                                 Y02653 17010002
         LA    R0,ATLSTSIZ+IEFPSIZE GET LENGTH OF IEFPARAM AND   Y02653 17050002
*                                  THE ATTATCH PARAMETER LIST    Y02653 17060002
         LA    R1,TCORE                 SUBPOOL NUMBER                  17200000
         SLL   R1,24                    TO HIGH ORDER BYTE OF           17250000
         OR    R0,R1                    LENGTH REGISTER                 17300000
         LR    R1,R2                    ADDRESS OF INPOUT LIST          17350000
         FREEMAIN  R,LV=(0),A=(1)       FREE THE INPUT LIST             17400000
         DROP  R2                                                 20030 17450000
         LR    R2,R7              SAVE ADDRESS OF INIT TCB        20030 17500000
SD16446 EQU    *                                                 S21474 17550000
         LA    R0,TCBLEN           TCB LENGTH                      I272 17600000
         GETMAIN    R,LV=(0)       GET CORE FOR DUMMY TCB          I272 17650000
         XC    ZERO(FF,R1),ZERO(R1)            ZERO DUMMY TCB           17754002
         XC    FF(TCBLEN-FF,R1),FF(R1)       ZERO REMAINDER OF TCB      17754402
         USING TCB,R1                  TCB ADDRESSABILITY         20029 17756002
         TM    JCTRSW1,JCTWARMS    IS JOB BEING WARMSTARTED      Y02641 17760002
         BO    SD16447             YES BY-PASS                   Y02641 17770002
         TM    LCTOPSW3,LCTALERR   ERROR DURING ALLOCATION        M0475 17800002
         BZ    SD16448             NO                             M0475 17850000
         L     R4,LCTTCBAD         ADDR OF INIT TCB              S21474 17862002
         MVC   TCT(D4,R1),TCT(R4)  PUT TCT PTR IN DUMMY TCB      S21474 17870002
         XC    LCTCOMCD,LCTCOMCD   CLEAR THE COMPLETION  CODE    Y02641 17880002
         L     R9,LCTQDRTY         GET ADDR OF JOBS CSCB        YM06015 17880302
         USING IEFCSCB,R9          SET CSCB BASE                YM06015 17880602
         TM    CHACT,CHCLD         HAS THIS JOB BEEN CANCELED   YM06443 17880902
         BNO   SD16447A            NOT CANCELED, DO NOT PICK UP THE     17881202
*                                  CANCEL ECB COMP CODE         YM06443 17881502
         ST    R1,LCTTCBAD         STORE PTR TO DUMMY TCB       YM02479 17882002
         L     R5,LCTSCTAD         ADDR OF SCT(TO BE USED ON    YM02479 17883002
*                                  RETURN FROM TERMINATION      YM02479 17884002
         L     R4,LCTJCTAD         ADDRESS OF JCT               YM02479 17885002
         L     R15,CHCECB          GET CANCEL ECB FROM CSCB     YM06015 17886002
         SLL   R15,D12             CHANGE CC IN ECB TO TCB CC FORMAT    17886302
*                                                               YM06015 17886402
         ST    R15,TCBCMP          PUT CC FROM ECB IN TCB FORMAT IN THE 17886602
*                                  DUMMY TCB FOR UNALLOCATION   YM06015 17894602
         OI    TCBFLGS,TCBFA       SET ABEND INDICATOR         @ZA17354 17898640
         DROP  R9                  DROP ECB BASE                YM06015 17902602
         LR    R3,R2               STORE PARM LIST PTR          YM02479 17910602
         B     SD16449             GET SAVEAREA FOR TERMINATE   YM02479 17918602
SD16447  EQU   *                                                 Y02641 17926602
         CLC   JCTACODE(D4),ZEROS  IS THERE AN ABEND CODE        Y02641 17940002
         BE    SD16447A            NO DONT SET ABEND INDICATORTR Y02641 17942002
         OI    TCBFLGS,TCBFA       SET ABEND INDICATOR           Y02641 17944002
SD16447A EQU   *                                                 Y02641 17946002
         ST    R1,LCTTCBAD         STORE PTR TO DUMMY TCB        S21474 17950000
         L     R5,LCTSCTAD         ADDR OF SCT(TO BE USED ON     S21474 18050000
*                                  RETURN FROM TERMINATION       S21474 18100000
         L     R4,LCTJCTAD         ADDRESS OF JCT                YM1234 18110001
         MVC   TCBCMP(D4),LCTCOMCD PUT COMPLETION CODE IN TCB    Y02641 18180002
         LR    R3,R2               STORE PARM LIST PTR           S21474 18200000
         B     SD16449             GET SAVEAREA FOR TERMINATE    S21474 18250000
SD16448  EQU   *                                                 S21474 18300002
         L     R7,LCTTCBAD         ADDRESS OF INIT TCB           Y02641 18360002
         MVC   TCBPKF(D1),TCBPKF-TCB(R7)  PUT PROTECT KEY IN     Y02641 18370002
*                                   DUMMY TCB                    Y02641 18390002
         ST    R1,LCTTCBAD         ADDRESS OF TCB TO LCT           I272 18550000
         MVC   TCBTCTB(D3),LCTPARM1+D1     ADDR TCT FOR PGM       20029 18600000
         MVC   TCBFLGS(D1),LCTPARM1    TCB STATUS FLAGS FOR PGM   20029 18650000
         TM    TCBFLGS,TCBFA           ABEND BIT ON IN TCB        20029 18700000
         BNO   DONTSET                 NO-DONT SET BIT IN LCT    A30740 18750000
         OI    LCTINTSW,LCTABEND       YES-SET BIT IN LCT        A30740 18800000
DONTSET  EQU   *                                                 A30740 18850000
         MVC   TCBCMP(D4),LCTPARM4     COMP CODE FOR PGM          20029 18900000
         MVC   TCBDSP(D1),LCTPARM3     DISP PRIORITY OF JOB STEP  20029 18950000
         DROP  R1                                                 20029 19000000
SD16449 EQU    *                                                 S21474 19050000
*********************************************************************** 19060002
* THIS SECTION OF CODE PERFORMS WARMSTART PROCESSING. THIS INVOLVES     19070002
* MOSTLY SETTING STATUS INDICATORS TO INDICATE WHERE IN PROCESSING      19080002
* A JOB IS,SAVING OF COMPLETION AND ABEND CODES,AND CHECKPOINTING       19090002
* THE JCT AND SCT TO SAVE THE DATA IN CASE OF A SYSTEM FAILURE.         19092002
*********************************************************************** 19094002
         TM    JCTRSW1,JCTWARMS    IS JOB BEING WARMSTARTED      Y02641 19094402
         BO    SD16450             YES-BYPASS THIS PROCESSING    Y02641 19095202
         TM    JCTJSB,JCTJSBEX     DOES THE JOB STATUS INDICATE  Y02641 19098402
*                                  IN EXECUTION                  Y02641 19098802
         BNO   SD16452             IF NOT,BYPASS COMPLETION CODE Y02641 19099202
*                                  PROCESSING                    Y02641 19099602
         TM    LCTINTSW,LCTABEND   HAS THE JOB ABENDED           Y02641 19099702
         BNO   SD16451             NO, NO ABEND CODE             Y02641 19103002
         MVC   JCTACODE(D4),LCTPARM4 MOVE ABEND CODE TO JCT      Y02641 19106702
SD16451  EQU   *                                                 Y02641 19133002
         NI    JCTJSB,FF-JCTJSBEX  TURN OFF JCT'IN EXECUTION BIT'Y02641 19133802
         OI    JCTJSB,JCTJSBTM     SET IN TERMINATION INDICATOR  Y02641 19136402
         TM    LCTINTSW,LCTABEND   HAS THE JOB ABENDED           Y02641 19138002
         BO    SD16451B            YES, NO COMPLETION CODE       Y02641 19138802
         MVC   SCTSEXEC(D2),LCTPARM4+D2 PUT COMP. CODE IN SCT    Y02641 19139602
         NC    SCTSEXEC(D2),X0FFF  TURN OFF HIGH ORDER FOUR BITS Y02641 19143602
* THE COMPLETION CODE IS ONLY 12 BITS- THE LOW ORDER 12.         Y02641 19144402
SD16451B EQU   *                                                 Y02641 19145202
********************************************************************    19145302
* BUILD EPAS FOR JCT AND SCT AND INVOKE THE SWA MANAGER WRITE           19145602
* LOCATE ROUTINE TO CAUSE THE DATA IN THE TWO CONTROL BLOCKS            19146002
* TO BE JOURNALED.                                                      19146402
********************************************************************    19146502
         LA    R1,REGSAVE+72       ADDR OF REMOTE PARMLIST       Y02641 19147602
         LA    R13,REGSAVE         ADDR OF REGISTER SAVE AREA    Y02641 19149202
         USING SMPARMS,R1                                       YM01566 19159202
         LA    R15,SMEPAPTR        GET PTR TO FIRST             YM01566 19169202
         ST R15,SMPARM1            PARAMETER (EPA PTR)          YM01566 19180002
         LA    R15,SMCODE          SET PTR TO SECOND            YM01566 19180102
         ST    R15,SMPARM2         PARAMETER                    YM01566 19180202
*                                                                       19180302
         LA    R15,SMEPA1          GET PTR TO FIRST EPA         YM01566 19180402
         ST    15,SMEPAPTR         STORE IN PARAMETER           YM01566 19181902
*                                                                       19183902
         MVC   SMCODE,WRTELCTE     SET CODE FOR WRITE LOCATE    YM01566 19185902
         XC    SMEPA1(SMEND-SMEPA1),SMEPA1 CLEAR EPAS           YM01566 19186302
*                                                                       19186702
*        SET UP EPA FOR JCT                                             19187102
         LA    R15,SMEPA1          ADDR OF EPA FOR JCT          YM01566 19187202
         USING ZB505,R15                                                19187302
         ST    R4,SWBLKPTR         PUT JCT BLOCK ADDR IN EPA    YM01566 19187402
         MVC   SWVA,LCTJCTVA       PUT JCT SVA IN EPA           YM01566 19188002
         LA    R14,SWLGTH          LENGTH OF JCT                YM01566 19188402
         ST    R14,SWLNGTH         PUT LENGTH ON EPA            YM01566 19188802
         LA    R14,SMEPA2          GET ADDR OF NEXT EPA(SCT)    YM01566 19189202
         ST    R14,SWCHNPTR        CHAIN EPAS                   YM01566 19189302
*                                                                       19189502
*        SET UP EPA FOR SCT                                             19189602
         LA    R15,SMEPA2          ADDR OF EPA FOR SCT          YM01566 19189702
         ST    R5,SWBLKPTR         PUT SCT BLOCK ADDR IN EPA    YM01566 19189902
         MVC   SWVA,LCTSCTVA       PUT SCT SVA IN EPA           YM01566 19190102
         LA    R14,SWLGTH          LENGTH OF SCT                YM01566 19190202
         ST    R14,SWLNGTH         PUT LENGTH ON EPA            YM01566 19190302
         DROP  R15                                              YM01566 19190402
* GET ENTRY POINT TO SWA MANAGER'S LOCATE MODE ROUTINE                  19190702
         L     R15,CVTPTR          GET PTR TO CVT               YM01566 19191102
         USING CVTMAP,R15                                       YM01566 19191202
         L     R15,CVTJESCT        GET PTR TO JESCT             YM01566 19191302
         DROP  R15                                              YM01566 19191402
         USING JESCT,R15                                        YM01566 19191502
         L     R15,JESWAA          GET ADDR OF SWA MANAGER      YM01566 19191602
*                                  LOCATE ROUTINE               YM01566 19191702
         DROP  R1,R15                                           YM01566 19191802
         BALR  R14,R15             DO WRITE LOCATE FOR JCT/SCT  YM01566 19192102
********************************************************************    19192202
*  UPON RETURN FROM SWA MANAGER WRITE LOCATE, MARK THE JSCB AS          19192302
*  HAVING 'ENTERED TERMINATION' AND REMOVE 'COMPLETED ALLOCATION'.      19192402
********************************************************************    19192502
         L     R1,LCTJSCB          GET ADDR OF JSCB             YM02685 19192602
         USING IEZJSCB,R1                                       YM02685 19192702
         NI    JSCBJJSB,FF-JSCBJSBX  TURN OFF JSCB'IN EXEC BIT' YM02685 19192802
         OI    JSCBJJSB,JSCBJSBT  SET IN TERM INDICATOR IN JSCB YM02685 19193502
         DROP  R1                                               YM02685 19193802
SD16450  EQU   *                                                 Y02641 19196502
         NI   QMSTA,FF-QMSJNL      INDICATE NOT TO JOURNAL       Y02641 19200502
* IF THE JOB IS BEING WARMSTARTED,AND FAILED WHILE IN TERMINATION       19202502
* AND THERE WAS NO ABEND CODE, THEN INDICATE THE JOB IS TO BE RESTARTED 19206502
         TM    JCTRSW1,JCTWARMS    IS JOB BEING WARMSTARTED      Y02641 19208502
         BNO   SD16452             NO,DO NOT SET CONT-RESTART    Y02641 19210502
         TM    JCTJSB,JCTJSBTM     DID JOB FAIL IN TERMINATION   Y02641 19214502
         BNO   SD16452A            NO,DO NOT SET CONT -RESTART   Y02641 19216502
         CLC   JCTACODE(D4),ZEROS  DID THE JOB ABEND             Y02641 19218502
         BNE   SD16452A            YES,DO NOT SET CONT-RESTART   Y02641 19220502
         CLC   SCTANSCT(D4),ZEROS  IS THERE ANOTHER STEP         Y02641 19224502
         BE    SD16452A            NO, NO NEED TO CONTINUE       Y02641 19227502
         OI    JCTRSW1,JCTCONTR    SET CONTINUE RESTART FLAG     Y02641 19230502
         B     SD16452A            GET CORE FOR SAVE AREA        Y02641 19232502
SD16452  EQU   *                                                 Y02641 19234502
         TM    LCTOPSW3,LCTALERR   DID JOB FAIL IN ALLOCATION    Y02641 19236502
         BO    SD16452A            YES,DO NOT UPDATE JCT         Y02641 19240502
         IC    R1,JCTSNUMB         INCREMENT STEP COUNTER       YM06095 19248502
         LA    R1,1(R1)              IN                         YM06095 19249502
         STC   R1,JCTSNUMB           JCT                        YM06095 19250502
*              LCTPARM1 CONTAINS TCBFLGS FROM EXEC PGM TCB         I272 19251502
         TM    LCTPARM1,TCBFA          DID EXEC PGM ABEND         20029 19252502
         BO    SD16452A            YES                             CR17 19253502
         MVC   JCTSSTR(4),SCTANSCT DENOTE NEXT STEP IN JCT         CR17 19254502
SD16452A EQU   *                                                 Y02641 19264602
         LA    R13,REGSAVE         GET ADDR OF REG SAVEAREA     AS20443 19264840
         NI    LCTOPSW3,FF-LCTALERR   ZERO ALLOC RET. CODE        M0475 19265002
         NI    LCTERR,FF-LCTACOMP     CLEAR THE ALLOC COMP FLAG YM07219 19265202
*                                     USED FOR ESTAE RETRY TEST YM07219 19265402
         L     R15,CVTPTR          GET PTR TO CVT              @Z40FPPJ 19290740
         USING CVTMAP,R15                                      @Z40FPPJ 19291740
         L     R15,CVTJESCT        GET PTR TO JESCT            @Z40FPPJ 19292740
         DROP  R15                                             @Z40FPPJ 19293740
         USING JESCT,R15                                       @Z40FPPJ 19294740
         L     R15,JESUNALC        GET ADDRESS OF UNALLOCATION @Z40FPPJ 19295740
         LR    R1,R3               PASS PARM LIST TO UNALLOC   @Z40FPPJ 19296240
         BALR  R14,R15             GO TO UNALLOCATION          @Z40FPPJ 19296740
*********************************************************************** 19400000
*        UPON RETURNING FROM TERMINATE, REG 15 WILL REFLECT A CODE    * 19450000
*        USED TO DETERMINE IF JOB TERMINATE WAS ENTERED BY STEP TERM. * 19500000
*        IF JOB TERM HAS BEEN ENTERED, CONTROL IS PASSED TO IEFSD066, * 19550000
*        THE JOB DELETE MODULE.  IF JOB TERM HAS NOT BEEN      *   I272 19600000
*        ENTERED CONTROL IS PASSED TO ALLOCATE FOR AND ATTACH  *   I272 19650000
*        ANOTHER STEP.                                         *   I272 19700000
         LR    R7,R15              SAVE RETURN CODE            *   I272 19750000
*                                                               YM07604 19901002
*        THE STEP SCT MUST BE JOURNALED AGAIN AT THIS POINT.    YM07604 19901602
*        THE MOVE MODE IS USED BECAUSE WITH THE TERMINATION     YM07604 19902202
*        INDICATORS ON,A WRITE LOCATE WOULD NOT CAUSE THE       YM07604 19902802
*        BLOCK TO BE JOURNALLED                                 YM07604 19903402
         SPACE 1                                                YM07604 19904002
         OI    QMSTA,QMSJNL        TURN ON JOURNAL BIT IN QMPA  YM07604 19904602
         LA    R14,REGSAVE+72      ADDR. OF REMOTE PARAM. LIST. YM07604 19905202
         ST    R14,QMPCL           PUT REMOTE LIST ADDR IN QMPA.YM07604 19905802
         MVI   QMPCL,ONEOP         INDICATE ONE OPERATION..     YM07604 19906402
         MVI   QMPOP,WRITEOP       INDICATE WRITE OPERATION...  YM07604 19907002
         MVC   D0(D4,R14),LCTSCTAD MOVE SCT STORAGE ADDR TO THE YM07604 19907602
*                                  REMOTE PARAMETER LIST..      YM07604 19908202
         MVC   D4(D4,R14),SCTDISKA MOVE SCT'S SELF SVA AND ID   YM07604 19908802
*                                  TO THE REMOTE PARAM. LIST..  YM07604 19910002
         L     R15,QMGRVCON        ENTRY POINT OF SWA MGR...    YM07604 19911002
         LR    R1,R10              QMPA POINTER TO REG 1....    YM07604 19912002
*        REGISTER 13 STILL POINTS TO SAVE AREA FOR SWA MGR USE. YM07604 19912502
         BALR  R14,R15             GO TO THE SWA MANAGER...     YM07604 19913002
         NI    QMSTA,FF-QMSJNL     TURN OFF JOURNAL BIT IN QMPA YM07604 19914002
         SPACE 1                                                        19915002
         LA    R0,TCBLEN           TCB LENGTH                      I272 19915202
         L     R1,LCTTCBAD         ADDRESS OF TCB                  I272 19915402
         FREEMAIN   R,LV=(0),A=(1) FREE DUMMY TCB                  I272 19915602
         USING CVTDESCT,R1                                       Y02641 19916002
         L     R1,CVTPTR           GET ADDR OF CVT               Y02641 19920002
         L     R1,CVTTCBP          PTR TO NEXT AND CURRENT TCB   Y02641 19930002
         L     R1,D4(R1)           ADDR OF CURRENT TCB           Y02641 19940002
         ST    R1,LCTTCBAD         RESTORE CURR TCB PTR IN LCT   Y02641 19942002
         DROP R1                                                 Y02641 19944002
         L     R6,LCTENTR          GET ADDRESS OF IEL             M0397 19950000
         USING VIEL,R6             IEL ADDRESSABILITY             M0397 20000000
         L     R6,IELEXIT          GET ADDRESS OF INIT EXIT LIST  M0397 20050000
         DROP  R6                                                 M0397 20100000
         USING IELEXITS,R6         EXIT LIST ADDRESSABILITY       M0397 20150000
         CLI   IELRTNCD,HEX10      DID PRE-INVOCATION REQUEST     M2577 20200000
*                                  FLUSH PROCESSING             M2577   20250000
         BE    FLUSHBIT            YES,TEST FLUSH INDICATOR      S21474 20300000
         CLI   IELRTNCD,HEX14      DID POST INVOCATION REQUEST JOBM2577 20350000
*                                  FLUSH PROCESSING               M2577 20400000
         BNE   NORMAL              NO, BYPASS JOB FLUSH          S21474 20450000
FLUSHBIT EQU   *                                                  M2577 20500000
         TM    JCTJSTAT,JOBFLSH    HAS JOB FLUSH BIT BEEN SET     M0397 20550000
         BO    NORMAL              YES, BYPASS JOB FAIL SETTING   M0397 20600000
         OI    JCTJSTAT,INCMSTS    SET JOB FAIL BIT IN JCT        M0397 20650000
         DROP  R6                                                 M0397 20700000
NORMAL   EQU   *                                                  M0397 20750000
         LR    R1,R3                    ADDR OF TERMINATION PARAM  CR17 20800000
         FREEMAIN   R,LV=24,A=(1),SP=TCORE   FREE IT.              CR17 20850000
         LR    R1,R13                   ADDRESS OF REGSAVE              20900000
         TM    JCTRSW1,JCTCONTR+JCTCKPTR+JCTSTEPR SHOULD THE JOB Y02641 20960002
*                                  BE SUSPENDED                  Y02641 20970002
         BZ    SD16453             NO                            Y02641 20980002
         LA    R15,D8              YES, SET JOB SUSPENSION CODE  Y02641 20990002
         B     NOWTP               GO TO JOB SUSPENSION          Y02641 20990402
SD16453  EQU   *                                                 Y02641 20992002
         TM    JCTRSW1,JCTWARMS    IS JOB BEING WARMSTARTED      Y02641 20994002
         BNO   SD16454             NO,CONTINUE NORMAL PATH       Y02641 20996002
         LA    R7,D4               YES,GO TO JOB DELETE          Y02641 20998002
SD16454  EQU   *                                                 Y02641 20998402
         LA    R15,4                                               CR17 21000000
         CR    R7,R15                   IS THIS JOB TERMINATION.   CR17 21050000
         BNE   SD064214                 NO.                        CR17 21100000
*                                      YES.......                  I254 21150000
NOWTP    EQU   *                                                   I254 21850000
         ST    R11,LCTPARM1        PUT ADDR OF LCT IN PARMLIST   Y02641 21860002
         ST    R15,LCTPARM2        PUT FUNC CODE IN PARMLIST     Y02641 21870002
         LA    R1,LCTPARM1         PUT ADDR OF PARMLIST IN REG 1 Y02641 21880002
         L     R15,SD66VCON       GET ADDR OF IEFSD066                  21950002
         BR    R15                      GO TO IEFSD166             CR17 22000002
SD064214 LA    R15,8                                               CR17 22050000
         CR    R7,R15                   IS JOB TO BE SUSPENDED.    CR17 22100000
         BE    NOWTP               YES,GO TO IEFSD166            Y02641 22160002
*                                                                  I254 22500000
*******************************************************************I254 22550000
*                                                                  I254 22600000
         L     R7,LCTJSCB          ADDRESS EXEC PGM JSCB          M4338 22650000
         USING IEZJSCB,R7                                          I254 22700000
         L     R1,JSCBSMLR         GET SYSTEM MESSAGE RPL ADDR @ZA09487 22710040
         ENDREQ RPL=(R1)           PUT SYSTEM MESSAGE BUFFERS  @ZA09487 22720040
         XC    JSCBDBTB(D4),JSCBDBTB           CLEAR DEB PTR            22750000
         XC    JSCHPCEA(D3),JSCHPCEA ZERO ADDR OF JES CNTL ELMNT YM4419 22760001
*                                                                  I254 23350000
         XC    JSCBSHR,JSCBSHR     CLEAR SHARE INDICATOR          S0311 23360002
         NI    JSCBOPTS,FF-JSCBAUTH TURN OFF AUTHORIZED FLAG    YM01497 23380002
         LA    R1,REGSAVE+72            YES.QMGR REMOTE AREA.      CR17 23400000
         LA    R13,REGSAVE              REGISTER SAVE AREA              23450000
         L     R0,SCTANSCT              ADDRESS OF NEXT SCT             23500000
         USING SMPARMS,R1                                       YM01566 23510002
         LA    R15,SMEPAPTR        GET PTR TO FIRST             YM01566 23520002
         ST R15,SMPARM1            PARAMETER (EPA PTR)          YM01566 23530002
         LA    R15,SMCODE          SET PTR TO SECOND            YM01566 23540002
         ST    R15,SMPARM2         PARAMETER                    YM01566 23542002
*                                                                       23544002
         LA    R15,SMEPA1          GET PTR TO FIRST EPA         YM01566 23546002
         ST    15,SMEPAPTR         STORE IN PARAMETER           YM01566 23548002
*                                                                       23548402
         MVC   SMCODE,READLCTE     SET CODE FOR READ  LOCATE    YM01566 23548802
         XC    SMEPA1(SMEND-SMEPA2),SMEPA1 CLEAR EPA            YM01566 23549202
*                                                                       23549602
*        SET UP EPA FOR SCT                                             23549702
         LA    R10,SMEPA1          ADDR OF EPA FOR SCT          YM01566 23549802
         USING ZB505,R10                                                23549902
         ST    R0,SWVA             ADDR OF NEXT SCT             YM01566 23560002
* GET ENTRY POINT TO SWA MANAGER'S LOCATE MODE ROUTINE                  24050002
         L     R15,CVTPTR          GET PTR TO CVT               YM01566 24100002
         USING CVTMAP,R15                                       YM01566 24150002
         L     R15,CVTJESCT        GET PTR TO JESCT             YM01566 24200002
         DROP  R15                                              YM01566 24250002
         USING JESCT,R15                                        YM01566 24260002
         L     R15,JESWAA          GET ADDR OF SWA MANAGER      YM01566 24270002
*                                  LOCATE ROUTINE               YM01566 24280002
         BALR  R14,R15             LOCATE THE NEXT SCT          YM01566 24282002
         DROP  R15                                              YM01566 24290002
         ST    R0,LCTSCTDA         PUT SVA OF SCT IN THE LCT     Y02652 24292002
         MVC   LCTSCTAD,SWBLKPTR   PUT BOLCK ADDR IN LCT        YM01566 24292402
         DROP  R10                                              YM01566 24294002
         SR    R1,R1                                                    24296002
         IC    R1,LCTSNUMB              UPDATE                          24300000
         LA    R1,1(0,R1)               STEP NUMBER                     24350000
         STC   R1,LCTSNUMB              IN LCT                          24400000
*********************************************************************** 24450000
*                                                                     * 24500000
* LCTPARM1 IS TESTED IN IEFSD102 FOR DATA SET ENQUEUEING,AND MUST BE  * 24550000
* SET TO ZERO BEFORE EXITING IEFSD164 TO IEFSD101.                    * 24600000
*                                                                     * 24650000
         XC    LCTPARM1,LCTPARM1                                        24700000
*                                                                     * 24750000
*********************************************************************** 24800000
         LR    R1,R11                   LCT ADDRESS TO R1               24850000
         L     R15,SD101VCN       ADDRESS OF IEFSD101             20030 24900000
         BR    R15                     BRANCH TO SD101 TO INITIATE      24950002
*                                              ANOTHER JOB STEP         24960002
         EJECT                                                          25450000
QMGRVCON DC    V(IEFQMRAW)                                              25500000
SD66VCON DC    V(IEFSD066)                                              25600000
SD101VCN DC    V(IEFSD101)                                        20030 25650000
ZEROS    DC    F'0'                FULL WORD OF ZEROS            Y02641 25750002
X0FFF    DC    X'0FFF'                                                  25760002
WRTELCTE DC    CL2'WL'             CODE FOR WRITE LOCATE        YM01566 25810002
READLCTE DC    CL2'RL'             CODE FOR READ LOCATE         YM01566 25860002
         DS    0F                                                Y02641 26310002
PATCH    DS    10F                                               Y02641 26320002
HEX10    EQU   X'10'               RETURN CODE CHECKER            M1786 26350000
HEX14    EQU   X'14'               POST INVOCATION RETURN CODE    M2577 26400000
JOBFLSH  EQU   64                  FLUSH BIT IN JCT               M0397 26450000
RETCOD4 EQU    X'04'               STEP NOT ATTACHED INDICATOR   S21474 26500000
TCT      EQU   164                 DISPLACEMENT IN TCB OF TCT    S21474 26550000
POSTBIT  EQU   X'40'                                                    26600000
TCORE    EQU   253                                                      26650000
TWO      EQU   2                                                        26660002
ZERO     EQU   0                   DISPLACEMENT                    I272 26700000
D0       EQU   0                                                        26720002
D1       EQU   1                   DISPLACEMENT                    I272 26750000
D2       EQU   2                                                        26760002
D3       EQU   3                   DISPLACEMENT                   M4338 26800000
D4       EQU   4                   DISPLACEMENT                    I272 26850000
D8       EQU   8                                                   I254 26900000
D12      EQU   12                                                       26950000
FF       EQU   X'FF'                                                    27000000
PGMABEND EQU   X'80'               ABEND BIT IN TCBFLGS FIELD      I272 27100000
POSTCODE EQU   X'30'                                              M4338 27150000
SWLGTH   EQU   176                 LENGTH OF JCT AND SCT        YM01566 27160002
ONEOP    EQU   X'01'               ONE SWA OPERATION REQUESTED  YM07604 27170002
WRITEOP  EQU   X'03'               WRITE OPERATION REQUESTED    YM07604 27180002
*******************************************************************I254 27200000
*                                                                  I254 27250000
SMPARMS  DSECT                     USED TO INVOKE SWA MANAGER   YM01566 27270002
*                                  LOCATE MODE                  YM01566 27280002
SMPARM1  DS    F                   PTR TO EPA PTR               YM01566 27290002
SMPARM2  DS    F                   PTR TO FUNCTION CODE         YM01566 27292002
SMEPAPTR DS    F                   PTR TO FIRST EPA             YM01566 27294002
SMCODE   DS    CL2                 FUNCTION CODE FOR LOCATE     YM01566 27296002
SMEPA1   DS    4F                  FIRST EPA                    YM01566 27298002
SMEPA2   DS    4F                  SECOND EPA                   YM01566 27298402
SMEND    EQU   *                                                        27298802
*                                                                       27299202
         IEFZB505                                               YM01566 27299602
IEFCSCB DSECT                                                           27300000
 IEECHAIN                                                               27350000
*                                                                     * 27400000
         EJECT                                                          27450000
DCBSTART EQU   *                                                        27500000
IHADCB   DSECT                                                          27550000
         DCB  DSORG=PO,MACRF=E                                          27600000
IEFXLIST DC    F'0'                     DCB EXIT LIST                   27650000
DCBEND   EQU   *                                                        27700000
*                                                                     * 27750000
         EJECT                                                          27800000
         IEZATTCH                                                       29000000
         EJECT                                                          29050000
*********************************************************************** 29100000
*                                                                     * 29150000
*        THE FOLLOWING REPRESENTS A BLOCK OF MAIN STORAGE WHICH IS    * 29200000
*        ALLOCATED FOR THE LIFE OF                                    * 29250000
*        OF THIS INITIATOR.  IT CONTAINS:                             * 29300000
*                                                                     * 29350000
*              (1)  THE LCT (LINKAGE CONTROL TABLE)                   * 29400000
*              (2)  A 2 LEVEL REGISTER SAVE AREA FOLLOWED BY THE      * 29450000
*                   THE QUEUE MANAGER PARAMETER AREA                  * 29500000
*              (3)  AN ALTERNATE QUEUE MANAGER PARAMETER AREA         * 29550000
*                                                                     * 29600000
*********************************************************************** 29650000
IEFLOT   DSECT                                                          29700000
  IEFALLCT                                                              29750000
         IEFZB630                                                Y02653 29760002
         IEFZB622                                                Y02653 29770002
CVTDESCT  DSECT                                                  Y02641 29772002
         CVT                                                     Y02621 29780002
         IEFJESCT                                                Y02621 29790002
         EJECT                                                          29800000
IEFSCT   DSECT                                                          29850000
  IEFASCTB                                                              29900000
*                                                                     * 29950000
         EJECT                                                          30000000
         IEFQMNGR                                                       30050000
         EJECT                                                          30200000
IEFJCT   DSECT                                                          30250000
         IEFAJCTB                                                       30300000
VIEL     DSECT                                                    M0397 30350000
         IEZIEL  EXITS=RTN                                        M0397 30400000
         IKJTCB                                                   20029 30450000
         IEZJSCB                                                        30500000
         EJECT                                                          30700000
*********************************************************************** 30750000
*                         REGISTER EQUATE STATEMENTS                  * 30800000
*********************************************************************** 30850000
R0       EQU   0                                                        30900000
R1       EQU   1                                                        30950000
R2       EQU   2                                                        31000000
R3       EQU   3                                                        31050000
R4       EQU   4                                                        31100000
R5       EQU   5                                                        31150000
R6       EQU   6                                                        31200000
R7       EQU   7                                                        31250000
R8       EQU   8                                                        31300000
R9       EQU   9                                                        31350000
R10      EQU   10                                                       31400000
R11      EQU   11                                                       31450000
R12      EQU   12                                                       31500000
R13      EQU   13                                                       31550000
R14      EQU   14                                                       31600000
R15      EQU   15                                                       31650000
         EJECT                                                          31700000
         END                                                            31750000
