         TITLE 'IEFSMFIE - SMF INIT EXIT'                               00300018
IEFSMFIE CSECT                                                          00600018
* A 372500,373000,390500                                        YA00964 00650001
* A 176700,623220-623366,883620-883660,883750,762500           @G32FPRS 00700043
*MODULE NAME= IEFSMFIE                                          @Y02669 04850002
*                                                               @Y02669 04900002
*DESCRIPTIVE NAME= SMF INITIALIZATION EXIT SUPPORT MODULE       @Y02669 04950002
*                                                               @Y02669 05000002
*COPYRIGHT= N/A                                                 @Y02669 05050002
*                                                               @Y02669 05100002
*STATUS= REL. 02.0                                              @Y02669 05150002
*                                                               @Y02669 05200002
*FUNCTION=                                                      @Y02669 05250002
*    THIS MODULE HANDLES JOB INITIALIZATION PROCESSING AND STEP @Y02669 05300002
*    INITIALIZATION PROCESSING.  IT BASICALLY PERFORMS THE      @Y02669 05350002
*    FOLLOWING FUNCTIONS.                                       @Y02669 05360002
*                                                               @Y02669 05370002
*    DECISION AS TO WHETHER JOB OR STEP INITIALIZATION IS TO    @Y02669 05380002
*    TAKE PLACE.                                                @Y02669 05390002
*         WHEN THIS MODULE FIRST RECEIVES CONTROL FROM IEFSD101,@Y02669 05392002
*         IT IS DECIDED IF ANY SMF OPTIONS ARE TO BE PERFORMED  @Y02669 05394002
*         AND, IF SO, THE CURRENT TIME AND DATE ARE STORED IN   @Y02669 05396002
*         THE JCT (VIA TIME SVC 11).  IF NOT, A RETURN IS MADE  @Y02669 05398002
*         TO THE CALLER OF IEFSMFIE.  IF THE LCT INDICATES THAT @Y02669 05398402
*         THIS IS THE FIRST STEP OF THE JOB OR IF A TCT POINTER @Y02669 05398802
*         IS NOT PRESENT IN THE TCB, JOB INITIALIZATION         @Y02669 05399202
*         PROCESSING IS PERFORMED.  OTHERWISE, STEP INITIALI-   @Y02669 05399602
*         ZATION PROCESSING IS STARTED.                         @Y02669 05399702
*                                                               @Y02669 05399802
* JOB INITIALIZATION PROCESSING                                 @Y02669 05399902
*                                                               @Y02669 05449902
*    CONSTRUCTING A TIMING CONTROL TABLE (TCT).                 @Y02669 05459902
*         THE JMR IS READ INTO CORE. CORE IS OBTAINED FOR A TCT @Y02669 05469902
*         AND THE COMMON EXIT PARAMETER AREA (1ST 40 BYTES OF   @Y02669 05479902
*         THE JMR).  THE TCT CORE IS CLEARED AND SEVERAL FIELDS @Y02669 05489902
*         OF THE TCT ARE INITIALIZED. THE COMMON EXIT PARAMETER @Y02669 05491902
*         AREA IS INITIALIZED FROM THE JMR.                     @Y02669 05493902
*                                                                       05495902
*    SUPPORT OF A USER'S JOB INITIATION EXIT ROUTINE.           @Y02669 05497902
*         THE ACT IS READ INTO CORE.  IF A USER JOB INITIATION  @Y02669 05498302
*         EXIT RTN IS TO BE EXECUTED, A USER PARAMETER LIST IS  @Y02669 05498702
*         BUILT, THE FIELDS BEING INITIALIZED FROM THE ACT AND  @Y02669 05499102
*         THE COMMON EXIT PARAMETER AREA OF THE JMR. THE USER'S @Y02669 05499502
*         JOB INITIATION EXIT ROUTINE IS EXECUTED.  UPON RETURN @Y02669 05499602
*         TO IEFSMFIE, THE USER RETURN CODE IS CHECKED FOR USER @Y02669 05499702
*         JOB CANCELATION.  IF THE JOB IS TO BE CANCELLED, THE  @Y02669 05499802
*         JCT IS MARKED TO INDICATE THIS.                       @Y02669 05549802
*                                                               @Y02669 05559802
*    ISSUING SMF JOB COMMENCEMENT RECORD TYPE 20.               @Y02669 05569802
*         WHETHER OR NOT THE USER HAS CANCELLED THE JOB, THE    @Y02669 05579802
*         SMF RECORD TYPE 20 IS BUILT AND WRITTEN TO THE SMF    @Y02669 05589802
*         DATA SET VIA SVC 83. IF THE USER HAS CANCELLED THE    @Y02669 05591802
*         JOB, STEP INITIALIZATION PROCESSING IS PERFORMED.     @Y02669 05593802
*                                                               @Y02669 05595802
* STEP INITIALIZATION PROCESSING                                @Y02669 05597802
*                                                               @Y02669 05598202
*    IF THE JCT INDICATES THAT STEP PROCESSING IS TO BE PER-    @Y02669 05598602
*    FORMED AND USER EXITS ARE TO BE TAKEN, A USER  PARAMETER   @Y02669 05599002
*    LIST IS BUILT AND THE USER SUPPLIED STEP INITIATION EXIT   @Y02669 05599402
*    RTN (USI) IS EXECUTED.  UPON RETURN TO IEFSMFIE, THE USER  @Y02669 05599502
*    RETURN CODE IS CHECKED FOR USER JOB CANCELATION.  IF THE   @Y02669 05599602
*    JOB IS TO BE CANCELLED THE JCT IS MARKED TO INDICATE THIS. @Y02669 05599702
*                                                               @Y02669 05633102
*  OPERATION=                                                  @YM04108 05643102
*      INORDER FOR THE USER EXITS (IEFUJI, IEFUSI) TO          @YM04108 05644102
*      OPEN/CLOSE INSTALLATION DEFINED DATA SETS,              @YM04108 05645102
*      THE INITIATOR'S JSCB MUST BE THE ACTIVE JSCB.           @YM04108 05646102
*      THEREFORE, PRIOR TO CALLING THE EXIT, THE               @YM04108 05647102
*      INITIATOR'S JSCB IS MADE THE ACTIVE JSCB.               @YM04108 05648102
*      UPON RETURN FROM THE EXIT, THE P/P JSCB IS AGAIN        @YM04108 05649102
*      MADE THE ACTIVE JSCB.                                   @YM04108 05650102
*                                                               @Y02669 05653102
*NOTES                                                          @Y02669 05663102
*  DEPENDENCIES= INITIATOR (IEFSD101) FOR LCT ADDRESS IN REG 1  @Y02669 05665102
*    CHARACTER-CODE DEPENDENCIES= NONE                          @Y02669 05665502
*  RESTRICTIONS= NONE                                           @Y02669 05665902
*  REGISTER-CONVENTIONS= R15 IS USED FOR RETURN CODES FROM EXIT @Y02669 05666302
*                        ROUTINES.                              @Y02669 05666402
*  PATCH-LABEL= N/A                                             @Y02669 05666502
*                                                               @Y02669 05677602
*MODULE TYPE=                                                   @Y02669 05687602
*  PROCESSOR= (ASSEM)                                           @Y02669 05688002
*  MODULE SIZE= N/A                                             @Y02669 05688402
*  ATTRIBUTES= REFRESHABLE, REENTRANT, KEY 0, SUPERVISOR STATE, @Y02669 05688802
*              PAGABLE LPA                                      @Y02669 05692502
*                                                               @Y02669 05694502
*ENTRY POINT= IEFSMFIE                                          @Y02669 05694902
*  PURPOSE= SEE FUNCTION                                        @Y02669 05695302
*  LINKAGE= BALR                                                @Y02669 05695702
*  INPUT= REGISTER ONE CONTAINS THE ADDRESS OF THE LCT          @Y02669 05696102
*  REGISTERS SAVED= GPR 0-15                                    @Y02669 05696202
*  REGISTER USAGE= N/A                                          @Y02669 05746202
*  REGISTERS RESTORED= GPR 0-15                                 @Y02669 05756202
*                                                               @Y02669 05766202
*EXIT - NORMAL= RETURN TO CALLER                                @Y02669 05776202
*  CONDITIONS= PROCESSING COMPLETE                              @Y02669 05786202
*  OUTPUT= 1) A TIMING CONTROL TABLE (TCT) IS CONSTRUCTED AND   @Y02669 05788202
*             POINTED TO BY THE TCB IF THIS IS THE FIRST STEP   @Y02669 05790202
*             0F THE JOB.                                       @Y02669 05792202
*          2) SMF RECORD TYPE 20 IS WRITTEN TO THE SMF DATA SET @Y02669 05794202
*             IF THIS IS THE FIRST STEP OF THE JOB.             @Y02669 05794602
*          3) THE COMMON EXIT PARAMETER AREA (1ST 40 BYTES OF   @Y02669 05795402
*             JMR) IS POINTED TO BY THE TCT.                    @Y02669 05795802
*  RETURN CODES= NONE                                           @Y02669 05795902
*                                                               @Y02669 05796002
*EXIT - ERROR= NONE                                             @Y02669 05796102
*                                                               @Y02669 05812802
*EXTERNAL REFERENCES=                                           @Y02669 05822802
*  ROUTINES= IEFUJI (USER JOB INITIATION EXIT ROUTINE)          @Y02669 05824802
*            IEFUSI (USER STEP INITIATION EXIT ROUTINE)         @Y02669 05826802
*            IEFAB4F7 (SWA MANAGER READ ROUTINE)                @Y02669 05828802
*  DATA AREAS= NONE                                             @Y02669 05829202
*  CONTROL BLOCKS=     LCT - LINKAGE CONTROL TABLE              @Y02669 05829302
*                      JCT - JOB CONTROL TABLE                  @Y02669 05829402
*                      SCT - STEP CONTROL TABLE                 @Y02669 05835002
*                      TCB - TASK CONTROL BLOCK                 @Y02669 05837002
*                      ACT - ACCOUNTING CONTROL TABLE           @Y02669 05839002
*                      JMR - JOB MANAGEMENT RECORD              @Y02669 05839402
*                      TCT - TIMING CONTROL TABLE               @Y02669 05839802
*                                                               @Y02669 05840202
*TABLES= NONE                                                   @Y02669 05840302
*                                                               @Y02669 05840402
*MACROS=   TIME                                                 @Y02669 05840502
*          SMFWTM                                               @Y02669 05880302
*          GETMAIN                                              @Y02669 05890302
*          FREEMAIN                                             @Y02669 05900302
*  SERIALIZATION= NONE                                          @Y02669 05910302
*                                                               @Y02669 05920302
*CHANGE ACTIVITY= RACF SUPPORT                                 @G32FPRL 05926343
*                                                               @Y02669 05943602
*MESSAGES= NONE                                                 @Y02669 05945602
*                                                               @Y02669 05946002
*ABEND CODES= NONE                                              @Y02669 05946402
*                                                               @Y02669 05946802
*************************************************************** @Y02669 05951202
*                                                               @Y02669 05955802
R0       EQU   0                       REGISTER EQUATES                 05960202
R1       EQU   1                                                        06000018
R2       EQU   2                                                        06300018
R3       EQU   3                                                        06600018
R4       EQU   4                                                        06900018
R5       EQU   5                                                        07200018
R6       EQU   6                                                        07500018
R7       EQU   7                                                        07800018
R8       EQU   8                                                        08100018
R9       EQU   9                                                        08400018
R10      EQU   10                                                       08700018
R11      EQU   11                                                       09000018
R12      EQU   12                                                       09300018
R13      EQU   13                                                       09600018
R14      EQU   14                                                       09900018
R15      EQU   15                                                       10200018
ACTSIZE  EQU   176                                                      10500018
CANCEL   EQU   4                       USER RETURN CODE                 10800018
ZERO     EQU   0                       FOR COMPARISON                   11100018
STEPONE  EQU   1                       INDICATES THIS IS FIRST          11400018
*                                           STEP                        11700018
*                                  BOTH JOB AND STEP USER EXITS         12000018
*                                  MAY BE REQUIRED                      12300018
JCTJMRSP EQU   X'40'                   STEP FUNCTION REQUESTED          12600018
CANCUJI  EQU   X'20'                   *                                12900018
CANCUSI  EQU   X'10'                   *                                13200018
SMFJEXIT EQU   X'20'                   JOB EXITS ARE TO BE TAKEN        13500018
SMFSEXIT EQU   X'60'                   STEP EXITS ARE REQUESTED         13800018
READ1    EQU   1                       FOR ONE RECORD                   14100018
POOL230  EQU   230                     ID SUB-POOL 230          @Y02669 14150002
POOL253  EQU   253                     *                                14400018
DEC0     EQU   0                       NUMERIC EQUATE                   15000018
DEC1     EQU   1                       NUMERIC EQUATE                   15300018
DEC3     EQU   3                       NUMERIC EQUATE                   15600018
DEC4     EQU   4                       NUMERIC EQUATE                   15900018
DEC5     EQU   5                       NUMERIC EQUATE                   16200018
DEC6     EQU   6                       NUMERIC EQUATE                   16250001
DEC12    EQU   12                      NUMERIC EQUATE                   16500018
DEC16    EQU   16                      NUMERIC EQUATE                   16800018
DEC24    EQU   24                      NUMERIC EQUATE                   17100018
DEC201   EQU   201                     NUMERIC EQUATE                   17400018
HEX00    EQU   X'00'                                                    17500018
POOL255  EQU   255                 SUBPOOL 255                    19018 17530019
ONE      EQU   1                   DISPLACEMENT                   19028 17570019
D8       EQU   8                   DISPLACEMENT                   19028 17580019
D20      EQU   20                  DISPLACEMENT                   19028 17590019
T20      EQU   20                  TYPE OF RECORD                 19028 17600019
MASKA    EQU   X'80'                   JOB SUPPORT                20011 17650020
ASCBPTR  EQU   12                 OFFSET TO ASCBOLD PTR IN PSA @G32FPRS 17670043
         STM   R14,R12,DEC12(R13)                                       17700018
         BALR  R12,R0                                                   17900018
         USING *,R12                   *                                18300018
         MODID BR=YES                                            Y01886 18350001
         USING IEFLOT,R10                                               18600018
         USING IEFSCT,R9                                                18900018
FIRST    DS    0H                                                       19800018
         LR    R10,R1                  LCT                              20100018
         LR    R4,R13                  SAVE R13 FOR NON-SMF             20400018
*                                           PROC-G                      20700018
         L     R9,LCTSCTAD             PTR TO SCT                       21000018
         L     R7,LCTJCTAD             PTR TO JCT                       21300018
         USING INJMJCT,R7              PTR TO JCT                       21600018
         USING IOPARAMS,R11            *                                21900018
         TM    JCTJMROP,MASKA      ARE SMF OPTIONS SPECIFIED    @Y02669 22200002
         BZ    SD101001            NO-RETURN TO NON SMF           20011 22500020
*                                           PROC-G                      22800018
         SPACE 4                                                        23100018
         GETMAIN R,LV=SAQSIZE,SP=POOL230 GET CORE FOR Q & S/A   @Y02669 24000002
         LR    R13,R1                  PTR TO QUE & SAVE AREA           24300018
         USING SVANDQM,R13             *                                24600018
         TIME  BIN                ISSUE TIME MACRO                 SMF1 24900018
         STM   R0,R1,SMFSAVE           *                                25200018
         MVC   JCTJMRSS(DEC3),SMFSAVE+DEC1 STEP TIME                    25500018
         MVC   JCTSSD(DEC3),SMFSAVE+DEC5 STEP DATE              @Y02669 25550002
         GETMAIN    R,LV=ACTSIZE,SP=POOL230 GET CORE FOR ACT    @Y02669 26520002
         LR    R8,R1               SAVE ACT ADDRESS               19028 26580019
         USING ACTDSKAD,R8         ACT ADDRESSABILITY             19028 26640019
         CLI   LCTSNUMB,STEPONE        IS THIS THE FIRST STEP OF        26700018
*                                           THE                         27000018
         BE    STEP1              JOB   BEGIN STEP1 PROCESS      F27251 27090019
         L     R5,LCTTCBAD         ADDR TCB FOR THIS JOB          M3152 27180019
         USING TCB,R5              TCB ADDRESSIBILITY           @Y02669 27230002
         L     R1,TCBTCT           AND THE CURRENT TCT          @Y02669 27270002
         LA    R1,0(R1)              ADDRESS                     F27251 27360019
         LTR   R1,R1      IS THERE A TCT PTR    IN STEP RESTARTS F27251 27450019
*                           IN OTHER THAN THE FIRST STEP THERE WILL     27540019
*                              NOT BE A TCT                             27630019
         BNZ   SMFSTEP                                           F27251 27720019
         DROP  R5                                               @Y02669 27770002
STEP1    EQU   *                                                 F27251 27810019
  SPACE 4                                                               27900018
*** *** ***                                                             28200018
*                                                                       28500018
*FIRST STEP PROCESSING HERE                                             28800018
*                                                                       29100018
*** *** ***                                                             29400018
         MVC   SMFQTTR3(DEC3),JCTJMR   JMR TTR                          29700018
         BAL   R5,ACTGET               AND GO READ IN JMR               30000018
         L     R5,LCTTCBAD         ADDR TCB FOR THIS JOB          M3152 30100019
         USING TCB,R5              TCB ADDRESSIBILITY           @Y02669 30150002
         GETMAIN   R,LV=TCTBIG,SP=POOL253                       @Y02669 30600002
         USING SMFTCT,R1               *                                30900018
         XC    DEC0(TCTBIG,R1),DEC0(R1) GET A TCT AND CLEAR IT          31200018
         MVC   TCTPOOL(4),SPSIZE       MOVE SP & SIZE                   31500018
TCTPROC  EQU   *                                                  19018 31800019
         LA    R1,DEC0(R1)             ZERO HI BYTE OF TCBTCT PTR M0432 32200018
         ST    R1,TCBTCT               *                        @Y02669 33000002
         ST    R5,TCTTCB               AND HAVE TCT PT TO TCB           33300018
         DROP  R5                                               @Y02669 33350002
         LA    R6,TCTCORE              HAVE TCT PT TO CORE TABLE        33600018
         ST    R6,TCTCRTBL             *                                33900018
         LR    R5,R1                   SAVE TCT BASE            @Y02669 33950002
         GETMAIN R,LV=JMRSIZE,SP=POOL253                        @Y02669 34000002
         LR    R6,R1                   JMR BASE                 @Y02669 34050002
         LR    R1,R5                   RESTORE TCT BASE         @Y02669 34100002
         USING JMR,R6                  *                                34500018
         MVC   DEC0(JMRSIZE,R6),DEC0(R8) AND MOVE JMR TO LOW            34800018
*                                           CORE                        35100018
         ST    R6,TCTJMR               HAVE THE TCT PT TO THE           35400018
*                                           JMR                         35700018
         ST    R6,JMRUJVP              SET UP PTR FOR TIME LIMIT        36000018
*                                           RTN                         36300018
         LA    R5,JMRUJVP              *                                36600018
         ST    R5,TCTUDATA             SUPERVISOR WILL LOAD R1          36900018
*                                           FROM HERE                   37200018
         OC    JCTJMRJT(DEC6),JCTJMRJT     IS THIS AUTO-RESTART?YA00964 37250001
         BNZ   RESTART                     YES-RETAIN JOB START YA00964 37300001
         MVC   JCTJMRJT(DEC3),SMFSAVE+DEC1 JOB TIME                     38700018
         MVC   JCTJMRJD(DEC3),SMFSAVE+DEC5 DATE                         39000018
RESTART  EQU   *                                                YA00964 39050001
         MVC   SMFQTTR2(DEC3),JCTACTAD TTR FOR JOB ACT TO EXT           39070019
*                                           PARM                        39140019
         BAL   R5,ACTGET               GO GET SPACE FOR ACT             39210019
         TM    JCTJMROP,SMFJEXIT       EXITS TO BE TAKEN FOR    @Y02669 39300002
*                                      JOB ENTRY                @Y02669 39600002
         BO    SMFSVAQ                 YES, GO SET UP FOR USER          39900018
*                                           EXIT                        40200018
         B     TESTDS              NO, CHECK DATA SET ACCTG       19028 40500019
         SPACE 4                                                        40800018
         SPACE  4                                                       42600018
TESTCANC EQU   *                       *                                42900018
         LA    R0,CANCEL               CHECK RETURN CODE- DOES          44400018
*                                           USER                        44700018
         CR    R0,R15              ASK THAT JOB BE CANCELLED      19028 45000019
         BNE   NOCANC                  IF SO CONTINUE                   45300018
         OI    JCTJSTAT,INCMSTS        MARK JCT FOR CANCEL              45600018
         BR    R5                      RETURN                           45900018
NOCANC   B     DEC4(R5)                GO BACK AFTER MARKING OF         46200018
*                                           CANC POINT                  46500018
         SPACE 4                                                        46800018
*** *** ***                                                             47100018
*                                                                       47400018
*INTERFACE TO Q MGR                                                     47700018
*                                                                       48000018
*** *** ***                                                             48300018
STEPGET  EQU   *                       *                                48600018
         MVC   SMFQTTR3(DEC3),SCTAFACT STEP ACT TTR                     48900018
ACTGET   EQU   *                       *                                49200018
         MVI   SMFQTTR1+DEC3,DEC0      *                                49500018
         ST    R8,SMFQADR3         ACT ADDRESS IN EXT PARM AREA   19028 50400019
         LA    R11,QMGR1               PTR TO PARAM AREA                51300018
         LA    R2,SMFQEXT              PTR TO EXT PARAM AREA            51600018
         ST    R2,QMPCL                PLACE PTR IN PARM AREA           51900018
         MVI   QMPCL,READ1             INDICATE ONE RECORD TO           52200018
*                                           READ                        52500018
         MVI   QMPOP,QMREAD            INDICATE READ                    52800018
         L     R15,VQUEMAN             ADDR OF QUEUE MAN READ           53100018
*                                           RTN                         53400018
         LR    R1,R11                  POINT TO QMPA                    53700018
         BALR  R14,R15                 BRANCH AND LINK FOR READ         54000018
         BR    R5                      RETURN                   @Y02669 54900002
         SPACE  4                                                       57000018
*        SET UP FOR JOB PROCESSING                                      57300018
*                                                                       57600018
SMFSVAQ  EQU   *                       *                                57900018
         LA    R0,JMRJOB               *                                59100018
         LA    R1,ACTPRGNM-ACTDSKAD(R8) PROGRAM NAME                    59400018
         NI    SMFJPRTY,HEX00          ZERO PARM FIELD                  59500018
         MVN   SMFJPRTY(DEC1),JCTJPRTY MOVE IN PRIORTY                  59600018
         LA    R2,SMFJPRTY                                              59700018
         LA    R3,ACTJNFLD-ACTDSKAD(R8) JOB ACT FLDS                    60000018
         STM   R0,R3,USERPARM          ST AND PT TO USER LIST           60300018
         LA    R1,USERPARM             *                                60600018
         MVI   JMRSTEP,DEC0            *                                60900018
         L     R15,VIEFUJI             ADDRESS OF JOB INIT RTN          61200018
         L     R5,LCTTCBAD             GET ADDR INITIATOR'S TCB@YM04108 61230002
         USING TCB,R5                                          @YM04108 61260002
         L     R5,TCBJSCB              GET ADDR INITIATOR JSCB @YM04108 61290002
         USING IEZJSCB,R5                                      @YM04108 61320002
         L     R3,JSCBACT              SAVE P/P JSCB ADDR      @YM04108 61350002
         ST    R5,JSCBACT              MAKE INITIATOR'S JSCB   @YM04108 61380002
*                                      ACTIVE JSCB             @YM04108 61410002
         BALR  R14,R15                 BRANCH TO USER                   61500018
         ST    R3,JSCBACT              RESTORE P/P JSCB ADDR   @YM04108 61600002
         DROP  R5                                              @YM04108 61700002
         BAL   R5,TESTCANC             *                                61800018
         OI    JCTJMRCL,CANCUJI        JOB INIT RTN CANCELED            62100018
TESTDS   EQU   *                                                  19028 62106019
         L     R2,CVTPTR           ADDRESS OF CVT                 19028 62112019
         USING CVT,R2              CVT ADDRESSABILITY            Y01120 62118001
         L     R2,CVTSMCA          ADDRESS OF SMCA               Y01120 62120001
         DROP  R2                                                       62122001
         USING SMCABASE,R2         SMCA ADDRESSABILITY            19028 62124019
         GETMAIN R,LV=REC20SZE,SP=POOL230 GET CORE FOR 20 REC   @Y02669 62160002
         LR    R14,R1              SAVE ADDRESS                   19028 62166019
         USING TYPE20,R14          TYPE 20 ADDRESSABILITY         19028 62172019
         XC    TYPE20(REC20SZE),TYPE20   ZERO OUT GOTTEN CORE     19028 62178019
         MVI   RECTYPE,T20         INSERT RECORD TYPE             19028 62184019
         MVC   RECJNM(D8),JMRJOB   JOB NAME STARTING              19028 62196019
         MVC   RECTME(D8),JMRENTRY GET TIME AND DATE              M3152 62202019
         MVC   RECPGRNM(D20),ACTPRGNM    INSERT PROGRAMMER NAME   19028 62208019
         MVC   RECUSID(D8),JMRUSEID      USER ID                  19028 62214019
         LA    R3,ACTJNFLD+ONE     POINT TO ACCTG FIELDS          19028 62226019
         LA    R15,RECJANO+ONE     POINT TO EMPTY SPACE           19028 62232019
         SR    R11,R11             ZERO OUT FOR IC                19028 62238019
         IC    R11,ACTJNFLD        NUMBER OF JOB ACCTG FIELDS     19028 62244019
         STC   R11,RECJANO         STORE IN TYPE 20 RECORD        19028 62250019
         LTR   R11,R11             ANY ACCOUNTING FIELDS          19028 62256019
         BZ    NOACCTG             BRANCH IF NO ACCTG FIELDS      19028 62262019
         SR    R1,R1               ZERO OUT FOR IC                19028 62268019
NEXTFLD  EQU   *                                                  19028 62274019
         IC    R1,ZERO(R3)         LENGTH OF THIS ACCTG FIELD     19028 62280019
         EX    R1,ACTGMOVE         MOVE ACCTG FIELD AND LENGTH    19028 62286019
         LA    R1,ONE(R1)          ADD 1 FOR LENGTH BYTE          19028 62292019
         AR    R15,R1              INCREMENT TO NEXT EMPTY SPACE  19028 62298019
         AR    R3,R1               INCREMENT TO NEXT ACCTG FIELD  19028 62304019
         BCT   R11,NEXTFLD         END OF ACCTG FIELDS            19028 62310019
NOACCTG  EQU   *                   YES                            19028 62316019
*                                                              @G32FPRS 62322043
* CODE ADDED FOR SUPPORT OF RACF 5-3-76                        @G32FPRS 62322243
*                                                              @G32FPRS 62322443
         XC    ZERO(26,R15),ZERO(R15) CLEAR RACF SMF AREA      @G32FPRL 62322543
         LA    R3,4                LENGTH OF RDW               @G32FPRL 62322643
         LR    R11,R15             COPY PTR TO CURRENT POSITION@G32FPRS 62322743
         SR    R11,R14             FIND CURRENT RECORD LENGTH  @G32FPRL 62323143
         SR    R11,R3              OFFSET TO RACF RELOCATE AREA@G32FPRL 62323243
         STH   R11,SMF20RLO        SAVE OFFSET TO RELOCATE AREA@G32FPRL 62323543
         MVC   ZERO(2,R15),RELSIZE  SAVE RELOCATE SECTION SIZE @G32FPRL 62323643
         LA    R15,2(ZERO,R15)     BUMP PAST LENGTH FIELD      @G32FPRL 62323743
         AH    R11,RELSIZE         ADD LENGTH OF RELOCATE AREA @G32FPRL 62323843
         AR    R11,R3              ADD LENGTH OF RDW           @G32FPRL 62323943
         STH   R11,RECLEN          PUT RECORD LENGTH IN RECORD @G32FPRL 62324043
         L     R1,CVTPTR           ADDRESS CVT                 @G32FPRS 62324343
         USING CVT,R1                                          @G32FPRS 62324443
         L     R1,CVTTCBP          GET ADDRESS OF NEW/OLD PTRS @G32FPRS 62324543
         L     R1,ASCBPTR(ZERO,R1) GET ADDRESS OF CURRENT ASCB @G32FPRS 62324643
         DROP  R1                                              @G32FPRS 62324943
         USING ASCB,R1                                         @G32FPRS 62325243
         L     R1,ASCBASXB         FIND ASXB                   @G32FPRS 62325543
         DROP  R1                                              @G32FPRS 62325843
         USING ASXB,R1                                         @G32FPRS 62326143
         L     R1,ASXBSENV         FIND RACF CONTROL TABLE     @G32FPRS 62326443
         LTR   R1,R1               IF NOT 0,RACF IN SYSTEM     @G32FPRS 62326743
         BZ    NORACF              IF NO RACF, DONT FILL FIELDS@G32FPRS 62327043
         DROP  R1                                              @G32FPRS 62327343
         USING ACEE,R1                                         @G32FPRS 62327643
         MVC   ZERO(8,R15),ACEEGRPN     GET GROUP ID           @G32FPRS 62330443
         LA    R15,8(ZERO,R15)     MOVE AREA ADDRESS 8 CHARS   @G32FPRS 62330943
         MVC   ZERO(8,R15),ACEEUSRI     GET USER ID            @G32FPRS 62331443
         LA    R15,8(ZERO,R15)     MOVE TO NEXT 8 CHARS        @G32FPRS 62331943
         L     R11,ACEETRMP        GET ADDRESS OF TERMINAL ID  @G32FPRS 62332443
         LTR   R11,R11             CHECK FOR A TERMINAL USER   @G32FPRS 62332943
         BZ    NORACF              FINISHED AT THIS POINT      @G32FPRS 62333443
         MVC   ZERO(8,R15),0(R11)  MOVE TERMINAL ID TO RECORD  @G32FPRS 62333943
         LA    R15,8(ZERO,R15)     MOVE POINTER TO NEXT 8 CHARS@G32FPRS 62334443
NORACF   EQU   *                                               @G32FPRS 62334943
         USING SMFTCT,R1                                                62336843
         LR    R1,R14              ADDRESS OF TYPE 20             19028 62337843
         SMFWTM     (1)            WRITE TO SMF DATA SET          19028 62340019
         LR    R1,R14              ADDRESS OF TYPE 20 RECORD      19028 62352019
         FREEMAIN   R,LV=REC20SZE,A=(1),SP=POOL230              @Y02669 62358002
STEPTEST EQU   *                                                  19028 62364019
         TM    JCTJMROP,JCTJMRSP       STEP FUNCTIONS REQUESTED @Y02669 62400002
         BZ    SMFRET                  NO-SMF PROCESSING                62700018
*                                           COMPLETE                    63000018
  SPACE 4                                                               63300018
*** *** ***                                                             63600018
*                                                                       63900018
*        SET UP FOR STEP PROCESSING                                     64200018
*                                                                       64500018
*** *** ***                                                             64800018
SMFSTEP  EQU   *                       *                                65100018
         TM    JCTJMROP,JMRSTPSW+JMREXITS *                             65400018
         BNO   SMFFJMR                 GO FREE JMR IF NOT BOTH          65700018
*                                           STEP FUNCTIONS AND          66000018
*                                   EXITS TO BE TAKEN                   66300018
         BAL   R5,STEPGET              *                                66600018
         L     R5,LCTTCBAD         ADDR TCB FOR THIS JOB          M3152 66900019
         USING TCB,R5              TCB ADDRESSIBILITY           @Y02669 66950002
         L     R1,TCBTCT           PT TO TCT                    @Y02669 67200002
         L     R0,TCTJMR               JMR                              67500018
         LR    R6,R0              PT TO JMR (ALREADY DONE IF THIS       67600018
*                                    IS FIRST STEP)                     67700018
         LA    R1,SCTSNAME             OBTAIN STPNME ADDR               67900018
         LA    R2,SCTPGMNM             OBTAIN PROGNME ADDR              68100018
         TM    SCTSTYPE,SCTGOSTP       FOR GO STEP PGM NAME IS A        68400018
*                                           TTR                         68700018
         BZ    NOTPGMDD                TAKE BRANCH IF NOT GO STEP       69000018
         LA    R2,PGMDD                OTHERWISE IT IS APGM DD          69300018
NOTPGMDD EQU   *                       *                                69600018
         LA    R3,ACTJNFLD-ACTDSKAD(R8) *                               69900018
         STM   R0,R3,USERPARM          ST AND PT TO USER LIST           70200018
         LA    R1,USERPARM             *                                70500018
         MVC   JMRSTEP(DEC1),LCTSNUMB  MOVE IN STEP NO.                 70800018
         L     R15,VIEFUSI             ADDRESS OF USER                  71100018
         L     R5,LCTTCBAD             GET ADDR INITIATOR'S TCB@YM04108 71130002
         USING TCB,R5                                          @YM04108 71160002
         L     R5,TCBJSCB              GET ADDR INITIATOR JSCB @YM04108 71190002
         USING IEZJSCB,R5                                      @YM04108 71220002
         L     R3,JSCBACT              SAVE P/P JSCB ADDR      @YM04108 71250002
         ST    R5,JSCBACT              MAKE INITIATOR'S JSCB   @YM04108 71280002
*                                      ACTIVE JSCB             @YM04108 71310002
         BALR  R14,R15                 GO TO USER STEP INIT RTN         71400018
         ST    R3,JSCBACT              RESTORE P/P JSCB ADDR   @YM04108 71500002
         DROP  R5                                              @YM04108 71600002
         BAL   R5,TESTCANC             SEE IF USER CANC JOB             71700018
         OI    JCTJMRCL,CANCUSI        STEP INIT CANCELLED              72000018
  SPACE 4                                                               72300018
SMFRET   EQU   *                       *                                72600018
SMFFJMR  EQU   *                       *                                72900018
SMFFSA   EQU   *                       *                                73200018
         LR    R1,R8               ADDRESS OF ACT                 19028 73340019
         FREEMAIN   R,LV=ACTSIZE,A=(1),SP=POOL230 FREE ACT CORE @Y02669 73410002
         LR    R1,R13                  LOCATION OF SAVEAREA             73500018
         FREEMAIN R,LV=SAQSIZE,A=(1),SP=POOL230  FREE THIS AREA @Y02669 74400002
  SPACE 4                                                               74700018
SD101001 EQU   *                       *                                75000018
         LR    R13,R4                  RESTORE REG 13                   75300018
         LM    R14,R12,DEC12(R13)      RESORE REGS                      75600018
         BR    R14                     RETURN                           75900018
VQUEMAN  DC    V(IEFQMRAW)             ADDR OF QUEUE MAN READ           76200018
*                                           AND                         76500018
*        WRITE RTN                                                      76800018
VIEFUJI  DC    V(IEFUJI)               USER ADDR OF USER JOB            77100018
*                                           INIT RTN                    77400018
VIEFUSI  DC    V(IEFUSI)               USER STEP INITIATION RTN         77700018
PGMDD    DC    C'PGM=*.DD'             *                                78000018
SPSIZE   DC    AL1(POOL253)                                             78100018
         DC    AL3(TCTBIG)                                      @Y02669 78200002
ACTGMOVE MVC   ZERO(ZERO,R15),ZERO(R3)   MOVE ACCTG FIELD         19028 78260019
RELSIZE  DC    AL2(RECEND-SMF20RLA) SIZE OF RELOCATABLE AREA   @G32FPRL 78270043
  SPACE 4                                                               78300018
SVANDQM  DSECT                    SAVE ARE AND QUEUE MAN EXT PARM  SMF1 78600018
*                                  AREA                                 78900018
SMFSAVE  DS    18F                     SAVE AREA                        79200018
USERPARM DS    2F                      PARM LIST FOR USER-              79500018
*                                                                       79800018
*        TO UJI              TO USI                                     80100018
*                                                                       80400018
*        JMRJOB              JMRJOB                                     80700018
*        PROGRAMMER'S NAME   STEP NAME                                  81000018
*        JOB PRIORITY        PGROGRAM NAME                              81300018
*        ACT INFO            ACT INFO                                   81600018
*                                                                       81900018
SMFQEXT  EQU   *                       EXTERNAL PARAMETER AREA          82200018
SMFQADR1 DS    F                       CORE LOCATION OF JMR             82500018
SMFQTTR1 DS    F                       TTR OF JMR                       82800018
SMFQADR2 EQU   SMFQADR1                *                                83100018
SMFQTTR2 EQU   SMFQTTR1                *                                83400018
SMFQADR3 EQU   SMFQADR2                *                                83700018
SMFQTTR3 EQU   SMFQTTR2                *                                84000018
SMFJPRTY DS    C                       JOB PRIORITY                     84100018
SMFRESV  DS    7C                      RESERVED                         84200018
SAQSIZE  EQU   *-SVANDQM               *                                84300018
         EJECT                                                          84360001
CVT      DSECT                                                          84420001
         CVT                                                            84480001
         EJECT                                                          84540001
  SPACE  4                                                              84600018
         IEZJSCB                                               @YM04108 84620002
         IKJTCB                                                 @Y02669 84650002
         IEFQMNGR                                                  SMF1 84900018
IEFJCT   DSECT                                                     SMF1 85200018
         IEFAJCTB                                                  SMF1 85500018
         IEFTCT                                                         86100018
         IEFJMR                                                    SMF1 86400018
IEFSCT   DSECT                                                          86700018
         IEFASCTB                                                       87000018
IEFLOT   DSECT                                                          87300018
         IEFALLCT                                                       87600018
         IEESMCA                                                        88210019
         IHAACEE                                                        88212043
         IHAASCB                                                        88214043
         IHAASXB                                                        88216043
TYPE20   DSECT                                                    19028 88220019
         DS    0D                                                 19028 88230019
RECLEN   DS    CL2                 LENGTH OF THE RECORD           19028 88240019
RECDES   DS    CL2                 SEGMENT DESCRIPTOR             19028 88250019
         DS    CL1                                                19028 88260019
RECTYPE  DS    CL1                 RECORD TYPE                    19028 88270019
RECTIME  DS    CL8                 TIME STAMP                     19028 88280019
RECCPU   DS    CL4                 CPU ID                         19028 88290019
RECJNM   DS    CL8                 JOB LOG NUMBER - JOB NAME      19028 88300019
RECTME   DS    CL8                 JOB START TIME AND DATE        19028 88310019
RECUSID  DS    CL8                 USER ID                        19028 88320019
SMF20RLO DS    BL2                 OFFSET TO RELOCATE SECTION  @G32FPRL 88325043
*                                  FROM BEGINNING OF RECORD    @G32FPRL 88328043
RECPGRNM DS    CL20                PROGRAMMER'S NAME              19028 88340019
RECJANO  DS    CL1                 NUMBER OF JOB ACCTG FIELDS     19028 88350019
         DS    CL148               JOB ACCTG FIELDS               19028 88360019
*    RELOCATABLE AREA                                          @G32FPRL 88360243
*    SMF20RLO IS ITS OFFSET FROM BEGINNING OF OF RECORD        @G32FPRL 88360443
SMF20RLA EQU   *                   RELOCATABLE AREA            @G32FPRL 88360643
SMF20RLS DS    BL2                 SIZE OF RELOCATE SECTION    @G32FPRS 88361043
SMF20GRP DS    CL8                 RACF GROUP ID               @G32FPRS 88362043
SMF20UID DS    CL8                 RACF USER ID                @G32FPRS 88363043
SMF20TID DS    CL8                 RACF TERMINAL ID            @G32FPRS 88364043
RECEND   EQU   *                                                  19028 88370019
REC20SZE EQU   RECEND-RECLEN       LENGTH OF THIS RECORD          19028 88380019
         END                                                            88500018
