         TITLE 'HEWLFESD  ESD CARD PROCESSOR'                           00050021
*FUNCTION/OPERATION: THIS MODULE PROCESSES THE ESD CARDS PRODUCED BY  * 00100021
*      ASSEMBLERS AND COMPILERS. IT ALSO PROCESSES THE ESD RECORDS    * 00150021
*      WHICH ARE THE OUTPUT OF A PREVIOUS LINK EDIT. AS EACH ESD ITEM * 00200021
*      IS ENCOUNTERED,IT IS ENTERED IN THE COMPOSITE ESD. IF THE      * 00250021
*      SYMBOL IS UNIQUE, THE ITEM IS ENTERED IN A NEW LINE, OTHERWISE * 00300021
*      THE HIERARCHIAL RULES OF ESD TYPES APPLY AND THE EXISTING      * 00350021
*      LINE IS MODIFIED. FOLLOWING ARE A FEW EXAMPLES OF COLLECTION.  * 00400021
*      SECTION DEFINITION + EXTERNAL REFERENCE = SECTION DEFINITION   * 00450021
*      LABEL DEFINITION + EXTERNAL REFERENCE = LABEL DEFINITION       * 00500021
*      EXTERNAL REFERENCE + EXTERNAL REFERENCE = EXTERNAL REFERENCE   * 00550021
*                                                                     * 00600021
*      PSEUDO REGISTERS MAY ONLY COLLECT PSEUDO REGISTERS,E.G.        * 00650021
*      A PR CANNOT COLLECT AVER BUT MAY ONLY COLLECT A PR .           * 00700021
*                                                                     * 00750021
*      IN THE PROCESS OF CREATING THE COMPOSITE ESD, THE ESD PROCESSOR* 00800021
*      ALSO CREATES THE RENUMBERING TABLE WHICH IS A TRANSLATION TABLE* 00850021
*      USED TO CHANGE ID'S FROM ESD-RELATIVE, TO CESD-RELATIVE.       * 00900021
*                                                                     * 00950021
*ENTRY POINTS  HEWLFESD - BEGINNING OF CSECT  -  LA  13,SAVEAREA      * 01000021
*                                                  BALR 14,15         * 01050021
*INPUT:                      -REGISTERS-                              * 01100021
*      REGISTER 4 - BYTE COUNT OF ESD ITEMS TO BE PROCESSED           * 01150021
*      REGISTER 5- ID OF FIRST ESD ITEM INPUT TO ESD PROCESSOR        * 01200021
*      REGISTER 6- ADDRESS OF FIRST ESD ITEM TO BE PROCESSED          * 01250021
*                            - OTHER INPUT -                          * 01300021
*      THE BASIC INPUT IS THE ESD RECORD ITSELF WHICH IS READ BY THE  * 01350021
*      INPUT PROCESSOR                                                * 01400021
*                                                                     * 01450021
*OUTPUT:  THE COMPOSITE EXTERNAL SYMBOL DICTIONARY(CESD)              * 01500021
*         THE RENUMBERING TABLE(RNT)                                  * 01550021
*           NEITHER OF THE ABOVE TABLES IS OUTPUT TO AN I/O DEVICE    * 01600021
*           BUT THEY ARE USED IN SUBSEQUENT PROCESSES                 * 01650021
*EXTERNAL ROUTINES: HEWLFLOG- WRITES ERROR DIAGNOSTIC CODE            * 01700021
*          HEWLCDLK - DELINK ROUTINE - IF AN RLD ITEM REQUIRES A      * 01750021
*                     DELINK VALUE, THIS ROUTINE SAVES IT IN THE      * 01800021
*                     DELINK TABLE                                    * 01850021
*                     CALLING SEQUENCE - BALR 14,15                   * 01900021
*EXITS-NORMAL:  AFTER ALL ESD ITEMS INPUT HAVE BEEN PROCESSED,CONTROL * 01950021
*               RETURNS TO THE INPUT PROCESSOR VIA REGISTER 14        * 02000021
*EXITS-ERROR:   THERE ARE NO ERROR EXITS TO THE SYSTEM. ALL ERRORS    * 02050021
*               ARE RELAYED THROUGH THE ERROR DIAGNOSTIC ROUTINE      * 02100021
*               WHICH THEN DECIDES WHETHER TO PROCEED OR STOP         * 02150021
*                                                                     * 02200021
*TABLES/WORK AREAS: NO INTERNAL TABLES ARE USED                       * 02250021
*ATTRIBUTES: REUSABLE                                                 * 02300021
*NOTES: N/A                                                           * 02350021
HEWLFESD CSECT                                                          02400021
**********************************************************************  02450021
*437000-442000                                                   S01904 02460021
*A442000,435000                                                   M4320 02462021
*A342500                                                        OX00027 02464000
*C305000,D307000-308000                                         OY00577 02466001
*SEE FIX FOR X4241,ALSO A721600-721700,A580667                  OX00822 02466102
*C081000                                                        OY00131 02468001
*SEE FIX FOR X4241                                               XM1786 02468402
*C343000,C348000                                                OX02010 02479202
*A359500-359960,C360000                                          XM4628 02484402
*     SEE FIX FOR XM4628                                        OX02833 02489602
*C65400                                                   OX3508,OY3042 02491602
*I533000,D579520-580532                                   OX3919,OY3210 02493602
*C262000-263000,C486000,I486000                                 XA05436 02494003
* SEE FIX FOR XA05436                                           YA03749 02494403
*C359600-359700,C359900,C359940,D359960-360000                  XA04649 02494503
* SEE FIX FOR XA04649                                           YA03751 02494603
*I533992,D533996                                        XA06871,ZA00835 02494703
* C263000,D263500-264960,D486500-486992,C492000,I499500         ZA01413 02521037
* I509000,C589000,C594000-595000,I597000,I721000                ZA01413 02531037
*C081000                                                       @XA11151 02547437
        ENTRY HEWLCE30                                                  02573737
         ENTRY HEWLCTTY                                                 02600021
        ENTRY HEWLCRID                                                  02700021
SYSRET   EQU   14                                                       02800021
RNT      EQU   5                                                        02900021
TEMP2    EQU   4                                                        03000021
CESDCHN  EQU   14                                                       03100021
SD       EQU   X'00'                                                    03200021
NULL     EQU   X'07'                                                    03300021
CESDID   EQU   9                                                        03400021
CESDORG  EQU   9                                                        03500021
ESDORG   EQU   9                                                        03600021
CESDSEG  EQU   12                                                       03700021
RNTTYPE  EQU   3                                                        03800021
RNTFLAG  EQU   2                                                        03900021
CM       EQU   X'05'                                                    04000021
TEMP     EQU   10                                                       04100021
CESDLEN  EQU   13                                                       04200021
SYSBRNCH EQU   15                                                       04300021
ESDLEN   EQU   13                                                       04400021
CESDTYPE EQU   8                                                        04500021
CESDNAME EQU   0                                                        04600021
ESDNAME  EQU   0                                                        04700021
CESDTF   EQU   10                                                       04800021
CESDXR   EQU   7                                                        04900021
LABELDEF EQU   X'01'                                                    05000021
LD       EQU   X'01'                                                    05100021
PC       EQU   X'04'                                                    05200021
LR       EQU   X'03'                                                    05300021
INTERNAL EQU   13                                                       05400021
SUBTYPE  EQU   13                                                       05500021
ER       EQU   X'02'                                                    05600021
ESDSEG   EQU   12                                                       05700021
PR       EQU   X'06'                                                    05800021
ESDTYPE  EQU   8                                                        05900021
ESDADD   EQU   6                                                        06000021
APT      EQU   2                                                        06100021
CESD     EQU   3                                                        06200021
BASE     EQU   12                                                       06300021
AUTOLIB  EQU   X'40'                                                    06400021
ESDWRITE EQU   X'01'                                                    06500021
NOLENBIT EQU   X'40'                                                    06600021
TEMP1    EQU   8                                                        06700021
TEMP4    EQU   0                                                        06800021
TEMP3    EQU   1                                                        06900021
OVBIT    EQU   X'20'                                                    07000021
TBLONUM  EQU   X'10D'                                                   07100021
REGSAVE  EQU   76                                                       07200021
OBJCTMOD EQU   X'20'                                                    07300021
RETURN   EQU   11                                                       07400021
BYTECNT  EQU   4                                                        07500021
RNTID    EQU   0                                                        07600021
RNTR     EQU   4                                                        07700021
COM      EQU   X'04'                                                    07800021
ESDOVFLW EQU   X'419'                                                   07900021
RNTOFLOW EQU   X'41A'                                                   08000021
ERR23    EQU   X'417'                                  @XA11151,OY00131 08100037
WX       EQU   X'0A'               WXTERN ESD ITEM                      08200021
WRKREG0  EQU   0                       WORK REGISTER 0                  08300021
WRKREGE  EQU   14                      WORK REGISTER 14                 08400021
WRKREGF  EQU   15                      WORK REGISTER 15                 08500021
         USING HEWLFESD,BASE                                            08600021
         USING APTDSECT,APT   ESTABLISH ADDRESSABILITY FOR APT          08700021
         STM   SYSRET,BASE,12(INTERNAL) SAVE CALLERS REGISTERS          08800021
         LR    BASE,SYSBRNCH            BASE IN 12                      08900021
         B     OVERNAME                BRANCH AROUND MODULE IDENT       09000037
MODID    DC    C'HEWLFESD'                                              09050037
         DC    C'10/15/75'                                              09100037
         DC    C'OZ02229 '                                              09150037
         DC    0H'0'                                                    09200037
OVERNAME ST    INTERNAL,SAVEAREA        SAVE ADDRESS OF SAVEAREA        09250037
         ST    SYSRET,REG24SA                                           09300021
         TM    APT1,OBJCTMOD       IS INPUT OBJECT MODULE               09400021
         BC    1,ESD01                  NO BRANCH                       09500021
         CH    BYTECNT,C56              IS BYTE COUNT GR 56             09600021
         BC    2,BADCARDO               YES ERROR                       09700021
         BC    15,ESD02                                                 09800021
ESD01    CH    BYTECNT,C240             IS BYTE COUNT GR 240            09900021
         BC    2,BADCARDL               YES ERROR                       10000021
ESD02    SRL   BYTECNT,4                NUMBER OF ESD ITEMS             10100021
         LTR   BYTECNT,BYTECNT  IS BYTE COUNT LESS THAN 16 DECIMAL      10200021
         BC    8,BADCARDO    NO-CONTINUE--YEW--PRINT ERROR              10300021
         STM   BYTECNT,RNT,REGSA4                                       10400021
*              INITIALIZE ALL BASES AND INDEXES                         10500021
         L     RNT,RECNT           RENUMBERING TABLE BASE REGISTER      10600021
         L     CESD,CHESD          CESD BASE REGISTER                   10700021
*              EXTRACT BITS 5,6,7 OF TYPE AND MAKE IT A BYTEFULL        10800021
ESD1     MVC   TESTYPE(1),ESDTYPE(ESDADD)                               10900021
*              MOVE ESD TYPE TO INTERNAL WORK AREA                      11000021
         LR    CESDXR,CESD              SAFETY FOR IDCESD               11100021
         NI    ESDTYPE(ESDADD),X'1F'   CLEAR ALL FLAGS EXCEPT DELETE    11200021
         NI    TESTYPE,X'0F'       CLEAR DELETE BIT                     11300021
*              IS ESD TYPE PR                                           11400021
         TM    APT1,OBJCTMOD       IS INPUT OBJECT MODULE               11500021
         BC    1,ESD1A0                NO-BRANCH                        11600021
         NI    ESDTYPE(ESDADD),X'EF'   CLEAR DELETE BIT                 11700021
ESD1A0   CLI   TESTYPE,PR                                               11800021
         BC    8,ESD2                                                   11900021
*              YES-BRANCH TO ESD2 NOT TO DESTROY ALIGNMENT FIELD        12000021
*              NO-CONTINUE                                              12100021
         MVC   ESDSEG(1,ESDADD),CSNO+1                                  12200021
*              SET ESD SEGMENT NUMBER FIELD TO THE CURRENT SEGMENT      12300021
*              IF AUTOMATIC LIBRARY CALL IS IN OPERATION, THE CURRENT * 12400021
*              SEGMENT NUMBER IS ONE                                  * 12500021
         TM    APT1,AUTOLIB                                             12600021
         BC    8,ESD1A                                                  12700021
         MVI   ESDSEG(ESDADD),1                                         12800021
*              IS ESD TYPE AN ER                                      * 12900021
ESD1A    CLI   TESTYPE,ER          IS TYPE ER                           13000021
         BC    8,ESD1B             YES                                  13100021
         CLI   TESTYPE,WX          IS TYPE WX                           13200021
         BC    7,ESD2              NO                                   13300021
*              NO-BRANCH TO ESD2                                        13400021
*              YES-CONTINUE                                             13500021
*              CLEAR BYTE 9 OF THE ER FOR AUTOMATIC LIBRARY CALL      * 13600021
ESD1B    XC    ESDORG(3,ESDADD),9(ESDADD)                               13700021
         TM    APT1,OBJCTMOD                                            13800021
*              IS INPUT OBJECT MODULE                                   13900021
*              NO-BRANCH TO ESD2                                        14000021
*              YES-CONTINUE                                             14100021
*              ALL ERS  FROM OBJECT MODULES ARE PURE ERS(BYTE 13 = 0) * 14200021
         BC    1,ESD2                                                   14300021
         MVI   SUBTYPE(ESDADD),X'00'                                    14400021
ESD2     L     TEMP,RCCB                                                14500021
*              ARE THERE ANY REPLACE/CHANGE CARDS IN CHAIN            * 14600021
         LTR   TEMP,TEMP                                                14700021
         BC    8,ESD3                                                   14800021
*              YES-CONTINUE BY BRANCHING TO REPLACE/CHANGE CARD PROCESS 14900021
         L     INTERNAL,RPCHGADD                                        15000021
         BALR  RETURN,INTERNAL                                          15100021
*              REPLACE/CHANGE CARD PROCESSOR RETURNS HERE               15200021
ESD3     CLI   TESTYPE,PC                                               15300021
*              IS ESD TYPE PRIVATE CODE                                 15400021
*              YES-BRANCH TO ENTER PC AT CURRENT LINE + 1               15500021
*              NO-CONTINUE TESTING FOR LABEL DEFINITION                 15600021
         BC    8,ESD20                                                  15700021
         CLI   TESTYPE,NULL            IS TYPE A NULL                   15800021
         BC    8,RENUMBER              YES , BRANCH                     15900021
*              IS ESD TYPE LABEL DEFINITION                             16000021
         CLI   TESTYPE,LD                                               16100021
*              NO-BRANCH TO ESD4 TO SEARCH THE CESD                     16200021
*              YES-CHANGE TYPE TO LR AND SET LABEL DEFINITION BIT ON    16300021
         BC    7,ESD4                                                   16400021
         MVI   TESTYPE,LR                                               16500021
         OI    INTERN1,LABELDEF                                         16600021
ESD4     LR    CESDXR,CESD                                              16700021
*              INITIALIZE CESD LOOP                                     16800021
         LH    CESDTF,ENCDC                                             16900021
         LA    CESDTF,1(CESDTF)                                         17000021
ESD5     LA    CESDXR,16(CESDXR)                                        17100021
*              IS CESD LOOP DONE                                        17200021
         BCT   CESDTF,ESD6                                              17300021
*              YES-BRANCH TO NON-RESOLUTION PROCESSING                  17400021
         B     ESD23             BRANCH TO ENTER ESD ITEM               17500021
*              NO-CONTINUE CHECKING FOR A SYMBOL MATCH                  17600021
ESD6     CLC   ESDNAME(8,ESDADD),CESDNAME(CESDXR)                       17700021
*              DO ESD AND CESD SYMBOLS MATCH                            17800021
*              NO-CONTINE CESD SEARCH                                   17900021
         BC    7,ESD5                                                   18000021
*              YES-PERFORM COLLECTION OF ESD AND CESD TYPES             18100021
*              EXTRACT CESD TYPE FOR TESTING PURPOSES                   18200021
ESD6A    EQU   *                                                        18300021
         MVC   CESDTTYP(1),CESDTYPE(CESDXR)                             18400021
         NI    CESDTTYP,X'0F'                                           18500021
         BAL   RETURN,IDCESD                                            18600021
         CLI   CESDTTYP,NULL                                            18700021
         BC    8,ESD5                                                   18800021
         CLI   TESTYPE,PR                                               18900021
*              IS ESD TYPE PSEUDO REGISTER                              19000021
*              YES-A PSEUDO REGISTER MAY ONLY COLLECT ANOTHER           19100021
         BC    8,ESD9                                                   19200021
*              NO-THE CESD TYPE MAY BE A PSEUDO REGISTER                19300021
*              IS CESD TYPE PSEUDO REGISTER OR NULL                     19400021
         CLI   CESDTTYP,PR                                              19500021
*              YES-RETURN TO CESD SEARCH                                19600021
         BC    8,ESD5                                                   19700021
         CLI   CESDTTYP,NULL       IS TYPE NULL                         19800021
         BC    8,ESD5                                                   19900021
*              NO-CONTINUE                                              20000021
*                                                                       20100021
*        PROCESS WX'S  HERE.  IF WX MATCHES ANYTHING BUT ANOTHER        20200021
*        WX, CHANGE THE TYPE TO ER AND PROCESS NORMALLY.                20300021
*                                                                       20400021
         CLI   TESTYPE,WX          IS INPUT ESD TYPE WX                 20500021
         BC    7,ESD6B             NO - BRANCH                          20600021
*        INPUT ITEM IS WX                                               20700021
         CLI   CESDTTYP,WX         IS CESD A WX                         20800021
         BC    7,ESD6C             NO - BRANCH                          20900021
         B     RENUMBER            BOTH TYPES ARE WX                    21000021
*        ONLY  INPUT ITEM IS WX                                         21100021
ESD6C    CLI   CESDTTYP,ER         IS CESD TYPE ER                      21200021
         BNE   ESD6D               NO                                   21300021
         CLI   SUBTYPE(CESDXR),X'80'  IS CESD ITEM A CONTROL CARD       21400021
         BC    2,ESD5              YES - CONTINUE CESD LOOP             21500021
ESD6D    MVI   TESTYPE,ER          CHANGE INPUT ITME TO ER              21600021
         MVI   ESDTYPE(ESDADD),ER                                       21700021
         B     ESD7                CONTINUE                             21800021
ESD6B    CLI   CESDTTYP,WX         IS CESD TYPE WX                      21900021
         BC    7,ESD7              NO - BRANCH                          22000021
*        ONLY CESD TYPE IS WX - CHANGE TO ER                            22100021
         NI    CESDTTYP,X'F7'          CHANGE CESD ITEM TO ER           22200021
         NI    CESDTYPE(CESDXR),X'F7'  CHANGE CESD ITEM TO ER           22300021
ESD7     TM    CESDTYPE(CESDXR),X'40' IS TYPE CHAIN                     22400021
*              YES-BRANCH TO RESET CESD INDEX TO CHAIN VALUE            22500021
         BC    1,ESD13                                                  22600021
*              IS CESD TYPE ER                                          22700021
         LA    RETURN,ESD23A                                            22800021
         CLI   CESDTTYP,ER                                              22900021
*              YES-SEE IF IT IS A CONTROL CARD                          23000021
         BC    8,ESD12                                                  23100021
*              IT IS NOT AN ER OR CONTROL CARD                          23200021
         CLI   TESTYPE,LR                                               23300021
*              IS ESD TYPE LR                                           23400021
         BC    7,ESD14                                                  23500021
*              NO-BRANCH FOR FURTHER EXAMINATION OF ESD TYPE            23600021
*              YES-PERFORM LABEL REFERENCE RESOLUTION                   23700021
         OI    INTERN1,X'02'                                            23800021
*              SET MATCH BIT ON INTERNALLY                              23900021
         BC    15,LABEL                                                 24000021
ESD9     CLI   CESDTYPE(CESDXR),PR                                      24100021
*              IS CESD TYPE A PSEUDO REGISTER                           24200021
         BC    7,ESD5                                                   24300021
*              NO-RETURN TO THE CESD SEARCH                             24400021
*              YES-BOTH ESD AND CESD TYPES ARE PSEUDO REGISTERS         24500021
         CLC   ESDLEN(3,ESDADD),CESDLEN(CESDXR)                         24600021
*              IS ESD LENGTH GREATER THAN CESD LENGTH                   24700021
*              NO-BRAN.H TO CHECK ALIGNMENT                             24800021
         BC    4,ESD10                                                  24900021
*              YES SET CESD LENGTH TO ESD LENGTH                        25000021
         MVC   CESDLEN(3,CESDXR),ESDLEN(ESDADD)                         25100021
ESD10    OC    CESDSEG(1,CESDXR),ESDSEG(ESDADD)                         25200021
*              SET CESD ALIGNMENT TO THE HIGHER OF THE TWO VALUES       25300021
         BC    15,RENUMBER                                              25400021
ESD12    CLI   SUBTYPE(CESDXR),X'80'                                    25500021
*              IS CESD SUBTYPE FOR A CONTROL CARD                       25600021
         BC    2,ESD5                                                   25700021
*              YES-CONTINUE CESD LOOP                                   25800021
*              NO-RESUME PROCESSING                                     25900021
         OI    INTERN1,MATCHER         SHOW WE MATCHED AN ER            26000021
*              IS ESD TYPE CM,SD,LR                                     26100021
         CLI   TESTYPE,X'02'            IS INPUT ITEM AN ER     XA05436 26200003
         BNE   ESD17                    BRANCH IF NOT   XA05436,ZA01413 26300037
         TM    ESDTYPE(ESDADD),X'10'    IS INCOMING ITEM DELETE/REPLACE 26500021
         BC    8,ESD12A                 NO-BRANCH                       26600021
         TM    CESDTYPE(CESDXR),X'10'   IS CESD TYPE DELETE/RELPACE     26700021
         BC    8,ESD15A                 NO                              26800021
*                                       CESD ITEM IS ALSO DEL/REP       26900021
         TM    SUBTYPE(CESDXR),X'08'         IS IT A DELETE             27000021
         BC    8,ESD15A                 NO BRANCH                       27100021
         TM    SUBTYPE(ESDADD),X'08'    IS ESD TYPE A DELETE            27200021
         BC    8,CESDDLNK               NO BRANCH                       27300021
         BC    15,ESD23                 DELETE-DELETE CAUSES BOTH LINES 27400021
*                                       TO BE ENTERED                   27500021
ESD12A   TM    SUBTYPE(ESDADD),X'07'    IS SUBTYPE A PURE ER            27600021
         BC    5,ESD17                                                  27700021
         NI    SUBTYPE(CESDXR),X'F7'    CLEAR DELETE BIT MAKING SUBTYPE 27800021
*                                       A REPLACE                       27900021
         TM    SUBTYPE(CESDXR),X'06'    IS SUBTYPE A NO CALL            28000021
*                                       OR LIBR ARY MEMBER              28100021
         BC    9,RENUMBER               NO BRANCH                       28200021
         OI    SUBTYPE(CESDXR),X'01'    YES IT IS-MARK CESD MATCHED     28300021
         BC    15,RENUMBER                                              28400021
*              RESET CESD INDEX TO CHAIN VALUE AND THEN BRANCH BACK TO* 28500021
*              EXAMINE THE TYPE OF THE LINE TO WHICH THIS WAS CHAINED * 28600021
ESD13    LH    TEMP,CESDCHN(CESDXR)                                     28700021
         SLL   TEMP,4                                                   28800021
         LA    CESDXR,0(TEMP,CESD)                                      28900021
         BC    15,ESD6A                                                 29000021
ESD14    CLI   TESTYPE,SD                                               29100021
*              IS ESD TYPE SD                                           29200021
         BC    7,ESD18                                                  29300021
*              NO-BRANCH FOR FURTHER EXAMINATION OF ESD TYPE            29400021
*              YES-PERFORM SECTION DEFINITION RESOLUTION                29500021
         CLI   CESDTTYP,CM                                              29600021
*              IS CESD TYPE CM                                          29700021
         BC    7,ESD15                                                  29800021
*              NO-CONTINUE RESOLUTION                                   29900021
*        YES! COMPARE LENGTH FIELDS.CM SHOULD BE  SMALLER OR EQUAL.     30000021
*        IF IT'S NOT WE'LL GIVE ERROR MESSAGE AND TAKE CM LENGTH.222116 30100021
         CLC   ESDLEN(3,ESDADD),CESDLEN(CESDXR)                         30200021
         BNL   ESD38                                                    30300021
         CLC   ESDLEN(3,ESDADD),ZERO3  IS SD LENGTH ZERO?               30400021
         BNE   COMMON1                YES. GOTO PRINT ERROR MSG OY00577 30500001
*                               'COMMON AND SUBROUTINE-SAME NAME        30600021
ESD14A   LR    TEMP3,CESDXR            NAME OF COMMON FOR MSG           30900021
         LH    TEMP4,ERR57             ERR NUMBER,SEVERITY,DISP         31000021
         L     SYSBRNCH,ERDIG          ADDR. OF ERROR ROUTINE           31100021
         BALR  SYSRET,SYSBRNCH         GO TO PRINT MSG                  31200021
         B     ESD38                   CONT. PROCESSING SD ITEM         31300021
*              BRANCH TO SECTION DEFINITION PROCESSING                  31400021
ESD15    CLI   CESDTTYP,LR                                              31500021
*              IS CESD TYPE LABEL REFERENCE                             31600021
         LA    RETURN,ESD15A                                            31700021
         BC    8,DBLDEF                                                 31800021
*              YES-BRANCH TO ERROR ROUTINE FOR DOUBLE LABEL DEFINITION  31900021
*              NO-CONTINUE                                              32000021
ESD15A   LA    RETURN,ENTER                                             32100021
*              BRANCH TO DELETE CHAIN ROUTINE FOR AUTOMATIC REPLACE   * 32200021
         BC    15,DELCHN                                                32300021
*              IF THE ESD TYPE IS NOT MARKED DELETE,RENUMBER IT       * 32400021
ESD16    TM    ESDTYPE(ESDADD),X'10'                                    32500021
         BC    8,RENUMBER                                               32600021
*              IT IS DELETE SO BRANCH TO DELETE CHAIN ROUTINE           32700021
         BC    15,ESD15A                                                32800021
*              IS SUBTYPE UNMATCHED LIBRARY MEMBER                      32900021
ESD17    OI    INTERN1,X'08'                                            33000021
         TM    8(CESDXR),X'10'         IS CESD DELETE                   33100021
         BC    1,CESDDLNK               DELINK IT                       33200021
ESD17A   TM    13(CESDXR),X'06'        IF CESD TYPE IS LIBRARY MEMBER   33300021
         BCR   9,RETURN                DECHAIN IT                       33400021
         TM    13(CESDXR),X'04'                                         33500021
         BCR   1,RETURN                                                 33600021
         L     SYSBRNCH,ADDDECHN                                        33700021
         BCR   15,SYSBRNCH                                              33800021
ESD18    CLI   TESTYPE,CM                                               33900021
*              IS ESDTYPE COMMON                                        34000021
         BC    7,ESD16                                                  34100021
*              NO-BRANCH FOR ER PROCESSING                            * 34200021
         OI    INTERN1,COM         INTERNAL COM BIT FOR DELINK OX00027  34250000
         CLI   CESDTTYP,PC                                      OX02010 34300003
*              IS CESD TYPE PC                                          34400021
         BC    8,ESD5                                                   34500021
*              YES-NO MATCH RESULTS                                     34600021
         LA    RETURN,ESD15A                                            34700021
         CLI   CESDTTYP,LR                                      OX02010 34800003
*              IS CESDTYPE A LABEL                                      34900021
         BC    8,DBLDEF                                                 35000021
*              YES-BRANCH TO ERROR FOR DOUBLE LABEL DEFINITION MESSAGE  35100021
*              SET ESD TYPE TO CESD TYPE                                35200021
*              SET ESD TYPE TO DELETE AND THEN BRANCH TO THE COMMON   * 35300021
*              ROUTINE                                                  35400021
         BC    15,COMMON                                                35500021
*                                                                     * 35600021
*                   UNMATCHED  PC  PROCESSING BEGINS HERE             * 35700003
*                                                                     * 35900021
ESD20    EQU   *                                                 XM4628 35950003
         BAL   RETURN,NXTLINE          GET NEXT CESD ITEM       XA04649 35960003
         NC    ESDLEN(3,ESDADD),ESDLEN(ESDADD) IS IT 0 LENGTH?   XM4628 35980003
         BNZ   ESD21                 BRANCH IF NO        XM4628,XA04649 35990003
         OI    TESTYPE,DELETE        MARK DELETE                 XM4628 35992003
         B     ENTER                 ENTER IN RNT        XM4628,XA04649 35994003
ESD21    TM    APT1,AUTOLIB                                             36100021
*              IS AUTOMATIC LIBRARY CALL IN OPERATION                 * 36200021
         BC    8,ESD22                                                  36300021
*              NO-BRANCH AROUND                                         36400021
*              YES-SET BIT 0 OF TYPE TO A ONE                           36500021
         OI    ESDTYPE(ESDADD),X'80'                                    36600021
ESD22    OI    APT1,ESDWRITE                                            36700021
*              SET ESD WRITE INDICATOR ON                               36800021
*              IS LENGTH FIELD IN ESD BLANKS                            36900021
         NC    ESDLEN(3,ESDADD),ESDLEN(ESDADD)                          37000021
         BC    4,ENTER                                                  37100021
*              NO-ENTER THE LINE IN THE CESD                            37200021
*              YES-IS NO LENGTH BIT ON                                  37300021
         TM    APT2,NOLENBIT                                            37400021
*              YES-IGNORE IT                                          * 37500021
         BC    1,ENTER                                                  37600021
         OI    APT2,NOLENBIT                                            37700021
*              SET NOLENGTH BIT ON AND SAVE THE LINE ADDRESS IN APT   * 37800021
         ST    CESDXR,PDSE18                                            37900021
         BC    15,ENTER                                                 38000021
**********            NON RESOLUTION PROCESSING BEGINS HERE  ********** 38100021
ESD23    BAL   RETURN,FREELINE                                          38200021
*              SET CESD INDEX TO CURRENT LINE+1 AND UPDATE CURRENT CNT* 38300021
ESD23A   CLI   TESTYPE,LR                                               38400021
*              IS ESD TYPE LR                                           38500021
         BC    8,LABEL                                                  38600021
*              YES BRANCH TO LABEL ROUTINE                              38700021
*              NO-IS ESD TYPE SECTION DEFINITION                        38800021
         CLI   TESTYPE,SD                                               38900021
         BC    8,ESD21                                                  39000021
*              YES-BRANCH TO SECTION DEFINITION PROCESSING              39100021
*              NO-IS TYPE NULL                                          39200021
         CLI   TESTYPE,CM                                               39300021
*              SET INTERNAL COMMON INDICATOR ON AND MARK COMMON DELETE* 39400021
         BC    8,ESD42                                                  39500021
*              YES-BRANCH TO RENUMBER ROUTINE                           39600021
**********            THE ENTER ROUTINE STARTS HERE          ********** 39700021
ENTER    CH    CESDID,ENCDX                                             39800021
*              IS THE CESD LIMIT EXCEEDED                               39900021
         BC    12,ENTER2               NO,SKIP REALOC           S01904  40000021
         STM   WRKREG0,WRKREGF,BRNCHSV   SAVE REGISTERS         S01904  40100021
         LA    WRKREG0,ESDOVFLW        MESSAGE CODE CESD OVFLW  S01904  40200021
         LA    WRKREGE,ENTER1          SET RETURN ADDRESS       S01904  40300021
ENTER3   TM    APT4,X'C0'              REALOC POSSIBLE          S01904  40400021
         BO    ESD39A                  SIGNAL OVERFLOW          S01904  40500021
         L     WRKREGF,ERDIGA          GET REALOC RTN ADDR      S01904  40600021
         BR    WRKREGF                 GO TO REALOC RTN         S01904  40700021
ENTER1   LM    WRKREG0,WRKREGF,BRNCHSV  RESTORE REGISTERS       S01904  40800021
*              NO-SET ESD SYMBOL AND ORIGIN INTO CESD LINE              40900021
ENTER2   MVC   CESDNAME(8,CESDXR),ESDNAME(ESDADD)                       41000021
*              MOVE SYMBOL FIELD                                      * 41100021
         MVC   CESDORG(3,CESDXR),ESDORG(ESDADD)                         41200021
*              MOVE ORIGIN FIELD                                      * 41300021
         TM    CESDTYPE(CESDXR),X'20'                                   41400021
*              IS CESD TYPE INSERT                                      41500021
         BC     8,ESD24X         NO,  BRANCH.                           41600021
         CLI    TESTYPE,LR       IS ITEM AN LR                          41700021
         BC     7,ESD24          NO,  BRANCH.                           41800021
ESD24X   MVC    CESDSEG(1,CESDXR),ESDSEG(ESDADD)                        41900021
ESD24    MVC   CESDLEN(3,CESDXR),ESDLEN(ESDADD)                         42000021
*              SET CESD LENGTH FIELD TO ESD LENGTH FIELD                42100021
*              SET CESD TYPE TO ESD TYPE                                42200021
         NI    CESDTYPE(CESDXR),X'F0'   CLEAR LOW ORDER BITS            42300021
         OC    CESDTYPE(1,CESDXR),TESTYPE                               42400021
         MVC   CLRBYT(1),ESDTYPE(ESDADD)                                42500021
         NI    CLRBYT,X'F0'        CLEAR BITS                           42600021
         OC    CESDTYPE(1,CESDXR),CLRBYT                                42700021
**********            THE RENUMBER ROUTINE STARTS HERE       ********** 42800021
*              IF THE LINE WHICH IS ABOUT TO BE ENTERED IS AN LD        42900021
*              IT IS NOT ENTERED-ALL OTHERS ARE                         43000021
RENUMBER TM    INTERN1,LABELDEF                                         43100021
         BC    1,ESD30                                                  43200021
         L     TEMP,REGSA5                                              43300021
         LTR   TEMP,TEMP                                                43400021
         BC    12,TBLOFLOW                                              43500021
         L     RNT,RECNT               UPDATE REG PTR TO RNT      M4320 43550021
         CH    TEMP,ENCDX                                               43600021
         BC    12,RNUMBR2              NO OVERFLOW              S01904  43700021
         STM   WRKREG0,WRKREGF,BRNCHSV SAVE REGISTERS           S01904  43800021
         LA    WRKREGE,RNUMBR1         SET RETURN ADDRESS       S01904  43900021
         LA    WRKREG0,RNTOFLOW        MESSAGE CODE RNT OVFLW   S01904  44000021
         B     ENTER3                  CHECK FOR POSS REALOC    S01904  44100021
RNUMBR1  LM    WRKREG0,WRKREGF,BRNCHSV RESTORE REGISTERS        S01904  44200021
         L     RNT,RECNT               UPDATE REG PTR TO RNT      M4320 44250021
RNUMBR2  SLL   TEMP,2                                                   44300021
*              COMPUTE ADDRESS OF RNT LINE                            * 44400021
         AR    TEMP,RNT                                                 44500021
         MVC   RNTTYPE(1,TEMP),TESTYPE                                  44600021
         MVC   CLRBYT(1),ESDTYPE(ESDADD)                                44700021
         NI    CLRBYT,X'F0'        CLEAR BITS                           44800021
         OC    RNTTYPE(1,TEMP),CLRBYT                                   44900021
*              SET TYPE IN RNT                                          45000021
         OI    RNTFLAG(TEMP),X'01'                                      45100021
*              SET PRESENT FLAG ON IN RNT LINE AND THEN GO TO  IDCESD * 45200021
*              TO COMPUTE THE ID(LINE NUMBER) OF THE PRESENT LINE     * 45300021
         BAL   RETURN,IDCESD                                            45400021
         LH    TEMP1,RNTID(TEMP)                                        45500021
         STH   CESDID,RNTID(TEMP)                                       45600021
*              STORE THE LINE ID IN THE RNT                           * 45700021
         TM    RNTFLAG(TEMP),X'02'                                      45800021
*              IS DEPEND FLAG ON                                        45900021
         BC    8,ESD29                                                  46000021
*              NO-BRANCH TO UPDATE RNT INDEX                          * 46100021
*              YES-CLEAR DEPEND BIT IN RNT                            * 46200021
         NI    RNTFLAG(TEMP),X'FD'                                      46300021
ESD24A   SLL   TEMP1,4                                                  46400021
         AR    TEMP1,CESD               TEMP1 IS INDEX TO LABEL LINE    46500021
         TM    CESDTYPE(TEMP1),X'40'                                    46600021
         BC    8,ESD25                                                  46700021
*              IF THE CESD TYPE IS CHAINED A DOUBLE DEFINITION WILL     46800021
*              OCCUR IF THE PRESENTESD IS NOT MARKED DELETE           * 46900021
         TM    ESDTYPE(ESDADD),X'10'                                    47000021
         BC    1,ESD28B                                                 47100021
         LA    RETURN,ESD28B                                            47200021
*              BRANCH TO ERROR DIAGNOSTIC FOR DOUBLE SYMBOL DEFINITION* 47300021
*                        *****ERROR*****                              * 47400021
*                                                                     * 47500021
         BC    15,DBLDEF1                                               47600021
ESD25    TM    ESDTYPE(ESDADD),X'10'                                    47700021
         BC    1,ESD27                                                  47800021
*              IF ESD TYPE IS NOT DELETE - RENUMBER ID                  47900021
ESD26    LH    TEMP,12(TEMP1)                                           48000021
ESD26A   STH   CESDID,14(TEMP1)                                         48100021
*              IF CHAIN ENDS (TEMP= 0 ) STOP RENUMBERING LABELS       * 48200021
ESD26B   LTR   TEMP1,TEMP                                               48300021
         BC    8,ESD29                                                  48400021
         BC    15,ESD24A                                                48500021
ESD27    LH    TEMP2,14(,TEMP1)        GET CESD ID FOR SD ITEM  XA05436 48600003
         MVI   CESDTYPE(TEMP1),ER      SET CESD TO ER                   48700021
*              IF THE ESD TYPE IS DELETE, CHECK RNT POINTER TO SEE IF * 48800021
*              IT IS AN LD-IF IT IS SET TYPE TO ER MARKED DELETE      * 48900021
         LTR   TEMP2,TEMP2                                              49000021
         BZ    ESD28A                  LD THAT CAN BE DELETED           49100021
         BM    ESD28C                  LD THAT CAN'T BE DELETED ZA01413 49200037
*              IF IT IS AN LR- THE RNT TYPE MUST BE SET TO ER DELETE  * 49300021
*              AS WELL AS CESD TYPE                                   * 49400021
ESD28    SLL   TEMP2,2                                                  49500021
         AR    TEMP2,RNT                                                49600021
*              SET RNT TYPE                                           * 49700021
*              SET CESD TYPE                                          * 49800021
         MVI   RNTTYPE(TEMP2),ER       RNT TYPE ER                      49900021
         OI    RNTTYPE(TEMP2),DELETE   TURN ON DELETE FLAG       A44660 49950000
         TM    RNTFLAG(TEMP2),X'80'    CHECK FOR SAVED BLDL BIT ZA01413 49960037
         BNO   ESD28AA                 BRANCH IF NOT FOUND      ZA01413 49970037
         MVI   CESDORG(TEMP1),X'80'    RESTORE BLDL BIT IN ER   ZA01413 49980037
         NI    RNTFLAG(TEMP2),X'7F'    REMOVE BLDL BIT IN RNT   ZA01413 49990037
ESD28AA  EQU   *                                                ZA01413 49992037
         TM    RNTFLAG(TEMP2),NODELETE   SHOULD WE MARK IT              50000021
*                                             FOR DELETION?             50100021
         BO    ESD28B                  NO,BRANCH                        50200021
ESD28A   OI    CESDTYPE(TEMP1),DELETE  YES, SET DELETE FLAG             50400021
*                                              IN TYPE                  50500021
ESD28B   LH    TEMP,12(TEMP1)                                           50600021
*              SET SUBTYPE TO DELETE                                  * 50700021
         MVI   SUBTYPE(TEMP1),X'08'                                     50800021
         BC    15,ESD26B                TO CHECK IF CHAIN IS DONE       50900021
ESD28C   STC   TEMP2,TSTBYT            SAVE FLAG LOW BYTE       ZA01413 50950037
         TM    TSTBYT,X'01'            TEST IF EVEN OR ODD      ZA01413 50960037
         BO    ESD28B                  BRANCH IF ODD            ZA01413 50970037
         MVI   CESDORG(CESDXR),X'80'   RESTORE BLDL BIT IN ER   ZA01413 50980037
         B     ESD28B                  RESUME MAINLINE          ZA01413 50990037
ESD29    L     TEMP,REGSA5                                              51000021
*              IF THE ITEM BEING PROCESSED IS COMMON-DELINK IT        * 51100021
         TM    INTERN1,COM                                              51200021
         BC    1,ESD43                                                  51300021
ESD29A   LA    TEMP,1(TEMP)                                             51400021
         ST    TEMP,REGSA5                                              51500021
HEWLCE30 EQU   *                                                        51600021
ESD30    NI    INTERN1,X'00'                                            51700021
         LA    ESDADD,16(ESDADD)                                        51800021
         L     TEMP,REGSA4                                              51900021
         BCT   TEMP,ESD30A                                              52000021
*              IF THE ESD CARD IS DONE- RETURN TO THE INPUT PROCESSOR * 52100021
ESD30A0  L     INTERNAL,SAVEAREA                                        52200021
         LM    SYSBRNCH,TEMP3,16(INTERNAL)                              52300021
         L     SYSRET,REG24SA                                           52400021
         LM    CESD,BASE,32(INTERNAL)                                   52500021
*              CLEAR INTERNAL INDICATORS                              * 52600021
         BCR   15,SYSRET                                                52700021
*              OTHERWISE SAVE THE RNTID AND RETURN TO THE BEGINNING   * 52800021
ESD30A   ST    TEMP,REGSA4                                              52900021
         BC    15,ESD1                                                  53000021
**********            THE LABEL ROUTINE STARTS HERE          ********** 53100021
LABEL    LH    TEMP,14(ESDADD)                                          53200021
*              COMPUTE THE RNT ADDRESS FOR THE LABEL ID               * 53300021
         CH    TEMP,ENCDX               DOES IT EXCEED THE      OX03919 53350002
*                                       LIMITS OF THE RNT       OX03919 53360002
         BC    12,RNTOK                 BRANCH IF NOT           OX03919 53370002
         STM   WRKREG0,WRKREGF,BRNCHSV  SAVE REGISTERS          OX03919 53380002
         LA    WRKREGE,RNTRET           SET UP RETURN ADDRESS   OX03919 53390002
         LA    WRKREG0,RNTOFLOW         SET CODE FOR RNT        OX03919 53392002
*                                       OVERFLOW                OX03919 53394002
         B     ENTER3                   GO TEST IF REALLOC      OX03919 53396002
*                                       POSS AND DO SO IF       OX03919 53398002
*                                       POSSIBLE                OX03919 53398402
RNTRET   EQU   *                                                OX03919 53398802
         LM    WRKREG0,WRKREGF,BRNCHSV  RESTORE REGS            OX03919 53399202
RNTOK    EQU   *                                        ZA00835,XA06871 53399303
         L     RNT,RECNT               RESTORE POINTER TO RNT   OX03919 53399603
         SLL   TEMP,2                                                   53400021
         AR    TEMP,RNT                                                 53500021
         LA    INTERNAL,ENTER                                           53600021
         L     TEMP2,REGSA5                                             53700021
         TM    INTERN1,MATCHER         DID THIS MATCH AN ER?            53800021
         BNO   REN1                    NO, BRANCH                       53900021
         TM    INTERN1,LABELDEF        IS THIS AN LD?                   54000021
         BO    REN1                    YES, NO FLAG IN RNT              54100021
         SLL   TEMP2,2                                                  54200021
         AR    TEMP2,RNT               ADD TO FORM RNT ADDRESS          54300021
         OI    RNTFLAG(TEMP2),NODELETE   YES,SET FLAG ON IN RNT         54400021
*                                      SO THIS CAN'T BE DELETED         54500021
         L     TEMP2,REGSA5            RESTORE RNT ID                   54600021
REN1     EQU   *                                                        54700021
*              SAVE THE RNT ID FIELD                                  * 54800021
         LH    TEMP1,0(TEMP)                                            54900021
*              IS CONTROL SECTION PRESENT                               55000021
         TM    2(TEMP),X'01'                                            55100021
         BC    8,ESD33                                                  55200021
*              NO-BRANCH                                                55300021
*              IF RNT TYPE IS DELETE-BRANCH                             55400021
         TM    3(TEMP),X'50'                                            55500021
         BC    5,ESD31                                                  55600021
*              IF MATCH BIT IS ON-BRANCH                                55700021
         TM    INTERN1,X'02'                                            55800021
         BC    1,ESD32                                                  55900021
*              IF NOT-RENUMBER ID FIELD                                 56000021
         STH   TEMP1,14(ESDADD)                                         56100021
         BCR   15,INTERNAL                                              56200021
*              IF THE RNT TYPE IS DELETE -                              56300021
ESD32    BAL   RETURN,DBLDEF                                            56400021
ESD31    TM    INTERN1,LABELDEF                                         56500021
         BC    1,ESD44                                                  56600021
*              AND THE ESD TYPE IS LD - DONT ENTER THE LINE             56700021
*              IF IT IS AN LR -                                       * 56800021
         MVI   SUBTYPE(ESDADD),X'08'                                    56900021
         MVI   TESTYPE,2                                                57000021
         OI    ESDTYPE(ESDADD),X'10'                                    57100021
*              MAKE ESD TYPE ER MARKED DELETE                           57200021
         TM    INTERN1,X'0A'                                            57300021
*              IF IT IS A MATCHING SYMBOL, BRANCH TO  DELETE CHAIN    * 57400021
*              ROUTINE. IF NOT, STORE RNTID IN  BYTE 14 OF CESD LINE  * 57500021
         BC    8,ESD33A                                                 57600021
         BAL   RETURN,DELCHN                                            57700021
         BCR   15,INTERNAL                                              57800021
*                                                                       57900021
ESD33    EQU   *                                                OX00822 57950001
         OI    2(TEMP),X'02'                                    OX00822 58066701
*              SET DEPENDENCY BIT ON IN RNT LINE FOR SD                 58100021
         TM    INTERN1,X'02'                                            58200021
*              IF IT IS A MATCHING SYMBOL - BRANCH, IF NOT- SET UP    * 58300021
*              CHAIN OF LABELS                                        * 58400021
         BC    1,ESD35                                                  58500021
         STH   CESDID,0(TEMP)                                           58600021
         STH   TEMP1,12(ESDADD)                                         58700021
         TM    INTERN1,X'01'                                            58800021
         BC    8,ESD33B                                         ZA01413 58900037
         SR    TEMP2,TEMP2              CLEAR TEMP2                     59000021
         TM    INTERN1,MATCHER         DID THIS MATCH AN ER?            59100021
         BNO   ESD33A                  NO, BRANCH                       59200021
         O     TEMP2,FS                YES, IT CAN'T BE DELETED         59300021
         TM    CESDORG(CESDXR),X'80'   CHECK BLDL BIT           ZA01413 59400037
         BNO   ESD33A                  BRANCH IF NOT ON         ZA01413 59450037
         SLL   TEMP2,1                 MAKE FLAG EVEN IF ON     ZA01413 59500037
ESD33A   STH   TEMP2,14(ESDADD)                                         59600021
         BCR   15,INTERNAL                                              59700021
ESD33B   TM    INTERN1,MATCHER         DID LR MATCH ER          ZA01413 59750037
         BNO   ESD33A                  BRANCH IF NOT            ZA01413 59760037
         TM    CESDORG(CESDXR),X'80'   WAS BLDL ISSUED FOR ER   ZA01413 59770037
         BNO   ESD33A                  BRANCH IF NOT            ZA01413 59780037
         L     TEMP,REGSA5             GET INPUT ESD ID         ZA01413 59790037
         SLL   TEMP,2                  CALC RNT OFFSET          ZA01413 59792037
         AR    TEMP,RNT                POINT TO RNT ENTRY       ZA01413 59794037
         OI    RNTFLAG(TEMP),X'80'     KEEP BLDL BIT IN RNT     ZA01413 59796037
         B     ESD33A                  RESUME MAINLINE          ZA01413 59798037
ESD35    BAL   RETURN,DELCHN                                            59800021
         MVI   TESTYPE,2                                                59900021
*              MAKE LABEL AN ER  AND CHAIN IT TO THE MATCH            * 60000021
         STH   CESDID,0(TEMP)                                           60100021
         STH   TEMP1,12(ESDADD)                                         60200021
         BCR   15,INTERNAL                                              60300021
**********            THE DELCHN ROUTINE STARTS HERE         ********** 60400021
DELCHN   STH   CESDID,14(ESDADD)                                        60500021
*              STORE THE ID OF THE LINE IT IS CHAINED TO IN BYTES 14- * 60600021
*              15 OF THE LINE AND MARK TYPE DELETE-CHAIN              * 60700021
         OI    ESDTYPE(ESDADD),X'50'                                    60800021
**********            THE FREELINE ROUTINE STARTS HERE       ********** 60900021
FREELINE CLI   TESTYPE,PR     IS THIS ESD ITEM A PSEUDO REGISTER        61000021
         BE    NXTLINE    IF PSEUDO-REG USE NEW CESD LINE               61100021
* PSEUDO REGISTERS MUST BE IN THE ORDER OF APPEARANCE                   61200021
         L     CESDXR,FLCD                                              61300021
         LTR   CESDXR,CESDXR                                            61400021
*              IF THERE ARE NO LINES IN THE ENTRIES DELETED CHAIN,    * 61500021
*              GO TO NXTLINE TO SELECT CURRENT LINE+1                 * 61600021
         BC    8,NXTLINE                                                61700021
ESD37    L     TEMP3,12(CESDXR)                                         61800021
*              SET FIRST FREE LINE TO NEXT FREE LINE                  * 61900021
         ST    TEMP3,FLCD                                               62000021
*              IDCESD COMPUTES AN ID OF A CESD LINE GIVEN  AN ADDRESS * 62100021
IDCESD   LR    CESDID,CESDXR                                            62200021
         SR    CESDID,CESD                                              62300021
         SRL   CESDID,4                                                 62400021
         BCR   15,RETURN                                                62500021
*              NXTLINE INCREMENTS THE CURRENT CESD COUNT AND THEN     * 62600021
*              COMPUTES THE ADDRESS OF THE LINE(CESDXR)               * 62700021
NXTLINE  LH    CESDID,ENCDC                                             62800021
         LA    CESDID,1(CESDID)                                         62900021
         STH   CESDID,ENCDC                                             63000021
         LR    CESDXR,CESDID                                            63100021
         SLL   CESDXR,4                                                 63200021
         AR    CESDXR,CESD                                              63300021
         BCR   15,RETURN                                                63400021
COMMON   CLC   13(3,CESDXR),13(ESDADD)                                  63500021
*        IF CESD SIZE IS LESS,CHECK FOR SD TYPE CESD                    63600021
         BNL   ESD38                                                    63700021
         TM    CESDTYPE(CESDXR),X'0F'  IS CESD SD                       63800021
         BZ    COMMON1                                                  63900021
         MVC   13(3,CESDXR),13(ESDADD)                                  64000021
         B   ESD38                                                      64100021
COMMON1  LR    TEMP3,CESDXR                                             64200021
*                                 NAME OF COMMON.                       64300021
         LH    TEMP4,CMGTSD       GET ERROR CODE                        64400021
         L     SYSBRNCH,ERDIG     GIVE ERROR MESSAGE                    64500021
         BALR  14,15                                                    64600021
*              IF OVERLAY-PROMOTION TAKES PLACE IN COMMON PATH        * 64700021
ESD38    TM    PDSE7,OVBIT                                              64800021
         BCR   8,RETURN                                                 64900021
         TM    CESDTYPE(CESDXR),X'20'    IS INSERT BIT ON IN CESD       65000021
         BCR   1,RETURN                 YES. USE CESD SEG NO            65100021
         L     INTERNAL,ADDCPTH                                         65200021
         BCR   15,INTERNAL                                              65300021
DBLDEF1  LR    TEMP3,TEMP1             POINT TO DUPLICATE NAME    X3508 65400002
         BC    15,ESD39                                                 65500021
DBLDEF   LR    TEMP3,ESDADD                                             65600021
ESD39    EQU   *                                                        65700021
         LH    TEMP4,DLDEF                                              65800021
ESD39A   L     SYSBRNCH,ERDIG                                           65900021
         BALR  14,15                                                    66000021
         BCR   15,RETURN                                                66100021
TBLOFLOW LA    TEMP4,RNTOFLOW                                           66200021
         BC    15,ESD39A                                                66300021
ESDOFLOW LA    TEMP4,ESDOVFLW                                           66400021
         BC    15,ESD39A                                                66500021
**********            THE CESDDLNK ROUTINE STARTS HERE       ********** 66600021
CESDDLNK LH    RNTR,14(CESDXR)          LOAD WITH RNT POINTER           66700021
DLNK1    LR    TEMP3,CESDID                                             66800021
         L     SYSBRNCH,DELNKRT                                         66900021
         BALR  SYSRET,SYSBRNCH                                          67000021
         BCR   15,RETURN                                                67100021
INTERN1  DC    X'00'                                                    67200021
MATCHER  EQU   X'10'                   INTERN1 FLAG -- THIS             67300021
*                                      ENTRY MATCHED AN ER              67400021
NODELETE EQU   X'20'                   RNT FLAG -- THIS NAME            67500021
*                                      SHOULDN'T BE DELETED             67600021
DELETE   EQU   X'10'                   CESD TYPE DELETE FLAG            67700021
FS       DS    0F                                                       67800021
         DC    X'FFFFFFFF'             NEG FULLWORD FOR LD CHAIN        67900021
HEWLCTTY EQU   *                                                        68000021
TESTYPE  DC    X'00'                                                    68100021
CESDTTYP DC    X'00'                                                    68200021
ERR57    DC    X'2239'                 MSG NUMBER FOR MSG#562           68300021
ZERO3    DC    X'000000'               FOR CHECKING SD LENGTH           68400021
ADDCPTH  DC    V(HEWLCPTH)                                              68500021
ADDDECHN DC    V(HEWLCDCN)                                              68600021
RPCHGADD DC    V(HEWLFRCG)                                              68700021
DELNKRT  DC    V(HEWLCDLK)                                              68800021
ESD42    OI    INTERN1,COM                                              68900021
*              SET INTERNAL COMMON BIT ON AND MAKE ESD TYPE DELETE    * 69000021
         OI    ESDTYPE(ESDADD),X'10'                                    69100021
         BC    15,ENTER                                                 69200021
ESD43    LR    RNTR,TEMP                                                69300021
         LA    RETURN,ESD29A                                            69400021
*              CLEAR COMMON BIT AND SET UP FOR DELINKING              * 69500021
         NI    INTERN1,X'FB'                                            69600021
         OI    APT1,ESDWRITE                                            69700021
         BC    15,DLNK1                                                 69800021
ESD44    TM    INTERN1,X'0A'                                            69900021
         BC    4,ESD30                                                  70000021
         MVI   8(CESDXR),NULL                                           70100021
         BC    15,ESD30                                                 70200021
BADCARDO LA    TEMP3,0(0,ESDADD)                                        70300021
         SH    TEMP3,C16                                                70400021
         LH    TEMP4,ERR22                                              70500021
         BC    15,BADCRDL1                                              70600021
BADCARDL LA    TEMP4,ERR23                                              70700021
BADCRDL1 LA    RETURN,ESD30A0                                           70800021
         BC    15,ESD39A                                                70900021
REGSA4   DC    F'0'                                                     71000021
HEWLCRID EQU   *                                                        71100021
REGSA5   DC    F'0'                                                     71200021
REG24SA  DC    F'0'                                                     71300021
C56      DC    H'56'                                                    71400021
C240     DC    H'240'                                                   71500021
C16      DC    H'16'                                                    71600021
ERR22    DC   X'1216'                                                   71700021
DLDEF    DC    X'2118'                                                  71800021
SAVEAREA DC    F'0'                                                     71900021
CMGTSD   DC    X'2237'                                                  72000021
CLRBYT   DC    X'00'                                                    72100021
TSTBYT   DS    X                       WORK AREA                ZA01413 72150037
SAVETEMP DC    F'0'                     SAVE AREA FOR TEMP REG  OX00822 72160001
MAINTAIN DC    50F'0'                   MAINTENANCE AREA        OX00822 72170001
         HEWAPT                                                         72200021
         END                                                            72300021
