         TITLE 'HEWLFINT - LINKAGE EDITOR   ** INITIALIZER **'          00860401
HEWLFINT CSECT                                                          00860801
**********************************************************************  00862021
*154000-156500,164600-164700,171100-171440,458600-458700         S21016 00864021
*458800-458998                                                   S21016 00866021
*062600-062700,070100-070200,077600,153700,178100,333500-333900  S01904 00868021
*412500-413500,458720-458740                                     S01904 00868421
*070300-070420,153220,153800,542100                              Y01048 00868500
*046000,527500                                                   A47001 00868600
*093500                                                           M2199 00868700
*A146500                                SA51444                         00874900
*C415500                                SA51436                         00876900
*C123500,A275000,C277000-277500,C494000-502000                  SA47971 00878900
*D503000,C503500                                                SA47971 00880900
*A064500,C117700,A120500,C151000,A151000,D514100-514200,        SA49330 00881300
*A515000,C515500,A515500,A543500                                SA49330 00892700
*D121500-122000                                                 OY00129 00902701
*D009158,A009372-009376,A494600-494700,A495600-495700           OX00127 00903101
*A314600-314800,A316000-318000,D316000-320500,A334600           OY00338 00903501
*D064600,A064600-064920,C120540,A120560-120980,D151000-151100   OY00130 00903901
*D151300-151666,I528600-528900,D543600-543700,A543600-543740    OY00130 00904301
*A117720,C117750,C117800,D118000                                OY00136 00908101
*C515420-515440                                                 OY00227 00910101
*D063500-064000,D117600-117650,C399500-402000,D402500-403500    OY00359 00912101
*C405500-406000,C413500                                         OY00359 00912501
*C499500,A500100-500440,A500600-501000                           YM5584 00914501
*C155500-156000                                                  XM1641 00914902
*A440600                                                         XM5473 00915303
*A458944-458956                                                 OX04245 00915702
*I496000                                                OX03511,OY03041 00917702
*I146500                                                OX03507,0Y03040 00919702
*I064920,I515600,D516200                                OX04281,OY03412 00921702
*C333701                                              @ZA04726,@YA09265 00922137
*C449000                                                       @ZA05444 00922337
*C515120                                                       @ZA07598 00922537
*C495500                                                       @ZA07605 00922737
*A21951000-21953000      SYSPRINT BLOCKING                     @ZA16058 00922837
*C117500,117700,495700,499000,499200 D493500 A499100,499500    @ZA33269 00922937
       EJECT                                                            00923337
**********************************************************************  00923402
         USING HEWLFINT,SYSBRNCH                                        00927200
* STATUS CHANGE LEVEL - 002     DATE - 01/19/73                         00937201
*                                                                       00937601
*FUNCTION/OPERATION: THIS MODULE IS THE SECOND TO BE ENTERED IN THE   * 00938600
*      LINK EDITOR. IT OPENS THE FOLLOWING DDNAMES- SYSLMOD,SYSLIN,   * 00950021
*      AND SYSPRINT.  IT THEN ALLOCATES STORAGE TO LINK EDITOR        * 01000021
*      TABLES DEPENDENT UPON THE STORAGE AVAILABLE AT THE TIME.       * 01050021
*      IT CLEARS OUT THE ALL PURPOSE TABLE AND THE TABLE AREA WHICH   * 01100021
*      IT ALLOCATES. IT SETS UP THE PDS DIRECTORY INDICATORS TO       * 01150021
*      THEIR INITIAL VALUES.                                          * 01200021
*      IF THE NAME CARD IS USED, IT WILL RE-INITIALIZE FOR A NEW      * 01250021
*      RECURSION THROUGH LINK EDITOR.                                 * 01300021
*                                                                     * 01350021
*                                                                     * 01400021
*ENTRY POINTS  HEWLFINT - BEGINNING OF  LINK EDITOR  LA REG13,SAVEAREA* 01450021
*                                                    L  REG1,POINTER  * 01500021
*                                                      TO LIST        * 01550021
*                                                    BALR 14,15       * 01600021
*              HEWLENAM - RECURSIVE ENTRY FOR SECOND LINK EDIT        * 01650021
*                                                    BCR 15,15        * 01700021
*                                                                     * 01750021
*                                                                     * 01800021
*INPUT:  THE ADDRESS OF A PARAMETER LIST IS PASSED FROM INITIATOR IN  * 01850021
*        REGISTER ONE. THE LIST CONTAINS THE ADDRESS OF THE           * 01900021
*        PARAMETER BYTE COUNT AND POSSIBLY THE ADDRESS OF A LIST      * 01950021
*        OF DDNAMES                                                   * 02000021
*        THE FIRST IS USED TO OBTAIN THE PARM FIELD OF THE            * 02050021
*        EXECUTE CARD. THE BYTE COUNT IDENTIFIES THE NUMBER OF BYTES  * 02100021
*        OF PARM INFORMATION WHICH FOLLOWS.                           * 02150021
*                                                                     * 02200021
*                                                                     * 02250021
*OUTPUT: THE ADDRESSES AND MAXIMUM ENTRY COUNTS FOR ALL LINK EDITOR   * 02300021
*        VARIABLE TABLES                                              * 02350021
*                                                                     * 02400021
*                                                                     * 02450021
*EXTERNAL ROUTINES  HEWLFLOG- WRITE ERROR CODE                          02500021
*                   HEWLFOPT- PROCESSES PARM FIELD OF EXEC CARD         02550021
*                                                                     * 02600021
*                                                                     * 02650021
*EXITS-NORMAL   AFTER INITIALIZATION IS COMPLETE, TO HEWLFINP TO      * 02700021
*               INITIATE PROCESSING                                   * 02750021
*                                                                     * 02800021
*EXITS-ERROR: IF A DDNAME CANNOT BE OPENED ERROR 28,SEVERITY 4 IS     * 02850021
*             PASSED TO HEWLFLOG.                                     * 02900021
*             IF THE MINIMUM CORE CANNOT BE OBTAINED, ERROR 29,       * 02950021
*             SEVERITY 4 IS PASSED TO HEWLFLOG.                       * 03000021
*                                                                     * 03050021
*TABLES/WORK AREAS:                                                     03100021
*                                                                     * 03150021
*        TABLE IS USED BY THE ALLOCATOR ROUTINE TO ASSIGN AREAS IN    * 03200021
*        GOTTEN STORAGE TO THE VARIABLE TABLES OF THE PROGRAM.        * 03250021
*        EACH ENTRY CONTAINS 8 SWITCHES IN ONE BYTE DENOTING, FOR     * 03300021
*        EXAMPLE, WHICH PASSES USE THE TABLE; AN INCREMENT TO WHICH   * 03350021
*        156 MUST BE ADDED TO DETERMINE THE ADDRESS IN THE ALL PURPOSE* 03400021
*        TABLE AT WHICH THE DETERMINED ADDRESS OF THE TABLE IS TO BE  * 03450021
*        STORED; A SIMILAR INCREMENT FOR THE NUMBER OF ENTRIES IN THE * 03500021
*        TABLE; THE NUMBER OF BYTES IN EACH ENTRY OF THE TABLE;       * 03550021
*        THE WEIGHT FACTOR OF THE TABLE FOR PURPOSES OF EXPANSION;    * 03600021
*        AND THE MINIMUM SIZE OF THE TABLE.                             03650021
*                                                                     * 03700021
*ATTRIBUTES: REUSABLE                                                 * 03750021
*                                                                     * 03800021
*NOTES: N/A                                                           * 03850021
*                                                                     * 03900021
DDNAME   EQU   40                                                       03950021
         EXTRN HEWLFAPT                                                 04000021
         EXTRN APTEXLST                                                 04050021
         EXTRN HEWLCSDB                                                 04100021
         EXTRN HEWLCMDB                                                 04150021
         EXTRN HEWLCUDB                                                 04200021
         EXTRN HEWLCPDB                                                 04250021
         EXTRN HEWLTMDB                                                 04300021
         ENTRY HEWLENAM                                                 04350021
         ENTRY HEWLXIT2                SYSLMOD OPEN EXIT                04400021
         EXTRN APTXLIST                SYSLMOD EXIT LIST                04450021
         ENTRY MAINGOT                                                  04500021
         EXTRN     ENQNAME                                              04550021
         EXTRN     MINOR                                                04600021
         EXTRN     INDDNAME                                      A47001 04610000
         ENTRY MSGFOUR                                                  04650021
DDNAMEOF EQU   40                                                       04700021
BASE     EQU   12                                                       04750021
REG1     EQU   1                                                        04800021
SYSBRNCH EQU   15                                                       04850021
REG3     EQU   3                                                        04900021
REG4     EQU   4                                                        04950021
LEN4     EQU   4             REG 4 FOR SYSLMOD ADJUST SIZE              05000021
REG7     EQU   7                                                        05050021
REG8     EQU   8                                                        05100021
REG11    EQU   11                                                       05150021
REG10    EQU   10                                                       05200021
REG5     EQU   5                                                        05250021
LEN5     EQU   5             REG 5 FOR TEXT BUFFER ADJUST USE           05300021
ZERO     EQU   0                                                        05350021
REG13    EQU   13                                                       05400021
REG14    EQU   14                                                       05450021
REG9     EQU   9                                                        05500021
OPENBIT  EQU   X'10'                                                    05550021
OPENFLAG EQU   48                                                       05600021
SYSRET   EQU   14                                                       05650021
LEN6     EQU   6                                                        05700021
SYSTERM  EQU   5                                                        05750021
SYSPRINT EQU   6                                                        05800021
TCBTSTSK EQU   X'80'       TIME SHARING FLAG IN TCBTSFLG FIELD          05850021
SYSLIN   EQU   7                                                        05900021
SYSLMOD  EQU   8                                                        05950021
SYSUT1   EQU   9                                                        06000021
TERMOFF  EQU   X'FD'                   TERM OPTION TURNED OFF           06050021
TSO      EQU   X'80'                   TSO SWITCH IN APTSWS             06100021
TERM     EQU   X'02'                   TERM SWITCH IN NEWSW             06150021
SNGLIN   EQU   X'01'                   SWITCH FOR 1 LINE OF OPTS.       06200021
DCBS     EQU   X'10'                   DCBS SWITCH                      06250021
AOSLE    EQU   X'80'                   PDSE12, RUN UNDER AOS     S01904 06260021
THREE    EQU   3                       LENGTH OF THREE BYTES     S01904 06270021
APT      EQU   2                                                        06300037
REG15    EQU   15                                                       06450021
TIOTPTR  EQU   14                       POINTER TO TIOT         OY00130 06460001
UCBPTR   EQU   TIOTPTR                  POINTER TO UCB          OY00130 06470001
LNTHDD   EQU   15                       LENGTH OF DD ENTRY      OY00130 06480001
BINNO    EQU   LNTHDD                   BIN NUMBER (2321)       OY00130 06490001
D2321    EQU   X'05'                    CODE FOR 2321 DEVICE    OY00130 06492001
STOWBIT  EQU   X'80'                   STOW DONE FLG    OX04281,OY03412 06494002
CIND2    EQU   X'3D'                   FLG DISP IN DCB  OX04281,OY03412 06496002
         EJECT                                                          06498037
         STM   14,12,12(REG13)                                          06500021
*              SAVE CALLERS REGISTERS                                 * 06550021
        BALR  BASE,0                                                    06600021
         USING *,BASE                                                   06650021
         BC    15,OVERNAME         TO AVOID THE NAME IDENTIFIER         06700021
DATE     DC    C'&SYSDATE OZ33269'  DATE/APAR NUMBER                    06750037
         DC    C'HEWLFINT',0H'0'    MOD ID                              06780037
         EJECT                                                          06810037
OVERNAME L     APT,APTADD                                               06850037
*              LOAD REGISTER 2 WITH APT ADDRESS                       * 06900021
         USING APTDSECT,APT        ESTABLISH ADDRESSABILITY WITH APT    06950021
         USING DEFDSECT,RWORK2                                          07000021
         XC    PDSE12(THREE),PDSE12    ZERO OUT SWITCHES         S01904 07010021
         OI    PDSE12,AOSLE            BIT FOR AOS LKED          S01904 07020021
         OI    PDSE12,PDSAPFLG         SET AUTH CODE BIT         Y01048 07030000
         MVC   PDSAPF,APFINIT          INITIALIZE AUTHORIZATION  Y01048 07040000
         MVC   APTAPF,APFINIT          CODES-LGTH=1,CODE=0       Y01048 07042000
         STM   13,14,SYSRTN                                             07050021
*              SAVE SYSTEM RETURN AND SAVE AREA ADDRESS               * 07100021
         LA    REG13,REGSA         LOAD REG13 WITH ADDRESS OF           07150021
*                                       SAVE AREA                     * 07200021
         XC    HISEV(2),HISEV CLEAR THE HI SEVERITY CODE                07250021
         NI    SWITCH,X'00'        TURN OFF ALL BIT SWITCHES            07300021
         L     REG3,0(0,REG1)                COMPUTE THE ADDRESS OF THE 07350021
         LA    REG3,0(0,REG3)                BYTE COUNT FOR ATTRIBUTES  07400021
         ST    REG1,REGSAVE1      SAVE PARM REG                         07450021
         LR    REG1,REG3                                                07500021
         NI    PDSE7,ZERO                                               07550021
         NI    PDSE8,ZERO                                               07600021
         OI    PDSE8,X'82'   SET 44K LE BIT ON AND DC OPT OFF           07650021
         NI    APT0,ZERO                                                07700021
         NI    APTSWS,SWSINIT          INITIALIZE                       07750021
*                                      BIT 0 & 2-4                      07752021
         NI    APT4,ZERO               INITIALIZE APT4          S01904  07760021
         L     SYSBRNCH,ATOPTADD                                        07800021
         BALR  SYSRET,SYSBRNCH                                          07850021
CONTIN   L     REG1,REGSAVE1                                            07900021
         LM    SYSTERM,SYSUT1,DCBADRS1                                  07950021
*              MOVE STANDARD DDNAMES                                  * 08000021
         MVC   DDNAMEOF(8,SYSLIN),SYSLINNM   MOVE SYSLIN DDNAME         08050021
         MVC   DDNAMEOF(8,SYSLMOD),SYSLMDNM  MOVE SYSLMOD DDNAME        08100021
         MVC   DDNAMEOF(8,SYSUT1),SYSUT1NM   MOVE SYSUT1 DDNAME         08150021
         MVC   DDNAMEOF(8,SYSPRINT),SYSPRTNM MOVE SYSPRINT DDNAME       08200021
         MVC   DDNAMEOF(8,SYSTERM),SYSTRMNM  MOVE SYSTERM DDNAME        08250021
         MVC   LIBNAME(8),SYSLIBNM MOVE SYSLIB DD NAME                  08300021
         TM    0(REG1),X'80'            ARE DDNAMES PASSED              08350021
         BC    1,INT20                  NO- BRANCH                      08400021
         L     REG3,4(0,REG1)           ADDRESS OF DDNAMES BYTECOUNT    08450021
         NI    1(REG3),X'F8'      ROUND COUNT MODULO 8                  08500021
         LH    REG4,0(0,REG3)           BYTE COUNT OF DDNAMES IN REG4   08550021
         LTR   REG4,REG4                ARE DDNAMES PASSED              08600021
         BC    8,INT20                  NO-BRANCH                       08650021
         LA    REG3,2(REG3)             ADDRESS OF DDNAMES              08700021
         EXTRACT  INITEXAD,'S',FIELDS=(TSO)  TEST IF TSO                08750021
         ST    REG4,XTRTSAVE       SAVE REG.4                           08800021
         L     REG4,INITEXAD         GET @ OF TSO FIELD                 08850021
         LTR   REG4,REG4             WAS TSO DEFINED                    08900021
         BZ    TSO2                  NO. BRANCH                         08950021
         TM    0(REG4),TCBTSTSK      YES. IS IT TS TASK                 09000021
         BNO   TSO2                  NO. DONT SET TSO FLAG              09050021
         OI    APTSWS,TSO            TURN ON TSO FLAG                   09100021
TSO2     L     REG4,XTRTSAVE         RESTORE REG4                       09150021
         LA    SYSBRNCH,TEST         @ OF DDNAME TEST                   09200021
         LA    REG4,0(REG3,REG4)        REG4 CONTAINS END ADDRESS       09250021
         BALR  SYSRET,SYSBRNCH          TEST DDNAME                     09300021
         MVC   DDNAMEOF(8,SYSLIN),0(REG3) MOVE SYSLIN DDNAME            09350021
         L     REG10,INDDNMAD       GET SYSLIN DDNAME SAVAREA     M2199 09360000
         MVC   0(8,REG10),0(REG3)   SAVE SYSLIN DDNAME            M2199 09370000
         LA    REG3,8(REG3)             INCREMENT COUNT                 09400021
         CLR   REG3,REG4                IS LOOP DONE                    09450021
         BC    11,INT20                 YES-BRANCH                      09500021
         BALR  SYSRET,SYSBRNCH          TEST MEMBER NAME                09550021
         BC    15,INT19                 BRANCH TO SET MEMBER NAME BIT   09600021
         BCR   0,0                      PADDING                         09650021
INT01    LA    REG3,8(REG3)             INCREMENT COUNT                 09700021
         CLR   REG3,REG4                IS LOOP DONE                    09750021
         BC    11,INT20                 YES-BRANCH                      09800021
         BALR  SYSRET,SYSBRNCH          TEST DDNAME                     09850021
         MVC   DDNAMEOF(8,SYSLMOD),0(REG3) MOVE SYSLMOD DDNAME          09900021
         BALR  SYSRET,SYSBRNCH     DO IT AGAIN                          09950021
         MVC   ACTVLMOD(8),0(REG3) SAVE ACTIVE LMOD DDNAME              10000021
         LA    REG3,8(REG3)             INCREMENT COUNT                 10050021
         CLR   REG3,REG4                IS LOOP DONE                    10100021
         BC    11,INT20                 YES-BRANCH                      10150021
         BALR  SYSRET,SYSBRNCH          TEST DDNAME                     10200021
         MVC   LIBNAME(8),0(REG3)  MOVE SYSLIB DDNAME                   10250021
         LA    REG3,16(REG3)            INCREMENT COUNT                 10300021
         CLR   REG3,REG4                IS LOOP DONE                    10350021
         BC    11,INT20                 YES-BRANCH                      10400021
         BALR  SYSRET,SYSBRNCH          TEST DDNAME                     10450021
         MVC   DDNAMEOF(8,SYSPRINT),0(REG3) MOVE SYSPRINT DDNAME        10500021
         LA    REG3,16(REG3)            INCREMENT COUNT                 10550021
         CLR   REG3,REG4                IS TABLE DONE                   10600021
         BC    11,INT20                 YES-BRANCH                      10650021
         BALR  SYSRET,SYSBRNCH          TEST DDNAME                     10700021
         MVC   DDNAMEOF(8,SYSUT1),0(REG3)  MOVE SYSUT1 DDNAME           10750021
         BALR  SYSRET,SYSBRNCH     DO IT AGAIN                          10800021
         MVC   ACTVUT1(8),0(REG3)  SAVE ACTIVE UT1 DDNAME               10850021
         LA    REG3,32(REG3)       INCREMENT ADDRESS                    10900021
         CLR   REG3,REG4           LOOP DONE ?                          10950021
         BC    11,INT20            YES - BRANCH                         11000021
         BALR  SYSRET,SYSBRNCH     TEST DDNAME                          11050021
         MVC   DDNAMEOF(8,SYSTERM),0(REG3)                              11100021
         BC    15,INT20                 DONE                            11150021
INT19    OI    APTEMP+8,X'80'     SET MEMBER NAME RECEIVED TEMP BIT     11200021
         MVC   APTEMP(8),0(REG3)  MOVE MEMBER NAME TO TEMP STORAGE      11250021
         BC    15,INT01                 BRANCH BACK IN-LINE             11300021
TEST     NC    0(8,REG3),0(REG3)        IS FIELD ZERO                   11350021
         BC    8,6(SYSRET)              YES BRANCH TO 6 PLUS RETURN     11400021
         BCR   15,SYSRET                RETURN                          11450021
INT20    DEVTYPE  ACTVLMOD,DEVSAVE   FIND SYSLMOD BLOCK SIZE            11500021
         MVC   EXITTEST(2),DEVMAXBS+2  SAVE IT FOR EXIT ROUTINE         11550021
         GETMAIN  EU,LV=200,A=MAINGOT                                   11600021
         L     1,ADDRIND                                                11650021
         MVC   5(3,1),MAINGOT+1                                         11700021
         RDJFCB MF=(E,DCBADRS2)                                         11750021
JFCBIND2 EQU   X'57'                   D'PLACEMENT IN JFCB     @ZA33269 11755037
         MVI   APTSW2,X'00'            TURN OFF FIRST BIT A49330,A37663 11760037
         L     1,MAINGOT               POINT TO JFCB            OY00136 11765037
         TM    JFCBIND2(REG1),X'08'    TEST IF DISP=SHR        @ZA33269 11770037
         BO    SKIPSET                 YES, DON'T ENQ           OY00136 11780001
         OI    APTSW2,ENQBIT           YES - TURN ON FIRST BIT   A37663 11785000
SKIPSET  EQU   *                                                 A37663 11790000
*  MOVES DSNAME TO MINOR NAME POSITION FOR ENQ                          11850021
         ST    REG3,TEMP                                                11900021
         L     REG3,=V(MINOR)                                           11950021
         MVC   0(44,REG3),0(1)                                          12000021
         L     REG3,TEMP                                                12050021
         TM    DEVCODE+1,SHRSYSMD      IS SYSLMOD SHRD DASD     SA49330 12052000
         BZ    CHKENQ                  BRANCH IF ON             OY00130 12054001
         EXTRACT INITEXAD,'S',FIELDS=(TIOT)                     OY00130 12056001
*                                      GET TIOT POINTER                 12058001
         L     TIOTPTR,ADDRTIOT        PICK UP TIOT ADDRESS     OY00130 12058401
         USING TIOT,TIOTPTR                                     OY00130 12058801
         SR    LNTHDD,LNTHDD           CLEAR DD LENGTH REG      OY00130 12059201
TIOTLP   CLI   TIOELNGH,X'00'          END OF TIOT REACHED      OY00130 12059601
         BE    SKIPENQ                 YES, LET OPEN CATCH IT   OY00130 12059701
         CLC   TIOEDDNM,ACTVLMOD       SYSLMOD ENTRY FOUND      OY00130 12059801
         BE    UCBPRCS                 YES, BRANCH TO PROCESS   OY00130 12059901
         IC    LNTHDD,TIOELNGH         GET LENGTH OF DD ENTRY   OY00130 12063201
         AR    TIOTPTR,LNTHDD          POINT TO NEXT DD ENTRY   OY00130 12065201
         B     TIOTLP                  REPEAT FOR NEXT ENTRY    OY00130 12065601
UCBPRCS  EQU   *                                                OY00130 12066001
         LA    REG4,TIOEFSRT-1         PICK UP PTR TO UCB PTR   OY00130 12066402
         DROP  TIOTPTR                                          OY00130 12066501
         OI    APTSW2,SHRSYSMD         INDICATE SHARED SYSLMOD  OY00130 12096601
         RESERVE (ENQNAME,MINOR,E,44,SYSTEMS),UCB=(REG4)        OY00130 12097002
*                                      RESERVE SYSLMOD DEVICE   OY00130 12097401
         B     SKIPENQ                 RETURN TO MAIN FLOW      OY00130 12097801
CHKENQ   EQU   *                       RESERVE BYPASS           OY00130 12098001
         TM    APTSW2,ENQBIT           DISP=OLD ON SYSLMOD?      A37663 12098101
         BO    SKIPENQ                 YES - DON'T ENQUEUE       A37663 12105401
         ENQ   (ENQNAME,MINOR,E,44,SYSTEM)                              12112701
SKIPENQ  EQU   *                                                 A37663 12120000
         L     1,MAINGOT                                                12250021
         MVC   OVERRIDE(2),102(1)   SAVE OVER/RIDE                      12300021
         XC    102(2,1),102(1)        CLEAN OUT JFCB            SA47971 12350000
         OPEN  MF=(E,DCBADRS2),TYPE=J                                   12400021
NOOR     FREEMAIN  E,LV=200,A=MAINGOT                                   12450021
         NI    APTSWS,X'EF'          TURN OFF OVER-RIDE SWITCH          12500021
         USING IHADCB,SYSPRINT                                          12550021
         MVC   PRNTNAME(8),DCBDDNAM                                     12600021
         MVC   NAMEDD(8),DCBDDNAM                                       12650021
         DROP  SYSPRINT                                                 12700021
         DEVTYPE  PRNTNAME,ANSWER                                       12750021
         LTR   REG15,REG15                                              12800021
         BNZ   ABENT10            BRANCH IF DEVTYPE UNSUCCESSFUL        12850021
         TM    ANSWER+2,X'A0'                                           12900021
         BM    BLKGOK                                                   12950021
         LA    REG15,MSG4                                               13000021
         ST    REG15,MSGFOUR                                            13050021
         MVI   MSGFOUR,49                                               13100021
*********************************************************************** 13120037
*      OPEN   ((SYSPRINT),(OUTPUT),(SYSLIN),(INPUT),(OUTPUT))         * 13140037
*********************************************************************** 13160037
BLKGOK   LA    1,DCBADRS4                                               13200021
         TM    NEWSW,TERM         TERM SPECIFIED?                       13250021
         BZ    TSO3               NO - BRANCH                           13300021
         LA    1,DCBADRS1                                               13350021
TSO3     OPEN  MF=(E,(1))          OPEN DATA SETS                       13400021
         TM    OPENFLAG(SYSPRINT),OPENBIT                               13450021
         BC    8,ABENT10                                                13500021
         TM    HEWLCWBB+24,X'04'       WAS ERROR DETECTED               13550021
         BC    1,ABENT2A               YES, BLKSIZE TOO LARGE           13600021
         TM    NEWSW,TERM              TERM OPTION SPECIFIED?           13650021
         BZ    TSO5                    NO - CONTINUE                    13700021
         TM    OPENFLAG(SYSTERM),OPENBIT  OPEN ERROR?                   13750021
         BC    1,TSO5                  NO - CONTINUE                    13800021
         NI    NEWSW,TERMOFF           YES--TURN OFF TERM OPTION        13850021
TSO5     TM    OPENFLAG(SYSLIN),OPENBIT  OPEN ERROR?                    13900021
         BC    1,INTSET                                                 13950021
         OI    INTERN1,1                                                14000021
         MVC   DDSAV(8),DDNAME(SYSLIN)                                  14050021
INTSET   OI    OPENFLAG(SYSLIN),X'08'  TURN ON UNLIKE ATTRIBUTES        14100021
INT20A   BALR  BASE,0                                                   14150021
         USING *,BASE                                                   14200021
         OI    PDSE7,X'02'     SET EXECUTABLE BIT ON                    14250021
         OI    PDSE8,X'70'     SET NO RLD 1 TXT BITS                    14300021
         MVC   SAVATS(2),PDSE7     SAVE ATTRIBUTES                      14350021
         MVC   SAVATS+2(1),APT0                                         14400021
         BCR   15,0                                                     14450021
         MVI   SPACES,54           LINE COUNT IS 54 FIRST TIME          14500021
         BC    15,INT21                                                 14550021
         DROP  BASE                                                     14600021
HEWLENAM MVI   SPACES,1            LINE COUNT IS 1 SECOND TIME          14650021
         MVI   LIBOPEN,C' '            FORCE LIB REOPEN OX03507,OY03040 14652002
         OI    APTSW2,REINTRY           SET NOT FIRST TIME THRU SA51444 14660000
INT21    BALR  BASE,0                                                   14700021
         USING *,BASE                                                   14750021
         TM    INTERN1,1               OPEN ERROR                       14800021
         BC    1,INT22                 YES BRANCH                       14850021
         LA    REG13,REGSA         ADDRESS OF SAVE AREA                 14900021
         OPEN  MF=(E,DCBADRS2)     OPEN SYSLMOD                         14950021
         L     SYSLMOD,DCBADRS2        LOAD ADDR. OF SYSLMOD            15000021
INT21A   TM    OPENFLAG(SYSLMOD),OPENBIT                                15050021
         BO    INT22                    BRANCH IF NOT           SA49330 15120000
         OI    INTERN1,1                                                15183300
         MVC   DDSAV(8),DDNAME(SYSLMOD)                                 15200021
INT22    EQU   *                                                        15250021
         SPACE 1                                                 S21016 15300021
********** CLEAR ALL PORTIONS OF THE ALL PURPOSE TABLE **********S21016 15310021
**********     THAT ARE NOT INITIALIZED ELSEWHERE      **********S21016 15320021
         MVC   PDSAPF,APTAPF           REAL CODE=DEFAULT         Y01048 15322000
         XC    PDSE1(APT3-PDSE1),PDSE1 CLEAR PDSE1 TO APT3       S21016 15340021
         NI    APT3,X'01'                    CLEAR APT3 EXCLDG BIT 7    15350021
         OI    PDSE12,AOSLE            BIT FOR AOS LINKEDIT      AOSCD  15370021
         OI    PDSE12,PDSAPFLG         SET AUTH CODE BIT         Y01048 15380000
         XC    CTTR(SGT1-CTTR),CTTR    CLEAR CTTR TO SGT1        S21016 15400021
         XC    BITMAP(HISEV-BITMAP),BITMAP CLEAR BITMAP TO HISEV S21016 15450021
* DO NOT CLEAR THE HIGHEST SEVERITY CODE                                15500021
         XC    INCBRKPT(ENRNX-INCBRKPT),INCBRKPT CLEAR INCBRKPT  XM1641 15550002
*                                                TO ENRNX        XM1641 15600002
         XC    ENSPX(ORDRMAX-ENSPX),ENSPX CLEAR ENSPX TO ORDRMAX S01904 15610000
         MVC   REGSA+5(3),SYSRTN+1 SAVE POINTER BACK                    15650021
         LH    RWORK2,ENRNX           GET MAX ENTRIES IN RNT    OX02397 15660003
         STH   RWORK2,ENRNC           STORE IN CURRENT          OX02397 15670003
*                                     CURRENT MUST ALWAYS       OX02397 15680003
*                                     EQUAL MAX FOR RNT DUE TO  OX02397 15690003
*                                     LR PROCESSING             OX02397 15692003
         SPACE 2                                                        15700021
R0       EQU   0                                                        15750021
RPARAM   EQU   1                      PARAMETER REGISTER                15800021
RINDEX   EQU   3                      INDEX REGISTER                    15850021
RWORK2   EQU   4                     WORK REGISTERS                     15900021
RWORK3   EQU   5                                                        15950021
RWORK4   EQU   6                                                        16000021
RWORK5   EQU   7                                                        16050021
RWORK9   EQU   9                                                        16100021
NUMBGROS EQU   9                      NUMBER OF GROWS POSSIBLE          16150021
RWORK6   EQU   10                                                       16200021
TABLLIST EQU   11                     GPR USED TO ADDRESS LIST OF TABLS 16250021
RBASE    EQU   12                     BASE REGISTER                     16300021
RSAVE    EQU   13                     POINTER TO SAVE AREA              16350021
RRETURN  EQU   14                     RETURN REGISTER                   16400021
RLINK    EQU   15                     LINKAGE REGISTER                  16450021
PTRLEN   EQU   4                       LENGTH OF A FOUR-BYTE     S21016 16460021
*                                      ADCON FOR USE IN A MOVE   S21016 16470021
OVERBIT  EQU   X'20'                  BIT TESTED FOR OVERLAY            16500021
LOWZEROS EQU   X'07'                  TEST FOR DOUBLE                   16550021
LOWZERO  EQU   X'03'                           SINGLE WORD ALIGNMENT    16600021
ENDFLAG  EQU   X'FF'                  END FLAG FOR LIST                 16650021
SWITCHES EQU   0                      INCREMENT IN LIST ENTRY OF SWTCHS 16700021
OVERLAY  EQU   X'80'                  BIT DENOTING OVERLAY TABLE        16750021
FIRSTPAS EQU   X'40'                               FIRST PASS TABLE     16800021
INTERPAS EQU   X'20'                               INTERMED. PASS TABLE 16850021
SECONDPS EQU   X'10'                               SECOND PASS TABLE    16900021
DBLWORDB EQU   X'08'                               DBL WORD BOUNDARY    16950021
WORDBNDR EQU   X'04'                               SGL                  17000021
CUTOFF   EQU   X'02'                               SPECIAL PROCESSING   17050021
ZERONTRY EQU   X'01'                               ZEROTH ENTRY PROV    17100021
SWSOFF   EQU   X'00'                   IMMEDIATE BYTE TO         S21016 17110021
*                                      INIALIZE A BYTE OF        S21016 17120021
*                                      SWITCHES TO ZEROES        S21016 17130021
SWSINIT  EQU   X'47'                   IMMEDIATE BYTE TO         S21016 17140021
*                                      INITIALIZE APTSWS BITS    S21016 17142021
*                                      0,2,3 & 4 TO ZEROES       S21016 17144021
ADDRINCR EQU   1                                         ADDR INCREMENT 17150021
ENTRINCR EQU   2                                         ENTR           17200021
BYTSENTR EQU   3                                         WEIGHT         17250021
WEIGHT   EQU   4                                         MINIMUM SIZE   17300021
MINSIZE  EQU   6                                                        17350021
ENTRYSIZ EQU   8                      SIZE OF LIST ENTRY                17400021
DC       EQU   X'80'                                                    17450021
FRSTIME  EQU   X'80'                                                    17500021
HIAROPT  EQU   X'04'               HIARCHY BIT IN NEWSW IN APT          17550021
ERRORTN  EQU   X'DC'                                                    17600021
BADLIN   EQU   X'43B'                                                   17650021
         EJECT                                                          17700021
         L     RWORK2,DEFVCON      FETCH ADDR OF HEWLFDEF               17750021
         L     REG1,VALUE1         FETCH MAX MAIN STOR AVAILABLE        17800021
         S     REG1,LLEGF64                                      S01904 17810021
PREPGM   EQU   *                                                        18250021
         ST    REG1,MAXSTOR        AND PLACE IN GETMAIN MAX REQ         18300021
         MVC   TOTWT(8),NORMWT        SET                               18350021
         TM    SAVATS,OVERBIT      TEST SAVED BIT FOR OVERLAY OPT       18400021
         BC    8,ALL001               NONE, CONTINUE                    18450021
         MVC   TOTWT(8),OVLAYWT       YES, RESET PARAMETERS             18500021
         MVI   ALL010SW+1,X'00'      SET SWITCH TO KEEP OVERLAY TABLES  18550021
ALL001   EQU   *                                                        18600021
         LH    RWORK2,DUMHRWT      FETCH DUMMY HIAR TABLE WEIGHT        18650021
         LH    REG10,DUMHRMN       FETCH DUMMY HIAR TABLE MIN BYTES     18700021
         TM    NEWSW,HIAROPT  TEST HIAR BIT                             18750021
         BC    8,ALL002            NO, CONTINUE                         18800021
         MVC   TOTWT(8),HIARWT     YES, RESET PARAMETERS                18850021
         LH    RWORK2,WEIGHTHR     FETCH TRUE HIAR TABLE WEIGHT         18900021
         LH    REG10,MINBTHR       FETCH TRUE HIAR TABLE MIN BYTES      18950021
ALL002   EQU   *                                                        19000021
         STH   RWORK2,HIARSLOT+4   PLACE HIAR WEIGHT IN ALLOCATION TAB  19050021
         STH   REG10,HIARSLOT+6    PLACE HIAR MIN BT IN ALLOCATION TAB  19100021
         TM    NEWSW,FRSTIME       IS THIS THE FIRST TIME IN INT        19150021
         BC    8,FSTENTRY          BRANCH IF 1ST TIME THRU              19200021
REUSSW   BC    0,GOODLIN      DUMMY BR FOR REUSABILITY                  19250021
         MVI   REUSSW+1,X'F0'      MAKE IT UNCOND IF LE IS KLUDGE       19300021
         L     RWORK3,MAINREQ      FETCH MINIMUM MAIN STOR REQ          19350021
         S     RWORK3,BUFCON       SUBTRACT MIN BUFFER AREA REQ         19400021
         ST    RWORK3,MAINREQ      REPLACE MINIMUM MAIN STOR REQ        19450021
         BC    15,GOODLIN          BYPASS ALL TABLE ALLOCATION          19500021
FSTENTRY EQU   *                                                        19550021
         NI    APT3,X'00'                    CLEAR APT3 IF 1ST TIME TH  19600021
         GETMAIN VU,LA=MAINREQ,A=MAINGOT                                19650021
*        GET AS MUCH STORAGE AS POSSIBLE                                19700021
         MVC   COREADR(8),MAINGOT  SAVE FOR ERROR FREEMAIN              19750021
         L     RWORK3,MAINLEN         LOAD LENGTH OF AREA RECEIVED      19800021
         L     REG10,MAINLEN       FETCH RETURNED LENGTH                19850021
         S     REG10,MAINREQ       REDUCE BY REQUIREMENT                19900021
         AH    REG10,TXT6K         BUT ADD IN TXT BUF SIZE              19950021
         C     REG10,VALUE2        COMPARE FOR SUFFICIENCY              20000021
         BC    4,ALTERV2           NOT ENOUGH                           20050021
NOWTEST  EQU   *                                                        20100021
         LH    REG10,TXT6K         SEE IF VALUE2 IS                     20150021
         C     REG10,VALUE2        GR THAN 6K                           20200021
         BC    11,SIXK             NO-BRANCH                            20250021
         L     REG10,CON60K        UPDATE                               20300021
         SH    REG10,TXT6K              THE 60K CONSTANT                20350021
         A     REG10,VALUE2             TO                              20400021
         ST    REG10,CON60K             60K + (VALUE2 - 6K)             20450021
         L     REG10,CON32K        UPDATE                               20500021
         SH    REG10,TXT6K              THE 32K CONSTANT                20550021
         A     REG10,VALUE2             TO                              20600021
         ST    REG10,CON32K             32K + (VALUE2 - 6K)             20650021
         BC    15,GRSIXK                                                20700021
SIXK     EQU   *                                                        20750021
*                                                                       20800021
         MVC   VALUE2+2(2),TXT6K   USE 6K ALWAYS                        20850021
*                                                                       20900021
GRSIXK   EQU   *                                                        20950021
         C     RWORK3,CON60K       CAN WE PROVIDE A MAX BLK FCTR OF 40  21000021
         BC    11,ALLM40           YES                                  21050021
         C     RWORK3,CON32K       CAN WE PROVIDE A BLK FCTR OF 10      21100021
         BC    11,ALLM10           YES                                  21150021
         MVC   MAXBF(2),M05        NO-PROVIDE A MAX BLK FCTR OF 5       21200021
         MVC   LINSIZE(4),LINMIN   USE MIN SYSLIN AND SYSPRINT SIZES    21250021
         BC    15,FETCHADR                                              21300021
ALTERV2  EQU   *                                                        21350021
         N     REG10,MASK2K        SET VALUE2 TO 2048 BYTE BOUNDARY     21400021
         ST    REG10,VALUE2        CHANGE VALUE2                        21450021
         BC    15,NOWTEST          GO BACK                              21500021
ALLM10   MVC   MAXBF(2),M10        PROVIDE A MAX BLK FACTOR OF 10       21550021
         MVC   LINSIZE(4),LININT   USE INT SYSLIN AND SYSPRINT SIZES    21600021
         BC    15,FETCHADR                                              21650021
ALLM40   MVC   MAXBF(2),M40        PROVIDE A MAX BLK FACTOR OF 40       21700021
         MVC   LINSIZE(4),LINMAX   USE MAX SYSLIN AND SYSPRINT SIZES    21750021
FETCHADR LH    RWORK2,PRTSIZE      GET MAX. PRTBUF SIZE                 21800021
         LH    REG1,HEWLCWBB+12         LOAD BLOCKSIZE                  21850021
         TM    APTSWS,TSO              IN TSO MODE?                     21900021
         BZ    TSO6                    NO - CONTINUE                    21950021
         L     REG7,HEWLCWBB           LOAD DCB ADDDRESS       @AZ16058 21960037
         CLI   17(REG7),X'4F'       IS SYSPRNT A TERMINAL      @AZ16058 21970037
         BNE   TSO6                    NO--BRANCH              @AZ16058 21980037
         LA    REG1,121                YES--SET UP A FULL BUFFER        22000021
*                                      EVEN THO LRECL ONLY 81           22050021
TSO6     LA    REG1,7(REG1)            ROUND UP TO                      22100021
         N     REG1,ALIGNX         A MULTIPLE OF EIGHT                  22150021
         STH   REG1,PRTSIZE        SAVE REAL SIZE FOR ALLOCATION        22200021
         SR    RWORK2,REG1             COMPUTE STORAGE AVAIL. TO TABLES 22250021
         AR    RWORK2,RWORK2           DOUBLE VALUE FOR BOTH BUFFERS    22300021
         STH   RWORK2,DIFFSAVE        SAVE DIFFER. FOR LATER            22350021
         L     RWORK2,MAINGOT          FETCH ADDR OF OBTAINED STORAGE   22400021
         ST    RWORK2,HEWLCRBB+4   PLACE 1ST LIBRARY BUFFER ADDR        22450021
         AH    RWORK2,LINSIZE      ADD BUFFER SIZE TO ADDR              22500021
         SH    RWORK3,LINSIZE      SUB BUFFER SIZE FROM LENGTH          22550021
         ST    RWORK2,HEWLCRBB+8   PLACE 2ND LIBRARY BUFFER ADDR        22600021
         AH    RWORK2,LINSIZE      ADD BUFFER SIZE TO ADDR              22650021
         SH    RWORK3,LINSIZE      SUB BUFFER SIZE FROM LENGTH          22700021
         ST    RWORK2,HEWLCRBN+4   PLACE 1ST SYSLIN BUFFER ADDR         22750021
         AH    RWORK2,LINSIZE      ADD BUFFER SIZE TO ADDR              22800021
         SH    RWORK3,LINSIZE      SUB BUFFER SIZE FROM LENGTH          22850021
         ST    RWORK2,HEWLCRBN+8   PLACE 2ND SYSLIN BUFFER ADDR         22900021
         AH    RWORK2,LINSIZE      ADD BUFFER SIZE TO ADDR              22950021
         SH    RWORK3,LINSIZE      SUB BUFFER SIZE FROM LENGTH          23000021
         ST    RWORK2,HEWLCWBB+4   PLACE 1ST SYSPRINT BUFFER ADDR       23050021
         MVI   1(RWORK2),X'40'         CLEAR SYSPRINT BUFFER            23100021
         MVC   2(120,RWORK2),1(RWORK2)                                  23150021
         ST    RWORK2,HEWLCWBB+20                                       23200021
         AH    RWORK2,PRTSIZE      INCREMENT ADDRESS                    23250021
         SH    RWORK3,PRTSIZE      DECREMENT LENGTH                     23300021
         ST    RWORK2,HEWLCWBB+8   PLACE 2ND SYSPRINT BUFFER ADDR       23350021
         AH    RWORK2,PRTSIZE      INCREMENT ADDRESS                    23400021
         SH    RWORK3,PRTSIZE      DECREMENT LENGTH                     23450021
         TM    SAVATS+1,DC         TEST FOR DOWNWARD COMP IN LM         23500021
         BC    8,PROV1K            BR IF IT IS TO BE DC                 23550021
*                                  CONTINUE IF NOT DC                   23600021
*                                                                       23650021
*     DEVTYPE FOR SYSLMOD DONE BEFORE OPEN                              23700021
         MVC   TXTSIZE(2),TXT18K        USE 18K                         23750021
         LA    REG10,TXT18K            LOAD ADDR OF LIST                23800021
PROVNK   CLC   DEVMAXBS+2(2),0(REG10)  COMPARE BLOCKING                 23850021
         BC    11,TRYUT1               DEVTYPE > LIST VALUE             23900021
         MVC   TXTSIZE(2),2(REG10)     USE NEXT SIZE IN LIST            23950021
         LA    REG10,2(REG10)          GET ITS ADDR                     24000021
         CLC   TXT1K(2),0(REG10)       IS BLKSIZE 1K?                   24050021
         BNE   PROVNK                  IF NOT, TEST AGAIN               24100021
PROV1K   MVC   TXTSIZE(2),TXT1K         USE 1K                          24150021
TRYUT1   EQU   *                                                        24200021
         L     REG10,VALUE2        FETCH VALUE2                         24250021
         SRL   REG10,1             DIVIDE BY 2                          24300021
         CH    REG10,TXT20K        SEE IF 18K RECORDS NEEDED            24350021
         BC    4,TESTSIZE          BR IF NO                             24400021
         OI    SWITCH,X'80'        TURN ON BIT TO PROVIDE 5K RLD BUF    24450021
TESTSIZE EQU   *                                                        24500021
         CH    REG10,TXTSIZE       SEE IF WE CAN DOUBLE BUFFER          24550021
         BC    11,NOFIXT           BR IF OK                             24600021
         STH   REG10,TXTSIZE       USE SMALLER VALUE FOR RCD SIZE       24650021
NOFIXT   EQU   *                                                        24700021
         DEVTYPE ACTVUT1,DEVSAVE FIND MAXIMUN TEXT BUFFER RECORD SIZE   24750021
*                                                                       24800021
         NI    DEVMAXBS+3,X'F8'    SET TO DOUBLE WORD BOUNDARY          24850021
         MVC   SZSYSUT1+2(2),DEVMAXBS+2 ESTABLISH SYSUT1 MAX BYTES/TRK  24900021
         MVC   UT1SIZE+2(2),TXT18K      USE 18K                         24950021
         LA    REG10,TXT18K            LOAD ADDR OF LIST                25000021
PROVMK   CLC   DEVMAXBS+2(2),0(REG10)  COMPARE BLOCKING                 25050021
         BC    11,TRYNXT               DEVTYPE > LIST VALUE             25100021
         MVC   UT1SIZE+2(2),2(REG10)   USE NEXT SIZE IN LIST            25150021
         LA    REG10,2(REG10)          GET ITS ADDR                     25200021
         CLC   TXT1K(2),0(REG10)       IS BLKSIZE 1K?                   25250021
         BNE   PROVMK                  IF NOT, TEST AGAIN               25300021
         MVC   UT1SIZE+2(2),TXT1K       USE 1K                          25350021
TRYNXT   EQU   *                                                        25400021
         C     REG10,UT1SIZE       SEE IF WE CAN DOUBLE BUFFER          25450021
         BC    11,NOFIXU           BR IF OK                             25500021
         ST    REG10,UT1SIZE       USE SMALLER VALUE FOR RCD SIZE       25550021
NOFIXU   EQU   *                                                        25600021
         STM   LEN4,LEN6,SPACES+8 STORE REGISTER FOR USE                25650021
         SR    LEN4,LEN4     CLEAR REGISTER 4                           25700021
         LH    LEN5,TXTSIZE  MAXIMUM SYSLMOD SIZE                       25750021
         LH    LEN6,UT1SIZE+2  LOAD MAXIMUM SUST1 BUFFER SIZE           25800021
         CR    LEN5,LEN6     IS SYSLMOD SIZE GREATER THAN SYSUT1 SIZE   25850021
         BH    NOFX          YES                                        25900021
         LR    LEN6,LEN5     READJUST FOR DIVISION                      25950021
         LH    LEN5,UT1SIZE+2     LOAD SYSUT1 BUFFER SIZE INTO RER. 5   26000021
*  DIVID LARGER OF SYSLMOD OR SYSUT1 BUFFER SIZE INTO EACH OTHER        26050021
*  TO FIND EVEN MULTIPLE                                                26100021
NOFX     DR    LEN4,LEN6                                                26150021
         LTR   LEN4,LEN4     WERE SIZES AN EVEN MULTIPLE OF EACH OTHER  26200021
         BC      8,NORMDER   YES                                        26250021
         SR    LEN4,LEN4                                                26300021
         MR    LEN4,LEN6     FIND EVEN MULTIPLE SIZE                    26350021
         CLC   TXTSIZE(2),UT1SIZE+2    IS SYSLMOD SIZE GREATER          26400021
         BL    UT1MORE       NO                                         26450021
         STH   LEN5,TXTSIZE  READJUST SYSLMOD MAXIMUM RECORD SIZE       26500021
         BC    15,SHIFT2                                                26550021
UT1MORE  STH   LEN5,UT1SIZE+2     READJUST UT1 BUFFER SIZE              26600021
NORMDER  LH    LEN5,TXTSIZE  LOAD SYSLMOD BUFFER SIZE                   26650021
SHIFT2   SLL   LEN5,1        MULTIPLE SYSLMOD BUFFER SIZE BY 2          26700021
READJT   L     LEN4,VALUE2                                              26750021
         TM    SWITCH,X'80'  ARE 4K UBFFERS AVAILABLE FOR RLD RECORDS   26800021
         BC    8,NOBUFF      NO                                         26850021
         SH    LEN4,TXT4K    SUBTRACT FOUR K FROM BUFFER AREA           26900021
NOBUFF   LH    LEN6,TXTSIZE                                             26950021
         CH    LEN6,UT1SIZE+2                                           27000021
         BH    MULT2                                                    27050021
         LH    LEN6,UT1SIZE+2                                           27100021
MULT2    AR    LEN5,LEN6                                                27150021
         CR    LEN4,LEN5                                                27200021
         BH    MULT2                                                    27250021
         BE    ENDFIX                                                   27300021
         SR    LEN5,LEN6                                                27350021
         ST    LEN5,VALUE2                                              27400021
ENDFIX   LM    LEN4,LEN6,SPACES+8  RESTORE REGISTERS USED               27450021
         MVC   MULTSIZE+2(2),TXTSIZE ESTABLISH MULTIPLICITY SIZE        27500021
         CLC   MULTSIZE+2(2),EXITTEST   COMPARE TO BLOCK SIZE   SA47971 27510000
         BNH   MULTFIX                  BRANCH IF USABLE        SA47971 27520000
         MVC   MULTSIZE+2(2),EXITTEST   OVERRIDE WITH BLK SIZE  SA47971 27530000
MULTFIX  EQU   *                        OVERRIDE BYPASS         SA47971 27540000
         L     SYSLMOD,DCBADRS2        GET ADDR OF SYSLMOD DCB          27550021
         USING IHADCB,SYSLMOD                                           27600021
         CLC   MULTSIZE+2(2),DCBBLKSI  COMPARE MULT. TO BLKSIZE         27650021
         BNH   MULTOK                  MULT. LESS               SA47971 27700000
         MVC   MULTSIZE+2(2),DCBBLKSI  USE BLKSIZE AS MULT.     SA47971 27750000
MULTOK   EQU   *                                                        27800021
         NI    MULTSIZE+3,X'F8'   RND RECSIZES DOWN TO MULT OF 8        27850021
         DROP      SYSLMOD                                              27900021
         LH    RWORK5,TXT1K        FETCH TWICE SIZE INTO BUFFER         27950021
         TM    SWITCH,X'80'        PROVIDE A 5K RLD BUFFER              28000021
         BC    8,ITERATE           BR IF NO                             28050021
         LH    RWORK5,TXT5K            GET TWICE SIZE OF RLD BUFFER     28100021
ITERATE  SRL   RWORK5,1            DIVIDE BY TWO                        28150021
         C     RWORK5,SZSYSUT1     COMPARE THIS SIZE TO MAX             28200021
         BC    2,ITERATE           LOOP IF GR TH MAX ALLOWABLE          28250021
         STH   RWORK5,RLDBUFSZ     SET THIS SIZE IN BUF SIZE            28300021
         LH    RWORK5,MAXTKS1      FETCH  8K CONSTANT                   28350021
         C     RWORK5,SZSYSUT1     COMPARE THIS SIZE TO MAX             28400021
         BC    4,HAVEMAX           BR IF LESS THAN MAX                  28450021
         L     RWORK5,SZSYSUT1     FETCH ACTUAL MAX                     28500021
HAVEMAX  EQU   *                                                        28550021
         STH   RWORK5,MAXTKS1      PLACE IN MAX TRACK SIZE              28600021
         SLL   RWORK5,2            MULTIPLY BY 4                        28650021
         STH   RWORK5,MAXTKS2      PLACE IN MAX TRACK SIZE X 4          28700021
         ST    RWORK2,RLDOUT1      PLACE RLD BUFFER 1 ADDR              28750021
         AH    RWORK2,RLDBUFSZ     INCREMENT ADDRESS                    28800021
         SH    RWORK3,RLDBUFSZ     DECREMENT LENGTH                     28850021
         ST    RWORK2,RLDOUT2      PLACE RLD BUFFER 2 ADDRESS           28900021
         AH    RWORK2,RLDBUFSZ     INCREMENT ADDRESS                    28950021
         SH    RWORK3,RLDBUFSZ     DECREMENT ADDRESS                    29000021
         MVC   RLDSIZE+2(2),RLDBUFSZ    SET RLD BUF SIZE IN APT         29050021
         ST    RWORK2,TXTBFBEG     PLACE LOAD MOD OR TXT BUFFER ADDR    29100021
         L     RWORK5,VALUE2       FETCH VALUE2                         29150021
         TM    SWITCH,X'80'                                             29200021
         BC    8,L5KRLD                                                 29250021
         SH    RWORK5,TXT4K                                             29300021
L5KRLD   EQU   *                                                        29350021
         CH    RWORK5,TXT6K        SEE IF VALUE2 IS GR TH 6K            29400021
         BC    2,GRTH6K            YES-BRANCH                           29450021
         LH    RWORK5,TXT6K        NO-THEN USE 6K INSTEAD               29500021
GRTH6K   AR    RWORK2,RWORK5            INCREMENT BY SIZE OF TEXT BUF   29550021
         SR    RWORK3,RWORK5            DECREMENT BY SIZE OF TEXT BUF   29600021
         ST    RWORK2,TXTBFEND          PLACE ADDR OF END OF TEXT BUF   29650021
         STM   RWORK2,RWORK3,MAINGOT    RESTORE MAINGOT + LENGTH        29700021
         L     REG8,DCBADRS3       FETCH ADDR OF SYSUT1 DCB             29750021
         USING IHADCB,REG8                                              29800021
         MVC   DCBBLKSI(2),SZSYSUT1+2        UPDATE SYSUT1 DCB          29850021
         DROP  REG8                                                     29900021
         CLC   MAXBF(2),HEWLCWBB+16  COMPARE SYSPRT BLKFC               29950021
         BL    ABENT2     EXIT IF SYSPRINT BLOCKING TOO GREAT           30000021
         L     REG10,HEWLCWBB+20   GET ADDR OF SYSPRINT BUFFER          30050021
         MVI   0(REG10),X'8B'          CC TO RESTORE                    30100021
         L     REG15,COREADR           PICK UP GETMAIN'D ADDR           30150021
         A     REG15,CORELEN           ADD IN LENGTH                    30200021
         ST    REG15,FFCADR            STORE ADDR IN APT                30250021
         L     SYSBRNCH,PRNTAD         ADDRESS OF PRINT ROUTINE         30300021
         BALR  SYSRET,SYSBRNCH                                          30350021
         L     REG10,HEWLCWBB+20       ADDRESS OF PRINT BUFFER          30400021
TEST1ST  CLI   MSGONE,X'00'             TEST 1ST BYTE FOR ZEROES        30450021
         BC    8,TEST2ND                YES - TRY NEXT                  30500021
         L     RWORK2,MSGONE            FETCH ADDR OF MSG               30550021
         NI    SWITCH,X'FE'        TURN OFF SINGLE LINE SWITCH          30600021
         LH    RWORK5,HEWLCWBB+14  LOAD LRECL                           30650021
         LA    RWORK9,0(RWORK5,RWORK2) ADDRESS OF CHARACTER AT          30700021
*                                      END OF BUFFER                    30750021
         BCTR  RWORK9,0                                                 30800021
         CLI   0(RWORK9),C' '      IS THE CHARACTER BLANK               30850021
         BNE   TEST2               NO - BRANCH                          30900021
         OI    SWITCH,SNGLIN       TURN ON SINGLE LINE SWITCH           30950021
         B     HDR1                BRANCH TO PRINT HEADER               31000021
TEST2    CLI   0(RWORK9),C','      IS LAST CHARACTER A COMMA            31050021
         BE    HDR1                YES - BRANCH TO PRINT                31100021
         BCT   RWORK9,TEST2        LOOK FOR COMMA TO BREAK LINE         31150021
HDR1     SR    RWORK9,RWORK2       GET LENGTH OF MESSAGE                31200021
         EX    RWORK9,MOVEMSG      MOVE MOVE MESSAGE INTO BUFFER        31250021
         BALR  SYSRET,SYSBRNCH     GO PRINT                             31300021
         TM    SWITCH,SNGLIN       IS THE MESSAGE CONTINUED             31350021
         BC    1,TEST2ND           NO - BRANCH                          31400021
         L     REG10,HEWLCWBB+20   GET BUFFER ADDRESS                   31450021
         MVI   0(RWORK2),C' '           INJECT BLANK TO CLEAR   OY00338 31460001
         BCTR  RWORK9,0                 GET MOVE LNG, LINE1     OY00338 31470001
         EX    RWORK9,MOVEPAD           CLEAR OUT LINE 1        OY00338 31480001
         SR    SYSRET,SYSRET                                            31500021
         IC    SYSRET,MSGONE       GET TOTAL LENGTH OF MESSAGE          31550021
         LA    RWORK2,1(SYSRET,RWORK2)  POINT TO END OF TEXT    OY00338 31600001
         SR    RWORK2,RWORK5            POINT TO SECOND LINE    OY00338 31650001
         MVI   0(RWORK2),X'09'          MOVE IN CARR CNTRL      OY00338 31700001
         BCTR  RWORK5,0                 ADJUST FOR MOVE LENGTH  OY00338 31750001
         EX    RWORK5,MOVEMSG           MOVE IN REST OF MSG     OY00338 31800001
         BALR  SYSRET,SYSBRNCH     GO PRINT SECOND LINE                 32100021
TEST2ND  CLI   MSGTWO,X'00'        TEST 1ST BYTE FOR ZEROES             32150021
         BC    8,TEST3RD           YES - TRY NEXT                       32200021
         L     REG10,HEWLCWBB+20        ADDRESS OF PRINT BUFFER         32250021
         L   RWORK2,MSGTWO                                              32300021
         IC    SYSRET,MSGTWO       FETCH LENGTH OF MSG TWO              32350021
         EX    SYSRET,MOVEMSG      THEN MOVE MSG TWO                    32400021
         BALR  SYSRET,SYSBRNCH          PRINT MSG TWO                   32450021
TEST3RD  CLI   MSGTHREE,X'00'                                           32500021
         BC    8,TEST4TH           YES - TRY NEXT                       32550021
         L     REG10,HEWLCWBB+20   GET ADDR OF SYSPRINT BUFFER          32600021
         L     RWORK2,MSGTHREE     FETCH ADDR OF MSG                    32650021
         IC    SYSRET,MSGTHREE     FETCH LENGTH OF MSG THREE            32700021
         EX    SYSRET,MOVEMSG      THEN MOVE MSG THREE                  32750021
         BALR  SYSRET,SYSBRNCH          PRINT MSG THREE                 32800021
TEST4TH  CLI   MSGFOUR,X'00'                                            32850021
         BC    8,DECREQ            YES - CONTINUE                       32900021
         L     REG10,HEWLCWBB+20   GET ADDR OF SYSPRINT BUFFER          32950021
         L     RWORK2,MSGFOUR      FETCH ADDR OF MSG                    33000021
         IC    SYSRET,MSGFOUR     FETCH LENGHT OF MSG FOUR              33050021
         EX    SYSRET,MOVEMSG      THEN MOVE MSG FOUR                   33100021
         BALR  SYSRET,SYSBRNCH     PRINT MSG FOUR                       33150021
DECREQ   EQU   *                                                        33200021
         A     RWORK3,BUFCON       ADD SIZE OF BUFFERS  SINCE           33250021
*                                  THEY HAVE BEEN ALLOCATED             33300021
         STM   ZERO,SYSBRNCH,BRNCHSV   SAVE REGISTERS            S01904 33350021
         L     SYSBRNCH,ERDIGA         ADDRESS OF REALLOC RTN    S01904 33360021
         BALR  SYSRET,SYSBRNCH         GO TO REALLOC RTN         S01904 33370021
************************************************                OY09265 33370137
*  REALLOCATION IMMEDIATELY AFTER ALLOCATION   *                OY09265 33370237
************************************************                OY09265 33370337
         TM    APT4,X'C0'              PREVIOUS REALLOCATE?     OY09265 33370437
         BO    REALLOC                 BR IF PREVIOUS REALLOC   OY09265 33370837
         L     15,ERDIGA               ADDRESS OF REALLOC RTN   OY09265 33372037
         BALR  14,15                   GO TO REALLOC RTN        OY09265 33374037
REALLOC  LM    ZERO,SYSBRNCH,BRNCHSV   RESTORE REGISTERS         S01904 33380037
         B     ALL043                                            S01904 33390021
*                                                                       33400021
MOVEMSG  MVC   0(1,REG10),0(RWORK2) PUT MSG INTO SYSPRINT BUFFER        33450021
MOVEPAD  MVC   1(1,RWORK2),0(RWORK2)   EXECUTED PAD PROPAGATOR  OY00338 33460001
*                                                                       33500021
         EJECT                                                          33550021
SCDENTRY EQU   *                                                        33600021
         TM    SAVATS,OVERBIT           TEST FOR OVERLAY                33650021
         BC    8,NOTOVLY                NOT  OVERLAY                    33700021
         LH    RWORK2,DIFFSAVE         GET PRTBUF REMAINDER             33750021
         LA    RWORK6,3000             AMOUNT FOR LARGER CALLS LIST     33800021
         CR    RWORK6,RWORK2           IS THERE 3000 BYTES LEFT         33850021
         BC    12,USESOME      YES SO ONLY USE 3000 BYTES               33900021
         LR    RWORK6,RWORK2           GET ALL OF EXTRA PRTBUF          33950021
USESOME  SR    RWORK3,RWORK6       KEEP  THIS 3000 FROM GENERAL ALLOC.  34000021
         LH    RWORK2,CALLSLST+6       GET MIN CALLS LIST SIZE          34050021
         AR    RWORK2,RWORK6       ADD 3000 TO MIN.                     34100021
         STH   RWORK2,CALLSLST+6       SAVE FOR ALLOCATION              34150021
         LH    RWORK2,ENTRLIST+6       GET MIN ENTRY LIST SIZE          34200021
         AR    RWORK2,RWORK6       ADD 3000 TO MINIMUM                  34250021
         STH   RWORK2,ENTRLIST+6       SAVE FOR ALLOCATION              34300021
         MVC   TTRLIST(4),HEWLCRBB+4    PLACE ADDR OF TTR LIST          34350021
         MVC   SGTBSLOT+6(2),SG256 ALLOW 256 SEGMENTS                   34400021
         CLC   MAXBF(2),M10        CAN WE PROVIDE 256 SEGMENTS          34450021
         BC    11,NOTOVLY          YES                                  34500021
         MVC   SGTBSLOT+6(2),SG200 NO - THEN PROVIDE A MAX OF 200       34550021
NOTOVLY  EQU   *                                                        34600021
         S     RWORK3,MAINREQ           SUB MINIMUM MAIN STOR REQ       34650021
         SR    RWORK2,RWORK2          CLEAR REGISTER FOR DIVISION       34700021
         SR    RWORK6,RWORK6                                            34750021
         D     RWORK2,TOTWT           CALCULATE NUMBER OF GROWS         34800021
         MVC   FSTPHIGH(4),MAINGOT    INITIALIZE HIGH ASSIGNED ADDRS    34850021
         MVC   INTPHIGH(8),FSTPHIGH                                     34900021
         LA    TABLLIST,TABLE         INITIALIZE REGISTERS FOR TABLE    34950021
         SR    RWORK4,RWORK4                                            35000021
         LA    RINDEX,ENTRYSIZ                                          35050021
ALL010   LR    NUMBGROS,RWORK3        REINITIALIZE NUMBER OF GROWS      35100021
         TM    SWITCHES(TABLLIST),OVERLAY TEST FOR OVERLAY TABLE        35150021
ALL010SW BC    3,ALL0405             YES, SKIP THIS TABLE               35200021
         TM    SWITCHES(TABLLIST),FIRSTPAS TEST FOR OCCURANCE IN PASS   35250021
         BC    8,ALL011                         TO FIND HIGHEST UNAVAIL 35300021
         L     RWORK2,FSTPHIGH                  ABLE ADDRESS            35350021
ALL011   TM    SWITCHES(TABLLIST),INTERPAS                              35400021
         BC    8,ALL012                                                 35450021
         C     RWORK2,INTPHIGH                                          35500021
         BC    11,ALL012                                                35550021
         L     RWORK2,INTPHIGH                                          35600021
ALL012   TM    SWITCHES(TABLLIST),SECONDPS                              35650021
         BC    8,ALL020                                                 35700021
         C     RWORK2,SECPHIGH                                          35750021
         BC    11,ALL020                                                35800021
         L     RWORK2,SECPHIGH                                          35850021
ALL020   TM    SWITCHES(TABLLIST),DBLWORDB ALIGN IF NECESSARY           35900021
         BC    8,ALL021                                                 35950021
         STC   RWORK2,ALIGNTST                                          36000021
         TM    ALIGNTST,LOWZEROS                                        36050021
         BC    8,ALL030                                                 36100021
         SRL   RWORK2,3                                                 36150021
         LA    RWORK2,1(0,RWORK2)                                       36200021
         SLL   RWORK2,3                                                 36250021
ALL021   TM    SWITCHES(TABLLIST),WORDBNDR                              36300021
         BC    8,ALL030                                                 36350021
         STC   RWORK2,ALIGNTST                                          36400021
         TM    ALIGNTST,LOWZERO                                         36450021
         BC    8,ALL030                                                 36500021
         SRL   RWORK2,2                                                 36550021
         LA    RWORK2,1(0,RWORK2)                                       36600021
         SLL   RWORK2,2                                                 36650021
ALL030   IC    RWORK4,ADDRINCR(TABLLIST)                                36700021
         TM    SWITCHES(TABLLIST),ZERONTRY TEST FOR NEED TO DECR ADDR   36750021
         BC    3,ALL060               YES                               36800021
         ST    RWORK2,CSNO(RWORK4)  NO-STORE ADDRESS IN APT             36850021
ALL031   MH    NUMBGROS,WEIGHT(TABLLIST) CALC. BYTES TO BE ADDED        36900021
         AH    NUMBGROS,MINSIZE(TABLLIST) AND ADD                       36950021
         TM    SWITCHES(TABLLIST),CUTOFF  TEST FOR SPECIAL CASE         37000021
         BC    3,ALL070               YES                               37050021
ALL032   LA    RWORK5,0(RWORK2,NUMBGROS) NO, ADD TO START ADDRESS       37100021
         TM    SWITCHES(TABLLIST),FIRSTPAS TEST FOR OCCURANCE IN PASS   37150021
         BC    8,ALL033                             AND UPDATE HIGH     37200021
         ST    RWORK5,FSTPHIGH                      ADDRESSES           37250021
ALL033   TM    SWITCHES(TABLLIST),INTERPAS                              37300021
         BC    8,ALL034                                                 37350021
         ST    RWORK5,INTPHIGH                                          37400021
ALL034   TM    SWITCHES(TABLLIST),SECONDPS                              37450021
         BC    8,ALL040                                                 37500021
         ST    RWORK5,SECPHIGH                                          37550021
ALL040   IC    RWORK4,BYTSENTR(TABLLIST) CALCULATE MAXIMUM NUMBER OF    37600021
         SR    NUMBGROS-1,NUMBGROS-1  CLEAR REGISTER FOR DIVISION       37650021
         DR    NUMBGROS-1,RWORK4                                ENTRIES 37700021
         IC    RWORK4,ENTRINCR(TABLLIST)                                37750021
         C     NUMBGROS,MAXENTRS             TEST VS MAX POSSIBLE ENTRS 37800021
         BC    12,NOWSTORE                   IF LESS TH OR EQ BRANCH    37850021
         L     NUMBGROS,MAXENTRS             OTHERWISE USE MAX VALUE    37900021
NOWSTORE EQU   *                                                        37950021
         STH   NUMBGROS,CSNO(RWORK4)                                    38000021
ALL0405  CLI   MINSIZE+2(TABLLIST),ENDFLAG TEST FOR END                 38050021
         BC    7,ALL050               NO, LOOP                          38100021
         L     RPARAM,INTPHIGH        YES, DETERMINE HIGHEST ADDRESS    38150021
         C     RPARAM,SECPHIGH                                     USED 38200021
         BC    3,ALL041                                                 38250021
         L     RPARAM,SECPHIGH                                          38300021
ALL041   STC   RPARAM,ALIGNTST                                          38350021
         TM    ALIGNTST,LOWZEROS      ALIGN                             38400021
         BC    8,ALL042                                                 38450021
         SRL   RPARAM,3                                                 38500021
         LA    RPARAM,1(0,RPARAM)                                       38550021
         SLL   RPARAM,3                                                 38600021
ALL042   ST    RPARAM,FFCADR                                            38650021
         L     R0,MAINGOT                                               38700021
         A     R0,MAINLEN                                               38750021
         SR    R0,RPARAM                                                38800021
         FREEMAIN R,LV=(0),A=(1)                                        38850021
ALL043   XC    CSNO(4),CSNO        ZERO OUT SCRATCH LOCATION            38900021
         MVI   ALL010SW+1,X'30'      RESET SWITCH                       38950021
         B     ALLOCEND            LEAVE ALLOCATE ROUTINE               39000021
ALL050   SR    RWORK2,RWORK2          RESET REGISTER                    39050021
         BXH   TABLLIST,RINDEX,ALL010 LOOP                              39100021
ALL060   IC    RWORK6,BYTSENTR(TABLLIST) TAKE CARE OF ZEROTH ENTRY      39150021
         SR    RWORK2,RWORK6                                  PROVISION 39200021
         ST    RWORK2,CSNO(RWORK4)                                      39250021
         AR    RWORK2,RWORK6                                            39300021
         B     ALL031                                                   39350021
ALL070   TM    SWITCHES(TABLLIST),X'32'                                 39400021
         BC    1,ALL0702                                                39450021
         CH    NUMBGROS,MAXTKS1                                         39500021
         BC    4,ALL032                                                 39550021
         LH    NUMBGROS,MAXTKS1                                         39600021
         B     ALL032                                                   39650021
ALL0702  CH    NUMBGROS,MAXTKS2    EXCEED 4 TIMES TRACK SIZE            39700021
         BC    4,ALL032            NO--CONTINUE                         39750021
         LH    NUMBGROS,MAXTKS2    YES--RESET TO MAX TRACK SIZE X 4     39800021
         B     ALL032                                                   39850021
         DS    0F                                                       39900021
NORMWT   DC    AL4(ROUNDSIM)  TOTAL WEIGHT W/O OVLY OR HIAR     OY00359 39950001
NORMMIN  DC    AL4(NORMTABS+BUFFERS+ALIGNM)  MIN SPACE NEEDED   OY00359 40000001
OVLAYWT  DC    AL4(ROUNOVLY)  TOTAL WEIGHT WITH OVLY,NO HIAR    OY00359 40050001
OVLAYMIN DC    AL4(OVLATABS+BUFFERS+ALIGNM)  MIN SPACE NEEDED   OY00359 40100001
HIARWT   DC    AL4(ROUNHIAR)  TOTAL WEIGHT WITH HIAR,NO OVLY    OY00359 40150001
HIARCHYM DC    AL4(HIARTABS+BUFFERS+ALIGNM)  MIN SPACE NEEDED   OY00359 40200001
BUFCON   DC    AL4(BUFFERS)                                             40400021
BUFFERS  EQU   9984           MINIMUM BUFFER AREA REQ.                  40450021
ALIGNM   EQU   7                     ALLOWANCE FOR ALIGNMENT            40500021
DATAMAN  EQU   2*1024        SPACE FOR DATA MANAGEMENT AND      OY00359 40550001
*                             STOW WORK AREAS AND ABEND PROC    OY00359 40600001
NONRES   EQU   2048                    SPACE FOR NONRESIDENT ACCESS     40650021
*                                      METHOD ROUTINES                  40700021
MAXTKS1  DC    AL2(8184)                                                40750021
MAXTKS2  DC    AL2(32736)                                               40800021
TOTWT    DS    1F                     TOTAL WEIGHT                      40850021
MAINREQ  DC    X'00000000'         REQUEST FOR GETMAIN                  40900021
MAXSTOR  DC    X'01000000'    MAXIMUM MAIN STORAGE - 16384K OR LESS     40950021
MAINGOT  DC    2A(0)                  ADDRESS OF MAIN STORAGE GOTTEN    41000021
MAINLEN  EQU   MAINGOT+4              LENGTH OF SAME                    41150021
CON88K   DC    X'00016000'    CONSTANT OF 88K                           41200021
CON60K   DC    AL4(42*1024)                                      S01904 41250021
CON32K   DC    AL4(25*1024)                                      S01904 41300021
LLEGF64  DC    AL4(28*1024+DATAMAN)  SPACE FOR LE AND SCP       OY00359 41350001
MAXENTRS DC    X'00007FFF'         MAXIMUM ENTRIES BEF NEG SIGN GOES ON 41600021
DEFVCON  DC    V(HEWLFDEF)    ADDRESS OF CSECT CONTAINING DEFAULTS      41650021
         EJECT                                                          41700021
         DS    0H                     FOR ALIGNMENT                     41750021
*                SSAAEEBBWWWWMMMM SWS,ADDR,ENTS,BYTES,WGT,MINIMUM  NO.  41800021
TABLE    DC    X'78347A0100300480'  1 TEXT I/O TABLE   BYTES/ENT IS 4   41850021
SGTBSLOT EQU   *                                                        41900021
         DC    X'F31C800100000100'  2 SEGTAB1                           41950021
         DC    X'713C7E05001E01F4'  3 DELINK                            42000021
         DC    X'30388201000000A0'  4 ALIAS                             42050021
         DC    X'3884000100000008'  5 8 BYTES PRIOR TO HESD             42100021
         DC    X'3800700800B00AF0'  6 HESD                              42150021
         DC    X'32487607005407E0' 7  TEXT NOTE LIST 2                  42200021
         DC    X'324C7809006C0708' 8  RLD NOTE LIST 2                   42250021
         DC    X'442C000100000104'  9 INPUT RLD BUFFERS-1ST PASS        42300021
         DC    X'49407010016015E0' 10 CESD                              42350021
HIARSLOT EQU   *                                                        42400021
         DC    X'635800010016015E' 11 HIAR                              42450021
         DC    X'1454000100000300' 12 OUTPUT RLD BUFFERS-2ND PASS       42500021
         DC    X'6A247207001501F8' 14  TXT NOTE LIST 1                  42550021
         DC    X'6A287409001B01C2' 15  RLD NOTE LIST 1                  42600021
         DC    X'7400000100000004' 16 RENUMBERING TABLE PREFIX          42650021
         DC    X'7530000400580578' 17 RNT + RLC TABLES                  42700021
ENTRLIST DC    X'9444880600120558' 18A  ENTRY LIST                      42750021
CALLSLST DC    X'E4207C0100140558' 18B  CALLS LIST                      42800021
         DC    X'FF'               19 END FLAG                          42850021
*                                                                       42900021
*              XXXX      FORMAT OF HIGH ORDER DIGIT                     42950021
*              11XX      OVLY 1ST PASS                                  43000021
*              1X1X      OVLY INT PASS                                  43050021
*              1XX1      OVLY 2ND PASS                                  43100021
*              01XX      NO-OVLY 1ST PASS                               43150021
*              0X1X      NO-OVLY INT PASS                               43200021
*              0XX1      NO-OVLY 2ND PASS                               43250021
*                                                                       43300021
ALIGNTST DS    1C                     BYTE USED FOR ALIGNMENT           43350021
DEVSAVE  DS    0F                                                       43400021
DEVCODE  DC    F'0'           DEV CODE FROM UCB                         43450021
DEVMAXBS DC    F'0'           MAX  BLK SIZE ACCEPTED                    43500021
LINMIN   DC    H'0400'                                                  43550021
PRTMIN   DC    H'0608'                                                  43600021
LININT   DC    H'0800'                                                  43650021
PRTINT   DC    H'1216'                                                  43700021
LINMAX   DC    H'3200'                                                  43750021
PRTMAX   DC    H'4840'                                                  43800021
LINSIZE  DC    H'0'                                                     43850021
PRTSIZE  DC    H'0'                                                     43900021
TXT18K   DC    H'18432'                                                 43950021
TXT13K   DC    H'13312'                                                 44000021
TXT12K   DC    H'12288'                                                 44050021
TXT7P5K  DC    H'7680'       7.5K FOR 3340 DEVICE                XM5473 44060003
TXT6K    DC    H'6144'                                                  44100021
TXT5K    DC    H'5120'                 CONSTANT FOR RLD BUF SIZE        44150021
TXT4K    DC    H'4096'                                                  44200021
TXT3K    DC    H'3072'                                                  44250021
TXT2K    DC    H'2048'                                                  44300021
TXT1K    DC    H'1024'                                                  44350021
TXT10K   DC    H'10240'                                                 44400021
TXT20K   DC    H'20480'                                                 44450021
RLDBUFSZ DC    H'0'           SIZE OF RLD BUFS 1ST P-OUT  2ND P-IN      44500021
K4       DC    H'4'                                                     44550021
K8       DC    H'8'                                                     44600021
WEIGHTHR DC    X'0016'                                                  44650021
MINBTHR  DC    X'015E'                                                  44700021
DUMHRWT  DC    X'0000'                                                  44750021
DUMHRMN  DC    X'0008'                                                  44800021
SG200    DC    X'00C8'                                                  44850021
SG256    DC    X'00FF'                MAX SEGMENT COUNT        @ZA05444 44900037
TXTSIZE  DC    H'0'                                                     44950021
DIFFSAVE DS    H                       AREA FOR SAVE OF UNUSED PRTBUF   45000021
FSTPHIGH DS    3F                     CURRENT HIGH ASSIGNED ADDRESSES   45050021
SECPHIGH EQU   FSTPHIGH+8                                               45100021
INTPHIGH EQU   FSTPHIGH+4                                               45150021
MASK2K   DC    X'FFFFF800'         MASK TO SET A VALUE TO MULT OF 2048  45200021
ALIGNX   DC    X'FFFFFFF8'             CONST. FOR  DBLE WORD ALIGNMENT  45250021
SWITCH   DC    X'00000000'                                              45300021
*              BIT 0     IF ON PROVIDE 2-2560 BYTE RLD BUFFERS          45350021
*              BITS 1-7 SPARE                                           45400021
         EJECT                                                          45450021
ALLOCEND EQU   *                   END OF ALLOCATE ROUTINE              45500021
TESTLIN  CLC   MAXBF(2),HEWLCRBN+16   COMPARE SYSLIN BLKFC              45550021
         BC    11,GOODLIN                    EXIT IF VALID BLKFCTR      45600021
         MVC   LINECNT+1(1),SPACES     SET LINE COUNT                   45650021
         LA    R0,BADLIN                FETCH MESSAGE NO                45700021
         L     SYSBRNCH,ERDIG      ADDR OF ERROR RTN                    45750021
         BALR  SYSRET,SYSBRNCH          PRINT THE ERROR MSG AND EXIT    45800021
GOODLIN  EQU   *                                                        45850021
         MVI   IDRSWS,SWSOFF           INIALIZE IDR SWITCHES TO  S21016 45860021
*                                      ALL ZEROES                S21016 45870021
         MVI   APTSW3,SWSOFF           INITIALIZE TO ZEROES      S01904 45874021
         MVI   APTSW4,SWSOFF           INITIALIZE TO ZEROES      S01904 45876021
         MVC   IDRTREND(PTRLEN),IDRTRTAB  INIALIZE ADDRESS OF    S21016 45880021
*                                      NEXT AVAILABLE BYTE IN    S21016 45890021
*                                      IDR TRANSLATOR DATA TABLE S21016 45892021
*                                      TO FIRST BYTE OF TABLE    S21016 45894021
         MVC   IDRTIEND(PTRLEN),IDRTITAB INITIALIZE ADDRESS OF  OX04245 45894402
*                                      NEXT AVAILABLE BYTE IN   OX04245 45894802
*                                      IDR TRANSLATOR ID TABLE  OX04245 45895202
*                                      TO FIRST BYTE OF TABLE   OX04245 45895602
         MVC   IDRUDEND(PTRLEN),IDRUDTAB  INIALIZE ADDRESS OF    S21016 45896021
*                                      NEXT AVAILABLE BYTE IN    S21016 45898021
*                                      IDR USER - DATA TABLE     S21016 45898421
*                                      TO FIRST BYTE OF TABLE    S21016 45898821
         MVC   IDRZPEND(PTRLEN),IDRZPTAB  INIALIZE ADDRESS OF    S21016 45899221
*                                      NEXT AVAILABLE BYTE IN    S21016 45899621
*                                      IDR IMASPZAP DATA TABLE   S21016 45899721
*                                      TO FIRST BYTE OF TABLE    S21016 45899821
         NI    NEWSW,X'86'        INIT. NEWSW                           45900021
         NI    APT4,X'C3'              INIT. PAGE/ORDER SWITCHES YM2649 45910000
         MVC   EPSM(8),BLANKS      CLEAR EP SYMBOL TO BLANKS            45950021
         MVC   PDSE18(8),BLANKS    CLEAR MEMBER NAME OF MODULE TO BLNKS 46000021
         MVC   PDSE7(2),SAVATS     RESTORE                              46050021
         MVC   APT0(1),SAVATS+2    ATTRIBUTES                           46100021
         NI    APTSWS,TSO              CLEAR SWITCHES, NOT TSO          46150021
         OI    APTSWS,DCBS         INIT. APTSWS                         46200021
         TM    APTEMP+8,X'80'           MEMBER NAME RECEIVED            46250021
         BZ    AROUND                   NO                              46300021
         L     SYSBRNCH,DCBADRS2        GET SYSLMOD DCB                 46350021
         L     SYSBRNCH,44(SYSBRNCH)    DEB ADDRESS                     46400021
         LA    SYSBRNCH,0(SYSBRNCH)     CLEAR HI-ORDER BITS             46450021
         TM    8(SYSBRNCH),X'80'        IS DISP NEW OR MOD              46500021
         BO    AROUND                   YES.  DON'T SET BIT FOR         46550021
         OI    APTEMP+8,X'10'           STOW WITH REPLACE               46600021
AROUND   MVC   PDSE1(8),APTEMP          SET MEMBER NAME RECEIVED IN APT 46650021
*                                                                       46700021
         OC    APT3(1),APTEMP+8    MOVE NAME RCD BIT TO APT             46750021
         OI    APT1,X'04'                                               46800021
         MVI   CSNO+1,1            SET CURRENT SEGMENT TO 1             46850021
         MVC   LINECNT+1(1),SPACES  SET LINE COUNT                      46900021
         MVI   LSTS,X'01'                                               46950021
         MVC   ENRLD2X(2),K256+2   MOVE INPUT RLD BUF SIZE TO APT       47000021
         TM    INTERN1,1                                                47050021
         BC    1,ABENT                                                  47100021
         TM    NEWSW,FRSTIME       SEE IF FIRST TIME IN INT             47150021
         BC    1,SECOND            YES - THEN FALL THRU                 47200021
         OI    NEWSW,X'80'         SET BIT ON                           47250021
         L     REG9,TXTBFEND       GET ADDR OF NORM TABLES              47300021
SETEXIT  EQU   *                                                        47350021
         L     REG10,FFCADR        GET END ADDR OF NORM TABLES          47400021
         LA    RWORK3,EXIT         FETCH ADDRESS OF 1ST TIME EXIT       47450021
CLEARSUB EQU   *                                                        47500021
         L     SYSRET,K256         FETCH CONSTANT 256 FOR TEST          47550021
         LR    REG3,REG9           FETCH STARTING ADDR OF TABLES        47600021
         SR    REG4,REG4           CLEAR A REGISTER                     47650021
         ST    REG4,0(REG3)             AND PLACE ZEROES INTO           47700021
         ST    REG4,4(REG3)             FIRST 8 BYTES OF THE FIELD      47750021
         LR    REG4,REG10          FETCH ENDING ADDR OF TABLES          47800021
         SR    REG4,REG3                CALC LENGTH OF TABLES           47850021
         SH    REG4,K8             REDUCE BY 8 FOR ORIGINAL STORES      47900021
         CR    REG4,SYSRET              SEE IF GR TH 256                47950021
         BNH   OUTLOOP                  BR  IF GR TH 256                48000021
COMPR    MVC   8(256,REG3),0(REG3) START OF LOOP--  MOVE 256 CHARS      48050021
         AR    REG3,SYSRET                          INC ADDRESS         48100021
         SR    REG4,SYSRET                          DEC LENGTH          48150021
         CR    REG4,SYSRET                          SEE IF GR TH 256    48200021
         BH    COMPR               END OF LOOP----  BR IF GR TH 256     48250021
OUTLOOP  BCTR  REG4,0                   SUB 1 FOR MVC                   48300021
         EX    REG4,LASTMVC             DO LAST MVC                     48350021
         BCR   15,RWORK3           NOW LEAVE SUBROUTINE                 48400021
EXIT     L     SYSBRNCH,INPUT      FETCH ADDRESS OF HEWLFINP            48450021
         BALR  SYSRET,SYSBRNCH     LEAVE INITIALIZER                    48500021
SECOND   EQU   *                                                        48550021
         L     REG9,TXTBFEND           GET ADDR OF TXTIO TABLE          48600021
         L     REG10,FFCADR            GET END ADDR OF TABLES           48650021
         BAL   RWORK3,CLEARSUB     BR TO ENTER CLEAR SUBR               48700021
         L     REG9,RECNT          GET ADDR OF RENUMB TABLE             48750021
         SH    REG9,K4             TAKE 4 MORE BYTES FOR RNT PREFIX     48800021
         BC    15,SETEXIT          NOW GO TO SET RET ADDRESS            48850021
*                                                                       48900021
LASTMVC  MVC   8(1,REG3),0(REG3)   FOR THE LAST MOVE OF LS TH 256 CHARS 48950021
*                                                                       49000021
         USING *,15                                                     49050021
         USING IHADCB,REG1                                              49100021
HEWLXIT2 ST    REG5,SAVEIT             SAVE REG                         49150021
         L     REG5,ADDRIND            ADDRESS OF INDICATOR             49200021
         NI    0(REG5),X'F0'           SET NOT ACTIVE                   49250021
         NI    DCBBUFNO,X'00'      ZERO OUT BUFFER NUMBER FIELD         49300021
         TM    APTSWS,X'10'             TEST FOR DCBS OVERRIDE  SA47971 49400000
         BNO   XIT2A                    BRANCH IF NOT           SA47971 49450000
         NC    OVERRIDE,OVERRIDE        IS OVERRIDE SPECIFIED   OX00127 49460001
         BZ    XIT2A                    BRANCH IF NOT           OX00127 49470001
         CLC   EXITTEST,OVERRIDE        COMPARE TO BLOCK SIZE   SA47971 49500000
         BL    XIT2A                    BRANCH IF USABLE 47971,@ZA07605 49550037
         CLC   DCBBLKSI(2),OVERRIDE     IS OVERRIDE USUABLE     OX00127 49560001
         BH    XIT2A                    BRANCH IF NOT          @ZA33269 49570037
         MVC   EXITTEST,OVERRIDE        USE DCB OVERRIDE        SA47971 49600000
         MVC   DCBBLKSI(2),OVERRIDE     UPDATE DSCB     OX03511,OY03041 49610002
XIT2A    TM    PDSE8,X'80'              TEST FOR DC OPTION      SA47971 49650000
         BO    XIT2B                    BRANCH IF NOT APPLIC    SA47971 49700000
         CLC   EXITTEST,BUF1K           COMPARE TO 1024         SA47971 49750000
         BNH   XIT2B                    BRANCH IF USABLE        SA47971 49800000
         MVC   EXITTEST,BUF1K           USE 1024 FOR BLK SIZE   SA47971 49850000
XIT2B    L     REG5,4(REG5)             POINT TO JFCB          @ZA33269 49900037
         TM    JFCBIND2(REG5),X'C0'     NEW DATA SET?          @ZA33269 49910037
         BNO   TESTMIN                  IF NOT, BRANCH         @ZA33269 49920037
         MVC   DCBBLKSI(2),EXITTEST     IF SO, SET BLOCK SIZE   SA47971 49930037
TESTMIN  EQU   *                                                 YM5584 49940037
         L     REG5,SAVEIT              RESTORE REGISTER 5     @ZA33269 49950037
         TM    PDSE7,SCTR               TEST SCTR SPECIFIED      YM5584 50012001
         BO    SCTRMIN                  USE SCTR MINIMUM         YM5584 50014001
         CLC   DCBBLKSI(2),MIN256       TEST FOR MINIMUM BLKSIZE YM5584 50020001
         BL    SETMIN                   GO SET MINIMUM BLKSIZE   YM5584 50030001
         BR    REG14                    RETURN                   YM5584 50040001
SETMIN   EQU   *                                                 YM5584 50042001
         MVC   DCBBLKSI(2),MIN256       SET MINIMUM BLKSIZE      YM5584 50044001
         BR    REG14                    RETURN                  SA47971 50050000
SCTRMIN  EQU   *                                                 YM5584 50060001
         CLC   DCBBLKSI(2),MINSCTR      TEST FOR MINBLK FOR SCTR YM5584 50070001
         BL    SETSCTR                  GO SET SCTR MIN BLKSIZE  YM5584 50080001
         BR    REG14                    RETURN                   YM5584 50090001
SETSCTR  EQU   *                                                 YM5584 50092001
         MVC   DCBBLKSI(2),MINSCTR      SET MIN BLKSIZE FOR SCTR YM5584 50094001
         BR    REG14                    RETURN                   YM5584 50096001
SCTR     EQU   X'04'                    MASK FOR SCTR TEST       YM5584 50098001
MINSCTR  DC    H'1024'                  MIN BLKSIZE FOR SCTR     YM5584 50098401
MIN256   DC    H'256'                   MINIMUM SYSLMOD BLKSIZE  YM5584 50100001
OVERRIDE DC    H'00'                                                    50250021
EXITTEST DC    H'00'  BLOCK SIZE FROM DEVTYPE OR OPEN EXIT CALC SA47971 50350000
BUF1K    DC    H'1024'                                                  50400021
SAVEIT   DC    F'0'                                                     50450021
ADDRIND  DC    A(APTXLIST)                                              50500021
         DROP  15                                                       50550021
         DROP  REG1                                                     50600021
ATOPTADD DC    V(HEWLFOPT)                                              50650021
BLANKS   DC    C'        '         8 BLANKS                             50700021
K256     DC    F'256'                                                   50750021
K3K      DC    F'3072'                                                  50800021
K44K     DC    F'45056'                                                 50850021
ADRAPTEX DC    A(APTEXLST)       ADR OF EXIT LIST                       50900021
APTADD   DC    A(HEWLFAPT)                                              50950021
ABENT    LH    ZERO,ERROR                                               51000021
         LA    REG1,DDSAV                                               51050021
         L     SYSBRNCH,ERDIG      ADDR OF ERROR ROUTINE                51100021
         BCR   15,SYSBRNCH                                              51150021
ABENT2   L     BASE,=A(HEWLFINT+6)     ESTABLISH ADDRESSABILITY         51200021
         USING HEWLFINT+6,BASE                                          51250021
         L     0,CORELEN          LENGTH OF STORAGE FROM GETMAIN        51300021
         L     1,COREADR    ADDRESS OF THE FIRST BYTE                   51350021
         FREEMAIN R,LV=(0),A=(1)  FREE ALLOCATED CORE                   51400021
ABENT2A  WTO   'IEW0984 ERROR-SYSPRINT BLOCKSIZE EXCEEDS MAXIMUM-LINKEDX51450021
               IT PROCESSING TERMINATED.',ROUTCDE=11                    51500021
ABENT1   EQU   *                                               @ZA07598 51512037
         L     SYSLMOD,DCBADRS2                                @ZA07598 51532037
         OI    CIND2(SYSLMOD),STOWBIT                          @ZA07598 51552037
         LA    1,DCBADRS4                                      @ZA07598 51572037
         TM    NEWSW,TERM                                      @ZA07598 51592037
         BZ    TSO4                                            @ZA07598 51612037
         LA    1,DCBADRS1                                      @ZA07598 51632037
TSO4     CLOSE MF=(E,(1))                                      @ZA07598 51652037
         TM    APTSW2,SHRSYSMD                                 @ZA07598 51672037
         BNO   ABENT1A                                         @ZA07598 51692037
         DEQ   (ENQNAME,MINOR,44,SYSTEMS)                      @ZA07598 51712037
         B     ABENT1B                                         @ZA07598 51732037
ABENT1A  TM    APTSW2,ENQBIT                                   @ZA07598 51752037
         BO    ABENT1B                                         @ZA07598 51772037
         DEQ   (ENQNAME,MINOR,44,SYSTEM)                       @ZA07598 51792037
ABENT1B  LA    SYSBRNCH,16                                     @ZA07598 51812037
         LM    13,14,SYSRTN                                    @ZA07598 51832037
         LM    0,12,20(13)                                     @ZA07598 51852037
         BCR   15,14                                           @ZA07598 51872037
ABENT10  WTO   'IEW0994 ERROR - SYSPRINT DD CARD MISSING--LINKAGE EDITOX52050021
               R PROCESSING TERMINATED.',ROUTCDE=11                     52100021
         B     ABENT1                  BRANCH TO DEQUE                  52150021
REGSAVE1 DC    F'0'                                                     52200021
DCBADRS1 DC    X'0F'               OUTPUT FLAG                          52250021
         DC    AL3(HEWLTMDB)       ADDRESS OF SYSTERM                   52300021
DCBADRS4 DC    X'0F'               OUTPUT FLAG                          52350021
         DC    AL3(HEWLCPDB)       ADDRESS OF SYSPRINT                  52400021
         DC    X'00'               INPUT FLAG                           52450021
         DC    AL3(HEWLCSDB)       ADDRESS OF SYSLIN                    52500021
DCBADRS2 DC    X'8F'               OUTPUT FLAG AND END FLAG             52550021
         DC    AL3(HEWLCMDB)       ADDRESS OF SYSLMOD                   52600021
DCBADRS3 DC    A(HEWLCUDB)         ADDRESS OF SYSUT1                    52650021
INPUT    DC    V(HEWLFINP)                                              52700021
PRNTAD   DC    V(HEWLEPNT)                                              52750021
INDDNMAD DC    A(INDDNAME)                                       A47001 52760000
TEMP     DS    F                                                        52800021
INITEXAD DS    F           EXTRACT WILL PUT @ OF TSO FIELD HERE         52850021
*                                      EXTRACT WILL PUT @ OF    OY00130 52860001
*                                      TIOT HERE                OY00130 52870001
ADDRTIOT EQU   INITEXAD                TIOT ADDR FROM EXTRACT   OY00130 52880001
ADDRUCB  EQU   ADDRTIOT                UCB ADDR FROM TIOT       OY00130 52890001
XTRTSAVE DS    F       SAVE AREA FOR REG USED AFTER EXTRACT FOR TSO     52900021
SYSLINNM DC    C'SYSLIN  '                                              52950021
SYSUT1NM DC    C'SYSUT1  '                                              53000021
SYSLMDNM DC    C'SYSLMOD '                                              53050021
SYSPRTNM DC    C'SYSPRINT'                                              53100021
SYSLIBNM DC    C'SYSLIB  '                                              53150021
SYSTRMNM DC    C'SYSTERM '      STANDARD DDNAME FOR 12TH ENTRY          53200021
LENGTH   DC    H'96'            LENGTH OF DDNAMELIST IN TSO MODE        53250021
ACTVUT1  DC    C'SYSUT1  '                                              53300021
ACTVLMOD DC    C'SYSLMOD '                                              53350021
ERROR    DC    X'241C'                                                  53400021
INTERN1  DC    X'00'                                                    53450021
DDSAV    DS    8X'00'                                                   53500021
APTEMP   DC    C'        '                PDSEI TEMP STORAGE            53550021
         DC    X'00'                     APT0+3 TEMP STORAGE            53600021
         DS    0H                                                       53650021
M05      DC    H'05'                                                    53700021
M10      DC    H'10'                                                    53750021
M40      DC    H'40'                                                    53800021
PRNTNAME DS    2F                                                       53850021
ANSWER   DS    2F                                                       53900021
MSGFOUR  DC    A(0)                                                     53950021
MSG4     DC    X'09'                                                    54000021
         DC    11C' '                                                   54050021
NAMEDD   DC    C'SYSPRINT DEFAULT BLOCKING USED'                        54100021
         DC    2C' '                                                    54150021
FACTOR   DC    C' 1 - 1'                                                54200021
APFINIT  DC    X'0100'                 INIT VALUE FOR AUTH CODE  Y01048 54210000
         EJECT                                                          54220037
         DCBD  DSORG=(PS,PO)                                            54300021
         EJECT                                                          54350021
TIOT     DSECT                         MAP OF TIOT              OY00130 54360001
         IEFTIOT1                                               OY00130 54370001
UCB      DSECT                                                  OY00130 54372001
         IEFUCBOB                                               OY00130 54374001
         EJECT                                                  SA49330 54380000
*                                                                       54400021
*                                                                       54450021
DEFDSECT DSECT                                                          54500021
DEFIDENT DS    CL4                 THE NAME IDENTIFIER                  54550021
DESPNT   DS    F                   DESIGN POINT                         54600021
DEFV1    DS    F                   DEFAULT VALUE1                       54650021
DEFV2    DS    F                   DEFAULT VALUE2                       54700021
NAME     DS    CL4                 EDITOR NAME                          54750021
*                                                                       54800021
*                                                                       54850021
         HEWAPT                                                         54900021
         END                                                            54950021
