         TITLE 'HEWLFRAT   RLD/TXT PROCESSOR'                           00010021
*                 R L D / T X T    P R O C E S S O R                    00020021
         SPACE 2                                                        00030021
*FUNCTION/OPERATION -- THIS MODULE WILL HANDLE TEXT AND RLD RECORDS   * 00040021
*  FROM BOTH LOAD MODULES AND OBJECT MODULES.  IT WILL RECEIVE CONTROL* 00050021
*  FROM THE INPUT PROCESSOR AND WILL PUT ITS OUTPUT ON AN INTERMEDIATE* 00060003
*  FILE FOR USE BY THE SECOND PASS IF THE OUTPUT EXCEEDS THE SPACE    * 00070021
*  AVAILABLE IN THE OUTPUT BUFFER.  IN GENERAL THE RLD/TXT PROCESSOR  * 00080021
*  ORDERS THE INFORMATION FOR THE SECOND PASS PROCESSOR.              * 00090021
*                                                                     * 00100021
*ENTRY POINTS -- CONTROL IS PASSED BY THE INPUT PROCESSOR TO LOCATION * 00110021
*  HEWLFRAT                                                           * 00120021
*                                                                     * 00130021
*INPUT -- THE INPUT PROCESSOR SUPPLIES INFORMATION IN REGISTERS       * 00140021
*  REG 4 (RLD ONLY) -- BYTE COUNT OF RLD INPUT                          00150021
*  REG 6 (RLD ONLY) -- LOCATION IN STORAGE OF RLD INPUT                 00160021
*  REG 3 (TXT ONLY) -- ASSEMBLED ADDRESS OF FIRST BYTE OF TEXT        * 00170021
*  REG 6 (TXT ONLY) -- ID OF THIS TEXT RECORD                         * 00180021
*  REG 8 (TXT ONLY) -- LENGTH OF LOAD MODULE INPUT                      00190021
*                                                                     * 00200021
*OUTPUT -- IF ALL THE OUTPUT INFORMATION CAN BE CONTAINED IN THE OUT- * 00210021
*  PUT BUFFER, IT REMAINS IN STORAGE.  IF IT EXCEEDS THE CAPACITY OF  * 00220021
*  THE BUFFER ALL OF THE INFORMATION IS WRITTEN OUT ON AN INTERMEDIATE* 00230021
*  FILE.                                                              * 00240021
*                                                                     * 00250021
*EXTERNAL ROUTINES.                                                   * 00260021
*  ERROR DIAGNOSTIC ROUTINE -- OUTPUTS ERROR MESSAGES                 * 00270021
*  ESD PROCESSOR -- PLACES ENTRIES IN DELINK TABLE                    * 00280021
*                                                                     * 00290021
*EXITS                                                                * 00300021
*  NORMAL -- RETURN TO INPUT PROCESSOR                                * 00310021
*  ERRORS -- INTERNAL TABLES MAY OVERFLOW                             * 00320021
*     A)  CALLS LIST -- TOO MANY CALLS IN OVERLAY STRUCTURE           * 00330021
*     B)  RLD NOTE LIST -- TOO MANY CONTROL SECTIONS THAT CONTAIN RLD * 00340021
*           ITEMS                                                     * 00350021
*     C)  TEXT NOTE LIST -- TOO MANY CONTROL SECTIONS THAT CONTAIN    * 00360021
*           TEXT OR THERE ARE EXCESSIVE RE-ORIGINS WITHIN THE INPUT   * 00370021
*     D)  TEXT ID IS ILLEGAL.  TEXT RECORD IS IGNORED.                * 00380021
*                                                                     * 00390021
*TABLES                                                               * 00400021
*  THE FOLLOWING TABLES IN THE ALL PURPOSE TABLE ARE USED --          * 00410021
*                                                                     * 00420021
*     CALLS LIST-IN OVERLAY, LIST OF CALLS TO OTHER CONTROL SECTIONS, * 00430021
*        USED IN CREATION OF ENTABS                                   * 00440021
*                                                                     * 00450021
*     COMPOSITE ESD - USED TO GET ASSEMBLED ADDRESS OF CONTROL SECTION* 00460021
*                                                                     * 00470021
*     RENUMBERING TABLE -- USED TO RENUMBER RLD AND TEXT ITEMS        * 00480021
*                                                                     * 00490021
*  TEXT I/O TABLE -- 4 BYTES PER ENTRY                                * 00510021
*                                                                     * 00520021
*        *************************                                    * 00530021
*        *           *           *                                    * 00540021
*        *     ID    * FLG--MULT *                                    * 00550021
*        *           *           *                                    * 00560021
*        *************************                                    * 00570021
*        '           '           '                                    * 00580021
*        '  2 BYTES  '  2 BYTES  '                                    * 00590021
*        '           '           '                                    * 00600021
*                                                                     * 00610021
*  FOR EACH CHANGE, IN THE INPUT STREAM, OF AN ID OR A MULTIPLICITY,  * 00620021
*  AN ENTRY IS MADE IN THE TEXT I-O TABLE.  THE 'ID' IS THE ID OF A   * 00630021
*  TXT RECORD.  THE 'MULTIPLICITY' IS CALCULATED FOR EACH TEXT RECORD * 00640021
*  THAT IS PRESENTED.  A CHANGE IN MULTIPLICITY WILL OCCUR --         * 00650021
*    1) FOR EACH TEXT RECORD THAT IS A MULTIPLE OF UT1SIZE.           * 00660021
*      (UT1SIZE IS THE SIZE OF THE TEXT BUFFER AND THE MAXIMUM SIZE   * 00670021
*      OF A TEXT RECORD FROM A LOAD MODULE)                           * 00680021
*    2) FOR EACH RE-ORIGIN OF TEXT WITHIN A CONTROL SECTION (THE CON- * 00690021
*      TROL SECTION BEING GREATER THAN UT1SIZE).                      * 00700021
*                                                                     * 00710021
*  TEXT NOTE LIST -- 7 BYTES PER ENTRY                                * 00720021
*                                                                     * 00730021
*  THERE IS A ONE-TO-ONE CORRESPONDENCE BETWEEN THE TEXT I-O TABLE    * 00740021
*  AND THE TEXT NOTE LIST.  THE 'NTH' ENTRY OF THE TEXT I-O TABLE     * 00750021
*  REFERS TO THE 'NTH' RECORD OF THE TEXT NOTE LIST.  THE NOTE LIST   * 00760021
*  RELATES WHERE THE TEXT RECORD HAS BEEN WRITTEN ON THE DISK THROUGH * 00770021
*  THE 3 BYTE TTR ENTRY.  IF THE INPUT DECK HAS BEEN SHUFFLED OR IF   * 00780021
*  THERE ARE RE-ORIGINS WITHIN THE CONTROL SECTION (REPRESENTED BY    * 00790021
*  THE ID IN THE TXT I/O TABLE) THEN THE CONTROL SECTION CAN NOT BE   * 00800021
*  GATHERED AT ONE TIME.  THEREFORE, 'PIECES' OF TEXT WHICH ARE CALLED* 00810021
*  'DENSE' RECORDS ARE PLACED ON THE INTERMEDIATE FILE.  THE 2 BYTE   * 00820021
*  RELATIVE ADDRESS (OFFSET) DEFINES WHERE THIS 'PIECE' OF TEXT OCCURS* 00830021
*  WITHIN THE TEXT BUFFER.  THE SECOND PASS PROCESSOR WILL GATHER ALL * 00840021
*  THE 'PIECES' FOR EACH CONTROL SECTION AND MERGE THEM.              * 00850021
*                                                                     * 00860021
*        *******************************************                  * 00870021
*        *            *                *           *                  * 00880021
*        *   OFFSET   *  TTR/STG ADDR  *  LENGTH   *                  * 00890021
*        *            *                *           *                  * 00900021
*        *******************************************                  * 00910021
*        '            '                '           '                  * 00920021
*        '  2 BYTES   '    3 BYTES     '  2 BYTES  '                  * 00930021
*        '            '                '           '                  * 00940021
*                                                                     * 00950021
*                                                                     * 00960021
*                                                                     * 00970021
*                                                                     * 00990021
*  TEXT I/O CONTROL TABLE -- 4 BYTES PER ENTRY                        * 01000021
*                                                                     * 01010021
*  TO SAVE SPACE THE TEXT NOTE LIST IS NOT KEPT 'COMPLETELY' IN CORE. * 01020021
*  INSTEAD, WHEN IT REACHES A MAXIMUM VALUE, IT IS WRITTEN ON AN      * 01030021
*  INTERMEDIATE FILE AND THE RESULTANT TTR IS PLACED IN THE TEXT I/O  * 01040021
*  CONTROL TABLE.                                                     * 01050021
*                                                                     * 01060021
*                                                                     * 01070021
*        ************************                                     * 01080021
*        *      *               *                                     * 01090021
*        *   0  *      TTR      *                                     * 01100021
*        *      *               *                                     * 01110021
*        ************************                                     * 01120021
*        '      '               '                                     * 01130021
*        '   1  '               '                                     * 01140021
*        ' BYTE '    3 BYTES    '                                     * 01150021
*        '      '               '                                     * 01160021
*                                                                     * 01170021
*                                                                     * 01180021
*                                                                     * 01190021
*                                                                     * 01200021
*  RLD NOTE LIST -- 9 BYTES PER ENTRY                                 * 01210021
*                                                                     * 01220021
*        ****************************************************         * 01230021
*        *1.         *2.         *3.         *4.            *         * 01240021
*        *     ID    * FLG--MULT *  LENGTH   * TTR/ACCM LNG *         * 01250021
*        *           *           *           *              *         * 01260021
*        ****************************************************         * 01270021
*        '           '           '           '              '         * 01280021
*        '  2 BYTES  '  2 BYTES  '  2 BYTES  '   3 BYTES    '         * 01290021
*        '           '           '           '              '         * 01300021
*                                                                     * 01310021
*  1. THE ID IS THE ID OF THE CONTROL SECTION IN WHICH THE RLD ITEMS  * 01320021
*     OCCUR                                                           * 01330021
*  2. THE LOWEST MULTIPLICITY OF AN ADDRESS FIELD, OF AN RLD ITEM IN  * 01340021
*     THIS RLD RECORD, IS STORED HERE.                                * 01350021
*  3. THE NUMBER OF BYTES IN THE RLD RECORD IS DIVIDED BY 4 AND SAVED * 01360021
*     IN THIS TWO BYTE ENTRY.  (WORD COUNT)                           * 01370021
*  4. THE ACCUMULATED WORD COUNT OF GROUPED ENTRIES IS SAVED HERE,    * 01380021
*     EXCEPT WHEN IT IS IN THE LAST ENTRY OF A RECORD WRITTEN OUT ON  * 01390021
*     THE INTERMEDIATE DATA SET.  THEN IT HOLDS THE TTR OF THE RECORD.* 01400021
*                                                                     * 01410021
*                                                                     * 01430021
*                                                                     * 01440021
*  THE RLD I/O CONTROL TABLE - 4 BYTES PER ENTRY                      * 01450021
*                                                                     * 01460021
*  TO SAVE SPACE THE RLD NOTE LIST IS NOT KEPT 'COMPLETELY' IN CORE.  * 01470021
*  INSTEAD, WHEN IT REACHES A MAXIMUM VALUE, IT IS WRITTEN ON AN      * 01480021
*  INTERMEDIATE DATA SET AND THE RESULTANT TTR IS PLACED IN THE RLD   * 01490021
*  I/O CONTROL TABLE.                                                 * 01500021
*                                                                     * 01510021
*        ************************                                     * 01520021
*        *      *               *                                     * 01530021
*        *   0  *      TTR      *                                     * 01540021
*        *      *               *                                     * 01550021
*        ************************                                     * 01560021
*        '      '               '                                     * 01570021
*        '   1  '               '                                     * 01580021
*        ' BYTE '    3 BYTES    '                                     * 01590021
*        '      '               '                                     * 01600021
*                                                                     * 01610021
*                                                                     * 01620021
*                                                                     * 01630021
*                                                                     * 01640021
*ATTRIBUTES                                                           * 01650021
*  1) REUSABLE                                                        * 01660021
*                                                                     * 01670021
*NOTES -- SPECIAL TEXT....... SET ON WITH 'SPTXTON' AND TESTED        * 01680037
* JUST AFTER LABEL TXT002X.  THIS IS USED FOR TWO CASES.......        * 01684037
* 1) LARGE DS AREAS WITHIN A CSECT WHICH CAUSE THE FOLLOWING          * 01688037
* TEXT TO USE AN ADDITIONAL MULTIPLICITY WHIC CANNOT BE NOTED         * 01692037
* ANY OTHER WAY...                                                    * 01696037
* 2) A CSECT WITHIN A LOAD MODULE STARTING WITH A LARGE DS AREA         01700037
* FOLLOWED BY CODE WHICH WILL USE AN ADDITIONAL MULTIPLICITY            01704037
* WHICH CANNOT BE NOTED ANY OTHER WAY....                               01708037
* ...WITHOUT THIS CODE THE MODULE CREATED WILL LOSE SOME TEXT           01712037
* WHICH IS LOCATED INTO THE NEXT MULTIPLICITY OR BUFFER......           01716037
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 01730021
*                                                                     * 01740021
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 01750021
         SPACE 2                                                        01760021
     TITLE  'HEWLFRAT   RLD/TXT PROCESSOR  --  RLD EQUIVALENCIES'       01770021
HEWLFRAT CSECT                 ENTRY POINT                              01780021
*                                                                       01790021
*217900-218300,219500-221100,359100-359500,360700-362300         S01904 01800021
*367500-369500,372300-374300,543900-545500,602700-603100         S01904 01810021
*604300-611100,613100-621500,721100-729500,826700-828700         S01904 01820021
*831100-831900                                                   S01904 01830021
*C244620,A244620                                                 A49482 01832000
*C217500                                                         A52402 01834000
*A162700,A182700,A448700                                         A53300 01836000
*C367900,C368700,A372700,A831500,C834700,A953100                OX00029 01838000
*C162900,C182900                                                 XM1384 01838402
*A244480-244632                                                 OY00137 01838802
*C059100                                                        OY00131 01839201
*A484400-484500,C507500,A517200-517300,A747920,A817600-817860   OY00356 01839601
*C817900,D818300,C818700,C943900-9466400                        OY00356 01839701
*I302300,I350300,C352700                                OX03655,OY03146 01847202
*I360300,I361900                                        OX03721,OY03423 01849202
*I509500,I655900,I656300                                OX04241,OY03414 01851202
*C541811,I557500,C766100                                        XA05128 01853203
* SEE FIX FOR XA05128                                           YA03165 01853603
*I183100,I447100                                                XA04649 01854003
* SEE FIX FOR XA04649                                           YA03751 01854403
*I350400,C352700                                                XA05742 01854803
* SEE FIX FOR XA05742                                           YA04541 01854903
*I509500,I655900,I656300                                        XA05743 01865903
* SEE FIX FOR XA05743                                           YA04540 01875903
*I360300,C360700,I361900                                        YA05040 01876303
* SEE FIX FOR YA05040                                           XA05444 01876703
*I365600-366132,I413200-413300                                  XA05132 01876803
* SEE FIX FOR XA05132                                           YA04538 01876903
*C611500-612700,D629500,D631100,C631500,I632700                 XA05445 01880603
*D640300-640700,C642700,C643500                                 XA05445 01882603
* SEE FIX FOR XA05445                                           YA04542 01883003
* SEE FIX FOR XA05445                                           ZA00715 01883403
*I187500,I188300                                                XA05656 01883803
* SEE FIX FOR XA05656                                   ZA00717,YA04545 01884203
*A612600,A612900,I628700                                        XM08070 01889903
*A644700                                                        XM09517 01890303
*A612900,A621500,D629900,I611600                                XM09521 01890703
*I825600-826132,D097500,I097100,D486700-501100  ZA00723,YA04548,XA06144 01897603
* C503100-503900,C505100-505500,I514700,I518700                 ZA01405 01899602
* C528300-528700,D604700-606700,D608300-610700                  ZA01405 01900002
* D615100-617100,D618700-621100,I630700,I631500,I670700         ZA01405 01900402
* I685500,I705100,I713500,I715900,D723100-725100                ZA01405 01900502
* D726700-729100,I735500,D837100,I842300,C917900                ZA01405 01900602
* D612700                                                       ZA01409 01908802
* C059100                                                      @XA11151 01910837
* C603500,C614300,C722300                                      @ZA07602 01912837
* C9815000,A9816200-98121000 OZ28721 SYSRTE FROM OY19267       @ZA28721 01913837
* A098179-098180,C098184-098185                                @ZA33611 01914437
*                                                                       01915837
         EJECT                                                          01927837
         SPACE 1                                                        01933602
         EXTRN HEWLCUDB                                                 01941802
         SPACE 2                                                        01950021
*                  MASKS, FLAGS, OFFSETS AND VALUES                     01990021
         SPACE 2                                                        02030021
*                       FOR ALL PURPOSE TABLE                           02070021
         SPACE 1                                                        02110021
EOD      EQU   X'01'     END-OF-DATA FLAG IN NEWSW                      02150021
RT       EQU   X'02'     TEXT FLAG IN APT0  (RLD/TEXT)                  02190021
DEL      EQU   X'10'     DELETE FLAG IN APT1                            02230021
EX       EQU   X'20'     LOAD MODULE FLAG IN APT1  (LD MOD/OBJ MOD)     02270021
OI       EQU   X'20'     OVERLAY FLAG IN PDSE7                          02310021
TUPAS    EQU   X'20'     2 PASS OPERATION IS CURRENT                    02350021
DELOFF   EQU   X'EF'     MASK OUT DELETE FLAG IN APT1                   02390021
ANY      EQU   X'EF'     FLAGS FOR ANY RLD ATTRIBUTES IN PDSE8          02430021
         SPACE 2                                                        02470021
*                       FOR RENUMBERING TABLE                           02510021
         SPACE 1                                                        02550021
DID      EQU   0         OFFSET FOR 'R' ID                              02590021
DF       EQU   2         OFFSET FOR FLAG IN RNT                         02630021
DT       EQU   3         OFFSET FOR TYPE IN RNT                         02670021
DSAV     EQU   X'04'     DELINK VALUE SAVED FLAG IN RNT                 02710021
CH       EQU   X'40'     CHAINED FLAG FOR TYPE IN RNT                   02750021
         SPACE 2                                                        02790021
*                             FOR DCB                                   02830021
         SPACE 1                                                        02870021
PHL      EQU   0         INITIAL DATA COUNT                             02910021
PHADD    EQU   0         INITIAL DATA AREA LOCATION                     02950021
LENGTH   EQU   6         OFFSET FOR DATA COUNT                          02990021
ADD      EQU   12        OFFSET FOR DATA AREA LOCATION                  03030021
DCBOPN   EQU   X'10'     SUCCESSFUL OPEN                                03070021
OPNFLGS  EQU   48        OPEN FLAGS IN DCB                              03110021
         SPACE  2                                                       03150021
*                           FOR RLD ITEM                                03190021
         SPACE 1                                                        03230021
CONT     EQU   1         CONTINUATION FLAG IN FA                        03270021
RELOFF   EQU   X'7F'     MASK OUT RELATIVE FLAG                         03310021
NREL     EQU   X'80'     NONRELATIVE FLAG IN 'R' POINTER                03350021
REL      EQU   X'80'     RELATIVE FLAG IN FA FIELD                      03390021
CONTN    EQU   X'FE'     CONTINUATION FLAG IN FA MASK OUT               03430021
ANYR     EQU   X'F0'     ANY TYPE FLAGS IN FA                           03470021
*                            FOR MODULE                                 03550021
         SPACE 1                                                        03590021
BUFFRN2  EQU   X'01'     BUFFER 2 IS CURRENT                            03630021
BUFF1    EQU   X'02'     BUFFER 1 FULL                                  03670021
FNLCHK   EQU   X'02'     FINAL CHECK AT EOD                             03710021
CHKNOW   EQU   X'04'     CHECK LAST WRITE NOW                           03750021
BUFF2    EQU   X'04'     BUFFER 2 FULL                                  03790021
FULL2    EQU   X'06'     BUFFERS 1 AND 2 BOTH FULL                      03830021
BUFW1    EQU   X'08'     BUFFER 1 WRITTEN                               03870021
PURGE    EQU   X'08'     PURGE FLAG                                     03910021
BUFW2    EQU   X'10'     BUFFER 2 WRITTEN                               03950021
RNBUF2   EQU   X'10'     RLD'S-IN-BUFFER-2 FLAG                         03990021
NLFULL   EQU   X'10'     NOTE LIST FULL FLAG                            04030021
MCT      EQU   12        MAX SIZE FOR RLD/TXT I/O CONTROL TABLE         04070021
CKNNLF   EQU   X'14'     CHECK NOW AND NOTE LIST FULL                   04110021
WRIT2    EQU   X'18'     BUFFERS 1 AND 2 BOTH WRITTEN                   04150021
FULLR    EQU   X'20'     RLD I/O CONTROL TABLE FULL FLAG                04190021
BUF1CHK  EQU   X'20'     BUFFER 1 CHECKED FLAG                          04230021
BUF2CHK  EQU   X'40'     BUFFER 2 CHECKED FLAG                          04270021
NOPNR1   EQU   X'7F'     BUFFER 1 OPENER FLAG MASK OUT                  04310021
CONTOVN  EQU   X'7F'     CONTINUATION OVERFLOW FLAG MASK OUT            04350021
CONTOV   EQU   X'80'     CONTINUATION OVERFLOW FLAG                     04390021
OPNR1    EQU   X'80'     BUFFER 1 OPENER FLAG                           04430021
OP1BF2   EQU   X'81'     OPENER 1 AND BUFFER 2 NOW FLAGS                04470021
NBUF2CHK EQU   X'BF'     BUFFER 2 CHECKED FLAG MASK OUT                 04510021
NBUF1CHK EQU   X'DF'     BUFFER 1 CHECKED FLAG MASK OUT                 04550021
N2BUFWF  EQU   X'E1'     BOTH BUFFERS FULL AND WRITTEN FLAGS MASK OUT   04590021
NBUF2WF  EQU   X'EB'     BUFFER 2 FULL-WRITTEN FLAGS MASK OUT           04630021
NLFLCHKN EQU   X'EB'     NOTE LIST FULL + CHK NOW FLAGS MASK OUT        04670021
NBUFW2   EQU   X'EF'     BUFFER 2 WRITTEN FLAG MASK OUT                 04710021
RNBUF1   EQU   X'EF'     RLD'S-IN-BUFFER-1 MASK                         04750021
NBUF1WF  EQU   X'F5'     BUFFER 1 FULL-WRITTEN FLAGS MASK OUT           04790021
NBUFW1   EQU   X'F7'     BUFFER 1 WRITTEN FLAG MASK OUT                 04830021
NPURGE   EQU   X'F7'     PURGE FLAG MASK OUT                            04870021
NCHKNOW  EQU   X'FB'     CHECK NOW FLAG MASK OUT                        04910021
NBUFF2   EQU   X'FB'     BUFFER 2 FULL FLAG MASK OUT                    04950021
NBUFF1   EQU   X'FD'     BUFFER 1 FULL FLAG MASK OUT                    04990021
NFNLCHK  EQU   X'FD'     FINAL CHECK FLAG MASK OUT                      05030021
BUFLIP   EQU   X'FE'     EXTRACT CURRENT BUFFER FLAG MASK               05070021
BUFFRN1  EQU   X'FE'     BUFFER 1 CURRENT MASK                          05110021
STMULT   EQU   X'02'               FOR MAXIMUM STRING                   05150021
STMULT1  EQU   X'00'                  MULTIPLICITY                      05190021
*                           FOR NOTE LIST                               05270021
         SPACE 1                                                        05310021
NFLGS    EQU   X'03'     NO FLAGS MASK                                  05350021
BUFN2    EQU   X'10'     BUFFER 2 HOLDS CURRENT RLD'S                   05390021
TTRF     EQU   X'40'     TTR IS PRESENT/END-OF-BUFFER                   05430021
NICF     EQU   X'6F'     RLD'S NOT-IN-CORE MASK                         05470021
INCF     EQU   X'80'     RLD'S IN-CORE FLAG                             05510021
GPF      EQU   X'BF'     SET GROUP FLAG MASK                            05550021
FLGS     EQU   X'FC'     ALL FLAGS MASK                                 05590021
XPDIND   EQU   X'80'                   EXPAND REQUEST SWITCH     Y01031 05600000
*                                      (IN APTSW3; ONE=ACTIVE)   Y01031 05610000
         SPACE 2                                                        05630021
*                             FOR CESD                                  05670021
         SPACE 1                                                        05710021
DSAVOF   EQU   X'EF'     MASK OUT DELETE FLAG IN CESD                   05750021
         SPACE 2                                                        05790021
******** ERROR MSG **************************************************** 05830037
MSG      EQU   0       ALSO SEE IEW0284/IEW0222/IEW0614                 05860037
IEW0234  EQU   X'417'  LOAD MODULE SOURCE ERROR        OY00131,@XA11151 05880037
IEW0354  EQU   X'423'  CALLS LIST OVERFLOW                              05900037
IEW0622  EQU   X'023E'                                                  05920037
IEW0374  EQU   X'425'  RLD I/O CONTROL TABLE OVERFLOW                   05940037
IEW0382  EQU   X'226'                                                   05960037
IEW0364  EQU   X'424'                                                   05980037
*********************************************************************** 06040037
*                       REGISTER ASSIGNMENTS                            06070021
         SPACE 1                                                        06110021
R0       EQU   0         SAVE/RESTORE, ERROR CODE, WORK REG             06150021
GR1      EQU   1         CESD ID, LINK THROUGH MULTDET, RESULTANT TTR   06190021
XS3      EQU   1         'R' ID                                         06230021
XAPT     EQU   2         POINTER TO APT                                 06270021
XRMK2    EQU   3         BYTE CT OF PROCESSED ENTRIES IN RLD I/O CTL TB 06310021
XAA      EQU   3         CURRENT LOC IN TEXT BUFFER                     06350021
GR3      EQU   3         POINTER TO CESD, ASSEMBLED ADDR IN FA          06390021
XJM1     EQU   4         INPUT REC BYTE CT, TEXT OUTPUT BUFFER BYTE CT  06430021
XPSAV    EQU   4         'P' ID, POINTER TO ID IN RNT                   06470021
GR4      EQU   4         START OF RLD STRING, DIVISION WORK REG         06510021
GR5      EQU   5         START RNT, DIVISION WORK REG                   06550021
XRET2    EQU   5         LINK THROUGH WRITE ROUTINE                     06590021
XPRLD    EQU   6         ORIGINAL POINTER TO START OF RLD STRING,       06630021
*                            CURRENT FA POINTER                         06670021
XBCNT    EQU   7         BYTE COUNT OF PROCESSED ITEMS                  06710021
XIBCNT   EQU   8         RLD STRING BYTE COUNT                          06750021
XRET     EQU   9         LINK THROUGH BUFFERING ROUTINE                 06790021
GR9      EQU   9         CURRENT RNT ENTRY POINTER                      06830021
XOBCNT   EQU   10        BYTE COUNT OF ITEMS IN RLD BUFFER              06870021
XDCB     EQU   10        POINTER TO SYSUT1 DCB                          06910021
XSTR     EQU   11        POINTER TO START OF RLD STRING                 06950021
RBASE    EQU   12        MODULE BASE REGISTER                           06990021
GR13     EQU   13        BASE REGISTER FOR MODULE SAVE AREA, POINTER    07030021
*                            TO CURRENT CESD ENTRY                      07070021
R14      EQU   14        RETURN LINK, WRITE DATA LENGTH                 07110021
XS1      EQU   14        POINTER TO CURRENT DELINK ENTRY, TO CURRENT    07150021
*                            CALLS LIST ENTRY, TO CURRENT CESD ENTRY,   07190021
*                            TEXT NOTE LIST OFFSET                      07230021
XS2      EQU   15        POINTER TO CURRENT RLD BUFFER ENTRY,           07270021
*                            TO CURRENT TEXT NOTE LIST ENTRY, TO        07310021
*                            CURRENT TEXT BUFFER ENTRY, WORK REG        07350021
R15      EQU   15        BRANCH ADDRESS, WRITE DATA LOC, CURRENT LOAD   07390021
*                            MODULE BUFFER ENTRY, WORK REG              07430021
XRIO     EQU   15        CURRENT RLD NOTE LIST ENTRY POINTER            07470021
WRKREG0  EQU   0                   WORK REGISTER 0                      07510021
WRKREGF  EQU   15                  WORK REGISTER 15                     07550021
RETURN   EQU   14                  RETURN REGISTER                      07590021
BRANCH   EQU   15                  BRANCH REGISTER                      07630021
         TITLE 'HEWLFRAT   RLD/TXT PROCESSOR  --  ENTRY AND EXIT'       07670021
*                           R L D / T X T                               07710021
*              C O M M O N   E N T R Y   AND   E X I T                  07750021
*                              ROUTINE                                  07790021
         SPACE 2                                                        07830021
*     THIS ROUTINE RECEIVES CONTROL FROM THE INPUT PROCESSOR.  IT SAVES 07870021
*  THE RETURN ADDRESS, DIFERENTIATES BETWEEN RLD AND TEXT MATERIAL, AND 07910021
*  PASSES CONTROL TO THE PROPER PROCESSING ROUTINE.  AT THE CONCLUSION  07950021
*  OF THIS PROCESSING, IT RE-ESTABLISHES THE RETURN ADDRESS AND RETURNS 07990021
*  CONTROL THERETO.                                                     08030021
*     EVENT SEQUENCE FOR ENTRY --                                       08070021
*        ESTABLISH BASE REGISTER FOR COMMON ROUTINES AND RLD PROCESSOR. 08110021
*        SAVE RETURN ADDRESS.                                           08150021
*        LOAD REMAINING BUFFERRED BYTE COUNT                            08190021
*        PROCEED TO PURGE RLD AND TEXT BUFFERS IF ENTRY IS FROM         08230021
*           END-OF-DATA.                                                08270021
*        DIRECT CONTROL TO EITHER THE RLD OR TEXT PROCESSING ROUTINE.   08310021
*        RELINQUISH CONTROL TO ERROR ROUTINE IF INPUT LENGTH IS         08350021
*           GREATER THAN MAXIMUM.                                       08390021
*        CLEAR STRING COUNT AND SAVE INPUT BYTE COUNT FOR RLD           08430021
*           PROCESSING ROUTINE.                                         08470021
*     EVENT SEQUENCE FOR PURGE/EXIT --                                  08510021
*        PURGE --                                                       08550021
*           CLEAR STRING COUNT ACCUMULATOR                              08590021
*           LINK TO RLD PURGE ROUTINE.                                  08630021
*           LINK TO TEXT PURGE ROUTINE.                                 08670021
*        EXIT --                                                        08710021
*           SAVE RLD BUFFERRED BYTE COUNT (RLD RETURN).                 08750021
*           LOAD RETURN ADDRESS (TEXT RETURN).                          08790021
*           RETURN TO CALLER.                                           08830021
         SPACE 2                                                        08870021
*HEWLFRAT  CSECT               ENTRY POINT AND NAME                     08910021
         BALR  RBASE,R0        L BASE REGISTER                          08950021
RATLOC   EQU   *               DEFINE BASE LOCATION                     08990021
         USING *,RBASE         DEFINE BASE REGISTER                     09030021
         USING APTDSECT,XAPT                                            09070021
         B     OVERNAME        SKIP IDENTITY                            09110037
DATE     DC    C' 06/15/78 OZ33611 ' DATE/APAR NUMBER                   09130037
MODID1   DC    C' HEWLFRAT ',0H'0'   MOD ID                             09170037
OVERNAME L     XBCNT,TXT001AD  L BASE REGISTER FOR TEXT PROCESSING RTN  09210037
         USING HEWLFTXT,XBCNT  DEFINE BASE REGISTER FOR TEXT PROCESSOR  09230021
         ST    R14,INADD1      SAVE CALLER RETURN ADDRESS               09270021
         LH    XOBCNT,OBCNT    L REMAINING BUFFERRED COUNT              09310021
         TM    NEWSW,EOD       CHK FOR END-OF-DATA                      09350021
         BC    7,ECPRG         BC IF YES TO PURGE ROUTINES              09390021
         LTR   XJM1,XJM1       NO -- CHK IF INPUT BYTE COUNT IS ZERO    09430021
         BC    8,TXTRET        IGNORE ZERO LENGTH TXT OR RLD INPUT      09470021
         TM    APT0,RT         CHK IF RLD OR TEXT                       09510021
         BC    8,RATIN         BC IF RLD                                09550021
         L     XS2,TXTBFEND    L LOC OF END OF TEXT BUFFER              09590021
         S     XS2,TXTBFBEG    LESS LOC OF START OF TEXT BUFFER         09630021
         CR    XJM1,XS2        CHK IF INPUT GREATER THAN SPAN           09670021
         BC    2,ERR3        INPUT RECORD LARGER THAN TXTBUFFER         09710021
         TM    APT1,EX         IS IT A LOAD MODULE?                     09720003
         BO    TXTLM           BRANCH IS YES                            09730003
TXT0011  LTR   RID,RID         IS TXT ID EQUAL ZERO?                    09740003
         BC    8,TXTILL        YES, ERROR COND                          09742003
         CH    RID,ENCDX       TXT ID G.T. NUMBER OF ESD ITEMS          09744003
         BH    TXTILL          YES, ERROR COND                          09746003
         TM    APTSW3,XPDIND   EXPAND REQUEST?                   Y01031 09748003
         BO    TXT0151X        IF SO BRANCH                      Y01031 09748403
         SLL   RID,2           CALCULATE RENUMBER LINE                  09748803
         A     RID,RECNT       ENTRY                                    09749203
         CLC   DID(2,RID),CONZO1 IS RENUMBERED ID EQU ZERO              09749603
         BE    TXTILL          YES, ERROR COND                          09749703
         TM    DT(RID),DEL     IS THIS ID TO BE DELETED                 09749803
         BO    TXTLM2          BRANCH IF SO                             09749903
         TM    DT(RID),DT      TYPE NOT SD OR PC - INVALID              09763203
         BZ    TXT00151                                                 09773203
*   IF ERROR BRANCH IS TAKEN, MODULE MARKED NOT                         09775203
*   EXECUTABLE UNLESS 'LET' IS SPECIFIED                                09775603
TXTILL   LA    MSG,IEW0382                                              09776037
         TM    APT1,EX         IS IT A LOAD MODULE?              A43127 09776403
         BO    ERR3A           YES,ISSUE MSG AND FLUSH NEXT REC  A43127 09776503
         B     ERROR                                                    09776603
TXT00151 LH    RID,DID(RID)    RID=NEW UPDATED ID                       09781003
TXT0151X LR    XS1,RID         XS1=NEW UPDATED ID                Y01031 09783003
         STH   XS1,CURID                                                09785003
*DETERMINE MULTIPLICITY AND CHECK FOR '512' MAXIMUM                     09785403
         SLL   XS1,4                                                    09785503
         A     XS1,CHESD       XS1=ABSOLUTE ADDR OF ENT. IN CESD        09796603
         L     XS1,8(XS1)      XS1=TYPE AND ASSEMBLED ADDRESS           09806603
         LA    XS1,0(XS1)      XS1=ASSEMBLED ADDR. OF CONTROL SECTION   09807003
         TM    APTSW3,XPDIND   EXPAND REQUESTED?                 Y01031 09807403
         BO    TXT0152X        IF SO BRANCH                      Y01031 09807503
         SR    XAA,XS1         ASSM ADDR NOW RELATIVE TO ZERO           09807603
TXT0152X LR    GR9,XAA                                           Y01031 09807703
         SR    GR8,GR8         DIVIDE BY SYSLMOD SIZE TO                09811403
         D     GR8,MULTSIZE    DETER. MULTIPLICITY AND DISPLACEMENT     09813403
         STH   GR9,CMULN                                                09813803
         STH   GR8,CDISP                                                09814203
         CH    GR9,MAXMULT     BRANCH IF WE HAVE NOT EXCEEDED           09814603
         BL    SPLTXT1         THE NUMBER OF MULTIPLICITIES    @ZA28721 09815037
         LA    MSG,IEW0364     INPUT HAS EXCEEDED MULT LIMIT            09815437
         B     ERROR                                                    09815837
*                                                                       09816237
* SPECIAL TEXT IS SET ON IF THIS IS THE FIRST TEXT RECORD               09816337
* OF A CSECT IN A LOAD MODULE AND A LARGE DEFINE STORAGE                09816437
* IS THE FIRST THING IN THE CSECT AND THE DS AREA CROSSES               09816537
* A MULTIPLICITY.                                                       09816637
*                                                                       09816737
SPLTXT1  EQU *                                                 @ZA28721 09816837
         LTR   XAA,XAA         TST FOR REMAINDER               @ZA28721 09816937
         BC    8,TXTINT        BR IF ZERO                      @ZA28721 09817337
         TM    APT1,EX         IS IT A LOAD MODULE?            @ZA28721 09817437
         BNO   TXTINT          BYPASS IF NOT                   @ZA28721 09817837
         CLC   PID(2),CURID    CURRENT ID A REPEAT?            @ZA33611 09817937
         BE    TXTINT          BRANCH IF YES                   @ZA33611 09818037
         TM    APTSW3,XPDIND   EXPAND REQUESTED?               @ZA28721 09818137
         BO    TXTINT          BYPASS IF EXPAND REQUESTED      @ZA28721 09818237
         SR    GR9,GR9         CLEAR REG 9                     @ZA28721 09818337
         AR    GR9,COUNT       ADD THE RECORD COUNT  TO  THE   @ZA33611 09818437
         AH    GR9,CDISP       DISPLACEMENT OF THE FIRST TXT   @ZA33611 09818537
         C     GR9,MULTSIZE    AND TEST IF IT CROSSES TO NXT   @ZA28721 09819437
         BNH   TXTINT          MULTIPLICITY,BR IF IT DOESN'T!  @ZA28721 09819837
         OI    SWITCH+1,SPTXTON  TURN SPECIAL TXT ON           @ZA28721 09820237
         B     TXTINT                                          @ZA28721 09820637
*   PASS INITIAL CHECKS                                                 09821037
         BCR   15,XBCNT        GO TO PROCESS TEXT                       09822603
RATIN    LH    XS2,ENRLD2X     RLD -- L SIZE OF RLD INPUT BUFFER        09826303
         CR    XJM1,XS2        CHK IF INPUT GREATER                     09830021
         BC    2,ERR1          BC IF YES -- ERROR                       09870021
         SR    XIBCNT,XIBCNT   CLEAR STRING COUNT ACCUMULATOR           09910021
         STH   XJM1,TTR1       SAVE RLD INPUT BYTE COUNT                09950021
RATINX   BC    15,RLD001       GO TO PROCESS RLD'S                      09990021
         SPACE 1                                                        10030021
ECPRG    SR    XIBCNT,XIBCNT   CLEAR STRING COUNT ACCUMULATOR           10070021
         BAL   XRET,RLDBUF     INPUT BYTE CT ZERO -- PURGE RLD          10110021
ECPRGX   STH   XIBCNT,OBCNT    CLEAR PREVIOUS BUFFERRED COUNT           10150021
         LA    XRET,TXTRET     SET INTERMEDIATE RETURN                  10190021
         L     R14,TXTBUFAD    L LOC OF TEXT PURGE ROUTINE              10230021
         BCR   15,R14          GO TO TEXT PURGE ROUTINE                 10270021
         SPACE 1                                                        10310021
RLDRET   STH   XOBCNT,OBCNT    SAVE BUFFERRED BYTE COUNT                10350021
         SPACE 1                                                        10390021
TXTRET   L     R15,INADD1      L RETURN ADDRESS                         10430021
         BALR  R14,R15         RETURN (WITH LINK)                       10470021
         SPACE 1                                                        10510021
MOVEJM1  MVC   0(0,XS2),0(XSTR)  MOVE INSTR TO MOVE ITEM TO BUFFER      10550021
         BC    15,RLD0161      CONTINUE PROCESSING IF LINKED            10590021
         SPACE 1                                                        10630021
MOVEJM1A MVC   0(4,XS2),SAVIDS   MOVE 'R' AND 'P' ID'S INTO BUFFER      10670021
         SPACE 1                                                        10710021
         TITLE 'HEWLFRAT   RLD/TXT PROCESSOR  --  WRITE ROUTINE'        10750021
*                          R L D / T X T                                10790021
*                     C O M M O N   W R I T E                           10830021
*                             ROUTINE                                   10870021
         SPACE 1                                                        10910021
*  THIS ROUTINE WRITES THE RLD AND TEXT INTERMEDIATE OUTPUT AS WELL   * 10950021
*  AS THE RLD AND TEXT NOTE LISTS AS REQUIRED.  AT ENTRY A TEST IS    * 10990021
*  MADE FOR RECORD SIZE ZERO.  ZERO SHOWS THE INPUT MODULE CONTAINED  * 11030021
*  NO TEXT OR RLD ITEMS OR THAT THE RLD ITEMS OCCURRED IN A MODULE    * 11070021
*  MARKED DELETE.  IN THE ZERO LENGTH CASE NO WRITE TAKES PLACE.      * 11110021
*  IF SYSUT1 HAS NOT BEEN OPENED PREVIOUSLY, IT IS OPENED NOW.          11150021
         SPACE 2                                                        11190021
RLDBUFR  LTR   R14,R14         CHK IF SIZE IS ZERO OR LESS              11230021
         BCR   12,XRET         BC IF YES -- RETURN                      11270021
COMBUF   LA    GR13,REGSA      SIZE NOT ZERO -- L LOC OF SAVE AREA      11310021
BUFFRET  L     XDCB,DCBAD      L LOC OF SYSUT1 DCB                      11350021
         STH   R14,DECBJM+LENGTH   SET DATA LENGTH IN DECB              11390021
         ST    R15,DECBJM+ADD   SET DATA AREA LOC IN DECB               11430021
         SPACE 1                                                        11470021
         TM    OPNFLGS(XDCB),DCBOPN  CHK IF DCB OPENED                  11510021
         BC    1,COMBUF2       BC IF YES                                11550021
         SPACE 1                                                        11590021
         MVC   DDNAME(8),40(XDCB)   NO -- RESERVE DD NAME               11630021
         OPEN  ((XDCB),(OUTIN))   OPEN SYSUT1 DCB                       11670021
         SPACE 1                                                        11710021
         TM    OPNFLGS(XDCB),DCBOPN   CHK IF OPEN SUCCESSFUL            11750021
         BC    1,COMBUF2       BC IF YES                                11790021
ABEND1   LA    GR1,DDNAME      NO -- L LOC OF DD NAME                   11830021
         LH    MSG,IEW0284     L ERROR CODE                             11870037
         LA    R14,TXTRET      L RETURN ADDRESS                         11910021
         L     R15,ERDIG       L LOC OF ERROR ROUTINE                   11950021
         BCR   15,R15          GO TO ERROR ROUTINE                      11990021
         SPACE 1                                                        12030021
COMBUF2  WRITE DECBJM,SF,(XDCB),PHADD,PHL                               12070021
         BCR   15,XRET2        RETURN                                   12110021
         SPACE  1                                                       12150021
COMCHK   LA    GR13,REGSA      L LOC OF SAVE AREA                       12190021
         L     XDCB,DCBAD      L ADDRESS OF SYSUT1 DCB                  12230021
         SPACE  1                                                       12270021
         CHECK DECBJM                                                   12310021
         SPACE 1                                                        12350021
         NOTE  (XDCB)                                                   12390021
         SPACE 1                                                        12430021
         SR    XOBCNT,XOBCNT   CLEAR BUFFERRED BYTE COUNT               12470021
         BCR   15,XRET2        RETURN                                   12510021
         SPACE 2                                                        12550021
DDNAME   DC    C'SYSUT1  '                                              12630021
         SPACE 2                                                        12670021
   TITLE 'HEWLFRAT   RLD/TXT PROCESSOR  --  ERROR ROUTINE INTERFACE'    12710021
*                    E R R O R     R O U T I N E                        12750021
*                         I N T E R F A C E                             12790021
         SPACE 2                                                        12830021
         SPACE 1                                                        12870021
ERR1     LH    MSG,IEW0222     L OBJECT MODULE ERROR CODE               12910037
         TM    APT1,EX         CHK IF IS OBJECT MODULE                  12950037
         BC    8,ERROR         BC IF YES TO ERROR ROUTINE INTERFACE     12990037
ERR2     LA    MSG,IEW0234     NO -- L ERROR CODE FOR LOAD MODULE       13030037
         SPACE 2                                                        13070021
*                   COMMON EXIT TO ERROR ROUTINE                        13110021
         SPACE 1                                                        13150021
ERROR    L     R15,ERDIG                                                13190021
         LA    R14,TXTRET                                               13230021
         BCR   15,R15                                                   13270021
         SPACE                                                          13310021
*     ERROR CAUSE BY INPUT EECORD LARGER THAN THAN THE TEXT BUFFER      13350021
*        REQUIRE ERROR MSG AND A DUMMY READ                             13390021
         SPACE                                                          13430021
ERR3     LA    MSG,IEW0234    LOAD MODULE RRROR MSG                     13470037
ERR3A    L     R15,ERDIG      ESTABLISH ADDR OF ERROR RTN        A43127 13510000
         BALR  R14,R15    PRINT ERROR MSG AND RETURN TO                 13550021
         LA    GR9,1            ISSUE BUMMY READ OF 1 TO ADVANCE TO     13590021
         B     READ0        TO THE NEXT RECORD                          13630021
     TITLE 'HEWLFRAT   RLD/TXT PROCESSOR  --  MULTIPLICITY ROUTINE'     13670021
*                            C O M M O N                                13710021
*        M U L T I P L I C I T Y   D E T E R M I N A T O R              13750021
*                              ROUTINE                                  13790021
         SPACE 2                                                        13830021
*     THIS ROUTINE DETERMINES THE LOWEST MULTIPLICITY IDENTITY          13870021
*  AND RELOCAND OF TEXT ITEM                                            13910021
*     XS1 AND XS2 = CBRC                                                13950021
*     XAA = ASSEMBLED ADDRESS OF 1ST BYTE OF TEXT                       13990021
*     XAA = GR3, GR3 = ADDRESS FIELD FOR RLD ITEM                       14030021
         SPACE 2                                                        14070021
         SPACE 2                                                        14110021
MULTDET  SLL   XS1,4           MULTIPLY 'ID' BY 16 (CESD LENGTH)        14150021
         A     XS1,CHESD       ADD LOC OF START OF CESD                 14190021
         L     XS1,8(XS1)      L TYPE/ADDRESS FROM EXTRACTED ENTRY      14230021
         LA    XS1,0(XS1)      CLEAR TO ASSEMBLED ADDRESS               14270021
         LCR   XS1,XS1         FORM COMPLEMENTED ADDRESS                14310021
         A     XS1,TXTBFBEG    ADD LOC OF TEXT BUFFER TO FORM CURRENT   14350021
*                                   BUFFER RELOCATION CONSTANT  (CBRC)  14390021
         LR    XS2,XS1         L CBRC IN XS2                            14430021
         LR    R0,XS1          SAVE REGISTER  (CBRC)                    14470021
         AR    XS2,XAA         ADD ASSEMBLED ADDRESS OF TEXT TO CBRC    14510021
         S     XS2,TXTBFBEG    SUBTRACT LOC OF TEXT BUFFER              14550021
         SR    XS1,XS1         CLEAR REMAINDER REGISTER                 14590021
         D     XS1,MULTSIZE    DIVIDE BY BUFFER SIZE FOR MULTIPLICITY   14630021
         N     XS2,STRUNC      LIMIT MULTIPLICITY TO 10 BITS            14670021
         BCR   15,GR1          RETURN                                   14710021
         SPACE 2                                                        14750021
         TITLE 'HEWLFRAT   RLD/TXT PROCESSOR  --  RLD PROCESSING'       14790021
*                 R L D    P R O C E S S I N G                          14830021
*                            ROUTINE                                    14870021
         SPACE 2                                                        14910021
*     THIS ROUTINE IS ENTERED FOR EACH 'R' AND 'P' FIELD.  IT RENUMBERS 14950021
*  THE 'R' AND 'P' POINTERS VIA THE RENUMBERING TABLE AND DETERMINES    14990021
*  WHEN IT IS NECESSARY TO ENTER THE DELINK ROUTINE.  THE ACTUAL        15030021
*  SETTING OF THE DELINK ENTRY WAS DONE BY THE ESD PROCESSOR.           15070021
*     XBCNT = CUMULATIVE BYTE COUNT OF INPUT RLD ITEMS WHICH HAVE BEEN  15110021
*        PROCESSED.  WHEN XBCNT = TTR1, END OF INPUT HAS BEEN REACHED.  15150021
*     XIBCNT = STRING BYTE COUNT.   A STRING CONSISTS OF A GROUP OF     15190021
*        CONTIGUOUS RLD ITEMS, EACH WITH A 'P' ID FIELD OF THE SAME ID. 15230021
*        ONE ENTRY FOR EACH STRING IS MADE IN THE RLD NOTE LIST.        15270021
*     XSTR = POINTER TO START OF A STRING -- INITIAL 'R' ID.            15310021
*     XPRLD = POINTER TO CURRENT FLAG-ADDRESS ITEM.  AT ENTRY XPRLD     15350021
*        HOLDS THE LOCATION OF THE FIRST RLD ITEM IN AN INPUT RECORD.   15390021
*        SUBSEQUENTLY IT IS THE POINTER TO THE FA FIELD OF EACH CURRENT 15430021
*        ITEM.                                                          15470021
         SPACE 1                                                        15510021
RLD001   SR    XBCNT,XBCNT     INITIALIZE INPUT COUNT TO ZERO           15550021
         MVC   ENCT(2),ENR1C   SET CURRENT NOTE LIST ENTRY COUNT        15590021
RLD002   SR    XIBCNT,XIBCNT   INITIALIZE STRING COUNT TO ZERO          15630021
         SPACE 1                                                        15670021
RLD002A  LA    XBCNT,8(XBCNT)  STEP BY 8 NO OF BYTES PROCESSED          15710021
         LR    XSTR,XPRLD      L START OF CURRENT STRING                15750021
         L     R14,BUFSTLOC    L BUFFERED STRING LOCATION               15790021
         LTR   R14,R14         CHK IF LOCATION SET                      15830021
         BC    7,RLD002B       BC IF YES                                15870021
         ST    XSTR,BUFSTLOC   NO -- SET WITH CURRENT STRING LOC        15910021
RLD002B  MVC   SAVIDS(4),0(XSTR)   RESERVE 'R' AND 'P' ID'S             15950021
         MVC   SAVIDR(2),0(XSTR)   SAVE RLD ITEM 'R' ID                 15990021
         LA    XPRLD,4(XPRLD)  STEP TO LOC OF NEXT FA FIELD             16030021
         MVI   STM,STMULT      RESET STRING MULTIPLICITY                16070021
         LH    XPSAV,SAVIDS+2           L 'P' NUMBER AND                16110021
         SLL   XPSAV,2           QUADRUPLE  (ID FIELD LENGTH)           16150021
         A     XPSAV,RECNT     ADD LOC OF RNT-4 TO FORM CURRENT RNT LOC 16190021
         CLC   DID(2,XPSAV),CONZO  IS RENUMBERED ID ZERO                16230021
         BC    8,ERR1          BC IF ZERO -- ERROR                      16270021
         LH    GR3,ENCDX               MAX # CESD = MAX # RNT'S  A53300 16280000
         SLL   GR3,2                   MULTIPLY BY 4             XM1384 16290002
         A     GR3,RECNT               GET HIGHEST ADDR OF RNT-4 A53300 16300000
         A     GR3,FOUR                HIGHEST VALID ADDR OF RNT A53300 16302000
         CR    GR3,XPSAV               IS IT A VALID P PTR?      A53300 16304000
         BL    ERR1                    NO - IEW0222              A53300 16306000
         OI    APT1,DEL        SET DELETE FLAG                          16310021
         TM    DT(XPSAV),DEL   IS P A DELETE                            16350021
         BC    1,RLD012        BC IF YES TO SKIP PROCESSING             16390021
         NI    APT1,DELOFF     NO -- RESET DELETE FLAG OFF              16430021
RLD003   CLC   DID(2,XPSAV),PREP  IS CURRENT P SAME AS PREVIOUS P       16470021
         BC    8,RLD0042       BC IF YES TO CONTINUE STRING             16510021
         LR    XRET,XOBCNT     L BUFFERRED BYTE COUNT                   16550021
         AR    XRET,XIBCNT     ADD CURRENT STRING COUNT                 16590021
         LA    XRET,4(XRET)    STEP BY 4                                16630021
         C     XRET,RLDSIZE    CHK AGAINST MAXIMUM BUFFER SIZE          16670021
         BC    10,RLD0042      BC IF EQUAL OR GREATER                   16710021
RLD0031  BAL   XRET,RLDBUF     NO -- GO TO BUFFER PREVIOUS STRING       16750021
*                                NOTE -- BUFFERING WILL NOT OCCUR IF    16790021
*                                    PREVIOUS P WAS A DELETE OR IF THIS 16830021
*                                    IS THE FIRST P POINTER IN A MODULE 16870021
RLD004   SR    XIBCNT,XIBCNT   RESET STRING COUNT TO ZERO               16910021
         TM    RLDFLGS,CONTOV  CHK FOR CONTINUATION OVERFLOW FLAG       16950021
         BC    8,RLD0041       BC IF NO                                 16990021
         NI    RLDFLGS,CONTOVN   CLEAR CONTINUATION OVERFLOW FLAG       17030021
         CH    XBCNT,TTR1      CHK IF INPUT EXHAUSTED                   17070021
         BC    10,RLDRET       RETURN IF YES                            17110021
         L     XSTR,SBACKUP    SET NEW STRING ORIGIN                    17150021
         ST    XSTR,BUFSTLOC   SET NEW BUFFERRED STRING LOC             17190021
         LR    XPRLD,XSTR      L NEW STRING ORIGIN                      17230021
         LA    XPRLD,4(XPRLD)   SET TO LOC OF NEXT FA FIELD             17270021
         LA    XBCNT,4(XBCNT)  STEP BY 4 NO OF INPUT BYTES PROCESSED    17310021
         LA    XPSAV,SAVIDS+2  RESERVE 'P' ID                           17350021
         BC    15,RLD0041A                                              17390021
RLD0041  ST    XSTR,BUFSTLOC   SET NEW BUFFERRED STRING LOC             17430021
RLD0041A MVC   PREP(2),DID(XPSAV)   RESERVE CURRENT 'P' AS PREVIOUS 'P' 17470021
RLD0042  MVC   SAVIDS+2(2),0(XPSAV)   SAVE NEW 'P' ID FOR RLD ITEM      17510021
RLD0043  NI    PDSE8,ANY       SET RLD FLAG ON                          17550021
         LA    XIBCNT,8(XIBCNT)  STEP STRING COUNT BY 8                 17590021
         LH    GR4,SAVIDR      L 'R' ID OF CURRENT ITEM                 17630021
         N     GR4,RIDMSK      CLEAR TO 'R' ID                          17670021
         LA    R14,RLD010      L PROCEED ADDRESS FOR 'P' RENUMBERING    17710021
         SPACE 2                                                        17750021
*                  RENUMBER 'ID' POINTER ROUTINE                        17790021
*                     WITH DELINK IF REQUIRED                           17830021
         SPACE 1                                                        17870021
RLD004A  LR    R0,R14          SAVE REGISTER 14                         17910021
         L     GR3,CHESD       L START OF CESD                          17950021
         L     GR5,RECNT       L START OF RNT-4                         17990021
         LR    GR9,GR4         L RLD 'ID'                               18030021
         SLL   GR9,2           QUADRUPLE  (ENTRY LENGTH)                18070021
         AR    GR9,GR5         ADD RNT START TO FORM CURRENT ENTRY LOC  18110021
         TM    0(XPRLD),X'30'  IS RLD A PSEUDO-REGISTER                 18150021
         BC    1,RLD012        BC IF YES -- SKIP RENUMBERING            18190021
         CLC   DID(2,GR9),CONZO  IS RENUMBERED ID ZERO                  18230021
         BC    8,ERR1          BC IF YES -- ERROR                       18270021
         LH    GR3,ENCDX               MAX # CESD = MAX # RNT'S  A53300 18280000
         SLL   GR3,2                   MULTIPLY BY FOUR          XM1384 18290002
         A     GR3,RECNT               GET HIGHEST ADDR OF RNT-4 A53300 18300000
         A     GR3,FOUR                HIGHEST VALID RNT ADDR    A53300 18302000
         CR    GR3,GR9                 VALID R PTR?              A53300 18304000
         L     GR3,CHESD               RESTORE START OF CESD -   A53300 18306000
*                                      DOESN'T CHANGE COND CODE  A53300 18308000
         BL    ERR1                    NO - IEW0222              A53300 18308400
         LH    GR1,DID(GR9)    L UPDATED ID                             18310021
         MVC   TEMP(1),3(GR9)          GET RNT TYPE             XA04649 18320003
         NI    TEMP,X'0F'              GET RID OF FLAGS         XA04649 18330003
         CLI   TEMP,X'04'              TEST FOR PC TYPE         XA04649 18340003
         BNE   RLD004B                 BRANCH IF NOT PC         XA04649 18342003
         TM    3(GR9),X'10'            TEST FOR DELETE FLAG     XA04649 18344003
         BNO   RLD004B                 BRANCH IF NOT PC DELETE  XA04649 18346003
         LR    GR13,GR1                SET UP WORK REG          XA04649 18348403
         SLL   GR13,4                  CALC CESD OFFSET         XA04649 18348803
         AR    GR13,GR3                GET CESD POINTER         XA04649 18349203
         NC    13(3,GR13),13(GR13)     TEST FOR 0-LENGTH PC     XA04649 18349603
         BNZ   RLD004B                 BRANCH IF NOT 0-LENGTH   XA04649 18349703
         LA    R0,IEW0622              SET UP MESSAGE IEW0622   XA04649 18349837
         B     ERROR                   GO TO LOG MESSAGE        XA04649 18349903
RLD004B  EQU   *                                                XA04649 18363203
         LR    GR13,GR1        USE UPDATED ID                           18376703
         SLL   GR13,4          MULTIPLY BY 16  (ENTRY LENGTH)           18390021
         AR    GR13,GR3        ADD START OF CESD TO FORM CURRENT LOC    18430021
         TM    DT(GR9),DEL     IS TYPE IN RNT A DELETE                  18470021
         BC    8,RLD008        BC IF NO                                 18510021
         TM    DF(GR9),DSAV    YES, IS DELETE -- IS DELINK VALUE SAVED  18550021
         BC    1,RLD007        BC IF YES                                18590021
         TM    0(XPRLD),ANYR   DELINK NOT SAVED -- IS TYPE NON-BRANCH   18630021
         BC    5,RLD0061       BC IF NO TO SKIP DELINKING               18670021
         SPACE 1                                                        18710021
RLD005   L     R15,ADDEL       NON-BRANCH TYPE -- L LOC OF DELINK RTN   18750021
         S     GR9,RECNT               HOLD RNT OFFSET          XA05656 18760003
         BALR  R14,R15         GO TO PERFORM DELINK                     18790021
         LR    R14,R0          RESTORE REGISTER 14                      18830021
         A     GR9,RECNT               RECALC RNT ADDR          XA05656 18840003
         SPACE 1                                                        18870021
RLD0061  NI    8(GR13),DSAVOF  SET DELETE FLAG OFF IN CESD              18910021
         TM    DF(GR9),DSAV    IS DELINK VALUE SAVED                    18950021
         BC    8,RLD008        BC IF NO                                 18990021
RLD007   TM    0(XPRLD),ANYR   IS RNT TYPE A NON-BRANCH                 19030021
         BC    5,RLD009        BC IF NO                                 19070021
MOVEJM2  MVC   DELR(2),DID(GR9)  SAVE RENUMBERED ID                     19110021
         OI    APTSWS,X'08'    SET DELINKED 'R' RECEIVED FLAG           19150021
         BCR   15,R14          RETURN TO DELINK CALLER                  19190021
         SPACE 1                                                        19230021
RLD008   TM    DT(GR9),CH      IS RNT TYPE FLAGGED AS CHAINED           19270021
         MVC   SAVIDS(2),DID(GR9)   SAVE RENUMBERED ID FOR OUTPUT       19310021
*                                NOTE -- THIS INSTRUCTION DOES NOT      19350021
*                                  CHANGE CONDITION CODE                19390021
         BCR   8,R14           NOT CHAINED -- MOVE INSTR OK -- RETURN   19430021
         MVC   SAVIDS(2),14(GR13)   CHAINED -- OVERWRITE FIRST MOVE     19470021
         BCR   15,R14          RETURN TO CALLER                         19510021
         SPACE 1                                                        19550021
RLD009   LA    XS1,5           L SIZE OF DELINK TABLE ENTRY             19590021
         MH    XS1,0(GR9)      MULTIPLY BY ENTRY NUMBER                 19630021
         A     XS1,DLKT        ADD START OF DELINK TABLE TO FORM DELINK 19670021
*                                ENTRY LOC                              19710021
         MVC   SAVIDS(2),0(XS1)   RENUMBER 'R' WITH DELINK TABLE ID     19750021
         LR    R14,R0          RESTORE REGISTER 14                      19790021
         BCR   15,R14          RETURN TO CALLER                         19830021
         SPACE 2                                                        19870021
         EJECT                                                          19910021
*                 OVERLAY CALLS LIST ENTRY ROUTINE                      19950021
         SPACE 1                                                        19990021
*         IF OVERLAY IS SPECIFIED,  AND IF THE REFERENCE IS TO A 4-BYTE 20030021
*  CONSTANT, THIS ROUTINE IS ENTERED.  IF THE REFERENCE AND THE POINTER 20070021
*  ARE IN THE SAME CSECT NO ACTION IS TAKEN.  IF THE 'P' ID IS DIFERENT 20110021
*  FROM THE PREVIOUS 'P' ENTERED, THE 2 BYTE CHAINING FIELD IS CLEARED, 20150021
*  THE NEW 'P' IS INSERTED IN THE NEXT 2 BYTE AREA, AND THE CURRENT 'R' 20190021
*  ID FOLLOWS IN THE NEXT 2 BYTE AREA.  IF THE NEW 'P' ID MATCHES THE   20230021
*  PREVIOUS 'P', THE CURRENT 'R' ID IS ENTERED DIRECTLY IN THE FIRST 2  20270021
*  BYTES.  THE UPDATED CUMULATIVE CALLS LIST BYTE COUNT IS SAVED IN APT 20310021
*  (ENCLC).  WHEN THIS CALLS LIST LENGTH EXCEEDS MAXIMUM (ENCLX),  AN   20350021
*  ERROR INDICATION IS GENERATED.                                       20390021
         SPACE 1                                                        20430021
RLDCALL  TM    PDSE7,OI        CHK FOR OVERLAY                          20470021
         BC    8,RLD012        BC IF NO -- SKIP CALLS LIST ENTRY        20510021
         TM    0(XPRLD),X'0C'  IS OVERLAY -- CHK IF 4 BYTE CONSTANT     20550021
         BC    12,RLD012       BC IF NO -- SKIP CALLS LIST ENTRY        20590021
         SPACE 1                                                        20630021
         LH    XS1,ENCLC       L CURRENT BYTE COUNT OF CALLS LIST       20670021
         A     XS1,CLLT        ADD START OF CALLS LIST TO FORM CURRENT  20710021
*                                  ENTRY LOCATION                       20750021
         LH    XS3,SAVIDS      L CURRENT 'R' ID                         20790021
         N     XS3,RIDMSK      CLEAR TO 'R' ID                          20830021
         TM    APTSWS,X'08'            IS DELINK VALUE SAVED?           20870021
         BZ    RLDCLA                  NO, BRANCH OUT                   20910021
         MH    XS3,FIVEFIVE            YES, MULT DELINK ID BY 5         20950021
         A     XS3,DLKT                ADD TO DELINK TABLE ADDR         20990021
         MVC   DLKTSAVE(2),0(XS3)      SAVE TRUE R ID                   21030021
         LH    XS3,DLKTSAVE            PICK UP TRUE R ID                21070021
RLDCLA   LH    XS2,SAVIDS+2            PICK UP CURRENT P ID             21110021
         CR    XS2,XS3         CHK IF 'R' EQUALS 'P'  (IN SAME CSECT)   21150021
         BC    8,RLD012        RETURN IF YES -- NO ENTRY REQUIRED       21190021
         CH    XS2,CALLCURP    DOES 'P' EQUAL PREVIOUS 'P'              21230021
         BC    8,CALLR         BC IF YES                                21270021
CALLPANR MVI   0(XS1),0        NO --    CLEAR                           21310021
         MVI   1(XS1),0             CHAINING FIELD                      21350021
         STH   XS2,2(XS1)      SET CURRENT 'P' IN CALLS LIST            21390021
         STH   XS2,CALLCURP    SAVE NEW 'P' FOR FUTURE CHECK            21430021
         LA    XS1,4(XS1)      STEP ENTRY POINTER BY 4 TO 'R' AREA      21470021
CALLR    STH   XS3,0(XS1)      SET CURRENT 'R' IN CALLS LIST            21510021
         LA    XS1,2(XS1)      STEP ENTRY POINTER TO NEXT 'R' FIELD     21550021
*                                   (OR NEXT ENTRY)                     21590021
         S     XS1,CLLT        SUBTRACT CALLS LIST START TO GET BYTE CT 21630021
         STH   XS1,ENCLC       SAVE UPDATED CALLS LIST BYTE COUNT       21670021
         AH    XS1,SIX                 ADD 6 BYTES TO COUNT      XM6209 21680000
CALLR02  CH    XS1,ENCLX       CHK IF BYTE CNT IS AT OVRFLO SIZE XM6209 21710000
         BNH   CALLR01       NO -- CONTINUE               A52402,XM6209 21750000
         TM    APT4,REALOCTE    IS REALOC POSSIBLE?              S01904 21790021
         BNO   CALLR1            YES,TRY REALLOCATING            S01904 21830021
         LA    MSG,IEW0354     YES -- L CALLS LIST OVERFLOW ERROR CODE  21870037
         BC    15,ERROR        GO TO ERROR ROUTINE INTERFACE            21910021
CALLR01  SH    XS1,SIX                 SET BACK TO TRUE COUNT    XM6209 21920000
         B     RLD012                  CONTINUE PROCESSING       XM6209 21930000
SIX      DC    H'6'                    SIX BYTES                 XM6209 21940000
CALLR1   STM   WRKREG0,WRKREGF,BRNCHSV SAVE REGISTERS            S01904 21950021
         L     BRANCH,ERDIGA       GET ADDR OF REALOC RT         S01904 21990021
         BALR  RETURN,BRANCH       GO TO REALLOCATE              S01904 22030021
         LM    WRKREG0,WRKREGF,BRNCHSV  RESTORE REGISTERS        S01904 22070021
         B     CALLR02             CONTINUE               S01904,XM6209 22110000
         SPACE 2                                                        22150021
         EJECT                                                          22190021
*     THIS SEQUENCE IS ENTERED FOR EACH FLAG-ADDRESS FIELD (FA).  IT    22230021
*  POSTS THE FLAG FIELD WITH THE PROPER INDICATION FOR AN ABSOLUTE OR   22270021
*  A RELATIVE RELOCATION CONSTANT OR FOR A PSEUDO-REGISTER.  IT FINDS   22310021
*  THE LOWEST MULTIPLICITY IN A STRING OF RLD ITEMS OF THE SAME 'P'     22350021
*  POINTER AND ENTERS THAT MULTIPLICITY IN THE RLD NOTE LIST ENTRY FOR  22390021
*  THAT 'P' POINTER.                                                    22430021
         SPACE 2                                                        22470021
RLD010   EQU   *               DEFINE SYMBOL                            22510021
         NI    0(XPRLD),X'7F'          CLEAR POSSIBLE FLAGS FROM        22550021
*                                   PREVIOUS SECOND PASS PROCESSING     22590021
*                                        (IF EXECUTABLE MODULE)         22630021
         TM    0(XPRLD),X'30'  IS THIS A PSEUDO-REGISTER                22670021
         BC    1,RLD012        YES -- SKIP PROCESSING                   22710021
         TM    0(XPRLD),X'10'  IS FLAG A BRANCH TYPE                    22750021
         BC    1,RLDCALL       YES -- GO TO CHK FOR OVERLAY             22790021
         TM    DT(GR9),DEL     CHK IF DELETE FLAG IN RNT                22830021
         BC    8,RLD010A       BC IF NOT DELETE                         22870021
         SPACE 1                                                        22910021
         BAL   R14,RLD004A     DELETE -- DELINK IF REQUIRED             22950021
         SPACE 1                                                        22990021
RLD010A  MVC   FLAG(1),DT(GR9) GET TYPE BYTE FROM RNT                   23030021
         NI    FLAG,X'07'      ISOLATE TYPE FLAGS                       23070021
         CLI   FLAG,X'06'      IS PSEUDO-REGISTER                       23110021
         BC    7,RLD011        BC IF NO                                 23150021
         OI    0(XPRLD),X'20'  YES -- FLAG RLD ITEM AS PR               23190021
         BC    15,RLD012                                                23230021
         SPACE 1                                                        23270021
RLD011   CLI   FLAG,X'02'      IS EXTERNAL REFERENCE                    23310021
         BC    8,RLD012        BC IF YES                                23350021
         TM    DT(GR9),DEL     NO -- CHK FOR DELETE IN RNT              23390021
         BC    1,RLD012        YES -- FLAG REMAINS ABSOLUTE             23430021
         OI    0(XPRLD),REL    NOT DELETE -- FLAG AS RELATIVE           23470021
RLD012   LH    XS1,SAVIDS+2    L CURRENT 'P' ID                         23510021
         L     GR3,0(XPRLD)         EXTRACT ASSEMBLED ADDRESS           23550021
         LA    GR3,0(GR3)               FROM RLD FA FIELD               23590021
         TM    APT1,DEL        IS 'P' A DELETE                          23630021
         BC    1,RLD0122       YES -- GO TO CHK FOR CONTINUED STRING    23670021
         SPACE 2                                                        24070021
*                ESTABLISH MULTIPLICITY OF CURRENT ITEM                 24110021
         SPACE 1                                                        24150021
         BAL   GR1,MULTDET     NOT DELETE -- GO TO OBTAIN MULTIPLICITY  24190021
         SPACE 1                                                        24230021
         STH   XS2,POSMULT     RESERVE POSSIBLE NEW LOWEST MULTIPLICITY 24270021
         MVC   NFLG(1),RLDMULT      EXTRACT FLAGS FROM                  24310021
         NI    NFLG,FLGS              NOTE LIST MODEL                   24350021
         NI    RLDMULT,NFLGS   CLEAR FLAGS IN MODEL (ID MULTIPLICITY)   24390021
         NI    STM,NFLGS       CLEAR FLAGS IN STRING MULTIPLICITY       24430021
         LR    R0,XIBCNT               CURRENT STRING LENGTH     A38313 24438000
         AR    R0,XOBCNT               ADD BUFFER BYTE COUNT     A38313 24446000
         CLC   SAVIDS+2(2),PREP        SAME P PTR?              OY00137 24448002
         BNE   RLD01202                IF NOT BRANCH            OY00137 24450002
         TM    APTSWS,X'08'            TEST DELINK R PTR SAVED  OY00137 24452002
         BNO   RLD01200                BRANCH IF NOT ON         OY00137 24452402
         CLC   DELR(2),PRER            SAME R PTR?              OY00137 24452802
         BNE   RLD01202                BRANCH IF NOT            OY00137 24453202
         B     RLD01201                BRANCH                   OY00137 24453702
RLD01200 CLC   SAVIDS(2),PRER          SAME                     OY00137 24453802
         BNE   RLD01202                BRANCH IF NOT            OY00137 24453902
RLD01201 SH    R0,SFOUR                ALLOW FOR CHAINED ITEM   OY00137 24455902
RLD01202 EQU   *                                                        24465902
         C     R0,RLDSIZE              COMPARE TO MAX BUFF COUNT A38313 24472802
         BH    RLD0120                 GREATER, SKIP      A49482,A38313 24482102
*                                      MULT DETER         A49482,A38313 24491402
         CLC   POSMULT(2),RLDMULT  IS THIS LOWEST MULTIPLICITY OF ID    24500702
         BC    10,RLD0120      BC IF NO TO CHK STRING MULTIPLICITY      24510021
         STH   XS2,RLDMULT     YES -- SET NEW LOWEST MULT IN MODEL      24550021
RLD0120  CLC   POSMULT(2),STM  IS THIS LOWEST MULTIPLICITY OF STRING    24590021
         BC    10,RLD0121      NO -- GO TO CHK FOR CONTINUATION         24630021
         STH   XS2,STM         YES -- SAVE NEW LOWEST STRING MULT       24670021
RLD0121  OC    RLDMULT(1),NFLG SET FLAGS IN RLD MODEL                   24710021
         OC    STM(1),NFLG     SET FLAGS IN STRING COMPARATOR           24750021
RLD0122  TM    APTSWS,X'08'                                             24790021
         BC    8,RLD0122X         BRANCH IF NOT                         24830021
         MVC   SAVIDS(2),DELR     MOVE DELINK 'R' POINTER               24870021
         OI    SAVIDS,NREL        SET NON-RELATIVE FLAG                 24910021
RLD0122X TM    0(XPRLD),CONT      CHK FOR CONTINUATION FLAG             24950021
         LA    XPRLD,4(XPRLD)  STEP TO NEXT FA FIELD (OR END OF STRING) 24990021
*                              NOTE -- THIS INSTRUCTION WILL NOT CHANGE 25030021
*                                CONDITION CODE                         25070021
         BC    8,RLD013A       BC IF NO                                 25110021
         TM    APT1,DEL        IS 'P' A DELETE                          25150021
         BC    1,RLD0124       BC IF YES                                25190021
         LR    R0,XIBCNT       CONTINUE STRING -- L CURRENT STRING CT   25230021
         AR    R0,XOBCNT       ADD BUFFERRED BYTE COUNT                 25270021
         LR    XS1,XPRLD       L CURRENT STRING ITEM POINTER            25310021
         SH    XS1,SFOUR       SUBTRACT 4                               25350021
         C     XIBCNT,RLDSIZE  CHK IF STRING EQUALS BUFFER              25390021
         BC    8,RLD0125       BC IF YES                                25430021
         C     R0,RLDSIZE      STRING IS LESS, CHK TOTAL COUNT          25470021
         BC    4,RLD0124       BC IF TOTAL LESS THAN BUFFER             25510021
         CLC   SAVIDS(2),PRER  CHK IF CURRENT 'R' SAME AS PREVIOUS 'R'  25550021
         BC    7,RLD0122A      BC IF NOT SAME                           25590021
         CLC   SAVIDS+2(2),PREP  SAME -- CHK 'P' SAME AS PREVIOUS 'P'   25630021
         BC    8,RLD0123       BC IF SAME                               25670021
RLD0122A C     R0,RLDSIZE      NOT SAME -- CHK TOTAL WITH BUFFER SIZE   25710021
         BC    8,RLD0125       BC IF EQUAL                              25750021
         SH    XS1,SFOUR       SUBTRACT 4 FROM STRING POINTER           25790021
         BC    15,RLD0125                                               25830021
RLD0123  C     R0,RLDSIZE      CHK TOTAL WITH BUFFER SIZE               25870021
         BC    2,RLD0125       BC IF GREATER                            25910021
RLD0124  LA    XBCNT,4(XBCNT)  SAME -- STEP BY 4 INPUT BYTE COUNT       25950021
         LA    XIBCNT,4(XIBCNT)  STEP BY 4 CURRENT STRING COUNT         25990021
         TM    APT1,DEL        IS 'P' A DELETE                          26030021
         BC    1,RLD0122X         YES - GO TO END OF STRING             26070021
         BC    15,RLD010       NO -- GO TO CHECK NEXT FA ITEM           26110021
         SPACE 1                                                        26150021
RLD0125  OI    RLDFLGS,CONTOV  SET CONTINUATION-OVERFLOW FLAG           26190021
         ST    XS1,SBACKUP     SAVE FOR REPLACEMENT STRING POINTER      26230021
*                                                                       26270021
*      IF DELINKING HAS TAKEN PLACE, THIS ROUTINE MOVES THE DELINKED    26310021
*  'R' POINTER INTO THE STRING ID, CLEARS THE DELINK FLAG IN APT, SETS  26350021
*  THE NON-RELATIVE FLAG IN THE 'R' ID AND CLEARS THE RELATIVE FLAG     26390021
*  IN EACH FA FIELD IN THE STRING.                                      26430021
*                                                                       26470021
RLD013A  TM    APTSWS,X'08'    CHK IF ANY DELINK 'R' RECEIVED           26510021
         BC    8,RLD013        BC IF NO -- CONTINUE RLD PROCESSING      26550021
         NI    APTSWS,X'F7'    CLEAR DELINK FLAG IN APT                 26590021
         LR    R0,XSTR         SAVE START OF STRING                     26630021
         LA    XSTR,4(0,XSTR)  INCREMENT TO FA FIELD                    26670021
RLD013B  NI    0(XSTR),RELOFF  CLEAR RELATIVE FLAG IN FA                26710021
         LA    XSTR,4(0,XSTR)  INCREMENT TO NEXT FLAG FIELD             26750021
         CR    XSTR,XPRLD      CHK IF AT END OF STRING                  26790021
         BC    5,RLD013B       BC IF NO TO CONTINUE STRING PROCESSING   26830021
         LR    XSTR,R0         YES -- RESTORE STRING POINTER            26870021
         SPACE  2                                                       26910021
*IF CONTINUATION BIT NOT SET, NEXT ITEM IS A NEW R+P OR WE ARE AT       26950021
*THE END OF OUR INPUT RECORD                                            26990021
         SPACE 1                                                        27030021
RLD013   TM    APT1,DEL        IS 'P' A DELETE                          27070021
         BC    1,RLD0156       IF YES, GO TO CHK END-OF-INPUT           27110021
         SPACE 1                                                        27150021
*        WE HAVE COME TO THE END OF A STRING OF                         27190021
*RLD ITEMS. WHAT FOLLOWS THIS STRING MAY BE ANOTHER RLD ITEM WITH A NEW 27230021
*R AND P OR WE MAY BE AT THE END OF THE RLD INPUT. BEFORE WE FIND       27270021
*OUT WHICH IS TRUE, THE OLD STRING MUST BE MOVED INTO THE RLD BUFFER.   27310021
*IF THE RLD STRING WILL NOT FIT INTO THE BUFFER, THE BUFFER IS FIRST    27350021
*PURGED. THE OLD STRING WILL THEN BE MOVED IN.                          27390021
         SPACE 1                                                        27430021
RLD014   L     XS2,RLDOUT1     L START OF RLD BUFFER 1 -- DATA LOC      27470021
         TM    BUFFS,BUFFRN2   CHK IF BUFFER 2 IS CURRENT               27510021
         BC    8,*+8           BC IF NO                                 27550021
         L     XS2,RLDOUT2     L START OF RLD BUFFER 2 -- DATA LOC      27590021
         AR    XS2,XOBCNT      ADD BUFFERRED COUNT TO BUFFER LOC        27630021
         LR    XS1,XIBCNT             L CURRENT STRING BYTE COUNT       27670021
         AR    XS1,XOBCNT          AND FORM CURRENT BUFFER BYTE COUNT   27710021
RLD0151  BCTR  XIBCNT,0        REDUCE FOR EXACT MOVE COUNT              27750021
         CLC   SAVIDS(4),PRER  CHK IF CURRRNT 'ID'S' SAME AS PREVIOUS   27790021
         BC    7,RLD0152       BC IF NOT BOTH SAME                      27830021
RLD015   SH    XS2,SFOUR       GET ADDRESS OF PREVIOUS FA FIELD         27870021
         OI    0(XS2),CONT     SET CONTINUATION FLAG IN PREVIOUS FA     27910021
         LA    XS2,4(XS2)      RESTORE BUFFER LOC                       27950021
         LA    XSTR,4(XSTR)    STEP INPUT POINTER TO SKIP 'R' AND 'P'   27990021
         SH    XIBCNT,SFOUR    REDUCE STRING COUNT  (LESS 'R' AND 'P')  28030021
         EX    XIBCNT,MOVEJM1   MOVE CURRENT STRING INTO OUTPUT BUFFER  28070021
         BC    15,RLD015X      SKIP INSERT OF ID'S                      28110021
         SPACE 1                                                        28150021
RLD0152  C     XS1,RLDSIZE     CHK AGAINST MAXIMUM BUFFER SIZE          28190021
         BC    12,RLD0153      BC IF EQUAL OR LESS                      28230021
         TM    RLDFLGS,CONTOV  MORE -- CHK FOR CONTINUATION-OVERFLOW    28270021
         BC    8,RLD016        BC IF NO TO PURGE BUFFER                 28310021
         LA    XIBCNT,1(XIBCNT)   YES -- RECOMPENSATE STRING COUNT      28350021
         BC    15,RLD0031      BC TO CONTINUATION PURGE                 28390021
RLD0153  EX    XIBCNT,MOVEJM1  MOVE CURRENT STRING INTO OUTPUT BUFFER   28430021
RLD0154  EX    0,MOVEJM1A      MOVE CURRENT STRING ID'S INTO BUFFER     28470021
RLD015X  L     R14,BUFSTCT     L BUFFERRED STRING COUNT                 28510021
         LA    XIBCNT,1(XIBCNT)  RECOMPENSATE STRING COUNT              28550021
         AR    R14,XIBCNT      ADD CURRENT STRING COUNT                 28590021
         ST    R14,BUFSTCT     SAVE UPDATED BUFFERED STRING COUNT       28630021
         LR    R14,XS2         L LOC OF CURRENT OUT BUFFER STRING       28670021
         AR    R14,XIBCNT      ADD CURRENT STRING COUNT                 28710021
         SH    R14,SFOUR       GET LOC OF TERMINAL F/A FIELD            28750021
         NI    0(R14),CONTN    CLEAR TERMINAL ITEM CONTINUATION FLAG    28790021
         AR    XOBCNT,XIBCNT   UPDATE BUFFER BYTE COUNT                 28830021
         STH   XOBCNT,OBCNT    SAVE UPDATED COUNT IN MODEL              28870021
         TM    RLDFLGS,CONTOV  CHK FOR CONTINUATION OVERFLOW FLAG       28910021
         BC    1,RLD0031       BC IF YES TO PURGE BUFFER                28950021
         C     XOBCNT,RLDSIZE  CHK BUFFERRED CT WITH MAXIMUM BUFFER     28990021
         LA    XRET,RLD0156    L RETURN ADDRESS                         29030021
*                                   NOTE -- THIS INSTRUCTION DOES NOT   29070021
*                                      CHANGE CONDITION CODE            29110021
         BC    11,RLDBUF       BC IF NOT LESS TO PURGE BUFFER           29150021
RLD0155  MVC   PRER(4),SAVIDS  SAVE CURRENT 'ID'S' AS PREVIOUS 'ID'S'   29190021
RLD0156  CH    XBCNT,TTR1      CHK IF END-OF-INPUT                      29230021
         BC    4,RLD002        NO -- CONTINUE PROCESSING RLD ITEMS      29270021
RLDRETX  BC    15,RLDRET       YES -- RETURN TO CALLER                  29310021
***                                 CLOSE TIMER HOOK                    29350021
         SPACE 2                                                        29390021
RLD016   LA    XIBCNT,1(XIBCNT)   RECOMPENSATE STRING COUNT             29430021
RLD0161  BAL   XRET,RLDBUF     PURGE RLD BUFFER                         29470021
         MVC   PREP(2),SAVIDS+2  INITIALIZE 'P' ID FOR NEW BUFFER       29510021
         MVC   RLDMULT(2),STM  SET STRING MULTIPLICITY IN ID MULTIPCTY  29550021
         B     RLD014               THEN INSERT STRING                  29590021
         EJECT                                                          29630021
*             FORM RLD NOTE LIST AND INITIATE WRITE OUT                 29670021
*                  RLD BUFFER/RLD NOTE LIST ROUTINE                     29710021
         SPACE 1                                                        29750021
RLDBUF   L     R14,BUFSTCT     L BUFFERED STRING COUNT                  29790021
         LTR   R14,R14         CHK IF ANY BYTE COUNT                    29830021
         BC    7,RLDBUF1       BC IF SOME                               29870021
         LR    R14,XIBCNT      L CURRENT STRING BYTE COUNT              29910021
         LTR   XIBCNT,XIBCNT   CHK IF ANY                               29950021
         BC    7,RLDBUF1       BC IF SOME                               29990021
RLDBUFA  TM    NEWSW,EOD       NONE -- CHK FOR END-OF-DATA              30030021
         BCR   8,XRET          RETURN IF NOT                            30070021
         LTR   XOBCNT,XOBCNT   EOD -- CHK FOR ANY BUFFERED CT REMAINING 30110021
         BC    7,RLDBUF1A      CONTINUE IF ANY                          30150021
         TM    NEWSW,TUPAS     NONE -- CHK FOR 2 PASS NOW               30190021
         BC    8,RLDBFRTN      RETURN IF NO                             30230021
         OI    RLDFLGS,FNLCHK                                   OX03655 30240002
         BC    15,RLDBUF3B     YES, 2 PASS -- CONTINUE PURGE CHECK      30270021
         SPACE 1                                                        30310021
RLDBUF1  TM    APT1,EX         CHK IF EXECUTABLE (LOAD) MODULE          30350021
         BC    8,RLDBUF1A      BC IF NO                                 30390021
         CLC   TTR1(2),ENRLD2X   LD MODULE -- CHK IF INPUT OVER MAXIMUM 30430021
         BC    2,ERR2          BC IF OVER MAXIMUM -- ERROR              30470021
         SPACE 1                                                        30510021
RLDBUF1A SRL   R14,2           DIVIDE BUFFERRED STRING COUNT BY 4       30550021
         STH   R14,WDCNT       SAVE WORD COUNT IN MODEL                 30590021
         TM    NEWSW,TUPAS     CHK FOR 2 PASS NOW                       30630021
         BC    1,RLDBUF1C      BC IF YES                                30670021
         NI    RLDMULT,RNBUF1  SET RLD'S-IN-BUFFER-1 FLAG               30710021
         L     R14,RLDOUT1     L LOC OF OUT-BUFFER 1                    30750021
         TM    BUFFS,BUFFRN2   CHK IF BUFFER 2 IS CURRENT               30790021
         BC    8,RLDBUF1B      BC IF NO                                 30830021
         OI    RLDMULT,RNBUF2  YES -- SET RLD'S-IN-BUFFER-2 FLAG        30870021
         L     R14,RLDOUT2     L LOC OF OUT-BUFFER 2                    30910021
RLDBUF1B NI    RLDMULT,GPF     SET GROUP FLAG IN MODEL                  30950021
         OI    RLDMULT,INCF    SET RLD-IN-CORE FLAG IN MODEL            30990021
RLDBUF1C LR    R15,XOBCNT      L CURRENT BUFFERRED BYTE COUNT           31030021
         SLL   R15,6           REDUCE TO WORD COUNT IN MODEL POSITION   31070021
         ST    R15,RTTR1       SAVE ACCUMULATED WORD COUNT IN MODEL     31110021
         SPACE 1                                                        31150021
         MVC   SFLIP(1),BUFFS  HOLD CURRENT BUFFER FLAG                 31190021
         NI    SFLIP,BUFFRN2   EXTRACT CURRENT BUFFER FLAG              31230021
         XI    SFLIP,BUFFRN2   FLIP NEXT BUFFER FLAG                    31270021
         LR    XS1,XIBCNT      L STRING COUNT                           31310021
         AR    XS1,XOBCNT      ADD BUFFERED BYTE COUNT                  31350021
         C     XS1,RLDSIZE     CHK AGAINST MAXIMUM BUFFER COUNT         31390021
         BC    13,RLDBUF3      BC IF NOT GREATER                        31430021
RLDBUF2  OI    RLDMULT,TTRF    SET END-OF-BUFFER FLAG IN MODEL          31470021
         TM    BUFFS,BUFFRN2   CHK IF BUFFER 2 IS CURRENT               31510021
         BC    8,RLDBUF2A      BC IF NO                                 31550021
         OI    BUFFS,BUFF2     YES -- SET BUFFER 2 FULL FLAG            31590021
         BC    15,RLDBUF2B                                              31630021
RLDBUF2A OI    BUFFS,BUFF1     SET BUFFER 1 FULL FLAG                   31670021
RLDBUF2B TM    NEWSW,TUPAS     CHK FOR 2 PASS NOW                       31710021
         BC    1,RLDBUF4A      BC IF YES                                31750021
         TM    BUFFS,BUFFRN2   NO -- CHK IF BUFFER 2 IS CURRENT         31790021
         BC    1,RLDBUF4       BC IF YES                                31830021
         STH   XOBCNT,OBCNT    SAVE CURRENT BUFFERRED BYTE COUNT        31870021
         MVC   OPREP(14),PREP  SAVE CURRENT MODEL FOR OPENER 1          31910021
         OI    BUFFS,OP1BF2    SET OPENER AND BUFFER 2 NOW FLAGS        31950021
         SR    XOBCNT,XOBCNT   CLEAR BUFFER 1 COUNT                     31990021
         SPACE 1                                                        32030021
         SPACE 1                                                        32070021
RLDBUF3  LH    XRIO,ENR1C      L CURRENT NOTE LIST ENTRY COUNT          32110021
         LA    XRIO,1(XRIO)    STEP FOR CHECK                           32150021
         CH    XRIO,ENR1X      CHK IF NOTE LIST WILL BE FULL            32190021
         BC    4,RLDBUF3A      BC IF NO                                 32230021
         TM    NEWSW,TUPAS     CHK FOR TWO PASS MODE                    32270021
         BC    1,RLDBUF32      BC IF YES                                32310021
         TM    BUFFS,BUFFRN2   ONE PASS MODE -- CHK FOR BUFFER 2 NOW    32350021
         BC    1,RLDBUF32      BC IF YES                                32390021
RLDBUF31 OI    RLDFLGS,NLFULL  SET NOTE LIST FULL FLAG                  32430021
RLDBUF32 OI    RLDFLGS,CHKNOW  SET CHECK NOW FLAG                       32470021
         OI    NEWSW,TUPAS     SET 2 PASS NOW FLAG                      32510021
         BC    15,RLDBUF2                                               32550021
RLDBUF3A TM    NEWSW,EOD       CHK FOR END-OF-DATA NOW                  32590021
         BC    8,RLDBUF6C      BC IF NO                                 32630021
RLDBUF3B OI    RLDMULT,TTRF    SET END-OF-BUFFER FLAG IN MODEL          32670021
         TM    NEWSW,TUPAS     CHK FOR TWO PASS FLAG                    32710021
         BC    8,RLDBUF6C      BC IF NO                                 32750021
         SPACE 1                                                        32790021
RLDBUF4  OI    NEWSW,TUPAS     SET 2 PASS FLAG                          32830021
RLDBUF4A TM    BUFFS,OPNR1     CHK FOR BUFFER 1 OPENER FLAG             32870021
         BC    8,RLDBUF5       BC IF NO                                 32910021
         STH   XOBCNT,OBCNT    SAVE CURRENT BUFFERRED BYTE COUNT        32950021
         MVC   CPREP(14),PREP  SAVE CURRENT MODEL FOR RESUME            32990021
         MVC   PREP(14),OPREP  RESTORE OPENER 1 MODEL TO CURRENT MODEL  33030021
         LH    XOBCNT,OBCNT    RESTORE OPENER 1 BUFFERRED BYTE COUNT    33070021
         NI    BUFFS,BUFFRN1   SET BUFFER 1 CURRENT FLAG                33110021
         SPACE 1                                                        33150021
RLDBUF5  L     XRIO,RNT1       L NOTE LIST STARTING LOC                 33190021
         SH    XRIO,SNINE      LESS 9 -- 1 ENTRY LENGTH                 33230021
         LH    XS1,ENR1C       L NOTE LIST ENTRY COUNT                  33270021
         LTR   XS1,XS1         CHK IF ANY COUNT                         33310021
         BC    7,*+8           BC IF SOME                               33350021
         LA    XS1,1(XS1)      NONE -- SET TO ONE                       33390021
RLDBUF5A LA    XRIO,9(XRIO)    STEP NOTE LIST ENTRY LOC ONE ENTRY       33430021
         NI    2(XRIO),NICF    CLEAR IN-CORE AND BUFFER 2 FLAGS         33470021
         BCT   XS1,RLDBUF5A    LOOP TO NEXT ENTRY                       33510021
         SPACE 1                                                        33550021
RLDBUF6  TM    BUFFS,WRIT2     CHK IF ANY BUFFER WRITTEN YET            33590021
         BC    8,RLDBUF7C      BC IF NONE                               33630021
         OI    RLDFLGS,CHKNOW  SET CHECK NOW FLAG                       33670021
RLDBUF6A STH   XOBCNT,OBCNT    SAVE CURRENT BUFFERRED BYTE COUNT        33710021
         MVC   CPREP(14),PREP  SAVE CURRENT MODEL FOR CHECK             33750021
         MVC   PREP(14),LPREP  RESTORE RESERVE MODEL TO CHECK           33790021
         LH    XOBCNT,OBCNT    RESTORE RESERVED BUFFERRED BYTE COUNT    33830021
         SPACE  1                                                       33870021
RLDWCHK  L     GR1,SAVETTR     L RESERVED TTR                           33910021
****             REMOVE ABOVE INSTRUCTION IF OVERLAP IS ADDED           33950021
****                           AND REPLACE WITH                         33990021
****     BAL   XRET2,COMCHK    CHECK AND NOTE                           34030021
         SPACE  1                                                       34070021
         SPACE 1                                                        34110021
         NI    RLDMULT,NICF    SET NOT-IN-CORE FLAG IN MODEL            34150021
         OI    RLDMULT,TTRF    SET TTR FLAG IN MODEL                    34190021
         ST    GR1,RTTR1       SET TTR IN MODEL                         34230021
         SPACE 1                                                        34270021
         TM    BUFFS,BUFFRN2   CHK IF BUFFER 2 IS CURRENT               34310021
         BC    1,RLDBUF6B      BC IF YES                                34350021
         OI    BUFFS,BUF2CHK   NO -- SET BUFFER 2 CHECKED FLAG          34390021
         NI    BUFFS,NBUF2WF   CLEAR BUFFER 2 FULL AND WRITTEN FLAGS    34430021
         BC    15,RLDBUF6C                                              34470021
RLDBUF6B OI    BUFFS,BUF1CHK   SET BUFFER 1 CHECKED FLAG                34510021
         NI    BUFFS,NBUF1WF   CLEAR BUFFER 1 FULL-WRITTEN FLAGS        34550021
RLDBUF6C LA    XRIO,9          L RLD NOTE LIST ENTRY LENGTH             34590021
         MH    XRIO,ENCT       MULTIPLY BY ENTRY COUNT                  34630021
         A     XRIO,RNT1       ADD NOTE LIST STARTING LOC TO FORM       34670021
*                                   CURRENT ENTRY LOC                   34710021
         MVC   0(9,XRIO),PREP  MOVE MODEL INTO RLD NOTE LIST ENTRY      34750021
RLDBUF6D SR    R14,R14         CLEAR REGISTER                           34790021
RLDBUF6X ST    R14,BUFSTCT     CLEAR BUFFERRED STRING COUNT             34830021
         ST    R14,BUFSTLOC    CLEAR BUFFERED STRING LOCATION           34870021
         TM    RLDFLGS,CHKNOW  CHK FOR CHECK NOW                        34910021
         BC    8,RLDBUF7       BC IF NO                                 34950021
         MVC   PREP(14),CPREP  YES -- RESTORE CURRENT MODEL             34990021
         LH    XOBCNT,OBCNT    RESTORE CURRENT BUFFERRED BYTE COUNT     35030021
         TM    RLDFLGS,FNLCHK          CHECK FOR NO DATA        XA05742 35040003
         BO    RLDBUF71                BRANCH IF NO DATA        XA05742 35050003
RLDBUF7  LH    XRIO,ENCT       L RLD NOTE LIST ENTRY COUNT              35070021
         LA    XRIO,1(XRIO)    UPDATE BY 1                              35110021
         STH   XRIO,ENR1C      SAVE NEW COUNT IN APT                    35150021
         CH    XRIO,ENR1X      CHK IF NOTE LIST IS FULL                 35190021
         BC    10,RLDBUF7A     BC IF NOT LESS                           35230021
RLDBUF71 NI    RLDFLGS,NCHKNOW   LESS -- CLEAR CHECK NOW FLAGS  XA05742 35270003
         BC    15,RLDBUF7C     GO TO WRITE                              35310021
RLDBUF7A TM    RLDFLGS,NLFULL  NOT LESS -- CHK FOR NOTE LIST FULL FLAG  35350021
         BC    1,RLDBUF7B      BC IF YES                                35390021
         OI    RLDFLGS,NLFULL  NO -- SET NOTE LIST FULL FLAG NOW        35430021
         BC    15,RLDBUF7C     GO TO WRITE                              35470021
RLDBUF7B NI    RLDFLGS,NLFLCHKN  CLEAR NOTE LIST FULL + CHK NOW FLAGS   35510021
         SPACE 1                                                        35550021
*THE RLD NOTE LIST IS FULL. AN ENTRY IS NOW MADE IN THE RLD I/O CONTROL 35590021
*TABE.IT CONTAINS A MAXIMUM OF 3 TTR'S OF THE RLD NOTE LIST. AN OVER-   35630021
*FLOW CONDITION WILL OCCUR IF THE NOTE LIST MUST BE PURGED AND THE RLD  35670021
*I/O CONTROL TABLE IS FULL.THE WORDS 'NOTE' AND 'MARK' ARE INTER-       35710021
*CHANGEABLE. HISTORICALLY BOTH TERMS HAVE BEEN USED.                    35750021
         SPACE 1                                                        35790021
BUFRMK2  TM    RLDFLGS,FULLR   CHK IF I/O CONTROL TABLE FULL            35830021
         BC    8,BUFROK        BC IF NOT FULL -- CONTINUE               35870021
         TM    APT4,REALOCTE       IS REALLOC POSSIBLE?          S01904 35910021
         BNO   BUFRMK2A            YES,TRY REALLOCATION          S01904 35950021
         LA    MSG,IEW0374     L ERROR CODE FOR I/O CTL TABLE OVERFLOW  35990037
         BC    15,ERROR        GO TO ERROR ROUTINE INTERFACE            36030021
BUFRMK2A S     XPSAV,RECNT             CALC RRNT OFFSET         YA05040 36040003
         STM   WRKREG0,WRKREGF,BRNCHSV  SAVE REGISTERS   S01904,YA05040 36070003
         L     BRANCH,ERDIGA       GET ADDR OF REALLOC RTN       S01904 36110021
         BALR  RETURN,BRANCH       GO TO REALLOC RTN             S01904 36150021
         LM    WRKREG0,WRKREGF,BRNCHSV  RESTORE REGISTERS        S01904 36190021
         A     XPSAV,RECNT             RELOCATE RNT POINTER     YA05040 36200003
         B     RLDBUF7C                                          S01904 36230021
         SPACE 1                                                        36270021
BUFROK   LA    R14,9           L LENGTH OF NOTE LIST ENTRY              36310021
         MH    R14,ENR1C       MULTIPLY BY ENTRY CT TO FORM DATA CT     36350021
         L     R15,RNT1        L DATA LOC                               36390021
         SPACE 1                                                        36430021
         BAL   XRET2,RLDBUFR   GO TO WRITE OUT NOTE LIST                36470021
         SPACE 1                                                        36510021
         BAL   XRET2,COMCHK    GO TO CHECK LAST WRITE                   36550021
         LA    R15,9           PREPARE TO CLEAR BUFFER  OX05132,OY04538 36560003
         MH    R15,ENR1C       COMPUTE NOTELIST LENGTH  OX05132,OY04538 36570003
         L     XRET2,RNT1      POINT TO NOTELIST START  OX05132,OY04538 36580003
         XR    R14,R14         CLEAR FOR DIVIDE         OX05132,OY04538 36582003
         D     R14,HEX100      HOW MANY MOVES?          OX05132,OY04538 36584003
         LTR   R15,R15         LESS THAN 256 BYTES?     OX05132,OY04538 36586003
         BZ    BUFRLEFT        YES, CHECK FOR REMAINDER OX05132,OY04538 36588003
BUFRCLR  EQU  *                                         OX05132,OY04538 36588103
         XC    0(256,GR5),0(GR5)  CLEAR 256 BYTES       OX05132,OY04538 36588403
         A     XRET2,HEX100     BUMP BUFFER POINTER     OX05132,OY04538 36588803
         BCT   R15,BUFRCLR      IF MORE TO MOVE, LOOP   OX05132,OY04538 36589203
BUFRLEFT EQU   *                                        OX05132,OY04538 36589603
         LTR   R14,R14          ANY REMAINDER?          OX05132,OY04538 36589703
         BZ    BUFRCLRD         NO, WE ARE DONE         OX05132,OY04538 36589803
         BCTR  R14,0            DECREMENT FOR EXECUTE   OX05132,OY04538 36589903
         EX    R14,CLEARIT      CLEAR REMAINDER         OX05132,OY04538 36603203
BUFRCLRD EQU   *                                        OX05132,OY04538 36613203
         SPACE 1                                                        36616703
         SPACE                                                          36630021
         LA    XS1,IOCT+12     L LOC OF START OF RLD I/O CTL TABLE      36670021
         LR    XRMK2,XS1              L SAME IN XRMK2 AND               36710021
         SR    XRET2,XRET2         CLEAR REGISTER                S01904 36750021
         IC    XRET2,ENIRC         LNGTH IN REALLOC TBLE OX00029,S01904 36790000
         SR    WRKREG0,WRKREG0     CLEAR REGISTER                S01904 36830021
         IC    WRKREG0,ENIRC+1     LENGTH IN ORIG TABLE  OX00029,S01904 36870000
         AR    XRET2,WRKREG0       CURRENT LENGTH OF TABLE       S01904 36910021
         AR    XRMK2,XRET2                                       S01904 36950021
*THE TTR CONTAINED IN REG 1, IS STORED IN THE CURRENT RLD I/O CONTROL   36990021
*TABLE ENTRY                                                            37030021
         ST    GR1,0(XRMK2)    SAVE RLD NOTE LIST TTR IN CURRENT RLD    37070021
*                                 I/O CONTROL TABLE ENTRY               37110021
         LA    XRMK2,4(XRMK2)  STEP TO NEXT ENTRY LOC                   37150021
         SR    XRMK2,XS1       SUBTRACT LOC OF TABLE START              37190021
         TM    APT4,REALOCTE       WAS REALLOC DONE?             S01904 37230021
         BNO   BUFRMK2D            NO,USE BOTH BYTES OF ENIRC    S01904 37270021
         SR    XRMK2,WRKREG0            GET NEW TBL BYTES       OX00029 37280000
         STC   XRMK2,ENIRC         USE FIRST BYTE OF ENIRC       S01904 37310021
         B     BUFRMK2E                                          S01904 37350021
BUFRMK2D STH   XRMK2,ENIRC     SAVE UPDATED TABLE BYTE COUNT IN APT     37390021
BUFRMK2E LA    XRET2,4(XRET2)                                    S01904 37430021
*IF THE RLD I/O CONTROL TABLE IS FULL, THE 'FULLR' INDICATOR IS SET     37470021
*THIS MEANS THAT NO MORE BUFFERINGS OF THE RLD NOT LIST CAN OCCUR.      37510021
         CH    XRET2,XII       CHK IF RLD I/O CTRL TABLE FULL           37550021
         BC    4,BUFRMK3       BC IF NO TO CONTINUE                     37590021
         OI    RLDFLGS,FULLR   YES -- SET OVERFLOW FLAG                 37630021
BUFRMK3  SR    R0,R0                      RESET TO ZERO                 37670021
         NI    BUFFS,N2BUFWF   RESET BOTH FULL AND WRITTEN FLAGS        37710021
         STH   R0,ENR1C             RLD NOTE LIST ENTRY COUNT           37750021
         STH   R0,ENCT         RESET ENTRY COUNT IN MODEL               37790021
         OI    RLDFLGS,PURGE       SET PURGE FLAG                       37830021
         SPACE 2                                                        37870021
RLDBUF7C TM    NEWSW,TUPAS     CHK FOR 2 PASS FLAG                      37910021
         BC    8,RLDBUFBK      NO -- GO TO RETURN                       37950021
RLDBUF7D LTR   XOBCNT,XOBCNT   CHK FOR ANY BUFFERRED COUNT              37990021
         BC    8,RLDBUF8A      BC IF NONE                               38030021
         TM    RLDMULT,TTRF    CHK FOR END-OF-BUFFER FLAG               38070021
         BC    8,RLDBUF8A      BC IF NO                                 38110021
         LR    R14,XOBCNT      L BUFFERED BYTE COUNT IN REG E           38150021
         TM    BUFFS,BUFFRN2   CHK IF BUFFER 2 IS CURRENT               38190021
         BC    1,RLDBUF7E      BC IF YES                                38230021
         L     R15,RLDOUT1     NO -- L LOC OF BUFFER 1                  38270021
         SPACE 1                                                        38310021
         BAL   XRET2,RLDBUFR   GO TO WRITE OUT BUFFER 1                 38350021
         BAL   XRET2,COMCHK            CHECK AND NOTE                   38390021
****             REMOVE ABOVE INSTRUCTION IF OVERLAP IS ADDED           38430021
         ST    GR1,SAVETTR             SAVE TTR                         38470021
****             REMOVE ABOVE INSTRUCTION IF OVERLAP IS ADDED           38510021
         SPACE 1                                                        38550021
         OI    BUFFS,BUFW1     SET BUFFER 1 WRITTEN FLAG                38590021
         NI    BUFFS,NBUF1CHK  CLEAR BUFFER 1 CHECKED FLAG              38630021
         BC    15,RLDBUF7F                                              38670021
RLDBUF7E L     R15,RLDOUT2     L LOC OF BUFFER 2                        38710021
         SPACE 1                                                        38750021
         BAL   XRET2,RLDBUFR   GO TO WRITE OUT BUFFER 2                 38790021
         BAL   XRET2,COMCHK            CHECK AND NOTE                   38830021
****             REMOVE ABOVE INSTRUCTION IF OVERLAP IS ADDED           38870021
         ST    GR1,SAVETTR             SAVE TTR                         38910021
****             REMOVE ABOVE INSTRUCTION IF OVERLAP IS ADDED           38950021
         SPACE 1                                                        38990021
         OI    BUFFS,BUFW2     SET BUFFER 2 WRITTEN FLAG                39030021
         NI    BUFFS,NBUF2CHK  CLEAR BUFFER 2 CHECKED                   39070021
RLDBUF7F STH   XOBCNT,OBCNT    SAVE CURRENT BUFFERRED BYTE COUNT        39110021
         MVC   LPREP(14),PREP  SAVE WRITTEN MODEL FOR CHECK             39150021
         SR    XOBCNT,XOBCNT   CLEAR BUFFERRED BYTE COUNT               39190021
         TM    BUFFS,OPNR1     CHK FOR BUFFER 1 OPENER FLAG             39230021
         BC    8,RLDBUF8       BC IF NO                                 39270021
         MVC   PREP(14),CPREP  RESTORE CURRENT MODEL                    39310021
         LH    XOBCNT,OBCNT    RESTORE CURRENT BUFFERRED BYTE COUNT     39350021
         OI    BUFFS,BUFFRN2   SET BUFFER 2 CURRENT FLAG                39390021
         NI    BUFFS,NOPNR1    CLEAR BUFFER 1 OPENER FLAG               39430021
RLDBUF8  TM    BUFFS,FULL2     CHK FOR 2 BUFFERS FULL                   39470021
         BC    1,RLDBUF6       LOOP TO CHECK, THEN WRITE                39510021
         TM    RLDFLGS,PURGE   CHK FOR PURGE FLAG                       39550021
         BC    8,RLDBUF8A      BC IF NONE                               39590021
         NI    RLDFLGS,NPURGE  YES -- CLEAR PURGE FLAG                  39630021
         BC    15,RLDBUF6D     GO TO STEP NOTE LIST ENTRY COUNT         39670021
RLDBUF8A TM    RLDFLGS,CHKNOW  CHK FOR CHECK NOW FLAG                   39710021
         BC    1,RLDBUF6A      BC IF YES TO CHECK                       39750021
         TM    RLDFLGS,FNLCHK  CHK IF FINAL CHECK FLAG                  39790021
         BC    1,RLDBUF8B      BC IF YES                                39830021
         TM    NEWSW,EOD       CHK FOR END-OF-DATA NOW                  39870021
         BC    8,RLDBUF8C      BC IF NO                                 39910021
         OI    RLDFLGS,FNLCHK  SET FINAL CHECK FLAG                     39950021
         BC    15,RLDBUF3B     LOOP TO FINAL CHECK                      39990021
RLDBUF8B NI    RLDFLGS,NFNLCHK    CLEAR FINAL CHECK FLAG                40030021
RLDBUF8C TM    RLDMULT,TTRF    CHK FOR END-OF-BUFFER FLAG               40070021
         BC    8,RLDBUFBK      BC IF NO                                 40110021
         NI    BUFFS,BUFFRN1   CLEAR BUFFER 2 CURRENT FLAG              40150021
         OC    BUFFS(1),SFLIP  SET FLAG FOR NEXT BUFFER                 40190021
RLDBUFBK SR    XRIO,XRIO       CLEAR REGISTER                           40230021
         BCTR  XRIO,0          INVERT                                   40270021
         STH   XRIO,PRER       RESET PREVIOUS 'R' ID                    40310021
         STH   XRIO,PREP       RESET PREVIOUS 'P' ID                    40350021
RLDBFBK1 LH    XRIO,ENR1C         L UPDATED NOTE LIST ENTRY COUNT       40390021
         STH   XRIO,ENCT                  AND SET IN MODEL              40430021
         MVI   RLDMULT,STMULT  RESET RLD ITEM MULTIPLICITY              40470021
         SPACE 1                                                        40510021
*       CHECK FOR END-OF-OUTPUT-MODULE FLAG.  INITIALIZE PROCESS        40550021
*                 FLAGS IF FOUND AND RETURN TO CALLER.                  40590021
         SPACE 1                                                        40630021
RLDBFRTN TM    NEWSW,EOD       CHK FOR END-OF-OUTPUT-MODULE FLAG        40670021
         BCR   8,XRET          RETURN IF NO                             40710021
         MVI   PRER,X'FF'      YES -- INITIALIZE PREVIOUS 'R' ID        40750021
         MVC   PRER+1(3),PRER  INITIALIZE PREVIOUS 'P' ID               40790021
         MVI   WDCNT,X'00'            INITIALIZE                        40830021
         MVC   WDCNT+1(21),WDCNT    CONTROL AREAS                       40870021
           MVC   CALLCURP(2),CONZO                                      40910021
         BCR   15,XRET         RETURN                                   40950021
         SPACE 2                                                        40990021
     TITLE 'HEWLFRAT   RLD/TXT PROCESSOR  --  RLD CONSTANTS'            41030021
DCBAD    DC    A(HEWLCUDB)                                              41070021
ADDEL    DC    V(HEWLCDLK)                                              41110021
*                                    PROCESSED CSECTS IN BUFFER         41150021
DELR     DC    X'0000'          DELINKED R POINTER SAVE AREA            41190021
CONZO    DC    H'0'                                                     41230021
******** ERROR MSG **************************************************** 41270037
IEW0284  DC    X'241C'  FAILURE TO OPEN DCB CODE                        41280037
IEW0222  DC    X'1216'                                                  41290037
IEW0614  DC    X'243D'      NO LENGTH SPACIFIED IN CESD                 41295037
*********************************************************************** 41300037
XII      DC    H'12'                                                    41310021
CLEARIT  XC    0(0,XRET2),0(XRET2)     FOR RLD NOTELIST CLR     OX05132 41320003
HEX100   DC    F'256'                  FOR RLD NOTELIST CLR     OX05132 41330003
         SPACE 2                                                        41350021
*                    RLD NOTE LIST ENTRY MODEL                          41390021
         SPACE 1                                                        41430021
         CNOP  0,4       ALIGN TO START PREP ON HALF WORD               41470021
PRER     DC    X'FFFF'   PREVIOUS 'R' ID                                41510021
PREP     DC    X'FFFF'   PREVIOUS 'P' ID                                41550021
RLDMULT  DC    X'0200'   FLAG-MULTIPLICITY FIELD                        41590021
*                          BIT 0 -- 0 -- RLD NOT IN CORE                41630021
*                                   1 -- RLD IN CORE                    41670021
*                          BIT 1 -- 0 -- GROUPED ENTRY                  41710021
*                                   1 -- TTR ENTRY                      41750021
*                          BIT 2 -- RESERVED                            41790021
*                          BIT 3 -- 0 -- IN BUFFER 1                    41830021
*                                   1 -- IN BUFFER 2                    41870021
*                          BIT 4 -- RESERVED                            41910021
*                          BIT 5 -- RESERVED                            41950021
*                          BITS 6-15 -- MULTIPLICITY ID                 41990021
WDCNT    DC    X'0000'   RLD WORD COUNT                                 42030021
RTTR1    DC    X'00000000'   TTR/ACCUMULATED WORD COUNT FIELD           42070021
OBCNT    DC    X'0000'   RLD BYTE COUNT                                 42110021
ENCT     DC    X'0000'   RLD NOTE LIST ENTRY COUNT                      42150021
         DC    X'0000'   RESERVED                                       42190021
RLDFLGS  DC    X'0'      RLD PROCESSING FLAGS                           42230021
*                          BIT 0 -- 1 -- CONTINUED STRING OVERFLOWS     42270021
*                                          BUFFER                       42310021
*                          BIT 1 -- 1 -- NEW GROUPED STRING OVERFLOWS   42350021
*                                          BUFFER                       42390021
*                          BIT 2 -- 0 -- I/O CONTROL TABLE NOT FULL     42430021
*                                   1 -- I/O CONTROL TABLE FULL         42470021
*                          BIT 3 -- 0 -- NOTE LIST NOT FULL             42510021
*                                   1 -- NOTE LIST FULL                 42550021
*                          BIT 4 -- 0 -- NO NOTE LIST PURGE NOW         42590021
*                                   1 -- NOTE LIST PURGED NOW           42630021
*                          BIT 5 -- 0 -- NO CHECK LAST WRITE NOW        42670021
*                                   1 -- CHECK LAST WRITE NOW           42710021
*                          BIT 6 -- 0 -- NOT FINAL CHECK                42750021
*                                   1 -- FINAL CHECK AT EOD             42790021
         EJECT                                                          42830021
BUFFS    DC    X'0'      RLD BUFFER CONTROL FLAGS                       42870021
*                          BIT 0 -- 1 -- BUFFER 1 OPENER                42910021
*                          BIT 1 -- 1 -- BUFFER 2 CHECKED               42950021
*                          BIT 2 -- 1 -- BUFFER 1 CHECKED               42990021
*                          BIT 3 -- 1 -- BUFFER 2 WRITTEN               43030021
*                          BIT 4 -- 1 -- BUFFER 1 WRITTEN               43070021
*                          BIT 5 -- 1 -- BUFFER 2 FULL                  43110021
*                          BIT 6 -- 1 -- BUFFER 1 FULL                  43150021
*                          BIT 7 -- 0 -- BUFFER 1 CURRENT               43190021
*                                   1 -- BUFFER 2 CURRENT               43230021
         SPACE 1                                                        43270021
         SPACE 1                                                        43310021
BUFSTCT  DC    F'0'      BUFFERRED STRING COUNT                         43350021
BUFSTLOC DC    F'0'      BUFFERRED STRING STARTING LOCATION             43390021
         SPACE 2                                                        43430021
*          MODEL TO HOLD WRITE TIME ENVIRONMENT FOR CHECK USE           43470021
         SPACE 1                                                        43510021
         CNOP  2,4       ALIGN TO START LPREP ON HALF WORD              43550021
LPREP    DC    X'0000'   CESD ID FIELD                                  43590021
LRLDMULT DC    X'0200'   FLAG-ADDRESS FIELD                             43630021
LWDCNT   DC    X'0000'   RLD WORD COUNT                                 43670021
LRTTR1   DC    X'00000000'     TTR/STORAGE ADDRESS FIELD                43710021
LOBCNT   DC    X'0000'   RLD BYTE COUNT                                 43750021
LENCT    DC    X'0000'   RLD NOTE LIST ENTRY COUNT                      43790021
         DC    X'0000'   RESERVED                                       43830021
         SPACE 2                                                        43870021
*            MODEL TO HOLD INITIAL BUFFER LOAD ENVIRONMENT              43910021
         SPACE 1                                                        43950021
         CNOP  2,4       ALIGN TO START OPREP ON HALF WORD              43990021
OPREP    DC    X'0000'   CESD ID FIELD                                  44030021
ORLDMULT DC    X'0200'   FLAG-ADDRESS FIELD                             44070021
OWDCNT   DC    X'0000'   RLD WORD COUNT                                 44110021
ORTTR1   DC    X'00000000'     TTR/STORAGE ADDRESS FIELD                44150021
OOBCNT   DC    X'0000'   RLD BYTE COUNT                                 44190021
OENCT    DC    X'0000'   RLD NOTE LIST ENTRY COUNT                      44230021
         DC    X'0000'   RESERVED                                       44270021
         SPACE 2                                                        44310021
*      MODEL TO HOLD CURRENT ENVIRONMENT WHILE PREVIOUS ONE IS USED     44350021
         SPACE 1                                                        44390021
         CNOP  2,4       ALIGN TO START CPREP ON HALF WORD              44430021
CPREP    DC    X'0000'   CESD ID FIELD                                  44470021
CRLDMULT DC    X'0200'   FLAG-ADDRESS FIELD                             44510021
CWDCNT   DC    X'0000'   RLD WORD COUNT                                 44550021
CRTTR1   DC    X'00000000'     TTR/STORAGE ADDRESS FIELD                44590021
COBCNT   DC    X'0000'   RLD BYTE COUNT                                 44630021
CENCT    DC    X'0000'   RLD NOTE LIST ENTRY COUNT                      44670021
         DC    X'0000'   RESERVED                                       44710021
         SPACE 2                                                        44750021
TEMP     DS    X                                                XA04649 44760003
TXT001AD DC    A(HEWLFTXT)     LOC OF TEXT PROCESSING ROUTINE           44790021
TXTBUFAD DC    A(TXTBUF) LOC OF TEXT PURGE ROUTINE                      44830021
RATADR   DC    A(RATLOC) RLD STANDARD BASE REGISTER VALUE               44870021
FOUR     DC    F'4'                    OFFSET FOR RNT TABLE      A53300 44880000
TTR1     DC    F'0'      STORAGE FOR TTR OR INPUT COUNT                 44910021
INADD1   DC    F'0'      RETURN TO INPUT PROCESSOR                      44950021
SBACKUP  DC    F'0'      SAVE AREA FOR REPLACEMENT STRING POINTER       44990021
SAVIDS   DC    F'0'      SAVE AREA FOR REPLACEMENT ID'S                 45030021
SAVETTR  DC    F'0'      SAVE AREA FOR TTR                              45070021
STRUNC   DC    X'000003FF'     MULTIPLICITY SIZE LIMITOR                45110021
RIDMSK   DC    X'00007FFF'     MASK FOR 'R' ID                          45150021
         SPACE 1                                                        45190021
SAVIDR   DC    H'0'      RESERVE AREA FOR RLD ITEM 'R' ID               45230021
CALLCURP DC    H'0'                                                     45270021
POSMULT  DC    H'0'      RESERVE AREA FOR POSSIBLE LOWEST MULTIPLICITY  45310021
STM      DC    X'0200'   RESERVE AREA FOR STRING MULTIPLICITY           45350021
SONE     DC    H'1'      DECIMAL 1                                      45390021
SFOUR    DC    H'4'      DECIMAL 4                                      45430021
SSEVEN   DC    H'7'      DECIMAL 7                                      45470021
SNINE    DC    H'9'      DECIMAL 9                                      45510021
         SPACE 1                                                        45550021
NFLG     DC    X'0'      TEMPORARY RESERVE AREA FOR FLAGS               45590021
FLAG     DC    X'0'                                                     45630021
         SPACE 1                                                        45670021
SFLIP    DC    X'00'     TEMPORARY STORAGE FOR BUFFER FLAGS             45710021
         DS    0H                                                       45750021
FIVEFIVE DC    H'5'                                                     45790021
DLKTSAVE DC    H'0'                                                     45830021
         SPACE 2                                                        45870021
PATCH1   DC    35D'0'                                                   45910037
     TITLE 'HEWLFRAT   RLD/TXT PROCESSOR  --  TEXT PROCESSING'          45950021
HEWLFTXT CSECT                                                          45990021
         SPACE 3                                                        46030021
*                                                                       46070021
*                     T E X T    P R O C E S S O R                      46110021
*                                                                       46150021
         SPACE 2                                                        46190021
*      THIS ROUTINE PROCESSES ALL TXT INPUT FOR EVERY LINKEDIT. THE ID  46230021
*  IS RENUMBERED VIA THE RENUMBERING TABLE AND THE MULTIPLICITY IS      46270021
*  DETERMINED AS A FUNCTION OF A SYSLMOD RECORD.   AFTER SPACE HAS BEEN 46310021
*  ALLOCATED IN THE TXTBUFFER AND AN ENTRY MADE IN THE TXTIO TABLE AND  46350021
*  TEXT NOTELIST(FIRST APPEARANCE ONLY),THE TEXT IS MOVED(OBJ) OR READ  46390021
*  DIRECTLY(LM) INTO THE TXTBUFFER.                                     46430021
         SPACE 2                                                        46470021
*                                                                       46510021
*              GENERAL  REGISTER UTILIZATION                            46550021
*                                                                       46590021
RID1     EQU   1         GENERAL WORK REGISTER IN INITIAL LOAD MODULE   46630021
*                             PROCESSING                                46670021
COUNT    EQU   4         WILL MAINTAIN INPUT COUNT AS PASSED BY LMINP   46710021
RID      EQU   5         WILL MAINTAIN RENUMBERED ID                    46750021
REG6     EQU   6         WORK REGISTER FOR LM PROCESSING & TXTBUF       46790021
RIP      EQU   6         LOCATION OF OBJECT MODULE TEXT PRIOR TO MOVE   46830021
*                        INTO PROPER LOCATION IN THE TEXT BUFFER        46870021
TXTBASE  EQU   7         BASE REGISTER FOR TEXT PROCESSOR -             46910021
*                        REG 12 IS BASE FOR RLD PROCESSOR               46950021
XSTX     EQU   7         LINK REGISTER WHEN RETURNING TO MINP FOR LM    46990021
DCBADD   EQU   8         READ. REG 8 HAS DCB ADDRESS                    47030021
GR8      EQU   8         GENERAL WORK REG                               47070021
XTMK2    EQU   8         WORK REG WHEN TEXT NOTE LIST WRITTEN           47110021
READCNT  EQU   9         REGISTER TO PASS LENGTH TO MINP FOR LM READ    47150021
RLK      EQU   9         GENERAL                                        47190021
BUFFADDR EQU   10        LOCATION FOR LM READ PASSED TO MINP            47230021
XP1      EQU   10        GENERAL                                        47270021
XP2      EQU   11        GENERAL                                        47310021
* REG12 - RLD PROCESSOR BASE - REQUIRED WHEN RETURNING FOR ANY COMMON   47350021
*     AREA (WRITE ROUTINE,ERROR HANDLING,AND NORMAL RETURN )            47390021
         EJECT                                                          47430021
         SPACE                                                          47470021
*                                                                       47510021
*                   MASKS AND FLAGS FOR HEWLFTXT                        47550021
*                                                                       47590021
         SPACE                                                          47630021
FLAGOUT  EQU   X'03'            MASK TO ZERO FLAG FIELD IN TXTIO        47670021
READSW   EQU   X'04'      INDICATOR WHEN A READ IS TO BE ISSUED         47710021
READOFF  EQU   X'FB'        TURN OFF THE READ SW                        47750021
DENSE1   EQU   X'40'        FOR INTERNAL INDICATOR                      47790021
DENSE    EQU   X'20'                                                    47830021
TTRDEN   EQU   X'60'              MASK FOR TTR AND DENSE RECORD         47870021
INCORE   EQU   X'80'              MASK FOR TXTIO FLAG                   47910021
NOLEN    EQU   X'80'                                                    47950021
EOF      EQU   X'01'     END OF INPUT SWITCH                            47990037
FULLT    EQU   X'40'                                                    48090037
SHORTRD  EQU   X'20'            MASK FOR SHORT READ FOR LM              48190021
*                     ALL ITEMS IN CONTROL RECORD TO BE DELETED         48230021
SHORTRD1 EQU   X'DF'         MASK TO RESET SHORT READ SWITCH            48270021
NOLEN1   EQU   X'10'                                                    48310021
NOLEN2   EQU   X'08'       NOLENGTH INDICATOR FOR NAME CARD             48350021
NOLEN3   EQU   X'18'          MASK FOR NOLENGTH IN GENERAL              48390021
NOGRPPG  EQU  X'10'           FLAG SIGNIFING A NONGROUPED PURGE REQ     48430021
SPTXTON  EQU   X'80'                    FLAG FOR SPEC LM TEXT   OY00356 48440001
SPTXTOFF EQU   X'7F'                    RESET SPEC LM TEXT FLAG OY00356 48450001
         SPACE 2                                                        48470021
*    *    *    *    *    *    *    *    *    *    *    *    *    *    * 48510021
         EJECT                                                          48550021
         B     TXTINT         BRANCH AROUND IDENTIFIER                  48590037
MODID2   DC    C' START TXT CSECT  '                                    49090037
         DC    0H'0'                                                    49590037
* INITIALIZE     -  WILL SAVE MUCH REPETITION LATER                     50190021
*       TXTFREE - ADDRESS OF NEXT FREE ENTRY IN TXTIO TABLE             50230021
*       TNTFREE - ADDRESS OF NEXT FREE ENTRY IN TXT NOTE LIST           50270021
TXTINT   LH    GR1,ENTOC             PICK UP TXTIO OFFSET       ZA01405 50310002
         ST    GR1,TXTFREE           PRESERVE TXTIO OFFSET      ZA01405 50390002
         A     GR1,TXTIO             COMPUTE TXTIO POINTER      ZA01405 50400002
         LA    R0,7                  CALC 7 BYTES PER TNT ENTRY         50430002
         MH    R0,ENT1C              TIMES CURRENT NO. OF ENTRIES       50470002
         ST    R0,TNTFREE            PRESERVE TNT OFFSET        ZA01405 50480002
         A     R0,TNT1               COMPUTE TNT POINTER                50510002
* WE KNOW THE CURRENT ID AND MULTIPLICITY                               50590021
         TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 50600017
         BO    TXT002A                 IF SO, BRANCH             Y01031 50610017
         CLC   PID(2),CURID   CHECK IF ID IA A REPEAT                   50630021
         BC    7,TXT002          NO - BRANCH                            50670021
         CLC   PMULN(2),CMULN   HAS THE MULT CHANGED                    50710021
         BC    7,TXT002X     YES - BRANCH                       OY00356 50750001
         TM    APT1,EX    IS THIS A LOAD MODULE                         50790021
         BC    1,TXTLM3       YES BRANCH  ID ID THE SAME                50830021
         TM    SWITCH,DENSE1  WAS LAST THING WE WE DEALING WITH A DENSE 50870021
         BC    1,TXTDEN         RECORD                                  50910021
         L     GR1,LASTTNT      OBTAIN LAST NOTELIST ADDR               50950021
         A     GR1,TNT1                RELOCATE TNL POINTER     XA05743 50960003
         B     TXTINSRT                                                 50990021
* SECOND PHASE                                                          51030021
* THE ID  AND OR MULT HAVE CHANGED -                                    51070021
*                                                                       51110021
*                                                                       51150021
TXT002   TM    SWITCH,NOLEN   WAS PREVIOUS ENTRY A NO LENGTH            51190021
         BC    14,TXT002A                                               51230021
*                                                                       51270021
TXTN1    MVC   HOLD1(4),CURID      PRESERVE CURRENT ID                  51310021
         MVC   CURID(2),PID        RESTORE OLD ID                       51350021
         TM    SWITCH,DENSE1        IS THERE DENSE ENTRY TO CLEAR UP    51390021
         BC    14,TXTN5         NO - BRANCH                             51430021
         L     XS1,TNTFREE             PICK UP TNT OFFSET               51470002
         A     XS1,TNT1                COMPUTE TNT POINTER      ZA01405 51480002
         SH    XS1,TSEVEN              SET UP PARAMETER FOR DENSE PURGE 51510002
         BAL   XP2,TXTNIO         GO TO DENSE PURGE                     51550021
TXTN5    NI    SWITCH,X'3F'      CLEAR DENSE AND NOLEN BITS             51590021
         OI    SWITCH,NOLEN2                                            51630021
         B     BUFFALL    FIND NUMBER OF MULT AND LENGTH OF             51670021
*                                   LAST ONE                            51710021
TXT002X  EQU   *                                                OY00356 51720001
         OI    SWITCH+1,SPTXTON         INDICATE CHANGED MULT   OY00356 51730001
TXT002A  TM    SWITCH,DENSE1   WAS PREVIOUS ENTRY DENSE                 51750021
         BC    14,TXT002B         BRANCH LAST NOT DENSE                 51790021
         NI    SWITCH,X'BF'   TUNN OF INDICATOR                         51830021
         L     XS1,TNTFREE             PICK UP TNT OFFSET               51870002
         A     XS1,TNT1                COMPUTE TNT POINTER      ZA01405 51880002
         SH    XS1,TSEVEN   SET UP NOTELIST ADDR                        51910021
         BAL   XP2,TXTNIO         WRITE OUT LAST PIECE                  51950021
TXT002B  MVC   PID(4),CURID    UPDATE PAST ID TO AGREE WITH CURRENT     51990021
         TM    APT1,EX      IS THIS A LOAD MOD                          52030021
         BC    8,TXT003      NO - BRANCH                                52070021
         TM    SWITCH,READSW     HAS THE READ BEEN ISSUED               52110021
         BC    8,TXT002BB       YES  BRANCH                             52150021
         L     R0,TXTBFBEG     ADD THE TXTBUF ADDR TO THE               52190021
         A     R0,BUFDISP       DISPLAC IN THE BUFF TO FIND             52230021
         AR    R0,COUNT                IF THE NEXT READ WILL FIT        52270021
         AH    R0,CDISP                ADD WHAT'S BEEN ALLOCATED A38306 52310021
         C     R0,TXTBFEND                                              52350021
         BC    12,TXT002BB       BR IF IT WILL FIR                      52390021
         BAL   RLK,TXTBUF                                               52430021
         SR    RLK,RLK     RESET DISPLACE IN TXTBUF TO                  52470021
         ST    RLK,BUFDISP      XERO                                    52510021
TXT002BB TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 52550000
         BO    TXT003                  IF SO, BRANCH             Y01031 52552000
         TM    APT1,EX                                           Y01031 52560000
         BC    1,BUFALLOC                                               52590021
*                                                                       52630021
*  NOW CAN SEARCH TXTIO TO SEE IF THIS ID AND MULT HAVE EVER APPEARED   52670021
*     BEFORE                                                            52710021
*                                                                       52750021
TXT003   SR    GR8,GR8        GR8 WILL CONTAIN NOTE LIST DISPLACEMENT   52790021
         L     XS2,TXTIO               PICK UP TXTIO ADDR       ZA01405 52800002
         LR    XS1,XS2                 COPY FOR POINTER CALC    ZA01405 52810002
         A     XS1,TXTFREE             COMPUTE TXTIO POINTER    ZA01405 52830002
         CR    XS1,XS2        ANYTHING IN THE TABLE                     52910021
         BC    8,TXTNEW                                                 52950021
TXT003A  CLC   CURID(2),0(XS2) COMPARE ID FIELD FIRST                   52990021
         BC    8,TXT003B       BRANCH ON A MATCH                        53030021
TXT003C  LA    XS2,4(XS2)                                               53070021
         LA    GR8,7(GR8)                                               53110021
         CR    XS2,XS1                                                  53150021
         BC    4,TXT003A                                                53190021
*  HAVE NEW ID  - TEST IF LENGTH PRESENT IN CESD                        53230021
TXTNEW   TM    SWITCH,NOLEN3                                            53270021
         BC    7,TXTNL6B        ENTRY NO FOUND  RETURN                  53310021
         LH    XS1,CURID                                                53350021
         SLL   XS1,4                                                    53390021
         A     XS1,CHESD                                                53430021
         CLC   13(3,XS1),CONZO1    CESD LENGTH EQU ZERO                 53470021
         BC    7,TXT003D      BRANCH IF LENGTH SPECIFIED                53510021
         OI    SWITCH,NOLEN                                             53550021
TXT003D  B     BUFALLOC                                                 53590021
*                                                                       53630021
*ID MATCHED-MUST CHECK MULT -  FIRST 10 BITS OF TXTIO ENTRY             53670021
TXT003B  LH    GR5,2(XS2)                                               53710021
         N     GR5,MULTONLY     ZERO OUT THE TOP 22 BITS                53750021
         CH    GR5,CMULN                                                53790021
         BC    8,TXTOLD       CONTINUE PROCESS ON A MATCH               53830021
         SH    XS1,SFOUR    POSITION TO LAST ENTRY IN TXTIO             53870021
         CLC   0(2,XS1),CURID  HAS THE ID CHANGED WE ARE PROCESSING     53910021
         BC    7,ABAFIX             YES-  MUST SET NONGRP PURGE NEC     53950021
TXT003B1 LA    XS1,4(XS1)     RESTORE THE ADDR OF FREE TXTIO ADDR       53990021
         B     TXT003C        OR CONTINUE SEARCH                        54030021
*                                                                       54070021
ABAFIX   OI    SWITCH+1,NOGRPPG   SIGNIFY A NONGROUPED PURGE NEC        54110021
         B     TXT003B1          GO BACJ TO RESTORE TXTIO FREE ADDR     54150021
TXTOLD   TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 54160017
         BNO   TXTOLDX                 IF NOT, BRANCH            Y01031 54170017
         OI    SWITCH+1,NOGRPPG        SIGNIFY NON-GROUPED       Y01031 54180017
*                                      PURGE NECESSARY           Y01031 54180123
         AH    COUNT,CDISP             ADD TEXT LENGTH TO        Y01031 54180223
*                                      DISPLACEMENT IN MULT.     Y01031 54180323
         C     COUNT,MULTSIZE          DOES IT FILL THE MULT.?   Y01031 54180723
         BH    TXTOLDXX                IF SO, BRANCH     Y01031,XA05128 54181103
         OI    2(XS2),X'08'            INDICATE UNTRUE LENGTH    Y01031 54181623
*                                      IN PREVIOUS ENTRY         Y01031 54182023
TXTOLDXX SH    COUNT,CDISP             RESET TEXT LENGTH         Y01031 54184023
TXTOLDX  TM    SWITCH,NOLEN3                                     Y01031 54190017
         BC    7,TXTNL3                                                 54230021
         TM    2(XS2),INCORE       CHECK IF ALREADY WRITTEN             54270021
*  XP1- SIZE LAST MULT   XS2-TXTIO ADDR   GR8-TNT1 DISP                 54310021
         BC    8,TXTOLD1      BRANCH IF NOT                             54350021
         XR    RLK,RLK             CLEAR REGISTER                S01904 54390021
         XR    GR1,GR1             CLEAR REGISTER                S01904 54430021
         IC    GR1,ENITC+1         BYTES IN REALOC TXTIO CNTRL   S01904 54470021
         IC    RLK,ENITC           BYTES IN OLD TXTIO CNTRL      S01904 54510021
         AR    GR1,RLK             TOTAL BYTES IN CURRENT TBL    S01904 54550021
         LTR   GR1,GR1           TBL IN USE?                            54590021
         BC    8,TXTOLDA         IF NOT  BRANCH                         54630021
         LA    GR1,7                                                    54670021
         MH    GR1,TXTNOTE                                              54710021
         SR    GR8,GR1          SUB ACTUAL BYTES WRITTEN                54750021
TXTOLDA  L     GR1,TNT1                                                 54790021
         AR    GR1,GR8                                                  54830021
         TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 54840017
         BNO   TXTINSRT             IF NOT, BRANCH                      54870002
TXTOLD1  L     GR8,BUFDISP     BEFORE SIGNALLING DENSE INFO             54910021
         A     GR8,MULTSIZE         CHECK THAT MULT SIZE CAN BE ALLOC   54950021
         A     GR8,TXTBFBEG          IF NOT  IT WILL ENTER PURGE        54990021
         C     GR8,TXTBFEND       EXPECTING LAST ITEM TO BE DENSE       55030021
         BC    12,TXTOLD2                                               55070021
         BAL   RLK,TXTBUF2          PURGE BEFORE SETTING SENSE          55110021
         SR    RLK,RLK            RESET PARA AFTER PURGE                55150021
         ST    RLK,BUFDISP                                              55190021
TXTOLD2  OI    SWITCH,DENSE1                                            55230021
         B     BUFALLOC                                                 55270021
*                                                                       55310021
*BUFALLOC  THIS ROUTINE WILL ALLOCATE REQUIRED SIZE IN BUFFER           55350021
*        PIECE     1 MULT                                               55390021
*        CSECT     1 MULT EXECPT FOR LAST                               55430021
*                       LAST MULT ACTUAL SIZE                           55470021
*                                                                       55510021
BUFALLOC TM    SWITCH,DENSE1  DEALING WITH OUT OF ORDER TEXT            55550021
         BC    8,BUFFALL               NO,BRANCH                        55590021
         TM    APT1,EX                 IS IT LOAD MODULE                55630021
         BC    8,BUF1                  NO,BRANCH                        55670021
         L     XS2,MULTSIZE            YES,PICK UP OUTPUT RECSIZE       55710021
         SH    XS2,CDISP               MULTSIZE-CDISP=TRUE SIZE         55750021
         TM    APTSW3,XPDIND           EXPAND TXT IN PROCESS    XA05128 55760003
         BNO   BUFOUT                  BRANCH IF NOT            XA05128 55770003
         CR    XS2,COUNT               LT REMAINDER OF MULT     XA05128 55780003
         BNH   BUFOUT                  BRANCH IF NOT            XA05128 55782003
         LR    XS2,COUNT               ALLOC ONLY EXPAND LENGTH XA05128 55784003
         B     BUFOUT                  GO TO ALLOCATE THAT MUCH         55790021
BUFFALL  TM    SWITCH,NOLEN   NOLENGTH WILL ALSO GET FULL MULT ALLOC    55830021
         BC    1,BUF1         UNTIL REAL SIZE KNOWN                     55870021
         LH    XS1,CURID      MUST CHECK SIZE IN CESD                   55910021
         SLL   XS1,4                                                    55950021
         A     XS1,CHESD                                                55990021
         CLC   13(3,XS1),CONZO1     IS CESD LENGTH ZERO                 56030021
         BC    7,BUFFALL1                                               56070021
         LH    R0,IEW0614      LOAD ERROR PARA                          56110037
         LR    GR1,XS1                                                  56150021
         B     ERROR                                                    56190021
BUFFALL1 CLC   13(3,XS1),MULTSIZE+1  IF THE CESD SIZE EXCEEDS MULT      56230021
         BC    2,BUF2              BRANCH                               56270021
         LH    XS2,14(XS1)         SIZE = CESD SIZE                     56310021
         SR    XP2,XP2     SET HIGHEST MULT TO ZER/                     56350021
         B     BUFOUT11                                                 56390021
BUF2     L     XP2,12(XS1)    PICK UP ACTUAL CESD LENGTH                56430021
         LA    XP2,0(XP2)    CLEAR HIGH ORDER BYTE                      56470021
         SR    XP1,XP1                                                  56510021
         D     XP1,MULTSIZE                                             56550021
         LTR   XP1,XP1            IF THE REMAINDER IS ZERO IT IS        56590021
         BC    7,BUF1A            NECESSARY TO DECREMENT THE MULT ONE   56630021
         BCTR  XP2,0                                                    56670021
         L     XP1,MULTSIZE       INSERT FULL SIZE                      56710021
BUF1A    TM    SWITCH,NOLEN3                                            56750021
         BC    7,BUF1A1                                                 56790021
         CH    XP2,CMULN           IS THIS THE LAST MULT                56830021
         BC    7,BUF1               FULL MULT                           56870021
BUF1A1   LR    XS2,XP1          GET CORRECT LENGTH FOR NO LEN           56910021
BUFOUT11 LA    XS2,7(XS2)              MUST ALLOC THE LAST MULT ON      56950021
         N     XS2,DBLWRD                 A DOUBLEWORD BOUNDARY         56990021
         TM    SWITCH,NOLEN3                                            57030021
         BC    8,BUFOUT                                                 57070021
         LR    XP1,XS2          SAVE LENGTH FOR NO LENGTH               57110021
         B     TXTNL2                                                   57150021
BUF1     L     XS2,MULTSIZE                                             57190021
BUFOUT   LR    R0,R15                                                   57230021
         L     GR1,BUFDISP                                              57270021
         A     GR1,TXTBFBEG                                             57310021
         ST    GR1,BUFSTART                                             57350021
         A     R0,BUFDISP                                               57390021
         ST    R0,BUFDISP                                               57430021
         A     R0,TXTBFBEG        HAVE WE EXCEEDED BUFFER LIMITS        57470021
         C     R0,TXTBFEND                                              57510021
         BC    12,BUFCLR     ******REMOVE WHENBUFCLR NO LONGER          57550021
*         NECESSARY    REPLACE WITH    BC   10,BUFENT                   57590021
         ST    XS2,BUFDISP                                              57630021
         ST    XS2,SPACES                                               57670021
         BAL   RLK,TXTBUF          YES - PURGE                          57710021
         TM    APT1,EX     IS THIS A LOAD MOD                           57750021
         BC    14,BUFOUT1                                               57790021
         L     XP1,LMLEN     SET LENGTH PARA FOR MOVE                   57830021
         L     GR8,TXTBFBEG        SET UP TO ADDR                       57870021
         L     GR9,BUFSTART    SET UP FROM AD                           57910021
         BAL   XP2,LMMOVE                                               57950021
BUFOUT1  L     GR1,TXTBFBEG    RESER POINTERS                           57990021
         L     XS2,SPACES                                               58030021
         ST    GR1,BUFSTART                                             58070021
         B     BUFCLR       ********REMOVE WHEN BUFCLR NO LONGER        58110021
*         NECESSARY    REPLACE WITH    B   BUFENT                       58150021
*                                                                       58190021
TXTNL2   STH   XP2,CMULN           KNOW IDENTIFICATION OF LAST MULT     58230021
         B     TXT003              GO SEARCH TXTIO FOR ENTRY TO CORRECT 58270021
*                                   LENGTH                              58310021
*                                                                       58350021
*           THIS IS A SUBROUTINE TO CLEAR THE ALLOCATED                 58390021
*           PORTION OF THE BUFFER -   THIS IS NECESSARY IN ORDER TO     58430021
*             SYSGEN THE NUCLEUS AND SHOULD BE REMOVED WHEN             58470021
*            FETCH NO LONGER REQUIRES ZEROS IN BUFFER                   58510021
*                                                                       58550021
BUFCLR   TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 58590000
         BO    BUFCLR4                 IF SO, BRANCH             Y01031 58592000
         TM    PDSE7,X'04'        IF SCATTER NOT SPECIFIED -     Y01031 58600000
         BC    8,BUFENT           WILL AVOID CLEARING BUFFER            58630000
         TM    APT1,EX            MUST ALSO AVOID IF LOAD MOD INPUT     58670021
         BC    8,BUFCLR4       IF IS LM   WILL AVOID CLEARING IF        58710021
         TM    SWITCH,READSW        THE READ HAS BEEN ISSUED            58750021
         BC    8,BUFENT         SINCE IT IS IMPOSSIBLE TO TELL          58790021
BUFCLR4  LR    XP2,XS2      WHAT THE GROUPING WAS                       58830021
         LA    XP1,256                                                  58870021
         L     GR1,BUFSTART       GR1 - STARTING ADDR OF AREA           58910021
BUFCLR1  CR    XP1,XP2            LENGTH GT 256                         58950021
         BC    10,BUFCLR2         NO - BRANCH                           58990021
         XC    0(256,GR1),0(GR1)                                        59030021
         SR    XP2,XP1            DECREMENT COUNT                       59070021
         AR    GR1,XP1            INCREMENT ADDR                        59110021
         B     BUFCLR1                                                  59150021
BUFCLR2  BCTR  XP2,0                                                    59190021
         EX    XP2,BUFCLR3                                              59230021
         B     BUFENT                                                   59270021
*                                                                       59310021
BUFCLR3  XC    0(1,GR1),0(GR1)                                          59350021
*                                                                       59390021
*                                                                       59430021
* BUFENT MAKES ALL NECESSARY ENTRIES IN TXTIO TABLE AND TXT NOTE LIST   59470021
*        R15 CONTAINS ALLOCATED SIZE                                    59510021
*        BUFSTART CONTAINS BUFF STARTING ADDR FOR AREA                  59550021
BUFENT  SR     XP2,XP2                                                  59590021
         TM    SWITCH,DENSE1                                            59630021
         BC    1,BUFENT1      AVOID THE DIVIDE BUT CHECK FOR FULL TABLE 59670021
         C     XS2,UT1SIZE    WAS LARGER THAN UT1 ALLOC                 59710021
         BC    12,BUFENT1     NO - BRANCH                               59750021
         LR    XP2,XS2                                                  59790021
         SR    XP1,XP1                                                  59830021
         D     XP1,UT1SIZE                                              59870021
         ST    XP1,DISPLAC    DISPLAC IN LAST SECTION                   59910021
         LTR   XP1,XP1        WILL THE DIVIDE COME OUT EVEN             59950021
         BC    8,BUFENT1A                                               59990021
BUFENT1  LA    XP2,1(XP2)     XP2 HAS NUMBER OF ENTRIES REQUIRED        60030021
BUFENT1A LR    GR9,XP2                                                  60070021
         SLL   GR9,2        MUST INSURE THAT THE TXTIO                  60110021
         AH    GR9,ENTOC       HAS NOT BEEN OVERFLOWED                  60150021
BUFENT3A CH    GR9,ENTOX         IF IT HAS  IT IS A                     60190021
         BC    12,BUFENT1B       UNRECOVERABLE ERROR                    60230021
         TM    APT4,REALOCTE       HAS REALLOC BEEN DONE?        S01904 60270021
         BNO   BUFENT2A            NO,TRY REALLOCATION           S01904 60310021
QUIT     LA    MSG,IEW0364     TXTIO OVFLOW - TERMINATE JOB    @ZA07602 60350037
         B     ERROR                                                    60390021
BUFENT2A STM   WRKREG0,WRKREGF,BRNCHSV  SAVE REGISTERS           S01904 60430021
         L     BRANCH,ERDIGA       GET ADDR OF REALLOC RTN       S01904 60710021
         BALR  RETURN,BRANCH       GO TO REALLOC RTN             S01904 60750021
         LM    WRKREG0,WRKREGF,BRNCHSV  RESTORE REGISTERS        S01904 60790021
         B     BUFENT3A            CHECK FOR OVERFLOW AGAIN      S01904 61110021
BUFENT1B ST    XS2,HOLD3               MUST PRESERVE ALLOC LEN  XA05445 61160003
         ST    XS2,HOLD                LENGTH IN HOLD           XM09521 61170003
         MVC   HOLD1(4),CURID          SETUP FOR TXTIOT         XM09521 61180003
BUFENT1E LA    GR9,7                   GET LEN OF TNL ENTRY     XA05445 61210003
         MH    GR9,ENT1X               GET LEN OF CURRENT TNL   XM08070 61260003
         C     GR9,TNTFREE             TEST FOR END OF TNL      XA05445 61280003
         BH    BUFENT2B         BRANCH IF NOT REACHED   XM08070,XM09521 61290003
         TM    IOCTSTAT,FULLT      IO CNTRL TBL OVFLOW?          S01904 61310021
         BZ    BUFENT1C            NO,BRANCH OUT                 S01904 61350021
         TM    APT4,REALOCTE       HAS REALLOC BEEN DONE         S01904 61390021
         BO    QUIT                YES,TOO MUCH INPUT          @ZA07602 61430037
         STM   WRKREG0,WRKREGF,BRNCHSV  SAVE REGISTERS           S01904 61470021
         L     BRANCH,ERDIGA       GET ADDR OF REALLOC RTN       S01904 61750021
         BALR  RETURN,BRANCH       GO TO REALLOC RTN             S01904 61790021
         LM    WRKREG0,WRKREGF,BRNCHSV  RESTORE REGISTERS        S01904 61830021
         B     BUFENT2B                                         XM09521 62150003
BUFENT1C LR    GR3,XP2      SAVE REG XP2 WHEN ENTERING PURGES           62190021
         MVC   HOLD3+8(1),SWITCH       MUST MAINTAIN SWITCH             62230021
         ST    XS2,BUFDISP                                              62270021
         BAL  RLK,TXTBUF2                                               62310021
         TM    APT1,EX       IS THIS A LOAD MODULE                      62350021
         BC    14,BUFENT1D        IF NOT  BRANCH                        62390021
         L     RLK,BUFSTART       WAS THERE ANY THING IN THE            62430021
         C     RLK,TXTBFBEG        THAT WAS NOT ALLOC I                 62470021
         BC    8,BUFENT1D         IF NOT   NO SWEAT                     62510021
         L     XP1,LMLEN       IF THERE WAS  IT MUST                    62550021
         L     GR8,TXTBFBEG         IT MUST BE MOBED TO THE FRONT       62590021
         BAL   XP2,LMMOVE     OF THE BUFFER AND RECORDED                62630021
BUFENT1D L     RLK,TXTBFBEG                                             62670021
         MVC   SWITCH(1),HOLD3+8         RESTORE SWITCH AFTER PURGE     62710021
         ST    RLK,BUFSTART                                             62750021
         BAL   RLK,BUFTMK2                                              62790021
         L     XS2,BUFDISP                                              62830021
         LR    XP2,GR3                                                  62870021
         ST    XS2,HOLD3                 SAVE ALLOCATED LENGTH  XM08070 62880003
BUFENT2  ST    XS2,HOLD        LENGTH IN HOLD                           62910021
BUFENT2B EQU   *                                                XM09521 62960003
         OI    HOLD1+2,INCORE  MARK ENTRY AS INCORE                     63030021
         L     GR8,TNTFREE             PICK UP TNT OFFSET               63070002
         A     GR8,TNT1                COMPUTE TNT POINTER      ZA01405 63120002
         L     GR1,TXTFREE             PICK UP TXTIO OFFSET     XA05445 63150002
         A     GR1,TXTIO               COMPUTE TXTIO POINTER    ZA01405 63160002
         TM    SWITCH,DENSE1                                            63190021
         BC    1,BUFDEN                                                 63230021
BUFENTA  MVC   0(4,GR1),HOLD1      INSERT ID & MULT IN TXTIO            63270021
         MVC   0(2,GR8),HOLD+6         PUT OFFSET IN TNL ENTRY  XA05445 63280003
         MVC   5(2,GR8),HOLD+2     PUT LENGTH IN NOTELIST               63310021
         MVC   2(3,GR8),BUFSTART+1  AND STARTING ADDR                   63350021
         BAL   GR1,TXTPTR           UPDATE ALL INTERNAL PTRS            63390021
         BCT   XP2,BUFENT4         HAVE WE MADE ALL NECESARY ENTRIES    63430021
         L     XS2,HOLD3      MUST PRESERVE THE ALLOC LENGTH            63470021
         ST    XP2,HOLD+4          ZERO AREA AS WE LEAVE                63510021
         TM    APT1,EX            IS THIS A LOAD MODULE                 63550021
         BC    8,BUFENTA1          BR ON OBJENT INPUT                   63590021
         TM    SWITCH,READSW       HAS THE READ BEEN ISSUED             63630021
         BC    8,TXTLM5       YES  BRANCH                               63670021
         LA    GR3,TXTLM5        SET RETURN ADDR AFTER READ             63710021
         B     TXTREAD                                                  63750021
BUFENTA1 LR    GR1,GR8     SET UP A PARA FOR OBJ INPUT                  63790021
         B     TXTINSRT                                                 63830021
BUFENT4  OI    HOLD1+2,DENSE                                            63870021
         LH    R0,HOLD+6           UPDATE DISP                          63910021
         A     R0,UT1SIZE                                               63950021
         STH   R0,HOLD+6                                                63990021
         S     XS2,UT1SIZE                                              64110021
         C     XS2,UT1SIZE                                              64150021
         BC    10,BUFENT6           HIGH OR EQU                         64190021
         MVC   HOLD+2(2),DISPLAC+2 MOVE APPROP LEN INTO HOLD AREA       64230003
         B     BUFENT1E              RETURN FOR NEXT ENTRY      XA05445 64270003
BUFENT6  MVC   HOLD+2(2),UT1SIZE+2 MOVE APPROP LEN INTO HOLD AREA       64310003
         B     BUFENT1E              RETURN FOR NEXT ENTRY      XA05445 64350003
*                                                                       64390021
*                                                                       64430021
BUFDEN   MVC   HOLD+6(2),CDISP   WILL ONLY BE THRU HERE ONCE    XM09517 64470003
         OI    HOLD1+2,DENSE      MARK WORK AREA DENSE FOR ENTRY        64510021
         L     R0,BUFSTART           MUST REESTABLISH THE               64550021
         AH    R0,CDISP         FROMAD FOR THE PURGE    TXTNIO          64590021
         ST    R0,FROMAD           THIS WILL BE THE STARTING ADDR       64630021
         TM    APT1,EX     CAN BE A LOAD WHEN CONFIG REQUIRES THAT A    64670021
         BC    1,BUFDEN1         ID BE READ BUT WILL NOT FIT IN BUFFER  64710021
*       BUT HAS BEEN ALLOCATED - CAUSED BY GROUPED INPUT                64750021
         ST    GR4,HOLD                                                 64790021
         AR    R0,GR4                                                   64830021
         ST    R0,TOADDR                                                64870021
         LH    XP1,CDISP                                                64910021
         AR    XP1,GR4    WILL PIECE EXTEND BEYOND MYLT                 64950021
         C     XP1,MULTSIZE     NO   BRANCH                             64990021
         BC    12,BUFENTA                                               65030021
         SR    XP1,GR4     OBTAIN TRUE ADDR THAT WILL FIT               65070021
         LNR   XP1,XP1                                                  65110021
         A     XP1,MULTSIZE                                             65150021
         ST    XP1,HOLD                                                 65190021
         ST    XP1,TOADDR     CHANGE TO ADDR TO PREVENT LATTER MATCH    65230021
         B     BUFENTA                                                  65270021
BUFDEN1  SH    R0,CDISP                REALIGN                          65310021
         ST    R0,FROMAD               FROM ADDR                        65350021
         B     BUFENTA                                                  65390021
* THE TXT IS ADDED IN THE BUFFER AS THE LAST STEP - SPACE HAS BEEN      65430021
*  ALLOCATED IF NECESSARY AND RECORDED IN THE TXTIOT AND TXT NOTE LIST  65470021
*        REG1 WILL CONTAIN THE APPROP NOTE LIST ADDR                    65510021
*                                                                       65550021
TXTINSRT LH    R0,CDISP       TEST IF END OF PIECE WILL EXCEED          65590021
         S     GR1,TNT1                CALC TNL OFFSET          XA05743 65600003
         ST    GR1,LASTTNT        SAVE NOTE LIST ADDR                   65630021
         A     GR1,TNT1                RESTORE TNL POINTER      XA05743 65640003
         AR    R0,GR4             MULTIPLICITY BOUNDRY                  65670021
         C     R0,MULTSIZE                                              65710021
         BC    2,TXTSPLT      BRANCH IF SPLITTING NECESSARY             65750021
         BAL   RLK,TXTMOVE                                              65790021
         B     TXTRET                                                   65830021
*                                                                       65870021
TXTMOVE  MVC   HOLD+1(3),2(GR1)    OBTAIN BUFFER ADDR                   65910021
         L     GR1,HOLD                                                 65950021
         AH    GR1,CDISP                                                65990021
         BCTR  GR4,0               DECREMENT LENGTH                     66030021
         EX    GR4,TXTMVE          MOVE  INTO  BUFFER                   66070021
         LA    GR4,1(GR4)          RESET LENGTH                         66110021
         BR    RLK                                                      66150021
*                                                                       66190021
TXTMVE   MVC   0(1,GR1),0(RIP)                                          66230021
*                                                                       66270021
TXTSPLT  LR    GR8,GR4      THE TXT HAS SPANNED TEO MULTIPLICITIES      66310021
         L     GR4,MULTSIZE      MOVE AS MUCH AS WILL FIT               66350021
         SH    GR4,CDISP         READJUST PARAMETERS AND REENTER        66390021
         BAL   RLK,TXTMOVE                                              66430021
         SR    GR8,GR4        UPDATE LOCATION                           66470021
         AR    RIP,GR4       -UPDATE LOCATION                           66510021
         LR    GR4,GR8           RESTORE LINGTH                         66550021
         LA    R0,1                                                     66590021
         AH    R0,CMULN                                                 66630021
         STH   R0,CMULN       UPDATE MULTIPLICITY                       66670021
         SR    R0,R0          AND                                       66710021
         STH   R0,CDISP       ZERO DISPLACEMENT                         66750021
         B     TXT002A                                                  66790021
*                                                                       66830021
* TXTEND - EOF RECEIVED - IF NOLENGTH CSECT - LENGTH MUST BE POSTED     66870021
*         AT THIS TIME -  ALSO THE BUFFER MUST BE CLEANED IF NECESSARY  66910021
*                                                                       66950021
TXTEND   TM    SWITCH,DENSE1                                            66990021
         BC    14,TXTENDA                                               67030021
         L     XS1,TNTFREE             PICK UP TNT OFFSET               67070002
         A     XS1,TNT1                COMPUTE TNT POINTER      ZA01405 67080002
         SH    XS1,TSEVEN         OBTAIN LAST NOTELIST ADDR FOR TXTNIO  67110002
         BAL   XP2,TXTNIO                                               67150021
         NI    SWITCH,X'BF'        CLEAN UP DENSE SW                    67190021
TXTENDA  TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 67230017
         BO    TXTEND2A                IF SO, BRANCH             Y01031 67232017
         TM    SWITCH,NOLEN                                             67240017
         BC    14,TXTEND1   BRANCH IF NOT NOLENGTH                      67270021
         OI    SWITCH,NOLEN1      NOLENGTH CLEANUP                      67310021
         ST    RLK,RETURNAD       SAVE RETURN ADDR                      67350021
         B     TXTN1                                                    67390021
TXTENDNL NI    SWITCH,X'EF'         TURN OFF CLEAN UP                   67430021
         L     RLK,RETURNAD      RESTORE RETURN ADDR                    67470021
TXTEND1  L     GR1,TXTIO    TEST FIRST ENTRY TXTIO TABLE TO SEE         67510021
         TM    2(GR1),INCORE         IF IT HAS BEEN WRITTEN OUT         67550021
         BC    1,TXTEND2A    NO   TEST IF OVERLAY IS SPECIFIED          67590021
TXTEND1A ST    RLK,RETURNAD        SAVE RETURN ADDR                     67630021
         BAL   RLK,TXTBUF2    CLEAR TXTBUFFER                           67670021
         L     RLK,RETURNAD      RESTORE RETURN ADDR                    67710021
TXTEND2  SR    R0,R0                                                    67750021
         STH   R0,SWITCH     CLEAN UP  SWITCH FOR NEXG INTERATION       67790021
         ST    R0,BUFDISP    CLEAR BUFFER DISP                          67830021
         STH   R0,PID           MADE RAT REENTERABLE                    67870021
         STH   R0,TXTNOTE          REINITIALIZE TO ZER/                 67910021
         STH   R0,TXTWR     CLEAR NUMBER OF ENTRIES WR IN TXTIO         67950021
         BR    RLK                                                      67990021
TXTEND2A TM    PDSE7,X'20'        IF OVLY SPEC  MUST FORCE              68030021
         BC    1,TXTEND1A          2 PASS SITUATION                     68070021
         TM    APT4,ORDERR         IS ORDERING REQUIRED?         S01904 68110021
         BO    TXTEND1A            YES,MUST FORCE PURGE          S01904 68150021
         TM    SWITCH+1,NOGRPPG      IS A NONGROUPED PURGE REQUIRED     68190021
         BC    1,TXTEND1A          YES  BRANCH TO PURGE                 68230021
         B     TXTEND2                                                  68270021
*THIS ROUTINE  WILL CHECK IF THE NEW DENSE PIECE IS CONTIGUOUS WITH     68310021
* THE EXISTING  DENSE RECORD IN THE BUFFER                              68350021
*   IF IT IS IT WILL BE ADDED                                           68390021
*  -IF NOT-  THE EXISTING PIECE WILL BE WRITTEN AND NEW ONE ADDED       68430021
*              KNOW ID AND MULT ARE SAME AS PREVIOUS                    68470021
*                                                                       68510021
TXTDEN   L     XS1,TNTFREE             PICK UP TNT OFFSET               68550002
         A     XS1,TNT1                COMPUTE TNT POINTER      ZA01405 68552002
*                            IF A DENSE RECORD PRESENT IT WILL ALWAYS   68560002
         SH    XS1,TSEVEN    BE THE LAST ENTRY  CORRECT TNT1 ADDR       68590002
         MVC   HOLD+1(3),2(XS1) OBTAIN BUFFER ADDR                      68630021
         L     GR9,HOLD                                                 68670021
         AH    GR9,CDISP       GR9 CONTAINS WHERE NEW PIECE WOULD BEGIN 68710021
         L     GR1,TOADDR                                               68750021
         CR    GR9,GR1         PIECE                                    68790021
         BC    8,TXTDEN1      IF EQU NEW CAN BE ADDED AFTER OLD AFTER   68830021
*                             FIRST ENSURING LENGTH WON'T EXCEED MULT   68870021
         AR    GR9,GR4                                                  68910021
         C     GR9,FROMAD      PIECE WE WISH TO ADD EQ BEGINNING OF OLD 68950021
         BC    7,TXTDEN2      NO BRANCH                                 68990021
         SR    GR9,GR4                                                  69030021
         ST    GR9,FROMAD     AND INCREMENT LENGTH                      69070021
         MVC   0(2,XS1),CDISP      DD OF PIECE                          69110021
         LR    R0,GR4                                                   69150021
TXTDENA1 MVC   HOLD+2(2),5(XS1) RETRIEVE OLD LENGTH                     69190021
         AH    R0,HOLD+2                                                69230021
         STH   R0,HOLD+2        ADD ADDITIONAL                          69270021
         MVC   5(2,XS1),HOLD+2                                          69310021
         LR    GR1,XS1         SET UP PARA FOR TXTINSRT                 69350021
         B     TXTINSRT                                                 69390021
* THE TXT IS TO BE ADDED BEHIND PRESENT PIECE - MUST CHECK FIRST TO     69430021
*  ENSURE DOESN'T EXCEED MULT BOUNDRIES                                 69470021
TXTDEN1  LH    GR9,CDISP                                                69510021
         AR    GR9,GR4                                                  69550021
         LR    R0,GR4                                                   69590021
         L     GR1,TOADDR          BRANCH IF ALL FIT -                  69630021
         AR    GR1,GR4        SIMPLY INCREASE LENGTH                    69670021
         ST    GR1,TOADDR                                               69710021
         C     GR9,MULTSIZE                                             69750021
         BC    12,TXTDENA1                                              69790021
         SR    GR9,GR4            IF EXCEEDS MULT LIMIT - ENTER SIZE    69830021
         LNR   GR9,GR9             THAT WILL FIT - INSERT ROUTINE WILL  69870021
         A     GR9,MULTSIZE        TAKE CARE OF OVERLAP                 69910021
         LR    R0,GR9         SET UP REG ZERO WITH CORRECT LEN          69950021
         B     TXTDENA1                                                 69990021
*                                                                       70030021
*THE TXT WAS NOT CONTIGUOUS  -  WILL WRITE OUT EXISTING PIECE           70070021
*                                                                       70110021
TXTDEN2  LA    XP2,BUFALLOC                                             70150021
         B     TXTNIO                                                   70190021
*                                                                       70230021
* THIS ROUTINE  IS USED WHENEVER A  SECTION OF OUT OF ORDER TEXT IS TO  70270021
*   BE WRITTEN OUT  -  IT WILL MAKE ADDITIONAL ENTRIES IF SIZE OF       70310021
*   PIECE EXCEEDS UT1                                                   70350021
*                                                                       70390021
TXTNIO   LR    GR8,XS1                                                  70430021
         ST    XRET2,HOLD3    RESERVE REG5                              70470021
         L     GR1,TXTFREE             PICK UP TXTIO OFFSET             70510002
         A     GR1,TXTIO               COMPUTE TXTIO POINTER    ZA01405 70520002
*                             CHECK IF LAST ENTRY HAS ALREADY BEEN      70530002
         SH    GR1,SFOUR      WRITTEN  CAN HAPPEN IN ISOLATED           70550021
         TM    2(GR1),DENSE      WAS THE LAST ENTRY MADE DENSE          70590021
         BCR   8,XP2       IF NOT  RETURN IMMEDIATLY                    70630021
         TM    2(GR1),INCORE       HAS THE LAST DENSE ENTRY             70670021
         BCR   8,XP2     WRITTEN  --     YES RETURN                     70710021
         L     XS2,FROMAD                                               70750021
TXTNIOA  MVC   HOLD+2(2),5(GR8)    RETRIEVE  LENGTH                     70790021
         LH    XS1,HOLD+2       IF PIECE SIZE EXCEEDS UT1 - BRANCH      70830021
         CH    XS1,UT1SIZE+2                                            70870021
         BC    2,TXTNI1                                                 70910021
         BAL   XRET2,COMBUF                                             70950021
         BAL   XRET2,COMCHK                                             70990021
         ST    GR1,HOLD                                                 71030021
         MVC   2(3,GR8),HOLD      RECORD TTR                            71070021
         TM    APT1,EX    IS THIS A LOAD MODULE                         71110021
         BC    1,TXTNIOB                                                71150021
         L     R0,BUFDISP                                               71190021
         S     R0,MULTSIZE                                              71230021
         ST    R0,BUFDISP         FREE ALLOC BUFFER AREA                71270021
TXTNIOB  LA    R0,4        SET TO DECREMENT TO LAST TXTIO ENTRY         71310021
         L     GR1,TXTFREE             PICK UP TXTIO OFFSET             71350002
         A     GR1,TXTIO               COMPUTE TXTIO POINTER    ZA01405 71360002
         SR    GR1,R0                                                   71390021
         NI    2(GR1),FLAGOUT      ZERO FLAG FIELD                      71430021
         OI    2(GR1),TTRDEN                                            71470021
         L     XRET2,HOLD3   PRESERVE REG5                              71510021
         BR    XP2                                                      71550021
TXTNI1   L     GR1,TXTFREE             PICK UP TXTIO OFFSET             71590002
         A     GR1,TXTIO               COMPUTE TXTIO POINTER    ZA01405 71600002
         LA    R0,4                    MAKE ADDITIONAL ENTRY            71630002
         SR    GR1,R0                                                   71670021
         MVC   4(4,GR1),0(GR1)                                          71710021
         MVC   5(2,GR8),UT1SIZE+2     INSERT UT1 LENGTH                 71750021
         S     XS1,UT1SIZE                                              71790021
         STH   XS1,HOLD1+4        NEW LENGTH                            71830021
         MVC   HOLD1+1(3),2(GR8)     OBTAIN BUFFER ADDR                 71870021
         MVC   HOLD1+6(2),0(GR8)         AND THE DISPLACEMENT           71910021
         LA    R0,1                THE LENGTH OF THE ENTRY EXCEEDS      71950021
         AH    R0,ENT1C       UT1 -  FIRST MAKE EXTRA TABLE             71990021
         CH    R0,ENT1X       ENTRIES                                   72030021
         BC    12,TXTN3                                                 72070021
         TM    IOCTSTAT,FULLT      IO CNTRL TBL OVFLOW?          S01904 72110021
         BNO   TXTNI11             NO,BRANCH OUT                 S01904 72150021
         TM    APT4,REALOCTE       HAS REALLOC BEEN DONE?        S01904 72190021
         BO    QUIT                YES,TOO MUCH INPUT          @ZA07602 72230037
         STM   WRKREG0,WRKREGF,BRNCHSV  SAVE REGISTERS           S01904 72270021
         L     BRANCH,ERDIGA       GET ADDR OF REALLOC RTN       S01904 72550021
         BALR  RETURN,BRANCH       GO TO REALLOC RTN             S01904 72590021
         LM    WRKREG0,WRKREGF,BRNCHSV  RESTORE REGISTERS        S01904 72630021
         B     TXTN3                                             S01904 72950021
TXTNI11 STM   XS1,XS2,SPACES                                            72990021
         BAL   RLK,TXTBUF1     PURGE AVOIDING DENSE CHECK               73030021
         SR    RLK,RLK   ZERO BUFFER DISPLACEMENT AFTER                 73070021
         ST    RLK,BUFDISP    PURGING BUFFER                            73110021
         BAL   RLK,BUFTMK2                                              73150021
         LM    XS1,XS2,SPACES                                           73190021
         B     TXTN2                                                    73230021
TXTN3    L     XS1,UT1SIZE         CORRECT LENGTH FOR FIRST WRITE       73270021
         NI    2(GR1),FLAGOUT      ZERO FLAG FIELD                      73310021
         OI    2(GR1),TTRDEN                                            73350021
         BAL   XRET2,COMBUF                                             73390021
         BAL   XRET2,COMCHK                                             73430021
         ST    GR1,HOLD                                                 73470021
         MVC   2(3,GR8),HOLD      STORE TTR                             73510021
TXTN2    L     GR8,TNTFREE             PICK UP TNT OFFSET               73550002
         A     GR8,TNT1                COMPUTE TNT POINTER      ZA01405 73560002
         LH    GR1,HOLD1+6                                              73590021
         A     GR1,UT1SIZE                                              73630021
         STH   GR1,HOLD1+6                                              73670021
         MVC   0(2,GR8),HOLD1+6                                         73710021
         MVC   2(5,GR8),HOLD1+1                                         73750021
         BAL   GR1,TXTPTR                                               73790021
         LH    XS2,HOLD1+6                                              73830021
         A     XS2,HOLD1         RESET STARTING ADDR                    73870021
         LA    XS2,0(XS2)                                               73910021
         B     TXTNIOA        REENTER CHECKING NEWLY CREATED ENTRY WITH 73950021
*                        DECREMENTED LENGTH                             73990021
*                                                                       74030021
TXTPTR   LA    R0,1                                                     74070021
         AH    R0,ENT1C          INCREMENT COUNT OF ENTRIES             74110021
         STH   R0,ENT1C          TXT NOTE LIST                          74150021
         LA    R0,4                                                     74190021
         AH    R0,ENTOC          INCREMENT COUNT OF BYTES               74230021
         STH   R0,ENTOC          TXT IO TABLE                           74270021
         LA    R0,4                                                     74310021
         A     R0,TXTFREE        UPDATE PTR TO FIRST FREE ENTRY IN      74350021
         ST    R0,TXTFREE          TXT IO TABLE                         74390021
         LA    R0,7                                                     74430021
         A     R0,TNTFREE           UPDATE PTR TO FIRST FREE ENTRY IN   74470021
         ST    R0,TNTFREE           TEXT NOTE LIST                      74510021
         BR    GR1                                                      74550021
*                                                                       74590021
* LOAD MODULE PROCESSOR                                                 74630021
*                                                                       74670021
*      FIRST STEP IS TO DETERMINE IF ALL ID'S ARE TO BE DELETED         74710021
*       IF SO - READ WILL BE ISSUED WILL ZERO LENGTH                    74750021
TXTLM    LA    READCNT,1    SET UP PARA FOR ZERO READ                   74790021
         NI    SWITCH+1,SPTXTOFF        RESET SPEC TEXT FLAG    OY00356 74792001
         TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 74800000
         BO    TXTLMX                  IF SO, BRANCH             Y01031 74810017
         L     REG6,RLDINPAD   INITIALIZE ID-LENGTH PTR                 74830021
         L     COUNT,12(REG6)      COUNT SET FOR TOTAL INPUT            74870021
         LA    COUNT,0(COUNT)     CLEAR THE HIGH ORDER BYTE             74910021
TXTLMX   ST    COUNT,LMLEN         SAVE INPUT RECORD LENGTH      Y01031 74950017
         TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 74960017
         BO    TXTLM1X                 IF SO, BRANCH             Y01031 74970017
         LH    R0,4(REG6)                                               74990021
         AH    REG6,6(REG6)                                             75030021
         LA    REG6,16(REG6)                                            75070021
         ST    REG6,IDLENPTR                                            75110021
         AR    R0,REG6                                                  75150021
         ST    R0,CREND  INIT ID-LENGTH LIST END PTR                    75190021
         LR    RID1,RID       CALCULATE RENUMBER                        75230021
TXTLM1   SLL   RID1,2          ENTRY                                    75270021
         A     RID1,RECNT                                               75310021
         TM    DT(RID1),DEL    IS THIS ID TO BE DELETED                 75350021
         BC    7,TXTLM1A          CONTINUE SEARCH IF DELETE             75390021
TXTLM1X  OI    SWITCH,READSW         INDICATE READ IS REQUIRED   Y01031 75430000
         B     TXT0011                                                  75470021
TXTLM1A  LA    RIP,4(RIP)          ONTINUE SEARCH                       75510021
         C     RIP,CREND     WAS THAT THE LAST ONE                      75550021
         BC    10,READ0                                                 75590021
         LH    RID1,0(RIP)                                              75630021
         B     TXTLM1                                                   75670021
READ0    OI    SWITCH,SHORTRD      ALL ITEMS IN THIS RECORD ARE TO BE   75710021
*      DELETED                                                          75750021
         LA    BUFFADDR,HOLD1        BUMMY AREA FOR ARTIFICAL           75790021
         B     READ0A          READ                                     75830021
TXTREAD  LR    READCNT,COUNT        SET UP COUNT FOR READ               75870021
         ST    XS2,TXTALLOC                                             75910021
         L     BUFFADDR,BUFSTART                                        75950021
         AH    BUFFADDR,CDISP         COMPUTE CORRECT LOCATION          75990021
         TM    SWITCH,DENSE1           IS THIS RECORD DENSE             76030021
         BC    8,READ0B                NO, BRANCH                       76070021
         SH    BUFFADDR,CDISP          YES,RESET BUFR START ADDR        76110021
READ0B   NI    SWITCH,READOFF          ALL SET TO READ                  76150021
READ0A   L     DCBADD,HEWLCLAC      ADDR OF CURRENT READ BLOCK          76190021
         L     DCBADD,0(DCBADD)           ADDR OF DECB FOR THE READ     76230021
         L     REG6,INPADD         ESTABLISH  BASE FOR READ             76270021
         L     XP2,RDMACRO                                              76310021
         LR    COUNT,TXTBASE     REG4 WILL HOLD BASE UNTIL RETURN       76350021
         TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 76360000
         BO    READ0AX                 IF SO, BRANCH             Y01031 76370017
         BALR  XSTX,XP2                                                 76390021
         LR    TXTBASE,COUNT                                            76430021
         TM    SWITCH,SHORTRD       A SHORT READ TO BE ISSUED           76470021
         BC    14,TXTGREAD        NO  BRANCH                            76510021
         NI    SWITCH,SHORTRD1      RESET SWITCH                        76550021
         B     TXTRET                                                   76590021
READ0AX  LH    RID,CURID               RESTORE ESDID             Y01031 76600017
         L     COUNT,LMLEN             RESTORE TXT COUNT Y01031,XA05128 76610003
         B     GREADX                  CONTINUE                  Y01031 76620017
TXTGREAD L     COUNT,IDLENPTR                                           76630021
         LH    RID,0(COUNT)   MUST RESTOTE ID                           76670021
         LH    COUNT,2(COUNT)                                           76710021
GREADX   SR    GR1,GR1      PREPARE TO ZERO ACCUNLEN             Y01031 76750017
         ST    GR1,ACUMLEN                                              76790021
         L     XS2,TXTALLOC       OBTAIN AMOUNT OF BUFFER ALLOC         76830021
         BR    GR3                                                      76870021
*                                                                       76910021
*   ID IS TO BE DELETED                                                 76950021
*                                                                       76990021
TXTLM2   TM    APT1,EX                                                  77030021
         BC    8,TXTRET     RETURN FOR OBJECT MODULES                   77070021
         TM    SWITCH,READSW       HAS THE READ BEEN ISSUED             77110021
         BC    8,TXTLM2A       YES  BRANCH                              77150021
         TM    SWITCH,NOLEN      IS A NOLEN OUTSTANDING                 77190021
         BC    14,TXTLM2C          NO -  AVOID NOLEN CLEAN UP           77230021
         OI    SWITCH,X'20'            SET FLAG TO RETURN               77270021
         B     TXTN1          START NOLEN CLEAN UP                      77310021
TXTLM2D  NI    SWITCH,X'DF'          RESET INCICATOR                    77350021
TXTLM2C  L     GR3,BUFDISP         SET TO DO THE READ                   77390021
         A     GR3,TXTBFBEG            NEW                              77430021
         ST    GR3,BUFSTART            BEFSTART                         77470021
         SR    GR3,GR3                                                  77510021
         STH   GR3,CDISP               CLEAR DISP                       77550021
         L     R0,TXTBFBEG       ESTABLISH BEGINNING OF TXTBUF          77590021
         A     R0,BUFDISP        AND OBTAIN THE FIRST FREE AREA         77630021
         AR    R0,COUNT        AND ADD TOTAL LENGTH OF INPUT RECORD     77670021
         C     R0,TXTBFEND       WILL IT OVERFLOW BUFFER                77710021
         BC    12,TXTLM2B         BRANCH IF IT WILL FIT                 77750021
         BAL   RLK,TXTBUF      PURGE THE TXTBUF                         77790021
         SR    RLK,RLK         AND ZERO THE BUFFER DISPLACEMENT         77830021
         ST    RLK,BUFDISP                                              77870021
         L     RLK,TXTBFBEG       MUST RESET BUFSTART TO THR BEG        77910021
         ST    RLK,BUFSTART        OF THE BUFFER TO POSITION READ       77950021
TXTLM2B  BAL   GR3,TXTREAD          NOW DO THE READ BEFORE COMTINUING   77990021
TXTLM2A  L     RLK,IDLENPTR                                             78030021
         LR    XS1,RLK                                                  78070021
         LA    RLK,4(RLK)                                               78110021
         C     RLK,CREND    IF THIS IS THE LAST ID  THERE IS NO NEED    78150021
         BC    10,TXTRET    TO MOVE THE REMAINING BUFFER ENTY UP        78190021
         LH    XS1,2(XS1)   XS1 CONTAINS LENGTH TO BE DELETED           78230021
         LNR   XP1,XS1                                                  78270021
         A     XP1,LMLEN    XP1 CONTAIN AMOUNT OF TXT IN BUFFER TO BE   78310021
         L     GR8,BUFDISP  MOVED                                       78350021
         A     GR8,TXTBFBEG                                             78390021
         LR    RLK,GR8                                                  78430021
         AR    RLK,XS1      FROMAD                                      78470021
         BAL   XP2,LMMOVE                                               78510021
         B     TXTLM4                                                   78550021
* THIS RTN WILL BE USED TO OVERLAY DELETED ID'S IN THE BUFFER AND       78590021
*  MOVE ANY REMAINING TXT IN THE BUFFER TO THE BEGINNING IF A FULL      78630021
*  MULTIPLICITY CAN NOT BE ALLOCATED                                    78670021
*                                                                       78710021
* INCOMING PARAMETERS ARE     GR8  - TO ADDR                            78750021
*                             GR9  - FROMAD                             78790021
*                             XP1  - AMOUNT TO BE MOVED                 78830021
LMMOVE   LA    GR1,256        SET UP TEST COUNT                         78870021
LMMOVE3  CR    GR1,XP1        IF THE INCOMING COUNT IS LESS THAN THAT   78910021
         BC    10,LMMOVE1    WE ONLY HAVE ONE MOVE                      78950021
         MVC   0(256,GR8),0(RLK)    MOVE COUNT                          78990021
         SR    XP1,GR1      AND THE PARAMETERS ADJUSTED ACCORDINGLY     79030021
         AR    GR8,GR1         INCREMENT TO AND FROM ADDRESSES          79070021
         AR    RLK,GR1                                                  79110021
         B     LMMOVE3                                                  79150021
LMMOVE1  BCTR  XP1,0                                                    79190021
         EX    XP1,TLMMVE                                               79230021
LMMOVE2  BR    XP2                                                      79270021
*                                                                       79310021
TLMMVE   MVC   0(1,GR8),0(RLK)                                          79350021
*                                                                       79390021
* ID & MULT AGREE WITH LAST - THIS MULT HAS BE ALLOCATED BUT IF LENGTH  79430021
*     EXCEEDS PRESENT BUFFER BOUNDRIES - ANOTHER MUST BE ALLOC          79470021
*                                                                       79510021
TXTLM3   NI    SWITCH,X'BF'   INSURE DENSE SW IS OFF                    79550021
         SH    GR1,SFOUR     OBTAIN LAST TXTIO ADDR                     79590021
         TM    2(GR1),INCORE    HAS THAT ENTRY BEEN WRITTEN             79630021
         BC    1,TXTLM3A         BRANCH IF STILL IN CORE                79670021
TXTLM3D  OI    SWITCH,DENSE1    MARK ENTRY OUT OF ORDER                 79710021
         B     BUFALLOC       AND ALLOC AND ENTER IN TABLES             79750021
TXTLM3A  L     R0,BUFSTART        CHECK IF RECORD WILL FIT IN BUFFER    79790021
         AH    R0,CDISP          ADD THE BUFFER START AND THE DISP      79830021
         AR    R0,COUNT        AND THE LENGTH OF THE INCOMING RECORD    79870021
         C     R0,TXTBFEND        DIES THE INCOMING RECORD EXCEED       79910021
         BC    12,TXTLM3C        BUFFER LIMITS                          79950021
         BAL   RLK,TXTBUF                                               79990021
         SR    RLK,RLK     PURGE AND RESET BUFFER INCREMENT             80030021
         ST    RLK,BUFDISP        TO ZERO                               80070021
         B     TXTLM3D    SINCE JUST PURGED MUST MARK OUT OF ORDER      80110021
TXTLM3C  BAL   GR3,TXTREAD       READ THJ LOAD MOD INPUT RECORD         80150021
         LH    GR8,CDISP           WILL THIS INPUT EXCEED MUL           80190021
         AR    GR8,COUNT                                                80230021
         C     GR8,MULTSIZE                                             80270021
         BC    12,TXTLM4      BRANCH ON LOW OR EQUAL                    80310021
*  IT IS NECESSARY TO READJUSNT TO THE TRUE AMOUNT THAT                 80350021
*         MUST BE ALLOCATED                                             80390021
         S     GR8,MULTSIZE         CDISP+COUNT-MULTSIZE IS             80430021
         LR    COUNT,GR8      THE TRUE AMOUNT LEFT TO ALLOC             80470021
         LH    GR9,CMULN                                                80510021
         LA    GR9,1(GR9)     BUMP MULT                                 80550021
         STH   GR9,CMULN      AND ALLOCATE SPACE IN BUFFER              80590021
         STH   GR9,PMULN          UPDATE TO CHECK NEXT ENTRY            80630021
         B     BUFALLOC                                                 80670021
*                                                                       80710021
* THE PRESENT ENTRY HAS BEEN FULLY PROCESSED - IF THAT WAS LAST ENTRY   80750021
*  WE WILL RETURN - IF NOT WE WILL READJUST PARAMETERS AND REENTER      80790021
*                                                                       80830021
TXTLM4   TM    APTSW3,XPDIND           EXPAND REQUEST?           Y01031 80870017
         BNO   TXTLM4X                 IF NOT, BRANCH            Y01031 80872017
         BAL   RLK,TXTEND              DO EOF CLEAN-UP           Y01031 80874017
         B     TXTRET                  RETURN                    Y01031 80876017
TXTLM4X  L     GR8,IDLENPTR                                             80880017
         LR    GR9,GR8                                                  80910021
         LA    GR8,4(GR8)     BUMP IDLENPTR AND SEE                     80950021
         C     GR8,CREND      IF PAST END OF CONTROL RECORD             80990021
         BC    10,TXTRET    BRANCH HIGH OR EQY                          81030021
         LH    GR9,2(GR9)     PICK UP NEXT LENGTH                       81070021
         LR    GR1,GR9                                                  81110021
         LNR   GR1,GR1                                                  81150021
         A     GR1,LMLEN                                                81190021
         ST    GR1,LMLEN                                                81230021
         A     GR9,ACUMLEN                                              81270021
         ST    GR9,ACUMLEN                                              81310021
         L     XAA,RLDINPAD   NOW OBTAIN ASSM OF THIS ID                81350021
         L     XAA,8(XAA)                                               81390021
         LA    XAA,0(XAA)                                               81430021
         AR    XAA,GR9                                                  81470021
         ST    GR8,IDLENPTR        KEEP UPDATED IDLENPTR                81510021
         LH    COUNT,2(GR8)        OBTAIN NEW LENGTH                    81550021
         LH    RID,0(GR8)           AND ID                              81590021
         B     TXT0011                                                  81630021
* ONE MULTIPLICITY HAS BE ALLOCATED - TEST IF THERE IS MORE PRESENTLY   81670021
* IN THE BUFFER THAT MUST BE ALLOCATED AND ENTERED IN TABLES            81710021
*                                                                       81750021
TXTLM5   EQU   *                                                OY00356 81760001
         TM    SWITCH+1,SPTXTON         CHECK FOR SPEC TXT      OY00356 81770001
         BNO   TXTLM5A                  BRANCH IF NOT APPLIC    OY00356 81780001
         NI    SWITCH+1,SPTXTOFF        SET FLAG OFF            OY00356 81782001
         AH    COUNT,CDISP              ADJUST FOR TEXT DISPLAC OY00356 81784001
TXTLM5A  EQU   *                                                OY00356 81786001
         SR    COUNT,XS2   SUBTRACT ALLOCATED SIZE FROM LENGTH  OY00356 81790002
         BNP   TXTLM4      BRANCH ON ZERO OR LESS CHECK NEXT ID OY00356 81870001
         LH    GR9,CMULN                                                81910021
         LA    GR9,1(GR9)     IF NOT FINISHED WITH THIS ID - BUMP MULT  81950021
         STH   GR9,CMULN      AND REALLOCATE                            81990021
         STH   GR9,PMULN          UPDATE TO CHECK NEXT ENTRY            82030021
         B     TXT002A                                                  82070021
*AN ENTRY IS TO BE MADE IN THE TXT I/O CONTROL TABLE. UNLESS IT IS FULL 82110021
BUFTMK2  TM    IOCTSTAT,FULLT    IS TXT I/O CNTL TABLE FULL             82150021
         BC    8,BUFTOK                                                 82190021
*TABLE IS FULL. ERROR                                                   82230021
         LA    MSG,IEW0364                                              82270037
         B     ERROR                                                    82310021
BUFTOK   LA    R14,7                                                    82350021
         MH    R14,ENT1X                                                82390021
*R14=NUMBER OF BYTES IN NOTE LIST.                                      82430021
         L     R15,TNT1           R15=START OF MARK LIST                82470021
         BAL   XRET2,COMBUF                                             82510021
         BAL   XRET2,COMCHK                                             82550021
         LA    R15,7                   LOAD NOTELIST ENTRY LEN  XA06144 82560003
         MH    R15,ENT1X               MULT BY ENTRY COUNT      XA06144 82570003
         L     XRET2,TNT1              GET ADDRESS OF NOTELIST  XA06144 82580003
         XR    R14,R14                 CLEAR REG 14 FOR DIVIDE  XA06144 82582003
         D     R14,HEX100              DIVIDE FOR CLEARING      XA06144 82584003
         LTR   R15,R15                 TEST QUOTIENT            XA06144 82586003
         BZ    TXT0161                 IF ZERO, BRANCH          XA06144 82588003
TXT0160  EQU   *                                                XA06144 82588103
         XC    0(256,XRET2),0(XRET2)   CLEAR 256 BYTES          XA06144 82588403
         A     XRET2,HEX100            BUMP BUFFER POINTER      XA06144 82588803
         BCT   R15,TXT0160             IF MORE TO MOVE, LOOP    XA06144 82589203
TXT0161  EQU   *                                                XA06144 82589603
         LTR   R14,R14                 ANY REMAINDER?           XA06144 82589703
         BZ    TXT0162                 NO, WE ARE DONE          XA06144 82589803
         BCTR  R14,0                   DECREMENT FOR EXECUTE    XA06144 82589902
         EX    R14,CLEARIT             CLEAR REMAINDER          XA06144 82603203
TXT0162  EQU   *                                                XA06144 82613203
         LA    XTMK2,IOCT                                               82616703
         LR    XS1,XTMK2                                                82630021
         XR    R0,R0               CLEAR REGISTER                S01904 82670021
         XR    XRET2,XRET2         CLEAR REGISTER                S01904 82710021
         IC    XRET2,ENITC         GET OLD COUNT IN TXTIO TBL    S01904 82750021
         IC    R0,ENITC+1          GET NEW COUNT OF BYTES USED   S01904 82790021
         AR    XRET2,R0            ADD BOTH COUNTS               S01904 82830021
         AR    XTMK2,XRET2         ADD TO CURRENT ENTRY ADDR     S01904 82870021
*STORE THE TTR IN THE CURRENT ENTRY OF THE TXT I/O CONTROL TABLE        82910021
         ST    GR1,0(XTMK2)   STORE TTR OF TXT NOTE LIST                82950021
         LA    XTMK2,4(XTMK2)                                           82990021
         SR    XTMK2,XS1      SUBTRACT TO OBTAIN REL ADDR               83030021
*THE UPDATED BYTE COUNT IS NOW STORED                                   83070021
         TM    APT4,REALOCTE       HAS REALLOC BEEN DONE?        S01904 83110021
         BNO   TXT016              NO-BRANCH OUT                 S01904 83150021
         SR    XTMK2,R0                 GET NEW TBL BYTES       OX00029 83160000
         STC   XTMK2,ENITC         USE FIRST BYTE OF ENITC       S01904 83190021
         B     TXT016A             BRANCH AROUNG REG UPDATE OF ENITC    83230021
TXT016   STH   XTMK2,ENITC        STORE BYTE COUNT                      83270021
TXT016A  LH    R0,ENT1C       KEEP TRACK OF ACTUAL ENTERIES             83310021
         AH    R0,TXTNOTE    WRITTEN                                    83350021
         STH   R0,TXTNOTE                                               83390021
*TEST FOR OVERFLOW                                                      83430021
         LA    XRET2,4(,XRET2)          ADJUST TOTAL LENGTH     OX00029 83480000
         CH    XRET2,X12                IS TXT I/O TBL FULL     OX00029 83490000
         BC    4,TXT017    NO,CONTINUE                                  83510021
         OI    IOCTSTAT,FULLT    INDICATE TXT I/O CNTL TABLE IS FULL    83550021
*                          CAN NOT BE PURGED AGAIN                      83590021
TXT017   SR    R0,R0                                                    83630021
         STH   R0,ENT1C  RESET TXT NOTELIST CURRENT BYTE COUNT TO ZERO  83670021
         ST    R0,TNTFREE                                               83750021
         BCR   15,RLK                                                   83790021
*                                    PROCESSED CSECTS IN BUFFER         83830021
*                                                                       83870021
* THIS ROUTINE WILL CLEAR THE BUFFER AND MARK ENTRIES WRITTEN*          83910021
*                                                                       83950021
TXTBUF   TM    NEWSW,EOF        IS THIS END OF INPUT                    83990021
         BC    1,TXTEND                                                 84030021
         LTR   COUNT,COUNT    ZERO LENGTH IS IGNORED                    84070021
         BCR   8,RLK                                                    84110021
TXTBUF2  TM    SWITCH,DENSE1      FIRST CHECK IF LAST THISG IN BUFFER   84150021
         BC    14,TXTBUF1         IS A PIECE OF OUT OF ORDER TEXT       84190021
         L     XS1,TNTFREE             PICK UP TNT OFFSET               84230002
         A     XS1,TNT1                COMPUTE TNT POINTER      ZA01405 84240002
         SH    XS1,TSEVEN      SET UP PARAMETER FOR TXTNIO              84270021
         BAL   XP2,TXTNIO         WRITE IT AND RET                      84310021
         NI    SWITCH,X'BF'                                             84350021
TXTBUF1  CLC   TXTWR(2),ENTOC     ANYTHING IN TABLE                     84390021
         BCR   8,RLK                                                    84430021
         STM   RID,REG6,HOLD3         MUST MAINTAIN REGS 5 AND 6        84470021
         TM    PDSE7,X'20'        OVERLAY OPTION SPECIFIED              84510021
         BC    1,TXTENT1          WRITE ON E RECORD PER ENTRY           84550021
         CLC   MULTSIZE(4),UT1SIZE                                      84590021
         BC    2,TXTENT1          BRANCH MULT HIGH                      84630021
         TM    SWITCH,NOLEN        IS THERE AN OUTSTANDING NOLEN TO     84670021
         BC    1,TXTENT1     BE POSTED   YES   WE CAN NOT GROUP         84710021
         TM    SWITCH+1,NOGRPPG       DO WE NEED A NON GROUPED PURGE    84750021
         BC    1,TXTENT1      YES  PURGE WITHOUT GROUPING               84790021
*                                                                       84830021
*   AFTER HERE SYSUT1 WILL BE GROUPED AS MUCH AS POSSIBLE               84870021
*                                                                       84910021
*                                                                       84950021
*                                                                       84990021
         LH    REG6,ENTOC    REG6 WILL BE USED TO PROVIDE LIMIT         85030021
         A     REG6,TXTIO                                               85070021
         ST    REG6,TSCNEND    SAVE END ADDR                            85110021
         LH    REG6,TXTWR    BYTES WRITTEN IN TXTIO                     85150021
         LR    GR8,REG6        TO TXTIO ENTRY                           85190021
         SRL   GR8,2                                                    85230021
         SH    GR8,TXTNOTE        SUB NUMBER OF ENTERIES WRITTEN        85270021
TXTB2A   A     REG6,TXTIO    NOW REGS XSTX AND GR8 CONTAIN EFFECTIVE    85310021
         MH    GR8,TSEVEN                                               85350021
         A     GR8,TNT1       ADDR OF ENTRIES TO BE WRITTEN             85390021
TXTB2    TM    2(REG6),INCORE                                           85430021
         BC    1,TXTB1                                                  85470021
         LH    GR1,TXTACUM        HIT OUT OF ORDER                      85510021
         LTR   GR1,GR1           CLEAR PREVIOUS GROUPING IF NEC         85550021
         BC    7,TXTBWR             OR ADVANCE TO ENEXT                 85590021
TXTB2C   LA    REG6,4(REG6)   BUMP PTRS TO NEXT ENTRY                   85630021
         LA    GR8,7(GR8)                                               85670021
         C     REG6,TSCNEND                                             85710021
         BC    10,TXTBEND                                               85750021
         B     TXTB2                                                    85790021
*                                                                       85830021
TXTB1    NI    2(REG6),X'7F'  MARK THIS ENTRY NOT IN CORE               85870021
         LH    GR1,TXTACUM    HAVE WE STARTED A GROUPING                85910021
         LTR   GR1,GR1                                                  85950021
         BC    7,TXTB3        YES - BRANCH                              85990021
         MVC   HOLD+2(2),5(GR8)   PARAMETER FOR WRITE                   86030021
         LH    XS1,HOLD+2      ACQUIRE LENGTH                           86070021
         MVC   HOLD+1(3),2(GR8) AND                                     86110021
         L     XS2,HOLD             BUFFER ADDR                         86150021
TXTB1A   STH   XS1,TXTACUM                                              86190021
         B     TXTB2C                                                   86230021
*                                                                       86270021
*  GROUPING HAS STARTED - FIRST TEST WILL SEE IF ADDITIONAL LENGTH WILL 86310021
*    EXCEED LIMITS REGARDLESS OF ABILITY TO BE GROUPED - IF IT WOULD    86350021
*    FIT - THEN ELIGIBILITY IS TESTED                                   86390021
*                                                                       86430021
TXTB3    MVC   HOLD+2(2),5(GR8)    ADD NEW LENGTH TO ACUM LENGTH        86470021
         AH    GR1,HOLD+2           AND TEST AGAINST UT1SIZE            86510021
         C     GR1,UT1SIZE                                              86550021
         BC    2,TXTBWR            WRITE PREVIOUS ENTRY                 86590021
         LA    R0,4                ADDITIONAL LENGTH WILL FIT - IS LAST 86630021
         SR    REG6,R0              MULT ZERO                           86670021
         MVC   HOLD(4),0(REG6)                                          86710021
         NI    HOLD+2,FLAGOUT                                           86750021
         LA    GR1,1        CONSECUTIVE                                 86790021
         A     GR1,HOLD      BUMP                                       86830021
         AR    REG6,R0      RESTORE PTR TO PRESENT TXTIO ENTRY          86870021
         C     GR1,0(REG6)    WAS LAST ONE GREATER THAN PRESENT         86910021
         BC    8,TXTB3A                                                 86950021
         CLC   2(2,REG6),CONZO1   IF PRESENT MULT=0  CHECK IF LAST      86990021
*                ENTRY IS LAST MULT                                     87030021
         BC    7,TXTBWR                                                 87070021
         SR    REG6,R0                                                  87110021
*  SINCE PRESENT ENTRY IS MULT ZERO  AND AFTER INSURING ID              87150021
*   NOT THE SAME   CHECK IF PREVIOUS ISLAST ONE                         87190021
         CLC   0(2,REG6),4(REG6)       ARET THE ID S THE SAME           87230021
         BC    8,TXTBWR1                                                87270021
         CLC   2(2,REG6),CONZO1    MULT CHANGE                          87310021
         BNE   TXTBWR1                                                  87350021
         LH    GR1,0(REG6)                                              87390021
         AR    REG6,R0          RESTORE TO PRESENT ENTRY                87430021
         SLL   GR1,4              WAS COMPLETE CSECT SO THE PRESENT     87470021
         A     GR1,CHESD          ENTRY CAN BE GROUPED WITH IT          87510021
         L     XP2,12(GR1)                                              87550021
         LA    XP2,0(XP2)     OBTAIN LENGTH FROM CESD                   87590021
         SR    XP1,XP1                                                  87630021
         D     XP1,MULTSIZE                                             87670021
         LTR   XP1,XP1                                                  87710021
         BC    7,TXTB4A                                                 87750021
         BCTR  XP2,0                                                    87790021
TXTB4A   CH    XP2,HOLD+2   HIGHEST MULT EQU LST                        87830021
         B     TXTBWR              NO GROUPING OF CSECTS IN UT1 AOS     87870021
TXTB3A   MVC   HOLD+2(2),5(GR8)   - UPDATE ACUM LENGTH                  87910021
         AH    XS1,HOLD+2                                               87950021
         B     TXTB1A                                                   87990021
*                                                                       88030021
*                                                                       88070021
TXTBEND  LH    GR1,ENTOC                                                88110021
         STH   GR1,TXTWR        UPDATE NUMBER OF BYTES WRITTEN          88150021
         LH    GR1,TXTACUM      BEFORE LEAVEING MUST WRITE ANY          88190021
         LTR   GR1,GR1             PARTIAL GROUPING                     88230021
         BC    8,TXTENTRT                                               88270021
         OI    SWITCH,X'01'       END SW                                88310021
         B     TXTBWR                                                   88350021
TXTBWR1  AR    REG6,R0      RESTORE PTR TO PRESENT TXTIO                88390021
TXTBWR   BAL   XRET2,COMBUF                                             88430021
         BAL   XRET2,COMCHK                                             88470021
         ST    GR1,HOLD          SAVE TTR IN LAST                       88510021
         LA    GR1,7               PROCESSED ENTRY                      88550021
         SR    GR8,GR1                                                  88590021
         MVC   2(3,GR8),HOLD      STORE TTR                             88630021
         AR    GR8,GR1                                                  88670021
         LA    R0,4      RESET R0                                       88710021
         SR    REG6,R0              AND                                 88750021
         OI    2(REG6),X'40'       TTR FLAG IN TXTIO                    88790021
         AR    REG6,R0                                                  88830021
         SR    GR1,GR1                                                  88870021
         STH   GR1,TXTACUM         NO LONGER GROUPING - THIS GROUP      88910021
         TM    SWITCH,X'01'            LAST WRITE SWITCH ON?            88950021
         BC    14,TXTENT2              NO, GO TEST DENSE SWITCH         88990021
         NI    SWITCH,X'FE'            YES, TURN THE SWITCH OFF         89030021
         B     TXTENTRT                RETURN                           89070021
TXTENT2  TM    2(REG6),DENSE           IS NEXT RECORD DENSE             89110021
         BC    1,TXTB2C                YES, SKIP IT                     89150021
         B     TXTB1                   NO, PROCESS IT                   89190021
TXTENT1  CLC   TXTWR(2),ENTOC     ONE RECORD PER ENTRY  LENGHT WILL     89230021
         BC    7,TXTENT11       BE UT1 OR ACTUAL WHICHEER               89270021
TXTENTRT LM    RID,REG6,HOLD3         MUST MAINTAIN REGS 5 AND 6        89310021
         BCR   15,RLK                                                   89350021
TXTENT11 LH    GR13,TXTWR                                               89390021
         LA    R0,4                                                     89430021
         AR    R0,GR13                                                  89470021
         STH   R0,TXTWR           BUMP TXTWR                            89510021
         A     GR13,TXTIO                                               89550021
         TM    2(GR13),INCORE    WAS THE FIRST ENTRY ALREADY WR         89590021
         BC    14,TXTENT1                                               89630021
         NI    2(GR13),X'7F'      TURN OFF OLD INDICATOR                89670021
         OI    2(GR13),X'40'       MARK TTR                             89710021
         S     GR13,TXTIO                                               89750021
         SRL   GR13,2                                                   89790021
         LA    R0,7      SIZE OF ONE NOTE LIST ENTRY                    89830021
         STH   R0,HOLD+2                                                89870021
         SH    GR13,TXTNOTE                                             89910021
         MH    GR13,HOLD+2                                              89950021
         A     GR13,TNT1                                                89990021
         MVC   DISPLAC(2),0(GR13)                                       90030021
         MVC   HOLD+1(3),2(GR13)                                        90070021
         L     XS2,HOLD           ADDR CORRECT AND ADD ANY DISP         90110021
         AH    XS2,DISPLAC         TO IT   USUALLY ZERO                 90150021
         MVC   HOLD+2(2),5(GR13)   OBTAIN ENTRY LENGTH                  90190021
         CLC   HOLD+2(2),UT1SIZE+2   INSURE SPECIFY LINGTH LESS  UT1    90230021
         BC    4,TXTENT2A      IF LENGTH SPECIFIES LESS THAN UT1        90270021
         L     XS1,UT1SIZE        USE ACTUAL LENGTH                     90310021
         B     TXTENT3                                                  90350021
TXTENT2A LH    XS1,HOLD+2                                               90390021
TXTENT3  LR    REG6,GR13                                                90430021
         BAL   XRET2,COMBUF                                             90470021
         BAL   XRET2,COMCHK                                             90510021
         ST    GR1,HOLD     SAVE TTR                                    90550021
         MVC   2(3,REG6),HOLD      SAVE TTR                             90590021
         B     TXTENT1                                                  90630021
***********************************************************             90670021
*                                                                       90710021
*                     WHERE THE ACTUAL LENGTH IS POSTED FOR             90750021
*                    NOLENGTH CSECTS                                    90790021
*                                                                       90830021
***********************************************************             90870021
TXTNL3   LR    XS1,XS2                                                  90910021
         TM    2(XS2),INCORE    IS THE PRESENT ENTRY TO BE POSTED       90950021
         BC    8,TXTNLB       IN CORE NOW -  YES POST GOOD LEN          90990021
         S     XS1,TXTIO      OBTAIN NUMBER OF ENTRIES IN TXTIO         91030021
         SRL   XS1,2          IF THAT NUMBER EXCEEDS MAX ALLOWABLE AT   91070021
         LA    XS1,1(XS1)   ADD ONE TO GET TRUE ENTRY NUMBER            91110021
         LH    RLK,TXTNOTE                                              91150021
TXTNL4   CH    XS1,TXTNOTE    COMPARE THE ENTRY NUMBER TO THE           91190021
*   NUMBER OF ENTRIES WRITTEN.   IF LESS OR EQU WILL HAVE UNTRUE        91230021
*   LENGTH POSTED                                                       91270021
         BC    4,TXTNLB        MUST POST UNTRUE LENGTH INDIC            91310021
         BC    7,TXTNLC    BRANCH NOT EQU   EQU  CHECK FOR ZERO         91350021
         LTR   RLK,RLK     FALL THRU IF NORELIST NEVER WR               91390021
         BC    7,TXTNLB      COMPUTE TRUE NOTELIST                      91430021
TXTNLC   MH    RLK,TSEVEN       DISPLACEMENT                            91470021
         SR    GR8,RLK       TRUE DISPLACEMENT                          91510021
TXTNL6   STH   XP1,HOLD+2      POSTED -                                 91550021
         A     GR8,TNT1          OBTAIN NOTE LIST ADDR AND POST         91590021
         MVC   5(2,GR8),HOLD+2     PROPER LENGTH                        91630021
TXTNL6A  CLC   MULTSIZE(4),UT1SIZE WAS MORE THAN ONE ENTRY MADE         91670021
         BC    2,TXTNL5            YES - BRANCH                         91710021
TXTNL6B  LA    GR8,7(GR8)     WAS THE HIGHEST MULT THE LAST ENTRY       91750002
         L     RLK,TNT1                PICK UP TNT ADDRESS      ZA01405 91790002
         A     RLK,TNTFREE             COMPUTE TNT POINTER      ZA01405 91800002
         CR    GR8,RLK                 IF SO, IT'S LAST IN      ZA01405 91810002
         BC    8,TXTNL7         BUFFER AND THE BUFFER DISP CAN BE ADJ   91830021
         BAL   RLK,TXTBUF1     IF NOT  WE MUST FORCE TWO PASS TO CLEAR  91870021
         SR    RLK,RLK         RESET THE BUFFER DISPLACEMENT TO         91910021
         ST    RLK,BUFDISP       ZERO                                   91950021
TXTNL6C  NI    SWITCH,X'F7'    ANY GAPES IN THE BUFFER                  91990021
         TM    SWITCH,X'20'       SHOULD RETURN TO LM DELETE            92030021
         BC    1,TXTLM2D          YES                                   92070021
         TM    SWITCH,NOLEN1    NO LENGTH CLEAN UP                      92110021
         BC    1,TXTENDNL                                               92150021
         MVC   CURID(4),HOLD1      RESTORE PARA FOR PRESENT ID          92190021
         B     TXT002B                                                  92230021
*THE NOTELIST HAS BEEN WRITE OUT AT LEAST ONCE - BE CERTAIN APPLICABLE  92270021
* ENTRY STILL IN CORE                                                   92310021
TXTNLB   OI    2(XS2),X'08'    IF NOT  SET BIT FOR UNTRUE LENGTH        92350021
         B     TXTNL6C            AND RETURN                            92390021
TXTNL7   L     GR8,BUFDISP    PRESENT DISPLACEMENT MINUS ALLOC          92430021
         S     GR8,MULTSIZE     SIZE   PLUS THE READ LENGTH  IS THE     92470021
         AH    GR8,HOLD+2                                               92510021
         ST    GR8,BUFDISP     NEW PROPER BUFFER DISP                   92550021
         B     TXTNL6C                                                  92590021
TXTNL5   LA    XS2,4(XS2)      INCREMENT TXTIO ADDR                     92630021
         LA    GR8,7(GR8)     LESS THAN MULT- POSSIBLE THAT EXTRA       92670021
         S     XP1,UT1SIZE    ENTRIES HAVE BEEN MADE                    92710021
         C     XP1,UT1SIZE                                              92750021
         BC    2,TXTNL5                                                 92790021
         LTR   XP1,XP1            BRANCH IF LESS THAN ZERO              92830021
         BC    12,TXTNL9    VAL 0 OR NEG PRESENT ENTRY NOT REQ          92870021
         STH   XP1,HOLD                                                 92910021
         MVC   5(2,GR8),HOLD   NOVE IN PROPER LENGTH TO LAST PIECE      92950021
TXTNL5A  CLC   0(4,XS2),4(XS2)    IS THE NEXT ONE THE AAME              92990021
         BC    7,TXTNL6B     PREPARE TO RETURN                          93030021
         LA    XS2,4(XS2)      INCREMENT TXTIO ADDR                     93070021
         LA    GR8,7(GR8)         INCREMENT NOTELIST ADDR               93110021
TXTNL9   CLC   0(4,XS2),4(XS2)    IS THE NEXT ONE THE SAME              93150021
         BC    8,TXTNL8        YES  BRANCH                              93190021
         MVC   0(2,XS2),CONZO1     ZERO THE EXTRA ID                    93230021
         B     TXTNL6B                                                  93270021
TXTNL8   MVC   0(2,XS2),CONZO1                                          93310021
         LA    XS2,4(XS2)      INCREMENT TXTIO ADDR                     93350021
         LA    GR8,7(GR8)         INCREMENT NOTELIST ADDR               93390021
         B     TXTNL9    CONTINUE    TO CHECK OOR END                   93430021
*                                                                       93470021
         DS    0F                                                       93510021
DBLWRD   DC    X'FFFFFFF8'          MASK TO ZERO LST THREE BITS         93550021
MULTONLY DC    X'000003FF'           MASK TO ZERO ALL BUT MULT          93590021
IOCTSTAT DC    X'00'       I/O CONTROL TABLE OVFLO IND                  93630021
*         ENTRIES WRITTEN                                               93670021
TXTWR    DC    H'0'     CONTAINS DISPLACEMENT IN TXTIO TABLE OF         93710021
BUFSTART DC    F'0'                                                     93790021
BUFDISP  DC    F'0'                                                     93830021
HOLD     DC    2F'0'          MISC  FOR ENTER INFO INTO TABLES          93870021
TXTFREE  DC    F'0'           FIRST FREE ADDR IN TXTIO                  93910021
TNTFREE  DC    F'0'           FIRST FREE ADDR IN NOTELIST               93950021
TXTNOTE  DC    H'0'     HOLDS THE ACTUAL NUMBER OF ENTRIES OF THE       93990021
*  TXT NOTELIST THAT HAVE BEEN WRITTEN.   IT WILL NOT GE THE MAX IN     94030021
*  SITUATIONS REQUIRE MULTIPLE ENTRIES                                  94070021
CURID    DC    2X'0'          MAINTAINS CURRENT ID AND MULTIPLICITY     94110021
CMULN    DC    2X'0'                                                    94150021
PID      DC    2X'0'          MAINTAINS  PAST ID & MULT                 94190021
PMULN    DC    2X'0'                                                    94230021
MAXMULT  DC    H'512'                                                   94270021
TSEVEN   DC    H'7'       CCONSTANT USED TO DECREMENT NOTELIST ADDR     94310021
SWITCH   DC    XL2'00'                                                  94350021
*   BIT 0      NO LENGTH INDICATOR                                      94390001
*   BIT 1      DENSE INDICATOR  (NOT RELATED TO TXTIO FLAG)             94430001
*   BIT 2      LOAD MODULE INDICATOR FOR DUMMY READ                     94440001
*   BIT 3      NOLENGTH AND HAVE RECEIVED NEW ID   POST TRUE LEN        94510001
*   BIT 4      NOLEN CLEAN UP ON END OF ENPUT                           94550001
*   BIT 1      DENSE INDICATOR  (NOT RELATED TO TXTIO FLAG)             94558037
*   BIT 2      LOAD MODULE INDICATOR FOR DUMMY READ                     94566037
*   BIT 3      NOLENGTH AND HAVE RECEIVED NEW ID   POST TRUE LEN        94574037
*   BIT 4      NOLEN CLEAN UP ON END OF ENPUT                           94582037
*   BIT 5      LOAD MODULE READ TO BE ISSUED                            94590001
*   BIT 6      RESERVED                                                 94600001
*   BIT 7      LAST WRITE SIGNAL WHEN GROUPING ON UT1                   94630001
*   BIT 8      FLAG FOR SPECIAL LOAD MODULE TEXT SITUATION      OY00356 94640001
*   BIT 9-10   RESERVED                                                 94660001
*   BIT 11     FLAG FOR NONGROUPED PURGE REQUIRED                       94662001
*   BIT 12-15  RESERVED                                                 94664001
HOLD1    DS    2F                                                       94670021
DISPLAC  DC    F'0'                                                     94710021
TXTALLOC EQU   *       USED FOR LM TO MAINTAIN ALLOC SIZE               94750021
LASTTNT  DC    F'0'               MAINTAIN LAST NOTELIST ADDR           94790021
FROMAD   DC    F'0'      START & END FOR DENSE RECORDS                  94830021
TOADDR   DC    F'0'                                                     94870021
CDISP    DC    H'0'                DISPLACEMENT IN MULTIPLICITY         94910021
RDMACRO  DC    V(HEWLERDM)                                              94950021
INPADD   DC    V(HEWLCINP)                                              94990021
ACUMLEN  DC    F'0'      WILL ACCUMULATE LENGTH OF LM RECORD TO ENABLE  95030021
LMLEN    DS    F      WILL HOLD TOTAL LENGTH OF LM INPUT RECORD         95070021
*                    RECOMPUTATION OF ASSM ADDR                         95110021
RETURNAD EQU   *               SAVES RETURN WHEN PROCESS FINISHED       95150021
IDLENPTR DS    1F                  PTR TO ID-LENGTH ENTRY               95190021
CREND    DS    1F                  PTR TO END OF ID-LENGTH LIST         95230021
CONZO1   DC    F'0'      CONSTANT OF ZERO                               95270021
TXTACUM  DC    H'0'                                                     95310021
X12      DC    H'12'                    LNGTH LIMIT FOR TXT I/O OX00029 95320000
TSCNEND  DS    F      END OF SCN                                        95350021
HOLD3    DS    3F                                                       95390021
*********************************************************************** 95470037
*        PATCH AREA                                                   * 96170037
*********************************************************************** 96870037
PATCH2   DC    50F'0',C'PATCH AREA ' FOR PROG MAINT                     97570037
         HEWAPT                                                         98370037
         END                                                            99170037
