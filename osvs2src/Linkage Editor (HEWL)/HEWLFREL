 TITLE 'HEWLFREL - SECOND PASS RELOCATION'                              00020021
*********************************************************************** 00080021
*STATUS: CHANGE LEVEL 0                                               * 00100021
*FUNCTION/OPERATION:                                                  * 00120021
*        1) RELOCATION                                                * 00140021
*        2) CREATION OF ENTAB AND ITS RLDS                            * 00160021
*        3) SECOND PASS INITIALIZATION                                * 00180021
*ENTRY POINTS:                                                        * 00200021
*        HEWLFREL- FOR SECOND PASS INITIALIZATION                     * 00220021
*        RELOCATE- FOR RELOCATION                                     * 00240021
*        SCDENTAB- FOR CREATION OF ENTAB AND ITS RLDS                 * 00260021
*                                                                     * 00280021
*INPUT: - SAME TABLES AS HEWLFSCD                                     * 00300021
*                                                                     * 00320021
*OUTPUT: ENTAB TEXT AND ENTAB RLD RECORDS. THE SIZE OF THE ENTAB IS   * 00340021
*              LIMITED ONLY  BY THE MAXIMUM RECORD SIZE ON SYSLMOD    * 00360021
*                                                                     * 00380021
*EXTERNAL ROUTINES:                                                   * 00400021
*        GETIDMUL- TO GET NEXT TEXT TO PROCESS                        * 00420021
*        WRTTXT- TO WRITE A TEXT RECORD                               * 00440021
*        WRTCRRLD- TO WRITE A CR/RLD RECORD                           * 00460021
*        CHECKRD - TO CHECK A READ                                    * 00480021
*        CHECKWRT- TO CHECK A WRITE                                   * 00500021
*EXITS: NORMAL-RETURN VIA REGISTER 14 TO CALLER                       * 00520021
*       ERROR ---  ENTRY LIST EXCEEDED      L  15,ERDIG               * 00540021
*                                           L  0,ERCODE44             * 00560021
*                                           BR 15                     * 00580021
*TABLES/WORK AREAS: - REFER TO LINKAGE EDITOR PLM FOR DETAILED        * 00600021
*        DESCRIPTIONS                                                 * 00620021
*        1) ALL PURPOSE TABLE                                         * 00640021
*        2) HESD                                                      * 00660021
*        3) DELINK TABLE                                              * 00680021
*        4) RELOCATION CONSTANT TABLE                                 * 00700021
*        5) RLD NOTELIST                                              * 00720021
*        6) TEXT CONTROL BLOCKS(SEE LABELS TXTCB1 AND TXTCB2)         * 00740021
*        7) RLD CONTROL BLOCKS(SEE LABELS INRLDCB1,INRLDCB2,OTRLDCB1, * 00760021
*              OTRLDCB2, AND OTRLDCB3)                                * 00780021
*        8) SEGTAB1                                                   * 00800021
*                                                                     * 00820021
*ATTRIBUTES:  REUSABLE                                                * 00840021
*NOTES:  NONE                                                         * 00860021
*                                                                     * 00880021
*********************************************************************** 00900021
*                                                                     * 00920021
*   THE PROLOGUE FOR THIS ROUTINE IS INCORPORATED IN THE PROLOGUE     * 00940021
*                   FOR HEWLFSCD                                      * 00960021
*                                                                     * 00980021
HEWLFREL CSECT                                                          01000021
*420400-422000,424400,426800-427600,430000,430800                S01904 01010021
*I478000-478784                                         OX05443,OY04003 01012003
*D624400-626000,A628400,D634000-642000,I657800-679999   OX05440,OY04132 01014003
*I682800                                                        XM09129 01016003
*SEE FIX FOR XM09129                                            XA07157 01018003
*A255600-257000  ADCONS OVER 8 MEG HAVE FF IN HIGH ORDER       @ZA08247 01019037
*                                                                       01020021
*********************************************************************** 01080021
*                       FLAG INDICATORS                               * 01160021
*********************************************************************** 01240021
ABSOLUTE EQU   X'1F'                   TO MARK RLD ABSOLUTE             01320021
*                                                                     * 01400021
*                   NEWSW2 INDICATORS IN APT                          * 01480021
MORERLDS EQU   X'80'                    MORE RLDS STILL TO BE READ      01560021
SPLTMOVD EQU   X'40'                    SPLIT RLD MOVED TO OUTPUT BFR.  01640021
MOVDOFF  EQU   X'BF'                                                    01720021
RPSAVED  EQU   X'20'                    R+P SAVED FROM PREV. RECORD.    01800021
RPSAVOFF EQU   X'DF'                                                    01880021
ABS      EQU   X'10'                   ABSOLUTE RELOCATION NEEDED       01960021
REL      EQU   X'EF'                   RELATIVE RELOCATION NEEDED       02040021
SPLITRLD EQU   X'08'                    SPLIT RLD SAVED IN HESD         02120021
GROUPRLD EQU   X'02'                   USE SAME BUFFER--GROUP RLDS      02200021
GROUPOFF EQU   X'FD'                   RLDS ARE NOT TO BE GROUPED       02280021
RPINBFR  EQU   X'01'                    R+P ALREADY MOVE TO BUFFER      02360021
NOTINBFR EQU   X'FE'                                                    02440021
*                                                                     * 02520021
*                  CONTROL RECORD INDICATORS                          * 02600021
*                                                                     * 02680021
TXT      EQU   X'01'                    TEXT FOLLOWS                    02760021
RLD      EQU   X'02'                    RLDS PRESENT                    02840021
RLDOFF   EQU   X'FD'                                                    02920021
SEGEND   EQU   X'04'                    LAST TEXT FOR SEGMENT           03000021
MODEND   EQU   X'08'                    LAST TEXT FOR MODULE            03080021
*   TEXT CONTROL BLOCK INDICATORS                                     * 03160021
*                              BYTE 1                                 * 03240021
INUSE    EQU   X'80'                    CONTROL BLOCK IN USE            03320021
BEINGWT  EQU   X'40'                    TEXT BEING WRITTEN              03400021
WRTCKD   EQU   X'3F'                                                    03480021
BEINGRD  EQU   X'20'                    TEXT BEING READ                 03560021
RDCKD    EQU   X'DF'                    READ IS CHECKED                 03640021
FIRSTXT  EQU   X'08'                    FIRST TEXT OF GROUP             03720021
LASTXT   EQU   X'04'                    LAST TEXT OF GROUP              03800021
TESTWRT  EQU   X'C0'                    TEST IF TEXT WRITTEN YET        03880021
*                              BYTE2                                  * 03960021
XDAP     EQU   X'80'                    XDAP WRITE NEEDED               04040021
DUMMY    EQU   X'40'                    DUMMY WRITE NEEDED              04120021
PREV     EQU   X'07'                    TEST FOR PREVIOUS CONTROL REC.  04200021
*                              BYTE3                                    04280021
RLDSIN1  EQU   X'C0'                    TEST FOR UNPROCESSED RLDS-BFR1  04360021
RLDSIN2  EQU   X'30'                    TEST FOR UNPROCESSED RLDS-BFR2  04440021
BUF1PROC EQU   X'40'                    RLDS IN BUFFER 1 PROCESSED      04520021
BUF1OFF  EQU   X'3F'                                                    04600021
BUF2PROC EQU   X'10'                    RLDS IN BUFFER 2 PROCESSED      04680021
BUF2OFF  EQU   X'CF'                                                    04760021
*    RLD INPUT CONTROL BLOCK INDICATORS                               * 04840021
*INUSE    EQU  X'80'                    CONTROL BLOCK IN USE            04920021
*NOTINUSE EQU  X'7F'                                                    05000021
*   RLD  NOTELIST INDICATORS                                            05080021
PROCESSD EQU   X'20'                   RLDS ALL PROCESSED IN SET        05160021
BUF2     EQU   X'10'                   RLDS IN BFR. 2                   05240021
SPLT     EQU   X'08'                    RLD SET HAS A SPLIT RLD         05320021
SPLTOFF  EQU   X'F7'                                                    05400021
JUSTPROC EQU   X'04'                    RLD SET CONTAINS RELOCATED RLDS 05480021
*                                            TO MOVE                    05560021
JUSTOFF  EQU   X'FB'                                                    05640021
*       RLD OUTPUT CONTROL BLOCK INDICATORS                           * 05720021
*INUSE   EQU   X'80'                    CONTROL BLOCK IN USE            05800021
NOTINUSE EQU   X'7F'                                                    05880021
*BEINGWT EQU   X'40'                    CONTROL BLOCK BEING WRITTEN     05960021
*WRTCKD  EQU   X'3F'                    TURN OFF BEING WRITTEN+IN USE   06040021
*      RLD ITEM INDICATORS                                              06120021
UNRESER  EQU   X'80'                    UNRESOLVED EXTERNAL REFERENCE   06200021
*                                            INDICATOR IN RLD           06280021
PROC     EQU   X'40'                    RLD HAS BEEN PROCESSED          06360021
PROCOFF  EQU   X'BF'                    PROCESSED BIT OFF               06440021
CONT     EQU   X'01'                    NEXT FA FIELD IS CHAINED        06520021
CONTOFF  EQU   X'FE'                                                    06600021
RELREL   EQU   X'7F'                   TURN OFF RELATIVE INDICATOR      06680021
*                                                                     * 06760021
*                   APT3 INDICATORS                                   * 06840021
*                                                                     * 06920021
SEGSTART EQU   X'04'                   TEXT IS FIRST IN SEGMENT         07000021
*                                                                     * 07080021
*                  REGISTER  USAGE                                    * 07160021
*                                                                     * 07240021
SAVEAREA EQU   13                      SAVE AREA REGISTER               07320021
RETURN   EQU   14                       RETURN REGISTER                 07400021
BRANCH   EQU   15                      BASE REGISTER IN HEWLFREL        07480021
WORK0    EQU   0                        GENERAL WORK REGISTER           07560021
WORK1    EQU   1                        PARM REG.AND GENERAL WORK REG.  07640021
APT      EQU   2                        BASE REG FOR APT                07720021
CURTXTCB EQU   3                       ADDRESS OF CURRENT TEXT CTRL BLK 07800021
WORK4    EQU   4                        GENERAL WORK REGISTER           07880021
HESDADDR EQU   5                        HESD ENTRY ADDR.-USED IN RELOC. 07960021
OUTRLDCB EQU   5                        ADDR.OF.CTRL.BLK.FOR OUTPUT     08040021
*                                            BFR.-USED IN MVRLD         08120021
WORK2    EQU   6                        WORK REG -USED IN DIVIDE INSTR  08200021
WORK3    EQU   7                        WORK REG -USED IN DIVIDE INSTR  08280021
INRLDCB  EQU   8                        ADDR.OF CTRL.BLK.FOR INPUT BFR. 08360021
*                                            CONTAINING NEEDED RLD'S    08440021
PREVCREC EQU   8                        PREV CTRL REC - USED ONLY IN    08520021
*                                            SCDENTAB                   08600021
NOTLSENT EQU   9                        CURR.RLD NOTELIST ENTRY         08680021
RLDSETAD EQU   10                       RLD SET BUFFER ADDR             08760021
BRANCHX  EQU   11                      SECOND LEVEL BR. REG--MVRLD      08840021
WORK5    EQU   11                      GENERAL WORK REGISTER--MREL      08920021
BASE     EQU   12                       BASE REG.FOR HEWLFSCD           09000021
*                             ERROR CODES                             * 09080021
HEX1     EQU   X'1'                     BITMAP INDIC-INVAL.2 BYTE ADCON 09160021
HEX2     EQU   X'2'                     BITMAP INDIC-INVAL.VCON IN OVLY 09240021
ERCODE44 EQU   X'42C'                   ENTRY LIST OVERFLOWED           09320021
         ENTRY RELOCATE                                                 09400021
         ENTRY  SCDENTAB                                                09480021
         ENTRY OTRLDCB1                 RLD OUTPUT CONTROL BLOCK 1      09560021
         ENTRY OTRLDCB2                 RLD OUTPUT CONTROL BLOCK 2      09640021
         ENTRY OTRLDCB3                 RLD OUTPUT CONTROL BLOCK 3      09720021
         ENTRY INRLDCB1                 RLD INPUT CONTROL BLOCK  1      09800021
         ENTRY INRLDCB2                 RLD INPUT CONTROL BLOCK  2      09880021
         USING *,BRANCH                                                 09960021
         B     MODID+6                                                  10040021
MODID    DC    C'19MREL'                                                10120021
         USING APTDSECT,APT             BASE FOR APT                    10200021
         LA    SAVEAREA,REGSA           APT SAVE AREA FOR IOCS          10280021
         ST    WORK1,CURENTAB           HESD ADDR. OF NEXT ENTAB ENTRY  10360021
         MVC   LKAENTAB+1(4),1(WORK1)     HESD--SET-UP BY HEWLFOUT      10440021
         MVC   CURENTRY(4),SELST       INIT CURR ENTRY ADDR TO BEG      10520021
         MVI   NEWSW2,X'00'            INIT. APT SWITCH AREA            10600021
         NI    APT3,X'F1'              INIT APT SWITCH AREA             10680021
**********************************************************************  10760021
*                                                                     * 10840021
*        INITIALIZATION OF TXT AND RLD CONTROL BLOCKS                 * 10920021
*                                                                     * 11000021
INIT     SR    WORK1,WORK1                                              11080021
         ST    WORK1,TXTCB1                                             11160021
         ST    WORK1,TXTCB2                                             11240021
         STH   WORK1,OTRLDCB1+2                                         11320021
         STH   WORK1,OTRLDCB2+2                                         11400021
         STH   WORK1,OTRLDCB3+2                                         11480021
         MVI   OTRLDCB1,X'00'          CLEAR FLAG FIELD OF OUTPUT BFR   11560021
         MVI   OTRLDCB2,X'00'               CONTROL BLOCKS              11640021
         MVI   OTRLDCB3,X'00'                                           11720021
         MVC   INRLDCB1(4),OF           SET RLD ADDR TO F'S             11800021
         MVC   INRLDCB2(4),OF                                           11880021
         MVC   INRLDCB1+4(4),RLDINBF1   BEG. OF RLD INPUT BUFFER 1      11960021
         MVC   INRLDCB2+4(4),RLDINBF2   BEG. OF RLD INPUT BUFFER 2      12040021
         L     WORK1,RLDOUTBF           BEG. AND END OF RLD OUTPUT BFRS 12120021
         ST    WORK1,OTRLDCB1+8                                         12200021
         LA    WORK1,236(WORK1)        (END-4 SO CAN ALWAYS ADD         12280021
         ST    WORK1,OTRLDCB1+12       ONE ID-LENGTH LIST ENTRY         12360021
         LA    WORK1,20(WORK1)                                          12440021
         ST    WORK1,OTRLDCB2+8                                         12520021
         LA    WORK1,236(WORK1)                                         12600021
         ST    WORK1,OTRLDCB2+12                                        12680021
         LA    WORK1,20(WORK1)                                          12760021
         ST    WORK1,OTRLDCB3+8                                         12840021
         LA    WORK1,236(WORK1)                                         12920021
         ST    WORK1,OTRLDCB3+12                                        13000021
*                                                                     * 13080021
*              INITIALIZATION OF CONSTANT AREAS                       * 13160021
*                                                                     * 13240021
         MVC   SRCHBEG(4),TXTIO         BEGINNING ADDR.OF TEXT I/O TBL. 13320021
         OI    APT3,FIRSTXT             SET 1ST TEXT OF MODULE ON       13400021
         LA    CURTXTCB,TXTCB1                                          13480021
         LA    WORK4,TXTCB2                                             13560021
         OI    INRLDCB2,BUF2                                            13640021
         LA    PREVCREC,OTRLDCB1        ADDR. OF CTRL. BLK. FOR PREV.CR 13720021
         OI    1(CURTXTCB),X'24'       PREV. CR. IS IN BFR. 1           13800021
         MVC   4(4,PREVCREC),8(PREVCREC) FIRST FREE ADDR.= BFR.BEG.     13880021
         OI    0(PREVCREC),INUSE                                        13960021
         L     WORK2,8(PREVCREC)                                        14040021
         XC    0(16,WORK2),0(WORK2)     ZERO THE CONTROL RECORD         14120021
         XC    CCWDISP(4),CCWDISP                                       14200021
         XC    GROUPLNG(2),GROUPLNG                                     14280021
         BR    RETURN                                                   14360021
RELOCATE STM   WORK0,BRANCH,SAVE       SAVE REGISTERS                   14440021
*                                                                     * 14520021
*                    COMPUTE  BUFFER  RELOCAND                        * 14600021
*                                                                     * 14680021
         L     WORK5,8(CURTXTCB)                                        14760021
         SH    WORK5,24(CURTXTCB)       BEGINNING OF TXT FOR CURR ID    14840021
         ST    WORK5,TXTBEG                                             14920021
         LH    WORK2,CURMULT                                            15000021
         MH    WORK2,MULTSIZE+2        MULT . MULT SIZE                 15080021
         LH    HESDADDR,CURID                                           15160021
         SLL   HESDADDR,3                                               15240021
         A     HESDADDR,HESD           CALCULATE CURRENT HESD ENTRY     15320021
         LH    WORK3,CURID                                              15400021
         SLL   WORK3,2                                                  15480021
         A     WORK3,RECNT             ADDR OF REL CNST TABLE ENTRY     15560021
         L     WORK3,0(WORK3)          GET REL RELOC CONSTANT           15640021
         AR    WORK5,WORK3                                              15720021
         L     WORK4,0(HESDADDR)       TYPE AND LKA                     15800021
         LA    WORK4,0(WORK4)                                           15880021
         SR    WORK5,WORK4                                              15960021
         SR    WORK5,WORK2              BFREL=BEG.OF TXT+REL RELO CNST  16040021
         ST    WORK5,BFREL                    -LKA-(MULT NO* MULT SIZE) 16120021
         SR    WORK3,WORK4                                              16200021
         ST    WORK3,INPUTADR          SAVE INPUT ADDR FOR MULT UPDATE  16280021
*                                                                     * 16360021
*        DETERMINE IN WHICH BUFFER RLD'S ARE LOCATED                  * 16440021
*                                                                     * 16520021
TSTBUF1  TM    2(CURTXTCB),RLDSIN1      ARE THERE UNPROC. RLD'S IN BFR1 16600021
         BC    11,TSTBUF2               NO                              16680021
         LA    INRLDCB,INRLDCB1         YES,GET ADDR.OF BFR.CTRL.BLOCK  16760021
         B     RLDADDR                                                  16840021
TSTBUF2  TM    2(CURTXTCB),RLDSIN2      ARE THERE UNPROC. RLD'S IN BFR2 16920021
         BC    11,MVRLD                 NO,GO TO MOVE RLDS              17000021
         LA    INRLDCB,INRLDCB2         GET ADDR.OF BFR.CTRL BLOCK      17080021
*                                                                     * 17160021
*              CALCULATE STORAGE ADDRESS OF RLD SET                   * 17240021
*                                                                     * 17320021
RLDADDR  L     NOTLSENT,12(INRLDCB)     GET RLD NOTELIST ENTRY ADDR     17400021
         CL    NOTLSENT,8(INRLDCB)     IS THIS 1ST ENTRY                17480021
         BNE   RLDADDR1                NO                               17560021
         L     RLDSETAD,4(INRLDCB)     USE BEG OF BUFFER                17640021
         B     RELOC                                                    17720021
RLDADDR1 LR    RLDSETAD,NOTLSENT                                        17800021
         SH    RLDSETAD,FOUR                                            17880021
         MVC   TEMPAREA(4),0(RLDSETAD) GET BOUNDARY ALIGN               17960021
         L     RLDSETAD,TEMPAREA                                        18040021
         LA    RLDSETAD,0(RLDSETAD)                                     18120021
         SLL   RLDSETAD,2                                               18200021
         A     RLDSETAD,4(INRLDCB)      STORAGE ADDR.OF RLD SET         18280021
*                                                                     * 18360021
*                   DETERMINE BYTES OF RLD INFORMATION IN SET         * 18440021
*                                                                     * 18520021
RELOC    MVC   TEMPAREA(2),4(NOTLSENT)                                  18600021
         LA    WORK1,4                                                  18680021
         MH    WORK1,TEMPAREA                                           18760021
         STH   WORK1,RLDBYTES           BYTES OF RLD INFORMATION        18840021
RELOC00  MVC   RSAVE(2),0(RLDSETAD)     SAVE  R PTR                     18920021
         NI    RSAVE,X'7F'              CLEAR DELINK BIT                19000021
         ST    RLDSETAD,PREVRPAD        SAVE ADDR OF PREV R AND P PTR   19080021
*                                                                     * 19160021
RELOC10  LA    RLDSETAD,4(RLDSETAD)     UPDATE TO FA FIELD              19240021
         LH    WORK1,RLDBYTES                                           19320021
         SH    WORK1,FOUR               DECR. RLD BYTE COUNT            19400021
         LTR   WORK1,WORK1              IS RLD SET ALL PROCESSED        19480021
         BZ    RELOC150                 YES                             19560021
         STH   WORK1,RLDBYTES           SAVE REMAINING COUNT            19640021
         TM    0(RLDSETAD),PROC         IS RLD ALREADY PROCESSED        19720021
         BO    RELOC120                 YES                             19800021
*                                                                     * 19880021
*        COMPUTE TEXT BUFFER ADDRESS OF ADCON                         * 19960021
*                                                                     * 20040021
         L     WORK1,0(RLDSETAD)        RLD FA FIELD                    20120021
         LA    WORK1,0(WORK1)           CLEAR FLAG FIELD                20200021
         A     WORK1,BFREL              BFR RELOCAND + RLD ADDR         20280021
         ST    WORK1,ADCONADR           SAVE ADCON'S TEXT BUFFER ADDR   20360021
*                                                                     * 20440021
*        DETERMINE IF RLD ITEM IS WITHIN CURRENT TEXT LIMITS          * 20520021
*                                                                     * 20600021
         C     WORK1,TXTBEG             COMPARE TO BEGINNING OF TEXT    20680021
         BL    RELOC120                 NO, NOT WITHIN THIS TXT RECORD  20760021
         C     WORK1,8(CURTXTCB)        COMPARE TO END ADDR             20840021
         BL    RELOC20                  YES, IT IS WITHIN THIS TXT REC  20920021
         CLC   1(3,RLDSETAD),1(INRLDCB) NO,CHECK IF LOW RLD ADDR.       21000021
         BNL   RELOC120                       SHOULD BE UPDATED         21080021
         MVC   1(3,INRLDCB),1(RLDSETAD)                                 21160021
         B     RELOC120                 GO TO PROCESS NEXT RLD ITEM     21240021
*                                                                     * 21320021
*                 TEST FOR A SPLIT ADDRESS CONSTANT                   * 21400021
*                                                                     * 21480021
RELOC20  TM    0(RLDSETAD),X'04'        IS LENGTH OF ADCON = 3 BYTES    21560021
         BO    RELOC30                  NO                              21640021
         LA    WORK3,2                  YES,LENGTH-1 SAVED              21720021
         AR    WORK1,WORK3              CALC END OF ADCON               21800021
         B     RELOC50                                                  21880021
RELOC30  TM    0(RLDSETAD),X'08'        IS LENGTH OF ADCON = 4 BYTES    21960021
         BZ    RELOC40                  NO,  MUST BE TWO BYTES          22040021
         LA    WORK3,3                  YES,LENGTH-1 SAVED              22120021
         AR    WORK1,WORK3              CALC END OF ADCON               22200021
         B     RELOC50                                                  22280021
RELOC40  TM    0(RLDSETAD),X'20'        IS IT A PSEUDO REG TYPE         22360021
         BZ    ERROR01                  NO, SET BIT MAP ERROR INDICATOR 22440021
         LA    WORK3,1                  YES, LENGTH-1 SAVED             22520021
         AR    WORK1,WORK3              CALC END OF ADCON               22600021
RELOC50  STH   WORK3,LENGTH             SAVE ADCON LENGTH-1             22680021
         C     WORK1,8(CURTXTCB)        COMP END OF ADCON TO END OF BFR 22760021
         BL    RELOC60                                                  22840021
         BAL   RETURN,SPLTADCN          GO TO SPLIT ADCON ROUTINE       22920021
RELOC60  L     WORK3,PREVRPAD                                           23000021
         TM    0(WORK3),X'80'           IS TYPE A DELINK                23080021
         LH    WORK3,RSAVE              GET CURRENT R PTR               23160021
         LR    WORK0,WORK3                                              23240021
         BNO   RELOC70                  NO,  TEST FOR OVERLAY           23320021
*                                                                     * 23400021
*              DELINK THE ADDRESS CONSTANT                            * 23480021
*                                                                     * 23560021
         MH    WORK3,FIVE                                               23640021
         A     WORK3,DLKT               COMPUTE DELINK TABLE ENTRY ADDR 23720021
         MVC   DLNKR(2),0(WORK3)        GET R PTR FROM DELINK TABLE     23800021
         LH    WORK0,DLNKR              WORK0 CONTAINS TRUE R PTR       23880021
         MVC   DLNKSAVE+1(3),2(WORK3)  SAVE DELIND VALUE                23960021
RELOC70  TM    PDSE7,X'20'              IS THE PGM IN OVERLAY           24040021
         BO    SCDOVLY                  YES                             24120021
*                                                                     * 24200021
*   MOVE ADCON FROM TEXT BUFFER TO WORK REG FOR RELOCATION            * 24280021
*                                                                     * 24360021
RELOC75  L     WORK3,ADCONADR           GET TEXT ADDR OF ADCON          24440021
         LA    WORK1,ADCON+3            END ADDR OF ADCON SAVE AREA     24520021
         SH    WORK1,LENGTH                                             24600021
         LH    WORK4,LENGTH                                             24680021
         EX    WORK4,MOVE               MOVE ADCON TO GET BNDY. ALIGN.  24760021
         L     WORK4,ADCON                                              24840021
         ST    WORK1,RELADCON           STORAGE ADDR OF RELO ADCON      24920021
*                                                                     * 25000021
*     TEST TYPE TO DETERMINE WHAT TYPE OF RELOCATION TO PERFORM       * 25080021
*                                                                     * 25160021
         TM    0(RLDSETAD),X'80'        IS IT RELATIVE                  25240021
         BZ    RELOC130                 NO                              25320021
         NI    0(RLDSETAD),RELREL      SET OFF REL. INDIC.              25400021
         NI    NEWSW2,REL              SET REL. RELOC. INDIC.           25480021
         LR    WORK1,WORK0    USE SAVED ID TO INDEX HESD       @ZA08247 25560037
         LR    WORK3,WORK1                                     @ZA08247 25570037
         SLL   WORK3,3                                         @ZA08247 25580037
         A     WORK3,HESD                                      @ZA08247 25590037
         TM    0(WORK3),X'0F'    TEST FOR UNRESOLVED EXTERNAL  @ZA08247 25600037
         BC    8,TESTIT                                        @ZA08247 25610037
         TM    0(WORK3),X'05'                                  @ZA08247 25620037
         BC    5,TESTIT                                        @ZA08247 25630037
         OI    0(RLDSETAD),UNRESER  SET UNRESOLVED EXT.REF.IND @ZA08247 25640037
TESTIT   TM    NEWSW2,ABS           REL OR ABS RELOCATION      @ZA08247 25650037
         BO    GETIT                ABS.USE LKA FROM HESD      @ZA08247 25660037
         LR    WORK3,WORK1          REL.GET REL FACTOR FROM    @ZA08247 25670037
         SLL   WORK3,2               THE REL.RELOC.CONST. TBL  @ZA08247 25680037
         A     WORK3,RECNT                                     @ZA08247 25690037
GETIT    L     WORK3,0(WORK3)      GET RELOC FACTOR            @ZA08247 25700037
*                                                                     * 25800021
*                        PERFORM  RELOCATION                          * 25880021
*                                                                     * 25960021
         TM    0(RLDSETAD),X'90'       UNRESOLVED VCON                  26040021
         BNO   RELOC90                 NO-GO AND RELOCATE               26120021
         SR    WORK4,WORK4        YES - CLEAR REG. AND RETURN           26200021
         OI    0(RLDSETAD),PROC   MARK RLD PROCESSED                    26280021
         B     RELOC110                                                 26360021
RELOC90  TM    0(RLDSETAD),X'02'        DOES RLD INDICATE SUBT.         26440021
         BZ    RELOC95                  NO                              26520021
         LCR   WORK3,WORK3              COMPLEMENT FOR SUBTRACT         26600021
RELOC95  AR    WORK4,WORK3              RELOCATE ADCON                  26680021
*                                                                     * 26760021
*           PLACE RELOCATED ADDRESS CONSTANT BACK INTO TEXT           * 26840021
*                                                                     * 26920021
RELOC100 ST    WORK4,ADCON              PUTS RELOC. ADCON INTO WK AREA  26970037
         L     WORK3,RELADCON           ADDR. OF RELOCATED ADCON        27080021
         L     WORK1,ADCONADR           TEXT BUFFER ADDR OF ADCON       27160021
         LH    WORK2,LENGTH                                             27240021
         EX    WORK2,MOVE               RELOC ADCON MOVE BACK INTO TEXT 27320021
*                                                                     * 27400021
*            RELOCATE THE ADDRESS FIELD OF CURRENT RLD ITEM           * 27480021
*                                                                     * 27560021
RELOC110 LH    WORK1,CURID                                              27640021
         NI    NEWSW2,REL              SET REL. RELOC. INDIC.           27720021
         BAL   RETURN,FRELFAC1          TO FETCH RELOCATION FACTOR      27800021
         L     WORK4,0(RLDSETAD)        GET RLD ADDR.                   27880021
         LA    WORK4,0(WORK4)          CLEAR FLAG FIELD                 27960021
         AR    WORK4,WORK3                                              28040021
         ST    WORK4,TEMPAREA                                           28120021
         MVC   1(3,RLDSETAD),TEMPAREA+1 UPDATE RLD ADDR FIELD           28200021
         OI    0(RLDSETAD),PROC         MARK RLD PROCESSED              28280021
*                                                                     * 28360021
*              UPDATE TO NEXT RLD ITEM                                * 28440021
*                                                                     * 28520021
RELOC120 TM    0(RLDSETAD),X'01'        IS IT A FA CONTINUATION         28600021
         BO    RELOC10                  YES, RETURN                     28680021
         LA    RLDSETAD,4(RLDSETAD)     NO, UPDATE TO NEXT RLD ITEM     28760021
         LH    WORK1,RLDBYTES                                           28840021
         SH    WORK1,FOUR                                               28920021
         STH   WORK1,RLDBYTES           DECR. RLD BYTE COUNT            29000021
         LTR   WORK1,WORK1             RLD SET ALL PROCESSED            29080021
         BZ    RELOC150                YES                              29160021
         B     RELOC00                  RETURN TO PROCESS NEXT RLD      29240021
*                                                                     * 29320021
*                   ABSOLUTE  RELOCATION                              * 29400021
*                                                                     * 29480021
RELOC130 TM    0(RLDSETAD),X'30'        IS IT A PSEUDO REG - TYPE 2     29560021
         BO    RELOC135                 YES                             29640021
         L     WORK1,PREVRPAD                                           29720021
         TM    0(WORK1),X'80'           IS DELINKING REQUIRED           29800021
         BO    RELOC140                 YES                             29880021
RELOC131 OI    NEWSW2,ABS              SET ABS. RELOC. INDIC.           29960021
         BAL   RETURN,FRELFAC           TO FETCH ABS. RELOC. FACTOR     30040021
         TM    0(RLDSETAD),X'70'        IS TYPE ABSOLUTE                30120021
         BZ    RELOC90                  YES, GO TO RELOCATE             30200021
*                                       NO, TYPE IS 'BRANCH' OR PSEUDO1 30280021
         LR    WORK4,WORK3              USE RELOC. FAC. AS ADCON VALUE  30360021
         B     RELOC100                 RETURN TO RELOCATE              30440021
RELOC135 L     WORK4,PRAL               USE  ACCUM LNC AS ADCON VALUE   30520021
         B     RELOC100                 RETURN TO RELOCATE              30600021
RELOC140 L     WORK2,DLNKSAVE          GET DELIND VALUE                 30680021
         TM    0(RLDSETAD),X'02'        DOES SIGN INDICATE SUBTRACT     30760021
         BO    RELOC145                 YES                             30840021
         LCR   WORK2,WORK2              COMPLEMENT VALUE                30920021
RELOC145 AR    WORK4,WORK2              ADD DELINK VALUE TO ADCON       31000021
         NI    0(RLDSETAD),ABSOLUTE    MARK RLD ABSOLUTE                31080021
         B     RELOC131                                                 31160021
RELOC150 OI    2(NOTLSENT),JUSTPROC    RLD SET JUST PROCESSED           31240021
         CLC   FF(3),1(INRLDCB)         IS RLD SET ALL RELOCATED        31320021
         BE    RELOC160                 YES                             31400021
         L     WORK3,0(INRLDCB)         NO, UPDATE LOWEST MULTIPLICITY  31480021
         LA    WORK3,0(WORK3)                                           31560021
         A     WORK3,INPUTADR                                           31640021
         SR    WORK2,WORK2                                              31720021
         D     WORK2,MULTSIZE          WORK3 CONTAINS UPDATED MULT      31800021
         STH   WORK3,TEMP                                               31880021
         NI    2(NOTLSENT),X'FC'       SAVE ONLY INDIC.                 31960021
         OC    TEMP(1),2(NOTLSENT)     SET INDICATORS IN NEW MULT       32040021
         MVC   2(2,NOTLSENT),TEMP       UPDATE LOWEST MULTIPLICITY      32120021
         MVC   1(3,INRLDCB),FF         REINITIAL F'S IN INRLDCB         32200021
         B     RELOC170                                                 32280021
RELOC160 OI    2(NOTLSENT),PROCESSD     SET PROCESSED BIT FOR RLD SET   32360021
*                                                                     * 32440021
*        CHECK FOR OTHER NEEDED RLD'S IN GROUPING                     * 32520021
*                                                                     * 32600021
RELOC170 CL    NOTLSENT,16(INRLDCB)     MORE RLD SETS IN GROUP          32680021
         BNE   RELOC190                YES                              32760021
         TM    0(INRLDCB),X'10'         WORKING IN BUFFER 1             32840021
         BZ    RELOC180                 YES                             32920021
         OI    2(CURTXTCB),BUF2PROC     NO,SET RLD'S IN BFR 2 PROCESSED 33000021
         B     TSTBUF1                                                  33080021
RELOC180 OI    2(CURTXTCB),BUF1PROC     SET RLD'S IN BUFFER 1 PROCESSED 33160021
         B     TSTBUF1                                                  33240021
RELOC190 LA    NOTLSENT,9(NOTLSENT)     INCR. TO NEXT NOTELIST ENTRY    33320021
         CLC   CURID(2),0(NOTLSENT)     CURRENT ID = ENTRY ID           33400021
         BNE   RELOC170                 NO                              33480021
         MVC   TEMPAREA(2),2(NOTLSENT)                                  33560021
         NI    TEMPAREA,X'03'          CLEAR INDICATORS                 33640021
         CLC   CURMULT(2),TEMPAREA     CURRENT MULT = ENTRY MULT        33720021
         BNE   RELOC170                 NO                              33800021
         ST    NOTLSENT,12(INRLDCB)     UPDATE NOTELIST FIELD OF CB     33880021
         B     TSTBUF1                  RETURN TO PROCESS               33960021
*                                                                     * 34040021
*   SUBROUTINE TO FETCH THE NEEDED RELOCATION FACTOR - WORK3 CONTAINS * 34120021
*     THE RELOCATION FACTOR ON EXIT - WORK0 CONTAINS R PTR ON ENTRANCE* 34200021
*                                                                     * 34280021
FRELFAC  LR    WORK1,WORK0              USE SAVED ID TO INDEX HESD      34360021
FRELFAC1 LR    WORK3,WORK1                                              34440021
         SLL   WORK3,3                                                  34520021
         A     WORK3,HESD                                               34600021
         TM    0(WORK3),X'0F'           TEST FOR UNRESOLVED EXTERNAL    34680021
         BC    8,TEST                                                   34760021
      TM   0(WORK3),X'05'                                               34840021
         BC    5,TEST                                                   34920021
         OI    0(RLDSETAD),UNRESER      SET UNRESOLVED EXT.REF.INDIC.   35000021
TEST     TM    NEWSW2,ABS              REL OR ABS RELOCATION NEEDED     35080021
         BO    GET                      ABS. - USE LKA FIELD FROM HESD  35160021
         LR    WORK3,WORK1              REL. - GET RELOC.FACTOR FROM    35240021
         SLL   WORK3,2                       THE REL. RELOC. CONST. TBL 35320021
         A     WORK3,RECNT                                              35400021
GET      L     WORK3,0(WORK3)           GET RELOC FACTOR                35480021
         LA    WORK3,0(WORK3)           CLEAR HIGH ORDER BYTE           35560021
         BR    RETURN                   RETURN                          35640021
*                                                                     * 35720021
*                   OVERLAY RELOCATION  ROUTINE                       * 35800021
*                                                                     * 35880021
SCDOVLY  NI    VCONSW,LN3OFF            INIT 3-BYT VCON SWCH OFF A48242 35960000
         TM    0(RLDSETAD),X'60'        IS IT A V-TYPE ADCON            36010000
         BC    5,RELOC75               NO,RETURN                        36040021
         TM    0(RLDSETAD),X'10'                                        36120021
         BZ    RELOC75                  NO, RETURN                      36200021
         TM    0(RLDSETAD),X'0C'        IS LENGTH = 4 BYTES             36280021
         BM    ERROR02A                 NO - POSSIBLE ERROR      A48242 36360000
*                                       GO TURN ON SWITCH        A48242 36410000
RETRN    EQU   *                        AND CONTINUE             A48242 36420000
*                                                                     * 36440021
*              OBTAIN  'FROM'  SEGMENT                                * 36520021
*                                                                     * 36600021
         SR    WORK5,WORK5                                              36680021
         NI    0(RLDSETAD),RELREL      SET OFF RELATIVE INDIC.          36760021
         IC    WORK5,4(HESDADDR)        GET SEG. NO. FROM HESD          36840021
*                                                                     * 36920021
*              OBTAIN   'TO'   SEGMENT                                * 37000021
*                                                                     * 37080021
         OI    NEWSW2,ABS              SET ABS. RELOC. INDIC.           37160021
         BAL   RETURN,FRELFAC                                           37240021
         TM    0(RLDSETAD),X'80'        IS RLD MARKED 'UNRESOLVED ER'   37320021
         BO    RELOC75                  YES, RETURN TO NON-OVERLAY      37400021
         LR    WORK3,WORK0                                              37480021
         SLL    WORK3,3                                                 37560021
         A     WORK3,HESD              HESD ADDR OF R PTR               37640021
         SR    WORK1,WORK1                                              37720021
         IC    WORK1,4(WORK3)           GET SEG NO. FROM HESD           37800021
         BAL   RETURN,CPTH              GO TO COMMON PATH ROUTINE       37880021
*                                                                     * 37960021
*        TEST   RESULTS TO DETERMINE TYPE OF CALL                     * 38040021
*                                                                     * 38120021
         IC    WORK1,4(WORK3)                                           38200021
         CLR   WORK5,WORK1                                              38280021
         BE    RELOC75                 UPWARD CALL-NO ENTAB NEEDED      38360021
         IC    WORK1,4(HESDADDR)                                        38440021
         CLR   WORK5,WORK1                                              38520021
         BE    OVLY70                  DOWNWARD CALL-ENTAB NEEDED       38600021
*                                                                     * 38680021
*        TEST TO DETERMINE IF IT IS WITHIN OR ACROSS A REGION         * 38760021
*                                                                     * 38840021
         ST    SAVEAREA,SAVE13         SAVE REG. 13 TEMPORARILY         38920021
         LA    SAVEAREA,OVLY30          INITIALIZE                      39000021
OVLY10   LA    RETURN,4                 LOOP CT = 4 REGIONS             39080021
         LA    WORK5,LSTS                                               39160021
         SR    WORK2,WORK2                                              39240021
OVLY20   IC    WORK2,0(WORK5)           GET HIGHEST SEG OF REGION       39320021
         CLR   WORK1,WORK2              COMPARE TO 'TO' AND 'FROM' SEG  39400021
         BCR   13,SAVEAREA              SEG. IS IN REGION               39480021
         LA    WORK5,1(WORK5)           SEG NOT IN REGION -UPDATE TO    39560021
         BCT   RETURN,OVLY20                 NEXT REGION                39640021
OVLY30   ST    WORK5,TEMPAREA           FOUND REGION FOR 'FROM' SEG     39720021
         LA    SAVEAREA,OVLY40                                          39800021
         IC    WORK1,4(WORK3)           GET 'TO' SEGMENT                39880021
         B     OVLY10                   GO TO FIND ITS REGION           39960021
OVLY40   CL    WORK5,TEMPAREA           ARE SEGMENTS IN SAME REGION     40040021
         L     SAVEAREA,SAVE13         RESTORE REG 13                   40120021
         BNE   OVLY70                   NO                              40200021
*                                                                     * 40280021
*              SEGMENTS IN SAME REGION-TEST FOR EXCLUSIVE CALL        * 40360021
*                                                                     * 40440021
         L     WORK2,SELST                                              40520021
         LH    WORK5,ENELTC                                             40600021
         LTR   WORK5,WORK5                                              40680021
         BZ    RELOC75                 NO ENTRIES-INVALID EXCLUS. CALL  40760021
OVLY50   CH    WORK0,0(WORK2)           ENTRY IN ENTRY LIST FOR CALL    40840021
         BE    OVLY60                   YES                             40920021
         LA    WORK2,6(WORK2)                                           41000021
         BCT   WORK5,OVLY50                                             41080021
         B     RELOC75                  INVALID EXCLUSIVE CALL          41160021
*                                                                     * 41240021
*        PLACE CUR. SEG.NO. AND ENTAB ADDR. INTO ADCON TEXT LOCATION  * 41320021
*                                                                     * 41400021
OVLY60   TM    VCONSW,LEN3             IS IT A 3-BYTE VCON ?     A48242 41450000
         BO    ERROR02B                IF SO, IT IS AN ERROR     A48242 41460000
         L     WORK5,ADCONADR           TXT ADDR OF ADCON        A48242 41480000
*        PLACE CUR.SEG.NO. AND ENTAB ADDR INTO ADCON TEXT LOCATION    * 41560021
         MVC   1(3,WORK5),3(WORK2)      ENTAB ENTRY ADDR.               41640021
         MVC   0(1,WORK5),CURSEG+1      CUR. SEG. NO.                   41720021
         B     RELOC110                 RETURN TO RELOCATE              41800021
OVLY70   TM    VCONSW,LEN3             IS IT A 3-BYTE VCON ?     A48242 41850000
         BO    ERROR02B                IF SO, IT IS AN ERROR     A48242 41860000
         LH    WORK5,ENELTC                                      A48242 41880000
OVLY70C  CH    WORK5,ENELTX             ENTRY LIST FULL                 41960021
         BL    OVLY70B                 NO,BRANCH OUT            S01904  42040021
         TM    APT4,REALOCTE           REALLOC DONE ALREADY?    S01904  42120021
         BNO   OVLY70A                 NO,TRY TO REALLOC        S01904  42200021
         LA    RETURN,ERCODE44         SIGNAL ERROR COND                42280021
         B     ERROR                    GO TO ERROR EXIT                42360021
OVLY70A  STM   WORK1,WORK3,BRNCHSV     SAVE WORK REGISTERS      S01904  42440021
         L     WORK3,FFCADR            HIGHEST ADDR RETAINED BY ALLOC   42520021
         S     WORK3,SELST             MINUS ADDR OF 2PASS ENTRY LIST   42600021
         XR    WORK2,WORK2             EQUALS AVAILABLE BYTES   S01904  42680021
         D     WORK2,SIXFULL           DIVIDE BY SIX            S01904  42760021
         STH   WORK3,ENELTX            YIELDS NEW MAX NO OF ENTRIES     42840021
         OI    APT4,REALOCTE           FLAG REALLOCATION AS DONE        42920021
         LM    WORK1,WORK3,BRNCHSV     RESTORE REGISTERS        S01904  43000021
         B     OVLY70C                 RESUME PROCESSING        S01904  43080021
OVLY70B  LTR   WORK5,WORK5              ENTRY LIST EMPTY                43160021
         BZ    OVLY90                   YES                             43240021
*                                                                     * 43320021
*        SCAN ENTRY LIST ON  ID  FOR SAVED R                          * 43400021
*                                                                     * 43480021
         L     WORK2,SELST                                              43560021
OVLY80   CH    WORK0,0(WORK2)           SAVED R = ENTRY LIST ID         43640021
         BE    OVLY60                   YES                             43720021
         LA    WORK2,6(WORK2)                                           43800021
         BCT   WORK5,OVLY80                                             43880021
*                                                                     * 43960021
*        ENTRY LIST FOR ID DOES NOT EXIST - CREATE AN ENTRY           * 44040021
*                                                                     * 44120021
OVLY90   L     WORK2,CURENTRY                                           44200021
         STH   WORK0,0(WORK2)           R PTR TO ENTRY LIST             44280021
         MVC   2(1,WORK2),CURSEG+1      CURRENT SEGMENT TO ENTRY LIST   44360021
         MVC   3(3,WORK2),LKAENTAB+1    ENTAB LKA                       44440021
*                                                                     * 44520021
*        PLACE CUR.SEG.NO.AND ENTAB ADDR.INTO ADCON TEXT LOCATION     * 44600021
*                                                                     * 44680021
         L     WORK5,ADCONADR                                           44760021
         MVC   0(4,WORK5),2(WORK2)      MODIFY VALUE OF ADCON           44840021
         LA    WORK2,6(WORK2)                                           44920021
         ST    WORK2,CURENTRY           UPDATE ENTRY LIST 1ST FREE ADDR 45000021
         L     WORK1,LKAENTAB                                           45080021
         LA    WORK1,12(WORK1)                                          45160021
         ST    WORK1,LKAENTAB           UPDATE TO NEXT ENTAB LINE ADDR. 45240021
         LH    WORK1,ENELTC                                             45320021
         LA    WORK1,1(WORK1)           INC. ENTRY LIST COUNT           45400021
         STH   WORK1,ENELTC                                             45480021
         B     RELOC110                 RETURN TO RELOCATE              45560021
*                                                                     * 45640021
*              SPLIT ADDRESS CONSTANT ROUTINE                         * 45720021
*                                                                     * 45800021
SPLTADCN STM   WORK0,BRANCH,SAVERET    SAVE ALL REGISTERS               45880021
         OI    2(NOTLSENT),SPLT         SET SPLIT ADCON IN RLD SET      45960021
         ST    RLDSETAD,SPLITADR        SAVE START ADDR OF SPLIT RLD    46040021
         L     WORK2,SAVE+16            GET ADDR OF OTHER TEXT CTRL BLK 46120021
         TM    0(WORK2),INUSE           IS IT IN USE                    46200021
         BO    SPLT7                    YES                             46280021
SPLT2    L     WORK3,4(CURTXTCB)        BEG. OF TEXT IN BUFFER          46360021
         L     WORK1,BFREL                                              46440021
         A     WORK1,TXTBFBEG                                           46520021
         S     WORK1,TXTBEG                                             46600021
         ST    WORK1,BFREL             UPDATE BUFFER RELOC. CONSTANT    46680021
         A     WORK1,0(RLDSETAD)                                        46760021
         ST    WORK1,ADCONADR          UPDATE ADCON ADDRESS             46840021
         L     WORK1,TXTBFBEG           BEG. OF TEXT BUFFER             46920021
         ST    WORK1,TXTBEG            UPDATE TEXT BEG. ADDR            47000021
         ST    WORK1,4(CURTXTCB)        UPDATE BEG. OF TEXT IN BUFFER   47080021
         L     WORK5,MULTSIZE           SIZE OF TEXT                    47160021
         LA    WORK4,255                YES                             47240021
SPLT3    CH    WORK5,CON256             MORE THAN 256 BYTES TO MOVE     47320021
         BL    SPLT5                    NO                              47400021
         EX    WORK4,MOVE               MOVE 256 BYTES                  47480021
         SH    WORK5,CON256             DECR TXT SIZE                   47560021
         AH    WORK3,CON256             UPDATE TXT BUFFER PTRS          47640021
         AH    WORK1,CON256                                             47720021
         B     SPLT3                                                    47800021
SPLT5    EQU   *                                        OX05443,OY04003 47850003
         LTR   WORK5,WORK5             ANY REMAINDER?   OX05443,OY04003 47860003
         BNP   SPLT6                   NO,CONTINUE      OX05443,OY04003 47870003
         LR    WORK4,WORK5             SAVE COUNT       OX05443,OY04003 47872003
         BCTR  WORK4,0                 DECRE FOR MOVE   OX05443,OY04003 47874003
         EX    WORK4,MOVE              MOVE REMAINDER   OX05443,OY04003 47876003
         AR    WORK1,WORK5             UPDATE TEXT BUFFER POINTER       47878003
SPLT6    EQU   *                                        OX05443,OY04003 47878403
         ST    WORK1,8(CURTXTCB)        UPDATE END OF TEXT IN BUFFER    47880003
         ST    WORK1,FREEADDR          UPDATE 1ST FREE ADDR             47960021
         LR    WORK1,WORK2                                              48040021
         LA    WORK0,1                 LOOKAHEAD READ INDIC             48120021
         L     BRANCHX,ADGET                                            48200021
         BALR  RETURN,BRANCHX           GO TO READ IN NEXT MULT         48280021
SPLT7    TM    0(WORK2),BEINGRD         IS IT BEING READ                48360021
         BO    SPLT8                    YES                             48440021
         TM    0(WORK2),BEINGWT         IS IT BEING WRITTEN             48520021
         BZ    SPLT9                    NO                              48600021
         L     RETURN,ADCHKWRT                                          48680021
         BALR  BRANCHX,RETURN          CHECK WRITE                      48760021
         NI    0(WORK2),WRTCKD          MARK TEXT CTRL BLK NOT IN USE   48840021
         B     SPLT2                       AND NOT BEING WRITTEN        48920021
SPLT8    L     RETURN,ADCHKRD                                           49000021
         BALR  BRANCHX,RETURN          CHECK READ                       49080021
         NI    0(WORK2),RDCKD           MARK TEXT CTRL BLK NOT BEING RD 49160021
SPLT9    LM    WORK0,BRANCH,SAVERET    RESTORE ALL REGISTERS            49240021
         BR    RETURN                   RETURN                          49320021
*                                                                     * 49400021
* DETERMINE THE HIGHEST SEGMENT IN THE COMMON PATH BETWEEN 2 SEGMENTS * 49480021
*                                                                     * 49560021
CPTH     L     WORK2,SGT1                                               49640021
CPTH1    CLR   WORK5,WORK1                                              49720021
         BCR   8,RETURN                 SEGMENTS EQUAL - RETURN         49800021
         BH    CPTH2                                                    49880021
         XR    WORK5,WORK1              SWITCH REGISTERS                49960021
         XR    WORK1,WORK5                                              50040021
         XR    WORK5,WORK1                                              50120021
CPTH2    IC    WORK5,0(WORK2,WORK5)                                     50200021
         LTR   WORK5,WORK5              SEGMENT ENTRY > 0               50280021
         BH    CPTH1                   YES                              50360021
         LA    WORK5,1                  NO, SET SEGMENT = 1             50440021
         BR    RETURN                   RETURN                          50520021
*                                                                     * 50600021
*                                                                     * 50680021
*     MOVE  RELOCATED RLDS FROM INPUT BUFFER TO OUTPUT BUFFER         * 50760021
*                                                                     * 50840021
*                                                                     * 50920021
MVRLD    TM    NEWSW2,SPLTMOVD          CHECK IF SPLIT RLD IN BUFFER    51000021
         BO    MVRLD20                  YES                             51080021
         TM    NEWSW2,GROUPRLD         SHOULD RLDS BE GROUPED           51160021
         BZ    MVRLD00                 NO                               51240021
         NI    NEWSW2,GROUPOFF         SET RLD GROUP INDIC OFF          51320021
         L     OUTRLDCB,SAVEBFCB       USE PREV BUFFER CTRL BLK         51400021
         B     MVRLD30                                                  51480021
*                                                                     * 51560021
*                  FIND  A FREE OUTPUT RLD BUFFER                     * 51640021
*                                                                     * 51720021
MVRLD00  LA    OUTRLDCB,OTRLDCB1        IS BUFFER 1 FREE                51800021
         TM    0(OUTRLDCB),INUSE                                        51880021
         BZ    MVRLD25                  YES                             51960021
         LA    OUTRLDCB,OTRLDCB2        IS BUFFER 2 FREE                52040021
         TM    0(OUTRLDCB),INUSE                                        52120021
         BZ    MVRLD25                  YES                             52200021
         LA    OUTRLDCB,OTRLDCB3        IS BUFFER 3 FREE                52280021
         TM    0(OUTRLDCB),INUSE                                        52360021
         BZ    MVRLD25                  YES                             52440021
         TM    0(OUTRLDCB),BEINGWT      IS BUFFER 3 BEING WRITTEN       52520021
         BO    MVRLD10                  YES                             52600021
         LA    OUTRLDCB,OTRLDCB2        IS BUFFER 2 BEING WRITTEN       52680021
         TM    0(OUTRLDCB),BEINGWT                                      52760021
         BO    MVRLD10                  YES                             52840021
         LA    OUTRLDCB,OTRLDCB1        IS BUFFER 1 BEING WRITTEN       52920021
         TM    0(OUTRLDCB),BEINGWT                                      53000021
         BZ    MVRLD210                 NO, ALL BUFFERS IN USE - WRITE  53080021
MVRLD10  L     RETURN,ADCHKWRT                                          53160021
         BALR  BRANCHX,RETURN          BRANCH TO CHECK WRITE            53240021
         NI    0(OUTRLDCB),WRTCKD       WRITE CHECKED -CB NOT IN USE    53320021
         B     MVRLD25                                                  53400021
MVRLD20  L     OUTRLDCB,CBTOUSE         CB.ADDR.FOR BFR.WITH SPLIT RLD  53480021
         NI    NEWSW2,MOVDOFF           TURN OFF SPLIT RLD MOVED INDIC. 53560021
         B     MVRLD28                                                  53640021
MVRLD25  L     WORK2,8(OUTRLDCB)        GET BEG. ADDR. OF BUFFER        53720021
         XC    0(16,WORK2),0(WORK2)     CLEAR THE CONTROL RECORD        53800021
         MVC   4(4,OUTRLDCB),8(OUTRLDCB) FIRST FREE ADDR= BFR.BEG.      53880021
MVRLD28  MVC   TEMP(1),1(OUTRLDCB)                                      53960021
         XI    TEMP,X'FF'               FLIP BITS                       54040021
         NI    TEMP,X'38'               ALL BITS OFF EXCEPT BFR. INDIC. 54120021
         OC    1(1,CURTXTCB),TEMP       ASSOCIATE BFR. WITH TXTCB       54200021
         OI    0(OUTRLDCB),INUSE        MARK OUTPUT CB USED             54280021
         XC    2(2,OUTRLDCB),2(OUTRLDCB) ZERO ID LENGTH FIELD           54360021
MVRLD30  TM    NEWSW2,RPSAVED           HAVE R AND P PTRS.BEEN SAVED    54440021
         BO    MVRLD100                                                 54520021
*                                                                     * 54600021
*        DETERMINE IN WHICH BUFFER THE PROCESSED RLDS ARE             * 54680021
*                                                                     * 54760021
MVRLD35  TM    2(CURTXTCB),BUF1PROC     PROCESSED RLDS IN BUFFER 1      54840021
         LA    INRLDCB,INRLDCB1                                         54920021
         BO    MVRLD40                  YES                             55000021
         TM    2(CURTXTCB),BUF2PROC     PROCESSED RLDS IN BUFFER 2      55080021
         LA    INRLDCB,INRLDCB2                                         55160021
         BO    MVRLD40                  YES                             55240021
         TM    NEWSW2,MORERLDS         ARE THERE MORE RLDS FOR TEXT     55320021
         BZ    MVRLD36                 NO, CHECK FOR EMPTY BUFFER       55400021
         OI    NEWSW2,GROUPRLD         YES, SET RLD GROUP INDIC.        55480021
         ST    OUTRLDCB,SAVEBFCB       SAVE CTRL BLK ADDRESS            55560021
         B     MVRLD37                                                  55640021
MVRLD36  L     WORK2,4(OUTRLDCB)       FIRST FREE ADDRESS               55720021
         LR    WORK1,OUTRLDCB                                           55800021
         CL    WORK2,8(OUTRLDCB)       HAS ANYTHING BEEN ADDED TO BFR   55880021
         BNE   MVRLD37                 YES                              55960021
         NI    0(WORK2),RLDOFF         NO, TURN RLD INDIC. OFF          56040021
         NI    0(OUTRLDCB),NOTINUSE    MARK CTRL BLK NOT IN USE         56120021
         NC    1(1,CURTXTCB),1(OUTRLDCB)                                56200021
MVRLD37  LM    2,15,SAVE+8             RESTORE REGISTER 0,2-15          56280021
         L     0,SAVE                                                   56360021
         BR    RETURN                   RETURN,ALL RELOCATED RLDS MOVED 56440021
*                                                                     * 56520021
*          IDENTIFY NOTELIST ENTRY PERTAINING TO THE RLDS THAT        * 56600021
*                  ARE TO BE MOVED                                    * 56680021
*                                                                     * 56760021
MVRLD40  L     WORK2,8(OUTRLDCB)                                        56840021
         OI    0(WORK2),RLD             SET RLDS PRESENT INDIC IN CR    56920021
         L     NOTLSENT,8(INRLDCB)      ADDR. OF 1ST NOTELIST ENTRY     57000021
MVRLD50  CLC   0(2,NOTLSENT),CURID     ENTRY ID = CURRENT ID            57080021
         BNE   MVRLD60                                                  57160021
         TM    2(NOTLSENT),JUSTPROC     RLD SET HAS RELOC.RLDS TO MOVE  57240021
         BO    MVRLD80                  YES                             57320021
MVRLD60  LA    NOTLSENT,9(NOTLSENT)     UPDATE TO NEXT ENTRY            57400021
         CL    NOTLSENT,16(INRLDCB)     ALL RLDS MOVED FROM BUFFER      57480021
         BNH   MVRLD50                  NO                              57560021
         L     WORK2,4(OUTRLDCB)                                        57640021
         AH    WORK2,TWELVE                                             57720021
         NI    0(WORK2),CONTOFF        SET CONT. OFF IN LAST FA FIELD   57800021
         TM    0(INRLDCB),BUF2          ALL RLDS MOVED FROM INPUT BFR2  57880021
         BO    MVRLD70                  YES                             57960021
         NI    2(CURTXTCB),BUF1OFF      NO RLDS IN BFR1 FOR CURR. TEXT  58040021
         B     MVRLD35                                                  58120021
MVRLD70  NI    2(CURTXTCB),BUF2OFF      NO RLDS IN BFR2 FOR CURR. TEXT  58200021
         B     MVRLD35                                                  58280021
MVRLD80  NI    2(NOTLSENT),JUSTOFF      TURN RLDS TO MOVE INDIC. OFF    58360021
         ST    NOTLSENT,12(INRLDCB)                                     58440021
*                                                                     * 58520021
*    CALCULATE  ADDRESS AND EXTENT OF RLD SET IN BUFFER               * 58600021
*                                                                     * 58680021
         MVC   TEMPAREA(2),4(NOTLSENT)  LENGTH OF RLD SET               58760021
         LH    WORK2,TEMPAREA                                           58840021
         SLL   WORK2,2                  MULT. TO GET BYTES OF RLD       58920021
         CL    NOTLSENT,8(INRLDCB)     IS THIS 1ST ENTRY FOR BUFFER     59000021
         BNE   MVRLD90                 NO                               59080021
         L     RLDSETAD,4(INRLDCB)     YES USE BEG. OF BUFFER           59160021
         B     MVRLD95                                                  59240021
MVRLD90  SH    NOTLSENT,THREE                                           59320021
         MVC   TEMPAREA+1(3),0(NOTLSENT) GET DISP.OF RLDS FROM BFR.BEG. 59400021
         L     RLDSETAD,TEMPAREA                                        59480021
         LA    RLDSETAD,0(RLDSETAD)     CLEAR HIGH ORDER BYTES          59560021
         SLL   RLDSETAD,2                                               59640021
         A     RLDSETAD,4(INRLDCB)      ADDR. OF RLD SET IN BUFFER      59720021
MVRLD95  AR    WORK2,RLDSETAD                                           59800021
         ST    WORK2,RLDSTEND           SAVE RLD SET END ADDR.          59880021
*                                                                     * 59960021
*      CALCULATE BEGIN AND END OF TEXT                                * 60040021
*                                                                     * 60120021
         LH    WORK2,CURMULT                                            60200021
         MH    WORK2,MULTSIZE+2         DISPLACEMENT FROM BEG. OF CSECT 60280021
         LH    WORK1,CURID                                              60360021
         SLL   WORK1,3                                                  60440021
         A     WORK1,HESD                                               60520021
         L     WORK3,0(WORK1)                                           60600021
         LA    WORK3,0(WORK3)                                           60680021
         AR    WORK2,WORK3              DISPLACEMENT FROM BEG.OF MODULE 60760021
         ST    WORK2,MULTBEG            START DISP. OF MULT.            60840021
         A     WORK2,MULTSIZE                                           60920021
         ST    WORK2,MULTEND            END  DISP. OF  MULT.            61000021
*                                                                     * 61080021
*    CHECK FOR SPLIT RLD FROM PREVIOUS TEXT AND FOR SPLIT RLD         * 61160021
*                      IN CURRENT TEXT                                * 61240021
*                                                                     * 61320021
         NI    NEWSW2,NOTINBFR         TURN OFF R+P IN BFR.             61400021
         MVI   RPPTRS,X'FF'             SET PREV. R PTR TO HIGHEST R    61480021
         TM    NEWSW2,SPLTMOVD          HAS SPLIT RLD BEEN MOVED TO BFR 61560021
         BZ    MVRLD100                                                 61640021
         L     WORK2,8(OUTRLDCB)                                        61720021
         MVC   RPPTRS(2),16(WORK2)     SET R PTR TO SPLIT RLD R PTR     61800021
         OI    NEWSW2,RPINBFR           TURN ON  R+P IN BFR. INDICATOR  61880021
MVRLD100 L     NOTLSENT,12(INRLDCB)     NOTELIST ENTRY ADDR.            61960021
MVRLD102 TM    NEWSW2,RPSAVED           R+P SAVED FROM PREV RLD RECORD  62040021
         BZ    MVRLD105                 NO                              62120021
         NI    NEWSW2,RPSAVOFF          SET R+P SAVED INDIC OFF         62200021
         L     RLDSETAD,RESUMEAD        GET ADDR OF CHAIN               62280021
         B     MVRLD120                                                 62360021
MVRLD105 MVC   RSAVE(2),0(RLDSETAD)                                     62680021
         TM    RSAVE,X'80'             IS R PTR MARKED DELINK           62760021
         BZ    MVRLD110                NO               OX05440,OY04132 62840003
         NI    RSAVE,X'7F'             TURN OFF DELINK BIT              62920021
         SR    WORK2,WORK2             CLEAR REGISTER                   63000021
         LH    WORK2,RSAVE                                              63080021
         MH    WORK2,FIVE                                               63160021
         A     WORK2,DLKT              DELINK TABLE ENTRY FOR R PTR     63240021
         MVC   RSAVE(2),0(WORK2)       UPDATE R PTR                     63320021
MVRLD110 LA    RLDSETAD,4(RLDSETAD)     UPDATE TO FA FIELD              64280021
MVRLD120 TM    0(RLDSETAD),PROC         IS RLD PROCESSED                64360021
         BZ    MVRLD140                 NO                              64440021
         TM    2(NOTLSENT),SPLT         IS THERE A SPLIT RLD IN SET     64520021
         BZ    MVRLD121                NO                               64600021
         CL    RLDSETAD,SPLITADR       IS THIS A SPLIT RLD              64680021
         BE    MVRLD145                YES                              64760021
MVRLD121 L     WORK2,0(RLDSETAD)        GET RLD ADD?                    64840021
         LA    WORK2,0(WORK2)                                           64920021
*                                                                     * 65000021
*    CHECK IF  RLD REFERS TO CURRENT MULTIPLICITY                     * 65080021
*                                                                     * 65160021
         CL    WORK2,MULTBEG                                            65240021
         BL    MVRLD140                                                 65320021
         CL    WORK2,MULTEND                                            65400021
         BNL   MVRLD140                                                 65480021
         TM    NEWSW2,RPINBFR           ARE R+P PTRS.ALREADY IN BUFFER  65560021
         L     WORK2,4(OUTRLDCB)        FIRST FREE ADDR                 65640021
         BO    MVRLD125                 YES                             65720021
*                                                                     * 65800021
*                                                       OX05440,OY04132 65850003
*      CHECK IF RLDS CAN BE CHAINED WITH PREVIOUS RLDS  OX05440,OY04132 65860003
*                                                       OX05440,OY04132 65870003
MVRLD106 CLC   RPPTRS(2),RSAVE         DOES PREV R = NEW R              65872003
         BNE   MVRLD108                 NO              OX05440,OY04132 65874003
         CL    WORK2,8(OUTRLDCB)       ANYTHING IN BUFFER               65878003
         BE    MVRLD108                NO               OX05440,OY04132 65878403
         OI    NEWSW2,RPINBFR          SET R AND P IN BUFFER            65878803
         OI    12(WORK2),CONT          SET CONT BIT IN PREV FA          65879203
         B     MVRLD123                                 OX05440,OY04132 65879803
MVRLD108 MVC   RPPTRS(2),RSAVE         SAVE NEW R PTR   OX05440,OY04132 65879903
*                                                                       65906603
*          CHECK IF ROOM IN OUTPUT RLD BUFFER                         * 65933303
*                                                                     * 65960021
MVRLD123 EQU   *                                        OX05440,OY04132 66010003
         CLC   4(4,OUTRLDCB),12(OUTRLDCB) IS THERE ROOM FOR R-P PTR.    66040021
         BNL   MVRLD180                 NO                              66120021
         L     WORK3,12(OUTRLDCB)                                       66200021
         SH    WORK3,EIGHT                                              66280021
         CR    WORK2,WORK3              IS THERE ROOM TO ADD R+P AND FA 66360021
         BH    MVRLD180                 NO                              66440021
         CL    WORK2,8(OUTRLDCB)       1ST ENTRY IN BUFFER              66520021
         BE    MVRLD122                YES                              66600021
         NI    12(WORK2),CONTOFF       MAKE SURE CONT. INDIC OFF        66680021
MVRLD122 MVC   16(4,WORK2),RPPTRS      MOVE R+P TO OUTPUT BUFFER        66760021
         LA    WORK2,4(WORK2)                                           66840021
         ST    WORK2,4(OUTRLDCB)        UPDATE 1ST FREE ADDR.           66920021
         OI    NEWSW2,RPINBFR           SET INDICATOR  R+P  IN BFR      67000021
         B     MVRLD130                                                 67080021
MVRLD125 CLC   4(4,OUTRLDCB),12(OUTRLDCB) IS THERE ROOM TO ADD FA       67160021
         BNL   MVRLD170                 NO                              67240021
         OI    12(WORK2),CONT          MAKE SURE CONT INDIC ON          67320021
*                                                                     * 67400021
*         MOVE RLD INFORMATION FROM INPUT TO OUTPUT BUFFER            * 67480021
*                                                                     * 67560021
MVRLD130 MVC   16(4,WORK2),0(RLDSETAD) MOVE FA TO OUTPUT BUFFER         67640021
         NI    16(WORK2),PROCOFF       TURN OFF PROCESSED INDICATOR     67720021
         LA    WORK2,4(WORK2)                                           67800021
         ST    WORK2,4(OUTRLDCB)        UPDATE 1ST FREE ADDR.           67880021
MVRLD140 TM    0(RLDSETAD),CONT         IS RLD MARKED CONTINUATION      67960021
         BZ    MVRLD160                 NO                              68040021
         B     MVRLD110                YES                              68120021
MVRLD145 L     WORK2,HESD                                               68200021
         MVC   0(4,WORK2),RPPTRS        MOVE SAVED R+P PTRS TO HESD     68280021
         MVC   0(2,WORK2),RSAVE         GET CORRECT R PTR      XM09129  68330003
         MVC   4(4,WORK2),0(RLDSETAD)   MOVE FA FIELD                   68360021
         NI    4(WORK2),X'BE'           TURN PROC. AND CONT BITS OFF    68440021
         OI    NEWSW2,SPLITRLD          SET SPLIT RLD SAVED IN HESD     68520021
         NI    2(NOTLSENT),SPLTOFF      TURN SPLIT RLD IN SET OFF       68600021
         TM    0(RLDSETAD),CONT         IS CONT. INDICATED              68680021
         BO    MVRLD110                                                 68760021
MVRLD160 NI    NEWSW2,NOTINBFR          TURN OFF R+P IN BFR. INDIC.     68840021
         LA    RLDSETAD,4(RLDSETAD)     UPDATE TO NEXT R+P FIELD        68920021
         CL    RLDSETAD,RLDSTEND        ARE RLDS ALL MOVED FROM SET     69000021
         BL    MVRLD100                 NO                              69080021
         L     WORK2,8(OUTRLDCB)       BUFFER BEGINNING                 69160021
         L     WORK3,4(OUTRLDCB)       1ST FREE ADDR                    69240021
         OI    0(WORK2),RLD            SET RLDS PRESEND INDIC           69320021
         SR    WORK3,WORK2                                              69400021
         ST    WORK3,4(WORK2)          STORE RLD BYTE COUNT IN BUFFER   69480021
         TM    0(CURTXTCB),LASTXT      IS TEXT LAST IN GROUP            69560021
         BO    MVRLD60                 YES                              69640021
         OI    NEWSW2,GROUPRLD         SET RLDS TO BE GROUPED INDIC     69720021
         ST    OUTRLDCB,SAVEBFCB       SAVE CTRL BLK ADDR               69800021
         B     MVRLD60                  YES, DET.IF MORE SETS IN GROUP  69880021
*                                            TO BE MOVED                69960021
*                                                                     * 70040021
* THE RLD OUTPUT BUFFER IS FULL --COMPLETE INFORMATION IN BUFFER      * 70120021
*        CONTROL RECORD AND BUFFER CONTROL BLOCK                      * 70200021
*                                                                     * 70280021
MVRLD170 L     WORK2,12(OUTRLDCB)                                       70360021
MVRLD180 ST    RLDSETAD,RESUMEAD        SAVE ADDR.OF WHERE TO RESUME    70440021
         NI    12(WORK2),CONTOFF        SET CONT. OFF IN PREV FA FIELD  70520021
         OI    NEWSW2,RPSAVED           SET R+P SAVED INDICATOR         70600021
         NI    NEWSW2,NOTINBFR         TURN OFF R-P IN BFR.             70680021
         L     WORK2,8(OUTRLDCB)        BUFFER BEGINNING                70760021
         L     WORK3,4(OUTRLDCB)        1ST FREE ADDR                   70840021
         OI    0(WORK2),RLD             SET RLDS PRESENT INDIC          70920021
         SR    WORK3,WORK2                                              71000021
         ST    WORK3,4(WORK2)           STORE RLD BYTE COUNT IN BUFFER  71080021
         B     MVRLD00                  GO TO FIND FREE OUTPUT BUFFER   71160021
*                                                                     * 71240021
*      ALL RLD OUTPUT BUFFERS ARE FULL- FREE ONE FOR USE              * 71320021
*                                                                     * 71400021
MVRLD210 TM    1(CURTXTCB),PREV         CHECK IF ONE CONTAINS THE       71480021
         BC    7,MVRLD230                    1D-LENGTH LIST             71560021
         TM    1(CURTXTCB),XDAP         HAS DUMMY WRITE BEEN WRITTEN    71640021
         BO    MVRLD220                 YES                             71720021
         TM    NEWSW2,MORERLDS          ARE THE MORE RLDS TO PROCESS    71800021
         BZ    MVRLD260                 NO                              71880021
         OI    1(CURTXTCB),DUMMY        SET DUMMY WRITE INDICATOR       71960021
         L     BRANCHX,ADWRTTXT                                         72040021
         BALR  RETURN,BRANCHX           BRANCH TO WRITE DUMMY TXT       72120021
         OI    1(CURTXTCB),XDAP         SET XDAP INDICATOR              72200021
MVRLD220 LA    WORK1,OTRLDCB1          WRITE RLD RECORD 1               72280021
         L     WORK4,SAVE+16           RESTORE NEXT TXTCB ADDR FOR      72360021
*                                            WRTCRRLD CHECK             72440021
         L     BRANCHX,ADWRTCR                                          72520021
         BALR  RETURN,BRANCHX           BRANCH TO WRITE RLD RECORD      72600021
         NC    1(1,CURTXTCB),1(WORK1)    TAKE CR REC OFF TXTCB          72680021
         B     MVRLD00                  RETURN TO CONTINUE MOVES        72760021
*                                                                       72840021
MVRLD230 L     WORK1,SAVE+32           ADDR OF PREV. CONTROL RECORD CB  72920021
         OI    0(CURTXTCB),LASTXT       SET LAST TEXT IN GROUP          73000021
         L     WORK2,SAVE+16            NEXT TEXT CONTROL BLOCK         73080021
         TM    0(WORK2),INUSE           HAS SOME TEXT BEEN READ AHEAD   73160021
         BO    MVRLD250                 YES                             73240021
         XC    GROUPLNG(2),GROUPLNG    CLEAR GROUP LENGTH               73320021
MVRLD240 L     BRANCHX,ADWRTCR                                          73400021
         L     WORK4,SAVE+16           RESTORE NEXT TXTCB ADDR FOR      73480021
*                                            WRTCRRLD CHECK             73560021
         BALR  RETURN,BRANCHX           BRANCH TO WRITE PREV CTRL. REC. 73640021
         NC    1(1,CURTXTCB),1(WORK1)    TAKE CR REC OFF TXTCB          73720021
         B     MVRLD00                  RETURN TO CONTINUE MOVES        73800021
MVRLD250 TM    0(WORK2),BEINGWT         IS IT BEING WRITTEN             73880021
         BO    MVRLD240                 YES                             73960021
         OI    0(WORK2),FIRSTXT         SET 1ST TEXT IN GROUP INDIC.    74040021
         MVC   26(2,WORK2),24(WORK2)   CORRECT GROUP LENGTH             74120021
         L     WORK0,8(WORK2)                                           74200021
         SH    WORK0,24(WORK2)                                          74280021
         ST    WORK0,4(WORK2)          UPDATE BEG OF TEXT               74360021
         ST    WORK0,PREVBEG           UPDATE BEG. ADDR OF TEXT GROUP   74440021
         MVC   29(3,WORK2),CCWDISP+1   UPDATE CCW DISP                  74520021
         MVC   GROUPLNG(2),24(WORK2)   UPDATE LNG FOR GROUPING          74600021
         B     MVRLD240                                                 74680021
MVRLD260 TM    0(CURTXTCB),TESTWRT      HAS TEXT BEEN WRITTEN YET       74760021
         BC    11,MVRLD220              YES, GO TO WRITE RLD RECORD     74840021
         L     BRANCHX,ADWRTTXT                                         74920021
         BALR  RETURN,BRANCHX           BRANCH TO WRITE TEXT            75000021
         B     MVRLD220                                                 75080021
*                                                                     * 75160021
*                        ERROR  ROUTINES                              * 75240021
*                                                                     * 75320021
ERROR01  OI    BITMAP+7,HEX1      SET INVALID TWO BYTE ADCON            75400021
         B     RELOC120                 RETURN TO PROCESS NEXT ADCON    75480021
ERROR02A OI    VCONSW,LEN3        TURN ON 3-BYTE VCON SWITCH     A48242 75530000
         B     RETRN              AND CONTINUE PROCESSING        A48242 75532000
ERROR02B NI    VCONSW,LN3OFF      TURN OFF 3-BYTE VCON SWITCH    A48242 75540000
ERROR02  OI    BITMAP+7,HEX2      SET INVALID VCON IN OVERLAY           75560021
         B     RELOC120                 RETURN TO PROCESS NEXT ADCON    75640021
ERROR    L     BRANCH,ERDIG                                             75720021
         LR    WORK0,RETURN             ERROR CODE                      75800021
         BR    BRANCH                   GO TO ERROR DIAGNOSTICS ROUTINE 75880021
***    *     *     *    *    *    *    *    *    *    *    *    *   *** 75960021
*                                                                     * 76040021
*              ENTAB AND ENTAB/RLD CREATION ROUTINE                   * 76120021
*                                                                     * 76200021
***    *     *     *    *    *    *    *    *    *    *    *    *   *** 76280021
SCDENTAB EQU   *                                                        76360021
         ST    RETURN,SAVERET                                           76440021
         L     WORK2,CURENTAB           HESD ADDR.OF CURRENT ENTAB      76520021
         LR    WORK3,WORK2                                              76600021
         S     WORK2,HESD                                               76680021
         SRL   WORK2,3                                                  76760021
         STH   WORK2,CURID              CALC. ENTAB ID                  76840021
*                                                                     * 76920021
*   MAKE ID-LENGTH LIST ENTRY FOR ENTAB, THEN WRITE THE CONTROL       * 77000021
*   RECORD.  THERE IS ALWAYS ROOM FOR THE ENTAB ID-LENGTH, BECAUSE    * 77080021
*           4 BYTES ARE LEFT IN EVERY RLD RECORD                      * 77160021
*                                                                     * 77240021
         TM    0(PREVCREC),INUSE       DOES PREV CR CONTAIN RLDS        77320021
         BO    SCDENT10                YES                              77400021
         MVC   4(4,PREVCREC),8(PREVCREC) INIT 1ST FREE ADDR             77480021
         OI    0(PREVCREC),INUSE                                        77560021
         L     WORK2,8(PREVCREC)       BEG. OF BUFFER                   77640021
         XC    0(16,WORK2),0(WORK2)    CLEAR THE CONTROL INFOR          77720021
SCDENT10 L     WORK2,4(PREVCREC)        1ST FREE ADDR IN PREV. CR       77800021
         MVC   16(2,WORK2),CURID        MAKE ID-LENGTH LIST ENTRY IN    77880021
         MVC   18(2,WORK2),6(WORK3)          PREV. CR.                  77960021
         MVI   3(PREVCREC),X'04'        ID-LENGTH =4                    78040021
         L     WORK2,8(PREVCREC)                                        78120021
         OI    0(WORK2),TXT             SET TEXT FOLLOWS IN CR          78200021
         MVC   26(2,CURTXTCB),6(WORK3)  LENGTH OF ENTAB TO CB           78280021
         MVC   9(3,WORK2),1(WORK3)      MOVE LKA TO CR                  78360021
         MVC   LKAENTAB+1(3),1(WORK3)  GET LKA ADDR                     78440021
         OI    8(WORK2),X'06'                                           78520021
         MVC   14(2,WORK2),6(WORK3)     ENTAB LENGTH TO CR              78600021
         OI    12(WORK2),X'40'                                          78680021
         LR    WORK1,PREVCREC                                           78760021
         L     BRANCHX,ADWRTCR                                          78840021
         BALR  RETURN,BRANCHX           GO TO WRITE PREV CTRL REC       78920021
         NC    1(1,CURTXTCB),1(PREVCREC) TAKE CR REC OFF TXTCB          79000021
*                                                                     * 79080021
*         CREATE ENTAB AND WRITE IT                                   * 79160021
*                                                                     * 79240021
         L     WORK1,TXTBFBEG           BEGINNING OF TEXT BUFFER        79320021
         ST    WORK1,4(CURTXTCB)        BEG.OF TEXT IN CB               79400021
         LH    WORK0,26(CURTXTCB)       LENGTH OF ENTAB                 79480021
         SH    WORK0,TWELVE             INIT.  DISP.                    79560021
         L     WORK3,SELST              START OF ENTRY LIST             79640021
SCDENT15 MVC   0(2,WORK1),BRINST        SET IN 1ST 2 BYTES OF ENTAB     79720021
         STH   WORK0,2(WORK1)           SET IN DISP.                    79800021
SCDENT20 CLC   CURSEG+1(1),2(WORK3)     SEARCH ENTRY LIST FOR CUR.SEG.  79880021
         BNE   SCDNT25A                NOT FOUND                        79960021
SCDENT25 LH    WORK2,0(WORK3)                                           80040021
         SLL   WORK2,3                                                  80120021
         A     WORK2,HESD                                               80200021
         XC    4(8,WORK1),4(WORK1)                                      80280021
         MVC   5(4,WORK1),1(WORK2)      MOVE ADDR. AND SEG.NO.TO ENTAB  80360021
         LA    WORK1,12(WORK1)          INCR.TO NEXT LINE IN ENTAB      80440021
         SH    WORK0,TWELVE             DECR. DISP                      80520021
         BZ    SCDENT30                 BRANCH WHEN OFFSET =0           80600021
SCDNT25A LH    WORK2,ENELTC            NO. ENTS IN ENTRY LIST           80680021
         MH    WORK2,SIX               MULTIPLY BY 6                    80760021
         A     WORK2,SELST             ADD TO LIST BEG ADDR             80840021
         LA    WORK3,6(WORK3)          INCR TO NEXT LIST ENTRY          80920021
         CR    WORK3,WORK2             SEARCHED THRU WHOLE LIST?        81000021
         BNL   SCDENT31                YES                              81080021
         B     SCDENT15                                                 81160021
SCDENT31 LA    WORK1,12(WORK1)         UPDATE ENTAB ENTRY ADDR          81240021
         SH    WORK0,TWELVE            END OF ENTAB?                    81320021
         BZ    SCDENT30                YES-GO TO CREATE LST LINE        81400021
         B     SCDENT31                NO-BRANCH BACK                   81480021
SCDENT30 ST    WORK1,8(CURTXTCB)        LAST ENTRY ADDR.                81560021
         MVC   0(8,WORK1),SVCLINE       SET UP LAST LINE OF ENTAB       81640021
         LH    WORK3,ENSPX              GET SEGTAB ID                   81720021
         SLL   WORK3,3                                                  81800021
         A     WORK3,HESD                                               81880021
         MVC   9(3,WORK1),1(WORK3)      MOVE SEGTAB ADDR TO ENTAB       81960021
         MVC   8(1,WORK1),CURSEG+1      CURRENT SEG.NO. TO ENTAB        82040021
         NI    1(CURTXTCB),X'00'        CLEAR FLAG BITS OF TXTCB        82120021
         L     BRANCHX,ADWRTTXT                                         82200021
         BALR  RETURN,BRANCHX           BRANCH TO WRITE ENTAB           82280021
*                                                                     * 82360021
*    CREATE ENTAB RLDS IN OUTPUT BUFFER AND WRITE THEM OUT            * 82440021
*                                                                     * 82520021
         LA    PREVCREC,OTRLDCB1        USE BFR1 AND BFR2               82600021
         LA    WORK3,OTRLDCB2                                           82680021
         L     WORK1,LKAENTAB           ADDR. OF BEG.OF ENTAB           82760021
         LA    WORK1,4(WORK1)           INCR. TO FIRST LKA              82840021
         LH    WORK0,26(CURTXTCB)                                       82920021
         A     WORK0,LKAENTAB                                           83000021
         SH    WORK0,TWELVE             ADDR.OF LAST ENTRY IN ENTAB     83080021
SCDENT50 L     WORK2,8(PREVCREC)        ADDR. OF RLD BFR.BEG.           83160021
         OI    0(PREVCREC),INUSE       MARK RLD CTRL BLK IN USE         83240021
         XC    0(16,WORK2),0(WORK2)     CLEAR CTRL.REC.                 83320021
         MVC   4(4,PREVCREC),8(PREVCREC)                                83400021
         OI    0(WORK2),RLD             SET RLDS PRESENT INDIC.         83480021
         XC    16(2,WORK2),16(WORK2)    SET R PTR.TO ZERO               83560021
         MVC   18(2,WORK2),CURID        SET P PTR = ENTAB ID            83640021
SCDENT60 LA    WORK2,4(WORK2)           UPDATE 1ST FREE ADDR.           83720021
         CL    WORK2,12(PREVCREC)       ROOM FOR 4 BYTES IN BUFFER      83800021
         BNL   SCDENT80                 NO                              83880021
         ST    WORK1,16(WORK2)          MAKE RLD FA FIELD FOR ENTAB     83960021
         MVI   16(WORK2),X'1D'               ENTRY                      84040021
         LA    WORK1,12(WORK1)          UPDATE TO NEXT LKA FIELD        84120021
         CR    WORK1,WORK0              RLD FOR EACH 12 BYTES OF ENTAB  84200021
         BL    SCDENT60                 NO                              84280021
         AH    WORK1,FIVE               INCR. TO SEGTAB ADDR.           84360021
         ST    WORK1,20(WORK2)          UPDATE LAST RLD ITEM TO POINT   84440021
         MVI   20(WORK2),X'18'               TO SEGTAB ADDR.            84520021
         L     WORK1,8(PREVCREC)        BEG.OF BFR.                     84600021
         LA    WORK2,8(WORK2)          UPDATE FOR LAST 2 RLD ENTRIES    84680021
         S     WORK2,8(PREVCREC)        RLD BYTES                       84760021
         STH   WORK2,6(WORK1)           SET RLD BYTES IN CR.            84840021
         OI    0(WORK1),SEGEND          SET END OF SEG.INDIC.IN CR      84920021
         CLC   CURSEG(2),ENSPC          IS THIS LAST SEGMENT            85000021
         BNE   SCDENT70                 NO                              85080021
         OI    0(WORK1),MODEND          YES,SET END OF MOD. INDIC.IN CR 85160021
SCDENT70 LR    WORK1,PREVCREC                                           85240021
         L     BRANCHX,ADWRTCR                                          85320021
         BALR  RETURN,BRANCHX           BRANCH TO WRITE RLD RECORD      85400021
         NC    1(1,CURTXTCB),1(PREVCREC) TAKE CR REC OFF TXTCB          85480021
         L     WORK1,CURENTAB                                           85560021
         LA    WORK1,8(WORK1)           UPDATE TO NEXT ENTAB ENTRY      85640021
         ST    WORK1,CURENTAB                                           85720021
         MVC   LKAENTAB+1(4),1(WORK1)  GET LKA AND SEG NO OF NEXT ENTAB 85800021
         OI    APT3,SEGSTART           SET 1ST TEXT OF SEG INDIC        85880021
         XC    0(3,CURTXTCB),0(CURTXTCB)  CLEAR INDIC IN CURR. TXT CB   85960021
         XC    GROUPLNG(2),GROUPLNG    INIT GROUP CT. FOR NEXT SEG.     86040021
         L     RETURN,SAVERET                                           86120021
         BR    RETURN                   RETURN TO PROCESS NEXT SEGMENT  86200021
SCDENT80 S     WORK2,8(PREVCREC)        BYTES OF RLD                    86280021
         ST    WORK1,TEMPAREA          SAVE ADDR OF ADCON               86360021
         L     WORK1,8(PREVCREC)                                        86440021
         STH   WORK2,6(WORK1)           BYTES OF RLD INFO IN CR         86520021
         LR    WORK1,PREVCREC                                           86600021
         L     BRANCHX,ADWRTCR                                          86680021
         BALR  RETURN,BRANCHX           BRANCH TO WRITE AN RLD RECORD   86760021
         NC    1(1,CURTXTCB),1(PREVCREC) TAKE CR REC OFF TXTCB          86840021
         XR    PREVCREC,WORK3           SWITCH BUFFERS                  86920021
         XR    WORK3,PREVCREC                                           87000021
         XR    PREVCREC,WORK3                                           87080021
         L     WORK1,TEMPAREA          RESTORE ADDRESS OF ADCON         87160021
         B     SCDENT50                                                 87240021
MOVE     MVC   0(1,WORK1),0(WORK3)                                      87320021
*                     ******************                                87400021
         DS    0F                                                       87480021
TXTCB1   EQU   *                   TEXT CONTROL BLOCK                   87560021
         DC    F'0'                FLAGS                                87640021
         DC    F'0'                BEGINNING ADDRESS OF TEXT IN BUFFER  87720021
         DC    F'0'                END ADDRESS OF TEXT IN BUFFER        87800021
         DC    F'0'                ADDRESS OF TXTIOT ENTRY MARKING THE  87880021
*                                       BEGINNING OF THE TEXT GROUPING  87960021
         DC    F'0'                ADDRESS OF TXTIOT ENTRY FOR TEXT     88040021
*                                       BEING PROCESSED                 88120021
         DC    F'0'                ADDRESS OF TXTIOT ENTRY MARKING THE  88200021
*                                       END OF THE TEXT GROUPING        88280021
         DC    H'0'                LENGTH OF CURRENT TEXT               88360021
           DC    H'0'                ACCUMULATED TEXT LENGTH            88440021
         DC    F'0'                    CCW DISPLACEMENT                 88520021
TXTCB2   EQU   *                   TEXT CONTROL BLOCK                   88600021
         DC    F'0'                FLAGS                                88680021
         DC    F'0'                BEGINNING ADDRESS OF TEXT IN BUFFER  88760021
         DC    F'0'                END ADDRESS OF TEXT IN BUFFER        88840021
         DC    F'0'                ADDRESS OF TXTIOT ENTRY MARKING THE  88920021
*                                       BEGINNING OF THE TEXT GROUPING  89000021
         DC    F'0'                ADDRESS OF TXTIOT ENTRY FOR TEXT     89080021
*                                       BEING PROCESSED                 89160021
         DC    F'0'                ADDRESS OF TXTIOT ENTRY MARKING THE  89240021
*                                       END OF THE TEXT GROUPING        89320021
         DC    H'0'                LENGTH OF CURRENT TEXT               89400021
         DC    H'0'                ACCUMULATED TEXT LENGTH              89480021
         DC    F'0'                    CCW DISPLACEMENT                 89560021
OTRLDCB1 EQU   *                   RLD OUTPUT CONTROL BLOCK             89640021
         DC    X'00DB'                                                  89720021
         DC    H'0'                BYTES OF ID-LENGTH LIST              89800021
         DC    F'0'                ADDRESS OF 1ST FREE ADDR. IN BUFFER  89880021
         DC    F'0'                ADDRESS OF BEGINNING OF BUFFER       89960021
         DC    F'0'                ADDRESS OF END OF BUFFER             90040021
OTRLDCB2 EQU   *                   RLD OUTPUT CONTROL BLOCK             90120021
         DC    X'00ED'                                                  90200021
         DC    H'0'                                                     90280021
         DC    F'0'                                                     90360021
         DC    F'0'                                                     90440021
         DC    F'0'                                                     90520021
OTRLDCB3 EQU   *                   RLD  OUTPUT CONTROL BLOCK            90600021
         DC    X'00F6'                                                  90680021
         DC    H'0'                                                     90760021
         DC    F'0'                                                     90840021
         DC    F'0'                                                     90920021
         DC    F'0'                                                     91000021
INRLDCB1 EQU   *                   RLD INPUT CONTROL BLOCK              91080021
         DS    1X                  FLAGS                                91160021
         DS    3X                  LOWEST RLD ADDRESS OF UNPROCESSED    91240021
*                                       RLD'S IN RLD SET                91320021
         DC    F'0'                ADDRESS OF BEGINNING OF BUFFER       91400021
         DC    F'0'                ADDRESS OF RLDION ENTRY MARKING THE  91480021
*                                       BEGINNING OF RLD GROUPING       91560021
         DC    F'0'                ADDRESS OF CURRENT RLDION ENTRY      91640021
*                                       BEING PROCESSED                 91720021
         DC    F'0'                ADDRESS OF RLDION ENTRY MARKING THE  91800021
*                                       END OF THE RLD GROUPING         91880021
INRLDCB2 EQU   *                   RLD INPUT CONTROL BLOCK              91960021
         DS    1X                                                       92040021
         DS    3X                                                       92120021
         DC    F'0'                                                     92200021
         DC    F'0'                                                     92280021
         DC    F'0'                                                     92360021
         DC    F'0'                                                     92440021
*                   SAVE AREAS                                          92520021
LENGTH   DS    1H                       LENGTH OF ADCON-1               92600021
DLNKR    DS    1H                       DELINK R SAVED                  92680021
RSAVE    DS    1H                       SAVE AREA FOR R PTR             92760021
RLDBYTES DS    1H                       BYTES OF RLD INFO IN RLD SET    92840021
SAVERET  DS    16F                      SAVE AREA FOR RETURN REG        92920021
MULTBEG  DS    1F                      BEG BUFFER ADDR OF MULT          93000021
MULTEND  DS    1F                      END BUFFER ADDR OF MULT          93080021
RESUMEAD DS    1F                       ADDR OF REMAINING FA'S IN CHAIN 93160021
RLDSTEND DS    1F                       RLD SET END ADDR.               93240021
BFREL    DS    1F                       BUFFER RELOCAND                 93320021
ADCON    DS    1F                       ADCON MOVED HERE FOR ALIGNMENT  93400021
TXTBEG   DS    1F                      BEGINNING OF TXT FOR CURR ID     93480021
PREVRPAD DS    1F                      ADDR  OF LAST R + P PTR.         93560021
SAVE13   DS    1F                      TEMPORARY SAVE AREA FOR REG. 13  93640021
TEMPAREA DS    1F                       TEMP SAVE AREA                  93720021
ADCONADR DS    1F                      TEXT BUFFER ADDR OF ADCON        93800021
RELADCON DS    1F                       BEGIN ADDR OF RELOCATE ADCON    93880021
SAVEBFCB DS    1F                      PREV RLD BUFFER CB SAVE AREA     93960021
DLNKSAVE DC    F'0'                    SAVE DELINK VALUE                94040021
INPUTADR DS    1F                      ADDR OF CSECT ON INPUT           94120021
TEMP     DS    1H                      TEMPORARY SAVE AREA              94200021
*                                         IN WORK AREA                  94280021
SAVE     DS    18F                      SAVE AREA FOR HEWLFREL          94360021
*                   CONSTANT AREAS                                      94440021
SIXFULL  DC    F'6'                                                     94520021
OF       DC    X'00FFFFFF'             SET FLAGS & RLD ADDR IN RLD CB   94600021
FF       DC    X'FFFFFF'                COMPARE FOR UPDATE MULTIPLICITY 94680021
VCONSW   DC    X'00'                   VCON LENGTH SWITCH        A48242 94730000
LEN3     EQU   X'80'                   VCON LENGTH = 3 BYTES     A48242 94740000
LN3OFF   EQU   X'7F'                   TO TURN OF LEN3 BIT       A48242 94750000
THREE    DC    H'3'                                                     94760021
FOUR     DC    H'4'                                                     94840021
FIVE     DC    H'5'                                                     94920021
SIX      DC    H'6'                    DECIMAL 6                        95000021
SEVEN    DC    H'7'                                                     95080021
EIGHT    DC    H'8'                                                     95160021
TWELVE   DC    H'12'                                                    95240021
CON256   DC    H'256'                                                   95320021
BRINST   BC    15,0(15)                                                 95400021
SVCLINE  SVC   45                                                       95480021
         L     15,4(15)                                                 95560021
         BCR   15,15                                                    95640021
ADWRTTXT DC    V(WRTTXT)                WRITE TEXT ROUTINE              95720021
ADWRTCR  DC    V(WRTCRRLD)              WRITE CR/RLD ROUTINE            95800021
ADCHKWRT DC    V(CHECKWRT)              ADDR. OF CHECK ROUTINE(WRITE)   95880021
ADCHKRD  DC    V(CHECKRD)               ADDR. OF CHECK ROUTINE(READ)    95960021
ADGET    DC    V(GETIDMUL)              ADDR OF LOOKAHEAD/READAHEAD     96040021
PATCH    DS    25F     ********PATCH AREA   **************************  96120021
         HEWAPT                                                         96200021
CURENTAB EQU   IOCT                     HESD ADDR.OF NEXT ENTAB ENTRY   96280021
LKAENTAB EQU   IOCT+4                   ENTAB LKA                       96360021
GROUPLNG EQU   IOCT+10                  ACCUMULATED GROUP LENGTH        96440021
CCWDISP  EQU   IOCT+12                 CCW DISP ACEMENT                 96520021
SPLITADR EQU   IOCT+16                  SPLIT RLD ADDR.IN INPUT BUFFER  96600021
CBTOUSE  EQU   IOCT+20                  CTRL.BLK.ADDR.FOR BFR.WITH      96680021
*                                            SPLIT RLD                  96760021
CURSEG   EQU   EPSM                     CURRENT SEGMENT                 96840021
RPPTRS   EQU   EPSM+2                   SAVED R PTR.FOR CHAINING        96920021
CURID    EQU   EPSM+4                   CURREND ID                      97000021
CURMULT  EQU   EPSM+6                   CURRENT MULTIPLICITY            97080021
SRCHBEG  EQU   SPACES+56               WHERE TO RESUME SEARCH OF        97160021
*                                           TXTIOT FOR NEW ID           97240021
CURENTRY EQU   SPACES+60           FIRST FREE ENTRY IN ENTRY LIST       97320021
FREEADDR EQU   SPACES+64               FIRST FREE ADDR IN TEXT BUFFER   97400021
PREVBEG  EQU   SPACES+68               ADDR OF 1ST TEXT OF GROUP        97480021
         END                                                            97560021
