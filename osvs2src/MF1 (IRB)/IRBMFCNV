         TITLE '*/* IRBMFCNV - BINARY TO CHARACTER CONVERSION MODULE   *00001000
                       '                                                00002000
IRBMFCNV CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(16)                                             0001 00007000
         DC    C'IRBMFCNV  74.087'                                 0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @12,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@12                                         0001 00013000
         L     @00,@SIZDATD                                        0001 00014000
         GETMAIN R,LV=(0)                                               00015000
         LR    @11,@01                                             0001 00016000
         USING @DATD,@11                                           0001 00017000
         ST    @13,@SA00001+4                                      0001 00018000
         LM    @00,@01,20(@13)                                     0001 00019000
         ST    @11,8(,@13)                                         0001 00020000
         LR    @13,@11                                             0001 00021000
         MVC   @PC00001(28),0(@01)                                 0001 00022000
*                                                                  0006 00023000
*/* BEGIN GENERAL INITIALIZATION                                     */ 00024000
*                                                                  0006 00025000
*   IF CNFLOAT='1'B THEN                                           0006 00026000
         L     @10,@PC00001+24                                     0006 00027000
         TM    CNFLOAT(@10),B'10000000'                            0006 00028000
         BNO   @RF00006                                            0006 00029000
*     CNIFLOAT='1'B;                /* INITIALIZE TEMPORARY VARIABLE */ 00030000
         OI    CNIFLOAT,B'10000000'                                0007 00031000
*   ELSE                                                           0008 00032000
*     CNIFLOAT='0'B;                /* INITIALIZE TEMPORARY VARIABLE */ 00033000
         B     @RC00006                                            0008 00034000
@RF00006 NI    CNIFLOAT,B'01111111'                                0008 00035000
*   CNRETCDE=0;                     /* SET NORMAL RETURN CODE        */ 00036000
*                                                                  0009 00037000
@RC00006 SR    @10,@10                                             0009 00038000
         LR    CNRETCDE,@10                                        0009 00039000
*   /*****************************************************************/ 00040000
*   /*                                                               */ 00041000
*   /* CHECK PARAMETERS FOR VALIDITY IF NO OUTPUT STRING OR OUTPUT   */ 00042000
*   /* STRING IS TOO LONG                                            */ 00043000
*   /*                                                               */ 00044000
*   /*****************************************************************/ 00045000
*                                                                  0010 00046000
*   IF CNOUTLEN<=0|CNOUTLEN>256 THEN                               0010 00047000
         L     @04,@PC00001+12                                     0010 00048000
         L     @04,CNOUTLEN(,@04)                                  0010 00049000
         CR    @04,@10                                             0010 00050000
         BNH   @RT00010                                            0010 00051000
         CH    @04,@CH00056                                        0010 00052000
         BNH   @RF00010                                            0010 00053000
@RT00010 DS    0H                                                  0011 00054000
*     RETURN CODE(12);              /* RETURN TO REPORT GENERATOR    */ 00055000
*                                                                  0011 00056000
         L     @13,4(,@13)                                         0011 00057000
         L     @00,@SIZDATD                                        0011 00058000
         LR    @01,@11                                             0011 00059000
         FREEMAIN R,LV=(0),A=(1)                                        00060000
         LA    @15,12                                              0011 00061000
         L     @14,12(,@13)                                        0011 00062000
         LM    @00,@12,20(@13)                                     0011 00063000
         BR    @14                                                 0011 00064000
*   /*****************************************************************/ 00065000
*   /*                                                               */ 00066000
*   /* FORCE FLOATING OF RESULT IN OUTPUT STRING IF BAD OUTPUT SCALE */ 00067000
*   /* FACTOR                                                        */ 00068000
*   /*                                                               */ 00069000
*   /*****************************************************************/ 00070000
*                                                                  0012 00071000
*   IF CNOUFRAC<0|CNOUFRAC>=CNOUTLEN THEN                          0012 00072000
@RF00010 L     @10,@PC00001+16                                     0012 00073000
         L     @10,CNOUFRAC(,@10)                                  0012 00074000
         LTR   @10,@10                                             0012 00075000
         BM    @RT00012                                            0012 00076000
         L     @04,@PC00001+12                                     0012 00077000
         C     @10,CNOUTLEN(,@04)                                  0012 00078000
         BL    @RF00012                                            0012 00079000
@RT00012 DS    0H                                                  0013 00080000
*     DO;                                                          0013 00081000
*       CNIFLOAT='1'B;              /* FORCE FLOATING                */ 00082000
         OI    CNIFLOAT,B'10000000'                                0014 00083000
*       CNRETCDE=4;                 /* SET WARNING RETURN CODE       */ 00084000
         LA    CNRETCDE,4                                          0015 00085000
*     END;                                                         0016 00086000
*   IF CNINPUT<0 THEN                                              0017 00087000
@RF00012 L     @10,@PC00001                                        0017 00088000
         ICM   @04,15,CNINPUT(@10)                                 0017 00089000
         BNM   @RF00017                                            0017 00090000
*     CNMINUS=1;                    /* INDICATES MINUS SIGN REQUIRED */ 00091000
         MVC   CNMINUS(2),@CH00065                                 0018 00092000
*   ELSE                                                           0019 00093000
*     CNMINUS=0;                    /* MINUS SIGN NOT REQUIRED       */ 00094000
         B     @RC00017                                            0019 00095000
@RF00017 SR    @10,@10                                             0019 00096000
         STH   @10,CNMINUS                                         0019 00097000
*   IF CNCOMMAS='1'B THEN                                          0020 00098000
@RC00017 L     @10,@PC00001+20                                     0020 00099000
         TM    CNCOMMAS(@10),B'10000000'                           0020 00100000
         BNO   @RF00020                                            0020 00101000
*     CNSSIGCM='1'B;                /* INITIALIZE TEMPORARY VARIABLE */ 00102000
         OI    CNSSIGCM,B'10000000'                                0021 00103000
*   ELSE                                                           0022 00104000
*     CNSSIGCM='0'B;                /* INITIALIZE TEMPORARY VARIABLE */ 00105000
         B     @RC00020                                            0022 00106000
@RF00020 NI    CNSSIGCM,B'01111111'                                0022 00107000
*   CNSFRAZR='0'B;                  /* DONT SUPPRESS LEADING ZERO ON    00108000
*                                      ALL FRACTIONAL NUMBERS        */ 00109000
@RC00020 NI    CNSFRAZR,B'01111111'                                0023 00110000
*                                                                  0024 00111000
*/* BEGIN MAINLINE PROCESSING                                        */ 00112000
*                                                                  0024 00113000
*   /*****************************************************************/ 00114000
*   /*                                                               */ 00115000
*   /* SET UP INTERNAL VARIABLES TO REPRESENT IDEAL CONVERTED STRING */ 00116000
*   /*                                                               */ 00117000
*   /*****************************************************************/ 00118000
*                                                                  0024 00119000
*   IF CNINPUT=0 THEN               /* ZERO IS A SPECIAL CASE        */ 00120000
         SR    @10,@10                                             0024 00121000
         L     @04,@PC00001                                        0024 00122000
         C     @10,CNINPUT(,@04)                                   0024 00123000
         BNE   @RF00024                                            0024 00124000
*     DO;                                                          0025 00125000
*       CNSIGNFC=0;                 /* NO COMMAS REQUIRED            */ 00126000
         LR    CNSIGNFC,@10                                        0026 00127000
*       CNSSIGCM='0'B;              /* NO COMMAS REQUIRED            */ 00128000
         NI    CNSSIGCM,B'01111111'                                0027 00129000
*       CNSIGNF=0;                  /* NO CONVERTED SIGNIFICANT    0028 00130000
*                                      DIGITS                        */ 00131000
         LR    CNSIGNF,@10                                         0028 00132000
*       CNSIGZER=0;                 /* NO SIGNIFICANT TRAILING ZEROS */ 00133000
         LR    CNSIGZER,@10                                        0029 00134000
*       CNLEADZ=1;                  /* INDICATES THAT A LEADING ZERO    00135000
*                                      IS REQUIRED BEFORE THE DEC. 0030 00136000
*                                      POINT.                        */ 00137000
         LA    CNLEADZ,1                                           0030 00138000
*       CNFRAZER=0;                 /* NO FRACTIONAL LEADING ZEROS 0031 00139000
*                                      REQUIRED                      */ 00140000
         LR    CNFRAZER,@10                                        0031 00141000
*       CNFRAC=0;                   /* NO CONVERTED FRACTIONAL DIGITS*/ 00142000
         STH   @10,CNFRAC                                          0032 00143000
*     END;                                                         0033 00144000
*   ELSE                            /* INPUT VALUE IS NON-ZERO.    0034 00145000
*                                      CONVERSION IS NECESSARY       */ 00146000
*     DO;                                                          0034 00147000
         B     @RC00024                                            0034 00148000
@RF00024 DS    0H                                                  0035 00149000
*       CVD(CNINPUT,CNPAKSTR);      /* CONVERT BINARY INPUT VALUE TO    00150000
*                                      PACKED DECIMAL FORMAT         */ 00151000
         L     @10,@PC00001                                        0035 00152000
         L     @10,CNINPUT(,@10)                                   0035 00153000
         CVD   @10,CNPAKSTR                                        0035 00154000
*       UNPK(CNWRKSTR,CNPAKSTR);    /* UNPACK                        */ 00155000
*                                                                  0036 00156000
         UNPK  CNWRKSTR(16),CNPAKSTR(8)                            0036 00157000
*       /*************************************************************/ 00158000
*       /*                                                           */ 00159000
*       /* CHANGE SIGN FIELD TO ZONE PATTERN                         */ 00160000
*       /*                                                           */ 00161000
*       /*************************************************************/ 00162000
*                                                                  0037 00163000
*       CNWRKSTR(LENGTH(CNWRKSTR))=CNWRKSTR(LENGTH(CNWRKSTR))|'F0'X;    00164000
*                                                                  0037 00165000
         OI    CNWRKSTR+15,X'F0'                                   0037 00166000
*       /*************************************************************/ 00167000
*       /*                                                           */ 00168000
*       /* ISOLATE SIGNIFICANT DIGITS BY STEPPING OVER LEADING ZEROS */ 00169000
*       /*                                                           */ 00170000
*       /*************************************************************/ 00171000
*                                                                  0038 00172000
*       DO CNLOOPV=1 BY 1 WHILE(CNWRKSTR(CNLOOPV)='F0'X);          0038 00173000
         LA    CNLOOPV,1                                           0038 00174000
         B     @DE00038                                            0038 00175000
@DL00038 DS    0H                                                  0039 00176000
*       END;                                                       0039 00177000
*                                                                  0039 00178000
         AH    CNLOOPV,@CH00065                                    0039 00179000
@DE00038 LA    @10,CNWRKSTR-1(CNLOOPV)                             0039 00180000
         CLI   0(@10),X'F0'                                        0039 00181000
         BE    @DL00038                                            0039 00182000
*       /*************************************************************/ 00183000
*       /*                                                           */ 00184000
*       /* CNLOOPV NOW POINTS TO FIRST NON-ZERO CHARACTER. SET UP    */ 00185000
*       /* INTERNAL VARIABLES TO DESCRIBE REQUIRED SEGMENTS OF THE   */ 00186000
*       /* OUTPUT VARIABLE                                           */ 00187000
*       /*                                                           */ 00188000
*       /*************************************************************/ 00189000
*                                                                  0040 00190000
*       IF CNINSCAL>=0 THEN         /* ALL DIGITS ARE SIGNIFICANT    */ 00191000
         SR    @10,@10                                             0040 00192000
         L     @04,@PC00001+4                                      0040 00193000
         L     @04,CNINSCAL(,@04)                                  0040 00194000
         CR    @04,@10                                             0040 00195000
         BL    @RF00040                                            0040 00196000
*         DO;                                                      0041 00197000
*                                                                  0041 00198000
*           /*********************************************************/ 00199000
*           /*                                                       */ 00200000
*           /* SAVE SIGNIFICANT DIGITS                               */ 00201000
*           /*                                                       */ 00202000
*           /*********************************************************/ 00203000
*                                                                  0042 00204000
*           CNSIGDIG=CNWRKSTR(CNLOOPV:LENGTH(CNWRKSTR));           0042 00205000
         MVI   CNSIGDIG+1,C' '                                     0042 00206000
         MVC   CNSIGDIG+2(8),CNSIGDIG+1                            0042 00207000
         LA    @09,16                                              0042 00208000
         SR    @09,CNLOOPV                                         0042 00209000
         LA    @07,CNWRKSTR-1(CNLOOPV)                             0042 00210000
         EX    @09,@SM00144                                        0042 00211000
*           CNSIGNF=LENGTH(CNWRKSTR)-CNLOOPV+1;/* REMEMBER NUMBER OF    00212000
*                                      SIGNIFICANT DIGITS            */ 00213000
         AH    @09,@CH00065                                        0043 00214000
         LR    CNSIGNF,@09                                         0043 00215000
*           CNLEADZ=0;              /* NO LEADING ZERO               */ 00216000
         LR    CNLEADZ,@10                                         0044 00217000
*           CNSIGZER=CNINSCAL;      /* TRAILING ZEROS REQUIRED IF  0045 00218000
*                                      SCALE>0. NUMBER OF TRAILING 0045 00219000
*                                      SIGNIFICANT ZEROS IS EQUAL TO    00220000
*                                      SCALE FACTOR                  */ 00221000
*                                                                  0045 00222000
         L     @09,@PC00001+4                                      0045 00223000
         L     @09,CNINSCAL(,@09)                                  0045 00224000
         LR    CNSIGZER,@09                                        0045 00225000
*           /*********************************************************/ 00226000
*           /*                                                       */ 00227000
*           /* ESTABLISH NUMBER OF COMMAS NEEDED BEFORE DECIMAL POINT*/ 00228000
*           /*                                                       */ 00229000
*           /*********************************************************/ 00230000
*                                                                  0046 00231000
*           IF(CNSIGNF+CNSIGZER)<=3 THEN                           0046 00232000
         LR    @09,CNSIGNF                                         0046 00233000
         AR    @09,CNSIGZER                                        0046 00234000
         CH    @09,@CH00098                                        0046 00235000
         BH    @RF00046                                            0046 00236000
*             CNSIGNFC=0;           /* NO COMMAS NEEDED              */ 00237000
         LR    CNSIGNFC,@10                                        0047 00238000
*           ELSE                                                   0048 00239000
*             DO;                                                  0048 00240000
         B     @RC00046                                            0048 00241000
@RF00046 DS    0H                                                  0049 00242000
*               CNSIGNFC=(CNSIGNF+CNSIGZER)/3;                     0049 00243000
*                                                                  0049 00244000
         LA    @10,3                                               0049 00245000
         LR    @09,CNSIGNF                                         0049 00246000
         AR    @09,CNSIGZER                                        0049 00247000
         LR    @00,@09                                             0049 00248000
         SRDA  @00,32                                              0049 00249000
         DR    @00,@10                                             0049 00250000
         LR    CNSIGNFC,@01                                        0049 00251000
*               /*****************************************************/ 00252000
*               /*                                                   */ 00253000
*               /* IF EVEN MULTIPLE OF 3, ONE LESS COMMA IS REQUIRED */ 00254000
*               /*                                                   */ 00255000
*               /*****************************************************/ 00256000
*                                                                  0050 00257000
*               IF(CNSIGNF+CNSIGZER)//3=0 THEN                     0050 00258000
         LR    @00,@09                                             0050 00259000
         SRDA  @00,32                                              0050 00260000
         DR    @00,@10                                             0050 00261000
         LTR   @00,@00                                             0050 00262000
         BNZ   @RF00050                                            0050 00263000
*                 CNSIGNFC=CNSIGNFC-1;                             0051 00264000
         BCTR  CNSIGNFC,0                                          0051 00265000
*             END;                                                 0052 00266000
@RF00050 DS    0H                                                  0053 00267000
*           CNFRAZER=0;             /* NO LEADING FRACTIONAL ZEROS   */ 00268000
@RC00046 SR    @10,@10                                             0053 00269000
         LR    CNFRAZER,@10                                        0053 00270000
*           CNFRAC=0;               /* NO CONVERTED FRACTIONAL DIGITS*/ 00271000
         STH   @10,CNFRAC                                          0054 00272000
*           GO TO CNLAB1;           /* PUT STRING IN OUTPUT FIELD    */ 00273000
         B     CNLAB1                                              0055 00274000
*         END;                                                     0056 00275000
*       IF CNINSCAL<(-(LENGTH(CNWRKSTR)-CNLOOPV))THEN/* ALL DIGITS 0057 00276000
*                                      CONVERTED ARE FRACTIONAL      */ 00277000
@RF00040 L     @10,@PC00001+4                                      0057 00278000
         L     @10,CNINSCAL(,@10)                                  0057 00279000
         LA    @04,16                                              0057 00280000
         SR    @04,CNLOOPV                                         0057 00281000
         LR    @03,@04                                             0057 00282000
         LCR   @03,@03                                             0057 00283000
         CR    @10,@03                                             0057 00284000
         BNL   @RF00057                                            0057 00285000
*         DO;                                                      0058 00286000
         ST    @04,@TF00001                                        0058 00287000
*           CNSIGNF=0;              /* NO SIGNIFICANT CONVERTED    0059 00288000
*                                      DIGITS                        */ 00289000
         SR    @07,@07                                             0059 00290000
         LR    CNSIGNF,@07                                         0059 00291000
*           CNSIGZER=0;             /* NO SIGNIFICANT TRAILING ZEROS */ 00292000
         LR    CNSIGZER,@07                                        0060 00293000
*           CNLEADZ=1;              /* ONE SIGNIFICANT ZERO IS     0061 00294000
*                                      REQUIRED                      */ 00295000
         LA    @15,1                                               0061 00296000
         LR    CNLEADZ,@15                                         0061 00297000
*           CNSIGNFC=0;             /* NO COMMAS REQUIRED            */ 00298000
         LR    CNSIGNFC,@07                                        0062 00299000
*           CNSSIGCM='0'B;          /* NO COMMAS REQUIRED            */ 00300000
         NI    CNSSIGCM,B'01111111'                                0063 00301000
*           CNFRAZER=-CNINSCAL-(LENGTH(CNWRKSTR)-CNLOOPV+1);/* SET 0064 00302000
*                                      NUMBER OF ZEROS TRAILING    0064 00303000
*                                      DECIMAL POINT AND LEADING   0064 00304000
*                                      CONVERTED FRACTIONAL DIGITS   */ 00305000
         LR    CNFRAZER,@10                                        0064 00306000
         LCR   CNFRAZER,CNFRAZER                                   0064 00307000
         A     @15,@TF00001                                        0064 00308000
         SR    CNFRAZER,@15                                        0064 00309000
*           CNFRADIG=CNWRKSTR(CNLOOPV:LENGTH(CNWRKSTR));/* REMEMBER     00310000
*                                      FRACTIONAL DIGITS ACTUALLY  0065 00311000
*                                      CONVERTED                     */ 00312000
         MVI   CNFRADIG+1,C' '                                     0065 00313000
         MVC   CNFRADIG+2(8),CNFRADIG+1                            0065 00314000
         LA    @10,CNWRKSTR-1(CNLOOPV)                             0065 00315000
         L     @07,@TF00001                                        0065 00316000
         EX    @07,@SM00146                                        0065 00317000
*           CNFRAC=LENGTH(CNWRKSTR)-CNLOOPV+1;/* LENGTH OF FRACTIONAL   00318000
*                                      DIGITS                        */ 00319000
         STH   @15,CNFRAC                                          0066 00320000
*         END;                                                     0067 00321000
*       ELSE                        /* CONVERTED DIGITS ARE PART   0068 00322000
*                                      SIGNIFICANT AND PART        0068 00323000
*                                      FRACTIONAL                    */ 00324000
*         DO;                                                      0068 00325000
         B     @RC00057                                            0068 00326000
@RF00057 DS    0H                                                  0069 00327000
*           CNSIGNF=LENGTH(CNWRKSTR)+CNINSCAL-CNLOOPV+1;/* LENGTH OF    00328000
*                                      SIGNIFICANT DIGITS            */ 00329000
         LA    @10,16                                              0069 00330000
         L     @03,@PC00001+4                                      0069 00331000
         L     @03,CNINSCAL(,@03)                                  0069 00332000
         LR    CNSIGNF,@03                                         0069 00333000
         AR    CNSIGNF,@10                                         0069 00334000
         SR    CNSIGNF,CNLOOPV                                     0069 00335000
         AH    CNSIGNF,@CH00065                                    0069 00336000
*           CNSIGDIG=CNWRKSTR(CNLOOPV:LENGTH(CNWRKSTR)+CNINSCAL);/*     00337000
*                                      REMEMBER SIGNIFICANT DIGITS   */ 00338000
*                                                                  0070 00339000
         MVI   CNSIGDIG+1,C' '                                     0070 00340000
         MVC   CNSIGDIG+2(8),CNSIGDIG+1                            0070 00341000
         SR    @03,CNLOOPV                                         0070 00342000
         AR    @03,@10                                             0070 00343000
         LA    @10,CNWRKSTR-1(CNLOOPV)                             0070 00344000
         EX    @03,@SM00148                                        0070 00345000
*           /*********************************************************/ 00346000
*           /*                                                       */ 00347000
*           /* ESTABLISH NUMBER OF COMMAS NEEDED BEFORE DECIMAL POINT*/ 00348000
*           /*                                                       */ 00349000
*           /*********************************************************/ 00350000
*                                                                  0071 00351000
*           IF CNSIGNF<=3 THEN                                     0071 00352000
         CH    CNSIGNF,@CH00098                                    0071 00353000
         BH    @RF00071                                            0071 00354000
*             CNSIGNFC=0;           /* NO COMMAS REQUIRED            */ 00355000
         SR    CNSIGNFC,CNSIGNFC                                   0072 00356000
*           ELSE                                                   0073 00357000
*             DO;                                                  0073 00358000
         B     @RC00071                                            0073 00359000
@RF00071 DS    0H                                                  0074 00360000
*               CNSIGNFC=CNSIGNF/3;                                0074 00361000
*                                                                  0074 00362000
         LA    @10,3                                               0074 00363000
         LR    @00,CNSIGNF                                         0074 00364000
         SRDA  @00,32                                              0074 00365000
         DR    @00,@10                                             0074 00366000
         LR    CNSIGNFC,@01                                        0074 00367000
*               /*****************************************************/ 00368000
*               /*                                                   */ 00369000
*               /* ONE LESS COMMA IS REQUIRED FOR AN EVEN MULTIPLE OF*/ 00370000
*               /* THREE                                             */ 00371000
*               /*                                                   */ 00372000
*               /*****************************************************/ 00373000
*                                                                  0075 00374000
*               IF CNSIGNF//3=0 THEN                               0075 00375000
         LR    @00,CNSIGNF                                         0075 00376000
         SRDA  @00,32                                              0075 00377000
         DR    @00,@10                                             0075 00378000
         LTR   @00,@00                                             0075 00379000
         BNZ   @RF00075                                            0075 00380000
*                 CNSIGNFC=CNSIGNFC-1;                             0076 00381000
         BCTR  CNSIGNFC,0                                          0076 00382000
*             END;                                                 0077 00383000
@RF00075 DS    0H                                                  0078 00384000
*           CNSIGZER=0;             /* NO TRAILING SIGNIFICANT ZEROS */ 00385000
@RC00071 SR    @10,@10                                             0078 00386000
         LR    CNSIGZER,@10                                        0078 00387000
*           CNLEADZ=0;              /* NO LEADING ZERO               */ 00388000
         LR    CNLEADZ,@10                                         0079 00389000
*           CNFRAZER=0;             /* NO LEADING FRACTIONAL ZEROS   */ 00390000
         LR    CNFRAZER,@10                                        0080 00391000
*           CNFRAC=-CNINSCAL;       /* NUMBER OF FRACTIONAL DIGITS   */ 00392000
         L     @10,@PC00001+4                                      0081 00393000
         L     @10,CNINSCAL(,@10)                                  0081 00394000
         LR    @07,@10                                             0081 00395000
         LCR   @07,@07                                             0081 00396000
         STH   @07,CNFRAC                                          0081 00397000
*           CNFRADIG=CNWRKSTR(LENGTH(CNWRKSTR)+CNINSCAL+1:LENGTH(  0082 00398000
*               CNWRKSTR));         /* REMEMBER FRACTIONAL DIGITS    */ 00399000
         MVI   CNFRADIG+1,C' '                                     0082 00400000
         MVC   CNFRADIG+2(8),CNFRADIG+1                            0082 00401000
         SR    @07,@07                                             0082 00402000
         BCTR  @07,0                                               0082 00403000
         SR    @07,@10                                             0082 00404000
         LA    @02,CNWRKSTR+16(@10)                                0082 00405000
         EX    @07,@SM00150                                        0082 00406000
*         END;                                                     0083 00407000
*     END;                                                         0084 00408000
@RC00057 DS    0H                                                  0085 00409000
*CNLAB1:                                                           0085 00410000
*                                                                  0085 00411000
*/* AT THIS POINT AN IDEAL STRING HAS BEEN CREATED WITH ALL NEEDED 0085 00412000
*   DESCRIPTION. TRY TO FIT THIS STRING INTO THE OUTPUT FIELD        */ 00413000
*                                                                  0085 00414000
*   IF CNIFLOAT^='1'B THEN          /* FLOATING OF RESULT IN THE   0085 00415000
*                                      OUTPUT STRING HAS NOT BEEN  0085 00416000
*                                      INDICATED                     */ 00417000
@RC00024 DS    0H                                                  0085 00418000
CNLAB1   TM    CNIFLOAT,B'10000000'                                0085 00419000
         BO    @RF00085                                            0085 00420000
*     DO;                                                          0086 00421000
*                                                                  0086 00422000
*       /*************************************************************/ 00423000
*       /*                                                           */ 00424000
*       /* CALCULATE IDEAL NUMBER OF REQUIRED CHARACTERS INCLUDING   */ 00425000
*       /* POSSIBLE SIGN, DECIMAL POINT, AND COMMAS                  */ 00426000
*       /*                                                           */ 00427000
*       /*************************************************************/ 00428000
*                                                                  0087 00429000
*       CNPLACES=CNMINUS;           /* MINUS SIGN (1 OR 0)           */ 00430000
         LH    CNPLACES,CNMINUS                                    0087 00431000
*       CNPLACES=CNPLACES+CNSIGNF;  /* ADD NUMBER OF SIGNIFICANT   0088 00432000
*                                      CONVERTED DIGITS              */ 00433000
         AR    CNPLACES,CNSIGNF                                    0088 00434000
*       IF CNSSIGCM='1'B THEN       /* IF COMMAS, ADD NUMBER REQUIRED*/ 00435000
         TM    CNSSIGCM,B'10000000'                                0089 00436000
         BNO   @RF00089                                            0089 00437000
*         CNPLACES=CNPLACES+CNSIGNFC;                              0090 00438000
         AR    CNPLACES,CNSIGNFC                                   0090 00439000
*       CNPLACES=CNPLACES+CNSIGZER+ /* SIGNIFICANT ZEROS TRAILING  0091 00440000
*                                      CONVERTED SIGNIFICANT DIGITS  */ 00441000
*           CNLEADZ;                /* LEADING ZERO                  */ 00442000
@RF00089 LR    @10,CNPLACES                                        0091 00443000
         AR    @10,CNSIGZER                                        0091 00444000
         AR    @10,CNLEADZ                                         0091 00445000
         LR    CNPLACES,@10                                        0091 00446000
*       IF CNOUFRAC>0 THEN          /* IF FRACTIONAL OUTPUT IS     0092 00447000
*                                      DESIRED                       */ 00448000
         L     @10,@PC00001+16                                     0092 00449000
         L     @10,CNOUFRAC(,@10)                                  0092 00450000
         LTR   @10,@10                                             0092 00451000
         BNP   @RF00092                                            0092 00452000
*         CNPLACES=CNPLACES+CNDECLEN+/* DECIMAL POINT LENGTH         */ 00453000
*             CNOUFRAC;             /* NUMBER OF PLACES TO THE RIGHT    00454000
*                                      OF THE DECIMAL POINT IN THE 0093 00455000
*                                      OUTPUT FIELD                  */ 00456000
         LA    @07,1                                               0093 00457000
         AR    @07,CNPLACES                                        0093 00458000
         AR    @07,@10                                             0093 00459000
         LR    CNPLACES,@07                                        0093 00460000
*       IF CNPLACES<=CNOUTLEN THEN  /* IF STRING WILL FIT INTO OUTPUT*/ 00461000
@RF00092 L     @10,@PC00001+12                                     0094 00462000
         L     @10,CNOUTLEN(,@10)                                  0094 00463000
         CR    CNPLACES,@10                                        0094 00464000
         BH    @RF00094                                            0094 00465000
*         DO;                                                      0095 00466000
*                                                                  0095 00467000
*           /*********************************************************/ 00468000
*           /*                                                       */ 00469000
*           /* CONCATENATE STRING PARTS INTO OUTPUT STRING           */ 00470000
*           /*                                                       */ 00471000
*           /*********************************************************/ 00472000
*                                                                  0096 00473000
*           CALL MFCHINSR(CNOUTLEN-CNPLACES+1);                    0096 00474000
*                                                                  0096 00475000
         SR    @10,CNPLACES                                        0096 00476000
         AH    @10,@CH00065                                        0096 00477000
         ST    @10,@AFTEMPS                                        0096 00478000
         LA    @10,@AFTEMPS                                        0096 00479000
         ST    @10,@AL00001                                        0096 00480000
         LA    @01,@AL00001                                        0096 00481000
         BAL   @14,MFCHINSR                                        0096 00482000
*           /*********************************************************/ 00483000
*           /*                                                       */ 00484000
*           /* MACDATE Y-2 73018                                     */ 00485000
*           /*                                                       */ 00486000
*           /*********************************************************/ 00487000
*                                                                  0097 00488000
*           RESPECIFY                                              0097 00489000
*            (GPR15F)RESTRICTED;                                   0097 00490000
*           IF GPR15F=0 THEN        /* CONVERSION COMPLETE           */ 00491000
         LTR   GPR15F,GPR15F                                       0098 00492000
         BNZ   @RF00098                                            0098 00493000
*             RETURN CODE(0);       /* RETURN TO REPORT GENERATOR    */ 00494000
*                                                                  0099 00495000
         L     @13,4(,@13)                                         0099 00496000
         L     @00,@SIZDATD                                        0099 00497000
         LR    @01,@11                                             0099 00498000
         FREEMAIN R,LV=(0),A=(1)                                        00499000
         SR    @15,@15                                             0099 00500000
         L     @14,12(,@13)                                        0099 00501000
         LM    @00,@12,20(@13)                                     0099 00502000
         BR    @14                                                 0099 00503000
*           /*********************************************************/ 00504000
*           /*                                                       */ 00505000
*           /* MACDATE Y-2 73018                                     */ 00506000
*           /*                                                       */ 00507000
*           /*********************************************************/ 00508000
*                                                                  0100 00509000
*           RESPECIFY                                              0100 00510000
*            (GPR15F)UNRESTRICTED;                                 0100 00511000
@RF00098 DS    0H                                                  0101 00512000
*         END;                                                     0101 00513000
*                                                                  0101 00514000
*       /*************************************************************/ 00515000
*       /*                                                           */ 00516000
*       /* REMOVE LEADING ZERO IF FRACTIONAL PART IS PRESENT AND TRY */ 00517000
*       /* AGAIN                                                     */ 00518000
*       /*                                                           */ 00519000
*       /*************************************************************/ 00520000
*                                                                  0102 00521000
*       IF CNOUFRAC=0 THEN          /* DONT REMOVE LEADING ZERO      */ 00522000
@RF00094 L     @10,@PC00001+16                                     0102 00523000
         ICM   @07,15,CNOUFRAC(@10)                                0102 00524000
         BZ    @RT00102                                            0102 00525000
*         GO TO CNLAB2;             /* FLOAT STRING IN OUTPUT FIELD  */ 00526000
*       CNPLACES=CNPLACES-CNLEADZ;  /* TRY REMOVING LEADING ZERO     */ 00527000
         SR    CNPLACES,CNLEADZ                                    0104 00528000
*       IF CNPLACES<=CNOUTLEN THEN  /* IF STRING WILL FIT NOW        */ 00529000
         L     @10,@PC00001+12                                     0105 00530000
         L     @10,CNOUTLEN(,@10)                                  0105 00531000
         CR    CNPLACES,@10                                        0105 00532000
         BH    @RF00105                                            0105 00533000
*         DO;                                                      0106 00534000
*           CNSFRAZR='1'B;          /* SUPPRESS LEADING ZERO         */ 00535000
*                                                                  0107 00536000
         OI    CNSFRAZR,B'10000000'                                0107 00537000
*           /*********************************************************/ 00538000
*           /*                                                       */ 00539000
*           /* CONCATENATE STRING PARTS INTO OUTPUT FIELD            */ 00540000
*           /*                                                       */ 00541000
*           /*********************************************************/ 00542000
*                                                                  0108 00543000
*           CALL MFCHINSR(CNOUTLEN-CNPLACES+1);                    0108 00544000
*                                                                  0108 00545000
         SR    @10,CNPLACES                                        0108 00546000
         AH    @10,@CH00065                                        0108 00547000
         ST    @10,@AFTEMPS                                        0108 00548000
         LA    @10,@AFTEMPS                                        0108 00549000
         ST    @10,@AL00001                                        0108 00550000
         LA    @01,@AL00001                                        0108 00551000
         BAL   @14,MFCHINSR                                        0108 00552000
*           /*********************************************************/ 00553000
*           /*                                                       */ 00554000
*           /* MACDATE Y-2 73018                                     */ 00555000
*           /*                                                       */ 00556000
*           /*********************************************************/ 00557000
*                                                                  0109 00558000
*           RESPECIFY                                              0109 00559000
*            (GPR15F)RESTRICTED;                                   0109 00560000
*           IF GPR15F=0 THEN        /* CONVERSION COMPLETE           */ 00561000
         LTR   GPR15F,GPR15F                                       0110 00562000
         BNZ   @RF00110                                            0110 00563000
*             RETURN CODE(0);       /* RETURN TO REPORT GENERATOR    */ 00564000
*                                                                  0111 00565000
         L     @13,4(,@13)                                         0111 00566000
         L     @00,@SIZDATD                                        0111 00567000
         LR    @01,@11                                             0111 00568000
         FREEMAIN R,LV=(0),A=(1)                                        00569000
         SR    @15,@15                                             0111 00570000
         L     @14,12(,@13)                                        0111 00571000
         LM    @00,@12,20(@13)                                     0111 00572000
         BR    @14                                                 0111 00573000
*           /*********************************************************/ 00574000
*           /*                                                       */ 00575000
*           /* MACDATE Y-2 73018                                     */ 00576000
*           /*                                                       */ 00577000
*           /*********************************************************/ 00578000
*                                                                  0112 00579000
*           RESPECIFY                                              0112 00580000
*            (GPR00P,                                              0112 00581000
*             GPR01P,                                              0112 00582000
*             GPR14P,                                              0112 00583000
*             GPR15P)UNRESTRICTED;                                 0112 00584000
@RF00110 DS    0H                                                  0113 00585000
*         END;                                                     0113 00586000
*                                                                  0113 00587000
*       /*************************************************************/ 00588000
*       /*                                                           */ 00589000
*       /* CONCATENATED STRING WILL NOT FIT IN OUTPUT STRING WITH    */ 00590000
*       /* CNOUFRAC PLACES TO THE RIGHT OF THE DECIMAL. TRY FLOATING */ 00591000
*       /* THE CONCATENATED STRING IN THE OUTPUT FIELD FOR MAXIMUM   */ 00592000
*       /* PERCISION.                                                */ 00593000
*       /*                                                           */ 00594000
*       /*************************************************************/ 00595000
*                                                                  0114 00596000
*CNLAB2:                                                           0114 00597000
*       CNIFLOAT='1'B;              /* INDICATE FLOATING             */ 00598000
@RF00105 DS    0H                                                  0114 00599000
CNLAB2   OI    CNIFLOAT,B'10000000'                                0114 00600000
*       CNRETCDE=4;                 /* SET WARNING RETURN CODE       */ 00601000
         LA    CNRETCDE,4                                          0115 00602000
*     END;                                                         0116 00603000
*                                                                  0116 00604000
*   /*****************************************************************/ 00605000
*   /*                                                               */ 00606000
*   /* STRING WILL BE FLOATED IN THE OUTPUT FIELD FOR MAXIMUM        */ 00607000
*   /* PRECISION TRY TO ALLOW A ZERO OR ALL FRACTIONAL NUMBER TO BE  */ 00608000
*   /* REPRESENTED IN THE OUTPUT FIELD AS .XXXX OR -.XXXX            */ 00609000
*   /*                                                               */ 00610000
*   /*****************************************************************/ 00611000
*                                                                  0117 00612000
*   IF CNLEADZ^=0&CNOUTLEN>=CNMINUS+CNDECLEN+1 THEN                0117 00613000
@RF00085 LTR   CNLEADZ,CNLEADZ                                     0117 00614000
         BZ    @RF00117                                            0117 00615000
         L     @14,@PC00001+12                                     0117 00616000
         LA    @10,2                                               0117 00617000
         AH    @10,CNMINUS                                         0117 00618000
         C     @10,CNOUTLEN(,@14)                                  0117 00619000
         BH    @RF00117                                            0117 00620000
*     CNSFRAZR='1'B;                /* SUPPRESS LEADING ZERO IF IT IS   00621000
*                                      SPECIFIED AND AT LEAST THE  0118 00622000
*                                      MINUS SIGN, DECIMAL POINT AND    00623000
*                                      ONE DIGIT WILL FIT.           */ 00624000
*                                                                  0118 00625000
         OI    CNSFRAZR,B'10000000'                                0118 00626000
*   /*****************************************************************/ 00627000
*   /*                                                               */ 00628000
*   /* CALCULATE IDEAL NUMBER OF REQUIRED CHARACTERS IN SIGNIFICANT  */ 00629000
*   /* PART OF THE STRING INCLUDING MINUS SIGN, COMMAS, AND LEADING  */ 00630000
*   /* ZERO                                                          */ 00631000
*   /*                                                               */ 00632000
*   /*****************************************************************/ 00633000
*                                                                  0119 00634000
*   CNPLACES=CNMINUS;                                              0119 00635000
@RF00117 LH    CNPLACES,CNMINUS                                    0119 00636000
*   IF CNSSIGCM='1'B THEN           /* IF COMMAS, ADD NUMBER REQUIRED*/ 00637000
         TM    CNSSIGCM,B'10000000'                                0120 00638000
         BNO   @RF00120                                            0120 00639000
*     CNPLACES=CNPLACES+CNSIGNFC;                                  0121 00640000
         AR    CNPLACES,CNSIGNFC                                   0121 00641000
*   CNPLACES=CNPLACES+CNSIGNF;      /* ADD SIGNIFICANT CONVERTED   0122 00642000
*                                      DIGITS                        */ 00643000
@RF00120 AR    CNPLACES,CNSIGNF                                    0122 00644000
*   CNPLACES=CNPLACES+CNSIGZER;     /* SIGNIFICANT ZEROS TRAILING  0123 00645000
*                                      CONVERTED SIGNIFICANT DIGITS  */ 00646000
         AR    CNPLACES,CNSIGZER                                   0123 00647000
*   IF CNSFRAZR='0'B THEN           /* ADD LEADING ZERO IF SPECIFIED    00648000
*                                      AND NOT SUPPRESSED.           */ 00649000
         TM    CNSFRAZR,B'10000000'                                0124 00650000
         BNZ   @RF00124                                            0124 00651000
*     CNPLACES=CNPLACES+CNLEADZ;                                   0125 00652000
         AR    CNPLACES,CNLEADZ                                    0125 00653000
*   IF CNPLACES<=CNOUTLEN THEN      /* IF STRING WILL FIT INTO OUTPUT*/ 00654000
@RF00124 L     @14,@PC00001+12                                     0126 00655000
         C     CNPLACES,CNOUTLEN(,@14)                             0126 00656000
         BH    @RF00126                                            0126 00657000
*     DO;                                                          0127 00658000
*       CALL MFCHINSR(1);           /* CONCATENATE STRING PARTS INTO    00659000
*                                      OUTPUT STRING                 */ 00660000
*                                                                  0128 00661000
         LA    @01,@AL00128                                        0128 00662000
         BAL   @14,MFCHINSR                                        0128 00663000
*       /*************************************************************/ 00664000
*       /*                                                           */ 00665000
*       /* MACDATE Y-2 73018                                         */ 00666000
*       /*                                                           */ 00667000
*       /*************************************************************/ 00668000
*                                                                  0129 00669000
*       RESPECIFY                                                  0129 00670000
*        (GPR15F)RESTRICTED;                                       0129 00671000
*       IF GPR15F=0 THEN            /* CONVERSION COMPLETE           */ 00672000
         LTR   GPR15F,GPR15F                                       0130 00673000
         BNZ   @RF00130                                            0130 00674000
*         RETURN CODE(CNRETCDE);    /* RETURN TO REPORT GENERATOR    */ 00675000
*                                                                  0131 00676000
         L     @13,4(,@13)                                         0131 00677000
         L     @00,@SIZDATD                                        0131 00678000
         LR    @01,@11                                             0131 00679000
         FREEMAIN R,LV=(0),A=(1)                                        00680000
         LR    @15,@05                                             0131 00681000
         L     @14,12(,@13)                                        0131 00682000
         LM    @00,@12,20(@13)                                     0131 00683000
         BR    @14                                                 0131 00684000
*       /*************************************************************/ 00685000
*       /*                                                           */ 00686000
*       /* MACDATE Y-2 73018                                         */ 00687000
*       /*                                                           */ 00688000
*       /*************************************************************/ 00689000
*                                                                  0132 00690000
*       RESPECIFY                                                  0132 00691000
*        (GPR00P,                                                  0132 00692000
*         GPR01P,                                                  0132 00693000
*         GPR14P,                                                  0132 00694000
*         GPR15P)UNRESTRICTED;                                     0132 00695000
@RF00130 DS    0H                                                  0133 00696000
*     END;                                                         0133 00697000
*   IF CNSSIGCM='1'B THEN           /* IF COMMAS WERE SPECIFIED THEN    00698000
*                                      ATTEMPT TO REMOVE COMMAS TO 0134 00699000
*                                      SEE IF STRING WILL FIT WITHOUT   00700000
*                                      THEM                          */ 00701000
@RF00126 TM    CNSSIGCM,B'10000000'                                0134 00702000
         BNO   @RF00134                                            0134 00703000
*     DO;                                                          0135 00704000
*       CNPLACES=CNPLACES-CNSIGNFC;                                0136 00705000
         SR    CNPLACES,CNSIGNFC                                   0136 00706000
*       IF CNPLACES<=CNOUTLEN THEN  /* IF STRING WILL FIT NOW        */ 00707000
         L     @14,@PC00001+12                                     0137 00708000
         C     CNPLACES,CNOUTLEN(,@14)                             0137 00709000
         BH    @RF00137                                            0137 00710000
*         DO;                                                      0138 00711000
*           CNSSIGCM='0'B;          /* INDICATE NO COMMAS            */ 00712000
         NI    CNSSIGCM,B'01111111'                                0139 00713000
*           CALL MFCHINSR(1);       /* CONCATENATE PARTS INTO OUTPUT    00714000
*                                      FIELD                         */ 00715000
*                                                                  0140 00716000
         LA    @01,@AL00140                                        0140 00717000
         BAL   @14,MFCHINSR                                        0140 00718000
*           /*********************************************************/ 00719000
*           /*                                                       */ 00720000
*           /* MACDATE Y-2 73018                                     */ 00721000
*           /*                                                       */ 00722000
*           /*********************************************************/ 00723000
*                                                                  0141 00724000
*           RESPECIFY                                              0141 00725000
*            (GPR15F)RESTRICTED;                                   0141 00726000
*           IF GPR15F=0 THEN        /* CONVERSION COMPLETE           */ 00727000
         LTR   GPR15F,GPR15F                                       0142 00728000
         BNZ   @RF00142                                            0142 00729000
*             RETURN CODE(4);       /* RETURN TO REPORT GENERATOR    */ 00730000
*                                                                  0143 00731000
         L     @13,4(,@13)                                         0143 00732000
         L     @00,@SIZDATD                                        0143 00733000
         LR    @01,@11                                             0143 00734000
         FREEMAIN R,LV=(0),A=(1)                                        00735000
         LA    @15,4                                               0143 00736000
         L     @14,12(,@13)                                        0143 00737000
         LM    @00,@12,20(@13)                                     0143 00738000
         BR    @14                                                 0143 00739000
*           /*********************************************************/ 00740000
*           /*                                                       */ 00741000
*           /* MACDATE Y-2 73018                                     */ 00742000
*           /*                                                       */ 00743000
*           /*********************************************************/ 00744000
*                                                                  0144 00745000
*           RESPECIFY                                              0144 00746000
*            (GPR00P,                                              0144 00747000
*             GPR01P,                                              0144 00748000
*             GPR14P,                                              0144 00749000
*             GPR15P)UNRESTRICTED;                                 0144 00750000
@RF00142 DS    0H                                                  0145 00751000
*         END;                                                     0145 00752000
*     END;                                                         0146 00753000
*                                                                  0146 00754000
@RF00137 DS    0H                                                  0147 00755000
*   /*****************************************************************/ 00756000
*   /*                                                               */ 00757000
*   /* NUMBER WILL NOT FIT WITHOUT LOOSING SIGNIFICANCE. FILL OUTPUT */ 00758000
*   /* FIELD WITH ASTERISKS AND RETURN.                              */ 00759000
*   /*                                                               */ 00760000
*   /*****************************************************************/ 00761000
*                                                                  0147 00762000
*   DO CNLOOPV=1 TO CNOUTLEN;       /* LOOP THROUGH OUTPUT FIELD     */ 00763000
@RF00134 LA    CNLOOPV,1                                           0147 00764000
         B     @DE00147                                            0147 00765000
@DL00147 DS    0H                                                  0148 00766000
*     CNOUTSTR(CNLOOPV)=CNFLCHAR;   /* SET IN ASTERISK               */ 00767000
         L     @14,@PC00001+8                                      0148 00768000
         ALR   @14,CNLOOPV                                         0148 00769000
         AL    @14,@CF00129                                        0148 00770000
         MVI   CNOUTSTR(@14),C'*'                                  0148 00771000
*   END;                                                           0149 00772000
         AH    CNLOOPV,@CH00065                                    0149 00773000
@DE00147 L     @14,@PC00001+12                                     0149 00774000
         C     CNLOOPV,CNOUTLEN(,@14)                              0149 00775000
         BNH   @DL00147                                            0149 00776000
*   RETURN CODE(8);                 /* RETURN TO REPORT GENERATOR    */ 00777000
         L     @13,4(,@13)                                         0150 00778000
         L     @00,@SIZDATD                                        0150 00779000
         LR    @01,@11                                             0150 00780000
         FREEMAIN R,LV=(0),A=(1)                                        00781000
         LA    @15,8                                               0150 00782000
         L     @14,12(,@13)                                        0150 00783000
         LM    @00,@12,20(@13)                                     0150 00784000
         BR    @14                                                 0150 00785000
*                                                                  0151 00786000
*/*                                                                  */ 00787000
*/*** START OF SPECIFICATIONS ****************************************  00788000
*                                                                    */ 00789000
*/*                                                                  */ 00790000
*/* SUBROUTINE-NAME = MFCHINSR                                       */ 00791000
*/*                                                                  */ 00792000
*/* DESCRIPTIVE-NAME = CONVERTED OUTPUT INSERTION SUBROUTINE         */ 00793000
*/*                                                                  */ 00794000
*/* FUNCTION = COMPLETES OUTPUT STRING WITH CONVERTED STRING FROM    */ 00795000
*/*            PRESET DATA AND CONTROL VARIABLES.                    */ 00796000
*/*                                                                  */ 00797000
*/* ENTRY-POINT = MFCHINSR                                           */ 00798000
*/*                                                                  */ 00799000
*/*    PURPOSE = SEE FUNCTION                                        */ 00800000
*/*                                                                  */ 00801000
*/*    LINKAGE = R1 - PARAMETER LIST ADDRESS                         */ 00802000
*/*                                                                  */ 00803000
*/**** END OF SPECIFICATIONS *****************************************  00804000
*                                                                    */ 00805000
*/*                                                                  */ 00806000
*/* PROCEDURE TO INSERT CHARACTERS INTO OUTPUT FIELD BASED ON      0151 00807000
*   CONTROL VARIABLES                                                */ 00808000
*                                                                  0151 00809000
*MFCHINSR:                                                         0151 00810000
*   PROCEDURE(CHSTART)              /* STARTING CHARACTER POSITION IN   00811000
*                                      OUTPUT FIELD                  */ 00812000
*       ;                                                          0151 00813000
MFCHINSR STM   @14,@12,12(@13)                                     0151 00814000
         MVC   @PC00002(4),0(@01)                                  0151 00815000
*                                                                  0152 00816000
*/* BEGIN MISCELLANEOUS DECLARATION                                  */ 00817000
*                                                                  0152 00818000
*   DECLARE                                                        0152 00819000
*     CHSTART                       /* PARAMETER - STARTING CHARACTER   00820000
*                                      POSITION IN OUTPUT FIELD      */ 00821000
*         FIXED BINARY(31),                                        0152 00822000
*     CHLOOPV                       /* LOOP VARIABLE                 */ 00823000
*         FIXED BINARY(31),                                        0152 00824000
*     CHCOMCNT                      /* COMMA INSERTION CONTROL VAR.  */ 00825000
*         FIXED BINARY(15),                                        0152 00826000
*     COMMA                         /* COMMA CONSTANT                */ 00827000
*         CHARACTER(1)STATIC LOCAL INITIAL(','),                   0152 00828000
*     CHINSSRT                      /* INSERTION POINT FOR ROUNDING     00829000
*                                      OPERATION                     */ 00830000
*         FIXED BINARY(15),                                        0152 00831000
*     CHINSERT                      /* INSERTION CHARACTERS FOR ROUND*/ 00832000
*         CHARACTER(2),                                            0152 00833000
*     CHINSLEN                      /* INSERTION CHARACTER LENGTH    */ 00834000
*         FIXED BINARY(15),                                        0152 00835000
*     CHDECCNT                      /* COUNT OF DIGITS PAST DEC PT,     00836000
*                                      (INCLUDING DECIMAL POINT)     */ 00837000
*         FIXED BINARY(15),                                        0152 00838000
*     CHRNDUP                       /* INDICATES ROUND OPERATION     */ 00839000
*         BIT(1),                                                  0152 00840000
*     CHSCAN                        /* STRING SCAN VARIABLE          */ 00841000
*         FIXED BINARY(31);                                        0152 00842000
*                                                                  0153 00843000
*/* BEGIN MAINLINE PROCESSING                                        */ 00844000
*                                                                  0153 00845000
*   /*****************************************************************/ 00846000
*   /*                                                               */ 00847000
*   /* INITIALIZE                                                    */ 00848000
*   /*                                                               */ 00849000
*   /*****************************************************************/ 00850000
*                                                                  0153 00851000
*   CHRNDUP='0'B;                   /* NO ROUND REQUIRED YET         */ 00852000
         NI    CHRNDUP,B'01111111'                                 0153 00853000
*   CHDECCNT=0;                     /* NO DIGITS PAST DEC PT.        */ 00854000
*                                                                  0154 00855000
         SR    CHDECCNT,CHDECCNT                                   0154 00856000
*   /*****************************************************************/ 00857000
*   /*                                                               */ 00858000
*   /* INSERT BLANKS BEFORE START POSITION                           */ 00859000
*   /*                                                               */ 00860000
*   /*****************************************************************/ 00861000
*                                                                  0155 00862000
*   IF CHSTART>1 THEN               /* IF THERE IS ROOM FOR BLANKS   */ 00863000
         LA    @14,1                                               0155 00864000
         L     @10,@PC00002                                        0155 00865000
         C     @14,CHSTART(,@10)                                   0155 00866000
         BNL   @RF00155                                            0155 00867000
*     DO CHLOOPV=1 TO CHSTART-1;                                   0156 00868000
         LR    CHLOOPV,@14                                         0156 00869000
         B     @DE00156                                            0156 00870000
@DL00156 DS    0H                                                  0157 00871000
*       CNOUTSTR(CHLOOPV)=' ';      /* INSERT BLANK                  */ 00872000
         L     @14,@PC00001+8                                      0157 00873000
         ALR   @14,CHLOOPV                                         0157 00874000
         AL    @14,@CF00129                                        0157 00875000
         MVI   CNOUTSTR(@14),C' '                                  0157 00876000
*     END;                                                         0158 00877000
         AH    CHLOOPV,@CH00065                                    0158 00878000
@DE00156 L     @14,@PC00002                                        0158 00879000
         L     @14,CHSTART(,@14)                                   0158 00880000
         BCTR  @14,0                                               0158 00881000
         CR    CHLOOPV,@14                                         0158 00882000
         BNH   @DL00156                                            0158 00883000
*   CHSCAN=CHSTART;                 /* SET SCAN VARIABLE AT START  0159 00884000
*                                      POSITION                      */ 00885000
@RF00155 L     @14,@PC00002                                        0159 00886000
         L     CHSCAN,CHSTART(,@14)                                0159 00887000
*   IF CNMINUS=1 THEN               /* IF MINUS SIGN NEEDED          */ 00888000
         LA    @14,1                                               0160 00889000
         CH    @14,CNMINUS                                         0160 00890000
         BNE   @RF00160                                            0160 00891000
*     DO;                                                          0161 00892000
*       CNOUTSTR(CHSCAN)='-';       /* INSERT MINUS SIGN             */ 00893000
         L     @10,@PC00001+8                                      0162 00894000
         ALR   @10,CHSCAN                                          0162 00895000
         AL    @10,@CF00129                                        0162 00896000
         MVI   CNOUTSTR(@10),C'-'                                  0162 00897000
*       CHSCAN=CHSCAN+1;            /* POINT TO NEXT CHARACTER       */ 00898000
         AR    CHSCAN,@14                                          0163 00899000
*     END;                                                         0164 00900000
*   IF CNSIGNF=0 THEN               /* NO SIGNIFICANT CONVERTED    0165 00901000
*                                      DIGITS                        */ 00902000
@RF00160 LTR   CNSIGNF,CNSIGNF                                     0165 00903000
         BZ    @RT00165                                            0165 00904000
*     GO TO CHLAB1;                 /* INSERT SINGLE LEADING ZERO    */ 00905000
*                                                                  0166 00906000
*   /*****************************************************************/ 00907000
*   /*                                                               */ 00908000
*   /* INSERT CONVERTED DIGITS AND TRAILING SIGNIFICANT ZEROS (WITH  */ 00909000
*   /* COMMAS IF REQUESTED)                                          */ 00910000
*   /*                                                               */ 00911000
*   /*****************************************************************/ 00912000
*                                                                  0167 00913000
*   IF CNSSIGCM='1'B THEN           /* IF COMMAS REQUESTED           */ 00914000
         TM    CNSSIGCM,B'10000000'                                0167 00915000
         BNO   @RF00167                                            0167 00916000
*     DO;                                                          0168 00917000
*                                                                  0168 00918000
*       /*************************************************************/ 00919000
*       /*                                                           */ 00920000
*       /* SET COMMA INSERTION CONTROL VARIABLE                      */ 00921000
*       /*                                                           */ 00922000
*       /*************************************************************/ 00923000
*                                                                  0169 00924000
*       CHCOMCNT=(3-(CNSIGNF+CNSIGZER)//3)//3;                     0169 00925000
*                                                                  0169 00926000
         LA    @14,3                                               0169 00927000
         LR    @00,CNSIGNF                                         0169 00928000
         AR    @00,CNSIGZER                                        0169 00929000
         SRDA  @00,32                                              0169 00930000
         DR    @00,@14                                             0169 00931000
         LCR   @00,@00                                             0169 00932000
         AR    @00,@14                                             0169 00933000
         SRDA  @00,32                                              0169 00934000
         DR    @00,@14                                             0169 00935000
         LR    CHCOMCNT,@00                                        0169 00936000
*       /*************************************************************/ 00937000
*       /*                                                           */ 00938000
*       /* INSERT SIGNIFICANT CONVERTED DIGITS                       */ 00939000
*       /*                                                           */ 00940000
*       /*************************************************************/ 00941000
*                                                                  0170 00942000
*       DO CHLOOPV=1 TO CNSIGNF;                                   0170 00943000
         LA    CHLOOPV,1                                           0170 00944000
         B     @DE00170                                            0170 00945000
@DL00170 DS    0H                                                  0171 00946000
*         IF CHCOMCNT=3 THEN        /* TIME FOR COMMA                */ 00947000
         CH    CHCOMCNT,@CH00098                                   0171 00948000
         BNE   @RF00171                                            0171 00949000
*           DO;                                                    0172 00950000
*             CHCOMCNT=0;           /* RESET CONTROL VARIABLE        */ 00951000
         SR    CHCOMCNT,CHCOMCNT                                   0173 00952000
*             CHLOOPV=CHLOOPV-1;    /* RESET LOOP VARIABLE           */ 00953000
         BCTR  CHLOOPV,0                                           0174 00954000
*             CNOUTSTR(CHSCAN)=COMMA;                              0175 00955000
         L     @14,@PC00001+8                                      0175 00956000
         ALR   @14,CHSCAN                                          0175 00957000
         AL    @14,@CF00129                                        0175 00958000
         MVC   CNOUTSTR(1,@14),COMMA                               0175 00959000
*           END;                                                   0176 00960000
*         ELSE                      /* INSERT DIGIT                  */ 00961000
*           DO;                                                    0177 00962000
*                                                                  0177 00963000
         B     @RC00171                                            0177 00964000
@RF00171 DS    0H                                                  0178 00965000
*             /*******************************************************/ 00966000
*             /*                                                     */ 00967000
*             /* INCREMENT COMMA CONTROL VARIABLE                    */ 00968000
*             /*                                                     */ 00969000
*             /*******************************************************/ 00970000
*                                                                  0178 00971000
*             CHCOMCNT=CHCOMCNT+1;                                 0178 00972000
         AH    CHCOMCNT,@CH00065                                   0178 00973000
*             CNOUTSTR(CHSCAN)=CNSIGDIG(CHLOOPV);                  0179 00974000
         L     @14,@PC00001+8                                      0179 00975000
         ALR   @14,CHSCAN                                          0179 00976000
         AL    @14,@CF00129                                        0179 00977000
         LA    @10,CNSIGDIG-1(CHLOOPV)                             0179 00978000
         MVC   CNOUTSTR(1,@14),0(@10)                              0179 00979000
*           END;                                                   0180 00980000
*         CHSCAN=CHSCAN+1;          /* INCREMENT SCAN                */ 00981000
@RC00171 AH    CHSCAN,@CH00065                                     0181 00982000
*       END;                                                       0182 00983000
*                                                                  0182 00984000
         AH    CHLOOPV,@CH00065                                    0182 00985000
@DE00170 CR    CHLOOPV,CNSIGNF                                     0182 00986000
         BNH   @DL00170                                            0182 00987000
*       /*************************************************************/ 00988000
*       /*                                                           */ 00989000
*       /* INSERT TRAILING ZEROS                                     */ 00990000
*       /*                                                           */ 00991000
*       /*************************************************************/ 00992000
*                                                                  0183 00993000
*       DO CHLOOPV=1 TO CNSIGZER;                                  0183 00994000
         LA    CHLOOPV,1                                           0183 00995000
         B     @DE00183                                            0183 00996000
@DL00183 DS    0H                                                  0184 00997000
*         IF CHCOMCNT=3 THEN        /* TIME FOR COMMA                */ 00998000
         CH    CHCOMCNT,@CH00098                                   0184 00999000
         BNE   @RF00184                                            0184 01000000
*           DO;                                                    0185 01001000
*             CHCOMCNT=0;           /* RESET CONTROL VARIABLE        */ 01002000
         SR    CHCOMCNT,CHCOMCNT                                   0186 01003000
*             CHLOOPV=CHLOOPV-1;    /* RESET LOOP VARIABLE           */ 01004000
         BCTR  CHLOOPV,0                                           0187 01005000
*             CNOUTSTR(CHSCAN)=COMMA;                              0188 01006000
         L     @14,@PC00001+8                                      0188 01007000
         ALR   @14,CHSCAN                                          0188 01008000
         AL    @14,@CF00129                                        0188 01009000
         MVC   CNOUTSTR(1,@14),COMMA                               0188 01010000
*           END;                                                   0189 01011000
*         ELSE                      /* INSERT TRAILING ZERO          */ 01012000
*           DO;                                                    0190 01013000
*                                                                  0190 01014000
         B     @RC00184                                            0190 01015000
@RF00184 DS    0H                                                  0191 01016000
*             /*******************************************************/ 01017000
*             /*                                                     */ 01018000
*             /* INCREMENT COMMA CONTROL VARIABLE                    */ 01019000
*             /*                                                     */ 01020000
*             /*******************************************************/ 01021000
*                                                                  0191 01022000
*             CHCOMCNT=CHCOMCNT+1;                                 0191 01023000
         AH    CHCOMCNT,@CH00065                                   0191 01024000
*             CNOUTSTR(CHSCAN)='0';                                0192 01025000
         L     @14,@PC00001+8                                      0192 01026000
         ALR   @14,CHSCAN                                          0192 01027000
         AL    @14,@CF00129                                        0192 01028000
         MVI   CNOUTSTR(@14),C'0'                                  0192 01029000
*           END;                                                   0193 01030000
*         CHSCAN=CHSCAN+1;          /* INCREMENT SCAN                */ 01031000
@RC00184 AH    CHSCAN,@CH00065                                     0194 01032000
*       END;                                                       0195 01033000
         AH    CHLOOPV,@CH00065                                    0195 01034000
@DE00183 CR    CHLOOPV,CNSIGZER                                    0195 01035000
         BNH   @DL00183                                            0195 01036000
*     END;                                                         0196 01037000
*   ELSE                            /* NO COMMAS REQUIRED            */ 01038000
*     DO;                                                          0197 01039000
*                                                                  0197 01040000
         B     @RC00167                                            0197 01041000
@RF00167 DS    0H                                                  0198 01042000
*       /*************************************************************/ 01043000
*       /*                                                           */ 01044000
*       /* INSERT SIGNIFICANT CONVERTED DIGITS                       */ 01045000
*       /*                                                           */ 01046000
*       /*************************************************************/ 01047000
*                                                                  0198 01048000
*       CNOUTSTR(CHSCAN:CHSCAN+CNSIGNF-1)=CNSIGDIG(1:CNSIGNF);     0198 01049000
         L     @14,@PC00001+8                                      0198 01050000
         ALR   @14,CHSCAN                                          0198 01051000
         AL    @14,@CF00129                                        0198 01052000
         LR    @10,CNSIGNF                                         0198 01053000
         BCTR  @10,0                                               0198 01054000
         EX    @10,@SM00152                                        0198 01055000
*       CHSCAN=CHSCAN+CNSIGNF;                                     0199 01056000
*                                                                  0199 01057000
         AR    CHSCAN,CNSIGNF                                      0199 01058000
*       /*************************************************************/ 01059000
*       /*                                                           */ 01060000
*       /* INSERT TRAILING ZEROS                                     */ 01061000
*       /*                                                           */ 01062000
*       /*************************************************************/ 01063000
*                                                                  0200 01064000
*       DO CHLOOPV=1 TO CNSIGZER;                                  0200 01065000
         LA    CHLOOPV,1                                           0200 01066000
         B     @DE00200                                            0200 01067000
@DL00200 DS    0H                                                  0201 01068000
*         CNOUTSTR(CHSCAN)='0';                                    0201 01069000
         L     @14,@PC00001+8                                      0201 01070000
         ALR   @14,CHSCAN                                          0201 01071000
         AL    @14,@CF00129                                        0201 01072000
         MVI   CNOUTSTR(@14),C'0'                                  0201 01073000
*         CHSCAN=CHSCAN+1;                                         0202 01074000
         AH    CHSCAN,@CH00065                                     0202 01075000
*       END;                                                       0203 01076000
         AH    CHLOOPV,@CH00065                                    0203 01077000
@DE00200 CR    CHLOOPV,CNSIGZER                                    0203 01078000
         BNH   @DL00200                                            0203 01079000
*     END;                                                         0204 01080000
*                                                                  0204 01081000
*   /*****************************************************************/ 01082000
*   /*                                                               */ 01083000
*   /* INSERT SINGLE SIGNIFICANT LEADING ZERO IF REQUESTED AND NOT   */ 01084000
*   /* SUPPRESSED                                                    */ 01085000
*   /*                                                               */ 01086000
*   /*****************************************************************/ 01087000
*                                                                  0205 01088000
*CHLAB1:                                                           0205 01089000
*   IF CNSFRAZR='0'B&CNLEADZ>0 THEN                                0205 01090000
@RC00167 DS    0H                                                  0205 01091000
CHLAB1   TM    CNSFRAZR,B'10000000'                                0205 01092000
         BNZ   @RF00205                                            0205 01093000
         LTR   CNLEADZ,CNLEADZ                                     0205 01094000
         BNP   @RF00205                                            0205 01095000
*     DO;                                                          0206 01096000
*       CNOUTSTR(CHSCAN)='0';       /* INSERT SINGLE LEADING ZERO    */ 01097000
         L     @14,@PC00001+8                                      0207 01098000
         ALR   @14,CHSCAN                                          0207 01099000
         AL    @14,@CF00129                                        0207 01100000
         MVI   CNOUTSTR(@14),C'0'                                  0207 01101000
*       CHSCAN=CHSCAN+1;            /* POINT SCAN TO NEXT CHARACTER  */ 01102000
         AH    CHSCAN,@CH00065                                     0208 01103000
*     END;                                                         0209 01104000
*                                                                  0209 01105000
*   /*****************************************************************/ 01106000
*   /*                                                               */ 01107000
*   /* INSERT DECIMAL POINT IF IT WILL FIT                           */ 01108000
*   /*                                                               */ 01109000
*   /*****************************************************************/ 01110000
*                                                                  0210 01111000
*   IF CHSCAN<=CNOUTLEN THEN        /* IF DECIMAL POINT WILL FIT     */ 01112000
@RF00205 L     @14,@PC00001+12                                     0210 01113000
         C     CHSCAN,CNOUTLEN(,@14)                               0210 01114000
         BH    @RF00210                                            0210 01115000
*     DO;                                                          0211 01116000
*       CNOUTSTR(CHSCAN)='.';       /* INSERT DECIMAL POINT          */ 01117000
         L     @14,@PC00001+8                                      0212 01118000
         ALR   @14,CHSCAN                                          0212 01119000
         AL    @14,@CF00129                                        0212 01120000
         MVI   CNOUTSTR(@14),C'.'                                  0212 01121000
*       CHDECCNT=CHDECCNT+1;        /* INCREMENT COUNT OF FRACTIONAL    01122000
*                                      DIGITS PLUS DECIMAL POINT     */ 01123000
         LA    @14,1                                               0213 01124000
         AR    CHDECCNT,@14                                        0213 01125000
*       CHSCAN=CHSCAN+1;            /* POINT SCAN TO NEXT CHARACTER  */ 01126000
         AR    CHSCAN,@14                                          0214 01127000
*     END;                                                         0215 01128000
*                                                                  0215 01129000
*   /*****************************************************************/ 01130000
*   /*                                                               */ 01131000
*   /* INSERT LEADING FRACTIONAL DIGITS IF THEY WILL FIT             */ 01132000
*   /*                                                               */ 01133000
*   /*****************************************************************/ 01134000
*                                                                  0216 01135000
*   DO CHLOOPV=1 TO CNFRAZER WHILE(CHSCAN<=CNOUTLEN);              0216 01136000
@RF00210 LA    CHLOOPV,1                                           0216 01137000
         B     @DE00216                                            0216 01138000
@DL00216 L     @14,@PC00001+12                                     0216 01139000
         C     CHSCAN,CNOUTLEN(,@14)                               0216 01140000
         BH    @DC00216                                            0216 01141000
*     CNOUTSTR(CHSCAN)='0';         /* INSRT LEADING FRACTIONAL DIGIT*/ 01142000
         L     @14,@PC00001+8                                      0217 01143000
         ALR   @14,CHSCAN                                          0217 01144000
         AL    @14,@CF00129                                        0217 01145000
         MVI   CNOUTSTR(@14),C'0'                                  0217 01146000
*     CHDECCNT=CHDECCNT+1;          /* INCREMENT COUNT OF DIGITS PAST   01147000
*                                      DECIMAL POINT                 */ 01148000
         LA    @14,1                                               0218 01149000
         AR    CHDECCNT,@14                                        0218 01150000
*     CHSCAN=CHSCAN+1;              /* POINT SCAN TO NEXT CHARACTER  */ 01151000
         AR    CHSCAN,@14                                          0219 01152000
*   END;                                                           0220 01153000
         AH    CHLOOPV,@CH00065                                    0220 01154000
@DE00216 CR    CHLOOPV,CNFRAZER                                    0220 01155000
         BNH   @DL00216                                            0220 01156000
@DC00216 DS    0H                                                  0221 01157000
*   IF CHLOOPV^=CNFRAZER+1 THEN     /* NOT ALL LEADING FRACTIONAL  0221 01158000
*                                      ZEROS WOULD FIT. NO ROUNDING     01159000
*                                      IS REQUIRED.                  */ 01160000
         LA    @14,1                                               0221 01161000
         LR    @10,CNFRAZER                                        0221 01162000
         AR    @10,@14                                             0221 01163000
         CR    CHLOOPV,@10                                         0221 01164000
         BNE   @RT00221                                            0221 01165000
*     GO TO CHLAB2;                 /* TEST FOR LAST CHARACTER A   0222 01166000
*                                      DECIMAL POINT                 */ 01167000
*                                                                  0222 01168000
*   /*****************************************************************/ 01169000
*   /*                                                               */ 01170000
*   /* INSERT CONVERTED FRACTIONAL ZEROS IF THEY WILL FIT            */ 01171000
*   /*                                                               */ 01172000
*   /*****************************************************************/ 01173000
*                                                                  0223 01174000
*   DO CHLOOPV=1 TO CNFRAC WHILE(CHSCAN<=CNOUTLEN);                0223 01175000
         LR    CHLOOPV,@14                                         0223 01176000
         B     @DE00223                                            0223 01177000
@DL00223 L     @14,@PC00001+12                                     0223 01178000
         C     CHSCAN,CNOUTLEN(,@14)                               0223 01179000
         BH    @DC00223                                            0223 01180000
*     CNOUTSTR(CHSCAN)=CNFRADIG(CHLOOPV);/* INSERT CHARACTER         */ 01181000
         L     @14,@PC00001+8                                      0224 01182000
         ALR   @14,CHSCAN                                          0224 01183000
         AL    @14,@CF00129                                        0224 01184000
         LA    @10,CNFRADIG-1(CHLOOPV)                             0224 01185000
         MVC   CNOUTSTR(1,@14),0(@10)                              0224 01186000
*     CHDECCNT=CHDECCNT+1;          /* INCREMENT COUNT OF DIGITS PAST   01187000
*                                      DECIMAL POINT                 */ 01188000
         LA    @14,1                                               0225 01189000
         AR    CHDECCNT,@14                                        0225 01190000
*     CHSCAN=CHSCAN+1;              /* POINT SCAN TO NEXT CHARACTER  */ 01191000
         AR    CHSCAN,@14                                          0226 01192000
*   END;                                                           0227 01193000
         AH    CHLOOPV,@CH00065                                    0227 01194000
@DE00223 CH    CHLOOPV,CNFRAC                                      0227 01195000
         BNH   @DL00223                                            0227 01196000
@DC00223 DS    0H                                                  0228 01197000
*   IF CHLOOPV^=CNFRAC+1 THEN       /* NOT ALL FRACTIONAL CONVERTED     01198000
*                                      DIGITS INSERTED. POSSIBILITY     01199000
*                                      OF ROUND UP                   */ 01200000
         LA    @14,1                                               0228 01201000
         AH    @14,CNFRAC                                          0228 01202000
         CR    CHLOOPV,@14                                         0228 01203000
         BE    @RF00228                                            0228 01204000
*     DO;                                                          0229 01205000
*                                                                  0229 01206000
*       /*************************************************************/ 01207000
*       /*                                                           */ 01208000
*       /* IF NEXT CHARACTER WHICH WAS TO BE INSERTED IS GREATER THAN*/ 01209000
*       /* 5                                                         */ 01210000
*       /*                                                           */ 01211000
*       /*************************************************************/ 01212000
*                                                                  0230 01213000
*       IF CNFRADIG(CHLOOPV)>='5' THEN                             0230 01214000
         LA    @14,CNFRADIG-1(CHLOOPV)                             0230 01215000
         CLI   0(@14),C'5'                                         0230 01216000
         BL    @RF00230                                            0230 01217000
*         CHRNDUP='1'B;             /* SET ROUND UP FLAG             */ 01218000
         OI    CHRNDUP,B'10000000'                                 0231 01219000
*     END;                                                         0232 01220000
*                                                                  0232 01221000
@RF00230 DS    0H                                                  0233 01222000
*   /*****************************************************************/ 01223000
*   /*                                                               */ 01224000
*   /* FILL WITH ZEROS IF NECESSARY                                  */ 01225000
*   /*                                                               */ 01226000
*   /*****************************************************************/ 01227000
*                                                                  0233 01228000
*   DO WHILE(CHSCAN<=CNOUTLEN);     /* LOOP THROUGH TO END OF STRING */ 01229000
@RF00228 B     @DE00233                                            0233 01230000
@DL00233 DS    0H                                                  0234 01231000
*     CNOUTSTR(CHSCAN)='0';         /* INSERT FILL ZERO              */ 01232000
         L     @14,@PC00001+8                                      0234 01233000
         ALR   @14,CHSCAN                                          0234 01234000
         AL    @14,@CF00129                                        0234 01235000
         MVI   CNOUTSTR(@14),C'0'                                  0234 01236000
*     CHDECCNT=CHDECCNT+1;          /* INCREMENT COUNT OF DIGITS PAST   01237000
*                                      DECIMAL POINT                 */ 01238000
         LA    @14,1                                               0235 01239000
         AR    CHDECCNT,@14                                        0235 01240000
*     CHSCAN=CHSCAN+1;              /* POINT TO NEXT CHARACTER       */ 01241000
         AR    CHSCAN,@14                                          0236 01242000
*   END;                                                           0237 01243000
*                                                                  0237 01244000
@DE00233 L     @14,@PC00001+12                                     0237 01245000
         C     CHSCAN,CNOUTLEN(,@14)                               0237 01246000
         BNH   @DL00233                                            0237 01247000
*   /*****************************************************************/ 01248000
*   /*                                                               */ 01249000
*   /* IF LAST CHARACTER IS A DECIMAL POINT, SHIFT RIGHT BY ONE      */ 01250000
*   /* CHARACTER                                                     */ 01251000
*   /*                                                               */ 01252000
*   /*****************************************************************/ 01253000
*                                                                  0238 01254000
*CHLAB2:                                                           0238 01255000
*   IF CNOUTSTR(CNOUTLEN)='.' THEN                                 0238 01256000
CHLAB2   L     @14,@PC00001+12                                     0238 01257000
         L     @14,CNOUTLEN(,@14)                                  0238 01258000
         L     @10,@PC00001+8                                      0238 01259000
         ALR   @14,@10                                             0238 01260000
         AL    @14,@CF00129                                        0238 01261000
         CLI   CNOUTSTR(@14),C'.'                                  0238 01262000
         BNE   @RF00238                                            0238 01263000
*     DO;                                                          0239 01264000
*                                                                  0239 01265000
*       /*************************************************************/ 01266000
*       /*                                                           */ 01267000
*       /* SHIFT RIGHT ONE CHARACTER                                 */ 01268000
*       /*                                                           */ 01269000
*       /*************************************************************/ 01270000
*                                                                  0240 01271000
*       CNOUTSTR(2:CNOUTLEN)=CNOUTSTR(1:CNOUTLEN-1);               0240 01272000
         L     @14,@PC00001+12                                     0240 01273000
         L     @14,CNOUTLEN(,@14)                                  0240 01274000
         BCTR  @14,0                                               0240 01275000
         BCTR  @14,0                                               0240 01276000
         MVC   @TS00001(256),CNOUTSTR(@10)                         0240 01277000
         EX    @14,@SM00154                                        0240 01278000
*       CNOUTSTR(1)=' ';            /* FILL WITH LEADING BLANK       */ 01279000
         MVI   CNOUTSTR(@10),C' '                                  0241 01280000
*     END;                                                         0242 01281000
*   IF CHRNDUP='1'B THEN            /* IF ROUND UP NECESSARY         */ 01282000
@RF00238 TM    CHRNDUP,B'10000000'                                 0243 01283000
         BNO   @RF00243                                            0243 01284000
*     DO;                                                          0244 01285000
*                                                                  0244 01286000
*       /*************************************************************/ 01287000
*       /*                                                           */ 01288000
*       /* STEP BACK THROUGH STRING IN OUTPUT FIELD UNTIL ROUND CAN  */ 01289000
*       /* BE PERFORMED. QUIT IF BLANK OR MINUS SIGN IS ENCOUNTERED. */ 01290000
*       /* FIRST ZERO COMMA CONTROL VARIABLE.                        */ 01291000
*       /*                                                           */ 01292000
*       /*************************************************************/ 01293000
*                                                                  0245 01294000
*       CHCOMCNT=0;                                                0245 01295000
         SR    CHCOMCNT,CHCOMCNT                                   0245 01296000
*       DO CHLOOPV=CNOUTLEN TO 1 BY-1 WHILE CNOUTSTR(CHLOOPV)^=' '&     01297000
*             CNOUTSTR(CHLOOPV)^='-';                              0246 01298000
         L     @14,@PC00001+12                                     0246 01299000
         L     CHLOOPV,CNOUTLEN(,@14)                              0246 01300000
         B     @DE00246                                            0246 01301000
@DL00246 L     @14,@PC00001+8                                      0246 01302000
         LR    @10,@14                                             0246 01303000
         ALR   @10,CHLOOPV                                         0246 01304000
         AL    @10,@CF00129                                        0246 01305000
         CLI   CNOUTSTR(@10),C' '                                  0246 01306000
         BE    @DC00246                                            0246 01307000
         LR    @10,@14                                             0246 01308000
         ALR   @10,CHLOOPV                                         0246 01309000
         AL    @10,@CF00129                                        0246 01310000
         CLI   CNOUTSTR(@10),C'-'                                  0246 01311000
         BE    @DC00246                                            0246 01312000
*         IF CNOUTSTR(CHLOOPV)='.'|CNOUTSTR(CHLOOPV)=',' THEN      0247 01313000
         LR    @10,@14                                             0247 01314000
         ALR   @10,CHLOOPV                                         0247 01315000
         AL    @10,@CF00129                                        0247 01316000
         CLI   CNOUTSTR(@10),C'.'                                  0247 01317000
         BE    @RT00247                                            0247 01318000
         ALR   @14,CHLOOPV                                         0247 01319000
         AL    @14,@CF00129                                        0247 01320000
         CLI   CNOUTSTR(@14),C','                                  0247 01321000
         BNE   @RF00247                                            0247 01322000
@RT00247 DS    0H                                                  0248 01323000
*           DO;                     /* DECIMAL POINT OR COMMA      0248 01324000
*                                      ENCOUNTERED                   */ 01325000
*             CHCOMCNT=0;           /* ZERO COMMA CONTROL VARIABLE   */ 01326000
         SR    CHCOMCNT,CHCOMCNT                                   0249 01327000
*             GO TO CHLAB3;         /* COMPLETE ROUNDING OPERATION   */ 01328000
         B     CHLAB3                                              0250 01329000
*           END;                                                   0251 01330000
*                                                                  0251 01331000
*         /***********************************************************/ 01332000
*         /*                                                         */ 01333000
*         /* IF CURRENT CHARACTER IS A NINE, SET IT TO ZERO AND      */ 01334000
*         /* PROPAGATE CARRY TO NEXT CHARACTER                       */ 01335000
*         /*                                                         */ 01336000
*         /***********************************************************/ 01337000
*                                                                  0252 01338000
*         IF CNOUTSTR(CHLOOPV)='9' THEN                            0252 01339000
@RF00247 L     @14,@PC00001+8                                      0252 01340000
         LR    @10,@14                                             0252 01341000
         ALR   @10,CHLOOPV                                         0252 01342000
         AL    @10,@CF00129                                        0252 01343000
         CLI   CNOUTSTR(@10),C'9'                                  0252 01344000
         BNE   @RF00252                                            0252 01345000
*           DO;                                                    0253 01346000
*             CNOUTSTR(CHLOOPV)='0';                               0254 01347000
         ALR   @14,CHLOOPV                                         0254 01348000
         AL    @14,@CF00129                                        0254 01349000
         MVI   CNOUTSTR(@14),C'0'                                  0254 01350000
*             CHCOMCNT=CHCOMCNT+1;  /* INCREMENT COMMA CONTROL VBL.  */ 01351000
         AH    CHCOMCNT,@CH00065                                   0255 01352000
*           END;                                                   0256 01353000
*         ELSE                      /* FINAL ROUNDING OPERATION CAN     01354000
*                                      BE PERFORMED                  */ 01355000
*           DO;                                                    0257 01356000
*                                                                  0257 01357000
         B     @RC00252                                            0257 01358000
@RF00252 DS    0H                                                  0258 01359000
*             /*******************************************************/ 01360000
*             /*                                                     */ 01361000
*             /* SET F0-F8 TO F1-F9                                  */ 01362000
*             /*                                                     */ 01363000
*             /*******************************************************/ 01364000
*                                                                  0258 01365000
*             CNOUTSTR(CHLOOPV)=CNOUTSTR(CHLOOPV)+1;               0258 01366000
         L     @14,@PC00001+8                                      0258 01367000
         LA    @10,1                                               0258 01368000
         LR    @07,CHLOOPV                                         0258 01369000
         AL    @07,@CF00129                                        0258 01370000
         SR    @05,@05                                             0258 01371000
         IC    @05,CNOUTSTR(@07,@14)                               0258 01372000
         AR    @10,@05                                             0258 01373000
         AL    @14,@CF00129                                        0258 01374000
         STC   @10,CNOUTSTR(CHLOOPV,@14)                           0258 01375000
*             GO TO CHLAB4;         /* REMOVE MINUS FROM ALL ZEROS   */ 01376000
         B     CHLAB4                                              0259 01377000
*           END;                                                   0260 01378000
*CHLAB3:                            /* ROUNDING LOOP COMPLETED       */ 01379000
*       END;                                                       0261 01380000
*                                                                  0261 01381000
@RC00252 DS    0H                                                  0261 01382000
CHLAB3   BCTR  CHLOOPV,0                                           0261 01383000
@DE00246 LTR   CHLOOPV,CHLOOPV                                     0261 01384000
         BP    @DL00246                                            0261 01385000
@DC00246 DS    0H                                                  0262 01386000
*       /*************************************************************/ 01387000
*       /*                                                           */ 01388000
*       /* LOOP ENDED AND THE CARRY OPERATION COULD NOT BE COMPLETED */ 01389000
*       /* BECAUSE ALL DIGITS WERE NINES. A '1' OR POSSIBLE '1,' MUST*/ 01390000
*       /* BE INSERTED TO COMPLETE THE ROUNDING OPERATION. IF THERE  */ 01391000
*       /* IS ROOM, INSERT AND SHIFT AS NECESSARY. OTHERWISE, RETURN */ 01392000
*       /* CODE 4 TO THE MAINLINE PROCEDURE. IF FLOATING IS IN       */ 01393000
*       /* CONTROL, THE DIGITS TO THE RIGHT OF THE DECIMAL POINT     */ 01394000
*       /* (CHDECCNT) IS TH AMOUNT OF SPACE AVAILABLE FOR THE INSERT.*/ 01395000
*       /* IF FLOATING IS NOT BEING PERFORMED, THEN THE NUMBER OF    */ 01396000
*       /* BLANKS TO THE LEFT OF THE (POSSIBLE) MINUS SIGN IS THE    */ 01397000
*       /* SPACE AVAILABLE FOR THE INSERT. FIRST DETERMINE INSERTION */ 01398000
*       /* CHARACTERS AND LENGTH.                                    */ 01399000
*       /*                                                           */ 01400000
*       /*************************************************************/ 01401000
*                                                                  0262 01402000
*       IF CHCOMCNT=3&CNSSIGCM='1'B THEN                           0262 01403000
         CH    CHCOMCNT,@CH00098                                   0262 01404000
         BNE   @RF00262                                            0262 01405000
         TM    CNSSIGCM,B'10000000'                                0262 01406000
         BNO   @RF00262                                            0262 01407000
*         DO;                       /* TIME FOR A COMMA AND THEY WERE   01408000
*                                      REQUESTED                     */ 01409000
*           CHINSERT='1,';                                         0264 01410000
         MVC   CHINSERT(2),@CC00134                                0264 01411000
*           CHINSLEN=2;                                            0265 01412000
         LA    CHINSLEN,2                                          0265 01413000
*         END;                                                     0266 01414000
*       ELSE                        /* NO COMMAS NEEDED              */ 01415000
*         DO;                                                      0267 01416000
         B     @RC00262                                            0267 01417000
@RF00262 DS    0H                                                  0268 01418000
*           CHINSERT='1';                                          0268 01419000
         MVI   CHINSERT+1,C' '                                     0268 01420000
         MVI   CHINSERT,C'1'                                       0268 01421000
*           CHINSLEN=1;                                            0269 01422000
         LA    CHINSLEN,1                                          0269 01423000
*         END;                                                     0270 01424000
*                                                                  0270 01425000
*       /*************************************************************/ 01426000
*       /*                                                           */ 01427000
*       /* NOW TRY TO INSERT STRING                                  */ 01428000
*       /*                                                           */ 01429000
*       /*************************************************************/ 01430000
*                                                                  0271 01431000
*       IF CNIFLOAT='1'B THEN       /* FLOATING                      */ 01432000
@RC00262 TM    CNIFLOAT,B'10000000'                                0271 01433000
         BNO   @RF00271                                            0271 01434000
*         DO;                                                      0272 01435000
*                                                                  0272 01436000
*           /*********************************************************/ 01437000
*           /*                                                       */ 01438000
*           /* DETERMINE INSERTION POINT                             */ 01439000
*           /*                                                       */ 01440000
*           /*********************************************************/ 01441000
*                                                                  0273 01442000
*           IF CNOUTSTR(1)='-' THEN                                0273 01443000
         L     @14,@PC00001+8                                      0273 01444000
         CLI   CNOUTSTR(@14),C'-'                                  0273 01445000
         BNE   @RF00273                                            0273 01446000
*             CHINSSRT=2;           /* INSERT BEHIND MINUS SIGN      */ 01447000
         LA    CHINSSRT,2                                          0274 01448000
*           ELSE                                                   0275 01449000
*             CHINSSRT=1;           /* INSERT AT BEGINNING           */ 01450000
*                                                                  0275 01451000
         B     @RC00273                                            0275 01452000
@RF00273 LA    CHINSSRT,1                                          0275 01453000
*           /*********************************************************/ 01454000
*           /*                                                       */ 01455000
*           /* INSERT STRING IF POSSIBLE                             */ 01456000
*           /*                                                       */ 01457000
*           /*********************************************************/ 01458000
*                                                                  0276 01459000
*           IF CHDECCNT>=CHINSLEN THEN                             0276 01460000
@RC00273 CR    CHDECCNT,CHINSLEN                                   0276 01461000
         BL    @RF00276                                            0276 01462000
*             DO;                   /* HAVE AVAILABLE SPACE          */ 01463000
*                                                                  0277 01464000
*               /*****************************************************/ 01465000
*               /*                                                   */ 01466000
*               /* SHIFT STRING                                      */ 01467000
*               /*                                                   */ 01468000
*               /*****************************************************/ 01469000
*                                                                  0278 01470000
*               CNOUTSTR(CHINSSRT+CHINSLEN:CNOUTLEN)=CNOUTSTR(CHINSSRT: 01471000
*                   CNOUTLEN-CHINSLEN);                            0278 01472000
*                                                                  0278 01473000
         LR    @14,CHINSSRT                                        0278 01474000
         AR    @14,CHINSLEN                                        0278 01475000
         L     @10,@PC00001+8                                      0278 01476000
         ST    @14,@TF00001                                        0278 01477000
         ALR   @14,@10                                             0278 01478000
         AL    @14,@CF00129                                        0278 01479000
         L     @07,@PC00001+12                                     0278 01480000
         L     @07,CNOUTLEN(,@07)                                  0278 01481000
         S     @07,@TF00001                                        0278 01482000
         LR    @05,@10                                             0278 01483000
         ALR   @05,CHINSSRT                                        0278 01484000
         AL    @05,@CF00129                                        0278 01485000
         MVC   @TS00001(256),CNOUTSTR(@05)                         0278 01486000
         EX    @07,@SM00156                                        0278 01487000
*               /*****************************************************/ 01488000
*               /*                                                   */ 01489000
*               /* INSERT TEXT                                       */ 01490000
*               /*                                                   */ 01491000
*               /*****************************************************/ 01492000
*                                                                  0279 01493000
*               CNOUTSTR(CHINSSRT:CHINSSRT+CHINSLEN-1)=CHINSERT(1: 0279 01494000
*                   CHINSLEN);                                     0279 01495000
         ALR   @10,CHINSSRT                                        0279 01496000
         AL    @10,@CF00129                                        0279 01497000
         LR    @14,CHINSLEN                                        0279 01498000
         BCTR  @14,0                                               0279 01499000
         EX    @14,@SM00158                                        0279 01500000
*             END;                                                 0280 01501000
*           ELSE                    /* DONT HAVE SPACE               */ 01502000
*             RETURN CODE(4);       /* RETURN TO REPORT GENERATOR    */ 01503000
*                                                                  0281 01504000
         B     @RC00276                                            0281 01505000
@RF00276 LA    @15,4                                               0281 01506000
         L     @14,12(,@13)                                        0281 01507000
         LM    @00,@12,20(@13)                                     0281 01508000
         BR    @14                                                 0281 01509000
*           /*********************************************************/ 01510000
*           /*                                                       */ 01511000
*           /* SHIFT MAY HAVE PLACED DECIMAL POINT IN RIGHT-HAND     */ 01512000
*           /* POSITION. IF SO, SHIFT RIGHT BY ONE                   */ 01513000
*           /*                                                       */ 01514000
*           /*********************************************************/ 01515000
*                                                                  0282 01516000
*           IF CNOUTSTR(CNOUTLEN)='.' THEN                         0282 01517000
@RC00276 L     @14,@PC00001+12                                     0282 01518000
         L     @14,CNOUTLEN(,@14)                                  0282 01519000
         L     @10,@PC00001+8                                      0282 01520000
         ALR   @14,@10                                             0282 01521000
         AL    @14,@CF00129                                        0282 01522000
         CLI   CNOUTSTR(@14),C'.'                                  0282 01523000
         BNE   @RF00282                                            0282 01524000
*             DO;                                                  0283 01525000
*               CNOUTSTR(2:CNOUTLEN)=CNOUTSTR(1:CNOUTLEN-1);       0284 01526000
         L     @14,@PC00001+12                                     0284 01527000
         L     @14,CNOUTLEN(,@14)                                  0284 01528000
         BCTR  @14,0                                               0284 01529000
         BCTR  @14,0                                               0284 01530000
         MVC   @TS00001(256),CNOUTSTR(@10)                         0284 01531000
         EX    @14,@SM00154                                        0284 01532000
*               CNOUTSTR(1)=' ';    /* FILL WITH LEADING BLANK.      */ 01533000
         MVI   CNOUTSTR(@10),C' '                                  0285 01534000
*             END;                                                 0286 01535000
*         END;                                                     0287 01536000
*       ELSE                        /* NOT FLOATING                  */ 01537000
*         DO;                                                      0288 01538000
*                                                                  0288 01539000
         B     @RC00271                                            0288 01540000
@RF00271 DS    0H                                                  0289 01541000
*           /*********************************************************/ 01542000
*           /*                                                       */ 01543000
*           /* DETERMINE AVAILABLE SPACE                             */ 01544000
*           /*                                                       */ 01545000
*           /*********************************************************/ 01546000
*                                                                  0289 01547000
*           IF CHLOOPV=0 THEN       /* NO SPACE                      */ 01548000
         LTR   CHLOOPV,CHLOOPV                                     0289 01549000
         BNZ   @RF00289                                            0289 01550000
*             RETURN CODE(4);       /* RETURN TO REPORT GENERATOR    */ 01551000
         LA    @15,4                                               0290 01552000
         L     @14,12(,@13)                                        0290 01553000
         LM    @00,@12,20(@13)                                     0290 01554000
         BR    @14                                                 0290 01555000
*           IF CNOUTSTR(CHLOOPV)='-'&CHLOOPV<CHINSLEN+1|CNOUTSTR(  0291 01556000
*               CHLOOPV)=' '&CHLOOPV<CHINSLEN THEN                 0291 01557000
@RF00289 L     @14,@PC00001+8                                      0291 01558000
         ALR   @14,CHLOOPV                                         0291 01559000
         AL    @14,@CF00129                                        0291 01560000
         CLI   CNOUTSTR(@14),C'-'                                  0291 01561000
         BNE   @GL00008                                            0291 01562000
         LA    @14,1                                               0291 01563000
         AR    @14,CHINSLEN                                        0291 01564000
         CR    CHLOOPV,@14                                         0291 01565000
         BL    @RT00291                                            0291 01566000
@GL00008 L     @14,@PC00001+8                                      0291 01567000
         ALR   @14,CHLOOPV                                         0291 01568000
         AL    @14,@CF00129                                        0291 01569000
         CLI   CNOUTSTR(@14),C' '                                  0291 01570000
         BNE   @RF00291                                            0291 01571000
         CR    CHLOOPV,CHINSLEN                                    0291 01572000
         BNL   @RF00291                                            0291 01573000
@RT00291 DS    0H                                                  0292 01574000
*             RETURN CODE(4);       /* NOT ENOUGH SPACE              */ 01575000
         LA    @15,4                                               0292 01576000
         L     @14,12(,@13)                                        0292 01577000
         LM    @00,@12,20(@13)                                     0292 01578000
         BR    @14                                                 0292 01579000
*           ELSE                    /* SPACE IS AVAILABLE            */ 01580000
*             DO;                   /* INSERT STRING                 */ 01581000
@RF00291 DS    0H                                                  0294 01582000
*               IF CNOUTSTR(CHLOOPV)='-' THEN                      0294 01583000
*                                                                  0294 01584000
         L     @14,@PC00001+8                                      0294 01585000
         LR    @10,@14                                             0294 01586000
         ALR   @10,CHLOOPV                                         0294 01587000
         AL    @10,@CF00129                                        0294 01588000
         CLI   CNOUTSTR(@10),C'-'                                  0294 01589000
         BNE   @RF00294                                            0294 01590000
*                 /***************************************************/ 01591000
*                 /*                                                 */ 01592000
*                 /* MOVE MINUS SIGN                                 */ 01593000
*                 /*                                                 */ 01594000
*                 /***************************************************/ 01595000
*                                                                  0295 01596000
*                 CNOUTSTR(CHLOOPV-CHINSLEN)='-';                  0295 01597000
*                                                                  0295 01598000
         LR    @10,CHLOOPV                                         0295 01599000
         SR    @10,CHINSLEN                                        0295 01600000
         ALR   @14,@10                                             0295 01601000
         AL    @14,@CF00129                                        0295 01602000
         MVI   CNOUTSTR(@14),C'-'                                  0295 01603000
*               /*****************************************************/ 01604000
*               /*                                                   */ 01605000
*               /* INSERT STRING                                     */ 01606000
*               /*                                                   */ 01607000
*               /*****************************************************/ 01608000
*                                                                  0296 01609000
*               CNOUTSTR(CHLOOPV-CHINSLEN+1:CHLOOPV)=CHINSERT(1:   0296 01610000
*                   CHINSLEN);                                     0296 01611000
@RF00294 LR    @14,CHLOOPV                                         0296 01612000
         SR    @14,CHINSLEN                                        0296 01613000
         L     @10,@PC00001+8                                      0296 01614000
         ALR   @10,@14                                             0296 01615000
         LCR   @14,@14                                             0296 01616000
         AR    @14,CHLOOPV                                         0296 01617000
         BCTR  @14,0                                               0296 01618000
         EX    @14,@SM00158                                        0296 01619000
*             END;                                                 0297 01620000
*         END;                                                     0298 01621000
*     END;                                                         0299 01622000
@RC00271 DS    0H                                                  0300 01623000
*CHLAB4:                                                           0300 01624000
*                                                                  0300 01625000
*   /*****************************************************************/ 01626000
*   /*                                                               */ 01627000
*   /* IF NUMBER IS -XXX... WHERE XXX ARE ALL ZERO, REMOVE MINUS     */ 01628000
*   /* SIGN. STEP BACK THROUGH STRING DISREGARDING COMMAS AND DECIMAL*/ 01629000
*   /* POINTS UNTIL A BLANK OR MINUS SIGN IS REACHED                 */ 01630000
*   /*                                                               */ 01631000
*   /*****************************************************************/ 01632000
*                                                                  0300 01633000
*   DO CHLOOPV=CNOUTLEN TO 1 BY-1 WHILE CNOUTSTR(CHLOOPV)^=' '&CNOUTSTR 01634000
*         (CHLOOPV)^='-';                                          0300 01635000
@RF00243 DS    0H                                                  0300 01636000
CHLAB4   L     @14,@PC00001+12                                     0300 01637000
         L     CHLOOPV,CNOUTLEN(,@14)                              0300 01638000
         B     @DE00300                                            0300 01639000
@DL00300 L     @14,@PC00001+8                                      0300 01640000
         LR    @10,@14                                             0300 01641000
         ALR   @10,CHLOOPV                                         0300 01642000
         AL    @10,@CF00129                                        0300 01643000
         CLI   CNOUTSTR(@10),C' '                                  0300 01644000
         BE    @DC00300                                            0300 01645000
         LR    @10,@14                                             0300 01646000
         ALR   @10,CHLOOPV                                         0300 01647000
         AL    @10,@CF00129                                        0300 01648000
         CLI   CNOUTSTR(@10),C'-'                                  0300 01649000
         BE    @DC00300                                            0300 01650000
*     IF CNOUTSTR(CHLOOPV)='.'|CNOUTSTR(CHLOOPV)=',' THEN          0301 01651000
         LR    @10,@14                                             0301 01652000
         ALR   @10,CHLOOPV                                         0301 01653000
         AL    @10,@CF00129                                        0301 01654000
         CLI   CNOUTSTR(@10),C'.'                                  0301 01655000
         BE    @RT00301                                            0301 01656000
         LR    @10,@14                                             0301 01657000
         ALR   @10,CHLOOPV                                         0301 01658000
         AL    @10,@CF00129                                        0301 01659000
         CLI   CNOUTSTR(@10),C','                                  0301 01660000
         BE    @RT00301                                            0301 01661000
*       GO TO CHLAB5;               /* IGNORE DECIMAL POINT OR COMMA */ 01662000
*     IF CNOUTSTR(CHLOOPV)^='0' THEN                               0303 01663000
         ALR   @14,CHLOOPV                                         0303 01664000
         AL    @14,@CF00129                                        0303 01665000
         CLI   CNOUTSTR(@14),C'0'                                  0303 01666000
         BNE   @RT00303                                            0303 01667000
*       GO TO CHLAB6;               /* NON-ZERO, QUIT                */ 01668000
*CHLAB5:                            /* TEST FOR MINUS SIGN AND REMOVE   01669000
*                                      IF IT EXISTS                  */ 01670000
*   END;                                                           0305 01671000
CHLAB5   BCTR  CHLOOPV,0                                           0305 01672000
@DE00300 LTR   CHLOOPV,CHLOOPV                                     0305 01673000
         BP    @DL00300                                            0305 01674000
@DC00300 DS    0H                                                  0306 01675000
*   IF CHLOOPV=0 THEN               /* NO MINUS SIGN                 */ 01676000
         LTR   CHLOOPV,CHLOOPV                                     0306 01677000
         BZ    @RT00306                                            0306 01678000
*     GO TO CHLAB6;                 /* QUIT                          */ 01679000
*   IF CNOUTSTR(CHLOOPV)='-' THEN                                  0308 01680000
         L     @14,@PC00001+8                                      0308 01681000
         LR    @10,@14                                             0308 01682000
         ALR   @10,CHLOOPV                                         0308 01683000
         AL    @10,@CF00129                                        0308 01684000
         CLI   CNOUTSTR(@10),C'-'                                  0308 01685000
         BNE   @RF00308                                            0308 01686000
*     CNOUTSTR(CHLOOPV)=' ';        /* REMOVE MINUS SIGN             */ 01687000
         ALR   @14,CHLOOPV                                         0309 01688000
         AL    @14,@CF00129                                        0309 01689000
         MVI   CNOUTSTR(@14),C' '                                  0309 01690000
*CHLAB6:                                                           0310 01691000
*   RETURN CODE(0);                 /* RETURN TO CALLER              */ 01692000
@RF00308 DS    0H                                                  0310 01693000
CHLAB6   SR    @15,@15                                             0310 01694000
         L     @14,12(,@13)                                        0310 01695000
         LM    @00,@12,20(@13)                                     0310 01696000
         BR    @14                                                 0310 01697000
*   END;                                                           0311 01698000
*   END;                                                           0312 01699000
@EL00001 L     @13,4(,@13)                                         0312 01700000
@EF00001 L     @00,@SIZDATD                                        0312 01701000
         LR    @01,@11                                             0312 01702000
         FREEMAIN R,LV=(0),A=(1)                                        01703000
@ER00001 LM    @14,@12,12(@13)                                     0312 01704000
         BR    @14                                                 0312 01705000
@DATA    DS    0H                                                       01706000
@CH00098 DC    H'3'                                                     01707000
@CH00056 DC    H'256'                                                   01708000
@SM00144 MVC   CNSIGDIG(0),0(@07)                                       01709000
@SM00146 MVC   CNFRADIG(0),0(@10)                                       01710000
@SM00148 MVC   CNSIGDIG(0),0(@10)                                       01711000
@SM00150 MVC   CNFRADIG(0),0(@02)                                       01712000
@SM00152 MVC   CNOUTSTR(0,@14),CNSIGDIG                                 01713000
@SM00154 MVC   CNOUTSTR+1(0,@10),@TS00001                               01714000
@SM00156 MVC   CNOUTSTR(0,@14),@TS00001                                 01715000
@SM00158 MVC   CNOUTSTR(0,@10),CHINSERT                                 01716000
         DS    0F                                                       01717000
@AL00128 EQU   *                       LIST WITH   1 ARGUMENT(S)        01718000
@AL00140 DC    A(@CF00065)             LIST WITH   1 ARGUMENT(S)        01719000
@DATD    DSECT                                                          01720000
         DS    0F                                                       01721000
@SA00001 DS    18F                                                      01722000
@PC00001 DS    7F                                                       01723000
@PC00002 DS    1F                                                       01724000
@AL00001 DS    1A                                                       01725000
@TF00001 DS    F                                                        01726000
@AFTEMPS DS    1F                                                       01727000
IRBMFCNV CSECT                                                          01728000
         DS    0F                                                       01729000
@CF00129 DC    F'-1'                                                    01730000
@CF00065 DC    F'1'                                                     01731000
@CH00065 EQU   @CF00065+2                                               01732000
@DATD    DSECT                                                          01733000
         DS    0D                                                       01734000
CNMINUS  DS    H                                                        01735000
CNFRAC   DS    H                                                        01736000
@TS00001 DS    CL256                                                    01737000
         DS    CL4                                                      01738000
CNPAKSTR DS    CL8                                                      01739000
CNWRKSTR DS    CL16                                                     01740000
CNSIGDIG DS    CL10                                                     01741000
CNFRADIG DS    CL10                                                     01742000
CNSSIGCM DS    BL1                                                      01743000
CNSFRAZR DS    BL1                                                      01744000
CNIFLOAT DS    BL1                                                      01745000
CHINSERT DS    CL2                                                      01746000
CHRNDUP  DS    BL1                                                      01747000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                01748000
@ENDDATD EQU   *                                                        01749000
IRBMFCNV CSECT                                                          01750000
         DS    0F                                                       01751000
@SIZDATD DC    AL1(0)                                                   01752000
         DC    AL3(@ENDDATD-@DATD)                                      01753000
         DS    0D                                                       01754000
@CC00134 DC    C'1,'                                                    01755000
COMMA    DC    CL1','                                                   01756000
CNPATCH  DS    CL100                                                    01757000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       01758000
@01      EQU   01                                                       01759000
@02      EQU   02                                                       01760000
@03      EQU   03                                                       01761000
@04      EQU   04                                                       01762000
@05      EQU   05                                                       01763000
@06      EQU   06                                                       01764000
@07      EQU   07                                                       01765000
@08      EQU   08                                                       01766000
@09      EQU   09                                                       01767000
@10      EQU   10                                                       01768000
@11      EQU   11                                                       01769000
@12      EQU   12                                                       01770000
@13      EQU   13                                                       01771000
@14      EQU   14                                                       01772000
@15      EQU   15                                                       01773000
CHSCAN   EQU   @03                                                      01774000
CHDECCNT EQU   @07                                                      01775000
CHINSLEN EQU   @03                                                      01776000
CHINSSRT EQU   @02                                                      01777000
CHCOMCNT EQU   @05                                                      01778000
CHLOOPV  EQU   @02                                                      01779000
CNFRAZER EQU   @09                                                      01780000
CNLEADZ  EQU   @08                                                      01781000
CNSIGZER EQU   @06                                                      01782000
CNSIGNFC EQU   @03                                                      01783000
CNSIGNF  EQU   @04                                                      01784000
CNRETCDE EQU   @05                                                      01785000
CNPLACES EQU   @02                                                      01786000
CNLOOPV  EQU   @02                                                      01787000
GPR15F   EQU   @15                                                      01788000
GPR00P   EQU   @00                                                      01789000
GPR01P   EQU   @01                                                      01790000
GPR14P   EQU   @14                                                      01791000
GPR15P   EQU   @15                                                      01792000
GPR00F   EQU   @00                                                      01793000
GPR01F   EQU   @01                                                      01794000
GPR14F   EQU   @14                                                      01795000
IKEBC    EQU   0                                                        01796000
IKEBF15  EQU   0                                                        01797000
IKEBF31  EQU   0                                                        01798000
IKEBP15  EQU   0                                                        01799000
IKEBP31  EQU   0                                                        01800000
IKEBP8   EQU   0                                                        01801000
CNINPUT  EQU   0                                                        01802000
CNINSCAL EQU   0                                                        01803000
CNOUTSTR EQU   0                                                        01804000
CNOUTLEN EQU   0                                                        01805000
CNOUFRAC EQU   0                                                        01806000
CNCOMMAS EQU   0                                                        01807000
CNFLOAT  EQU   0                                                        01808000
CHSTART  EQU   0                                                        01809000
@RT00102 EQU   CNLAB2                                                   01810000
@RT00165 EQU   CHLAB1                                                   01811000
@RT00221 EQU   CHLAB2                                                   01812000
@RF00282 EQU   @RC00271                                                 01813000
@RT00301 EQU   CHLAB5                                                   01814000
@RT00303 EQU   CHLAB6                                                   01815000
@RT00306 EQU   CHLAB6                                                   01816000
@PB00002 EQU   @EL00001                                                 01817000
@ENDDATA EQU   *                                                        01818000
         END   IRBMFCNV,(C'PL/S-II',0502,74087)                         01819000
