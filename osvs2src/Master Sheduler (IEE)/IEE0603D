         TITLE 'SET COMMAND SYNTAX CHECKER - MODULE IEE0603D'           00030002
IEE0603D CSECT                                                          00032001
* C 000798,001874-001877,128292-128392                           YM4026 00032401
* D 000983-000984,001762,126792-127292,146792-148292             YM4026 00032801
*********************************************************************** 00034001
*                                                                     * 00036001
*TITLE:  IEE0603D---SET COMMAND SYNTAX CHECKER - MODULE IEE0603D      * 00038002
*                                                                     * 00038401
*FUNCTION: ACCEPTS THE PARAMETERS OF THE SET COMMAND: CLOCK,    Y01040* 00038801
*   DATE, RESET, AND IPS, PLUS THE GMT AND ADDR PARAMETERS      Y02759* 00039202
*   (VALID ONLY DURING IPL, VARY CPU ONLINE, AND TOD CLOCK      Y02759* 00039902
*   RECOVERY) AND PROCEEDS AS FOLLOWS:                          Y02759* 00040602
*   IF TIME AND/OR DATE IS SPECIFIED WITHOUT GMT, OR IF RESET   Y02759* 00041302
*   IS SPECIFIED, IEE6503D IS CALLED.  IF GMT OR ADDR IS        Y02759* 00042002
*   SPECIFIED, IEE6603D IS CALLED.  ON RETURN FROM EITHER,      Y02759* 00042702
*   IF IPS WAS SPECIFIED, CONTROL IS PASSED TO IEE0803D.        Y02759* 00043402
*   OTHERWISE, CONTROL IS RETURNED TO THE CALLER.               Y02759* 00044102
*   IN ADDITION, POSITIVE SYNTAX CHECKING IS PERFORMED ON KEYWORDS    * 00044802
*   AND PARAMETERS.                                                   * 00046002
*                                                                     * 00047202
*ENTRY POINT: IEE0603D - FROM COMMAND ROUTER MODULE, IEE0403D.        * 00048402
*ATTRIBUTES: REENTRANT, READ ONLY AND SELF-RELOCATABLE.         Y01040* 00049602
*                                                                     * 00050802
*EXTERNAL REFERENCES:                                                 * 00052002
*   MASTER RESIDENT CORE, USING MACRO IEEBASEA                        * 00053202
*   EXTENDED SAVE AREA(XSA), USING MACRO IEEXSA                       * 00054402
*   COMMUNICATIONS VECTOR TABLE USING MACRO CVT                       * 00055602
*   TIMER SUPERVISOR WORKAREA(TPC), USING MACRO IEAVVTPC        Y02759* 00056002
*   TOD CLOCK WORKAREA                                          Y02759* 00056402
*                                                                     * 00056802
*MACROS: IEEXSA, IEEBASEA, AND CVT                              Y01040* 00058002
*                                                                     * 00059202
*INPUT: REGISTER 2 POINTING TO THE EXTENDED SAVE AREA WHICH MUST      * 00060402
*   CONTAIN: IN XAR, A POINTER TO THE COMMAND BUFFER                  * 00061602
*            IN XAL, A POINTER TO THE PARAMETER LIST (FIRST KEYWORD)  * 00062802
*       REGISTER 10 POINTING TO MASTER RESIDENT CORE (IEEBASEA)   M2081 00064002
*                                                                     * 00065202
*OUTPUT: FOR A NORMAL EXIT TO IEE6503D, THE SET LOCAL TIME ROUTINE:   * 00066402
*          R2 POINTS TO THE EXTENDED SAVE AREA:                 Y02759* 00068402
*          XAS CONTAINS THE TIME (IF SPECIFIED)                 Y02759* 00069002
*          XAV CONTAINS THE DATE (IF SPECIFIED)                 Y02759* 00069602
*                                                                     * 00070402
*        FOR A NORMAL EXIT TO IEE6603D, THE SET TOD CLOCK ROUTINE:    * 00072002
*          R2 POINTS TO THE EXTENDED SAVE AREA:                 Y02759* 00072102
*          XAS CONTAINS THE TIME (IF SPECIFIED)                 Y02759* 00072302
*          XAV CONTAINS THE DATE (IF SPECIFIED)                 Y02759* 00072502
*          IF ADDR WAS SPECIFIED, THE FIRST LOGICAL TCWA        Y02759* 00072702
*          ENTRY AND THE ONE FOR THE SPECIFIED ADDRESS HAVE     Y02759* 00072902
*          BEEN EXCHANGED.                                      Y02759* 00073102
*                                                                     * 00073802
*        FOR A NORMAL EXIT TO IEE0803D, THE CSCB CREATION ROUTINE:    * 00073902
*          R2 POINTS TO THE EXTENDED SAVE AREA:                 Y02759* 00074702
*          XAL CONTAINS A POINTER TO THE FIRST PARAMETER        Y02759* 00075302
*          XAU CONTAINS THE UCMI                                Y02759* 00075902
*          XAR CONTAINS A POINTER TO THE COMMAND BUFFER         Y02759* 00076502
*          XAA CONTAINS THE ASID                                Y02759* 00077102
*          XAN CONTAINS THE VERB CODE                           Y02759* 00077702
*                                                                     * 00078602
*        FOR AN ERROR EXIT TO IEE0503D, THE MESSAGE ASSEMBLER:        * 00078902
*          R2 POINTS TO THE EXTENDED SAVE AREA WHICH CONTAINS:        * 00079202
*           IN XAE, THE MESSAGE CODE (SEE ERROR MESSAGES BELOW)       * 00079802
*           IN XAV, THE VERB IN EBCDIC, LEFT ADJUSTED WITH BLANKS     * 00080602
*                                                                     * 00081402
*EXITS: NORMAL - TO IEE0803D,CALLER                             Y02759* 00082202
*       ERROR  - TO THE MESSAGE ASSEMBLY MODULE, IEE0503D             * 00083002
*                                                                     * 00083802
         EJECT                                                          00084602
*ERROR MESSAGES: THE FOLLOWING CONDITIONS GENERATE THE INDICATED      * 00085402
*   MESSAGES:                                                         * 00086202
*      1.NON-INTERNAL SET COMMAND ISSUED IN TOD CLOCK SYSTEM      20071 00087002
*        'IEE305I SET      COMMAND INVALID'         (CODE=5)    Y01040* 00088602
*      2.NON-NUMERIC OR EXCESSIVE CHARACTERS IN TIME OR DATE, OR THE  * 00089402
*        DAY DATE IS ZERO, OR A NON-LEAP YEAR HAVING 366 DAYS   YM1821* 00090202
*        'IEE306I          INVALID NUMERICS'        (CODE=6)    Y01040* 00091002
*      3.MISPLACED PERIODS IN CLOCK OR DATE PARAMETER                 * 00091802
*        'IEE307I          DELIMITER ERROR'         (CODE=7)    Y01040* 00092602
*      4.FAILURE TO FIND BLANK, COMMA OR END OF BUFFER AFTER PARAMETER* 00093402
*        'IEE308I          TERM LENGTH ERROR'       (CODE=8)    Y01040* 00094202
*      5.KEYWORD NOT FOUND IN KEYWORD TABLE                           * 00095002
*        'IEE309I          KEYWORD MISSPELLED'      (CODE=9)    Y01040* 00095802
*      6.NO KEYWORD,                                                  * 00096602
*        DATE NOT SPECIFIED WHEN CLOCK HAS TO BE SET            Y02759* 00097402
*        'IEE310I          KEYWORD MISSING'         (CODE=10)   Y01040* 00098202
*      7.BLANK AFTER KEYWORD                                          * 00099002
*        'IEE311I          PARAMETER MISSING'       (CODE=11)   Y01040* 00099802
*      8.REPEATED KEYWORD                                             * 00100602
*        'IEE312I SET      PARAMETERS CONFLICT'     (CODE=12)   Y01040* 00103802
*      9.KEYWORD SPECIFIED IS INVALID IN THIS CONTEXT                 * 00104202
*        'IEE535I          INVALID PARAMETER'       (CODE=62)   Y02759* 00104302
*                                                                     * 00104602
* NOTE- IF AN ERROR OCCURS, A CODE OF X'FF' IS PLACED IN        Y02759* 00105602
*       BAIPL(IPL ECB) TO INDICATE THAT AN ERROR OCCURRED       Y02759* 00106502
*       ON THE SET COMMAND.                                     Y02759* 00107402
*                                                                       00108401
*OPERATION:                                                             00108602
*   EACH INCOMING COMMAND HAS ITS LEADING KEYWORD COMPARED WITH A     * 00108701
*   TABLE (KEYTAB) CONTAINING EACH OF THE SIX POSSIBLE          Y01040* 00110101
*   KEYWORDS: CLOCK, DATE, ADDR, GMT, RESET, AND IPS.           Y02759* 00112102
*   SUCCESSFUL COMPARISON RESULTS IN TRANSFER BEING MADE, USING Y01040* 00112501
*   KEYTAB, TO THE APPROPRIATE KEYWORD SUBROUTINE.  SUCCESSFUL  Y01040* 00112601
*   RECOGNITION OF A KEYWORD CAUSES THE SETTING OF AN ID MASK   Y01040* 00112701
*   FOR THAT KEYWORD IN THE XSA.  THE SUBROUTINES FOR CLOCK,    Y01040* 00112802
*   TIME, AND ADDR CHECK FOR VALID NUMERICS THAT DO NOT         Y02759* 00112902
*   EXCEED THE PRE-DETERMINED MAXIMUMS. VALID TIME, DATE, OR    Y01040* 00113202
*   ADDR IS PACKED AND HELD IN THE XSA.                         Y02759* 00113602
*                                                                     * 00113702
*   AFTER RETURNING FROM THE SUBROUTINES, A CHECK IS MADE FOR         * 00113902
*   SUCCESSIVE KEYWORDS. IF THERE ARE MORE, THE KEYTAB SCAN IS        * 00115102
*   REPEATED.                                                         * 00117102
*                                                                     * 00129301
         EJECT                                                          00129401
*TABLES/WORK AREAS: THE EXTENDED SAVE AREA AS USED INTERNALLY IN      * 00129501
*   IEE0603D IS MAPPED AS FOLLOWS:                                    * 00130801
*                                                                     * 00132801
*       ***************************************************           * 00133201
*       *XAP                     *XAD                     *           * 00133301
*       *SAVE AREA FOR PTR TO    *                        *           * 00133401
*       * END OF COMMAND BUFFER. *                        *           * 00134701
*       ***************************************************           * 00136701
*       *XAX                                              *           * 00137102
*       *      CPU ADDRESS IN PACKED DECIMAL              *             00137202
*       *                                                 *           * 00139602
*       ***************************************************           * 00140302
*       *XAE   *XAR+1            *XAL                     *           * 00141602
*       *ID/ER *BUFFER           *SAVE AREA FOR CURRENT   *           * 00143602
*       *CODE  *POINTER          * PARAMETER POINTER.     *           * 00145602
*       ***************************************************           * 00146001
*       *XAV                     *XAV+4                   *           * 00146101
*       *                        * DATE IN PACKED         *           * 00146201
*       *                        *     DECIMAL.           *           * 00146301
*       ***************************************************           * 00146401
*       *XAS                     *XAS+4                   *           * 00147501
*       *                        * TIME IN PACKED         *           * 00149501
*       *                        *     DECIMAL.           *           * 00149601
*       ***************************************************           * 00149701
*                                                                     * 00149801
*   A KEYWORD TABLE (KEYTAB), WHICH CONTROLS KEYWORD SCANNING AND     * 00150102
*   KEYWORD SUBROUTINE BRANCHING.                                     * 00150802
*                                                                     * 00151502
*                                                                     * 00152701
*CHARACTER SET  THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL * 00153101
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 00153201
*   TO THE ONE USED AT ASSEMBLY TIME. THE CODING HAS BEEN ARRANGED SO * 00153301
*   THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY, WILL   * 00153401
*   RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.               * 00153701
*                                                                     * 00154101
*********************************************************************** 00154201
         EJECT                                                          00154301
*      REGISTER ASSIGNMENTS        FUNCTION(S)                          00154401
R0       EQU   0                   ENTRY CODE TO ESTAE EXIT      Y02759 00155302
R1       EQU   1                   POST                                 00155402
R2       EQU   2                   BASE REGISTER FOR XSA                00155701
R3       EQU   3                   CURRENT PARAMETER PTR AND LINK REG   00156101
R4       EQU   4                   KEYTAB POINTER AND WORK REGISTER     00156501
R5       EQU   5                   ERROR LINKER AND WORK REGISTER       00156901
R6       EQU   6                   WORK REGISTER                 Y02759 00157002
R7       EQU   7                   WORK REGISTER                 Y02759 00157102
R8       EQU   8                   WORK REGISTER                        00157201
R9       EQU   9                   PARAMETER POINTER AND WORK REGISTER  00157601
R10      EQU   10                  BASE FOR MASTER RESIDENT CORE        00158001
R11      EQU   11                  WORK REGISTER                        00158401
SBASE    EQU   12                  BASE REGISTER FOR PROGRAM            00158501
R13      EQU   13                  WORK REGISTER                  20071 00162202
R14      EQU   14                  BRANCH REGISTER                20071 00164201
R15      EQU   15                  LINKAGE REGISTER              Y02759 00166202
*                                                                     * 00166601
* DISPLACEMENTS OF INFORMATION WITHIN KEYWORD TABLE ELEMENTS          * 00166801
KEYTBL   EQU   83                  KEYWORD TABLE LENGTH MINUS ONE       00167202
KEYELN   EQU   14                  KEYWORD TABLE ELEMENT LENGTH         00167302
KEYLNG   EQU   0                   DISPLACEMENT OF KEYWORD LENGTH       00168301
KEYDIS   EQU   1                   DISPLACEMENT OF DELIMITER            00170301
KEYWRD   EQU   2                   DISPLACEMENT OF KEYWORD              00170401
KEYBRN   EQU   8                   DISPLACEMENT OF BRANCH               00170501
KEYIDM   EQU   12                  DISPLACEMENT OF ID MASK              00171501
KEYFLD   EQU   13                  DISPLACEMENT OF FOLD COUNT    Y02759 00171902
* ERROR CODES FOR MESSAGE MODULE                                        00173501
ERR5     EQU   5                    ERROR CODE                   Y02759 00173602
ERR6     EQU   6                    ERROR CODE                   Y02759 00173902
ERR7     EQU   7                    ERROR CODE                   Y02759 00174202
ERR8     EQU   8                    ERROR CODE                   Y02759 00174502
ERR9     EQU   9                    ERROR CODE                   Y02759 00174802
ERR10    EQU   10                   ERROR CODE                   Y02759 00175102
ERR11    EQU   11                   ERROR CODE                   Y02759 00175402
ERR12    EQU   12                   ERROR CODE                   Y02759 00175702
ERR13    EQU   62                   ERROR CODE                   Y02759 00176002
* PERIOD DISPLACEMENTS FOR DATE AND CLOCK                             * 00176601
PERD1    EQU   2                   DISPLACEMENT OF PERIOD               00176701
PERD2    EQU   5                   DISPLACEMENT OF PERIOD               00176801
D0       EQU   0                                                 Y02759 00177202
D1       EQU   1                   OFFSET TO GET TO KEYWORD      Y01040 00179502
D2       EQU   2                                                  20071 00179902
D3       EQU   3                                                  20071 00180302
D8       EQU   8                                                  20071 00181502
FOX      EQU   15                                                       00181902
D30      EQU   30                                                       00182302
XFF      EQU   X'FF'                                              20071 00183201
C6       EQU   C'6'                                               20071 00184401
C9       EQU   C'9'                                               20071 00184801
LOC16    EQU   16                                                Y02759 00184902
ZERO     EQU   X'00'               NO PARAMETER FOLLOWING        Y01040*00185101
                                        KEYWORD                  Y01040 00185501
CLOCK    EQU   X'01'               SPECIFIC CODE FOR CLOCK       Y02759 00186202
DATE     EQU   X'02'               SPECIFIC CODE FOR DATE        Y02759 00186502
GMT      EQU   X'04'               SPECIFIC CODE FOR GMT         Y02759 00186802
ADDR     EQU   X'08'               SPECIFIC CODE FOR ADDR        Y02759 00187102
RESET    EQU   X'10'               SPECIFIC CODE FOR RESET       Y02759 00187402
IPS      EQU   X'20'               SPECIFIC CODE FOR IPS         Y02759 00187702
* UPPER AND LOWER COMPARANDS FOR SCHECK                               * 00188001
SNUMHI   EQU   C'9'                HIGH NUMERIC                         00188301
SNAWT    EQU   C'0'                CHARACTER ZERO                       00188601
SEINS    EQU   X'01'               BINARY ONE                           00188901
SNUMLO   EQU   SNAWT-SEINS         LOW NUMERIC COMPARAND                00189201
         EJECT                                                          00189501
* MAIN ROUTINE - ESTABLISHES ADDRESSABILITY FOR PROGRAM, XSA, AND     * 00189902
*    MASTER RESIDENT CORE.  USES XSA POINTERS TO COMMAND BUFFER AND   * 00190302
*    LEADING KEYWORD TO IDENTIFY THE KEYWORD. KEYWORD RECOGNITION     * 00190702
*    LEADS TO BRANCHING TO THE KEYWORD'S SUBROUTINE.                  * 00191002
*                                                                     * 00191601
*/*IEE0603D: CHART (FMODE) */                                           00191702
*/* HEADER                                                              00191801
*/*MASTER SCHEDULER (COMMANDS)                             GMT AND L    00196101
*/*OCAL TIME                                                IEE0603D    00198101
*/*                                                              PAG    00198201
*/*E #                                                               */ 00198301
*/*IEE0603D:1A2 E ENTRY FROM IEE0403D */                                00198502
*/*1B2 M ESTABLISH ADDRESSIBILITY */                                    00198602
         BALR  SBASE,0             ESTABLISH PROGRAM ADDRESSABILITY     00198701
         USING MODBASE,SBASE                                     Y02759 00198802
MODBASE  EQU   *                                                 Y02759 00199002
IEE0603D MODID BRANCH=YES                                        Y01886 00199202
         USING XSA,R2              BASE FOR EXTENDED SAVE AREA          00199701
         USING BASE,R10            ESTABLISH BASEA ADDRESSABLTY         00199801
*/*1C2 P SET POINTER TO START OF KEYWORDS AND ESTABLISH RECOVERY EXIT*/ 00199902
         SR    R15,R15             ZEROES TO INITIALIZE ERROR    Y02759 00213302
*                                       EXIT FLAGS               Y02759 00213602
         L     R9,XAL              USE REG 9 AS PTR TO PARMS     Y04925 00213902
         STM   R9,R15,REGSAVE      SAVE REGS 9-15                Y02759 00216702
         LA    R9,0(R9)            ZERO H.O. BYTE TO TEST PTR    Y04925 00216902
         MVC   ESTAELST(ESTAELN),ESTAEL  COPY ESTAE PARAMETER           00217102
*                                       LIST TO XSA                     00217502
         LA    R1,ESTAELST         GET ADDR OF ESTAE LIST FORM          00217602
         LA    R7,EXITPARM         GET RECVY EXIT PARMLIST ADDRESS      00217702
         ESTAE ,CT,PARAM=(7),MF=(E,(1))  ESTABLISH RECOVERY EXIT        00217902
*/*1D2 D (NO,SERR10,YES,) ANY KEYWORDS */                               00218602
         LTR   R9,R9               IS PARAMETER PTR 0?            20071 00218802
         BZ    SERR10              YES, KEYWORDS MISSING          20071 00219002
*/*1E2 P SET UP REGISTERS FOR KEYWORD SCAN TABLE */                     00219902
         L     R7,XAR              LOAD POINTER TO BUFFER               00220902
         LA    R7,0(R7)                 CONTAINING COMMAND              00221902
         LH    R6,0(R7)            LOAD BUFFER LENGTH                   00222902
         N     R6,SFFFF-2          CLEAR POSSIBLE GARBAGE               00223902
*/*1F2 P COMPUTE END OF BUFFER AND SAVE */                              00224902
         AR    R7,R6               COMPUTE END OF BUFFER                00225902
         ST    R7,XAP              SAVE IN FIRST WORD OF XSA            00226902
*/*1G2 M CLEAR KEYWORD MASK BYTE */                                     00227902
         NI    XAE,X'00'           CLEAR ID MASK AREA                   00228902
         SPACE                                                          00229902
*/*SNEWKY:1H2 M SET UP TO CHECK KEYWORD AGAINST TABLE */                00230902
SNEWKY   EQU   *                   EXAMINE KEYWORD                      00231902
         LA    R6,KEYELN           LOAD KEYTAB ELEMENT LENGTH           00232902
*                                       FOR INCREMENT IN BXLE           00233902
         LA    R4,KEYTAB           GET ADDRESS OF KEYWORD TABLE         00234902
         LA    R7,KEYTBL(R4)       GET END OF TABLE ADDRESS             00235902
*                                       FOR COMPARAND IN BXLE           00236902
         SR    R5,R5               LOAD LENGTH OF A                     00237902
SNXTWRD  IC    R5,KEYLNG(R4)            PARTICULAR KEYWORD              00238902
*/*SETCLK:1J2 D (YES,BUFFERCK,NO,) KEYWORD A MATCH */                   00239902
         EX    R5,SETMVC           MOVE POTENTIAL PARM TO WKAREA        00240902
         IC    R5,KEYFLD(R4)       GET LENGTH TO FOLD TO CAPS           00241902
         EX    R5,SETOC            FOLD TO UPPER CASE                   00242902
         IC    R5,KEYLNG(R4)       GET LENGTH TO COMPARE                00243902
         EX    R5,SETCLC           IS THIS THE KEYWORD?                 00244902
         BE    CKPARM              YES, NOW GO CHECK PARAMETER          00245902
*/*1K2 D (YES,SERR09,NO,) END OF TABLE */                               00246902
         BXLE  R4,R6,SNXTWRD       RECHECK IF NOT END OF TABLE          00247902
*/*1K1 P (,SETCLK) INCREMENT TO NEXT KEYWORD */                         00248902
         B     SERR09              ERROR, KEYWORD NOT FOUND             00249902
         SPACE                                                          00250902
*/*BUFFERCK:1B4 D (NO,INCRMT,YES,) SHOULD KEYWORD HAVE PARM */          00251902
CKPARM   LA    R9,1(R9,R5)         POINT REGISTER TO PARAMETER          00252902
         CLI   D1(R4),ZERO         SHOULD THERE BE A PARMETER?   Y01040 00253902
         BE    INCRMT              NO, SKIP CHECK FOR ONE        Y01040 00254902
*/*1C4 D (NO,SERR11,YES,) IS THERE A PARAMETER */                       00255902
         CLI   0(R9),C' '          IS PARAMETER BLANK?                  00256902
         BE    SERR11              YES, ERROR                           00257902
         SPACE                                                          00258902
*/*INCRMT:1D4 D (YES,SERR08,NO,) BUFFER EXCEEDED */                     00259902
INCRMT   EQU   *                                                 Y01040 00260902
         SR    R3,R3               POINT A REGISTER TO THE END OF       00261902
         IC    R3,KEYDIS(R4)            PARAMETER                       00262902
         LA    R3,0(R3,R9)                                              00263902
         C     R3,XAP              IS BUFFER EXCEEDED?                  00264902
         BH    SERR08              YES, ERROR                           00265902
         SPACE                                                          00266902
*/*1E4 P GET KEYWORD */                                                 00267902
         SR    R5,R5               NO, PREPARE TO                       00268902
         IC    R5,KEYIDM(R4)            LOAD KEYWORD'S ID MASK          00269902
*/*1F4 D (YES,SERR12,NO,) KEYWORD A REPEAT */                           00270902
         EX    R5,SETTMP           IS THIS KEYWORD A REPEAT?            00271902
         BO    SERR12              YES, ERROR                           00272902
         SPACE                                                          00273902
*/*1G4 P SAVE KEYWORD ID */                                             00274902
         OC    XAE(1),KEYIDM(R4)   SAVE KEYWORD'S ID IN XSA             00275902
         ST    R3,XAL              SAVE POINTER TO END OF PARAMETER     00276902
*/*1H4 D (CLOK,SCLOCK,DATE,SDATE,ADDR,SADDR,IPS,SETNXT,RSET,SETNXT,GMT, 00277902
*/*SETNXT)                                                              00278902
*/* GO TO APPROPRIATE PROCESSING ROUTINE */                             00279902
         EX    0,KEYBRN(R4)        GO TO THE APPROPRIATE SUBROUTINE     00280902
         EJECT                                                          00281902
* KEYWORD=CLOCK SUBROUTINE - SYNTAX CHECKS THE CLOCK PARAMETER FOR    * 00282902
*    PROPER POSITIONING OF PERIODS, NUMERIC CHARACTERS, AND THE EX-   * 00283902
*    CEEDING OF PROPER LIMITS FOR HOUR, MINUTE OR SECOND. A VALID     * 00284902
*    PARAMETER IS PACKED IN THE XSA TEMPORARILY, IN XAS.              * 00285902
*                                                                     * 00286902
*/*SCLOCK:2A3 D (NO,SERR07,YES,) ARE PERIODS CORRECT */                 00287902
SCLOCK   EQU   *                                                        00288902
         CLI   PERD1(R9),C'.'      CHECK FOR PROPER PLACEMENT           00289902
         BNE   SERR07                        INCORRECT                  00290902
         CLI   PERD2(R9),C'.'           OF PERIODS                      00291902
         BNE   SERR07                        INCORRECT                  00292902
*/*2B3 P REMOVE PERIODS AND SAVE HHMMSS */                              00293902
         MVC   XAS(2),0(R9)        CONSOLIDATE TIME WITHOUT             00294902
         MVC   XAS+2(2),3(R9)           PERIODS                         00295902
         MVC   XAS+4(2),6(R9)                                           00296902
         LA    R11,6               SET LOOP CONTROLLER TO 6             00297902
         LA    R9,XAS              SET POINTER TO TIME                  00298902
*/*2C3 S SCHECK: VALIDATE TIME DIGITS */                                00299902
         BAL R13,SCHECK            VERIFY TIME DIGITS             20071 00300902
*/*2D3 D (YES,SERR06,NO,) DO HOURS EXCEED 23 */                         00301902
         CLC   XAS(2),SETCHR       DO HOURS EXCEED 23?                  00302902
         BH    SERR06              YES, ERROR                           00303902
*/*2E3 D (YES,SERR06,NO,) DO MINUTES EXCEED 59 */                       00304902
         CLC   XAS+2(2),SETCMS     DO MINUTES EXCEED 59?                00305902
         BH    SERR06              YES, ERROR                           00306902
*/*2F3 D (YES,SERR06,NO,) DO SECONDS EXCEED 59 */                       00307902
         CLC   XAS+4(2),SETCMS     DO SECONDS EXCEED 59?                00308902
         BH    SERR06              YES, ERROR                           00309902
*/*2G3 P (,SETNXT) SAVE TIME IN PACKED DECIMAL */                       00310902
         PACK  XAS+4(4),XAS(6)     PACK TIME FOR CONVERSION             00311902
         B     SETNXT              GO CHECK NEXT KEYWORD                00312902
         EJECT                                                          00313902
* KEYWORD=DATE SUBROUTINE - SYNTAX CHECKS THE DATE PARAMETER FOR      * 00314902
*    PROPER POSITIONING OF PERIODS, NUMERIC CHARACTERS, AND THE EX-   * 00315902
*    CEEDING OF PROPER LIMITS FOR THE DAY. A VALID PARAMETER IS       * 00316902
*    PACKED IN THE XSA TEMPORARILY, IN XAV.                           * 00317902
*                                                                     * 00318902
*/*SDATE:2A1 D (NO,SERR07,YES,) IS THE PERIOD CORRECT */                00319902
SDATE    EQU   *                                                        00320902
         CLI   PERD1(R9),C'.'      IS PERIOD POSITIONED?                00321902
         BNE   SERR07              NO, ERROR                            00322902
*/*2B1 P REMOVE THE PERIOD AND SAVE YYDDD */                            00323902
         MVC   XAV(2),0(R9)        CONSOLIDATE DATE WITHOUT             00324902
         MVC   XAV+2(3),3(R9)           PERIODS                         00325902
         LA    R11,5               SET LOOP CONTROLLER TO 5             00326902
         LA    R9,XAV              SET POINTER TO DATE                  00327902
*/*2C1 S SCHECK: VALIDATE DATE DIGITS */                                00328902
         BAL   R13,SCHECK          VERIFY DATE DIGITS             20071 00329902
*/*2D1 D (YES,SERR06,NO,) IS THE DAY 000? */                            00330902
         CLC   XAV+D2(D3),SETDD0   IS DDD = 000?                 YM1821 00331902
         BE    SERR06              YES, INVALID NUMERICS         YM1821 00332902
*/*2E1 M PRESET EXITING ADDRESS TO 'SETNXT' IN REGISTER 13 */           00333902
         LA    R13,SETNXT          SET BRANCH TO NEXT KEYWORD    YM1821 00334902
*/*2F1 D (GT,SERR06,LT,SYEAR,EQ,) DDD = 366? */                         00335902
         CLC   XAV+2(3),SETDDY     DO DAYS EXCEED 366?                  00336902
         BH    SERR06              YES, ERROR                           00337902
         BL    SYEAR               BRANCH IF LESS THAN 366 DAYS  YM1821 00338902
*/*2G1 M PRESET EXITING ADDRESS TO 'LEAPYEAR' IN REGISTER 13 */         00339902
         LA    R13,LEAPYEAR        SET BRANCH TO YEAR VALIDITY   YM1821 00340902
SYEAR    EQU   *                                                 YM1821 00341902
*/*SYEAR:2H1 P SAVE YYDDD IN PACKED DECIMAL */                          00342902
         PACK  XAV+4(4),XAV(5)     PACK DATE FOR CONVERSION             00343902
*/*2J1 D (YES,SETNXT,NO,LEAPYEAR) REGISTER 13 POINTING TO 'SETNXT'? */  00344902
         BR    R13                                               YM1821 00345902
*********************************************************************** 00346902
*                                                                     * 00347902
* THIS ROUTINE, ENTERED ONLY AFTER A DATE WITH 366 DAYS         Y02759* 00348902
* IS ENCOUNTERED, CHECKS FOR THE VALIDITY OF THE 366 DAYS IN    YM1821* 00349902
* THE YEAR.  THE YEAR IN QUESTION IS DIVIDED BY 4, AND IF A     YM1821* 00350902
* REMAINDER IS PRESENT, THE ROUTINE LEADS TO AN ERROR MESSAGE   YM1821* 00351902
* ISSUED.  NORMAL PROCESSING IS CONTINUED FOR A VALID LEAP      YM1821* 00352902
* YEAR.                                                         YM1821* 00353902
*                                                                     * 00354902
*********************************************************************** 00355902
*/*LEAPYEAR:2J2 P OBTAIN THE YEAR */                                    00356902
LEAPYEAR EQU   *                                                 YM1821 00357902
         SR    R4,R4               CLEAR REGISTER                YM1821 00358902
         ST    R4,XAV              CLEAR FIRST WORD FOR 'CVB'    YM1821 00359902
         CVB   R5,XAV              CONVERT TO BINARY             YM1821 00360902
         D     R4,D1000            SHIFT OFF DDD                        00361902
*/*2J3 D (YES,SERR06,NO,) IS IT 1900? */                                00363902
         LTR   R5,R5               TEST FOR 1900                        00371902
         BZ    SERR06              ERROR IF 1900                        00381902
*/*2J4 D (NO,SERR06,YES,SETNXT) IS IT PERFECTLY DIVISIBLE BY 4? */      00383902
         SLL   R5,D30              SHIFT OFF ALL BUT BITS 30-31         00391902
         LTR   R5,R5               EITHER 0NE ON?                       00392302
         BNZ   SERR06              YES, ERROR.  NOT A LEAP YEAR         00402202
         B     SETNXT              GO CHECK NEXT KEYWORD         YM1821 00599602
      EJECT                                                             00629201
* KEYWORD=ADDR SUBROUTINE - VALIDITY CHECKS THE CPU ADDRESS SPECIFIED.* 00631202
*    A VALID ADDRESS IS PACKED IN THE XSA TEMPORARILY, IN XAX.        * 00633202
*                                                                     * 00635202
*/*SADDR:2A2 P SAVE CPU ADDRESS */                                      00639602
SADDR    EQU   *                                                        00640002
         MVC   XAX(2),D0(R9)       SAVE SPECIFIED CPU ADDRESS    Y02759 00641202
         LA    R11,D2              SET LOOP CONTROLLER TO 2      Y02759 00646202
*/*2B2 S SCHECK:VALIDATE ADDRESS DIGITS */                              00651202
         BAL   R13,SCHECK          VERIFY ADDRESS DIGITS         Y02759 00659202
*/*2C2 D (YES,SERR06,NO,) DOES ADDR EXCEED 15? */                       00669202
         CLC   XAX(2),SETCADDR     DOES ADDRESS EXCEED 15?       Y02759 00671202
         BH    SERR06              YES, ERROR                    Y02759 00673202
*/*2D2 P (,SETNXT) SAVE ADDR IN PACKED DECIMAL */                       00675202
         PACK  XAX(8),XAX(2)       PACK CPU ADDRESS FOR          Y02759 00677202
*                                  FURTHER VERIFICATION          Y02759 00677602
         B     SETNXT              GO CHECK NEXT KEYWORD         Y02759 00678002
      EJECT                                                             00678402
* THE FOLLOWING CLOSED SUBROUTINE IS USED BY SCLOCK, SDATE, AND       * 00679202
*    SADDR TO CHECK THAT ALL PARAMETER CHARACTERS ARE NUMERIC. R11    * 00689202
*    IS THE LOOP COUNTER; R3 IS THE RETURN REGISTER; R9 POINTS TO     * 00729202
*    THE PARAMETER.                                                   * 00779202
*                                                                     * 00829201
*/*SCHECK:2A5 E NUMERIC CHECK SUBRT */                                  00879202
SCHECK   EQU   *                                                        00929201
*/*2B5 P CHECK FOR NUMERIC DIGITS */                                    00979202
         SR    R4,R4               SET INCREMENT REGISTERS TO ZERO      01029201
         SR    R6,R6                                                    01079201
         LA    R5,SNUMLO           SET LOWER LIMIT OF DIGIT             01129201
         LA    R7,SNUMHI           SET UPPER LIMIT OF DIGIT             01179201
*/*SDGTLP:2C5 D (YES,SERR06,NO,) DIGIT LESS THAN 0? */                  01229202
SDGTLP   SR    R8,R8               CLEAR FOR LOADING                    01279201
         IC    R8,0(R9)            TAKE ONE CHARACTER                   01329201
         BXLE  R8,R4,SERR06        TEST FOR LOW                         01379201
*/*2D5 D (YES,SERR06,NO,) DIGIT GREATER THAN 9? */                      01429202
         BXH   R8,R6,SERR06        TEST FOR HIGH                        01479201
*/*2E5 P INCREMENT TO NEXT DIGIT */                                     01529202
         LA    R9,1(R9)            INCREMENT CHARACTER POINTER          01579201
*/*2F5 D (NO,SDGTLP,YES,) LAST DIGIT CHECKED? */                        01629202
         BCT   R11,SDGTLP          IS LOOP DONE?                        01679201
*/*2G5 R RETURN TO CALLER */                                            01729202
         BR    R13                 YES, RETURN                    20071 01779201
         EJECT                                                          08129201
* RETURNED TO FROM A KEYWORD SUBROUTINE, THIS PORTION OF THE MAIN     * 08179201
*    ROUTINE CHECKS IF THE SET COMMAND IS COMPLETE OR IF THERE ARE    * 08229201
*    MORE KEYWORDS. A COMMA AS DELIMITER RESULTS IN THE RETURN TO     * 08279201
*    THE KEYWORD TABLE SCAN FOR THE NEW KEYWORD. SUCCESSFUL COMPLE-   * 08329201
*    TION LEADS TO 'SETOUT'.                                          * 08379201
*                                                                     * 08429201
*/*SETNXT:1D1 D (YES,SETOUT,NO,) END OF BUFFER? */                      08479202
SETNXT   EQU   *                                                        08529201
         C     R3,XAP              IS IT VALID END OF BUFFER?           08579201
         BE    SETOUT              YES, END OF SET COMMAND              08629201
*/*1E1 D (YES,SETOUT,NO,) END OF COMMAND? */                            08679202
         CLI   0(R3),C' '          IS NEXT CHARACTER A BLANK?           08729201
         BE    SETOUT              YES, END OF SET COMMAND              08779201
*/*1F1 D (NO,SERR08,YES,) IS THERE A COMMA? */                          08829202
         CLI   0(R3),C','          IS NEXT CHARACTER A COMMA?           08879201
         BNE   SERR08              NO, MUST BE ERROR                    08929201
         LA    R9,1(R3)            YES, BUMP CURRENT PARAMETER          08979201
*/*1G1 D (NO,SERR07,YES,SNEWKY) ANOTHER PARAMETER FOLLOWING? */         09029202
         CLI   0(R9),C' '          IS NEXT CHARACTER BLANK?             09079201
         BE    SERR07              YES, DELIMITER ERROR                 09129201
         B     SNEWKY              GO CHECK NEXT KEYWORD                09179201
         EJECT                                                          09229201
*/*SETOUT:3A1 M PRESET REGISTER 14 TO THE ADDRESS OF 'CKIPS' */         09249202
SETOUT   LA    R14,CKIPS              PICKUP RETURN ADDRESS             09279202
*/*3B1 D (NO,SERR05,YES,) IS IT IPL AND INTERNAL? */                    09329202
         TM    BASFL,BAIN+BAINTSET    IS IT IPL/VARY AND INTERNAL?      12939202
         BZ    SERR05                 IPL/VARY, BUT NOT INTERNAL        12941202
*/*3C1 D (YES,INTSET,NO,) IS IT INTERNAL ONLY? */                       12941602
         TM    BASFL,BAINTSET         IS IT INTERNAL?                   12943202
         BO    INTSET                 YES, BRANCH                       12945202
*/*3D1 D (YES,SERR13,NO,) GMT/ADDR AFTER IPL? */                        12945602
         TM    XAE,GMT+ADDR           GMT OR ADDR SPECFD AFTER IPL?     12947202
         BNZ   SERR13                 YES, ERROR                        12947602
*/*3E1 D (NO,NORESET,YES,) RESET SPECIFIED? */                          12947702
         TM    XAE,RESET              RESET SPECIFIED?                  12948002
         BZ    NORESET                NO, BRANCH                        12948402
*/*3F1 D (YES,SERR12,NO,LCL) RESET WITH DATE/CLOCK? */                  12948502
         TM    XAE,DATE+CLOCK         RESET SPECFD WITH DATE/CLOCK?     12948802
         BNZ   SERR12                 YES, ERROR                        12948902
         B     LCL                                                      12949002
*/*NORESET:3E2 D (NO,CKIPS,YES,) CLOCK/DATE SPECIFIED? */               12952302
NORESET  TM    XAE,CLOCK+DATE         CLOCK AND/OR DATE SPECFD?         12955802
         BCR   D8,R14                 NO, GO CHECK FOR IPS              12959102
*/*LCL:3G1 P GET ADDRESS OF IEE6503D */                                 12961102
LCL      L     R15,VCON65             GET ADDR OF SET LOCAL TIME        12969102
*/*3H1 S (,CKIPS) IEE6503D:SET LOCAL TIME */                            12971102
CALLMOD  BR    R15                    ROUTINE AND BALR TO IT            12972402
         DROP  SBASE                                                    12974402
         USING *,R14                                                    12974802
*/*CKIPS:3J1 D (NO,NOIPS:BT,YES,DESTAE1:RL) IPS SPECIFIED? */           12974902
CKIPS    LM    R9,R14,REGSAVE         RESTORE REGS 9-14                 12975202
         DROP  R14                                                      12975602
         USING MODBASE,SBASE                                            12975702
         TM    XAE,IPS                IPS SPECIFIED?                    12975802
         BZ    NOIPS                  NO, BRANCH                        12989102
         ST    R9,XAL                 RESTORE VERB CODE AND      Y04925 12991102
*                                          POINTER TO FIRST PARM Y04925 12995102
         MVC   XAV(8),SETSET          MOVE VERB NAME TO XSA      Y04925 12999102
*/*DESTAE1:3J2 P DELETE RECOVERY EXIT */                                12999202
         ESTAE 0                      DELETE RECOVERY EXIT              12999302
*/*3K2 R GET ADDRESS OF IEE0803D AND BRANCH TO IT */                    12999702
         L     R15,VCON08             GET ADDR OF CSCB CREATION RTN     13001102
         BR    15                     BRANCH TO CSCB CREATION RTN       13009802
*/*NOIPS:3K1 R DELETE RECOVERY EXIT AND RETURN TO IEE0403D */           13011902
NOIPS    ESTAE 0                      DELETE RECOVERY EXIT              13012302
         BR    R14                    RETURN IF NO IPS                  13014202
         EJECT                                                          13016402
*/*INTSET:3A4 M ESTABLISH ADDRESSABILITY TO TOD CLOCK WORKAREA */       13018602
INTSET   L     R6,LOC16               GET CVT POINTER                   13020802
         USING CVT,R6                                                   13023002
         L     R6,CVTTPC              GET TPC POINTER                   13025202
         USING TPC,R6                                                   13027402
         L     R6,TPCTCWA             GET TCWA POINTER                  13029602
         USING TCWA,R6                                                  13031802
*/*3B4 D (YES,SERR13,NO,) RESET SPECIFIED? */                           13034002
         TM    XAE,RESET              RESET SPECIFIED                   13036202
         BO    SERR13                 YES, RESET IS ERROR ON INT SET    13038402
*/*3C4 D (YES,CKZZZ,NO,) ADDR SPECIFIED? */                             13040602
         TM    XAE,ADDR               ADDR SPECIFIED?                   13042802
         BO    CKZZZ                  YES, BRANCH                       13045002
*/*3D4 D (YES,CKDATE,NO,) MSG IEA886A OR IEA887A ISSUED? */             13047202
         TM    TCWAGFLG,MSGYYY+MSGZZZ  MSG YYY OR ZZZ OUTSTANDING       13049402
         BNZ   CKDATE                 YES, SEE IF DATE SPECFD           13051602
*/*3E4 D (NO,CKGMT,YES,) DATE/CLOCK SPECIFIED? */                       13053802
         TM    XAE,DATE+CLOCK         NO, MUST BE XXX OUTSTANDING       13056002
*                                         SEE IF CLOCK/DATE SPECFD      13058202
         BZ    CKGMT                  IF NOT, CHECK FOR GMT             13060402
*/*3F4 D (NO,LCL,YES,) GMT SPECIFIED? */                                13062602
         TM    XAE,GMT                IF SO, IS GMT SPECIFIED?          13064802
         BZ    LCL                    NO, GO TO LCL TIME RTN            13067002
*/*TOD:3H4 P GET ADDRESS OF IEE6603D */                                 13069202
TOD      L     R15,VCON66             GET ADDR OF SET TOD CLOCK RTN     13071402
*/*3J4 S (,CKIPS) IEE6603D:SET TOD CLOCK */                             13073602
         BR    R15                        AND GO THERE                  13075802
*/*CKDATE:3D5 D (NO,SERR10,YES,TOD) DATE SPECIFIED? */                  13078002
CKDATE   TM    XAE,DATE               DATE SPECIFIED?                   13080202
         BZ    SERR10                 NO, ERROR                         13082402
         B     TOD                    YES, GO TO TOD CLOCK RTN          13084602
*/*CKGMT:3E5 D (YES,SERR13,NO,CKIPS) GMT SPECIFIED? */                  13086802
CKGMT    TM    XAE,GMT                GMT SPECIFIED?                    13089002
         BO    SERR13                 YES, GMT WITHOUT DATE/CLOCK       13091202
*                                         IS AN ERROR                   13093402
         B     CKIPS                  NO, GO CHECK FOR IPS              13095602
*                                                                       13097802
* ADDR WAS SPECIFIED.  SEE IF IT IS VALID, AND ACT ACCORDINGLY          13100002
*                                                                       13102202
*/*CKZZZ:3C3 D (NO,SERR13,YES,) MSG IEA887A ISSUED? */                  13104402
CKZZZ    TM    TCWAGFLG,MSGZZZ        MSG ZZZ OUTSTANDING?              13106602
         BZ    SERR13                 WITHOUT IT, ADDR IS AN ERROR      13108802
*/*3D3 P SEARCH TOD CLOCK WORKAREA ENTRIES FOR SPECIFIED ADDR */        13111002
         CVB   R5,XAX                 CONVERT THE ADDR TO BINARY        13113202
         LA    R7,LTCWA(,R6)          GET PTR TO FIRST TCWA ENTRY       13115402
         USING TCENTRY,R7                                               13117602
         LH    R8,TCCPUCNT            GET NUMBER OF ENTRIES             13119802
NEXT     CH    R5,TCWAIADD            COMPARE SPECIFIED CPU ADDR        13122002
*                                          WITH ADDR IN ENTRY           13124202
         BE    MATCH                  BRANCH IF THEY MATCH              13126402
         LA    R7,LENTRY(,R7)         POINT TO NEXT ENTRY               13128602
         BCT   R8,NEXT                BRANCH IF MORE ENTRIES            13130802
*/*3E3 D (NO,SERR06,YES,) CORRECT ENTRY FOUND? */                       13133002
         B     SERR06                 ELSE, NO MATCH FOUND, ERROR       13135202
*/*3F3 D (NO,SERR06,YES,) IS THIS CLOCK SET? */                         13137402
MATCH    TM    TCWALFLG,TCLCC         THIS CLOCK SET?                   13139602
         BNZ   SERR06                 NO, ERROR                         13141802
         LA    R8,LTCWA(,R6)          GET PTR TO FIRST ENTRY            13144002
*/*3G3 D (YES,NOSWAP:RR,NO,) IS THIS 1ST ENTRY? */                      13146202
         CR    R7,R8                  IS MATCHING ENTRY THE FIRST?      13148402
         BE    NOSWAP                 YES, NO SWAP REQUIRED             13150602
*/*3H3 M SWAP 1ST AND MATCHING ENTRIES */                               13152802
         XC    D0(LENTRY,R7),D0(R8)   EXCHANGE FIRST                    13155002
         XC    D0(LENTRY,R8),D0(R7)         AND MATCHING                13157202
         XC    D0(LENTRY,R7),D0(R8)               ENTRIES               13159402
*/*NOSWAP:3J3 M (,CKIPS:B ) INDICATE TOD CLOCK O.K. */                  13161602
NOSWAP   NI    TCWAGFLG,XFF-TCGNSET   INDICATE TOD CLOCK OK             13163802
         B     CKIPS                  GO CHECK FOR IPS                  13166002
         EJECT                                                          13168202
* THE FOLLOWING INSTRUCTIONS PASS A DESIGNATED ERROR CODE TO THE      * 13170402
*    SET COMMAND ERROR SUBROUTINE, 'SETERR', IN REGISTER 5.           * 13172602
*                                                                     * 13174802
*/*SERR05:4A3 M (,SETERR) SET ERROR CODE FOR COMMAND INVALID */         13177002
SERR05   BAL   R5,SETERR           ERROR CODE = 5                 20071 13179201
         DC    AL1(ERR5)                                          20071 13229201
*                                                                 20071 13279201
*/*SERR06:4B2 M (,SETERR) SET ERROR CODE FOR INVALID NUMERICS */        13329202
SERR06   BAL   R5,SETERR           ERROR CODE = 6                       13379201
         DC    AL1(ERR6)                                                13429201
*                                                                     * 13479201
*/*SERR07:4B4 M (,SETERR) SET ERROR CODE FOR DELIMITER ERROR */         13529202
SERR07   BAL   R5,SETERR           ERROR CODE = 7                       13579201
         DC    AL1(ERR7)                                                13629201
*                                                                     * 13679201
*/*SERR08:4C2 M (,SETERR) SET ERROR CODE FOR TERM LENGTH ERROR */       13729202
SERR08   BAL   R5,SETERR           ERROR CODE = 8                       13779201
         DC    AL1(ERR8)                                                13829201
*                                                                     * 13879201
*/*SERR09:4C4 M (,SETERR) SET ERROR CODE FOR UNIDENTIFIBLE KEYWORD */   13929202
SERR09   BAL   R5,SETERR           ERROR CODE = 9                       13979201
         DC    AL1(ERR9)                                                14029201
*                                                                     * 14079201
*/*SERR10:4D2 M (,SETERR) SET ERROR CODE FOR KEYWORD MISSING */         14129202
SERR10   BAL   R5,SETERR           ERROR CODE = 10                      14179201
         DC    AL1(ERR10)                                               14229201
*                                                                     * 14279201
*/*SERR11:4D4 M (,SETERR) SET ERROR CODE FOR PARAMETER MISSING */       14329202
SERR11   BAL   R5,SETERR           ERROR CODE = 11                      14379201
         DC    AL1(ERR11)                                               14429201
*                                                                     * 14479201
*/*SERR12:4E2 M (,SETERR) SET ERROR CODE FOR PARAMETERS CONFLICT */     14529202
SERR12   BAL   R5,SETERR           ERROR CODE = 12                      14579201
         DC    AL1(ERR12)                                               14629201
*                                                                       14679202
*/*SERR13:4E4 M (,SETERR) SET ERROR CODE FOR INVALID PARAMETER */       14689202
SERR13   BAL   R5,SETERR           ERROR CODE = 62              Y02759  14729202
         DC    AL1(ERR13)                                       Y02759  14799202
         EJECT                                                          14879201
* ERROR SUBROUTINE - RECEIVES IN REGISTER 5 AN ERROR MESSAGE CODE     * 14929201
*    WHICH IS PLACED IN THE XSA (IN XAE). CONTROL GOES TO THE MESSAGE * 14979202
*    ASSEMBLY MODULE, IEE0503D, BY BRANCH.                      Y01040* 15029201
*/*SETERR:4F3 M SET UP TO ISSUE MESSAGE */                              15079202
SETERR   DS    0H                                                       15129201
         TM    BASFL,BAINTSET      INTERNAL COMMAND?                    15131202
         BNO   EXTCMD              NO, BRANCH                           15133202
         MVC   XAV(8),SETRPLY      MOVE VARIABLE TEXT TO XSA     Y02759 15139202
         B     INSERRC             GO GET ERROR CODE                    15149202
EXTCMD   MVC   XAV(8),SETSET       MOVE VARIABLE TEXT TO XSA            15179202
INSERRC  MVC   XAE(1),0(R5)        INSERT ERROR CODE                    15229202
*/*4G3 M INDICATE PARAMETERS NOT ACCEPTED */                            15279202
         MVI   BAIPLCC,XFF         PUT RETURN CODE IN IPL ECB    Y01040 15329202
         LM   R9,R14,REGSAVE       RESTORE REGS 9-14             Y02759 15339202
*/*4H3 P DELETE RECOVERY EXIT */                                        15349202
         ESTAE 0                   DELETE RECOVERY EXIT                 15359202
*/*4J3 P GET ADDRESS OF IEE0503D */                                     15379202
         L    R15,VCON05           GET ADDRESS OF IEE0503D       Y01029 15429201
*/*4K3 R BRANCH TO IEE0503D */                                          15479202
         BR   R15                  BRANCH TO IEE0503D            Y01029 15529201
         EJECT                                                          15629201
*                                                                       15639202
* ERROR RECOVERY EXIT                                                   15649202
*                                                                       15659202
*/*SERREXIT:5A3 E ESTAE EXIT ROUTINE */                                 15661202
SERREXIT BALR  SBASE,0             ESTABLISH ADDRESSABILITY             15669202
         USING *,SBASE                                                  15671202
*/*5B3 M INDICATE PERCOLATION IN REG 15 */                              15671602
         SR    R15,R15             SET RC FOR PERCOLATION               15673202
*/*5C3 D (NO,CMDFAIL,YES,) SDWA SUPPLIED? */                            15673602
         CH    R0,H12              SEE IF SDWA SUPPLIED                 15675202
         BE    FAILCMND            BRANCH IF NOT                        15677202
         L     R2,0(R1)            IF SO, GET PARMLIST ADDR INTO R2     15677602
         USING EXITPARM,R2         PARMLIST ADDRESSABILITY              15677702
*/*5D3 P ISSUE SETRP */                                                 15677802
         SETRP RECPARM=SETID,RC=0, ESTABLISH INTERFACE BACK TO RTM     *15678002
               DUMP=NO                                                  15678102
*/*5E3 M DETERMINE CSECT WHERE ERROR OCCURRED AND SET NAME IN SDWA */   15680102
         TM    CSECTCDE,X'C0'      DETERMINE WHERE ERROR OCCURRED       15682102
         BZ    FAILCMND            BRANCH IF ERROR IN IEE0603D          15684102
*                                     AS CSECT NAME IS CORRECT          15686102
         BO    CSECT66             BRANCH TO CHANGE CSECT NAME IF       15688102
*                                     ERROR IN IEE6603D                 15690102
         USING SDWA,R1                                                  15695802
         MVC   SDWACSCT+3(2),C65   CHANGE CSECT NAME TO IEE6503D        15705802
         B     FAILCMND            BRANCH TO SET FAIL FLAG              15707802
CSECT66  MVC   SDWACSCT+3(2),C66   CHANGE CSECT NAME TO IEE6603D        15709802
         DROP  R1                                                       15711802
*/*CMDFAIL:5F3 M INDICATE PARAMETERS NOT ACCEPTED */                    15711902
FAILCMND L     R10,R10SAVE         GET ADDRESS OF BASEA                 15712202
         MVI   BAIPLCC,XFF         INDICATE COMMAND FAILED              15712302
*/*5G3 R RETURN TO RTM */                                               15719702
         BR    R14                 RETURN TO RTM                        15727402
*/*IEE0603D: END */                                                     15734802
         USING MODBASE,SBASE       RE-ESTABLISH ORIGINAL ADDRESSABILITY 15742202
         USING XSA,R2                                                   15749602
         EJECT                                                          15757002
* THE FOLLOWING TABLE CONTROLS THE SCAN OF INCOMING KEYWORDS AND THE  * 15764402
*   BRANCHING TO SPECIFIC KEYWORD SUBROUTINES.                        * 15771802
*                                                                     * 15779201
         DS    0H                                                       15829201
KEYTAB   EQU   *                                                        15879201
         DC    X'5'                KEYWORD LENGTH MINUS ONE             15929201
         DC    X'8'                PARAMETER DELIMITER                  15979201
         DC    C'CLOCK='           KEYWORD                              16029201
         B     SCLOCK              SPECIFIC CODING                      16079201
         DC    X'01'               KEYWORD ID MASK PATTERN              16129201
         DC    X'4'                CHARS TO FOLD MINUS ONE       Y02759 16179202
*                                                                     * 16229201
         DC    X'4'                KEYWORD LENGTH MINUS ONE             16279201
         DC    X'6'                PARAMETER DELIMITER                  16329201
         DC    C'DATE='            KEYWORD                              16379201
         DC    C' '                FILLER                               16429201
         B     SDATE               SPECIFIC CODING                      16479201
         DC    X'02'               KEYWORD ID MASK PATTERN              16529201
         DC    X'3'                CHARS TO FOLD MINUS ONE       Y02759 16539202
*                                                                     * 16629201
         DC    X'2'                KEYWORD LENGTH MINUS ONE      Y01040 16679202
         DC    X'0'                PARAMETER DELIMITER           Y01040 16729202
         DC    C'GMT'              KEYWORD                       Y01040 16779202
         DC    C'   '              FILLER                        Y01040 16829202
         B     SETNXT              SPECIFIC CODING               Y01040 16879202
         DC    X'04'               KEYWORD ID MASK PATTERN       Y01040 16929202
         DC    X'2'                CHARS TO FOLD MINUS ONE       Y02759 16939202
*                                                                     * 17029202
         DC    X'4'                KEYWORD LENGTH MINUS ONE      Y02759 17079202
         DC    X'2'                PARAMETER DELIMITER           Y02759 17129202
         DC    C'ADDR='            KEYWORD                       Y02759 17179202
         DC    C' '                FILLER                        Y02759 17229202
         B     SADDR               SPECIFIC CODING               Y02759 17279202
         DC    X'08'               KEYWORD ID MASK PATTERN       Y02759 17329202
         DC    X'3'                CHARS TO FOLD MINUS ONE       Y02759 17379202
*                                                                     * 17429201
         DC    X'4'                KEYWORD LENGTH MINUS ONE      Y02759 17479202
         DC    X'0'                PARAMETER DELIMITER           Y02759 17529202
         DC    C'RESET'            KEYWORD                       Y02759 17579202
         DC    C' '                FILLER                        Y02759 17629202
         B     SETNXT              SPECIFIC CODING               Y02759 17679202
         DC    X'10'               KEYWORD ID MASK PATTERN       Y02759 17729202
         DC    X'4'                CHARS TO FOLD MINUS ONE       Y02759 17779202
*                                                                     * 17829202
         DC    X'3'                KEYWORD LENGTH MINUS ONE      Y02759 17879202
         DC    X'2'                PARAMETER DELIMITER           Y02759 17929202
         DC    C'IPS='             KEYWORD                       Y02759 17979202
         DC    C'  '               FILLER                        Y02759 18029202
         B     SETNXT              SPECIFIC CODING               Y02759 18079202
         DC    X'20'               KEYWORD ID MASK PATTERN       Y02759 18129202
         DC    X'2'                CHARS TO FOLD MINUS ONE       Y02759 18179202
         EJECT                                                          18229201
* LIST FORM OF ESTAE MACRO                                              18239202
*                                                                       18249202
ESTAEL   ESTAE SERREXIT,PURGE=NONE,ASYNCH=NO,RECORD=YES,MF=L            18259202
ESTAELN  EQU   *-ESTAEL            LENGTH OF ESTAE PARMLIST             18269202
         EJECT                                                          18271202
* CONSTANTS USED BY THE IMMEDIATE COMMANDS ROUTINE                    * 18279201
*                                                                     * 18329201
         DS    0F                                                       18379201
         DC    X'0000'                                                  18429201
SFFFF    DC    X'FFFF'                                                  18479201
*                                                                     * 18529201
SETCADDR DC    C'15'               MAXIMUM CPU ADDR              Y02759 18539202
SETCHR   DC    C'23'               MAXIMUM HOUR                         18579201
SETCMS   DC    C'59'               MAXIMUM MINUTE OR SECOND             18629201
SETDDY   DC    C'366'              MAXIMUM DAY                          18679201
SET99    DC    C'99'               HIGH DATE COMPRAND                   18729201
C65      DC    C'65'               CHARS TO CHANGE CSECT NAME           18739202
C66      DC    C'66'               CHARS TO CHANGE CSECT NAME           18749202
*                                                                     * 18779201
SETSET   DC    C'SET     '         VERB FOR MESSAGE MODULE              18829201
SETRPLY  DC    C'RPLY HAS'                                       Y02759 18879202
SETDD0   DC    C'000'              DDD PORTION OF DATE, 000      Y01040 18929201
SETUC    DC    6X'40'              FOR FOLDING TO UPPER CASE     Y02759 18939202
SETID    DS    0CL24               ID FOR RECOVERY RECORD               18949202
         DC    CL8'IGC0003D'       LOAD MODULE NAME                     18959202
         DC    CL8'IEE0603D'       CSECT NAME                           18969202
         DC    CL8'SETCMFRR'       ERROR IDENTIFIER                     18971202
*                                                                     * 18979201
SETCLC   CLC   FOLDAREA(1),KEYWRD(R4) COMPARE NEW KEYWORD WITH TABLE    19029202
SETTMP   TM    XAE,X'00'           TEST ID MASK PATTERN                 19079202
SETMVC   MVC   FOLDAREA(1),0(R9)   MOVE TEXT TO WORKAREA                19089202
SETOC    OC    FOLDAREA(1),SETUC   FOLD TO CAPS                         19099202
*                                                                     * 19129201
H12      DC    H'12'               TEST VALUE FOR NO SDWA               19139202
D1000    DC    F'1000'             CONSTANT FOR SHIFTING OFF DDD OF     19179202
*                                      YYDDD CONVERTED TO BINARY        19189202
*                                                                     * 19229202
         DS   0F                                                 Y01029 19379201
VCON05   DC   V(IEE0503D)          ADDRESS OF IEE0503D           Y01029 19429201
VCON08   DC   V(IEE0803D)          ADDRESS OF IEE0803D           Y02759 19439202
VCON65   DC   V(IEE6503D)          ADDRESS OF IEE6503D           Y01029 19479201
VCON66   DC   V(IEE6603D)          ADDRESS OF IEE6603D           Y02759 19499202
         EJECT                                                          19509202
SETTCWA  DSECT                                                          19519202
TCWA     DS    0D                      TOD CLOCK WORKAREA               19521202
         DS    52C                                                      19523202
TCWAGFLG DS    1C                      GLOBAL TCWA FLAGS                19525202
MSGXXX   EQU   X'80'                   MSG XXX OUTSTANDING              19527202
MSGYYY   EQU   X'40'                   MSG YYY OUTSTANDING              19527302
MSGZZZ   EQU   X'20'                   MSG ZZZ OUTSTANDING              19527402
TCGNSET  EQU   X'08'                   TOD CLOCK NOT SET                19527502
         DS    1C                                                       19528602
TCCPUCNT DS    1H                      NUMBER OF TCWA ENTRIES           19528702
         DS    56C                                                      19528802
LTCWA    EQU   *-TCWA                  LENGTH OF TCWA                   19528902
         SPACE 10                                                       19529002
SETTCENT DSECT                                                          19529102
TCENTRY  DS    0D                      TOD CLOCK WORKAREA ENTRY         19529202
         DS    12C                                                      19545802
TCWAIADD DS    1H                      I-STREAM ADDRESS                 19555802
         DS    1C                                                       19557802
TCWALFLG DS    1C                      LOCAL FLAGS                      19558202
TCLCC    EQU   X'30'                                                    19558602
LENTRY   EQU   *-TCENTRY               LENGTH OF ENTRY                  19559802
         EJECT                                                          19562502
         IHASDWA                                                        19572502
         EJECT                                                          19574502
SETXSA   DSECT                                                          19579201
         IEEXSA                                                         19629201
         EJECT                                                          19639202
*                                                                       19649202
* THIS MAPS THE XASAVSTD FIELD OF THE EXTENDED XSA. IT IS USED          19659202
* FOR A REGISTER SAVEAREA, AND A WORKAREA FOR BOTH MAINLINE AND         19669202
* RECOVERY.                                                             19673202
*                                                                       19675202
         ORG   XASAVSTD            MAP ON EXTENDED SAVEAREA             19677202
FOLDAREA DS    8C                  WORKAREA FOR FOLDING KEYWORDS        19677602
EXITPARM DS    0CL28               PARM AREA USED BY ESTAE EXIT RTN     19678002
REGSAVE  EQU   EXITPARM            SAVEAREA FOR REGS 9 THRU 15          19678402
R9SAVE   DS    F                                                        19678802
R10SAVE  DS    F                                                        19678902
R11SAVE  DS    F                                                        19679002
R12SAVE  DS    F                                                        19679102
R13SAVE  DS    F                                                        19682402
R14SAVE  DS    F                                                        19684402
R15SAVE  DS    F                                                        19684802
         ORG   R15SAVE             MAP ON FIELD R15SAVE                 19685002
EXITFLGS EQU   *                   FLAGS FOR ESTAE EXIT RTN             19685202
CSECTCDE DS    C                   BITS 0 AND 1 ARE THE ONLY BITS USED  19685602
*                                    '00'B IS MODULE IEE0603D           19685702
*                                    '01'B IS MODULE IEE6503D           19685802
*                                    '11'B IS MODULE IEE6603D           19692002
         DS    3C                  RESERVED                             19695202
ESTAELST ESTAE SERREXIT,PURGE=NONE,ASYNCH=NO,RECORD=YES,MF=L            19697202
         EJECT                                                          19698202
         CVT   DSECT=YES                                                19704402
         EJECT                                                          19710602
         IEAVVTPC                                                       19716802
         EJECT                                                          19723002
         IEEBASEA                                                       19729201
         END                                                            19779201
