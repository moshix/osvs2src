IEE0803D TITLE 'COMMAND SCHEDULE MODULE'                                00200002
*********************************************************************** 00400002
* MODULE NAME = IEE0803D                                              * 00600002
* DESCRIPTIVE NAME = CSCB, ASCB CREATION                              * 00800002
*                                                                     * 01000002
* COPYRIGHT = N/A                                                     * 01200002
*                                                                     * 01400002
* STATUS    =    OS/VS2 - SERVICE DATA IMPROVEMENTS           @G17SPTJ* 01420041
*                                                                     * 01800002
* FUNCTION =  FOR MOUNT, START, LOGON, DUMP, UNLOAD, DISPLAY,         * 02000002
*             TRACK, SET, VARY STORAGE, VARY CHANNEL, VARY CPU,       * 02200002
*             VARY ONLINE, VARY OFFLINE, VARY CONSOLES, RESET, SEND   * 02250002
*             QUIESCE, SWITCH, HALT, PAGEADD AND SLIP         @G17SPTJ* 02300041
*             COMMANDS.                                       @G17SPTJ* 02400041
*             IEE0803D BUILDS A CSCB TO HOLD THE COMMAND,     @Z40WPSS* 02450040
*             ENCODES THE COMMAND AND STORES IT IN THE CSCB.  @Z40WPSS* 02500040
*             FOR START, MOUNT AND LOGON, AN ASCB IS CREATED  @Z40WPSS* 02550040
*             AS PART OF INITIALIZATION FOR A NEW MEMORY.     @Z40WPSS* 02600040
*             FOR HOLD AND RELEASE TP, CONTROL IS PASSED TO   @Z40WPSS* 02650040
*             IED1303D.                                       @Z40WPSS* 02700040
*                                                                     * 03600002
* OPERATION = A CONDITIONAL GETMAIN IS DONE FOR THE CORE FOR          * 03800002
*             THE CSCB.  IN THE CASE OF INSUFFICIENT CORE,            * 04000002
*             AN ERROR CODE IS PASSED TO IEE0503D (MESSAGE            * 04200002
*             MODULE). THE CSCB IS INITIALIZED WITH THE               * 04400002
*             VERB CODE,CSCB SIZE, CONSOLE ID, SCREEN AND             * 04600002
*             AREA ID, ASID AND OPERAND DATA. ALSO,FOR DISPLAY        * 04800002
*             AND TRACK PROCESSING, AN INDICATOR IS SET TO            * 05000002
*             DESIGNATE STARTED TASK OR LOGON FOR DISPLAY JOBS        * 05200002
*             OR DISPLAY TS.  (STARTED JOBS ONLY.)  FOR               * 05400002
*             START, MOUNT AND LOGON, IEAVEMRQ IS USED FOR            * 05600002
*             ASCB CREATION. A PTR TO THE CSCB WILL BE PASSED         * 05800002
*             TO IEAVEMRQ FROM THIS MODULE IN A PARMLIST              * 06200002
*             POINTED TO BY REG1. ON RETURN  FROM IEAVEMRQ            * 06400002
*             THE CSCB CONTAINS THE ASID FOR THE NEW MEMORY.          * 06600002
*             REG0 ALSO CONTAINS THE ASID.                            * 06800002
*             RETURN CODES FROM THE ROUTINE ARE PROCESSED.            * 07200002
*             IF ASCB CREATION FAILS, THE CSCB IS FREED AND           * 07400002
*             AN ERROR CODE IS NORMALLY PASSED TO IEE0503D.   @Z30BPSV* 07600003
*             IF A START COMMAND NOT ISSUED UNDER THE         @Z30BPSV* 07700003
*             COMMUNICATIONS TASK IS BEING PROCESSED, A       @Z30BPSV* 07800003
*             SUBSYSTEM EXIT IS TAKEN AND                     @Z30BPSV* 07900003
*             A RETURN CODE OF 8 IS PASSED TO THE CALLER      @Z30BPSV* 08000003
*             IF ASCB CREATION IS SUCCESSFUL, AN ENQ IS DONE ON       * 08200002
*             THE CSCB CHAIN, THE NEW CSCB IS ENCHAINED, AND A        * 08400002
*             DEQ IS DONE.  THE ASSIGNMENT PENDING BIT HAS BEEN       * 08600002
*             SET IN THE CSCB AND THE MASTER SCHEDULER WAIT           * 08800002
*             ROUTINE IS CROSS MEMORY POSTED.                         * 09000002
*                                                                     * 09200002
* CHARACTER CODE DEPENDENCIES =                                       * 09400002
*             ANY CHARACTER CODE OTHER THAN EBCDIC WILL REQUIRE       * 09600002
*             REASSEMBLY OF MODULE.                                   * 09800002
         EJECT                                                          10050002
* DEPENDENCIES =                                                      * 10200002
*             MERGE OF IEE2103D AND IEE0503D INTO IEE0503D.           * 10400002
*             IEAVEMRQ - MEMORY CREATE                                * 10600002
*                                                                     * 10800002
* RESTRICTIONS =                                                      * 11000002
*             NONE                                                    * 11200002
*                                                                     * 11400002
* REGISTER CONVENTIONS =                                              * 11600002
*             R0  - MACRO USAGE                                       * 11800002
*             R1  - MACRO USAGE                                       * 12000002
*             R14 - RETURN ADDRESS                                    * 12200002
*             R15 - RETURN CODES                                      * 12400002
*                                                                     * 12600002
* PATCH LABEL =                                                       * 12800002
*             PTCH803D: RESERVED PATCH AREA 70 BLANKS.                * 13000002
*                                                                     * 13200002
* MODULE TYPE =                                                       * 13400002
*             CSECT                                                   * 13600002
* MODULE SIZE =                                                       * 13800002
*             FORMER DESIGN POINT CONSTRAINTS OF 1 K LOADS            * 14000002
*             FOR SVCS HAVE BEEN REMOVED. N.A.                        * 14200002
* ATTRIBUTES =                                                        * 14400002
*             REENTRANT, PAGED LPA, ZERO PSW KEY, SUPERVISOR          * 14600002
*             MODE                                                    * 14800002
* ENTRY POINT =                                                       * 15000002
*             IEE0803D FROM THE FOLLOWING MODULES:                    * 15200002
*                IEE0403D  START, MOUNT, LOGON, HOLD, RELEASE,        * 15250041
*                          UNLOAD, RESET, QUIESCE, DUMP,      @G17SPTJ* 15400041
*                          PAGEADD AND SLIP.                  @G17SPTJ* 15600041
*                          NO TEST IS MADE FOR THE PAGEADD    @Z40WPSS* 15603041
*                          COMMAND IN THIS MODULE.            @Z40WPSS* 15610041
*                IEE0603D  SET                                        * 15650002
*                IKJ5803D  SEND                                       * 15800002
*                IEE3203D  VARY CHANNEL, VARY CPU, VARY STORAGE       * 16000002
*                          VARY ONLINE, VARY OFFLINE, VARY CONSOLES   * 16050002
*                          VARY PATH, VARY CN                         * 16120040
*                IEE1403D  HALT, SWITCH                               * 16200002
*                IEE3503D  DISPLAY PFK                                * 16400002
*                IEE7503D  TRACK AND OTHER DISPLAY OPERANDS.          * 16600002
*                                                                     * 16800002
* PURPOSE =   CSCB CREATION FOR TASK CREATING COMMANDS.               * 17000002
*             ASCB & CSCB CREATION FOR MEMORY CREATING                * 17200002
*             COMMANDS.                                               * 17400002
*                                                                     * 17600002
* LINKAGE =   BRANCH VIA VCONS.                                       * 17800002
         EJECT                                                          17850002
*                                                                     * 18000002
* INPUT DATA =                                                        * 18200002
*             R2 POINTS TO THE EXTENDED SAVE AREA (XSA).              * 18400002
*             R14 CONTAINS RETURN ADDRESS.                            * 18600002
*             XSA INITIALIZED AS FOLLOWS:                             * 18800002
*                XAU CONTAINS UCMI                                    * 19000002
*                XAL CONTAINS PTR TO COMMAND OPERANDS IN              * 19200002
*                    BUFFER.                                          * 19400002
*                XAR CONTAINS PTR TO COMMAND INPUT BUFFER             * 20000002
*                XAS CONTAINS SCREEN AREA ID IN XASDID                * 20200002
*                XAS CONTAINS ROUTED CONSOLE ID FROM                  * 20400002
*                    L=CCA IN XASCID                                  * 20600002
*                XAA CONTAINS ASID FROM TSO ISSUED                    * 20800002
*                    COMMANDS (SEND, DISPLAY). THIS                   * 21000002
*                    FIELD WAS FORMERLY THE TJID.                     * 21200002
*                XAN CONTAINS THE VERB CODE                           * 21400002
*                XAV CONTAINS COMMAND VERB AS ENTERED                 * 21600002
*                XAX CONTAINS INFORMATION ON DISPLAY                  * 21800002
*                    COMMAND OPERANDS IN A BIT MASK.                  * 22200002
*                                                                     * 22400002
* REGISTERS SAVED =  NONE                                             * 22600002
* REGISTER CONTENTS DURING PROCESSING =                               * 22800002
*             R2  - XSA BASE                                          * 23000002
*             R3  - PROGRAM BASE ADDRESSIBILITY                       * 23200002
*             R4  - BASEA ADDRESSIBILITY                              * 23400002
*                                                                     * 23600002
*             R5  - ADDRESSIBILITY TO CSCB CHAIN                      * 23800002
*                   ACCESS COMMAND BUFFER THROUGH XAL                 * 24000002
*             R6  - CSCB CHAIN POINTERS                               * 24200002
*             R7  - CVT ADDRESSIBILITY                                * 24400002
*             R8  - ADDRESSIBILITY TO NEWLY CREATED CSCB              * 24600002
*             R13 - SAVE AREA ADDRESS FOR IEAVEMRQ                    * 24650002
*                                                                     * 24800002
* REGISTERS RESTORED =                                                * 25000002
*             NONE                                                    * 25200002
         EJECT                                                          25250002
**********************************************************************  25400002
* EXIT - NORMAL =                                                     * 25600002
*             POSTEXIT                                                * 25800002
* CONDITIONS =                                                        * 26000002
*             COMPLETION OF SVC34 PROCESSING FOR TASK AND             * 26200002
*             MEMORY CREATING COMMANDS.  EXIT IS A RETURN             * 26400002
*             TO CALLER.                                              * 26600002
* OUTPUT DATA =                                                       * 26800002
*             CSCB, ASCB, ASID                                        * 27000002
* RETURN CODE =                                                       * 27200002
*             R15 = 0                                                 * 27400002
*********************************************************************** 27600002
* EXIT - NORMAL =                                                     * 27800002
*             EXIT13                                                  * 28000002
* CONDITIONS =                                                        * 28200002
*             A VALID HOLD TP OR RELEASE TP COMMAND HAS BEEN          * 28400002
*             ENTERED. EXIT IS TO IED1303D TO PROCESS THE             * 28600002
*             COMMAND.                                                * 28800002
* OUTPUT DATA =                                                       * 29000002
*             SAME AS INPUT DATA IF VALID.                            * 29200002
* RETURN CODES =                                                      * 29400002
*             NONE                                                    * 29600002
*********************************************************************** 32000002
* EXIT - ERROR =                                                      * 32200002
*             EXIT3A                                                  * 32400002
* CONDITIONS =                                                        * 32600002
*             NO CSCB (OR ASID IF FOR LOGON, MOUNT OR START)  @Z30BPSV* 32800003
*             CREATED.                                        @Z30BPSV* 32900003
*             XAE FIELD CONTAINS ERROR CODE. DUE TO                   * 33000002
*             GETMAIN FAILURE FOR CSCB. TAKEN VIA BRANCH              * 33200002
*             ON VCON TO IEE0503D MESSAGE MODULE, PROVIDED    @Z30BPSV* 33400003
*             THE SUBSYSTEM INDICATED THAT THE MESSAGE IS TO  @Z30BPSV* 33450003
*             BE ISSUED FOR FAILING START COMMANDS ISSUED     @Z30BPSV* 33500003
*             UNDER A TASK OTHER THAN COMMTASK.               @Z30BPSV  33550003
*             THE SAME EXIT IS TAKEN IF ASCB CREATION FAILS           * 33600002
*             WITH A RETURN CODE OF 4, 8, OR 12.  THE EXACT           * 33800002
*             MEANING OF THESE CODES ARE LISTED IN A BLOCK            * 34000002
*             COMMENT WHERE THE MACRO IS CALLED.                      * 34200002
* OUTPUT DATA =                                                       * 34400002
*             ERROR CODE IN XAE FIELD OF XSA IS X'3A'.                * 34600002
* RETURN CODES =                                                      * 34800002
*             R15 = 8                                         @Z30BPSV* 35000003
**********************************************************************  35010002
         EJECT                                                          35050002
*********************************************************************** 35200002
* EXIT - ERROR =                                                      * 35400002
*             EXIT05                                                  * 35600002
* CONDITIONS =                                                        * 35800002
*             HOLD OR RELEASE COMMAND AND NO TP= KEYWORD              * 36000002
*             IN OPERAND. TAKEN VIA BRANCH ON VCON TO                 * 36200002
*             IEE0503D MESSAGE MODULE.                                * 36400002
* OUTPUT DATA =                                                       * 36600002
*             XAE FIELD CONTAINS ERROR CODE OF X'05'.                 * 36800002
* RETURN CODES =                                                      * 37000002
*             NONE                                                    * 37200002
*********************************************************************** 37400002
* EXIT - ERROR =                                                      * 37600002
*             EXIT0B                                                  * 37800002
* CONDITIONS =                                                        * 38000002
*             A COMMAND WAS ISSUED WITH NO PARAMETERS.                * 38200002
*             TAKEN VIA BRANCH ON VCON TO IEE0503D.                   * 38250002
* OUTPUT DATA =                                                       * 38400002
*             XAE CONTAINS ERROR CODE X'0B' IN XSA.                   * 38600002
* RETURN CODES =                                                      * 38800002
*             NONE                                                    * 39000002
*********************************************************************** 39250002
* EXIT - ERROR =                                                      * 39400002
*             EXIT3E                                                  * 39600002
* CONDITIONS =                                                        * 39800002
*             DUMP COMMAND WAS ISSUED WITHOUT COMM PARM.              * 40000002
*             EXIT IS TO IEE0503D MESSAGE MODULE.                     * 40200002
* OUTPUT DATA =                                                       * 40400002
*             XAE CONTAINS ERROR CODE X'3E' IN XSA.                   * 40600002
* RETURN CODES =                                                      * 40800002
*             NONE                                                    * 41000002
*********************************************************************** 41200002
         EJECT                                                          41210002
*********************************************************************** 41250002
* EXTERNAL REFERENCES =                                               * 41400002
* ROUTINES =  IEE0503D ERROR MESSAGE MODULE                           * 41600002
*             IED1303D TP PROCESSING MODULE                           * 42000002
*             IEAVEMRQ MEMORY REQUEST MODULE                          * 42050002
* DATA AREAS =                                                        * 42200002
*             NONE                                                    * 42400002
* CONTROL BLOCKS =                                                    * 42600002
*             IEECHAIN CSCB CREATED IN MODULE                         * 42800002
*             ASCB     ASCB CREATED IN MODULE                         * 43000002
*             IEEXSA   EXTENDED SAVE AREA                             * 43200002
*             IEEBASEA MASTER RESIDENT CORE                           * 43400002
*             IEFPTRS  NEW/OLD TCB ASCB POINTERS              @Z30BPSV* 43430003
*             IEECUCM  UNIT CONTROL MODULE                    @Z30BPSV* 43460003
*             IEFJESCT JES CONTROL TABLE                      @Z30BPSV* 43490003
*             IEFJSSOB SUBSYSTEM OPTION BLOCK                 @Z30BPSV* 43520003
*             IEFJSSIB SUBSYSTEM IDENTIFICATION BLOCK         @Z30BPSV* 43550003
* TABLES =    NONE                                                    * 43600002
* MACROS =    GETMAIN, FREEMAIN, ENQ, DEQ, POST,                      * 43800002
*             IEFJESCT, IEFJSSOB, IEFJSSIB, IEFSSREQ          @Z30BPSV* 43900003
*             ENQ AND DEQ FOR CSCB CHAIN.   ENQ IS EXCLUSIVE.         * 44000002
*             MINOR NAME = Q10.                                       * 44200002
*             MAJOR NAME = SYSIEFSD.                                  * 44250002
*                                                                     * 44400002
* MESSAGES =                                                          * 44600002
*             MSGID    CODE   MSG                                     * 44800002
*             IEE305I  05     COMMAND INVALID                         * 45000002
*             IEE311I  0B     PARM MISSING                            * 45200002
*             IEE328I  3A     COMMAND ABORTED                         * 45400002
*             IEE535I  3E     INVALID DUMP PARAMETER                  * 45600002
*                                                                     * 45800002
*             IEE0503D ISSUES THE MESSAGES AND                        * 46000002
*             CONTAINS THE TEXT.                                      * 46200002
*                                                                     * 46600002
* SYSGEN =    MODULE INCLUDED IN IGC0003D, IN SYSGEN MACRO            * 46800002
*             SGIEF441 FROM AOSB3 DISTLIB. TARGLIB IS                 * 47000002
*             SYS1.LPALIB.                                            * 47050002
* SYSTEM LIBRARIES =                                                  * 47200002
*             NONE.                                                   * 47400002
*********************************************************************** 47600002
         TITLE 'CSCB EXPANSION'                                         47650002
CHFIRST  DSECT                                                          47800002
         IEECHAIN                                                       48000002
         TITLE 'BASEA EXPANSION'                                        48050002
         IEEBASEA                                                       48200002
         TITLE 'XSA EXPANSION'                                          48250002
IEEXSA   DSECT                                                          48400002
         IEEXSA                                                         48600002
         TITLE 'CVT ENTRIES'                                            49800002
CVT      DSECT                                                          50000002
         CVT                                                            50200002
         TITLE 'NEW/OLD TCB ASCB POINTERS'                              50204003
         IEFPTRS                                                        50208003
         TITLE 'UNIT CONTROL MODULE'                                    50212003
         IEECUCM FORMAT=NEW                                             50216003
         TITLE 'JOB ENTRY SUBSYSTEM CONTROL TABLE'                      50220003
         IEFJESCT                                                       50224003
         TITLE 'SUBSYSTEM OPTIONS BLOCK'                                50228003
         IEFJSSOB CF                                                    50232003
         TITLE 'SUBSYSTEM IDENTIFICATION BLOCK'                         50236003
         IEFJSSIB                                                       50240003
         TITLE 'EQUATES'                                                50250002
IEE0803D CSECT                                                          50400002
*********************************************************************** 50600002
*                                                                     * 50800002
*                     REGISTER USAGE                                  * 51000002
*                                                                     * 51200002
*********************************************************************** 51400002
R0       EQU   0                  SIZE REGISTER FOR FREEMAIN     Y02669 51450002
R1       EQU   1                  GOTTEN CORE POINTER FROM GETMAIN.     51600002
R2       EQU   2                  PTR TO EXTENDED SAVE AREA.            51800002
R3       EQU   3                  BASE REGISTER.                        52000002
R4       EQU   4                  RESIDENT CORE BASE REGISTER.          52200002
R5       EQU   5                  CSCB CHAIN ADDRESSIBILITY             52400002
R6       EQU   6                  WORK REGISTER.                        52600002
R7       EQU   7                  CVT ADDRESSIBILITY                    52800002
R8       EQU   8                  NEW CSCB ADDRESSIBILITY               53000002
R9       EQU   9                  WORK REGISTER.                        53010002
R10      EQU   10                 WORK REGISTER.                        53020002
R11      EQU   11                 BAL REGISTER                   A00042 53030002
R12      EQU   12                 WORK REGISTER                  A00042 53040002
R13      EQU   13                 SAVE AREA ADDRESS REGISTER     Y02669 53050002
R14      EQU   14                 RETURN REGISTER.                      53200002
R15      EQU   15                 EXIT REGISTER                  Y02669 53400002
*********************************************************************** 53600002
*                                                                     * 53800002
*                    DISPLACEMENTS                                    * 54000002
*                                                                     * 54200002
*********************************************************************** 54400002
D0       EQU   0                        *                         20002 54600002
D1       EQU   1                        *                               54800002
D2       EQU   2                  LENGTH OF ASID                 Y02669 55000002
D3       EQU   3                  LENGTH OF 'TP='                Y02669 55200002
D4       EQU   4                  OFFSET IN GETMAIN LIST FOR     Y02669 55250002
*                                 GOTTEN CORE PTR                Y02669 55300002
D6       EQU   6                  LENGTH OF 'COMM=(' PARM        Y02669 55400002
D8       EQU   8                  LENGTH OF XSA MSG FILL         Y02669 55600002
D124     EQU   124                LENGTH OF BUFFER AREA          Y01012 56000002
BLANK    EQU   C' '               BLANK FOR PADDING CHBUF       YM25013 56050002
         EJECT                                                          56200002
*********************************************************************** 56400002
*                                                                       56600002
*                     VERB CODES                                        56800002
*                                                                       57000002
*********************************************************************** 57200002
START    EQU   X'04'              START COMMAND VERB CODE        Y01012 57400002
MOUNT    EQU   X'0C'              MOUNT COMMAND VERB CODE        Y02669 57600002
VARY     EQU   X'28'              VARY COMMAND VERB CODE         Y02669 57650002
VPATH    EQU   X'50'              VARY PATH COMMAND VERB CODE    Y02669 57652002
VCPU     EQU   X'54'              VARY CPU COMMAND VERB CODE     Y02669 57654002
VCH      EQU   X'58'              VARY CHANNEL COMMAND VERB CODE Y02669 57656002
VSTOR    EQU   X'5C'              VARY STORAGE COMMAND VERB CODE Y02669 57658002
QUIESCE  EQU   X'60'              QUIESCE COMMAND VERB CODE      Y02669 57660002
HOLD     EQU   X'6C'              HOLD COMMAND VERB CODE         Y02669 57700002
RELEASE  EQU   X'70'              RELEASE COMMAND VERB CODE      Y02669 57750002
LOGON    EQU   X'98'              LOGON COMMAND VERB CODE        Y02669 58050002
DUMP     EQU   X'AC'              DUMP COMMAND VERB CODE         Y02669 58200002
TRACK    EQU   X'C4'              TRACK COMMAND VERB CODE        Y02669 58250002
*********************************************************************** 58400002
*                                                                       58600002
*                   ERROR CODES                                         58800002
*                                                                       59000002
*********************************************************************** 59200002
INVCODE  EQU   X'05'              COMMAND INVALID MSG CODE       Y02669 59400002
PARMCDE  EQU   X'0B'              PARAMETER MISSING MSG CODE     Y02669 59600002
NOCORECD EQU   X'3A'              CODE FOR NO CORE MSG           A34263 59800002
DUMPCDE  EQU   X'3E'              INVALID DUMP CMD ERROR CODE    Y01012 60000002
*********************************************************************** 60030003
*                                                                     * 60060003
*                         MISCELLANEOUS CONSTANTS              @Z30BPSV 60090003
*                                                                     * 60120003
*********************************************************************** 60150003
CSCBSZE  EQU   CHLAST-CHFIRST     SIZE OF CSCB                   Y02669 60200002
PTR      EQU   4                  INDIRECT ADDRESS             @Z30BPSV 60204003
SSSTORE  EQU   SSIBSIZE+SSOBLN16+PTR  SIZE OF SUBSYSTEM        @Z30BPSV 60213003
*                                 INTERFACE STORAGE            @Z30BPSV 60222003
HYBITON  EQU   X'80'              MASK FOR END-OF-LIST         @Z30BPSV 60231003
LOBYTES  EQU   7                  MASK FOR ICM                 @Z30BPSV 60240003
         TITLE 'COMMAND SCHEDULE MODULE'                                60250002
*********************************************************************** 60300002
*     ESTABLISH ADDRESSIBILITY AND BASE FOR XSA, BASEA.          Y02669 60310002
*     CHECK IF NO OPERANDS ON COMMAND. IF NONE, SET UP           Y02669 60320002
*     ERROR CODE FOR PARM MISSING MESSAGE, IEE311I.              Y02669 60330002
*     (QUIESCE AND LOGON ARE EXCEPTIONS AND CAN HAVE NO          M00875 60340002
*     OPERANDS.) IF OPERANDS PRESENT, CONTINUE WITH              Y02669 60342002
*     PROCESSING.                                                Y02669 60344002
*********************************************************************** 60350002
         BALR  R3,0               BASE                           Y02669 60400002
         USING *,R3               REGISTER.                             60600002
         MODID BRANCH=YES                                               60800002
         USING IEEXSA,R2          EXTENDED SAVE AREA BASE               61000002
         L     R7,CVTPTR          ADDRESS OF CVT                        61200002
         USING CVT,R7             ESTABLISH CVT ADDRESSABILITY   Y01012 61400002
         L     R4,CVTMSER         MASTER RESIDENT CORE ADDRESSING.      61600002
         USING BASE,R4            ESTABLISH ADDRESSIBILITY              61800002
         ST    R14,XASAVLOC       SAVE RETURN ADDRESS            Y02669 61850002
         L     R5,XAL             GET PTR TO LIST POSITION              62000002
         LA    R5,D0(R5)          CLEAR HIGH ORDER GARBAGE              62200002
         CLI   XAN,QUIESCE        IS THIS QUIESCE COMMAND?       Y02651 62250002
         BE    CSCB               YES, BYPASS OPERAND CHECK      Y02651 62300002
         CLI   XAN,LOGON          IS THIS LOGON COMMAND?         M00875 62350002
         BE    CSCB               YES,BYPASS OPERAND CHECK       M00875 62400002
         LTR   R5,R5              ARE THERE ANY OPERANDS?        Y02669 62600002
         BZ    EXIT0B             NO. ERROR                      Y02669 62800002
         EJECT                                                          62810002
*********************************************************************** 62850002
*     IF DUMP COMMAND, VALIDITY CHECK FOR 'COMM=(' IN THE        Y02669 62860002
*     FIRST PART OF OPERAND. IF NONE, SET UP ERROR CODE          Y02669 62870002
*     IN THE XSA  FOR PARM INVALID MESSAGE, IEE535I.             Y02669 62880002
*     IF OK, GO GET CSCB CORE.                                   Y02669 62890002
*     ON HOLD AND RELEASE COMMANDS, CHECK FOR TP= AS THE         Y02669 62892002
*     OPERAND. IF IT IS NOT TP=, SET UP ERROR CODE FOR           Y02669 62894002
*     INVALID PARM MESSAGE, IEE305I. IF OK, BRANCH TO            Y02669 62896002
*     IED1303D TO PROCESS COMMAND.                               Y02669 62898002
*********************************************************************** 62900002
CHECDUMP EQU   *                                                 Y02651 62960002
         CLI   XAN,DUMP           THIS DUMP COMMAND?             Y02669 63000002
         BNE   CHECHOLD           NO, CHECK FOR HOLD CMD         Y02669 63200002
         CLC   D0(D6,R5),COMM     YES, THIS 'COMM=(' PARAMETER?  Y02669 63400002
         BE    CSCB               YES,THEN SET UP THE CSCB       Y02669 63600002
         B     EXIT3E             NO, INVALID PARM RTN           Y02669 63800002
CHECHOLD EQU   *                                                        64000002
         CLI   XAN,HOLD           IS IT HOLD COMMAND              20002 64200002
         BE    CHECKTP            YES, CHECK FOR 'TP='            20002 64400002
         CLI   XAN,RELEASE        IS IT RELEASE COMMAND           20002 64600002
         BNE   CSCB               NO, CONTINUE                   Y02669 64800002
CHECKTP  EQU   *                                                  20002 65000002
         CLC   TPEQLS(D3),D0(R5)  CHECK FOR 'TP='                Y01012 65200002
         BE    EXIT13             YES, BRANCH TO IED1303D        Y02669 65400002
         B     EXIT05             NO, INVALID PARM RTN           Y02669 65600002
         EJECT                                                          68400002
*********************************************************************** 68450002
*     DO CONDITIONAL GETMAIN IN SP245 FOR CSCB. IF NO            Y02669 68460002
*     CORE, SET UP COMMAND ABORTED MESSAGE, IEE328I. IF          Y02669 68470002
*     OK, INITIALIZE CSCB WITH INFORMATION IN XSA.               Y02669 68480002
*********************************************************************** 68500002
         SPACE                                                          68550002
CSCB     EQU   *                                                        68600002
         MVC   XASAVSTD(GETLNG),GETLIST                          Y02669 68800002
         LA    R1,XASAVSTD+D4     XAD SHOULD POINT TO            Y02669 69000002
         ST    R1,XASAVSTD+D4     GOTTEN CORE                    Y02669 69200002
         LA    R1,XASAVSTD        PREPARE R1 FOR GETMAIN         A34263 69400002
         GETMAIN MF=(E,(1))       EXECUTE FORM OF GETMAIN        A34263 69600002
         LTR   R15,R15            WAS CORE AVAILABLE             A34263 69800002
         BZ    GOTCSCB            YES,CONTINUE                 @Z30BPSV 69850003
         LA    R8,SSCFCSFL        SET CSCB FAIL CODE           @Z30BPSV 69920003
         ST    R8,XAK             FOR SUBSYSTEM                @Z30BPSV 69990003
         B     EXIT3A             SET UP FOR MESSAGE           @Z30BPSV 70060003
GOTCSCB  EQU   *                                               @Z30BPSV 70130003
         L     R8,XASAVSTD+D4     PREPARE ADDRESSABILITY         Y02669 70200002
         USING CHAIN,R8           R8 CONTAINS PTR TO GOTTEN CORE Y02669 70400002
         XC    CHAIN(CSCBSZE),CHAIN     CLEAR CSCB TO ZEROES     Y01012 70600002
         MVI   CHBUF,BLANK              CLEAR CHBUF TO BLANKS   YM25013 70650002
         MVC   CHBUF+D1(L'CHBUF-1),CHBUF                        YM25013 70700002
         MVC   CHVCD(D1),XAN      MOVE VERB CODE TO GOTTEN CORE. Y02669 70800002
         MVI   CHSZE,(CSCBSZE/D8) CSCB SIZE IN DOUBLE WORDS      Y01012 71000002
         MVC   CHUCMP(D1),XAU     PUT UCMI INTO CSCB                MCS 71400002
*                                 DISPLAY OPERANDS MASK          Y02669 71410002
         MVC   CHTRSTAT(D1),XAXMASK                                     71450002
         MVC   CHASID,XAA         MOVE ASID FOR TSO IN OP. MODE YM01854 71460002
         EJECT                                                          71500002
*********************************************************************** 71550002
*                                                                       71600002
*     THE FOLLOWING CODE ANSWERS A PROBLEM FOUND IN FIELD TEST   A00042 71602002
*     FOR RELEASE 1 OF VS/2.                                            71602402
*     A USER WAS ISSUING COMMANDS AFTER GETTING INTO KEY ZERO.   A00042 71604002
*     THE COMMAND BUFFER IN HIS PROGRAM ENDED NEAR A 4K BOUN-    A00042 71606002
*     DARY. THE PREVIOUS CODE BLINDLY MOVED 124 CHARACTERS INTO  A00042 71608002
*     CHBUF FROM THE COMMAND INPUT BUFFER. WITH THE INTRODUC-    A00042 71608402
*     TION OF VIRTUAL STORAGE, IT WAS POSSIBLE TO HIT THE BOUN-  A00042 71608802
*     DARY OF AN UNITIALIZED PAGE IN THE MOVE, RESULTING IN AN   A00042 71609202
*     0C4.  NOW THE LENGTH OF THE OEPRANDS IS CALCULATED VIA     A00042 71609602
*     THE LENGTH FIELD OF THE INPUT BUFFER AND THE ADDRESS OF    A00042 71609702
*     WHERE THE OPERANDS BEGIN.                                  A00042 71609802
*                                                                       71609902
*********************************************************************** 71623202
         CLI   CHVCD,QUIESCE      IS IT QUIESCE COMMAND?         A00042 71625202
         BE    INITREST           YES, BYPASS OPERAND MOVE AS    A00042 71627202
*                                 QUIESCE HAS NO OPERANDS.       A00042 71629202
         CLI   CHVCD,LOGON        IS IT LOGON COMMAND?           M00875 71631202
         BE    INITREST           LOGON HAS NO OPERANDS          M00875 71631602
         L     R12,XAR            ADDRESS COMMAND INPUT BUFFER   A00042 71633202
         LA    R12,D0(R12)        CLEAR HIGH ORDER BYTE          A00042 71633602
         AH    R12,D0(R12)        COMPUTE END OF BUFFER          A00042 71635202
         SR    R12,R5             SUBTRACT BEGINNING OF          A00042 71635602
*                                 OPERANDS FROM END OF BUFFER    A00042 71635702
*                                 TO GET LENGTH                  A00042 71635802
         CH    R12,CHBUFLNG       DO OPERANDS EXCEED CSCB        A00042 71636002
*                                 BUFFER LENGTH?                 A00042 71636402
         BNH   CHKONES            NO, CHECK IF LESS THAN ONE     A00042 71636502
         LH    R12,CHBUFLNG       YES, MOVE CSCB BUFFER LENGTH   A00042 71636602
         B     MOVEOPS            GO EXECUTE MOVE                A00042 71641002
CHKONES  EQU   *                                                 A00042 71643002
         CH    R12,HALFONE        IS LENGTH AT LEAST ONE?        A00042 71645002
         BNL   MOVEOPS            YES, MOVE OPERANDS TO CSCB     M00837 71645402
         BAL   R11,FREECSCB       NO, FREE GOTTEN CORE           A00042 71649902
         B     EXIT0B             ISSUE ERROR MSG, IEE311I       A00042 71651902
MOVEOPS  EQU   *                                                 A00042 71654602
         BCTR  R12,D0             DECREMENT BY ONE FOR MOVE      A00042 71659102
         EX    R12,MVECHBUF       MOVE OPERANDS TO CSCB          A00042 71669102
INITREST EQU   *                                                 A00042 71671102
         OI    CHSTS,CHAP         SET ASSIGNMENT PENDING BIT     Y02669 71672802
         TM    XASSDS,XASSDS1     IS THIS A STATUS DISPLAY       Y02669 71686402
         BZ    SETCONID           NO, USE ISSUING CONSOLE ID     Y02669 71700002
         MVC   CHCNID(D1),XASCID  SAVE CONSOLE ID                Y02669 71750002
         MVC   CHARID(D1),XASDID  SAVE DISPLAY AREA ID           Y02669 71760002
         B     CHKVARY            CHECK FOR VARY COMMAND         Y02669 71770002
SETCONID EQU   *                                                 Y02669 71780002
         MVC   CHCNID(D1),CHUCMP  CONSOLE ID OF ISSUING CON      Y02669 71790002
         EJECT                                                          71792002
*********************************************************************   71800002
*     FOR VARY COMMANDS, THE READER'S COMMAND AUTHORITY          Y02669 71810002
*     IS STORED IN THE XAS FIELD BY IEE5403D. IEE0803D           Y02669 71820002
*     TRANSFERS THIS TO THE CHINC FIELD SO THAT THE              Y02669 71830002
*     ATTACHED VARY PROCESSORS CAN ACCESS THE INFORMA-           Y02669 71832002
*     TION AFTER THE XSA IS FREED.                               Y02669 71834002
*********************************************************************   71836002
         SPACE                                                          71836402
CHKVARY  EQU   *                                                 Y02669 71838002
         CLI   CHVCD,VARY         IS IT VARY COMMAND?            Y02669 71838402
         BE    SETAUTH            YES, MOVE RDR AUTHORIZATION    Y02669 71838502
         CLI   CHVCD,VPATH        IS IT VARY PATH COMMAND?       Y02669 71838602
         BE    SETAUTH            YES, MOVE RDR AUTHORIZATION    Y02669 71838702
         CLI   CHVCD,VCPU         IS IT VARY CPU COMMAND?        Y02669 71840802
         BE    SETAUTH            YES, MOVE RDR AUTHORIZATION    Y02669 71842802
         CLI   CHVCD,VCH          IS IT VARY CHANNEL COMMAND?    Y02669 71843202
         BE    SETAUTH            YES, MOVE RDR AUTHORIZATION    Y02669 71845602
         CLI   CHVCD,VSTOR        IS IT VARY STORAGE COMMAND?    Y02669 71847602
         BE    SETAUTH            YES, MOVE RDR AUTHORIZATION    Y02669 71847702
         B     CHKSTART           NO, CHECK NEED FOR IEAVEMRQ    Y02669 71848002
SETAUTH  EQU   *                                                 Y02669 71850102
         MVC   CHINC(D2),XAS      MOVE READER CMND AUTH          Y02669 71850402
         B     ENQCSCB            GO CHAIN CSCB FOR VARY         Y02669 71852802
         SPACE                                                          71855202
**********************************************************************  71857602
*     FOR DISPLAY AND TRACK PROCESSORS, (IEECB800), THE CHTRKID  Y02669 71860002
*     FIELD IS SET BELOW ON ALL STARTS OR MOUNTS AND LOGONS.     Y02669 71870002
*     TO SUPPORT D JOBS, CHJOBID IS SET HERE FOR ALL STARTS      Y02669 71880002
*     AND MOUNTS. TO SUPPORT D TS, CHTSID IS SET HERE FOR ALL    Y02669 71890002
*     LOGON COMMANDS.                                            Y02669 71892002
**********************************************************************  71900002
         SPACE                                                          71910002
CHKSTART  EQU   *                                                Y02669 71950002
         CLI   CHVCD,START        IS IT START COMMAND?           Y02669 71960002
         BE    SETJOB             YES, SET JOB IDENTIFICATION    Y02669 71970002
         CLI   CHVCD,MOUNT        IS IT MOUNT COMMAND?           Y02669 71980002
         BNE   CHKLOGON           NO, CHECK FOR LOGON            Y02669 71990002
SETJOB   EQU   *                                                 Y02669 71992002
         OI    CHTRKID,CHJOBID    YES, SET JOB IDENTIFICATION    Y02669 71994002
         B     GETASCB            GO TO MEMORY CREATE FOR        Y02669 71996002
*                                 START AND MOUNT                Y02669 71996402
CHKLOGON EQU   *                                                 Y02669 71998002
         CLI   CHVCD,LOGON        IS IT LOGON COMMAND?           Y02669 71998402
         BNE   CHKTRACK           NO, GO TO CHECK TRACK          Y02669 71998802
SETLOGON EQU   *                                                 M00875 71998902
         OI    CHTRKID,CHTSID     YES, SET TIME SHARING ID       Y02669 71999202
         B     GETASCB            GO TO MEMORY CREATE FOR LOGON  Y02669 71999602
         EJECT                                                          72000002
*********************************************************************   72001602
*     THE TRACK COMMAND PROCESSOR NEEDS TO BE POSTED BY          Y02669 72002002
*     DIDOCS CONSOLE CLOSE WHEN A CONSOLE IS VARIED OFFLINE      Y02669 72002402
*     OR SUFFERS ASYNCHRONOUS FAILURE. THE FOLLOWING ROUTINE     Y02669 72002802
*     SETS UP THE COMMUNICATIONS FIELD FOR THE POST: THE         Y02669 72003202
*     CHCECB ADDRESS IS STORED IN THE DCMATRECB FIELD. THE       Y02669 72003302
*     ADDRESS OF THE LATTER IS PICKED UP FROM XAXSACB AS SET UP  Y02669 72003402
*     BY IEE7503D. (OTHERWISE DIDOCS COULD NOT ACCESS THE        Y02669 72003502
*     TRACK CSCB.)                                               Y02669 72006402
*********************************************************************   72009802
CHKTRACK EQU   *                                                        72012702
         CLI   CHVCD,TRACK        IS IT TRACK COMMAND?           Y02669 72015602
         BNE   ENQCSCB            NO, GO TO ENCHAIN CSCB         Y02669 72018502
         LA    R9,CHCECB          ADDRESS OF CANCEL ECB          Y02669 72021402
         L     R10,XAXSACB        ADDRESS OF DCM FIELD IN SACB   Y02669 72024302
         ST    R9,D0(R10)         ECB ADDRESS STORED FOR DIDOCS  Y02669 72027202
         B     ENQCSCB            GO CHAIN CSCB FOR TRACK        Y02669 72029202
         SPACE                                                          72030102
*********************************************************************   72033002
*     FOR STARTS, MOUNTS AND LOGONS A NEW MEMORY MUST BE CREATED.       72049702
*     THE FOLLOWING CODE SETS UP THE PARM LIST TO IEAVEMRQ, THE         72059702
*     MEMORY CREATE MODULE, BALR'S TO THAT MODULE, AND PROCESSES        72069702
*     RETURN CODES. AS INPUT, R1 POINTS TO THE CSCB PTR, AND R13        72079702
*     CONTAINS THE ADDRESS OF A REGISTER SAVE AREA.                     72089702
*********************************************************************   72099702
         SPACE                                                          72101702
GETASCB  EQU   *                                                 Y02669 72109702
         ST    R8,XAP             SET UP PARM CSCB PTR           Y02669 72119702
         LA    R1,XAP             GET PARAMETER ADDRESS          Y02669 72121702
         LA    R13,XASAVSTD       SAVE AREA ADDRESS              Y02669 72129702
         L     R15,VCONMRQ        IEAVEMRQ ADDRESS               Y02669 72139702
         BALR  R14,R15            BRANCH TO IEAVEMRQ             Y02669 72141702
         EJECT                                                          72142102
*********************************************************************   72143702
*     ON RETURN FROM IEAVEMRQ, THE ASCB IS GOTTEN AND            Y02669 72144102
*     CONTAINS THE CSCB POINTER. THE CSCB CONTAINS THE           Y02669 72144502
*     ASID. REG0 CONTAINS THE ASID. R15 CONTAINS THE             Y02669 72144902
*     RETURN CODES.                                              Y02669 72145302
*          R15=0  -  SUCCESSFUL                                  Y02669 72145402
*          R15=4  -  NO GO FROM OPTIMIZER                        Y02669 72145502
*          R15=8  -  SYSTEM OVERLOAD                             Y02669 72145602
*          R15=12 -  UNEXPECTED SYSTEM FAILURE                   Y02669 72159202
*     IN THE CASE OF FAILURE, THE CORE OBTAINED FOR THE          Y02669 72169202
*     CSCB IS FREED.                                             Y02669 72169602
*********************************************************************   72172802
         SPACE                                                          72174802
         LTR   R15,R15            WAS MEMORY CREATE SUCCESSFUL?  Y02669 72182802
         BZ    ENQCSCB            IF YES, GO TO CHAIN NEW CSCB   Y02669 72184802
         ST    R15,XAK            SAVE RET CODE FOR SUBSYSTEM  @Z30BPSV 72184903
         BAL   R11,FREECSCB       NO, FREE GOTTEN CORE           A00042 72185103
         B     EXIT3A             NO, ERROR EXIT FOR IEE328I     A00042 72187102
FREECSCB EQU   *                                                 A00042 72189902
         LA    R0,CSCBSZE         NO, GET SIZE CSCB FOR FREEMAIN Y02669 72190002
         O     R0,SP245MSK        INSERT SUPBOOL               @Z30BPSV 72192003
         LR    R1,R8              GET PTR TO CSCB FOR FREEMAIN   Y02669 72194002
         FREEMAIN R,LV=(0),A=(1)                                 Y02669 72196002
         BR    R11                RETURN TO INTERNAL CALLER      A00042 72197002
         EJECT                                                          72206002
*********************************************************************   72208002
*     AN EXCLUSIVE ENQ ON Q10 IS DONE ON THE CSCB CHAIN          Y02651 72210002
*     RESOURCE TO ADD THE NEWLY CREATED CSCB TO THE              Y02651 72220002
*     CHAIN.  THEN THE RESOURCE IS DEQ'D.                        Y02651 72230002
*     THE SYSEVENT MACRO IS ISSUED PRIOR TO THE ENQ TO           Y02651 72240002
*     MAKE THE MEMORY NON-SWAPPABLE, AND AFTER THE DEQ           Y02651 72242002
*     TO MAKE THE MEMORY SWAPPABLE AGAIN.                        Y02651 72244002
*********************************************************************   72246502
         SPACE                                                          72248502
ENQCSCB  EQU   *                                                 Y02651 72256502
         ST   R0,XAP              SAVE ASID FROM MEMORY CREATE   M00881 72256902
*                                 FOR TIOC ON LOGON COMMAND      M00881 72257302
         SYSEVENT DONTSWAP        MAKE MEMORY NON=SWAPPABLE      Y02651 72258502
         MVC   XASAVSTD(ENQLNG),ENQLIST                          Y02651 72266502
         LA    R1,XASAVSTD        SET UP ADDRESS FOR ENQ         Y02651 72276502
         ENQ   ,MF=(E,(1))                                       Y02651 72286502
         LA    R6,BACHN           ADDR OF CHAIN PTR TO R6.              72346502
         DROP  R8                                                       72400002
         USING CHAIN,R5                                                 72600002
CSCBSRCH EQU   *                                                        72800002
         LR    R5,R6              UPDATE BASE REGISTER                  73000002
         L     R6,CHPTR           UPDATE SEARCH REG WITH CHAIN PTR      73200002
         LTR   R6,R6              THIS LAST CSCB                 Y01012 73400002
         BNE   CSCBSRCH           NO KEEP SEARCHING FOR LAST ONE Y01012 73600002
         ST    R8,CHPTR           CHAIN ELEMENT BY PUTTING CORE  Y02669 73800002
*                                 ADDR IN LAST CHAIN PTR AREA.          74000002
         DROP R5                                                        74200002
         USING CHAIN,R8           REESTAB BASE FOR CSCB            I283 74400002
         MVC   XASAVSTD(DEQLNG),DEQLIST                          Y02651 74450002
         LA    R1,XASAVSTD        SETUP DEQ LIST FORM FOR DEQ    Y02651 74500002
         DEQ   ,MF=(E,(1))        RELEASE CSCB RECOURSE          Y02651 74550002
         SYSEVENT OKSWAP          MAKE MEMORY SWAPPABLE          Y02651 74560002
         EJECT                                                          74560402
*********************************************************************   74562002
*     POST THE MASTER SCHEDULER WAIT ROUTINE, IEEVWAIT,          Y02669 74562402
*     VIA CROSS MEMORY POST FUNCTION.                            Y02657 74562802
*********************************************************************   74564002
         MVC   XASAVSTD(POSTLNG),POSTLIST                        Y02657 74566002
         LA    R1,XASAVSTD        ADDRESS LIST FORM MACRO        Y02657 74568002
         L     R6,BAASCB          GET ASCB ADDRESS FOR POST      Y02657 74568402
         POST BALAD,ASCB=(R6),MF=(E,(1)),ERRET=CVTBRET           Y02657 74570002
         L     R14,XASAVLOC       RESTORE RETURN ADDRESS         Y02669 74572002
         L     R0,XAP             RESTORE ASID FOR TIOC          M00881 74574002
         SR    R15,R15            SUCCESSFUL RETURN CODE         M00879 74576002
         BR    R14                RETURN TO CALLER               Y02669 74580002
         EJECT                                                          74610002
*********************************************************************** 75200002
*                                                                Y02669 75400002
*     VALID EXIT FOR HOLD OR RELEASE TP COMMAND TO IED1303D.     Y02669 75600002
*                                                                Y02669 75800002
*********************************************************************** 76000002
EXIT13   EQU   *                                                 Y02669 76200002
         L     R15,VCON13         ADDRESS OF IED1303D            Y01029 76400002
         BR    R15                GO TO IED1303D                 Y01029 76600002
         SPACE                                                          77100003
*********************************************************************** 77600003
*                                                                Y02669 79000002
*     GENERAL ERROR EXITS FOR COMMANDS TO IEE0503D.              Y02669 79200002
*                                                                Y02669 79400002
*********************************************************************** 79600002
EXIT0B   EQU   *                                                 Y02669 79800002
         MVI   XAE,PARMCDE        (VERB) PARAMETER MISSING       Y01012 80000002
         B     EXIT               BRANCH TO IEE0503D             Y01012 80200002
EXIT05   EQU   *                                                 Y02669 80400002
         MVI   XAE,INVCODE        COMMAND INVALID ERROR CODE     Y02669 80600002
         B     EXIT               BRANCH TO IEE0503D             Y02669 80800002
EXIT3E   EQU   *                                                 Y02669 81250002
         MVI   XAE,DUMPCDE        PARAMETER INVALID ERROR CODE   Y02669 81300002
EXIT     EQU   *                                                 Y01029 81400002
         L     R14,XASAVLOC       RESTORE RETURN ADDRESS         A00042 81450002
         L     R15,VCON05         GET ADDRESS OF IEE0503D        Y01029 81600002
         BR    R15                BRANCH TO IEE0503D             Y01029 81800002
         EJECT                                                          81802003
*********************************************************************** 81804003
*                                                                       81806003
*      ERROR EXIT FOR START, MOUNT AND LOGON.                  @Z30BPSV 81810003
*                                                              @Z30BPSV 81819003
*     IF A START CMD WAS NOT ISSUED UNDER THE COMMUNICATIONS   @Z30BPSV 81828003
*     TASK (I.E., POTENTIALLY ISSUED BY A SUBSYSTEM),          @Z30BPSV 81837003
*     NOTIFICATION THAT THE COMMAND IS FAILING IS SENT TO ALL  @Z30BPSV 81846003
*     ACTIVE SUBSYSTEMS.  UNLESS AT LEAST ONE SUBSYSTEM        @Z30BPSV 81855003
*     INDICATES THAT IEE328I IS TO BE SUPPRESSED, CONTROL      @Z30BPSV 81864003
*     PASSES TO IEE0503D.  OTHERWISE, CONTROL RETURNS TO       @Z30BPSV 81873003
*     THE CALLER.                                              @Z30BPSV 81882003
*                                                              @Z30BPSV 81891003
*     IN ANY EVENT, A RETURN CODE OF EIGHT IS SET IN           @Z30BPSV 81900003
*     REGISTER FIFTEEN.  THE MESSAGE IS ALWAYS ISSUED FOR      @Z30BPSV 81909003
*     LOGON AND MOUNT.                                         @Z30BPSV 81918003
*                                                                       81933003
*********************************************************************** 81936003
          SPACE                                                         81940003
EXIT3A   EQU   *                                               @Z30BPSV 81950003
         L     R14,XASAVLOC      RESTORE RETURN ADDRESS        @Z30BPSV 81955003
         CLI   XAN,START         IF NOT A START COMMAND,       @Z30BPSV 81960003
         BNE   SETRC             SET RC AND GO TO MSG MOD      @Z30BPSV 81965003
         L     R9,CVTTCBP        GET ADDR NEW/OLD PTRS         @Z30BPSV 81970003
         USING TCBASCB,R9        ADD RESSABILITY TO NEW/OLD    @Z30BPSV 81975003
         L     R9,TCBPTR         GET ADDR OF CALLER'S TCB      @Z30BPSV 81980003
         DROP  R9                RELEASE NEW/OLD ADDR'LITY     @Z30BPSV 81985003
         L     R10,CVTCUCB       GET ADDR OF UCM               @Z30BPSV 81990003
         USING UCM,R10           ADDRESSABILITY TO UCM         @Z30BPSV 81995003
         C     R9,UCMPXA         IS CALLER COMMTASK            @Z30BPSV 82000003
         BE    SETRC             YES, SET RC AND GO TO MSG MOD @Z30BPSV 82005003
         DROP  R10               RELEASE UCM ADDRESSABILITY    @Z30BPSV 82010003
         LA    R1,XASAVSTD       GET ADDR FOR GETMAIN LIST     @Z30BPSV 82015003
         MVC   XASAVSTD(SSLNG),SSLIST MOVE IN LIST             @Z30BPSV 82020003
         LA    R9,XASAVSTD+D4    SET ADDRESS FOR               @Z30BPSV 82025003
         ST    R9,XASAVSTD+D4    GOTTEN STORAGE IN LIST        @Z30BPSV 82030003
         GETMAIN MF=(E,(1))      GET STORAGE FROM SP255        @Z30BPSV 82035003
         LTR   R15,R15           SUCCESS?                      @Z30BPSV 82040003
         MVC   XAS(D4),SP255     SAVE SUBPOOL/LENGTH           @Z30BPSV 82045003
         L     R1,XASAVSTD+D4    GET ADDRESS OF STORAGE        @Z30BPSV 82050003
         ST    R1,XAS+D4         SAVE IT                       @Z30BPSV 82055003
         BZ    GOTSSBLX          YES,SET UP FOR SUBSYSTEMS     @Z30BPSV 82060003
*                                AND BRANCH AROUND SP245       @Z30BPSV 82065003
*                                GETMAIN                       @Z30BPSV 82070003
         GETMAIN R,LV=SSSTORE,SP=245 TRY AGAIN                 @Z30BPSV 82075003
         MVC   XAS(D4),SP245     SAVE SUBPOOL/LENGTH           @Z30BPSV 82080003
         ST    R1,XAS+D4         SAVE STORAGE ADDRESS          @Z30BPSV 82085003
GOTSSBLX EQU   *                                               @Z30BPSV 82090003
         XC    D0(SSSTORE,R1),D0(R1) ZERO GOTTEN STORAGE       @Z30BPSV 82095003
         EJECT                                                          82116003
*********************************************************************** 82117003
*                                                                       82118003
*                                                                       82120003
*        INITIALIZE THE SSIB AND SSOB                          @Z30BPSV 82125003
*                                                                       82130003
*                                                                       82131003
*********************************************************************** 82132003
         SPACE                                                          82133003
         LA    R9,D4(R1)         BUILD INTERFACE TO IEFSSREQ:  @Z30BPSV 82135003
         ST    R9,D0(R1)         SET SSOB ADDR IN PARM LIST    @Z30BPSV 82140003
         OI    D0(R1),HYBITON    WITH END-OF-LIST ON           @Z30BPSV 82145003
         USING SSOB,R9           R9 ADDRESSES SSOB             @Z30BPSV 82150003
         LA    R10,SSOBLN16(R9)  GET ADDRESS OF SSIB           @Z30BPSV 82155003
         USING SSIB,R10          R10 ADDRESSES SSIB            @Z30BPSV 82160003
         SPACE                                                          82165003
*        INITIALIZE THE SSOB                                   @Z30BPSV 82170003
         SPACE                                                          82175003
         ST    R10,SSOBSSIB      SET SSIB PTR IN SSOB          @Z30BPSV 82180003
         MVC   SSOBID,SSOBNAME   MOVE'SSOB' TO SSOB            @Z30BPSV 82184003
         MVI   SSOBLEN+1,SSOBHSIZ MOVE IN LENGTH               @Z30BPSV 82188003
         MVI   SSOBFUNC+1,SSOBCFCD MOVE IN FUNCTION CODE       @Z30BPSV 82192003
         LA    R6,SSCFBGN        ADDR FUNCTION DEPENDENT       @Z30BPSV 82196003
*                                EXTENSION                     @Z30BPSV 82200003
         ST    R6,SSOBINDV       STORE IN SSOB BASE            @Z30BPSV 82204003
         MVI   SSCFLEN+1,SSCFSIZE STORE SIZE IN EXTENSION      @Z30BPSV 82208003
         MVC   SSCFBFAD+1(D3),XAR+1 PROVIDE ADDRESS OF COMMAND @Z30BPSV 82212003
*                                BUFFER TO SUBSYSTEM, AND      @Z30BPSV 82216003
         MVC   SSCFMRRC(D4),XAK  THE RETURN CODE FROM MEMORY   @Z30BPSV 82220003
*                                REQUEST OR CSCB FAILURE       @Z30BPSV 82224003
         SPACE                                                          82233003
*        INITIALIZE THE SSIB                                   @Z30BPSV 82236003
         SPACE                                                          82239003
         MVI   SSIBLEN+1,SSIBSIZE MOVE IN LENGTH OF SSIB       @Z30BPSV 82242003
         MVC   SSIBSSNM,SUBNAME  MOVE IN SUBSYSTEM NAME        @Z30BPSV 82244003
         MVC   SSIBID,SSIBNAME   MOVE'SSIB' TO SSIB            @Z30BPSV 82246003
         LA    R13,XASAVSTD      GET SAVE AREA POINTER         @Z30BPSV 82248003
         LR    R6,R14            SAVE RETURN ADDRESS           @Z30BPSV 82250003
         IEFSSREQ                ISSUE SUBSYSTEM INTERFACE     @Z30BPSV 82252003
         EJECT                                                          82257703
*********************************************************************** 82258403
*                                                                       82259103
*        FREE THE SSIB AND SSOB STORAGE                        @Z30BPSV 82263003
*                                                                       82264003
*********************************************************************** 82265003
         SPACE                                                          82266003
         LR    R14,R6            RESTORE RETURN ADDRESS        @Z30BPSV 82269003
         L     R10,SSOBRETN      SAVE SUBSYSTEM RETURN CODE    @Z30BPSV 82272003
         LR    R9,R15            SAVE INTERFACE RETURN CODE    @Z30BPSV 82275003
         DROP  R9                RELEASE SSOB AND              @Z30BPSV 82278003
         DROP  R10               SSIB ADDRESSABILITY           @Z30BPSV 82281003
         LM    R0,R1,XAS         LOAD STORAGE ADDRESS,         @Z30BPSV 82284003
*                                SUBPOOL AND LENGTH FOR        @Z30BPSV 82287003
         FREEMAIN R,LV=(0),A=(1) FREEMAIN                      @Z30BPSV 82290003
         LTR   R9,R9             SUBSYS INTERFACE SUCCESSFUL   @Z30BPSV 82293003
         BNZ   SETRC             NO, SET RC AND GOTO MSG MOD   @Z30BPSV 82296003
         LTR   R10,R10           IEE328I TO BE ISSUED          @Z30BPSV 82299003
         BNZ   NOMSG             NO, SET RC AND RETURN         @Z30BPSV 82302003
         SPACE                                                          82305003
*        SET RETURN CODE, SET MESSAGE CODE, AND BRANCH         @Z30BPSV 82308003
         SPACE                                                          82311003
SETRC    EQU   *                                                        82314003
         LA    R15,D8            SET FAILING RETURN CODE       @Z30BPSV 82317003
         MVI   XAE,NOCORECD      IEE328I MESSAGE CODE          @Z30BPSV 82320003
         L     R8,VCON05         GET ADDRESS OF IEE0503D       @Z30BPSV 82323003
         BR    R8                BRANCH TO IT                  @Z30BPSV 82326003
         SPACE                                                          82329003
*        SET RETURN CODE AND RETURN                            @Z30BPSV 82332003
         SPACE                                                          82335003
NOMSG    EQU   *                                               @Z30BPSV 82338003
         LA    R15,D8            SET FAILING RETURN CODE       @Z30BPSV 82341003
         BR    R14               RETURN                        @Z30BPSV 82344003
         EJECT                                                          82347003
*********************************************************************** 82347503
*                                                                       82348003
*        CONSTANTS AND MACRO LISTS                             @Z30BPSV 82348503
*                                                                       82349003
*********************************************************************** 82349503
         DS    0F                                                       82350003
VCON05   DC    V(IEE0503D)       MESSAGE MODULE CSECT.           Y01029 82400003
VCON13   DC    V(IED1303D)       TCAM                            Y01029 82500003
VCONMRQ  DC    V(IEAVEMRQ)       MEMORY REQUEST MODULE           Y02669 82600003
SP245MSK DC    X'F5000000'       SUBPOOL 245 FOR FREEMAIN MAC  @Z30BPSV 82700003
COMM     DC    C'COMM=('         FORMAT OF COMM PARAMETER        Y02669 82800003
TPEQLS   DC    C'TP='            FORMAT OF TP PARAMETERS         Y02669 82900003
SSOBNAME DC    C'SSOB'           SSOB NAME                     @Z30BPSV 83401003
SSIBNAME DC    C'SSIB'           SSIB NAME                     @Z30BPSV 83402003
SUBNAME  DC    C'MSTR'           MASTER SUBSYSTEM NAME         @Z30BPSV 83403003
SP245    DC    AL1(245)          SUBPOOL 245 AND               @Z30BPSV 83404003
         DC    AL3(SSSTORE)      LENGTH FOR FREEMAIN           @Z30BPSV 83405003
SP255    DC    AL1(255)          SUBPOOL 255 AND               @Z30BPSV 83406003
         DC    AL3(SSSTORE)      LENGTH FOR FREEMAIN           @Z30BPSV 83407003
         DS    0F                                                       83410002
MVECHBUF MVC   CHBUF(D0),D0(R5)  MOVE OPERANDS TO CSCB BUFFER    A00042 83420003
CHBUFLNG DC    AL2(L'CHBUF)      LENGTH OF CSCB BUFFER           A00042 83430003
HALFONE  DC    X'0001'           CHECK FOR MINIMUM TO MOVE       A00042 83440003
         DS    0D                                                       83450002
ENQLIST  ENQ   (SYSNAME,RNAME,E,3,SYSTEM),RET=HAVE,MF=L          Y02651 83500002
ENQEND   EQU   *                  LABLE USED TO CALCULATE LENGTH Y02651 83550002
         DS    0D                                                       83552002
DEQLIST  DEQ   (SYSNAME,RNAME,3,SYSTEM),RET=HAVE,MF=L            Y02651 83560002
DEQEND   EQU   *                  LABLE USED TO CALCULATE LENGTH Y02651 83570002
CANUSE   DS    0F                 FOR BOUNDARY ALIGNMENT         A34263 83572002
GETLIST  GETMAIN EC,LV=CSCBSZE,A=0,SP=245,MF=L                   Y02669 83574003
GETEND   EQU   *                  LABLE USED TO CALCULATE LENGTH Y02669 83578003
SSLIST   GETMAIN EC,LV=SSSTORE,A=0,SP=255,MF=L SSOB/SSIB LIST  @Z30BPSV 83583003
SSEND    EQU   *                  LABEL USED TO CALCULATE LEN  @Z30BPSV 83593003
POSTLIST POST  MF=L                                              Y02657 83607003
POSTEND  EQU   *                  LABLE USED TO CALCULATE LENGTH Y02657 83615003
ENQLNG   EQU   ENQEND-ENQLIST     LENGTH TO MOVE TO GOTTEN CORE  Y02651 83623003
DEQLNG   EQU   DEQEND-DEQLIST     LENGTH TO MOVE TO GOTTEN CORE  Y02651 83631003
GETLNG   EQU   GETEND-GETLIST     LENGTH TO MOVE TO GOTTEN CORE  Y02669 83640002
SSLNG    EQU   SSEND-SSLIST       LENGTH TO MOVE TO GOTEN CORE @Z30BPSV 83660003
POSTLNG  EQU   POSTEND-POSTLIST   LENGTH TO MOVE TO GOTTEN CORE  Y02657 83690002
SYSNAME  DC    C'SYSIEFSD'        MAJOR NAME IS SYSIEFSD         Y02651 83810002
RNAME    DC    C'Q10'             MINOR NAME IS Q10              Y02651 83820002
PATCH    DC    CL50'* * * * IEE0803D * * * *'                           83850003
         EJECT                                                          84000002
         END                                                            84200002
