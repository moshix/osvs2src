 TITLE 'IEE3303D - VARY COMMAND SYNTAX SCANNER'                         00883103
IEE3303D CSECT                                                          00883202
**********************************************************************  00883402
* MODULE NAME      = IEE3303D                                           00883802
*   CSECT NAME     = IEE3303D                                           00883902
*                                                                       00888502
* LOAD MODULE NAME = IEE3603D                                           00890502
*                                                                       00892502
* DESCRIPTIVE NAME = VARY COMMAND SYNTAX SCANNER FOR KEYWORDS:          00892902
*                            ONLINE                                     00893302
*                            OFFLINE                                    00893702
*                            CONSOLE                                    00894102
*                                                                       00894702
* COPYRIGHT        = MISSING                                            00895102
*                                                                       00895502
* STATUS           = OS/VS/2 RELEASE 3                         @Z30LPTJ 00895903
*                                                                       00896602
* FUNCTION         = THIS ROUTINE SYNTAX SCANS THE UNIT FIELDS IN THE   00897002
*                    COMMAND FOR:                                       00897402
*                    . VALID UNIT SPECIFICATION                         00897802
*                    . CORRECT NUMBER AND LOCATION OF COMMAS, PARENS    00898202
*                      BLANKS, END OF BUFFER DELIMITING END OF          00898402
*                      COMMAND                                          00898502
*                    . CHECKS COMMAND AUTHORITY,MUST BE EITHER 2 OR 3   00898602
*                    . IF SMF IS IN THE SYSTEM, CONTROL IS GIVEN TO     00899202
*                      MODULE IEE2303D WITH CODES SPECIFYING WHICH      00899602
*                      MODULE SHOULD IT RETURN TO.                      00900002
*                    . CHECKS FOR COMMA FOLLOWING 'CONSOLE'             00900402
*                      KEYWORD. IN THIS CASE CONTROL IS PASSED          00900502
*                      TO 4403D FIRST FROM HERE (IF SMF IS NOT          00900602
*                      ACTIVE, IF IT IS ACTIVE THEN A FLAG IS SET       00900702
*                      FOR 2303D TO GO TO 4403D FIRST WHEN IT IS        00901402
*                      READY TO RELINQUISH CONTROL)                     00901802
*                                                                       00902202
* OPERATION        = THIS ROUTINE VALIDATES THE SYNTAX OF UNITS:        00903202
*                       XXX            (SINGLE UNIT)                    00903302
*                       O-XXX          (OUTPUT ONLY UNIT)               00904402
*                       (I-XXX,O-XXX)  (COMPOSITE SPECIFICATION)        00906402
*                    IT VALIDATES THAT PARENS ENCLOSE MULTIPLE UNITS    00906502
*                    AND THAT EACH UNIT IS SEPARATED BY COMMAS          00906802
*                    IF THE KEYWORD IS 'CONSOLE', IT VALIDATES THAT     00907202
*                    THE ISSUER HAS COMMAND AUTHORITY OF 3              00907602
*                    IF THE KEYWORD IS 'ONLINE/OFFLINE' THAN IT         00908402
*                    VALIDATES THAT THE ISSUER HAS COMMAND              00908802
*                    AUTHORITY OF 2 OR 3                                00909202
*                    IT CHECKS WHETHER ADDITIONAL PARAMETERS ARE        00909602
*                    PRESENT ON THE 'CONSOLE' KEYWORD. IF SO, IT SETS   00909702
*                    A BIT INFORMING THAT 4403D MUST RECEIVE CONTROL    00910102
*                    FIRST, AND IT STORES THE POINTER TO THESE          00910502
*                    ADDITIONAL KEYWORDS IN XAS+4 FOR 4403D             00910602
*                    IF SMF IS ACTIVE, IT GIVES CONTROL TO              00910702
*                    2303D FIRST, FOR THE CONSOLE AND ONLINE            00911002
*                    KEYWORDS.                                          00911402
*                    TO FIND WHETHER SMF IS ACTIVE, THIS MODULE         00911502
*                    CHECKS THE CVTSMCA BYTE IN THE CVT TO SEE IF       00911602
*                    IT HAS BEEN INITIALIZED WITH THE ADDRESS OF THE    00911702
*                    SMCA.  IF NOT, THEN WE KNOW THAT SMF HAS NOT       00912102
*                    BEEN INITIALIZED AS YET AND NO RECORD CAN BE       00912702
*                    WRITTEN.  THEREFORE, IEE2303D'S FUNCTION IS        00913102
*                    BYPASSED.  IF CVTSMCA CONTAINS AN ADDRESS          00913502
*                    (WHICH IS THE PTR TO THE SMCA) WE TEST THE         00913902
*                    SMCAUSER AND THE SMCAMAN BITS IN THE SMCA          00914502
*                    (BYTE = SMCAMISC) TO SEE IF SMF IS OPERATING.      00914902
*                    IF NONE OR ONLY ONE IS ON, WE CANNOT WRITE         00915302
*                    A RECORD AND, THEREFORE, IEE2303D'S FUNCTION       00915702
*                    IS AGAIN BYPASSED.  IF BOTH BITS ARE ON, THEN      00916102
*                    WE DETERMINE IF JOB ACCOUNTING WAS REQUESTED       00916202
*                    BY THE USER BY TESTING THE SMCAOPT BYTE OF THE     00916302
*                    SMCA, BIT = SMCAOPT1.  IF IT IS OFF, THEN JOB      00916502
*                    ACCOUNTING WAS NOT REQUESTED AND IEE2303D'S        00916902
*                    FUNCTION IS BYPASSED.                              00917502
*                    IF THIS BIT IS ON, THEN WE KNOW THAT SMF IS UP     00917902
*                    AND RUNNING AND THAT JOB ACCOUNTING WAS            00918302
*                    REQUESTED AND THEREFORE, WE GIVE CONTROL TO        00918702
*                    IEE2303D TO WRITE THE SMF RECORD FOR ALL VALID     00919402
*                    DEVICES CHANGING TO THE 'ONLINE' AND               00919802
*                    'CONSOLE' STATES.                                  00920202
*                    IT ALSO SETS BITS IN THE XOPCODE BYTE OF THE       00921102
*                    DUMMY XSA TO SHOW WHICH KEYWORD WAS SPECIFIED:     00921402
*                    X'80' = CONSOLE                                    00921802
*                    X'20' = ONLINE                                     00921902
*                    X'10' = OFFLINE                                    00922002
*                                                                       00922202
* NOTES                                                                 00922302
*   DEPENDENCIES   = NONE                                               00922402
*   CHARACTER/CODE DEPENDENCIES                                         00922502
*                  = THIS MODULE CAN BE ASSEMBLED WITH ANY NEW          00923002
*                    CHARACTER/CODE SET.                                00923402
*                                                                       00923502
* RESTRICTIONS     = R1 OUTPUT = XAD SWITCHES FOR 4203D                 00923802
*                       INCLUDING CCAHOLD                               00924202
*                    R2 ADDRESSABILITY FOR DUMMY XSA                    00924602
*   REGISTER CONVENTIONS                                                00924702
*                  = REGISTERS ARE DEFINED AT LABEL: DEFREG             00924802
*   PATCH LABEL    = PATCH                                              00924902
*                                                                       00925002
* MODULE TYPE      = CSECT                                              00925102
*   PROCESSOR      = ASSEMBLER                                          00925202
*   MODULE SIZE    = VS/2 = '354'                              @Z30LPTJ 00925403
*   ATTRIBUTES     = REENTRANT, REUSABLE, REFRESHABLE,                  00925802
*                    ZERO PSW PROTECT KEY, PAGED LPA                    00925902
*                                                                       00926402
* ENTRY POINTS     = IEE3303D FROM IEE3603D                             00926802
*   PURPOSE        = VARY ONLINE/OFFLINE/CONSOLE COMMANDS TO BE         00927202
*                    PROCESSED                                          00927302
*   LINKAGE        = BRANCH                                             00927402
*   INPUT          = DUMMY XSA POINTED BY REG 2                         00928002
*                    IN THE DUMMY XSA THE FOLLOWING FIELDS:             00928402
*                       XAS AND XAS+1 CONTAIN READER/INTERPRETER        00928802
*                       COMMAND AUTHORITY                               00929202
*                       XAR CONTAINS THE SIZE OF THE COMMAND BUFFER     00929302
*                       XAL CONTAINS THE PTR TO THE LIST POSITION       00929402
*                       XAV CONTAINS THE VERB OF THE COMMAND 'VARY'     00929502
*                       XAU CONTAINS THE CONSOLE ID OF THE ISSUER       00929602
*                       OF THE COMMAND                                  00929702
*                    R13 POINTS TO THE SAVE AREA, WORD17 = CSCB PTR     00929802
*   REGISTERS SAVED  = ALL                                              00929902
*   REGISTER USAGE = R1 R/I COMMAND AUTHORITY                           00930002
*                    R2 PTR TO THE DUMMY XSA                            00930102
*                    R3 ADDRESSABILITY                                  00930202
*                    R4 UCME PTR                                        00930302
*                    R6 CVT PTR                                         00930402
*                    R7 EOB REG                                         00930502
*                    R9 PARAM LIST REG                                  00930602
*                    R10 UCM REG                                        00930702
*                    R11 UCMPRFX REG                                    00930802
*                    R12 UCME REG                                       00930902
*                    R13 SAVE AREA REG                                  00931002
*   REGISTERS RESTORED                                                  00931102
*                  = ALL                                                00931602
*                                                                       00932002
* EXITS - NORMAL   = IF SMF IS IN THE SYSTEM = IEE2303D VIA BRANCH      00932402
*   CONDITIONS     = WITH INDICATOR WHETHER IT SHOULD GO TO             00932802
*                    4203D OR 4403D WHEN RETURNING                      00932902
* EXITS - NORMAL-2-  = IF SMF IS NOT ACTIVE = TO:                       00933002
*   CONDITIONS     = IEE4203D FOR ONLINE/OFFLINE                        00933102
*                    IEE4403D OR IEE4203D FOR CONSOLE                   00933202
*                    FOR VARY OFFLINE, AN EXIT IS TAKEN ALWAYS          00933602
*                    DIRECTLY TO 4203D SINCE NO RECORD HAS TO BE        00933702
*                    WRITTEN FOR AN OFFLINE COMMAND.                    00934102
*   OUTPUT         = DUMMY XSA POINTED BY REG2                          00934202
*                    REG1 HAS THE XAD SWITCHES FOR 4203D                00934602
*                            BYTE 1 = USWITCH SWITCHES                  00935002
*                            BYTE 2 = USWTWO - UNUSED SWITCHES          00935402
*                            BYTE 3 AND 4 = CCAHOLD - HAS COMMAND       00935802
*                                           AUTHORITY OF ISSUER         00936202
*                    XAS                                                00936302
*                            BYTE 1 = XOPCODE - HAS INDICATION OF       00936402
*                                      KEYWORD                          00936502
*                            BYTE 2 = XSWITCH - UNUSED IN THIS MODULE   00936702
*                            BYTE3&4= UNUSED IN THIS MODULE             00936802
*                            BYTE5-8= TEMPORARITY HAS PTR TO END OF     00936902
*                                      KEYWORD FOR 4403D                00937002
*                    SAVE AREA PTR IN REG 13                            00937102
*   RETURN CODES   = NONE                                               00937202
*                                                                       00937302
* EXITS - ERROR-1- = TO IEE0503D AND IEE2103D VIA BALR                  00937403
*                    ON RETURN, THE CSCB IS FREED VIA AN MGCR MACRO     00937502
*                    THE SAVE AREA AND THE DUMMY XSA                    00937602
*                    GOTTEN IN 3603D IS ALSO FREED VIA FREEMAIN         00938002
*                    AND A RETURN IS TAKEN TO THE CALLER OF THE SVC     00938402
*   CONDITIONS     = AN ERROR SITUATION WAS DETECTED                    00938802
*   OUTPUT         = DUMMY XSA PTR IN REG 2 AND THE FOLLOWING:          00939202
*                       XAE = ERROR MESSAGE CODE                        00939302
*                       XAV = VERB 'VARY'                               00939402
*                       XAU = UCM ID                                    00939502
*   RETURN CODES = NONE                                                 00939602
*                                                                       00939702
* EXITS - ERROR-2- = TO IEE0503D AND IEE2103D VIA BALR.        @Z30LPTJ 00940103
*                    ON RETURN, AN EXIT IS MADE TO IEECB904    @Z30LPTJ 00940503
*                    FOR FURTHER VARY RANGE PROCESSING.        @Z30LPTJ 00940603
*   CONDITIONS     = AN ERROR SITUATION WAS DETECTED AND VARY  @Z30LPTJ 00942603
*                    RANGE IS BEING PROCESSED.                 @Z30LPTJ 00944603
*   OUTPUT         = DUMMY XSA PTR IN REG 2 AND THE FOLLOWING: @Z30LPTJ 00946603
*                        XAE = ERROR MESSAGE CODE              @Z30LPTJ 00948603
*                        XAV = VERB 'VARY'                     @Z30LPTJ 00950603
*                        XAU = UCM ID                          @Z30LPTJ 00952603
*   RETURN CODES   = NONE                                      @Z30LPTJ 00954603
* EXTERNAL REFERENCES                                                   00956603
*   ROUTINES       = IEE2303D     SMF ROUTINE                           00960803
*                    IEE4203D     ONLINE/OFFLINE/CONSOLE PROCESSOR      00962903
*                    IEE4403D     CONSOLE SUBKEYWORD PROCESSOR          00963603
*                    IEECB904     VARY RANGE PROCESSOR         @Z30LPTJ 00964303
*                    IEE0503D     MESSAGE MODULE                        00965003
*                    IEE2103D     MESSAGE MODULE                        00965703
*   DATA AREAS     = SEE EXITS - OUTPUT DATA                            00967103
*                                                                       00968503
* CONTROL BLOCKS   = . DUMMY EXTENDED SAVE AREA (XSA)                   00969603
*                    . CVT                                              00972003
*                       FIELDS TESTED  - CVTCUCB                        00972703
*                                        CVTSMCA                        00973403
*                       FIELDS UPDATED - NONE                           00974803
*                    . UNIT CONTROL MODULE (UCM)                        00976203
*                       FIELDS TESTED  - UCMVEZ                         00977603
*                                        UCMVEA                         00979003
*                                        UCMAUTH                        00981103
*                       FIELDS UPDATED - NONE                           00981803
*                    . SYSTEM MANAGMENT FACILITIES CONTROL TAB (SMCA)   00982503
*                       FIELDS TESTED  - SMCAMISC - BIT=SMCAUSER        00983903
*                                                       SMCAMAN         00985303
*                                        SMCAOPT  - BIT=SMCAOPT1        00986703
*                       FIELDS UPDATED - NONE                           00988103
*                    . COMMAND SCHEDULING CONTROL BLOCK (CSCB)          00990203
*                       FIELDS TESTED  - NONE                           00990903
*                       FIELDS UPDATED - CHSTS - BIT= CHFC              00991603
*                                                                       00993003
* TABLES           = SAVEAREA AND SAVE WORK AREA =                      00994403
*                    84 BYTES                                           00995803
*                                                                       00997203
* MACROS           = MGCR, FREEMAIN, LOAD, DELETE ,DEQ                  00999303
*                                                                       01000003
* MAPPING MACROS   = IEEXSA                                             01001003
*                    IEECUCM                                            01002403
*                    CVT                                                01004303
*                    IEESMCA                                            01005203
*                    IEECHAIN                                           01006203
*   SERIALIZATION  = PROTECTION AGAINST ALLOC, OLTEP AND ANOTHER VARY   01008103
*                    IS DONE VIA AN ENQ ISSUE EARLIER IN MODULE         01009003
*                    IEE3603D. A DEQ WILL BE ISSUED HERE IF A TERMINAL  01010003
*                    ERROR CONDITION IS FOUND. THIS IS DONE AT:  SDEQUE 01012303
*                    PROTECTION AGAINST COMM TASK IS STILL NOT REQUIRED 01013103
*                    AND THEREFORE THIS MODULE WILL NOT ISSUE ANY       01013803
*                    SETLOCKS                                           01015703
*                                                                       01016603
* CHANGE LEVEL     = Y02669, Y02651, Z30LPTJ                   @Z30LPTJ 01017603
*                                                                       01019503
* CHANGE ACTIVITY  = N/A                                                01021403
*                                                                       01022303
* MESSAGES         = IEE345I AUTHORITY INVALID - FROM IEE2103D          01023303
*                    IEE307I DELIMITER ERROR - FROM IEE0503D            01025203
*                    IEE308I TERM LENGTH ERROR - FROM IEE0503D          01026103
*                                                                       01027103
* ABEND CODES      = NONE                                               01029003
*                                                                       01030003
* PACKAGING        = IEE3303D WILL BE PART OF LOAD MODULE               01031003
*                       IEE3603D                                        01032803
*                    THIS LOAD MODULE ALIASES ARE                       01033703
*                       NONE                                            01034703
*                    THIS LOAD MODULE ENTRY POINTS ARE                  01036603
*                       IEE3603D                                        01037503
*                    MODULE WILL RESIDE IN:  LPALIB                     01038503
*                                                                       01040403
* SYSGEN           = SUPPLIED BY THE FOLLOWING SECTIONS:                01041403
*                       LOAD MODULE NAME                                01042403
*                       PACKAGING                                       01044203
*                       THIS CSECT WILL BE INCLUDED AT SYSGEN FROM      01046103
*                       DLIB -AOSB3- BY MACRO -SGIEF441-                01047003
*                                                                       01048003
* SYSTEM LIBRARIES = NONE                                               01049903
*                                                                       01050803
**********************************************************************  01051803
         EJECT                                                          01053703
*                                                                       01054603
*  REGISTER ASSIGNMENTS                                                 01055603
*                                                                       01057503
DEFREG   EQU   *                                                 Y02669 01058503
R0       EQU   0                                                        01059503
R1       EQU   1                  R/I COMMAND AUTHORITY                 01060503
R2       EQU   2                  DUMMY XSA PTR                         01061503
R3       EQU   3                  ADDRESSABILITY                        01062503
R4       EQU   4                  UCME PTR                              01065103
R5       EQU   5                  WORK REG - SAVE FOR UCME SIZE         01066003
R6       EQU   6                  WORK REG - SAVE FOR LAST UCME PTR     01067003
R7       EQU   7                  END OF BUFFER REG                     01068903
R8       EQU   8                                                        01069903
R9       EQU   9                  PARAM LIST REG                        01070903
RA       EQU   10                 UCM ADDR REG                          01072503
RB       EQU   11                 UCMPRFX REG                           01073503
RC       EQU   12                  UCMPFX REG                     19084 01074803
RD       EQU   13                                                 19084 01075803
RE       EQU   14                  RET ADD REG                    19084 01078403
RF       EQU   15                  WORK AND XCTL REG              19084 01079403
*                                                                 19084 01080403
         EJECT                                                    19084 01082203
*                                                                 19084 01083203
*        CONSTANTS AND CODES                                      19084 01084203
*                                                                 19084 01085203
CA3      EQU   X'20'               COMD AUTH OF 3 - CONS          19084 01086203
CA2OR3   EQU   X'60'                                              19084 01087903
URI      EQU   X'80'                                              19084 01089803
USYST    EQU   X'00'                                              19084 01090703
SYSCODE  EQU   X'E0'                                              19084 01091703
XFF      EQU   X'FF'                                           @Z30LPTJ 01092703
*                                                                 19084 01095503
         SPACE 10                                                 19084 01096403
*                                                                 19084 01097403
*        NUMBER ASSIGNMENTS                                       19084 01099303
*                                                                 19084 01100203
ZERO     EQU   0                                                  19084 01101203
ONE      EQU   1                                                  19084 01103103
TWO      EQU   2                                                  19084 01104003
TRE      EQU   3                                                  19084 01105003
FOR      EQU   4                                                  19084 01106903
SIX      EQU   6                                                  19084 01107903
SVN      EQU   7                                                  19084 01108903
EIT      EQU   8                                                  19084 01110103
TEN      EQU   10                                                 19084 01111103
TWLV     EQU   12                                                 19084 01113403
FIFTN    EQU   15                                                 19084 01114403
D14      EQU   14                                                Y02669 01115403
D64      EQU   64                                                Y02669 01116403
D132     EQU   132                                               Y02669 01117403
*                                                                 19084 01118403
         EJECT                                                    19084 01120803
*                                                                 19084 01121803
*        CHARACTER CONSTANTS                                      19084 01123603
*                                                                 19084 01124603
BLANK    EQU   C' '                                               19084 01126403
CONSOLE  EQU   C'C'                                               19084 01127403
RPAREN   EQU   C')'                                               19084 01129203
LPAREN   EQU   C'('                                               19084 01130103
COMMA    EQU   C','                                               19084 01131003
*                                                                 19084 01132003
*        ERROR CONSTANTS                                          19084 01133003
*                                                                 19084 01134803
ERR41    EQU   41                       AUTH INVALID              19084 01135803
ERR7     EQU   7                        DELIMITER ERROR           19084 01137603
ERR8     EQU   8                                                  19084 01138603
         EJECT                                                    19784 01140403
*********************************************************************** 01141403
*                                                                 19084 01143203
*        ADDRESSABILITY AND HOUSE KEEPING                         19084 01144203
*                                                                 19084 01146003
*********************************************************************** 01147003
         BALR  R3,ZERO                                                  01148803
         USING *,R3                                               19084 01149703
         USING XSA,R2                                             19084 01150603
         MODID BR=YES                                            Y01886 01151603
*                                                                       01152603
         LH    R8,XAA              SAVE VARY RANGE BITS        @Z30LPTJ 01154403
         STM   R0,RF,ZERO(RD)                                    Y02669 01155403
         L     R9,XAL              PTR TO LIST POSITION           19084 01157203
         LA    R9,ZERO(R9)         CLEAR HIGH ORDER BYTE          19084 01158203
         L     R7,XAR                                             19084 01160003
         AR    R7,R9               COMPUTE END OF BUFFER INTO R7 Y02669 01161003
         XC    XAD(FOR),XAD        CLEAR SWITCH AREA              19084 01162803
         MVC   XACAHOLD(TWO),XAS  MOVE OVER R/I CMD AUTH TO XAS@Z30LPTJ 01163803
         XC    XAS(EIT),XAS        ZERO INDICATOR AREA            19084 01165603
         L     R6,CVTPTR                                          19084 01166503
         USING CVT,R6                                            Y01012 01167403
*                                                                 19084 01168403
*********************************************************************** 01169403
*        START  OF SCAN                                           19084 01171203
*********************************************************************** 01172203
*                                                                 19084 01174003
         CLI   ZERO(R9),LPAREN    ONE PAREN                             01176003
         BNE   CONTINUE           NOPE, SINGLE UNIT                     01176403
         CLI   ONE(R9),LPAREN     OUTPAREN IS HERE, SECON PAREN?        01177403
         BNE   CONTINUE           NOPE, JUST SINGLE PAREN               01178803
         CLI   TWO(R9),LPAREN     DOUBLE PAREN, IS THERE MORE?          01179803
         BE    SERR4              YES, NO GOOD TO HAVE 3PAREN LEVELS    01180803
CONTINUE EQU   *                                                        01183203
*                                                                       01184203
         CLI   ZERO(R9),LPAREN     PAREN FOR COMP OR MULT UNITS   19084 01185303
         BNE   S1UNIT              NO,SINGLE UNIT                 19084 01187403
         CLC   ONE(TWO,R9),HIUNIT+ONE  IS IT A SINGLE COMPOSITE   19084 01188403
         BE    S1COMP              YES,SINGLE COMP SPECIFIED      19084 01189503
         OI    XADUSWIT,XAXPAREN   NO,MULTIPLE UNITS,SET PAREN @Z30LPTJ 01191603
SINDEX   EQU   *                                                  19084 01192603
         LA    R9,ONE(R9)           INDEX TO UNIT                 19084 01193703
S1UNIT   EQU   *                                                  19084 01194703
         CLC   ZERO(TRE,R9),HIUNIT  DO WE HAVE A COMPOSITE        19084 01195803
         BE    S1COMP                                             19084 01197903
         CLC   ZERO(TWO,R9),HOUNIT+ONE   DO WE HAVE AN O-XXX      19084 01198903
         BNE   SCOMACK             NO, THIS IS A REGULAR XXX            01200003
SOUNIT   EQU   *                   INDEX PLUS 2 INTO UNIT         19084 01202003
         LA    R9,TWO(R9)                                         19084 01203003
SCOMACK  EQU   *                                                  19084 01204003
         LA    R9,TRE(R9)          INDEX TO WHERE COMMA SHOULD BE 19084 01206003
         TM    XADUSWIT,XAXPAREN   IS THE XTR PAREN ON         @Z30LPTJ 01207003
         BO    SPARNCK             YES,CHECK FOR RPAREN           19084 01208003
         CLI   ZERO(R9),COMMA      COMMA ENDS UNIT FIELD          19084 01209003
         BNE   SERR4    ANY OTHER VALID UNIT SHOULD BE 3 CHAR    Y01012 01210003
SKEYCK   EQU   *                                                 Y02669 01212003
         CLI   ZERO(R9),COMMA  DOES A COMMA FOLLOW THE LAST UNT? Y02669 01213003
         BE    KEYTST             YES,OK                         Y02669 01214003
         LA    R9,ONE(R9)         UP BY ONE TO NEXT UNIT         Y02669 01216003
         B     SKEYCK             CHECK IF COMMA EXISTS NOW      Y02669 01217003
KEYTST   EQU   *                                                 Y02669 01218003
         CLI   ONE(R9),CONSOLE     IS THIS A CONSOLE KEYWORD     Y02669 01219003
         BNE   SONOFF              NO,MUST BE ON/OFFLINE          19084 01220003
         OI    XASOPCOD,XACON    TURN ON CONSOLE KEY INDICATOR @Z30LPTJ 01222003
         BAL   R5,SUCMID           GO GET REQUESTORS COMD AUTH    19084 01224003
         TM    XACAHOLD,CA3      CA PLACED IN CCAHOLD OF XAD   @Z30LPTJ 01225003
         BZ    SERR1               AUTHORITY IS INVALID           19084 01226003
         LA    R9,EIT(R9)          INDEX PAST CONSOLE KEYWORD     19084 01228003
SMFRTN   EQU   *                                                  19084 01229003
         ST    R9,XAS+FOR          PTR TO KEYWORD FOR 4403D       19084 01230003
         SR    R5,R5                                              19084 01232003
         TM    XASOPCOD,XAOFF       IS IT OFFLINE              @Z30LPTJ 01233003
         BO    FOR2EXT                                            19084 01234003
*                                                                 19084 01235003
*        PRESET FOR SMF TO RETURN TO 4203D                        19084 01236003
*                                                                 19084 01237003
         TM    XASOPCOD,XACON      IS IT CONSOLE KEY           @Z30LPTJ 01238003
         BZ    SMFEXT              NO, GOTO  SMF                  19084 01240003
         CR    R9,R7               EOB                            19084 01242003
         BE    SMFEXT              YES, COMMAND FINISHED          19084 01243003
         CLI   ZERO(R9),BLANK      BALNK DELIMITS END             19084 01244003
         BE    SMFEXT              YES,GO CHECK FOR SMF           19084 01246003
*                                                                 19084 01247003
*   PRESET FOR SMF TO GO TO 4403D- XAS+4 WILL PT TO,KEYWORDS      19084 01248003
*                                                                 19084 01249003
         OI    XASWITCH,XASMF44   MODULE TO RETURN TO IS 4403D @Z30LPTJ 01250003
         B     SMFEXT2             GO TO SMF ROUTINE                    01252803
SMFEXT   EQU   *                                                  19084 01253203
         OI    XASWITCH,XASMF42    RETURN TO 4203D SWITCH      @Z30LPTJ 01254203
SMFEXT2  EQU   *                                                  19084 01255903
         L     R6,CVTPTR                                         Y02669 01257903
         USING CVT,R6                                            Y02669 01258903
         L     R7,CVTSMCA          ADDRESS IF SNCA               Y02669 01259903
         LTR   R7,R7               ANY THERE                     Y02669 01261903
         BZ    NOSMF               NO, EXIT NOT TAKEN TO 2303D   Y02669 01262703
         USING SMCABASE,R7                                       Y02669 01263603
         TM    SMCAMISC,SMCAUSER+SMCAMAN  TEST TO SEE IF RECD IS Y02669 01264603
*                                  TO BE WRITTEN OUT             Y02669 01265603
         BC    D14,NOSMF           NO, EXIT NOT TAKEN TO 2303D   Y02669 01266603
         TM    SMCAOPT,SMCAOPT1    IS HOB ACCOUNTING REQUESTED   Y02669 01267603
         BO    YESSMF              YES, GO TO 2303D              Y02669 01268603
NOSMF    EQU   *                                                 Y02669 01269603
*                                                                Y02669 01273602
*    NO 2303D, CHECK IF MUST GO TO 4203D OF 4403D                Y02669 01275602
*                                                                Y02669 01277602
         TM    XASWITCH,XASMF42    EXIT TO 4203D?              @Z30LPTJ 01278003
         BO    FOR2EXT             4203D                         Y02669 01278402
         B     FOR4EXT             NO, 4403D                     Y02669 01278502
YESSMF   EQU   *                                                 Y02669 01278602
         MVC   XAX+TRE(TWO),MOD23                                Y02669 01280602
         L     RF,SMFMOD           GET ADDRESS OF IEE2303D       Y02669 01282102
         B     COMONEXT            GO TO EXIT ROUTINE            Y02669 01285502
S1COMP   EQU   *                                                  19084 01288902
         CLC   SIX(TRE,R9),HOUNIT   IS ,O- SPECIFIED              19084 01290602
         BNE   SERR3               NO, DELIMITER ERROR            19084 01292302
         CLI   TWLV(R9),RPAREN     RPAREN ENDS COMPOSITE          19084 01295702
         BNE   SERR3               NO, ERROR                      19084 01297402
         LA    R9,TEN(R9)          INDEX PAST UNIT                19084 01300802
         B     SCOMACK             GO TO CHECK ENDING             19084 01302502
*                                                                 19084 01304202
SPARNCK  EQU   *                                                  19084 01307602
         CLI   ZERO(R9),RPAREN     ARE WE AT END OF UNIT FLD      19084 01309302
         BNE   SMOREUNT            NO, APPARENTLY MORE UNITS      19084 01311002
         LA    R9,ONE(R9)          INDEX PAST 'PARENS'            19084 01314402
         B     SKEYCK              GO TO CONTINUE                 19084 01316102
SMOREUNT EQU   *                                                  19084 01319502
         CLI   ZERO(R9),COMMA      COMMA DELIMITS UNITS           19084 01321202
         BE    SINDEX              YES,CONTINEU UNIT SCAN         19084 01322902
         B     SERR4               TERM LENGTH ERROR              19084 01324602
SONOFF   EQU   *                                                  19084 01329702
         CLC   ONE(TWO,R9),ONLINE  IS IT ONLINE KEY               19084 01331402
         BNE   SOFFLINE            NO,MUST BE OFFLINE             19084 01333102
         OI    XASOPCOD,XAON       TURN ON ONLINE BIT          @Z30LPTJ 01336503
         LA    R9,SVN(R9)          INDEX PAST KEYWORD             19084 01339902
SCOMDATH EQU   *                                                  19084 01343302
         BAL   R5,SUCMID           GO GET COMD AUTH OF ISSUER     19084 01345002
         TM    XACAHOLD,CA2OR3   IS C A  TWO OR THREE          @Z30LPTJ 01348403
         BZ    SERR1               NO, AUTH IS INVALID            19084 01350102
         B     SMFRTN              YES, GO CHECK SMF              19084 01351802
*                                                                 19084 01353502
SOFFLINE EQU   *                                                  19084 01356902
         OI    XASOPCOD,XAOFF     TURN OFFLINE BIT             @Z30LPTJ 01358603
         LA    R9,EIT(R9)          INDEX PAST KEYWORD             19084 01362002
         B     SCOMDATH            GO TO CHECK EOB               Y01012 01363702
*                                                                 19084 01365402
SUCMID   EQU   *                                                  19084 01368802
         CLI   XAU,URI             WAS R/I ISSER                  19084 01372202
         BCR   EIT,R5              YES,RETURN                     19084 01376002
*                                                                 19084 01378002
         CLI   XAU,USYST           WAS A SYSTEM COMMAND           19084 01382002
         BNE   UCONS               NO,FROM CONSOLE                19084 01384002
         XC    XACAHOLD(TWO),XACAHOLD  YES, ZERO CAHOLD        @Z30LPTJ 01388003
         OI    XACAHOLD,SYSCODE    AND INSERT ALL C.A.            19084 01390003
         BCR   FIFTN,R5            RETURN                         19084 01394002
*                                                                 19084 01396002
UCONS    EQU   *                                                  19084 01400001
         LR    RE,RD              SAVE SAVE AREA REG IN R14      Y02669 01400402
         SR    RD,RD               ZERO FOR IC                   Y02669 01401002
         IC    RD,XAU              CONSOLE ID                    Y02669 01402002
         BCTR  RD,ZERO             MINUS ONE                     Y02669 01404002
         L     R4,CVTCUCB                                         19084 01405001
         USING UCM,R4                                                   01406202
         L     RC,UCMVEZ           PTR TO FIRST UCME              19084 01407902
         L     R4,UCMVEA           AND SIZE                       19084 01409602
         DROP  R4                                                 19084 01411302
         MR    RC,RC               ID TIMES SIZE                  19084 01413002
         AR    R4,RD               PLUS ADDR OF FIRST UCME       Y02669 01414702
         USING UCMLIST,R4          GIVES ISSUERS UCME             19084 01416402
         MVC   XACAHOLD(TWO),UCMAUTH    MOVE OVER HIS C.A.     @Z30LPTJ 01419803
         LR    RD,RE              RESTORE REG13 SAVE AREA PTR    Y02669 01421802
         BCR   FIFTN,R5            RETURN                         19084 01423202
         EJECT                                                          01424902
*********************************************************************** 01426602
*                                                                 19084 01428302
*        EXIT ROUTINES                                            19084 01430002
*                                                                 19084 01431702
*********************************************************************** 01433402
FOR2EXT  EQU   *                                                 Y01029 01436802
         MVC   XAX+TRE(TWO),MOD42                                Y02669 01438802
         L     RF,UCMMOD     ADDRESS OF IEE4203D                 Y01029 01441902
         B     COMONEXT      GO TO EXIT RTN                      Y02669 01445302
*                                                                Y02669 01448002
FOR4EXT  EQU   *                                                 Y02669 01448402
         MVC   XAX+TRE(TWO),MOD44                                Y02669 01448502
         L     RF,VCON44           ADDRESS OF 4403D              Y02669 01448602
COMONEXT EQU   *                                                 Y02669 01448702
         LM    R0,RE,ZERO(RD)    RESTORE ALL REGS BUT BRANCH REG Y02669 01448802
         BR    RF                  BRANCH TO NEXT RTN            Y02669 01449002
*                                                                       01449202
SERR3    MVI   XAE,ERR7                 DELIMITER ERROR          Y01029 01450402
         B     SERR05                   MSG MOD IS 0503D         Y01029 01452102
*                                                                 19084 01453802
SERR4    MVI   XAE,ERR8                 TERM LENGTH ERROR        Y01029 01457202
*                                                                 19084 01458902
SERR05   EQU   *                                                        01462302
         SPACE 5                                                        01462702
**************************************************               Y02651 01463102
*                                                                Y02651 01463202
*  THIS IS A TERMINAL ERROR CONDITION. A DEQ WILL BE             Y02651 01463602
*  ISSUED BEFORE EXITING TO THE ERROR MESAGE MODULE.             Y02651 01464002
*                                                                Y02651 01464102
         BAL   R4,SDEQUE                                         Y02651 01464202
*                                                                Y02651 01464302
**************************************************               Y02651 01465302
         SPACE 5                                                        01465402
         LOAD  EP=IEE0503D                                       Y02669 01465502
         LR    RF,R0               GET ADDRESS OF RTN IN REG15   Y02669 01465602
         MVC   XAX+TRE(TWO),MOD05                                Y02669 01465702
         XC    XAA(TWO),XAA        CLEAR OUT VARY RANGE BITS   @Z30LPTJ 01466003
         BALR  RE,RF               GO TO 0503D                   Y02669 01468203
* ON RETURN                                                      Y02669 01468403
         LM    R0,RF,ZERO(RD)      RESTORE ALL REGS              Y02669 01468803
         STH   R8,XAA              RESTORE VARY RANGE BITS     @Z30LPTJ 01469003
         DELETE EP=IEE0503D                                      Y02669 01469203
EXIT     EQU   *                                                 Y02669 01469403
         TM    XAAVRANG,XAARNG1    VARY RANGE BEING PROCESSED? @Z30LPTJ 01469703
         BO    CB904EXT            YES, EXIT VIA IEECB904      @Z30LPTJ 01469803
         L     R1,D64(RD)          GET CSCB PTR                  Y02669 01469903
         USING CHAIN1,R1                                         Y02669 01470103
         OI    CHSTS,CHFC          SET FREE CSCB                 Y02669 01470303
         MGCR  (1),CHAIN                                         Y02669 01470503
         LM    R0,RF,ZERO(RD)      RESTORE ALL REGS              Y02669 01470703
         LR    R4,RE               SAVE RETURN ADDRESS           Y02669 01471003
         LA    R0,D132             SAVE AREA SIZE                Y02669 01471303
         LR    R1,R2               SAVE AREA POINTER             Y02669 01471603
         FREEMAIN R,LV=(0),A=(1)                                 Y02669 01471903
*                                  FREE SAVE AREA                Y02669 01472203
*                                  FREE DUMMY XSA GOTTEN IN 3603DY02669 01472503
         LR    RE,R4               RESTORE RETURN REG            Y02669 01472803
         BR    RE                  RETURN                        Y02669 01473103
*                                                                Y02669 01473403
*                                                                 19084 01473703
SERR1    MVI   XAE,ERR41                 AUTHORITY INVALID MSG   Y01029 01474203
         SPACE 5                                                        01474602
**************************************************               Y02651 01475002
*                                                                Y02651 01475202
*  THIS IS A TERMINAL ERROR CONDITION. A DEQ WILL BE             Y02651 01475302
*  ISSUED BEFORE EXITING TO THE ERROR MESSAGE MODULE.            Y02651 01475402
*                                                                Y02651 01475502
         BAL   R4,SDEQUE                                         Y02651 01475602
*                                                                Y02651 01475702
**************************************************               Y02651 01476402
         SPACE 5                                                        01476602
         LOAD  EP=IEE2103D                                       Y02669 01476802
         LR    RF,R0               GET RTN'S ADDRESS INTO REG15  Y02669 01477002
         MVC   XAX+TRE(TWO),MOD21                                Y02669 01477202
         XC    XAA(TWO),XAA        CLEAR OUT VARY RANGE BITS   @Z30LPTJ 01477303
         BALR  RE,RF               GO TO 2103D                   Y02669 01477402
*  ON RETURN                                                     Y02669 01477602
         LM    R0,RF,ZERO(RD)      RESTORE ALL REGS              Y02669 01477702
         STH   R8,XAA              RESTORE VARY RANGE BITS     @Z30LPTJ 01483203
         DELETE EP=IEE2103D                                      Y02669 01483303
         B     EXIT                                              Y02669 01493703
*                                                                 19084 01498003
CB904EXT EQU   *                                               @Z30LPTJ 01503103
         OI    XAAVRANG,XAARNG3    TURN TERMINATION EXIT BIT ON@Z30LPTJ 01504103
         L     RF,VCON904          GET IEECB904 ADDRESS        @Z30LPTJ 01505103
         BR    RF                  GO TO VARY RANGE PROCESSOR  @Z30LPTJ 01506103
         EJECT                                                          01507103
*****************************************************************Y02651 01508203
*                                                                Y02651 01513303
*  THIS IS THE DEQ SUBROUTINE                                    Y02651 01523503
*  THE ENQ WAS ISSUED IN MODULE IEE3603D                         Y02651 01526903
SDEQUE   EQU   *                                                 Y02651 01530303
         TM    XAAVRANG,XAARNG1    VARY RANGE BEING PROCESSED? @Z30LPTJ 01531303
         BO    PROCEED             YES, AVOID DEQUEING         @Z30LPTJ 01532303
         DEQ   MF=(E,IEFDEQUE)                                   Y02651 01535403
PROCEED  EQU   *                                               @Z30LPTJ 01545203
         BR     R4                                               Y02651 01546203
*****************************************************************Y02651 01547303
         EJECT                                                          01552403
*****************************************************************Y02651 01560903
*                                                                Y02651 01562603
*  THE LIST FORM OF THE DEQ MACRO INTRUCTION FOLLOWS             Y02651 01567703
*                                                                Y02651 01576203
IEFDEQUE DEQ   (IEFSQCBS,IEFQ4QCB,TWO,SYSTEM,IEFSQCBS,IEFVQCBS,SVN,    *01579603
               SYSTEM),RET=HAVE,MF=L                           @YM5443P 01584603
IEFVQCBS DC    C'VARYDEV'                                               01589603
IEFSQCBS DC    C'SYSIEFSD'                                       Y02651 01594603
IEFQ4QCB DC    C'Q4'                                             Y02651 01599603
*                                                                Y02651 01604603
*****************************************************************Y02651 01609603
         EJECT                                                          01614603
*********************************************************************** 01619603
*                                                                 19084 01624603
*        CONSTANTS USED BY 3303D                                  19084 01629603
*                                                                 19084 01634603
*********************************************************************** 01639603
HIUNIT    DC    C'(I-'                   BEGINNING OF COMPOSITE   19084 01644603
HOUNIT   DC    C',O-'                   MIDDLE OF COMPOSITE       19084 01649603
*                                       OR OUTPUT UNIT            19084 01654603
ONLINE   DC    C'ON'                    ONLINE KEYWORD            19084 01659603
*                                                                 19084 01664603
         DS    0F                                                Y02669 01669603
SMFMOD   DC    V(IEE2303D)              SMF MODULE               Y02669 01674603
UCMMOD   DC    V(IEE4203D)              MCS UCM SCANNER          Y02669 01679603
VCON44   DC    V(IEE4403D)                                       Y02669 01684603
VCON904  DC    V(IEECB904)                                     @Z30LPTJ 01689603
*                                                                Y02669 01694603
MOD23    DC    C'23'                                             Y02669 01699603
MOD42    DC    C'42'                                             Y02669 01704603
MOD44    DC    C'44'                                             Y02669 01709603
MOD05    DC    C'05'                                             Y02669 01714603
MOD21    DC    C'21'                                             Y02669 01719603
*                                                                Y02669 01724603
         SPACE 5                                                        01729603
PATCH    DC    CL50'***IEE3303D***'                            @Z30LPTJ 01734603
         EJECT                                                          01739603
SXSA     DSECT                                                          01744603
         IEEXSA                                                         01749603
         EJECT                                                          01771002
CVT      DSECT                                                   Y01029 01774002
         CVT                                                            01777002
         EJECT                                                          01780002
UUCM     DSECT                                                   Y01029 01783002
         IEECUCM   FORMAT=NEW                                           01786002
         EJECT                                                          01790002
CHAIN1   DSECT                                                          01790402
         IEECHAIN                                                       01792002
         EJECT                                                          01794002
         IEESMCA                                                        01796002
         END                                                            01800001
