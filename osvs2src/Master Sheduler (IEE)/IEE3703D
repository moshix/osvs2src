         TITLE 'IEE3703D--VS2 CANCEL/FORCE COMMAND'                     00050041
*********************************************************************** 00400018
*                                                                     * 00800018
*  MODULE NAME =  IEE3703D                                       Y02669 00850002
*                                                                     * 01600018
*  DESCRIPTIVE NAME =  CANCEL/FORCE COMMAND HANDLER            @G17FPSS 01620041
*                                                                     * 02400018
*                                                                     * 02450041
*  STATUS =  OS/VS2 - SERVICE DATA IMPROVEMENTS                @G17FPSS 02470041
*                                                                     * 04000018
*  FUNCTION =  CANCEL/FORCE BOTH FOREGROUND AND BACKGROUND     @G17FPSS 04000141
*              JOBS IN EXECUTION                               @G17FPSS 04000241
*     OPERATION =                                                Y02669 04000602
*        0.  IF THE COMMAND WAS FORCE THEN CHECK TO SEE IF IT  @ZD00106 04000741
*            WAS ISSUED ON THE MASTER CONSOLE. IF NOT THEN A   @ZD00106 04000841
*            BRANCH IS MADE TO MODULE IEE0503D TO ISSUE        @ZD00106 04000941
*            MESSAGE IEE345I.                                  @ZD00106 04001041
*                                                                       04001441
*        1.  OPERAND SYNTAX IS CHECKED.  VALID SYNTAX IS:        Y02669 04002041
*                CANCEL                FORCE                   @G17FPSS 04002341
*             A) NAME               E) NAME                    @G17FPSS 04002441
*             B) NAME,DUMP          F) U=NAME                  @G17FPSS 04002641
*             C) U=NAME                                                 04002741
*             D) U=NAME,DUMP                                            04002841
*            WHERE NAME IN A,B AND E MAY BE THE NAME OF A      @G17FPSS 04003041
*            BACKGROUND JOB OR A DEVICE ID (CANCEL/FORCE       @G17FPSS 04003141
*            IS INDIFFERENT TO THE EXTERNAL SIGNIFICANCE OF THE  Y02669 04003241
*            NAME). NAME IN C,D AND F IS THE USERID OF A TIME  @G17FPSS 04003341
*            SHARING USER.  IN ALL CASES, THE FINAL DELIMITER    Y02669 04003441
*            MUST BE A BLANK OR END OF BUFFER, THE INTERMEDIATE  Y02669 04003541
*            DELIMITER, A COMMA.                                 Y02669 04003641
*                                                                       04003741
*            IF THE SYNTAX IS INVALID, CONTROL PASSES TO THE     Y02669 04003841
*            MESSAGE MODULE TO ISSUE THE MESSAGE INDICATED AT    Y02669 04003941
*            THE ERROR EXIT.                                     Y02669 04004041
*                                                                       04004141
*        2.  ENQ SHARE ON THE CSCB CHAIN RESOURCE AND SEARCH THE Y02651 04004202
*            CHAIN FOR A CSCB WITH NAME IN THE CHKEY OR CHUNIT   Y02669 04004402
*            FIELDS MATCHING THE NAME IN THE OPERAND FIELD OF THEY02669 04004602
*            COMMAND.  IF NONE IS FOUND, CONTROL IS PASSED TO    Y02669 04004802
*            THE MESSAGE MODULE TO ISSUE THE MESSAGE INDICATED   Y02669 04005002
*            AT THE EXIT.                                        Y02669 04005202
*                                                                       04005402
*        3.  IF A CSCB IS FOUND, WITH THE ASSIGNMENT PENDING     Y02669 04005602
*            BIT (CHAP) OFF, THE TYPE IS CHECKED AGAINST THE     Y02669 04005802
*            TYPE SPECIFIED IN THE COMMAND:  FOREGROUND OR       Y02669 04006002
*            BACKGROUND.  IF CHAP IS ON, OR THE TYPES DO NOT     Y02669 04006202
*            MATCH, THE SCAN CONTINUES.                          Y02669 04006402
*                                                                       04006602
*        4.  IF THE TYPES MATCH AND FORCE WAS THE COMMAND THEN @G17FPSS 04006741
*            A TEST IS MADE TO SEE IF A CANCEL COMMAND WAS     @G17FPSS 04006841
*            ISSUED FOR THE JOB OR TSO USER(IF BIT CHAFORCE IS @G17FPSS 04007241
*            ON IN THE CSCB).  IF NOT THEN CONTROL IS PASSED   @G17FPSS 04007341
*            TO THE MESSAGE MODULE TO ISSUE MESSAGE IEE838I.   @G17FPSS 04007441
*            IF CANCEL WAS ISSUED BEFORE THE FORCE             @G17FPSS 04008441
*            THEN A CALLRTM TYPE=MEMTERM IS ISSUED WITH THE    @G17FPSS 04009541
*            JOBS ASID GOTTEN FROM THE CSCB. A COMPLETION CODE @G17FPSS 04010541
*            OF X'A22' IS PASSED TO CALLRTM. CONTROL IS THEN   @G17FPSS 04013541
*            GIVEN TO STEP 6.                                  @G17FPSS 04016541
*                                                                       04025341
*        5.  A CANCEL COMMAND WAS ISSUED.                      @G17FPSS 04026341
*            IF THE TYPES MATCH, AND FOREGROUND WAS SPECIFIED    Y02669 04026641
*            (BIT CHTSID IN BYTE CHTRKID IS ON AND U=NAME        Y02669 04027341
*            APPEARS ON THE COMMAND), THE BRANCH TO SIC IS TAKEN,Y02669 04028341
*            AND THE CANCEL ECB (CHCECB) IN THE CSCB IS POSTED,  Y02669 04028641
*            WITHIN SIC, WITH ONE OF THE FOLLOWING COMPLETION    Y02669 04029341
*            CODES:                                              Y02669 04029541
*                           00000122          DUMP               Y02669 04029741
*                           00000222          NO DUMP            Y02669 04029941
*            IF BACKGROUND CANCEL WAS SPECIFIED, AND BIT CHJOBID Y02669 04030141
*            IN BYTE CHTRKID IS ON, INDICATING A BACKGROUND JOB  Y02669 04030341
*            CSCB.  THE ABOVE BRANCH TO SIC IS TAKEN (SIC WILL @ZA05360 04031341
*            NOT POST THE CANCEL ECB FOR BACKGROUND JOBS)      @ZA05360 04033341
*            AND THE CANCEL ECB IS POSTED WITH ONE OF THE      @ZA05360 04035341
*            ABOVE COMPLETION CODES. BIT CHAFORCE IS TURNED ON @G17FPSS 04038341
*            TO SHOW THAT A CANCEL HAS BEEN ISSUED FOR THIS    @G17FPSS 04041341
*            JOB.                                              @G17FPSS 04051341
*                                                                       04101002
*        6.  DEQ OFF THE CSCB CHAIN RESOURCE AND PASS CONTROL TO Y02651 04111041
*            EXIT CMBRCH TO CAUSE THE MESSAGE MODULE TO INDICATE Y02669 04144002
*            ACCEPTANCE OF THE COMMAND, AFTER ISSUING SYSEVENT @YM6770P 04154002
*            BRINGIN TO SWAP IN THE CANCELLED MEMORY --        @YM6770P 04161002
*            OTHERWISE, THE MEMORY, IF SWAPPED-OUT AT THE      @YM6770P 04168002
*            TIME OF CANCEL, COULD REMAIN SWAPPED-OUT FOR      @YM6770P 04175002
*            A SUBSTANTIAL PERIOD OF TIME.                     @YM6770P 04182002
*                                                                       04193002
*        7.  IF A SATISFACTORY CSCB IS NOT FOUND, AND FOREGROUND Y02669 04203041
*            CANCEL/FORCE WAS SPECIFIED, OR IF A CSCB WAS NOT  @G17FPSS 04216041
*            FOUND FOR A BACKGROUND CANCEL/FORCE, CONTROL PASSES Y02669 04239041
*            TO EXITS NOTFORE, NOTBACK AND NONCAN TO SET UP    @G17FPSS 04262041
*            APPROPRIATE PARAMETER LISTS FOR THE MESSAGE       @G17FPSS 04312041
*            MODULE.                                           @G17FPSS 04362041
*                                                                     * 05600018
*  NOTES=  THE CSCB CHAIN ENQ ON Q10 MUST BE ISSUED BEFORE THE   Y02651 05600202
*          CHAIN SEARCH AND RETAINED UNTIL AFTER THE POST, TO    Y02651 05600402
*          ASSURE THAT A CSCB FOUND WILL REMAIN ON THE CHAIN     Y02651 05600602
*          UNTIL POSTED.                                         Y02651 05601602
*                                                                       05601741
*          SIC IS ENTERED FOR BACKGROUND JOBS TO CAUSE THE     @ZA05360 05601841
*          INITIATOR TO BE FORCED DISPATCHABLE IF THE          @ZA05360 05601941
*          RCT IS HUNG; THE XMPOST IS ISSUED IN THIS           @ZA05360 05602041
*          MODULE BECAUSE SIC HAS NO WAY TO PROPERLY           @ZA05360 05602141
*          PROCESS JOBS WITH MORE THAN ONE CSCB.  THE          @ZA05360 05602241
*          EXTERNAL WRITER (XWTR) IS AN EXAMPLE.               @ZA05360 05602341
*                                                                       05602602
*     CHARACTER CODE DEPENDENCIES =                              Y02669 05603602
*          THIS MODULE HAS BEEN CODED IN SUCH A WAY THAT IF THE  Y02669 05604602
*          EXTERNAL CHARACTER SET IS CHANGED FROM EBCDIC,        Y02669 05605602
*          REASSEMBLY WILL YIELD A VALID MODULE.                 Y02669 05606602
*                                                                       05607602
*     DEPENDENCIES =  ENQ, DEQ, SIC, CROSS MEMORY POST,          Y02669 05608602
*                     SYSEVENT, CALLRTM                        @G17FPSS 05608841
*                                                                       05609602
*     RESTRICTIONS =  THIS MODULE EXPECTS REGISTER TWO TO CON-   Y02669 05610602
*                     TAIN THE ADDRESS OF AN EXTENDED SAVE AREA. Y02669 05611602
*                     IT SAVES NO REGISTERS, BUT WILL NOT ALTER  Y02669 05612602
*                     REGISTERS 13 AND 14.                       Y02669 05613602
*                                                                       05614602
*     REGISTER CONVENTIONS =                                     Y02669 05615602
*              REGISTER 7         BUFFER SCAN POINTER            Y02669 05616602
*              REGISTER 8         CVT POINTER                    Y02657 05617002
*              REGISTER 11        CSCB POINTER                   Y02669 05617602
*              REGISTER 12        MODULE BASE                    Y02669 05618602
*              REGISTER 14        RETURN ADDRESS                 Y02669 05619602
*              REGISTER 15        ADDRESS OF SUCCESSOR MODULE    Y02669 05620602
*                                                                       05621602
*     PATCH-LABEL =  PATCH                                       Y02669 05622602
*                                                                       05623602
*  MODULE-TYPE =  CSECT                                          Y02669 05624602
*                                                                       05625602
*     PROCESSOR =  ASSEMBLER                                     Y02669 05626602
*                                                                       05627602
*     MODULE-SIZE =  N/A                                         Y02669 05628602
*                                                                       05629602
*     ATTRIBUTES =                                               Y02669 05630602
*                  PAGED LPA              REENTRANT              Y02669 05631602
*                  ZERO PSW PROTECT KEY   REUSABLE               Y02669 05632602
*                  SUPERVISOR MODE        REFRESHABLE            Y02669 05633602
*                                                                     * 06400018
*  ENTRY-POINT =  IEE3703D, FROM IEE0403D                        Y02669 06401002
*                                                                       06402002
*     PURPOSE =  CANCEL A JOB IN EXECUTION                     @G17FPSS 06402241
*                FORCE A JOB THAT WAS NOT REMOVED BY A         @G17FPSS 06402541
*                      CANCEL COMMAND.                         @G17FPSS 06402841
*                                                                       06404002
*     LINKAGE =  REGISTER TWO CONTAINS THE ADDRESS OF AN XSA,    Y02669 06405002
*                INITIALIZED AS FOLLOWS:                         Y02669 06406002
*                    XAR    POINTS TO COMMAND BUFFER                    07600002
*                    XAV    CONTAINS THE VERB IN EBCDIC                 08000002
*                    XAV    CONTAINS THE VERB CODE                      08400041
*                    XAL    POINTS TO THE COMMAND PARAMETER LIST        08401002
*                    XAU    CONTAINS THE ID OF ISSUING CONSOLE   Y02669 08401202
*                    XAA    CONTAINS ASID OF TIME-SHARING USER   Y02669 08401402
*                                                                       08402002
*     INPUT DATA =  AS DESCRIBED ABOVE                           Y02669 08403002
*                                                                       08404002
*     REGISTERS SAVED =  NONE                                    Y02669 08405002
*                                                                       08406002
*     REGISTER CONTENTS DURING PROCESSING =                      Y02669 08407002
*                        SEE REGISTER CONVENTIONS                Y02669 08408002
*                                                                       08409002
*     REGISTERS RESTORED =  NONE                                 Y02669 08410002
*                                                                       08411002
*  EXIT-NORMAL =  CMBRCH                                         Y02669 08412002
*     CONDITIONS =  THE CANCEL ECB IN THE CSCB CORRESPONDING TO  Y02669 08413002
*                   THE JOB SPECIFIED ON THE COMMAND IS POSTED.  Y02669 08414002
*                   CONTROL IS PASSED VIA BRANCH TO IEE0503D TO  Y02669 08415002
*                   ISSUE MESSAGE IEE301I.                       Y02669 08416002
*                                                                       08417002
*     OUTPUT DATA =  REGISTER TWO POINTS TO AN XSA CONTAINING:   Y02669 08418002
*                    XAE     MESSAGE INDEX X'01'                 Y02669 08419002
*                    XAV     JOBNAME                             Y02669 08421002
*                    XAU     CONSOLE ID FOR WTO                  Y02669 08421202
*                    XAA     ASID FOR TPUT                       Y02669 08422002
*                                                                       08423002
*                    CSCB FOR THIS JOB WITH CANCEL ECB (CHCECB)  Y02669 08424002
*                    POSTED AND CHCLD BIT SET ON.                Y02669 08425002
*                                                                       08426002
*     RETURN CODES =  NONE                                       Y02669 08427002
*                                                                       08447041
*  EXIT-NORMAL =  CMBRCH                                         Y02669 08467041
*     CONDITIONS =  CALLRTM TYPE=MEMTERM IS DONE. CONTROL IS   @G17FPSS 08487041
*                   PASSED VIA BRANCH TO IEE0503D TO ISSUE     @G17FPSS 08497041
*                   MESSAGE IEE301I.                           @G17FPSS 08527041
*                                                                       08547041
*     OUTPUT DATA =  REGISTER TWO POINTS TO AN XSA CONTAINING: @G17FPSS 08567041
*                    XAE     MESSAGE INDEX X'02'               @G17FPSS 08587041
*                    XAV     JOBNAME                           @G17FPSS 08607041
*                    XAU     CONSOLE ID FOR WTO                @G17FPSS 08627041
*                    XAA     ASID FOR TPUT                     @G17FPSS 08647041
*                                                                       08667041
*     RETURN CODES =  NONE                                     @G17FPSS 08687041
*                                                                     * 08800018
*  EXIT-ERROR =  NOTFORE                                         Y02669 08801002
*     CONDITIONS =  FOREGROUND CANCEL/FORCE SPECIFIED FOR A    @G17FPSS 08801541
*                   USER NOT LOGGED ON.                          Y02669 08802041
*                   CONTROL IS PASSED VIA BRANCH ON VCON TO      Y02669 08804002
*                   MESSAGE MODULE (IEE0503D) TO ISSUE MESSAGE   Y02669 08805002
*                   IEE324I.                                     Y02669 08806002
*                                                                       08807002
*     OUTPUT DATA =  REGISTER TWO CONTAINS THE ADDRESS OF AN     Y02669 08808002
*                    XSA INITIALIZED AS FOLLOWS:                 Y02669 08809002
*                    XAE     MESSAGE INDEX  X'35'                Y02669 08810002
*                    XAV     USERID (NAME FROM THE COMMAND)      Y02669 08811002
*                    XAU     CONSOLE ID FOR WTO                  Y02669 08811202
*                    XAA     ASID FOR TPUT                       Y02669 08811402
*                                                                       08812002
*     RETURN CODES =  NONE                                       Y02669 08813002
*                                                                     * 08814002
*  EXIT-ERROR =  NOTBACK                                         Y02669 08815002
*     CONDITIONS =  BACKGROUND CANCEL/FORCE SPECIFIED FOR A    @G17FPSS 08815541
*                   NAME WITH NO CORRESPONDING CSCB ON THE CHAIN.Y02669 08816041
*                   CONTROL IS PASSED VIA BRANCH ON VCON TO      Y02669 08818002
*                   MESSAGE MODULE (IEE0503D) TO ISSUE MESSAGE   Y02669 08819002
*                   IEE341I.                                     Y02669 08820002
*                                                                       08821002
*     OUTPUT DATA =  REGISTER TWO CONTAINS THE ADDRESS OF AN     Y02669 08822002
*                    XSA INITIALIZED AS FOLLOWS:                 Y02669 08823002
*                    XAE     MESSAGE INDEX  X'24'                Y02669 08824002
*                    XAV     JOBNAME (NAME FROM THE COMMAND)     Y02669 08825002
*                    XAU     CONSOLE ID FOR WTO                  Y02669 08825202
*                    XAA     ASID FOR TPUT                       Y02669 08825402
*                                                                       08826002
*     RETURN CODES =  NONE                                       Y02669 08827002
*                                                                     * 08828002
*  EXIT-ERROR =  CMERRC                                          Y02669 08843041
*     CONDITIONS =  NO OPERAND ON THE COMMAND                    Y02669 08844002
*                   CONTROL IS PASSED VIA BRANCH ON VCON TO      Y02669 08845002
*                   MESSAGE MODULE (IEE0503D) TO ISSUE MESSAGE   Y02669 08846002
*                   IEE311I.                                     Y02669 08847002
*                                                                       08848002
*     OUTPUT DATA =  REGISTER TWO CONTAINS THE ADDRESS OF AN     Y02669 08849002
*                    XSA INITIALIZED AS FOLLOWS:                 Y02669 08850002
*                    XAE     MESSAGE INDEX  X'0B'                Y02669 08851002
*                    XAV     COMMAND VERB                        Y02669 08852002
*                    XAU     CONSOLE ID FOR WTO                  Y02669 08852202
*                    XAA     ASID FOR TPUT                       Y02669 08852402
*                                                                       08853002
*     RETURN CODES =  NONE                                       Y02669 08854002
*                                                                     * 08855002
*  EXIT-ERROR =  AUTHERR                                       @ZD00106 08855141
*    CONDITIONS =  THE FORCE COMMAND WAS NOT ISSUED ON THE     @ZD00106 08855941
*                  MASTER CONSOLE. CONTROL IS PASSED VIA       @ZD00106 08856341
*                  BRANCH TO IEE0503D TO ISSUE MESSAGE         @ZD00106 08857341
*                  IEE345I.                                    @ZD00106 08858341
*                                                                       08859441
*    OUTPUT DATA = REGISTER TWO CONTAINS THE ADDRESS OF AN     @ZD00106 08859541
*                  XSA INITIALIZED AS FOLLOWS:                 @ZD00106 08860441
*                  XAE     MESSAGE INDEX X'29'                 @ZD00106 08861441
*                  XAV     JOBNAME (NAME FROM THE COMMAND)     @ZD00106 08862441
*                  XAU     CONSOLE ID FOR WTO                  @ZD00106 08863441
*                  XAA     ASID FOR TPUT                       @ZD00106 08863641
*                                                                       08863941
*    RETURN CODES =  NONE                                      @ZD00106 08864041
*                                                                     * 08864641
*  EXIT-ERROR =  CMERR8A                                         Y02669 08864741
*     CONDITIONS =  LENGTH OF AN OPERAND EXCEEDS EIGHT           Y02669 08864841
*                   CHARACTERS.                                  Y02669 08864941
*                   CONTROL IS PASSED VIA BRANCH ON VCON TO      Y02669 08865041
*                   MESSAGE MODULE (IEE0503D) TO ISSUE MESSAGE   Y02669 08865141
*                   IEE308I.                                     Y02669 08865241
*                                                                       08865341
*     OUTPUT DATA =  REGISTER TWO CONTAINS THE ADDRESS OF AN     Y02669 08865441
*                    XSA INITIALIZED AS FOLLOWS:                 Y02669 08865541
*                    XAE     MESSAGE INDEX  X'08'                Y02669 08865641
*                    XAV     COMMAND VERB                        Y02669 08865741
*                    XAU     CONSOLE ID FOR WTO                  Y02669 08865841
*                    XAA     ASID FOR TPUT                       Y02669 08865941
*                                                                       08866002
*     RETURN CODES =  NONE                                       Y02669 08867002
*                                                                     * 08868002
*  EXIT-ERROR =  CMERR8                                          Y02669 08869002
*     CONDITIONS =  LENGTH OF AN OPERAND EXCEEDS EIGHT           Y02669 08870002
*                   CHARACTERS.                                  Y02669 08871002
*                   CONTROL IS PASSED VIA BRANCH ON VCON TO      Y02669 08872002
*                   MESSAGE MODULE (IEE0503D) TO ISSUE MESSAGE   Y02669 08873002
*                   IEE308I.                                     Y02669 08874002
*                                                                       08875002
*     OUTPUT DATA =  REGISTER TWO CONTAINS THE ADDRESS OF AN     Y02669 08876002
*                    XSA INITIALIZED AS FOLLOWS:                 Y02669 08877002
*                    XAE     MESSAGE INDEX  X'08'                Y02669 08878002
*                    XAV     COMMAND VERB                        Y02669 08879002
*                    XAU     CONSOLE ID FOR WTO                  Y02669 08879202
*                    XAA     ASID FOR TPUT                       Y02669 08879402
*                                                                       08880002
*     RETURN CODES =  NONE                                       Y02669 08881002
*                                                                     * 08882002
*  EXIT-ERROR =  INVAL                                           Y02669 08883002
*     CONDITIONS =  NAME NOT SPECIFIED OR AN INVALID PARAMETER   Y02669 08884002
*                   ON THE COMMAND.                              Y02669 08885002
*                   CONTROL IS PASSED VIA BRANCH ON VCON TO      Y02669 08886002
*                   MESSAGE MODULE (IEE0503D) TO ISSUE MESSAGE   Y02669 08887002
*                   IEE305I.                                     Y02669 08888002
*                                                                       08889002
*     OUTPUT DATA =  REGISTER TWO CONTAINS THE ADDRESS OF AN     Y02669 08890002
*                    XSA INITIALIZED AS FOLLOWS:                 Y02669 08891002
*                    XAE     MESSAGE INDEX  X'05'                Y02669 08892002
*                    XAV     COMMAND VERB                        Y02669 08893002
*                    XAU     CONSOLE ID FOR WTO                  Y02669 08893202
*                    XAA     ASID FOR TPUT                       Y02669 08893402
*                                                                       08894002
*     RETURN CODES =  NONE                                       Y02669 08895002
*                                                                       08945041
*  EXIT-ERROR =  NONCAN                                        @G17FPSS 08995041
*    CONDITIONS =  CANCEL/FORCE WAS ISSUED FOR A JOB WHICH IS  @G17FPSS 09045041
*                  MARKED NON-CANCELABLE. CONTROL IS PASSED    @G17FPSS 09095041
*                  VIA BRANCH ON VCON TO MESSAGE MODULE        @G17FPSS 09145041
*                  (IEE0503D) TO ISSUE MESSAGE IEE841I.        @G17FPSS 09195041
*                                                                       09215041
*    OUTPUT DATA = REGISTER TWO CONTAINS THE ADDRESS OF AN     @G17FPSS 09245041
*                  XSA INITIALIZED AS FOLLOWS:                 @G17FPSS 09295041
*                  XAE     MESSAGE INDEX X'1C' FOR CANCEL      @G17FPSS 09345041
*                                        X'16' FOR FORCE       @G17FPSS 09395041
*                  XAV     JOBNAME (NAME FROM THE COMMAND)     @G17FPSS 09445041
*                  XAU     CONSOLE ID FOR WTO                  @G17FPSS 09495041
*                  XAA     ASID FOR TPUT                       @G17FPSS 09545041
*                                                                       09565041
*    RETURN CODES =  NONE                                      @G17FPSS 09595041
*                                                                     * 10800018
*  EXTERNAL REFERENCES =                                         Y02669 10801041
*                                                                       10802002
*     REFERENCES =  IEE0503D - MESSAGE MODULE                    Y02669 10803002
*                   SIC INTERFACE                                Y02669 10803402
*                                                                       10804002
*     DATA AREAS =  NONE                                         Y02669 10805002
*                                                                       10806002
*     CONTROL BLOCKS =  XSA, CSCB, PSA, ASVT                     Y02669 10807002
*                                                                       10808002
*     TABLES =                                                   Y02669 10809002
*                                                                       10810002
*     MACROS =  MODID, ENQ, DEQ, POST, SYSEVENT, IEEXSA,         Y02669 10811002
*               IEECHAIN, SETLOCK, IHAPSA, IHAASVT, CALLRTM    @G17FPSS 10811241
*                                                                       10812002
*     SERIALIZATION =                                            Y02651 10812102
*        ENQUEUE RESOURCES =       QNAME             RNAME       Y02651 10812202
*                                  SYSIEFSD          Q10         Y02651 10812402
*        LOCKS HELD =  CMS, LOCAL                                Y02651 10812502
*                                                                       10812602
*     CHANGE LEVEL =  Y02651, Y02657, Y02669, @YM6770P         @YM6770P 10813002
*                     ZA05360, G17FPSS, ZD00106                @ZD00106 10833041
*                                                                     * 13200018
         EJECT                                                          13200541
*  MESSAGES =                                                    Y02669 13201002
*        CODE                   TEXT                             Y02669 13202002
*        X'01'       IEE301I  (JOBNAME)  CANCEL COMMAND ACCEPTED Y02669 13203002
*        X'02'       IEE301I  (JOBNAME)  FORCE COMMAND ACCEPTED@G17FPSS 13203341
*        X'05'       IEE305I  (VERB)     COMMAND INVALID         Y02669 13204002
*        X'08'       IEE308I  (VERB)     TERM LENGTH ERROR       Y02669 13205002
*        X'0B'       IEE311I  (VERB)     PARAMETER MISSING       Y02669 13206002
*        X'16'       IEE841I  (JOBNAME)  NON-FORCIBLE          @G17FPSS 13206141
*        X'1B'       IEE838I  (JOBNAME)  CANCELABLE-ISSUE CANCEL        13206341
*                                           BEFORE FORCE       @G17FPSS 13206441
*        X'1C'       IEE841I  (JOBNAME)  NON-CANCELABLE        @G17FPSS 13206541
*        X'24'       IEE341I  (JOBNAME)  NOT ACTIVE                     13207041
*        X'29'       IEE345I  (VERB)     AUTHORITY INVALID     @ZD00106 13207241
*        X'35'       IEE324I  (USERID)   NOT LOGGED ON           Y02669 13207541
*                                                                       13210002
*        ALL MESSAGES CONTAINED IN AND ISSUED BY IEE0503D.       Y02669 13210402
*                                                                       13211002
*  COMPLETION CODE =                                                    13211341
*        A22 - PASSED TO CALLRTM WHEN FORCING AN ADDRESS SPACE @G17FPSS 13211641
*                                                                       13211841
*  SYSGEN =  THIS MODULE IS IN LOAD MODULE IGC0003D IN           Y02669 13212002
*            SYS1.LPALIB.  IT IS INCLUDED AT SYSGEN FROM DLIB    Y02669 13213002
*            AOSB3 BY SYSGEN MACRO SGIEF441.                     Y02669 13214002
*                                                                       13215002
*  SYSTEM LIBRARIES =  THIS MODULE MAKES REFERENCE TO NO SYSTEM  Y02669 13216002
*                      LIBRARIES.                                Y02669 13218002
*                                                                     * 16400018
*********************************************************************** 17600018
         EJECT                                                          17650002
**************************************************************** Y02669 17700002
*                                                                       17750002
*        REGISTER EQUATES                                        Y02669 17800002
*                                                                       17850002
**************************************************************** Y02669 17860002
         SPACE 2                                                        17900002
IEE3703D  CSECT                                                         18000018
R0       EQU   0                                                        18800018
R1       EQU   1                                                        19200018
R2       EQU   2                                                        19600018
R3       EQU   3                                                        20000018
R4       EQU   4                                                        20400018
R5       EQU   5                                                        20800018
R6       EQU   6                                                        21200018
R7       EQU   7                                                        21600018
R8       EQU   8                                                        22000018
R9       EQU   9                                                        22400018
R10      EQU   10                                                       22800018
R11      EQU   11                                                       23200018
R12      EQU   12                                                       23600018
R13      EQU   13                                                       24000018
R14      EQU   14                                                       24400018
R15      EQU   15                                                       24800018
         EJECT                                                          24850002
**************************************************************** Y02669 24900002
*                                                                       24950002
*        EQUATES FOR LENGTHS OFFSETS, AND CONSTANTS              Y02669 25000002
*                                                                       25050002
**************************************************************** Y02669 25060002
         SPACE 2                                                        25100002
D0       EQU   0                                                        25200018
D1       EQU   1                                                        25250002
D2       EQU   2                                                        25400019
D3       EQU   3                                                   I272 25600019
D4       EQU   4                                                        26000018
D5       EQU   5                                                   O102 26003002
D6       EQU   6                                                  20035 26100020
D7       EQU   7                                                  20030 26200020
D8       EQU   8                                                        26400018
D9       EQU   9                                                        26450002
FIVE     EQU   5                                                   O102 27606002
CMCOMP   EQU   X'40'              COMPLETION CODE ECB                   30800018
BLANK    EQU   C' '                                                     31200018
UNCK     EQU   X'01'              UNCHECKED PARAMETER INDICATOR   M0232 31430020
EOS      EQU   X'02'              END OF SCAN SWITCH             Y02669 31432002
BOTHALF  EQU   X'03'              MASK FOR LAST TWO BYTES        Y02669 31433002
*                                 OF REGISTER                    Y02669 31436002
DUMPSW   EQU   X'04'              DUMP SWITCH                    Y02669 31486002
NONCANSW EQU   X'10'              NON-CANCELABLE SWITCH        @G17FPSS 31489041
COMMA    EQU   C','                                                     31500018
FOX      EQU   255                                                20030 31570020
FORCE    EQU   132                FORCE CMD VERB CODE          @G17FPSS 31575041
A22      EQU   2594               COMPLETION CODE FOR FORCE    @G17FPSS 31577041
SYSISSUD EQU   X'00'              CMD ISSUED BY SYSTEM         @ZD00106 31578041
         SPACE                                                          31580002
*                                                                       31582002
*        MESSAGE CODE EQUATES                                    Y02669 31584002
*                                                                       31586002
         SPACE                                                          31588002
CMCD01   EQU   1                                                        31590002
CMCD02   EQU   2                  FORCE CMD ACCEPTED           @G17FPSS 31590541
CMCD05   EQU   5                                                   O102 31592002
CMCD08   EQU   8                                                        31594002
CMCD0B   EQU   11                                                  O102 31596002
CMCD12   EQU   12                                                  O102 31598002
CMCD17   EQU   17                                                  O102 31598402
CMCD22   EQU   22                 NON-FORCIBLE MSG CODE        @G17FPSS 31598541
CMCD27   EQU   27                 ISSUE CANCEL FOR JOB MSG     @G17FPSS 31598641
CMCD28   EQU   28                 NON-CANCELABLE MSG CODE      @G17FPSS 31599041
CMCD36   EQU   36                 NOT ACTIVE MSG CODE            Y02669 31599141
CMCD41   EQU   41                 AUTHORITY INVALID MSG CODE   @G17FPSS 31599241
CMCD53   EQU   53                 MSG CODE- NOT LOGGED ON        Y02669 31599541
         EJECT                                                          31599941
*********************************************************************** 31600018
*  ENTRY ROUTINE- THIS PORTION OF CODE ESTABLISHES ADDRESSABILITY FOR * 32000018
*        THE MODULE AND THE VARIOUS DSECTS, SET UP THE EXTENDED SAVE  * 32400018
*        AREA.                                                        * 32800018
*********************************************************************** 33200018
         BALR  R12,0              ESTABLISH ADDRESSABILITY              33600018
         USING  *,R12                                                   34000018
         MODID BRANCH=YES                                        Y01886 34050001
         USING XSA,R2             ADDR. FOR XSA                         34400020
         USING CMCVT,R8           CVT...                         Y02657 34800002
         L     R8,CVTPTR          ...ADDRESSABILITY              Y02657 35200002
         L     R10,CVTMSER        PTR TO MASTER RESIDENT CORE           35600018
         USING BASE,R10           ADDR. FOR MRC                         36000018
         L     R11,BACHN                                                36800018
         USING CMCHAIN,R11        ADDR. FOR CHAIN                       37200018
         L     R9,XAL             PTR TO COMMAND PARM LIST              37600018
         LA    R9,D0(R9)          CLEAR HIGH ORDER BYTE           M2420 37800018
         L     R7,XAR             PTR TO CIB                            38000018
         LA    R7,D0(R7)                                                38400018
         AH    R7,D0(R7)          ABSOLUTE END OF BUFFER                38800018
         ST    R7,XAP             SAVE IN 1ST WORD OF XSA               39200018
         MVI   XAX,BLANK                                                39600018
         MVC   XAX+D1(D7),XAX     BLANK OUT JOBNAME                     40000020
         MVC   XAS(D8),XAX        XAS AS WELL                           40400018
         EJECT                                                          40430041
*********************************************************************** 40460041
*                                                                     * 40490041
* IF THIS IS THE FORCE COMMAND THEN CHECK TO SEE IF IT WAS     @ZD00106 40500041
* ISSUED FROM THE MASTER CONSOLE. IF NOT THEN MODULE IEE0503D  @ZD00106 40525041
* IS CALLED TO ISSUE MESSAGE IEE345I.                          @ZD00106 40545041
*                                                                     * 40610041
* TO FIND ISSUING CONSOLE'S UCME THE FOLLOWING FORMULA IS USED @ZD00106 40620041
*    UCME ADDR = UCMVEA + UCMVEZ * (XAU - 1)                   @ZD00106 40630041
*       UCMVEA - ADDR OF FIRST UCME                            @ZD00106 40670041
*       UCMVEZ - LENGTH OF A UCME                              @ZD00106 40700041
*       XAU    - CONSOLE ID WHERE THE COMMAND WAS ISSUED       @ZD00106 40730041
*                                                                     * 40790041
*********************************************************************** 40820041
         SPACE                                                          40850041
         CLI   XAN,FORCE          WAS THIS A FORCE CMD ?       @ZD00106 40860041
         BNE   AUTHOK             NO, CONTINUE                 @ZD00106 40880041
         CLI   XAU,SYSISSUD       WAS FORCE ISSUED BY SYSTEM?  @ZD00106 40940041
         BE    AUTHERR            YES, ERROR, GO ISSUED MSG    @ZD00106 40950041
         L     R5,CVTCUCB         ADDR OF UCM BASE             @ZD00106 40960041
         USING UCM,R5             UCM ADDRESSABILITY           @ZD00106 41000041
         L     R3,UCMVEA          ADDR OF 1ST UCME             @ZD00106 41030041
         L     R6,UCMVEZ          LENGTH OF A UCME             @ZD00106 41060041
         DROP  R5                                              @ZD00106 41090041
         SR    R5,R5              CLEAR REGISTER               @ZD00106 41120041
         IC    R5,XAU             GET CONSOLE ID OF ISSUER     @ZD00106 41150041
         BCTR  R5,D0              SUBRTACT 1                   @ZD00106 41180041
         MR    R4,R6              MULT LENGTH * ID-1           @ZD00106 41210041
         AR    R5,R3              ADD TO ADDR OF 1ST UCME      @ZD00106 41240041
         USING UCMLIST,R5         UCME ADDRESSABILITY          @ZD00106 41270041
         TM    UCMDISP1,UCMDISPA  IS THIS THE MASTER CONSOLE ? @ZD00106 41310041
         BZ    AUTHERR            NO GO TO ISSUE MESSAGE       @ZD00106 41320041
         DROP  R5                                              @ZD00106 41360041
         SPACE                                                          41420041
*********************************************************************** 41450041
*                                                                     * 41480041
* WAS A PARAMETER SPECIFIED WITH THE COMMAND ?                 @ZD00106 41490041
*                                                                     * 41540041
*********************************************************************** 41570041
         SPACE                                                          41600041
AUTHOK   EQU   *                  AUTH HAS BEEN CHECKED AND OK @ZD00106 41610041
         LA    R4,D9              *INITIALIZE COUNTER          *   O102 41800019
         LTR   R7,R9              PARAMETER AREA PTR=0                  42400018
         BZ    CMERRC             IF ZERO GO TO ERROR MESSAGE           42800018
         XC    XAE,XAE            *ZERO PARM BYTE              *   O102 42900019
         EJECT                                                          42950002
*                                                                 20030 43010020
* SCAN BUFFER- CHECK IF FIRST TWO CHARACTERS ARE 'U=', CHECK      20030 43020020
*        LENGTH OF JOBNAME, CHECK FOR DUMP                        20030 43030020
*                                                                 20030 43040020
         CLC   D0(L'UEQUAL,R9),UEQUAL CANCEL TS USER             Y02669 43050002
         BNE   CMSTNEXT           NO, PROCESS BATCH              Y02669 43060002
         LA    R9,D2(R9)          POINT TO BEGINNING OF JOBNAME   20030 43160020
         LR    R7,R9                                              20030 43170020
CMSTNEXT EQU   *                                                        43200018
         C     R7,XAP             HAS END OF BUFFER BEEN REACHED        43600018
         BE    CMTSKNME           END OF SCAN, CHECK NAME          O102 44000019
         CLI   D0(R7),BLANK       CHARACTER  A BLANK                    44400018
         BE    CMTSKNME           END OF SCAN, CHECK NAME          O102 44800019
         CLI   D0(R7),COMMA                                             45200018
         BE    PERAMS             *CONTINUE SCAN               *   O102 45700019
         OI    XAE,UNCK           SET UNCHECKED PARM BIT          M0232 46200020
         LA    R7,1(R7)           INCREMENT  PTR                        46800018
         BCT   R4,CMSTNEXT        *CONTINUE SCAN               *   O102 47200019
         B     CMERR8A                                             O102 47600019
CMTSKNME  EQU  *                                                        48000018
         OI    XAE,EOS            END OF SCAN INDICATOR          Y02669 48060002
PERAMS   EQU   *                                                   O102 48120019
         CLI   XAX,BLANK         *JOBNAME GOTTEN YET?     *        O102 48180019
         BNE   JOBCK                                               O102 48240019
         LA    R3,D8              * MAX NAME LENGTH       *        O102 48300019
         SR    R3,R4                                               O102 48360019
         BM    CMERR8             TERM LENGTH ERROR                O102 48420019
         EX    R3,CMMVCX          MOVE TASKNAME TO XAX             O102 48480019
         MVC   XAV(D8),XAX         NAME FOR CANCEL AND MSG         O102 48540019
         NI    XAE,FOX-UNCK       TURN OFF UNCHECKED PARM BIT     M0232 48600020
JOBCK    EQU   *                                                   O102 48660019
         TM    XAE,EOS                 IS THIS END OF SCAN?      Y02669 48720002
         BNO   NXPARM                  NO, CHECK NEXT FIELD        O102 48780019
         TM    XAE,UNCK           YES; UNCHECKED PARM BIT ON?     M0232 48840020
         BO    INVAL                   YES, COMMAND INVALID        O102 48900019
         B     ENDCK                   NO, SEARCH CSCB'S           O102 48960019
NXPARM   EQU   *                                                   O102 49020019
         NI    XAE,FOX-UNCK       TURN OFF UNCHECKED PARM BIT     M0232 49080020
         LA    R4,FIVE                                             O102 49140019
         CLI   XAN,FORCE          WAS THIS A FORCE COMMAND?    @G17FPSS 49190041
         BE    INVAL              YES. NO ACCEPTABLE KEYWORDS  @G17FPSS 49240041
         CLC   D1(D4,R7),PDUMP                                     O102 49680019
         BE    DUMP               *IF NO HITS,GIVE ERROR MSG-*     O102 49740019
         B     INVAL              *NO OTHER ACCEPTABLE KEYWORDS*   O102 49800019
DUMP     EQU   *                                                   O102 51840019
         OI    XAE,DUMPSW         *  SET DUMP SWITCH           * Y02669 52080002
         LA    R7,D5(R7)          * UPDATE PARM POINTER            O102 52140019
         B     CMSTNEXT           *AND BRANCH TO CONTINUE SCAN *   O102 52200019
ENDCK    EQU   *                                                   O102 52260019
         EJECT                                                          52310002
*                                                                  I272 52840019
* CSCB SCAN ROUTINE COMPARES FIRST ON CHKEY FOR TASKNAME EQUAL     I272 52880019
* TO TASKNAME IN XSA.  IF NO MATCH, A CHECK IS MADE ON 3-BYTE      I272 52920019
* UNIT NAME FIELD. IF NO MATCH IN CSCB CHAIN, BRANCH TO          Y02669 52960002
* IEE0503D, MESSAGE MODULE.                                      Y02669 52970002
        SPACE                                                           53010002
* THE CSCB CHAIN RESOURCE IS SERIALIZED VIA ENQ ON Q10. THE      Y02651 53050002
* RESOURCE IS RELEASED AT CMBRCH.  THE HOLDER OF THE CSCB ENQ    Y02651 53060002
* MUST BE NON-SWAPPABLE TO PREVENT SWAP OUT WHILE HOLDING THE    Y02651 53080002
* RESOURCE, WITH THE PERFORMANCE DEGRADATION WHICH WOULD RESULT  Y02651 53082002
* WHEN ANOTHER ENQ IS ISSUED TO OBTAIN THE RESOURCE.             Y02651 53084002
         SPACE                                                          53086002
         SYSEVENT DONTSWAP         DON'T SWAP CURRENT MEMORY     Y02651 53088002
         SPACE                                                          53090002
         MVC   XASAVSTD(LNE),ENQCSCB MOVE ENQ PARM LIST TO XSA   Y02651 53100002
         ENQ   MF=(E,XASAVSTD)     ENQ ON CSCB CHAIN RESOURCE    Y02651 53110002
CMSCAN   EQU   *                                                   I272 53120019
         LTR   R11,R11             END OF CHAIN                    I272 53160019
         BZ    CMBRCH              YES. GO SET UP NOT FOUND MSG  Y02669 53200002
         TM    CHSTS,CHAP          ASSIGNMENT PENDING              I272 53240019
         BNZ   CMNOGO              GO GET NEXT CSCB                I272 53280019
         CLC   CHKEY,XAX           DO IDS MATCH                    I272 53320019
         BE    FOUND               YES                             I272 53360019
         CLC   CHUNIT(D3),XAX      DO UNIT NAMES MATCH             I272 53400019
         BNE   CMNOGO              NO. GO GET NEXT CSCB            I272 53440019
FOUND    EQU   *                                                   I272 53480019
         TM    CHACT,CHCL         IS JOB CANCELLABLE                    53600018
         BZ    CMNOCAN            NO. SCAN REMAINIMG CSCB'S    @G17FPSS 53620041
*                                                                 20030 54002020
* THIS CHECK IS TO ASSURE THAT WHEN A FOREGROUND JOBNAME IS       20030 54004020
*        SPECIFIED TO BE CANCELLED, A BACKGROUND JOB OF THE SAME  20030 54006020
*        NAME WILL NOT ACCIDENTLY BE CANCELLED AND VICA VERSA.    20030 54008020
*                                                                 20030 54010020
         L     R5,XAL             PTR TO COMMAND PARM LIST        20030 54014020
         LA    R5,D0(R5)          CLEAR HIGH ORDER BYTE           20030 54016020
         CLR   R5,R9              WAS FORE OR BACKGROUND SPECIFIED20030 54018020
         BNE   CHPOST             FOREGROUND. BRANCH TO CHECK CSCBM6205 54020020
* BACKGROUND SPECIFIED, CHECK CSCB FOUND                          20030 54022020
         TM    CHTRKID,CHJOBID    IS THIS A BACKGROUND JOB CSCB  Y02669 54024002
         BNO   CMNOGO             NO. BRANCH TO SCAN THE NEXT    Y02669 54026002
*                                 CSCB                           Y02669 54028002
         B     CANJOB             BYPASS FOREGROUND TEST         Y02669 54036002
CMNOCAN  EQU   *                  JOB WAS NON-CANCELABLE       @G17FPSS 54037041
         OI    XAE,NONCANSW       SET NON-CANCELABLE SWITCH    @G17FPSS 54037641
         B     CMNOGO                                                   54039041
CHPOST   EQU   *                                                  20030 54040020
         TM    CHTRKID,CHTSID     VERIFY FOREGROUND CSCB         Y02669 54042002
         BO    CANJOB             YES, CANCEL IT.                Y02669 54044002
CMNOGO   EQU   *                                                 Y02669 54047002
         L     R11,CHPTR          NEXT CSCB                      Y02669 54050002
         B     CMSCAN             GO TEST CSCB                   Y02669 54053002
CANJOB   EQU   *                                                   O102 54350019
         CLI   XAN,FORCE          THIS A FORCE CMD ?           @G17FPSS 54350241
         BE    FORCEMEM           YES, GO FORCE THE ADDR SPACE @G17FPSS 54350341
         MVC   CHUCMP,XAU          UPDATE UCMI IN CSCB             I272 54350602
         OI    CHACT,CHCLD        POSITION POST CODE                    57200018
         TM    CHCECB,CMCOMP       COMPLETION CODE SET             I272 57600019
         BZ    POST                NO                              I272 57800019
         XC    CHCECB,CHCECB       YES. CLEAR ECB                  I272 58000019
*                                                                       58000402
* LOCATE THE ASCB FOR SIC AND XMPOST                             Y02657 58002002
*                                                                       58010002
* THE ADDRESS OF THE ASCB ASSOCIATED WITH THE ASID IN CHASID     Y02657 58050002
* IS CALCULATED FOR USING THIS FORMULA:                          Y02657 58100002
*   ASCBPTR = ((CHASID*4) + ADDR(ASVTENTY) - 4),                 Y02657 58150002
* WHERE ASVTENTY IS THE FIRST ASCB POINTER IN THE ASVT AND       Y02657 58160002
* ASCBPTR IS THE ASVT FIELD CONTAINING THE ADDRESS OF THE ASCB.  Y02657 58170002
*                                                                       58192002
POST     EQU   *                                                   I272 58192402
         L     R5,CVTASVT          ASVT...                       Y02657 58194002
         USING ASVT,R5             ...ADDRESSABILITY             Y02657 58196002
         LA    R5,ASVTENTY         ADDRESS FIRST ASVT ENTRY      Y02657 58198002
         DROP  R5                  DROP ASCB ADDRESSABILITY      Y02657 58198402
         S     R5,FOUR             DECREMENT TO FIRST SLOT       Y02657 58198802
         SR    R6,R6               ZERO ASID REG FOR INSERT      Y02657 58199202
         ICM   R6,BOTHALF,CHASID   ASID FROM CSCB                Y02657 58199602
         SLL   R6,D2               QUADRUPLE IT FOR OFFSET       Y02657 58199702
         AR    R5,R6               ADDRESS ASVT ENTRY FOR ASID   Y02657 58199802
         L     R6,D0(R5)           LOAD IT FOR SIC AND XMPOST    Y02657 58199902
*                                                                       58209902
* PLACE COMPLETION CODE IN REGISTER ZERO FOR CROSS MEMORY POST. Y02657  58219902
* THE POST IS DONE IN SIC FOR CANCELLATION OF FOREGROUND JOBS,  Y02657  58229902
* AND IN THIS MODULE FOR CANCELLATION OF BACKGROUND JOBS.       Y02657  58239902
*                                                                       58241902
         L     R0,CNODUMP          CANCEL JOB WITHOUT DUMP       Y02657 58243902
         TM    XAE,DUMPSW          DUMP SWITCH ON                Y02657 58249902
         BZ    CNCJBN              * NO,                       * Y02657 58299902
         L     R0,CDUMP            CANCEL JOB WITH DUMP          Y02657 58349902
         EJECT                                                          58380602
*        SCHEDULE SRB TO CANCELLED ADDRESS SPACE               @ZA05360 58381241
*                                                                Y02669 58383202
*        TO DO SO, A BRANCH ENTRY TO SYSTEM INITIATED CANCEL     Y02669 58391202
*        (SIC) WILL BE TAKEN, WITH THE LOCAL AND CMS LOCKS HELD. Y02669 58403202
*        THE LOCKS ARE FREED IMMEDIATELY UPON RETURN FROM SIC.   Y02669 58405202
*        THE REGISTERS ON ENTRY TO SIC:                          Y02669 58405602
*              REGISTER 0          COMPLETION CODE FOR POST      Y02669 58406002
*              REGISTER 1          TARGET MEMORY ASCB ADDR       Y02669 58406402
*              REGISTER 13         ADDRESS OF FULL SAVE AREA     Y02669 58406802
*              REGISTER 14         RETURN POINT IN IEE3703D      Y02669 58406902
*              REGISTER 15         SIC ENTRY POINT ADDRESS       Y02669 58407002
CNCJBN   EQU   *                                               @ZA05360 58417041
         SPACE                                                          58428102
         STM   R11,R14,XASAVLOC    SAVE REGISTERS ACROSS LOCKS   Y02651 58438102
SETLOCK1 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02651X58448102
               RELATED=(SIC,IEE3703D(CLRLOCK1))                  Y02651 58448502
SETLOCK2 SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02651X58448902
               RELATED=(SIC,IEE3703D(CLRLOCK2))                  Y02651 58449302
         LR    R1,R6               GET ADDRESS OF ASCB           Y02669 58456502
         LA    R13,XASAVSTD        GET ADDRESS OF SAVE AREA      Y02669 58460502
         L     R15,CVTSIC          GET ADDR OF SIC ENTRY POINT   Y02669 58462502
         BALR  R14,R15             BRANCH TO SIC                 Y02669 58462902
CLRLOCK2 SETLOCK RELEASE,TYPE=CMS,                               Y02651X58463302
               RELATED=(SIC,IEE3703D(GETLOCK2))                  Y02651 58463402
CLRLOCK1 SETLOCK RELEASE,TYPE=LOCAL,                             Y02651X58463502
               RELATED=(SIC,IEE3703D(GETLOCK1))                  Y02651 58470602
         LM    R11,R14,XASAVLOC    RESTORE REGS SAVED ACR0SS     Y02651 58472702
*                                  LOCKS                         Y02651 58474702
         TM    CHTRKID,CHTSID    IS THIS A FOREGROUND JOB CSCB @ZA05360 58474841
         BO    CMCCA            YES, GO SET UP FOR MSG IEE301I @ZA05360 58475041
         EJECT                                                          58476241
*                                                                       58476702
* POST THE CANCEL ECB IN THE CSCB                                Y02669 58477702
*                                                                       58478102
DOPOST   EQU   *                                                  M6205 58491920
*                                  MOVE POST PARM LIST TO XSA    Y02657 58572302
         MVC   XASAVLOC(POSTLEN),POSTER                          Y02657 58573902
*                                                                       59095302
* XMPOST CANCEL ECB                                              Y02657 59095702
*                                                                       59096102
         POST  CHCECB,(0),ASCB=(R6),ERRET=CVTBRET,               Y02657X59096902
               MF=(E,XASAVLOC)     XMPOST CANCEL ECB             Y02657 59097302
CMCCA    EQU   *                                                 Y02669 59099302
         SYSEVENT  BRINGIN,ASIDL=CHASID   INFORM SRM THAT      @YM6770P 59099402
*                                  ADDRESS SPACE IS TO BE      @YM6770P 59099602
*                                  SWAPPED IN FOR CANCELLATION @YM6770P 59099802
         OI    CHACT,CHAFORCE  MARK JOB AS CANCEL ISSUED FOR IT@G17FPSS 59099941
         MVI   XAE,CMCD01          CANCEL COMMAND ACCEPTED         I272 59100002
         B     CMBRCH              GO FREE RESOURCES           @G17FPSS 59120041
         EJECT                                                          59150002
*********************************************************************** 59151041
*                                                                     * 59152041
*            FORCE COMMAND PROCESSING                                 * 59153041
*                                                                     * 59154041
*********************************************************************** 59155041
*********************************************************************** 59155141
*                                                                     * 59155241
*        CALL RTM TO FORCE THE ADDRESS SPACE TO TERMINATE             * 59155341
*                                                                     * 59155441
*********************************************************************** 59155541
         SPACE 2                                                        59156041
FORCEMEM EQU    *                                              @G17FPSS 59157041
         TM     CHACT,CHAFORCE   WAS A CANCEL ISSUED FOR THIS           59157441
*                                ASID?                         @G17FPSS 59157941
         BO     CALLRTM          YES, GO FORCE ASID            @G17FPSS 59158441
         MVI    XAE,CMCD27       CODE FOR ISSUE CANCEL FOR JOB @G17FPSS 59158541
         B      CMBRCH           GO RELEASE REASOURCES         @G17FPSS 59158641
         SPACE                                                          59159541
CALLRTM  EQU    *                                                       59159741
         SR     R6,R6            ZERO ASID REG FOR INSERT      @G17FPSS 59160041
         ICM    R6,BOTHALF,CHASID GET ASID FROM CSCB           @G17FPSS 59160841
         STM    R11,R14,XASAVLOC SAVE REGS ACROSS CALLRTM      @G17FPSS 59161641
         LA     R13,XASAVSTD     CALLRTM NEEDS A WORK AREA     @G17FPSS 59162041
         LR     R5,R2            SAVE ADDR OF XSA              @G17FPSS 59163241
         SPACE                                                          59164141
         CALLRTM TYPE=MEMTERM,COMPCOD=A22,ASID=(R6)   CANCEL THE       X59165041
                                 ADDRESS SPACE                 @G17FPSS 59165441
         SPACE                                                          59165941
         LR     R2,R5            RESTORE XSA ADDR              @G17FPSS 59166441
         LM     R11,R14,XASAVLOC RESTORE THE REGS              @G17FPSS 59167441
         MVI    XAE,CMCD02       CODE FOR FORCE CMD ACCEPTED   @G17FPSS 59168441
         EJECT                                                          59175041
*  THE CSCB CHAIN RESOURCE (Q10) IS RELEASED HERE. IT WAS        Y02651 59200002
*  OBTAINED AT ENDCK. SWAPPING IS THEN AGAIN MADE POSSIBLE.      Y02651 59250002
CMBRCH   EQU    *                                                Y02669 69600002
         MVC   XASAVSTD(LND),DEQCSCB MOVE DEQ PARM LIST TO XSA   Y02651 69610002
         DEQ   MF=(E,XASAVSTD)     DEQ OFF CSCB CHAIN RESOURCE   Y02651 69650002
         SPACE                                                          69700002
         SYSEVENT OKSWAP          ALLOW SWAP FOR THIS MEMORY     Y02651 69750002
         SPACE                                                          69800002
         LTR   R11,R11            END OF CSCB CHAIN                I272 70400002
         BC    7,CMBRCH5                                                70800002
         L     R5,XAL             PTR TO COMMAND PARM LIST        20030 70840020
         LA    R5,D0(R5)          CLEAR HIGH ORDER BYTE           20030 70880020
         CLR   R5,R9              WAS A BACKGROUND JOB SPECIFIED  20030 70920020
         BNE   NOTFORE            NO, GO ISSUE NOT LOGGED ON MSG Y02669 70960002
NOTBACK  EQU   *                                                 Y02669 70963002
         TM    XAE,NONCANSW       WAS JOB NONCANCELABLE?       @G17FPSS 70963641
         BO    NONCAN             YES, GO USE NON-CAN MSG      @G17FPSS 70963941
         MVI   XAE,CMCD36         MSG CODE - NOT ACTIVE        @G17FPSS 70964241
         B     CMBRCH5            GO TO IEE0503D               @G17FPSS 70964541
NONCAN   EQU   *                  JOB NON-CANCELABLE           @G17FPSS 70964841
         MVI   XAE,CMCD28         MSG CODE - NON-CANCELABLE    @G17FPSS 70965141
         CLI   XAN,FORCE          WAS THIS A FORCE CMD?        @G17FPSS 70965241
         BNE   CMBRCH5            NO, GO TO IEE0503D           @G17FPSS 70965341
         MVI   XAE,CMCD22         MSG CODE NON-FORCIBLE        @G17FPSS 70965441
         B     CMBRCH5            GO TO IEE0503D               @G17FPSS 70965641
NOTFORE  EQU   *                   USER NOT LOGGED ON            Y02669 70966002
         MVI   XAE,CMCD53         MSG CODE- NOT LOGGED ON        Y02669 71000002
         B     CMBRCH5            GO BRANCH TO IEE0503D          Y02669 71080002
CMERRC   EQU   *                                                   O102 74060019
         MVI   XAE,CMCD0B         PARAMETER MISSING CODE         Y02669 74120002
         B     CMBRCH5F           GO OVERLAY XAV WITH COMMAND  @G17FPSS 74230041
*                                 VERB AND BRANCH TO IEE0503D    Y02669 74232002
AUTHERR  EQU   *                  THE AUTH OF ISSUING CONSOLE WAS      *74233041
                                  INVALID                      @ZD00106 74233541
         MVI   XAE,CMCD41         AUTH INVALID CODE            @ZD00106 74234041
         B     CMBRCH5F           GO OVERLAY XAV WITH COMMAND VERB     *74236041
                                  AND BRANCH TO IEE0503D       @ZD00106 74236541
CMERR8A  EQU   *                                                   O102 74240019
CMERR8   EQU    *                                                       74400018
         MVI   XAE,CMCD08         TERM LENGTH ERROR                     74800018
         B     CMBRCH5F           GO OVERLAY JOBNAME W/ CMD    @G17FPSS 74870041
*                                 VERB AND BRANCH TO IEE0503D    Y02669 74930002
INVAL    MVI   XAE,CMCD05     * CODE FOR 'COMMAND INVALID'     * Y02669 75410002
         SPACE 2                                                        75430002
**************************************************************** Y02669 75440002
*                                                              * Y02669 75450002
*       EXIT CODE FOR BRANCH TO:                               * Y02669 75452002
*                                                              * Y02669 75454002
*              MESSAGE MODULE         IEE0503D                 * Y02669 75454102
*                                                              * Y02669 75454802
**************************************************************** Y02669 75456002
CMBRCH5F EQU   *                                               @G17FPSS 75456341
         MVC   XAV(D8),CANC       MOVE CANCEL VERB TO MESSAGE  @G17FPSS 75456641
         CLI   XAN,FORCE          THIS A FORCE CMD ?           @G17FPSS 75456941
         BNE   CMBRCH5            NO                           @G17FPSS 75457241
         MVC   XAV(D8),FORCNAM    YES, MOVE FORCE INTO MSG     @G17FPSS 75457541
CMBRCH5  EQU   *                                                 Y02669 75458802
         L     R11,VCON05         GET ADDRESS OF IEE0503D        Y02669 75459202
         BR    R11                GO BRANCH TO MESSAGE MODULE    Y02669 75459302
         EJECT                                                          75709602
*********************************************************************** 78000018
*                                                                     * 78400018
*                       DEFINED CONSTANTS                             * 78800018
*                                                                     * 79200018
*********************************************************************** 79600018
         DS    0F                                                       80000018
VCON05   DC    V(IEE0503D)        ADDRESS OF MESSAGE MODULE      Y02669 80050002
CDUMP    DC    X'00000122'        CANCEL WITH A DUMP             Y02669 80500002
CNODUMP  DC    X'00000222'        CANCEL WITHOUT A DUMP          Y02669 80600002
FOUR     DC    F'4'               CONSTANT FOR ASID CONVERSION   Y02657 80750002
CANC     DC    C'CANCEL  '        CANCEL COMMAND                   O102 80900002
FORCNAM  DC    C'FORCE   '        FORCE COMMAND                @G17FPSS 80901041
PDUMP    DC    C'DUMP'            DUMP COMPARAND                   O102 80903002
UEQUAL   DC    C'U='              TS USER INDICATOR              Y02669 80953002
CMMVCX   MVC   XAX(1),0(R9)                                             81600018
         SPACE                                                          81602002
POSTER   POST  MF=L                LIST FORM OF MACRO            Y02657 81603002
         SPACE                                                          81613002
POSTLEN  EQU   *-POSTER            LENGTH OF PARMLIST FOR MOVE   Y02657 81615002
         SPACE                                                          81617002
* ENQ PARAMETER LIST FOR CSCB RESOURCE                           Y02651 81623002
ENQCSCB  ENQ   (IEECSCB,IEESQ10,S,3,SYSTEM),MF=L                 Y02651 81633002
LNE      EQU   *-ENQCSCB           LENGTH OF ENQ PARM LIST       Y02651 81633402
         SPACE                                                          81633802
* DEQ PARAMETER LIST FOR CSCB RESOURCE                           Y02651 81634202
DEQCSCB  DEQ   (IEECSCB,IEESQ10,3,SYSTEM),MF=L                   Y02651 81634602
LND      EQU   *-DEQCSCB           LENGTH OF DEQ PARM LIST       Y02651 81634702
         SPACE                                                          81634802
IEECSCB  DC    C'SYSIEFSD'         QNAME                         Y02651 81635002
IEESQ10  DC    C'Q10'              RNAME                         Y02651 81637002
         SPACE                                                          81687002
PATCH    DC    CL50'***   IEE3703D  PATCH AREA  ***'             Y02669 81737002
         TITLE 'IEE3703D--XSA MAP'                                      82206002
CMXSA    DSECT                                                          82400018
        IEEXSA                                                          82800018
         TITLE 'IEE3703D--CVT MAP'                                      83000019
CMCVT    DSECT                                                          83200018
         CVT   DSECT=NO                                          Y01012 83600001
         TITLE 'IEE3703D--MASTER RESIDENT CORE MAP'                     83800019
         IEEBASEA                                                       84000018
         TITLE 'IEE3703D--CSCB MAP'                                     84053002
CMCHAIN  DSECT                                                          84400018
         IEECHAIN                                                       84800018
         TITLE  'IEE3703D--PREFIX STORAGE AREA MAP'                     84900002
         IHAPSA                                                         84950002
         TITLE 'IEE3703D--ADDRESS SPACE VECTOR TABLE MAP'               85000002
         IHAASVT                                                 Y02657 85050002
         TITLE 'IEE3703D--UNIT CONTROL MODULE(UCM)'            @G17FPSS 85100041
         IEECUCM  FORMAT=NEW                                   @G17FPSS 85150041
         END                                                            86000018
