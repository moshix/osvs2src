 TITLE 'IEE4303D - VARY MASTER CONSOLE COMMAND PROCESSOR'               13960003
*********************************************************************** 13970002
*                                                                       14000002
* MODULE NAME      = IEE4303D                                           14050002
*   CSECT NAME     = IEE4303D                                           14100002
*   LOAD MODULE NAME                                                    14150002
*                  = IGC0003D                                           14200002
*                                                                       14250002
* DESCRIPTIVE NAME = VARY MASTER CONSOLE COMMAND PROCESSOR              14300002
*                                                                       14350002
* COPYRIGHT        = MISSING                                            14400002
*                                                                       14450002
* STATUS           = OS/VS/2 RELEASE 3                         @Z30LPTJ 14460003
*                                                                       14470002
* FUNCTION         = THIS MODULE PROCESSES THE COMMANDS :               14480002
*                    VARY UNIT,MSTCONS AND                              14490002
*                    VARY (I-XXX,O-XXX),MSTCONS                         14492002
*                    FOR THE CONSOLE SWITCH ROUTINE IGCXLO7B            14494002
*                                                                       14496002
* OPERATION        = THIS MODULE RECEIVES CONTROL FROM THE INITIAL      14498002
*                    KEYWORD SCAN MODULE - IEE3203D.                    14498402
*                    THE UNIT CONTROL MODULE ENTRY (UCME) OF THE        14498802
*                    NAMED UNIT IS CHECKED TO ASSURE THAT THE UNIT      14499202
*                    IS A CONSOLE CAPABLE OF INPUT AND OUTPUT.          14499602
*                    IF THE COMMAND NAMES A COMPOSITE CONSOLE,          14499702
*                    INDICATED BY (I-XXX,O-XXX), THE UNITS ARE          14499802
*                    CHECKED TO ASSURE THEY ARE ACTIVE AND THAT         14499902
*                    THEY WERE SYSGENED AS A COMPOSITE CONSOLE.         14549902
*                    IF THE UNIT NAMED DOES NOT MEET THESE              14559902
*                    REQUIREMENTS THE COMMAND IS REJECTED.              14569902
*                    IF THE CONSOLE IS ACTIVE PENDING TO BE CHANGED     14579902
*                    TO AN ACTIVE STATE, THE COMMAND IS ALSO REJECTED.  14589902
*                    HOWEVER, IF THE CONSOLE IS NON-ACTIVE BUT THE      14591902
*                    UCME SHOWS A STATUS WHERE IT IS PENDING TO BE      14593902
*                    CHANGED TO THE CONSOLE STATE, THE OPERATOR IS      14595902
*                    INFORMED VIA A 'DEVICE CHANGING STATUS' MSG.       14597902
*                    PUT OUT BY IEE2103D.  THE COMMAND, THEN IS         14598302
*                    REJECTED AT THIS TIME.                             14598702
*                    THE AUTHORITY OF THE ISSUING CONSOLE IS            14599102
*                    CHECKED.  THE COMMAND IS PROCESSED IF IT IS        14599502
*                    ISSUED BY THE EXISTING MASTER CONSOLE OF THE       14599602
*                    SYSTEM.  IF THE MASTER CONSOLE ALTERNATE CHAIN     14599702
*                    IS EXHAUSTED, THE COMMAND IS ACCEPTED FROM         14599802
*                    ANY CONSOLE.                                       14649802
*                    THE MODULE THEN PASSES TO THE CONSOLE SWITCH       14659802
*                    ROUTINE A FLAG INDICATING THE CAUSE OF THE         14669802
*                    SWITCH, THE ADDRESS OF THE NEW MASTER CONSOLE      14679802
*                    UCME AND THE ADDRESS OF THE OLD MASTER             14689802
*                    CONSOLE UCME OR ZEROES IF THE COMMAND WAS          14691802
*                    ISSUED BY ANY OTHER MEANS THAT THE OLD MASTER.     14693802
*                                                                       14695802
* NOTES                                                                 14697802
*   DEPENDENCIES   = NONE                                               14698202
*   CHARACTER/CODE DEPENDENCIES                                         14698602
*                  = THIS MODULE CAN BE ASSEMBLED WITH ANY NEW          14699002
*                    CHARACTER/CODE SET.                                14699402
*                                                                       14699502
* RESTRICTIONS     = REG2 PTS TO THE XSA ON INPUT                       14699602
*   REGISTER CONVENTIONS                                                14699702
*                  = REGS ARE DEFINED AT LABEL: DEFREG                  14749702
*   PATCH LABEL    = PATCH                                              14759702
*                                                                       14769702
* MODULE TYPE      = CSECT                                              14779702
*   PROCESSOR      = ASSEMBLER                                          14789702
*   MODULE SIZE    = VS/2 = '296'                              @Z30LPTJ 14791703
*   ATTRIBUTES     = REENTRANT, REUSABLE, REFRESHABLE, PAGED LPA,       14793702
*                    ZERO PSW PROTECT KEY, SUPERVISOR MODE              14795702
*                                                                       14797702
* ENTRY POINT      = IEE4303D FROM IEE3203D                             14798102
*   PURPOSE        = TO PROCESS THE V MSTCONS COMMAND                   14798502
*   LINKAGE        = BRANCH                                             14798902
*   INPUT          = THE VARY SCAN AND ROUTER MODULE PASSES A PTR       14799302
*                    TO THE XSA IN REG2.                                14799402
*                    THE XSA CONTAINS A POINTER TO THE COMMAND          14799502
*                    OPERAND FIELD AND ALSO CONTAINS THE COMMAND        14799602
*                    VERB (V OR VARY).                                  14849602
*                    THE CVT POINTER IS LOCATED AT ADDRESS 16,          14859602
*                    THE CVT IS USED TO LOCATE THE UCM AND THE UCME'S   14869602
*                    EACH UCME CONTAINS A POINTER TO ITS UCB.           14879602
*   REGISTERS SAVED  = NONE                                             14889602
*    REGISTER USAGE= R2 PTR TO XSA                                      14891602
*                    R3 UCM PTR                                         14893602
*                    R5 CUME PTR                                        14894002
*                    R9 UNIT PTR                                        14894402
*                    R10 UCB PTR                                        14894802
*                    R13 ADDRESSABILITY                                 14895202
*                    R14 RETURN ADDRESS                                 14895302
*   REGISTERS RESTORED                                                  14895402
*                  = NONE                                               14895502
*                                                                       14945502
* EXIT - NORMAL    = RETURN                                             14955502
*   CONDITIONS     = WHEN THE COMMAND HAS BEEN EXECUTED                 14965502
*   OUTPUT         = A NEW CONSOLE IS THE MASTER CONSOLE                14975502
*   RETURN CODE    = NONE                                               14985502
*                                                                       14987502
* EXIT - ERROR     = IEE2103D OR IEE0503D VIA BRANCH                    14989502
*   CONDITIONS     = ERROR HAS BEEN DETECTED  IN THE V COMMAND          14991502
*   OUTPUT         = REG2 PTS TO THE XSA                                14993502
*                    XAE HAS APPROPRIATE MSG CODE                       14993902
*   RETURN CODES   = NONE                                               14994302
*                                                                       14994702
* EXTERNAL REFERENCES                                                   14995102
*   ROUTINES       = IEE2103D                                           14995202
*                    IEE0503D                                           14995302
*                    COMM. TASK                                         14995402
*   DATA AREAS     = FOR EXIT TO 0503D OR 2103D - SEE OUTPUT-DATA       15012102
*                    FOR COMM. TASK =                                   15022102
*                    IF THE COMMAND IS PROCESSED, THE CONSOLE SWITCH    15024102
*                    ROUTINE IS PASSED THE ADDRESS OF THE XSA           15026102
*                    IN REG1.  THE XSA CONTAINS:                        15028102
*                       PTR TO MODULE NAME                              15028502
*                       UNUSED                                          15028602
*                       NAME OF ROUTINE (IGCXLO7B)                      15028702
*                       X'00' CONSOLE SWITCH TO BE PERFORMED            15034302
*                       X'04' RESULT OF EXTERNAL INTERRUPT              15036302
*                       X'08' RESULT OF VARY MSTCONS COMMAND            15038302
*                       PTR TO NEW MASTER UCME                          15038702
*                       PTR TO COMMAND ISSUER'S UCME                    15039102
*                                                                       15039502
* CONTROL BLOCKS   = 1. EXTENDED SAVE AREA                              15039602
*                    2. UNIT CONTROL MODULE (UCM)                       15039702
*                       FIELDS TESTED  - UCMDISP - BIT=UCMDISPA         15039802
*                                        UCMCOMPC                       15054802
*                                        UCMATR - BIT=UCMOF             15064802
*                                                     UCMIF             15066802
*                                                     UCMUF             15068802
*                                        UCMMODE - BIT=UCMAMFA          15069202
*                                        UCMUCB                         15069602
*                                        UCMVEA                         15069702
*                       FIELDS UPDATED - NONE                           15069802
*                    3. UNIT CONTROL BLOCK (UCB)                        15069902
*                       FIELDS TESTED  - UCBNAME                        15074902
*                                        SRTESTAT- BIT=SRTEDADI         15076902
*                       FIELDS UPDATED - NONE                           15078902
*                    4. CVT                                             15079302
*                       FIELDS TESTED  - CVTCUCB                        15079702
*                       FIELDS UPDATED - NONE                           15079802
*                                                                       15079902
* TABLES           = NONE                                               15084902
*                                                                       15086902
* MACROS           = SVC 72,SETLOCK                                     15088902
*                                                                       15089302
* MAPPING MACROS   = IEEXSA                                             15089702
*                    IEECUCM                                            15089802
*                    IEFUCBOB                                           15089902
*                    CVT                                                15139902
*                    IHAPSA                                             15141902
*   SERIALIZATION  = TESTED FIELDS IN THE UCB AND THE UCM WILL BE       15149902
*                    PROTECTED BY THE CMS AND LOCAL LOCKS               15151902
*                    AGAINST COMM TASK AND ANOTHER VARY COMMAND         15152302
*                    LOCKS ARE GOTTEN AT:                               15153902
*                         MSETLCK                                       15155902
*                    LOCKS ARE RELEASED AT:                             15157902
*                         MUNSTLK                                       15158302
*                    FIELDS PROTECTED ARE:                              15158702
*                         UCMMODE - BIT = UCMAMFA  -UCM                 15159102
*                         UCMATR  - BIT = UCMUF    -UCM                 15159502
*                         UCMDISP - BIT = UCMDISPA -UCM                 15161102
*                                                                       15164902
*                         SRTESTAT- BIT = SRTEDADI -UCB                 15166502
*                                                                       15184102
* CHANGE LEVEL     = Y02669, Y02651, Z30LPTJ                   @Z30LPTJ 15185703
*                                                                       15187302
* CHANGE ACTIVITY  = N/A                                                15188902
*                                                                       15190502
* MESSAGES         = TO IEE0503D FOR ERROR MESSAGES:                    15192102
*                       IEE307I VARY DELIMITER ERROR                    15193702
*                       (ISSUED WHEN THE SYNTAX OF THE UNIT FIELD       15195302
*                       IS NOT CORRECT)                                 15196902
*                       IEE313I XXX UNIT REF INVALID                    15198502
*                       (ISSUED WHEN UNIT CANNOT BECOME THE             15200102
*                       MASTER CONSOLE)                                 15201702
*                    TO IEE2103D FOR ERROR MESSAGES:                    15203302
*                       IEE345I VARY AUTHORITY INVALID                  15204902
*                       (ISSUED WHEN THE COMMANDS SOURCE CONSOLE        15206502
*                       DOES NOT HAVE THE COMMAND AUTHORITY TO          15216502
*                       VARY A MASTER CONSOLE.)                         15218502
*                                                                       15220502
* ABEND CODES      = NONE                                               15222502
*                                                                       15222902
* PACKAGING        = IEE4303D WILL BE PART OF LOAD MODULE               15223002
*                    = IGC0003D                                         15223102
*                    THIS LOAD MODULE ALIASES ARE                       15228702
*                    = NONE                                             15230702
*                    THIS LOAD MODULE ENTRY POINTS ARE                  15232702
*                    = IGC0003D                                         15233102
*                      MODULE WILL RESIDE IN : LPALIB                   15233202
*                                                                       15233502
* SYSGEN           = SUPPLIED BY SECTIONS:                              15233902
*                       LOAD MODULE NAME                                15234002
*                       PACKAGING                                       15234102
*                       THIS CSECT WILL BE INCLUDED AT SYSGEN FROM      15238702
*                       DLIB -AOSB3- BY MACRO -SGIEF441-                15240702
*                                                                       15243502
* SYSTEM LIBRARIES = NONE                                               15248102
*                                                                       15258102
*********************************************************************** 15260102
         EJECT                                                          15260202
*********************************************************************** 15260502
*  COMMAND TO BE PROCESSED IS:                                          15261902
*                                                                       15265902
*    ***           ***                                                  15267902
*    *               *                                                  15269902
*    * XXX           *                                                  15270302
*  V *               *,MSTCONS                                          15270702
*    * (I-XXX,O-XXX) *                                                  15271102
*    *               *                                                  15271602
*    ***           ***                                                  15272902
*********************************************************************** 15273402
         EJECT                                                          15275202
IEE4303D CSECT                                                          15279202
DEFREG   EQU   *                                                 Y02669 15283202
*                                                                       15287202
R0       EQU   0                                                        15291202
R1       EQU   1                                                        15295202
MXSABASE EQU   2         XSA PTR                                        15299202
R2       EQU   2                                                        15303202
UCMBASE  EQU   3         UCM PTR                                 Y02669 15307202
R4       EQU   4                                                 Y02669 15311202
R5       EQU   5       UCME PTR                                  Y02669 15315202
R6       EQU   6                                                        15319202
R7       EQU   7                                                        15323202
R8       EQU   8                                                        15327202
R9       EQU   9       UNIT PTR                                         15331202
R10      EQU   10      UCB PTR                                          15335202
R11      EQU   11                                                       15345202
R12      EQU   12                                                       15355202
MBASE    EQU   13      ADDRESSABILITY                            Y02669 15365202
MRETURN  EQU   14      RETURN ADDRESS                            Y02669 15375202
R14      EQU   14                                                Y02651 15375602
R15      EQU   15                                                       15377202
*                                                                       15379202
*                                                                       15381202
*  TESTING AND BIT SETTING MASKS                                        15383202
*                                                                       15383602
MRI      EQU   X'80'                   READER/INTERPRETER ID            15385202
MSYS     EQU   0                       SYSTEM ID                        15435202
VARMST   EQU   X'08'                                                    15485202
CD44     EQU   44                                                 19084 17900019
*                                                                       18300019
* ERROR MESSAGE CODES                                                   18700019
*                                                                       19100019
ER1      EQU   41                      AUTHORITY INVALID                19500019
ER2      EQU   7                       DELIMITER ERROR                  19900019
ER3      EQU   13                      UNIT REF INVALID                 20300019
*                                                                       21100019
ZERO     EQU   0                                                        21500019
ONE      EQU   1                                                        21900019
TWO      EQU   2                                                        22300019
TRE      EQU   3                                                        22700019
FOR      EQU   4                                                        23100019
SIX      EQU   6                                                        23500019
EIT      EQU   8                                                        23900019
ELEV     EQU   11                                                       24700019
TWLV     EQU   12                                                       25100019
EITN     EQU   18                                                 M0676 25150001
LPAREN   EQU   C'('                                                     25900019
COMMA    EQU   C','                                                     26700019
BLANK    EQU   C' '                                                     27100019
SVCSVN2  EQU   72                                                       27500019
         EJECT                                                          27550002
*********************************************************************** 27900019
*                                                                       28300019
*        START OF THE ROUTINE                                           28350002
*                                                                       28700019
*********************************************************************** 29100019
         BALR  MBASE,ZERO                 ESTABLISH PROGRAM ADDRESS     29500019
         USING *,MBASE                                                  29900019
         MODID BR=YES                                            Y01886 29950001
         USING XSA,MXSABASE            SAVE AREA ADDRESSIBILITY         30300019
         L     R5,CVTPTR               POINTER TO CVT USED              30700019
         USING USETCVT,R5              USE CVT TO PT.TO UCB INFO        31100019
         L     UCMBASE,CVTCUCB         ..                               31500019
         LR    R8,UCMBASE              SAVE UCM BASE ADDRESS   @YM02762 31700002
         DROP  R5                      CVT NO LONGER NEEDED             31900019
         USING UCM,UCMBASE             UCM ADDRESSIBILITY        Y02669 32300002
*********************************************************************** 32700019
*                                                                     * 33100019
* COMMAND AUTHORITY VERIFICATION                                      * 33500019
*                                                                     * 33900019
*********************************************************************** 34300019
           SPACE 10                                                     34350002
*****************************************************************Y02651 34360002
*                                                                Y02651 34362002
*  LOCKS ARE SET HERE USING SUBROUTINE:                          Y02651 34364002
*              MSETLCK                                           Y02651 34366002
*  LOCKS WILL BE RELEASED WHEN NO NEEDED AT:                     Y02651 34368002
*              MUNSTLK                                           Y02651 34368402
*                                                                Y02651 34368802
         BAL   R4,MSETLCK         GO GET LOCKS FOR UCB AND UCM   Y02651 34369202
*                                                                Y02651 34369602
*****************************************************************Y02651 34370002
           SPACE 10                                                     34400002
         L     R9,XAL              UNIT PTR                       19084 34700019
         LA    R9,ZERO(R9)                                        19084 35100019
         XC    XAL(FOR),XAL              ISSUING CONSOLE PTR IN PARM    35500019
         CLI   XAU,MSYS                IF ISSUING SYSTEM-OK             35900019
         BE    MPROCESS                GO PROCESS UNIT                  36300019
         CLI   XAU,MRI                 READER/INTERPRETER ONLY ALLOWED  36700019
         BE    MCHAIN                  IF CHAIN EXHAUSTED-GO CHECK      37100019
*                                                                       37500019
         SR    R11,R11                  IS COMMAND FROM MASTER CONSOLE  37900019
         IC    R11,XAU                 USE ALGORITHUM TO ACCESS UCME    38300019
         LM    R6,R7,UCMVEA            R6 PTS TO FIRST UCM ENTRY        38700019
*                                      R7 CONTAINS SIZE OF ENTRY        39100019
         BCTR  R11,ZERO                   REF. INTO UCME'S              39500019
         MR    R10,R7                  LENGTH 1 ENTRY                   39900019
         AR    R11,R6                  ADD ADDR OF 1ST ENTRY            40300019
         ST    R11,XAL                 SAVE ADR IN PARM LIST            40700019
         USING UCMLIST,R11             REFERENCE TO ISSUER'S UCME       41100019
         TM    UCMDISP,UCMDISPA        WAS ISSUER MASTER CONSOLE Y02669 41500002
         BO    MPROCESS                YES,PROCESS UNIT SPECIFIED       41900019
MCHAIN   EQU   *                                                        41950002
         TM    UCMMODE,UCMAMFA         IF CHAIN NOT EXHAUSTED    Y02669 42300002
         DROP  R11                                                      42700019
         BO    MPROCESS                PROCESS UNIT              Y02669 43100002
         SPACE 10                                                       43150002
*****************************************************************Y02651 43160002
*                                                                Y02651 43162002
*  RELEASE LOCKS HERE.                                           Y02651 43164002
*  EXIT BECAUSE OF ERRORS                                        Y02651 43166002
*                                                                Y02651 43168002
         BAL   R4,MUNSTLK         GO RELEASE THE LOCKS           Y02651 43168402
*                                                                Y02651 43168802
*****************************************************************Y02651 43170002
         SPACE 10                                                       43200002
         B     ERR1                                              Y02651 43250002
         EJECT                                                          43300002
*********************************************************************** 43500019
*                                                                     * 43900019
* UNIT SYNTAX AND VALIDITY CHECK                                      * 44300019
*                                                                     * 44700019
*********************************************************************** 45100019
MPROCESS EQU   *                                                        45500019
         XC    XAD(FOR),XAD        ASSUME NON-COMPOSITE UNIT            45900019
         CLI   ZERO(R9),LPAREN          IS COMPOSITE SPGCIFIED    19084 46300019
         BE    MRTPAR                  YES,GO PROCESS             19084 46700019
         CLI   TRE(R9),COMMA            IF NOT COMPOSITE, TEST FOR19084 47100019
         BNE   ERR2                    DELIMITER ERROR,IF NOT     19084 47500019
         BAL   R1,MCHECK               CHECK FOR VALID UNIT       19084 47900019
         USING UCMLIST,R5               VALID,HAS CORRECT SUPPORT 19084 48300019
         TM    UCMATR,UCMOF+UCMIF       HAS I/O SUPPORT          Y02669 48700002
         BO    MKEYCHK                 UNIT OK,CHECK KEYWORD      M4449 49100019
         SPACE 10                                                       49150002
*****************************************************************Y02651 49200002
*                                                                Y02651 49210002
*  ERROR CONDITION, RELEASE LOCKS FIRST AND THEN ISSUE ERROR MSG Y02651 49220002
*  LOCKS WILL BE RELEASED AT: MUNSTLK                            Y02651 49230002
*  LOCKS WERE SET AT:                                            Y02651 49240002
*              MSETLCK                                           Y02651 49242002
*                                                                Y02651 49244002
         LA    R4,ERR3            ERROR MSG ROUTINE AFTER RELEASEY02651 49246002
         B     MUNSTLK            GO RELEASE ALL LOCKS           Y02651 49248002
*                                                                Y02651 49248402
*****************************************************************Y02651 49250002
         EJECT                                                          49300002
*                                                                 19084 49900019
* COMPOSITE UNIT VERIFICATION CHECK                               19084 50300019
*                                                                 19084 50700019
MRTPAR   EQU   *                                                  19084 51100019
         OI    XADUSWIT,XAIOCOMP        UNIT IS COMPOSITE      @Z30LPTJ 51500003
         CLC   ONE(TWO,R9),MIUNT        I-XXX SPECIFIED PROPERLY  19084 51900019
         BNE   ERR2                    NO,ERROR                   19084 52300019
         CLC   SIX(TRE,R9),MOUNIT       O-XXX SPECIFIED PROPERLY  19084 52700019
         BNE   ERR2                    NO,ERROR                         53100019
         CLC   TWLV(TWO,R9),CMARTPN    IS ), PRESENT              19084 53500019
         BNE   ERR2                    NO,ERROR                         53900019
         LA    R9,TRE(R9)                PTR TO FIRST CHAR OF I-UN19084 54300019
         BAL   R1,MCHECK               CHECK FOR VALID I-UNIT     19084 54700019
         TM    UCMATR,UCMIF             HAS INPUT SUPPORT        Y02669 55100002
         BZ    ERR31                   NO,ERROR                   M0128 55500001
         L     R11,UCMCOMPC             GET PTR TO COMP UCME      M0128 55550001
         LA     R11,ZERO(R11)           CLEAR HIGH ORDER BYTE     M0128 55560001
         LTR   R11,R11                  WAS I-UNIT A VALID COMP   M0128 55600001
         BZ    ERR31                    NO,UNIT REF WAS NOT VALID M0128 55650001
         DROP  R5                                                 M0128 55700001
         USING UCMLIST,R11              ADDRESSABILTY O-UNT UCME  M0128 55750001
         L     R10,UCMUCB               GET PTR TO O-UNT UCB      M0128 55800001
         USING UCB,R10                  ADDRESSABILITY O-UNT UCB  M0128 55850001
         CLC   SIX(TRE,R9),UCBNAME      IS SPEC O-UNT THE LOG COM M0128 55900001
         BNE   ERR31                    NO,UNIT REF WAS NOT VALID M0128 55950001
         CLI   EITN(R9),BLANK           BLANK FOLLOWS KEYWORD     M0128 56000001
         BNE   ERR2                     NO,DELIMETER ERROR        M0128 56050001
         TM    UCMATR,UCMUF             IS O-UNIT ACTIVE          M0676 56100001
         BZ    MNACTIVE                 NO,SEE IF PENDING CHANGE  M0676 56150001
         TM    SRTESTAT,SRTEDADI        IS IT CHNGING TO NONACTIVEM0676 56200001
         BO    ERR31        ERROR, CHANGING STATUS AND THEREFORE Y02669 56250002
*                           CANNOT BECOME THE MASTER CONSOLE     Y02669 56300002
         B     MPARMSET                 GO CHECK I-UNIT           M0676 56350002
         EJECT                                                          56352002
MNACTIVE EQU   *                                                  M0676 56360001
         TM    SRTESTAT,SRTEDADI        IS IT CHNGING TO ACTIVE   M0676 56400001
         BO    ERR4                     CHANGING STATUS MSG       M0676 56450001
         B     ERR31                    NO,INVALID UNIT REF       M0676 56500001
         DROP  R11,R10                                            M0676 56550001
         EJECT                                                          56600002
MKEYCHK  EQU   *                                                  M4449 59260019
         USING UCMLIST,R5               ADDRESSABLTY FOR UNIT CK  M0676 59310001
         CLI   ELEV(R9),BLANK          BLANK FLOOWS KEYWORD       M4449 59340019
         BNE   ERR2                    NO, DELIMITER ERROR        M4449 59420019
         EJECT                                                          59470002
*                                                                       59500019
* PARAMETER LIST FOR SVC 72                                             59900019
*                                                                       60300019
MPARMSET ST    R5,XAR                  PTR TO NEW MSTCONS UCME          60700019
         TM    UCMATR,UCMUF        ACTIVE BIT ON                  19084 60900019
         L     R5,UCMUCB                                          19084 61100019
         USING UCB,R5                                             19084 61500019
         BO    MACTIVE             YES,GO CHECK IF PENDING TO CHNG19084 62300019
         TM    SRTESTAT,SRTEDADI   IS NONACTIVE,IS IT PENDING     19084 62700019
         BZ    ERR31               NO, PURELY NON ACTIVE, NO GOOD 19084 63100019
         B     ERR4                YES, PENDING,CHANGING STATUSMSG19084 63500019
*                                                                 19084 63900019
MACTIVE  EQU   *                                                  19084 64300019
         TM    SRTESTAT,SRTEDADI   PENDING TO CHANGE TO NONACTIVEY02669 64700002
         BO    ERR31               ERR,CHNGING STATS ,THEREFORE  Y02669 65700002
*                                  CANNOT BECOME THE MASTER CONSOLE     65750002
         SPACE 10                                                       65800002
*****************************************************************Y02651 65850002
*                                                                Y02651 65860002
*  FINISHED WITH OUR PROCESSING, AND SVC 72 WILL SOON BE ISSUED  Y02651 65870002
*  MUST RELEASE ALL LOCKS GOTTEN ON ENTRY TO THIS MODULE.        Y02651 65880002
*  LOCKS WERE OBTAINED AT:                                       Y02651 65890002
*     MSETLCK                                                    Y02651 65892002
*                                                                Y02651 65894002
         BAL   R4,MUNSTLK                                        Y02651 65896002
*                                                                Y02651 65898002
*****************************************************************Y02651 65900002
         SPACE 10                                                       65950002
         ST    R8,XAN                 INSERT UCM BASE ADDRESS  @YM02762 66150002
*                                     INTO PARAMETER LIST               66350002
         MVI   XAE,VARMST             SWITCH RESULT VARY MSTCONS        66700002
         MVC   XAX(EIT),MSWTRTN       NAME OF SWITCH RTN                67300002
         LA    R5,XAX                                                   67900018
         ST    R5,XAP                                                   68500018
         LR    R1,R5                  LOAD PTR TO NAME                  69100002
         SVC   SVCSVN2                                                  69700018
         BR    MRETURN                 RETURN                           70300018
         EJECT                                                          70350002
*                                                                       70900018
*********************************************************************** 71500018
*                                                                       72100018
* PHYSICAL UNIT ADDRESS VALIDITY CHECK                                  72700018
*                                                                       73300018
*********************************************************************** 73900018
* ON ENTRY REGISTER 8 POINTS TO FIRST CHARACTER OF UNIT NAME            74500018
MCHECK   LM    R5,R7,UCMVEA            R5 CONTAINS PTR 1ST UCME         75100018
*                                      R6 CONTAINS SIZE UCMES           75700018
*                                      R7 CONTAINS ADDR. OF LAST        76300018
         USING UCMLIST,R5              REFERENCE TO UCME                76900018
MLOOP    L     R10,UCMUCB              PTR TO ASSOCIATED UCB            77500018
         USING UCB,R10                 ..                               78100018
         CLC   ZERO(TRE,R9),UCBNAME         COMPARE PHYSICAL UNIT ADDR  78700019
         BE    MFND                    FOUND,UNIT HAS UCME        19874 79300019
         BXLE  R5,R6,MLOOP             NO,CONTINUE SEARCH         19874 79900019
         B     ERR31                   NOT FOUND,ERROR            M0128 80500001
         DROP  R5,R10                                             19874 81100019
MFND     BR    R1                      RETURN                     19874 81700019
* ON RETURN, REGISTER 5 CONTAINS ADDRESS OF UNITS UCME            19874 82300019
*                                                                 19874 82900019
         EJECT                                                          82950002
*********************************************************************** 83500019
*                                                                 19084 84100019
*  THE FOLLOWING SECTION PASSES A ERROR MESSAGE CODE TO EITHER OF THE   84700019
*  MESSAGE WRITING MODULES IGC0503D OR IGG2103D. THE CODE IS PLACED IN  85300019
*  THE XSA AT XAE.  THE SOURCE TEXT IS PLACED IN THE XSA AT XAV.  19084 85900019
*********************************************************************** 86500019
*                                                                 19084 86800019
ERR1     EQU   *                                                        86850002
         BAL   R5,ERLINK1              MSG MOD IS 2103D           19084 87100002
         DC    AL1(ER1)                ERROR CODE IS 41           19084 87400019
*                                                                 19084 87700019
         DS    0H                                                Y02651 87710002
ERR2     EQU   *                                                 Y02651 87750002
         SPACE 5                                                        87800002
***************************************************              Y02651 87850002
*                                                                Y02651 87860002
*  THIS IS AN ERROR EXIT, LOCKS OBTAINED AT:                     Y02651 87870002
*       MSETLCK                                                  Y02651 87880002
*  MUST BE RELEASED HERE                                         Y02651 87890002
*                                                                Y02651 87892002
         BAL   R4,MUNSTLK                                        Y02651 87894002
*                                                                Y02651 87896002
***************************************************              Y02651 87900002
         SPACE 5                                                        87950002
         BAL   R5,ERLINK               MSG MOD IS 0503D           19084 88000002
         DC    AL1(ER2)                ERROR CODE IS 7            19084 88300019
*                                                                 19084 88600019
ERR3     DS    0F                                                 19084 88670019
         MVI   XAV+TRE,BLANK       PAD WITH BLANKS                19084 88740019
ERR32    EQU   *                                                  19084 88810019
         MVC   XAV(TRE),ZERO(R9)                                  19084 88910019
         BAL   R5,ERLINK               MSG MOD IS 0503D                 89500019
         DC    AL1(ER3)                ERROR CODE IS 13                 89800019
*                                                                       90100019
         DS    0H                                                Y02651 90102002
ERR31    EQU   *                                                 Y02651 90110002
         SPACE 5                                                        90120002
***************************************************              Y02651 90122002
*                                                                Y02651 90122402
*  THIS IS AN ERROR EXIT, LOCKS OBTAINED AT:                     Y02651 90122802
*       MSETLCK                                                  Y02651 90123202
*  MUST BE RELEASED HERE                                         Y02651 90123602
*                                                                Y02651 90123702
         BAL   R4,MUNSTLK                                        Y02651 90123802
*                                                                Y02651 90123902
***************************************************              Y02651 90124002
         SPACE 5                                                        90126002
         TM    XADUSWIT,XAIOCOMP   COMPOSITE CONSOLE?          @Z30LPTJ 90130003
         BZ    ERR3                NO                             19084 90160019
         MVI   XAV+TRE,COMMA       MOVE IN DELIMITER              19084 90250019
         MVC   XAV+FOR(TRE),SIX(R9)    MOVE IN O-UNIT             19084 90280019
         B     ERR32               GO MOVE IN I-UNIT              19084 90310019
*                                                                 19084 90340019
ERR4     DS    0F                                                Y02651 90400002
         SPACE 5                                                        90450002
***************************************************              Y02651 90460002
*                                                                Y02651 90462002
*  THIS IS AN ERROR EXIT, LOCKS OBTAINED AT:                     Y02651 90464002
*       MSETLCK                                                  Y02651 90466002
*  MUST BE RELEASED HERE                                         Y02651 90468002
*                                                                Y02651 90468402
         BAL   R4,MUNSTLK                                        Y02651 90468802
*                                                                Y02651 90469202
***************************************************              Y02651 90470002
         SPACE 5                                                        90500002
         MVI   XAV+TRE,BLANK       BLANK AREA                     19084 91400019
         TM    XADUSWIT,XAIOCOMP   WAS IT A COMPOSITE?         @Z30LPTJ 92542403
         BZ    M1UNT               NO, SINGLE UNIT                      92543118
         MVI   XAV+TRE,COMMA       MOVE IN DELIMITER              19084 92551819
         MVC   XAV+FOR(TRE),SIX(R9)    MOVE IN O-UNIT             19084 92553819
M1UNT    EQU   *                                                        92555819
         MVC   XAV(TRE),ZERO(R9)   MOVE IN UNITNAME INTO MSG      19084 92561819
*                                                                 19084 92591819
MMSG     EQU   *                                                  19084 92597819
         BAL   R5,ERLINK1          GO TO ERROR ROUTINE            19084 92603819
         DC    AL1(CD44)           CHAANGING STATUS MSG           19084 92609819
ERLINK   MVC   XAX(EIT),ERMOD1           ERROR MSGE MODULE NAM   Y02669 92615802
         L     R15,VCON05         GET ADDRESS OF 0503D           Y02669 92617802
         B     MERGO                   EXIT RTN                  Y02669 92621802
ERLINK1  EQU   *                                                        92627819
         MVC   XAX(EIT),ERMOD2                                   Y02669 92633802
         L     R15,VCON21         GET ADDRESS OF 2103D           Y02669 92635802
MERGO    MVC   XAE(ONE),ZERO(R5)            INSERT ERROR CODE IN XSA    92639819
         BR    R15                EXIT                           Y02669 92649802
*                                                                       92681819
         EJECT                                                          92683802
*****************************************************************Y02651 92684202
*                                                                Y02651 92684302
*  SUBROUTINE WHICH OBTAINS AND RELEASES REQUIRED LOCKS          Y02651 92684402
*                                                                Y02651 92684502
MSETLCK  EQU   *                                                 Y02651 92688802
         STM   R11,R14,XASAVLOC                                  Y02651 92689202
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02651*92690802
               RELATED=(IEE4303D(MUNSTLK))                       Y02651 92693202
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02651*92693302
               RELATED=(IEE4303D(MUNSTLK))                       Y02651 92693402
         LM    R11,R14,XASAVLOC                                  Y02651 92693502
         BR    R4                                                Y02651 92693602
*                                                                Y02651 92693702
         SPACE 5                                                 Y02651 92693802
*                                                                Y02651 92695202
MUNSTLK  EQU   *                                                 Y02651 92697202
         STM   R11,R14,XASAVLOC                                  Y02651 92697302
         SETLOCK RELEASE,TYPE=CMS,RELATED=(IEE4303D(MSETLCK))    Y02651 92697602
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(IEE4303D(MSETLCK))  Y02651 92698002
         LM    R11,R14,XASAVLOC                                  Y02651 92699102
         BR    R4                                                Y02651 92701402
*                                                                Y02651 92702502
*****************************************************************Y02651 92703602
         EJECT                                                          92704702
*****************************************************************       92705802
*                                                                       92706502
MIUNT    DC    C'I-'                   I-XXX SPECIFICATION              92710802
MOUNIT   DC    C',O-'                  0-XXX SPECIFICATION              92715102
CMARTPN  DC    C'),'               PAREN, AFTER COMPOSITE         19084 92719402
MSWTRTN  DC    C'IGC0407B'             CONSOLE SWITCH RTN      @YM02762 92723702
ERMOD1   DC    C'IEE0503D'             ERROR MSG MODULE          Y02669 92728002
ERMOD2   DC    C'IEE2103D'             ERROR MSG MODULE          Y02669 92778002
         DS    0F                                                Y02669 92828002
VCON21   DC    V(IEE2103D)                                       Y02669 92838002
VCON05   DC    V(IEE0503D)                                       Y02669 92838402
         SPACE 5                                                        92838802
PATCH    DC    CL50'***IEE4303D***'                            @Z30LPTJ 92839203
        EJECT                                                           92939203
UCB      DSECT                                                          93100018
         IEFUCBOB                                                       93800018
         EJECT                                                          94100018
USETCVT  DSECT                                                          94500018
         CVT      SYS=VMS                                               95200018
         EJECT                                                          95500018
XSADSECT DSECT                                                          95900018
         IEEXSA                                                         96600018
         EJECT                                                          96900018
UUCM     DSECT                                                          97300018
         IEECUCM    FORMAT=NEW                                          98000002
         EJECT                                                          98050002
         IHAPSA                                                         98100002
         END                                                            98700018
