 TITLE 'IEE4603D - VARY ONLINE AND OFFLINE FOR CONSOLE DEVICES'         00090003
IEE4603D CSECT                                                          00180002
* C 072000-072900,234000-234900                                         00210002
* D 246600                                                              00240002
*********************************************************************** 00270002
* MODULE NAME      = IEE4603D                                           00360002
*   CSECT NAME     = IEE4603D                                           00450002
*                                                                       00540002
* LOAD MODULE NAME = IEE3603D                                           00630002
*                                                                       00720002
* DESCRIPTIVE NAME = VARY ONLINE, OFFLINE FOR CONSOLE DEVICES           00810002
*                                                                       00840002
* COPYRIGHT        = MISSING                                            00990002
*                                                                       01080002
* STATUS           = OS/VS/2 RELEASE 3                         @Z30LPTJ 01170003
*                                                                       01260002
* FUNCTION         = IEE4603D WILL PROCESS THE ONLINE/OFFLINE           01350002
*                    KEYWORDS OF THE VARY COMMAND BY SETTING BITS       01440002
*                    IN THE UNIT'S UCB AND UCME                         01530002
*                                                                       01620002
* OPERATION        = IEE4603D IS ENTERED ONLY FROM IEE4203D             01710002
*                    WHICH HAS SCANNED THE UNIT FIELD OF THE VARY       01800002
*                    COMMAND FOR ALL ERRORS.                            01890002
*                    THIS MODULE WILL PROCESS THE ONLINE/OFFLINE        01980002
*                    KEYWORDS OF THE VARY COMMAND                       02070002
*                    IT WILL SET BITS FOR ON/OFFLINE PROCESSING         02160002
*                    IN THE UNIT'S UCB AND UCME                         02250002
*                    WHEN THE UNIT HAS BEEN VARIED, 4603D WILL BALR     02340002
*                    TO IEAVMNTR TO PROCESS ALL BIT CHANGES REQUIRED    02430002
*                    FOR THE FOLLOWING COMANDS:                         02520002
*                            MONITOR JOBNAMES                           02610002
*                            MONITOR STATUS                             02700002
*                            MONITOR SESSIONS                           02790002
*                    FOR THIS DEVICE WHICH IS CHANGING STATUS FROM      02880002
*                    FORM A CONSOLE TO A NON-CONSOLE STATE.             02970002
*                    THIS IS DONE BECAUSE:                              03060002
*                    1. SINCE THIS CONSOLE IS NOT FUNCTIONING AS        03150002
*                    SUCH ANYMORE, WE DO NOT WANT ANY MORE OF THESE     03240002
*                    COMMAND'S MESSAGES BEING QUEUED TO IT (IF IN       03330002
*                    FACT HAD EVER ISSUED ANY OF THE ABOVE THREE        03420002
*                    COMMANDS).                                         03510002
*                    2. IF THIS CONSOLE, WHEN IT WAS ONE, DID IN        03600002
*                    FACT ISSUE ANY OF THE ABOVE THREE COMMANDS,        03690002
*                    AND IT WAS THE ONLY CONSOLE ON THE SYSTEM          03780002
*                    WHICH HAS ISSUED THEM, THEN WE ALSO WANT           03870002
*                    THE BITS INDICATING THESE COMMANDS TURNED          03960002
*                    OFF IN THE MASTER RESIDENT CORE AREA.              04050002
*                    THIS SUBROUTINE (IEAVMNTR) WILL DO ALL THE         04140002
*                    CHECKING AND ALL THE BIT'S SETTING.                04230002
*                    3. DEVICES WHICH ARE CURRENTLY INACTIVE AS         04320002
*                    CONSOLES AND ARE:                                  04410002
*                    OFFLINE                CMD ISSUED: V OFFLINE       04500002
*                    ONLINE,ALLOC           CMD ISSUED: V ONLINE        04590002
*                    ONLINE,UNALLOC         CMD ISSUED: V ONLINE        04680002
*                    OFFLINE                CMD ISSUED: V ONLINE        04770002
*                    ARE ALL HANDLED AS IMMEDIATE COMMANDS AND ALL      04860002
*                    STATUS BITS ARE SET IN THIS MODULE.                04950002
*                    HOWEVER, WHEN THE DEVICE IS:                       05040002
*                    ONLINE                 CMD ISSUED: V OFFLINE       05130002
*                    THEN IT CANNOT BE MADE OFFLINE IMMEDIATELY         05220002
*                    AND TERMINATION WILL HANDLE THIS SITUATION.        05310002
*                    ANY DEVICES FUNCTIONING CURRENTLY AS               05400002
*                    CONSOLES CANNOT BE VARIED TO THE ONLINE/OFFLINE    05490002
*                    STATES IMMEDIATELY AND COMM. TASK AND              05580002
*                    TERMINATION WILL HANDLE THIS CASES.                05670002
*                                                                       05760002
*                    IEE4603D SETS THE FOLLOWING BITS:                  05850002
*                     ..FOR ACTIVE CONSOLE TO ONLINE:                   05940002
*                            CLOSE PENDING       ON   UCME              06030002
*                            ON/OFF CHANGE STATS OFF  UCB               06120002
*                            CONSL.CHANGE STATUS ON   UCB               06210002
*                            MP-OPERATOR BIT     N/A  UCB               06300002
*                                                                       06390002
*                     ..FOR ACTIVE CONSOLE TO OFFLINE:                  06480002
*                            CLOSE PENDING       ON   UCME              06570002
*                            CONSL.CHANGE STATUS ON   UCB               06660002
*                            ON/OFF CHANG STATUS ON   UCB               06750002
*                            OPERATOR-MP BIT     ON   UCB               06840002
*                                                                       06930002
*                       FOR INACTIVE CONSOLE TO ONLINE, THE             07020002
*                       REQUEST IS NOT HONORED IF THE DEVICE            07110002
*                       IS CURRENTLY IN USE BY A SYSTEM        @YM07231 07200002
*                       COMPONENT.                             @YM07231 07290002
*                                                                       07380002
*                     ..FOR INACTIVE CONSOLE TO ONLINE:                 07470002
*                           .IF INACTIVE CONSL = OFFLINE:               07560002
*                            ONLINE BIT            UCB  ON              07650002
*                            ONL/OFF CHANGE STATUS UCB  OFF             07740002
*                            CONSL.CHANGE STATUS   UCB  OFF             07830002
*                            OPERATOR-MP BIT       UCB  OFF             07920002
*                                                                       08010002
*                           .IF INACTIVE CONSOLE = ONLINE,ALLOCATED     08100002
*                            ONLINE BIT            UCB  ON              08190002
*                            ON/OFF CHANGE STATUS  UCB  OFF             08280002
*                            CONSL.CHANGE STATUS   UCB  OFF             08370002
*                            MP-OPERATOR BIT       UCB  N/A             08460002
*                                                                       08550002
*                           .IF INACTIVE CONSOLE = ONLINE,UNALLOCATED   08640002
*                            ONLINE BIT           UCB  ON               08730002
*                            ON/OFF CHANGE STATUS UCB  OFF              08820002
*                            CONSL.CHANGE STATUS  UCB  OFF              08910002
*                            MP-OPERATOR BIT      UCB  N/A              09000002
*                                                                       09090002
*                     ..FOR INACTIVE CONSOLE TO OFFLINE:                09180002
*                           .IF INACTIVE CONSOLE = OFFLINE:             09270002
*                            ON/OFF CHANGE STATS.  UCB  OFF             09360002
*                            CONSL..CHANGE STATUS  UCB  OFF             09450002
*                            MP-OPERATOR BIT       UCB  N/A             09540002
*                                                                       09630002
*                           .IF INACTIVE CONSOLE = ONLINE,ALLOCATED:    09720002
*                            ON/OFF CHANGE STATUS  UCB  ON              09810002
*                            CONSL.CHANGE STATUS   UCB  OFF             09900002
*                            MP-OPERATOR BIT       UCB  ON              09990002
*                                                                       10080002
*                           .IF INACTIVE CONSOLE = ONLINE,UNALLOCATED:  10170002
*                            ON/OFF CHANGE STATUS  UCB  ON              10260002
*                            CONSL.CHANGE STATUS   UCB  OFF             10350002
*                            MP-OPERATOR BIT       UCB  ON              10440002
*                            MRC SEARCH BIT(MSSUM) MRC  ON              10530002
*                                                                       10620002
*                    IEE4603D WILL DISPATCH PROPER MESSAGES TO THE      10710002
*                    VARIED CONSOLES, RESTEP THE UNIT FIELD POINTER,    10800002
*                    AND DETERMINE IF ALL UNITS HAVE BEEN PROCESSED.    10890002
*                    IF ALL UNITS HAVE BEEN PROCESSED AND IF ONLY I/O   10980002
*                    UNITS ARE TO BE VARIED ON/OFF, THEN IT BRANCHES    11070002
*                    TO IEE3103D. IF NO UNITS ARE (INCLUDING            11160002
*                    ANY I/O UNITS IT EXITS TO THE CALLER OF THE SVC    11250002
*                    IF VARY RANGE IS BEING PROCESSED, THEN    @Z30LPTJ 11260003
*                    MESSAGES ARE SUPPRESSED AND WHEN EXIT IS  @Z30LPTJ 11270003
*                    MADE, IT IS A BRANCH TO IEECB904 FOR      @Z30LPTJ 11280003
*                    FURTHER VARY RANGE PROCESSING             @Z30LPTJ 11290003
*                                                                       11340002
* NOTES                                                                 11430002
*    DEPENDENCIES = NONE                                                11520002
*    CHARACTER/CODE DEPENDENCIES                                        11610002
*                 = THIS MODULE CAN BE ASSEMBLER WITH ANY NEW           11700002
*                   CHARACTER/CODE SET.                                 11790002
*                                                                       11880002
* RESTRICTIONS    = R2 CONTAINS THE PTR TO THE XSA ON INPUT AND OUTPUT  11970002
*   REGISTER CONVENTIONS                                                12060002
*                 = REGISTER DEFINITION WILL BE FOUND AT:  REGDEF       12150002
*   PATCH LABEL   = PATCH                                               12240002
*                                                                       12330002
* MODULE TYPE     = CSECT                                               12420002
*   PROCESSOR     = ASSEMBLER                                           12510002
*   MODULE SIZE   = VS/2 = '692'                                        12600003
*   ATTRIBUTES    = REENTRANT, REUSABLE,REFRESHABLE,ZERO PSW            12690002
*                    PROTECT KEY, PAGED LPA                             12780002
*                                                                       12870002
* ENTRY POINTS     = IEE4603D FROM IEE4203D                             12960002
*    PURPOSE       = TO VARY ONLINE AND OFFLINE CONSOLE DEVICES         13050002
*    LINKAGE       = BRANCH                                             13140002
*    INPUT         = REG2 PTR TO THE DUMMY XSA                          13230002
*                    XAD HAS THE SWITCHES COMPUTED BY IEE4203D          13320002
*                    XAR CONTAINS PROCESS SWITCHES FOR THE UNITS        13410002
*                    XAL PTR TO THE PARAMETER OF THE COMMAND            13500002
*                    REG13 PTS TO THE SAVE AREA GOTTEN BY 3603D         13590002
*                    WORD 17 OF THE SAVE AREA HAS THE PTR TO THE CSCB   13680002
*    REGISTERS SAVED= ALL                                               13770002
*    REGISTER USAGE= R0  CONSOLE ID FOR WTO                             13860002
*                    R1  MRC PTR AND WTO                                13950002
*                    R2  DUMMY XSA PTR                                  14040002
*                    R3  ADDRESSABILITY                                 14130002
*                    R4  UCME PTR                                       14220002
*                    R7  PROCESS BIT REG                                14310002
*                    R9  UNIT PTR                                       14400002
*                    R10 UCM PTR                                        14490002
*                    R11 UCMPRFX PTR                                    14580002
*                    R12 UCB PTR                                        14670002
*                    R13 SAVE AREA PTR                                  14760002
*    REGISTERS RESTORED                                                 14850002
*                  = ALL                                                14940002
*                                                                       15030002
* EXITS - NORMAL 1 = TO IEE3103D VIA BRANCH                             15120002
*    CONDITIONS    = IF SOME UNITS (I/O) ARE LEFT TO BE                 15210002
*                       PROCESSED BY IEE3103D (AS INDICATED BY          15300002
*                       XAUDVC BIT IN XAD), EXIT TO IEE3103D VIA BR.    15390003
*    OUTPUT        = 1. WTO'S FOR VARIED DEVICES (SEE MESSAGES)         15480002
*                    2. UCME AND UCB BIT SETTINGS FOR VARIED            15570002
*                       DEVICES (SEE OPERATION)                         15660002
*                    3. IF EXIT TO IEE3103D, THE OUTPUT IS              15750002
*                       REG2 PTS TO THE DUMMY XSA                       15840002
*                            XAR PTR TO THE LOGICAL END OF BUFFER       15930002
*                            (PTS TO COMMA BEFORE KEYWORD)              16020002
*                            XAL HAS COMMAND PARAM LIST                 16110002
*                            XAV HAS THE VERB                           16200002
*                            XAS+0(XASOPCOD) AND XAS+1(XSWITCH)         16290003
*                            HAVE BIT DESIGNATING THE KEYWORD:          16380002
*                                 ONLINE                                16470002
*                                 OFFLINE                               16560002
*                    REG13 HAS PTR TO THE SAVE AREA, WORD17=CSCB PTR    16650002
*    RETURN CODES  = NONE                                               16740002
*                                                                       16830002
* EXIT - NORMAL 2  = IEAVMNTR VIA BALR                                  16920002
*                  = ADDR. OF THIS RTN IS PRESET IN AREA:UCMMNTR        17010002
*                     OF THE UCM                                        17100002
*    CONDITIONS    = MONITOR COMMAND BIT HANDLING RTN. FOR THIS         17190002
*                    CONSOLE GOING OUT OF THIS STATE, AND THEREFORE,    17280002
*                    DOES NOT NEED MONITOR MSGS SENT TO IT ANYLONGER    17370002
*    OUTPUT        = REG1 POINTS TO A POINTER WHICH IN TURN             17460002
*                    POINTS TO A TWO WORD PARAMETER LIST CONTAINING     17550002
*                    THE DEVICE'S ID AND FUNCTION CODES.(SEE DSECT)     17640002
*                    R13 PTS TO A SAVEAREA                              17730002
*                    R14 HAS RETURN ADDRESS                             17820002
*    RETURN CODES  = NONE                                               17910002
*                                                                       18000002
* EXITS - NORMAL -3-= RETURN TO CALLER                                  18090002
*    CONDITIONS    = WHEN NO MORE UNITS AND NO I/O ARE TO BE PROCESSED  18180002
*    OUTPUT        = ALL UNITS IN COMMAND ARE COMPLETED                 18270002
*                    SAVE AREA AND DUMMY XSA ARE FREED                  18360002
*                    CSCB IS FREED VIA THE MGCR MACRO                   18450002
*    RETURN CODES  = NONE                                               18540002
*                                                                       18550003
* EXITS - NORMAL 4 = TO IEECB904 VIA BRANCH                    @Z30LPTJ 18560003
*    CONDITIONS    = WHEN NO MORE UNITS AND NO I/O UNITS ARE   @Z30LPTJ 18570003
*                    TO BE PROCESSED AND VARY RANGE IS BEING   @Z30LPTJ 18580003
*                    PROCESSED                                 @Z30LPTJ 18590003
*    OUTPUT        = REGISTER 2 POINTING TO THE XSA WHICH HAS  @Z30LPTJ 18600003
*                    THE XAL POINTING TO THE VARY RANGE WORK   @Z30LPTJ 18610003
*                    AREA                                      @Z30LPTJ 18620003
*    RETURN CODES  = NONE                                      @Z30LPTJ 18630003
*                                                                       18670003
* EXITS - ERROR    = NONE                                               18720002
*                                                                       18760003
* EXTERNAL REFERENCES                                                   18900002
*    ROUTINES      = IEE3103D                                           18990002
*                    IEECB904                                  @Z30LPTJ 19010003
*                                                                       19030003
*    DATA AREAS    = SEE EXITS - OUTPUT DATA                            19080002
*                                                                       19170002
* CONTROL BLOCKS   = DUMMY EXTENDED SAVE AREA (XSA)                     19260002
*                    CVT                                                19350002
*                       FIELDS UPDATED = NONE                           19440002
*                       FIELDS TESTED  = CVTCUCB                        19530002
*                                        CVTMSER                        19620002
*                    UNIT CONTROL MODULE (UCM)                          19710002
*                       FIELDS UPDATED = UCMSTS - UCMCF                 19800002
*                       FIELDS TESTED  = UCMCOMPC                       19890002
*                                        UCMMSG - BIT= UCMMSGA          19980002
*                                        UCMUCB                         20070002
*                                        UCMVEA                         20160002
*                                        UCMMNTR                        20250002
*                    UNIT CONTROL BLOCK (UCB)                           20340002
*                       FIELDS UPDATED = SRTESTAT - BIT= SRTECHGS       20430002
*                                                        SRTEDADI       20520002
*                                                        SRTEONLI       20610002
*                                        UCBWGT - BIT= UCBVORSN         20700002
*                       FIELDS TESTED  = SRTESTAT - BIT= SRTEALOC       20790002
*                                                        SRTEONLI       20880002
*                                                        SRTESYSR       20970002
*                                        UCBNAME                        21060002
*                     COMMAND SCHEDULING CONTROL BLOCK (CSCB)           21150002
*                       FIELDS TESTED  - NONE                           21240002
*                       FIELDS UPDATED - CHSTS -BIT= CHFC               21330002
*                     MASTER SCHEDULER RESIDENT DATA AREA (MRC)         21420002
*                       FIELDS TESTED  - NONE                           21510002
*                       FIELDS UPDATED - MSECBFL - BIT= MSSUM           21600002
*                                                                       21690002
* TABLES           = NONE                                               21780002
*                                                                       21870002
* MACROS           = WTO,GETMAIN,FREEMAIN,MGCR,GETMAIN,SETLOCK,DEQ      21960002
*                                                                       22050002
* MAPPING MACROS   = IEEXSA                                             22140002
*                    CVT                                                22230002
*                    IEECUCM                                            22320002
*                    IEFUCBOB                                           22410002
*                    IEEBASEA                                           22500002
*                    IEECHAIN                                           22590002
*                    IHAMPL                                             22680002
*                    IHAPSA                                             22770002
*    SERIALIZATION = PROTECTION AGAINST COMM TASK WHEN SETTING ON/OFF   22860002
*                    THE UCME BITS IS ACCOMPLISHED VIA THE CMS AND      22950002
*                    LOCAL LOCKS OBTAINED AT: OSETLOCK                  23040002
*                    AND RELEASED AT: RELEASE                           23130002
*                    BOTH IN THIS MODULE.                               23220002
*                    PROTECTION AGAINST ALLOCATION, VARY/UNLOAD AND     23310002
*                    SYSTEM COMPONENT IS ACCOMPLISHED BY       @YM07231 23400002
*                    EXECUTION OF THIS ROUTINE UNDER AN ENQ    @YM07231 23440002
*                    GOTTEN EARLIER, IN MODULE IEE3603D.       @YM07231 23490002
*                    A DEQ WILL BE ISSUED IN THIS MODULE IF THE         23580002
*                    TERMINAL EXIT IS TAKEN AT LOC: ODEQUE              23670002
*                    ALL UCB AND MRC BITS THAT ARE TURNED ON/OFF IN     23760002
*                    THIS ROUTINE ARE SET BY THE COMPARE-AND-SWAP       23850002
*                    INSTRUCTION.                                       23940002
*                                                                       24030002
* CHANGE LEVEL     = Y02669, Y02651, Z30LPTJ                   @Z30LPTJ 24120003
*                                                                       24210002
* CHANGE ACTIVITY = N/A                                                 24300002
*                                                                       24390002
* MESSAGES         = 'IEE302I XXX ONLINE'                               24480002
*                    'IEE303I XXX OFFLINE'                              24570002
*                       (WHERE XXX IS THE UNIT NAME IN QUESTION)        24750002
*                       THE ABOVE MESSAGES ARE SUPPRESSED      @Z30LPTJ 24780003
*                       WHEN VARY RANGE IS BEING PROCESSED.    @Z30LPTJ 24810003
*                                                                       24840002
* ABEND CODES      = NONE                                               24930002
*                                                                       25020002
* PACKAGING        = IEE4603D WILL BE PART OF LOAD MODULE               25110002
*                       = IEE3603D                                      25200002
*                    THIS LOAD MODULE ALIASES ARE                       25290002
*                       = NONE                                          25380002
*                    THIS LOAD MODULE ENTRY PTS ARE                     25470002
*                       = IEE3603D                                      25560002
*                    MODULE WILL RESIDE IN:  LPALIB                     25650002
*                                                                       25740002
* SYSGEN           = SUPPLIED BY SECTIONS:                              25830002
*                       LOAD MODULE NAME                                25920002
*                       PACKAGING                                       26010002
*                       THIS CSECT WILL BE INCLUDED AT SYSGEN FROM      26100002
*                       DLIB -AOSB3- BY MACRO -SGIEF441-                26190002
*                                                                       26280002
* SYSTEM LIBRARIES = NONE                                               26370002
*********************************************************************** 26460002
         EJECT                                                          26550002
*********************************************************************** 26640002
*                                                                       26730002
*   ***           ***                                                   26820002
*   *               *                                                   26910002
*   * XXX           *                                                   27000002
*   *               * ONLINE                                            27090002
* V * O-XXX         *,                                                  27180002
*   *               * OFFLINE                                           27270002
*   * (I-XXX,O-XXX) *                                                   27360002
*   *               *                                                   27450002
*   ***           ***                                                   27540002
*********************************************************************** 27630002
         EJECT                                                          27720002
*                                                                 19084 27810002
*        REGISTER EQUATES                                         19084 27900002
*                                                                 19084 27990002
DEFREG   EQU   *                                                 Y02669 28080002
R0       EQU   0                   CONSOLE ID FOR WTO             19084 28170002
R1       EQU   1                   IN-XAD,USE-MRC PTR,AND WTO     19084 28260002
R2       EQU   2                   XSA                            19084 28350002
R3       EQU   3                   ADDRESS                        19084 28440002
R4       EQU   4                   UCME                           19084 28530002
R5       EQU   5                                                  19084 28620002
R6       EQU   6                                                  19084 28710002
R7       EQU   7                   PROCESS BIT REG                19084 28800002
R8       EQU   8                                                  19084 28890002
R9       EQU   9                   UNIT PTR                       19084 28980002
R10      EQU   10                  UCM REG                        19084 29070002
R11      EQU   11                  UCMPFX REG                     19084 29160002
R12      EQU   12                  UCB REG                        19084 29250002
R13      EQU   13                                                 19084 29340002
R14      EQU   14                  RET ADDR                       19084 29430002
R15      EQU   15                                                 19084 29520002
*********************************************************************** 29610002
*                                                                 19084 29700002
*        EQUATES                                                  19084 29790002
*                                                                 19084 29880002
*********************************************************************** 29970002
ZERO     EQU   0                                                  19084 30060002
ONE      EQU   1                                                  19084 30150002
TWO      EQU   2                                                  19084 30240002
TRE      EQU   3                                                  19084 30330002
FOR      EQU   4                                                  19084 30420002
SIX      EQU   6                                                  19084 30510002
SVN      EQU   7                                                  19084 30600002
EIT      EQU   8                                                  19084 30690002
TWELV    EQU   12                                                Y02669 30780002
SIXTN    EQU   16                                                Y02669 30870002
NINETEEN EQU   19                      *                          21051 30960002
D64      EQU   64                                                Y02669 31050002
D132     EQU   132                                               Y02669 31140002
D68      EQU   68                                                Y02669 31230002
*                                                                 19084 31320002
FOX      EQU   255                                                19084 31410002
*                                                                 19084 31500002
RIID     EQU   X'80'                                              19084 31590002
         SPACE 10                                                 19084 31770002
ONOFKEY  EQU   C'O'                                               19084 31950002
NLINE    EQU   C'N'                                               19084 32040002
FFLINE   EQU   C'F'                                               19084 32130002
EIGHTY8  EQU   88                                                Y02669 32220002
         EJECT                                                          32310002
*********************************************************************** 32400002
*                                                                 19084 32490002
*        ONLINE AND OFFLINE OF CONSOLE DEVICES PROCESSOR          19084 32580002
*                                                                 19084 32670002
*********************************************************************** 32760002
         BALR  R3,ZERO                                            19084 32850002
         USING *,R3                                               19084 32940002
         MODID BR=YES                                            Y01886 33030002
         USING XSA,R2                                             19084 33120002
*                                                                       33210002
         STM   R0,R15,ZERO(R13)                                  Y02669 33300002
         L     R4,XAR              PROCESS SWITCHES               19084 33390002
         L     R9,XAL              GET PTR TO UNIT BEGIN          19084 33480002
         LA    R9,ZERO(R9)                                        19084 33570002
         L     R10,CVTPTR                                         19084 33660002
         USING OCVT,R10                                           19084 33750002
         L     R10,CVTCUCB         GET PTR TO UCM                 19084 33840002
         DROP  R10                                                19084 33930002
         USING UCM,R10                                           Y02669 34020002
*                                                                 19084 34110002
         SPACE 10                                                 19084 34200002
         TM    XADUSWIT,XAXPAREN   MULTIPLE UNITS              @Z30LPTJ 34290003
         BZ    OSINGLE                                            19084 34380002
OSTART   LA    R9,ONE(R9)          YES,INDEX PAST BEGINNING PARENS19084 34470002
OSINGLE  EQU   *                                                  19084 34560002
         CLC   ZERO(TWO,R9),OOUNIT IS IT AN O-XXX                 19084 34650002
         BNE   OCOMP               NO, MAYBE A COMPOSITE          19084 34740002
         LA    R9,TWO(R9)               YES INDEX TO UNITNAME     19084 34830002
         B     OTEST               GO CHECK IF MUST PROCESS IF    19084 34920002
*                                                                 19084 35010002
OCOMP    EQU   *                                                  19084 35100002
         CLC   ZERO(TRE,R9),OIUNIT     DO WE HAVE A COMPOSITE     19084 35190002
         BNE   OTEST               NO, ITS A REGULAR UNIT        Y02669 35280002
         LA    R9,TRE(R9)               YES,INDEX TO INPUT UNIT   19084 35370002
         OI    XADUSWIT,XAIOCOMP        TURN COMPOSITE SWITCH  @Z30LPTJ 35460003
*                                                                 19084 35550002
OTEST    EQU   *                                                  19084 35640002
         LTR   R4,R4                    DO WE PROCESS THIS UNIT   19084 35730002
         BZ    ONOMORE             NO, AND NOMORE EITHER,FINISHED 19084 35820002
         BM    OPROCES             YES,PROCESS THIS ONE           19084 35910002
*                                       NO, NOT PROCESS THIS ONE  19084 36000002
OOMIT    EQU   *                                                  19084 36090002
         TM    XADUSWIT,XAIOCOMP   IS IT A COMP WE HAVE TO OMIT@Z30LPTJ 36180003
         BZ    OENDCK              NO,                            19084 36270002
         LA    R9,SVN(R9)               YES INDEX OVER            19084 36360002
*                                                                 19084 36450002
OENDCK   EQU   *                                                  19084 36540002
         LA    R9,TRE(R9)          PT AFTER DLIM ADTER UNIT       19084 36630002
         NI    XADUSWIT,XAXPAREN+XAUDVC MULT. UNITS, CLEAN UP  @Z30LPTJ 36720003
         SLL   R4,ONE              ALL SWITCHES EXCEPT XAXPAREN@Z30LPTJ 36810003
         B     OSTART              AND IODEV SWITCH. GO START OVER19084 36900002
*                                                                 19084 36990002
OPROCES  EQU   *                                                  19084 37080002
         LM    R5,R7,UCMVEA        GET UCMES PTRS                 19084 37170002
         USING UCMLIST,R5                                         19084 37260002
OLOOP    L     R12,UCMUCB          AND UCB ADDRESSABILITY         19084 37350002
         USING OUCB,R12                                           19084 37440002
         CLC   ZERO(TRE,R9),UCBNAME     IS THIS THE UCME FOR UNIT 19084 37530002
         BE    OONOFF              YES,                          Y02669 37620002
         BXLE  R5,R6,OLOOP         MUST BE NEXT ONE GO CHECK      19084 37710002
*                                  WILL ALWAYS FIND ONE,CHECKED BY 4203 37800002
         EJECT                                                    19084 37890002
OONOFF   EQU   *                                                 Y02669 37980002
         SPACE 5                                                        38070002
*****************************************************************Y02651 38160002
*                                                                Y02651 38250002
*  LOCKS MUST BE GOTTEN NOW FOR PROTECTION AGAINST COMM TASK     Y02651 38340002
*  THESE LOCKS WILL BE RELEASED IN THIS MODULE AT:               Y02651 38430002
*      RELEASE                                                   Y02651 38520002
*                                                                Y02651 38610002
OSETLOCK EQU   *                                                 Y02651 38700002
         LR    R8,R13             SAVE SAVEAREA POINTER          Y02651 38790002
         STM   R11,R14,D68(R8)                                   Y02651 38880002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02651*38970002
               RELATED=(IEE4603D(RELEASE))                       Y02651 39060002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02651*39150002
               RELATED=(IEE4603D(RELEASE))                       Y02651 39240002
         LM    R11,R14,D68(R8)                                   Y02651 39330002
*****************************************************************Y02651 39420002
        SPACE 10                                                19084   39510002
*********************************************************************** 39600002
*                                                                 19084 39690002
*        PROCESS KEYWORDS                                         19084 39780002
*                                                                 19084 39870002
*********************************************************************** 39960002
         TM    XASOPCOD,XAON       ONLINE                      @Z30LPTJ 40050003
         BZ    OOFFLN              NO, OFFLINE                    19084 40140002
         EJECT                                                          40230002
*********************************************************************** 40320002
*                                                                 19084 40410002
*        ONLINE KEYWORD                                           19084 40500002
*                                                                 19084 40590002
*********************************************************************** 40680002
OONLINE  EQU   *                                                  19084 40770002
*                                                                 19084 40860002
****************PROCESS TO VARY CONSOLE TO ONLINE STATUS          19084 40950002
*                                                                 19084 41040002
*                                                                 19084 41130002
*                                                                 19084 41220002
         OI    XADUSWIT,XAUBLANK   MSG MUST BE PUT OUT         @Z30LPTJ 41310003
         TM    SRTESTAT,SRTESYSR   IS IT A CONSOLE NOW            19084 41400002
         BZ    ONTEST              NO, FUNCTIONING AS IO DEV      19084 41490002
SETBITS2 EQU   *                                                 Y02669 41580002
         OI    UCMSTS,UCMCF        TURN CLOSE PENDING FOR CTASK  Y02651 41670002
*        OI    SRTESTAT,SRTEDADI   SET CHAGING STATUS IN UCB     Y02651 41760002
*        NI    SRTESTAT,FOX-SRTECHGS  SET ON/OFF CHANGE STTS OFF Y02651 41850002
*                                                                Y02651 41940002
*********** THE ABOVE TWO INSTRUCTION WILL BE PROTECTED VIA THE  Y02651 42030002
*           COMPARE AND SWAP INSTRUCTION                         Y02651 42120002
*                                                                Y02651 42210002
         STM   R4,R6,D68(R13)     SAVE USED REGS                 Y02651 42300002
OIDADI   EQU   *                                                 Y02651 42390002
         OIL   SRTESTAT,SRTEDADI,WREGS=(4,5,6),REF=OUCB          Y02651 42480002
NICHGS   EQU   *                                                 Y02651 42570002
NILCHANG EQU   X'BF'    -X'FF'-SRTECHGS-                                42660002
         NIL   SRTESTAT,NILCHANG,WREGS=(4,5,6),REF=OUCB          Y02651 42750002
         LM    R4,R6,D68(R13)     RESTORE REGS                   Y02651 42840002
*                                                                Y02651 42930002
         TM    XADUSWIT,XAIOCOMP  I-UNIT OF A COMP IN PROCESS? @Z30LPTJ 43020003
         BZ    OUNTTST            NO CHECK FOR OUNIT OF COMP     Y02669 43110002
SETOUNT  EQU   *                  YES, PRCES O-UNIT OF COMP FRST Y02669 43200002
         LR    R8,R9              SAVE I-UNIT'S UNITNAME PTR     Y02669 43290002
         LR    R6,R5              SAVE I-UNIT'S UCME PTR         Y02669 43380002
         LR    R11,R12            SAVE I-UNIT'S UCB PTR          Y02669 43470002
         L     R5,UCMCOMPC        GET O-UNIT'S UCME PTR          Y02669 43560002
         L     R12,UCMUCB         GET O-UNIT'S UCB PTR           Y02669 43650002
         LA    R9,SIX(R9)         GET O-INUT'S UNITNAME PTR      Y02669 43740002
         NI    XADUSWIT,FOX-XAIOCOMP TURN OFF I-UNIT'S FLAG    @Z30LPTJ 43830003
         OI    XADUSWIT,XAIPAREN  SET O-UNIT IN PROCESSED SW   @Z30LPTJ 43920003
         B     SETBITS2           GO TO SET FLAGS FOR O-UNIT     Y02669 44010002
*                                                                Y02669 44100002
OUNTTST  EQU   *                                                 Y02669 44190002
         TM    XADUSWIT,XAIPAREN  IF NOT I-UNIT, IS IT O-UNIT  @Z30LPTJ 44280003
         BZ    OMSGPTR            NO REGUNIT, GO ISSUE MSG       Y02669 44370002
         LR    R9,R8              YES, JUST ENDED PROCESING O-UNTY02669 44460002
         LR    R5,R6              RESTORE REGS TO CONTAIN        Y02669 44550002
         LR    R12,R11            THE I-UNIT'S INFOR             Y02669 44640002
         NI    XADUSWIT,FOX-XAIPAREN TURN OFF O-UNIT FLAG      @Z30LPTJ 44730003
         OI    XADUSWIT,XAIOCOMP  AND TURN ON THE I-UNIT FLAG  @Z30LPTJ 44820003
         B     OMSGPTR            GO ISSUE MSGS FOR BOTH UNITS   Y02669 44910002
*                                                                 19084 45000002
*                                                                 19084 45090002
ONTEST   EQU   *                                                  19084 45180002
*        NI    UCBWGT,FOX-UCBVORSN                               Y02651 45270002
*                                                                Y02669 45360002
*        OI    SRTESTAT,SRTEONLI       TURN ONLINE BIT           Y02651 45450002
*        NI    SRTESTAT,FOX-SRTECHGS+SRTEDADI  TURN OFF THE      Y02651 45540002
*                      ON/OFF AND CONSOLE CHANGE STATUS BITS     Y02651 45630002
*                                                                Y02651 45720002
*********   THE ABOVE TWO INSTRUCTIONS WILL BE PROTECTED VIA THE Y02651 45810002
*            COMPARE-AND-SWAP INSTRUCTION                        Y02651 45900002
*                                                                Y02651 45990002
         STM   R4,R6,D68(R13)     SAVE USED REGS                 Y02651 46080002
NILOPER  EQU   *                                                 Y02651 46170002
NILVORSN EQU    X'FB'     -X'FF'-UCBVORSN-                              46260002
         NIL   UCBWGT,NILVORSN,WREGS=(4,5,6),REF=OUCB            Y02651 46350002
OIONLI   EQU   *                                                 Y02651 46440002
         OIL   SRTESTAT,SRTEONLI,WREGS=(4,5,6),REF=OUCB          Y02651 46530002
NILCHGS  EQU   *                                                 Y02651 46620002
         NIL   SRTESTAT,NILCHANG,WREGS=(4,5,6),REF=OUCB          Y02651 46710002
NIDADI   EQU   *                                                 Y02651 46800002
NILDADI  EQU    X'FE'     -X'FF'-SRTEDADI-                              46890002
         NIL   SRTESTAT,NILDADI,WREGS=(4,5,6),REF=OUCB           Y02651 46980002
         LM    R4,R6,D68(R13)     RESTORE REGS                   Y02651 47070002
         TM    XADUSWIT,XAIOCOMP  I-UNIT OF COMP PROCESSED     @Z30LPTJ 47160003
         BZ    NOTCOMP            NO,CHECK IF O-UNIT OF COMP     Y02669 47250002
         LR    R8,R9              YES,MUST SET UP FOR O-UNIT     Y02669 47340002
         LR    R6,R5              R8=I-UNT'S UTNM PTR AND R15=   Y02669 47430002
         LR    R11,R12            I-UNT'S UCME, R11=I-UNT'S UCB  Y02669 47520002
         L     R5,UCMCOMPC        GET O-UNIT'S UCME PTR          Y02669 47610002
         L     R12,UCMUCB         O-UNIT'S UCB PTR               Y02669 47700002
         LA    R9,SIX(R9)         O-UNIT'S UNITNAME PTR          Y02669 47790002
         NI    XADUSWIT,FOX-XAIOCOMP TURN OFF I-UNIT FLAG      @Z30LPTJ 47880003
         OI    XADUSWIT,XAIPAREN  TURN ON O-UNIT'S FLAG        @Z30LPTJ 47970003
         B     ONTEST             GO SET BITS IN THE O-UNIT      Y02669 48060002
*                                                                Y02669 48150002
NOTCOMP  EQU   *                                                 Y02669 48240002
         TM    XADUSWIT,XAIPAREN  WAS IT THE O-UNIT PROCESSED  @Z30LPTJ 48330003
         BZ    OMSGPTR            NO, REG UNIT, GO ISSUE MSG     Y02669 48420002
         LR    R9,R8              YES, THEREFORE RESTORE I-UNT'S Y02669 48510002
         LR    R12,R11            POINTER REGISTERS              Y02669 48600002
         LR    R5,R6                                             Y02669 48690002
         NI    XADUSWIT,FOX-XAIPAREN TURN OFF O-UNIT FLAG      @Z30LPTJ 48780003
         OI    XADUSWIT,XAIOCOMP  TURN ON I-UNIT FLAG          @Z30LPTJ 48870003
*                                 ISSUE MSG FOR BOTH UNITS       Y02669 48960002
OMSGPTR  EQU   *                                                        49050002
         SPACE 10                                                       49140002
***************************************************              Y02651 49230002
*                                                                Y02651 49320002
*  SINCE A WTO MACRO WILL NOW BE ISSUED FOR THE DEVICE(S) JUST   Y02651 49410002
*  PROCESSED, ALL LOCKS MUST BE TEMPORARITY RELEASED AND RE-     Y02651 49500002
*  OBTAINED IF MORE DEVICES ARE TO BE PROCESSED                  Y02651 49590002
*                                                                Y02651 49680002
         BAL   R8,RELEASE                                        Y02651 49770002
*                                                                Y02651 49860002
***************************************************              Y02651 49950002
         SPACE 10                                                       50040002
*                                                                 19084 50130002
         LA    R15,ONLMSG           PT TO ONLINE MSG              19084 50220002
         B     OMSGS               GO ISSUE MSG FOR UNIT          19084 50310002
*                                                                 19084 50400002
         EJECT                                                          50490002
*********************************************************************** 50580002
*                                                                 19084 50670002
*       OFFLINE KEYWORD                                           19084 50760002
*                                                                 19084 50850002
*********************************************************************** 50940002
OOFFLN   EQU   *                                                  19084 51030002
*                                                                 19084 51120002
*                                                                 19084 51210002
*                                                                 19084 51300002
*************   PROCESS TO VARY CONSOLE TO OFFLINE STATUS         19084 51390002
*                                                                 19084 51480002
         TM    SRTESTAT,SRTESYSR   IS IT CURRENTLY A CONSOLE      19084 51570002
         BZ    UOFFTEST            NO, NOW IS USED AS IO DEV      19084 51660002
SETBITS  EQU   *                                                 Y02669 51750002
         OI    UCMSTS,UCMCF        SET CLOSE PENG BIT FOR C TASK Y02651 51840002
*                                                                Y02651 51930002
*        OI    UCBWGT,UCBVORSN                                   Y02651 52020002
*                                                                Y02669 52110002
*        OI    SRTESTAT,SRTECHGS+SRTEDADI  TURN ON/OFF CHANGEBIT Y02651 52200002
*                                  AND CONSOLE CHANGE STATUS BIT Y02651 52290002
*                                                                Y02651 52380002
*********** THE ABOVE INSTRUCTION WILL BE PROTECTED VIA THE      Y02651 52470002
*           COMPARE-AND-SWAP INSTRCTION                          Y02651 52560002
*                                                                Y02651 52650002
         STM   R4,R6,D68(R13)     SAVE USED REGS                 Y02651 52740002
OILOPER  EQU   *                                                 Y02651 52830002
         OIL   UCBWGT,UCBVORSN,WREGS=(4,5,6),REF=OUCB            Y02651 52920002
OICHGS   EQU   *                                                 Y02651 53010002
         OIL   SRTESTAT,SRTECHGS,WREGS=(4,5,6),REF=OUCB          Y02651 53100002
OILDADI  EQU   *                                                 Y02651 53190002
         OIL   SRTESTAT,SRTEDADI,WREGS=(4,5,6),REF=OUCB          Y02651 53280002
         LM    R4,R6,D68(R13)     RESTORE REGS                   Y02651 53370002
         OI    XADUSWIT,XAUBLANK  INDICATE MSG SENT            @Z30LPTJ 53460003
         TM    XADUSWIT,XAIOCOMP  PROCESSING I-UNIT OF COMP    @Z30LPTJ 53550003
         BZ    OFFPTR1            NO SEE IF IF IS O-UNIT OF COMP Y02669 53640002
         LR    R8,R9         YES,SAVE I-UNT'S REGS R8=UNTNM PTR  Y02669 53730002
         LR    R6,R5              STORE I-UNIT'S UCME PTR        Y02669 53820002
         LR    R11,R12            STORE I-UNIT'S UCB PTR         Y02669 53910002
         L     R5,UCMCOMPC        GET O-UNIT'S UCME PTR          Y02669 54000002
         L     R12,UCMUCB         GET O-UNIT'S UCB PTR           Y02669 54090002
         LA    R9,SIX(R9)         GET O-UNIT'S UNITNAME PTR      Y02669 54180002
         NI    XADUSWIT,FOX-XAIOCOMP TURN OFF I-UNIT FLAG      @Z30LPTJ 54270003
         OI    XADUSWIT,XAIPAREN  SET O-UNIT'S FLAG            @Z30LPTJ 54360003
         B     SETBITS            GO SET BITS IN THE O-UNIT      Y02669 54450002
*                                                                Y02669 54540002
OFFPTR1  EQU   *                                                 Y02669 54630002
         TM    XADUSWIT,XAIPAREN  WAS IF O-UNIT OF COMP        @Z30LPTJ 54720003
         BZ    OFFPTR             NO, REG UNIT, GO ISSUE MSG     Y02669 54810002
         LR    R9,R8              RESTORE I-UNIT'S REGISTER PTRS Y02669 54900002
         LR    R5,R6                                             Y02669 54990002
         LR    R12,R11                                           Y02669 55080002
         NI    XADUSWIT,FOX-XAIPAREN TURN OFF O-UNIT'S FLAG    @Z30LPTJ 55170003
         OI    XADUSWIT,XAIOCOMP  TURN ON I-UNIT FLAG          @Z30LPTJ 55260003
OFFPTR   EQU   *                                                  19084 55350002
         SPACE 10                                                       55440002
***************************************************              Y02651 55530002
*                                                                Y02651 55620002
*  SINCE A WTO MACRO WILL NOW BE ISSUED FOR THE DEVICE(S) JUST   Y02651 55710002
*  PROCESSED, ALL LOCKS MUST BE TEMPORARILY RELEASE AND          Y02651 55800002
*  REOBTAINED IF MORE DEVICES ARE TO BE PROCESSED                Y02651 55890002
*                                                                Y02651 55980002
         BAL   R8,RELEASE                                        Y02651 56070002
*                                                                Y02651 56160002
***************************************************              Y02651 56250002
         SPACE 10                                                       56340002
         LA    R15,OFFLMSG         OFFLINE MSG                    19084 56430002
         B     OMSGS               GO ISSUE MESSAGE               19084 56520002
*                                                                 19084 56610002
*                                                                 19084 56700002
UOFFTEST EQU   *                                                  19084 56790002
*        NI    SRTESTAT,FOX-SRTECHGS+SRTEDADI TURN OFF THE ON/OFFY02651 56880002
*                                  AND CONSOLE CHANGE STATUS BITSY02651 56970002
*                                                                Y02651 57060002
*********** THE ABOVE INSTRUCTION WILL BE PROTECTED VIA THE      Y02651 57150002
*           COMPARE-AND-SWAP INSTRUCTION                         Y02651 57240002
*                                                                Y02651 57330002
         STM   R4,R6,D68(R13)     SAVE REGS                      Y02651 57420002
OFFCHGS  EQU   *                                                 Y02651 57510002
         NIL   SRTESTAT,NILCHANG,WREGS=(4,5,6),REF=OUCB          Y02651 57600002
OFFDADI  EQU   *                                                 Y02651 57690002
         NIL   SRTESTAT,NILDADI,WREGS=(4,5,6),REF=OUCB           Y02651 57780002
*        OI    UCBWGT,UCBVORSN                                   Y02669 57870002
*                                                                Y02651 57960002
*********** THE ABOVE INSTRUCTION WILL BE PROTECTED VIA THE      Y02651 58050002
*           COMPARE-AND-SWAP INSTRUCTION                         Y02651 58140002
*                                                                Y02651 58230002
OILOPER2 EQU   *                                                 Y02651 58320002
         OIL   UCBWGT,UCBVORSN,WREGS=(4,5,6),REF=OUCB            Y02651 58410002
         LM    R4,R6,D68(R13)     RESTORE REGS                          58500002
         TM    SRTESTAT,SRTEONLI  IS DEV NOW IN ONLINE STATE            58590002
         BZ    TESTCOMP           OFFLINE, TO GO OFFLINE                58680002
*        OI    SRTESTAT,SRTECHGS  SET ON/OFF CHNG STTS IN UCB           58770002
ONCHGS   EQU   *                                                 Y02651 58860002
         OIL   SRTESTAT,SRTECHGS,WREGS=(4,5,6),REF=OUCB          Y02651 58950002
         LM    R4,R6,D68(R13)                                    Y02651 59040002
*                                                                Y02651 59130002
         L     R1,CVTPTR                                         Y02669 59220002
         USING OCVT,R1                                           Y02669 59310002
         L     R1,CVTMSER                                        Y02669 59400002
         DROP  R1                                                Y02669 59490002
         USING BASE,R1                                           Y02669 59580002
*        OI    MSECBFL,MSSUM   SET THE UCB-SEARCH FLAG IN MRC    Y02651 59670002
OIMSSUM  EQU  *                                                  Y02651 59760002
         OIL   MSECBFL,MSSUM,WREGS=(4,5,6),REF=BASE              Y02651 59850002
         LM    R4,R6,D68(R13)                                    Y02651 59940002
*                                                                Y02651 60030002
         DROP  R1                                                Y02669 60120002
         NI    XADUSWIT,FOX-XAUBLANK SET TO ISSUE NO-MESSAGES  @Z30LPTJ 60210003
         TM    XADUSWIT,XAIOCOMP  I-UNIT OF COMP PROCESSED     @Z30LPTJ 60300003
         BO    GETOUNT            YES, GET O-UNIT AND PROCESS    Y02669 60390002
         TM    XADUSWIT,XAIPAREN  NO, WAS IT THE O-UNIT        @Z30LPTJ 60480003
         BZ    OCONT2        NO,REGUNT,RELEASE AND GOTO NXT UNT  Y02669 60570002
         LR    R9,R8              YES, RESTORE I-UNITS REG PTRS  Y02669 60660002
*                                 R9 HAS I-UNIT'S UNITNAME PTR   Y02669 60750002
         LR    R5,R6              R5 HAS I-UNIT'S UCME PTR       Y02669 60840002
         LR    R12,R11            R12 HAS I-UNIT'S UCB PTR       Y02669 60930002
         NI    XADUSWIT,FOX-XAIPAREN TURN OFF O-UNIT FLAG      @Z30LPTJ 61020003
         OI    XADUSWIT,XAIOCOMP  TURN ON I-UNIT FLAG          @Z30LPTJ 61110003
OCONT2   EQU   *                                                 Y02669 61200002
         SPACE 10                                                       61290002
***************************************************              Y02651 61380002
*                                                                Y02651 61470002
*  THIS ONE DEVICE OF COMP DEVICES HAS BEEN PROCESSED            Y02651 61560002
*  RELEASE LOCKS BEFORE GOING TO THE NEXT DEVICE BECAUSE         Y02651 61650002
*  THERE MAY NOT BE A DEVICE TO PROCESS ANYWAY                   Y02651 61740002
*                                                                Y02651 61830002
         BAL   R8,RELEASE                                        Y02651 61920002
*                                                                Y02651 62010002
***************************************************              Y02651 62100002
         SPACE 10                                                       62190002
         B     OCONT              CONTINUE DO NO SEND MSG        Y02669 62280002
*                                                                Y02669 62370002
TESTCOMP EQU   *                                                 Y02669 62460002
         OI    XADUSWIT,XAUBLANK  SET TO SEND MSG              @Z30LPTJ 62550003
         TM    XADUSWIT,XAIOCOMP  I-UNIT OF COMP PROCESSED     @Z30LPTJ 62640003
         BZ    TESTO              NO CHECK IF O-UNIT OF COMP     Y02669 62730002
GETOUNT  EQU   *                                                 Y02669 62820002
         LR    R8,R9              SAVE I-UNIT'S UNITNAME PTR     Y02669 62910002
         LR    R6,R5              SAVE I-UNIT'S UCME PTR         Y02669 63000002
         LR    R11,R12            SAVE I-UNIT UCB PTR            Y02669 63090002
         L     R5,UCMCOMPC        GET O-UNIT'S UCME              Y02669 63180002
         L     R12,UCMUCB         GET O-UNIT'S UCB               Y02669 63270002
         LA    R9,SIX(R9)         GET O-UNIT'S UNITNAME PTR      Y02669 63360002
         NI    XADUSWIT,FOX-XAIOCOMP TURN OFF I-UNIT FLAG      @Z30LPTJ 63450003
         OI    XADUSWIT,XAIPAREN  SET O-UNIT FLAG              @Z30LPTJ 63540003
         B     UOFFTEST           GO SET BITS IN THE O-UNIT      Y02669 63630002
TESTO    EQU   *                                                 Y02669 63720002
         TM    XADUSWIT,XAIPAREN  WAS IT THE O-UNIT OF COMP    @Z30LPTJ 63810003
         BZ    OFFPTR             NO REG UNIT                    Y02669 63900002
         LR    R9,R8              YES, RESTORE I-UNIT'S REGS     Y02669 63990002
         LR    R5,R6                                             Y02669 64080002
         LR    R12,R11                                           Y02669 64170002
         NI    XADUSWIT,FOX-XAIPAREN TURN OFF O-UNIT FLAG      @Z30LPTJ 64260003
         OI    XADUSWIT,XAIOCOMP  TURN ON I-UNIT'S FLAG        @Z30LPTJ 64350003
         B     OFFPTR                                            Y02669 64440002
*                                                                Y02669 64530002
         EJECT                                                          64620002
*********************************************************************** 64710002
*                                                                 19084 64800002
*        MESSAGE ROUTINE                                          19084 64890002
*                                                                 19084 64980002
*********************************************************************** 65070002
*                                                                 19084 65160002
OMSGS    EQU   *                                                  19084 65250002
         TM    XAAVRANG,XAARNG1    VARY RANGE BEING PROCESSED? @Z30LPTJ 65280003
         BO    OCONT               YES, SUPPRESS THE MESSAGE   @Z30LPTJ 65330003
         ST    R13,XAK             SAVE SAVEAREA POINTER       @Z30LPTJ 65380003
         L     R11,XAD             STORE SWITCHES                 19084 65430002
         LM    R12,R13,XAS         STORE BITS AND SWITCHES        19084 65520002
         LM    R6,R7,XAR           STORE VERB CODE AND LIST POS  Y02669 65610002
         SR    R0,R0                                              19084 65700002
         L     R8,XAU              CONSOLE ID MUST BE SAVED    @Z30LPTJ 65790003
*                                  ACROSS MULTIPLE WTO'S                65880002
         TM    XAU,RIID            READER INTERPRETER COMMAND     19084 65970002
         BO    ORDR                SEND TO MASTER CONSOLE         19084 66060002
         IC    R0,XAU              NO, PICK UP CONSOLE ID         19084 66150002
ORDR     EQU   *                                                  19084 66240002
         MVC   XAH(FOR),OINTRO2    DECLARED MCSFLGS AND LENGTH    19084 66330002
         MVC   XAI(EIT),OBASIC     MESSAGE ID                     19084 66420002
         MVC   XAF(EIT),XAI+SVN    BLANK OUT REST                 19084 66510002
         MVC   XAI+TRE(TRE),ZERO(R15)   MOVE IN ACCURATE MSG ID   19084 66600002
         LA    R15,TRE(R15)          INDEX TO TEXT                19084 66690002
         MVC   XAT(NINETEEN),ZERO(R15) MOVE IN MESSAGE            21051 66780002
         MVC   XAT+NINETEEN(FOR),OEND  ROUT AND DESC CODES        21051 66870002
         MVC   XAF(TRE),ZERO(R9)   MOVE IN UNITS                  19084 66960002
*                                                                 19084 67050002
         LR    R1,R2                                              19084 67140002
*                                                                 19084 67230002
         WTO   MF=(E,(1))          ISSUE MESSGE                   19084 67320002
*                                                                 19084 67410002
*        RESTORE ENVIRONMENT                                      19084 67500002
*                                                                 19084 67590002
         ST    R11,XAD             RESTORE ALL SWITCHES AND INFO  19084 67680002
         STM   R12,R13,XAS         **                             19084 67770002
         L     R13,XAK             RESTORE SAVE AREA POINTER   @Z30LPTJ 67860003
         STM   R6,R7,XAR             **                          Y02669 67950002
         ST    R8,XAU              RESTORE CONSOLE ID IN XSA   @Z30LPTJ 68040003
         MVC   XAV(EIT),OVARY                                    Y02669 68130002
         MVC   XAX(EIT),MODID                                    Y02669 68220002
*                                                                 19084 68310002
OCONT    EQU   *                                                  19084 68400002
         TM    XADUSWIT,XAIPAREN  O-XXX OF A COMPOSITE         @Z30LPTJ 68490003
         BO    NOMONTR            YES, MNTOR CMD CHECKED ALREADY Y02669 68580002
         GETMAIN R,LV=EIGHTY8     GETMAIN CORE FOR PARAM LIST    Y02669 68670002
         ST    R13,TWELV(R1)      STORE VARY'S SAVE AREA PTR     Y02669 68760002
         LA    R14,FOR(R1)        ADDRESS OF PARAM LIST          Y02669 68850002
         ST    R14,ZERO(R1)                                      Y02669 68940002
         USING MPL,R14                                           Y02669 69030002
         XC    FOR(EIT,R1),FOR(R1)  ZERO PARAM AREA              Y02669 69120002
         OI    MPLPROC1,MPLCONS+MPLSTOP                          Y02669 69210002
*                                 SET THE VARY CONSOLE AND STOP  Y02669 69300002
*                                 ALL MONITOR CMDS - OPTION BITS Y02669 69390002
         OI    MPLTYPE1,MPLALL                                   Y02669 69480002
*                                 SET THE MONITOR JOBNAMES,MNTOR Y02669 69570002
*                                 STATUS AND MNITOR SESSIONS BIT Y02669 69660002
*                                 ON SO THEY WILL STOP ALL THREE Y02669 69750002
*                                 FROM GOING TO THIS CONSOLE     Y02669 69840002
*                                                                Y02669 69930002
*  REG 5 STILL PTS TO THE VARIED DEVICE'S UCME                   Y02669 70020002
*                                                                Y02669 70110002
         SR    R13,R13                                           Y02669 70200002
         IC    R13,UCMID          GET THE CONSOLE ID OF THE DEV  Y02669 70290002
         STC   R13,MPLID+ONE      PLACE IT IN THE PARAMLIST      Y02669 70380002
*                                 RIGHT JUSTIFIED                Y02669 70470002
         LA    R13,SIXTN(R1)       SAVE AREA FOR VMNTR PTR       Y02669 70560002
*                                                                Y02669 70650002
* REG 10 STILL HAS THE ADDRESS OF THE UCM                        Y02669 70740002
*                                                                Y02669 70830002
         L     R15,UCMMNTR        GET ADDRESS OF THE ROUTINE     Y02669 70920002
*                                 IEAVMNTR- FROM THE UCM         Y02669 71010002
         BALR  R14,R15            GO TO IEAVMNTR                 Y02669 71100002
*                                                                Y02669 71190002
         L     R13,TWELV(R1)      RE-ADDRESS R14 WITH CALLER'S   Y02669 71280002
         LA    R0,EIGHTY8         SIZE OF THE PARAM LIST AND SA  Y02669 71370002
         FREEMAIN R,LV=(0),A=(1)  FREE THE CORE                  Y02669 71460002
NOMONTR  EQU   *                                                 Y02669 71550002
         TM    XADUSWIT,XAIOCOMP   PROCESSING COMP I-XXX?      @Z30LPTJ 71640003
         BZ    ONOCOMP             NO                             19084 71730002
         LA    R9,SIX(R9)          INDEX TO O-XXX                 19084 71820002
         NI    XADUSWIT,FOX-XAIOCOMP TURN OFF COMP SWITCH      @Z30LPTJ 71910003
         OI    XADUSWIT,XAIPAREN   BUT TURN ON INTERNPAREN SW  @Z30LPTJ 72000003
         L     R5,UCMCOMPC         GET PTR TO O-UNITS UCME        19084 72090002
         L     R12,UCMUCB          GET PTR TO OUTPUT UCB          19084 72180002
         TM    XADUSWIT,XAUBLANK   MUST ISSUE THE MSG          @Z30LPTJ 72270003
         BZ    ONOCOMP            NO RETURN                             72360002
         LA    R15,OFFLMSG        YES, ASSUME OFFLINE MSG               72450002
         TM    XASOPCOD,XAON        WAS IT THE ONLINE MSG               72540003
         BZ    OMSGS              NO, OFFLINE MSG                       72630002
         LA    R15,ONLMSG         ONLINE MSG                            72720002
         B     OMSGS              GO ISSUE MSG FOR THE O-UNIT           72810002
*                                                                 19084 72900002
ONOCOMP  EQU   *                                                  19084 72990002
         TM    XADUSWIT,XAIPAREN   PROCESSING COMP O-UNIT?     @Z30LPTJ 73080003
         BZ    OENDCK              NO, OF                         19084 73170002
         LA    R9,ONE(R9)          YES,ADD ONE FOR INTERN PAREN   19084 73260002
         B     OENDCK              GO CHECK IF END                19084 73350002
*                                                                 19084 73440002
         SPACE 10                                                 19084 73530002
ONOMORE  EQU   *                                                  19084 73620002
         TM    XADUSWIT,XAUDVC     DO WE HAVE IOUNITS YET      @Z30LPTJ 73710003
         BZ    RETEXT              NO, RETURN                    Y02669 73800002
IOLOOP   EQU   *                                                  19084 73890002
         CLI   ZERO(R9),ONOFKEY    IS AN O-XXX FOR ONLINE/OFFLINE 19084 73980002
         BE    O3103D              YES, GO CHECK FURTHER          19084 74070002
OINDEX   LA    R9,ONE(R9)          INDEX TO NEXT CHARACTER        19084 74160002
         B     IOLOOP              GO CHECK FOR -O-               19084 74250002
*                                                                 19084 74340002
O3103D   EQU   *                                                  19084 74430002
         CLI   ONE(R9),NLINE       MAKE SURE IF KEYWORD, IS IT AN -N-   74520002
         BE    OEXT                YES, GO TO 3103D               19084 74610002
         CLI   ONE(R9),FFLINE      NO, IS IT AN -F- FOR FFLINE    19084 74700002
         BNE OINDEX                NO, KEYWORD NO FOUND YET       19084 74790002
*                                                                 19084 74880002
OEXT     EQU   *                                                  19084 74970002
         BCTR  R9,ZERO             PT TO COMMA BEFORE KEYWORD     19084 75060002
         ST    R9,XAR              3103D NEEDS THIS POINTER       19084 75150002
         MVC   XAX+TRE(TWO),IOMOD      3103D NAME                Y02669 75240002
         LM    R0,R15,ZERO(R13)    RESTORE REGS                  Y02669 75330002
         L     R15,VCON31         ADDRESS OF IEE3103D            Y02669 75420002
         BR    R15                GO TO 3103D                    Y02669 75510002
*                                                                 19084 75600002
*                                                                 19084 75690002
*                                                                 19084 75780002
         SPACE 5                                                        75870002
RETEXT   EQU   *                                                 Y02669 75960002
         TM    XAAVRANG,XAARNG1    VARY RANGE BEING PROCESSED? @Z30LPTJ 75970003
         BNO   PROCEED             NO, PROCEED NORMALLY        @Z30LPTJ 75980003
         L     R15,VCON904         GET IEECB904 ADDRESS        @Z30LPTJ 75990003
         BR    R15                 GO TO VARY RANGE PROCESSOR  @Z30LPTJ 76000003
PROCEED  EQU   *                                               @Z30LPTJ 76010003
         SPACE 5                                                        76050003
***************************************************              Y02651 76140002
*                                                                Y02651 76230002
*  THIS IS A TERMINAL EXIT.  THE ENQ ISSUED IN MODULE            Y02651 76320002
*  IEE3603D                                                      Y02651 76410002
*  WE MUST BE DEQUEUED HERE                                      Y02651 76500002
*                                                                Y02651 76590002
         DEQ   MF=(E,IEFDEQUE)                                   Y02651 76680002
*                                                                Y02651 76770002
***************************************************              Y02651 76860002
         SPACE 5                                                        76950003
         L     R1,D64(R13)         GET CSCB PTR                  Y02669 77040002
         USING CHAIN1,R1                                         Y02669 77130002
         OI    CHSTS,CHFC          SET TO FREE CSCB              Y02669 77220002
         MGCR  (1),CHAIN                                         Y02669 77310002
         LM    R0,R15,ZERO(R13)    RESTORE REGS                  Y02669 77400002
         LR    R4,R14              SAVE RETURN ADDRESS           Y02669 77490002
*                                  FREE SAVE AREA GOTTEN IN 3303DY02669 77580002
         LR    R1,R2               DUMMY XSA POINTER             Y02669 77670002
         LA    R0,D132             DUMMY XSA SIZE                Y02669 77760002
         FREEMAIN R,LV=(0),A=(1)                                 Y02669 77850002
*                                  FREE DUMMY XSA GOTTEN IN 3603DY02669 77940002
         LR    R14,R4              RESTORE RETURN REG            Y02669 78030002
         BR    R14                 RETURN                        Y02669 78120002
         EJECT                                                          78210002
*********************************************************************** 78300002
*                                                                 19084 78390002
*       DECLARES                                                  19084 78480002
*                                                                 19084 78570002
*********************************************************************** 78660002
         DS    0F                                                Y01022 78750002
OOUNIT   DC    C'O-'               O-XXX                          19084 78840002
OIUNIT   DC    C'(I-'              COMPOSITE                      19084 78930002
*                                                                 19084 79020002
OINTRO2  DC    X'0027A100'             LENGTH AND MCSFLAGS        21051 79110002
OBASIC   DC    C'IEE   I '         MSG ID                         19084 79200002
OEND     DC    X'08000000'         DESC AND ROUT CODES            19084 79290002
*                                                                 19084 79380002
         SPACE 10                                                 19084 79470002
*                                                                 19084 79560002
IOMOD    DC    C'31'         IO VARY MODULE                      Y02669 79650002
OVARY    DC    C'VARY    '         VARY COMMAND                   19084 79740002
         DS    0F                                                Y02669 79830002
VCON31   DC    V(IEE3103D)        VCON OF IEE3103D               Y02669 79920002
VCON904  DC    V(IEECB904)        VCON OF IEECB904             @Z30LPTJ 79960003
MODID    DC    C'IEE4603D'                                       Y02669 80010002
*                                                                 19084 80100002
         EJECT                                                          80190002
*****************************************************************Y02651 80280002
*                                                                Y02651 80370002
*  THE LIST FORM OF THE DEQ MACRO INSTRUCTION FOLLOWS            Y02651 80460002
*                                                                Y02651 80550002
IEFDEQUE DEQ   (IEFSQCBS,IEFQ4QCB,TWO,SYSTEM,IEFSQCBS,IEFVQCBS,SVN,    *80660002
               SYSTEM),RET=HAVE,MF=L                           @YM5443P 80680002
IEFVQCBS DC    C'VARYDEV'                                               80700002
IEFSQCBS DC    C'SYSIEFSD'                                       Y02651 80730002
IEFQ4QCB DC    C'Q4'                                             Y02651 80820002
*                                                                Y02651 80910002
*****************************************************************Y02651 81000002
         EJECT                                                          81090002
*****************************************************************Y02651 81180002
*                                                                Y02651 81270002
*  THE RELEASE-LOCKS SUBROUTINE FOLLOWS                          Y02651 81360002
*  THESE LOCKS WERE OBTAINED IN THIS MODULE AT:                  Y02651 81450002
*        OSETLOCK                                                Y02651 81540002
*                                                                Y02651 81630002
         DS    0H                                                       81670002
RELEASE  EQU   *                                                 Y02651 81720002
         LR    R0,R8                                             Y02651 81810002
*                                 SAVE RETURN ADDRESS            Y02651 81900002
         LR    R8,R13             SAVE AREA POINTER              Y02651 81990002
         STM   R11,R14,D68(R8)                                   Y02651 82080002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(IEE4603D(OSETLOCK))   Y02651 82170002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(IEE4603D(OSETLOCK)) Y02651 82260002
         LM    R11,R14,D68(R8)                                   Y02651 82350002
         LR    R8,R0              RESTORE RETURN ADRS            Y02651 82440002
         BR    R8                                                Y02651 82530002
*                                                                Y02651 82620002
*****************************************************************Y02651 82710002
         EJECT                                                          82800002
*********************************************************************** 82890002
*                                                                 19084 82980002
*        MESSAGES                                                 19084 83070002
*                                                                 19084 83160002
*********************************************************************** 83250002
*                                                                 19084 83340002
ONLMSG   DC    C'302'              ID OF ONLINE MSG               19084 83430002
         DC    C'ONLINE             '  TEXT                       21051 83520002
*                                                                 19084 83610002
*                                                                 19084 83700002
*                                                                 19084 83790002
OFFLMSG  DC    C'303'              ID OF OFFLINE MSG              19084 83880002
         DC    C'OFFLINE            '  TEXT                       21051 83970002
*                                                                 19084 84060002
         SPACE 5                                                        84150002
PATCH    DC    CL80'***IEE4603D***'                                     84240002
         EJECT                                                          84330002
OXSA     DSECT                                                          84420002
         IEEXSA                                                         84510002
         EJECT                                                          90450002
         IEZMPL                                                         90540002
         EJECT                                                          90630002
OCVT     DSECT                                                          90720002
         CVT                                                            90810002
         EJECT                                                          90900002
OUCM     DSECT                                                          90990002
         IEECUCM  FORMAT=NEW                                            91080002
         EJECT                                                          91170002
OUCB     DSECT                                                          91260002
         IEFUCBOB                                                       91350002
         EJECT                                                          91440002
CHAIN1   DSECT                                                          91530002
         IEECHAIN                                                       91620002
         EJECT                                                          91710002
         IEEBASEA                                                       91800002
         EJECT                                                          91890002
         IHAPSA                                                         91980002
         END                                                            92070002
