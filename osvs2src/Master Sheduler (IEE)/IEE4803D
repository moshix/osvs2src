 TITLE 'IEE4803D - CONSOLE INFORMATION MESSAGE ROUTINE #1'              00100003
IEE4803D CSECT                                                          00200002
*********************************************************************** 00300002
* MODULE NAME      = IEE4803D                                           00400002
*   CSECT NAME     = IEE4803D                                           00500002
*                                                                       00600002
* LOAD MODULE NAME = IEE3603D                                           00700002
*                                                                       00800002
* DESCRIPTIVE NAME = CONSOLE INFORMATIONAL MESSAGE ROUTINE              00900002
*                                                                       01000002
* COPYRIGHT        = MISSING                                            01100002
*                                                                       01200002
* STATUS           = OS/VS/2 RELEASE 3                         @Z30LPTJ 01300003
*                                                                       01400002
* FUNCTION         = THIS MODULE USES THE UCM AND THE UCB TO            01500002
*                    CONSTRUCT A MESSAGE DISPLAYING THE CURRENT         01600002
*                    STATUS OF THE CONSOLE                              01700002
*                    THE MESSAGE CONTAINS THE PHYSICAL DEVICE ADDRESS   01800002
*                    OF THE CONSOLE AND ITS ALTERNATE, AND WHETHER      01900002
*                    THE CONSOLE IS ACTIVE AND/OR THE MASTER CONSOLE.   02000002
*                                                                       02100002
* OPERATION        = ON ENTRY, THIS ROUTINE GETS THE UNIT'S UCM AND     02200002
*                    UCB POINTERS AND FILLS THE MESSAGE BUFFER WITH     02300002
*                    ALL THE PERTINENT INFORMATION ABOUT THE NEW        02400002
*                    CONSOLE SUCH AS ITS COMPOSITE (IF ANY), ITS        02500002
*                    ALTERNATE CONSOLE, WHETHER IT IS A HARDCPY         02600002
*                    DEVICE OR NOT, ITS ROUT CODES AND ITS COMMAND      02700002
*                    COMMAND AUTHORITY.                                 02800002
*                    ALSO INFO SUCH AS WHETHER THE NEW CONSOLE IS       02900002
*                    ALREADY ACTIVE AS A CONSOLE OR WHETHER IT          03000002
*                    IS PENDING TO CHANGE TO THE CONSOLE STATE AS       03100002
*                    SOON AS ANY PREVIOUS WORK THAT IT DID AS A         03200002
*                    SYSTEM DEVICE IS COMPLETE.                         03300002
*                    IT ALSO SHOWS WHETHER THIS IS THE MASTER CONSOLE   03400002
*                    WHEN ALL THE INFO HAS BEEN GATHERED AND PLACED     03500002
*                    IN THE MESSAGE BUFFER, THIS ROUTINE EXITS TO       03600002
*                    IEE7303D TO ACTUALLY ISSUE THE WTO TO THE          03700002
*                    OPERATOR.                                          03800002
*                    IF THE ROUTINE WAS ENTERED FROM IEE7303D TO SET    03900002
*                    UP THE HARDCPY MESSAGE BECAUSE THE CONSOLE IS      04000002
*                    THE SYSTEM HARDCPY DEVICE AS WELL, THEN IT         04100002
*                    PRESETS THE MESSAGE TO TELL THE OPERATOR THAT      04200002
*                    FACT.                                              04300002
*                                                                       04400002
* NOTES                                                                 04500002
*   DEPENDENCIES   = NONE                                               04600002
*   CHARACTER/CODE DEPENDENCIES                                         04700002
*                  = THIS MODULE CAN BE ASSEMBLED WITH ANY NEW          04800002
*                    CHARACTER/CODE SET.                                04900002
*                                                                       05000002
* RESTRICTIONS     = SEE ENTRY POINTS - INPUT DATA                      05100002
*   REGISTER CONVENTIONS                                                05200002
*                  = REGISTERS ARE DEFINED AT LABEL: DEFREG             05300002
*   PATCH LABEL    = PATCH                                              05400002
*                                                                       05500002
* MODULE TYPE      = CSECT                                              05600002
*   PROCESSOR      = ASSEMBLER                                          05700002
*   MODULE SIZE    = VS2 = '38E'                               @ZM30445 05800003
*   ATTIBUTES      = REENTRANT, REFRESHABLE, REUSABLE,                  05900003
*                    ZERO PSW PROTECT KEY                               06000002
*                                                                       06100002
* ENTRY POINTS     = IEE4803D FROM IEE4903D OR IEE7303D                 06200002
*   PURPOSE        = TO SET UP THE CONSOLE INFORMATIONAL MESSAGE        06300002
*                    WHEN A VARY CONSOLE COMMAND WAS ISSUED             06400002
*                    AND TO SET THE HARDCPY MESSAGE IF THAT             06500002
*                    NEW CONSOLE IS THE HARDCPY DEVICE AS WELL.         06600002
*   LINKAGE        = BRANCH                                             06700002
*   INPUT          = REG13 CONTAINS THE SAVE AREA POINTER               06800002
*                    WORD 17 OR THE SAVE AREA HAS THE PTR TO THE CSCB   06900002
*                    REG2 CONTAINS THE PTR TO THE DUMMY XSA             07000002
*                    XAP HAS THE MLWTO ID IN THE THREE HIGH             07100002
*                    ORDER BYTES AND THE GRAPHICS INDICATOR             07200002
*                    IN THE LOW BYTE                                    07300002
*                    REG1 POINTS TO THE MESSAGE CORE GOTTEN BY          07400002
*                    IEE4903D                                           07500002
*                    THE XAD SWITCHES ARE STORED IN THE DUMMY XSA       07600002
*                    XAR OF THE DUMMY XSA HAS THE PROCESS SWITCHES      07700002
*                    XAL HAS THE PTR TO THE PARMS OF THE COMMAND        07800002
*                                                                       07900002
*                    IF ENTRY IS FROM IEE7303D THEN THE FOLLOWING       08000002
*                    IS ALSO TRUE:                                      08100002
*                    REG11 CONTAINS AN INDICATOR FOR THE HARDCPY MSG    08200002
*                    THE XARESV FIELD OF THE DUMMY XSA HAS THE HIGH     08300003
*                    ORDER BIT SET TO MEAN THAT A BRANCH HAS TO BE      08400002
*                    IMMEDIATELY MADE TO 'CENDCHK'                      08500002
*                    REG9 POINTS TO THE CURRENT PROCESSED UNITNAME      08600002
*   REGISTERS SAVED = ALL                                               08700002
*   REGISTER USAGE  =REG1 ON INPUT IS THE POINTER TO THE MESSAGE CORE   08800002
*                    REG2 PTS TO THE DUMMY XSA                          08900002
*                    REG3 ADDRESSABILITY                                09000002
*                    REG4 PROCESS BITS                                  09100002
*                    REG5 UCME PTR                                      09200002
*                    REG9 UNIT PTR                                      09300002
*                    REG10 UCM PTR                                      09400002
*                    REG11 HARDCPY OF NOHCPY MSG SWITCH                 09500002
*                    REG12 MESSAGE ADDRESSABILITY                       09600002
*                    REG13 SAVE AREA PTR                                09700002
*                    REG14 COMPOSITE SWITCH                             09800002
*   REGISTERS RESTORED                                                  09900002
*                  = ALL                                                10000002
*                                                                       10100002
* EXITS - NORMAL-1-= TO IEE7303D VIA BRANCH                             10200002
*   CONDITIONS     = TO FINISH CONSTRUCTION MESSAGE AND TO ISSUE        10300002
*                    IT TO THE OPERATOR                                 10400002
*   OUTPUT         = REG2 PTS TO THE DUMMY XSA                          10500002
*                    R0 HAS THE COMPOSITE UCME PTR OR IS 0              10600002
*                    REG13 PTS TO THE SAVE AREA, WORD17 OF THE          10700002
*                    SAVE AREA HAS THE CSCB PTR                         10800002
*                    REG1 PTS TO THE MESSAGE CORE GOTTEN BY 4903D       10900002
*                    THE XAD SWITCHES ARE STORED IN THE DUMMY XSA       11000002
*                    XAR OF THE DUMMY XSA HAS THE PROCESS SWITCHES      11100002
*                    XAL OF THE DUMMY XSA HAS THE POINTER TO THE        11200002
*                    PARMS OF THE COMMAND                               11300002
*                    XARESV FIELD OF THE DUMMY XSA  HAS BIT1 SET TO     11400003
*                    INDICATE TO TAKE AN IMMEDIATE BRANCH TO            11500002
*                    LABEL: 'CRT2'                                      11600002
*                    XAP HAS THE MLWTO ID                               11700002
*                    REG4 HAS THE PROCESS BITS                          11800002
*                    REG 9 PTS TO THE UNIT                              11900002
*                    REG11 WILL BE 0 UNLESS THE HARDCPY MSG IS NEEDED   12000002
*                    THEN IT WILL CONTAIN THE PTR TO THE UCME OF        12100002
*                    THE HARDCPY UNIT                                   12200002
*                    REG12 HAS THE ADDRESS OF THE MESSAGE AREA          12300002
*   RETURN CODES   = NONE                                               12400002
*                                                                       12500002
* EXITS - NORMAL-2- = RETURN TO CALLER                                  12600002
*   CONDITIONS     = ALL NECESSARY MESSAGES HAVE BEEN ISSUED            12700002
*   OUTPUT         = THE CSCB CORE IS FREED VIA AN MGCR MACRO           12800002
*                    THE DUMMY XSA AND THE SAVE AREA CORE ARE           12900002
*                    FREEMAINED                                         13000002
*                    THE MESSAGE BUFFER IS ALSO FREEMAINED              13100002
*   RETURN CODES   = NONE                                               13200002
*                                                                       13300002
* EXITS - ERROR    = NONE                                               13400002
*                                                                       13500002
* EXTERNAL REFERENCES                                                   13600002
*   ROUTINES       = IEE7303D                                           13700002
*   DATA AREAS     = SEE EXITS - OUTPUT DATA                            13800002
*                                                                       13900002
* CONTROL BLOCKS   = 1. DUMMY EXTENDED SAVE AREA (XSA)                  14000002
*                    2. CVT                                             14100002
*                       FIELDS TESTED  - CVTCUCB                        14200002
*                       FIELDS UPDATED - NONE                           14300002
*                    3. UNIT CONTROL BLOCK (UCB)                        14400002
*                       FIELDS TESTED  - SRTESTAT -BIT= SRTEDADI        14500002
*                                        UCBNAME                        14600002
*                       FIELDS UPDATED - NONE                           14700002
*                    4. UNIT CONTROL MODULE (UCM)                       14800002
*                       FIELDS TESTED  - UCMALTEN                       14900002
*                                        UCMAUTH                        15000002
*                                        UCMCOMPC                       15100002
*                                        UCMDISP -BIT= UCMDISPB         15200002
*                                                      UCMDISPA         15300002
*                                                      UCMDISPD         15400002
*                                        UCMHRDRT                       15500002
*                                        UCMSDS1 - BIT=UCMSDS1A         15600002
*                                                      UCMSDS1B         15700002
*                                        UCMSFLGS - BIT=UCMSYSC         15800002
*                                        UCMUCB                         15900002
*                                        UCMVEA                         16000002
*                       FIELDS UPDATED - NONE                           16100002
*                    5. COMMAND SCHEDULING CONTROL BLOCK (CSCB)         16200002
*                       FIELDS TESTED  - NONE                           16300002
*                       FIELDS UPDATED - CHSTS - BIT=CHFC               16400002
*                                                                       16500002
* TABLES           = NONE                                               16600002
*                                                                       16700002
* MACROS           = MGCR,FREEMAIN,SETLOCK,DEQ                          16800002
*                                                                       16900002
* MAPPING MACROS   = IEEXSA                                             17000002
*                    CVT                                                17100002
*                    IEECUCM                                            17200002
*                    IEFCUBOB                                           17300002
*                    IEECHAIN                                           17400002
*                    IHAPSA                                             17500002
*   SERIALIZATION  = PROTECTION FROM COMM. TASK IS ACCOMPLISHED         17600002
*                    VIA THE CMS AND LOCAL LOCKS OBTAINED AT:           17700002
*                       CSETLOCK IN THIS MODULE                         17800002
*                    THESE LOCKS ARE RELEASED AT:                       17900002
*                       UNSTLOCK IN MODULE IEE7303D                     18000002
*                    PROTECTION AGAINST OLTEP, VARY/UNLOAD AND          18100002
*                    ALLOCATION IS ACCOMPLISHED VIA THE ENQ ISSUED IN   18200002
*                    MODULE IEE3603D.                                   18300002
*                    A DEQ WILL BE ISSUED AT CDEQUE IN THIS MODULE      18400002
*                    IF THE COMAND HAS A TERMINAL EXIT FROM HERE.       18500002
*                    OTHERWISE, THE DEQ WILL BE ISSUED IN MODULE        18600002
*                    IEE7303D  WHERE THE MODULE WILL EXIT IF NOT        18700002
*                    EXITING FROM HERE.                                 18800002
*                                                                       18900002
* CHANGE LEVEL     = Y02669, Y02651, Z30LPTJ, ZM30445          @ZM30445 19000003
*                                                                       19100002
* CHANGE ACTIVITY  = N/A                                                19200002
*                                                                       19300002
* MESSAGES         = REFER TO PROLOGUE OF IEE4903D FOR FULL INFO.       19400002
*                                                                       19500002
* ABEND CODES      = NONE                                               19600002
*                                                                       19700002
* PACKAGING        = IEE4803D WILL BE PART OF LOAD MODULE               19800002
*                       IEE3603D                                        19900002
*                    THIS LOAD MODULE ALIASES ARE                       20000002
*                       NONE                                            20100002
*                    THIS LOAD MODULE ENTRY POINTS ARE                  20200002
*                       IEE3603D                                        20300002
*                    MODULE WILL RESIDE IN:  LPALIB                     20400002
*                                                                       20500002
* SYSGEN           = SUPPLIED BY THE FOLLOWING SECTIONS:                20600002
*                       LOAD MODULE NAME                                20700002
*                       PACKAGING                                       20800002
*                    THIS CSECT WILL BE INCLUDED AT SYSGEN FROM         20900002
*                    DLIB -AOSB3- BY MACRO -SGIEF441-                   21000002
*                                                                       21100002
* SYSTEM LIBRARIES = NONE                                               21200002
*                                                                       21300002
*********************************************************************** 21400002
         EJECT                                                          21500002
*                                                                 19084 21600002
*********************************************************************** 21700002
*                                                                 19084 21800002
*        REGISTER EQUATES                                         19084 21900002
*                                                                 19084 22000002
*********************************************************************** 22100002
DEFREG   EQU   *                                                 Y02669 22200002
R0       EQU   0          OUTPUT TO 7303D = COMPOSITE PTR OR 0   Y02669 22300002
R1       EQU   1                   IN-PTR TO WTO CORE             19084 22400002
R2       EQU   2                   XSA                            19084 22500002
R3       EQU   3                   ADDRESSABILITY                Y02669 22600002
R4       EQU   4                   PROCESS BITS                  Y02669 22700002
R5       EQU   5                   UCME PTR                      Y02669 22800002
R6       EQU   6                                                  19084 22900002
R7       EQU   7                                                        23000002
R8       EQU   8                                                        23100002
R9       EQU   9                   UNIT PTR                       19084 23200002
R10      EQU   10                  UCM                            19084 23300002
R11      EQU   11                  HCPY OR NOHCPY MSG SWITCH      19084 23400002
R12      EQU   12                  MSG ADDRESSABILITY             19084 23500002
R13      EQU   13                  SAVE AREA PTR                        23600002
R14      EQU   14                  COMPOSITE SWITCH IN THIS RTN. Y02669 23700002
R15      EQU   15                                                 19084 23800002
*                                                                 19084 23900002
         SPACE 10                                                       24000002
*********************************************************************** 24100002
*                                                                 19084 24200002
*        CONSOLE MESSAGE PROCESSOR                                19084 24300002
*                                                                 19084 24400002
*********************************************************************** 24500002
*                                                                 19084 24600002
         EJECT                                                          24700002
         SPACE 10                                                       24800002
*********************************************************************** 24900002
*                                                                 19084 25000002
*        EQUATES                                                  19084 25100002
*                                                                 19084 25200002
*********************************************************************** 25300002
ZERO     EQU   0                                                  19084 25400002
ONE      EQU   1                                                  19084 25500002
TWO      EQU   2                                                  19084 25600002
TRE      EQU   3                                                  19084 25700002
FOR      EQU   4                                                  19084 25800002
FIV      EQU   5                                                  19084 25900002
SIX       EQU   6                                                 19084 26000002
SVN      EQU   7                                                  19084 26100002
EIT      EQU   8                                                  19084 26200002
TWLV     EQU   12                                                 19084 26300002
THIRTY6  EQU   36                                                Y02669 26800002
FORTY4   EQU   44                                                Y02669 26900002
BLANK    EQU   C' '                                               19084 27100002
COMMA    EQU   C','                                               19084 27200002
SLASH    EQU   C'/'                                               19084 27300002
CHCPY    EQU   C'H'                                               19084 27400002
CACTIVE  EQU   C'A'                                               19084 27500002
CMSTCONS EQU   C'M'                                               19084 27700002
FOXES    EQU   X'FF'                                              19084 28000002
L3       EQU   3                                                  19084 28400002
L67      EQU   67                                                 19084 28500002
SHIFT16  EQU   16                                                 19084 28700002
SHIFT1   EQU   1                                                  19084 28800002
D64      EQU   64                                                Y02669 29000002
D68      EQU   68                                                Y02669 29100002
D132     EQU   132                                               Y02669 29200002
RI       EQU   X'80'                                           @ZM30445 29300003
         EJECT                                                    19084 29400002
         BALR  R3,ZERO                                            19084 29500002
         USING *,R3                                               19084 29600002
         MODID BR=YES                                            Y01886 29700002
         USING XSA,R2                                             19084 29800002
*                                                                       29900002
         STM   R0,R15,ZERO(R13)                                  Y02669 30000002
         L     R4,XAR              GET PROCESS SWITCHE IN REG 7   19084 30100002
         LR    R12,R1              GOTTEN CORE FOR MSG            19084 30200002
         USING CMESSAGE,R12        ADDRESS MSG AREA               19084 30300002
         L     R10,CVTPTR                                         19084 30400002
         USING XCVT,R10                                           19084 30500002
         L     R10,CVTCUCB         GET PTR TO UCM                 19084 30600002
         DROP  R10                                                19084 30700002
         USING UCM,R10                                                  30800002
         USING UCMLIST,R5                                         19084 30900002
         TM    XARESV,XACENDCK    SHOULD 48 BRANCH TO CENDCHK  @Z30LPTJ 31000003
*                                 BECAUSE THIS IS A 2ND ENTRY           31100002
         BO    CENDCHK            YES, HARDCOPY OR MULTIPLE UNITS 21002 31200002
         L     R9,XAL              GET PTR TO UNITS               19084 31300002
         LA    R9,ZERO(R9)         CLEAR HIGH ORDER BYTE          19084 31400002
         SR    R11,R11                 HARDCOPY INDICATOR         21002 31500002
*                                                                 19084 31600002
         TM    XADUSWIT,XAXPAREN   MULTIPLE UNITS              @Z30LPTJ 31700003
         BZ    CSINGLE             NO,PTR IS OK                   19084 31800002
CPAREN   LA    R9,ONE(R9)          YES, INDEX BY ONE             Y02669 31900002
         NI    XADUSWIT,XAXPAREN   OFF,ALL BUT UDVC AND XPAREN @Z30LPTJ 32000003
CSINGLE  EQU   *                                                  19084 32100002
         CLC   ZERO(TWO,R9),COUNIT UNIT IS O-XXX                  19084 32200002
         BNE   CCOMP               NO,MAYBE COMPOSITE             19084 32300002
         LA    R9,TWO(R9)          INDEX TO UNIT NAME             19084 32400002
         B     CPROCESS            GO PROCESS                     19084 32500002
*                                                                 19084 32600002
CCOMP    EQU   *                                                  19084 32700002
         CLC   ZERO(TRE,R9),CIUNIT IS IT A COMPOSITE              19084 32800002
         BNE   CPROCESS            NO, REG UNIT                  Y02669 32900002
         OI    XADUSWIT,XAIOCOMP   YES, SET COMP SWITCH        @Z30LPTJ 33000003
         LA    R9,TRE(R9)          INDEX TO I-UNIT NAME           19084 33100002
*                                                                 19084 33200002
         EJECT                                                          33300002
         SPACE 10                                                 19084 33400002
CPROCESS EQU   *                                                  19084 33500002
         LTR   R4,R4               IS PROCESS FLAG ON             19084 33600002
         BZ    CHCPYCK                 NO MORE UNITS TO PROCESS   21002 33700002
         BNM   CENDCHK                 DON'T PROCESS THIS UNIT    21002 33800002
CUCME    EQU   *                                                  21002 33900002
         LM    R5,R7,UCMVEA    GET PTR TO FIRST AND LAST UCME     21002 34000002
CLOOP    L     R1,UCMUCB               AND UCB                    21002 34100002
         USING XUCB,R1                                            21002 34200002
         CLC   ZERO(TRE,R9),UCBNAME    IT IS SOUGHT UCME          21002 34300002
         BE    CPROC                   YES                        21002 34400002
         BXLE  R5,R6,CLOOP             NO, TRY ANOTHER            21002 34500002
*                                                                 19084 34600002
         EJECT                                                          34700002
CPROC    MVI   XTEXT,BLANK         BLANK OUT                      19084 34800002
         MVC   XTEXT+ONE(L67),XTEXT AREA                          19084 34900002
         USING XUCB,R1                                            19084 35000002
         SPACE 10                                                       35100002
*************************************************                Y02651 35200002
*                                                                Y02651 35300002
*  LOCKS MUST BE ACQUIRED NOW TO PROTECT AGAINST ANY BIT CHANGES Y02651 35400002
*  BY COMM. TASK                                                 Y02651 35500002
*                                                                Y02651 35600002
CSETLOCK EQU   *                                                 Y02651 35700002
         LR    R8,R13             SAVE AREA POINTER              Y02651 35800002
         STM   R11,R14,D68(R8)    SAVE SETLOCK REGS              Y02651 35900002
         SETLOCK  OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 Y02651*36000002
               RELATED=(IEE7303D(UNSTLOCK))                      Y02651 36100002
         SETLOCK  OBTAIN,TYPE=CMS,MODE=UNCOND,                   Y02651*36200002
               RELATED=(IEE7303D(UNSTLOCK))                      Y02651 36300002
         LM    R11,R14,D68(R8)                                   Y02651 36400002
*************************************************                Y02651 36500002
         SPACE 10                                                       36600002
         TM    UCMDISP,UCMDISPB    IS UNIT ALSO HCPY             Y02669 36700002
         BZ    CNOHCPY             NO, BRANCH AROUND              19084 36800002
         LR    R11,R5              YES, KEEP PTR TO UCME FOR LATER19084 36900002
*                                                                 19084 37000002
CNOHCPY  EQU   *                                                  19084 37100002
         L     R14,UCMCOMPC        PTR TO COMP OR ZEROES IF NONE Y02669 37200002
*                                                                 19084 37300002
         LTR   R14,R14             ANY COMPOSITE                 Y02669 37400002
         BZ    CONEU               NO, SINGLE UNIT                19084 37500002
         DROP  R5                                                 19084 37600002
         USING UCMLIST,R14                                       Y02669 37700002
         TM    UCMDISP,UCMDISPB    MAYBE O-UNIT IS HCPY           19084 37800002
         DROP  R14                                               Y02669 37900002
         USING UCMLIST,R5                                         19084 38000002
         BZ    CMOVE               NO, OK                         19084 38100002
         LR    R11,R5              YES,PTR TO UCME OF I-UNIT FOR  19084 38200002
*                                      HARDCPY MESSAGE            19084 38300002
CMOVE    EQU   *                                                  19084 38400002
         MVC   XUNIT1(L3),UCBNAME  MOVE IN 1-UNIT                 19084 38500002
         MVI   XBLANK,COMMA        MOVE COMMA                     19084 38600002
         L     R1,TWLV(R14)        GET UCB OF O-UNIT             Y02669 38700002
CONEU    EQU   *                                                  19084 38800002
         MVC   XUNIT2(L3),UCBNAME  MOVE IT IN                     19084 38900002
         MVI   XCOMMA,SLASH        MOVE IN SLASH TO DELIMIT ALTERN19084 39000002
         L     R6,UCMALTEN         GET ITS PTR                    19084 39100002
         DROP  R5                                                 19084 39200002
         USING UCMLIST,R6                                         19084 39300002
         LTR   R6,R6               HAVE AN ALTERNATE?            Y02669 39350002
         BZ    CATTRB              NOPE, A ONE CONS SYSTEM       Y02669 39360002
         L     R1,UCMUCB           GET UCB PTR                    19084 39400002
         MVC   XAUNIT1(L3),UCBNAME MOVE IN 1-OF ALTCONS           19084 39500002
         L     R6,UCMCOMPC         GET COMP OF ALTERNATE          19084 39600002
         LTR   R6,R6               ANY                            19084 39700002
         BZ    CATTRB              NO,GO CHECK CONS ATTRIBUTES    19084 39800002
         MVI   XBLK,COMMA          YES, MOVE DELIMITING COMMA     19084 39900002
         L     R1,UCMUCB                                          19084 40000002
         MVC   XAUNIT2(L3),UCBNAME MOVE IN O-ALT UNIT             19084 40100002
         DROP  R6,R1                                              19084 40200002
         USING UCMLIST,R5                                         19084 40300002
         SPACE 10                                                 19084 40400002
CATTRB   EQU   *                                                  19084 40500002
         MVI   XMSGSTAT+ONE,CHCPY  MOVE IN H                      19084 40600002
         LTR   R4,R4                    IS THIS THE HARDCOPY MSG  21002 40700002
         BZ    HARDAUTH                YES, DETERMINE AUTHORITY   21002 40800002
         L     R1,UCMUCB           UCB PTR TO CONSOLE IN CMD      19084 40900002
         USING XUCB,R1                                            19084 41000002
         MVI   XMSGSTAT+ONE,CACTIVE    IT WILL BE EITHER ACTIVE OR19084 41100002
*                                      CHANGING TO ACTIVE         19084 41200002
         TM    SRTESTAT,SRTEDADI   IS IT CHANGING TO ACTIVE       19084 41300002
         BO    PENDING                 YES,BRANCH                 M5933 41400002
         TM    XADUSWIT,XAIOCOMP       COMPOSITE CONSOLE       @Z30LPTJ 41500003
         BZ    CMASTER                 NO, THIS IS XXX CONSOLE   Y02669 41600002
         L     R1,TWLV(R14)            GET UCB OF O-UNIT         Y02669 41700002
         TM    SRTESTAT,SRTEDADI       O-UNIT CHANGING TO ACTIVE  M5933 41800002
         BZ    CMASTER                 NO                         M5933 41900002
         DROP  R1                                                 M5933 42000002
PENDING  MVC   XMSGSTAT+TWO(TWO),CPENG NEW CONS,CHANGING TO ACTIVEM5933 42100002
         B     CAUTHCK             GO CHECK CMD AUTH              19084 42200002
*                                                                 19084 42300002
*                                                                 19084 42400002
COONLY   EQU   *                                                  19084 42500002
         MVC   XMSGAUTH(FOR),CNONE      MOVE IN NO AUTH           19084 42600002
         BR    R15                  GO PROCESS ROUTS              19084 42700002
*                                                                 19084 42800002
*                                                                 19084 42900002
CMASTER  EQU   *                                                  19084 43000002
         TM    UCMDISP,UCMDISPA    MASTER                         19084 43100002
         BZ    CAUTHCK             NO,GO CHECK AUTH               19084 43200002
         MVI   XMSGSTAT+ONE,CMSTCONS    YES, MOVE IN M            19084 43300002
*                                                                 19084 43400002
         EJECT                                                    19084 43500002
CAUTHCK  EQU   *                                                  19084 43600002
         LA    R15,CEXIT               EXIT TO IEE7303D          Y02669 43700002
         LH    R6,UCMAUTH          GET AUTH IN REG5               19084 43800002
         TM    UCMDISP,UCMDISPD        O- ONLY CONSOLE            19084 43900002
         BO    COONLY              YES OUTPUT ONLY, AUTH=NONE    Y02669 44000002
         MVC   XMSGAUTH(TRE),CALL  ASSUME ALL                     19084 44100002
         CH    R6,CCMDALL         IS IT ALL AUTH                  19084 44200002
         BCR   EIT,R15             YES,GO TO EXIT TO 73          Y02669 44300002
*                                                                 19084 44400002
         MVC   XMSGAUTH(FOR),CINFO ASSUME INFO                    19084 44500002
         LTR   R6,R6               IS IT INFO                     19084 44600002
         BCR   EIT,R15             YES, GO CHECK RTCDS IN 73     Y02669 44700002
*                                                                 19084 44800002
         SR    R7,R7               NO, INDIVIDUAL AUTH            19084 44900002
         LA    R1,XMSGAUTH         PTR TO MSG AREA FOR AUTH       19084 45000002
         SLL   R6,SHIFT16          SHIFT AUTH                     19084 45100002
         LTR   R6,R6               IS IT ON                       19084 45200002
         BNM   CIND2               NO, BUT SOMETHING ELSE ON      19084 45300002
         MVC   ZERO(FOR,R1),CSYS   YES, IT IS SYS-MOVE IT IN      19084 45400002
         LA    R1,TRE(R1)          INDEX PAST IT                  19084 45500002
         BCTR  R7,ZERO             SET SECOND TIME SWITCH         19084 45600002
CIND2    EQU   *                                                  19084 45700002
         SLL   R6,SHIFT1          SHIFT ONE MORE                  19084 45800002
         LTR   R6,R6               IS IT ON                       19084 45900002
         BCR   EIT,R15             NO NOMORE, GO CHECK ROUT CODES 19084 46000002
         BNM   CIND4               NOT THIS ONE, GO ASSUME CONS   19084 46100002
         MVC   ZERO(FOR,R1),CIO+ONE     YES, ITS 10, MOVE IN -10- 19084 46200002
         LTR   R7,R7               SECOND TIME                    19084 46300002
         BZ    CIND3               NO,OK CHECK NEXT AUTH          19084 46400002
         MVC   ZERO(FOR,R1),CIO    YES, MOVE IN -,10-             19084 46500002
         BR    R15                 GO CHECK ROUTS IN 7303D       Y02669 46600002
*                                                                 19084 46700002
CIND3    EQU   *                                                  19084 46800002
         BCTR  R7,ZERO             SET SECOND TIME SWITCH         19084 46900002
         LA    R1,TWO(R1)          INDEX PAST -10-                19084 47000002
         SLL   R6,SHIFT1           SHIFT TO NEXT AUTH             19084 47100002
         LTR   R6,R6               ON                             19084 47200002
         BCR   EIT,R15             NO, NOMORE                     19084 47300002
*                                                                 19084 47400002
CIND4    EQU   *                                                  19084 47500002
         MVC   ZERO(FOR,R1),CONS+ONE    YES, MOVE IN -CONS-       19084 47600002
         LTR   R7,R7               SECOND TIME AROUND             19084 47700002
         BCR   EIT,R15             NO, GO CHECK ROUTS             19084 47800002
         MVC   ZERO(FIV,R1),CONS   YES, MOVE IN -,CONS-           19084 47900002
         BR    R15                     GO CHECK ROUT CODES        21002 48000002
         EJECT                                                    19084 48100002
*                                                                 19084 48200002
CENDCHK  EQU   *                                                  19084 48300002
         NI    XARESV,FOXES-XACENDCK   TURN OFF ENTRY BIT      @Z30LPTJ 48400003
         SLL   R4,SHIFT1           PROCESS BITS TO NEXT UNIT      19084 48500002
         ST    R4,XAR                  SAVE NEW PATTERN FOR       21002 48600002
*                                      MULTIPLE UNITS             21002 48700002
         LA    R9,TRE(R9)          INDEX TO NEXT UNIT             19084 48800002
         TM    XADUSWIT,XAIOCOMP   COMPOSITE SPECIFIED         @Z30LPTJ 48900003
         BZ    CMULT               GO CHECK IF MORE UNITS         19084 49000002
         LA    R9,SVN(R9)          INDEX PAST COMP UNIT          Y02669 49100002
CMULT    EQU   *                                                  19084 49200002
         TM    XADUSWIT,XAXPAREN   YES, MULTIPLE UNITS EXISTS? @Z30LPTJ 49300003
         BO    CPAREN              YES, CONTINUE                  19084 49400002
*                                                                 19084 49500002
CHCPYCK  EQU   *                                                  19084 49600002
         LTR   R11,R11             ANY HCPY MSG                   19084 49700002
         BZ    CFREE               NO, GO FINISH UP               19084 49800002
         LR    R5,R11              GET UCME OF HCPY INTO R5       19084 49900002
         L     R1,UCMUCB                                          19084 50000002
         B     CPROC               GO TO ISSUE AND BUILD MSG      19084 50100002
HARDAUTH EQU   *                                                  19084 50200002
         SR    R11,R11                 HARDCOPY MSG PROCESSED     21002 50300002
         LR    R6,R10              UCM PTR                        19084 50400002
         SH    R6,FOUR             MINUS 4 IS PTR TO PFX          19084 50500002
         L     R6,ZERO(R6)         GET PFX ADDR                   19084 50600002
         USING UCMPRFX,R6                                         19084 50700002
         MVC   XMSGAUTH(SIX),CNO       ASSUME NOCMDS              21002 50800002
         TM    UCMSDS1,UCMSDS1A        IS THIS STCMDS             21002 50900002
         BZ    HARDATH1                NO, TEST FOR INCMDS        21002 51000002
         MVC   XMSGAUTH(TWO),STCMDS    INDICATE STCMDS            21002 51100002
         B     HARDROUT                INDICATE CMDS ARE CHANGING 21002 51200002
HARDATH1 EQU   *                                                  21002 51300002
         TM    UCMSDS1,UCMSDS1B        IS THIS INCMDS             21002 51400002
         BZ    HARDATH2                CHECK FOR CMDS             21002 51500002
         MVC   XMSGAUTH(TWO),INCMDS    INDICATE INCMDS            21002 51600002
         B     HARDROUT                CONTINUE                   21002 51700002
HARDATH2 EQU   *                                                  21002 51800002
         TM    UCMSFLGS,UCMSYSC        IS THIS CMDS               21002 51900002
         BZ    HARDROUT                                           21002 52000002
         MVC   XMSGAUTH(SIX),CMDS      MOVE IN CMDS               21002 52100002
HARDROUT EQU   *                                                  19084 52200002
         LH    R6,UCMHRDRT             GET ROUTS OF HARCPY        21002 52300002
         DROP  R6                                                 19084 52400002
         OI    XARESV,XACRT2     INDICATE BRANCH TO CRT2 IN 73 @Z30LPTJ 52500003
CEXIT    EQU   *                                                  21002 52600002
         ST    R14,ZERO(R13)     REG0 SPOT - COMPOSITE SWITCH OR0Y02669 52700002
         STM   R4,R6,SHIFT16(R13) REG 4 HAS CURRENT PROCESS BITS Y02669 52800002
*                                 REG5 HAS UCME POINTER OF UNIT O       52900002
*                                 OR I-UNIT IF THIS IS COMPOSITE        53000002
*                                 REG6 HAS HARDCPY DEV ROUTS IF  Y02669 53050002
*                                 THIS IS THE HARDCPY MSG OR IS  Y02669 53060002
*                                  N/A IF THIS IS THE CONSOLE MSGY02669 53070002
         ST    R9,THIRTY6(R13)    REG9 HAS THE CURRENT UNIT PTR  Y02669 53100002
         STM   R11,R13,FORTY4(R13)   REG11 HAS HARDCPY INDICATOR Y02669 53200002
*                                 REG12 HAS MESSAGE AREA POINTER Y02669 53300002
*                                 REG13 HAS SAVE AREA POINTER    Y02669 53400002
         MVC   XAX+TRE(TWO),EXITNAME         IEE7303D            Y02669 53500002
*                                                                Y02669 53600002
         LM    R0,R15,ZERO(R13)   PRESET ALL REGS FOR 7303D      Y02669 53700002
         L     R15,VCON73                                        Y02669 53800002
         BR    R15            BRANCH TO 7303D                    Y02669 53900002
*                                                                Y02669 54000002
*         R0  = PRESET FOR COMPOSITE SWITCH                      Y02669 54100002
*         R4  = PROCESS BITS                                     Y02669 54200002
*         R1  = MSG POINTER                                      Y02669 54300002
*         R2  = DUMMY XSA POINTER                                Y02669 54400002
*         R5  = UCME PTR OF UNIT OR I-UNIT IF THIS IS COMP       Y02669 54500002
*         R9  = UNIT POINTER                                     Y02669 54600002
*         R11 = HARDCPY MSG INDICATOR OR 0 IF NOT NEEDED         Y02669 54700002
*         R12 = MESSAGE AREA POINTER                             Y02669 54800002
*         R13 = SAVE AREA POINTER                                Y02669 54900002
*         R14 = RETURN ADDRESS                                   Y02669 55000002
*         R15 = ADDRESS OF 7303D                                 Y02669 55100002
*                                                                Y02669 55200002
         EJECT                                                          55300002
CFREE    EQU   *                                                 Y02669 55400002
         L     R0,XAP                  MLWTO ID                   21002 55500002
         IC    R0,XAU             CONSOLE ID IN LOW ORDER BYTE    21002 55600002
         TM    XAU,RI             IS THIS FROM INPUT STREAM?   @ZM30445 55620003
         BNO   XAUIN              NO, AVOID NEXT INSTRUCTION   @ZM30445 55640003
         IC    R0,ZEROZERO        YES, INDICATE MASTER CONSOLE @ZM30445 55660003
XAUIN    EQU   *                                               @ZM30445 55680003
         MVC   ZERO(8,R12),ELINE       LAST LINE OF MLWTO         21002 55700002
         LR    R1,R12                  ADDRESS OF MESSAGE         21002 55800002
         WTO   MF=(E,(1))                                               55900002
         SPACE 10                                                       56000002
**************************************************               Y02651 56100002
*                                                                Y02651 56200002
*  THIS IS A TERMINAL EXIT AND THEREFORE THE ENQ ORIGINALLY      Y02651 56300002
*  ISSUE IN MODULE IEE3603D MUST BE DEQUEUED OF.                 Y02651 56400002
*                                                                Y02651 56500002
CDEQUE   EQU   *                                                 Y02651 56600002
         DEQ   MF=(E,IEFDEQUE)                                   Y02651 56700002
*                                                                Y02651 56800002
**************************************************               Y02651 56900002
         SPACE 10                                                       57000002
         LR    R1,R12                   PTR TO MSG AREA IN 1      19084 57100002
         FREEMAIN R,LV=96,A=(1),SP=229                           Y02669 57200002
         L     R1,D64(R13)         CSCB PTR                      Y02669 57300002
         USING CHAIN1,R1                                         Y02669 57400002
         OI    CHSTS,CHFC          SET TO FREE CSCB              Y02669 57500002
         MGCR  (1),CHAIN                                         Y02669 57600002
         LM    R0,R15,ZERO(R13)    RESTORE REGS                  Y02669 57700002
         LR    R4,R14              SAVE RETURN ADDRESS           Y02669 57800002
*                                  FREE SAVE AREA GOTTEN IN 3303DY02669 57900002
         LR    R1,R2               DUMMY XSA POINTER             Y02669 58000002
         LA    R0,D132             DUMMYXSA SIZE AND SVAREA SIZE Y02669 58100002
         FREEMAIN R,LV=(0),A=(1)                                 Y02669 58200002
*                                  FREE DUMMY XSA GOTTEN IN 3603DY02669 58300002
         LR    R14,R4              RESTORE RETURN REG            Y02669 58400002
         BR    R14                      RETURN                    19084 58500002
         EJECT                                                          58600002
**************************************************               Y02651 58700002
*  DEQ LIST FORM FOLLOWS:                                        Y02651 58800002
*                                                                Y02651 58900002
IEFDEQUE DEQ   (IEFSQCBS,IEFQ4QCB,TWO,SYSTEM,IEFSQCBS,IEFVQCBS,SVN,    *59000002
               SYSTEM),RET=HAVE,MF=L                           @YM5443P 59030002
IEFVQCBS DC    C'VARYDEV'                                               59060002
IEFSQCBS DC    C'SYSIEFSD'                                       Y02651 59100002
IEFQ4QCB DC    C'Q4'                                             Y02651 59200002
**************************************************               Y02651 59300002
         EJECT                                                          59400002
*********************************************************************** 59500002
*                                                                 19084 59600002
*        DECLARE AREA FOR MODULE                                  19084 59700002
*                                                                 19084 59800002
*********************************************************************** 59900002
*                                                                 19084 60000002
         DS    0F                                                Y02669 60100002
VCON73   DC    V(IEE7303D)                                       Y02669 60200002
EXITNAME DC    C'73'                                             Y02669 60300002
CNO      DC    C'NO'               HARDCPY NOCMDS OR CMDS- DO NOT 19084 60400002
CMDS     DC    C'CMDS  '                                          21002 60500002
INCMDS   DC    C'IN'                   INCMDS                     21002 60600002
STCMDS   DC    C'ST'                   STCMDS                     21002 60700002
CNONE    DC    C'NONE'             NO CMD AUTH OR NO ROUTS        19084 60800002
FOUR     DC    H'4'                CONSTANT TO GET PFX PTR        19084 60900002
FOX7     DC    X'00F7'             ..                             19084 61000002
CCMDALL  DC    X'E000'             ALL CMD AUTH                   19084 61100002
CINFO    DC    C'INFO'             INFO COMD AUTH                 19084 61200002
CSYS      DC    C'SYS '              CMD AUTH OF 1                19084 61300002
CIO      DC    C',IO  '            CMD AUTH OF 2                  19084 61400002
CONS     DC    C',CONS'            CMD AUTH OF 3                  19084 61500002
CALL     DC    C'ALL'              ALL ROUT AND CMD AUTH          19084 61600002
COUNIT   DC    C'O-'               OUTPUT ONLY UNIT               19084 61700002
CIUNIT   DC    C'(I-'              BEGINNING OF COMPOSITE         19084 61800002
CPENG    DC    C',P'               PENDING TO GO TO CONSOLE       19084 61900002
OLTTEST  DC    C'N,T'                  DEVICE IS NOT ACTIVE AND   21051 62000002
*                                      UNDER TEST BY OLTEP        21051 62100002
ZEROZERO DC    X'00'                                           @ZM30445 62150003
ELINE    WTO   (,E),MF=L                                          21002 62200002
         SPACE 5                                                        62300002
PATCH    DC    CL50'***IEE4803D***'                            @Z30LPTJ 62400003
         EJECT                                                    19084 62500002
CMESSAGE DSECT                                                    19084 62600002
XMSGHDR  DS    1F                      HEADER FIELD FOR MLWTO     21002 62700002
XTEXT    EQU   *                                                  19084 62800002
*                                                                 19084 62900002
*                                                                 19084 63000002
XUNIT1   DS    CL3                 1ST PHUSICAL UNIT ADDRES       19084 63100002
XBLANK   DS    CL1                 COMMA                          19084 63200002
XUNIT2   DS    CL3                                                19084 63300002
XCOMMA   DS    CL1                                                19084 63400002
XAUNIT1  DS    CL3                                                19084 63500002
XBLK     DS    CL1                                                19084 63600002
XAUNIT2  DS    CL3                                                19084 63700002
XMSGPAD1 DS    CL1                                                19084 63800002
XMSGSTAT DS    CL4                                                19084 63900002
XMSGPAD2 DS    CL1                                                19084 64000002
XMSGAUTH DS    CL1                                                19084 64100002
XMSGPAD3 DS    CL7                     BLANKS                     21002 64200002
XMSGID   DS    CL3                     CONSOLE ID                 21002 64300002
XMSGPAD4 DS    CL1                     BLANK                      21002 64400002
XMSGDID  DS    CL5                     DISPLAY AREA ID            21002 64500002
XMSGPAD5 DS    CL2                     BLANKS                     21002 64600002
XMSGRTCD DS    CL8                                                19084 64700002
XMSGWK   DS    CL30                                               19084 64800002
*                                                                 19084 64900002
         EJECT                                                          65000002
CXSA     DSECT                                                          65100002
         IEEXSA                                                         65200002
         EJECT                                                          72600002
XCVT     DSECT                                                          72700002
         CVT                                                            72800002
         EJECT                                                          72900002
XUCM     DSECT                                                          73000002
         IEECUCM   FORMAT=NEW                                           73100002
         EJECT                                                          73200002
XUCB     DSECT                                                          73300002
         IEFUCBOB                                                       73400002
         EJECT                                                          73500002
CHAIN1   DSECT                                                          73600002
         IEECHAIN                                                       73700002
         EJECT                                                          73800002
         IHAPSA                                                         73900002
         END                                                            74000002
