 TITLE 'IEE4903D - CONSOLE OPERAND PROCESSOR'                           00090003
IEE4903D CSECT                                                          00180002
* A 481600-482200                                              @ZA02592 00210003
* C 080100,220500                                              @ZA02592 00240003
* A 057700-058000,066800-067200,220900,322800,332100,361300,   @ZM34520 00245003
* A 407800-408100,421500-421800,469850-477240,738090-738810,   @ZM34520 00250003
* A 780400-780700,845150-846500,850000,855400                  @ZM34520 00255003
* C 066600,080100                                              @ZM34520 00260003
* D 449100,658800,659700,781200-791100,792900-800100           @ZM34520 00265003
* D (IEFDEQUE) 811800 - 818100                                 @ZA12404 00266051
* C (CDEQUE  ) APPROX. 845400                                  @ZA12404 00267051
* A (IEE36DEQ) APPROX. 890100                                  @ZA12404 00268051
* C (RETURN  )                                                 @ZA13369 00269051
*********************************************************************** 00270002
* MODULE NAME       = IEE4903D                                          00360002
*    CSECT NAME     = IEE4903D                                          00450002
*                                                                       00540002
* LOAD MODULE NAME  = IEE3603D                                          00630002
*                                                                       00720002
* DESCRIPTIVE NAME  = CONSOLE OPERAND PROCESSOR                         00810002
*                                                                       00900002
* COPYRIGHT         = NONE                                              00940051
*                                                                       01080002
* STATUS            = OS/VS/2 MVS 3033 PROCESSOR SUPPORT(SCP)  @G51APSS 01120051
*                                                                       01260002
* FUNCTION          = PROCESSES VARY XXX,CONSOLE,ETC.                   01350002
*                        SETS ALL REQUIRED INTERFACE AND STATUS BITS IN 01440002
*                        THE UCM, UCME, AND UCB                         01530002
*                     PROCESSES PARAMETERS AND CHECKS FOR THEIR         01620002
*                     VALIDITY AND ALLOWABILITY                         01710002
*                     PARAMETERS:                                       01800002
*                        AUTH=                                          01890002
*                        ROUT=                                          01980002
*                        ALTCONS=                                       02070002
*                                                                       02250002
* OPERATION         = THIS MODULE FIRST CHECKS TO SEE IF A     @G51APSS 02290051
*                     NO-CONSOLES CONDITION EXISTS. IF SO THEN @G51APSS 02340051
*                     MESSAGE IEE744I IS ISSUED, A DEQ IS      @G51APSS 02350051
*                     ISSUED FOR Q4 AND VARYDEV, THE GETMAINED @G51APSS 02360051
*                     WORK AREA IS FREED, THE CSCB IS FREED,   @G51APSS 02370051
*                     THE DUMMY XSA IS FREED AND CONTROL IS    @G51APSS 02380051
*                     RETURNED TO THE CALLER. IF A NO-CONSOLES @G51APSS 02390051
*                     CONDITION DOES NOT EXIST THEN A CHECK IS @G51APSS 02400051
*                     MADE TO SEE IF THE DEVICE TO BE          @G51APSS 02410051
*                     VARIED TO THE CONSOLE STATE IS ALREADY A CONSOLE. 02430002
*                     IF IT IS NOT, THEN HARDCPY REQUIREMENTS ARE       02520002
*                     CHECKED SINCE THIS WOULD BE A SECOND OR MORE      02610002
*                     CONSOLE ON THE SYSTEM NOW AND THEREFORE HARDCPY   02700002
*                     IS NOW DEFINITELY REQUIRED.                       02790002
*                     IF HARDCPY ALREADY EXISTS THEN THERE IS NO        02880002
*                     PROBLEM.  THE ONLY THING DONE NOW IS TO CHANGE    02970002
*                     IF REQUIRED, THE AUTHORITY AND ROUTCODES OF THE   03060002
*                     HARDCPY DEVICE TO THE MANDATORY ONES.             03150002
*                     HOWEVER IF HARDCPY DOES NOT EXIST, THEN           03240002
*                     WE CHECK WHETHER SYSLOG IS ACTIVE AND IF SO       03330002
*                     WE MAKE IT HARDCPY AND ISSUE A MSG LETTING THE    03420002
*                     OPERATOR KNOW THIS.                               03510002
*                     IF SYSLOG IS NOT ACTIVE, THEN WE TRY TO MAKE      03600002
*                        1. THE MASTER CONSOLE    OR                    03690002
*                        2. THE NEW CONSOLE COMING ON                   03780002
*                     THE HARDCPY DEVICE. IF ONE OR THE OTHER ARE NOT   03870002
*                     GRAPHIC DEVICES.  IF IT TURNS OUT THAT BOTH ARE   03960002
*                     GRAPHICS, THEN WE ALLOW THIS UNIT TO BECOME A     04050002
*                     CONSOLE BUT WE NOTIFY THE OPERATOR THAT HE WILL   04140002
*                     BE WORKING WITHOUT A HARDCPY DEVICE WHEN IT IS    04230002
*                     REQUIRED TO HAVE ONE.                             04320002
*                     THEN THIS MODULE SETS THE OPEN PENDING FLAG IN    04410002
*                     THE UCME OF THE NEW DEVICE AND CHECKS IF IT IS    04500002
*                     CURRENTLY ONLINE OR OFFLINE.                      04590002
*                     IF OFFLINE, THEN THE ONLINE AND CONSOLE BITS      04680002
*                     ARE SET IN THE UCB OF THE DEVICE AND WE GO AND    04770002
*                     SERVICE ANY FURTHER REQUEST THAT THE OPERATOR     04860002
*                     MIGHT HAVE HAD SUCH AS NEW AUTHORITY, ROUTCODES   04950002
*                     ETC., FOR THIS NEW CONSOLE.                       05040002
*                     IF THE DEVICE IS CURRENTLY ONLINE, WE CHECK IF    05130002
*                     THE DEVICE IS CURRENTLY ALLOCATED.                05220002
*                     IF YES, WE TURN ON THE CHANGE STATUS BIT IN THE   05310002
*                     UCB AND GO PROCESS FURTHER REQUEST FOR CHANGES    05400002
*                     FOR THE UNIT.                                     05490002
*                     IF IT IS NOT ALLOCATED,THEN THE CONSL BIT IS SET  05580002
*                     ON AND WE CONTINUE PROCESSING FURTHER CHANGES AS  05670002
*                     REQUESTED BY THE OPERATOR.                        05760002
*                     IF IT IS NOT ACTIVE AND IS NOT READY, AN @ZM34520 05770003
*                     ERROR MESSAGE (IEE313I) WILL BE ISSUED   @ZM34520 05790003
*                     AND ITS CORRESPONDING PROCESS BIT TURNED @ZM34520 05810003
*                     OFF.                                     @ZM34520 05830003
*                     IN ALL CASES, WHEN THE DEVICE IS VARIED TO THE    05850002
*                     CONSOLE STATE,FROM AN OFFLINE STATE, THIS RTN     05940002
*                     WILL TURN THE MP-OPERATOR BIT IN THE UCB OFF.     06030002
*                     THIS IS DONE SO THAT THE SYSTEM WILL KNOW         06120002
*                     THAT THE UNIT IS IN THE ONLINE/CONSOLE STATE      06210002
*                     DUE TO A 'VARY DEVICE' COMMAND.                   06300002
*                     WHEN ALL UNITS ON THE COMMAND HAVE BEEN PRO-      06390002
*                     CESSED AS DESCRIBED ABOVE, THEN WE ISSUE A        06480002
*                     HEADER MESSAGE AND EXIT TO IEE4803D TO COMPLETE   06570002
*                     THE MESSAGE FOR THIS COMMAND.  IF THERE  @ZM34520 06660003
*                     ARE NO PROCESS BITS REMAINING, A RETURN  @ZM34520 06680003
*                     TO CALLER WILL BE MADE, INSTEAD OF GOING @ZM34520 06700003
*                     TO IEE4803D.                             @ZM34520 06720003
*                                                                       06750002
* NOTES                                                                 06840002
*    DEPENDENCIES   = NONE                                              06930002
*    CHARACTER/CODE DEPENDENCIES                                        07020002
*                  = THIS MODULE CAN BE ASSEMBLED WITH ANY NEW          07110002
*                    CHARACTER/CODE SET.                                07200002
*                                                                       07290002
* RESTRICTIONS     = SEE ENTRY POINTS - INPUT DATA                      07380002
*                    XSA MUST NOT BE FREED BEFORE Q4 AND       @ZA12404 07400051
*                    VARYDEV ARE DEQUEUED AS FIELD XAWORKB     @ZA12404 07420051
*                    CONTAINS POINTER TO THE DYNAMIC DEQUE     @ZA12404 07425051
*                    LIST.                                     @ZA12404 07430051
*                                                              @ZA12404 07440051
*    REGISTER CONVENTIONS                                               07470002
*                  = REGISTERS ARE DEFINED AT LABEL: DEFREG             07560002
*    PATCH LABEL   = PATCH                                              07650002
*                                                                       07740002
* MODULE TYPE      = CSECT                                              07830002
*    PROCESSOR     = ASSEMBLER                                          07920002
*    MODULE SIZE   = X'83C' BYTES                              @G51APSS 07960051
*    ATTRIBUTES    = REENTRANT, REUSABLE, REFRESHABLE, ZERO PSW         08100002
*                    PROTECT KEY,PAGED LPA                              08190002
*                                                                       08280002
* ENTRY POINTS      = IEE4903D FROM IEE4203D                            08370002
*   PURPOSE         = TO PROCESS CONSOLE OPERAND ON THE VARY COMMAND    08460002
*   LINKAGE         = BRANCH                                            08550002
*   INPUT           = REGISTER 2 POINTS TO THE DUMMY XSA                08640002
*                     XAR HAS THE PROCESS SWITCHES FOR THE UNITS        08730002
*                     XAL HAS THE PTR TO THE PARMS OF THE COMMSND       08820002
*                    ADDITIONAL XSA FIELDS ARE DEFINED AT      @ZA13369 08850051
*                    SECTION 'XSA POINTER SAVE AREA'.          @ZA13369 08880051
*                     REGISTER 4 CONTAINS A GRAPHICS INDICATOR          08910002
*                        SET BY IEE4203D                                09000002
*                    REG13 PTS TO THE SAVE AREA GOTTEN IN 3603D         09090002
*                    WORD 17 OF THE SAVE AREA HAS THE CSCB PTR          09180002
*   REGISTERS SAVED = ALL                                               09270002
*   REGISTER USAGE  = R1  OUTPUT=WTO CORE PTR                           09360002
*                     R2  XSA PTR                                       09450002
*                     R3  ADDRESSABILITY                                09540002
*                     R4  UCME PTR                                      09630002
*                     R6  MLWTO AND GFX BYTE INDICATOR                  09720002
*                     R7  PROCESS BITS                                  09810002
*                     R9  UNIT PTR                                      09900002
*                     R10 UCM REGISTER                                  09990002
*                     R11 UCMPRFX REGISTER                              10080002
*                     R12 UCB PTR                                       10170002
*                     R13 SAVE AREA PTR                                 10260002
*   REGISTERS RESTORED                                                  10350002
*                   = ALL                                               10440002
*                                                                       10530002
* EXITS - NORMAL    = TO IEE4803D VIA BRANCH                            10620002
*                     IF ISSUER OF THE COMMAND HAS THE PROPER           10710002
*   CONDITIONS      = AUTHORITY, IF THE UNIT SPECIFIED HAS THE          10800002
*                     ABILITY TO BE VARIED AS A 'CONSOLE' AND           10890002
*                     IF THE PARAMETERS SPECIFIED MAY BE SET,           10980002
*                     IEE4903D WILL EXIT TO IEE4803D SO THAT            11070002
*                     MESSAGES CAN BE SENT INFORMING THE OPERATOR OF    11160002
*                     AUTHORITIES, AND ALTERNATE CONSOLES.              11250002
*   OUTPUT          = XAP CONTAINS THE MLWTO ID AND GRAPHICS ID         11340002
*                     R13 HAS THE SAVE AREA POINTER                     11430002
*                     R2 HAS THE DUMMY XSA POINTER                      11520002
*                     R1 CONTAINS PTR TO BUFFER FOR MSG                 11610002
*                     A MLWTO IS ISSUED FROM THIS MODULE:               11700002
*                     IEE349I CONSOLES                                  11790002
*                     CONSOLE/ALT  COND  AUTH  ID  AREA  ROUTCD         11880002
*                        (IF THIS CONSOLE IS GRAPHICS)                  11970002
*                        OR                                             12060002
*                     IEE349I CONSOLES                                  12150002
*                     CONSOLE/ALT  COND  AUTH  ID  ROUTCD               12240002
*                        ( IF CONSOLE IS NON-GRAPHICS)                  12330002
*                     CONDITIONS SET IN THIS MODULE:                    12420002
*                        OFFLINE TO CONSOLE...                          12510002
*                             SETS UCB BITS:  ON/OFFLINE = ON           12600002
*                                             PRIM CONSL = ON           12690002
*                                             MP-OPERATOR = OFF         12780002
*                             SETS UCME BITS: OPEN PENDG = ON           12870002
*                        IF DEVICE IS UNDER TEST BY OLTEP THEN          12960002
*                        THE 'VARY CONSOLE' REQUEST CANNOT BE           13050002
*                        HONORED                                        13140002
*                        ONLINE ALLOCATED TO CONSOLE...                 13230002
*                             SETS UCB BITS:  CONSOLE CHNG STATUS = ON  13320002
*                                             MP-OPERATOR = N/A         13410002
*                             SETS UCME BITS: OPEN PENDING        = ON  13500002
*                        ONLINE UNALLOCATED TO CONSOLE...               13590002
*                             WHEN ALLOC IS USING THE UCBS:             13680002
*                               SETS UCB BIT:  CONS CHANG STATUS = ON   13770002
*                                              MP-OPERATOR = N/A        13860002
*                               SETS UCME BIT: OPEN PENDING      = ON   13950002
*                             WHEN ALLOC IS NOT USING UCB:              14040002
*                               SETS UCB BIT:  PRIMARY CONSOLE = ON     14130002
*                                              MP-OPERATOR = N/A        14220002
*                               SETS UCME BIT: OPEN PENDING    = ON     14310002
*                     SETS OWN SWITCHES WITHIN XAD OF XSA               14400002
*                     ALSO PUTS OUT THE CONSOLE MESSAGE HEADER WHEN     14490002
*                     ALL THE UNITS IN THE COMMAND HAVE BEEN PROCESSED. 14580002
*                     IN ALL CASES WHERE THE COMMAND WAS HONORED:       14670002
*                             SETS UCB BIT: VARY-OPERATOR-MP  = OFF     14760002
*   RETURN CODES    = NONE                                              14850002
*                                                                       14940002
* EXITS - ERROR     = RETURN TO CALLER                                  15030003
*                     THIS MODULE WILL CLEAN UP ALL CORE BY FREEING     15120003
*                     THE SAVE AREA AND THE DUMMY XSA, FREEING THE      15210003
*                     CSCB CORE VIA AN MGCR MACRO                       15300003
*   CONDITIONS      = A GETMAIN FAILED OR INVALID UNITS HAVE BEEN       15480003
*                     DETECTED AND DELETED, AND HAS RESULTED IN NO      15510003
*                     UNITS LEFT IN THE BUFFER OR THE VARY     @G51APSS 15520051
*                     CONSOLE COMMAND WAS ISSUED WHEN A        @G51APSS 15540051
*                     NO-CONSOLES CONDITION EXISTS.            @G51APSS 15547051
*                                                                       15554051
*   OUTPUT          = 'IEE328I VARY COMMAND ABORTED'                    15570003
*                                                                       15610051
*                              -- OR --                                 15660003
*                                                                       15700051
*                     'IEE313I XXX      UNIT REF INVALID'               15750003
*                                                                       15760051
*                              -- OR --                        @G51APSS 15770051
*                                                                       15776051
*                     'IEE744I VARY CONSOLE REJECTED -         @G51APSS 15790051
*                              NO FULL CAPABILITY CONSOLES'    @G51APSS 15810051
*                     '     TO RESTORE MASTER CONSOLE:'        @G51APSS 15816051
*                     '  1) PRESS ENTER, REQUEST, OR END ON    @G51APSS 15822051
*                           ANY AVAILABLE CONSOLE'             @G51APSS 15826051
*                     '  2) PRESS THE EXTERNAL INTERRUPT KEY'  @G51APSS 15834051
*                                                                       15837051
*   RETURN CODES    = NONE                                              15840002
*                                                                       15930002
* EXTERNAL REFERENCES                                                   16020002
*   ROUTINES        = IEE4803D                                          16110002
*                     IEE2103D                                          16200002
*   DATA AREAS      = SEE EXITS - OUTPUT DATA                           16290002
*                                                                       16380002
* CONTROL BLOCKS    = 1. EXTENDED SAVE AREA (XSA)                       16470002
*                     2. CVT                                            16560002
*                        FIELDS TESTED  = CVTCUCB                       16650002
*                                         CVTMSER                       16740002
*                        FIELDS UPDATED = NONE                          16830002
*                     3. MASTER SCHEDULER RESIDENT DATA AREA (BASEA)    16920002
*                        FIELDS TESTED  = BALOG                         17010002
*                        FIELDS UPDATED = NONE                          17100002
*                     4. UNIT CONTROL MODULE (UCM)                      17190002
*                        FIELDS TESTED = UCMVEA,UCMUCB,UCMATR-BIT UCMUF 17280002
*                                         UCMCOMPC,UCMVEZ,UCMHCUCM      17370002
*                                         UCMSFLG1 BIT-UCMSYSB @G51APSS 17410051
*                                                      UCMSYSE @G51APSS 17460051
*                                                      UCMSYSG          17550002
*                                         UCMDISP BIT -UCMDISPA         17640002
*                                                      UCMDISPC         17730002
*                                         UCMSDS1 BIT -UCMSDS1A         17820002
*                                                      UCMSDS1B         17910002
*                        FIELDS UPDATED = UCMSTS BIT-  UCMTA            18000002
*                                         UCMSFLGS BIT - UCMSYSB        18090002
*                                                        UCMSYSC        18180002
*                                         UCMDISP BIT- UCMDISPB         18270002
*                                         UCMHCUCM,UCMHRDRT,UCMAUTH,    18360002
*                                         UCMRTCD,UCMOAOEN,UCMALTEN     18450002
*                     5. UNIT CONTROL BLOCK (UCB)                       18540002
*                        FIELDS TESTED  = UCBNAME                       18630002
*                                         UCBFL5 BIT- UCBNALOC          18720002
*                                         SRTESTAT BIT- SRTEONLI        18810002
*                                                       SRTEALOC        18900002
*                        FIELDS UPDATED = SRTESTAT BIT- SRTEONLI        18990002
*                                                       SRTESYSR        19080002
*                                                       SRTEDADI        19170002
*                                         UCBWGT BIT - UCBVORSN         19260002
*                     6. COMMAND SCHEDULING CONTROL BLOCK (CSCB)        19350002
*                        FIELDS TESTED  - NONE                          19440002
*                        FIELDS UPDATED - CHSTS - BIT= CHFC             19530002
*                                                                       19620002
* TABLES            = GETMAIN IS ISSUED FOR THE WTO BUFFER.             19710002
*                     96 BYTES FOR SUBPOOL 229.                         19800002
*                                                              @ZA12404 19808051
* XSA POINTER SAVE                                             @ZA12404 19816051
*    AREA          = XAWORKA - LV PARAM FOR DYNAMIC STORAGE    @ZA13369 19824051
*                    XAWORKB - IEE36DEQ POINTER                @ZA12404 19832051
*                    XAWORKC - IEE36WRK POINTER                @ZA13369 19840051
*                    XAWORKD - UNUSED                          @ZA12404 19848051
*                    XAWORKE - UNUSED                          @ZA12404 19856051
*                    XAWORKF - UNUSED                          @ZA12404 19864051
*                    XAWORKG - UNUSED                          @ZA12404 19872051
*                    XAWORKH - UNUSED                          @ZA12404 19880051
*                                                                       19890002
* MACROS            = DEQ,GETMAIN,FREEMAIN,WTO,LOAD,DELETE,MGCR,SETLOCK 19980002
*                                                                       20070002
* MAPPING MACROS    = IEEXSA                                            20160002
*                     CVT                                               20250002
*                     IEEBASEA                                          20340002
*                     IEECUCM                                           20430002
*                     IEFUCBOB                                          20520002
*                     IEECHAIN                                          20610002
*                     IHAPSA                                            20700002
*    SERIALIZATION =  PROTECTION AGAINST COMM. TASK IS ACCOMPLISHED     20790002
*                    IN THIS MODULE BY OBTAINING THE LOCAL AND CMS      20880002
*                    LOCKS AT:                                          20970002
*                       CSETLOCK                                        21060002
*                    AND RELEASING THEM AT:                             21150002
*                       UNSETLOK                                        21240002
*                    PROTECTION AGAINST OLTEP, ALLOCATION AND           21330002
*                    VARY/UNLOAD IS ACCOMPLISHED VIA AN ENQ IN MODULE   21420002
*                    IEE3603D                                           21510002
*                    THE DEQ IS ISSUED AT CDEQUE IN THIS MODULE ONLY IF 21600002
*                    A TERMINAL EXIT IS TAKEN IN THIS MODULE            21690002
*                    ALL BIT SETTINGS IN THE UCB ARE TURNED ON/OFF      21780002
*                    VIA THE COMPARE-AND-SWAP INSTRUCTION.              21870002
*                                                                       21960002
* CHANGE LEVEL      = Y02669, Y02651, Z30LPTJ, ZA02592,        @ZA02592 22050003
*                     ZM34520, OZ12404, OZ13369, G51APSS       @G51APSS 22070051
*                                                                       22320002
* MESSAGES          = IEE349I CONSOLES                                  22410002
*                     CONSOLE/ALT  COND  AUTH  ID  AREA  ROUTCD         22500002
*                        (IF THIS CONSOLE IS GRAPHICS)                  22590002
*                        OR                                             22680002
*                     IEE349I CONSOLES                                  22770002
*                     CONSOLE/ALT  COND  AUTH  ID  ROUTCD               22860002
*                        (IF THIS CONSOLE IS NON-GRAPHICS)              22950002
*                                                                       22990003
*                     'IEE709I HARDCOPY REQUIRED-NO HARDCOPY DEVICE     23040002
*                     AVAILABLE.'                                       23130002
*                     (IF HARCPY IS REQUIRED ON THE SYSTEM, AND YET     23220002
*                     THE MASTER CONSOLE OR THE NEW CONSOLE ARE BOTH    23310002
*                     GRAPHICS DEVICES AND SYSLOG IS INACTIVE.)         23400002
*                                                                       23440003
*                     'IEE710I         NOW RECEIVING HARDCOPY.'         23490002
*                     (WHEN A HARDCPY DEVICE, SUCH AS SYSLOG, OR THE    23580002
*                     MASTER CONSOLE OR THE NEW CONSOLE UNIT IS         23670002
*                     FORCED AS THE HARDCPY, BECAUSE HARDCPY IS NOW     23760002
*                     REQUIRED)                                         23850002
*                                                                       23890003
*                     MESSAGE 'IEE328I VARY COMMAND ABORTED'            23940002
*                     IS ISSUED FROM IEE2103D WHEN THE GETMAIN          24030002
*                     FOR THE WTO BUFFER IS UNSUCCESSFUL.               24120002
*                                                                       24130003
*                     'IEE313I XXX      UNIT REF INVALID'               24140003
*                     (WHEN A NOT ACTIVE & NOT READY CONSOLE DEVICE IS  24150003
*                     DETECTED)                                         24160003
*                                                                       24166051
*                     'IEE744I VARY CONSOLE REJECTED -         @G51APSS 24172051
*                              NO FULL CAPABILITY CONSOLES'    @G51APSS 24178051
*                     '     TO RESTORE MASTER CONSOLE:'        @G51APSS 24184051
*                     '  1) PRESS ENTER, REQUEST, OR END ON    @G51APSS 24190051
*                           ANY AVAILABLE CONSOLE'             @G51APSS 24194051
*                     '  2) PRESS THE EXTERNAL INTERRUPT KEY'  @G51APSS 24202051
*                                                                       24210002
* ABEND CODES       = NONE                                              24300002
*                                                                       24390002
* PACKAGING         = IEE4903D WILL BE PART OF LOAD MODULE              24480002
*                        = IEE3603D                                     24570002
*                     THIS LOAD MODULE ALIASES ARE                      24660002
*                        = NONE                                         24750002
*                     THIS LOAD MODULE ENTRY POINTS ARE                 24840002
*                        = IEE3603D                                     24930002
*                     THIS MODULE WILL RESIDE IN:  LPALIB               25020002
*                                                                       25110002
* SYSGEN            = SUPPLIED BY THE FOLLOWING SECTIONS:               25200002
*                        LOAD MODULE NAME                               25290002
*                        PACKAGING                                      25380002
*                     THIS CSECT WILL BE INCLUDED AT SYSGEN FROM        25470002
*                     DLIB -AOSB3- BY MACRO -SGIEF441-                  25560002
*                                                                       25650002
* SYSTEM LIBRARIES  = NONE                                              25740002
*                                                                       25830002
*********************************************************************** 25920002
         EJECT                                                          26010002
*****************************************************************Y02669 26100002
*                             ***                                ***    26190002
*                             *        ***                     *** *    26280002
*                             *        *                         * *    26370002
*                             *        * ALL                     * *    26460002
*                             *        * INFO                    * *    26550002
*                             * ,AUTH= * **   ** **  ** **    ** * *    26640002
*                             *        * * SYS *,* IO *,* CONS * * *    26730002
*                             *        * **   ** **  ** **    ** * *    26820002
*                             *        *                         * *    26910002
*                             *        ***                     *** *    27000002
*   ***           ***         *                                    *    27090002
*   *               *         *        ***                     *** *    27180002
*   * XXX           *         *        *                         * *    27270002
*   *               *         *        * ALL                     * *    27360002
* V * O-XXX         *,CONSOLE * ,ROUT= * NONE                    * *    27450002
*   *               *         *        * ROUTCODE(,ROUTCODE,...) * *    27540002
*   * (I-XXX,O-XXX) *         *        *                         * *    27630002
*   *               *         *        ***                     *** *    27720002
*   ***           ***         *                                    *    27810002
*                             *           ***           ***        *    27900002
*                             *           *               *        *    27990002
*                             *           * XXX           *        *    28080002
*                             * ,ALTCONS= * O-XXX         *        *    28170002
*                             *           * (I-XXX,O-XXX) *        *    28260002
*                             *           *               *        *    28350002
*                             *           ***           ***        *    28440002
*                             ***                                ***    28530002
*****************************************************************Y02669 28620002
         EJECT                                                          28710002
*                                                                 19084 28800002
*        REGISTER EQUATES                                         19084 28890002
*                                                                 19084 28980002
DEFREG   EQU   *                                                 Y02669 29070002
R0       EQU   0                                                  19084 29160002
R1       EQU   1                   IN-XAD,OUT-WTO CORE PTR        19084 29250002
R2       EQU   2                   XSA                            19084 29340002
R3       EQU   3                   ADDRESS                        19084 29430002
R4       EQU   4                                                        29520002
R5       EQU   5                   UCME                          Y02669 29610002
R6       EQU   6                                                  19084 29700002
R7       EQU   7                   PROCESS BITS                   19084 29790002
R8       EQU   8                   STAE REG                       19084 29880002
R9       EQU   9                   UNIT PTR                       19084 29970002
R10      EQU   10                  UCM REG                        19084 30060002
R11      EQU   11                  UCMPFX REG                     19084 30150002
R12      EQU   12                  UCB PTR                        19084 30240002
R13      EQU   13                                                 19084 30330002
R14      EQU   14                  RET ADDR                       19084 30420002
R15      EQU   15                                                 19084 30510002
         SPACE 3                                               @G51APSS 30600051
*********************************************************************** 30780002
*        EQUATES                                                  19084 30960002
*********************************************************************** 31140002
ZERO     EQU   0                                                  19084 31230002
ONE      EQU   1                                                  19084 31320002
TWO      EQU   2                                                  19084 31410002
TRE      EQU   3                                                  19084 31500002
FOR      EQU   4                                                  19084 31590002
SIX      EQU   6                                                  19084 31680002
SVN      EQU   7                                                  19084 31770002
EIT      EQU   8                                                  19084 31860002
FOX      EQU   255                                                19084 32040002
MSGLEN   EQU   96                      LENGTH FOR GETMAIN.        21002 32130002
GETERRCD EQU   X'3A'                   ERROR MESSAGE INDICATOR.  Y02669 32220002
UNITERR  EQU   X'0D'                   ERROR MESSAGE INDICATOR @ZM34520 32280003
D12      EQU   12                                                Y02669 32400002
D8       EQU   8                                                 Y02669 32490002
D3       EQU   3                                                 Y02669 32580002
D15      EQU   15                                                Y02669 32670002
D5       EQU   5                                                 Y02669 32760002
D64      EQU   64                                                Y02669 32850002
D16      EQU   16                                                Y02669 32940002
D68      EQU   68                                                Y02669 33030002
D46      EQU   46                                                Y02669 33120002
D76      EQU   76                                              @ZM34520 33210003
D132     EQU   132                                               Y02669 33300002
GRPX    EQU   X'FF'                   GRAPHICS INDICATOR          21002 33660002
SHIFT8  EQU   8                       REMOVE ONE BYTE             21002 33750002
MASK00   EQU   X'00'                                             Y02669 33840002
RIID     EQU   X'80'                                              19084 34020002
MC       EQU   X'80'                                              19084 34110002
USYSLG   EQU   X'00'                                              19084 34200002
         EJECT                                                          34290002
*********************************************************************** 34380002
*        CONSOLE PROCESSOR MODULE                                 19084 34470002
         BALR  R3,ZERO                                            19084 34560002
         USING *,R3                                               19084 34650002
         MODID BR=YES                                            Y01886 34740002
         USING XSA,R2                                             19084 34830002
         STM   R0,R15,ZERO(R13)                                  Y02669 34920002
         ST    R13,XAK           STORE SAVE AREA PTR, NEED R13 @Z30LPTJ 35010003
         L     R10,XAD                 SAVE FLAGS.               Y02669 35100002
         MVC   XAD(GETLNTH),GETLIST    MOVE IN GETMAIN LIST.      21002 35190002
         LA    R1,XAX                  GET ADDRESS POINTER.       21002 35280002
         ST    R1,XAX                  GETMAIN ADDRESS.           21002 35370002
         LA    R1,XAD                  GETMAIN LIST POINTER.      21002 35460002
         GETMAIN MF=(E,(1))            DO CONDITIONAL GETMAIN.    21002 35550002
         LTR   R15,R15                 WAS GETMAIN SUCCESSFUL ?   21002 35640002
         BNZ   GETFAIL                 NO,SO TAKE ERROR EXIT.     21002 35730002
* XAX CONTAINS THE ADDRESS OF GOTTEN CORE                               35820002
         STC   R4,XAX+FOR              SAVE GRAPHICS INDICATOR    21002 35910002
         ST    R10,XAD                 SET UP PASSED SWITCHES.    21002 36000002
         L     R4,XAR              PROCESS SWITCHES               19084 36090002
         XC    XAP(ONE),XAP        ZERO OUT THE SHIFT COUNTER  @ZM34520 36130003
         L     R9,XAL              GET PTR TO UNIT BEGIN          19084 36180002
         LA    R9,ZERO(R9)                                        19084 36270002
         L     R10,CVTPTR                                         19084 36360002
         USING CCVT,R10                                           19084 36450002
         L     R10,CVTCUCB         GET PTR TO UCM                 19084 36540002
         DROP  R10                                                19084 36630002
         USING UCM,R10                                                  36720002
*                                                                 19084 36810002
         LR    R11,R10             UCM PTR                        19084 36900002
         SH    R11,FOUR            MINUS FOUR IS UCMPFX ADD PTR   19084 36990002
         L     R11,ZERO(R11)       GET PFX PTR                    19084 37080002
         USING UCMPRFX,R11                                        19084 37170002
         EJECT                                                          37260002
**************************************************               Y02651 37350002
*                                                                Y02651 37440002
* LOCKS ARE NEEDED AT THIS POINT AS PROTECTION AGAINST COMM TASK Y02651 37530002
*  LOCKS WILL BE GOTTEN AT : CSETLOCK                            Y02651 37620002
*  AND THEY WILL BE RELEASED AT: UNSETLOK                        Y02651 37710002
*                                                                Y02651 37800002
         BAL   R8,CSETLOCK                                       Y02651 37890002
**************************************************               Y02651 37980002
         SPACE 2                                               @G51APSS 38020051
*********************************************************************** 38070051
*        IF A NO-CONSOLES CONDITION EXISTS THEN ISSUE MSG      @G51APSS 38074051
*        IEE744I AND IGNORE THE VARY CONSOLE                   @G51APSS 38078051
*********************************************************************** 38082051
         SPACE 1                                               @G51APSS 38086051
         TM    UCMSFLG1,UCMSYSE    DOES A NO-CONSOLES CONDITION EXIST? X38090051
                                                               @G51APSS 38094051
         BNO   OKPROCES            NO, PROCESS THE CMD         @G51APSS 38098051
         SR    R0,R0               READY FOR CONSOLE ID        @G51APSS 38102051
         TM    XAU,RIID            WAS IT READER COMMAND?      @G51APSS 38106051
         BO    ISS744I             YES, R0 IS NOW SET          @G51APSS 38110051
         IC    R0,XAU              GET CONSOLE ID              @G51APSS 38114051
ISS744I  EQU   *                                               @G51APSS 38118051
         BAL   R8,UNSETLOK         RELEASE THE LOCKS           @G51APSS 38122051
         LA    R1,NCCMSG           MSG IEE744I                 @G51APSS 38126051
         WTO   MF=(E,(1))          ISSUE MSG IEE744I           @G51APSS 38130051
         B     CLEANUP             GO FREE RESOURCES           @G51APSS 38134051
         SPACE 3                                               @G51APSS 38138051
OKPROCES EQU   *                                               @G51APSS 38142051
         TM    XADUSWIT,XAXPAREN   MULTIPLE UNITS              @Z30LPTJ 38160003
         BZ    CSINGLE             NO                             19084 38250002
CSTART   LA    R9,ONE(R9)          YES,INDEX PAST BEGINING PARE   19084 38340002
CSINGLE  EQU   *                                                  19084 38430002
         CLC   ZERO(TWO,R9),COUNIT      IS IT AN O-XXX            19084 38520002
         BNE   CCOMP                    NO, MAYBE A COMPOSITE     19084 38610002
         LA    R9,TWO(R9)               YES INDEX TO UNITNAME     19084 38700002
         OI    XADUSWIT,XAOUNIT       SET XAOUNIT SWITCH ON    @Z30LPTJ 38790003
         B     CTEST                    GO CHECK IF MUST PROCESS  19084 38880002
*                                                                 19084 38970002
CCOMP    EQU   *                                                  19084 39060002
         CLC   ZERO(TRE,R9),CIUNIT      DO WE HAVE A COMPOSITE    19084 39150002
         BNE   CTEST                  NO,ITS A REGULAR UNIT     19084   39240002
         LA    R9,TRE(R9)               YES,INDEX TO INPUT UNIT NM19084 39330002
         OI    XADUSWIT,XAIOCOMP        TURN COMPOSITE SWITCH  @Z30LPTJ 39420003
*                                                                 19084 39510002
CTEST    EQU   *                                                  19084 39600002
         LTR   R4,R4                    DO WE PROCESS THIS UNIT   19084 39690002
         BZ    CMSGRDY                  NO, AND NOMOR EITHER, FINI19084 39780002
         BM    CPROCES                  YES, PROCESS THIS ONE     19084 39870002
*                                       NO, NOT PROCESS THIS ONE  19084 39960002
COMIT    EQU   *                        THERE ARE OTHERS          19084 40050002
         TM    XADUSWIT,XAIOCOMP   WAS IT A COMP TO OMIT?      @Z30LPTJ 40140003
         BZ    CENDCK                   NO,                       19084 40230002
         LA    R9,SVN(R9)               YES INDEX OVER            19084 40320002
*                                                                 19084 40410002
CENDCK   EQU   *                                                  19084 40500002
         LA    R9,TRE(R9)               TO THE DELIMITER AFTER UNI19084 40590002
         NI    XADUSWIT,XAXPAREN TURN ALL OFF EXPT EXTR PARENS @Z30LPTJ 40680003
         SLL   R4,ONE              UP ALL SWITCHES               Y02669 40770002
         SR    R8,R8               ZERO OUT FOR NEXT INSTR.    @ZM34520 40780003
         IC    R8,XAP              OBTAIN CURRENT COUNTER      @ZM34520 40800003
         LA    R8,ONE(R8)          INCREMENT COUNTER BY ONE    @ZM34520 40820003
         STC   R8,XAP              STORE UPDATED SHIFT COUNTER @ZM34520 40840003
         B     CSTART              AND START AGAIN               Y02669 40860002
*                                                                 19084 40950002
CPROCES  EQU   *                                                  19084 41040002
         LM    R5,R7,UCMVEA        GET UCMES PTRS                 19084 41130002
         USING UCMLIST,R5                                         19084 41220002
CLOOP    L     R12,UCMUCB          AND UCB ADDRESSABILITY         19084 41310002
         USING CUCB,R12                                           19084 41400002
         CLC   ZERO(TRE,R9),UCBNAME     IS THIS THE UCME FOR UNIT 19084 41490002
         BE    CFIND               YES,                           19084 41580002
         BXLE  R5,R6,CLOOP         MUST BE NEXT ONE GO CHECK      19084 41670002
*                                  WILL ALWAYS FIND ONE,CHECKED BY 4203 41760002
CFIND    EQU   *                                                  19084 41850002
         TM    UCMATR,UCMUF        ACTIVE CONSOLE CURRENTLY       19084 41940002
         BO    CATTRIB             YES, GO CHANGE ATTRIBUTES ONLY 19084 42030002
*                                  CONSOLE IS NON ACTIVE          19084 42120002
         TM    UCBFLA,UCBNRY       IS DEVICE NOT READY?        @ZM34520 42150003
         BO    CONLINE             YES, ISSUE ERROR MESSAGE    @ZM34520 42180003
         TM    XADUSWIT,XAIOCOMP   PROCESSING I-UNIT           @Z30LPTJ 42210003
         BZ    CHCPREQ             NO,GO CHECK HCPY REQ          Y02669 42300002
*                                                                 19084 42390002
CSTATUS  EQU   *                                                  19084 42480002
*                                                                 19084 42570002
*        SET APPRORIATE BITS IN UCME AND UCB TO SHOW THAT THIS DEV19084 42660002
*        IS TO BE A CONSOLE                                       19084 42750002
*                                                                 19084 42840002
         OI    UCMSTS,UCMTA        OPEN FOR COMM TASK            Y02669 42930002
*        NI    SRTESTAT,FOX-SRTEDADI+SRTECHGS  TURN ALL PNDG BITSY02651 43020002
*                                 OFF JUST IN CASE THEY ARE ON   Y02651 43110002
*                                                                Y02651 43200002
********** THE ABOVE INSTRUCTION WILL BE PROTECTED VIA THE       Y02651 43290002
*          COMPARE-AND-SWAP INSTRUCTION                          Y02651 43380002
*                                                                Y02651 43470002
         L     R8,XAK             SAVE AREA POINTER            @Z30LPTJ 43560003
         STM   R4,R6,D68(R8)      STORE USED FOR OIL/NIL         Y02651 43650002
DADINI   EQU   *                                                 Y02651 43740002
NILDADI  EQU   X'FE'     -X'FF'-SRTEDADI-                        Y02651 43830002
         NIL   SRTESTAT,NILDADI,WREGS=(4,5,6),REF=CUCB           Y02651 44010002
CHGSNI   EQU   *                                                 Y02651 44100002
NILCHGS  EQU   X'BF'     -X'FF'-SRTECHGS-                        Y02651 44190002
         NIL   SRTESTAT,NILCHGS,WREGS=(4,5,6),REF=CUCB           Y02651 44370002
         LM    R4,R6,D68(R8)                                     Y02651 44460002
*                                                                Y02651 44550002
         TM    SRTESTAT,SRTEONLI   IS DEV CURRENTLY ONLINE        19084 44640002
         BO    CONLINE             YES,GO TO ONLINE PROCESSOR     19084 44730002
         EJECT                                                          44820002
*       NI    UCBWGT,FOX-UCBVORSN                                Y02669 45000002
*       OI    SRTESTAT,SRTEONLI+SRTESYSR  TURN ONL AND CONS BITS Y02651 45090002
*                                                                Y02651 45180002
********** THE ABOVE INSTRUCTION WILL BE PROTECTED VIA THE       Y02651 45270002
*          COMPARE-AND-SWAP INSTRUCTION                          Y02651 45360002
*                                                                Y02651 45450002
NILOPER  EQU   *                                                 Y02651 45540002
NILVORSN EQU   X'FB'    -X'FF'-UCBVORSN-                         Y02651 45630002
         NIL   UCBWGT,NILVORSN,WREGS=(4,5,6),REF=CUCB            Y02651 45810002
ONLIOI   EQU   *                                                 Y02651 45900002
         OIL   SRTESTAT,SRTEONLI,WREGS=(4,5,6),REF=CUCB          Y02651 45990002
OISYSR   EQU   *                                                 Y02651 46080002
         OIL   SRTESTAT,SRTESYSR,WREGS=(4,5,6),REF=CUCB          Y02651 46170002
         LM    R4,R6,D68(R8)                                     Y02651 46260002
*                                                                Y02651 46350002
*                                                                 19084 46440002
         B     CATTRIB             GO CHECK ATTRIBUTES            19084 46530002
*                                                                 19084 46620002
         EJECT                                                    19084 46710002
CONLINE  EQU   *                                                  19084 46800002
         L     R8,XAK             SAVE AREA POINTER            @Z30LPTJ 46890003
         STM   R4,R6,D68(R8)                                     Y02669 46980002
         TM    UCBFLA,UCBNRY       IS DEVICE NOT READY?        @ZM34520 46985003
         BNO   ITSREADY            NO, IT IS READY, BRANCH     @ZM34520 46991003
         TM    XADUSWIT,XAIOCOMP   IS IT COMPOSITE 'I-UNIT'?   @ZM34520 46997003
         BO    PARTTWO             YES, PROCESS 'O-UNIT'       @ZM34520 47003003
         L     R8,XAX              OBTAIN POINTER TO CORE      @ZM34520 47009003
         STM   R4,R6,D64(R8)       SAVE DATA IN GOTTEN CORE    @ZM34520 47015003
         L     R4,MASKBIT          GET MASK FOR BIT TURN OFF   @ZM34520 47021003
         L     R5,XAR              OBTAIN PROCESS BIT SWITCHES @ZM34520 47027003
         SR    R6,R6               ZERO OUT FOR NEXT INSTR.    @ZM34520 47033003
         IC    R6,XAP              OBTAIN THE SHIFT COUNTER    @ZM34520 47039003
         LTR   R6,R6               IS THERE ANY SHIFT COUNTER? @ZM34520 47045003
         BZ    AROUND              NO, BRANCH AROUND THE LOOP  @ZM34520 47051003
LOOP     EQU   *                                               @ZM34520 47057003
         SRL   R4,ONE              SHIFT RIGHT ONE BIT         @ZM34520 47063003
         BCT   R6,LOOP             LOOP UNTIL CORRECT POSITION @ZM34520 47069003
AROUND   EQU   *                                               @ZM34520 47075003
         XR    R5,R4               TURN OFF THE BAD UNIT BIT   @ZM34520 47081003
         SR    R6,R6               ZERO OUT FOR NEXT INSTR.    @ZM34520 47087003
         IC    R6,XAP              SAVE SHIFT COUNTER          @ZM34520 47093003
         MVI   XAE,UNITERR         SET ERROR MESSAGE CODE      @ZM34520 47099003
         MVC   XAV(D3),ZERO(R9)    MOVE IN INVALID DEVICE NAME @ZM34520 47105003
         MVC   XAV+TRE(D5),BLANKS  BLANK OUT REST OF AREA      @ZM34520 47111003
         MVC   D76(D16,R8),XAP     SAVE IMPORTANT XSA DATA     @ZM34520 47117003
         LR    R4,R8               SAVE THE SAVE AREA POINTER  @ZM34520 47123003
         BAL   R8,UNSETLOK         RELEASE THE LOCKS FOR WTO   @ZM34520 47129003
         L     R13,XAX             OBTAIN POINTER TO CORE      @ZM34520 47135003
         BAL   R8,MSGMODA          ISSUE THE ERROR MESSAGE     @ZM34520 47141003
         BAL   R8,CSETLOCK         OBTAIN THE LOCKS            @ZM34520 47147003
         LR    R8,R4               RESTORE THE SAVE AREA PTR.  @ZM34520 47153003
         MVC   XAP(D16),D76(R8)    RESTORE THE XSA DATA        @ZM34520 47159003
         MVC   XAV(EIT),VARYID     RESTORE 'VARY' CMD. NAME    @ZM34520 47165003
         ST    R5,XAR              STORE UPDATED BIT SWITCHES  @ZM34520 47171003
         STC   R6,XAP              RESTORE THE SHIFT COUNTER   @ZM34520 47177003
         LM    R4,R6,D64(R8)       RESTORE SAVED REGISTERS     @ZM34520 47183003
         B     CRETURN             CHECK FOR MORE UNITS        @ZM34520 47189003
ITSREADY EQU   *                                               @ZM34520 47195003
         TM    SRTESTAT,SRTEALOC   IS DEVICE ALLOCATED            19084 47232003
         BO    ONALLOC             YES, GO PROCESS ACCORDINGLY    19084 47240003
*        OI    SRTESTAT,SRTESYSR   NO, SET CONSOLE BIT IN UCB    Y02651 47250002
         B     OISYSR              GO EXECUTE THE ABOVE INSTR    Y02651 47340002
*                                                                 19084 47430002
ONALLOC  EQU   *                                                  19084 47520002
*        OI    SRTESTAT,SRTEDADI   TURN ON CHANGE STATUS BIT     Y02651 47610002
*                                                                Y02651 47700002
********** THE ABOVE INSTRUCTION WILL BE PROTECTED VIA THE       Y02651 47790002
*          COMPARE-AND-SWAP INSTRUCTION                          Y02651 47880002
*                                                                Y02651 47970002
OIDADI   EQU   *                                                 Y02651 48060002
         OIL   SRTESTAT,SRTEDADI,WREGS=(4,5,6),REF=CUCB          Y02651 48150002
         L     R15,CVTPTR          OBTAIN CVT POINTER          @ZA02592 48160003
         USING CCVT,R15                                        @ZA02592 48170003
         L     R15,CVTMSER         GET MASTER RESIDENT CORE    @ZA02592 48180003
         DROP  R15                                             @ZA02592 48190003
         USING BASE,R15                                        @ZA02592 48200003
         OIL   MSECBFL,MSSUM,WREGS=(4,5,6),REF=BASE            @ZA02592 48210003
         DROP  R15                                             @ZA02592 48220003
         LM    R4,R6,D68(R8)                                     Y02651 48240002
         B     CATTRIB             GO CHECK CONSOLES ATTRIBUTES   19084 48330002
         EJECT                                                          48420002
CHCPREQ  EQU   *                                                  19084 48510002
*                                                                 19084 48600002
*        PROCESING AN OUTPUT ONLY, AN IO CONSOLE, OR THE O-UNIT OF19084 48690002
*        COMPOSITE. THEREFORE HARDCPY REQUIREMENTS MUST BE CHECKED19084 48780002
*        R5    UCME PTR TO NEW CONSOLE                           Y02669 48870002
*        R9    PTS TO UNIT IN COMMAND                             19084 48960002
*        R10   UCM PTR                                            19084 49050002
*        R11   UCMPFX PTR                                         19084 49140002
*        R12   UCB PTR                 *                          21051 49230002
*                                                                 21051 49320002
         OI    UCMSFLGS,UCMSYSB    TURN HCPY EXISTS BIT        @YM08624 49330002
         L     R7,UCMHCUCM         HARDCOPY ADDRESS, IF PRESENT@YM07658 49340002
         LTR   R7,R7               HARDCOPY PRESENT?           @YM07658 49360002
         BNZ   MANDRT              YES, CHECK AUTHORITY        @YM07658 49380002
*        NO HCPY EXISTS, THEREFORE PAST- ONE ACTV CONS - MSTR     19084 49590002
*                                  NOW - NEW CONSOLE WILL MAKE HCP19084 49680002
*                                        MANDATORY                19084 49770002
         TM    UCMSFLGS,UCMSYSG        IS SYSLOG FUNCTIONING     Y02669 49860002
*                                 AS THE HARDCPY LOG NOW         Y02669 49950002
         BO    MANDRT             YES, CK CMD AUTHORITY          Y02669 50040002
         L     R15,CVTPTR                                        Y02669 50220002
         USING CCVT,R15                                          Y02669 50310002
         L     R15,CVTMSER         PICK UP MSTER RES CORE ADDR   Y02669 50400002
         DROP  R15                                               Y02669 50490002
         USING BASE,R15                                          Y02669 50580002
         CLI   BALOG,USYSLG        IS SYSLOG SUPPORTED           Y02669 50670002
         BNE   SYSHCPY             YES, MAKE IT THE HARDCPY      Y02669 50760002
         DROP  R15                                               Y02669 50850002
*                                                                Y02669 50940002
*     CONTINUE TO FIND MASTER'S UCME SINCE SYSLOG IS NOT ACTIVE  Y02669 51030002
*                                                                Y02669 51120002
         LM    R13,R15,UCMVEA                                     19084 51210002
         DROP  R5                                                 19084 51300002
         USING UCMLIST,R13                                        19084 51390002
CTST     EQU   *                                                  19084 51480002
         TM    UCMDISP,UCMDISPA    IS THIS THE MSTR CONSOLE       19084 51570002
         BO    CMSTR               YES,FOUND IF                   19084 51660002
         BXLE  R13,R14,CTST        NO,MUST BE NEXT                19084 51750002
CMSTR    EQU   *                   NO,ERROR CONDITION             19084 51840002
         TM    UCMDISP,UCMDISPC    IS THE MASTER A GRAPHICS      Y02669 51930002
         BO    CXSTS               YES, CHECK THE NEW CONSOLE    Y02669 52020002
         OI    UCMDISP,UCMDISPB    TURN MSTR UCME TO INDICATE HCPY19084 52110002
         ST    R13,UCMHCUCM        AND STORE PTR TO IT IN PFX     19084 52200002
         DROP  R13                                                19084 52290002
         USING UCMLIST,R5                                         19084 52380002
         B     MANDRT01            SET MANDATORY ROUTS AND CMDS  Y02669 52470002
*                                                                 19084 52560002
*        HARDCPY DOES EXIST- CHECK IF IT IS GFX                   19084 52650002
*                                                                 19084 52740002
CXSTS    EQU   *                                                  19084 52830002
         TM    UCMDISP,UCMDISPC    IS NEW CONS. A GFX                   52920002
         BO    CBOTHGFX            OOPS-BOTH ARE GFX CONSOLES           53010002
*                                                                       53100002
*    NEW CONSOLE IS PAPER PROD, THEREFORE MAKE NEW CONSOLE INTO         53190002
*    HARDCPY                                                            53280002
*                                                                       53370002
         OI    UCMDISP,UCMDISPB    TURN HCPY BIT IN NEW CONSOLE         53460002
         ST    R5,UCMHCUCM         STORE ITS UCME PTR IN HCPY PTR       53550002
         B     MANDRT02            GO SET MANDTRY ROUTCDS AND CM Y02669 53640002
*                                                                 19084 53730002
*        BOTH CONSOLES ARE GFX                                    19084 53820002
*                   IF SYSLOG IS PRESENT MAKE IT HCPY             19084 53910002
*                   ELSE LEAVE ALL AS IS                          19084 54000002
*                                                                 19084 54090002
*                                                                 19084 54180002
CBOTHGFX EQU   *                                                 Y02669 54270002
         NI    UCMSFLGS,FOX-UCMSYSB   TURN OFF BIT,CANT GET HCPY Y02669 54360002
*****************************************************************Y02669 54450002
*   MESSAGE - SINCE CANNOT GET A HARDCPY DEVICE                  Y02669 54540002
*****************************************************************Y02669 54630002
         SR    R0,R0                                             Y02669 54720002
         TM    XAU,RIID            WAS IT AN INPUT STREAM COMD.  Y02669 54810002
         BO    RDRCMD              YES, R0 FOR WTO IS PRESET     Y02669 54900002
         IC    R0,XAU              GET CONSL ID INTO R0 FOR WTO  Y02669 54990002
RDRCMD   EQU   *                                                 Y02669 55080002
         SPACE 3                                               @G51APSS 55120051
**************************************************               Y02651 55260002
*                                                                Y02651 55350002
*  LOCKS MUST BE RELEASED AT THIS POINT.  A WTO MACRO            Y02651 55440002
*  MUST BE ISSUED                                                Y02651 55530002
*  LOCKS WERE OBTAINED EARLIER AT:                               Y02651 55620002
*    CSETLOCK                                                    Y02651 55710002
*                                                                Y02651 55800002
         BAL   R8,UNSETLOK                                       Y02651 55890002
*                                                                Y02651 55980002
**************************************************               Y02651 56070002
         SPACE 2                                               @G51APSS 56110051
         LA    R1,NOCPYMSG         GET ADDRESS OF THE MESSAGE    Y02669 56250002
         WTO   MF=(E,(1))          ISSUE THE MESSAGE             Y02669 56340002
         SPACE 2                                               @G51APSS 56380051
**************************************************               Y02651 56520002
*                                                                Y02651 56610002
*  WTO MACRO HAS BEEN ISSUED. NEW LOCKS MUST BE OBTAINED         Y02651 56700002
*  TO PROTECT AGAINST COMM. TASK AND ANOTHER VARY CMD            Y02651 56790002
*  THEY WILL BE RELEASED AT:                                     Y02651 56880002
*      UNSETLOK                                                  Y02651 56970002
*                                                                Y02651 57060002
         BAL   R8,CSETLOCK                                       Y02651 57150002
*                                                                Y02651 57240002
**************************************************               Y02651 57330002
         SPACE 2                                               @G51APSS 57370051
         B     CSTATUS             GO CHANGE CONSOLE'S STATUS           57510002
         SPACE 5                                               @G51APSS 57550051
SYSHCPY  EQU   *                                                 Y02669 57870002
         XC    UCMHCUCM(FOR),UCMHCUCM   ZERO OUT HCPY PTR SHOWING 19084 57960002
         OI    UCMSFLGS,UCMSYSG    TURN BIT IN PRX MEANING SYSLOG 19084 58050002
*                                  IS HARDCPY                     19084 58140002
MANDRTS  EQU   *                                                 Y02669 58230002
         L     R1,XAX             POINTER TO GOTTEN CORE         Y02669 58320002
         MVC   ZERO(D46,R1),HCPYMSG   MOVE MSG INTO DYNAMIC CORE Y02669 58410002
         MVC   D12(D8,R1),SYSLOGUT ISSUE MSG ,SYSLOG IS HCPY NOW Y02669 58500002
         B     READY               CONTINUE MSG PROCESSING       Y02669 58590002
*                                                                 19084 58680002
*                                                                Y02669 58770002
*                                                                Y02669 58860002
MANDRT01 EQU   *                                                 Y02669 58950002
         DROP  R5                                                Y02669 59040002
         DROP  R12                                               Y02669 59130002
         USING UCMLIST,R13         ADDRESS OF MASTER'S UCME      Y02669 59220002
         L     R8,UCMUCB           AND ITS UCB                   Y02669 59310002
         USING CUCB,R8                                           Y02669 59400002
PUTMSG   EQU   *                                                 Y02669 59490002
         L     R1,XAX              POINTER TO GOTTEN CORE        Y02669 59580002
         MVC   ZERO(D46,R1),HCPYMSG     MOVE MSG INTO DYNAM CORE Y02669 59670002
         MVC   D12(D3,R1),UCBNAME  MOVE IN MASTER'S UNITNAME     Y02669 59760002
         MVC   D15(D5,R1),BLANKS   PAD WITH BLANKS               Y02669 59850002
         DROP  R8                                                Y02669 59940002
         USING CUCB,R12                                          Y02669 60030002
READY    EQU   *                                                 Y02669 60120002
         SR    R0,R0               READY CUMID REG FOR WTO       Y02669 60210002
         TM    XAU,RIID            WAS IT A READER COMMAND       Y02669 60300002
         BO    WRITEMSG            YES, R0 IS ALL PRESET         Y02669 60390002
         IC    R0,XAU              PRESET CONSOLE ID             Y02669 60480002
WRITEMSG EQU   *                                                 Y02669 60570002
         SPACE 2                                               @G51APSS 60610051
**************************************************               Y02651 60750002
*                                                                Y02651 60840002
*  LOCKS MUST BE RELEASED AT THIS POINT. A WTO MACRO             Y02651 60930002
*  MUST BE ISSUED.                                               Y02651 61020002
*  LOCKS WERE OBTAINED EARLIER AT:                               Y02651 61110002
*        CSETLOCK                                                Y02651 61200002
*                                                                Y02651 61290002
         BAL   R8,UNSETLOK                                       Y02651 61380002
*                                                                Y02651 61470002
**************************************************               Y02651 61560002
         SPACE 2                                               @G51APSS 61600051
         WTO   MF=(E,(1))          ISSUE MESSAGE                 Y02669 61740002
         SPACE 2                                               @G51APSS 61780051
**************************************************               Y02651 61920002
*                                                                Y02651 62010002
*  WTO MACRO HAS BEEN ISSUED. NEW LOCKS MUST BE OBTAINED         Y02651 62100002
*  TO PROTECT AGAINST COMM. TASK                                 Y02651 62190002
*  THEY WILL BE RELEASED AT:                                     Y02651 62280002
*      UNSETLOK                                                  Y02651 62370002
*                                                                Y02651 62460002
         BAL   R8,CSETLOCK                                       Y02651 62550002
*                                                                Y02651 62640002
**************************************************               Y02651 62730002
         SPACE 2                                               @G51APSS 62770051
         B     MANDRT              CONTINUE CONSOLE PROCESSING   Y02669 62910002
         DROP  R13                                               Y02669 63000002
         USING UCMLIST,R5                                        Y02669 63090002
         SPACE 5                                               @G51APSS 63130051
MANDRT02 EQU   *                                                 Y02669 63450002
         L    R8,UCMUCB            GET UCB ADDRESS OF CONSOLE    Y02669 63540002
         B     PUTMSG                                            Y02669 63630002
*                                                                Y02669 63720002
*                                                                Y02669 63810002
*                                                                Y02669 63900002
MANDRT   EQU   *                                                  21002 63990002
         TM    UCMSDS1,UCMSDS1A+UCMSDS1B STCMDS OR INCMDS         21002 64080002
         BNZ   MANDRT1             YES, DON'T CHANGE AUTHORITY    21002 64170002
CRTCODE  EQU   *                                                  19084 64260002
         OI    UCMSFLGS,UCMSYSC         CMDS TO HCPY              21002 64350002
MANDRT1  EQU   *                                                  21002 64440002
         OC    UCMHRDRT(TWO),CHARTRT    MANDATORY ROUT CDS        19084 64530002
         B     CSTATUS             GO TO CHANGE STATUS TO CONSOLE 19084 64620002
*                                                                 19084 64710002
         EJECT                                                          64800002
CATTRIB  EQU   *                                                  19084 64890002
         TM    UCMDISP,UCMDISPA    MSTR CONSOLE                   19084 64980002
         BNO   NO                      NO                         M0739 65070002
         TM    XADUSWIT,XAIOCOMP       IS MASTER A COMPOSITE?  @Z30LPTJ 65160003
         BNO   CROUT                   NO                         M0739 65250002
         OI    XASWITCH,XACOMPMS     YES,TURN ON MAST COMP BIT @Z30LPTJ 65340003
         B    CROUT                    DO NOT CHANGE CMD AUTH     M0739 65430002
NO       TM    XADUSWIT,XAOUNIT           OUTPUT ONLY          @Z30LPTJ 65520003
         BO    CROUT               YES, DO NOT CHANGE CMD AUTH    19084 65610002
         TM    XADUSWIT,XAIPAREN        O-UNIT OF COMP?        @Z30LPTJ 65700003
         BO    CROUT                    YES,OMIT CMD AUTH CHANGES 19084 65790002
         TM    XASOPCOD,XACMD      ARE CMD AUTHS TO BE CHANGED @Z30LPTJ 66060003
         BZ    CROUT               NO, GO CHECK IF ROUT TO BE CHAN19084 66150002
         MVC   UCMAUTH(TWO),XACMDATH PUT NEW CMD AUTH INTO UCME@Z30LPTJ 66240003
*                                                                 19084 66330002
CROUT    EQU   *                                                  19084 66420002
         TM    XASWITCH,XAROUT     IS ROUTS TO BE CHANGED?     @Z30LPTJ 66510003
         BZ    CALT                NO, SEE IF ALT MUST BE CHANGED 19084 66600002
         TM    XADUSWIT,XAIOCOMP   I-UNIT OF COMP?             @Z30LPTJ 66690003
         BO    CALT                YWA,OMIT ROUT CHANGES          19084 66780002
CMOVERT  MVC   UCMRTCD(TWO),XARTCODE   YES, MOVE RTS INTO UCME @Z30LPTJ 66870003
         TM    UCMDISP,UCMDISPA        MSTR CONSOLE               M0739 66960002
         BO    TURNONE                 YES, BRANCH                M0739 67050002
         TM    XASWITCH,XACOMPMS       COMPOSITE MASTER IF SO, @Z30LPTJ 67140003
         BNO   CALT                    UCME IS OF OUTPUT DEVICE   M0739 67230002
*                                      AND MASTER BIT IS ON ONLY  M0739 67320002
*                                      FOR INPUT DEVICE           M0739 67410002
TURNONE  OI    UCMRTCD,MC              TURN ON ROUT CODE 1        M0739 67500002
         NI    XASWITCH,FOX-XACOMPMS   ENSURE BIT IS TURNED OFF@Z30LPTJ 67590003
CALT     EQU   *                                                  19084 67680002
         TM    XASWITCH,XALTCHG    IS ALTERNATE TO BE CHANGED  @Z30LPTJ 67770003
         BZ    CRETURN             NO, GO MAKE FINAL CHECKS       19084 67860002
         TM    XASOPCOD,XALTCOM    IS ALT AN O-UNIT            @Z30LPTJ 67950003
         BZ    CALTCOMP            NO,MAYBE A COMP                19084 68040002
         BAL   R6,CID              GET UCME OF ALTERNATE          19084 68130002
CCOMPALT XC    UCMOAOEN(FOR),UCMOAOEN   ZERO OUT ALTS-COMPOS PTR  19084 68220002
         B     CRETURN             GO, MAKE FINAL CHECKS          19084 68310002
*                                                                 19084 68400002
CALTCOMP EQU   *                                                  19084 68490002
         TM    XASOPCOD,XALTCON    IS ALTERNATE A COMPOSITE    @Z30LPTJ 68580003
         BZ    CALTREG             NO, IO CONSOLE                 19084 68670002
         BAL   R6,CID              GO GET ALTERNATES UCME         19084 68760002
         DROP  R5                                                 19084 68850002
         USING UCMLIST,R15                                        19084 68940002
         L     R15,UCMCOMPC        GET PTR TO COMPOS OF ALTERNATE 19084 69030002
         DROP  R15                                                19084 69120002
         USING UCMLIST,R5                                         19084 69210002
         ST    R15,UCMOAOEN        STORE  IT IN NEW CONSL UCME    19084 69300002
*                                                                 19084 69390002
CRETURN  EQU   *                                                  19084 69480002
         TM    XADUSWIT,XAIOCOMP   PROCESSIN I-XXX?            @Z30LPTJ 69570003
         BZ    CNOIUNT             NO                             19084 69660002
PARTTWO  EQU   *                       *                          21051 69750002
         LA    R9,SIX(R9)          INDEX TO OUTPUT UNITNAME       19084 69840002
         NI    XADUSWIT,FOX-XAIOCOMP TURN OFF COMPOSITE SWITCH @Z30LPTJ 69930003
         OI    XADUSWIT,XAIPAREN   TURN ON OUT-OF-COMP- SWITCH @Z30LPTJ 70020003
         L     R5,UCMCOMPC         GET OUTPUT UCME PTR            19084 70110002
         B     CLOOP               GO PROCESS IT                  19084 70200002
*                                                                 19084 70290002
CALTREG  EQU   *                                                  19084 70380002
         BAL   R6,CID              GO GET ALTERNATES UCME         19084 70470002
         B     CCOMPALT            GO FIX PTRS                    19084 70560002
*                                                                 19084 70650002
*                                                                 19084 70740002
CNOIUNT  EQU   *                                                  19084 70830002
         TM    XADUSWIT,XAIPAREN   PROCESSIN OUT-OF-COMPOS?    @Z30LPTJ 70920003
         BZ    CENDCK              NO, GO CHECK EOB               19084 71010002
         LA    R9,ONE(R9)          YES, ADD 1 FOR INTERNAL PARENS 19084 71100002
         B     CENDCK              GO CHECK EOB                   19084 71190002
*        GET ALTERNATE UCME ROUTINE                               19084 71280002
*                                                                 19084 71370002
CID      EQU   *                                                  19084 71460002
         SR    R15,R15                                            19084 71550002
         LR    R7,R14              SAVE RET ADDRESS               19084 71640002
         IC    R15,XALTPTR         GETCONS ID OF ALTERNATE        19084 71730002
         BCTR  R15,ZERO            MINUS 1                        19084 71820002
         L     R14,UCMVEZ          GET SIZE OF UCMES              19084 71910002
         MR    R14,R14             TIMES ID                       19084 72000002
         A     R15,UCMVEA          PLUS ADDR OF FIRST UCME        19084 72090002
         ST    R15,UCMALTEN        EQUALS ADDR OF ALT UCME        19084 72180002
         LR    R14,R7              RESTORE RET ADDRESS            19084 72270002
         BR    R6                  RETURN                         19084 72360002
         EJECT                                                    19084 72450002
*        ISSUE HEADER FOR CONSOLES MSG                            19084 72540002
CMSGRDY  EQU   *                                                  19084 72630002
         SPACE 5                                                        72720003
**************************************************               Y02651 72810002
*                                                                Y02651 72900002
*  WE ARE FINISHED PROCESSING THE COMMAND AND WTO MACROS         Y02651 72990002
*  WILL NOW BE ISSUED.  THE LOCKS OBTAINED AT:                   Y02651 73080002
*        CSETLOCK                                                Y02651 73170002
*  WILL NOW BE RELEASED AT:                                      Y02651 73260002
*        UNSETLOK                                                Y02651 73350002
*                                                                Y02651 73440002
         BAL   R8,UNSETLOK                                       Y02651 73530002
*                                                                Y02651 73620002
**************************************************               Y02651 73710002
         SPACE 2                                               @G51APSS 73750051
         L     R4,XAR              OBTAIN THE PROCESS SIWTCHES @ZM34520 73809003
         LTR   R4,R4               ARE THERE ANY BITS LEFT?    @ZM34520 73818003
         BNZ   DISPLAY             YES, PROCEED TO DISPLAY     @ZM34520 73827003
CLEANUP  EQU   *                                               @G51APSS 73831051
         BAL   R8,CDEQUE           NO, PREPARE FOR EXIT        @ZM34520 73836003
         L     R1,XAX              OBTAIN GOTTEN CORE ADDRESS  @ZM34520 73845003
         FREEMAIN R,LV=96,A=(1),SP=229                         @ZM34520 73854003
         L     R13,XAK             GET SAVE AREA ADDRESS       @ZM34520 73863003
         B     RETURN              BRANCH TO SET UP RETURN     @ZM34520 73872003
DISPLAY  EQU   *                                               @ZM34520 73881003
         L     R4,XAX                  ADDRESS OF GOTTEN CORE     21002 73890002
         LR    R1,R4                   SAVE ADDRESS               21002 73980002
         LA    R6,CHEADR                                          19084 74070002
         MVC   ZERO(LCHEADR,R1),ZERO(R6)  MOVE MSG TO BUFFER      21002 74160002
         CLI   XAX+FOR,GRPX            ARE ANY CONSOLES GRAPHICS  21002 74250002
         BE    CONSOLE                 YES, MSG CONTAINS AREA LABE21002 74340002
         USING MSGDSECT,R1                                        21002 74430002
         MVC   AREA(SIX),ROUTCD        REMOVE AREA FIELD          21002 74520002
         MVI   LABEL+ONE,NEWLEN        CHANGE LEN OF LABEL LINE   21002 74610002
         DROP  R1                                                 21002 74700002
CONSOLE  EQU   *                                                  21002 74790002
         SR    R0,R0                                              19084 74880002
         TM    XAU,RIID                 GET CONSOLE ID FOR WTO    19084 74970002
         BO    CHEADER                                            19084 75060002
         IC    R0,XAU                                             19084 75150002
*                                                                 19084 75240002
CHEADER  EQU   *                                                  19084 75330002
         STC   R0,XAU                                             19084 75420002
         WTO   MF=(E,(1))          ISSUE MSG                      19084 75510002
*                                                                 19084 75600002
         SPACE 10                                                 19084 75690002
EXIT     EQU   *                                                  19084 75780002
         L     R13,XAK           RESTORE REG13 TO PT TO SVAREA @Z30LPTJ 75870003
         ST    R4,D16(R13)        STORE MSG ADDR                 Y02669 75960002
         LM    R2,R15,EIT(R13)                                   Y02669 76050002
         LR    R6,R1                GET MLWTO ID FOR IEE7303D     21002 76140002
         SLL   R6,SHIFT8               PUT MLWTO INTO HI ORDER BYT21002 76230002
         IC    R6,XAX+FOR              INSERT GRAPHICS INDICATOR  21002 76320002
         ST    R6,XAP              STORE IT INTO THE XAP OF XSA  Y02669 76410002
         LR    R1,R4                   POINTER TO MSG AREA        21002 76500002
         NI    XADUSWIT,ZERO+XAXPAREN+XAUDVC TURN OFF ALL BUT IO & XPAR*76590003
                                                               @Z30LPTJ 76630003
         MVI   XARESV,MASK00      SET UP 48/7303D SWITCHES     @Z30LPTJ 76700003
*                                 TO 0 SINCE THIS WILL BE THE    Y02669 76770002
*                                 FIRST ENTRY TO 4803D           Y02669 76860002
*                                                                 19084 76950002
*        XAU HAS CONSOLE ID OF CONSOLE,RDR OF SYSTEM              19084 77040002
*        XAR HAS PROCESS SWITCHES                                 19084 77130002
*        XAL HAS PTR TO UNIT FIELD                                19084 77220002
*        XAP HAS MLWTO ID AND GFX INDICATOR                      Y02669 77310002
*                                                                 19084 77400002
         MVC   XAX(EIT),CONSMSG         4803D NAME                19084 77490002
         L     R15,VCON48          GET ADDRESS OF IEE4803D       Y02669 77580002
         BR    R15                 GO TO IT                      Y02669 77670002
         EJECT                                                          77760002
*                                                                Y02669 77850002
*                                                                Y02669 77940002
GETFAIL  EQU   *                                                  21002 78030002
         BAL   R8,CDEQUE           DEQUEUE THE HELD RESOURCES  @ZM34520 78040003
         MVI   XAE,GETERRCD        GETMAIN FAIL MESSAGE CODE   @ZM34520 78240003
         BAL   R8,MSGMOD           ISSUE THE ERROR MESSAGE     @ZM34520 78440003
RETURN   EQU   *                                               @ZM34520 78640003
         L     R13,XAK          RESTORE SAVE AREA PTR INTO R13 @Z30LPTJ 79200003
         L     R1,D64(R13)         GET CSCB ADDRESS              Y02669 80100002
         USING CHAIN1,R1                                         Y02669 80190002
         OI    CHSTS,CHFC          SET FREE CSCB FLAG            Y02669 80280002
         MGCR  (1),CHAIN                                         Y02669 80370002
         LM    R0,R15,ZERO(R13)                                  Y02669 80460002
         LR    R4,R14              SAVE RETURN ADDRESS           Y02669 80550002
         L     R0,XAWORKA          LOAD LV PARAM               @ZA13369 80640051
         LR    R1,R2                                             Y02669 80730002
         FREEMAIN  R,LV=(0),A=(1)  FREE DUMMY XSA                Y02669 80820002
         LR    R14,R4              RESTORE RETURN ADDRESS        Y02669 80910002
         BR    R14                 RETURN                        Y02669 81000002
         EJECT                                                          81090002
**************************************************               Y02651 81900002
*                                                                Y02651 81990002
*  THE OBTAIN LOCKS SUBROUTINE FOLLOWS:                          Y02651 82080002
*  THESE LOCKS ARE RELEASED AT: UNSETLOK                         Y02651 82170002
         DS    0H                                                       82210002
CSETLOCK EQU   *                                                 Y02651 82260002
         L     R15,XAK            SAVE AREA POINTER            @Z30LPTJ 82350003
         STM   R11,R14,D68(R15)                                  Y02651 82440002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02651*82530002
               RELATED=(IEE4903D(UNSETLOK))                      Y02651 82620002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02651*82710002
               RELATED=(IEE4903D(UNSETLOK))                      Y02651 82800002
         LM    R11,R14,D68(R15)                                  Y02651 82890002
         BR    R8                                                Y02651 82980002
**************************************************               Y02651 83070002
         EJECT                                                          83160002
**************************************************               Y02651 83250002
*                                                                Y02651 83340002
*  THE RELEASE LOCKS SUBROUTINE FOLLOWS.                         Y02651 83430002
*  THESE LOCKS ARE OBTAINED AT: CSETLOCK                         Y02651 83520002
*                                                                Y02651 83610002
UNSETLOK EQU   *                                                 Y02651 83700002
         L     R15,XAK            SAVE AREA POINTER            @Z30LPTJ 83790003
         STM   R11,R14,D68(R15)                                  Y02651 83880002
         SETLOCK  RELEASE,TYPE=CMS,RELATED=(IEE4903D(CSETLOCK))  Y02651 83970002
         SETLOCK  RELEASE,TYPE=LOCAL,RELATED=(IEE4903D(CSETLOCK)) 02651 84060002
*                                                                Y02651 84150002
         LM    R11,R14,D68(R15)                                  Y02651 84240002
         BR    R8                                                Y02651 84330002
**************************************************               Y02651 84420002
         EJECT                                                          84510002
**************************************************             @ZM34520 84515003
*                                                              @ZM34520 84520003
*  THIS A TERMINAL EXIT FROM THIS MODULE.                      @ZM34520 84525003
*  THE ENQ ISSUED IN MODULE IEE3603D MUST BE DEQUEUED OFF.     @ZM34520 84530003
*                                                              @ZM34520 84535003
CDEQUE   EQU   *                                               @ZM34520 84540003
         USING IEE36DEQ,R1                                     @ZA12404 84540651
         L     R1,XAWORKB          REG1, PARM LIST POINTER     @ZA12404 84541251
         DEQ   MF=(E,(R1))         FREE RESOURCES              @ZA12404 84541851
         DROP  R1                                              @ZA12404 84544251
         BR    R8                 RETURN TO CALLER             @ZM34520 84550003
**************************************************             @ZM34520 84555003
         EJECT                                                          84560003
**************************************************             @ZM34520 84565003
MSGMOD   EQU   *                                               @ZM34520 84572003
         L     R13,XAK            RESTORE SAVE AREA POINTER    @ZM34520 84579003
MSGMODA  EQU   *                                               @ZM34520 84586003
         STM   R0,R15,ZERO(R13)                                @ZM34520 84593003
         MVC   XAX(EIT),ERRORMOD  SET IGC2103D NAME            @ZM34520 84600003
         LOAD  EP=IEE2103D                                     @ZM34520 84607003
         LR    R15,R0             STORE ROUTINE'S ADDRESS      @ZM34520 84614003
         BALR  R14,R15            GO TO 2103D TO PUT MESSAGE   @ZM34520 84621003
         LM    R0,R15,ZERO(R13)                                @ZM34520 84628003
         DELETE  EP=IEE2103D                                   @ZM34520 84635003
         BR    R8                 RETURN TO CALLER             @ZM34520 84642003
**************************************************             @ZM34520 84649003
         EJECT                                                          84660003
*********************************************************************** 84670003
*                                                                 19084 84690002
*        DECLARES                                                 19084 84780002
*                                                                 19084 84870002
*********************************************************************** 84960002
MASKBIT  DC    X'80000000'         MASK TO TURN OFF BAD BIT    @ZM34520 85000003
FOUR     DC    H'4'                                               19084 85050002
COUNIT   DC    C'O-'               O-XXX                          19084 85140002
CIUNIT   DC    C'(I-'              COMPOSITE                      19084 85230002
CHARTRT  DC    X'F340'             HARDCPY MANDATORY ROUT CODES   19084 85320002
SYSLOGUT DC    C'SYSLOG  '                                       Y02669 85410002
BLANKS   DC    CL5'     '                                        Y02669 85500002
VARYID   DC    C'VARY    '                                     @ZM34520 85540003
         SPACE 2                                               @G51APSS 85560051
         DS    0F                                                Y02669 85680002
VCON48   DC    V(IEE4803D)                                       Y02669 85770002
CONSMSG  DC    C'IEE4803D'                                       Y02669 85860002
ERRORMOD DC    C'IEE2103D'             ERROR MODULE.             Y02669 85950002
         SPACE 2                                               @G51APSS 86040051
GETLIST  GETMAIN EC,LV=MSGLEN,A=0,SP=229,MF=L                    Y02669 86310002
GETLNTH  EQU   *-GETLIST               LENGTH OF LIST FORM.       21002 86400002
         EJECT                                                          86490002
*********************************************************************** 86670002
*                                                                 19084 86760002
*        MESSAGE LIST FORMS                                    @G51APSS 86800051
*                                                                 19084 86940002
*********************************************************************** 87030002
         SPACE 1                                               @G51APSS 87070051
CHEADR   WTO   ('IEE349I CONSOLES',C),('CONSOLE/ALT     COND   AUTH   I*87120002
               D  AREA    ROUTCD',L),MF=L,DESC=(5),MCSFLAG=(REG0,RESP)  87210002
CEND     EQU   *                       END OF WTO                 21002 87300002
LCHEADR  EQU   CEND-CHEADR             LENGTH OF WTO              21002 87390002
         SPACE 2                                               @G51APSS 87430051
NOCPYMSG WTO   'IEE709I HARDCOPY REQUIRED-NO HARDCOPY DEVICE AVAILABLE'*87570002
               ,MF=L,DESC=(5),MCSFLAG=(REG0,RESP)                Y02669 87660002
         SPACE 2                                               @G51APSS 87700051
HCPYMSG  WTO   'IEE710I         NOW RECEIVING HARDCOPY',MF=L,DESC=(5), *87840002
               MCSFLAG=(REG0,RESP)                               Y02669 87930002
         SPACE 2                                               @G51APSS 87940051
NCCMSG   WTO   ('IEE744I VARY CONSOLE REJECTED - NO FULL CAPABILITY CONX87950051
               SOLES',D),                                              X87960051
               ('     TO RESTORE MASTER CONSOLE:',D),                  X87970051
               ('     1) PRESS ENTER, REQUEST, OR END ON ANY AVAILABLE X87975051
               CONSOLE',D),                                            X87986051
               ('     2) PRESS THE EXTERNAL INTERRUPT KEY',DE),        X88000051
               MF=L,DESC=(5),MCSFLAG=(REG0,RESP)               @G51APSS 88010051
         SPACE 5                                                        88110002
         DS    0F                                              @G51APSS 88140051
PATCH    DC    4CL25'**IEE4903D PATCH AREA **'                 @G51APSS 88170051
         SPACE 5                                                        88290002
MSGDSECT DSECT                                                    21002 88380002
CONTROL  DS    7F                                                 21002 88470002
LABEL    DS    38C                     UP TO AREA FIELD           21002 88560002
AREA     DS    7C                      WHERE ROUTCD SHOULD GO     21002 88650002
END      DS    1C                      END IF NO AREA FIELD       21002 88740002
ROUTCD   DS    6C                      ROUTCD FIELD               21002 88830002
NEWLEN   EQU   END-LABEL          LEN OF LINE IF NO AREA FIELD    21002 88920002
*                                                                 19084 89010002
         EJECT                                                          89014051
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  @ZA12404 89018051
*                                                           *  @ZA12404 89022051
* DSECT TO REFERENCE GETMAIN'D WORK AREA FOR DEQ.  Q4 AND   *  @ZA12404 89026051
* VARYDEV ARE ENQ'D IN IEE3603D AND DEQ'D IN THIS AND       *  @ZA12404 89030051
* OTHER MODULES.                                            *  @ZA12404 89034051
* SEE 'SERIALIZATION' IN MODULE DESCRIPTION FOR IEE3603D.   *  @ZA12404 89038051
*                                                           *  @ZA12404 89046051
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *  @ZA12404 89050051
         SPACE 1                                               @ZA12404 89054051
IEE36DEQ DSECT                                                 @ZA12404 89058051
DEQPARM  DEQ   (,,TWO,SYSTEM,,,SVN,SYSTEM),RET=HAVE,MF=L       @ZA12404 89070051
DEQLNTH  EQU   *-DEQPARM           LENGTH OF PARM LIST         @ZA12404 89074051
         DS    0D                  ROUND TO DOUBLE WORD        @ZA12404 89078051
*GETLNTH EQU   *-IEE36DEQ          LENGTH OF GETMAIN'D AREA    @ZA12404 89082051
         EJECT                                                          89100002
CXSA     DSECT                                                          89190002
         IEEXSA                                                         89280002
         EJECT                                                          95580002
CCVT     DSECT                                                          95670002
         CVT                                                            95760002
         EJECT                                                          95850002
         IEEBASEA                                                       95940002
         EJECT                                                          96030002
CUCM     DSECT                                                          96120002
         IEECUCM  FORMAT=NEW                                            96210002
         EJECT                                                          96300002
CUCB     DSECT                                                          96390002
         IEFUCBOB                                                       96480002
         EJECT                                                          96570002
CHAIN1   DSECT                                                          96660002
         IEECHAIN                                                       96750002
         EJECT                                                          96840002
         IHAPSA                                                         96930002
         END                                                            97020002
