IEE5403D TITLE 'PROLOG'                                       @ZA16354  00050003
**********************************************************************  00200002
* MODULE NAME     = IEE5403D                                   Y02669*  00290002
*                                                              Y02669*  00380002
* DESCRIPTIVE NAME= COMMAND TRANSLATOR ROUTINE                 Y02669*  00470002
*                                                              Y02669*  00560002
* COPY RIGHT      = N/A                                       @ZA14128* 00650003
*                                                              Y02669*  00740002
* STATUS          = 0S/VS2 RELEASE 3 PTF UZ08069              @ZA16354* 00830003
*                                                              Y02669*  00920002
* FUNCTION        = THIS MODULE TRANSLATES LOWER CASE LETTERS  Y02669*  01010002
*                   IN COMMANDS TO UPPER CASE, INITIALIZES THE Y02669*  01100002
*                   XSA, SCANS THE INPUT BUFFER FOR THE        Y02669*  01190002
*                   BEGINNING OF THE VERB, AND DIRECTS         Y02669*  01280002
*                   COMMANDS TO HARDCOPY.                      Y02669*  01370002
*                                                              Y02669*  01460002
* OPERATIONS      = UPON ENTRY REGISTER 1 POINTS TO A COMMAND  Y02669*  01550002
*                   INPUT BUFFER AND REGISTER 0 CONTAINS THE   Y02669*  01640002
*                   SOURCE OF THE COMMAND.                     Y02669*  01730002
*                                                              Y02669*  01820002
*                   THE COMMAND BUFFER IS SCANNED FROM LEFT    Y02669*  01870002
*                   TO RIGHT FOR THE FIRST NON-BLANK CHARACTER.Y02669*  01880002
*                   ONCE FOUND, THE FOLLOWING CHARACTERS       Y02669*  01892003
*                   ARE TRANSLATED TO UPPER                  @ZA14128*  01893003
*                   CASE BY MEANS OF AN INTERNAL TRANSLATE     Y02669*  01896002
*                   TABLE.  IF ANY INVALID CHARACTERS ARE      Y02669*  01948002
*                   LOCATED A CODE (X'2B') IS PLACED IN THE    Y02669*  01998002
*                   XAE FIELD OF THE XSA.  AN INVALID          Y02669*  02048002
*                   CHARACTER MESSAGE WILL BE ISSUED BY        Y02669*  02098002
*                   IEE0403D UPON READING THIS CODE.           Y02669*  02148002
*                                                              Y02669*  02360002
*                   IF THE SCAN FINDS APOSTROPHES NO           Y02669*  02900002
*                   TRANSLATION OF THE CHARACTER STRING WITHIN Y02669*  02990002
*                   THE QUOTES IS MADE.  IF NO QUOTES ARE      Y02669*  03080002
*                   FOUND, NORMAL TRANSLATION TO UPPER CASE    Y02669*  03170002
*                   OF THE CHARACTER STRING IS DONE.           Y02669*  03260002
*                                                              Y02669*  03350002
*                   A CHECK IS MADE FOR THE COMMAND SOURCE     Y02669*  03440002
*                   WHETHER INPUT STREAM OR TSO TERMINAL.      Y02669*  03530002
*                   FOR TSO THE ASID FIELD IS SAVED IN THE XAA Y02669*  03620002
*                   FIELD OF THE XSA.  IF FROM THE INPUT       Y02669*  03672002
*                   STREAM THE XAA FIELD IS ZEROED OUT.        Y02669*  03674002
*                                                              Y02669*  03800002
*                   IN SYSTEMS WITH THE MULTIPLE CONSOLE       Y02669*  03810002
*                   SUPPORT (MCS) OPTION, THIS ROUTINE         Y02669*  03820002
*                   DETERMINES WHETHER OR NOT THE COMMAND      Y02669*  03822002
*                   IS TO BE ADDED TO THE HARD COPY LOG.       Y02669*  03824002
*                   IF SO, A CHECK IS MADE TO DETERMINE        Y02669*  03826002
*                   IF THE COMMAND IS 'REPLY' OR 'CONTROL'.    Y02669*  03828002
*                   FOR SECURITY REASONS THESE COMMANDS        Y02669*  03828402
*                   WILL NOT BE WRITTEN TO THE LOG.            Y02669*  03828802
*                   A CHECK IS ALSO MADE TO DETERMINE IF THE @ZA03236*  03868803
*                   COMMAND BEGINS WITH A NUMBER. IF IT DOES,@ZA03236*  03908803
*                   IT WILL NOT BE HARDCOPIED BY THIS MODULE @ZA03236*  03948803
*                   IN CASE IT IS A REPLY COMMAND. BIT       @ZA03236*  03988803
*                   XASSDS4 IN THE XSA IS SET AND IEE0403D   @ZA03236*  04028803
*                   WILL HARDCOPY THE COMMAND IF IT DOES NOT @ZA03236*  04068803
*                   GET CHANGED TO A REPLY COMMAND BY THE    @ZA03236*  04108803
*                   SUBSYSTEM                                 @ZA03236* 04148803
*                                                              Y02669*  04250002
*                   THE SCAN POINTER IS RELOCATED AT THE       Y02669*  04340002
*                   BEGINNING OF THE VERB AND A BRANCH TAKEN   Y02669*  04480002
*                   TO IEE0403D.                               Y02669*  04490002
*                                                              Y02669*  04610002
* NOTES:                                                       Y02669*  04700002
*   CHARACTER-CODE= THIS MODULE IS CHARACTER CODE DEPENDENT.   Y02669*  04790002
*                   IF A CHARACTER SET OTHER THAN EBCDIC       Y02669*  04840002
*                   IS USED, THIS MODULE WILL NOT ASSEMBLE     Y02669*  04890002
*                   CORRECTLY.  THE TRANSLATE TABLE LOCATED    Y02669*  04940002
*                   AT THE END OF THIS MODULE IS WHERE THE     Y02669*  04950002
*                   CHARACTER DEPENDENT CODE IS LOCATED.       Y02669*  04960002
*   DEPENDENCIES  = NONE                                       Y02669*  04970002
*   RESTRICTIONS  = NONE                                       Y02669*  05060002
*   REGISTER-                                                  Y02669*  05150002
*    CONVENTIONS  = NONE                                       Y02669*  05240002
*   PATCH-LABEL   = PATCH                                      Y02669*  05330002
*                                                              Y02669*  05420002
* MODULE TYPE:                                                 Y02669*  05510002
*   PROCESSOR     = ASSEMBLER                                  Y02669*  05600002
*   MODULE SIZE   = X'344'                                    @ZA16354* 05690003
*   ATTRIBUTES    = ZERO PSW PROTECT KEY,REFRESHABLE,          Y02669*  05840002
*                   SUPERVISOR KEY,PAGED LPA                   Y02669*  05850002
*                                                              Y02669*  05870002
* ENTRY POINT     = IEE5403D                                   Y02669*  05960002
*   PURPOSE       = TRANSLATIONS OF COMMANDS TO UPPER CASE.    Y02669*  06010002
*   LINKAGE       = BRANCH FROM IEE0303D                       Y02669*  06050002
*   INPUT DATA    = REG 1 CONTAINS A POINTER TO COMMAND BUFFER Y02669*  06140002
*                   REGISTER 2 CONTAINS XSA POINTER            Y02669*  06230002
*                   REGISTER 0 CONTAINS UCM POINTER,           Y02669*  06320002
*                   READER AUTHORITY AND ASID                  Y02669*  06370002
*                                                              Y02669*  06410002
* REGISTER SAVED  = NONE                                       Y02669*  06500002
* REGISTER CONTENTS DURING                                     Y02669*  06550002
* PROCESSING      = REG 0  - COMMAND SOURCE                    Y02669*  06600002
*                   REG 1  - COMMAND INPUT BUFFER              Y02669*  06650002
*                   REG 2  - XSA                               Y02669*  06660002
*                   REG 3  - BASE REGISTER                     Y02669*  06670002
*                   REG 4  - WORK REGISTER                     Y02669*  06672002
*                   REG 5  - SCAN REGISTER                     Y02669*  06674002
*                   REG 6  - WORK REGISTER                     Y02669*  06676002
*                   REG 7  - UCM POINTER                       Y02669*  06678002
*                   REG 8  - WORK REGISTER                     Y02669*  06678402
*                   REG 9  - (OPEN)                            Y02669*  06678802
*                   REG 10 - SCAN POINTER                      Y02669*  06679202
*                   REG 11 - (OPEN)                            Y02669*  06679602
*                   REG 12 - WORK REGISTER                     Y02669*  06679702
*                   REG 13 - WORK REGISTER                     Y02669*  06679802
*                   REG 14 - RETURN REGISTER                   Y02669*  06679902
*                   REG 15 - LINK REGISTER                     Y02669*  06709902
* REGISTERS                                                    Y02669*  06830002
*   RESTORED      = NONE                                       Y02669*  06840002
*                                                              Y02669*  06860002
* EXIT - NORMAL   = IEE0403D                                   Y02669*  06950002
*   CONDITIONS    = NORMAL SVC 34 PROCESSING                   Y02669*  07040002
*   OUTPUT DATA   = LOWER CASE LETTERS CONVERTED TO UPPER CASE Y02669*  07130002
*                   IF REQUIRED COMMANDS WRITTEN TO HARDCOPY   Y02669*  07220002
*                   XAL POINTS TO BEGINNING OF VERB            Y02669*  07310002
*                   REGISTER 1 POINTS TO COMMAND BUFFER        Y02669*  07400002
*                   IF TSO XAA FIELD OF XSA CONTAINS ASID      Y02669*  07490002
*                   IF COMMAND STARTS WITH NUMBER, XASSDS4    @ZA03236* 07520003
*                   SET ON                                    @ZA03236* 07550003
*   RETURN CODE   = NONE                                       Y02669*  07580002
*                                                              Y02669*  07670002
* EXIT - ERROR    = NONE                                       Y02669*  07760002
*   CONDITIONS    = NONE                                       Y02669*  07850002
*   OUTPUT DATA   = NONE                                       Y02669*  07940002
*   RETURN CODE   = NONE                                       Y02669*  08030002
*                                                              Y02669*  08120002
* EXTERNAL                                                     Y02669*  08210002
*   REFERENCES    =                                            Y02669*  08300002
*   ROUTINES      = IEE0403D                                   Y02669*  08390002
*   DATA AREAS    = COMMAND BUFFER                             Y02669*  08480002
*   CONTROL BLOCKS= EXTENDED SAVE AREA                         Y02669*  08570002
*                   UNIT CONTROL BLOCK                         Y02669*  08660002
*   TABLES        = TRANSLATE TABLE                            Y02669*  08750002
*   MACRO         = NONE                                       Y02669*  08840002
*   ENQUEUED                                                   Y02669*  08930002
*    RESOURCES    = NONE                                       Y02669*  09020002
*   LOCKS         =                                            Y02669*  09110002
*   CHANGE LEVEL  = Y02669,ZA14128,ZA16354                    @ZA16354* 09200003
*                                                              Y02669*  09290002
* SYSGENS         = THIS MODULE IS INCLUDED IN LOAD MODULE     Y02669*  09360002
*                   IGC0003D AND LOADED INTO LPALIB. IT IS     Y02669*  09362002
*                   INCLUDED AT SYSGEN TIME FROM DLIB AOSB3    Y02669*  09364002
*                   USING SYSGEN MACRO SGIEF441.               Y02669*  09366002
*                                                              Y02669*  09366402
* SYSTEM LIBRARIES= NONE                                       Y02669*  09368002
*                                                              Y02669*  09370002
* MESSAGES        = NONE                                       Y02669*  09380002
**********************************************************************  09470002
         TITLE ' COMMUNICATIONS VECTOR TABLE'                           10400018
TRCVT    DSECT                                                          10600018
         CVT                                                            10800018
         TITLE ' EXTENDED SAVE AREA'                                    11200018
TRXSA    DSECT                                                          11400018
         IEEXSA                                                         11600018
         TITLE ' UNIT CONTROL MODULE'                                   11800018
TRUCM    DSECT                                                          12000018
         IEECUCM                                                        12200018
         TITLE ' TRANSLATE'                                             12600018
IEE5403D CSECT                                                          12800018
* A 188500-189000,411500,411820                                  YM1788 12850001
* C 249800,249920,314201,314401,314500,315500,411620,411900      YM1788 12900001
* D 194500-194600                                                YM1788 12950001
* A 249100-249400                                                YM2309 12960001
* A 249784,249920                                              @Y04979P 12970002
* C 249960                                                     @Y04979P 12980002
* D PROLOG APPROX 024100                                       @ZA14128 12986003
* C TRANS0 APPROX 249000-272000                                @ZA14128 12992003
* C TRTAB APPROX 418000                                        @ZA16354 12996003
         SPACE                                                          13000018
* R E G I S T E R   A S S I G N M E N T S                               13200018
         SPACE                                                          13400018
R0       EQU   0     UCM INDICATOR                                 IMCS 13600018
R1       EQU   1    INPUT REG, PTR TO BUFFER                            13800018
R2       EQU   2    XSA BASE REG                                        14000018
R3       EQU   3    MODULE BASE REG                                     14200018
R4       EQU   4    XSA WORKREG                                         14400018
R5       EQU   5    TRANSLATE WORK REG                                  14600018
R6       EQU   6    TRANSLATE WORK REG                                  14800018
R7       EQU   7                                                        15000018
R8       EQU   8                                                        15200018
R9       EQU   9                                                        15400018
R10      EQU   10                                                       15600018
R11      EQU   11                                                       15800018
R12      EQU   12                                                       16000018
R13      EQU   13                                                       16200018
R14      EQU   14                                                       16400018
R15      EQU   15   XCTL PARA-REG                                       16600018
         SPACE                                                          16800018
         SPACE                                                          17200018
* B A S E   M O D U L E                                                 17400018
BLANK    EQU   X'40'                                                    17600018
D3       EQU   3                                                  20030 17630020
D5       EQU   5                                                 A49195 17640001
D7       EQU   7                                                  20030 17660020
IEE298I  EQU   X'2B'                    CODE FOR MESSAGE IEE298I Y01120 17750001
         SPACE                                                          18000018
D0       EQU   0                        USED FOR OFFSETS,LENGTHS,ETC.   18200018
D1       EQU   1                        *                               18400018
D2       EQU   2                        *                               18600018
D4       EQU   4                        *                               18800018
D6       EQU   6                                                 YM1788 18850001
D8       EQU   8                                                 YM1788 18900001
         SPACE                                                          19200018
X80      EQU   X'80'                                                    19400018
UCMEQU   EQU   UCMSDS1A+UCMSDS1B                                  M0130 19500001
         EJECT                                                          19600002
         BALR  R3,0                                                     19800018
         USING *,R3                                                     20000018
         MODID BRANCH=YES                                        Y01886 20050001
         USING TRXSA,R2                                                 22000018
         MVI   XAE,INVALID        ZERO OUT XAE FIELD             Y02669 22050002
         EJECT                                                          23200002
* T R A N S L A T E   T H E   C O M M A N D                             23600018
         SPACE                                                          23800018
TRANS0   LA    R10,D3(R1)         POINT TO BYTE BEFORE TEXT    @ZA14128 24000003
         LA    R8,D1(R10)         POINT TO TEXT                @ZA14128 24050003
         LH    R7,0(R1)            LENGTH OF BUFFER                     24200018
         AR    R7,R1                                                    24400018
         ST    R7,XAP              SAVE FOR LATER USE BY         Y02669 24450002
*                                  MODULES ISSUING IEEBUFSC      Y02669 24500002
         BCTR  R7,0                END OF BUFFER                        24600018
         LA    R6,1                INCREMENT                            24800003
         SPACE                                                          24800903
*********************************************************************** 24801803
*   SKIP OVER CHARACTERS UNTIL THE 1ST NON-BLANK IS FOUND.     @ZA14128 24802703
*   IF NONE ARE FOUND THEN CONTROL IS GIVEN TO LABEL CHKMCS.   @ZA14128 24803603
*   IF A NON-BLANK IS FOUND THEN SEE IF IT IS A //BLANK. IF    @ZA14128 24804503
*   IT IS NOT THEN CONTROL IS GIVEN TO LABEL NOSLASH. IF IT    @ZA14128 24805403
*   IS THEN SKIP OVER IT AND CONTINUE LOOKING FOR A NON-BLANK  @ZA14128 24806303
*   CHARACTER.                                                 @ZA14128 24807203
*********************************************************************** 24808103
         SPACE                                                          24809003
SKIPBLKS EQU   *                                                        24809903
         BXH   R10,R6,CHKMCS      UPDATE PTR. TEST BUFFER END  @ZA14128 24810803
         CLI   D0(R10),BLANK      IS CHAR A BLANK?             @ZA14128 24811703
         BE    SKIPBLKS           YES THEN BRANCH              @ZA14128 24812603
         CLC   D0(D3,R10),XSLASH  NOT BLANK. IS IT A //BLANK?  @ZA14128 24813503
         BNE   NOSLASH            NO THEN BRANCH               @ZA14128 24814403
         LA    R10,D2(R10)        YES IT'S //BLANK. SKIP OVER  @ZA14128 24815303
         B     SKIPBLKS           FIND NEXT NON-BLANK CHAR     @ZA14128 24816203
         EJECT                                                          24817103
*********************************************************************** 24818003
*   THE COMMAND HAS BEEN FOUND. R10 POINTS TO THE BEGINNING    @ZA14128 24818903
*   OF THE COMMAND.                                            @ZA14128 24819803
*                                                                       24820703
*   TRANSLATE ALL CHARACTERS TO UPPER CASE AS LONG AS THEY     @ZA14128 24821603
*   ARE NOT IN SINGLE QUOTES. THESE WILL REMAIN AS THEY WERE   @ZA14128 24822503
*   ENTERED.                                                   @ZA14128 24823403
*                                                                       24824303
*   IF AN INVALID CHARACTER IS FOUND DURING TRANSLATION THEN   @ZA14128 24825203
*   FIELD XAE IN THE XSA IS SET TO INDICATE THIS TO MODULE     @ZA14128 24826103
*   IEE0403D.                                                  @ZA14128 24827003
*                                                                       24827903
*   WHEN THE END OF THE BUFFER IS REACHED THEN CONTROL IS THEN @ZA14128 24828803
*   GIVEN TO LABEL CHKMCS.                                     @ZA14128 24829703
*********************************************************************** 24830603
         SPACE                                                          24831503
NOSLASH  EQU   *                                               @ZA14128 24832403
         LR    R8,R10             SAVE PTR TO COMMAND          @ZA14128 24833303
FNDAPOS  EQU   *                                               @ZA14128 24834203
         CLI   D0(R10),C''''      IS CHAR OPENING APOSTROPHE?  @ZA14128 24835103
         BE    INQUOTE            YES THEN BRANCH              @ZA14128 24836003
         TR    D0(1,R10),TRTAB    TRANSLATE THE CHARACTER      @ZA14128 24836903
         CLI   D0(R10),INVALID    WAS IT AN INVALID CHARACTER? @ZA14128 24837803
         BNE   NEXTCHAR           NO THEN BRANCH               @ZA14128 24838703
         MVI   XAE,IEE298I        INDICATE INVALID CHAR FOUND  @ZA14128 24839603
         B     NEXTCHAR           GET NEXT CHARACTER           @ZA14128 24840503
INQUOTE  EQU   *                                               @ZA14128 24841403
         BXH   R10,R6,CHKMCS      UPDATE PTR. TEST BUFFER END  @ZA14128 24842303
         CLI   D0(R10),C''''      CLOSING APOSTROPHE FOUND?    @ZA14128 24843203
         BNE   INQUOTE            NO THEN BRANCH               @ZA14128 24844103
NEXTCHAR EQU   *                                               @ZA14128 24845003
         BXH   R10,R6,CHKMCS      UPDATE PTR. TEST BUFFER END  @ZA14128 24845903
         B     FNDAPOS            CONTINUE TRANSLATION         @ZA14128 24846803
         EJECT                                                          27250002
* C H E C K  F O R  M C S                                               27400018
CHKMCS   EQU   *                                                        27600018
         USING TRCVT,R7                 ADDRESS CVT                 MCS 27800018
         L     R7,CVTPTR                GET CVT ADDR                    28000018
         L     R7,CVTCUCB               PTR TO UCM BASE             MCS 28200018
         DROP  R7                       NO LONGER NEED CVT          MCS 28400018
         USING TRUCM,R7                 ADDRESS UCM                 MCS 28600018
         MVI   XAU,ZERO            ZERO OUT XAU FIELD             M5521 28602020
         LTR   R0,R0               IS COMMAND FROM INPUT STREAM   M5521 28602420
         BM   INPUTST              YES, ZEROS IN BOTH XAU AND XAJ M5521 28602820
         STH   R0,XAA              SAVE TJID/CONSOLE ID           M5521 28602902
         TM    XAA,X'80'           TEST HIGH ORDER BIT FOR TJID   M5521 28606302
         BZ    NONTSO              NO. NOT TSO TJID               M5521 28608320
         XI    XAA,X'80'           YES. TURN OFF BIT              M5521 28608702
         B     INMCS               CHECK FOR MCS                 Y01939 28609101
NONTSO   STC   R0,XAU              SAVE CONSOLE ID IN XSA         M5521 28609520
INPUTST  MVC   XAA(2),ZEROS        ZERO TJID FLD IN XSA WHEN NON-TSO    28609602
*                                                                 M5521 28685701
         EJECT                                                          28735702
* C H E C K  F O R  Q U E U E  T O  H A R D C O P Y                     30000018
INMCS    EQU   *                                                    MCS 30200018
         SH    R7,FOUR                  PT TO WORD BEFORE UCM BASE  MCS 30400018
         L     R7,D0(R7)                PTR TO MCS UCM PREFIX       MCS 30600018
         DROP  R7                       NO LONGER NEED UCM BASE     MCS 30800018
         USING UCMPRFX,R7               ADDRESS UCM MCS PREFIX      MCS 31000018
         TM    UCMSFLGS,UCMSYSB    IS HARDCOPY REQUIRED?          M0130 31050001
         BZ    NOHCPY              BRANCH IF NO                   M0130 31100001
         TM    UCMSDS1,UCMEQU      STCMDS OR INCMDS TO HARD COPY? M0130 31150001
         BM    HARDEXST            BRANCH IF YES                  M0130 31170001
         TM    UCMSFLGS,UCMSYSC         QUEUE TO HARDCOPY           MCS 31200018
         BZ    NOHCPY                   NO                          MCS 31400018
HARDEXST EQU   *                                                  M0130 31410001
         CLI   D0(R8),NUMBER      IS THIS HASP FORM REPLY?     @ZA03236 31411003
         BL    CHKRPLY            LOOK FOR REPLY               @ZA03236 31412003
         OI    XASSDS,XASSDS4     SHOW COMMAND NOT             @ZA03236 31413003
*                                 HARDCOPIED FOR 0403D         @ZA03236 31414003
         B     NOHCPY             DONT HARDCOPY                @ZA03236 31415003
CHKRPLY  CLC   D0(D2,R8),R        IS THIS THE 'R' COMMAND?       YM1788 31420103
         BE    NOHCPY             YES, BYPASS WTO                Y01012 31430101
         CLC   D0(D6,R8),REPLY    IS THIS THE 'REPLY' COMMAND?   YM1788 31440101
         BE    NOHCPY             YES, BYPASS WTO                Y01012 31442101
         CLC   D0(D2,R8),K        IS THIS THE 'K' COMMAND?       YM1788 31450001
         BE    NOHCPY             YES, DO NOT SEND CMD TO HARDCPY 21002 31500001
         CLC   D0(D8,R8),CONTROL  IS THIS THE 'CONTROL' COMMAND? YM1788 31550001
         BE    NOHCPY             YES, DO NOT SEND CMD TO HARDCPY 21002 31560001
         EJECT                                                          31570002
* H A R D C O P Y  W T O  R O U T I N E                             MCS 31600018
         LH    R5,D0(R1)                GET LENGTH OF CIB           MCS 31800018
         L     R12,D0(R1)               SAVE CONTENTS OF REG 1   A41171 32000001
         AR    R5,R1                    PT TO ONE PAST BUFFER END   MCS 32200018
         LA    R13,D4(R1)               PT TO START OF TEXT AREA    MCS 32400018
TRSCAN   EQU   *                                                    MCS 32600018
         BCTR  R5,D0                    BACK UP ONE BYTE            MCS 32800018
*                                                                   MCS 33000018
* SCAN BACKWARDS IN COMMAND INPUT BUFFER TO FIND A NON-BLANK CHAR-  MCS 33200018
* ACTER. THIS IS TO PREVENT WTO-ING UNNECESSARY TRAILING BLANKS.    MCS 33400018
*                                                                   MCS 33600018
         CLI   D0(R5),BLANK             IS THIS BYTE BLANK          MCS 33800018
         BNE   TRWTO                    NO. GO WRITE COMMAND        MCS 34000018
         CR    R13,R5                   AT THE BEGINNING OF BUFFER  MCS 34200018
         BCR   8,R14                    YES. BLANK CIB. NO-OP       MCS 34400018
         B     TRSCAN                   NO. CONTINUE BACK SCAN      MCS 34600018
TRWTO    EQU   *                                                    MCS 34800018
         SR    R5,R1                    COMMAND LENGTH LESS ONE     MCS 35000018
         LA    R5,D1(R5)                COMMAND LENGTH              MCS 35200018
         STH   R5,D0(R1)                WTO LENGTH FIELD            MCS 35400018
         SPACE                                                          35600018
HCFLG    EQU   X'0200'                  Q-TO-HARDCOPY ONLY FLAG     MCS 35800018
         SPACE                                                          36000018
         LA    R5,HCFLG                 SET Q-TO-HARDCOPY BIT ON    MCS 36200018
         STH   R5,D2(R1)                IN MCSFLAG FLD OF BUFFER    MCS 36400018
         LR    R6,R0                    SAVE PARAMETER REGISTER     MCS 36600018
         LR    R5,R1                    SAVE CIB PTR                MCS 36800018
         WTO   MF=(E,(1))               WRITE COMMAND TO HARDCOPY   MCS 37000018
         LR    R0,R6                    RESTORE  ...                MCS 37200018
         LR    R1,R5                    ...REGISTERS                MCS 37400018
         ST    R12,D0(R1)               RESTORE ORIGINAL REG 1   A41171 37600001
NOHCPY   EQU   *                                                    MCS 37800018
         LTR   R0,R0                    COMMAND FROM INPUT STREAM   MCS 38000018
         BNL   SCANVERB                 NO. FROM A CONSOLE          MCS 38200002
         MVI   XAU,X80                  INPUT STREAM INDICATOR      MCS 38400018
         STH   R0,XAS                   R/I COMMAND AUTHORITY       MCS 38600018
         EJECT                                                          38650002
SCANVERB EQU   *                                                    MCS 39000002
         SPACE                                                          39400018
         CLI   XAE,IEE298I        INVALID CHARACTER              Y01120 39520001
         BE    SETIND             YES SAVE INDICATOR              20030 39560020
         ST    R1,XAR             POINTER TO COMMAND IMAGE        20030 39600020
XBACK    MVI   XAV,BLANK          INIT VERB SLOT TO BLANKS        20030 39640020
         MVC   XAV+D1(D7),XAV                                     20030 39680020
         L     R7,XAP             GET ADDR OF BUFFER END +1 Y02669      39780002
         BCTR  R7,D0              GET END OF BUFFER               20030 39800002
         LA    R4,D4(R1)          BYPASS HEADER                   20030 39840020
         LA    R6,D1         INSERT INCREMENT                     20030 39880020
         CLC   D0(D3,R4),XSLASH   BUFFER PRECEECED BY //BLANK     20030 39920020
         BNE   SCAN               IF NOT, BEGIN VERB SCAN         20030 39960020
         LA    R4,D3(R4)          YES, BYPASS HEADER              20030 40000020
SCAN     EQU   *                                                  20030 40040020
         CLI   D0(R4),BLANK       IS THIS CHARACTER A BLANK       20030 40080020
         BNE   ADJBUFFR           IF NOT, ADJUST BUFFER          A49195 40120001
         BXLE   R4,R6,SCAN        IF SO UPDATE PTR AND TEST NEXT  20030 40160020
*        IF NON BLANK CHAR WAS NOT FOUND ENTIRE BUFFER WAS BLANK  20030 40200020
         BR   R14                                                 20030 40240020
SETIND   EQU   *                                                  20030 40280020
         ST    R1,XAR             INDICATOR MUST BE REPLACED      20030 40320020
         MVI   XAE,IEE298I        ABOVE INSTRCTION OVERLAYS CODE Y01120 40360001
         B     XBACK              CONTINUE PROCESSING             20030 40400020
ADJBUFFR EQU   *                                                 A49195 40410001
         LA    R6,D4(R1)          POINT TO BEGINNING OF BUFFER   A49195 40420001
         CR    R6,R4              VERB IN FIRST BUFFER POSITION? A49195 40430001
         BE    SAVEPTR            YES, NO ADJUSTMENT NEEDED      A49195 40432001
         LR    R6,R7              GET END OF BUFFER ADDRESS      A49195 40434001
         SR    R6,R4              COMPUTE VALID BUFFER LENGTH    A49195 40436001
         EX    R6,SHIFTMVE        MOVE VERB INTO FIRST POSITION  A49195 40438001
         LA    R4,D5(R6,R1)       POINT TO 1ST INVALID POSITION  A49195 40438401
         MVI   D0(R4),BLANK       INSERT BLANK                   A49195 40438801
         LR    R6,R7              GET END OF BUFFER ADDRESS      A49195 40439201
         CR    R6,R4              IS THIS LAST CHAR IN BUFFER    SM4227 40439301
         BE    SETPTR             YES. DONT BLANK OUT ANY MORE   SM4227 40439401
         SR    R6,R4              OBTAIN LENGTH OF BLANKS        A49195 40439601
         BCTR  R6,D0              DECREMENT THE LENGTH BY ONE    A49195 40439701
         EX    R6,PADMOVE         BLANK OUT THE INVALID PART OF  A49195*40439801
                                       BUFFER                           40439901
SETPTR   EQU   *                                                        40449901
         LA    R4,D4(R1)          SET POINTER TO THE VERB TEXT   A49195 40453202
SAVEPTR  EQU   *                                                  20030 40466701
         ST    R4,XAL             PUT PTR TO VERB IN XAL          20030 40480002
         L     R15,V0403D         GET ADDRESS OF ROUTER ROUTINE  Y02669 40530002
         BR    R15                GO TO IEE0403D (ROUTER)        Y02669 40550002
         EJECT                                                          40560002
SHIFTMVE MVC   D4(,R1),D0(R4)     SHIFT BUFFER INSTRUCTION       A49195 40650001
PADMOVE  MVC   D1(,R4),D0(R4)     ADD BLANKS INSTRUCTION         A49195 40700001
*                                 CONSTANT MUST BE CONTIGUOUS    Y01120 40850001
FOUR     DC    H'0004'            WORK CONSTANT                     MCS 41000001
ZEROS    DC    X'0000'                                                  41010020
V0403D   DC    V(IEE0403D)             POINTER TO ROUTER ROUTINE Y02669 41020002
ZERO     EQU   0                                                 A21432 41050018
INVALID  EQU   X'00'                                             A21432 41100018
K        DC    CL2'K '            COMPRAND FOR 'K' COMMAND       YM1788 41150001
CONTROL  DC    CL8'CONTROL '      COMPRAND FOR 'CONTROL' COMMAND YM1788 41162001
XSLASH   DC   CL3'// '                                            20030 41170020
R        DC    CL2'R '            COMPRAND FOR 'R' COMMAND       YM1788 41182001
REPLY    DC    CL6'REPLY '        COMPRAND FOR 'REPLY' COMMAND   YM1788 41190001
PATCH    DS    CL50'*** IEE5403D PATCH AREA ***'               @ZA14128 41192003
NUMBER   EQU   X'F0'              CHECK FOR REPLY CMD          @ZA03236 41196003
         TITLE ' TRANSLATE TABLE'                                       41400018
TRTAB    DS    0F                                                       41600018
         DC    256FL1'00'     ZERO FILLER FOR INVALID CHARACTER CHECK  *41800003
                                                               @ZA16354 41850003
         ORG   TRTAB+C' '                                               42000018
         DC    FL1'64'        BLANK                                     42200018
         ORG   TRTAB+C''''                                              42400018
         DC    FL1'125'       APOSTROPHE                                42600018
         ORG   TRTAB+C'#'                                               42800018
         DC    FL1'123'       POUND SIGN                                43000018
         ORG   TRTAB+C'$'                                               43200018
         DC    FL1'91'        DOLLAR SIGN                               43400018
         ORG   TRTAB+X'50'     EBCDIC                                   43600018
         DC    FL1'80'        AND SIGN                                  43800018
         ORG   TRTAB+C'('                                               44000018
         DC    FL1'77'        LEFT PARENTHESES                          44200018
         ORG   TRTAB+C')'                                               44400018
         DC    FL1'93'        RIGHT PARENTHESES                         44600018
         ORG   TRTAB+C'*'                                               44800018
         DC    FL1'92'        ASTERISK                                  45000018
         ORG   TRTAB+C'+'                                               45200018
         DC    FL1'78'        PLUS SIGN                                 45400018
         ORG   TRTAB+C','                                               45600018
         DC    FL1'107'       COMMA                                     45800018
         ORG   TRTAB+C'-'                                               46000018
         DC    FL1'96'        MINUS SIGN                                46200018
         ORG   TRTAB+C'.'                                               46400018
         DC    FL1'75'        PERIOD                                    46600018
         ORG   TRTAB+C'/'                                               46800018
         DC    FL1'97'        SLASH                                     47000018
         ORG   TRTAB+C'½'                                               47200018
         DC    FL1'74'             CENT SIGN                            47400018
         ORG   TRTAB+C'<'                                               47600018
         DC    FL1'76'             LESS THAN SIGN                       47800018
         ORG   TRTAB+C'|'                                               48000018
         DC    FL1'79'                                                  48200018
         ORG   TRTAB+C'!'                                               48400018
         DC    FL1'90'             EXCLAMATION POINT                    48600018
         ORG   TRTAB+C';'                                               48800018
         DC    FL1'94'             SEMICOLON                            49000018
         ORG   TRTAB+C'^'                                               49200018
         DC    FL1'95'                                                  49400018
         ORG   TRTAB+C'%'                                               49600018
         DC    FL1'108'            PERCENT SIGN                         49800018
         ORG   TRTAB+C'_'                                               50000018
         DC    FL1'109'            DASH SIGN                            50200018
         ORG   TRTAB+C'>'                                               50400018
         DC    FL1'110'            GREATER THAN SIGN                    50600018
         ORG   TRTAB+C'?'                                               50800018
         DC    FL1'111'            QUESTION MARK                        51000018
         ORG   TRTAB+C':'                                               51200018
         DC    FL1'122'            COLON                                51400018
         ORG   TRTAB+C'@'                                               51600018
         DC    FL1'124'            AT SIGN                              51800018
         ORG   TRTAB+C'"'                                               52000018
         DC    FL1'127'            QUOTES                               52200018
         ORG   TRTAB+C'0'                                               52400018
         DC    AL1(240)       ZERO                                      52600018
         DC    AL1(241)       ONE                                       52800018
         DC    AL1(242)       TWO                                       53000018
         DC    AL1(243)       THREE                                     53200018
         DC    AL1(244)       FOUR                                      53400018
         DC    AL1(245)       FIVE                                      53600018
         DC    AL1(246)       SIX                                       53800018
         DC    AL1(247)       SEVEN                                     54000018
         DC    AL1(248)       EIGHT                                     54200018
         DC    AL1(249)       NINE                                      54400018
         ORG   TRTAB+C'='                                               54600018
         DC    FL1'126'       EQUAL SIGN                                54800018
         ORG   TRTAB+C'@'                                               55000018
         DC    FL1'124'       AT SIGN                                   55200018
         ORG   TRTAB+C'A'-X'40'    EBCDIC                               55400018
         DC    AL1(193)       A TRANSLATED FROM LOWER CASE              55600018
         DC    AL1(194)       B TRANSLATED FROM LOWER CASE              55800018
         DC    AL1(195)       C TRANSLATED FROM LOWER CASE              56000018
         DC    AL1(196)       D TRANSLATED FROM LOWER CASE              56200018
         DC    AL1(197)       E TRANSLATED FROM LOWER CASE              56400018
         DC    AL1(198)       F TRANSLATED FROM LOWER CASE              56600018
         DC    AL1(199)       G TRANSLATED FROM LOWER CASE              56800018
         DC    AL1(200)       H TRANSLATED FROM LOWER CASE              57000018
         DC    AL1(201)       I TRANSLATED FROM LOWER CASE              57200018
         ORG   TRTAB+C'J'-X'40'    EBCDIC                               57400018
         DC    AL1(209)       J TRANSLATED FROM LOWER CASE              57600018
         DC    AL1(210)       K TRANSLATED FROM LOWER CASE              57800018
         DC    AL1(211)       L TRANSLATED FROM LOWER CASE              58000018
         DC    AL1(212)       M TRANSLATED FROM LOWER CASE              58200018
         DC    AL1(213)       N TRANSLATED FROM LOWER CASE              58400018
         DC    AL1(214)       O TRANSLATED FROM LOWER CASE              58600018
         DC    AL1(215)       P TRANSLATED FROM LOWER CASE              58800018
         DC    AL1(216)       Q TRANSLATED FROM LOWER CASE              59000018
         DC    AL1(217)       R TRANSLATED FROM LOWER CASE              59200018
         ORG   TRTAB+C'S'-X'40'    EBCDIC                               59400018
         DC    AL1(226)       S TRANSLATED FROM LOWER CASE              59600018
         DC    AL1(227)       T TRANSLATED FROM LOWER CASE              59800018
         DC    AL1(228)       U TRANSLATED FROM LOWER CASE              60000018
         DC    AL1(229)       V TRANSLATED FROM LOWER CASE              60200018
         DC    AL1(230)       W TRANSLATED FROM LOWER CASE              60400018
         DC    AL1(231)       X TRANSLATED FROM LOWER CASE              60600018
         DC    AL1(232)       Y TRANSLATED FROM LOWER CASE              60800018
         DC    AL1(233)       Z TRANSLATED FROM LOWER CASE              61000018
         ORG   TRTAB+C'A'                                               61200018
         DC    AL1(193)       A                                         61400018
         DC    AL1(194)       B                                         61600018
         DC    AL1(195)       C                                         61800018
         DC    AL1(196)       D                                         62000018
         DC    AL1(197)       E                                         62200018
         DC    AL1(198)       F                                         62400018
         DC    AL1(199)       G                                         62600018
         DC    AL1(200)       H                                         62800018
         DC    AL1(201)       I                                         63000018
         ORG   TRTAB+C'J'                                               63200018
         DC    AL1(209)       J                                         63400018
         DC    AL1(210)       K                                         63600018
         DC    AL1(211)       L                                         63800018
         DC    AL1(212)       M                                         64000018
         DC    AL1(213)       N                                         64200018
         DC    AL1(214)       O                                         64400018
         DC    AL1(215)       P                                         64600018
         DC    AL1(216)       Q                                         64800018
         DC    AL1(217)       R                                         65000018
         ORG   TRTAB+C'S'                                               65200018
         DC    AL1(226)       S                                         65400018
         DC    AL1(227)       T                                         65600018
         DC    AL1(228)       U                                         65800018
         DC    AL1(229)       V                                         66000018
         DC    AL1(230)       W                                         66200018
         DC    AL1(231)       X                                         66400018
         DC    AL1(232)       Y                                         66600018
         DC    AL1(233)       Z                                         66800018
         END                                                            67000018
