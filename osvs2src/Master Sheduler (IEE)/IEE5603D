         TITLE 'IEE5603D K AND MR MESSAGE MODULE LOAD ONE'              00100002
*********************************************************************** 00150002
*                                                                     * 00200002
*   MODULE NAME         =    IEE5603D                           Y02669* 00250002
*                                                                     * 00300002
*   DESCRIPTIVE NAME    =    CONTROL (K), MSGRT (MR) COMMANDS   Y02669* 00350002
*                            AND L=CCA OPERAND ERROR MESSAGE    Y02669* 00350402
*                            MODULE - LOAD 1                    Y02669* 00352002
*                                                                     * 00400002
*   COPYRIGHT           =    MISSING                            Y02669* 00450002
*                                                                     * 00500002
*   STATUS              =    01 - UPDATE FOR VS/2 RELEASE 1     Y02669* 00550002
*                                                                     * 00600002
*   FUNCTION            =    THIS MODULE HANDLES CONTROL (K),   Y02669* 00650002
*                            MSGRT (MR) COMMANDS AND L=CCA      Y02669* 00700002
*                            OPERAND ERROR MESSAGES.            Y02669* 00710002
*                                                                     * 00800002
*  OPERATION            =    MOST MESSAGES ARE ISSUED BY THE    Y02669* 00840002
*                            WRITE TO OPERATOR (WTO) MACRO      Y02669* 00900002
*                            TO THE SOURCE CONSOLE. INCLUDING @Y02668P* 00950003
*                            ALL MESSAGES ISSUED FROM ANOTHER @Y02668P* 00960003
*                            MEMORY (JES3). THIS INCLUDES THE @Y02668P* 00970003
*                            CONTROL AND MSG ROUTE COMMANDS   @Y02668P* 00980003
*                            IF THE MESSAGE IS TO BE WRITTEN    Y02669* 01000002
*                            IN RESPONSE TO A CONTROL OR MSGRT  YM1914* 01010002
*                            COMMAND ISSUED FROM A CRT CONSOLE  YM1914* 01030002
*                            OR THE MESSAGE ALSO INCLUDES       Y02669* 01050002
*                            'IEE150I CHANGE OPTIONS, IF        Y02669* 01060002
*                            DESIRED', (I.E. IN RESPONSE TO A   Y02669* 01070002
*                            'REF' COMMAND; K T,REF; K A,REF;   Y02669* 01080002
*                            MR REF), THE MESSAGE IS SET UP     Y02669* 01090002
*                            IN THE INSTRUCTION LINE OF THE     Y02669* 01100002
*                            TRANSIENT DCM TO BE WRITTEN BY     Y02669* 01130002
*                            DIDOCS.                            Y02669* 01160002
*                                                                     * 01202002
*                            FOR ALL MESSAGES WHICH ARE PUT IN  Y02651* 01204002
*                            THE TDCM INSTRUCTION LINE, IF THE  Y02651* 01206002
*                            CMS AND LOCAL LOCKS ARE NOT HELD   Y02651* 01208002
*                            ON ENTRY, THEY ARE OBTAINED AND    Y02651* 01208402
*                            XASSDS5 IS TURNED ON. FOR THE WTO  Y02651* 01208802
*                            ISSUED MESSAGES THE LOCKS ARE      Y02651* 01209202
*                            RELEASED BEFORE THE GETMAIN IS     Y02651* 01209602
*                            ISSUED.                            Y02651* 01209702
*                                                                     * 01209802
*                            IF THE COMMAND WAS ISSUED          YM1557* 01209902
*                            INTERNALLY, THE CONSOLE ID FOUND   YM1557* 01210002
*                            IN XAU WILL BE X'00'. IN THESE     YM1557* 01210402
*                            CASES, THE ERROR MESSAGE WILL BE   YM1557* 01211202
*                            ISSUED VIA WTO TO THE MASTER       YM1557* 01222202
*                            CONSOLE.                           YM1557* 01222602
*                                                                     * 01222702
*                            THE MESSAGE CODE FOUND IN XAE      Y02669* 01224702
*                            WHEN DOUBLED SERVES AS AN INDEX    Y02669* 01228002
*                            INTO THE MESSAGE TEXT TABLE.       Y02669* 01230002
*                                                                     * 01232002
*                            EACH ENTRY IN THE TABLE CONTAINS   Y02669* 01244002
*                            MESSAGE FLAGS WHICH INDICATE:      Y02669* 01248002
*                             X'80' - MESSAGE REQUIRES COMMAND  Y02669* 01252002
*                                     VERB FROM XAV             Y02669* 01256002
*                             X'40' - MESSAGE REQUIRES INVALID  Y02669* 01260002
*                                     OPERAND WHOSE ADDRESS IS  Y02669* 01268002
*                                     FOUND IN XASOPTR          Y02669* 01272002
*                             X'20' - MESSAGE REQUIRES          Y02669* 01276002
*                                     ADDITIONAL TEXT FROM      Y02669* 01284002
*                                     IEE5903D                  Y02669* 01288002
*                             X'10' - INVALID OPERAND BELONGS   Y02669* 01292002
*                                     AT END OF TEXT            Y02669* 01300002
*                                                                     * 01305002
*                            IF THE MESSAGE HAS TWO PARTS,      Y02669* 01310002
*                            A BRANCH IS TAKEN TO IEE5903D TO   Y02669* 01315002
*                            COMPLETE THE MESSAGE AND ISSUE IT. Y02669* 01320002
*                            (THIS IS THE ONLY ENTRANCE TO      Y02669* 01325002
*                            IEE5903D.)                         Y02669* 01330002
*                                                                     * 01335002
*   NOTES               =    NONE                               Y02669* 01340002
*                                                                     * 01350002
*    CHARACTER-CODE                                             Y02669* 01400002
*     DEPENDENCIES      =    ANY CHARACTER CODE OTHER THAN      Y02669* 01450002
*                            EBCDIC WILL REQUIRE REASSEMBLY OF  Y02669* 01500002
*                            THIS MODULE. NOTE THAT CHARACTER   Y02669* 01510002
*                            REPRESENTATIONS ARE USED FOR       Y02669* 01520002
*                            ',' AND ')'.                       Y02669* 01530002
*                                                                     * 01600002
*    DEPENDENCIES       =    NONE                               Y02669* 01650002
*                                                                     * 01700002
*    RESTRICTIONS       =    NONE                               Y02669* 01750002
*                                                                     * 01800002
*    REGISTER                                                   Y02669* 01850002
*     CONVENTIONS       =    NONE                               Y02669* 01900002
*                                                                     * 01950002
*     PATCH LABEL       =    PATCH                              Y02669* 02000002
*                                                                     * 02050002
*   MODULE TYPE         =    CSECT (MESSAGE MODULE)             Y02669* 02100002
*                                                                     * 02150002
*    PROCESSOR          =    N/A                                Y02669* 02200002
*                                                                     * 02250002
*    MODULE SIZE        =    X'3E6' + X'48' PATCH AREA          Y02669* 02300002
*                                                                     * 02350002
*    ATTRIBUTES         =    REFRESHABLE, REENTRANT,            Y02669* 02400002
*                            SUPERVISOR MODE, KEY 0,            Y02669* 02450002
*                            PAGED LPA                          Y02669* 02500002
*                                                                     * 02550002
         EJECT                                                          02560002
*   ENTRY POINT         =    IEE5603D FROM (SEE MESSAGES)       Y02669* 02600002
*      PURPOSE          =    TO ISSUE ERROR MESSAGES FOR MSGRT  Y02669* 02650002
*                            AND K COMMANDS AND L=CCA OPERAND   Y02669* 02700002
*      LINKAGE=              BRANCH                             Y02669* 02750002
*      INPUT DATA       =    REGISTER 2 CONTAINS ADDRESS OF XSA Y02669* 02800002
*                            WHICH CONTAINS INFORMATION ABOUT   Y02669* 02850002
*                            THE MESSAGE THAT IS TO BE WRITTEN  Y02669* 02900002
*                              XAE - ONE BYTE MESSAGE CODE      Y02669* 02950002
*                              XASTSAVE - ONE BYTE SECONDARY    Y02669* 03000002
*                            MESSAGE CODE WHEN THE MESSAGE IS   Y02669* 03050002
*                            IN TWO PARTS. THE LAST THREE BYTES Y02669* 03100002
*                            (XASOPTR) CONTAIN AN ADDRESS TO AN Y02669* 03150002
*                            INVALID OPERAND IF IT IS TO BE     Y02669* 03200002
*                            INCLUDED IN THE MESSAGE.           Y02669* 03250002
*                              XAN - COMMAND VERB CODE          Y02669* 03260002
*                              XAR - ADDR OF COMMAND BUFFER     Y02669* 03270002
*                              XASSDS3-ON IF A TASK OTHER     @Y02668P* 03272003
*                                       THAN COMTASK ISSUED   @Y02668P* 03274003
*                                       THE COMMAND (JES3)    @Y02668P* 03276003
*                              XASSDS5 ON IF LOCKS HELD         Y02651* 03280002
*                                      OFF IF NOT               Y02651* 03282002
*                              XAU - SOURCE CONSOLE ID          Y02669* 03290002
*                              XAV - COMMAND VERB               Y02669* 03292002
*                                                                     * 03300002
*      REGISTERS SAVED  =    REGISTER 14 SAVED IN XAS           Y02669* 03350002
*                            (XASAVSTD + 16) AT BADCODE.        Y02669* 03360002
*                            REGISTERS 11 - 14 SAVED BEFORE     Y02651* 03370002
*                            ISSUING SETLOCK AT LOCKSOFF        Y02651* 03390002
*                            AND LOCKSTAT                       Y02651* 03392002
*                                                                     * 03400002
*      REGISTER CONTENTS                                        Y02669* 03450002
*      DURING PROCESSING=    R0  - WORK REG                     Y02669* 03500002
*                            R1  - WORK REG                     Y02669* 03550002
*                            R2  - BASE REG FOR XSA             Y02669* 03600002
*                            R3  - OUTPUT-POSITION IN BUFFER    Y02669* 03650002
*                            R4  - WORK REG                     Y02669* 03700002
*                            R5  - WORK REG                     Y02669* 03750002
*                            R6  - OUTPUT-CURRENT TEXT LENGTH   Y02669* 03800002
*                            R7  - BASE REG UCM ENTRY           Y02669* 03850002
*                            R8  - OUTPUT-BASE REG TRANS DCM    Y02669* 03900002
*                            R9  - BASE REG FOR UCM + RDCM      Y02669* 03950002
*                            R10 - BASE REG FOR CVT + TAB2      Y02669* 04000002
*                            R11 - POINTER TO INVALID OPERAND   Y02669* 04050002
*                            R12 - MODULE BASE REG              Y02669* 04100002
*                            R13 - ADDRESS OF MSG TABLE ENTRY   Y02669* 04150002
*                            R14 - RETURN REG                   Y02669* 04200002
*                            R15 - RETURN CODE + LINK REG       Y02669* 04250002
*                                                                     * 04300002
*      REGISTER RESTORED=    REGISTER 14 RESTORE FROM XASAVSTD  Y02669* 04350002
*                            + 16 BEFORE EXITING AT RETURNOK    Y02669* 04351002
*                            AND NOCORE                         Y02669* 04352002
*                            REGISTERS 11 - 14 RESTORED AFTER   Y02651* 04354002
*                            ISSUING SETLOCK AT LOCKSOFF AND    Y02651* 04356002
*                            LOCKSTAT                           Y02651* 04358002
*                                                                     * 04360002
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04433202
*                                                                     * 04443202
*   EXIT - NORMAL       =    RETURN VIA BR R14 FROM RETURNOK    Y02669* 04453202
*      CONDITIONS       =    MESSAGE TO GO TO CRT DEVICE        Y02669* 04463202
*      OUTPUT DATA      =    MESSAGE IN DCM  INSTRUCTION LINE   Y02669* 04465202
*                               DCMIOCM1 - DCMWRINS X'04'       Y02669* 04465302
*                            WITH CURSOR POSITIONING            Y02669* 04466102
*                               DCMINLGN - ZERO OR CURSOR       Y02669* 04466902
*                                          POSITION             Y02669* 04467302
*                            INVALID K COMMAND                  Y02669* 04468902
*                               DCMSVC34 + DCMINVLD (X'40)      Y02669* 04469002
*                            IF DEVICE 2250 OR HAS LIGHT PEN    Y02669* 04469302
*                               DCMIOUNQ = DCMW2250 (X'08')     Y02669* 04470902
*                            DCMIOUNQ SET TO DCMINERR X'02'     Y02669* 04472502
*                            INDICATING AN ERROR MESSAGE IN     Y02669* 04474102
*                            THE DCM INSTRUCTION LINE AND       Y02669* 04475702
*                            'ENTER CANCEL' ADDED TO MSG        Y02669* 04477302
*                            LOCKS RELEASED                     Y02651* 04478902
*      RETURN CODES     =    NONE                               Y02669* 04480502
*                                                                     * 04482102
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04483702
*                                                                     * 04485302
*   EXITS - NORMAL      =    RETURN VIA BR R14 FROM             Y02669* 04486902
*                            ISSUEWTO->RETURNOK                 Y02669* 04487702
*      CONDITIONS       =    MESSAGE WRITTEN TO APPROPIATE      Y02669* 04488502
*                            CONSOLE VIA WTO AND MESSAGE        Y02669* 04490102
*                            BUFFER FREED VIA FREEMAIN          Y02669* 04491102
*      OUTPUT DATA      =    MESSAGE                            Y02669* 04493302
*      RETURN CODES     =    NONE                               Y02669* 04494902
*                                                                     * 04496502
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04498102
*                                                                     * 04499702
*   EXIT - NORMAL       =    BRANCH TO IEE5903D FROM D5903D     Y02669* 04501302
*      CONDITIONS       =    WHEN THE MESSAGE HAS TWO PARTS     Y02669* 04502902
*                            (BIT 2 IS ON IN MESSAGE TEXT + 5)  Y02669* 04504502
*      OUTPUT DATA      =    REG 2 POINTS TO XSA WHICH CONTAINS Y02669* 04506102
*                                 INFO ABOUT THE MESSAGE        Y02669* 04507702
*                               XASTSAVE - ONE BYTE SECONDARY   Y02669* 04509302
*                                 MESSAGE CODE                  Y02669* 04510902
*                               XAU - SOURCE CONSOLE ID         Y02669* 04512502
*                               XASCID - TARGET CONSOLE ID      Y02669* 04514102
*                               XASDID - TARGET AREA ID (CRT)   Y02669* 04515702
*                               XASSDS1 - ON WTO BUFFER         Y02669* 04516102
*                               XASSDS5 - ON LOCKS HELD         Y02651* 04517302
*                               XASAVSTD+12 - WTO BUFFER ADDR   Y02669* 04518902
*                               XASAVSTD+16 - RETURN ADDRESS    Y02669* 04519702
*                            REG 3 - CURRENT POSITION IN        Y02669* 04520502
*                                    MESSAGE BUFFER             Y02669* 04520602
*                            REG 6 - CURRENT LENGTH OF VARIABLE Y02669* 04520902
*                                    TEXT                       Y02669* 04521302
*                            REG 8 - ADDRESS OF TRANSIANT DCM   Y02669* 04521702
*      RETURN CODES     =    NONE                               Y02669* 04532102
*                                                                     * 04542102
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04542502
*                                                                     * 04542902
*   EXIT - ERROR        =    RETURN VIA BR R14 BADCODE->RETURN  Y02669* 04543302
*      CONDITIONS       =    BAD MESSAGE CODE PASSED IN XAE     Y02669* 04543702
*                            LOCKS RELEASED (IF HELD ON ENTRY)  Y02651* 04545302
*      OUTPUT DATA      =    NONE                               Y02669* 04548902
*      RETURN CODES     =    NONE                               Y02669* 04550502
*                                                                     * 04552102
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04553702
*                                                                     * 04555302
*   EXIT - ERROR        =    BRANCH TO IEE0503D FROM NOCORE     Y02669* 04556902
*      CONDITIONS       =    BECAUSE GETMAIN FAILED FOR WTO     Y02669* 04558602
*                            BUFFER TO HAVE 'IEE328I COMMAND    Y02669* 04559002
*                            ABORTED' ISSUED                    Y02669* 04561702
*      OUTPUT DATA      =    ERROR CODE FOR MESSAGE IN XSA      Y02669* 04563302
*                            POINTED TO BY REG 2                Y02669* 04564902
*                              XAE CONTAINS X'3A' FOR IEE328I   Y02669* 04566502
*                              XASSDS5 - OFF LOCKS RELEASED     Y02651* 04568102
*                              LOCKS WERE RELEASED BEFORE THE   Y02651* 04568202
*                              GETMAIN                          Y02651* 04568302
*      RETURN CODES     =    NONE                               Y02669* 04568502
*                                                                     * 04568602
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04571102
*                                                                     * 04573602
*   EXTERNAL REFERENCES                                         Y02669* 04576102
*                                                                     * 04578602
*      ROUTINES         =    BRANCHES TO IEE5903D  IEE0503D     Y02669* 04581102
*                                                                     * 04583602
*      DATA AREAS       =    NONE                               Y02669* 04586102
*                                                                     * 04588602
*      CONTROL BLOCKS   =    CVT  R - ADDRESS UCM               Y02669* 04591102
*                            UCM  R - ADDRESS UCME AND RDCM     Y02669* 04593602
*                        IEERDCM  R - ADDRESS OF IEETDCM        Y02669* 04595602
*                        IEETDCM  R - INDICATORS CHECKED        Y02669* 04596102
*                                 W - INDICATORS SET            Y02669* 04598602
*                            XSA  R - INPUT INFORMATION         Y02669* 04601102
*                                 W - WORK AREA                 Y02669* 04603602
*                        IHAPSA   NEEDED FOR SETLOCK            Y02651* 04605602
*                                                                     * 04606102
         EJECT                                                          04608102
*        TABLES         =    THIS MODULE CONTAINS TWO MESSAGE   Y02669* 04608602
*                            TABLES. THE FIRST IN INDEXED BY    Y02669* 04611102
*                            TWICE THE MESSAGE CODE PASSED IN   Y02669* 04613602
*                            XAE. THE INDEXED HALF WORD THEN    Y02669* 04616102
*                            POINTS TO AN ELEMENT IN TAB2 WHICH Y02669* 04626102
*                            CONTAINS THE APPROPIATE MESSAGE.   Y02669* 04628102
*                                                                     * 04628502
*                            TAB2 CONTAINS A ONE BYTE LENGTH OF Y02669* 04628902
*                            THE PREFORMATTED MESSAGE TEXT -1,  Y02669* 04629302
*                            FOUR BYTES OF FILLER, ONE BYTE     Y02669* 04629702
*                            OF MESSAGE FLAGS:                  Y02669* 04637502
*                               X'80' - COMMAND VERB IN MSG     Y02669* 04637902
*                               X'40' - INVALID OPERAND IN MSG  Y02669* 04638302
*                               X'20' - IEE5903D CONTAINS REST  Y02669* 04638702
*                                       OF MESSAGE TEXT         Y02669* 04639102
*                               X'10' - OPERAND AT END OF MSG   Y02669* 04639202
*                            AND THE PREFORMATTED MESSAGE TEXT. Y02669* 04639502
*                                                                     * 04641502
*      MACROS           =    MODID                              Y02669* 04643502
*                            WTO                                Y02669* 04643602
*                            GETMAIN SUBPOOL 229                Y02669* 04643902
*                            FREEMAIN SUBPOOL 229               Y02669* 04644302
*                            SETLOCK - CMS AND LOCAL OBTAINED   Y02651* 04644402
*                                                  & RELEASED   Y02651* 04644502
*                                                                     * 04644702
*      ENQUEUE RESOURCES=    NONE                               Y02669* 04645102
*                                                                     * 04652502
*      CHANGE LEVEL     =    Y02669                             Y02669* 04654402
*                            Y02651                             Y02651* 04655002
*                            YM1914                             YM1914* 04655602
*                            Y02668                           @Y02668P* 04655903
*                                                                     * 04656302
*      LOCKS HELD       = FOR NON-DCM INSTRUCTION LINE MESSAGES:      * 04656702
*                            CMS AND LOCAL LOCKS OBTAINED IN    Y02651* 04657602
*                            IEE7503D ARE RELEASED AND XASSDS5  Y02651* 04658602
*                            IS TURNED OFF BEFORE ISSUING       Y02651* 04659002
*                            THE GETMAIN MACRO.                 Y02651* 04659602
*                        FOR DCM INSTRUCTION LINE MESSAGES:           * 04660202
*                            IF LOCKS NOT HELD ON ENTRY,        Y02651* 04661702
*                            (I.E. XASSDS5 IS OFF) THEY ARE     Y02651* 04661802
*                            OBTAINED AND XASSDS5 IS TURNED ON. Y02651* 04664002
*                            IF MESSAGE HAS 2 PARTS, CONTROL    Y02651* 04671202
*                            GOES TO IEE5903D WITH THE LOCKS    Y02651* 04671302
*                            HELD.                              Y02651* 04675102
*                                                                     * 04679002
         EJECT                                                          04681002
*   MESSAGES            =    THE FOLLOWING MESSAGES ARE         Y02669* 04682802
*                            CONTAINED WITHIN THIS MODULE:      Y02669* 04686602
*                             * MEANS AN INVALID COMMAND VERB   Y02669* 04690402
*                               WILL APPEAR WITHIN THE MESSAGE  Y02669* 04694202
*                               (FOUND IN XAV)                  Y02669* 04698002
*                             & MEANS AN INVALID OPERAND WILL   Y02669* 04701802
*                               APPEAR WITHIN THE MESSAGE       Y02669* 04705602
*                               (POINTED TO BY XASOPTR)         Y02669* 04709402
*                             + MEANS A SECOND PART OF THE      Y02669* 04713202
*                               MESSAGE WILL BE FOUND IN        Y02669* 04717002
*                               IEE5903D.                       Y02669* 04720802
*                         XXXXD THE MODULE NAMES FOLLOWING      Y02669* 04724602
*                               EACH MESSAGE INDICATE THE       Y02669* 04725502
*                               MODULES IN WHICH THE ERRORS     Y02669* 04726402
*                               WERE DETECTED AND MESSAGES      Y02669* 04727302
*                               ISSUED.                         Y02669* 04728402
*                                                                     * 04732202
*                            IEE150I  CHANGE OPTIONS IF   X'02' Y02669* 04739802
*                                     DESIRED                   Y02669* 04743602
*                                     6903D,6403D               Y02669* 04747402
*                        +   IEE151I  DELETE REQUEST      X'03' Y02669* 04751202
*                                     INCONSISTENT              Y02669* 04755002
*                                     6703D                     Y02669* 04756002
*                        *&  IEE156I  INVALID OPERAND     X'04' Y02669* 04758802
*                                     6703D,7503D,6903D,6803D,  Y02669* 04762602
*                                     7703D,7803D,6403D,6303D   Y02669* 04763602
*                        +   IEE158I  K REQUEST           X'05' Y02669* 04764602
*                                     INCONSISTENT              Y02669* 04766402
*                                     6703D,6903D               Y02669* 04769402
*                        *   IEE345I  AUTHORITY INVALID   X'08' Y02669* 04774002
*                                     7503D,7703D,6303D         Y02669* 04775002
*                        *+& IEE921I  REJECTED            X'09' Y02669* 04777802
*                                     7503D,7703D               Y02669* 04781602
*                        +   IEE924I  INVALID AREA        X'0A' Y02669* 04785402
*                                     DEFINITION                Y02669* 04793002
*                                     6803D,6903D               Y02669* 04793902
*                        *+& IEE925I  OPERAND             X'0B' Y02669* 04794802
*                                     6703D,7503D,6403D,6303D   Y02669* 04795702
*                        +   IEE926I  L=CCA OPERAND       X'0C' Y02669* 04796802
*                                     INVALID                   Y02669* 04800602
*                                     6703D,7503D,6803D,7703D,  Y02669* 04804402
*                                     6403D,6303D               Y02669* 04805402
*                        *+  IEE927I  REQUEST AMBIGUOUS   X'0D' Y02669* 04808202
*                                     6703D,7503D,7803D         Y02669* 04809202
*                        *&  IEE931I  INSUFFICIENT        X'0E' Y02669* 04812002
*                                     STORAGE FOR COMMAND       Y02669* 04815802
*                                     6903D,6803D,6403D,6303D   Y02669* 04819602
*                                                                     * 04820602
*   SYSGEN              =    INCLUDED WITH SVC 34 IN LOAD       Y02669* 04823402
*                            MODULE IGC0003D, DLIB AOSB3,       Y02669* 04831002
*                            MACRO SGIEF441, TARLIB LPALIB.     Y02669* 04834802
*                                                                     * 04842402
*   SYSTEM                                                      Y02669* 04846202
*    LIBRARIES          =    NONE                               Y02669* 04850002
*                                                                     * 04855002
*********************************************************************** 04860002
         EJECT                                                          04865002
IEE5603D CSECT                                                          04870002
*********************************************************************** 04875002
*                                                                     * 04880002
*                          REGISTERS                                  * 04885002
*                                                                     * 04890002
*********************************************************************** 04895002
WRK0     EQU   0                   WORK REG MUST BE 0 AT MOVECDR Y02669 04900002
WRK1     EQU   1                   WORK REGISTER                        05000001
XSAR2    EQU   2                   INPUT/OUTPUT-XSA BASE REG     Y02669 05100002
WRK3     EQU   3                   OUTPUT-POSITION IN MSG BUFFER Y02669 05200002
WRK4     EQU   4                   WORK REGISTER                        05300002
WRK5     EQU   5                   WORK REGISTER                 Y02669 05400002
WRK6     EQU   6                   OUTPUT-CURRENT TEXT LENGTH    Y02669 05500002
UCMER7   EQU   7                   BASE REG FOR UCM ENTRY        Y02669 05600002
TDCMR8   EQU   8                   OUTPUT-BASE REG FOR TRANS DCM Y02669 05650002
WRK9     EQU   9                   BASE REG FOR UCM + RDCM       Y02669 05800002
WRK10    EQU   10                  BASE REG FOR CVT + TAB2       Y02669 05950002
BADOP11  EQU   11                  POINTER TO INVALID OPERAND    Y02669 06000002
BASE12   EQU   12                  MODULE BASE REGISTER          Y02669 06100002
WRK13    EQU   13                  ADDRESSES MESSAGE TABLE ENTRY Y02669 06200002
RETURN14 EQU   14                  RETURN REGISTER               Y02669 06300002
R15      EQU   15                  RETURN CODE + LINK REGISTER   Y02669 06400002
         EJECT                                                          06450001
*********************************************************************** 06460002
*                                                                     * 06500002
*                        NUMERIC  CONSTANTS                           * 06600002
*                                                                     * 06700002
*********************************************************************** 06750002
N0       EQU   0                   NUMBER CONSTANT                      06800001
N1       EQU   1                   NUMBER CONSTANT                      06900001
N2       EQU   2                   NUMBER CONSTANT                      07000001
N3       EQU   3                   NUMBER CONSTANT                      07100001
N4       EQU   4                   NUMBER CONSTANT                      07200001
N5       EQU   5                   NUMBER CONSTANT                      07300001
N6       EQU   6                   NUMBER CONSTANT                      07400001
N7       EQU   7                   NUMBER CONSTANT                      07500001
N8       EQU   8                   NUMBER CONSTANT                      07600001
N9       EQU   9                   NUMBER CONSTANT                      07700001
N10      EQU   10                  NUMBER CONSTANT                      07800001
N12      EQU   12                  NUMBER CONSTANT               Y02669 07850002
N15      EQU   15                  NUMBER CONSTANT                      08100001
N16      EQU   16                  NUMBER CONSTANT               Y02669 08150002
N25      EQU   25                  NUMBER CONSTANT                      08300001
N59      EQU   59                  NUMBER CONSTANT                      08500001
N60      EQU   60                  NUMBER CONSTANT                      08600001
N64      EQU   64                  NUMBER CONSTANT                      08700001
*********************************************************************** 08750002
*                                                                     * 08760002
*                        CHARACTER CONSTANTS                          * 08770002
*                                                                     * 08780002
*********************************************************************** 08790002
BLANK    EQU   X'40'               BLANK CONSTANT                Y02669 08800002
COMMA    EQU   C','                COMMA CHARACTER                      08900001
PARA2    EQU   C')'                PARENTHSIS CONSTANT                  09000001
*********************************************************************** 09050002
*                                                                     * 09060002
*                           FLAGS                                     * 09070002
*                                                                     * 09080002
*********************************************************************** 09090002
CMDFLAG  EQU   X'80'               COMMAND FLAG IN MSG TABLE     Y02669 09100002
OPFLAG   EQU   X'40'               OPERAND FLAG IN MSG TABLE     Y02669 09200002
VTXTFLAG EQU   X'20'               VARIABLE TEXT FLAG IN TABLE          09300002
OPENDFLG EQU   X'10'               OPERAND AT MSG END FLAG       Y02669 09400002
MCSFG    EQU   X'E0'               MCS FLAGS FOR WTO                    09450002
CODE2HI  EQU   14                  HIGHEST VALID MESSAGE CODE    Y02669 09600002
CODE2LO  EQU   2                   LOWEST VALID MESSAGE CODE     Y02669 09700002
TOOLOW   EQU   4                   CONDITION CODE - LOWER THAN   Y02669 09750002
TOOHIGH  EQU   2                   CONDITION CODE - HIGHER THAN  Y02669 09760002
XFF      EQU   X'FF'               MASK TO TURN OFF FLAGS        Y02669 09800002
KCMD     EQU   X'90'               CODE IN XSA FOR K COMMAND     Y02669 09900002
MRCMD    EQU   X'94'               CODE IN XSA FOR MSGRT COMMAND YM1914 09920002
SP229    EQU   229                 SUBPOOL NUMBER FOR GETMAIN    Y02669 09950002
IEE150I  EQU   X'02'               MSG CODE - CHANGE OPTION MSG  Y02669 10200002
MSG328   EQU   X'3A'               MSG CODE-IEE328I CMD ABORTED  Y02669 10450002
         EJECT                                                          10500001
*********************************************************************** 10550002
*                                                                     * 10600002
*          ESTABLISH ADDRESSABILITY TO MODULE, XSA, UCM, UCME         * 10650002
*                                                                     * 10700002
*********************************************************************** 10750002
         SPACE 2                                                        10800002
         BALR   BASE12,N0          LOAD BASE REG                 Y02669 10900002
         USING *,BASE12                                          Y02669 11000002
         MODID BRANCH=YES                                        Y01886 11050001
         USING DXSA,XSAR2           ADDRESSIBILITY OF XSA        Y02669 11100002
         L     WRK10,CVTPTR         ADDRESS OF CVT               Y02669 11200002
         USING DCVT,WRK10           ADDRESSIBILITY OF CVT        Y02669 11300002
         L     WRK9,CVTCUCB         ADDRESS OF UCM FROM CVT      Y02669 11400002
         USING UCM,WRK9             ADDRESSIBILITY OF UCM        Y02669 11500002
         DROP  WRK10                                             Y02669 11600002
         USING UCMLIST,UCMER7       ADDRESSIBILITY OF UCM ENTRY  Y02669 11700002
         SPACE                                                          11710002
*********************************************************************** 11750002
*                                                                     * 11800002
*             CHECK FOR INCORRECT MESSAGE CODE                        * 11900002
*       IF TOO HIGH OR TOO LOW FREE LOCKS, IF HELD, AND RETURN        * 11950002
*                                                                     * 12000002
*********************************************************************** 12400002
         SPACE 2                                                        12450002
BADCODE  EQU   *                                                 Y02669 12460002
         ST    RETURN14,XASAVSTD+N16   SAVE RETURN ADDRESS       Y02669 12470002
         CLI   XAE,CODE2HI         IS MSG CODE HIGHER THAN MAX?  Y02669 12500002
         BC    TOOHIGH,RETURN      YES, CHECK LOCKS AND RETURN   Y02651 12600002
         SPACE                                                          12650002
         CLI   XAE,CODE2LO         IS MSG CODE LOWER THAN MIN?   Y02669 12700002
         BC    TOOLOW,RETURN       YES, CHECK LOCKS AND RETURN   Y02651 12800002
         EJECT                                                          12850002
*********************************************************************** 13050002
*                                                                     * 13150002
*  TAKE THE SOURCE CONSOLE ID IN REG 1 AND CALCULATE THE ADDRESS Y02669 13160002
*   OF THE UCM ENTRY FOR THAT CONSOLE AND PLACE IT IN REG UCMER7 Y02669 13170002
*                                                                     * 13180002
*********************************************************************** 13182002
         SPACE 3                                                        13184002
         SR    WRK1,WRK1           CLEAR REG                            13190002
         IC    WRK1,XAU            GET SOURCE CONSOLE ID                13190402
         LTR   WRK1,WRK1           IF CONSOLE ID = 0 THEN        YM1557 13190502
         BZ    BUILDWTO            COMMAND ISSUED INTERNALLY     YM1557 13190602
         BCTR  WRK1,N0             SUBTRACT ONE FROM CONSOLE ID         13190802
         L     UCMER7,UCMVEA       FIRST UCM ENTRY FROM UCM      Y02669 13192002
         M     WRK0,UCMVEZ         MULTIPLY ENTRY SIZE BY REDUCED ID    13196002
         DROP  WRK9                                              Y02669 13196402
         AR    UCMER7,WRK1         ADDRESS OF DESIRED UCM ENTRY  Y02669 13198002
*********************************************************************** 13248002
*                                                                     * 13298002
*    DETERMINE WHETHER THE MESSAGE GOES IN DCM INSTRUCTION LINE       * 13348002
*          1 FOR MESSAGES WHICH ALSO INCLUDE 'IEE150I CHANGE          * 13350002
*           OPTIONS' FOR CRT DEVICES                                  * 13352002
*          2 FOR ALL MESSAGES PERTAINING TO K AND MR COMMAND FOR CRT  * 13354002
*    OR WTO BUFFER                                                    * 13356002
*          1 FOR NON-CRT DEVICES OR                                   * 13358002
*          2 FOR ALL OTHER MESSAGES TO CRT DEVICES                    * 13368002
*                                                                     * 13448002
*********************************************************************** 13498002
         TM    UCMDISP,UCMDISPC    IS THIS CONSOLE A CRT?               13600001
         BZ    BUILDWTO            NO, GO ISSUE WTO              Y02669 13700002
         TM    XASSDS,XASSDS3      IS TASK COMTASK?            @Y02668P 13710003
         BO    BUILDWTO            NO,BRANCH A TASK OTHER THAN @Y02668P 13720003
*                                  COMTASK ISSUED THE COMMAND  @Y02668P 13730003
         SPACE                                                          13750002
         CLI   XAN,KCMD            IS THIS A CONTROL (K) COMMAND?Y20669 13760002
         BE    LOCKSTAT            YES, PUT MSG IN DCM INSTRUCTION LINE 13762002
         SPACE                                                          13763002
         CLI   XAN,MRCMD           IS THIS A MSGRT COMMAND?      YM1914 13764002
         BE    LOCKSTAT            YES, PUT MSG IN INSTR LINE    YM1914 13766002
         SPACE                                                          13768002
         CLI   XAE,IEE150I         IS THIS CHANGE OPTIONS MSG?   Y02669 13770002
         BNE   BUILDWTO            NO, ISSUE WTO                 Y02669 13780002
         EJECT                                                          13790002
*********************************************************************** 13790102
* CMS AND LOCAL LOCKS IF NOT ALREADY HELD MUST BE OBTAINED FOR DCM    * 13794202
*********************************************************************** 13799002
LOCKSTAT EQU   *                                                 Y02651 13803102
         TM    XASSDS,XASSDS5      ARE LOCKS STILL ON?           Y02651 13807202
         BO    LOCKSON             YES,NO NEED TO TURN LOCKS ON  Y02651 13811302
         STM   BADOP11,RETURN14,XASAVLOC SAVE REGS FOR SETLOCK   Y02651 13815402
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        *13819502
               RELATED=(TR,PT,K,RETURN,IEE5903D(LOCKSOFF))              13823602
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                          *13827702
               RELATED=(TR,PT,K,RETURN,IEE5903D(LOCKSOFF))              13831802
         LM    BADOP11,RETURN14,XASAVLOC  RESTORE AFTER SETLOCK  Y02651 13835902
         OI    XASSDS,XASSDS5      INDICATE LOCKS ON             Y02651 13840002
         SPACE 2                                                        13850002
LOCKSON  EQU   *                                                 Y02651 13860002
         L     WRK9,UCMXB          ADDRESS OF RESIDENT DCM       Y02669 13880002
         USING DCMTSRT,WRK9                                      Y02669 13890002
         L     TDCMR8,DCMADTRN     ADDRESS OF TRANSIENT DCM      Y02669 13900002
         USING DCMSTRT,TDCMR8                                    Y02669 13950002
         DROP  WRK9                                              Y02669 14000002
         EJECT                                                          15100002
*********************************************************************** 15150002
*                                                                     * 15200002
*     CONTROL (K), MR OR IEE150I CHANGE OPTIONS MESSAGE FOR CRT  YM1914 15250002
*     WRK4 POINTS TO THE XSA OPERAND BUFFER FOR THE K OR MR      Y02669 15260002
*                 COMMANDS OR THE DCM ENTRY AREA FOR IEE150I     Y02669 15270002
*                                                                     * 15300002
*********************************************************************** 15400002
         SPACE 3                                                        15450002
MOVEDCM  EQU   *                                                        15500001
         L     WRK4,XAR            ADDRESS OF COMMAND BUFFER            15600002
         LA    WRK4,N4(WRK4)       INCREMENT TO COMMAND IN BUFFER       15700002
         CLI   XAE,IEE150I         IS THIS A IEE150I MESSAGE     Y02669 15800002
         BNE   MOVEOPT             NO, K COMMAND                        15900002
         SPACE                                                          15950002
         L     WRK4,DCMAENTR       YES, ADDRESS OF DCM ENTRY AREA       16000002
MOVEOPT  EQU   *                                                        16100001
         SR    BADOP11,BADOP11     NECESSARY FOR ICM             Y02669 16150002
         ICM   BADOP11,N7,XASOPTR  GET CURSOR POSITION           Y02669 16200002
*                                  OR INVALID OPERAND POINTER    Y02669 16250002
*                                  OK IF ZERO                    Y02669 16300002
         SR    BADOP11,WRK4        DISTANCE TO INVALID OPERAND   Y02669 16400002
         STH   BADOP11,DCMINLGN    SET CURSOR POSITIONING        Y02669 16500002
         OI    DCMSVC34,DCMINVLD   SET INVALID K COMMAND BIT            16600002
         CLI   XAE,IEE150I         IS THIS A IEE150I MESSAGE   @YM1919P 16620002
         BE    NOSOUND             YES,NO ALARM                @YM1919P 16640002
         OI    DCMIOCM1,DCMSOUND   NO,SOUND THE ALARM          @YM1919P 16660002
NOSOUND  EQU   *                                               @YM1919P 16680002
         L     WRK3,DCMAINS        ADDRESS OF INSTRUCTION LINE OF DCM   16700001
         LH    WRK4,DCMLGNTH       GET THE LENGTH OF A LINE FROM DCM    16800001
         B     BUILDL              GO BUILD MESSAGE              Y02669 16850002
*                                  WRK3 ADDRESSES DCM INSTRUCTIONY02669 16860002
*      ON EXIT FROM HERE           LINE                          Y02669 16870002
*                                  WRK4 CONTAINS LENGTH OF LINE  Y02669 16880002
         EJECT                                                          16900002
*********************************************************************** 16950002
*                                                                     * 17000002
*            GET CORE FOR A MESSAGE THAT IS A WTO                Y02669 17050002
*        FOR A NON-CRT OR AN ORDINARY MESSAGE FOR A CRT          Y02669 17060002
*        REG 3 - WILL BE THE CURRENT POSITION IN BUFFER PAST MCS Y02669 17070002
*        REG 4 - WILL BE THE LENGTH OF THE BUFFER (60)           Y02669 17080002
*                                                                     * 17100002
*********************************************************************** 17150002
         SPACE 3                                                        17160002
BUILDWTO EQU   *                                                        17170002
         TM    XASSDS,XASSDS5      ARE LOCKS STILL SET?          Y02651 17170402
         BZ    NOLOCKON            NO,NO NEED TO TURN LOCKS OFF  Y02651 17170802
         BAL   R15,LOCKSOFF        YES,GO RELEASE LOCKS          Y02651 17171202
NOLOCKON EQU   *                                                 Y02651 17178802
         LA    WRK1,XASAVSTD+N12   AREA FOR STORAGE ADDRESS      Y02669 17180002
         MVC   XASAVSTD(N10),GETAREA    MOVE PARM LIST TO XSA    Y02669 17190002
         ST    WRK1,XASAVSTD+N4    WHERE GETMAIN TO STORE ADDR   Y02669 17192002
         LA    WRK1,XASAVSTD       ADDR OF PARM LIST FOR GETMAIN Y02669 17194002
         GETMAIN MF=(E,(1))        GET CORE FOR WTO                     17196002
         LTR   R15,R15             WAS GETMAIN SUCESSFUL?        Y02669 17198002
         BC    N7,NOCORE           NO, IEE328I CMD ABORTED(0503D)Y02669 17198402
         SPACE                                                          17198502
         L     WRK3,XASAVSTD+N12   YES,GOTTEN CORE'S ADDRESS     Y02669 17198802
         XC    N0(N4,WRK3),N0(WRK3) ZERO FOUR BYTES                     17199202
         OI    XASSDS,XASSDS1      SET WTO INDICATOR ON          Y02669 17199602
         OI    N2(WRK3),MCSFG      SET MCS FLAGS FOR WTO ON             17199702
         LA    WRK3,N4(WRK3)       INCREMENT BUFFER ADDRESS PAST MCS    17199802
         LA    WRK4,N60            LENGTH OF MSG BUFFER NOW 60          17199902
         EJECT                                                          17233202
*********************************************************************** 17300002
*                                                                     * 17450002
*           BLANK OUT THE BUFFER AREA FOR THE MESSAGE                 * 17460002
*    ON ENTRY:                                                   Y02669 17460402
*     WRK4 CONTAINS LENGTH OF DCM INSTRUCTION LINE               Y02669 17462002
*                OR REMAINING LENGTH OF WTO BUFFER, NOW 60       Y02669 17464002
*     WRK3 CONTAINS ADDRESS OF DCM INSTRUCTION LINE              Y02669 17466002
*                OR WTO BUFFER                                   Y02669 17468002
*    ON EXIT - WRK4 IS DESTROYED                                 Y02669 17468402
*                                                                     * 17470002
*********************************************************************** 17472002
         SPACE 2                                                        17474002
BUILDL   EQU   *                                                        17480002
         BCTR  WRK4,N0             DECREMENT THE LENGTH OF THE BUFFER   17490001
         BCTR  WRK4,N0             AREA BY TWO                          17492001
         MVI   N0(WRK3),BLANK      BLANK FIRST CHARACTER         Y02669 17494002
         EX    WRK4,BLANKOUT       PROPAGATE BLANKS              Y02669 17496002
*********************************************************************** 17498002
*                                                                     * 17498402
*                GET MESSAGE TEXT ENTRY IN TABLE                      * 17498802
*                                                                     * 17499202
*********************************************************************** 17499602
         SR    WRK4,WRK4           CLEAR REG                            17500001
         IC    WRK4,XAE            ERROR CODE FROM XSA                  17600001
         AR    WRK4,WRK4           DOUBLE CODE FOR INDEX                17700001
         LA    WRK13,TAB1(WRK4)    PT TO APPROPRIATE TAB1 ENTRY  Y02669 17800002
         LH    WRK13,N0(WRK13)     LOAD TABLE ELEMENT            Y02669 17900002
         LA    WRK10,TAB2(WRK13)   PT TO APPROPRIATE TAB2 ENTRY  Y02669 17910002
         EJECT                                                          17950001
*********************************************************************** 17960002
*                                                                     * 18000002
*         BUILD MESSAGE IN DCM INSTRUCTION LINE OR WTO BUFFER         * 18100002
*           WRK3 STILL POINTS TO BEGINNING OF WTO BUFFER OR DCM LINE  * 18150002
*                                                                     * 18200002
*********************************************************************** 18500002
         SPACE 2                                                        18550002
         MVC   N0(N3,WRK3),MSGID   MOVE IN IEE                   Y02669 18600002
         MVC   N3(N4,WRK3),N1(WRK10) FILL IN MSG ID              Y02669 18800002
         TM    N5(WRK10),CMDFLAG   DOES MSG REQUIRE CMND VERB?   Y02669 19200002
         BZ    OPDTEST             NO                            Y02669 19250002
         SPACE 2                                                        19310002
*********************************************************************** 19350002
*                                                                     * 19350402
*               MOVE COMMAND VERB INTO MESSAGE BUFFER            Y02669 19352002
*   AT THIS POINT REG 0 CONTAINS ZERO ( FROM M INSTRUCTION)      Y02669 19352402
*                                                                     * 19354002
*********************************************************************** 19360002
         SPACE 2                                                        19400001
MOVECDR  EQU   *                                                        19450002
         MVC   N8(N8,WRK3),XAV     MOVE IN VERB FROM XSA                19500002
         LA    WRK3,N9(WRK3)       INCREMENT MSG PTR AROUND VERB        19550002
         LA    WRK0,N9             INCREMENT VARIABLE TEXT COUNT        19600002
OPDTEST  EQU   *                                                        19800001
         TM    N5(WRK10),OPFLAG    DOES MSG REQUIRE OPERAND?     Y02669 19900002
         BZ    MOVETXT             NO                            Y02669 20000002
         EJECT                                                          20002002
*********************************************************************** 20010002
*                                                                     * 20012002
*        MOVE INVALID OPERAND INTO MESSAGE BUFFER                Y02669 20020002
*        WRK0 - LENGTH OF VARIABLE TEXT SO FAR (0 OR 9)          Y02669 20020402
*        WRK3 - POSITION IN MESSAGE BUFFER                       Y02669 20020802
*        WRK4 - LENGTH OF INVALID OPERAND                        Y02669 20021202
*        BADOP11 - ADDRESS OF INVALID OPERAND                    Y02669 20021602
*                                                                     * 20022002
*********************************************************************** 20030002
         SPACE 2                                                        20040002
MOVEOPD  EQU   *                                                        20050002
         SR    WRK4,WRK4           CLEAR FOR ICM INSTRUCTION     Y02669 20060002
         ICM   WRK4,N7,XASOPTR     ADDRESS OF INVALID OPERAND    Y02669 20070002
         BZ    MOVETXT             IF ZERO NO OPERAND            Y02669 20072002
         LR    BADOP11,WRK4        ADDRESS OF INVALID OPERAND    Y02669 20080002
         LA    WRK5,N8             MAXIMUM OPERAND LENGTH        Y02669 20090002
INCROP   EQU   *                                                        20092002
         LA    WRK4,N1(WRK4)       INCREMENT OPERAND ADDR BY ONE        20094002
         CLI   N0(WRK4),BLANK      IS THIS END OF THE OPERAND?   Y02669 20096002
         BE    GETLEN              YES                                  20098002
         CLI   N0(WRK4),COMMA      IS THIS A COMMA?                     20098402
         BE    GETLEN              YES                                  20098802
         CLI   N0(WRK4),PARA2      IS THIS A PARENTHSIS?                20099202
         BE    GETLEN              YES                                  20099602
         BCT   WRK5,INCROP         DECREMENT AND TEST NEXT CHAR  Y02669 20099702
GETLEN   EQU   *                                                        20099802
         SR    WRK4,BADOP11        LENGTH OF INVALID OPERAND     Y02669 20099902
         BCTR  WRK4,N0             DECREMENT FOR EXECUTE                20133202
         TM    N5(WRK10),OPENDFLG  IS OPERAND AT END OF MSG?     Y02669 20143202
         BZ    OPNOTEND            NO                            Y02669 20153202
         EX    WRK4,OPATEND        PUT BAD OPERAND AT END OF MSG Y02669 20155202
         LA    WRK4,N1(WRK4)       LENGTH OF INVALID OPERAND     Y02669 20157202
         B     CONTOP              CONTINUE TO BUILD MSG         Y02669 20159202
OPNOTEND EQU   *                                                 Y02669 20161202
         EX    WRK4,MOVEINOP       PUT BAD OPERAND IN MSG TEXT   Y02669 20163202
         LA    WRK4,N2(WRK4)       LENGTH OF OPERAND + BLANK     Y02669 20165202
         AR    WRK3,WRK4           INCREMENT DCM PTR AROUND VERB Y02669 20165602
CONTOP   EQU   *                                                        20166002
         AR    WRK0,WRK4           INCREMENT VARIABLE TEXT COUNT        20166402
         EJECT                                                          20188502
*********************************************************************** 20188602
*                                                                     * 20188902
*         MOVE FIXED TEXT FROM TABLE TWO INTO MESSAGE BUFFER          * 20200002
*         WRK3 - POSITION IN MESSAGE BUFFER                           * 20250002
*         WRK6 - TOTAL LENGTH OF VARIABLE TEXT                        * 20260002
*                                                                     * 20300002
*********************************************************************** 20700002
         SPACE 2                                                        20750002
MOVETXT  EQU   *                                                        20800001
         SR    WRK6,WRK6           CLEAR REG                            20900001
         IC    WRK6,N0(WRK10)      GET FIXED MSG TEXT LENGTH - 1 Y02669 21000002
         EX    WRK6,FILLTEXT       MOVE IN FIXED TEXT            Y02669 21100002
         LA    WRK6,N9(WRK6)       LENGTH OF ID,+ BLANK,+ 1             21200001
         AR    WRK3,WRK6           UPDATE BUFFER POINTER TO INCLUDE TXT 21300001
         AR    WRK6,WRK0           LENGTH OF VERB AND OPERAND OR ZERO   21400001
         TM    N5(WRK10),VTXTFLAG  DOES MSG HAVE MORE TEXT?      Y02669 21800002
         BO    D5903D              YES, EXIT TO IEE5903D         Y02669 21900002
         SPACE                                                          22000002
         TM    XASSDS,XASSDS1      IS THIS A WTO?                Y02669 22400002
         BO    ISSUEWTO            YES                                  22500002
         SPACE                                                          22600002
*********************************************************************** 22650002
*       THE MESSAGE WAS PUT IN DCM INSTRUCTION LINE              Y02669 22660002
*********************************************************************** 22700002
         OI    DCMIOCM1,DCMWRINS   SET BIT TO WRITE INST LINE           22900001
         TM    DCMIOUNQ,DCMW2250   DOES DEVICE HAVE A LIGHT PEN?        23300001
         BZ    RETURN              NO                            Y02669 23400002
         SPACE                                                          23450002
         L     WRK3,DCMAINS        POINT TO INSTRUCTION LINE IN DCM     23900002
         MVC   N59(N15,WRK3),ENCANCEL  MOVE ENTER-CANCEL MSG INTO LINE  24000002
         NI    DCMIOUNQ,XFF-DCMINNOR TURN OFF NORMAL LINE BIT    Y02669 24100002
         OI    DCMIOUNQ,DCMINERR   INDICATE ERROR MSG IN INST LINE      24200001
         SPACE 2                                                        24400002
RETURN   EQU   *                                                        24600001
         TM    XASSDS,XASSDS5      ARE LOCKS STILL SET?          Y02651 24660002
         BZ    RETURNOK            NO,NO NEED TO TURN LOCKS OFF  Y02651 24670002
         BAL   R15,LOCKSOFF        GO RELEASE LOCKS              Y02669 24672002
RETURNOK EQU   *                                                 Y02651 24698802
         L     RETURN14,XASAVSTD+N16   RESTORE RETURN ADDRESS    Y02669 24699202
         BR    RETURN14            RETURN TO CALLER              Y02669 24700002
         EJECT                                                          25600001
*********************************************************************** 25800002
*                                                                     * 28800002
*         PREPARE TO WRITE MESSAGE VIA WTO AND FREE CORE         Y02669 28900002
*                                                                     * 29000002
*********************************************************************** 29300002
         SPACE 2                                                        29350002
ISSUEWTO EQU   *                                                        29400002
         L     WRK1,XASAVSTD+N12   ADDRESS OF WTO BUFFER         Y02669 29500002
         LA    WRK6,N4(WRK6)       4 EXTRA BYTES FOR WTO (MCS + LEN)    29600001
         STH   WRK6,N0(WRK1)       PUT LENGTH OF TEXT + 4 IN BUFFER     29700002
         AR    WRK6,WRK1           CALCULATE END OF BUFFER              29800002
         MVC   N0(N4,WRK6),DRCODES MOVE IN DESC AND ROUTE CODES         29900001
         SR    WRK0,WRK0           CLEAR REG                            30000001
         IC    WRK0,XAU            SOURCE CONSOLE ID FROM XSA           30100002
         WTO   MF=(E,(1))          WRITE MESSAGE                        30200001
         SPACE                                                          30250002
         L     WRK1,XASAVSTD+N12   ADDRESS OF AREA FOR FREEMAIN  Y02669 30600002
         FREEMAIN R,LV=N64,A=(1),SP=SP229                        Y02669 30700002
         B     RETURNOK            RETURN TO CALLER              Y02669 31100002
         EJECT                                                          31110002
*********************************************************************** 31160002
*                                                                     * 31210002
*         EXIT TO IEE5903D WITH THE FOLLOWING OUTPUT:            Y02669 31260002
*         XSAR2 - BASE REGISTER FOR XSA                          Y02669 31270002
*                 XASAVSTD + 12 BEGINNING ADDRESS OF WTO BUFFER  Y02669 31272002
*         XASAVSTD + 16 - RETURN ADDRESS                                31276002
*         WRK3 - CURRENT POSITION IN MESSAGE BUFFER              Y02669 31280002
*         WRK6 - TOTAL LENGTH OF VARIABLE TEXT                   Y02669 31290002
*         TDCMR8 - BASE REGISTER FOR TRANSIANT DCM               Y02669 31300002
*                                                                     * 31310002
*********************************************************************** 31360002
         SPACE 2                                                        31410002
D5903D   EQU   *                                                 Y02669 36200002
         L     R15,VCON5903        GET ADDRESS OF SECOND LOAD    Y02669 36300002
         BR    R15                 GO TO IEE5903D                Y02669 36350002
         SPACE  2                                                       37310002
*********************************************************************** 37312002
*                                                                     * 37314002
*                        EXIT TO IEE0503D                        Y02669 37316002
*           LOCKS WERE RELEASED BEFORE ATTEMPTING THE GETMAIN    Y02651 37316402
*                                                                     * 37318002
*********************************************************************** 37318402
         SPACE 2                                                        37318802
NOCORE   EQU   *                                                 Y02669 37320002
         L     RETURN14,XASAVSTD+N16 RESTORE RETURN ADDRESS      Y02669 37325002
         MVI   XAE,MSG328          MSG CODE -IEE328I CMD ABORTED Y02669 37330002
         L     R15,VCON0503        GO TO IEE0503D TO ISSUE MSG   Y02669 37340002
         BR    R15                                               Y02669 37342002
         EJECT                                                          37342102
*********************************************************************** 37342202
*             CMS AND LOCAL LOCKS MUST BE RELEASED BEFORE        Y02651 37342302
*                 ISSUING SVC'S AND RETURNING                    Y02651 37342402
*********************************************************************** 37342502
         SPACE 2                                                        37342602
LOCKSOFF EQU   *                                                 Y02651 37342702
         STM   BADOP11,RETURN14,XASAVLOC SAVE REGS FOR SETLOCK   Y02651 37342802
         SETLOCK RELEASE,TYPE=CMS,                                     *37342902
               RELATED=(TR,PT,K,IEE7503D(LOCKSET))                      37343002
         SETLOCK RELEASE,TYPE=LOCAL,                                   *37343102
               RELATED=(TR,PT,K,IEE7503D(LOCKSET))                      37343502
         LM    BADOP11,RETURN14,XASAVLOC    RESTORE REGS         Y02651 37343602
         NI    XASSDS,XFF-XASSDS5  INDICATE LOCKS OFF            Y02651 37343702
         BR    R15                                                      37343802
         EJECT                                                          37344902
*********************************************************************** 37345002
*                   EXECUTE INSTRCUTIONS                         Y02669 37345102
*********************************************************************** 37345202
         SPACE 2                                                        37345302
OPATEND  MVC   N25(N0,WRK3),N0(BADOP11) PUT OPERAND AT MSG END   Y02669 37345402
BLANKOUT MVC   N1(N0,WRK3),N0(WRK3)  USED TO BLANK MESSAGE BUFFERY02669 37345502
MOVEINOP MVC   N8(N0,WRK3),N0(BADOP11)  PUT OPERAND INTO MSG     Y02669 37345602
FILLTEXT MVC   N8(N0,WRK3),N6(WRK10)  MOVE FIX TEXT INTO BUFFER  Y02669 37345702
         SPACE 2                                                        37345802
*********************************************************************** 37345902
*                   GETMAIN LIST FORM                            Y02669 37346002
*********************************************************************** 37346402
GETAREA  GETMAIN EC,LV=N64,A=NOCORE,SP=SP229,MF=L                Y02669 37348002
         EJECT                                                          37357102
*********************************************************************** 37360002
*                                                                     * 37400002
*  THE FOLLOWING TABLE IS INDEXED BY TWICE THE MESSAGE CODE IN   Y02669 37500002
*  XASTSAVE. EACH HALF-WORD CONTAINS AN INDEX TO THE TAB2        Y02669 37600002
*  ELEMENT CONTAINING THE APPROPRIATE MESSAGE TEXT               Y02669 37650002
*                                                                     * 37700002
*********************************************************************** 37750002
PREMSG   EQU   6                   BYTES BEFORE MESSAGE TEXT            37800001
TAB1     EQU   *                                                        37900001
         DC    AL2(0)                                                   38000001
         DC    X'FFFF'             OBSOLETE MESSAGE              Y02669 38100002
         DC    Y(TM02-TAB2-PREMSG)                                      38200001
         DC    Y(TM03-TAB2-PREMSG)                                      38300001
         DC    Y(TM04-TAB2-PREMSG)                                      38400001
         DC    Y(TM05-TAB2-PREMSG)                                      38500001
         DC    X'FFFF'             OBSOLETE MESSAGE              Y02669 38600002
         DC    X'FFFF'             OBSOLETE MESSAGE              Y02669 38700002
         DC    Y(TM08-TAB2-PREMSG)                                      38800001
         DC    Y(TM09-TAB2-PREMSG)                                      38900001
         DC    Y(TM10-TAB2-PREMSG)                                      39000001
         DC    Y(TM11-TAB2-PREMSG)                                      39100001
         DC    Y(TM12-TAB2-PREMSG)                                      39200001
         DC    Y(TM13-TAB2-PREMSG)                                      39300001
         DC    Y(TM14-TAB2-PREMSG)                                      39400001
         EJECT                                                          39450001
*********************************************************************** 39460002
*                                                                     * 39500002
*  EACH ENTRY IN THE FOLLOWING TABLE CONTAINS:                   Y02669 39600002
*      A 1-BYTE LENGTH OF THE PREFORMATTED MESSAGE TEXT - 1      Y02669 39650002
*        4-BYTE ID FILLER                                        Y02669 39660002
*        1-BYTE MESSAGE FLAGS                                    Y02669 39670002
*               X'80' - MESSAGE REQUIRES COMMAND VERB FROM XAV   Y02669 39680002
*               X'40' - MESSAGE REQUIRES INVALID OPERAND FROM XASOPTR * 39690002
*               X'20' - MESSAGE REQUIRES ADDITIONAL TEXT FROM IEE5903D* 39692002
*               X'10' - INVALID OPERAND BELONGS AT END OF MESSAGE TEXT* 39694002
*        PREFROMATTED MESSAGE TEXT                               Y02669 39800002
*                                                                     * 39900002
*********************************************************************** 39950002
TAB2     EQU   *                                                        40000001
         DC    AL1(L'TM02-1)               LENGTH OF FIXED MSG TEXT     40600002
         DC    C'150I'                     MESSAGE ID FILLER            40700002
         DC    X'00'                       MESSAGE TYPE FLAG            40800002
TM02     DC    C'CHANGE OPTIONS IF DESIRED'  FIXED MSG TEXT             40900002
*                                                                       41000001
         DC    AL1(L'TM03-1)                                            41100001
         DC    C'151I'                                                  41200001
         DC    X'20'                                                    41300001
TM03     DC    C'DELETE REQUEST INCONSISTENT-'                          41400001
*                                                                       41500001
         DC    AL1(L'TM04-1)                                            41600001
         DC    C'156I'                                                  41700001
         DC    X'D0'                                                    41800001
TM04     DC    C'INVALID OPERAND -'                                     41900001
*                                                                       42000001
         DC    AL1(L'TM05-1)                                            42100001
         DC    C'158I'                                                  42200001
         DC    X'20'                                                    42300001
TM05     DC    C'K REQUEST INCONSISTENT-'                               42400001
*                                                                       42500001
         DC    AL1(L'TM08-1)                                            43600001
         DC    C'345I'                                                  43700001
         DC    X'80'                                                    43800001
TM08     DC    C'AUTHORITY INVALID'                                     43900001
*                                                                       44000001
         DC    AL1(L'TM09-1)                                            44100001
         DC    C'921I'                                                  44200001
         DC    X'E0'                                                    44300001
TM09     DC    C'REJECTED '                                             44400001
*                                                                       44500001
         DC    AL1(L'TM10-1)                                            44600001
         DC    C'924I'                                                  44700001
         DC    X'20'                                                    44800001
TM10     DC    C'INVALID AREA DEFINITION '                              44900001
*                                                                       45000001
         DC    AL1(L'TM11-1)                                            45100001
         DC    C'925I'                                                  45200001
         DC    X'E0'                                                    45300001
TM11     DC    C'OPERAND '                                              45400001
*                                                                       45500001
         DC    AL1(L'TM12-1)                                            45600001
         DC    C'926I'                                                  45700001
         DC    X'20'                                                    45800001
TM12     DC    C'L=CCA OPERAND INVALID-'                                45900001
*                                                                       46000001
         DC    AL1(L'TM13-1)                                            46100001
         DC    C'927I'                                                  46200001
         DC    X'A0'                                                    46300001
TM13     DC    C'REQUEST AMBIGUOUS-'                                    46400001
*                                                                       46500001
         DC    AL1(L'TM14-1)                                            46600001
         DC    C'931I'                                                  46700001
         DC    X'C0'                                                    46800001
TM14     DC    C'INSUFFICIENT STORAGE FOR COMMAND'                      46900001
*                                                                       47000001
         EJECT                                                          47050001
*********************************************************************** 47060002
*                                                                     * 47100002
*                             CONSTANTS                               * 47150002
*                                                                     * 47200002
*********************************************************************** 47250002
         SPACE                                                          47300002
VCON5903 DC    V(IEE5903D)         SECOND LOAD OF MSG MODULE     Y02669 47400002
VCON0503 DC    V(IEE0503D)         MESSAGE MODULE TO ISSUE '328I'Y02669 47450002
ENCANCEL DC    C'*ENTER**CANCEL*'  ADDED FOR CRT WITH CURSOR     Y02669 47500002
MSGID    DC    C'IEE'              MESSAGE ID                    Y02669 47600002
DRCODES  DC    X'0800'             DESCRIPTOR CODE                      47700001
         DC    X'0000'             ROUTING CODE                         47800001
         SPACE 5                                                        47810002
*********************************************************************** 47850002
*                                                                     * 47860002
*                             PATCH AREA                              * 47870002
*                                                                     * 47880002
*********************************************************************** 47890002
         SPACE 2                                                        47892002
PATCH    DC    C'****PATCH AREA****'                                    47900001
PATCH2   DC    C'IEE5603D-TEST ONLY'                                    48000001
PATCH3   DC    36C' '                                                   48100001
         EJECT                                                          48200101
         IEETDCM                                                 Y01012 48400101
         EJECT                                                          48500001
         IEERDCM                                                        48550002
         EJECT                                                          48600002
         IEECUCM  FORMAT=NEW                                            48700002
         EJECT                                                          48800001
DXSA     DSECT                                                          48900001
         IEEXSA                                                         49000001
         EJECT                                                          49900001
DCVT     DSECT                                                          50000001
         CVT                                                            50100001
         EJECT                                                          50150002
         IHAPSA                                                         50160002
         END                                                            50200001
