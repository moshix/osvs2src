 TITLE 'IEE5703D - VARY HARDCPY,OFF AND HARDCPY MESSAGE ROUTINE'        01061503
IEE5703D CSECT                                                          01061602
*********************************************************************** 01061802
*                                                                       01063002
* MODULE NAME      = IEE5703D                                           01065002
*    CSECT NAME    = IEE5703D                                           01067002
*                                                                       01069002
* LOAD MODULE NAME = IGC0003D                                           01069402
*                                                                       01079402
* DESCRIPTIVE NAME = VARY HARDCPY,OFF  PROCESSOR                        01089402
*                    AND                                                01089802
*                    HARDCPY MESSAGE ROUTER                             01090202
*                                                                       01090602
* COPYRIGHT        = MISSING                                            01091002
*                                                                       01094302
* STATUS           = OS/VS/2 RELEASE 3                         @Z30LPTJ 01096303
*                                                                       01096702
* FUNCTION         = 1. THIS MODULE TAKES THE HARDCPY FUNCTION OUT      01097102
*                    OF A SYSTEM WHEN THE OPERATOR REQUESTS IT.         01097502
*                    IT IS THE RESPONDER TO THE HARDCPY,OFF COMMAND.    01097602
*                    2. IF AN ERROR CONDITION HAS BEEN DETECTED IN      01097702
*                    THE HARDCPY PROCESSOR OR IN THIS MODULE,           01098802
*                    THIS ROUTINE GIVES CONTROL TO THE APPROPRIATE      01100802
*                    ERROR MESSAGE MODULE AND PASSES IT THE CORRECT     01100902
*                    ERROR CODE.                                        01116602
*                                                                       01126602
* OPERATION        = THIS ROUTINE CHECKS THE CODE PASSED TO IT IN       01128602
*                    THE XAE AND EITHER PROCESSES THE COMMAND OR        01130602
*                    SETS UP TO GO TO AN ERROR MESSAGE MODULE.          01131002
*                    IN PROCESSING THE COMMAND, IT CHECKS THAT          01131402
*                    THE SYSTEM DOES NOT REQUIRE HARDCPY, VALIDATES     01131802
*                    THAT THE UNIT SPECIFIED IN THE COMMAND IS THE      01132202
*                    CURRENT HARDCPY LOG.  IF NO UNIT WAS SPECIFIED     01132302
*                    THAN IT VALIDATES THE PRESENCE OF A HARDCPY        01132402
*                    DEVICE.                                            01137602
*                    IF ALL IS CORRECT, THIS ROUTINE SETS THE           01139602
*                    APPROPRIATE INFORMATION INDICATING THAT NO         01141602
*                    HARDCPY EXISTS AND GOES TO IEE2103D TO ISSUE       01142002
*                    A MESSAGE TO THE REQUESTING CONSOLE INFORMING      01142402
*                    THE OPERATOR THAT HIS COMMAND WAS ACCEPTED         01142802
*                    AND PROCESSED                                      01142902
*                                                                       01148102
* NOTES                                                                 01150102
*    DEPENDENCIES  = NONE                                               01152102
*   CHARACTER/CODE DEPENDENCIES                                         01152502
*                  = THIS MODULE CAN BE ASSEMBLED WITH ANY NEW          01152902
*                    CHARACTER/CODE SET.                                01153302
*                                                                       01153402
* RESTRICTIONS     = REG2 PTS TO THE XSA ON INPUT AND ON OUTPUT         01158602
*   REGISTER CONVENTIONS                                                01160602
*                  = REGISTERS ARE DEFINES AT LABEL: DEFREG             01162602
*   PATCH LABEL    = PATCH                                              01163002
*                                                                       01163402
* MODULE TYPE      = CSECT                                              01163802
*   PROCESSOR      = ASSEMBLER                                          01163902
*   MODULE SIZE    = VS/2 = '2BE'                              @Z30LPTJ 01169103
*   ATTRIBUTES     = REENTRANT, REUSABLE, REFRESHABLE, PAGED LPA,       01171102
*                    ZERO PSW PROTECT KEY, SUPERVISOR MODE              01173102
*                                                                       01173502
* ENTRY POINT      = IEE5703D FROM IEE4703D                             01173902
*   PURPOSE        = TO PROCESS THE HARDCPY,OFF COMMAND (FROM 4703D)    01174302
*                    OR TO ROUTE MSG TO IEE0503D OR IEE2103D FOR        01174402
*                    ERROR IN THE V HARDCPY COMMAND (FROM 47 AND 72)    01176102
*   LINKAGE        = BRANCH                                             01178102
*   INPUT          = IF CONTROL IS FROM IEE4703D FOR A                  01178502
*                    V HARDCPY,OFF COMMAND:                             01178902
*                       R2 PTS TO THE XSA                               01179302
*                       XAE = X'00'                                     01179402
*                    IF CONTROL IS FROM 4703D FOR ERROR IN THE          01179502
*                    V HARDCPY COMMAND:                                 01184002
*                       R2 PTR TO THE XSA                               01186002
*                       XAE = X'20' = GOTO 0503D -                      01188002
*                            MSG = UNIDENTIFIABLE KEYWORD               01188402
*                       XAE = X'24' - GOTO 2103D                        01188902
*                            MSG = AUTHORITY INVALID                    01189302
*                       XAE = X'28' - GOTO 0503D                        01189702
*                            MSG = INVALID NUMERICS                     01189802
*                    IF CONTROL IS FROM 7203D FOR ERROR CONDT.          01189902
*                       R2 PTS TO THE XSA                               01190002
*                       XAE = X'12' - GOTO 0503D                        01191302
*                            MSG = UNIT REF INVALID                     01193302
*                       XAE = X'16' - GOTO 0503D                        01193702
*                            MSG = SYSLOG NOT SUPPORTED                 01193802
*                       XAE = X'20' - GOTO 0503D                        01193902
*                            MSG = UNIDENTIFIABLE KEYWORD               01208502
*                       XAE = X'28' - GOTO 0503D                        01218502
*                            MSG = INVALID NUMERICS                     01220502
*   REGISTERS SAVED= NONE                                               01222502
*   REGISTER USAGE = R2 - PTR TO XSA                                    01222902
*                    R3 - ADDRESSABILITY                                01223302
*                    R4 - UCME PTR                                      01228202
*                    R7 - EOB PTR                                       01230202
*                    R9 - UNIT PTR                                      01232202
*                    R10 - UCM REG                                      01232602
*                    R11 - UCMPRFX PTR                                  01233002
*                    R14 - RETURN ADDRESS                               01237902
*   REGISTERS RESTORED                                                  01239902
*                  = NONE                                               01241902
*                                                                       01242302
* EXIT - NORMAL    = TO IEE2103D VIA BRANCH                             01242702
*   CONDITIONS     = HARDCPY,OFF COMMAND WAS SUCCESSFUL                 01247602
*                    INFORMATIONAL MESSAGE HAS TO BE SENT TO            01249602
*                    THE OPERATOR                                       01251602
*   OUTPUT         = REG2 PTR TO THE XSA                                01252002
*                    XAE = X'2A' FOR MESSAGE:                           01252402
*                       INACTIVE AS HARDCOPY                            01252502
*                    XAV HAS 'UNIT' NAME OR SYSLOG (WHATEVER            01257302
*                    WAS THE HARDCPY DEVICE)                            01259302
*   RETURN CODES   = NONE                                               01261302
*                                                                       01261702
* EXIT - ERROR     = TO IEE2103D OR IEE0503D VIA BRANCH                 01262102
*   CONDITIONS     = ERROR HAS BEEN DETECTED EITHER IN THE              01262502
*                    V HARDCPY,OFF OR THE V HARDCPY COMMANDS            01264002
*   OUTPUT         = REG2 PTR TO THE XSA                                01266002
*                    XAE = X'2D' - MSG: 'REQ'D FOR HARDCPY' MOD=2103D   01266402
*                    XAE = X'2C' - MSG: 'CHANGING STATUS  ' MOD=2103D   01266802
*                    XAE = X'1A' - MSG: 'SYSLOG NOT SUPPORTED'          01266902
*                                                           MOD=2103D   01267002
*                    XAE = X'29' - MSG: 'AUTHORITY INVALID' MOD=2103D   01267102
*                    XAE = X'09' - MSG: 'UNIDENTIFIABLE KEYWORD'        01271202
*                                                           MOD=0503D   01273202
*                    XAE = X'06' - MSG: 'INVALID NUMERICS'  MOD=0503D   01275202
*                    XAE = X'0D' - MSG: 'UNIT REF INVALID'  MOD=0503D   01275602
*   RETURN CODES   = NONE                                               01275702
*                                                                       01275802
* EXTERNAL REFERENCES                                                   01276202
*   ROUTINES       = IEE2103D                                           01276602
*                    IEE0503D                                           01276702
*   DATA AREAS     = SEE EXITS - OUTPUT                                 01276802
*                                                                       01276902
* CONTROL BLOCKS   = 1. EXTENDED SAVE AREA (XSA)                        01278102
*                    2. UNIT CONTROL MODULE (UCM)                       01280102
*                       FIELDS TESTED  - UCMATR- BIT=UCMUF              01280502
*                                                    UCMOF              01284302
*                                        UCMDISP-BIT=UCMDISPB           01286302
*                                                    UCMDISPC           01286702
*                                        UCMHCUCM                       01287102
*                                        UCMSFLGS-BIT=UCMSYSG           01287502
*                                        UCMUCB                         01287902
*                                        UCMVEA                         01288002
*                       FIELDS UPDATED - UCMDISP - BIT=UCMDISPB         01288102
*                                        UCMHCUCM                       01289102
*                                        UCMSFLGS- BIT=UCMSYSB          01291102
*                                                      UCMSYSG          01291202
*                    3. UNIT CONTROL BLOCK (UCB)                        01291402
*                       FIELDS TESTED  - SRTESTAT - BIT=SRTEDADI        01291802
*                                        UCBNAME                        01291902
*                       FIELDS UPDATED - NONE                           01292802
*                    4. CVT                                             01293202
*                       FIELDS TESTED  - CVTCUCB                        01293602
*                       FIELDS UPDATED - NONE                           01294002
*                                                                       01294402
* TABLES           = NONE                                               01294502
*                                                                       01294802
* MACROS           = SETLOCK                                            01295202
*                                                                       01301802
* MAPPING MACROS   = IEEXSA                                             01305002
*                    IEECUCM                                            01308202
*                    IEFUCBOB                                           01320202
*                    CVT                                                01320602
*                    IHAPSA                                             01320702
*   SERIALIZATION  = THE CMS AND LOCAL LOCKS WILL PROTECT THE           01321002
*                    UCB AND UCM IN THIS MODULE FOR THE VARY HARDCPY    01322302
*                    AND THE VARY HARDCPY,OFF COMANDS                   01324302
*                    THE LOCKS ARE OBTAINED AT:                         01326302
*                       HSETLCK                                         01326702
*                    AND THEY ARE RELEASED AT:                          01327102
*                       HUNSTLK                                         01327502
*                    THE FOLLOWING AREAS MUST BE PROTECTED:             01327602
*                       UCMDISP   BIT= UCMSYSB         UCM              01327702
*                       UCMSFLGS  BIT= UCMSYSB         UCM              01328102
*                                      UCMSYSG                          01328502
*                       UCMHCUCM                                        01328902
*                       UCMATR    BIT= UCMUF           UCM              01329002
*                                                                       01329102
*                       SRTESTAT  BIT= SRTEDADI        UCB              01329202
*                    NO LOCKS ARE REQUIRED FOR THIS MODULE'S            01329302
*                    MESSAGE ROUTINE FUNCTION.                          01329402
*                                                                       01329602
* CHANGE LEVEL     = Y02669, Y02651, Z30LPTJ                   @Z30LPTJ 01329703
*                                                                       01330402
* CHANGE ACTIVITY  = N/A                                                01331702
*                                                                       01333002
* MESSAGES         = IEE345I VARY AUTHORITY INVALID                     01334302
*                       THE MASTER CONSOLE DID NOT ISSUE THIS COMMAND   01335602
*                    IEE026I SYSLOG NOT SUPPORTED                       01336902
*                       SYSLOG WAS SPECIFIED IN THE COMMAND BUT         01338202
*                       SYSLOG IS NOT SUPPORTED                         01339502
*                    IEE313I UNIT REF INVALID                           01340802
*                       THIS MESSAGE IS WRITTEN WHENEVER AN INCORRECT   01342102
*                       UNIT IS GIVEN OR NO UNIT IS GIVEN BUT NO        01343402
*                       HARDCPY EXISTS.                                 01344702
*                    IEE309I UNIDENTIFIABLE KEYWORD                     01346002
*                       A KEYWORD WAS SPECIFIED IN THE COMMAND, BUT     01347302
*                       IT DOES NOT MATCH SYNTACTICALLY TO ANY          01348602
*                       ALLOWED KEYWORD                                 01349902
*                    IEE338I INACTIVE AS HARDCPY                        01351202
*                       THIS MESSAGE IS ISSUED UPON PROCESSING OF A     01352502
*                       VALID HARDCPY,OFF COMMAND.                      01353802
*                    IEE339I CHANGING STATUS                            01355102
*                       A VARY HARDCPY COMMAND WAS ISSUED FOR A         01356402
*                       DEVICE WHICH IS IN THE PROCESS OF CHANGING      01357702
*                       TO A CONSOLE OR FROM THE CONSOLE STATE.         01359002
*                    IEE299I REQ'D FOR HARDCPY                          01360302
*                       A VARY HARDCPY,OFF WAS ISSUED HOWEVER, THE      01361602
*                       HARDCPY DEVICE IS NEEDED BECAUSE EITHER         01362902
*                       MORE THAN ONE ACTIVE CONSOLE IS PRESENT ON      01364202
*                       THE SYSTEM, OF AT LEAST ONE (OR MORE) ACTIVE    01365502
*                       GRAPHIC CONSOLES ARE PRESENT.                   01366802
*                    IEE306I VARY INVALID NUMERICS                      01368102
*                       MSG COMES OUT WHEN AN INVALID ROUTCODE WAS      01369402
*                       TO BE ASSIGNED TO THE HARDCPY DEVICE.           01370702
*                                                                       01372002
* ABEND CODES      = NONE                                               01373302
*                                                                       01374602
* PACKAGING        = IEE5703D WILL BE PART OF LOAD MODULE               01375902
*                       = IGC0003D                                      01377202
*                    THIS LOAD MODULE ALIASES ARE                       01378502
*                       = NONE                                          01379802
*                    THIS LOAD MODULE ENTRY POINTS ARE                  01381102
*                       = IGC0003D                                      01382402
*                    MODULE WILL RESIDE IN : LPALIB                     01383702
*                                                                       01385002
* SYSGEN           = SUPPLIED BY SECTIONS:                              01386302
*                    PACKAGING                                          01387602
*                    LOAD MODULE NAME                                   01388902
*                    THIS CSECT WILL BE INCLUDED AT SYSGEN FROM         01389302
*                    DLIB -AOSB3- BY MACRO -SGIEF441-                   01389702
*                                                                       01390202
* SYSTEM LIBRARIES = NONE                                               01391502
*                                                                       01392802
*********************************************************************** 01394102
         EJECT                                                          01395402
*                                                                       01396702
*   REGISTER EQUATES                                                    01398002
*                                                                       01399302
DEFREG   EQU   *                                                 Y02669 01400602
R0       EQU   0                                                        01401902
R1       EQU   1                                                        01403202
R2       EQU   2                   XSA                                  01404502
R3       EQU   3                   ADDRESS                              01405802
R4       EQU   4                   UCME                           19784 01407102
R5       EQU   5                                                  19784 01408402
R6       EQU   6                                                  19784 01409702
R7       EQU   7                   EOB REG                        19784 01411019
R8       EQU   8                                                  19784 01511002
R9       EQU   9                   UNIT PTR                       19784 01611019
R10      EQU   10                  UCM REG                        19784 01711019
R11      EQU   11                  UCMPFX REG                     19784 01811019
R12      EQU   12                                                 19784 01911019
R13      EQU   13                                                 19784 02011019
R14      EQU   14                  RET ADDR                       19784 02111019
R15      EQU   15                                                 19784 02211019
         SPACE 10                                                       04200019
*********************************************************************** 04400019
*                                                                 19784 04600019
*        EQUATES                                                  19784 04800019
*                                                                 19784 05000019
*********************************************************************** 05200019
*                                                                 19784 05400019
ZERO     EQU   0                                                  19784 05600019
ONE      EQU   1                                                  19784 05800019
TWO      EQU   2                                                  19784 06000019
TRE      EQU   3                                                  19784 06200019
FOR      EQU   4                                                  19784 06400019
SIX      EQU   6                                                  19784 06600019
EIT      EQU   8                                                  19784 06800019
TWLV     EQU   12                                                 19784 07200019
FIFTN    EQU   15                                                 19784 07400019
*                                                                 19784 07600019
*                                                                 19784 07800019
REQCD    EQU   8                                                  19784 08000019
UREFCD   EQU   12                                                 19784 08200019
KEYCD    EQU   20                                                 19784 08400019
NUM6     EQU   6                                                  19784 08500019
*                                                                 19784 08600019
CD9      EQU   9                                                  19784 08800019
CD13     EQU   13                                                 19784 09000019
CD26     EQU   26                                                 19784 09200019
CD41     EQU   41                                                 19784 09400019
CD44     EQU   44                                                 19784 09600019
CD45     EQU   45                                                 19784 09800019
*                                                                 19784 10000019
*                                                                 19784 10400019
*                                                                 19784 10600019
BLANK    EQU   C' '                                               19784 10800019
*                                                                 19784 11000019
MSG42    EQU   42                                                 19784 11600019
*                                                                 19784 11800019
FOX      EQU   255                                                19784 12400019
*                                                                 19784 12600019
         EJECT                                                          13000019
*********************************************************************** 13200019
*                                                                 19784 13400019
*        HARDCPY,OFF PROCESSOR                                    19784 13600019
*                                                                 19784 13800019
*********************************************************************** 14000019
*                                                                 19784 14200019
*                                                                 19784 14400019
         BALR  R3,ZERO                                            19784 14600019
         USING *,R3                                               19784 14800019
         MODID BR=YES                                            Y01886 14850001
         USING XSA,R2                                             19784 15000019
         L     R5,XAL              GET PTR TO UNIT BEGIN          19784 15200019
         LA    R5,ZERO(R5)                                        19784 15400019
         L     R10,CVTPTR                                         19784 15600019
         USING OCVT,R10                                           19784 15800019
         L     R10,CVTCUCB         GET PTR TO UCM                 19784 16000019
         DROP  R10                                                19784 16200019
        USING UCM,R10                                            Y02669 16400002
*                                                                 19784 16600019
         LR    R11,R10             PTR TO UCM                     19784 16800019
         SH    R11,FOUR             MINUS 4                       19784 17000019
         L     R11,ZERO(R11)       UCMPFX PTR                     19784 17200019
         USING UCMPRFX,R11                                        19784 17400019
         SPACE 10                                                 19784 17600019
*                                                                 19784 17800019
OTABLE   EQU   *                                                  19784 18000019
         SR    R4,R4                                              19784 18200019
         IC    R4,XAE              INSERT CODE FOR WORK BRANCH    19784 18400019
         BC    FIFTN,BRANCH(R4)    GO TO APPROPRIATE WORK         19784 18600019
*                                                                 19784 18800019
*                                                                 19784 19000019
BRANCH   EQU   *                                                  19784 19200019
         B     OSCAN               GO TO PROCESS HARDCPY,OFF      19784 19400019
         B     MSGCHG              GO PUT CHANGING STATUS MSG     19784 19600019
         B     REQHCPY             GO PUT REQ'D FOR HARDCPY MSG   19784 19800019
         B     UTREFINV            XAE 12-UNIT REF INVALID        19784 20000019
         B     NOTSUPP             XAE 16-SYSLOG NOT SUPPORTED    19784 20200019
         B     KEYWORD             XAE 20-KEYWORD MISSPELLED      19784 20400019
         B     AUTHINV             XAE 24- AUTHORITY INVALID      19784 20600019
         B     INVNUM              XAE IS 28 INVALID NUMERICS    Y02669 20700002
*                                                                 19784 20800019
         EJECT                                                    19784 21000019
*                                                                 19784 21200019
OSCAN    EQU   *                                                  19784 21400019
         LR    R12,R5              SAVE UNIT PTR FOR MSG          19784 21800019
OLOOP    EQU   *                                                  19784 22000019
         CLC   ZERO(TWO,R5),HUNIT      ,H FOLLOWS                 19784 22200019
         BE    OFOUND              YES, FOUND IT                  19784 22400019
         LA    R5,ONE(R5)          INDEX BY ONE MORE              19784 22600019
         B     OLOOP                GO CHECK NEXT CHARACTER       19784 22800019
OFOUND   EQU   *                                                  19784 23000019
         LA    R5,TWLV(R5)         INDEX PAST COMD                19784 23200019
         L     R4,XAR              PTR TO PARAMS                  19784 23400019
         LA    R4,ZERO(R4)         CLEAR HIGH ORDER BYTE          19784 23600019
         AH    R4,ZERO(R4)         GET END OF BUFFER ADDRESS      19784 23800019
         CR    R5,R4               IS THIS END OF BUFFER          19784 24000019
         BH    OINVALID            NO,HIGHER,KEYWORD MISSPELLED   19784 24200019
         BE    OCONT               OK, GO PROCESS CMD             19784 24400019
         CLI   ZERO(R5),BLANK      DOES A BLANK FOLLOE COMD       19784 24600019
         BNE   OINVALID            NO,  KEYWORD MISSPELLED        19784 24800019
OCONT    EQU   *                                                  19784 25000019
         LR    R5,R12              RESTORE PTR TO UNIT FIELD      19784 25200019
          EJECT                                                         25250002
***************************************************              Y02651 25300002
*                                                                Y02651 25310002
*  LOCKS ARE REQUIRED AT THIS POINT AND THEY ARE OBTAINED AT:    Y02651 25320002
*              HSETLCK                                           Y02651 25330002
*  THESE LOCKS WILL BE RELEASED AT:                              Y02651 25340002
*              HUNSTLK                                           Y02651 25342002
*                                                                Y02651 25344002
HSETLCK  EQU   *                                                 Y02651 25346002
         STM   R11,R14,XASAVLOC                                  Y02651 25346402
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02651*25348002
               RELATED=(IEE5703D(HUNSTLK))                       Y02651 25348402
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02651*25348802
               RELATED=(IEE5703D(HUNSTLK))                       Y02651 25349202
         LM    R11,R14,XASAVLOC                                  Y02651 25349302
*                                                                Y02651 25349602
***************************************************              Y02651 25350002
          SPACE 10                                                      25360002
         CLC   ZERO(TWO,R5),HUNIT     UNIT WAS SPECIFIED          19784 25400019
         BE    HOFFNUNT            NO, GO VARY OFF PRESENTHARDCPY 19784 25600019
*                                                                 19784 25800019
         SPACE 10                                                       26000019
*********************************************************************** 26200019
*                                                                 19784 26400019
*    UNIT WAS SPECIFIED                                           19784 26600019
*                                                                 19784 26800019
*********************************************************************** 27000019
HOFFUNIT EQU   *                                                  19784 27200019
         CLC   ZERO(EIT,R12),HSYSLOG  WAS SYSLOG SPECIFIED        19784 27400019
         BE    HOFFSYLG            YES,GO CHECK IF IT IS HCPY     19784 27600019
*                                                                 19784 27800019
HUNITS   EQU   *                                                  19784 28000019
         LM    R5,R7,UCMVEA       PTR TO 1ST AND LAST UCMES       19784 28200019
         USING UCMLIST,R5                                         19784 28400019
HLOOPOFF EQU   *                                                  19784 28600019
         L     R4,UCMUCB           PTR TO UCB                     19784 28800019
         USING OUCB,R4                                            19784 29000019
         CLC   ZERO(TRE,R12),UCBNAME      IS THE SOUGHT UCME      19784 29200019
         BE    HFNDOFF             YES,BINGO                      19784 29400019
         BXLE  R5,R6,HLOOPOFF      NO, KEEP LOOKING               19784 29600019
         SPACE 5                                                        29650002
***************************************************              Y02651 29700002
*                                                                Y02651 29750002
*  SINCE THE ABOVE DEFAULTS INTO AN ERROR EXIT, WE MUST RELEASE  Y02651 29760002
*  ALL LOCKS FIRST                                               Y02651 29770002
         B     HOFFLCK             SORRY,NO MATCH                Y02651 29800002
*                                                                Y02651 29810002
***************************************************              Y02651 29850002
         SPACE 5                                                        29900002
HFNDOFF  EQU   *                                                  19784 30000019
       TM    UCMDISP,UCMDISPB    IS IT REALLY HCPY                19784 30200019
         SPACE 5                                                        30250002
***************************************************              Y02651 30300002
*                                                                Y02651 30310002
*  SINCE THE ABOVE DEFAULTS INTO AN ERROR EXIT, WE MUST RELEASE  Y02651 30320002
*  ALL LOCKS FIRST                                               Y02651 30330002
         BZ    HOFFLCK                                           Y02651 30340002
***************************************************              Y02651 30350002
         SPACE 5                                                        30360002
         DROP  R5                                                 19784 30600019
         LR    R9,R5                                              19784 30800019
         B     HOFF                YES,GO PROCESS                 19784 31000019
*                                                                 19784 31200019
HOFFSYLG EQU   *                                                  19784 31400019
         SR    R12,R12                                            19784 31500019
         TM    UCMSFLGS,UCMSYSG    IS SYSLOG REALLY HCPY          19784 31600019
         BO    HOFFNUNT            YES,GO PROCESS                 19784 31800019
         EJECT                                                          31850002
*****************************************************************Y02651 31900002
*                                                                Y02651 31950002
*  SINCE THIS IS AN ERROR CONDITION, MUST RELEASE LOCKS FIRST    Y02651 31952002
*                                                                Y02651 31954002
HOFFLCK  EQU   *                                                 Y02651 31956002
         BAL   R4,HUNSTLK         GO TO RELEASE LOCKS SUBROUTINE Y02651 31958002
*                                                                Y02651 31958402
*****************************************************************Y02651 31960002
         SPACE 5                                                        31970002
         B    HERR2               NO, SORRY                       19784 32000019
         EJECT                                                          32200019
*********************************************************************** 32400019
*                                                                 19784 32600019
*        THIS ROUTINE PROCESSED THE HARDCPY OFF COMMAND           19784 32800019
*                                                                 19784 33000019
*                  R5 PTR TO ,H OR UNIT,H                         19784 33200019
*                  R11 HAS PTR TO THE UCMPFX                      19784 33400019
*                  R10 HAS PTR TO THE UCM                         19784 33600019
*                                                                 19784 33800019
*********************************************************************** 34000019
HOFFNUNT EQU   *                   UNIT WAS NOT SPECIFIED IN CMD  19784 34200019
         SR    R12,R12             ZERO UNIT PTR IN CASE OF SYSLOG19784 34400019
         SR    R9,R9               ZERO UCME REG IN CASE OF SYSLOG19784 34600019
         TM    UCMSFLGS,UCMSYSG    IS SYSLOG HARDCPY              19784 34800019
         BO    HOFF                YES,GO PROC%SS                 19784 35000019
         LR    R12,R5                                             19784 35100019
         L     R9,UCMHCUCM         GET PTR TO UCME OF CURRENT HCPY19784 35200019
         LA    R9,ZERO(R9)         CLEAR HIGH ORDER BYTE          19784 35400019
         LTR   R9,R9               ANY PTR                        19784 35600019
         SPACE 5                                                        35650002
*****************************************************************Y02651 35660002
*                                                                Y02651 35662002
*  MUST GO RELEASE ALL LOCKS FIRST                               Y02651 35664002
*                                                                Y02651 35666002
         BZ    HOFFLCK                                           Y02651 35668002
*                                                                Y02651 35668402
*****************************************************************Y02651 35678402
         SPACE 5                                                        35700002
         USING UCMLIST,R9          REG9 PTR TO UCME OF HCPY DEV   19784 36000019
         L     R4,UCMUCB           PTR TO UCM                     19784 36200019
         USING OUCB,R4                                            19784 36400019
         LA    R12,UCBNAME         PTR TO NAME OF DEV IN UCB FOR MG     36600019
         DROP  R4                  MESSAGE                        19784 36800019
         DROP  R9                                                 19784 37000019
HOFF     EQU   *                                                  19784 37200019
*                                                                 19784 37400019
*   CHECK WHETHER CMD CAN BE ACCEPTED AND PROCESS ACCORDINGLY     19784 37600019
*                                                                 19784 37800019
*                   THIS RTN EXPECTS                              19784 38000019
*                                                                 19784 38200019
*                           R11 IS PTR TO UCMPFX                  19784 38400019
*                           R10 IS PTR TO UCM                     19784 38600019
*                             R9 IS PTR TO UCME OF HCPY DEV OR ZERO FOR 38800019
*                             SYSLOG                              19784 39000019
*                           R12 PTS TO UNITNAME OF IS ZERO FOR SYSLOG   39200019
*                                                                 19784 39400019
*                                                                 19784 39600019
         LM    R5,R7,UCMVEA        PTRS TO FIRST AND LAST UCMES   19784 39800019
         USING UCMLIST,R5                                         19784 40000019
         SR    R4,R4               SERO OUT ACTV CONSOLE SWITCH   19784 40200019
         SR    R13,R13             ZERO OUT GFX CONSOLE SWITCH    19784 40400019
HACTVCK  EQU   *                   CHECK FOR NO OF ACTV CONSOLES  19784 40600019
         L     R15,UCMUCB                                         19784 40800019
         USING OUCB,R15                                           19784 41000019
         TM    UCMATR,UCMUF        IS THE ACTIVE BIT ON IN UCME   19784 41200019
         BZ    HNOACTV             NO, CHECK IF CHANGING TO ACTIVE19784 41400019
         TM    SRTESTAT,SRTEDADI   ACTIVE,IS IT PENDING TO CHANGE 19784 41600019
         BO    HBXLE               YES, CHANGING TO NONACTIVE,OMIT19784 41800019
         B     HPLUS1              NOT CHANGING, COUNT IT IN      19784 42000019
*                                                                 19784 42200019
HNOACTV  EQU   *                                                  19784 42400019
         TM    SRTESTAT,SRTEDADI   CHANGING STATUS                19784 42600019
         BZ    HBXLE               NO OMIT                        19784 42800019
HPLUS1   EQU   *                                                  19784 43000019
         TM    UCMATR,UCMOF        WTO SUPPORT                    19784 43200019
         BZ    HBXLE               NO, I-UNIT, OMIT               19784 43400019
         LA    R4,ONE(R4)          PLUS 1 ACTV CONSOLES           19784 43800019
         TM    UCMDISP,UCMDISPC    IS CONSOLE GFX                 19784 44200019
         BO    HPLUS2              YES,TWO STRIKES                19784 44400019
HBXLE    BXLE  R5,R6,HACTVCK       CONTINUE                       19784 44600019
*                                  SORRY,RAN OUT OF UCMES         19784 44800019
         DROP  R15                                                19784 45000019
         BCTR  R4,ZERO             DECREASE ACTIVE CONSOLE SWITCH 19784 45200019
         LTR   R4,R4               IF ZERO MEANS ONLY ONE ACTIVE  19784 45400019
         BNZ   HERR1               NORE THAN 1,BYE TO CMD         19784 45600019
         LTR   R13,R13             IS THERE ONE GFX CONSOLE ACTIVE19784 45800019
         BNZ   HERR1               YES,BYE TO CMD                 19784 46000019
         DROP  R5                                                 19784 46200019
         USING UCMLIST,R9          ALL OK,CAN ACCEPT CMD          19784 46400019
         XC    UCMHCUCM(FOR),UCMHCUCM   ZERO OUT HCPY PTR IN PRFX 19784 46600019
         NI    UCMSFLGS,FOX-UCMSYSB-UCMSYSG    TURN OFF HARDCPY EXISTS  46800019
*                                  ON SYSTEM FLAG - X'40' AND     19784 47000019
*                                  POSSIBLE HARDCPY IS SYSLOG - X'02'   47200019
         LTR   R9,R9               WAS IT FOR SYSLOG              19784 47400019
         BZ    HOFFMSG             YES,GO TO ISSUE  MSG           19784 47600019
         NI    UCMDISP,FOX-UCMDISPB    TURN OFF HCPY FLAG IN UCM  19784 47800019
*                                                                 19784 48000019
         EJECT                                                          48050002
HOFFMSG  EQU   *                                                  19784 48200019
         SPACE 10                                                       48250002
***************************************************              Y02651 48300002
*                                                                Y02651 48310002
*  COMMAND HAS ENDED AND NOW BEFORE EXITING WE MUST RELEASE      Y02651 48320002
*  ALL LOCKS AT HUNSTLK                                          Y02651 48330002
*  LOCKS WERE GOTTEN AT:                                         Y02651 48340002
*    HSETLCK                                                     Y02651 48342002
*                                                                Y02651 48344002
         BAL   R4,HUNSTLK                                        Y02651 48346002
*                                                                Y02651 48348002
***************************************************              Y02651 48350002
         SPACE 10                                                       48360002
*          R12 IS ZERO IF FOR SYSLOG OR PTR TO UNIT NAME          19784 48400019
         MVI   XAE,MSG42            MSG CODE IS 42,MSG IS ---     19784 48600019
*                                  INACTIVE AS HARDCPY            19784 48800019
*                                  MSG MODULE IS 2103D            19784 49000019
HSYLOG   EQU   *                                                  19784 49200019
         MVC   XAV(TRE),ZERO(R12)  ASSUME REG 7 PTS TO UNIT       19784 49400019
         MVI   XAV+TRE,BLANK       NOVE IN BLANK PAST UNIT        19784 49600019
         MVC   XAV+FOR(FOR),XAV+TRE  BLANK REST OF AREA           19784 49800019
         LTR   R12,R12             WAS SYSLOG SPECIFIED           19784 50000019
         BNZ   HERREXIT            NO, UNIT ALREADY IS IN         19784 50200019
         MVC   XAV(SIX),HSYSLOG        YES, MOVE IN SYSLOG        19784 50400019
HERREXIT EQU   *                                                  19784 50600019
         MVC   XAX+TRE(TWO),MSG2103        MSG MODULE IS 2103D   Y02669 50800002
         L     R15,VCON21                                        Y02669 50850002
         BR    R15                                               Y02669 51000002
*                                                                 19784 51200019
HPLUS2   EQU   *                                                  19784 51400019
         LA    R13,ONE(R13)        PLUS 1 GFX CONSOLES            19784 51600019
         B     HBXLE               GO CONTINUE UCME SCAN          19784 51800019
         EJECT                                                          52000019
*********************************************************************** 52200019
*                                                                 19784 52400019
* ERROR MESSAGE ROUTINES                                          19784 52600019
*                                                                 19784 52800019
*********************************************************************** 53000019
*                                                                 19784 53200019
*                                                                 19784 53400019
HERR1    EQU   *                                                  19784 53600019
         SPACE 10                                                       53650002
***************************************************              Y02651 53700002
*                                                                Y02651 53710002
*  THIS IS AN ERROR EXIT AND WE ARE STILL HOLDING SOME LOCKS     Y02651 53720002
*  THESE LOCKS MUST BE RELEASED BEFORE EXITING AT SUBROUTINE:    Y02651 53730002
*              HUNSTLK                                           Y02651 53740002
*  LOCKS WERE OBTAINED AT:                                       Y02651 53742002
*              HSETLCK                                           Y02651 53744002
*                                                                Y02651 53746002
         BAL   R4,HUNSTLK                                        Y02651 53748002
*                                                                Y02651 53748402
***************************************************              Y02651 53750002
         SPACE 10                                                       53760002
         MVI   XAE,REQCD           REQ'D FOR HARDCPY MSG CODE     19784 53800019
         B     OTABLE              GO TO PROCESS IT               19784 54000019
*                                                                 19784 54200019
HERR2    EQU   *                                                  19784 54400019
         MVI   XAE,UREFCD          UNIT REF INVALID               19784 54600019
         B     OTABLE              GO PROCESS                     19784 54800019
*                                                                 19784 55000019
*                                                                 19784 55200019
MSGCHG   EQU   *                                                  19784 55400019
         MVI   XAE,CD44            CHANGING STATUS,2103D          19784 55600019
         B     HSYLOG              GO PROCESS                     19784 55800019
*                                                                 19784 56000019
*                                                                 19784 56200019
REQHCPY  EQU   *                                                  19784 56400019
         MVI   XAE,CD45            REQ'D FOR HCPY,2103D           19784 56600019
         B     HSYLOG              GO PROCESS                     19784 56800019
*                                                                 19784 57000019
*                                                                 19784 57200019
NOTSUPP  EQU   *                                                  19784 57400019
         MVI   XAE,CD26            SYSLOG NOT SUPPORTED,2103D     19784 57600019
         B     HERMOD0             GO XCTL                        19784 57800019
*                                                                 19784 58000019
*                                                                 19784 58200019
AUTHINV  EQU   *                                                  19784 58400019
         MVI   XAE,CD41            AUTHORITY INVALID,2103D        19784 58600019
*                                  NO,UNIT, MSG WILL HAVE 'VARY'  19784 58800019
         B     HERREXIT            GO PROCESS                     19784 59000019
*                                                                 19784 59200019
*                                                                 19784 59400019
KEYWORD  EQU   *                                                  19784 59600019
         MVI   XAE,CD9             KEYWORD MISSPELLED-0503D       19784 59800019
*                                  NO UNIT, MSG WILL HAVE 'VARY'  19784 60000019
         B     HERMOD              GO PROCESS                     19784 60200019
*                                                                 19784 60400019
INVNUM   EQU   *                                                  19784 60440019
         MVI   XAE,NUM6            MOVE IN ERROR CODE             19784 60480019
         MVC   XAV(EIT),HVARY      MOVE IN VARY COMMAND VERB      19784 60520019
         B     HERMOD              XCTL TO 0503D                  19784 60560019
*                                                                 19784 60600019
UTREFINV EQU   *                                                  19784 60800019
         MVI   XAE,CD13            UNIT REF INVALID-0503D         19784 61000019
         MVC   XAV(TRE),ZERO(R12)      MOVE UNIT                  19784 61400019
         MVI   XAV+TRE,BLANK       BLANK OUT REST                 19784 61600019
         CLC   ZERO(TWO,R12),HUNIT     WAS DEVICE SPECIFIED       M0048 61650001
         BNE   UNIT                    YES                        M0048 61700001
         MVC   XAV(EIT),HARDCOPY       MOVE IN HARDCOPY           M0048 61750001
UNIT     LTR   R12,R12                 WAS SYSLOG SPECIFIED       M0048 61800001
         BNZ   HERMOD              NO, OK                         19784 62000019
*                                                                 19784 62200019
HERMOD0  EQU   *                                                  19784 62400019
         MVC   XAV(SIX),HSYSLOG        NO, MOVE IN SYSLOG         19784 62600019
HERMOD   EQU   *                                                  19784 62800019
         MVC   XAX+TRE(TWO),MSG0503        MSG MODULE IS 0503D   Y02669 63000002
         L     R15,VCON05                                        Y02669 63050002
       BR    R15                                                 Y02669 63400002
*                                                                 19784 64600019
OINVALID EQU   *                                                  19784 64800019
         MVI   XAE,KEYCD                                          19784 65000019
         B     OTABLE              GO PROCESS                     19784 65200019
*                                                                 19784 65400019
*                                                                 19784 65600019
         EJECT                                                    19784 65800019
*****************************************************************Y02651 65810002
*                                                                Y02651 65812002
*  THIS IS THE RELEASE-LOCKS SUBROUTINE                          Y02651 65814002
*  ALL LOCKS ARE RELEASED HERE WHEN THIS ROUTINE DOES NO LONGER  Y02651 65816002
*  NEED THEM                                                     Y02651 65818002
*  ALL THESE LOCKS WERE OBTAINED AT LABEL:                       Y02651 65818402
*              HSETLCK                                           Y02651 65818802
*                                                                Y02651 65819202
HUNSTLK  EQU   *                                                 Y02651 65819602
         STM   R11,R14,XASAVLOC                                  Y02651 65821602
         SETLOCK RELEASE,TYPE=CMS,RELATED=(IEE5703D(HSETLCK))    Y02651 65823902
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(IEE5703D(HSETLCK))  Y02651 65825902
         LM    R11,R14,XASAVLOC                                  Y02651 65826302
         BR    R4                                                Y02651 65827902
*                                                                Y02651 65829902
*****************************************************************Y01651 65840002
         EJECT                                                    19784 65850002
*                                                                 19784 66000019
*                                                                 19784 66200019
*********************************************************************** 66400019
*                                                                 19784 66600019
*       DECLARES                                                  19784 66800019
*                                                                 19784 67000019
*********************************************************************** 67200019
*                                                                 19784 67400019
FOUR     DC    H'4'                USED TO ACCESS UCMPRFX         19784 67600019
*********************************************************************** 67800019
HSYSLOG  DC    C'SYSLOG'           DO NOT SEPARATE THIS AND THE   19784 68000019
HUNIT    DC    C',H'               FOLLOWING CONSTANT             19784 68200019
HVARY    DC    C'VARY    '         VARY COMMAND VERB              19784 68260019
*                                                                       68320019
*********************************************************************** 68400019
*                                                                 19784 68600019
*                                                                 19784 68800019
MSG2103  DC    C'21'                                             Y02669 69000002
MSG0503  DC    C'05'                                             Y02669 69200002
         DS    0F                                                Y02669 69250002
VCON21   DC    V(IEE2103D)                                       Y02669 69300002
VCON05   DC    V(IEE0503D)                                       Y02669 69350002
*                                                                 19784 69400019
HARDCOPY DC    C'HARDCOPY'                                        M0048 69450001
         SPACE 5                                                        69500002
PATCH    DC    CL50'***IEE5703D***'                            @Z30LPTJ 69550003
         EJECT                                                          69600019
OXSA     DSECT                                                          69800019
         IEEXSA                                                         70000019
         EJECT                                                          82600019
OCVT     DSECT                                                          82800019
         CVT                                                            83000019
         EJECT                                                          83200019
OUCM     DSECT                                                          83400019
         IEECUCM    FORMAT=NEW                                          83600002
         EJECT                                                          83800019
OUCB     DSECT                                                          84000019
         IEFUCBOB                                                       84200019
         EJECT                                                          84250002
         IHAPSA                                                         84300002
         END                                                            84800019
