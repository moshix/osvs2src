         TITLE 'IEE5903D K AND MR MESSAGE MODULE LOAD TWO'              00200002
*********************************************************************** 00400001
*                                                                     * 00500002
*   MODULE NAME         =    IEE5903D                           Y02669* 00550002
*                                                                     * 00600002
*   DESCRIPTIVE NAME    =    CONTROL (K), MSGRT (MR) COMMANDS   Y02669* 00650002
*                            AND L=CCA OPERAND ERROR MESSAGE    Y02669* 00650402
*                            MODULE - LOAD 2                    Y02669* 00652002
*                                                                     * 00700002
*   COPYRIGHT           =    N/A                                Y02669* 00750002
*                                                                     * 00800002
*   STATUS              =    01 - UPDATE FOR VS/2 RELEASE 2     Y02669* 00850002
*                                                                     * 00900002
*   FUNCTION            =    THIS MODULE HANDLES THE SECOND     Y02669* 00950002
*                            PARTS OF LINES FOR CONTROL (K),    Y02669* 00960002
*                            MSGRT (MR) COMMANDS AND L=CCA      Y02669* 01000002
*                            OPERAND ERROR MESSAGES.            Y02669* 01050002
*                                                                     * 01100002
*  OPERATION            =    THE MESSAGES ARE ISSUED BY THE     Y02669* 01150002
*                            WRITE TO OPERATOR (WTO) MACRO.     Y02669* 01200002
*                            UNLESS THE MESSAGE IS WRITTEN IN   Y02669* 01250002
*                            RESPONSE TO A CONTROL OR MSGRT     Y02669* 01300002
*                            COMMAND ISSUED FROM A CRT CONSOLE, Y02669* 01350002
*                            THEN THE MESSAGE IS SET UP IN THE  Y02669* 01400002
*                            INSTRUCTION LINE OF THE DCM        Y02669* 01450002
*                            TO BE WRITTEN BY DIDOCS.           Y02669* 01452002
*                                                                     * 01454002
*                            THE MESSAGE CODE FOUND IN XASTSAVE Y02669* 01462002
*                            WHEN DOUBLED SERVES AS AN INDEX    Y02669* 01472002
*                            INTO THE MESSAGE TEXT TABLE.       Y02669* 01482002
*                                                                     * 01492002
*                            THE MESSAGE TABLE ENTRIES CONTAIN  Y02669* 01494002
*                            MESSAGE FLAGS WHICH INDICATE:      Y02669* 01496002
*                              X'80' - MESSAGE REQUIRES 'CCA'   Y02669* 01498002
*                              X'40' - MESSAGE REQUIRES 'CC'    Y02669* 01498402
*                            THIS INFORMATION IS FOUND IN XAS,  Y02669* 01498802
*                            CONVERTED AND PLACED IN THE TEXT.  Y02669* 01499202
*                                                                     * 01499602
*                            AFTER THE MESSAGE TEXT HAS BEEN    Y02669* 01499702
*                            ADDED TO THE WTO BUFFER, THE WTO   Y02669* 01499802
*                            IS ISSUED, THE CORE FREED AND      Y02669* 01499902
*                            CONTROL IS RETURNED.               Y02669* 01516602
*                            OTHERWISE, THE TEXT IS ADDED TO    Y02669* 01526602
*                            THE DCM INSTRUCTION LINE, THE      Y02669* 01528602
*                            LOCKS RELEASED AND CONTROL IS      Y02651* 01530602
*                            RETURNED.                          Y02669* 01532602
*                                                                     * 01533302
*   NOTES               =    NONE                               Y02669* 01550002
*                                                                     * 01600002
         EJECT                                                          01610002
*    CHARACTER-CODE                                             Y02669* 01650002
*     DEPENDENCIES      =    ANY CHARACTER CODE OTHER THAN      Y02669* 01700002
*                            EBCDIC WILL REQUIRE REASSEMBLY     Y02669* 01750002
*                            OF THIS MODULE.                    Y02669* 01800002
*                                                                     * 01850002
*    DEPENDENCIES       =    THE ONLY ENTRANCE TO THIS MODULE   Y02669* 01900002
*                            IS FROM IEE5603D WHICH SUPPLIES    Y02669* 01950002
*                            NECESSARY INFORMATION IN THE XSA   Y02669* 01960002
*                            AND REGISTERS.                     Y02669* 01970002
*                                                                     * 02000002
*    RESTRICTIONS       =    NONE                               Y02669* 02050002
*                                                                     * 02100002
*    REGISTER                                                   Y02669* 02150002
*     CONVENTIONS       =    NONE                               Y02669* 02200002
*                                                                     * 02250002
*     PATCH LABEL       =    PATCH                              Y02669* 02300002
*                                                                     * 02350002
*   MODULE TYPE         =    CSECT (MESSAGE MODULE)             Y02669* 02400002
*                                                                     * 02450002
*    PROCESSOR          =    N/A                                Y02669* 02500002
*                                                                     * 02550002
*    MODULE SIZE        =    X'371' + X'48' PATCH AREA          Y02669* 02600002
*                                                                     * 02650002
*    ATTRIBUTES         =    REFRESHABLE, REENTRANT,            Y02669* 02700002
*                            SUPERVISOR MODE, KEY 0,            Y02669* 02750002
*                            PAGED LPA                          Y02669* 02752002
*                                                                     * 02760002
*   ENTRY POINT         =    IEE5903D FROM IEE5603D             Y02669* 02770002
*      PURPOSE          =    TO PICK UP THE SECOND PART OF MSG  Y02669* 02780002
*                            AND TO ISSUE ERROR MESSAGES FOR    Y02669* 02790002
*                            MSGRT AND K COMMANDS AND L=CCA     Y02669* 02790402
*                            OPERAND.                           Y02669* 02790802
*      LINKAGE          =    BRANCH                             Y02669* 02792002
*      INPUT            =    REG 2 - ADDRESS OF THE XSA         Y02669* 02800002
*                                WHICH CONTAINS INFO ABOUT THE  Y02669* 02810002
*                                MESSAGE TO BE WRITTEN          Y02669* 02850002
*                              XASTSAVE - ONE BYTE MESSAGE CODE Y02669* 02860002
*                              XAU - SOURCE CONSOLE ID          Y02669* 02870002
*                              XASSDS=X'80'(XASSDS1) ISSUE WTO  Y02669* 02872002
*                              XASSDS5 ON IF LOCKS STILL HELD   Y02651* 02880002
*                                      OFF LOCKS RELEASED       Y02651* 02882002
*                              XASCID - TARGET CONSOLE ID       Y02669* 02890002
*                              XASDID - TARGET AREA ID (CRT)    Y02669* 02892002
*                              XASAVSTD+12 - MSG BUFFER ADDR    Y02669* 02894002
*                              XASAVSTD+16 - RETURN ADDRESS     Y02669* 02896002
*                            REG 3 - CURRENT POSITION IN        Y02669* 02900002
*                                    MESSAGE BUFFER             Y02669* 02950002
*                            REG 6 - CURRENT MSG TEXT LENGTH    Y02669* 02990002
*                            REG 8 - ADDRESS OF TRANS DCM       Y02669* 03070002
*                                                                     * 04250002
*      REGISTERS SAVED  =    REGISTERS 11 - 14 SAVED IN XSA     Y02651* 04300002
*                            (XASAVLOC) BEFORE ISSUING SETLOCK  Y02651* 04306002
*                            AT LOCKSOFF                        Y02651* 04312002
*                            REGISTER 14 WAS SAVED IN IEE5603D  Y02669* 04320002
*                            IN XASAVSTD + 16.                  Y02669* 04330002
*                                                                     * 04350002
*      REGISTER CONTENTS                                        Y02669* 04360002
*      DURING PROCESSING=    R0  - WORK REG FOR WTO & FREEMAIN  Y02669* 04370002
*                            R1  - WORK REG FOR WTO & FREEMAIN  Y02669* 04380002
*                            R2  - INPUT - BASE REG FOR XSA     Y02669* 04390002
*                            R3  - INPUT - CURRENT POSITION     Y02669* 04392002
*                                          IN BUFFER            Y02669* 04393002
*                            R4  - ADDR DCM INSTRUCTION LINE    Y02669* 04394002
*                            R5  - USED TO CONVERT CONSOLE ID   Y02669* 04396002
*                            R6  - INPUT - CURRENT TEXT LENGTH  Y02669* 04398002
*                            R7  - UNUSED                       Y02669* 04398402
*                            R8  - INPUT - BASE REG TRANS DCM   Y02669* 04398802
*                            R9  - ERR CODE - MSG TABLE INDEX   Y02669* 04399202
*                            R10 - CORRESPONDING TABLE ENTRY    Y02669* 04399602
*                            R11 - MINOR MSG TEXT LENGTH        Y02669* 04399702
*                            R12 - MODULE BASE REG              Y02669* 04399802
*                            R13 - UNUSED                       Y02669* 04399902
*                            R14 - RETURN REGISTER              Y02669* 04449902
*                            R15 - BRANCH REGISTER              Y02651* 04459902
*                                                                     * 04469902
*      REGISTERS RESTORED=   REGISTERS 11 - 14 RESTORE FROM     Y02651* 04481902
*                            XASAVLOC AFTER ISSUING SETLOCK AT  Y02651* 04484902
*                            LOCKSOFF                           Y02651* 04487902
*                            RESISTER 14, RESTORED BEFORE       Y02669* 04490902
*                            RETURNING AT RETURN                Y02669* 04495902
*                                                                     * 04508202
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04513202
*                                                                     * 04518202
*   EXIT - NORMAL       =    RETURN BR R14 FROM                 Y02669* 04523202
*                            LOCKSOFF -> RETURN                 Y02669* 04525202
*  1   CONDITIONS       =    MESSAGE TO GO TO CRT DEVICE        Y02669* 04528202
*      OUTPUT DATA      =    MESSAGE IN DCM INSTRUCTION LINE    Y02669* 04533202
*                              DCMIOCM1 = DCMWRINS (X'04')      Y02669* 04535202
*                            IF DEVICE IS 2250 OR HAS LIGHT PEN:Y02669* 04535302
*                              DCMIOUNQ = DCMW2250 (X'08')      Y02669* 04535402
*                            SHOW DCM LINE CONTAINS ERROR MSG   Y02669* 04535602
*                              DCMIOUNQ = DCMINERR (X'02')      Y02669* 04536002
*                            ADD 'ENTER CANCEL' TO MSG          Y02669* 04537202
*      RETURN CODES     =    NONE                               Y02669* 04543202
*                                                                     * 04553202
         EJECT                                                          04555202
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04563202
*                                                                     * 04563302
*   EXIT - NORMAL       =    RETURN VIA BR R14 FROM             Y02669* 04563602
*                            ISSUEWTO -> RETURN                 Y02669* 04563802
*      CONDITIONS       =    MESSAGE ISSUED TO REQUESTING       Y02669* 04564002
*                            CONSOLE VIA WTO AND WTO BUFFER     Y02669* 04564102
*                            FREED VIA FREEMAIN                 Y02669* 04564202
*      OUTPUT DATA      =    MESSAGE                            Y02669* 04564402
*      RETURN CODES     =    NONE                               Y02669* 04564802
*                                                                     * 04577602
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04587602
*                                                                     * 04589602
*   EXIT - ERROR        =    RETURN VIA BR R14 FROM             Y02651* 04591602
*                            FREEXIT -> RETURN                  Y02651* 04592602
*      CONDITIONS       =    BAD MESSAGE CODE IN XASTSAVE       Y02669* 04593602
*                            MESSAGE BUFFER OBTAINED IN         Y02669* 04593702
*                            IEE5603D FREED VIA FREEMAIN        Y02669* 04593802
*      OUTPUT DATA      =    NONE                               Y02669* 04594002
*      RETURN CODES     =    NONE                               Y02669* 04594402
*                                                                     * 04594802
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  ** 04595302
*                                                                     * 04595702
*   EXTERNAL REFERENCES                                         Y02669* 04596102
*                                                                     * 04596202
*      ROUTINES         =    NONE                               Y02669* 04646202
*                                                                     * 04656202
*      DATA AREAS       =    NONE                               Y02669* 04666202
*                                                                     * 04676202
*      CONTROL BLOCKS   = IEETDCM R - DEVICE TYPE INFORMATION   Y02669* 04688202
*                                 W - MSG AND MSG INDICATOR     Y02669* 04688602
*                         IEEXSA  R - INPUT INFORMATION         Y02669* 04690202
*                                 W - WORK AREA                 Y02669* 04690602
*                         IHAPSA  NECESSARY FOR SETLOCK         Y02651* 04690702
*                                                                     * 04692202
*      TABLE            =    THIS MODULE CONTAINS TWO MESSAGE   Y02669* 04694202
*                            TABLES. THE FIRST IN INDEXED BY    Y02669* 04694602
*                            TWICE THE MESSAGE CODE PASSED IN   Y02669* 04695002
*                            XASTSAVE. THE INDEXED HALF WORD    Y02669* 04695402
*                            POINTS TO AN ELEMENT IN TAB4 WHICH Y02669* 04695802
*                            CONTAINS THE APPROPIATE MESSAGE.   Y02669* 04695902
*                                                                     * 04696002
*                            TAB4 CONTAINS A ONE BYTE LENGTH OF Y02669* 04696102
*                            THE PREFORMATTED MESSAGE TEXT -1,  Y02669* 04712802
*                            ONE BYTE OF MESSAGE FLAGS:         Y02669* 04722802
*                                X'80' - 'CCA' REQUIRED IN MSG  Y02669* 04724802
*                                X'40' - 'CC' REQUIRED IN MSG   Y02669* 04725202
*                            AND THE PREFORMATTED MESSAGE TEXT. Y02669* 04726802
*                                                                     * 04728802
*      MACROS           =    MODID                              Y02669* 04729202
*                            WTO                                Y02669* 04729302
*                            FREEMAIN SUBPOOL 229               Y02669* 04729402
*                            SETLOCK CMS AND LOCAL RELEASED     Y02651* 04731402
*                                                                     * 04735002
*      ENQUEUE RESOURCES=    NONE                               Y02669* 04737002
*                                                                     * 04739002
*      CHANGE LEVEL     =    Y02669                             Y02669* 04739402
*                            Y02651                             Y02651* 04739502
*                            YM1911(PROLOGUE & COMMENT CHANGES) YM1911* 04741502
*                                                                     * 04743502
*      LOCKS HELD       =    CMS AND LOCAL LOCKS OBTAINED IN    Y02651* 04745502
*                            IEE7503D OR IEE5603D ARE RELEASED  Y02651* 04749602
*                            AND XASSDS5 IS TURNED OFF AT       Y02651* 04849602
*                            LOCKSOFF BEFORE RETURNING AT       Y02651* 05089702
*                            WTODCM AND FREEXIT.                Y02651* 05092702
*                                                                     * 05095702
*   MESSAGES            =    THE FOLLOWING MESSAGES ARE         Y02669* 05099702
*                            CONTAINED WITHIN THIS MODULE:      Y02669* 05109702
*                             * MEANS 'CCA' WILL APPEAR IN THE  Y02669* 05119702
*                               MESSAGE                         Y02669* 05129702
*                             # MEANS 'CC' WILL APPEAR IN THE   Y02669* 05131702
*                               MESSAGE                         Y02669* 05131802
*                             THE MESSAGE ID INDICATES THE      Y02669* 05132102
*                             MESSAGE FOR WHICH THE FOLLOWING   Y02669* 05133702
*                             TEXT BECOMES THE SECOND PART.     Y02669* 05135702
*                                                                     * 05139702
*                             THE MOD NAME INDICATES THE MODULE Y02669* 05141702
*                             WHICH ENCOUNTERED THE ERROR AND   Y02669* 05143702
*                             ISSUED THE ERROR CODE.            Y02669* 05145702
*                                                                     * 05147702
*     MOD NAME      XASTSAVE  MSG ID   SECOND PART OF MSG       Y02669* 05149702
*     ________      ________  ______  ____________________      Y02669* 05189702
*     IEE6703D        X'06'  IEE151I  NO DISPLAY ON SCREEN      Y02669* 05229702
*     IEE6703D        X'07'           NO DISPLAY IN AREA        Y02669* 05269702
*     IEE6703D        X'04'           USE STOPTR TO DELETE      Y02669* 05309702
*     IEE6703D        X'06'  IEE158I  NO DISPLAY ON SCREEN      Y02669* 05349702
*     IEE6703D        X'07'           NO DISPLAY IN AREA        Y02669* 05389702
*     IEE6703D        X'08'           LAST FRAME DISPLAYED      Y02669* 05429702
*     IEE6703D        X'09'           FRAME NOT COMPLETE        Y02669* 05469702
*     IEE6703D        X'0A'           DISPLAY IS NOT DYNAMIC    Y02669* 05509702
*     IEE6903D        X'1E'           NO TRACK ACTIVE           Y02669* 05549702
*     IEE7503D        X'0C'  IEE921I  DISPLAY ALREADY EXISTS    Y02669* 05589702
*     IEE7503D        X'0D'           DISPLAY AREA BUSY         Y02669* 05629702
*     IEE7503D        X'0E'           NO TRACK TO STOP          Y02669* 05669702
*     IEE7503D        X'19'           NEEDS DISPLAY AREA        Y02669* 05709702
*     IEE7703D        X'1C'           DEVICE NOT SUPPORTED      Y02669* 05749702
*     IEE6803D        X'0F'  IEE924I  SCREEN SIZE EXCEEDED      Y02669* 05789702
*     IEE6803D        X'10'           AREA TOO SMALL            Y02669* 05829702
*     IEE6903D        X'11'           DISPLAY IN OR ABOVE AREA  Y02669* 05869702
*     IEE6803D                                                  Y02669* 05909702
*     IEE7503D        X'12'  IEE926I  *   NOT AN AREA           Y02669* 05989702
*     IEE6303D                        #   SUBSYSTEM CONSOLE     Y02669* 06009703
*     IEE6303D        X'1F'           SUBSYSTEM CONSOLE        @Y02668P 06019703
*     IEE7503D        X'13'           #   NOT A CONSOLE         Y02669* 06039702
*     IEE6303D                                                  Y02669* 06059702
*     IEE7503D        X'14'           #   FULL CAPABILITY       Y02669* 06089702
*     IEE7503D        X'15'           DYNAMIC DISPLAY IN AREA   Y02669* 06109702
*     IEE6703D        X'18'           ON THIS COMMAND           Y02669* 06129702
*     IEE6803D        X'1D'           #   OUTPUT ONLY           Y02669* 06149702
*     IEE7703D                                                  Y02669* 06169702
*     IEE7803D        X'16'  IEE927I  SPECIFY DISPLAY ID        Y02669* 06189702
*     IEE6703D        X'17'           SPECIFY L OPERAND         Y02669* 06239702
*     IEE7503D                                                  Y02669* 06289702
*     IEE6703D        X'1A'  IEE925I  FOR CRT ONLY              Y02669* 06339702
*     IEE7503D                                                  Y02669* 06359702
*     IEE6403D        X'1B'           FOR NON CRT ONLY          Y02669* 06389702
*                                                                     * 06439702
*   SYSGEN              =    INCLUDED WITH SVC 34 IN LOAD       Y02669* 06489702
*                            MODULE IGC0003D, DLIB AOSB3,       Y02669* 06539702
*                            MACRO SGIEF441, TARGLIB LPALIB.    Y02669* 06549702
*                                                                     * 06589702
*   SYSTEM                                                      Y02669* 06639702
*    LIBRARIES          =    NONE                               Y02669* 06689702
*                                                                     * 06739702
*********************************************************************** 08200001
         EJECT                                                          08400001
IEE5903D CSECT                                                          08600001
*********************************************************************** 08650002
*                                                                     * 08800002
*                        REGISTERS                                    * 09000002
*                                                                     * 09200002
*********************************************************************** 09250002
WRK0     EQU   0                   WORK REGISTER-WTO & FREEMAIN         09400002
WRK1     EQU   1                   WORK REGISTER-WTO & FREEMAIN         09600002
XSAR2    EQU   2                   INPUT-BASE REGISTER FOR XSA   Y02669 09800002
WRK3     EQU   3                   INPUT-CURRENT PLACE IN BUFFER Y02669 10000002
WRK4     EQU   4                   ADDR OF DCM INSTRUCTION LINE  Y02669 10200002
WRK5     EQU   5                   USED TO CONVERT CONSOLE ID    Y02669 10400002
WRK6     EQU   6                   INPUT-CURRENT LENGTH OF TEXT  Y02669 10600002
R7       EQU   7      (UNUSED)     UNUSED                        Y02669 10800002
TDCMR8   EQU   8                   INPUT-BASE REG FOR THE DCM    Y02669 10850002
WRK9     EQU   9                   ERR CODE FROM XSA-TABLE INDEX Y02669 11200002
WRK10    EQU   10                  CORRESPONDING TABLE ENTRY     Y02669 11250002
WRK11    EQU   11                  SECONDARY MESSAGE TEXT LENGTH Y02669 11600002
BASE12   EQU   12                  MODULE BASE REGISTER          Y02669 11800002
R13      EQU   13     (UNUSED)     UNUSED                        Y02669 12000002
RETURN14 EQU   14                  RETURN REGISTER               Y02669 12200002
R15      EQU   15                  BRANCH REGISTER               Y02651 12400002
         EJECT                                                          12450001
*********************************************************************** 12500002
*                                                                     * 12600002
*                        CONSTANTS                                    * 12800002
*                                                                     * 13000002
*********************************************************************** 13050002
N0       EQU   0                   NUMBER CONSTANT                      13200001
N1       EQU   1                   NUMBER CONSTANT                      13400001
N2       EQU   2                   NUMBER CONSTANT                      13600001
N3       EQU   3                   NUMBER CONSTANT                      13800001
N4       EQU   4                   NUMBER CONSTANT                      14000001
N6       EQU   6                   NUMBER CONSTANT                      14400001
N12      EQU   12                  NUMBER CONSTANT               Y02669 14450002
N15      EQU   15                  NUMBER CONSTANT                      15800001
N16      EQU   16                  NUMBER CONSTANT               Y02669 15850002
N59      EQU   59                  NUMBER CONSTANT                      16000001
N64      EQU   64                  NUMBER CONSTANT                      16200001
*********************************************************************** 16250002
*                                                                     * 16300002
*                       FLAGS AND MASKS                               * 16350002
*                                                                     * 16400002
*********************************************************************** 16450002
CCAFLAG  EQU   X'80'               CCA FLAG IN MESSAGE TABLE     Y02669 16600002
CCFLAG   EQU   X'40'               CC FLAG IN MESSAGE TABLE      Y02669 16800002
CODE2HI  EQU   31                  HIGHEST VALID MESSAGE CODE  @Y02668P 17400003
CODE2LO  EQU   4                   LOWEST VALID MESSAGE CODE     Y02669 17600002
TOOHIGH  EQU   2                   CONDITION CODE - HIGHER THAN  Y02669 17650002
TOOLOW   EQU   4                   CONDITION CODE - LOWER THAN   Y02669 17700002
XFF      EQU   X'FF'               MASK TO TURN OFF FLAGS        Y02669 17800002
CF0      EQU   X'F0'               EBCDIC ZONE                          18400001
SP229    EQU   229                 SUBPOOL FOR MESSAGE BUFFER    Y02669 18450002
         EJECT                                                          18460002
*********************************************************************** 18500002
*                                                                     * 18550002
*              ESTABLISH ADDRESSABILITY FOR MODULE               Y02669 18600002
*      ADDRESSABILITY FOR XSA AND RESIDENT DCM ARE PART OF INPUT Y02669 18610002
*                                                                     * 18650002
*********************************************************************** 18700002
         BALR  BASE12,N0           LOAD BASE REG                 Y02669 19600002
         USING *,BASE12            ADDRESSIBILITY OF ROUTINE     Y02669 19800002
         MODID BRANCH=YES                                        Y01886 19850001
         USING DXSA,XSAR2          ADDRESSIBILITY OF XSA         Y02669 20000002
         USING DCMSTRT,TDCMR8      ADDRESSIBILITY OF TRANS DCM   Y02669 20050002
         SPACE                                                          20160002
*********************************************************************** 20200002
*                                                                     * 21400002
*                 CHECK FOR INCORRECT MESSAGE CODE                    * 21600002
*                                                                     * 21800002
*********************************************************************** 22600002
         SPACE 3                                                        22610002
         CLI   XASTSAVE,CODE2HI    IS MSG CODE HIGHER THAN MAX?  Y02669 22800002
         BC    TOOHIGH,FREEXIT     YES, CHECK LOCKS AND RETURN   Y02651 23000002
         SPACE                                                          23050002
         CLI   XASTSAVE,CODE2LO    IS MSG CODE LOWER THAN MIN?   Y02669 23200002
         BC    TOOLOW,FREEXIT      YES, CHECK LOCKS AND RETURN   Y02651 23400002
         EJECT                                                          23600002
*********************************************************************** 24000002
*                                                                     * 24050002
*              CALCULATE ENTRY IN MESSAGE TABLE                  Y02669 24100002
*                                                                     * 24150002
*********************************************************************** 26000002
         SPACE                                                          26050002
         SR    WRK9,WRK9           CLEAR REG                     Y02669 26400002
         IC    WRK9,XASTSAVE       SECONDARY ERR CODE FROM XSA   Y02669 26600002
         AR    WRK9,WRK9           DOUBLE CODE FOR INDEX         Y02669 26800002
         LA    WRK10,TAB3(WRK9)    PT TO APPROPRIATE TAB3 ENTRY  Y02669 27000002
         LH    WRK10,N0(WRK10)     LOAD TABLE ELEMENT            Y02669 27200002
         LA    WRK10,TAB4(WRK10)   PT TO APPROPRIATE TAB4 ENTRY  Y02669 27210002
         SPACE 2                                                        27250002
*********************************************************************** 27300002
*                                                                     * 27400002
*        ADD MESSAGE TEXT TO DCM INSTRUCTION LINE OR WTO BUFFER       * 27600002
*            REG 3 - CURRENT POSITION IN MESSAGE BUFFER          Y02669 27650002
*            REG 6 - CURRENT LENGTH OF MESSAGE TEXT              Y02669 27700002
*                                                                     * 27800002
*********************************************************************** 28400002
         SPACE 3                                                        28450002
         SR    WRK11,WRK11         CLEAR REG                     Y02669 28800002
         IC    WRK11,N0(WRK10)     GET FIXED MSG TEXT LENGTH - 1 Y02669 29000002
         EX    WRK11,FXTEXT        MOVE IN FIXED TEXT            Y02669 29200002
         AR    WRK6,WRK11          ORIGINAL TEXT + TEXT LENGTH   Y02669 29400002
         LA    WRK6,N1(WRK6)       INCREMENT POSITION BY ONE     Y02669 29600002
*                                  HAD TO BE 1 LESS FOR EXECUTE  Y02669 29650002
         TM    N1(WRK10),CCAFLAG   DOES MSG REQUIRE 'CCA'?       Y02669 30400002
         BO    MOVEAREA            YES                           Y02669 30600002
         SPACE 1                                                        30800002
         TM    N1(WRK10),CCFLAG    DOES MSG REQUIRE 'CC'?        Y02669 31400002
         BO    UNPACKC             YES                           Y02669 31600002
         SPACE 1                                                        31800002
WTODCM   EQU   *                                                        32400001
         TM    XASSDS,XASSDS1      IS THIS A WTO?                Y02669 32600002
         BO    ISSUEWTO            YES                           Y02669 32800002
         EJECT                                                          33000002
*********************************************************************** 33600002
*                                                                     * 33610002
*              IF MESSAGE IN DCM INSTRUCTION LINE                Y02669 33620002
*                SET BITS, FREE LOCKS AND RETURN                 Y02669 33622002
*                                                                     * 33630002
*********************************************************************** 33650002
         SPACE 2                                                        33700002
         OI    DCMIOCM1,DCMWRINS   SET WRITE INSTRUCTION LINE IN DCM    34400002
         TM    DCMIOUNQ,DCMW2250   DOES DEVICE HAVE A LIGHT PEN?        35200001
         BZ    LOCKSOFF            NO, RELEASE LOCKS, RETURN     Y02651 35400002
         SPACE                                                          35450002
         L     WRK4,DCMAINS        YES,POINT TO INSTRUCTION LINE Y02669 36200002
         MVC   N59(N15,WRK4),ENCANCEL  MOVE ENTER-CANCEL MSG IN  Y02669 36400002
         NI    DCMIOUNQ,XFF-DCMINNOR TURN OFF NORMAL LINE BIT    Y02669 36600002
         OI    DCMIOUNQ,DCMINERR   INDICATE ERROR MSG IN INST LINE      36800001
         SPACE                                                          37000002
*********************************************************************** 37050002
*  CMS AND LOCAL LOCKS MUST BE RELEASED BEFORE EXITING FROM THIS MODULE 37100002
*********************************************************************** 37150002
LOCKSOFF EQU   *                                                        37200002
         STM   WRK11,RETURN14,XASAVLOC  SAVE REGS ACROSS SETLOCK Y02651 37250002
         SETLOCK RELEASE,TYPE=CMS,                                     *37300002
               RELATED=(TR,PT,K,IEE7503D(LOCKSET),IEE5603D(LOCKSTAT))   37350002
         SETLOCK RELEASE,TYPE=LOCAL,                                   *37400002
               RELATED=(TR,PT,K,IEE7503D(LOCKSET),IEE5603D(LOCKSTAT))   37450002
         LM    WRK11,RETURN14,XASAVLOC  RESTORE AFTER SETLOCK    Y02651 37500002
         NI    XASSDS,XASSDS5      INDICATE LOCKS OFF            Y02651 37550002
         B     RETURN                                                   37600002
         EJECT                                                          37850002
*********************************************************************** 37900002
*                                                                     * 38000002
*                 IF MESSAGE IS IN WTO BUFFER                    Y02669 38050002
*    ISSUE WTO FOR MESSAGE, FREE THE CORE AND RETURN             Y02669 38200002
*                                                                     * 38400002
*********************************************************************** 39000002
         SPACE 3                                                        39050002
ISSUEWTO EQU   *                                                 Y02669 39200002
         LA    WRK6,N4(WRK6)       4 EXTRA BYTES FOR WTO (MCS + LEN)    39800001
         L     WRK1,XASAVSTD+N12   BEGINNING ADDR OF MSG         Y02669 39850002
         STH   WRK6,N0(WRK1)       PUT LENGTH OF TEXT + 4 IN BUFFER     40000002
         AR    WRK6,WRK1           END ADDR OF MESSAGE BUFFER           40200002
         MVC   N0(N4,WRK6),DRCODES MOVE IN DESC AND ROUTE CODES         40400001
         SR    WRK0,WRK0           CLEAR REG                            40600001
         IC    WRK0,XAU            GET SOURCE CONSOLE ID FROM XSA       40800002
         WTO   MF=(E,(1))          WRITE MESSAGE                        41000001
         B     OKEXIT              NO LOCKS ON TO RELEASE        Y02651 41050002
         SPACE 3                                                        41200002
*********************************************************************** 41202002
*       COME HERE IF INVALID MESSAGE CODE IN XASTSAVE ONLY       Y02651 41210002
*          IF XASSDS HAS XASSDS1=ON WTO BUFFER MUST BE FREED     Y02651 41212002
*                                   NO LOCKS HELD                Y02651 41214002
*                        XASSDS5=ON LOCKS ARE ALWAYS HELD        Y02651 41216002
*********************************************************************** 41220002
         SPACE 3                                                        41230002
FREEXIT  EQU   *                                                 Y02651 41250002
         TM    XASSDS,XASSDS1      IF ON,LOCKS HAVE BEEN RELEASEDY02651 41300002
         BZ    LOCKSOFF            IF OFF, LOCKS MUST BE RELEASEDY02651 41360002
         SPACE 2                                                        41410002
OKEXIT   EQU   *                   NO NEED TO RELEASE LOCKS      Y02651 41750002
         L     WRK1,XASAVSTD+N12   ADDR OF BUFFER FOR FREEMAIN   Y02669 41800002
         FREEMAIN R,LV=N64,A=(1),SP=SP229 FREE BUFFER            Y02669 42000002
         SPACE                                                          42050002
RETURN   EQU   *                                                        42060002
         L     RETURN14,XASAVSTD+N16  RESTORE R14 SAVED IN 5603D Y02669 42100002
         BR    RETURN14            RETURN TO CALLER              Y02669 42200002
         EJECT                                                          42250002
*********************************************************************** 42300002
*                                                                     * 42400002
*    MOVE CONSOLE ID OR CONSOLE AND AREA ID INTO MESSAGE         Y02669 42600002
*                                                                     * 42800002
*********************************************************************** 43400002
         SPACE 3                                                        43450002
MOVEAREA EQU   *                                                        43600002
         MVC   N2(N1,WRK3),XASDID  MOVE AREA ID FROM XSA INTO MSG TEXT  43800002
         SPACE                                                          44000002
UNPACKC  EQU   *                                                        44800001
         SR    WRK5,WRK5           CLEAR REG                     Y02669 45000002
         IC    WRK5,XASCID         GET CONSOLE ID FROM XSA       Y02669 45200002
         CVD   WRK5,XAP            CONVERT CONSOLE ID TO DECIMAL Y02669 45400002
         UNPK  XAP+N1(N3),XAP+N6(N2) THEN TO PRINTABLE CHARACTERS       45600002
         OI    XAP+N3,CF0          CHANGE ZONE TO EBCDIC                45800002
         MVC   N0(N2,WRK3),XAP+N2  MOVE CONSOLE ID TO MSG TEXT          46000001
         B     WTODCM              BRANCH TO WRITE MESSAGE              46200002
         SPACE 3                                                        46250002
*********************************************************************** 46300002
*          EXECUTE INSTRUCTION TO MOVE TEXT INTO MESSAGE BUFFER         46360002
*********************************************************************** 46370002
FXTEXT   MVC   N0(N0,WRK3),N2(WRK10) MOVE IN TEXT FROM TABLE     Y02669 46400002
         SPACE 2                                                        46410002
         EJECT                                                          47050001
*********************************************************************** 47100002
*                                                                     * 47200002
*   THE FOLLOWING TABLE IS INDEXED BY TWICE THE MESSAGE CODE IN XAE   * 47400002
*   EACH HALF-WORD POINTS TO A TAB4 ELEMENT CONTAINING THE            * 47600002
*   APPROPIATE MESSAGE                                                * 47610002
*                                                                     * 47800002
*********************************************************************** 47850002
PREMSG   EQU   2                                                        48000001
TAB3     EQU   *                                                        48200001
         DC    AL2(0)                                                   48400001
         DC    X'FFFF'                 OBSOLETE MESSAGE CODE     Y02669 48600002
         DC    X'FFFF'                 OBSOLETE MESSAGE CODE     Y02669 48800002
         DC    X'FFFF'                 OBSOLETE MESSAGE CODE     Y02669 49000002
         DC    Y(VM04-TAB4-PREMSG)                               Y02669 49200002
         DC    X'FFFF'                 OBSOLETE MESSAGE CODE     Y02669 49400002
         DC    Y(VM06-TAB4-PREMSG)                               Y02669 49600002
         DC    Y(VM07-TAB4-PREMSG)                               Y02669 49800002
         DC    Y(VM08-TAB4-PREMSG)                               Y02669 50000002
         DC    Y(VM09-TAB4-PREMSG)                               Y02669 50200002
         DC    Y(VM10-TAB4-PREMSG)                               Y02669 50400002
         DC    X'FFFF'                 OBSOLETE MESSAGE CODE     Y02669 50600002
         DC    Y(VM12-TAB4-PREMSG)                               Y02669 50800002
         DC    Y(VM13-TAB4-PREMSG)                               Y02669 51000002
         DC    Y(VM14-TAB4-PREMSG)                               Y02669 51200002
         DC    Y(VM15-TAB4-PREMSG)                               Y02669 51400002
         DC    Y(VM16-TAB4-PREMSG)                               Y02669 51600002
         DC    Y(VM17-TAB4-PREMSG)                               Y02669 51800002
         DC    Y(VM18-TAB4-PREMSG)                               Y02669 52000002
         DC    Y(VM19-TAB4-PREMSG)                               Y02669 52200002
         DC    Y(VM20-TAB4-PREMSG)                               Y02669 52400002
         DC    Y(VM21-TAB4-PREMSG)                               Y02669 52600002
         DC    Y(VM22-TAB4-PREMSG)                               Y02669 52800002
         DC    Y(VM23-TAB4-PREMSG)                               Y02669 53000002
         DC    Y(VM24-TAB4-PREMSG)                               Y02669 53200002
         DC    Y(VM25-TAB4-PREMSG)                               Y02669 53400002
         DC    Y(VM26-TAB4-PREMSG)                               Y02669 53600002
         DC    Y(VM27-TAB4-PREMSG)                               Y02669 53800002
         DC    Y(VM28-TAB4-PREMSG)                               Y02669 53850002
         DC    Y(VM29-TAB4-PREMSG)                               Y02669 53900002
         DC    Y(VM30-TAB4-PREMSG)                               Y02669 53910002
         DC    Y(VM31-TAB4-PREMSG)                             @Y02668P 53930003
         EJECT                                                          53950001
*********************************************************************** 53960002
*                                                                       54000002
*    THE FOLLOWING TABLE CONTAINS:                               Y02669 54200002
*        A 1-BYTE LENGTH OF PREFORMATTED MESSAGE TEXT - 1        Y02669 54210002
*          1-BYTE OF MESSAGE FLAGS                               Y02669 54250002
*             X'80' - MESSAGE REQUIRES 'CCA' VALUE FOUND IN XAS  Y02669 54300002
*             X'40' - MESSAGE REQUIES 'CC' VALUE FOUND IN XAS    Y02669 54350002
*          PREFORMATTED MESSAGE TEXT                             Y02669 54400002
*                                                                     * 54600002
*********************************************************************** 54650002
TAB4     EQU   *                                                        54800001
         DC    AL1(L'VM04-1)              LENGTH OF FIXED TEXT   Y02669 57400002
         DC    X'00'                      FLAGS FOR MESSAGE             57600002
VM04     DC    C'USE STOPTR TO DELETE'    MESSAGE FIXED TEXT     Y02669 57800002
*                                                                       58800001
         DC    AL1(L'VM06-1)                                     Y02669 59000002
         DC    X'00'                                                    59200001
VM06     DC    C'NO DISPLAY ON SCREEN'                           Y02669 59400002
*                                                                       59600001
         DC    AL1(L'VM07-1)                                     Y02669 59800002
         DC    X'00'                                                    60000001
VM07     DC    C'NO DISPLAY IN AREA'                             Y02669 60200002
*                                                                       60400001
         DC    AL1(L'VM08-1)                                     Y02669 60600002
         DC    X'00'                                                    60800001
VM08     DC    C'LAST FRAME DISPLAYED'                           Y02669 61000002
*                                                                       61200001
         DC    AL1(L'VM09-1)                                     Y02669 61400002
         DC    X'00'                                                    61600001
VM09     DC    C'FRAME NOT COMPLETE'                             Y02669 61800002
*                                                                       62000001
         DC    AL1(L'VM10-1)                                     Y02669 62200002
         DC    X'00'                                                    62400001
VM10     DC    C'DISPLAY IS NOT DYNAMIC'                         Y02669 62600002
*                                                                       62800001
         DC    AL1(L'VM12-1)                                     Y02669 63800002
         DC    X'00'                                                    64000001
VM12     DC    C'DISPLAY ALREADY EXISTS'                         Y02669 64200002
*                                                                       64400001
         DC    AL1(L'VM13-1)                                     Y02669 64600002
         DC    X'00'                                                    64800001
VM13     DC    C'DISPLAY AREA BUSY'                              Y02669 65000002
*                                                                       65200001
         DC    AL1(L'VM14-1)                                     Y02669 65400002
         DC    X'00'                                                    65600001
VM14     DC    C'NO TRACK TO STOP'                               Y02669 65800002
*                                                                       66000001
         DC    AL1(L'VM15-1)                                     Y02669 66200002
         DC    X'00'                                                    66400001
VM15     DC    C'SCREEN SIZE EXCEEDED'                           Y02669 66600002
*                                                                       66800001
         DC    AL1(L'VM16-1)                                     Y02669 67000002
         DC    X'00'                                                    67200001
VM16     DC    C'AREA TOO SMALL'                                 Y02669 67400002
*                                                                       67600001
         DC    AL1(L'VM17-1)                                     Y02669 67800002
         DC    X'00'                                                    68000001
VM17     DC    C'DISPLAY IN OR ABOVE AREA'                       Y02669 68200002
*                                                                       68400001
         DC    AL1(L'VM18-1)                                     Y02669 68600002
         DC    X'80'                                                    68800001
VM18     DC    C'    NOT AN AREA'                                Y02669 69000002
*                                                                       69200001
         DC    AL1(L'VM19-1)                                     Y02669 69400002
         DC    X'40'                                                    69600002
VM19     DC    C'   NOT A CONSOLE'                               Y02669 69800002
*                                                                       70000001
         DC    AL1(L'VM20-1)                                     Y02669 70200002
         DC    X'40'                                                    70400002
VM20     DC    C'   FULL CAPABILITY'                             Y02669 70600002
*                                                                       70800001
         DC    AL1(L'VM21-1)                                     Y02669 71000002
         DC    X'00'                                                    71200001
VM21     DC    C'DYNAMIC DISPLAY IN AREA'                        Y02669 71400002
*                                                                       71600001
         DC    AL1(L'VM22-1)                                     Y02669 71800002
         DC    X'00'                                                    72000001
VM22     DC    C'SPECIFY DISPLAY ID'                             Y02669 72200002
*                                                                       72400001
         DC    AL1(L'VM23-1)                                     Y02669 72600002
         DC    X'00'                                                    72800001
VM23     DC    C'SPECIFY L OPERAND'                              Y02669 73000002
*                                                                       73200001
         DC    AL1(L'VM24-1)                                     Y02669 73400002
         DC    X'00'                                                    73600001
VM24     DC    C'ON THIS COMMAND'                                Y02669 73800002
*                                                                       74000001
         DC    AL1(L'VM25-1)                                     Y02669 74200002
         DC    X'00'                                                    74400001
VM25     DC    C'NEEDS DISPLAY AREA'                             Y02669 74600002
*                                                                       74800001
         DC    AL1(L'VM26-1)                                     Y02669 75000002
         DC    X'00'                                                    75200001
VM26     DC    C'FOR CRT ONLY'                                   Y02669 75400002
*                                                                       75600001
         DC    AL1(L'VM27-1)                                     Y02669 75800002
         DC    X'00'                                                    76000001
VM27     DC    C'FOR NON CRT ONLY'                               Y02669 76200002
*                                                                       76400001
         DC    AL1(L'VM28-1)                                     Y02669 76450002
         DC    X'00'                                                    76500001
VM28     DC    C'DEVICE NOT SUPPORTED'                           Y02669 76550002
*                                                                       76560001
         DC    AL1(L'VM29-1)                                     Y02669 76570002
         DC    X'40'                                                    76580001
VM29     DC    C'   OUTPUT ONLY'                                 Y02669 76590002
*                                                                       76592001
         DC    AL1(L'VM30-1)                                     Y02669 76592402
         DC    X'00'                                             Y02669 76592802
VM30     DC    C'NO TRACK ACTIVE'                                Y02669 76593202
*                                                                Y02669 76593602
         DC    AL1(L'VM31-1)                                   @Y02668P 76598603
         DC    X'40'                                           @Y02668P 76603603
VM31     DC    C'    SUBSYSTEM CONSOLE'                        @Y02668P 76608603
*                                                              @Y02668P 76613603
         EJECT                                                          76622002
*********************************************************************** 76636002
*                                                                     * 76650002
*                        CONSTANTS                                    * 76800002
*                                                                     * 77000002
*********************************************************************** 77050002
         SPACE                                                          77100002
ENCANCEL DC    C'*ENTER**CANCEL*'  ADDED FOR CRT WITH CURSOR     Y02669 77200002
DRCODES  DC    X'0800'             DESCRIPTOR CODE                      77400001
         DC    X'0000'             ROUTING CODE                         77600001
         SPACE 5                                                        77610002
*********************************************************************** 77650002
*                                                                     * 77700002
*                        PATCH AREA                                   * 77750002
*                                                                     * 77760002
*********************************************************************** 77770002
PATCH    DC    C'****PATCH AREA****'                                    77800001
PATCH2   DC    C'IEE5903D-TEST ONLY'                                    78000001
PATCH3   DC    36C' '                                                   78200001
         EJECT                                                          78400001
         IEETDCM                                                 Y01012 78800101
         EJECT                                                          79600001
DXSA     DSECT                                                          79800001
         IEEXSA                                                         80000001
         EJECT                                                          80050002
         IHAPSA                                                         80100002
         END                                                            83200001
