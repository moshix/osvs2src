 TITLE 'IGC0003D   MSGRT COMMAND PROCESSOR, LOAD ONE'                   00201002
*********************************************************************** 00202002
*                                                                     * 00300001
*  MODULE-NAME =  IEE6303D                                       Y02669 00301002
*                                                                       00302002
*  DESCRIPTIVE NAME =  MSGRT COMMAND HANDLER LOAD ONE            Y02669 00303002
*                                                                       00304002
*  COPYRIGHT =  NONE                                             Y02669 00305002
*                                                                       00306002
*  STATUS =  OS/VS2 - DUMPING IMPROVEMENTS                     @G33CPMR 00306243
*                                                                       00308002
*  FUNCTION =  THIS MODULE BUILDS AND MAINTAINS THE ROUTE CONRTOLY02669 00309002
*  TABLE (RCT) FOR EACH CONSOLE IN ORDER TO PROVIDE DEFAULT      Y02669 00310002
*  ROUTING.                                                      Y02669 00311002
*                                                                       00312002
*     OPERATION =                                                Y02669 00313002
*     O.  IT IS DETERMINED IF THE COMMAND IS CURRENTLY         @Y02668P 00313203
*     EXECUTING UNDER A TASK OTHER THAN THE COMMUNICATIONS     @Y02668P 00313403
*     TASK. IF SO, AN INDICATOR IS SET IN THE XSA. THIS CON-   @Y02668P 00313603
*     DITION IS MOST LIKELY TO OCCUR FOR A COMMAND ISSUED AT   @Y02668P 00314003
*     A JES3 CONSOLE ASSOCIATED WITH AN MCS CONSOLE.           @Y02668P 00315003
*                                                                       00317003
*     1.  EXAMINE THE VERB IN THE OPERAND FIELD, POINTED TO BY   Y02669 00317903
*     THE XAL FIELD OF THE XSA.  THE VALID VERBS ARE 'TR', 'K',  Y02669 00318803
*     'D' AND 'NONE'.  IF NONE IS FOUND, CONTROL PASSES TO EXIT  Y02669 00319703
*     RCTMEXT TO BRANCH TO IEE6403D TO PROCESS A POSSIBLE REF    Y02669 00320603
*     OPERAND OR ISSUE AN ERROR MESSAGE.                         Y02669 00321503
*                                                                       00322403
*     2.  SCAN THE OPERANDS ON THE VERB. THE VALID OPERANDS, AND Y02669 00323303
*     THE ASSOCIATED VERBS, ARE AS FOLLOWS:                      Y02669 00324203
*          D                 K                 TR                Y02669 00325103
*       *******           *******           ********             Y02669 00326003
*          A                NONE               A                 Y02669 00327003
*          C                                                     Y02669 00327703
*          D                                                   @Z40BPSV 00327840
*          M                                                     Y02669 00328403
*          S                                                   @G17SPTJ 00329241
*          U                                                     Y02669 00330003
*       CONSOLES                                                 Y02669 00332003
*        3850                                                  @Z40LPTA 00332240
*        DUMP                                                  @G33CPMR 00332643
*                                                                       00333003
*                                                                       00334002
*     IF AN INVALID OPERAND IS FOUND, CONTROL PASSES TO THE      Y02669 00335003
*     ERROR EXIT TO ISSUE THE MESSSGE INDICATED THERE.           Y02669 00335903
*                                                                       00336803
*     3.  ONCE THE VERB'S OPERANDS ARE SCANNED, SEARCH FOR THE   Y02669 00337703
*     ROUTING OPERAND (L=). IF IT IS FOUND, THE CONSOLE AND AREA Y02669 00338603
*     SPECIFICATIONS ARE VALIDITY CHECKED, ALONG WITH THE        Y02669 00339503
*     AUTHORITY OF THE ISSUING CONSOLE TO USE THE ROUTING        Y02669 00340403
*     OPERAND.  FAILURES IN THIS CHECKING CAUSE CONTROL TO PASS  Y02669 00341303
*        3850                                                  @Z40LPTA 00341740
*     OTHERWISE, THE ROUTING INFORMATION IS SAVED IN THE XSA     Y02669 00343203
*     (XASCID FIELD) FOR LATER USE.                              Y02669 00344203
*                                                                       00346003
*     4.  AFTER OBTAINING THE LOCAL AND CMS LOCKS, THE UCME      Y02651 00346903
*     OF THE ISSUING CONSOLE IS CHECKED TO DETERMINE IF AN       Y02669 00347803
*     RCT ALREADY EXISTS FOR THAT CONSOLE. IF NOT, BRANCH ENTER  Y02651 00348703
*     CONDITIONAL GETMAIN FOR 48 BYTES FROM SUBPOOL 241,         Y02669 00349603
*     TO OBTAIN STORAGE FOR AN RCT.  IF THE GETMAIN FAILS,       Y02669 00350503
*     CONTROL PASSES TO THE ERROR EXIT TO ISSUE THE              Y02669 00351403
*     MESSAGE INDICATED THERE.  IF THE GETMAIN IS SUCCESSFUL,    Y02669 00352303
*     PROCESSING CONTINUES AT STEP 7.  IF AN RCT ALREADY EXISTS, Y02669 00353203
*     PROCESSING CONTINUES WITH STEP 5.                          Y02669 00354103
*                                                                       00355003
*     5.  EACH OF THE FIVE SLOTS IN THE RCT IS CHECKED.  IF THE  Y02669 00355903
*     VERB AND OPERAND IN AN ENTRY MATCH THOSE BEING PROCESSED,  Y02669 00356803
*     THE ENTRY IS MARKED ACTIVE ( BIT RCTACT IN BYTE RCTCODE IS Y02669 00357703
*     SET ON), AND THE CONSOLE AND AREA ARE MOVED INTO THE RCT   Y02669 00358603
*     FROM THE XSA.  IF ANOTHER VERB APPEARS ON THE COMMAND,     Y02669 00359503
*     PROCESSING CONTINUES WITH STEP 1.  IF NO ROUTING OPERAND   Y02669 00360403
*     APPEARED WITH THIS COMMAND, THE ACTIVE BIT IS SET OFF.     Y02669 00361303
*     IF THE VERBS MATCH AND THE OPERANDS DO NOT, OR IF THE      Y02669 00362203
*     VERBS DO NOT MATCH, THE NEXT RCT ENTRY IS LOCATED AND      Y02669 00363103
*     TESTED, AS DESCRIBED ABOVE.                                Y02669 00364003
*                                                                       00364903
*     6.  HOWEVER, IF THE ENTRY JUST TESTED WAS THE LAST IN THIS Y02669 00365803
*     RCT, A TEST IS MADE TO DETERMINE IF THERE IS ANOTHER RCT   Y02669 00366703
*     CHAINED TO THE ONE JUST EXAMINED.  IF NONE EXISTS, STORAGE Y02669 00367603
*     IS OBTAINED FOR ONE AS DESCRIBED IN STEP 4, AND PROCESSING Y02669 00368503
*     CONTINUES WITH STEP 7.  IF ANOTHER RCT EXISTS, IT IS PRO-  Y02669 00369403
*     CESSED AS DESCRIBED IN STEP 5.                             Y02669 00370303
*                                                                       00371203
*     7.  THE FIRST ENTRY IN THE NEW RCT IS INITIALIZED AS       Y02669 00372103
*     DESCRIBED IN STEP 5, IN THE CASE WHERE THE VERB AND        Y02669 00373003
*     OPERAND MATCH.  IN ADDITION, THE END FLAG (BIT RCTEND IN   Y02669 00376203
*     BYTE RCTCODE) IS SET ON TO INDICATE THAT THIS IS THE LAST  Y02669 00377203
*     DEFINED ENTRY.                                             Y02669 00378303
*                                                                       00379303
*     8.  ONCE THE RCT IS SUCCESSFULLY UPDATED OR CREATED,       Y02669 00380303
*     THE CMS AND LOCAL LOCKS ARE RELEASED, AND CONTROL PASSED @YM4788P 00381103
*     TO IEE0503D TO ISSUE MESSAGE IEE712I VIA BRANCH.         @YM4788P 00382103
*                                                                       00383203
*     9.  IF THE OPERAND IS 'NONE', THIS IS A REQUEST TO DELETE  Y02669 00384603
*     ALL ROUTING DEFAULTS FOR THE ISSUING CONSOLE.  ONCE THE    Y02669 00386003
*     LOCAL AND CMS LOCKS HAVE BEEN OBTAINED, THE ADDRESS OF     Y02651 00386703
*     EACH RCT IS FOUND AND STORED IN THE XSA.  THE RCT POINTER  Y02669 00387403
*     IN THE UCME IS CLEARED.  THE LOCKS ARE THEN RELEASED, AND  Y02651 00388803
*     AND EACH RCT FOUND IS FREED VIA FREEMAIN.                  Y02669 00389503
*                                                                       00390203
*    10.  IF THE OPERAND IS 'CONT' AN INDICATOR IS TURNED ON   @Z40LPTA 00390340
*         IN THE XSA. IF THIS IS THE LAST OPERAND, CONTROL IS  @Z40LPTA 00390440
*         PASSED TO EXIT RCTMEXT TO BRANCH TO IEE6403D TO      @Z40LPTA 00390540
*         PROCESS THE OUTPUT. IF THIS IS NOT THE LAST OPERAND, @Z40LPTA 00390640
*         THE REMAINING BUFFER IS SCANNED FOR ADDITIONAL       @Z40LPTA 00390740
*         OPERANDS.(REF 2)                                     @Z40LPTA 00390840
*                                                                       00390940
*  NOTES =                                                       Y02669 00391603
*     CHARACTER CODE DEPENDENCIES =  THIS MODULE HAS BEEN CODED  Y02669 00393003
*     IN SUCH A WAY THAT IF THE EXTERNAL CHARACTER SET IS        Y02669 00393703
*     CHANGED FROM EBCDIC, REASSEMBLY WILL YIELD A VALID MODULE, Y02669 00394403
*     WITH THE FOLLOWING EXCEPTIONS:                             Y02669 00395803
*                                                                       00396503
*     THE CODE REPRESENTATION OF DECIMAL DIGITS MUST HAVE THE    Y02669 00397203
*     FOUR HIGH ORDER BITS 'ON'.  (I.E. X'FZ', WHERE Z IS ANY    Y02669 00398603
*     HEX DIGIT.)                                                Y02669 00400003
*                                                                       00400703
*     THE ALPHABETIC CHARACTERS MUST BE IN COLLATING SEQUENCE.   Y02669 00401403
*                                                                       00402803
*     IF EITHER OR BOTH OF THE ABOVE CHANGES, THE TEST FOR THE   Y02669 00403203
*     VALIDITY OF THE VALUE OF THE ROUTING LOCATION OPERAND (L)  Y02669 00404203
*     MUST BE RECODED.                                           Y02669 00405603
*                                                                       00407002
*     RCT'S ARE FREED ONLY IN RESPONSE TO 'MSGRT NONE'.          Y02669 00407703
*                                                                       00408403
*     DEPENDENCIES =  GETMAIN, MSGRT COMMAND TO BE VALID ONLY    Y02669 00409803
*                     FROM A CONSOLE, SETLOCK                    Y02651 00410503
*                                                                       00411203
*     RESTRICTIONS =  THIS MODULE EXPECTS REGISTER TWO TO CON-   Y02669 00412603
*     TAIN THE ADDRESS OF AN XSA.                                Y02669 00414003
*                                                                       00415003
*     REGISTER CONVENTIONS =  SEE REGISTER USAGE                 Y02669 00416003
*                                                                       00417003
*     PATCH LABEL =  PATCH                                       Y02669 00418003
*                                                                       00419003
*  MODULE TYPE =  CSECT                                          Y02669 00420003
*                                                                       00421003
*     PROCESSOR =  ASSEM                                         Y02669 00422003
*                                                                       00423003
*     MODULE SIZE = X'611'                                     @G33CPMR 00423143
*                                                                       00425002
*     ATTRIBUTES =  SUPERVISOR MODE            REENTRANT         Y02669 00426003
*                   ZERO PSW PROTECT KEY       PAGED LPA         Y02669 00427003
*                                                                       00428003
*  ENTRY POINT =  IEE6303D, FROM IEE0403D                        Y02669 00429003
*                                                                       00430003
*     PURPOSE =  TO SYNTAX CHECK AND PROCESS THE MSGRT COMMAND   Y02669 00431003
*                                                                       00432003
*     LINKAGE =  BRANCH FROM IEE0403D                            Y02669 00433003
*                                                                       00434002
*     INPUT =  REGISTER TWO CONTAINS THE ADDRESS OF AN XSA       Y02669 00435003
*     INITIALIZED AS FOLLOWS:                                    Y02669 00435803
*                                                                       00436603
*     XAL     CONTAINS THE ADDRESS OF THE FIRST OPERAND          Y02669 00437403
*     XAU     CONSOLE ID                                         Y02669 00438203
*     XAV     COMMAND VERB (MR OR MSGRT)                         Y02669 00440003
*     XAE     MESSAGE INDEX  (X'00')                             Y02669 00440803
*                                                                       00441603
*     OUTPUT =  N/A                                              Y02669 00442403
*                                                                       00443203
*     REGISTERS SAVED =  NONE                                    Y02669 00444203
*                                                                       00445103
*     REGISTER USAGE =                                           Y02669 00446103
*     REGISTER 0         WORK REGISTER                           Y02669 00447103
*     REGISTER 1         WORK REGISTER                           Y02669 00448103
*     REGISTER 2         XSA BASE                                Y02669 00449103
*     REGISTER 3         END OF SYNTAX SCAN ADDRESS              Y02669 00450103
*     REGISTER 4         WORK REGISTER                           Y02669 00451103
*     REGISTER 5         WORK REGISTER                           Y02669 00452103
*     REGISTER 6         WORK REGISTER                           Y02669 00453103
*     REGISTER 7         UCME BASE                               Y02669 00454103
*     REGISTER 8         RCT BASE                                Y02669 00455103
*     REGISTER 9         UCM BASE                                Y02669 00456103
*     REGISTER 10        CVT BASE                                Y02669 00457103
*     REGISTER 11        OPERAND POINTER, FROM XSA               Y02669 00458103
*     REGISTER 12        MODULE BASE                             Y02669 00459103
*     REGISTER 13        SAVE REGISTER                           Y02669 00460103
*     REGISTER 14        RETURN REGISTER                         Y02669 00461103
*     REGISTER 15        LINK REGISTER                           Y02669 00462103
*                                                                       00463103
*     FOR THE BRANCH ENTRY TO GETMAIN, REGISTER USAGE IS:        Y02651 00464103
*                                                                       00466002
*     REGISTER 0         LENGTH OF RCT                           Y02651 00486402
*     REGISTER 1         ADDRESS OF STORAGE GOTTEN               Y02651 00486602
*     REGISTER 3         USED BY MACRO                           Y02651 00487002
*     REGISTER 4         TCB ADDRESS                             Y02651 00487202
*     REGISTER 7         ASCB ADDRESS                            Y02651 00487402
*     REGISTER 14        RETURN ADDRESS IN MODULE                Y02651 00487602
*     REGISTER 15        ENTRY POINT OF GETMAIN                  Y02651 00487802
*                                                                       00488002
*     REGISTERS RESTORED =  NONE                                 Y02669 00506902
*                                                                       00527202
*  EXIT-NORMAL =  RET                                            Y02669 00547502
*                                                                       00567802
*     CONDITIONS =  THE RCT HAS BEEN SUCCESSFULLY CREATED OR     Y02669 00588102
*     UPDATED.  THE CMS AND LOCAL LOCKS ARE FREED AND CONTROL    Y02651 00608402
*     IS RETURNED VIA A BRANCH TO THE ADDRESS IN REGISTER 14.    Y02669 00628702
*                                                                       00649002
*     OUTPUT DATA =                                            @YM4788P 00669302
*     RCT            UPDATED OR INITIALIZED                    @YM4788P 00674302
*     REGISTER 2     ADDRESS OF XSA CONTAINING                 @YM4788P 00679302
*     XAE            MESSAGE CODE X'03'                        @YM4788P 00684302
*     XAV            COMMAND VERB (MSGRT)                      @YM4788P 00689602
*     XAU            CONSOLE ID FOR WTO                        @YM4788P 00695602
*                                                                       00701602
*     RETURN CODES =  NONE                                       Y02669 00709902
*                                                                       00730202
*  EXIT-NORMAL =  RCTMEXT                                        Y02669 00750502
*                                                                       00770802
*     CONDITIONS =  THE MR VERB IS NEITHER 'D', NOR 'K',         Y02669 00791102
*     NOR 'TR';  AFTER RELEASING THE CMS AND LOCAL LOCKS, IF     Y02651 00811402
*     HELD, CONTROL IS PASSED VIA BRANCH ON VCON TO              Y02669 00831702
*     IEE6403D TO CHECK FOR AND PROCESS THE 'REF' OPERAND.       Y02669 00852002
*     OR THE 'CONT' INDICATOR IN THE XSA.                      @Z40LPTA 00862040
*                                                                       00872302
*     OUTPUT DATA =                                              Y02669 00892602
*     REGISTER 2                ADDRESS OF XSA                   Y02669 00912902
*     LSTR(REGISTER 11)         ADDRESS OF MR VERB               Y02669 00933202
*     XASSDS(BIT XASPRF1)       'ON', IF A PARENTHESIS APPEARED  Y02669 00953502
*                               FIRST IN THE OPERAND FIELD       Y02669 00973802
*     XAL                       IDENTICAL TO LSTR                Y02669 00994102
*     XAV                       COMMAND VERB (MR OR MSGRT)       Y02669 01014402
*                                                                       01034702
*     RETURN CODES =  NONE                                       Y02669 01055002
*                                                                       01075302
*  EXIT-ERROR =  ERROR                                           Y02669 01095602
*                                                                       01115902
*     CONDITIONS =  A DELIMITER (BLANK, PARENTHESIS, OR COMMA)   Y02669 01136202
*     IS NOT FOUND WHERE EXPECTED, PARENTHESES ARE NOT BALANCED  Y02669 01156502
*     AROUND AN MR VERB-OPERAND PAIR (E.G. 'D=A)'), OR MORE THAN Y02669 01176802
*     THREE CHARACTERS FOLLOW THE ROUTING LOCATION PARAMETER     Y02669 01197102
*     (E.G. 'L=123Z').  EXIT IS TAKEN VIA BRANCH ON VCON TO      Y02669 01217402
*     CAUSE MESSAGE IEE156I TO BE ISSUED BY IEE5603D.            Y02669 01237702
*                                                                       01258002
*     OUTPUT DATA =                                              Y02669 01278302
*     WRK6(REGISTER 6)     ADDRESS OF LAST PARAMETER EXAMINED    Y02669 01298602
*     REGISTER 2           ADDRESS OF XSA CONTAINING             Y02669 01318902
*     XAE                  MESSAGE CODE X'04'                    Y02669 01339202
*     XAV                  COMMAND VERB (MR OR MSGRT)            Y02669 01359502
*     XAU                  CONSOLE ID FOR WTO                    Y02669 01379802
*                                                                       01400102
*     RETURN CODES =  NONE                                       Y02669 01420402
*                                                                       01440702
*  EXIT-ERROR =  ERROR1                                          Y02669 01461002
*                                                                       01481302
*     CONDITIONS =  THE AREA ID ON THE 'L' OPERAND IS NOT A      Y02669 01501602
*     A VALID CHARACTER.                                         Y02669 01521902
*     EXIT IS TAKEN VIA BRANCH ON VCON TO IEE6403D TO SET UP THE Y02669 01542202
*     INTERFACE TO CAUSE IEE5603D TO ISSUE MESSAGE IEE926I.      Y02669 01562502
*                                                                       01582802
*     OUTPUT DATA =  REGISTER TWO POINTS TO AN XSA CONTAINING:   Y02669 01603102
*     XAE                  MESSAGE CODE X'0C'                    Y02669 01623402
*     XAV                  COMMAND VERB (MR OR MSGRT)            Y02669 01643702
*     XAU                  CONSOLE ID FOR WTO                    Y02669 01664002
*     XASTSAVE             SUPPLEMENTARY MESSAGE CODE X'12'      Y02669 01684302
*                          FOR IEE5903D ('NOT AN AREA' SUFFIX)   Y02669 01704602
*                                                                       01724902
*     RETURN CODES =  NONE                                       Y02669 01745202
*                                                                       01765502
*  EXIT-ERROR =  ERROR2                                          Y02669 01785802
*                                                                       01806102
*     CONDITIONS =  THE MR VERB 'K' WAS SPECIFIED FROM A CRT     Y02669 01826402
*     CONSOLE.                                                   Y02669 01846702
*     EXIT IS TAKEN VIA BRANCH ON VCON TO IEE6403D TO SET UP THE Y02669 01867002
*     INTERFACE TO CAUSE IEE5603D TO ISSUE MESSAGE IEE925I.      Y02669 01887302
*                                                                       01907602
*     OUTPUT DATA =  REGISTER TWO POINTS TO AN XSA CONTAINING:   Y02669 01927902
*     XAE                  MESSAGE CODE X'0B'                    Y02669 01948202
*     XAV                  COMMAND VERB (MR OR MSGRT)            Y02669 01968502
*     XAU                  CONSOLE ID FOR WTO                    Y02669 01988802
*     WRK6                 ADDRESS OF 'K ' OR 'K,' IN COMMAND    Y02669 02009102
*                          BUFFER FOR MESSAGE                    Y02669 02029402
*     (XASTSAVE WILL BE SET TO X'1B' BY IEE6403D TO CAUSE        Y02669 02049702
*     IEE5903D TO ADD 'FOR NON CRT ONLY' TO THE MESSAGE)         Y02669 02070002
*                                                                       02090302
*     RETURN CODES =  NONE.                                      Y02669 02110602
*                                                                       02130902
*  EXIT-ERROR =  ERROR3                                          Y02669 02151202
*                                                                       02171502
*     CONDITIONS =  CONDITIONAL GETMAIN FOR 48 BYTE RCT FAILED.  Y02669 02191802
*     AFTER RELEASEING THE CMS AND LOCAL LOCKS, EXIT IS TAKEN    Y02651 02212102
*     VIA BRANCH ON VCON TO IEE6403D TO SET UP THE               Y02669 02232402
*     INTERFACE TO CAUSE IEE5603D TO ISSUE MESSAGE IEE931I.      Y02669 02252702
*                                                                       02273002
*     OUTPUT DATA =  REGISTER TWO POINTS TO AN XSA CONTAINING:   Y02669 02293302
*     XAE                  MESSAGE CODE X'0E'                    Y02669 02313602
*     XAV                  COMMAND VERB (MR OR MSGRT)            Y02669 02333902
*     XAU                  CONSOLE ID FOR WTO                    Y02669 02354202
*                                                                       02374502
*     RETURN CODES =  NONE.                                      Y02669 02394802
*                                                                       02415102
*  EXIT-ERROR =  ERROR4                                          Y02669 02435402
*                                                                       02455702
*     CONDITIONS =  CONSOLE ID SPECIFIED ON ROUTING OPERAND      Y02669 02476002
*     IS NOT THAT OF ANY CONSOLE IN THE SYSTEM.                  Y02669 02496302
*     EXIT IS TAKEN VIA BRANCH ON VCON TO IEE6403D TO SET UP THE Y02669 02516602
*     INTERFACE TO CAUSE IEE5603D TO ISSUE MESSAGE IEE926I.      Y02669 02536902
*                                                                       02557202
*     OUTPUT DATA =  REGISTER TWO POINTS TO AN XSA CONTAINING:   Y02669 02577502
*     XAE                  MESSAGE CODE X'0C'                    Y02669 02597802
*     XAV                  COMMAND VERB (MR OR MSGRT)            Y02669 02618102
*     XAU                  CONSOLE ID FOR WTO                    Y02669 02638402
*     XASTSAVE             SUPPLEMENTARY MESSAGE CODE X'13'      Y02669 02658702
*                          FOR IEE5903D ('NOT A CONSOLE' SUFFIX) Y02669 02679002
*                                                                       02699302
*     RETURN CODES =  NONE                                       Y02669 02719602
*                                                                       02739902
*  EXIT-ERROR =  ERROR6                                          Y02669 02760202
*                                                                       02780502
*     CONDITIONS =  ISSUING CONSOLE DOES NOT HAVE AUTHORITY TO   Y02669 02800802
*     SPECIFY ROUTING OPERAND.  (I.E. IT DOES NOT HAVE AUTHORITY Y02669 02821102
*     X'20'.)                                                    Y02669 02841402
*     EXIT IS TAKEN VIA BRANCH ON VCON TO IEE6403D TO SET UP THE Y02669 02861702
*     INTERFACE TO CAUSE IEE5603D TO ISSUE MESSAGE IEE345I.      Y02669 02882002
*                                                                       02902302
*     OUTPUT DATA =  REGISTER TWO POINTS TO AN XSA CONTAINING:   Y02669 02922602
*     XAE                  MESSAGE CODE X'08'                    Y02669 02942902
*     XAV                  COMMAND VERB (MR OR MSGRT)            Y02669 02963202
*     XAU                  CONSOLE ID FOR WTO                    Y02669 02983502
*                                                                       03003802
*     RETURN CODES =  NONE.                                      Y02669 03024102
*                                                                       03024503
*  EXIT-ERROR = ERROR8                                         @Y02668P 03024903
*                                                              @Y02668P 03025103
*     CONDITIONS = CONSOLE ID SPECIFIED ON THE ROUTING OPERAND @Y02668P 03025303
*                  IS THAT OF A JES3-ONLY CONSOLE. EXIT IS     @Y02668P 03025703
*                  TAKEN VIA BRANCH ON VCON TO IEE6403D TO SET @Y02668P 03026103
*                  UP THE INTERFACE TO CAUSE IEE5603D TO ISSUE @Y02668P 03026503
*                  MESSAGE IEE926I.                            @Y02668P 03026903
*                                                                       03027303
*     OUTPUT DATA = REGISTER TWO POINTS TO AN XSA CONTAINING   @Y02668P 03028103
*     XAE              MESSAGE CODE X'0C'                      @Y02668P 03029103
*     XAV              COMMAND VERB (MR OR MSGRT)              @Y02668P 03030103
*     XAU              CONSOLE ID FOR WTO                      @Y02668P 03031103
*     XASTSAVE         SUPPLEMENTARY MESSAGE CODE X'1F' FOR    @Y02668P 03032103
*                      FOR IEE5903D ('JES3-ONLY CONSOLE')      @Y02668P 03033103
*     XASTOPR          POINTER TO INVALID OPERAND              @Y02668P 03034103
*                                                              @YM2776P 03039103
* EXIT-ERROR =  RET                                            @YM2776P 03040103
*                                                              @YM2776P 03044403
*    CONDITIONS =  XAU IS ZERO. THUS, MSGRT IS UNABLE TO       @YM2776P 03047403
*                  DETERMINE WHAT CONSOLE'S RCT TO PROCESS.    @YM2776P 03053403
*                  CONDITION ORDINARILY ARISES FOR COMMANDS    @YM2776P 03056403
*                  IN SYS1.PARMLIB.                            @YM2776P 03059403
*                  EXIT IS TAKEN VIA A BRANCH TO THE ADDRESS   @YM2776P 03064703
*                  IN REGISTER 14.                             @YM2776P 03068703
*                                                              @YM2776P 03072703
*    OUTPUT DATA =  NONE                                       @YM2776P 03076703
*                                                              @YM2776P 03080703
*    RETURN CODES =  NONE                                      @YM2776P 03085003
*                                                                       03090003
*  EXTERNAL REFERENCES =                                         Y02669 03095003
*                                                                       03100003
*     ROUTINES =  IEE6403D - TO SET UP FOR ISSUING MESSAGES AND  Y02669 03105302
*                            TO PROCESS THE 'REF' OPERAND, VIA   Y02669 03125602
*                            BRANCH.                             Y02669 03145902
*                 IEE0503D - TO ISSUE MESSAGE IEE712I          @YM4788P 03155902
*                                                                       03166202
*     DATA AREAS =  NONE                                         Y02669 03186502
*                                                                       03206802
*     CONTROL BLOCKS =                                           Y02669 03227102
*     RCT    C,R,W,D                                             Y02669 03247402
*     XSA    R,W                                                 Y02669 03267702
*     UCM    R,W                                                 Y02669 03288002
*     CVT    R                                                   Y02669 03308302
*     PTRS   R                                                   Y02651 03328602
*                                                                       03348902
*     KEY:  C=CREATE,D=DELETE,R=READ,W=WRITE                     Y02669 03369202
*                                                                       03389502
*     TABLES =  OPTAB - VALID MAJOR OPERANDS OF TRACK AND        Y02669 03409802
*               DISPLAY COMMANDS                                 Y02669 03430102
*                                                                       03450402
*     MACROS =  GETMAIN, MODID, CVT, IEECUCM, IEEXSA,            Y02669 03470702
*     IEECVMAP RCT, SETLOCK, IHAPSA, IEFPTRS, FREEMAIN           Y02651 03491002
*        SERIALIZATION =                                         Y02651 03511302
*        LOCKS HELD =  CMS, LOCAL                                Y02651 03531602
*                                                                       03551902
*  CHANGE ACTIVITY =  Y02651, Y02669, @YM2776P, @YM0428P       @YM2776P 03572202
*                     @YM4296P, @YM4787P, @YM4788P, @Y02668P   @Y02668P 03582203
*                     @Z40LPTA, @Z40BPSV, @ZA07152, @ZA09261   @ZA09261 03582741
*                     @G17SPTJ, @G33CPMR                       @G33CPMR 03585743
*                                                                       03592502
          EJECT                                                         03612802
*  MESSAGES =                                                    Y02669 03633102
*        CODES                      TEXT                         Y02669 03653402
*   XAE   XASTSAVE                                               Y02669 03673702
*  X'0C'   X'12'      IEE926I (VERB) L=CCA OPERAND INVALID-      Y02669 03694002
*                     (AREAID) NOT AN AREA                       Y02669 03714302
*  X'04'   N/A        IEE156I (VERB) INVALID OPERAND- (OPERAND)  Y02669 03734602
*  X'0B'   N/A        IEE925I (VERB) OPERAND K FOR NON CRT ONLY  Y02669 03754902
*         (X'1B' SET                                             Y02669 03775202
*          BY IEE6403D)                                          Y02669 03795502
*  X'0E'   N/A        IEE931I (VERB) (OPERAND) INSUFFICIENT      Y02669 03815802
*                     STORAGE FOR COMMAND  (IF THE COMMAND IS    Y02669 03836102
*                     'MR D=A', OPERAND IS 'A')                  Y02669 03856402
*  X'0C'   X'13'      IEE926I (VERB) L=CCA OPERAND INVALID-      Y02669 03876702
*                     (CONSID) NOT A CONSOLE                     Y02669 03897002
*  X'08'   N/A        IEE345I (VERB) AUTHORITY INVALID           Y02669 03917302
*  X'03'   N/A        IEE712I MSGRT PROCESSING COMPLETE        @YM4788P 03927302
*  X'0C'   X'1F'      IEE926I (VERB) L=CCA OPERAND INVALID-    @Y02668P 03930303
*                     (CONSID) SUBSYSTEM CONSOLE               @Y02668P 03933303
*                                                                       03937602
*  MESSAGE IEE712I IS ISSUED FROM IEE0503D. OTHERWISE,         @YM4788P 03947602
*  ALL MAJOR TEXT CONTAINED IN IEE5603D.  IF NO MINOR TEXT, THE  Y02669 03957902
*  MESSAGE IS ISSUED FROM THERE.  IF THERE IS MINOR TEXT (SUFFIX)Y02669 03978202
*  IT IS CONTAINED IN IEE5903D, AND THE MESSAGE IS ISSUED FROM   Y02669 03998502
*  THERE.                                                        Y02669 04018802
*                                                                       04039102
*  ABEND CODES =  NONE.                                          Y02669 04059402
*                                                                       04079702
*********************************************************************** 04100001
        EJECT                                                           04200001
IEE6303D CSECT                                                          04300001
* THIS APAR WRITTEN TO SUPPORT MSS 'D 3850' S/C Z40LPTA        @ZA07152 04330040
* C (NEWENBK) APPROX 411000                                    @ZA09261 04350040
* A - CODE ADDED TO SUPPORT 'DISPLAY DUMP'                     @G33CPMR 04370043
********                                                              * 04400001
******** REGISTER EQUATES                                             * 04500001
********                                                              * 04600001
WRK0     EQU   0                   WORK REGISTER                        04700001
WRK1     EQU   1                   WORK REGISTER                        04800001
XSAR     EQU   2                   BASE REGISTER FOR THE XSA            04900001
CDRR     EQU   3                   END OF SYNTAX SCAN ADDRESS           04950001
WRK4     EQU   4                   WORK REGISTER                        05000002
WRK5     EQU   5                   WORK REGISTER                        05100002
WRK6     EQU   6                   WORK REGISTER                        05300001
ENTR     EQU   7                   BASE REGISTER FOR UCM ENTRIES        05400001
RCTR     EQU   8                   BASE REGISTER FOR THE RCT            05500001
UCMR     EQU   9                   BASE REGISTER FOR THE UCM            05600001
CVTR     EQU   10                  BASE REGISTER FOR THE CVT            05700001
LSTR     EQU   11                  LIST POINTER FROM XSA                05800001
BASR     EQU   12                  ROUTINE BASE REGISTER                05900001
SAVR     EQU   13                  SAVE REGISTER                        06000001
RETR     EQU   14                  RETURN REGISTER                      06100001
LNKR     EQU   15                  LINK REGISTER                        06200001
         EJECT                                                          06250001
********                                                              * 06300001
******** OTHER EQUATES                                                * 06400001
********                                                              * 06500001
N0       EQU   0                   NUMBER CONSTANT                      06600001
N1       EQU   1                   NUMBER CONSTANT                      06700001
N2       EQU   2                   NUMBER CONSTANT                      06800001
N3       EQU   3                   NUMBER CONSTANT                      06900001
N4       EQU   4                   NUMBER CONSTANT                      07000001
N5       EQU   5                   NUMBER CONSTANT                      07100001
N6       EQU   6                   NUMBER CONSTANT                      07200001
N7       EQU   7                   NUMBER CONSTANT                      07300001
N8       EQU   8                   NUMBER CONSTANT                      07400001
N9       EQU   9                   NUMBER CONSTANT                      07500001
N10      EQU   10                  NUMBER CONSTANT                      07600001
N11      EQU   11                  NUMBER CONSTANT                      07700001
N12      EQU   12                  NUMBER CONSTANT                      07800001
N16      EQU   16                  NUMBER CONSTANT               Y02669 07850002
CA       EQU   C'A'                A CONSTANT                           07900001
CI       EQU   C'I'                I CONSTANT                           08000001
CJ       EQU   C'J'                J CONSTANT                           08100001
CR       EQU   C'R'                R CONSTANT                           08200001
CS       EQU   C'S'                S CONSTANT                           08300001
CZ       EQU   C'Z'                Z CONSTANT                           08400001
COMMA    EQU   C','                COMMA CHARACTER                      08500001
PARA2    EQU   C')'                PARENTHSIS CONSTANT                  08600001
PARA1    EQU   C'('                PARENTHSIS CONSTANT                  08700001
BLK      EQU   C' '                BLANK CONSTANT                Y02669 08800002
TF       EQU   X'FF'               FLAG TO TURN OF SWITCHES             08900001
SUBP     EQU   241                 SUBPOOL FOR RCT SECTIONS      Y02669 09000002
XF0      EQU   X'F0'               NUMBER ZONE                          09100001
ASTRICK  EQU   X'5C'               AREA ID SPECIAL FILLER      @Z40LPTA 09150040
EQUAL    EQU   C'='                EQUAL CONSTANT                       09200001
LOPER    EQU   C'L'                L CONSTANT                           09300001
KCDR     EQU   C'K'                K CONSTANT                           09400001
CHARC    EQU   C'C'                LETTER CONSTANT               Y02669 09501002
CHARO    EQU   C'O'                LETTER CONSTANT                      09600001
CHARP    EQU   C'P'                LETTER CONSTANT             @G33CPMR 09700043
CHARD    EQU   C'D'                LETTER CONSTANT             @G33CPMR 09730043
ZERO     EQU   X'00'               NUMBER CONSTANT                      09800001
RTCDR    EQU   X'94'               COMMAND CODE FOR ROUTE CDR           09900001
KERROR   EQU   X'0B'               ERROR CODE FOR CRT ONLY MSG          10100001
NCERROR  EQU   X'0E'               ERROR CODE FOR NO CORE MSG           10200001
LIERROR  EQU   X'0C'               ERROR CODE FOR L INVALID MSG         10300001
AIERROR  EQU   X'12'               SECOND ERROR CODE FOR AREA INVALID   10400001
CIERROR  EQU   X'13'               SECOND ERROR CODE FOR CONSOLE INVAL  10500001
JIERROR  EQU   X'1F'               SECOND ERROR CODE FOR       @Y02668P*10530003
                                   SUBSYSTEM CONSOLE INVALID   @Y02668P 10560003
RIERROR  EQU   X'08'               ERROR CODE FOR AUTHORITY INVALID     10600001
IOERROR  EQU   X'04'               ERROR CODE FOR INVALID OPERAND       10700001
IEE712I  EQU   X'03'             MESSAGE CODE FOR PROCESS CPLT @YM4788P 10750002
*********                                                             * 10800001
         EJECT                                                          11000001
*******************************************************************     11300001
         BALR  BASR,N0             SET PROGRAM BASE                     11400001
         USING *,BASR              ESTABLISH ADDRESSIBILITY             11500001
         MODID BRANCH=YES                                        Y01886 11550001
         USING DXSA,XSAR           ADDRESSIBILITY OF XSA                11600001
         L     CVTR,CVTPTR         ADDRESS OF CVT                       11700001
         USING DCVT,CVTR           ADDRESSIBILITY OF THE CVT            11800001
         L     UCMR,CVTCUCB        ADDRESS OF UCM FROM CVT              11900001
         USING UCM,UCMR            ADDRESSIBILITY OF THE UCM     Y02669 12000002
         XC    XAS(N4),XAS         CLEAR FLAG BYTES              Y02669 12001002
         CLI   XAU,ZERO            SYSTEM-ISSUED COMMAND?      @YM2776P 12091002
         BE    RET1                YES, EXIT                   @YM7698P 12181002
         L     WRK4,CVTTCBP        GET ADDR OF NEW/OLD PTRS    @Y02668P 12191003
         USING TCBASCB,WRK4        ADDRESSABILITY TO NEW/OLD   @Y02668P 12201003
         L     WRK4,TCBPTR         GET ADDR OF CALLER'S TCB    @Y02668P 12211003
         DROP  WRK4                RELEASE NEW/OLD ADDR'LITY   @Y02668P 12221003
         C     WRK4,UCMPXA         IS CALLER COMMTASK?         @Y02668P 12231003
         BE    COMMTASK            YES, AVOID SETTING JES3 BIT @Y02668P 12241003
         OI    XASSDS,XASSDS3      NO, INDICATE NON-COMMTASK   @Y02668P 12251003
*                                  CALLER                      @Y02668P 12261003
        SPACE 2                                                         12300002
*******************************************************************     12600001
COMMTASK EQU   *                   HERE TO AVOID BIT           @Y02668P 12650003
STARTSC  EQU   *                                                        12700002
         L     LSTR,XAL            POINTER TO COMMAND PARAMETERS        12800001
         LA    LSTR,N0(LSTR)       CLEAR HIGH ORDER BYTE         Y02669 12801002
         LTR   LSTR,LSTR           OPERAND PRESENT?              Y02669 12802002
         BZ    RCTMEXT             NO, DEFAULT TO MR REF         Y02669 12803002
         LA    WRK4,N1             ONE FOR SCAN INCREMENT AND BXLE      12900002
CONSCAN  EQU   *                                               @Z40LPTA 12950040
         CLI   N0(LSTR),PARA1      IS THERE MORE THEN ONE VERB          13100001
         BNE   TESTVB              BRANCH NO                            13200001
         OI    XASPLS3,XASPRF1     SET VERB PARENTHESIS FLAG  @Y02668P  13300003
         AR    LSTR,WRK4           INCREMENT OVER PARENTHESIS           13400002
         STCM  LSTR,7,XAL+N1       UPDATE LIST POINTER PAST   @YM4296P  13430002
*                                  PARENTHSIS                 @YM4296P  13460002
***                                                                   * 13700001
***   TEST FOR THE VERB OF THE MSGRT COMMAND                          * 13800001
***                                                                   * 13900001
         SPACE 2                                                        14000001
*******************************************************************     14200001
TESTVB   EQU   *                                                        14300001
         CLC   N0(N2,LSTR),DIS     IS THIS A DISPLAY VERB?              14400001
         BE    SCANCHK             BRANCH YES                    Y02669 14500002
         SPACE 2                                                        14600001
*******************************************************************     14800001
         CLC   N0(N3,LSTR),TR      IS THIS A TRACK VERB?         Y02669 14900002
         BE    TRCHK               BRANCH YES                    Y02669 15070002
         SPACE 2                                                        15080002
*******************************************************************     15090002
         CLC   N0(N5,LSTR),NONE    IS THIS NONE?                 Y02669 15092002
         BE    NONERTN             BRANCH YES                    Y02669 15094002
         CLC   N0(N4,LSTR),CONTOP  CONTINUATION OPERAND?       @Z40LPTA 15094340
         BNE   KCHECK              NO,CHECK NEXT               @Z40LPTA 15094640
         OI    XASSDS,XASSDS6      YES,SET 'CONT' FLAG         @Z40LPTA 15094940
         CLI   N4(LSTR),BLK     END OF COMMAND?                @Z40LPTA 15095240
         BE    RCTMEXT             YES,SET UP FOR LOAD 2       @Z40LPTA 15095540
         CLI   N4(LSTR),COMMA   MORE OPERANDS?                 @Z40LPTA 15095840
         BNE   ENDCHCK             NO, CHECK IF END OF BUFFER  @Z40LPTA 15096140
         LA    LSTR,N5(LSTR)       INCREMENT PAST 'CONT,'      @Z40LPTA 15096440
         B     CONSCAN             CONTINUE COMMAND SCAN       @Z40LPTA 15096740
ENDCHCK  EQU   *                                               @Z40LPTA 15097040
         L     ENTR,XAP            END OF BUFFER ADDR + 1      @Z40LPTA 15097340
         BCTR  ENTR,0              DECREMENT BY ONE            @Z40LPTA 15097640
         LR    RCTR,LSTR           SET UP FOR END OF BUFF TEST @Z40LPTA 15097940
         LA    RCTR,N3(RCTR)       BUMP TO OPERAND END         @Z40LPTA 15098240
         CR    ENTR,RCTR           AT END OF BUFFER?           @Z40LPTA 15098540
         BE    RCTMEXT             YES, GO TO LOAD 2           @Z40LPTA 15098840
         B     ERROR               NO, INVALID OPERAND         @Z40LPTA 15099140
         EJECT                                                          15100001
*******************************************************************     15300001
KCHECK   EQU   *                                               @Z40LPTA 15350040
         CLI   N0(LSTR),KCDR       IS THIS A CONTROL (K) VERB?          15400001
         BNE   RCTMEXT             BRANCH NO TO SECOND LOAD             15500001
         OI    XASPLS3,XASKFG      SET K COMMAND FLAG         @Y02668P  15600003
         LR    WRK6,LSTR           SAVE ADDRESS OF VERB IN K CDR        15700001
         B     KCDRCHK             BRANCH TO CHECK FOR L OPERAND        15800001
         SPACE 2                                                        15900001
*******************************************************************     16100001
SCANCHK  EQU   *                                                        16400001
         LA    LSTR,N2(LSTR)       INCREMENT TO FIRST VERB              16500001
         CLI   N0(LSTR),PARA1      IS THERE MORE THAN ONE VERB?         16600001
         BNE   DISTAB1             BRANCH NO                            16700001
         OI    XASPLS3,XASPRF2   SET OPERAND PARENTHESIS FLAG @Y02668P  16800003
         AR    LSTR,WRK4           INCREMENT TO FIRST OPERAND           16900002
DISTAB1  EQU   *                                                        17000001
         LR    WRK6,LSTR           SAVE ADDRESS OF FIRST OPERAND        17100001
***                                                                   * 17200001
***  TEST THE OPERANDS OF THE MSGRT (MR) VERBS                        * 17300001
***                                                                   * 17400001
DISTABS  EQU   *                                                        17500001
         TM    XASPLS3,XASTRFG     IS THIS A TRACK VERB?       @Y02668P 17600003
         BO    TRSCAN              BRANCH YES                    Y02669 17700002
         CLC   N0(N4,LSTR),D3850   THIS D 3850 COMMAND         @Z40LPTA 17710040
         BNE   TESTCONS            NO, CHECK FOR CONSOLES      @Z40LPTA 17720040
         LA    LSTR,N3(LSTR)       INCREMENT BUFFER PTR        @Z40LPTA 17730040
         B     DISCONS             CONTINUE SCAN OF BUFFER     @Z40LPTA 17740040
TESTCONS EQU   *                                               @Z40LPTA 17750040
         CLC   N0(N8,LSTR),CONSOLES IS VERB OPERAND EQUAL TO CONSOLES?  17800001
         BNE   TESTDUMP            BRANCH NO                   @G33CPMR 17850043
         MVI   N0(LSTR),CHARO      CHANGE C OF CONSOLES TO O FOR RCT    18000001
         LA    LSTR,N7(LSTR)       INCREMENT PAST OPERAND               18100001
         B     DISCONS             CONTINUE SCAN OF BUFFER     @G33CPMR 18150043
TESTDUMP EQU   *                                               @G33CPMR 18170043
         CLC   N0(N4,LSTR),DUMP    IS THIS 'D=DUMP'?           @G33CPMR 18190043
         BNE   DISSCAN             BRANCH NO                   @G33CPMR 18210043
         MVI   N0(LSTR),CHARP      CHANGE D OF DUMP TO P FOR RCT        18260043
         LA    LSTR,N3(LSTR)       INCREMENT BUFFER PTR        @G33CPMR 18280043
         SPACE 2                                                        18300043
*******************************************************************     18400001
DISCONS  EQU   *                                                        18500001
         AR    LSTR,WRK4           INCREMENT PAST OPERAND               18600002
         CLI   N0(LSTR),BLK        IS THIS THE END OF THE COMAND        18700001
         BE    ENDSCAN             BRANCH YES                           18800001
         CLI   N0(LSTR),COMMA      IS THERE ANOTHER OPERAND?            18900001
         BE    SINGLED             BRANCH YES                           19000001
         CLI   N0(LSTR),PARA2      IS THIS END OF THE OPERANDS?         19100001
         BNE   ERROR               BRANCH NO                            19200001
         TM    XASPLS3,XASPRF2     WAS THERE AN OPENING       @Y02668P  19300003
*                                             PARENTHESIS     @Y02668P  19350003
         BNO   PARCHK              BRANCH NO                            19400001
         EJECT                                                          19450001
KCDRCHK  EQU   *                                                        19500001
         AR    LSTR,WRK4           INCREMENT PAST PARENTHSIS            19600002
***                                                                   * 19700001
***  WHAT CHARACTER FOLLOWS THE CLOSING OPERAND PARENTHSIS            * 19800001
***                                                                   * 19900001
         CLI   N0(LSTR),BLK        IS THIS THE END?                     20000001
         BE    ENDSCAN             BRANCH YES                           20100001
         SPACE 1                                                        20200001
*******************************************************************     20400001
LCHECK   EQU   *                                                        20500001
         CLC   N0(N3,LSTR),CLEQUAL IS THIS THE LOCATION OPERAND?        20600001
         BNE   TESTEND             BRANCH NO                            20700001
         SPACE 1                                                        20800001
*******************************************************************     21000001
         OI    XASSDS,XASSDS2      INDICATE THAT A L=VERB EXITS  Y02669 21100002
         LA    LSTR,N3(LSTR)       INCREMENT AROUND L=                  21200001
         LR    WRK0,LSTR           SAVE ADDRESS OF L OPERAND            21300001
         LA    WRK5,N3(LSTR)       NUMBER OF PARAMETERS IN L=           21400002
LLOOP    EQU   *                                                        21500001
         CLI   N0(LSTR),BLK        IS THERE A BLANK?                    21600001
         BE    ENDSCAN             BRANCH YES                           21700001
         CLI   N0(LSTR),PARA2      IS THERE AN OPERAND PARENTHESIS?     21800001
         BE    ENDSCAN1            BRANCH YES                           21900001
         BXLE  LSTR,WRK4,LLOOP     INCREMENT LIST PTR AND TRY AGAIN     22000002
         LR    LSTR,WRK0           START OF L OPERAND FOR MSG    Y02669 22001002
         B     ERROR               BRANCH TO INVALID OPERAND MSG        22100001
TESTEND  EQU   *                                                        22200001
         CLI   N0(LSTR),PARA2      IS THIS THE END OF THE VERB?         22300001
         BNE   ERROR               BRANCH NO                            22400001
PARCHK   EQU   *                                                        22500001
         TM    XASPLS3,XASPRF1   WAS THERE A VERB PARENTHESIS @Y02668P  22600003
         BNO   ERROR               BRANCH NO                            22700001
ENDSCAN1 EQU   *                                                        22800001
         AR    LSTR,WRK4           INCREMENT LIST POINTER               22900002
ENDSCAN  EQU   *                                                        23000001
         CLI   N0(LSTR),BLK        IS THIS THE LAST MR VERB             23100001
         BNE   ENDSCAN2            BRANCH NO                            23200001
         NI    XASPLS3,TF-XASPRF1 TURN OFF VERB PARENTHSIS FLAG@Y02668P 23300003
ENDSCAN2 EQU   *                                                        23400001
         AR    LSTR,WRK4           INCREMENT LIST POINTER               23500002
         LR    CDRR,LSTR           SAVE SCAN END FOR VERB               23600001
         LR    LSTR,WRK0           BEGINNING OF L OPERAND               23700001
         SR    WRK1,WRK1           CLEAR REG FOR CONSOLE ID             23800001
         SR    WRK5,WRK5           CLEAR REG FOR CONSOLE ID             23900002
         IC    WRK5,XAU            SOURCE CONSOLE ID                    24000002
         STC   WRK5,XASCID         EQUALS TARGET CONSOLE ID             24100002
         TM    XASSDS,XASSDS2      IS A L OPERAND PRESENT        Y02669 24200002
         BNO   VALIDX              BRANCH NO                            24300001
         EJECT                                                          24350001
***                                                                   * 24400001
***   FOUND THE L= OPERAND AND NOW MUST CHECK IT FOR VALIDITY         * 24500001
***                                                                   * 24600001
         SPACE 1                                                        24700001
*******************************************************************     24900001
LFOUND   EQU   *                                                        25000001
         STCM  LSTR,7,XASOPTR      SAVE OPERAND ADDRESS        @YM4787P 25020002
*                                  FOR CURSOR POSITIONING      @YM4787P 25040002
*                                  IN POSSIBLE ERROR MSG       @YM4787P 25060002
         TM    N0(LSTR),XF0        IS THE FIRST CHAR  A NUMBER?         25100001
         BNO   STOREA              BRANCH NO                            25200001
         TM    N1(LSTR),XF0        IS THE SECOND CHAR A NUMBER?         25300001
         BO    TWODIGIT            BRANCH YES                           25400001
ONEDIGIT EQU   *                                                        25500001
         PACK  XAX(N8),N0(N1,LSTR) PACK CONSOLE ID IN XSA      @Z40LPTA 25600040
         AR    LSTR,WRK4           INCREMENT LIST POINTER               25700002
         B     CHECKCC             BRANCH TO CONVERT NUMBER             25800001
TWODIGIT EQU   *                                                        25900001
         PACK  XAX(N8),N0(N2,LSTR) PACK CONSOLE ID IN XSA      @Z40LPTA 26000040
         LA    LSTR,N2(LSTR)       INCREMENT LIST POINTER               26100001
CHECKCC  EQU   *                                                        26200001
         USING UCMLIST,ENTR        ADDRESSIBILITY OF UCM ENTRY          26300001
         CVB   WRK5,XAX        CONVERT CONSOLE ID TO BINARY    @Z40LPTA 26400040
         L     ENTR,UCMVEL         LAST UCM ENTRY                       26500001
         IC    WRK1,UCMID          CONSOLE ID FROM LAST ENTRY           26600001
         SPACE 1                                                        26700001
*******************************************************************     26900001
         STC   WRK5,XASCID         SAVE VALID CONSOLE ID IN XSA         27000002
         LTR   WRK5,WRK5           IS CONSOLE ID NON-POSITIVE?   Y02669 27001002
         BNP   ERROR4              YES, SET UP FOR MSG IEE926I   Y02669 27002002
         CLR   WRK5,WRK1           IS CONSOLE ID FROM CDR VALID         27100002
         BH    ERROR4              BRANCH NO                            27200001
         CLI   N0(LSTR),BLK        IS THIS THE END OF THE COMMAND?      27300001
         BE    VALIDX              BRANCH YES                           27400001
         CLI   N0(LSTR),PARA2      IS THIS THE END OF A VERB?           27500001
         BE    VALIDX              BRANCH NO                            27600002
***                                                                   * 27700001
***  IS AREA ID A VALID ALPHABETIC CHARACTER                          * 27800001
***                                                                   * 27900001
STOREA   EQU   *                                                        28000001
         MVC   XASDID(N1),N0(LSTR) SAVE VALID AREA ID IN XSA            28100001
         CLI   N0(LSTR),ASTRICK    THIS SPECIAL FILLER         @Z40LPTA 28130040
         BE    STOREA1             BRANCH YES                  @Z40LPTA 28160040
         CLI   N0(LSTR),CA         IS AREA ID EQUAL OR GREATER THAN A?  28200001
         BL    ERROR1              BRANCH NO                            28300001
         CLI   N0(LSTR),CI         IS AREA ID EQUAL OR LESS THAN I?     28400001
         BNH   STOREA1             BRANCH YES                           28500001
         CLI   N0(LSTR),CJ         IS AREA ID EQUAL OR GREATER THAN J   28600001
         BL    ERROR1              BRANCH NO                            28700001
         CLI   N0(LSTR),CR         IS AREA ID EQUAL OR LESS THAN R      28800001
         BNH   STOREA1             BRANCH YES                           28900001
         CLI   N0(LSTR),CS         IS AREA ID EQUAL OR GREATER THAN S   29000001
         BL    ERROR1              BRANCH NO                            29100001
         CLI   N0(LSTR),CZ         IS AREA ID EQUAL OR LESS THAN Z      29200001
         BH    ERROR1              BRANCH NO                            29300001
STOREA1  EQU   *                                                        29400001
         CLI   N1(LSTR),BLK        IS NEXT CHARACTER A BLANK            29500001
         BE    VALIDX              BRANCH YES                           29600001
         CLI   N1(LSTR),PARA2      IS NEXT CHARACTER A PARENTHSIS       29700001
         BNE   ERROR               BRANCH NO TO OPERAND                 29800001
VALIDX   EQU   *                                                        29900001
         LR    WRK1,WRK5           POSITION TARGET ID FOR      @Y02668P 29910003
*                                  FINDUCME                    @Y02668P 29920003
         BAL   LNKR,FINDUCME       GET TARGET UCME ADDRESS     @Y02668P 29930003
         TM    UCMDISP2,UCMDISPK   SUBSYSTEM CONSOLE?          @Y02668P 29940003
         BO    ERROR8              YES, ERROR                  @Y02668P 29950003
         SR    WRK1,WRK1           NO, SET UP FOR INSERT CHAR  @Y02668P 29970003
         IC    WRK1,XAU            GET SOURCE CONSOLE ID                30000001
         LR    LSTR,WRK1           SAVE SOURCE ID                       30100001
         BAL   LNKR,FINDUCME       GET ISSUING UCME ADDRESS      Y02669 30150002
         CR    LSTR,WRK5           IS SOURCE SAME AS TARGET             31200002
         BE    KCDRCK              BRANCH YES                           31300001
         TM    UCMAUTH,UCMAUTH3    DOES SOURCE CONSOLE HAVE AUTHORITY   31400001
*                                   TO ROUTINE (MUST HAVE CONS AUTH.)   31500001
         BZ    ERROR6              BRANCH NO                            31600001
KCDRCK   EQU   *                                                        31700001
         TM    XASPLS3,XASKFG      IS VERB A K COMMAND        @Y02668P  31800003
         BNO   TABLECK             BRANCH NO                            31900001
         TM    UCMDISP,UCMDISPC    IS CONSOLE A CRT?                    32000001
         BO    ERROR2              BRANCH YES TO ERROR MSG              32100001
         EJECT                                                          32200002
*******************************************************************     32400001
***   THE RCT ENTRIES ARE UPDATED, AND THE CHAIN EXTENDED, UNDER Y02651 32401002
***   THE PROTECTION OF THE LOCAL AND CMS LOCKS.  THIS SERIAL-   Y02651 32402002
***   IZATION IS NECESSARY TO PREVENT THE READING OF A PARTIALLY Y02651 32403002
***   COMPLETE, OR PARTIALLY ALTERED, RCT ENTRY BY THE ROUTING   Y02651 32404002
***   OPERAND PROCESSOR (IEE7503D).                              Y02651 32405002
***   ONCE LOCKS ARE ACQUIRED, A SWITCH IS SET TO PREVENT THE    Y02651 32405202
***   OVERHEAD OF REACQUISITION  FOR EACH MSGRT VERB-OPERAND.    Y02651 32405402
***   THIS IS NECESSARY SINCE, ONCE THE RCT UPDATE SUBROUTINE    Y02651 32405602
***   COMPLETES, IT RETURNS TO THE BUFFER SCAN ROUTINE TO        Y02651 32405802
***   PROCESS ANY ADDITIONAL MSGRT VERB-OPERANDS APPEARING IN    Y02651 32405902
***   THE BUFFER.                                                Y02651 32406902
*******************************************************************     32407902
     SPACE 2                                                            32457902
TABLECK  EQU   *                                                        32500001
         BAL   LNKR,GETLOCK        OBTAIN LOCAL AND CMS LOCKS    Y02651 32550002
         L     RCTR,UCMRCT         RCT ADDRESS FROM UCM ENTRY           32600001
         L     LSTR,XAL            BEGINNING OF VERB ADDRESS            32700001
         LA    RCTR,N0(RCTR)       ZERO FLAG BYTE                       32800001
         LTR   RCTR,RCTR           DOES A TABLE EXIST?                  32900002
         BNZ   TESTRCT             BRANCH YES                           33000001
         LA    RCTR,UCMRCT         ADDRESS OF RCT IN UCM                33100001
         EJECT                                                          33200001
*******************************************************************     33400001
STARTRCT EQU   *                                                        33500001
***                                                                   * 33600001
***   ROUTINE TO ISSUE GETMAIN FOR RCT SECTION                        * 33700001
***   BECAUSE THE LOCAL AND CMS LOCKS ARE HELD AT THIS POINT,  @YM00428 33750002
***   GETMAIN MUST BE BRANCH ENTERED.  IT IS REQUIRED TO BRANCH YM00428 33760002
***   ENTER GETMAIN THAT THE CMS AND LOCAL LOCKS BE HELD.      @YM00428 33770002
***                                                                   * 33800001
*******************************************************************     33810002
      SPACE 2                                                           33820002
         STM   XSAR,RETR,XASAVSTD  SAVE ALL REGS ACROSS BRANCH @YM00428 33850002
*                                  ENTRY TO GETMAIN            @YM00428 33950002
         L     WRK4,CVTTCBP        GET ADDR OF NEW/OLD POINTERS YM00428 34000002
         USING TCBASCB,WRK4        ADDRESSABILITY TO NEW/OLD   @YM00428 34010002
         L     ENTR,ASCBPTR        REG7: ADDR CURRENT ASCB     @YM00428 34020002
         L     WRK4,TCBPTR         REG4: ADDR CURRENT TCB      @YM00428 34030002
         DROP  WRK4                RELEASE NEW/OLD ADDR'LITY   @Y02668P 34040003
         LA    WRK0,RCTTEND-RCTBEG REG0: RCT SIZE FOR GETMAIN  @YM00428 34050002
         GETMAIN RC,LV=(0),SP=SUBP,BRANCH=YES GETMAIN RCT      @YM00428 34100002
         LM    XSAR,RETR,XASAVSTD  RESTORE REGS                @YM00428 34150002
         LTR   LNKR,LNKR           IS RETURN CODE NON ZERO?             34500001
         BNZ   ERROR3              BRANCH YES                           34600001
         USING DSTRCT,WRK5                                              34700002
         LR    WRK5,WRK1           ADDRESS OF NEW SECTION OF RCT Y02651 34800002
         XC    RCTBEG(RCTTEND-RCTBEG),RCTBEG CLEAR AREA GOTTEN FOR RCT  34900001
         OI    RCTENT6,RCTCON      SET CONTINUE FLAG IN SECTION         35000001
         DROP  WRK5                                                     35100002
         USING DSTRCT,RCTR         ADDRESSIBILITY OF RCT                35200001
       EJECT                                                            35250002
***                                                                   * 35300001
***   START BUILDING NEW ENTRIES IN THE RCT                           * 35400001
***                                                                   * 35500001
         STCM  WRK5,7,N1(RCTR)     ADDRESS OF RCT INTO UCM OR    Y02669 35600002
*                                  PREVIOUS RCT ON CHAIN         Y02669 35601002
         LR    RCTR,WRK5           ADDRESS OF CORE GOTTEN FOR RCT       35700002
         SPACE 2                                                        35800001
*******************************************************************     36000001
BUILDX   EQU   *                                                        36100001
         OI    RCTCODE,RCTEND       TURN ON END AND ACTIVE FLAG         36200001
VERBCOD  EQU   *                                                        36300001
         MVC   RCTVER(N2),N0(LSTR)  MOVE ROUTE VERB INTO RCT            36400001
         MVC   RCTOPD(N1),N0(WRK6) MOVE OPERAND INTO RCT                36600001
         SPACE 2                                                        36700001
*******************************************************************     36900001
MOVECA   EQU   *                                                        37000001
         NI    XASPLS3,TF-XASTRFG  CLEAR TRACK VERB SWITCH     @Z40LPTA 37050040
         OI    RCTCODE,RCTACT      SET ENTRY ACTIVE IN RCT              37100001
         MVC   RCTCID(N2),XASCID   MOVE CONSOLE AND AREA ID INTO RCT    37200001
         XC    XASDID,XASDID       CLEAR AREA FIELD            @Z40LPTA 37220040
         CLI   RCTAID,N0           AREA ID DEFINED             @Z40LPTA 37240040
         BNE   CONENT              YES, CONTINUE               @Z40LPTA 37260040
         MVI   RCTAID,ASTRICK      NO, SET SPECIAL FILLER      @Z40LPTA 37280040
         EJECT                                                          37300001
*******************************************************************     37500001
CONENT   EQU   *                                                        37600001
         TM    XASSDS,XASSDS2      IS A L OPERAND IN THIS COMMANDY02669 37700002
         BO    CONENT1             BRANCH YES AND LEAVE ACTIVE          37800001
         SPACE 2                                                        37900001
*******************************************************************     38100001
         NI    RCTCODE,TF-RCTACT   TURN OFF ACTIVE BIT IN RCT           38200001
CONENT1  EQU   *                                                        38300001
         CLI   N1(WRK6),COMMA      IS NEXT CHARACTER A COMMA?           38400001
         BE    NEWENBK             BRANCH EQUAL                         38500001
         CLI   N1(WRK6),PARA2      IS NEXT CHARACTER A PARENTHSIS?      38600001
         BE    OPEREND             BRANCH EQUAL                         38700001
         CLI   N1(WRK6),BLK        IS NEXT CHARACTER A BLANK            38800001
         BE    OPEREND             BRANCH YES                           38900001
         CLC   N0(N8,WRK6),OONSOLES CHECK FOR 'D=CONSOLES'     @G33CPMR*38910043
                                   INTERNAL REPRESENATION      @G33CPMR 38916043
         BE    SETCONS             YES, IT IS CONSOLES         @G33CPMR 38930043
         LA    WRK6,N3(WRK6)       BUMP PAST OPERAND           @Z40LPTA 38960040
         B     CONENT              BRANCH TO CONTINUE SCAN     @Z40LPTA 38980040
**                                                                    * 38990043
**   ALL OPERANDS ARE REPRESENTED BY THEIR FIRST CHARACTER EXCEPT:    * 39000043
** A) CONSOLE OPERAND WHICH IS REPRESENTED BY THE CHARACTER 'O'@G33CPMR 39100043
** B) DUMP OPERAND WHICH IS REPRESENTED BY THE CHARACTER 'P'   @G33CPMR 39200043
**                                                                    * 39230043
SETCONS  EQU   *                                               @Z40LPTA 39350040
         LA    WRK6,N7(WRK6)       INCREMENT AROUND OPERAND             39400001
         B     CONENT              BRANCH TO CONTINUE                   39500001
       SPACE 2                                                          39501002
*******************************************************************     39800001
OPEREND  EQU   *                                                        39900001
         TM    XASPLS3,XASPRF1     IS PARENTHSIS FLAG ON       @Y02668P 40000003
         BNO   RET                 NO, EXIT FROM MODULE          Y02669 40100002
         SPACE 2                                                        40501002
***      SET-UP TO PROCESS NEXT MSGRT VERB                       Y02669 40502002
*******************************************************************     40503002
         STCM  CDRR,7,XAL+N1       ADDRESS OF NEXT MSGRT VERB  @YM4296P 40700002
         NI    XASPLS3,TF-XASPRF1+XASPRF2  CLEAR PAREN FLAGS   @Z40LPTA 40750040
         B     STARTSC             BRANCH TO START FOR NEXT VERB        40800001
NEWENBK  EQU   *                                                        40900001
         TM    XASPLS3,XASPRF2    IS SECOND PARENTHSIS FLAG ON @Y02668P 41000003
         BNO   OPEREND             BRANCH NO TO END                     41100001
         MVC   XASDID(N1),RCTAID   RESTORE AREAID FOR MULTIPLE          41130040
*                                  DISPLAY OPERANDS.           @ZA09261 41160040
         LA    WRK6,N2(WRK6)       INCREMENT OPERAND POINTER            41200001
         L     RCTR,UCMRCT         STARTING ADDRESS OF RCT              41300001
         EJECT                                                          41350001
***                                                                   * 41400001
***  SEARCH RCT FOR AN EXISTING ENTRY AND OVERLAY CC AND A IF FOUND   * 41500001
***                                                                   * 41600001
         SPACE 2                                                        41700001
*******************************************************************     41900001
TESTRCT  EQU   *                                                        42000001
         CLC   RCTVER(N1),N0(LSTR) DOES VERB IN RCT EQUAL ROUTE VERB    42100001
         BE    CHKOPD              BRANCH YES                           42200001
INCRCT   EQU   *                                                        42300001
         TM    RCTCODE,RCTCON      IS THIS RCT ENTRY THE END OR CONT    42400001
         BO    NXTPTR              BRANCH YES IT IS CONTINUED           42500001
         BM    LDENT               BRANCH YES IT IS END                 42600001
         LA    RCTR,RCTLEN(RCTR)   INCREMENT TO NEXT RCT ENTRY          42700001
         B     TESTRCT             BRANCH TO TEST NEXT ENTRY            42800001
NXTPTR   EQU   *                                                        42900001
         L     RCTR,N0(RCTR)       LOAD ADDRESS OF NEW SECTION          43000001
         B     TESTRCT             BRANCH TO TEST NEXT ENTRY            43100001
CHKOPD   EQU   *                                                        43200001
         CLC   RCTOPD(N1),N0(WRK6) IS OPERANDS EQUAL TO ONE CHARACTER   43300001
         BNE   INCRCT              BRANCH NO TO CHECK NEXT ENTRY        43400001
         B     MOVECA              BRANCH TO INSERT NEW CC AND A        43500001
***                                                                   * 43600001
***  SEARCH RCT FOR NON ACTIVE ENTRIES OR BUILD A NEW ENTRY           * 43700001
***                                                                   * 43800001
         SPACE 2                                                        43900001
*******************************************************************     44200001
LDENT EQU   *                                                           44300001
         L     RCTR,UCMRCT         ADDRESS OF RCT FROM UCM              44400001
         SPACE 2                                                        44500001
*******************************************************************     44700001
SEARACT  EQU   *                                                        44800001
         TM    RCTCODE,RCTCON      IS THIS ENTRY THE END OR CONTINUED   44900001
         BO    NXTPTR1             BRANCH YES IT IS CONTINUED           45000001
         SPACE 2                                                        45100001
*******************************************************************     45300001
         TM    RCTCODE,RCTACT      IS THIS ENTRY ACTIVE                 45400001
         BNO   VERBCOD             BRANCH NO TO CONSTRUCT ENTRY         45500001
        EJECT                                                           45501002
*******************************************************************     45800001
         TM    RCTCODE,RCTEND      IS THIS ENTRY THE END                45900001
         BO    BUILD1              BRANCH YES IT IS THE END             46000001
         SPACE 2                                                        46100001
*******************************************************************     46300001
         LA    RCTR,RCTLEN(RCTR)   INCREMENT FOR NEXT ENTRY             46400001
         B     SEARACT             BRANCH TO CONTINUE SEARCH            46500001
         SPACE 2                                                        46600001
*******************************************************************     46900001
NXTPTR1  EQU   *                                                        47000001
         L     RCTR,N0(RCTR)       LOAD NEXT SECTION                    47100001
         B     SEARACT             BRANCH TO CONTINUE                   47200001
         SPACE 2                                                        47300001
*******************************************************************     47600001
BUILD1   EQU   *                                                        47700001
         NI    RCTCODE,TF-RCTEND   TURN OFF END INDICATOR               47800001
         LA    RCTR,RCTLEN(RCTR)   NEXT RCT ENTRY                       47900001
         SPACE 2                                                        48000001
*******************************************************************     48200001
         TM    RCTCODE,RCTCON      IS THIS RCT ENTRY CONTINUED          48300001
         BNO   BUILDX              BRANCH NO                            48400001
         B     STARTRCT            BRANCH TO BUILD RCT ENTRY            48500001
         EJECT                                                          48600001
*******************************************************************     48800001
TRCHK    EQU   *                                                 Y02669 48900002
         OI    XASPLS3,XASTRFG     SET TRACK VERB FLAG         @Y02668P 49100003
         AR    LSTR,WRK4           INCREMENT LIST POINTER BY 1,  Y02669 49200002
*                                  SCANCHK WILL ADD 2 MORE, TO   Y02669 49201002
*                                  ADDRESS THE MSGRT VERB        Y02669 49202002
         B     SCANCHK             BRANCH TO CONTINUE SCAN              49300001
SINGLED  EQU   *                                                        49400001
         AR    LSTR,WRK4           INCREMENT LIST POINTER               49500002
         TM    XASPLS3,XASTRFG     IS THIS A TRACK COMMAND?    @Y02668P 49600003
         BO    TRSCAN              YES, BRANCH TO TRACK OPER CHK Y02669 49700002
         B     DISTABS             NO, BRANCH TO CHECK NEXT      Y02669 49900002
*                                  DISPLAY OPERAND               Y02669 49901002
         EJECT                                                          49951002
**************************************************************** Y02669 50001002
***      THIS ROUTINE PROCESSES THE 'NONE' OPERAND.  IF THERE IS Y02669 50051002
***      AT LEASE ONE RCT TO FREE, THE LOCAL AND CMS LOCKS ARE   Y02651 50101002
***      ACQUIRED FOR THE DURATION OF THE SCAN AND TRUNCATION OF Y02651 50151002
***      THE RCT CHAIN.  THE LOCKS ARE FOR THE PROTECTION OF THE Y02651 50201002
***      ROUTING LOCATION OPERAND PROCESSOR (IEE7503D), AND    @Y02668P 50301003
***      THE 'MSG REF' COMMAND PROCESSOR (IEE6303D).           @Y02668P 50321003
***      THE ADDRESSES OF UP TO THREE RCT'S ARE STORED IN THE    Y02669 50351002
***      XSA FOR FREEMAIN.  (THIS NUMBER MUST BE INCREASED IF    Y02669 50401002
***      MORE THAN FIFTEEN ROUTABLE COMMANDS ARE SUPPORTED BY    Y02669 50451002
***      MSGRT.)  AFTER STORING THE ADDRESSES AND TRUNCATING THE Y02669 50501002
***      CHAIN BY SETTING THE UCMRCT FIELD TO ZERO, THE LOCKS    Y02651 50551002
***      ARE RELEASED, AND EACH RCT FOUND IS FREED.              Y02669 50601002
**************************************************************** Y02669 50651002
       SPACE                                                            50701002
NONERTN  SR    WRK1,WRK1           PREPARE TO INSERT SOURCE ID   Y02669 50751002
         IC    WRK1,XAU            INSERT SOURCE CONSOLE ID      Y02669 50801002
         BAL   LNKR,FINDUCME       GET ISSUING CONS UCME ADDR    Y02669 50851002
         L     RCTR,UCMRCT         ADDRESS FIRST RCT, IF ANY     Y02669 50901002
         LA    RCTR,N0(RCTR)       CLEAR FLAG BYTE               Y02669 50951002
         LTR   RCTR,RCTR           ANY RCT'S?                    Y02669 51001002
         BZ    RET                 NO, EXIT                      Y02669 51051002
         BAL   LNKR,GETLOCK        YES, GET LOCAL AND CMS LOCKS  Y02651 51061002
***                                                                     51071002
***      SAVE THE ADDRESSES OF THE RCT'S                         Y02669 51081002
***                                                                     51091002
         XC    XASAVSTD(N16),XASAVSTD ZERO RCT ADDR SAVE AREA    Y02669 51111002
         LA    WRK5,XASAVSTD       ADDRESS FIRST RCT ADDR SLOT   Y02669 51151002
*                                  FOR FREEMAIN                  Y02669 51201002
STORPTR  ST    RCTR,N0(WRK5)       SAVE RCT ADDR                 Y02669 51251002
         LA    WRK5,N4(WRK5)       ADDRESS NEXT RCT SAVE SLOT    Y02669 51301002
         L     RCTR,RCTPTRN        ADDRESS NEXT RCT              Y02669 51311002
         LA    RCTR,N0(RCTR)       CLEAR FLAG BYTE               Y02669 51321002
         LTR   RCTR,RCTR           IS THERE A NEXT RCT?          Y02669 51331002
         BNZ   STORPTR             YES, SAVE IT                  Y02669 51341002
         XC    UCMRCTA(N3),UCMRCTA NO, CLEAR UCME RCT POINTER    Y02669 51343002
         BAL   LNKR,CLRLOCK        RELEASE LOCKS                 Y02651 51345002
***                                                                     51347002
***      FREE THE RCT'S                                          Y02669 51349002
***                                                                     51349402
         LA    WRK5,XASAVSTD       INITIALIZE SLOT POINTER       Y02669 51349802
FREENEXT L     WRK1,N0(WRK5)       GET ADDR OF NEXT RCT TO FREE  Y02669 51349902
         LTR   WRK1,WRK1           IS THERE ONE?                 Y02669 51353302
         BZ    RET                 NO, EXIT, DONE                Y02669 51355302
         FREEMAIN R,LV=RCTTEND-RCTBEG,A=(1),SP=SUBP YES, FREE IT Y02669 51355702
         LA    WRK5,N4(WRK5)       ADDRESS NEXT SLOT             Y02669 51356102
         B     FREENEXT            GO FREE NEXT RCT              Y02669 51356502
         EJECT                                                          51357202
**************************************************************** Y02669 51360602
***      THE FOLLOWING SUBROUTINE COMPARES THE MSGRT VERB        Y02669 51364002
***      OPERAND IN THE COMMAND BUFFER WITH THE TABLE OF VALID   Y02669 51367402
***      TRACK AND DISPLAY OPERANDS.  THERE ARE TWO ENTRY        Y02669 51370802
***      POINTS:  TRSCAN (IF THE VERB IS 'TR') AND DISSCAN (IF   Y02669 51374202
***      THE VERB IS 'D').                                       Y02669 51377602
***                                                              Y02669 51381002
***      INPUT IS THE ADDRESS OF THE OPERAND IN THE BUFFER, IN   Y02669 51384402
***      REGISTER LSTR.  OUTPUT IS LSTR CONTAINING THE ADDRESS   Y02669 51387802
***      OF THE DELIMITER PRECEDING THE VERB.  THIS IS INPUT TO  Y02669 51391202
***      EITHER DISCONS (IF A VALID OPERAND WAS FOUND) OR LCHECK Y02669 51394602
***      (IF NO VALID OPERAND WAS FOUND).                               51398002
***                                                              Y02669 51401402
***      THE TABLE (OPTAB) IS ORGANIZED IN SUCH A WAY THAT THE   Y02669 51404802
***      FIRST SECTION CONSISTS OF OPERANDS VALID FOR BOTH TRACK Y02669 51408202
***      AND DISPLAY, AND THE REMAINDER, OF THOSE VALID ONLY FOR Y02669 51411602
***      DISPLAY.  IF ENTRY IS MADE FOR TRACK, THE SCAN IS       Y02669 51415002
***      LIMITED TO THE FIRST SECTION BY SETTING THE END OF SCAN Y02669 51418402
***      ADDRESS APPROPRIATELY; IF FOR DISPLAY, IT IS SET TO THE Y02669 51421802
***      END OF THE ENTIRE TABLE.                                Y02669 51425202
**************************************************************** Y02669 51428602
         SPACE                                                          51432002
TRSCAN   EQU   *                   TRACK ENTRY POINT             Y02669 51435402
         LA    WRK5,TENTAB         ADDRESS END OF TRACK OPERANDS Y02669 51438802
         B     SCANOP              GO SCAN OPERANDS              Y02669 51442202
DISSCAN  EQU   *                   DISPLAY ENTRY POINT           Y02669 51445602
         LA    WRK5,DENTAB         ADDRESS END OF DISPLAY OPERS  Y02669 51449002
         SPACE                                                          51452402
SCANOP   EQU   *                   SCAN VERB OPERANDS            Y02669 51455802
         LA    WRK1,OPTAB          ADDRESS START OF OPER TABLE   Y02669 51459202
NEXTOP   CLC   N0(N1,LSTR),N0(WRK1) CHECK FOR MATCH              Y02669 51462602
         BE    DISCONS             IF MATCH FOUND, GO SET-UP FOR Y02669 51466002
*                                  NEXT OPERAND                  Y02669 51469402
         LA    WRK1,N1(WRK1)       IF NOT, BUMP TO NXT TAB ENTRY Y02669 51472802
         CR    WRK1,WRK5           END OF TABLE REACHED?         Y02669 51476202
         BNE   NEXTOP              NO, TEST MATCH ON NEXT ENTRY  Y02669 51479602
         BCTR  LSTR,N0             YES, DECREMENT LIST POINTER   Y02669 51483002
*                                  TO DELIMITER                  Y02669 51486402
         B     LCHECK              GO CHECK FOR L OPERAND        Y02669 51489802
         EJECT                                                          51493202
***                                                                   * 51496602
***  SET FLAGS IN XSA TO INDICATE ERROR HAS OCCURRED IN THE FIRST LOAD* 51500002
***                                                                   * 51600001
         SPACE 2                                                        51700001
*******************************************************************     51900001
ERROR2   EQU   *                                                        52000001
         MVI   XAE,KERROR          K CDR WAS ISSUED FROM A CRT          52100001
         B     RCTMEXT             EXIT FOR SECOND LOAD                 52200001
ERROR3   EQU   *                                                        52300001
         CLI   N0(WRK6),CHARO      IS OPERAND CONSOLES?          Y02669 52301002
         BNE   ERROR3A             NO, CHECK FOR 'D=DUMP'      @G33CPMR 52301543
         MVI   N0(WRK6),CHARC      YES, RESTORE C OF 'CONSOLES'  Y02669 52303002
         B     ERROR7              SKIP AROUND 'D=DUMP'        @G33CPMR 52303143
ERROR3A  EQU   *                                               @G33CPMR 52303643
         CLI   N0(WRK6),CHARP      IS OPERAND DUMP?            @G33CPMR 52303743
         BNE   ERROR7              NO, DO NOT CHANGE OPERAND   @G33CPMR 52303843
         MVI   N0(WRK6),CHARD      YES, RESTORE 'D' OF 'DUMP'  @G33CPMR 52303943
ERROR7   EQU   *                                                 Y02669 52304002
         MVI   XAE,NCERROR         NO CORE AVAILABLE FOR ROUTE TABLE    52400001
         B     RCTMEXT             EXIT FOR SECOND LOAD                 52500001
ERROR1   EQU   *                                                        52600001
         MVI   XASTSAVE,AIERROR    AREA ID NOT A VALID LETTER           52700001
         B     ERROR5              EXIT FOR SECOND LOAD                 52800001
ERROR4   EQU   *                                                        52900001
         MVI   XASTSAVE,CIERROR    CONSOLE ID NOT VALID                 53000001
ERROR5   EQU   *                                                        53001002
         MVI   XAE,LIERROR         CCA NOT A VALID L OPERAND            53002002
         B     RCTMEXT             EXIT FOR SECOND LOAD                 53003002
ERROR6   EQU   *                                                        53400001
         MVI   XAE,RIERROR         CONSOLE DID NOT HAVE VALID MR AUTHOR 53500001
         B     RCTMEXT             EXIT FOR SECOND LOAD                 53600001
ERROR8   EQU   *                                               @Y02668P 53650003
         MVI   XASTSAVE,JIERROR    NO MR TO SUBSYSTEM          @Y02668P 53700003
         B     ERROR5              EXIT FOR SECOND LOAD        @Y02668P 53800003
ERROR    EQU   *                                                        54000001
         LR    WRK6,LSTR           OPERAND POINTER FOR ERROR MSG        54100001
         MVI   XAE,IOERROR         INVALID OPERAND IN MR CDR            54200001
         SPACE 2                                                        54200102
*******************************************************************     54200202
***                                                                   * 54200402
***  EXIT FROM FIRST LOAD TO SECOND LOAD OF MSGRT COMMAND HANDLER     * 54200602
***                                                                   * 54200802
*******************************************************************     54200902
         SPACE 2                                                        54201202
RCTMEXT  EQU   *                                                        54201402
         BAL   LNKR,CLRLOCK        RELEASE CMS AND LOCAL LOCKS,  Y02651 54201502
*                                  IF HELD                       Y02651 54201702
         NI    XASSDS,XASSDS3+XASSDS6 CLEAR SWITCH,EXCEPT NON- @Z40LPTA 54203540
*                                     COMMTASK,'CONT'          @Z40LPTA 54203640
*                                  NON-COMMTASK SWITCH         @Y02668P 54204003
         MVI   XASPLS3,ZERO        USED DIFFERENTLY BY IEE6403D Y02668P 54207003
         L     LNKR,RCTM2          ADDRESS OF IEE6403D INTO R15  Y02669 54208003
         BR    LNKR                BRANCH TO IT                  Y02669 54209003
         EJECT                                                          54210003
*******************************************************************     54213403
***   EXIT CODE.  RELEASE CMS AND LOCAL LOCKS, AND             @YM4788P 54213603
***   EXIT TO IEE0503D                                         @YM4788P 54214603
*******************************************************************     54215603
         SPACE                                                          54216603
RET      EQU   *                   EXIT CODE                     Y02669 54220003
         BAL   LNKR,CLRLOCK        RELEASE CMS AND LOCAL LOCKS   Y02651 54221603
         MVI   XAE,IEE712I         PROCESSING COMPLETE CODE    @YM4788P 54223203
         MVC   XAV(N5),MSGRT       COMMAND VERB(MSGRT)         @YM4788P 54224803
         L     LNKR,IEE0503D       ADDRESS OF MESSAGE MODULE   @YM4788P 54225803
         BR    LNKR                BRANCH TO IT                @YM4788P 54226803
         SPACE 2                                                        54227803
*******************************************************************     54232003
***      EXIT CODE.  RETURN VIA BR 14                          @YM7698P 54233003
*******************************************************************     54234003
         SPACE                                                          54235003
RET1     EQU   *                                               @YM7698P 54238003
         BR    RETR                RETURN TO CALLER            @YM7698P 54239003
         SPACE 2                                                        54240003
*******************************************************************     54241003
***      CLRLOCK ROUTINE.  RELEASES CMS AND LOCAL LOCKS, IF HELD.Y02651 54244003
*******************************************************************     54246003
         SPACE                                                          54248003
CLRLOCK  TM    XASSDS,XASSDS5      LOCKS HELD?                   Y02651 54251202
         BZ    N0(LNKR)            NO, RETURN TO CALLING ROUTINE Y02651 54251403
         STM   LSTR,RETR,XASAVLOC  SAVE REGS ACROSS SETLOCKS     Y02651 54252003
CLRLOCK2 SETLOCK RELEASE,TYPE=CMS,                               Y02651X54255003
               RELATED=(RCT,IEE6303D(SETLOCK2))                  Y02651 54256003
CLRLOCK1 SETLOCK RELEASE,TYPE=LOCAL,                             Y02651X54257003
               RELATED=(RCT,IEE6303D(SETLOCK1))                  Y02651 54258003
         LM    LSTR,RETR,XASAVLOC  RESTORE SAVED REGS            Y02651 54259003
         NI    XASSDS,TF-XASSDS5   TURN OFF LOCKS HELD SWITCH  @Y02668P 54260003
         BR    LNKR                RETURN TO CALLING ROUTINE     Y02651 54261003
      EJECT                                                             54266202
*******************************************************************     54276202
***      GETLOCK ROUTINE.                                        Y02651 54296202
***      ACQUIRES LOCAL AND CMS LOCKS, IF NOT ALREADY HELD.      Y02651 54298202
*******************************************************************     54300202
    SPACE 2                                                             54302202
GETLOCK  TM    XASSDS,XASSDS5      LOCKS ALREADY HELD?           Y02651 54306202
         BO    LOKSHELD            YES, DON'T REACQUIRE          Y02651 54356202
         STM   LSTR,RETR,XASAVLOC  SAVE REGS ACROSS SETLOCKS     Y02651 54406202
SETLOCK1 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02651X54456202
               RELATED=(RCT,IEE6303D(CLRLOCK1))                  Y02651 54506202
SETLOCK2 SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02651X54556202
               RELATED=(RCT,IEE6303D(CLRLOCK2))                  Y02651 54606202
         LM    LSTR,RETR,XASAVLOC  RESTORE SAVED REGS            Y02651 54656202
         OI    XASSDS,XASSDS5      SET LOCKS HELD SWITCH         Y02651 54706202
LOKSHELD BR    LNKR                RETURN TO CALLER              Y02651 54756202
       EJECT                                                            54806202
*******************************************************************     54856202
***      FINDUCME ROUTINE.                                       Y02669 54906202
***      FIND AND SET BASE FOR UCM ENTRY                         Y02669 54956202
***               - INPUT - WRK1 CONTAINS CONSOLE ID             Y02669 54966202
***               - OUTPUT - UCM ENTRY SPECIFIED BY ID IN ENTR   Y02669 55006202
*******************************************************************     55156202
     SPACE 2                                                            55166202
FINDUCME EQU   *                                                        55206202
         L     ENTR,UCMVEA         FIRST ENTRY FROM UCM                 55256202
         BCTR  WRK1,N0             SUBRRACT ONE FROM CONSOLE ID         55306202
         M     WRK0,UCMVEZ         MULIPLY ENTRY SIZE BY REDUCED ID     55356202
         AR    ENTR,WRK1           ADDRESS OF DESIRED UCM ENTRY         55406202
         BR    LNKR                RETURN TO CALLER              Y02669 55456202
         EJECT                                                          56400001
********                                                              * 56500001
******** CONSTANTS USED BY ROUTINE                                    * 56600002
********                                                              * 56700001
DIS      DC    C'D='               DISPLAY VERB                         56710001
CONSOLES DC    C'CONSOLES'         CONSOLE OPERAND                      56800001
TR       DC    C'TR='              TRACK VERB                    Y02669 57300002
CLEQUAL  DC    C',L='              L OPERAND                            57500001
D3850    DC    C'3850'             D 3850 OPERAND CONSTANT     @Z40LPTA 57500140
CONTOP   DC    C'CONT'             CMND CONTINUATION OPERAND   @Z40LPTA 57500340
OONSOLES DC    C'OONSOLES'         INTERNAL REP. OF 'CONSOLES' @G33CPMR 57500443
DUMP     DC    C'DUMP'             D DUMP OPERAND CONSTANT     @G33CPMR 57500543
NONE     DC    C'NONE '            NONE OPERAND                  Y02669 57500843
MSGRT    DC    C'MSGRT'            MSGRT VERB FOR MSG          @YM4788P 57500943
IEE0503D DC    V(IEE0503D)         MESSAGE MODULE              @YM4788P 57501043
RCTM2    DC    V(IEE6403D)         SECOND MR LOAD                Y02669 57501143
         EJECT                                                          57501202
**************************************************************** Y02669 57501402
***      TABLE OF ROUTABLE TRACK AND DISPLAY COMMAND OPERANDS    Y02669 57501602
**************************************************************** Y02669 57501802
         SPACE 2                                                        57501902
OPTAB    EQU   *                                                 Y02669 57502902
A        DC    CL1'A'              OPERAND TEXT                  Y02669 57505002
TENTAB   EQU   *                   END OF TRACK OPERANDS         Y02669 57505202
***      END OF OPERANDS COMMON TO TRACK AND DISPLAY COMMANDS    Y02669 57505402
         SPACE                                                          57505602
***      START OF OPERANDS VALID ONLY ON DISPLAY COMMAND         Y02669 57505702
         SPACE                                                          57505902
***      NOTE: 'CONSOLES' DOES NOT APPEAR HERE BECAUSE IT IS     Y02669 57506702
***      HANDLED IN-LINE AS A SPECIAL CASE, BECAUSE ITS          Y02669 57506902
***      ABBREVIATION IS 'O'                                     Y02669 57507002
         SPACE                                                          57507102
CK       DC    CL1'C'              *                             Y02669 57507502
DMN      DC    CL1'D'              *                           @Z40BPSV 57507740
MATRIX   DC    CL1'M'              *                             Y02669 57508602
UNITS    DC    CL1'U'              *                             Y02669 57509002
REQUESTS DC    CL1'R'              *                             Y02669 57509402
SLIP     DC    CL1'S'              *                           @G17SPTJ 57509741
DENTAB   EQU   *                   END OF TABLE                  Y02669 57510241
***      END OF OPERAND TABLE                                    Y02669 57510502
         SPACE 3                                                        57510702
PATCH    DC    CL50'***   IEE6303D  PATCH AREA  ******'          Y02669 57511502
IEE6303D  TITLE 'UNIT CONTROL MODULE MAP'                               58001002
         IEECUCM   FORMAT=NEW                                           58200002
          TITLE 'EXTENDED SAVE AREA MAP'                                58201002
DXSA     DSECT                                                          58400001
         IEEXSA                                                         58500001
**                                                                    * 58600001
**  THE XAP AND XAD FIELDS OF THE XSA ARE USED AS A DOUBLE WORD       * 58700001
**   WORK AREA IN THIS MODULE AND ARE RESTORED BEFORE EXIT            * 58800001
**                                                                    * 58900001
**  THE XASSDS FIELD OF THE XSA IS USED AS FOLLOWS IN THIS MODULE     * 59000002
XASKFG   EQU   X'20'               THE VERB IS A K COMMAND              59700001
XASTRFG  EQU   X'10'               THE THE VERB IS TRACK         Y02669 59701002
XASPRF1  EQU   X'02'               THERE IS MORE THAN ONE VERB          60100001
XASPRF2  EQU   X'01'               THERE IS MORE THAN ONE OPERAND       60200001
        TITLE 'CVT MAP'                                                 60201002
DCVT     DSECT                                                          60700001
         CVT                                                            60800001
         TITLE 'ROUTE CONTROL TABLE MAP'                                60801002
DSTRCT   DSECT                                                   Y02669 60901002
         IEECVMAP RCT                                            Y02669 60902002
         TITLE 'PREFIX STORAGE AREA MAP'                                60903002
         IHAPSA                                                         60904002
         TITLE 'NEW/OLD TCB ASCB POINTERS MAP'                          60954002
         IEFPTRS                                                        61004002
         END                                                            64200001
