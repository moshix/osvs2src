         TITLE 'IGC0003D  MSGRT COMMAND HANDLER LOAD TWO'               00100002
*********************************************************************** 00200001
*  MODULE NAME=  IEE6403D                                        Y02669 00201002
*                                                                       00202002
*  DESCRIPTIVE NAME =  MSGRT COMMAND HANDLER:                    Y02669 00203002
*                      REF OPERAND                               Y02669 00204002
*                      MESSAGE MODULE INTERFACE                  Y02669 00205002
*                                                                       00206002
*  COPYRIGHT =  NONE                                             Y02669 00207002
*                                                                       00208002
*  STATUS =  OS/VS2 - DUMPING IMPROVEMENTS                     @G33CPMR 00208543
*                                                                       00210002
*  FUNCTION =  THIS MODULE EXAMINES THE ROUTE CONTROL TABLE AND  Y02669 00211002
*  FORMATS ITS CONTENTS AS A MSGRT COMMAND TO DISPLAY THE        Y02669 00212002
*  DEFAULT ROUTING OPTIONS IN EFFECT FOR THE ISSUING CONSOLE. IN Y02669 00213002
*  ADDITION, IT COMPLETES THE INTERFACE TO THE FIRST SDS MESSAGE Y02669 00214002
*  MODULE.                                                       Y02669 00215002
*                                                                       00216002
*     OPERATION =                                                Y02669 00217002
*     1.  IF AN ERROR CODE IS PRESENT IN THE XAE FIELD OF THE    Y02669 00218002
*     XSA, THE INTERFACE TO IEE5603D IS COMPLETED:  UNLESS THE   Y02669 00219002
*     INTENDED ERROR MESSAGE REFERS TO THE 'L' OPERAND, THE      Y02669 00220002
*     XASTSAVE FIELD OF THE XSA IS INITIALIZED WITH THE ADDRESS  Y02669 00221002
*     OF THE INVALID OPERAND TO APPEAR IN THE MESSAGE, THE       Y02669 00222002
*     ADDRESS BEING PASSED IN REGISTER 6 FROM IEE6303D.  THEN,   Y02669 00223002
*     IF THE MESSAGE IS TO BE ABOUT THE CONTROL (K) COMMAND      Y02669 00224002
*     ( MESSAGE IEE925I), THE SECONDARY CODE IS SET IN THE HIGH  Y02669 00225002
*     ORDER BYTE OF XASTSAVE, TO CAUSE 'FOR NON CRT ONLY' TO BE  Y02669 00226002
*     APPENDED TO THE MESSAGE.                                   Y02669 00227002
*                                                                       00227203
*     2.  IF THE COMMAND WAS NOT ISSUED UNDER COMMTASK, AS     @Y02668P 00227403
*     INDICATED BY BIT XASSDS3 BEING ON, THE CMS AND LOCAL     @Y02668P 00235403
*     LOCKS ARE ACQUIPED TO PROTECT AGAINST THE CONCURRENT     @Y02668P 00244003
*     EXECUTION OF 'MR NONE'. THE LIKELY CAUSE OF THIS ENTRY   @Y02668P 00254003
*     IS TO PROCESS 'MR REF' ISSUED FROM A JES3 CONSOLE        @Y02668P 00264003
*                                                                       00265003
*     3.  IF THE COMMAND OPERAND IS OTHER THAN 'REF ', OR THE  @Z40LPTA 00272004
*         'CONT' INDICATOR IN THE XSA IS NOT ON, CONTROL       @Z40LPTA 00277004
*     IS PASSED TO THE ERROR EXIT TO ISSUE THE MESSAGE STATED    Y02669 00288003
*     THERE.  ABSENCE OF OPERANDS IS TREATED AS 'MR REF '.       Y02669 00304003
*                                                                       00336003
*     4.  THE UCME OF THE ISSUING CONSOLE IS FOUND.  FROM THIS @Y02668P 00337003
*     IT IS DETERMINED IF THE CONSOLE IS A CRT.  IF IT IS, THE   Y02669 00353003
*     DISPLAY CONTROL MODULE (DCM) IS LOCATED AND THE            Y02669 00369003
*     INSTRUCTION LINE THEREIN USED FOR THE MESSAGE.  IF THE     Y02669 00385003
*     CONSOLE IS A NON CRT, A CONDITIONAL GETMAIN FOR 150 BYTES  Y02669 00402003
*     FROM SUBPOOL 229 IS ISSUED.  IF THE GETMAIN FAILS, CONTROL Y02669 00417003
*     IS PASSED TO THE ERROR EXIT TO ISSUE THE ERROR MESSAGE     Y02669 00433003
*     INDICATED THERE.  OTHERWISE, THE FIRST 12 BYTES OF THE     Y02669 00449003
*     GOTTEN STORAGE IS INITIALIZED WITH MCSFLAGS AND MESSAGE ID Y02669 00459003
*     IEE930I.  THE REMAINDER WILL BE TREATED AS IF IT WERE THE  Y02669 00469003
*     ENTRY AREA OF THE DCM, AND WILL BE REFERRED TO AS SUCH.    Y02669 00479003
*                                                                       00489003
*     5.  THE ENTRY AREA OF THE DCM IS BLANKED AND THE MSGRT   @Y02668P 00499003
*     COMMAND ('MR') MOVED IN.  A CHECK IS THEN MADE TO          Y02669 00509003
*     DETERMINE IF THERE IS A ROUTE CONTROL TABLE (RCT) FOR THIS Y02669 00519003
*     CONSOLE.                                                   Y02669 00529003
*                                                                       00539003
*     6.  IF NOT, 'NONE' IS MOVED IN AS THE OPERAND.  IF THE   @Y02668P 00549003
*     CONSOLE IS A CRT, THE 'CHANGE OPTIONS' SWITCH IS SET       Y02669 00559003
*     AND CONTROL IS PASSED TO THE EXIT TO ISSUE THE MESSAGE     Y02669 00569003
*     INDICATED THERE.  IF THE CONSOLE IS NOT A CRT,  CONTROL    Y02669 00579003
*     PASSES TO THE WRITE2 EXIT TO WTO THE GOTTEN BUFFER,        Y02669 00589003
*     FREE IT, AND RETURN VIA BRANCH ON REGISTER 14.             Y02669 00599003
*                                                                       00609003
*     7.  IF THERE IS AN RCT, THE FIRST ENTRY IS CHECKED TO    @Y02668P 00619003
*     DETERMINE IF IT IS ACTIVE (BIT RCTACT IN BYTE RCTCODE).    Y02669 00629003
*     IF NOT, THE NEXT ENTRY IS CHECKED.  IF IT IS ACTIVE, THE   Y02669 00639003
*     VERB, OPERAND, AND ROUTING INFORMATION ARE PLACED IN THE   Y02669 00649003
*     ENTRY AREA, FORMATTED AS OPERANDS ON A VALID MSGRT         Y02669 00659003
*     COMMAND, AND THE ENTRY MARKED AS HAVING BEEN DISPLAYED     Y02669 00669003
*     (BIT RCTRES IN BYTE RCTCODE). THEN ALL OTHER ACTIVE RCT    Y02669 00679003
*     ENTRIES ARE CHECKED FOR THIS VERB, AND THOSE FOUND ARE     Y02669 00689003
*     FORMATTED AND ADDED TO THE ENTRY AREA.  ONCE ALL ENTRIES   Y02669 00699003
*     IN ALL RCT'S HAVE BEEN EXAMINED FOR ONE COMMAND, ALL ARE   Y02669 00709003
*     CHECKED FOR THE NEXT, UNTIL ALL ROUTABLE COMMANDS ARE      Y02669 00719003
*     EXHAUSTED.  THE ORDER IN WHICH THE COMMANDS ARE CHECKED IS Y02669 00729003
*     DISPLAY, TRACK, AND CONTROL.                               Y02669 00739003
*                                                                       00749003
*     8.  FOR EACH ACTIVE RCT ENTRY A BRANCH IS TAKEN TO LABEL @Z40LPTA 00749604
*         BUFCHK TO DETERMINE IF THE VERB/OPERAND WILL FIT     @Z40LPTA 00750204
*         INTO THE OUTPUT BUFFER. IF IT WILL FIT, PROCESSING   @Z40LPTA 00750804
*         CONTINUES AS ABOVE.                                  @Z40LPTA 00751404
*         IF IT WILL NOT FIT, THE OPERAND 'CONT' IS SET INTO   @Z40LPTA 00752004
*         THE OUTPUT BUFFER.                                   @Z40LPTA 00752604
*         IF THE 'CONT' OPERAND INDICATOR IS NOT ON, THE       @Z40LPTA 00753204
*         'DISPLAYED' BIT IS TURNED OFF IN EACH RCT ENTRY,     @Z40LPTA 00753804
*         AND THE MESSAGE IS WRITTEN TO THE CONSOLE.           @Z40LPTA 00754404
*         IF THE 'CONT' OPERAND INDICATOR IS ON, BUFFER AND    @Z40LPTA 00755004
*         BUFFER LENGTH PTRS ARE RESET TO BEGINNING OF BUFFER  @Z40LPTA 00755604
*         AND PROCESSING RESUMES AT (REF 4). THIS RESULTS      @Z40LPTA 00756204
*         IN THE CURRENT OUTPUT BUFFER BEING PURGED, AND       @Z40LPTA 00756804
*         RE-INITIALIZED WITH THE RCT ENTRIES THAT HAVE NOT    @Z40LPTA 00757404
*         YET BEEN DISPLAYED.                                  @Z40LPTA 00758004
*     9. ONCE ALL RCT ENTRIES HAVE BEEN EXAMINED FOR ALL VERBS,@Y02668P 00759004
*     IF NO ACTIVE ENTRIES WERE FOUND, 'NONE' IS MOVED IN.       Y02669 00769003
*     THE 'DISPLAYED' BIT IS TURNED OFF IN EACH ENTRY, AND THE   Y02669 00779003
*     MESSAGE WRITTEN AS DESCRIBED IN STEP 5.                    Y02669 00789003
*                                                                       00799003
*  NOTES =                                                       Y02669 00809003
*                                                                       00819003
*     DEPENDENCIES =  GETMAIN, FREEMAIN, DIDOCS, WTO             Y02669 00829003
*                                                                       00839003
*     CHARACTER CODE DEPENDENCIES =  THIS MODULE HAS BEEN CODED  Y02669 00849003
*     IN SUCH A WAY THAT IF THE EXTERNAL CHARACTER SET IS        Y02669 00859003
*     CHANGED FROM EBCDIC, REASSEMBLY WILL YIELD A VALID MODULE, Y02669 00869003
*     WITH THE FOLLOWING EXCEPTION:                              Y02669 00879003
*                                                                       00889003
*     THE CODE REPRESENTATION OF DECIMAL DIGITS MUST HAVE THE    Y02669 00899003
*     FOUR HIGH ORDER BITS 'ON'.  (I.E. X'FZ', WHERE Z IS ANY    Y02669 00909003
*     HEX DIGIT.)                                                Y02669 00919003
*                                                                       00929003
*     RESTRICTIONS =  THIS MODULE EXPECTS REGISTER TWO ON        Y02669 00939003
*     ENTRY TO CONTAIN THE ADDRESS OF AN XSA.                    Y02669 00949003
*                                                                       00959003
*     REGISTER CONVENTIONS =  SEE REGISTER USAGE.                Y02669 00969003
*                                                                       00979003
*     PATCH-LABEL =  PATCH                                       Y02669 00989003
*                                                                       00999003
*  MODULE TYPE =  CSECT                                          Y02669 01009003
*                                                                       01019003
*     PROCESSOR =  ASSEM                                         Y02669 01029003
*                                                                       01039003
*     MODULE SIZE =  X'54C'                                    @G33CPMR 01044043
*                                                                       01059003
*     ATTRIBUTES =  ZERO PSW PROTECT KEY     REENTRANT           Y02669 01069003
*                   SUPERVISOR STATE         PAGED LPA           Y02669 01079003
*                                                                       01089003
*  ENTRY POINT =  IEE6403D, FROM IEE6303D                        Y02669 01099003
*                                                                       01109003
*     PURPOSE =  SET UP INTERFACE TO MESSAGE MODULE IEE5603D     Y02669 01119003
*     ON BEHALF OF IEE6303D, AND PROCESS 'REF ' OPERAND OF       Y02669 01129003
*     THE MSGRT COMMAND.                                         Y02669 01139003
*                                                                       01149003
*     LINKAGE =  BRANCH FROM IEE6303D                            Y02669 01159003
*                                                                       01169003
*     INPUT =                                                    Y02669 01179003
*     REGISTER 2             ADDRESS OF XSA                      Y02669 01189003
*     LSTR(REGISTER 11)      ADDRESS OF FIRST OPERAND            Y02669 01199003
*                            ('REF ' OR ERROR)                   Y02669 01209003
*     XAL                    ADDRESS OF FIRST OPERAND            Y02669 01219003
*     XAU                    CONSOLE ID                          Y02669 01229003
*     XAV                    COMMAND VERB (MR OR MSGRT)          Y02669 01239003
*     XAE                    MESSAGE INDEX OR X'00'              Y02669 01249003
*     XASSDS                 XASSDS3 - ON, FOR NON-            @Y02668P 01259003
*                            XASSDS6 - CONTINUATION BIT        @Z40LPTA 01264004
*                            COMMTASK REQUEST                  @Y02668P 01269003
*     XASTSAVE               ADDRESS OF VARIABLE SUFFIX TEXT FOR Y02669 01279003
*                            ERROR MESSAGE, AND CODE INDICATING  Y02669 01289003
*                            FIXED SUFFIX TEXT FOR IEE5903D      Y02669 01299003
*                                                                       01309003
*     OUTPUT =  N/A                                              Y02669 01319003
*                                                                       01329003
*     REGISTERS SAVED =  NONE                                    Y02669 01339003
*                                                                       01349003
*     REGISTER USAGE =                                           Y02669 01359003
*     REGISTER 0         WORK REGISTER                           Y02669 01369003
*     REGISTER 1         WORK REGISTER                           Y02669 01379003
*     REGISTER 2         XSA BASE                                Y02669 01389003
*     REGISTER 3         END OF SYNTAX SCAN ADDRESS              Y02669 01399003
*     REGISTER 4         WORK REGISTER                           Y02669 01409003
*     REGISTER 5         BRANCH AND LINK REGISTER                Y02669 01419003
*     REGISTER 6         WORK REGISTER                           Y02669 01429003
*     REGISTER 7         UCME BASE                               Y02669 01439003
*     REGISTER 8         RCT BASE                                Y02669 01449003
*     REGISTER 9         UCM BASE                                Y02669 01459003
*     REGISTER 10        CVT BASE                                Y02669 01469003
*     REGISTER 11        OPERAND POINTER, FROM XSA               Y02669 01479003
*     REGISTER 12        MODULE BASE                             Y02669 01489003
*     REGISTER 13        SAVE REGISTER                           Y02669 01499003
*     REGISTER 14        RETURN REGISTER                         Y02669 01509003
*     REGISTER 15        LINK REGISTER                           Y02669 01519003
*                                                                       01529003
*     REGISTERS RESTORED =  NONE                                 Y02669 01539003
*                                                                       01549003
*  EXIT-NORMAL =  WRITE2                                                01559003
*                                                                       01569003
*     CONDITIONS =  MR REF PROCESSED FROM A NON CRT CONSOLE.     Y02669 01579003
*     OPERAND 'CONT' PROCESSING IS THE SAME.                   @Z40LPTA 01584004
*     MESSAGE IEE930I IS WRITTEN VIA WTO TO THE REQUESTING       Y02669 01589003
*     CONSOLE, THE MESSAGE AREA FREED VIA FREEMAIN, AND CONTROL  Y02669 01599003
*     RETURNED TO THE CALLER VIA BRANCH ON REGISTER 14.          Y02669 01609003
*     THIS EXIT IS ALSO TAKEN FOR NON-COMMTASK (I.E. JES3)     @Y02668P 01619003
*     REQUESTS.                                                @Y02668P 01629003
*                                                                       01639003
*     OUTPUT =  MESSAGE IEE930I                                  Y02669 01649003
*                                                                       01659003
*     RETURN CODES =  NONE                                       Y02669 01669003
*                                                                       01679003
*  EXIT-NORMAL =  DISPLAY2                                       Y02669 01689003
*                                                                       01699003
*     CONDITIONS =  MR REF PROCESSED FROM A CRT CONSOLE.  THE MR Y02669 01709003
*     COMMAND WHICH WOULD ESTABLISH THE CURRENT ROUTING DEFAULTS Y02669 01719003
*     FOR THE REQUESTING CONSOLE IS IN THE ENTRY AREA OF ITS DCM Y02669 01729003
*     AND THE APPROPRIATE CODE IS SET IN THE XAE FIELD OF THE    Y02669 01739003
*     XSA TO CAUSE IEE5603D TO ISSUE THE 'CHANGE OPTIONS'        Y02669 01749003
*     MESSAGE.  CONTROL IS PASSED TO IEE5603D VIA BRANCH ON VCON.Y02669 01759003
*     OPERAND 'CONT' PROCESSING IS THE SAME.                   @Z40LPTA 01764004
*                                                                       01769003
*     OUTPUT =                                                   Y02669 01779003
*     ENTRY AREA OF DCM      MSGRT COMMAND                       Y02669 01789003
*     XAE                    MESSAGE CODE X'02'                  Y02669 01799003
*                                                                       01809003
*     RETURN CODES =  NONE.                                      Y02669 01819003
*                                                                       01829003
*  EXIT-ERROR =  ERROR2                                          Y02669 01839003
*                                                                       01849003
*     CONDITIONS =  THE CONDITIONAL GETMAIN FOR THE WTO PARA-    Y02669 01859003
*     METER LIST FAILED.                                         Y02669 01869003
*     CONTROL IS PASSED TO THE MESSAGE MODULE IEE5603D VIA       Y02669 01879003
*     BRANCH ON VCON TO ISSUE MESSAGE IEE931I.                   Y02669 01889003
*                                                                       01899003
*     OUTPUT =                                                   Y02669 01909003
*     XAE              MESSAGE CODE X'0E'                        Y02669 01919003
*     XAV              COMMAND VERB (MR OR MSGRT)                Y02669 01929003
*     XAU              CONSOLE ID FOR WTO                        Y02669 01939003
*     XASTSAVE         ADDRESS OF 'REF '                         Y02669 01949003
*                                                                       01959003
*     RETURN CODES =  NONE                                       Y02669 01969003
*                                                                       01979003
*  EXIT-ERROR =  ERROR1                                          Y02669 01989003
*                                                                       01999003
*     CONDITIONS =  ENTRY TO IEE6403D WAS NOT TO SET UP MESSAGE  Y02669 02009003
*     INTERFACE.  FURTHER, THE OPERAND ON THE COMMAND IS NOT     Y02669 02019003
*     'REF '.  NEITHER IS 'REF ' TO BE DEFAULTED.                Y02669 02029003
*     CONTROL IS PASSED TO THE MESSAGE MODULE IEE5603D VIA       Y02669 02039003
*     BRANCH ON VCON TO ISSUE MESSAGE IEE156I.                   Y02669 02049003
*                                                                       02059003
*     OUTPUT =                                                   Y02669 02069003
*     XAE              MESSAGE CODE X'04'                        Y02669 02079003
*     XAV              COMMAND VERB (MR OR MSGRT)                Y02669 02089003
*     XAU              CONSOLE ID FOR WTO                        Y02669 02099003
*                                                                       02109003
*     RETURN CODES =  NONE                                       Y02669 02119003
*                                                                       02129003
*  EXIT-ERROR =  ERROR                                           Y02669 02139003
*                                                                       02149003
*     CONDITIONS =  ENTRY TO IEE6403D WAS MADE FROM IEE6303D TO  Y02669 02159003
*     SET UP THE INTERFACE TO IEE5603D TO ISSUE A MESSAGE.  IF   Y02669 02169003
*     A MESSAGE OTHER THAN IEE926I IS TO BE ISSUED, REGISTER     Y02669 02179003
*     'WRK6' IS STORED IN XASTSAVE IN THE XSA.  FURTHER, IF      Y02669 02189003
*     MESSAGE IEE925I IS TO BE ISSUED, A CODE OF X'1B' IS MOVED  Y02669 02199003
*     INTO THE HIGH ORDER BYTE OF XASTSAVE TO INDICATE THE       Y02669 02209003
*     SUFFIX TEXT TO IEE5903D.                                   Y02669 02219003
*     CONTROL IS PASSED TO THE MESSAGE MODULE IEE5603D VIA       Y02669 02229003
*     BRANCH ON VCON TO ISSUE THE APPROPRIATE MESSAGE.           Y02669 02239003
*                                                                       02249003
*     OUTPUT =                                                   Y02669 02259003
*     XAE              MESSAGE CODE PASSED FROM IEE6303D         Y02669 02269003
*     XAV              COMMAND VERB (MR OR MSGRT)                Y02669 02279003
*     XAU              CONSOLE ID FOR WTO                        Y02669 02289003
*     XASTSAVE         POSSIBLY POINTER TO VARIABLE TEXT         Y02669 02299003
*                      POSSIBLY A CODE INDICATING SUFFIX TEXT    Y02669 02309003
*                                                                       02319003
*     RETURN CODES =  NONE                                       Y02669 02329003
*                                                                       02339003
*  EXTERNAL REFERENCES =                                         Y02669 02349003
*                                                                       02359003
*     ROUTINES =  IEE5603D - SDS MESSAGE MODULE                  Y02669 02369003
*                                                                       02379003
*     DATA AREAS = NONE                                          Y02669 02389003
*                                                                       02399003
*     CONTROL BLOCKS =                                           Y02669 02409003
*     RCT          R,W                                           Y02669 02419003
*     DCM          R,W                                           Y02669 02429003
*     XSA          R,W                                           Y02669 02439003
*     UCM          R                                             Y02669 02449003
*     CVT          R                                             Y02669 02459003
*     PSA          R                                           @Y02668P 02464003
*                                                                       02469003
*     KEY;  C=CREATE, D=DELETE, R=READ, W=WRITE                  Y02669 02479003
*                                                                       02489003
*  TABLES =  VERTAB - VALID MSGRT VERBS                          Y02669 02499003
*                                                                       02509003
*  MACROS =  CVT, IEEXSA, IEECUCM, IEETDCM, IEECVMAP RCT, MODID  Y02669 02519003
*            IHAPSA, SETLOCK                                   @Y02668P 02524003
*                                                                       02529003
*     SERIALIZATION =                                            Y02669 02539003
*     LOCKS HELD =  CMS, LOCAL                                 @Y02668P 02549003
*                                                                       02559003
*  CHANGE ACTIVITY =  Y02669, Y02651, Y02668, Z40LPTA, G33CPMR @G33CPMR 02564043
*                                                                       02579003
*  MESSAGES =                                                    Y02669 02589003
*  XAE CODE                          TEXT                        Y02669 02599003
*    X'04'         IEE156I (VERB) INVALID OPERAND- (OPERAND)     Y02669 02609003
*    X'0E'         IEE931I (VERB) (OPERAND) INSUFFICIENT         Y02669 02619003
*                  STORAGE FOR COMMAND  (OPERAND IS 'REF ',      Y02669 02629003
*                  OR '   ', IF REF WAS DEFAULTED)               Y02669 02639003
*    X'02'         MR (OPERANDS)  CHANGE OPTIONS IF DESIRED      Y02669 02649003
*                  (OPERANDS ARE THE MR DEFAULTS IN EFFECT)      Y02669 02659003
*    N/A           IEE930I MR (OPERANDS)                         Y02669 02669003
*                  (OPERANDS ARE THE MR DEFAULTS IN EFFECT)      Y02669 02679003
*                                                                       02689003
*  FOR ALL BUT THE LAST MESSAGE, THE TEXT IS CONTAINED IN EITHER Y02669 02699003
*  IEE5603D OR IEE5903D, OR BOTH, AND THE MESSAGE IS ISSUED FROM Y02669 02709003
*  ONE OF THEM.  MESSAGE IEE930I IS CONSTRUCTED BY AND ISSUED BY Y02669 02719003
*  IEE6403D.                                                     Y02669 02729003
*                                                                       02739003
*  ABEND CODES =  NONE.                                          Y02669 02749003
*                                                                       02759003
**********************************************************************  04200002
         EJECT                                                          04300001
IEE6403D CSECT                                                          04400001
* A - CODE ADDED TO SUPPORT 'DISPLAY DUMP'                     @G33CPMR 04450043
********                                                              * 04500001
******** REGISTER EQUATES                                             * 04600001
********                                                              * 04700001
WRK0     EQU   0                   WORK REGISTER                        04800001
WRK1     EQU   1                   WORK REGISTER                        04900001
XSAR     EQU   2                   BASE REGISTER FOR THE XSA            05000001
WRK3     EQU   3                   WORK REGISTER                        05100001
WRK4     EQU   4                   WORK REGISTER                        05200001
BALR     EQU   5                   BRANCH AND LINK REGISTER             05300001
WRK6     EQU   6                   WORK REGISTER                        05400001
ENTR     EQU   7                   BASE REGISTER FOR THE UCM ENTRY      05500001
RCTR     EQU   8                   BASE REGISTER FOR THE RCT            05600001
UCMR     EQU   9                   BASE REGISTER FOR THE UCM            05700001
CVTR     EQU   10                  BASE REGISTER FOR THE CVT            05800001
LSTR     EQU   11                  LIST POINTER FROM XSA                05900001
BASR     EQU   12                  ROUTINE BASE REGISTER                06000001
SAVR     EQU   13                  SAVE REGISTER                        06100001
RETR     EQU   14                  RETURN REGISTER                      06200001
LNKR     EQU   15                  LINK REGISTER                        06300001
         EJECT                                                          06350001
********                                                              * 06400001
******** OTHER EQUATES                                                * 06500001
********                                                              * 06600001
N0       EQU   0                   NUMBER CONSTANT                      06700001
N1       EQU   1                   NUMBER CONSTANT                      06800001
N2       EQU   2                   NUMBER CONSTANT                      06900001
N3       EQU   3                   NUMBER CONSTANT                      07000001
N4       EQU   4                   NUMBER CONSTANT                      07100001
N5       EQU   5                   NUMBER CONSTANT                      07200001
N6       EQU   6                   NUMBER CONSTANT                      07300001
N7       EQU   7                   NUMBER CONSTANT                      07400001
N8       EQU   8                   NUMBER CONSTANT                      07500001
N10      EQU   10                  NUMBER CONSTANT                      07700001
N11      EQU   11                  NUMBER CONSTANT                      07800001
N12      EQU   12                  NUMBER CONSTANT             @Z40LPTA 07807004
N13      EQU   13                  NUMBER CONSTANT             @Z40LPTA 07809004
KCDROP   EQU   14                  NUMBER CONSTANT             @Z40LPTA 07814004
TRACKOP  EQU   18                  NUMBER CONSTANT             @Z40LPTA 07819004
MAXOP    EQU   24                  NUMBER CONSTANT             @Z40LPTA 07830004
BUFFWTO  EQU   118                 NUMBER CONSTANT             @Z40LPTA 07860004
N120     EQU   120                 NUMBER CONSTANT             @Z40LPTA 07900004
N124     EQU   124                 NUMBER CONSTANT             @Z40LPTA 07930004
BUFFDCM  EQU   126                 NUMBER CONSTANT             @Z40LPTA 07960004
N132     EQU   132                 NUMBER CONSTANT             @Z40LPTA 07980004
N136     EQU   136                 NUMBER CONSTANT             @Z40LPTA 08000004
CHARO    EQU   C'O'                CHARACTER CONSTANT: CONSOLES  Y02669 08800002
CHAR3     EQU    X'F3'                D 3850 OPERAND CONSTANT  @Z40LPTA 08830004
CHARD    EQU   C'D'                     DISPLAY VERB           @Z40LPTA 08870004
CHARP    EQU   C'P'                CHARACTER CONSTANT: DUMP    @G33CPMR 08880043
CHARK    EQU   C'K'                CONTROL VERB                         08900001
CHART    EQU   C'T'                TRACK VERB                    Y02669 09000002
COMMA    EQU   C','                COMMA CHARACTER                      09100001
PARA2    EQU   C')'                PARENTHSIS CONSTANT                  09200001
PARA1    EQU   C'('                PARENTHSIS CONSTANT                  09300001
ASTRICK  EQU   X'5C'               CHARACTER CONSTANT          @Z40LPTA 09350004
EQUAL    EQU   C'='                CHARACTER CONSTANT                   09400001
BLK      EQU   X'40'               BLANK CONSTANT                       09500001
TF       EQU   X'FF'               FLAG TO TURN OF SWITCHES             09600001
SUBP     EQU   229                 SUBPOOL FOR GET AND FREEMAIN  Y02669 09700002
XF0      EQU   X'F0'               NUMBER ZONE                          09800001
ZERO     EQU   0                   TO TEST FOR ERROR CODE PRESENT       09900001
CHGOPT   EQU   2                   ERROR CODE FOR CHANGE OPTIONS MSG    10000001
IOERROR  EQU   4                   ERROR CODE FOR INVALID OPERAND       10100001
KERROR   EQU   11                  ERROR CODE FOR INVALID K MSG         10200001
LIERROR  EQU   12                  ERROR CODE FOR INVALID L OPERAND     10300001
NCERROR  EQU   14                  ERROR CODE FOR NO STORAGE MSG Y02669 10301002
NONCRT   EQU   27                  SECONDARY CODE FOR INVALID K MSG     10400001
KVERB    EQU   X'40'               K CDR FLAG                           10500001
MCSFG    EQU   X'E0'               MCS FLAGS FOR WTO                    10600001
CF0      EQU   X'F0'               NUMBER MSSK                          10700001
XFF      EQU   X'FF'               END OF VERB TABLE                    10800001
MOPD1    EQU   X'08'               OPERAND INTO BUFFER FLAG             10900001
MOPD2    EQU   X'04'               MULTIPLE OPERANDS FLAG               11000001
MVRB1    EQU   X'02'               VERB INTO BUFFER FLAG                11100001
MVRB2    EQU   X'01'               MULTIPLE VERB FLAG                   11200001
***                                                                     11300001
         EJECT                                                          11400001
*****************************************************************       11800001
         BALR  BASR,N0             SET PROGRAM BASE                     11900001
         USING *,BASR              ESTABLISH ADDRESSIBILITY             12000001
         MODID BRANCH=YES                                        Y01886 12050001
         USING DXSA,XSAR           ADDRESSIBILITY OF XSA                12100001
         USING DSTRCT,RCTR         ADDRESSIBILITY OF RCT                12200001
         L     CVTR,CVTPTR         ADDRESS OF CVT                       12300001
         USING DCVT,CVTR           ADDRESSIBILITY OF THE CVT            12400001
         L     UCMR,CVTCUCB        ADDRESS OF UCM FROM CVT              12500001
         USING UCM,UCMR            ADDRESSIBILITY OF THE UCM     Y02669 12600002
         USING UCMLIST,ENTR        ADDRESSIBILITY OF UCM ENTRY          12700001
***                                                                   * 12800001
***   SECOND LOAD OF THE MSGRT HANDLER IS ENTERED FOR TWO CONDITIONS  * 12900001
***   IF AN ERROR CONDITION HAS BEEN FOUND IN THE FIRST LOAD          * 13000001
***   OR IF A MR REF COMMAND HAS BEEN ISSUED                          * 13100001
***                                                                   * 13200001
         SPACE 2                                                        13300001
***      IS THERE AN ERROR CODE IN THE XSA                       Y02669 13401002
STARTSC  EQU   *                                                        13600001
         CLI   XAE,ZERO            IS THERE AN ERROR CODE PRESENT?      13700001
         BNE   ERROR               BRANCH YES TO MSG MODULE EXIT        13800001
***                                                                   * 13900001
***   TEST FOR THE VERB OF THE MSGRT COMMAND                          * 14000001
***                                                                   * 14100001
         SPACE 2                                                        14200001
***      IS THIS A MSGRT REF COMMAND                             Y02669 14301002
***      IS THIS A MSGRT 'CONT' FUNCTION?                      @Z40LPTA 14351004
REFFMT   EQU   *                                                        14500001
         TM    XASSDS,XASSDS6      THIS CONTINUATION?          @Z40LPTA 14530004
         BO    REFPROC             YES, PROCESS CONTINUATION   @Z40LPTA 14560004
         CLC   N0(N4,LSTR),REF     IS THIS A REFERENCE VERB?            14600001
         BE    REFPROC             YES, PROCESS REF REQUEST      Y02669 14700004
         LTR   LSTR,LSTR           NO OPERANDS (REF DEFAULT)?    Y02669 14701002
         BNZ   ERROR1              NO, BRANCH TO ERROR EXIT      Y02669 14702002
REFPROC  EQU   *                   PROCESS REF OPERAND           Y02669 14703002
         SR    WRK1,WRK1           CLEAR REG                            14800001
         IC    WRK1,XAU            GET SOURCE CONSOLE ID                14900001
         BAL   BALR,FINDUCME       BRANCH TO FIND UCM ENTRY             15000001
         EJECT                                                          15100003
***      IS THE CONSOLE A SUBSYSTEM CONSOLE OR CRT             @Y02668P 15200003
*****************************************************************       15300001
         TM    XASSDS,XASSDS3      NON-COMMTASK(JES3) REQUEST? @Y02668P 15310003
         BNO   COMTASK1            NO,TEST FOR CRT             @Y02668P 15320003
         B     WRITE1              YES, TREAT AS NON-CRT       @Y02668P 15350003
COMTASK1 EQU   *                   CONTINUE REF PROCESSING     @Y02668P 15360003
         TM    UCMDISP,UCMDISPC    IS THIS CONSOLE A CRT                15400001
         BNO   WRITE1              BRANCH NO                            15500001
         L     CVTR,UCMXB          ADDRESS OF RESIDENT DCM              15600001
         L     CVTR,N0(CVTR)       ADDRESS OF TRANSIENT DCM             15700001
         USING DCMSTRT,CVTR     ADDRESSIBILITY OF TRANSIENT DCM  Y01012 15800101
         EJECT                                                          15900001
***      GET ADDRESS OF DCM ENTRY AREA                           Y02669 15901002
*****************************************************************       16100001
         L     WRK3,DCMAENTR       ADDRESS OF ENTRY AREA OF DCM         16200001
         LH    WRK4,DCMLGNTH       LENGTH OF LINE FROM DCM              16300001
         AR    WRK4,WRK4           TWO LINES IN ENTRY AREA              16400001
         MVI   XASAVLEN,BUFFDCM    SET DCM OUTPUT LENGTH       @Z40LPTA 16450004
BUILDL   EQU   *                                                        16500001
         ST    WRK3,XASAVBUF      SAV OUTPUT BUFFER PTR        @Z40LPTA 16510004
         LR    BALR,WRK3          BEGINNING OF BUFFER AREA     @Z40LPTA 16520004
         SR    WRK1,WRK1          ZERO REG                     @Z40LPTA 16530004
         IC    WRK1,XASAVLEN      GET OUTPUT LENGTH            @Z40LPTA 16540004
         AR    BALR,WRK1          MAXIMUM OUTPUT ADDRESS       @Z40LPTA 16550004
         ST    BALR,XASAVEND      SAVE END OF BUFFER ADDR      @Z40LPTA 16560004
BUILDL2  EQU   *                                               @Z40LPTA 16570004
         BAL   BALR,BLINST         BLANK INST. LINE                     16600001
         SR    WRK6,WRK6           CLEAR COUNT REG                      16700001
         MVC   N0(N3,WRK3),RTVB    MOVE MSGRT COMMAND INTO BUFFER       16800001
         LA    WRK3,N3(WRK3)       INCREMENT BUFFER AROUND MR CDR       16900001
         L     RCTR,UCMRCT         ADDRESS OF RCT FROM UCM              17000001
         LA    RCTR,N0(RCTR)       ZERO FLAG BYTE                       17100001
         SPACE 2                                                        17200001
***      IS THERE AN RCT FOR THIS CONSOLE                        Y02669 17201002
*****************************************************************       17400001
         LTR   RCTR,RCTR           IS THERE A RCT TABLE                 17500001
         BZ    NONEDISP            BRANCH NO                     Y02669 17600002
         LA    WRK1,VERTAB         ADDRESS OF VERB TABLE                17700001
         SPACE 2                                                        17800001
***      HAS THIS ENTRY BEEN DISPLAYED                           Y02669 17801002
*****************************************************************       18000001
SEARACT  EQU   *                                                        18100001
         TM    RCTCODE,RCTRES      HAS THIS ENTRY BEEN DISPLAYED        18200001
         BO    INCRCT              BRANCH YES                           18300001
         SPACE 2                                                        18400001
***      IS THIS ENTRY ACTIVE                                    Y02669 18401002
*****************************************************************       18600001
         TM    RCTCODE,RCTACT      IS THIS ENTRY ACTIVE                 18700001
         BO    TESTACT             BRANCH YES                           18800001
         SPACE 2                                                        18900001
***      IS THIS ENTRY CONTINUED                                 Y02669 18901002
*****************************************************************       19100001
INCRCT   EQU   *                                                        19200001
         TM    RCTCODE,RCTCON      IS THIS ENTRY CONTINUED OR THE END   19300001
         BO    NXTPTR              BRANCH IF CONTINUED                  19400001
         BM    BUILD1              BRANCH IF END                        19800001
         SPACE 2                                                        19900001
***      IF NEITHER CONTINUED NOR END, CHECK NEXT ENTRY          Y02669 19901002
*****************************************************************       20100001
         LA    RCTR,RCTLEN(RCTR)   INCREMENT TO NEXT ENTRY              20200001
         B     SEARACT             BRANCH TO CONTINUE SEARCH            20300001
         EJECT                                                          20400001
*****************************************************************       20700001
NXTPTR   EQU   *                                                        20800001
         L     RCTR,N0(RCTR)       ADDRESS OF NEXT TABLE SECTION        20900001
         B     SEARACT             BRANCH TO CONTINUE SEARCH            21000001
***                                                                   * 21100001
***  BUILD MESSAGE IN DCM INSTRUCTION LINE OR WTO BUFFER                21200001
***                                                                   * 21300001
         SPACE 2                                                        21400001
*****************************************************************       21600001
TESTACT  EQU   *                                                        21700001
         CLC   RCTVER(N1),N0(WRK1) IS THIS ENTRY EQUAL TO PRESENT VERB  21800001
         BNE   INCRCT              BRANCH NO                            21900001
         BAL   BALR,BUFCHK         CHECK BUFFER LENGTH LEFT    @Z40LPTA 21950004
         TM    XASPLS3,MVRB1       IS VERB IN BUFFER           @Y02668P 22000003
         BO    NOMOVE              BRANCH YES                           22100001
         ST    WRK3,XASTSAVE       SAVE ADDRESS IN BUFFER OF VERB       22200002
         OI    XASPLS3,MVRB1       SET VERB IN BUFFER FLAG     @Y02668P 22300003
         MVC   N1(N2,WRK3),RCTVER  MOVE VERB INTO BUFFER                22400001
         MVI   N0(WRK3),PARA1      PLACE PARENTHSIS BEFORE VERB         22500001
         LA    WRK6,N1(WRK6)       INCREMENT COUNT REG                  22600001
         CLI   RCTVER,CHARK        IS THIS A CONTROL VERB               22700001
         BE    MOVELOP             BRANCH YES                           22800001
         CLI   RCTVER,CHART        IS THIS A TRACK VERB          Y02669 22900002
         BNE   NOMOVE              BRANCH NO                            23000001
         MVI   N3(WRK3),EQUAL      MOVE EQUAL INTO BUFFER               23100001
         LA    WRK3,N1(WRK3)       INCREMENT BUFFER POINTER             23200001
NOMOVE   EQU   *                                                        23300001
         BAL   BALR,CVTCID         BRANCH TO CONVERT CC TO EBIDIC       23400001
         TM    XASPLS3,MOPD1       IS ONE OPERAND IN BUFFER    @Y02668P 23500003
         BO    TESTCCA             BRANCH YES TO COMPARE CCA            23600001
         LA    WRK3,N3(WRK3)       INCREMENT BUFFER POINTER             23700001
         MVI   N0(WRK3),PARA1      PLACE PARENTHSIS BEFORE OPERAND      23800001
         LA    WRK3,N1(WRK3)       INCREMENT BUFFER POINTER             23900001
         SPACE 2                                                        24000001
***      SET ENTRY DISPLAYED BIT IN THE RCT ON                   Y02669 24001002
*****************************************************************       24200001
MOVEOP   EQU   *                                                        24300001
         OI    RCTCODE,RCTRES      SET ENTRY DISPLAYED BIT              24400001
         MVC   N0(N1,WRK3),RCTOPD  MOVE OPERAND INTO BUFFER             24500001
         SPACE 2                                                        24501002
***      SPECIAL PROCESSING FOR MULTI-CHARACTER OPERANDS         Y02669 24502002
*****************************************************************       24503002
         CLI   N0(WRK3),CHARO      IS THIS THE CONSOLES OPERAND         24600001
         BNE   D3850CHK            NO, TEST FOR  D 3850        @Z40LPTA 24701004
         MVC   N0(N8,WRK3),CONSOLES MOVE 'CONSOLES' INTO BUFFER         24800002
         LA    WRK3,N7(WRK3)       INCREMENT BUFFER POINTER             24900001
         B     MCOMMA                                          @Z40LPTA 24950004
D3850CHK EQU   *                                                        24957004
         CLI   N0(WRK3),CHAR3      IS THIS D 3850 OPERAND    @Z40LPTA   24964004
         BNE   DDUMPCHK            NO, TEST FOR D DUMP         @G33CPMR 24967043
         MVC   N0(N4,WRK3),D3850   YES, MOVE IN OPERAND      @Z40LPTA   24978004
         LA    WRK3,N3(WRK3)       INCREMENT BUFFER PTR      @Z40LPTA   24985004
         B     MCOMMA                                          @G33CPMR 24987043
DDUMPCHK EQU   *                                               @G33CPMR 24988043
         CLI   N0(WRK3),CHARP      IS THIS D DUMP OPERAND?     @G33CPMR 24989043
         BNE   MCOMMA              NO, MOVE IN 'L='            @G33CPMR 24990043
         MVC   N0(L'DUMP,WRK3),DUMP YES, MOVE IN OPERAND       @G33CPMR 24991043
         LA    WRK3,N3(WRK3)       INCREMENT BUFFER PTR        @G33CPMR 24992043
MCOMMA   EQU   *                                                        25000001
         LA    WRK3,N1(WRK3)       INCREMENT AROUND PARENTHSIS          25100001
         MVC   N1(N3,WRK3),CLEQUAL  MOVE COMMA L AND EQUAL INTO BUFFER  25200001
         MVI   N0(WRK3),PARA2      MOVE IN PARENTHSIS                   25300001
NOPARA   EQU   *                                                        25400001
         MVC   N4(N2,WRK3),XAP+N2  MOVE IN CONSOLE ID                   25500001
         MVC   N6(N1,WRK3),RCTAID  MOVE IN AREA ID                      25600001
         OI    XASPLS3,MOPD1       SET ONE OPERAND FLAG        @Y02668P 25700003
         B     INCRCT              BRANCH FOR NEXT ENTRY                25800001
MOVELOP  EQU   *                                                        25900001
         OI    RCTCODE,RCTRES      SET ENTRY DISPLAYED BIT              26000001
         LA    WRK6,N1(WRK6)       INCREMENT COUNT OF VERBS             26100001
         LA    WRK3,N1(WRK3)       INCREMENT BUFFER PAST VERB           26200001
         BAL   BALR,CVTCID         BRANCH TO CONVERT CC TO EBIDIC       26300001
         B     MCOMMA              BRANCH TO MOVE IN L OPERAND          26400001
TESTCCA  EQU   *                                                        26500001
         CLC   N4(N2,WRK3),XAP+N2  IS THIS CONSOLE ID EQUAL             26600001
         BNE   INCRCT2             BRANCH NO                            26700001
         CLC   N6(N1,WRK3),RCTAID  IS THIS AREA ID EQUAL                26800001
         BNE   INCRCT2             BRANCH NO                            26900001
         MVI   N0(WRK3),COMMA      MOVE COMMA BETWEEN OPERANDS          27000001
         LA    WRK3,N1(WRK3)       INCREMENT BUFFER POINTER             27100001
         OI    XASPLS3,MOPD2       SET MULTIPLE OPERAND FLAG   @Y02668P 27200003
         B     MOVEOP              BRANCH TO MOVE IN OPERAND            27300001
BUILD1   EQU   *                                                        27400001
         L     WRK4,XASTSAVE       ADDRESS OF VERB                      27500001
         L     RCTR,UCMRCT         LOAD BEGINNING OF RCT                27600001
         TM    XASPLS3,MOPD1       WAS AN ENTRY MADE           @Y02668P 27700003
         BNO   NXTTAB              BRANCH NO FOR NEXT VERB SEARCH       27800001
         TM    XASPLS3,MOPD2       IS MULTIPLE OPERAND FLAG ON @Y02668P 27900003
         BO    ONEOPS              BRANCH YES                           28000001
         MVC   N0(N6,WRK3),N1(WRK3) MOVE L OPERAND OVER ONE             28100001
         CLI   N1(WRK4),CHARK      IS THIS A K COMMAND                  28200001
         BE    ONEOPS1             BRANCH YES                           28300001
         LA    BALR,N5(WRK3)       GET LENGTH OF TEXT                   28400001
         SR    BALR,WRK4           LENGTH FOR EXECUTE                   28500001
         EX    BALR,PARMOVE2       MOVE TEXT TO GET RID OF BLANKS       28600001
         CLI   N1(WRK4),CHART      THIS A TWO CHARACTER VERB TR? Y02669 28700002
         BNE   DISTYP              BRANCH NO                            28800001
         MVI   N3(WRK4),EQUAL      MOVE EQUAL AFTER TWO CHARACTER VERB  28900001
DISTYP   EQU   *                                                        29000001
         BCTR  WRK3,N0             ADJUST FOR BLANKS REMOVED            29100001
ONEOPS1  EQU   *                                                        29200001
         BCTR  WRK3,N0             ADJUST FOR BLANKS REMOVED            29300001
         EJECT                                                          29350001
ONEOPS   EQU   *                                                        29400001
         LA    WRK3,N6(WRK3)       INCREMENT BUFFER POINTER             29500001
         NI    XASPLS3,TF-MOPD1-MOPD2-MVRB1 SET OPD AND VERB   @Y02668PX29600003
                                   FLAGS OFF                   @Y02668P 29650003
         MVI   N1(WRK3),PARA2      MOVE PARENTHSIS AROUND VERB          29700001
         MVI   N2(WRK3),COMMA      COMMA INTO BUFFER                    29800001
         LA    WRK3,N3(WRK3)       INCREMENT BUFFER POINTER             29900001
         TM    XASPLS3,MVRB2       DOES VERB HAVE DIFFERENT    @Y02668PX30000003
                                   ROUTED OPERANDS             @Y02668P 30050003
         BNO   NXTTAB              BRANCH NO                            30100001
         NI    XASPLS3,TF-MVRB2    TURN OFF VERB MOVED FLAG    @Y02668P 30200003
         B     SEARACT             BRANCH BACK TO SEARCH RCT            30300001
NXTTAB   EQU   *                                                        30400001
         LA    WRK1,N1(WRK1)       INCREMENT VERB TABLE                 30500001
         CLI   N0(WRK1),XFF        IS THIS THE END                      30600001
         BNE   SEARACT             BRANCH NO                            30700001
         LTR   WRK6,WRK6           ARE THERE ANY ACTIVE ENTRIES IN RCT  30800001
         BZ    NONEDISP            BRANCH NO PUT OUT MESSAGE            30900002
         BCTR  WRK3,N0             DECREMENT BUFFER POINTER             31000001
         MVI   N0(WRK3),BLK        BLANK OUT COMMA CHARACTER            31100001
         CH    WRK6,ONE            IS COUNT OF VERB GREATER THAN ONE    31200001
         BH    DISPLAY             BRANCH YES TO TURN OFF        Y02669 31300002
*                                  'DISPLAYED' FLAG IN RCT       Y02669 31301002
         BCTR  WRK3,N0             DECREMENT BUFFER POINTER             31400001
         MVI   N0(WRK3),BLK        BLANK OUT PARENTHSIS CHARACTER       31500001
         LR    WRK1,WRK3           END ADDRESS OF                       31600001
         SR    WRK1,WRK4           LENGTH OF VERB TEXT                  31700001
         BCTR  WRK1,N0             DECREMENT COUNT BY ONE               31800001
         EX    WRK1,PARMOVE1       MOVE TO BLANK VERB PARENTHSIS        31900001
         BCTR  WRK3,N0             DECREMENT BUFFER POINTER             32000001
*                                  I.E. SHIFT TEXT LEFT ONE BYTE Y02669 32001002
         SPACE 2                                                        32100001
*****************************************************************       32300001
DISPLAY  EQU   *                                                        32400001
         NI    RCTCODE,TF-RCTRES   TURN OFF DISPLAYED FLAG IN RCT       32500002
         TM    RCTCODE,RCTCON      IS THIS ENTRY THE END OR CONTINUED   32600001
         BM    DISPLAY2            BRANCH YES END                       32700001
         BO    NXTPTR3             BRANCH YES CONTINUED                 32800001
         LA    RCTR,RCTLEN(RCTR)   INCREMENT TO NEXT ENTRY              32900001
         B     DISPLAY             BRANCH BACK TO SEARCH                33000001
NXTPTR3  EQU   *                                                        33100001
         L     RCTR,N0(RCTR)       NEXT SECTION OF THE RCT              33200001
         B     DISPLAY             BRANCH BACK TO SEARCH                33300001
         EJECT                                                          33400001
***      NO ACTIVE ENTRIES, OR NO RCT'S, FOUND                  Y02669  33450002
*****************************************************************       33600001
NONEDISP EQU  *                                                 Y02669  33650002
         MVC  N0(N4,WRK3),NONE     MOVE IN 'NONE'               Y02669  33660002
         LA   WRK3,N4(WRK3)        INCREMENT BUFFER PAST 'NONE' Y02669  33660402
     SPACE 2                                                            33662002
*****************************************************************       33670002
DISPLAY2 EQU   *                                                        33700001
         TM    XASSDS,XASSDS3      NON-COMMTASK (JES3) REQUEST?@Y02668P 33710003
         BNO   COMTASK2            NO, CONTINUE CHECKS         @Y02668P 33720003
         BAL   LNKR,CLRLOCK        YES, RELEASE LOCKS          @Y02668P 33730003
         B     WRITE2              GO DO WTO                   @Y02668P 33740003
COMTASK2 EQU   *                                               @Y02668P 33750003
         TM    UCMDISP,UCMDISPC    IS THIS CONSOLE A CRT                33900001
         BNO   WRITE2              BRANCH NO                            34000001
         SPACE 2                                                        34100001
***      SET   CHANGE OPTIONS MESSAGE CODE IN XAE                Y02669 34101002
*****************************************************************       34400001
         L     WRK6,DCMAENTR       ADDRESS OF ENTRY AREA OF DCM         34500001
         LA    WRK6,N3(WRK6)       ADDRESS OF CURSOR FOR MSG RTN        34600001
         MVI   XAE,CHGOPT          MSG CODE FOR CHANGE OPTIONS          34700001
         B     ERROR               BRANCH TO PUT OUT MSG                34800001
INCRCT2  EQU   *                                                        34900001
         OI    XASPLS3,MVRB2       SET MULTIPLE OPERANDS FLAG  @Y02668P 35000003
         B     INCRCT              BRANCH FOR NEXT ENTRY                35100001
CVTCID   EQU   *                                                        35200001
         SR    WRK4,WRK4           CLEAR REG                            35300001
         IC    WRK4,RCTCID         GET CONSOLE ID FROM RCT              35400002
         CVD   WRK4,XAP            CONVERT CONSOLE ID TO DECIMAL        35500001
         UNPK  XAP+N1(N3),XAP+N6(N2) CONVERT TO PRINTABLE CHARACTERS    35600001
         OI    XAP+N3,CF0          CHANGE ZONE TO EBDIC                 35700001
         BR    BALR                BRANCH BACK TO CALLING RTN           35800001
         SPACE 2                                                        35900001
***      GETMAIN STORAGE FOR MESSAGE BUFFER                      Y02669 35901002
*****************************************************************       36100001
WRITE1   EQU   *                                                        36200001
         LA    WRK1,XAX+N4         AREA FOR STORAGE ADDRESS             36300001
         MVC   XAP(N10),GETAREA    MOVE REMOTE PARAMETER LIST TO XSA    36400001
         ST    WRK1,XAD            AREA FOR GETMAIN TO STORE ADDRESS    36500001
         LA    WRK1,XAP            ADDRESS OF REMOTE LIST FOR GETMAIN   36600001
         GETMAIN MF=(E,(1))        GET CORE FOR WTO                     36700001
         LTR   LNKR,LNKR           IS RETURN CODE ZERO                  36800001
         BNZ   ERROR2              NO, GO SET-UP FOR IEE931I     Y02669 36900002
         L     WRK3,XAX+N4         BUFFER ADDRESS                       37000001
         XC    N0(N4,WRK3),N0(WRK3) ZERO FOUR BYTES                     37100001
         OI    N2(WRK3),MCSFG      SET MCS FLAGES FOR WTO               37200001
         LA    WRK3,N4(WRK3)       INCREMENT BUFFER ADDRESS             37300001
         TM    XASSDS,XASSDS3      NON-COMMTASK(JES3) REQUEST? @Y02668P 37310003
         BNO   COMTASK3            NO, UNDER COMMTASK, NO      @Y02668P 37320003
*                                  LOCKS NEEDED                @Y02668P 37330003
         BAL   LNKR,GETLOCK        YES, GET CMS/LOCAL LOCKS    @Y02668P 37340003
COMTASK3 EQU   *                   CONTINUE REF PROCESSING     @Y02668P 37350003
*****************************************************************       37600001
         MVC   N0(N8,WRK3),IEE     MESSAGE ID INTO BUFFER               37700001
         LA    WRK3,N8(WRK3)       INCREMENT BUFFER AROUND MSG ID       37800001
         LA    WRK4,N120           LENGTH OF BUFFER REMAINING           37900004
         MVI   XASAVLEN,BUFFWTO    SET WTO OUTPUT LENGTH       @Z40LPTA 37930004
         B     BUILDL              BRANCH TO BUILD MESSAGE              38000001
         EJECT                                                          38100003
***      WRITE MESSAGE VIA WTO TO NON-CRT CONSOLE                Y02669 38101002
*****************************************************************       38300001
WRITE2   EQU   *                                                        38400001
         LR    WRK6,WRK3           SAVE ADDRESS OF MSG END     @Y02668P 38450003
         L     WRK3,XAX+N4         ADDRESS OF GETMAINED AREA            38500001
         SR    WRK6,WRK3           GET LENGTH OF BUFFER  TEXT           38600001
         STH   WRK6,N0(WRK3)       LENGTH OF WTO MSG PLUS 4             38700001
         AR    WRK6,WRK3           END OF BUFFER                        38800001
         MVC   N0(N4,WRK6),DRCODES MOVE IN DESC AND ROUTE CODES         38900001
         SR    WRK0,WRK0           CLEAR REG                            39000001
         IC    WRK0,XAU            TERMINAL ID FROM XSA                 39100001
         WTO   MF=(E,(WRK3))       WRITE MESSAGE                        39200001
         SPACE 2                                                        39201002
***      FREEMAIN MESSAGE BUFFER                                 Y02669 39202002
*****************************************************************       39500001
         L     WRK1,XAX+N4         ADDRESS OF WORD FOR GETMAIN          39600001
         FREEMAIN R,LV=N132,A=(1),SP=SUBP                      @Z40LPTA 39700004
         SPACE 2                                                        39800001
***      EXIT:  RETURN TO CALLER                                 Y02669 39801002
*****************************************************************       40000001
RET      EQU   *                                                 Y02669 40001002
         BR    RETR                RETURN TO CALLER                     40100001
***                                                                     40150001
***   BLANK BUFFER FOR MESSAGE                                          40160001
***                                                                     40170001
BLINST   EQU   *                                                        40200001
         BCTR  WRK4,N0             DECREMENT THE LENGTH -               40300001
         BCTR  WRK4,N0             BY TWO                               40400001
         MVI   N0(WRK3),BLK        BLANK FIRST CHARACTER                40500001
         EX    WRK4,BLI            PROPAGATE BLANKS                     40600001
         BR    BALR                RETURN FROM SUBROUTINE               40700001
         EJECT                                                          40750001
BUFCHK   EQU   *                                               @Z40LPTA 40751004
* TEST REMAINDER OF THE OUTPUT BUFFER TO DETERMINE IF THE               40752004
* NEXT OPERAND OR VERB WILL CAUSE BUFFER-OVERFLOW. IF IT                40753004
* WILL, SET UP THE 'CONT' OPERAND.                                      40754004
         ST    WRK4,XAD              SAVE REG VALUE                     40755004
         CLI   RCTVER,CHARD        THIS DISPLAY VERB           @Z40LPTA 40755304
         BNE   CHECKTR             NO, TEST FOR TRACK          @Z40LPTA 40755604
         LA    WRK4,MAXOP(WRK3)    LENGTH OF MAX OPERAND +CONT @Z40LPTA 40756004
         B     CHECKPTR            CHECK BUFFER CONTENT        @Z40LPTA 40756104
CHECKTR  EQU   *                                               @Z40LPTA 40756204
         CLI   RCTVER,CHART        THIS TRACK VERB             @Z40LPTA 40756304
         BNE   CHECKKCM            NO, SET UP K CMND. LEN      @Z40LPTA 40756404
         LA    WRK4,TRACKOP(WRK3)  LEN OF TRACK OPERAND + CONT @Z40LPTA 40756504
         B     CHECKPTR            CHECK BUFFER CONTENT        @Z40LPTA 40756604
CHECKKCM EQU   *                                               @Z40LPTA 40756704
         LA    WRK4,KCDROP(WRK3)   LEN OF K CMND + CONT        @Z40LPTA 40756804
CHECKPTR EQU   *                                               @Z40LPTA 40756904
         CLI   N0(WRK3),PARA2      PTR AT '),L=CCA' ?                   40757004
         BNE   NEXTCHK             NO, AT END OF VERB                   40758004
         LA    WRK4,N6(WRK4)       YES,BUMP PAST 'L=' VALVE             40759004
NEXTCHK  EQU   *                                                        40760004
         C     WRK4,XASAVEND      WILL OPERAND FIT?                     40761004
         BH    SETCONT            NO, SET UP CONTINUATION               40762004
         L     WRK4,XAD           RESTORE REG VALUE                     40763004
         BR    BALR               RETURN TO MAIN-LINE                   40764004
SETCONT  EQU   *                                                        40765004
* ENTRY HERE IS TO SET UP THE 'CONT'  OPERAND IN THE OUTPUT             40766004
* BUFFER. DETERMINE WHAT THE LAST CHARACTER IS IN THE BUFFER-           40767004
* ', ' OR '(L=CCA' ; INITIALIZE IT WITH THE 'CONT' OPERAND.             40768004
*                                                                       40769004
         CLI   N0(WRK3),BLK        THIS END OF VERB ?                   40770004
         BNE   MULTOP              NO, MULTIPE OPERAND.                 40771004
         MVC   N0(N4,WRK3),CONT    SET UP 'CONT' OPERAND                40772004
         LA    WRK3,N4(WRK3)       ADJUST BUFFER ADDRESS       @Z40LPTA 40772504
         B     TSTCONT                                                  40773004
MULTOP   EQU   *                                                        40774004
         LR    WRK4,WRK3           GET OUTPUT BUFFER PTR                40774104
         BCTR  WRK4,N0             DECREMENT PTR                        40774204
         BCTR  WRK4,N0                           BY TWO                 40774304
         CLI    N0(WRK4),PARA1      THIS LEFT PAREN                     40774404
         BNE    MULTOP1             NO, CONTINUE                        40774504
         MVC    N0(N8,WRK4),N1(WRK4) YES, DELETE RIGHT PAREN            40774604
         MVC    N1(N6,WRK4),N2(WRK4) DELETE RIGHT PAREN                 40774704
         LR     WRK3,WRK4           RE-SET OUTPUT BUFFER PTR            40774804
MULTOP1  EQU    *                                                       40774904
         CLI   N6(WRK3),ZERO       AREA ID SPECIFIED ?                  40775004
         BNE   MOVEND              YES                                  40776004
         MVI   N6(WRK3),ASTRICK    NO, SET SPECIAL FILLER               40777004
MOVEND   EQU   *                                                        40778004
         MVC   N7(N6,WRK3),PCCONT  MOVE IN ' ),CONT'                    40779004
         LA    WRK3,N13(WRK3)      ADJUST BUFFER ADDRESS       @Z40LPTA 40779504
TSTCONT  EQU   *                                                        40780004
         TM    XASSDS,XASSDS6      ARE WE PROCESSING CONT NOW           40781004
         BNO   SETRCT              NO, ISSUE FIRST MR                   40782004
         XC    XASPLS3,XASPLS3     CLEAR INTERNAL FLAGS        @Z40LPTA 40783004
         NI    XASSDS,TF-XASSDS6   CLEAR 'CONT' INDICATOR               40784004
* SET UP TO BLANK OUT THE OUTPUT BUFFER, SO IT CAN BE RE                40785004
* INITIALIZED WITH THE REMAINING RCT ENTRIES.                           40786004
*                                                                       40787004
         SR    WRK4,WRK4           ZERO LENGTH REG                      40788004
         IC    WRK4,XASAVLEN       GET OUTPUT LENGTH                    40789004
         L     WRK3,XASAVBUF       GET BUFFER ADDRESS                   40790004
         B     BUILDL2             START RE-SCAN                        40791004
SETRCT   EQU   *                                                        40792004
         L     RCTR,UCMRCT         RCT TABLE ADDRESS                    40793004
         LA    RCTR,N0(RCTR)       CLEAR HI-BYTE                        40794004
         B     DISPLAY             PROCESS THIS BUFFER                  40795004
         EJECT                                                          40796004
***                                                                     40800001
***  FIND AND SET BASE FOR UCM ENTRY - INPUT - WRK1 CONTAINS CONSOLE ID 40900001
***                                  - OUTPUT - UCM ENTRY SPECIFIED BY  41000001
*                                              ID IN ENTR REG           41100001
*                                                                     * 41200001
FINDUCME EQU   *                                                        41300001
         L     ENTR,UCMVEA         FIRST ENTRY FROM UCM                 41400001
         BCTR  WRK1,N0             SUBRRACT ONE FROM CONSOLE ID         41500001
         M     WRK0,UCMVEZ         MULIPLY ENTRY SIZE BY REDUCED ID     41600001
         AR    ENTR,WRK1           ADDRESS OF DESIRED UCM ENTRY         41700001
         BR    BALR                RETURN FROM SUBROUTINE               41800001
         SPACE 2                                                        41801002
***      SET NO STORAGE CODE IN XSA                              Y02669 41802002
*****************************************************************       41803002
ERROR2   MVI   XAE,NCERROR         MESSAGE CODE FOR IEE931I      Y02669 41804002
         LR    WRK6,LSTR           ADDRESS OF 'REF ' IN BUFFER   Y02669 41805002
         B     ERROR               GO FINISH MSG INTERFACE       Y02669 41806002
         SPACE 2                                                        41900001
***      SET INVALID OPERAND CODE IN XSA                         Y02669 41901002
*****************************************************************       42100001
ERROR1   EQU   *                                                        42200001
         MVI   XAE,IOERROR         ERROR CODE FOR INVALID OPERAND       42300001
         LR    WRK6,LSTR           ADDRESS OF INVALID OPERAND           42400001
         SPACE 2                                                        42500001
***                                                              Y02669 42501002
***      SET SECONDARY MESSAGE CODE IN XSA                       Y02669 42502002
***                                                              Y02669 42503002
ERROR    EQU   *                                                        42800001
         CLI   XAE,LIERROR         IS THIS AN INVALID L OPERAND MSG     42900001
         BE    EXIT                BRANCH YES TO MSG MODULE             43000001
         ST    WRK6,XASTSAVE       STORE ADDRESS OF INVALID OPERAND     43100001
         CLI   XAE,KERROR          IS THIS A K ERROR MSG                43200001
         BNE   EXIT                BRANCH NO TO MSG MODULE              43300001
         MVI   XASTSAVE,NONCRT     SET SECONDARY ERROR CODE FOR MSG     43400001
         SPACE 2                                                        43500001
***                                                              Y02669 43501002
***      EXIT TO MR MESSAGE MODULE 1     IEE5603D                Y02669 43502002
***                                                              Y02669 43503002
EXIT     EQU   *                                                        43800001
         NI    XASSDS,XFF-XASSDS5  TURN OFF LOCK FLAG TO AVOID   Y02651 43801002
*                                  FALSE INDICATION TO IEE5603D  Y02651 43802002
*                                  THAT LOCKS ARE HELD           Y02651 43803002
         L     LNKR,MSGL1          ADDRESS OF MSG MODULE         Y02669 43900002
         BR    LNKR                BRANCH TO IEE5603D            Y02669 43901002
     EJECT                                                              43931003
******************************************************************      43961003
***      GETLOCK ROUTINE.                                      @Y02668P 43991003
***      ACQUIRES LOCAL AND CMS LOCKS,IF NOT ALREADY HELD.     @Y02668P 44021003
******************************************************************      44051003
     SPACE 2                                                            44081003
GETLOCK  TM    XASSDS,XASSDS5      LOCKS ALREADY HELD?         @Y02668P 44111003
         BO    LOKSHELD            YES, DON'T REACQUIRE        @Y02668P 44141003
         STM   LSTR,RETR,XASAVLOC  SAVE REGS ACROSS SETLOCKS   @Y02668P 44171003
SETLOCK1 SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @Y02668PX44201003
               RELATED=(RCT,IEE6403D(CLRLOCK1))                @Y02668P 44231003
SETLOCK2 SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                  @Y02668PX44261003
               RELATED=(RCT,IEE6403D(CLRLOCK2))                @Y02668P 44291003
         LM    LSTR,RETR,XASAVLOC  RESTORE SAVED REGS          @Y02668P 44321003
         OI    XASSDS,XASSDS5      SET LOCKS HELD SWITCH       @Y02668P 44351003
LOKSHELD BR    LNKR                RETURN TO CALLER            @Y02668P 44381003
         SPACE 2                                                        44500001
******************************************************************      44510003
***      CLRLOCK ROUTINE. RELEASES CMS AND LOCAL LOCKS,IF HELD.@Y02668P 44520003
******************************************************************      44530003
         SPACE                                                          44540003
CLRLOCK  TM    XASSDS,XASSDS5      LOCKS HELD?                 @Y02668P 44550003
         BZ    N0(LNKR)            NO,RETURN TO CALLING ROUTINE@Y02668P 44560003
         STM   LSTR,RETR,XASAVLOC  SAVE REGS ACROSS SETLOCKS   @Y02668P 44570003
CLRLOCK2 SETLOCK RELEASE,TYPE=CMS,                             @Y02668PX44580003
               RELATED=(RCT,IEE6403D(SETLOCK2))                @Y02668P 44590003
CLRLOCK1 SETLOCK RELEASE,TYPE=LOCAL,                           @Y02668PX44600003
               RELATED=(RCT,IEE6403D(SETLOCK1))                @Y02668P 44610003
         LM    LSTR,RETR,XASAVLOC  RESTORE SAVED REGS          @Y02668P 44620003
         NI    XASSDS,XFF-XASSDS5  TURN OFF LOCKS HELD SWITCH  @Y02668P 44630003
         BR    LNKR                RETURN TO CALLING ROUTINE   @Y02668P 44640003
         SPACE 2                                                        44650003
*****************************************************************       44700001
BLI      MVC   N1(N0,WRK3),N0(WRK3)  USED TO BLANK INST LINE            44800001
PARMOVE2 MVC   N3(N0,WRK4),N4(WRK4) ELIMINATE PARENTHSIS                44900001
PARMOVE1 MVC   N0(N0,WRK4),N1(WRK4) ELIMINATE PARENTHSIS                45000001
         EJECT                                                          45050001
********                                                              * 45100001
******** CONSTANT USED BY ROUTINE                                     * 45200001
********                                                              * 45300001
REF      DC    C'REF '             REFERENCE VERB                       45400001
CONSOLES DC    C'CONSOLES'         CONSOLES OPERAND IN RCT IS O         45500001
D3850    DC    C'3850'             D 3850 OPERAND IN RCT IS 3  @Z40LPTA 45530004
DUMP     DC    C'DUMP'             D DUMP OPERAND IN RCT IS P  @G33CPMR 45540043
CONT     DC    C'CONT'             CONTINUATION OPERAND        @Z40LPTA 45560004
PCCONT   DC    C'),CONT'           CONTINUATION + DELIMITER    @Z40LPTA 45570004
IEE      DC    C'IEE930I '         MESSAGE ID FOR MSGRT REF CDR         45600001
RTVB     DC    C'MR '              MSGRT COMMAND                        45700001
VERTAB   DC    C'DTK'              VERB TABLE                    Y02669 45800002
         DC    X'FF'               END OF VERB TABLE                    45900001
CLEQUAL  DC    C',L='              L OPERAND                            46000001
NONE     DC    C'NONE'             NONE OPERAND                  Y02669 46050002
MSGL1    DC    V(IEE5603D)         MSG MODULE LOAD ONE           Y02669 46100002
DRCODES  DC    X'0800'             DESCRIPTOR CODES                     46200001
         DC    X'0000'             ROUTING CODES                        46300001
ONE      DC    H'1'                VALUE ONE                            46400001
GETAREA  GETMAIN EC,LV=N132,A=EXIT,SP=SUBP,MF=L                @Z40LPTA 46500004
PATCH    DC    CL50'***  IEE6403D  PATCH AREA  ***'            @G33CPMR 46550043
          TITLE  'TRANSIENT DISPLAY CONTROL MODULE MAP'                 46601002
         IEETDCM                                                 Y01012 47100101
          TITLE 'UNIT CONTROL MODULE MAP'                               47101102
         IEECUCM  FORMAT=NEW                                     Y02669 47400002
          TITLE 'CVT MAP'                                               47401002
DCVT     DSECT                                                          47600001
         CVT                                                            47700001
          TITLE 'EXTENDED SAVE AREA (XSA) MAP'                          47800002
DXSA     DSECT                                                          47900001
         IEEXSA                                                         48900003
         SPACE 2                                                        48950004
***************************************************************@Z40LPTA 49000004
*        THE FOLLOWING FIELDS ARE USED ONLY BY THIS MODULE,    @Z40LPTA 49050004
*        AS A STORAGE AREA FOR DATA PERTINENT TO THIS MODULES  @Z40LPTA 49100004
*        FUNCTION ONLY.                                        @Z40LPTA 49150004
         ORG   XASAVSTD                                        @Z40LPTA 49200004
XASAVBUF DS    F                   TEXT BEGINNING ADDRESS      @Z40LPTA 49250004
XASAVEND DS    F                   TEXT END ADDRESS            @Z40LPTA 49300004
XASAVLEN DS    X                   TEXT LENGTH                 @Z40LPTA 49350004
IEE6403D  TITLE 'ROUTE CONTROL TABLE MAP'                               50100002
DSTRCT   DSECT                                                   Y02669 50100202
         IEECVMAP RCT                                                   50101002
          TITLE 'PREFIX STORAGE AREA MAP'                               51101003
         IHAPSA                                                         52101003
         END                                                            53300001
