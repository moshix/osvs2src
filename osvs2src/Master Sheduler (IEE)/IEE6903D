         TITLE 'IEE6903D SVC 34 K A COMMAND LOAD 5'                     00900002
*********************************************************************** 01000001
*                                                                     * 01050002
* MODULE NAME         =  IEE6903D                               Y02669* 01100002
*                                                                     * 01150002
* DESCRIPTIVE NAME    =  CONTROL (K) A AND T COMMAND HANDLER    Y02669* 01200002
*                                                                     * 01250002
* COPYRIGHT           =  N/A                                    Y02669* 01300002
*                                                                     * 01350002
* STATUS              =  01 - UPDATE FOR VS/2 RELEASE 3 PTF   @ZA07770* 01400003
*                                                                     * 01450002
* FUNCTION            =  HANDLES THE                            Y02669* 01460002
*                             K A            K T                Y02669* 01460502
*                             K A,REF        K A,REF            Y02669* 01461002
*                             K A,NONE       K T,UTME           Y02669* 01461502
*                        COMMANDS WHICH CAN BE HANDLED WITH-    Y02669* 01462002
*                        OUT REFERENCE TO THE TRANSIENT DCM.    Y02669* 01469002
*                        (I.E. NO DIRECT INTERFACE IS           Y02669* 01476002
*                              REQUIRED WITH DIDOCS)            Y02669* 01483002
*                                                                     * 01490002
*   OPERATION         =  THE COMMAND IS VALIDITY CHECKED.       Y02669* 01492002
*                        IF AN INVALID OPERAND IS FOUND,        Y02669* 01492102
*                        'IEE156I INVALID OPERAND' IS ISSUED.   Y02669* 01492402
*                                                                     * 01492802
*                        IF (JES3) A TASK OTHER THAN COMTASK  @Y02668P* 01492903
*                        ISSUED THE COMMAND THEN THE MESSAGE  @Y02668P* 01493003
*                        IS ISSUED VIA WTO. THE XASSDS3 BIT   @Y02668P* 01493103
*                        IN THE XSA IS CHECKED. IF IT IS ON   @Y02668P* 01493803
*                        THEN A JES3 ASSOCIATED CONSOLE       @Y02668P* 01493903
*                        ISSUED THE COMMAND                   @Y02668P* 01497603
*                                                                     * 01498203
*                        K A; K A,REF                           Y02669* 01498903
*                        ___  _______                           Y02669* 01499903
*                        IF NOT A GRAPHICS CONSOLE, MESSAGES    Y02669* 01500403
*                        'IEE929I' AND 'IEE928I' ARE ISSUED     Y02669* 01500903
*                        VIA THE WTO MACRO. THE LOCKS ARE       Y02669* 01501403
*                        RELEASED PRIOR TO THE WTO, FREEMAIN    Y02669* 01502203
*                        AND CONTROL IS RETURNED.               Y02669* 01503203
*                                                                     * 01504203
*                        IF THE CONSOLE IS CRT, THE MESSAGE     Y02669* 01504603
*                        TEXT IS MOVED INTO THE DCM INSTRUCTION Y02669* 01505003
*                        LINE, THE OPTIONS INDICATOR FOR        Y02669* 01505803
*                        MESSAGE 'IEE150I' IS SET IN THE XSA    Y02669* 01507003
*                        AND CONTROL IS GIVEN TO IEE5603D WITH  Y02669* 01507403
*                        THE LOCKS HELD.                        Y02669* 01508403
*                                                                     * 01509103
*                        K T; K T;REF                           Y02669* 01509203
*                        --- --------                           Y02669* 01509903
*                        IF NOT A GRAPHICS CONSOLE, MESSAGE     Y02669* 01511203
*                        'IEE922I' IS ISSUED VIA THE WTO MACRO. Y02669* 01511803
*                        IF NO TRACK IS ACTIVE ON THE TARGET    Y02669* 01512503
*                        CONSOLE 'IEE158I NO TRACK ACTIVE' IS   Y02669* 01513003
*                        ISSUED TO THE SOURCE CONSOLE. THE      Y02669* 01513503
*                        LOCKS ARE RELEASED PRIOR TO THE        Y02669* 01514103
*                        GETMAIN. THE WTO AND FREEMAIN ARE      Y02669* 01514803
*                        ISSUED AND CONTROL IS RETURNED.        Y02669* 01515803
*                                                                     * 01516403
*                        IF THE CONSOLE IS CRT, THE MESSAGE     Y02669* 01517103
*                        TEXT IS MOVED INTO THE DCM INSTRUCTION Y02669* 01518103
*                        LINE, THE OPTIONS INDICATOR FOR        Y02669* 01518703
*                        MESSAGE 'IEE150I' IS SET IN THE XSA    Y02669* 01519403
*                        AND CONTROL IS GIVEN TO IEE5603D WITH  Y02669* 01519903
*                        THE LOCKS HELD.                        Y02669* 01520403
*                                                                     * 01521703
*                        K A,NONE                               Y02669* 01522203
*                        --------                               Y02669* 01522703
*                        THE TARGET CONSOLE'S UCME ADDRESS      Y02669* 01523203
*                        IS FOUND BASED ON THE INDEX IN         Y02669* 01524003
*                        XASCID.  THE GETMAINED SACB'S          Y02669* 01525003
*                        ASSOCIATED WITH THAT UCME ARE THEN     Y02669* 01525503
*                        FREEMAINED.                            Y02669* 01526603
*                                                                     * 01526903
*                        IF THERE IS AN ACTIVE STATUS OR        Y02669* 01527503
*                        DYNAMIC DISPLAY IN ANY OF THE AREAS,   Y02669* 01528603
*                        'IEE924I DISPLAY IN OR ABOVE AREA' IS  Y02669* 01528903
*                        ISSUED.                                Y02669* 01529503
*                                                                     * 01530403
*                        WHEN ALL THE SACB'S ARE FREED,         Y02669* 01530903
*                        'IEE928I' IS ISSUED BY THE WTO MACRO   Y02669* 01531603
*                        AFTER THE LOCKS HAVE BEEN RELEASED.    Y02669* 01532303
*                        CONTROL IS THEN RETURNED.              Y02669* 01533203
*                                                                     * 01534203
*                        K T,UTME=                              Y02669* 01534703
*                        ---------                              Y02669* 01535203
*                        THE TARGET CONSOLE'S UCME ADDRESS IS   Y02669* 01536203
*                        FOUND BASED ON THE INDEX IN XASCID.    Y02669* 01536703
*                        THE SACB'S ARE SEARCHED FOR AN AREA    Y02669* 01537203
*                        WITH AN ACTIVE TRACK DISPLAY. IF NONE  Y02669* 01538203
*                        IS FOUND 'IEE158I' IS ISSUED. OTHER-   Y02669* 01539203
*                        WISE THE NEW TIME INTERVAL VALUE IS    Y02669* 01539703
*                        STORED IN THE SACB, THE LOCKS          Y02669* 01540203
*                        RELEASED AND CONTROL RETURNED.         Y02669* 01541203
*                                                                     * 01541703
* NOTES                                                         Y02669* 01542203
*                                                                     * 01543203
*   CHARACTER-CODE                                              Y02669* 01543903
*    DEPENDENCIES     =  ANY CHARACTER CODE OTHER THAN EBCDIC   Y02669* 01544603
*                        WILL REQUIRE REASSEMBLY OF THIS MODULE.Y02669* 01545303
*                        NOTE: THIS MODULE USES CHARACTER       Y02669* 01546003
*                        REPRESENTATIONS FOR BLANK AND COMMA.   Y02669* 01546703
*                                                                     * 01547403
*   DEPENDENCIES      =  IEE7503D WILL ENSURE THAT ALL TARGET   Y02669* 01548103
*                        CONSOLES ARE CRT DEVICES.              Y02669* 01548803
*                                                                     * 01549503
*   RESTRICTIONS      =  THE TARGET CONSOLE MUST BE A GRAPHICS  Y02669* 01550203
*                        DEVICE.                                Y02669* 01550903
*                                                                     * 01551603
*   REGISTER                                                    Y02669* 01552303
*    CONVENTIONS      =  NONE                                   Y02669* 01553202
*                                                                     * 01563202
*   PATCH-LABEL       =  PATCH                                  Y02669* 01565202
*                                                                     * 01565602
* MODULE TYPE         =  CSECT                                  Y02669* 01566002
*                                                                     * 01566402
*   PROCESSOR         =  N/A                                    Y02669* 01566502
*                                                                     * 01566602
*   MODULE SIZE       =  X'581' + X'41' PATCH AREA              Y02669* 01577702
*                                                                     * 01587702
*   ATTRIBUTES        =  REFRESHABLE, REENTRANT, SUPERVISOR     Y02669* 01588102
*                        MODE, KEY 0, PAGED LPA                 Y02669* 01588302
*                                                                     * 01588602
* ENTRY POINT         =  IEE6903D FROM IEE6703D                 Y02669* 01593302
*   PURPOSE           =  TO PROCESS THE K A AND K A,REF AND     Y02669* 01593402
*                        K A,NONE AND K T AND K T,REF AND       Y02669* 01594402
*                        K T,UTME COMMANDS                      Y02669* 01595802
*   LINKAGE           =  BRANCH                                 Y02669* 01596402
*   INPUT DATA        =  REG 2 POINTS TO THE XSA                Y02669* 01597002
*                           XAL - POINTS TO COMMAND BUFFER      Y02669* 01598802
*                           XAS - L=CCA INFORMATION             Y02669* 01599802
*                           XASSDS3-ON IF CMD ISSUED FROM     @Y02668P* 01600103
*                                   A MEMORY OTHER THAN       @Y02668P* 01601103
*                                   COMTASK (JES3)            @Y02668P* 01602103
*                           XASSDS5 ON - LOCKS HELD             Y02651* 01603103
*                           XAU - ISSUING CONSOLE ID            Y02669* 01604803
*                        REG 14 CONTAINS THE RETURN ADDRESS     Y02669* 01606803
*                                                                     * 01607803
*   REGISTERS SAVED   =  REG 2 IS UNTOUCHED                     Y02669* 01610803
*                        REG 14 IS SAVED IN XSA (XAP)           Y02669* 01611803
*                        REG 11-14 SAVED BEFORE ISSUING         Y02651* 01612803
*                                  SETLOCK AT FREELOCK          Y02651* 01613803
*                                                                     * 01614803
*   REGISTER CONTENTS                                           Y02669* 01615803
*    DURING PROCESSING=  R0 - WORK REGISTER                     Y02669* 01616803
*                        R1 - WORK REGISTER                     Y02669* 01622102
*                        R2 - BASE REG FOR XSA                  Y02669* 01632102
*                        R3 - BASE REG FOR UCM                  Y02669* 01642102
*                        R4 - POINTS TO COMMAND OPERANDS        Y02669* 01644102
*                        R5 - SUBROUTINE BRANCH REG             Y02669* 01646102
*                        R6 - WORK REGISTER                     Y02669* 01648102
*                        R7 - WORK REGISTER                     Y02669* 01656702
*                        R8 - BASE REG FOR UCME                 Y02669* 01658702
*                        R9 - BASE REG FOR TRANSIENT DCM        Y02669* 01660702
*                        R10- BASE REG FOR RESIDENT DCM         Y02669* 01662702
*                        R11- SUBROUTINE BRANCH REG             Y02669* 01664702
*                        R12- BASE REG FOR SACB                 Y02669* 01665102
*                        R13- BASE REG FOR THIS MODULE          Y02669* 01665202
*                        R14- SUBROUTINE BASE REG               Y02669* 01665302
*                        R15- WORK REGISTER                     Y02669* 01665402
*                                                                     * 01674002
*   REGISTERS RESTORED=  REG 14 RESOTRED AT EXIT AND D5603D     Y02669* 01676002
*                        REG 11-14 RESTORED AFTER SETLOCK AT    Y02651* 01676102
*                                  FREELOCK.                    Y02651* 01678002
*                                                                     * 01680002
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *   * 01680802
*                                                                     * 01682402
* EXIT - NORMAL       =  RETURN VIA BR 14 FROM RETURN           Y02669* 01684402
* 1 CONDITIONS        =  FOR K A & K A,REF & K T & K T,REF &    Y02669* 01686402
*                        K T,UTME                               Y02669* 01688402
*   OUTPUT            =  SACB INFORMATION IS DISPLAYED IN THE   Y02669* 01690402
*                        ENTRY AREA IF SOURCE IS A CRT DEVICE   Y02669* 01692402
*                        OTHERWISE, IT IS ISSUED VIA A WTO      Y02669* 01694402
*                        REG 2 POINTS TO XSA                    Y02669* 01696402
*                            XASSDS5 RESET TO ZERO - LOCKS      Y02651* 01706402
*                                    RELEASED                   Y02651* 01708402
*   RETURN CODES      =  NONE                                   Y02669* 01712802
* 2 CONDITIONS        =  FOR K A,NONE                           Y02669* 01714802
*   OUTPUT            =  ALL GETMAINED SACB'S ARE FREED         Y02669* 01715202
*                        REG 2 POINTS TO XSA                    Y02669* 01715302
*                            XASSDS5 RESET TO ZERO - LOCKS      Y02651* 01715402
*                                    RELEASED                   Y02651* 01715502
*   RETURN CODES      =  NONE                                   Y02669* 01715602
*                                                                     * 01716102
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *   * 01718102
*                                                                     * 01720102
* EXIT - NORMAL       =  BRANCH TO IEE5603D FROM D5603D         Y02669* 01726102
*   CONDITIONS        =  TO ISSUE MESSAGE 'IEE150I CHANGE       Y02669* 01728102
*                        OPTIONS' FOR A CRT DEVICE ALONG        Y02669* 01728202
*                        WITH K A,LL OR K T,UTME MESSAGE IN     Y02669* 01728302
*                        THE INSTRUCTION LINE                   Y02669* 01728402
*   OUTPUT DATA       =  MESSAGE IN INSTRUCTION LINE OF DCM     Y02669* 01728502
*                        REG 2 - POINTS TO XSA                  Y02669* 01768502
*                          XAE CONTAINS X'02'                   Y02669* 01808502
*                          XASOPTR CONTAINS CURSOR POINTER      Y02669* 01848502
*                           XASSDS5 - ON LOCKS HELD             Y02651* 01888502
*   RETURN CODES      =  NONE                                   Y02669* 01928502
*                                                                     * 01968502
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *   * 02048502
*                                                                     * 02088502
* EXIT - ERROR        =  BRANCH TO IEE5603D FROM D5603D         Y02669* 02128502
*   CONDITIONS        =  TO ISSUE ERROR MESSAGES                Y02669* 02168502
*   OUTPUT DATA       =  ERROR CODES FOR MESSAGES TO BE         Y02669* 02208502
*                        ISSUED BY IEE5603D AND IEE5903D        Y02669* 02248502
*   RETURN CODES      =  REG 2 POINTS TO XSA                    Y02669* 02288502
*                           XAE WILL CONTAIN AN INDEX FOR THE   Y02669* 02328502
*                           MAJOR MESSAGE FOR IEE5603D:         Y02669* 02368502
*                              X'04' - IEE156I INVALID OPERAND  Y02669* 02448502
*                              X'05' - IEE158I K REQUEST        Y02669* 02488502
*                                              INCONSISTENT     Y02669* 02528502
*                              X'0A' - IEE924I INVALID AREA     Y02669* 02568502
*                                              DEFINITION       Y02669* 02608502
*                              X'0E' - IEE931I INSUFFICIENT     Y02669* 02648502
*                                      STORAGE FOR COMMAND      Y02669* 02688502
*                           XASTSAVE WILL CONTAIN AN INDEX FOR  Y02669* 02728502
*                           THE MINOR MESSAGE FOR IEE5903D:     Y02669* 02768502
*                            IEE924I INVALID AREA DEFINITION    Y02669* 02808502
*                              X'11' - DISPLAY IN OR ABOVE AREA Y02669* 02848502
*                            IEE158I K REQUEST INCONSISTENT     Y02669* 02888502
*                              X'1E' - NO TRACK ACTIVE          Y02669* 02928502
*                           XASSDS5 ON LOCKS HELD               Y02651* 02968502
*                                                                     * 03008502
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *   * 03048502
*                                                                     * 03088502
* EXTERNAL REFERENCES                                           Y02669* 03128502
*                                                                     * 03168502
*   ROUTINES          =  IEE5603D/IEE5903D                      Y02669* 03208502
*                                                                     * 03248502
*   DATA AREAS        =  NONE                                   Y02669* 03288502
*                                                                     * 03328502
*   CONTROL BLOCKS    =  CVT      R - ADDRESS UCM               Y02669* 03368502
*                        IEEXSA   R - INPUT                     Y02669* 03408502
*                                 W - ERROR MESSAGE CODES       Y02669* 03448502
*                        IEECUCM  R - ADDRESS DCM               Y02669* 03488502
*                        IEETDCM  R - INSTRUCTION LINE INFO     Y02669* 03528502
*                                 W - FILL IN INSTRUCTION LINE  Y02669* 03568502
*                        IEERDCM  R - ADDRESS SACB              Y02669* 03608502
*                          (SACB) R - GET INFO FOR MESSAGE      Y02669* 03648502
*                                 W - INITIALIZE                Y02669* 03688502
*                                 F - WHEN AREAS ARE DELETED    Y02669* 03728502
*                        IHAPSA   NECESSARY FOR SETLOCKS        Y02651* 03768502
*                        IEFPTRS  R - ADDRESS ASCB & TCB FOR    Y02651* 03808502
*                                     BRANCH ENTRIES            Y02651* 03848502
*                                                                     * 03888502
*   TABLES            =  NONE                                   Y02669* 03968502
*                                                                     * 04008502
*   MACROS            =  GETMAIN  SP 229 FOR WTO BUFFERS        Y02669* 04048502
*                        FREEMAIN SP 229 FOR WTO BUFFERS        Y02669* 04088502
*                        BRANCH ENTRY GETMAIN SP229 WTO BUFFERS Y02651* 04128502
*                        BRANCH ENTRY FREEMAIN SP241 SACB'S     Y02651* 04168502
*                        WTO                                    Y02669* 04208502
*                        SETLOCK - CMS AND LOCAL LOCKS RELEASED Y02651* 04248502
*                                                                     * 04288502
*   ENQUEUE RESOURCES =  NONE                                   Y02669* 04328502
*                                                                     * 04368502
*   LOCKS HELD        =  CMS AND LOCAL LOCKS OBTAINED IN        Y02651* 04408502
*                        IEE7503D ARE RELEASED AND XASSDS5 IS   Y02651* 04448502
*                        RESET BEFORE RETURNING AT RETURN.      Y02651* 04488502
*                        OTHERWISE THEY ARE RELEASED IN         Y02651* 04528502
*                        IEE5603D OR IEE5903D.                  Y02651* 04568502
*                                                                     * 04608502
*   CHANGE LEVEL      =  Y02669                                 Y02669* 04648502
*                        Y02651                                 Y02651* 04688502
*                        Y02668 - JES3 SUPPORT                @Y02668P* 04698503
*                        YM1911  (PROLOGUE & COMMENT CHANGES)   YM1911* 04708502
*                        @ZA07770 TIME INTERVAL TO 10 SEC     @ZA07770* 04718503
*                                                                     * 04728502
* MESSAGES            =  THE FOLLOWING MESSAGES ARE CONTAINED   Y02669* 04736502
*                        IN AND ISSUED FROM THIS MODULE:        Y02669* 04744502
*                                                                     * 04752502
*                        FOR K A,NONE: (MSG STRM-CRT & NON-CRT) Y02669* 04760502
*                         IEE928I DISPLAY AREA ID'S FOR CONSOLE Y02669* 04768502
*                                 'CC' ARE NONE                 Y02669* 04788502
*                        FOR K A & K A,REF: (NON-CRT)           Y02669* 04808502
*                         IEE929I K A,LL,LL...,L=CC             Y02669* 04848502
*                         IEE928I DISPLAY AREA ID'S FOR CONSOLESY02669* 04868502
*                                 'CC' ARE A,B...               Y02669* 04888502
*                                           (CRT-ENTRY AREA)    Y02669* 04908502
*                     *   K A,LL,LL...                          Y02669* 04928502
*                        FOR K T & K T,REF: (NON-CRT)           Y02669* 04948502
*                         IEE922I K T,UTME=XXX,L=CC             Y02669* 04968502
*                                           (CRT-ENTRY AREA)    Y02669* 04970502
*                     *   K T,UTME=XXX                          Y02669* 04972502
*                        THE FOLLOWING MESSAGES ARE CONTAINED   Y02669* 04974502
*                        IN AND ISSUED FROM IEE5603D & IEE5903D:Y02669* 04976502
*                         MSGID  CODE  MOD MESSAGE TEXT         Y02669* 04978502
*                         _____  ____  ___ ____________         Y02669* 04980502
*                        IEE150I X'02' 56  CHANGE OPTIONS,      Y02669* 04982502
*                                          IF DESIRED           Y02669* 04984502
*                          (ACCOMPANIES MESSAGES MARKED *)      Y02669* 04986502
*                        IEE156I X'04' 56  INVALID OPERAND      Y02669* 04988502
*                        IEE158I X'05' 56  K REQUEST            Y02669* 04990502
*                                            INCONSISTENT       Y02669* 04992502
*                                X'1E' 59  NO TRACK ACTIVE      Y02669* 04994502
*                        IEE924I X'0A' 56  INVALID AREA         Y02669* 04996502
*                                            DEFINITION         Y02669* 05008502
*                                X'11' 59  DISPLAY IN OR ABOVE  Y02669* 05011502
*                                            AREA               Y02669* 05014502
*                        IEE931I X'0E' 56  INSUFFICIENT STORAGE Y02669* 05017502
*                                            FOR COMMAND        Y02669* 05020502
*                                                                     * 05023502
* SYSGEN              =  INCLUDED WITH SVC 34 IN LOAD MODULE    Y02669* 05026502
*                        IGC0003D, DLIB AOSB3, MACRO SGCIEF441, Y02669* 05029502
*                        TARGLIB LPALIB.                        Y02669* 05032502
*                                                                     * 05035502
* SYSTEM LIBRARIES    =  NONE                                   Y02669* 05038502
*                                                                     * 05041502
*********************************************************************** 05048502
         EJECT                                                          05400001
IEE6903D CSECT                                                          05450002
* C- 301100                                                    @ZM30462 05470003
* PACK(C), CONSTANTS(C)                                        @ZA07770 05480003
*********************************************************************** 05500001
*                                                                     * 05600002
*                             REGISTERS                               * 05700002
*                                                                     * 05800002
*********************************************************************** 05900001
R0       EQU   0                   WORK REG                             07200001
R1       EQU   1                   WORK REG                             07300001
PARMREG  EQU   2                   INPUT BASE REG FOR XSA               07350002
UCMBASE  EQU   3                   UCM BASE REG                  Y02651 07400002
KOPS     EQU   4                   OPERAND POINTER                      07560002
R4       EQU   4                   WORK REG                             07570002
R5       EQU   5                   SUBROUTINE BRANCH REG                07600002
R6       EQU   6                   WORK REG                             07700001
R7       EQU   7                   WORK REG                      Y02651 07850002
UCMEBASE EQU   8                   UCM ENTRY BASE REG                   07860002
TDCMBASE EQU   9                   TRANSIENT DCM BASE REG               07870002
RDCMBASE EQU   10                  RESIDENT DCM BASE REG                07880002
RA       EQU   10                  PART OF EVEN ODD PAIR         Y02669 07882002
RB       EQU   11                  SUBROUTINE BRANCH REG                07890002
SACBPT   EQU   12                  SACB BASE REG                 Y02651 07892002
MYBASE   EQU   13                  THIS MODULE'S BASE REG               07894002
RE       EQU   14                  SUBROUTINE BRANCH REG         Y02669 07896002
R15      EQU   15                  CODE REG                      Y02669 08000002
         EJECT                                                          08200001
*********************************************************************** 08250002
*                                                                     * 08260002
*                    MESSAGE FLAG BIT SETTINGS                        * 08300002
*                                                                     * 08350002
*********************************************************************** 08360002
IEE150I  EQU   X'02'               MAJOR - WRITE OPTIONS MSG     Y02669 08400002
IEE156I  EQU   X'04'               MAJOR - INVALID OPERAND       Y02669 08450002
IEE158I  EQU   X'05'               MAJOR- K REQUEST INCONSISTENT Y02669 08452002
IEE158   EQU   X'1E'                 NO TRACK ACTIVE             Y02669 08454002
IEE924I  EQU   X'0A'               MAJOR - INVALID AREA DEFIN.   Y02669 08460002
IEE924   EQU   X'11'                 DISPLAY IN OR ABOVE AREA    Y02669 08470002
IEE931I  EQU   X'0E'               MAJOR - INSUF. STOR. FOR CMD  Y02669 08850002
*********************************************************************** 08900002
*                                                                     * 08950002
*                          EQUATES                                    * 09000002
*                                                                     * 09050002
*********************************************************************** 09060002
N0       EQU   0                   FIELD INCREMENT                      09200001
N1       EQU   1                   FIELD INCREMENT                      09300001
N2       EQU   2                   FIELD INCREMENT                      09400001
N3       EQU   3                   FIELD INCREMENT                      09500001
N4       EQU   4                   FIELD INCREMENT                      09600001
N5       EQU   5                   FIELD INCREMENT               Y02669 09650002
N6       EQU   6                   FIELD INCREMENT                      09800001
N7       EQU   7                   FIELD INCREMENT + ICM MASK    Y02669 09900002
N8       EQU   8                   FIELD INCREMENT + ICM MASK    Y02669 10000002
N9       EQU   9                   FIELD INCREMENT               Y02669 10002002
N10      EQU   10                  FIELD INCREMENT               Y02669 10010002
N12      EQU   12                  FIELD INCREMENT               Y02669 10050002
N13      EQU   13                  FIELD INCREMENT               Y02669 10052002
N15      EQU   15                  FIELD INCREMENT               Y02669 10060002
N16      EQU   16                  FIELD INCREMENT               Y02669 10062002
N17      EQU   17                  FIELD INCREMENT               Y02669 10070002
N20      EQU   20                  FIELD INCREMENT               Y02669 10080002
N24      EQU   24                  FIELD INCREMENT               Y02669 10090002
N28      EQU   28                  FIELD INCREMENT               Y02669 10092002
N32      EQU   32                  FIELD INCREMENT               Y02669 10094002
N33      EQU   33                  FIELD INCREMENT               Y02669 10096002
N42      EQU   42                  FIELD INCREMENT                      10100001
N49      EQU   49                  FIELD INCREMENT                      10200001
N80      EQU   80                  FIELD SIZE                           10250002
*********************************************************************** 10360002
*                                                                     * 10370002
*                    CHARACTER CONSTANTS                              * 10380002
*                                                                     * 10390002
*********************************************************************** 10392002
BLANK    EQU   C' '                BLANK CHAR                           10600001
COMMA    EQU   C','                COMMA CONSTANT                       10650002
ZERO     EQU   X'00'               CONSTANT                             10700002
         EJECT                                                          10720002
*********************************************************************** 10750002
*                                                                     * 10800002
*                    MASKS AND OTHER EQUATES                          * 10850002
*                                                                     * 10860002
*********************************************************************** 10870002
DIGIT    EQU   X'F0'               CONSTANT                      Y02669 10900002
SIGN     EQU   X'FC'               CONVERT EBCDIC TO SIGN        Y02669 10910002
XFF      EQU   255                 FIELD INCREMENT               Y02669 10950002
PTRCVT   EQU   16                  CVT ADDR                             11000002
NOHDCPY  EQU   X'04'               BIT TO SIGNIFY NO HARD COPY   Y02669 11050002
MCSMASK  EQU   X'41'               ID PASSED + QUEUE BY ID              11200001
SP229    EQU   229                 SUBPOOL FOR WTO BUFFER        Y02669 11250002
SP241    EQU   241                 SUBPOOL FOR SACB'S            Y02669 11300002
         EJECT                                                          11600001
*********************************************************************** 11700001
*                                                                     * 11800002
*                   ESTABLISH ADDRESSABILITY                          * 11900002
*                                                                     * 12000002
*           ON ENTRY, REGISTER 2 CONTAINS ADDRESS OF XSA              * 12400002
*                                                                     * 12500002
*********************************************************************** 12650002
         SPACE 2                                                        12660002
         BALR  MYBASE,N0           ESTABLISH ROUTINE 'S                 12700001
         USING *,MYBASE            BASE REGISTER                        12800001
         MODID BRANCH=YES                                        Y01886 12850001
         USING FAUXSA,PARMREG      ESTABLISH XSA ADDRESSABILITY         12900001
         L     UCMBASE,PTRCVT      GET CVT POINTER               Y02669 13000002
         USING CVTSECT,UCMBASE     BASE CVT REG                         13200001
         L     UCMBASE,CVTCUCB     GET UCM POINTER FROM CVT      Y02669 13300002
         DROP  UCMBASE                                           Y02669 13350002
         USING UCM,UCMBASE         ESTABLISH UCM ADDRESSABILITY  Y02669 13400002
         USING UCMLIST,UCMEBASE    BASE UCM ENTRY LIST                  13500001
         USING DCMTSRT,RDCMBASE    ESTABLISH RDCM BASE REG       Y02669 13600002
         USING DCMSTRT,TDCMBASE    BASE TDCM REG                 Y01012 13700001
         USING DCMACB,SACBPT       BASE SACB REG                        13800001
         SPACE 2                                                        13900002
         ST    RE,XAP              SAVE RETURN POINTER           Y02669 14000002
         SR    R1,R1               CLEAR REG                     Y02669 14050002
         IC    R1,XAU              LOAD SOURCE ID                Y02669 14100002
         BAL   RE,FINDUCME         FIND SOURCE ENTRY UCME        Y02669 14400002
         SPACE 2                                                        14450002
         L     KOPS,XAL            LOAD POINTER TO OPERANDS             14991402
         LA    KOPS,N0(KOPS)       CLEAR HIGH ORDER BYTE                15000001
         ST    KOPS,XASAVSTD+N32   SAVE OPERAND ADDRESS          Y02669 15050002
         EJECT                                                          15110002
*********************************************************************** 15150002
*                                                                     * 15160002
*                    K  A COMMAND                                Y02669 15200002
*                    K  A,REF COMMAND                            Y02669 15210002
*                                                                     * 15220002
*********************************************************************** 15250002
         SPACE                                                          15300002
         CLC   N0(N2,KOPS),KA      IS IT K A?                           15400002
         BE    KREFRTN             YES-GO HANDLE AS K A,REF      Y02669 15500002
         CLC   N0(N6,KOPS),KAREF   IS IT K A,REF?                       15700002
         BE    KREFRTN             YES-PROCESS                   Y02669 15750002
         SPACE 2                                                        15800402
*********************************************************************** 15802002
*                                                                     * 15804002
*                    K  T COMMAND                                Y02669 15806002
*                    K  T,REF COMMAND                            Y02669 15808002
*                                                                     * 15808402
*********************************************************************** 15808802
         SPACE                                                          15809202
         CLC   N0(N2,KOPS),KT      IS IT K T?                    Y02669 15809602
         BE    KREFRTN             YES-GO HANDLE AS K T,REF      Y02669 15809702
         CLC   N0(N6,KOPS),KTREF   IS IT K T,REF?                Y02669 15809802
         BE    KREFRTN             YES-PROCESS                   Y02669 15809902
         SPACE 2                                                        15810002
*********************************************************************** 15850002
*                                                                     * 15850402
*                    K  A,NONE COMMAND                           Y02669 15852002
*                                                                     * 15856002
*********************************************************************** 15860002
         SPACE                                                          15910002
         CLC   N0(N7,KOPS),KANONE+N2 IS IT K A,NONE?             Y02669 16000002
         BE    KNONERTN            YES-PROCESS                          16100002
         SPACE 2                                                        16102002
*********************************************************************** 16110002
*                                                                     * 16120002
*                    K  T,UTME= COMMAND                          Y02669 16130002
*  ERR - IEE156I INVALID OPERAND - IF NOT A; A,REF; A,NONE       Y02669 16140002
*                                         T; T,REF; T,UTME=      Y02669 16140402
*                                                                     * 16142002
*********************************************************************** 16144002
         SPACE                                                          16146002
         CLC   N0(N7,KOPS),KTUTME+N2  IS IT K T,UTME=?           Y02669 16148002
         BE    KUTMERTN            YES-PROCESS                   Y02669 16148402
         LA    KOPS,N1(KOPS)       NO,POINT CURSOR TO COMMA      Y02669 16198402
         B     BADKOP              ERR - IEE156I INVALID OPERAND Y02669 16200002
         EJECT                                                          18400001
*********************************************************************** 18750002
*                                                                     * 18752002
*                       K A AND K A,REF                          Y02669 18760002
*                       K T AND K T,REF                          Y02669 18770002
*         IF SOURCE IS NOT A GRAPHIC CONSOLE,ISSUE WTO FOR       Y02669 18800002
*         MESSAGE OTHERWISE LOAD POINTER TO DCM INSTRUCTION LINE Y02669 18810002
*            CLEARIT  - TO CLEAR ENTIRE LINE WITH BLANKS         Y02669 18820002
*            TARUCME  - TO GET THE TARGET CONSOLE'S UCME         Y02669 18830002
*         FOR K A AND K A,REF:                                   Y02669 18832002
*            MOVEINKA - TO MOVE THE MESSAGE TEXT INTO THE LINE   Y02669 18837002
*             BRANCH TO IEE5603D TO ISSUE THE MESSAGE            Y02669 18839002
*              'K A,LL,LL,...L=CC'                               Y02669 18842402
*              WITH THE CURSOR POINTING TO THE CHARACTER         Y02669 18842902
*              FOLLOWING 'A,' PLUS MESSAGE                       Y02669 18843402
*              'IEE150I CHANGE OPTIONS IF DESIRED'               Y02669 18844002
*         FOR K T AND K T,REF:                                   Y02669 18844402
*            FINDSACB - TO FIND THE SACB WITH TRACK IN IT        Y02669 18844602
*             IF NO TRACK ACTIVE ON THE SPECIFIED DEVICE:        Y02669 18844802
*              'IEE158I K REQUEST INCONSISTENT-NO TRACK ACTIVE'  Y02669 18845002
*            FINDUTME - TO CONVERT THE TIME INTERVAL TO          Y02669 18845202
*              DECIMAL BUILD THE MESSAGE TEXT AND BRANCH TO      Y02669 18846202
*              IEE5603D TO ISSUE: 'K T,UTME=XXX'                 Y02669 18847202
*              WITH THE CURSOR POINTING TO THE CHARACTER         Y02669 18848202
*              FOLLOWING '=,' PLUS MESSAGE                       Y02669 18849202
*              'IEE150I CHANGE OPTIONS IF DESIRED'               Y02669 18853902
*                                                                     * 18870502
*********************************************************************** 18876402
         SPACE 2                                                        18882302
KREFRTN  EQU   *                                                 Y02669 18888202
         TM    UCMDISP,UCMDISPC    IS ISSUING CONSOLE GRAPHICS?         18894102
         BZ    BUILDWTO            NO, GO BUILD MESSAGE          Y02669 18900002
         TM    XASSDS,XASSDS3      IS TASK ISSUING CMD COMTASK @Y02668P 18910003
         BO    BUILDWTO            NO, BRANCH ISSUE WTO        @Y02668P 18920003
         SPACE                                                          18950002
         L     RDCMBASE,UCMXB        LOAD POINTER TO RDCM        Y02669 19000002
         L     TDCMBASE,N0(RDCMBASE) LOAD POINTER TO TDCM        Y02669 19100002
         L     R6,DCMAENTR         LOAD ADDR OF ENTRY AREA              19200001
         LH    R1,DCMLGNTH         LOAD LENGTH OF A LINE                19300002
         BAL   RB,CLEARIT          CLEAR IT                             19500002
         BAL   RB,TARSACB          GET TARGET UCME               Y02669 19550002
         CLC   N0(N1,KOPS),KT      IS IT K T ?                   Y02669 19580002
         BE    KTREFRTN            YES-GO HANDLE AS K T,REF      Y02669 19590002
         LR    R1,R6               SAVE ADDRESS FOR CURSOR       Y02669 19590102
         BAL   RB,MOVEINKA         FILL IN MESSAGE TEXT          Y02669 19590402
         LA    R6,N4(R1)           BUMP POINTER TO , AFTER 'A'   Y02669 19590802
         B     TODIDOCS                                          Y02669 19591202
KTREFRTN EQU   *                                                 Y02669 19592002
         MVC   N0(N9,R6),KTUTME    MOVE COMMAND TO ENTRY AREA    Y02669 19600002
         BAL   RB,FINDSACB         FIND TARGET SACB WITH TRACK   Y02669 19610002
         BAL   RB,FINDUTME         GO CONVERT TIME VALUE         Y02669 19650002
         MVC   N9(N3,R6),XAX       MOVE VALUE INTO MSG           Y02669 19660002
         LA    R6,N9(R6)           SET CURSOR POSITION PAST ,    Y02669 19680002
TODIDOCS EQU   *                                                 Y02669 20350002
         ST    R6,XASTSAVE         SAVE CURSOR POSITION          Y02669 20400002
         MVI   XAE,IEE150I         SET OPTIONS MSG BIT           Y02669 20500002
         B     D5603D              GO TO IEE5603D TO ISSUE MSG   Y02669 20800002
         EJECT                                                          20850002
*********************************************************************** 27150002
*                                                                     * 27152002
*          IF SOURCE IS NOT A CRT DEVICE A WTO IS ISSUED FOR     Y02669 27154002
*               'IEE929I K A,LL,LL,...L=CC'                      Y02669 27154402
*            TARSACB  - TO GET THE TARGET CONSOLE'S UCME         Y02669 27156002
*            GETMAIN  - TO GET CORE FOR THE MESSAGE TEXT         Y02669 27158002
*                       AND CLEAR IT WITH BLANKS                 Y02669 27158102
*                       MUST BE DONE VIA BRANCH ENTRY TO GETMAIN Y02651 27158302
*                       LOCKS HELD DURING GETMAIN                Y02651 27163002
*            MOVEINKA - TO MOVE THE MESSAGE TEXT INTO THE        Y02669 27167802
*                       GETMAINED CORE                           Y02669 27172502
*                                                                     * 27213302
*          IF REPLYING TO K A,REF ALSO INCLUDED IS:              Y02669 27215402
*     'IEE928I DISPLAY AREA ID'S FOR COMSOLE 'CC' ARE ID,ID...'  Y02669 27229502
*            MOVEINLL - TO MOVE THE MESSAGE TEXT INTO THE        Y02669 27239502
*                       GETMAINED CORE                           Y02669 27249502
*            FREELOCK - TO RELEASE LOCKS BEFORE ISSUING SVC'S    Y02651 27251502
*            WRTWTO   - TO ISSUE WTO'S                           Y02669 27259502
*            FREE     - AFTER THE WTO'S ARE ISSUED TO FREE THE   Y02669 27269502
*                       GOTTEN CORE                              Y02669 27271502
*                                                                     * 27273802
*********************************************************************** 27283802
         SPACE 2                                                        27295902
BUILDWTO EQU   *                                                        27300002
         CLC   N0(N1,KOPS),KT      IS IT K T ?                   Y02669 27350002
         BE    KTREFWTO            YES-GO HANDLE AS K T,REF      Y02669 27360002
         SPACE 2                                                        27370002
KAREFWTO EQU   *                                                 Y20669 27380002
         BAL   RB,TARSACB          GO GET TARGET UCME            Y02669 27400002
         BAL   RB,GETMAIN          GET CORE FOR MSG-BRANCH ENTRY Y02651 27600002
         ST    R1,XASAVSTD+N16     SAVE BEGINNING ADDR OF IEE929IY02669 27650002
         MVC   N4(N8,R6),IEE929I   MOVE MESSAGE NUMBER                  27800002
         LA    R6,N13(R6)          BUMP MSG PT PAST MSG NO.      Y02669 27900002
         BAL   RB,MOVEINKA         GO PUT DATA INTO MSG          Y02669 28100002
         MVC   N0(N3,R6),LEQUALS   MOVE L=CC INTO MSG            Y02669 28300002
         MVC   N3(N2,R6),XAX+N1    STORE CC INTO L= PARAM.       Y02669 28400002
         LA    R6,N6(R6)           BUMP MSG LENGTH                      28500001
         ST    R6,XASAVSTD+N20     SAVE ENDING ADDRESS OF IEE929IY02651 28510002
         BAL   RB,GETMAIN          GET CORE FOR MSG-BRANCH ENTRY Y02651 28550002
         ST    R1,XASAVSTD+N24     SAVE BEGINNING ADDR OF IEE928IY02651 28560002
         MVC   N4(L'IEE928I,R6),IEE928I   MOVE MSG INTO AREA     Y02669 28600002
         LA    R6,N49(R6)          BUMP MESSAGE POINTER                 28650002
         BAL   RB,MOVEINLL         FILL IN MESSAGE INFO          Y02669 28670002
         MVC   N42(N2,R1),XAX+N1   MOVE CC INTO MESSAGE          Y02669 28680002
         ST    R6,XASAVSTD+N28     SAVE ENDING ADDRESS OF IEE928IY02651 28680802
         BAL   RB,FREELOCK         TO RELEASE LOCKS              Y02651 28682002
         L     R1,XASAVSTD+N16     GET BEGINNING ADDR OF IEE929I Y02651 28682402
         L     R6,XASAVSTD+N20     GET ENDING ADDRESS OF IEE929I Y02651 28684002
         BAL   RB,WRTWTO           GO WRITE WTO IEE929I          Y02669 28690002
         L     R1,XASAVSTD+N16     GET BEGINNING ADDR OF IEE929I Y02651 28690402
         BAL   RB,FREE             FREEMAIN WTO PARAMETER LIST   Y02669 28692002
         L     R1,XASAVSTD+N24     GET BEGINNING ADDR OF IEE928I Y02651 28692102
         L     R6,XASAVSTD+N28     GET ENDING ADDRESS OF IEE928I Y02651 28692202
         BAL   RB,WRTWTO           GO WRITE WTO IEE928I          Y02669 28692402
         L     R1,XASAVSTD+N24     GET BEGINNING ADDR OF IEE928I Y02651 28692502
         BAL   RB,FREE             FREEMAIN WTO PARAMETER LIST   Y02669 28692802
         B     RETURN              FINISHED, RETURN TO SYSTEM    Y02669 28694002
         EJECT                                                          29820002
*********************************************************************** 29830002
*                                                                     * 29840002
*          IF REPLYING TO K T,REF AND SOURCE IS NOT A CRT        Y02669 29850002
*          DEVICE A WTO IS ISSUED:                               Y02669 29860002
*               ' IEE922I K T,UTME=XXX,L=CC' IS ISSUED           Y02669 29862002
*            TARSACB  - TO GET THE TARGET CONSOLE'S UCME         Y02669 29863002
*            FINDSACB - TO FIND THE SACB WITH TRACK ACTIVE       Y02669 29864002
*              IF NO TRACK ACTIVE ON THE SPECIFIED DEVICE:       Y02669 29865002
*              'IEE158I K REQUEST INCONSISTENT-NO TRACK ACTIVE'  Y02669 29866002
*            FINDUTME - TO CONVERT THE TIME INTERVAL TO DECIMAL  Y02669 29868402
*            GETMAIN  - TO GET CORE FOR THE MESSAGE TEXT         Y02651 29868502
*                       MUST BE DONE VIA BRANCH ENTRY TO GETMAIN Y02651 29868602
*                       LOCKS HELD DURING GETMAIN                Y02651 29868702
*            CONVERT  - TO CONVERT THE 'CC' TO DECIMAL           Y02669 29868802
*            FREELOCK - TO RELEASE LOCKS BEFORE SVC'S            Y02651 29868902
*            WRTWTO   - TO ISSUE WTO                             Y02669 29869202
*            FREE     - AFTER THE WTO IS ISSUED TO FREE THE      Y02669 29869602
*                       GOTTEN CORE                              Y02669 29869702
*                                                                     * 29869802
*********************************************************************** 29869902
KTREFWTO EQU   *                                                 Y02669 29870002
         BAL   RB,TARSACB          GET TARGET UCME ADDRESS       Y02669 30070002
         BAL   RB,FINDSACB         FIND SACB WITH TRACK          Y02669 30080002
         BAL   RB,FINDUTME         CONVERT TIME VALUE TO DECIMAL Y02669 30090002
         BAL   RB,GETMAIN          BRANCH ENTRY GETMAIN          Y02669 30100002
         MVC   N4(N7,R6),IEE922I   MOVE MESSAGE NUMBER TO AREA @YM30462 30110003
         LA    R6,N13(R6)          BUMP MSG PT PAST MSG NO.      Y02669 30112002
         MVC   N0(N9,R6),KTUTME    MOVE COMMAND TO AREA          Y02669 30120002
         MVC   N9(N3,R6),XAX       MOVE EBCDIC TIME VALUE      @YM2775P 30170002
         BAL   R5,CONVERT          CONVERT TARGET CONSOLE ID     Y02669 30180002
         MVC   N12(N3,R6),LEQUALS  MOVE IN ',L='                 Y02669 30220002
         MVC   N15(N2,R6),XAX+N1   MOVE IN CC VALUE              Y02669 30270002
         LA    R6,N17(R6)          BUMP MSG PT TO LAST CHAR      Y02669 30320002
         BAL   RB,FREELOCK         GO RELEASE LOCKS              Y02651 30330002
         L     R1,XASAVSTD+N12     GET BEGINNING ADDRESS         Y02669 30340002
         BAL   RB,WRTWTO           GO ISSUE IEE922I              Y02669 30370002
         L     R1,XASAVSTD+N12     GET BEGINNING ADDRESS         Y02669 30380002
         BAL   RB,FREE             GO FREE GOTTEN CORE           Y02669 30420002
         B     RETURN              RETURN TO SYSTEM              Y02669 30470002
         EJECT                                                          30520002
*********************************************************************** 32050002
*                                                                     * 32052002
*                          K A,NONE                              Y02669 32060002
*         TARUCME - TO GET THE TARGET CONSOLE'S UCME             Y02669 32062002
*                                                                     * 32070002
*   ERR -IEE924I DISPLAY IN OR ABOVE AREA - IF STATUS DISPLAY ACTIVE  * 32080002
*                                                                     * 32082002
*   IF NO AREAS WERE ORIGINALLY DEFINED AND WHEN ALL ARE FREED   Y02669 32082402
*         FREELOCK - TO RELEASE LOCKS BEFORE SVC'S               Y02651 32082802
*         GETCORE - TO GET CORE FOR MESSAGE                      Y02669 32084802
*         CONVERT - TO CONVERT THE 'CC' TO DECIMAL               Y02669 32086002
*         WRTWTO  - TO ISSUE WTO MACRO                           Y02669 32088002
*         FREE    - TO FREEMAIN GOTTEN CORE FOR MESSAGE          Y02669 32088402
*        IEE928I DISPLAY AREA IDS' FOR CONSOLE 'CC' ARE 'NONE'        * 32090002
*                                         - IF NO SACB'S DEFINED      * 32090402
*                                         - WHEN ALL SACB'S FREED     * 32092002
*                                                                     * 32094002
* NOTE: LOCKS HELD ON ENTRY TO IEE6903D, CAN BE RELEASED IF 'NONE'    * 32096002
*********************************************************************** 32116002
        SPACE 2                                                         32150002
KNONERTN EQU   *                                                        35800001
         BAL   RB,TARSACB          GET TARGET CONSOLE'S UCME     Y02669 35900002
         LTR   SACBPT,SACBPT       ANY AREAS DEFINED?                   36100002
         BNZ   FREESACB            YES, TRY TO FREE SACBS        Y02669 36200002
         SPACE 2                                                        36200402
NOSACBS  EQU   *                                                        36200802
         BAL   RB,FREELOCK         GO FREE LOCKS                 Y02651 36200902
         BAL   RB,GETCORE          GET CORE FOR IEE928I MESSAGE  Y02669 36202002
         MVC   N4(L'IEE928I,R6),IEE928I   MOVE IN MESSAGE ID     Y02669 36204002
         LA    R6,N49(R6)          ADJUST POINTER                Y02669 36206002
         MVC   N0(N4,R6),KANONE+N4 MOVE IN WORD 'NONE'           Y02669 36208002
         LA    R6,N4(R6)           ADJUST POINTER TO MSG END     Y02669 36208402
         BAL   R5,CONVERT          CONVERT 'CC' TO DECIMAL       Y02669 36208802
         MVC   N42(N2,R1),XAX+N1   PUT VALUE IN MESSAGE          Y02669 36209202
         L     R1,XASAVSTD+N12     GET BEGINNING ADDRESS         Y02651 36209302
         BAL   RB,WRTWTO           ISSUE WTO MACRO               Y02669 36209602
         L     R1,XASAVSTD+N12     GET BEGINNING ADDRESS         Y02651 36219602
         BAL   RB,FREE             FREE GOTTEN CORE              Y02669 36219702
         B     RETURN              FINISHED, RETURN TO SYSTEM    Y02669 36229802
         EJECT                                                          36239902
*********************************************************************** 36250002
*                                                                     * 36260002
*     THIS CODE WILL FREEMAIN ANY GETMAINED SACB'S AND REINITIALIZE   * 36300002
*     PERMANENT SACB'S AND TURN OFF DCMAUSE BIT IN SACB'S             * 36400002
*                                                                     * 36410002
*********************************************************************** 36450002
         SPACE 2                                                        36500002
FREESACB EQU   *                                                        36550002
         CLI   DCMTOPDS,ZERO       IS THERE A DISPLAY ON SCREEN?        36700002
         BNE   ERROR               YES- ERROR CAN'T FREE IF BUSY        36800002
         SPACE                                                          36850002
         LA    R5,DCMADSDS         PRIME CHAIN BACKWARD POINTER         37600001
RESTART  EQU   *                                                        37900001
         TM    DCMASACB,DCMAGM     IS IT A GETMAINED SACB ?             38000002
         BO    FREEMAIN            YES- GO FREE IT                      38100002
         XC    DCMAROW(DCMCLRLN),DCMAROW  ZERO OUT SACB          Y02669 38300002
         NI    DCMASACB,XFF-DCMAUSE TURN OFF IN-USE BIT          Y02669 38400002
         XC    DCMALN(N2),DCMALN   ZERO OUT LENGTH FIELD OF SACB        38500001
         LR    R5,SACBPT           SAVE PREVIOUS BLOCK ADDR             38600001
RESTART2 EQU   *                                                        38800001
         ICM   SACBPT,N7,DCMACBNX+1   LOAD NEXT SACB POINTER     Y02669 38900002
         BNZ   RESTART             IS THERE ONE? YES-CONTINUE LOOP      39200002
         XC    DCMTOPAR(N2),DCMTOPAR ZERO OUT TOP AREA & TOP DISP. ID'S 39250001
         LA    R6,DCMADSDS         LOAD ADDR OF CHAIN START      Y02669 39400002
         CR    R5,R6               ARE THERE SYSGEN'D SACBS?     Y02669 39500002
         BNE   NOSACBS             YES-                          Y02669 39600002
         XC    DCMADSDS(N4),DCMADSDS ZERO OUT START ADDR                39800001
         B     NOSACBS             GO TELL STATUS IEE928I        Y02669 39900002
         SPACE 2                                                        40000001
*********************************************************************** 40010002
* NOTE: LOCKS HELD ON ENTRY TO IEE6903D - BRANCH ENTRY TO FREEMAIN    * 40050002
*       IS NECESSARY TO DECHAIN AND FREE SACB'S                       * 40070002
*         REGISTERS DESTROYED : 0, 1, 3, 4, 7, 14, 15                 * 40090002
*         INPUT INFORMATION: R4 POINTS TO CURRENT TCB                 * 40110002
*                            R7 POINTS TO CURRENT ASCB                * 40130002
*********************************************************************** 40180002
FREEMAIN EQU   *                                                        40200001
         L     R4,PTRCVT           GET ADDRESS OF CVT            Y02651 40250002
         USING CVTSECT,R4          ADDRESSABILITY FOR CVT        Y02651 40260002
         L     R4,CVTTCBP          ADDRESS OF TCBS & ASCBS       Y02651 40270002
         DROP  R4                                                Y02651 40272002
         USING TCBASCB,R4          ADDRESSABILITY FOR IEFPTRS    Y02651 40280002
         L     R7,ASCBPTR          ADDRESS OF ASCB FOR INTERFACE Y02651 40290002
         L     R4,TCBPTR           ADDRESS OF TCB FOR INTERFACE  Y02651 40292002
         MVC   N0(N4,R5),N0(SACBPT) MOVE PT TO NXT BLK INTO PREV BLK    40300001
         LR    R1,SACBPT           ADDR OF AREA TO FREE UP              40500001
         LR    SACBPT,R5           RESET SACB POINTER                   40600001
         LA    R0,DCMACBSZ         PASS SACB LENGTH                     40700001
         FREEMAIN RC,LV=(0),A=(1),SP=SP241,BRANCH=YES                   40750002
         B     RESTART2            LOOP                                 40800001
         EJECT                                                          40802002
*********************************************************************** 40804002
*                                                                     * 40806002
*      THIS CODE VALIDITY CHECKS THE VALUE FOLLOWING 'UTME='     Y02669 40808002
*      CONVERTS THE VALUE TO BINARY AND STORES THE VALUE         Y02669 40808102
*      IN THE APPROPIATE SACB                                    Y02669 40808202
*                                                                     * 40808402
*********************************************************************** 40808802
KUTMERTN EQU   *                                                 Y02669 40858802
         XC    XAX(N8),XAX         CLEAR CONVERT AREA            Y02669 40908802
         LA    KOPS,N7(KOPS)       BUMP PAST T,UTME= PARMS       Y02669 40910802
         TM    N0(KOPS),DIGIT      IS 1ST CHAR VALID DIGIT?      Y02669 40912802
         BNO   BADUTME             NO, IEE156I                   Y02669 40914802
         CLI   N1(KOPS),BLANK      IS 2ND DIGIT A BLANK?         Y02669 40916802
         BE    ONEDIGIT            YES, GO CONVERT 1 DIGIT       Y02669 40917202
         TM    N1(KOPS),DIGIT      IS 2ND CHAR VALID DIGIT?      Y02669 40917602
         BNO   BADUTME             NO, IEE156I                   Y02669 40918002
         CLI   N2(KOPS),BLANK      IS 3RD DIGIT A BLANK?         Y02669 40922502
         BE    TWODIGIT            YES, GO CONVERT 2 DIGITS      Y02669 40923802
         TM    N2(KOPS),DIGIT      IS 3RD CHAR VALID DIGIT?      Y02669 40925102
         BNO   BADUTME             NO, IEE156I                   Y02669 40926402
         CLI   N3(KOPS),BLANK      IS 4TH CHAR A BLANK?          Y02669 40927702
         BNE   BADUTME             NO, IEE156I                   Y02669 40929002
         B     TRIDIGIT            YES, GO CONVERT 3 DIGITS      Y02669 40930302
         SPACE 2                                                        40931602
ONEDIGIT EQU   *                                                 Y02669 40932902
         MVC   XAX+N7(N1),N0(KOPS) MOVE IN ONE DIGIT TO PACK     Y02669 40934202
         B     PACK                                              Y02669 40935502
TWODIGIT EQU   *                                                 Y02669 40936802
         MVC   XAX+N6(N2),N0(KOPS) MOVE IN TWO DIGITS TO PACK    Y02669 40938102
         B     PACK                                              Y02669 40939402
TRIDIGIT EQU   *                                                 Y02669 40940702
         MVC   XAX+N5(N3),N0(KOPS) MOVE IN THREE DIGITS TO PACK  Y02669 40942002
PACK     EQU   *                                                 Y02669 40943302
         PACK  XAX+N4(N4),XAX+N4(N4)  PACK THE DIGITS            Y02669 40944602
         NI    XAX+N7,SIGN         MAKE FOX A CHARLIE            Y02669 40945902
         SR    R15,R15                                           Y02669 40947202
         CVB   R15,XAX             CONVERT NUMBER TO BINARY      Y02669 40948502
         C     R15,X10             IS VALUE LESS THAN 10?      @ZA07770 40951103
         BL    BADUTME             YES-ERROR IEE156I             Y02669 40952402
         EJECT                                                          40953702
*********************************************************************** 40955002
*                                                                     * 40956302
*    SAVE THE NEW TIME VALUE FOR K T,UTME IN TARGET CONSOLE'S SACB    * 40957602
*    IF THERE IS ONE AND IF THERE IS AN ACTIVE TRACK IN IT            * 40958902
*            TARSACB  - TO GET THE TARGET CONSOLE'S UCME         Y02669 40959202
*            FINDSACB - TO FIND THE SACB WITH TRACK ACTIVE       Y02669 40959502
*              IF NO TRACK ACTIVE ON THE SPECIFIED DEVICE:       Y02669 40959802
*              'IEE158I K REQUEST INCONSISTENT-NO TRACK ACTIVE'  Y02669 40960202
*            FREELOCK - TO RELEASE LOCKS BEFORE SVC'S            Y02669 40965402
*   NOTE: ALWAYS RETURN TO SYSTEM WHEN VALUE HAS BEEN STORED          * 40969402
*                                                                     * 40974102
* NOTE: LOCKS ARE ALWAYS HELD ON ENTRY TO IEE6903D - MUST BE RELEASED * 40977802
*       BEFORE RETURNING TO SYSTEM                                    * 40985202
*********************************************************************** 40988902
         SPACE 2                                                        40996302
         BAL   RB,TARSACB          FIND TARGET UCME              Y02669 41000002
         BAL   RB,FINDSACB         FIND MATCHING SACB            Y02669 41003002
         STH   R15,DCMAUTME        STORE TIME VALUE              Y02669 41006002
         BAL   RB,FREELOCK         GO FREE LOCKS                 Y02651 41009002
         B     RETURN              RETURN TO SYSTEM              Y02669 41012002
         EJECT                                                          41015002
*********************************************************************** 41018002
*                                                                     * 41021002
*                THE FOLLOWING ARE SUBROUTINES                        * 41024002
*                                                                     * 41027002
*********************************************************************** 41030002
         SPACE 2                                                        41033002
*********************************************************************** 41036002
*                                                                     * 41039002
*                GET TARGET CONSOLE UCME                              * 41042002
*                                                                     * 41050002
*********************************************************************** 41150002
         SPACE 2                                                        41200002
TARSACB  EQU   *                                                 Y02669 41250002
         SR    R1,R1               CLEAR REG                            41300002
         IC    R1,XASCID           LOAD TARGET CONSOLE ID        Y02669 41350002
         BAL   RE,FINDUCME         GET CONSOLE'S UCME            Y02669 41400002
         L     RDCMBASE,UCMXB      LOAD POINTER TO RDCM          Y02669 41550002
         L     SACBPT,DCMADSDS     LOAD SACB POINTER FROM RDCM   Y02669 41600002
         BR    RB                  RETURN                               41700002
         SPACE 2                                                        41750002
*********************************************************************** 41800002
*                                                                     * 41850002
*              FIND AND BASE SOURCE OR TARGET UCME                    * 41900002
*                                                                     * 41920002
*    INPUT- REG 1 HAD CONSOLE ID RIGHT JUSTIFIED, HIGH ORDER BYTES ZERO 41950002
*    OUTPUT- POINTER TO DCMENTRY SPECIFIED BY CONSOLE ID IN UCMEBASE  * 42000002
*    REG USAGE-DESTROYS CONTENTS OF: REG 0,1,UCMEBASE                 * 42050002
*                                                                     * 42100002
*********************************************************************** 42150002
         SPACE 2                                                        42200002
FINDUCME EQU   *                                                 Y02669 42250002
         BCTR  R1,ZERO             SUBTRACT ONE FROM CONSOLE ID  Y02669 42300002
         L     UCMEBASE,UCMVEA     POINT TO FIRST ENTRY          Y02669 42310002
         M     R0,UCMVEZ           MULTIPLY SIZE BY REDUCED ID   Y02669 42320002
         AR    UCMEBASE,R1         POINT TO DESIRED UCM ENTRY    Y02669 42330002
         BR    RE                  RETURN                        Y02669 42340002
         EJECT                                                          42340102
*********************************************************************** 42340402
*                                                                     * 42340802
*                       FIND AND BASE SACB                            * 42341202
*                                                                     * 42341302
*    GIVEN A PARTICULAR CRT CONSOLE THIS SUBROUTINE FINDS AND         * 42341602
* BASES THE SCREEN AREA CONTROL BLOCK (SACB) WITH A TRACK ACTIVE.     * 42341702
* IF NONE IS FOUND, 'IEE158I K REQUEST INCONSISTENT NO TRACK ACTIVE'  * 42341802
* IS ISSUED.                                                          * 42351602
*    INPUT -  UCMEBASE - ADDRESS OF UCM ENTRY OF A CRT CONSOLE        * 42356402
*    OUTPUT - SACBBASE - ADDRESS OF SACB WITH TRACK ACTIVE            * 42366402
*                                                                     * 42375702
* ERR - IEE158I REQUEST INCONSISTENT - NO TRACK ACTIVE                * 42376102
*********************************************************************** 42377702
         SPACE 2                                                        42379702
FINDSACB EQU   *                                                 Y02669 42380102
         TM    DCMASACB,DCMAUSE    DOES SACB DEFINE AN AREA?     Y02669 42387402
         BZ    NOTRACK             NO, ERR NO TRACK ACTIVE       Y02669 42389402
         TM    DCMADFLG,DCMADD     TRACK ACTIVE IN AREA?         Y02669 42389802
         BCR   N1,RB               YES, RETURN                   Y02669 42390202
         ICM   SACBPT,N7,DCMACBNX+1  ANY MORE SACBS?             Y02669 42390302
         BZ    NOTRACK             NO, ERR NO TRACK ACTIVE       Y02669 42394202
         B     FINDSACB            CONTINUE SEARCH               Y02669 42396202
         EJECT                                                          42406802
*********************************************************************** 42408402
*                                                                     * 42410002
*              GETMAIN WITH LOCKS RELEASED                            * 42410802
*                                                                     * 42411202
*          GETCORE:  GETS CORE FOR MESSAGE                       Y02669 42411602
*          CLEARIT:  BLANKS OUT MESSAGE AREA IN EITHER           Y02669 42420002
*                    WTO BUFFER OR DCM INSTRUCTION LINE          Y02669 42420402
*  ERR - IEE931I INSUFFICIENT STORAGE FOR COMMAND - IF GETMAIN FAILS  * 42422002
*                                                                     * 42424002
*********************************************************************** 42430002
         SPACE 2                                                        42432002
GETCORE  EQU   *                                                        42440002
         LA    R1,XASAVSTD+N12     AREA FOR STORAGE ADDRESS      Y02669 42442002
         MVC   XASAVSTD(N10),GETAREA   MOVE PARM LIST TO XSA     Y02669 42444002
         ST    R1,XASAVSTD+N4      WHERE GETMAIN TO STORE ADDR   Y02669 42444402
         LA    R1,XASAVSTD         ADDR OF PARM LIST FOR GETMAIN Y02669 42444802
         GETMAIN  MF=(E,(1))                                     Y02669 42445202
         LTR   R15,R15             TEST RETURN CODE              Y02669 42448002
         BNZ   MSG931              IF NOT ZERO;MEANS NO CORE     Y02669 42448402
         SPACE                                                          42448502
CLEARBUF EQU   *                                                 Y02669 42448602
         L     R6,XASAVSTD+N12     LOAD GETMAINED ADDR           Y02669 42448802
         LA    R1,N80              LENGTH OF MSG IS ALWAYS 80    Y02669 42449202
*********************************************************************** 42449302
*   INPUT - REGISTER 1 CONTAINS LENGTH OF AREA TO BE CLEARED     Y02669 42449602
*           REGISTER 6 POINTS TO BEGINNING OF AREA               Y02669 42451602
*********************************************************************** 42452502
CLEARIT  EQU   *                                                        42452802
         MVI   N0(R6),BLANK        CLEAR AREA                           42453102
         BCTR  R1,N0               BY                                   42453402
         BCTR  R1,N0               DECREMENTING LENGTH  BY 2            42454002
         EX    R1,BLANKS           THEN PROPOGATING BLANK               42454602
         LR    R1,R6               SAVE THE BEGINNING ADDRESS    Y02669 42455202
         BR    RB                  RETURN                               42455602
         SPACE                                                          42455702
GETAREA  GETMAIN EC,LV=N80,A=MSG931,SP=SP229,MF=L                Y02669 42456002
         EJECT                                                          42456402
*********************************************************************** 42456702
*                                                                     * 42456802
*  THIS IS THE BRANCH ENTRY TO GETMAIN USED WHEN LOCKS NEED TO BE     * 42456902
*  HELD.                                                              * 42457102
*     REGISTERS DESTROYED: 0, 1, 3, 4, 7, 14, 15                      * 42457302
*     INPUT INFORMATION: R4 POINTS TO CURRENT TCB                     * 42457502
*                        R7 POINTS TO CURRENT ASCB                    * 42457702
*                                                                     * 42457902
*********************************************************************** 42458202
         SPACE 2                                                        42458502
GETMAIN  EQU   *                                                        42458802
         L     R4,PTRCVT           GET ADDRESS OF CVT            Y02651 42459102
         USING CVTSECT,R4          ADDRESSABILITY FOR CVT        Y02651 42459402
         L     R4,CVTTCBP          ADDRESS OF IEFPTRS            Y02651 42459702
         DROP  R4                                                Y02651 42460002
         USING TCBASCB,R4          ADDRESSABILITY FOR IEFPTRS    Y02651 42460502
         L     R7,ASCBPTR          ADDRESS OF ASCB FOR INTERFACE Y02651 42461002
         L     R4,TCBPTR           ADDRESS OF TCB FOR INTERFACE  Y02651 42461502
         GETMAIN RC,LV=N80,SP=SP229,BRANCH=YES                   Y02651 42462002
         LTR   R15,R15             WAS IT SUCCESSFUL?            Y02669 42462402
         BNZ   MSG931              NO ERROR - NO CODE            Y02669 42462802
         ST    R1,XASAVSTD+N12     SAVE ADDR OF CORE             Y02669 42463402
         B     CLEARBUF            GO CLEAR AREA JUST GOTTEN     Y02669 42465402
         EJECT                                                          42467502
*********************************************************************** 42468002
*                                                                     * 42468502
*             THIS CODE WILL CONVERT HEX TO EBCDIC               Y02669 42469002
*                                                                     * 42469502
*********************************************************************** 42470002
         SPACE 2                                                        42470502
FINDUTME EQU   *                                                 Y02669 42471002
         LH    R5,DCMAUTME         LOAD UTME VALUE               Y02669 42471502
         CVD   R5,XAX              CONVERT TO DECIMAL            Y02669 42473002
         UNPK  XAX(N3),XAX+N6(N2)  UNPACK NUMBER                 Y02669 42473502
         OI    XAX+N2,DIGIT        FIX SIGN                      Y02669 42474002
         BR    RB                  RETURN                        Y02669 42474502
         SPACE 2                                                        42475002
CONVERT  EQU   *                                                        42475502
         SR    R4,R4               CLEAR REG                     Y02669 42476002
         IC    R4,XASCID           GET TARGET CONSOLE ID         Y02669 42476502
EBCDIC   EQU   *                                                        42477002
         CVD   R4,XAX              CONVERT TO DECIMAL            Y02669 42477502
         UNPK  XAX(N3),XAX+N6(N2)  UNPACK NUMBER                 Y02669 42478002
         OI    XAX+N2,DIGIT        FIX SIGN                      Y02669 42478502
         BR    R5                  RETURN                        Y02669 42479002
         EJECT                                                          42479502
*********************************************************************** 42480002
*                                                                     * 42480502
*        FILL IS DESCRIPTOR, ROUTING CODES AND MCSFLAGS          Y02669 42481002
*                  ISSUE WTO AND RETURN                          Y02669 42481502
*   INPUT - REGISTER 1 POINTS TO BEGINNING OF WTO BUFFER         Y02669 42481902
*           REGISTER 6 POINTS TO END OF WTO BUFFER               Y02669 42482402
*                                                                     * 42484002
*********************************************************************** 42484502
         SPACE 2                                                        42485002
WRTWTO   EQU   *                                                 Y02669 42485502
         MVC   N0(N4,R6),DESCR     MOVE DESCRIPTOR CODE IN AREA  Y02669 42486002
         SR    R6,R1               GET LENGTH OF MSG             Y02669 42486502
         STH   R6,N0(R1)           STORE FOR WTO                 Y02669 42487002
         MVI   N2(R1),MCSMASK      ID PASSED AND QUEUE BY ID     Y02669 42487502
         MVI   N3(R1),N0           ZERO SECOND MSCFLGS BYTE      Y02669 42488002
         SR    R0,R0               CLEAR REG                     Y02669 42488502
         IC    R0,XAU              LOAD SOURCE DEVICE ID         Y02669 42489002
         WTO   MF=(E,(1))                                        Y02669 42489502
         BR    RB                  RETURN                        Y02669 42490002
         EJECT                                                          42490502
*********************************************************************** 42491002
*                                                                     * 42491502
*                FREEMAIN WTO PARAMETER LIST                     Y02669 42492002
*        INPUT - REGISTER 1 POINTS TO AREA TO BE FREED           Y02669 42500002
*                                                                     * 42504002
*********************************************************************** 42516002
         SPACE 2                                                        42526002
FREE     EQU   *                                                        42528002
         FREEMAIN R,LV=N80,A=(1),SP=SP229                        Y02669 42564002
         BR    RB                  RETURN                        Y02669 42576002
         EJECT                                                          42588002
*********************************************************************** 42588402
*                                                                     * 42588502
*       TO MOVE MESSAGE TEXT INTO DCM INSTRUCTION LINE                * 42588602
*       OR GETMAINED AREA                                             * 42588802
*         EBCDIC  - TO CONVERT TO EBCDIC                              * 42589502
*         CONVERT - TO GET CONSOLE ID                                 * 42590402
*       MOVEINKA - ENTRY POINT FOR IEE929I                            * 42590802
*       MOVEINLL - ENTRY POINT FOR IEE928I                            * 42591502
*                                                                     * 42592902
*********************************************************************** 42593602
         SPACE 2                                                        42594302
MOVEINKA EQU   *                                                 Y02669 42595002
         MVC   N0(N4,R6),KANONE    MOVE  MSG NO. ID ( K A,)      Y02669 42595702
         LA    R6,N4(R6)           BUMP MSG POINTER PAST MSG NO. Y02669 42596402
         LTR   SACBPT,SACBPT       ANY AREA'S DEFINED BY K A,LL? Y02669 42596802
         BZ    NONERTN             NO--INSERT 'NONE'             Y02669 42597202
         SR    R4,R4               CLEAR REG                     Y02669 42597602
NXTSACB  EQU   *                                                 Y02669 42647602
         TM    DCMASACB,DCMAUSE    AREA DEFINED HERE?            Y02669 42649602
         BZ    ANYSACB             NO--CHK NEXT SACB             Y02669 42649702
         IC    R4,DCMALN+N1        LOAD LENGTH OF AREA           Y02669 42650802
         BAL   R5,EBCDIC           GO CONVERT TO EBCDIC          Y02669 42652802
         MVC   N0(N2,R6),XAX+N1    MOVE LL INTO MESSAGE          Y02669 42653202
         MVI   N2(R6),COMMA        MOVE IN COMMA AFTER AREA ID   Y02669 42653602
         LA    R6,N3(R6)           BUMP MESSAGE POINTER          Y02669 42653702
         ICM   SACBPT,N7,DCMACBNX+1  GET POINTER TO NEXT SACB    Y02669 42653802
         BNZ   NXTSACB             ANY MORE? YES-KEEP ON LOOPING Y02669 42653902
         B     ANYSACB             NO, SEE IF THERE WERE ANY     Y02669 42654502
         SPACE 3                                                        42655102
MOVEINLL EQU   *                                                 Y02669 42656202
         L     SACBPT,DCMADSDS     GET ADDRESS OF FIRST SACB     Y02669 42656602
         LTR   SACBPT,SACBPT       ANY AREA'S DEFINED BY K A,LL? Y02669 42657302
         BZ    NONERTN             NO--INSERT 'NONE'             Y02669 42658302
         SR    R4,R4               CLEAR REG                     Y02669 42660002
NEXTSACB EQU   *                                                 Y02669 42662002
         TM    DCMASACB,DCMAUSE    AREA DEFINED HERE?            Y02669 42664002
         BZ    ANYSACB             NO--CHK NEXT SACB             Y02669 42664402
         LA    R4,N1(R4)           BUMP COUNTER                  Y02669 42664802
         MVC   N0(N1,R6),DCMAID    YES,MOVE AREA ID INTO MESSAGE Y02669 42665002
         MVI   N1(R6),COMMA        MOVE IN COMMA AFTER AREA ID   Y02669 42669102
         LA    R6,N2(R6)           BUMP MESSAGE POINTER          Y02669 42671102
NEXTBLK  EQU   *                                                 Y02669 42673102
         ICM   SACBPT,N7,DCMACBNX+1  GET POINTER TO NEXT SACB    Y02669 42673202
         BNZ   NEXTSACB            IF THERE IS ONE KEEP LOOPING  Y02669 42673302
         EJECT                                                          42900902
ANYSACB  EQU   *                                                 Y02669 42908902
         LTR   R4,R4               ANY SACBS AT ALL?             Y02669 42948902
         BZ    NONERTN             NO, INDICATE 'NONE' IN MESSAGEY02669 42958902
         BCTR  R6,N0               YES, BLANK OUT LAST COMMA     Y02669 42968902
         MVI   N0(R6),BLANK                                      Y02669 42978902
         B     FINIT               FINISH MESSAGE                Y02669 42998902
NONERTN  EQU   *                                                 Y02669 43048902
         MVC   N0(N4,R6),KANONE+N4 MOVE IN WORD 'NONE'           Y02669 43098902
         LA    R6,N4(R6)           BUMP MSG LENGTH               Y02669 43108902
         SPACE 2                                                        43148902
FINIT    EQU   *                                                        43198902
         BAL   R5,CONVERT          GO CONVERT CC TO EBCDIC              43248902
         BR    RB                  RETURN                        Y02669 43298902
         EJECT                                                          43548902
*********************************************************************** 43550902
*                                                                     * 43551302
*   CMS AND LOCAL LOCKS ARE ALWAYS HELD ON ENTRY TO IEE6903D.    Y02651 43551702
*   THEY MUST BE RELEASED BEFORE ISSUING SVC'S ( UNLESS BRANCH   Y02651 43552102
*   ENTRY IS USED) OR RETURNING.                                 Y02651 43552502
*                                                                     * 43552902
*********************************************************************** 43554902
         SPACE 3                                                        43556902
FREELOCK EQU   *                                                 Y02651 43558902
         STM   RB,RE,XASAVLOC         SAVE REGS AROUND SETLOCK   Y02651 43598902
         SETLOCK RELEASE,TYPE=CMS,RELATED=(K,IEE7503D(LOCKSET))         43648902
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(K,IEE7503D(LOCKSET))       43698902
         LM    RB,RE,XASAVLOC         RESTORE REGS AFTER SETLOCK Y02651 43748902
         NI    XASSDS,XFF-XASSDS5     INDICATE NO LOCKS HELD     Y02651 43798902
         BR    RB                     RETURN                     Y02651 43848902
         EJECT                                                          43898902
**********************************************************************  46078402
*                                                                    *  46088402
*                       NORMAL EXITS                                 *  46089302
*                                                                    *  46090202
**********************************************************************  46091202
         SPACE 2                                                        46091602
RETURN   EQU   *                                                 Y02669 46092402
         L     RE,XAP              RESTORE RETURN REG            Y02669 46094002
         BR    RE                  GO BACK TO SYSTEM             Y02669 46096002
         SPACE 2                                                        46098002
**********************************************************************  46100002
*                                                                    *  46150002
*                       ERROR EXITS                                  *  46160002
*                                                                    *  46170002
**********************************************************************  46180002
         SPACE 2                                                        46230002
NOTRACK  EQU   *                                                 Y02669 46280002
         MVI   XAE,IEE158I         INDICATE REQUEST INCONSISTENT Y02669 46282002
         MVI   XASTSAVE,IEE158     INDICATE NO TRACK ACTIVE      Y02669 46284002
         B     STOREOP             STORE ADDRESS OF T            Y02669 46286002
         SPACE 2                                                        46300002
MSG931   EQU   *                                                 Y02669 46550002
         MVI   XAE,IEE931I         CORE NOT AVAILABLE            Y02669 46560002
         B     STOREOP             GO TO PUT OUT MSG             Y02669 46570002
         SPACE  2                                                       46572002
ERROR    EQU   *                                                 Y02669 46580002
         MVI   XAE,IEE924I         SET ON MAJOR FLAG BIT         Y02669 46594002
         MVI   XASTSAVE,IEE924     DISPLAY IN OR ABOVE AREA      Y02669 46594402
         B     STOREOP                                           Y02669 46596002
         SPACE 2                                                        46596402
BADUTME  EQU   *                                                 Y02669 46596802
         SPACE 2                                                        46597802
BADKOP   EQU   *                                                 Y02669 46598002
         MVI   XAE,IEE156I         NONE OF ABOVE,SO ITS BAD      Y02669 46598402
         STCM  KOPS,N7,XASOPTR     GET CURRENT ADDR OF OPERAND   Y02669 46598502
         B     D5603D              EXIT TO MSG MODULE            Y02669 46598602
         SPACE 2                                                        46598702
STOREOP  EQU   *                                                 Y02669 46598802
         MVC   XASOPTR(N3),XASAVSTD+N33  SAVE OPERAND POINTER    Y02669 46599602
D5603D   EQU   *                                                 Y02669 46599702
         L     RE,XAP              RESTORE RETURN REG ADDR       Y02669 46599802
         L     R15,VCON5603                                      Y02669 46628602
         BR    R15                                               Y02669 46630602
         EJECT                                                          46633302
*********************************************************************** 46650002
*                                                                     * 46800002
*                         CONSTANTS                                   * 46820002
*                                                                     * 46840002
*********************************************************************** 46860002
BLANKS   MVC   N1(N0,R6),N0(R6)    FILL WITH BLANKS                     46910002
         DS    0F                                                       46950001
FOUR     DC    H'4'                CONSTANT                      Y02669 46960002
ELEVEN   DC    H'11'               CONSTANT                             47000002
X10      DC    F'10'               CONSTANT                    @ZA07770 47060003
VCON0503 DC    V(IEE0503D)                                       Y02669 47090002
VCON5603 DC    V(IEE5603D)                                       Y02669 47092002
IEE928I  DC    CL45'IEE928I DISPLAY AREA ID''S FOR CONSOLE CC ARE'      47100001
IEE929I  DC    C'IEE929I '                                              47200001
IEE922I  DC    C'IEE922I'                                        Y02669 47210002
LEQUALS  DC    C',L='                                            Y02669 47600002
KA       DC    C'A '                                                    47800001
KAREF    DC    C'A,REF '                                                47900001
KANONE   DC    C'K A,NONE '                                      Y02669 47900102
KT       DC    C'T '                                             Y02669 47900402
KTREF    DC    C'T,REF '                                         Y02669 47900802
KTUTME   DC    C'K T,UTME='                                      Y02669 47901202
DESCR    DC    B'00001000000000000000000000000000' DESCRIPTOR CODE+RT   47901602
         SPACE 2                                                        47902002
*********************************************************************** 47910002
*                                                                     * 47920002
*                          PATCH AREA                                 * 47940002
*                                                                     * 47960002
*********************************************************************** 47980002
PATCH1   DC    C'***PATCH AREA***'                                      48000001
PATCH2   DC    C'IEE6903D-TEST'                                         48100001
PATCH3   DC    36C' '                                                   48150001
         EJECT                                                          48300001
         IEETDCM                                                 Y01012 48800001
         EJECT                                                          48900001
         IEECUCM FORMAT=NEW                                             49100002
         EJECT                                                          49150002
         IEERDCM                                                        49300002
         EJECT                                                          49450002
FAUXSA   DSECT                                                          49500001
         IEEXSA                                                         49600001
         EJECT                                                          49650002
CVTSECT  DSECT                                                          49700001
         CVT                                                            49800001
         EJECT                                                          49850002
         IEFPTRS                                                        49900002
         EJECT                                                          49950002
         IHAPSA                                                         50000002
         END                                                            50100001
