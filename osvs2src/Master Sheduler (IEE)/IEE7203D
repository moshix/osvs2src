 TITLE 'IEE7203D - VARY HARDCPY PROCESSOR-PART TWO'                     00250003
HUCMSET  DSECT                                                          00300002
         IEECUCM  FORMAT=NEW                                            00400002
         EJECT                                                          00600001
         IEEBASEA                                                       00800001
         EJECT                                                          01000001
HXSASET  DSECT                                                          01200001
         IEEXSA                                                         01400001
         EJECT                                                          06800001
HCVTSET  DSECT                                                          07000001
         CVT   SYS=VMS                                                  07200001
         EJECT                                                          07400001
HUCBSET  DSECT                                                          07600001
         IEFUCBOB                                                       07800001
         EJECT                                                          08000001
    IHAPSA                                                              08050002
    EJECT                                                               08100002
IEE7203D CSECT                                                          08200001
*                                                                 21002 08400001
* HADDREQ(A)                                                   @ZA04559 08450003
*********************************************************************** 08600001
*                                                                       08650002
* MODULE NAME      = IEE7203D                                           08700002
*   CSECT NAME     = IEE7203D                                           08750002
*                                                                       08800002
* LOAD MODULE NAME = IGC0003D                                           08850002
*                                                                       08900002
* DESCRIPTIVE NAME = VARY HARDCPY OPERAND PROCESSOR - PART TWO          09050002
*                                                                       09100002
* COPYRIGHT        = MISSING                                            09150002
*                                                                       09200002
* STATUS           = OS/VS/2 RELEASE 3 PTF                     @ZA04559 09250003
*                                                                       09300002
* FUNCTION         = THIS MODULE USING INFORMATION IN THE XSA(SEE       09350002
*                    INPUT BELOW) CHANGES THE HARDCPY CONFIGURATION     09400002
*                    AS FOLLOWS:                                        09450002
*                    1. CAN CHANGE THE ROUTING CODES AND/OR ITS         09500002
*                    ABILITY TO RECEIVE COMANDS AND RESPONSES FOR       09550002
*                    EXISTING HARDCPY.                                  09600002
*                    2. CAN ADD HARDCPY CAPABILITIES TO AN ACTIVE       09650002
*                    CONSOLE                                            09700002
*                    3. WILL CHANGE HARDCPY FUNCTIONS FROM AN ACTIVE    09750002
*                    CONSOLE (OR SYSLOG) TO SYSLOG, OR ANOTHER          09800002
*                    ACTIVE CONSOLE.                                    09850002
*                                                                       09900002
* OPERATION        = IF ROUT=, CMDS, NOCMDS, INCMDS, STCMDS,            09950003
*                    ARE PRESENT AND ARE CORRECT, THIS MODULE           10000002
*                    DETERMINES WHETHER A NEW CONSOLE (OR SYSLOG)       10050002
*                    IS TO HAVE THE ADDED FUNCTION OF HARDCPY LOG       10100002
*                    OR WHETHER THE CAPABILITIES OF THE CURRENT         10150002
*                    HARDCPY LOG ARE TO BE CHANGED.                     10200002
*                    IN ALL CASES, A CHECK FOR MINIMUM MAINTENANCE      10250002
*                    REQUIREMENTS IS MADE AND MAINTENANCE REQUIREMENTS  10300002
*                    ARE ADDED TO THE CHANGES REQUESTED BY THE VARY     10350002
*                    COMMAND IF NECESSARY. (THE CHANGES ARE INDICATED   10400002
*                    IN THE XSA)                                        10450002
*                                                                       10500002
* NOTES                                                                 10550002
*   DEPENDENCIES   = NONE                                               10600002
*   CHARACTER/CODE DEPENDENCIES                                         10650002
*                  = THIS MODULE CAN BE ASSEMBLED WITH ANY NEW          10700002
*                    CHARACTER/CODE SET                                 10750002
*                                                                       10800002
* RESTRICTIONS     = REG2 PTS TO THE XSA ON INPUT                       10850002
*                    REG 12 PTS TO THE UNIT OR SYSLOG                   10900002
*   REGISTER CONVENTIONS                                                10950002
*                  = REGISTERS ARE DEFINED AT LOCATION: DEFREG          11000002
*   PATCH LABEL    = PATCH                                              11050002
*                                                                       11100002
* MODULE TYPE      = CSECT                                              11150002
*   PROCESSOR      = ASSEMBLER                                          11200002
*   MODULE SIZE    = VS/2 = '30C'                              @Z30LPTJ 11250003
*   ATTRIBUTES     = REENTRANT, REUSABLE, REFRESHABLE, PAGED LPA,       11300002
*                    ZERO PSW PROTECT KEY, SUPERVISOR MODE              11350002
*                                                                       11400002
* ENTRY POINT      = IEE7203D FROM IEE4703D                             11450002
*   PURPOSE        = TO COMPLETE PROCESSING THE VARY HARDCPY COMMAND    11500002
*   LINKAGE        = BRANCH                                             11550002
*   INPUT          = REG2 PTS TO THE XSA                                11600002
*                       XAR PTS TO THE COMMAND BUFFER                   11650002
*                       XAL PTS TO THE COMMAND PARAMETERS IN THE        11700002
*                       COMMAND BUFFER                                  11750002
*                       XAV CONTAINS THE VERB                           11800002
*   REGISTERS SAVED= NONE                                               11900002
*   REGISTER USAGE = R2  XSA PTR                                        11950002
*                    R4  UCME PTR                                       12000002
*                    R9  UNIT PTR                                       12050002
*                    R10 UCM PTR                                        12100002
*                    R11 CUMPRFX PTR                                    12150002
*                    R12 PASSED UNIT PTR OR 0 IF SYSLOG                 12200002
*   REGISTERS RESTORED                                                  12250002
*                  = NONE                                               12300002
*                                                                       12350002
* EXIT - NORMAL    = TO IEE4103D VIA BRANCH                             12400002
*   CONDITIONS     = TO ISSUE THE HARDCPY INFORMATIONAL MESSAGE         12450002
*   OUTPUT         = REG1 PTS TO THE MESSAGE BUFFER GOTTEN IN 7203D     12500002
*                    REG2 PTS TO THE XSA                                12510002
*                    REG 12 PTS TO THE UNIT FIELD OR IS 0 IS SYSLOG     12550002
*                    REG 14 HAS THE CALLER'S RETURN ADDRESS             12600002
*   RETURN CODES   = NONE                                               12650002
*                                                                       12700002
* EXIT - ERROR     = 1.      TO IEE5703D VIA BRANCH                     12750002
*   CONDITIONS     =         ERROR WAS DETECTED IN THE COMMAND          12800002
*   OUTPUT         =         REG2 PTS TO THE XSA                        12850002
*                            THE FOLLOWING CODES ARE SET IN THE XAE:    12900002
*                            XAE=X'12'=5703D MUST GO TO MODULE 0503D    12950002
*                                 FOR ERROR MSG                         13000002
*                                 'IEE313I UNIT REF INVALID'            13020002
*                            XAE=X'16'=5703D MUST GO TO MODULE 0503D    13050002
*                                 FOR ERROR MSG                         13100002
*                                 'IEE315I SYSLOG NOT SUPPORTED'        13120002
*                            XAE=X'20'=5703D MUST GO TO MODULE 0503D    13150002
*                                 FOR ERROR MSG                         13200002
*                                 'IEE309I UNIDENTIFIABLE KEYWORD'      13250002
*                            XAE=X'28'=5703D MUST GO TO MODULE 0503D    13300002
*                                 FOR ERROR MSG                         13350002
*                                 'IEE306I INVALID NUMERICS'            13370002
*   RETURN CODES   = NONE                                               13400002
* EXIT - ERROR     = 2.      TO IEE2103D VIA BRANCH                     13450002
*   CONDITIONS     =         ERROR WAS DETECTED IN THE COMMAND          13500002
*   OUTPUT         =         REG2 PTS TO THE XSA                        13550002
*                            XAE IS SET TO X'39' FOR NO STORAGE         13600002
*                            MESSAGE = 'COMMAND ABORTED' MSG.           13650002
*   RETURN CODES   = NONE                                               13700002
*                                                                       13750002
* EXTERNAL REFERENCES                                                   13800002
*                  = NONE                                               13850002
*   ROUTINE        = IEE5703D                                           13900002
*                    IEE2103D                                           13950002
*                    IEE4103D                                           14000002
*   DATA AREAS     = SEE EXITS - OUTPUT                                 14050002
*   CONTROL BLOCKS = 1. EXTENDED SAVE AREA (XSA)                        14100002
*                    2. UNIT CONTROL BLOCK (UCB)                        14150002
*                       FIELDS TESTED  - SRTESTAT- BIT= SRTEDADI        14200002
*                                        UCBNAME                        14250002
*                       FIELDS UPDATED - NONE                           14300002
*                    3. UNIT CONTROL MODULE (UCM)                       14350002
*                       FIELDS TESTED  - UCMATR- BIT= UCMUF             14400002
*                                                     UCMOF             14450002
*                                        UCMDISP-BIT= UCMDISPC          14500002
*                                                     UCMDISPB          14550002
*                                        UCMHCUCM                       14600002
*                                        UMSFLGS-BIT= UCMSYSG           14650002
*                                        UCMUCB                         14700002
*                                        UCMVEA                         14750002
*                       FIELDS UPDATED - UCMDISP- BIT=UCMDISPB          14800002
*                                        UCMHCUCM                       14850002
*                                        UCMHRDRT                       14900002
*                                        UCMSDS1-BIT= UCMSDS1A          14950002
*                                                     UCMSDS1B          15000002
*                                        UCMSFLGS-BIT= UCMSYSG         15050002
*                                                     UCMSYSC           15100002
*                                                     UCMSYSB           15150002
*                    4. CVT                                             15200002
*                       FIELDS TESTED  - CVTCUCB                        15250002
*                                        CVTMSER                        15300002
*                       FIELDS UPDATED - NONE                           15350002
*                    5. MASTER SCHEDULER RESIDENT DATA AREA (BASEA)     15360002
*                       FIELDS TESTED  - BALOG                          15370002
*                       FIELDS UPDATED - NONE                           15380002
*                                                                       15400002
* TABLES           = MESSAGE BUFFER = 160 BYTES GOTTEN IN               15450002
*                    SUBPOOL 255 OF LSQA                                15500002
*                                                                       15550002
* MACROS           = GETMAIN, FREEMAIN, SETLOCK                         15600002
*                                                                       15650002
* MAPPING MACROS   = IEEXSA                                             15700002
*                    IEECUCM                                            15750002
*                    IEFUCBOB                                           15800002
*                    IEEBASEA                                           15850002
*                    CVT                                                15900002
*                    IHAPSA                                             15910002
*   SERIALIZATION  = LOCAL AND CMS LOCKS ARE USED IN THIS MODULE        15950002
*                    TO PROTECT THE UCB AND UCM - UCMPRFX AND UCME      15960002
*                    PROTECTION ON THE UCB IS FROM SVC34 ONLY SINCE     15970002
*                    THE BIT TESTED IS SRTEDADI WHICH CAN ONLY BE       15980002
*                    CHANGED BY SVC34 (VARY) IN THIS MOD'S PROCESSING   15990002
*                    PROTECTION FOR THE UCM'S IS ALSO THE LOCAL AND     15992002
*                    CMS LOCKS AGAINST ANY UPDATES FROM SVC 34          15994002
*                    AND COMM TASK                                      15996002
*                    FIEDLS IN BASEA (BALOG) WILL BE PROTECTED WITH     15998002
*                    THE ABOVE LOCKS ALTHOUGH IT IS NOT NEEDED.         15998402
*                    LOCKS WILL BE SET AT:                              15998802
*                         HSETLCK IN THIS MODULE                        15999202
*                    THEY WILL BE RELEASED AT:                          15999602
*                         HUNSTLK IN IEE4103D FOR VALID COMMANDS        15999702
*                         OR AT LABEL: HUNSTLK IN THIS MODULE FOR ERROR 15999802
*                         CONDITIONS WHERE EXIT IS TAKEN TO ERR MSG MOD 15999902
*                    FIELDS THAT MUST BE PROTECTED ARE:                 16016602
*                        UCMHCUCM - PTR TO CURRENT HARDCPY  -  UCM      16026602
*                        UCMSFLGS - BITS: UCMSYSB - HCPY IS PRESENT     16028602
*                                         UCMSYSG - SYSLOG IS HCPY      16030602
*                                         UCMSYSC - CMDS SET IN HCPY    16032602
*                                   ALL THESE ARE IN THE    -  UCM      16033002
*                        UCMDISP  - BIT: UCMDISPB - THIS DEV IS THE     16033102
*                               HARDCPY DEV- UCME                       16033202
*                        UCMATR   - BIT: UCMUF - ACTV CONSL  - UCM      16038802
*                        UCMSDS1  - BIT: UCMSDS1A                       16040802
*                                        UCMSDS1B                       16042802
*                                   STCMDS AND INCMDS STATUS FOR HCPY   16043202
*                        UCMHRDRT - HDCPY ROUT CODES        -  UCM      16043602
*                                                                       16044002
*                        SRTESTAT - BIT: SRTEDADI-CHANGE STATUS         16044102
*                                                 FOR CONSL. - UCB      16044202
*                                                                       16044402
* CHANGE LEVEL     = Y02669, Y02651, Z30LPTJ, ZA04559          @ZA04559 16050003
*                                                                       16100002
* CHANGE ACTIVITY  = N/A                                                16150002
*                                                                       16200002
* MESSAGES         = REFER TO EXITS - ERROR.                            16250002
*                                                                       16300002
* ABEND CODES      = NONE                                               16350002
*                                                                       16400002
* PACKAGING        = IEE7203D WILL BE PART OF LOAD MODULE               16450002
*                    = IGC0003D                                         16500002
*                    THIS LOAD MODULE ALIASES ARE                       16550002
*                    = NONE                                             16600002
*                  THIS LOAD MODULE ENTRY POINTS ARE                    16650002
*                    = IGC0003D                                         16700002
*                      THE MODULE WILL RESIDE IN: LPALIB                16710002
*                                                                       16750002
* SYSGEN           = SUPPLIED BY SECTIONS:                              16800002
*                       LOAD MODULE NAME                                16850002
*                       PACKAGING                                       16900002
*                       THIS CSECT WILL BE INCLUDED FROM                16910002
*                       DLIB -AOSB3- BY SYSGEN MACRO -SGIEF441-         16920002
*                                                                       16950002
* SYSTEM LIBRARIES = NONE                                               17000002
*********************************************************************** 26200001
          EJECT                                                         26250002
* HARDCOPY PROCESSOR REGISTER ASSIGNMENTS-                            * 26800001
         SPACE 10                                                       27000001
DEFREG   EQU   *                                                 Y02669 27050002
R0      EQU   0                                                         27200001
R1       EQU   1                                                  19084 27400001
R2       EQU   2                   XSA                            19084 27600001
R3       EQU   3                   ADDRESS                        19084 27800001
R4       EQU   4                   UCME                           19084 28000001
R5       EQU   5                                                  19084 28200001
R6       EQU   6                                                        28400001
R7       EQU   7                                                        28600001
R8       EQU   8                                                  19084 28800002
R9       EQU   9                   UNIT PTR                       19084 29000001
R10      EQU   10                  UCM                            19084 29200001
R11      EQU   11                  UCMPFX                         19084 29400001
R12      EQU   12                  UNIT PTR IF 0,ITS SYSLOG       19084 29600001
R13      EQU   13                                                       29800001
R14      EQU   14                      RETURN REGISTER                  30000001
R15      EQU   15                                                 19084 30200001
         SPACE 10                                                       30400001
*                                                                       30600001
* ISSUING CONSOLE IDENT MASKS                                           30800001
*                                                                       31000001
* ERROR MESSAGE CODES                                                   32200001
*                                                                       32400001
ERR13    EQU   12                  UNIT REF. INVALID - 0503D      19084 32800001
ERR26    EQU   16                  SYSLOG NOT SUPPORTED - 0503D   19084 33000001
ERR9     EQU   20                  KEYWORD MISPELLED - 0503D      19084 33200001
GETERCD  EQU   X'3A'                   INSUFFICIENT STORAGE-2103DY02669 33450002
*                                                                       33600001
         SPACE 5                                                        33800001
*                                                                 19084 34000001
* GENERAL EQUATES                                                 19084 34200001
*                                                                 19084 34400001
SYSBALOG EQU   X'00'                                                    34600001
HNUM     EQU   2          MINIMUM NUMBER CONSOLES FOR HARDCOPY REQUIRED 35000003
CHGCD    EQU   X'04'               MSG - CHANGING STATUS  5703D   19084 35400001
BLANK    EQU   C' '                                                     36000001
MSGLEN   EQU   160                     MESSAGE AREA LENGTH.       21002 36850001
*                                                                       37000001
* NUMERAL EQUATES                                                 19084 37200001
*                                                                 19084 37400001
ZERO     EQU   0                                                        37600001
TWO      EQU   2                                                        38000001
TRE      EQU   3                                                        38200001
FOR      EQU   4                                                        38400001
EIT      EQU   8                                                        39000001
FOX      EQU   255                                                      40200001
         EJECT                                                          40400001
*********************************************************************** 40600001
*                                                                     * 40800001
* HARDCOPY PROCESSING MODULE                                          * 41000001
*                                                                     * 41200001
*********************************************************************** 41400001
         BALR  R3,ZERO             ADDRESSABILITY                 19084 41600001
         USING *,R3                                               19084 41800001
         MODID BR=YES                                            Y01886 41850001
         USING XSA,R2                                             19084 42000001
         L     R12,XAL                                           Y02669 42050002
         LA    R12,ZERO(R12)       GET POINTER TO PARAMS         Y02669 42100002
         L     R15,CVTPTR          CVT POINTER                    19084 42200001
         USING HCVTSET,R15                                        19084 42400001
         L     R10,CVTCUCB         PTR TO UCM                     19084 42600001
         USING UCM,R10                                           Y02669 42800002
*                                                                 19084 43000001
         LR    R11,R10             PTR TO UCM                     19084 43200001
         LA    R1,FOR                                             19084 43400001
         SR    R11,R1              MINUS FOUR IS PTR TO PFX       19084 43600001
         L     R11,ZERO(R11)                                      19084 43800001
         USING UCMPRFX,R11                                        19084 44000001
         MVC   XAD(GETLNTH),GETLIST    MOVE IN LIST FORM.         21002 44010001
         LA    R1,XAX                  GET LIST POINTER.          21002 44020001
         ST    R1,XAX                  STORE LIST POINTER.        21002 44030001
         LA    R1,XAD                  GET LIST ADDRESS.          21002 44040001
* DO A CONDITIONAL GETMAIN. THE GOTTEN ADDRESS WILL BE IN XAX.    21002 44042001
         GETMAIN MF=(E,(1))            DO CONDITIONAL GETMAIN.    21002 44050001
         LTR   R15,R15                 GETMAIN SUCCESSFUL ?       21002 44100001
         BNZ   GETERR                  NO,SO TAKE ERROR EXIT.     21002 44150001
         EJECT                                                          44200001
*********************************************************************** 44400001
*                                                                       44600001
* UNIT SCAN                                                             44800001
*                                                                       45000001
*********************************************************************** 45200001
HSCAN    EQU   *                                                        45400002
          SPACE 10                                                      45450002
***************************************************              Y02651 45500002
*                                                                Y02651 45510002
*  LOCKS MUST BE SET AT THIS POINT AT LABEL: HSETLCK             Y02651 45520002
*  THEY WILL BE RELEASED AT: HUNSTLK                             Y02651 45530002
*                                                                Y02651 45540002
HSETLCK  EQU   *                                                 Y02651 45542002
         STM   R11,R14,XASAVLOC                                  Y02651 45542402
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02651*45544002
               RELATED=(IEE4103D(HUNSTLK),IEE7203D(HUNSTLK))     Y02651 45546002
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02651*45548002
               RELATED=(IEE4103D(HUNSTLK),IEE7203D(HUNSTLK))     Y02651 45548402
         LM    R11,R14,XASAVLOC                                  Y02651 45548802
***************************************************              Y02651 45550002
          SPACE 10                                                      45560002
         L     R9,UCMHCUCM         PTR TO CURRENT HARDCPY, IF ANY 19084 45600001
         LA    R9,ZERO(R9)                                        19084 45800001
         CLC   ZERO(TWO,R12),HUNIT     IS UNIT SPECIFIED          19084 46000001
         BE    HPRESNT             NO, PRESENT HCPY IS TO BE MODIF19084 46200001
         CLC   TRE(TWO,R12),HUNIT      IS UNIT GIVE               19084 46400001
         BE    HUCHK               YES, GO CHECK VALIDITY         19084 46600001
         CLC   ZERO(EIT,R12),HSYSLOG   IS UNIT SYSLOG             19084 46800001
         BNE   HERR2                   NO,INVALID UNIT REFERENCE        47000001
         SPACE 10                                                       47200001
*********************************************************************** 47400001
*                                                                       47600001
* PROCESSING OF SYSLOG AS UNIT SPECIFIED IN COMMAND                     47800001
*                                                                       48000001
*********************************************************************** 48200001
         SR    R12,R12               SYSLOG,ZERO R12 FOR MOD 4803D19084 48400001
         TM    UCMSFLGS,UCMSYSG     IS SYSLOG EXISTING HARDCPY    19084 48600001
         BO    HMAINCK                 YES, BRANCH TO MAINTENANCE CHECK 48800001
         L     R15,CVTPTR              POINTER TO CVT             21002 48850001
         USING HCVTSET,R15             ADDRESSIBILITY FOR CVT     21002 48900001
         L     R15,CVTMSER              PTR TO MASTER RESIDENT COR19084 49000001
         USING BASE,R15                 USE TO DETERMINE IF SYSLOG19084 49200001
         CLI    BALOG,SYSBALOG      IS SYSLOG SUPPORTED           19084 49400001
         BE    HERR3                   ERROR MESSAGE IS WRITTEN   19084 49600001
         DROP  R15                  OTHERWISE                     19084 49800001
         LTR   R9,R9                   IF IS ZERO,NON-EXISTENT    19084 50000001
         BZ    HSYS1                   HARDCOPY SO DON'T DELETE         50200001
         USING UCMLIST,R9              OTHERWISE,                 19084 50400001
         NI    UCMDISP,FOX-UCMDISPB           TURN OFF HARDCOPY BIT9084 50600001
HSYS1    EQU   *                                                        50800001
         XC    UCMHCUCM(FOR),UCMHCUCM  ZERO OUT SYSLOG PTR              51000001
         OI    UCMSFLGS,UCMSYSG         SET SYSLOG BIT IN UCM ON  19084 51200001
*********************************************************************** 51400001
*                                                                     * 51600001
* CHECK FOR BASIC MAINTENANCE REQUIRED                                * 51800001
*                                                                     * 52000001
*********************************************************************** 52200001
HMAINCK  LA    R13,HNUM                NUMBER OF NON-GRAPHICS     19084 52400001
         LM    R5,R7,UCMVEA        TPR TO FIRST,LAST UCME AND SIZE19084 52600001
         DROP  R9                                                 19084 52800001
         USING UCMLIST,R5                                         19084 53000001
         SPACE                                                          53050001
HGRAPH   EQU   *                                                        53200001
         L     R1,UCMUCB                                          19084 53400001
         USING HUCBSET,R1                                         19084 53600001
         TM    UCMATR,UCMUF        IS AN ACTIVE CONSOLE          Y02669 53800002
         BZ    HNONACT             NO, GO CHECK IF CHANGING TO ACT19084 54000001
         TM    SRTESTAT,SRTEDADI   ACTIVE,CHECK IF CHANGING TO NONACTV  54200001
         BO    HGRAPH1             YES,CHANGING,OMIT              19084 54400001
HGRAPH3  EQU   *                                                  19084 54600001
         TM    UCMDISP,UCMDISPC    IS IT AN ACTIVE GFX CONSOLE    19084 54800001
         BO    HADDREQ             YES,MAKE IT REQ FOR HCPY             55000001
         TM    UCMATR,UCMOF         OUTPUT UNIT                   19084 55200001
         BZ    HGRAPH1             NO, OMIT WILL BE PICKED UP BY O-     55400001
         BCT   R13,HGRAPH1         DECREMENT AND CHECK NEXT UCME  19084 55600001
         SPACE 10                                                       55650001
HADDREQ  EQU   *                                                  19084 55800001
*********************************************************************** 55850001
* IF THERE IS AN ACTIVE GRAPHICS CONSOLE OR IF THERE ARE MORE    21002* 55900001
* THAN ONE ACTIVE CONSOLE, HARDCOPY IS REQUIRED. IF NO AUTH      21002* 55950001
* AND NO HARDCOPY DEVICE ARE SPECIFIED (THE HARDCOPY DEVICE IS   21002* 55960001
* NOT CHANGING) THE AUTH WILL REMAIN UNCHANGED. IF NO DEVICE IS  21002* 55970001
* BEING CHANGED AND AUTH IS NOT SPECIFIED, CMDS IS ASSUMED.      21002* 55980001
*********************************************************************** 55990001
         OC    XARTCODE(TWO),HBASIC1   ADD MANDATORY ROUT CODES@Z30LPTJ 56200003
         OI    XASWITCH,XAHRDREQ    INDICATE HARDCOPY REQUIRED @Z30LPTJ 56260003
         TM    XASOPCOD,XACMD         IS AUTH TO CHANGE.       @Z30LPTJ 56320003
         BO    HARDCPY                 YES, CK AUTH CHANGE.       21002 56400001
         TM    UCMSDS1,UCMSDS1A+UCMSDS1B WAS STCMDS OR INCMDS  @ZA04559X56410003
                                         SPECIFIED BEFORE      @ZA04559 56420003
         BNZ   HROUTCD             YES THEN BRANCH. DON'T USE  @ZA04559X56430003
                                   DEFAULT AUTH (CMDS)         @ZA04559 56440003
         B     DEFAULT             SET MANDAT RT CODES & CMDS    Y02669 56450002
HNONACT  EQU   *                                                  19084 56600001
         TM    SRTESTAT,SRTEDADI   NONACTV CHANGING TO ACTIVE     19084 56800001
         BO    HGRAPH3             YES,COUNT IT IN                19084 57000001
HGRAPH1  BXLE  R5,R6,HGRAPH        CONTINUE CHCK TILL ALL TESTED  19084 57200001
         DROP  R5,R1                                              19084 58000001
         TM    XASOPCOD,XACMD      IS CMDS TO BE CHANGED       @Z30LPTJ 58200003
         BZ    HROUTCD                   NO,CHECK FOR ROUT CHANGES19084 58400001
         SPACE 5                                                        58410001
HARDCPY  EQU   *                                                  21002 58450001
*********************************************************************** 58500001
*   AUTHORITY CODE DETERMINATION.                                     * 58550001
*********************************************************************** 58570001
         NI    UCMSDS1,FOX-UCMSDS1A-UCMSDS1B TURN OFF STCMDS INCMDS     58600001
*                            THE PREVIOUS STMT WAS ADDED FOR      21002 58800001
         NI    UCMSFLGS,FOX-UCMSYSC    TURN OFF CMDS              21002 59000001
         TM    XASWITCH,XASTHDCP       IS THIS STCMDS          @Z30LPTJ 59600003
         BO    HGRAPH2                 YES, SET BITS              21002 59800001
         TM    XASWITCH,XAINHDCP       IS THIS INCMDS          @Z30LPTJ 60000003
         BO    HGRAPH4                 YES, SET BITS              21002 60200001
         TM    XASWITCH,XAHRDCMD       IS THIS CMDS            @Z30LPTJ 60220003
         BO    DEFAULT                 YES SET BITS               21002 60230001
*********************************************************************** 60232001
*  IF HARDCOPY IS REQUIRED AND NOCMDS IS SPECIFIED, CMDS IS USED 21002* 60234001
*********************************************************************** 60236001
         TM    XASWITCH,XAHRDREQ       IS HARDCOPY REQUIRED    @Z30LPTJ 60250003
         BNO   HROUTCD1                NO, NOCMDS IS VALID        21002 60300001
DEFAULT  EQU   *                                                  21002 60350001
         OI    UCMSFLGS,UCMSYSC          SET COMMANDS WANTED BITON19084 60400001
         B     HROUTCD                   GO CHECK FOR ROUT CHANGES19084 60600001
HGRAPH2  EQU   *                                                  21002 60800001
         OI    UCMSDS1,UCMSDS1A        INDICATE STCMDS            21002 61000001
         B     HROUTCD                 CHECK ROUTING CODES        21002 61200001
HGRAPH4  EQU   *                                                  21002 61400001
         OI    UCMSDS1,UCMSDS1B        INDICATE INCMDS            21002 61600001
         SPACE 2                                                        61610001
HROUTCD  EQU   *                                                  21002 61650001
*********************************************************************** 61700001
* IF HARDCOPY IS REQUIRED, EVEN IF NO NEW ROUT CODES WERE SPECIF-21002* 61750001
* IED, THE ROUT CODES WILL CHANGE TO MAKE SURE THAT THE MANDA-   21002* 61800001
* TORY ROUT CODES ARE INCLUDED.                                  21002* 61850001
*********************************************************************** 61900001
         SPACE                                                          61950001
         TM    XASWITCH,XAHRDREQ       IS HARDCOPY REQUIRED    @Z30LPTJ 61960003
         BO    HROUTMVC                INCLUDE MANDAOTRY RT CODES 21002 61970001
HROUTCD1 EQU   *                                                  21002 61980001
         TM    XASWITCH,XAROUT      ARE RT.CODES TO BE CHANGED @Z30LPTJ 62000003
         BZ    HSTOP                   NO,COMMAND FINISHED              62200001
HROUTMVC EQU   *                                                  19084 62400001
         TM    XASWITCH,XAROUT    IF ROUTS WERE SPECIFIED      @Z30LPTJ 62450003
*                                 ON THE CMD THEY ARE ALREADY IN Y02669 62500002
         BO    MOVE               THEN JUST MOVE THEM IN UCME    Y02669 62550002
         OC    XARTCODE(TWO),UCMHRDRT  OR IN OLD ROUTS ALSO    @Z30LPTJ 62560003
MOVE     EQU   *                                                 Y02669 62570002
         MVC   UCMHRDRT(TWO),XARTCODE   CHANGE ROUTING CODES   @Z30LPTJ 62600003
HSTOP    EQU   *                                                        62800001
         L     R1,XAX                  PASS MSG AREA ADDRESS     Y02669 62850002
         MVC   XAX(EIT),HMSG3           HARDCPY MSG MOD 4103D           63000001
         OI    UCMSFLGS,UCMSYSB    TURN BIT MEANING HCPY IS ON SYS19084 63200001
         L     R15,VCON41          GO TO XCTL TO MES MODULE      Y02669 63400002
         BR    R15                 GO TO IT                      Y02669 63450002
*                                                                       63600001
         EJECT                                                          63800001
*********************************************************************** 64000001
*                                                                       64200001
* UNIT IS UNSPECIFIED-CHANGES ARE MADE TO EXISTING HARDCOPY             64400001
*                                                                       64600001
*********************************************************************** 64800001
HPRESNT  EQU   *                                                        65000001
         SR    R12,R12                                            19084 65200001
         TM    UCMSFLGS,UCMSYSG     DOES HARDCPY EXIST (SYSLOG)   19084 65400001
         BO    HMAINCK                 YES,GOTO MAINT. REQUIREMENTS CHK 65600001
         L     R12,XAL             PTR TO BEGINNING               19084 65800001
         LA    R12,ZERO(R12)                                      19084 66000001
         LTR   R9,R9               SETO FOR SYSLOG OR PTR TO HCPY 19084 66200001
         BZ    HERR5                   HARDCOPY EXISTS,OTHERWISE ERROR  66400001
         USING UCMLIST,R9                                         19084 66600001
         L     R9,UCMUCB           PTR TO THE UCB OF THE HARDCPY  19084 66800001
         DROP  R9                                                 19084 67000001
         USING HUCBSET,R9          ADDRESSABILITY FOR THE UCB     19084 67200001
         LA    R12,UCBNAME          PTR TO THE DEVICE NAME FOR 48 19084 67400001
         DROP  R9                                                 19084 67600001
         B     HMAINCK                 ..                               67800001
*                                                                 19084 68000001
         EJECT                                                          68200001
*********************************************************************** 68400001
*                                                                       68600001
* UNIT SPECIFIED                                                        68800001
*                                                                       69000001
*********************************************************************** 69200001
HUCHK    EQU   *                                                  19084 69400001
         LM    R5,R7,UCMVEA        R4 HAS PTR TO FIRST UCME       19084 69600001
*                                  R5 HAS SIZE OF EACH UCME       19084 69800001
*                                  R6 HAS PTR TO LAST UCME        19084 70000001
         USING UCMLIST,R5             REFERENCE TO UCM ENTRY      19084 70200001
HLOOP    EQU   *                                                  19084 70400001
         L     R4,UCMUCB           PTR TO UCB ASSOCIATED WITH UCME19084 70600001
         USING HUCBSET,R4                                         19084 70800001
         CLC   ZERO(TRE,R12),UCBNAME  COMPARE PHYSICAL UNIT ADRS. 19084 71000001
         BE    HFND                    EQUAL, UNIT HAS UCME             71200001
         BXLE  R5,R6,HLOOP         NO, CONTINUE SEARCH TILL EXHAUS19084 71400001
HERR5    EQU   *                                                  19084 71600001
         MVI   XAE,ERR13           UNIT REF INVALID TO 0503D      19084 71800001
         MVC   XAV(TRE),ZERO(R12)  MOVE IN INCORRECT UNIT         19084 72000001
         MVI   XAV+TRE,BLANK       MOVE IN BLANK TO CLEAR AREA    19084 72200001
         B     HOFFMVC             GO TO XCTL RTN                 19084 72400001
*                                                                 19084 72600001
*                                                                       72800001
HFND     EQU   *                                                        73000001
         TM    UCMDISP,UCMDISPB       IS UNIT CURRENT HARDCPY     19084 73200001
         BO    HMAINCK                 YES,CHECK FOR MAINTENANCE        73400001
         TM    UCMDISP,UCMDISPC      IS DEVICE A GRAPHICS         19084 73600001
         BO    HERR5               ERR,HCPY SHOULD NOT BE GFX     19084 73800001
         TM    UCMATR,UCMOF         DOES IT HAVE WTO SUPPORT     Y02669 74000002
         BZ    HERR5               ERROR                          19084 74200001
         TM    UCMATR,UCMUF        ACTIVE BIT ON IN UCME         Y02669 74400002
         BO    HPENG               YES, CHECK IF CHANGING STATUS  19084 74600001
         TM    SRTESTAT,SRTEDADI   NONACTV, IS IT CHANGING TO ACTV19084 74800001
        BO     HERR4               YES, CHANGING STATUS MESSAGE   19084 75000001
         B     HERR5               NO, PURELY NONACTV,UNIT REF INV19084 75200001
HPENG    EQU   *                                                  19084 75400001
         TM    SRTESTAT,SRTEDADI   ACTIVE CHANGING TO NONACTIVE   19084 75600001
         BO    HERR5               YES, UNIT REF INVALID          19084 75800001
*                                                                       76000001
         TM    UCMSFLGS,UCMSYSG         WAS HARDCOPY SYSLOG       19084 76200001
         BO    HSOFF                   YES, GO TURN SYSLOG BIT OFF      76400001
         LTR   R9,R9               ZERO  IS NONEXISTANT HCPY      19084 76600001
         BZ    HON                     ..                               76800001
         DROP  R5                                                 19084 77000001
         USING UCMLIST,R9              GO TO EXISTING HARDCPY UCME19084 77200001
         NI    UCMDISP,FOX-UCMDISPB           TURN OFF HARDCPY BIT19084 77400001
         DROP  R9                                                 19084 77600001
         USING UCMLIST,R5                                         19084 77800001
HON      OI    UCMDISP,UCMDISPB           TURN BIT ON IN NEW HARDC19084 78000001
         ST    R5,UCMHCUCM            STORE POINTER TO UCME       19084 78200001
         B     HMAINCK                 GO CHECK MAINTENANCE REQUIREMET  78400001
*                                                                       78600001
HSOFF    NI    UCMSFLGS,FOX-UCMSYSG        TURN SYSLOG BIT OFF    19084 78800001
         B     HON                     GO CHANGE POINTER                79000001
         EJECT                                                          79200001
*********************************************************************** 79400001
*                                                                       79600001
* ERROR MESSAGE ROUTINES                                                79800001
* AND EXIT ROUTINE                                                19084 80000001
*                                                                       80200001
*********************************************************************** 80400001
*                                                                       80600001
*                                                                       80800001
HERR2    EQU   *                                                  21002 81000001
         MVI   XAE,ERR9                MISSPELLED KEYWORD         21002 81200001
         B     HOFFMVC                 EXIT TO IGC5703D           21002 81400001
HERR3    EQU   *                                                  19084 81600001
         MVI   XAE,ERR26           ERR IS 26,SYSLOG NOT SUPPORTED 19084 81800001
*                                                                 19084 82000001
         B     HOFFMVC                                            19084 82200001
*                                                                 19084 82400001
HERR4    EQU   *                                                  19084 82600001
         MVI   XAE,CHGCD           MOVE CODE TO PUT CHANGING STATU19084 82800001
*                                  MESSAGE FROM 5703D             19084 83000001
HOFFMVC  EQU   *                                                  19084 83200001
         SPACE 10                                                       83210002
***************************************************              Y02651 83220002
*                                                                Y02651 83222002
*  LOCKS ARE NO LONGER NEEDED AND SINCE EXIT WILL BE TAKEN       Y02651 83224002
*  THEY MUST BE RELEASED FIRST AT LABEL:  HUNSTLK                Y02651 83226002
*                                                                Y02651 83228002
         BAL   R11,HUNSTLK        RELEASE ALL LOCKS              Y02651 83228402
*                                                                Y02651 83228802
***************************************************              Y02651 83230002
         SPACE 10                                                       83240002
         L     R1,XAX                  GET MESSAGE AREA ADDRESS.  21002 83250001
* IF WE TAKE THE ERROR PATH THE MESSAGE AREA MUST BE FREED.       21002 83310001
         FREEMAIN R,LV=MSGLEN,A=(1),SP=229                       Y02669 83350002
         MVC   XAX(EIT),OFFMOD     MOD NAME IS IGC5703D           19084 83400001
         L     R15,VCON57          ADDRESS OF 5703D              Y02669 83450002
         BR    R15                 GO TO IT                      Y02669 83500002
*                                                                 19084 85000001
GETERR   EQU   *                                                  21002 85650001
         MVI   XAE,GETERCD             PUT IN MESSAGE INDICATOR.  21002 85700001
         MVC   XAX(EIT),GETERMOD       SET UP ERROR XCTL.         21002 85750001
         L     R15,VCON21              ADDRESS OF 2103D          Y02669 85760002
         BR    R15                     GOTO IT                   Y02669 85770002
         EJECT                                                          85800001
*****************************************************************Y02651 85850002
*                                                                Y02651 85860002
*  THIS IS THE RELEASE-LOCKS SUBROUTINE                          Y02651 85870002
*  BOTH THE LOCAL AND CMS LOCKS WILL BE RELEASED HERE            Y02651 85880002
*                                                                Y02651 85890002
HUNSTLK  EQU   *                                                 Y02651 85892002
         STM   R11,R14,XASAVLOC                                  Y02651 85892402
         SETLOCK RELEASE,TYPE=CMS,RELATED=(IEE7203D(HSETLCK))    Y02651 85894002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(IEE7203D(HSETLCK))  Y02651 85896002
         LM    R11,R14,XASAVLOC                                  Y02651 85898002
         BR    R11                                               Y02651 85898402
*                                                                Y02651 85898802
*****************************************************************Y02651 85900002
         EJECT                                                          85950002
*********************************************************************** 86000001
*                                                                       86200001
* CONSTANTS USED BY HARDCPY PROCESSOR                                   86400001
*                                                                       86600001
*********************************************************************** 86800001
HSYSLOG  DC    C'SYSLOG'           DO NOT SEPARATE THESE TWO DCLS 19084 87000001
HUNIT    DC    C',H'               THEY ARE USED TOGHETHER        19084 87200001
*                                                                 19084 87400001
*                                                                       87600001
*                                                                       87800001
HMSG3    DC    C'IGC4103D'         HARDCOPY MSG MOD = 4103D             88000001
OFFMOD   DC    C'IGC5703D'         HARDCPY,OFF PROCESSOR          19084 88200001
GETERMOD DC    C'IGG2103D'             ERROR MODULE.              21002 88250001
HBASIC1  DC    X'F340'                 MASK FOR BASIC ROUTINE CODES     88400001
         DS    0F                                                Y02669 88410002
VCON41   DC    V(IEE4103D)                                       Y02669 88420002
VCON57   DC    V(IEE5703D)                                       Y02669 88430002
VCON21   DC    V(IEE2103D)                                       Y02669 88440002
GETLIST  GETMAIN EC,LV=MSGLEN,A=0,SP=229,MF=L                     21002 88450002
GETLNTH  EQU   *-GETLIST               LENGTH OF LIST FORM.       21002 88500001
         SPACE 5                                                        88550002
PATCH    DC    CL50'***IEE7203D***'                            @Z30LPTJ 88560003
         END                                                            88600001
