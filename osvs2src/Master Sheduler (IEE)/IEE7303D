 TITLE 'IEE7303D - CONSOLE INFORMATION MESSAGE ROUTINE #2'              00150003
IEE7303D CSECT                                                          00200002
*********************************************************************** 00300001
* MODULE NAME      = IEE7303D                                           00350002
*   CSECT NAME     = IEE7303D                                           00400002
*                                                                       00450002
* LOAD MODULE NAME = IEE3603D                                           00500002
*                                                                       00550002
* DESCRIPTIVE NAME = CONSOLE INFORMATIONAL MESSAGE ROUTINE              00600002
*                                                                       00650002
* COPYRIGHT        = MISSING                                            00700002
*                                                                       00750002
* STATUS           = OS/VS/2 RELEASE 3                         @Z30LPTJ 00800003
*                                                                       00850002
* FUNCTION         = CONSTRUCTS A MESSAGE DISPLAYING THE CURRENT        00900002
*                    STATUS OF THE CONSOLE                              00950002
*                                                                       01000002
* OPERATION        = AFTER A DEVICE HAS BEEN CHANGED INTO THE           01050002
*                    CONSOLE STATE, THIS ROUTINE IN CONJUNCTION         01100002
*                    WITH IEE4803D BUILDS AND SENDS A MESSAGE           01150002
*                    TO THE OPERATOR DISPLAYING THE CURRENT STATUS      01200002
*                    OF THE NEW CONSOLE DEVICE                          01250002
*                    THE MESSAGE CONTAINS THE PHYSICAL DEVICE           01300002
*                    ADDRESS OF THE CONSOLE AND ITS ALTERNATE CONSOLE   01350002
*                    AND WHETHER THE CONSOLE IS ACTIVE AND/OR           01400002
*                    THE MASTER CONSOLE.  IT ALSO HAS THE ROUT CODES    01450002
*                    AND COMMAND AUTHORITY OF THE NEW CONSOLE.          01500002
*                    THIS RTN IS CALLED REPEATEDLY BY 4803D, AS         01510002
*                    MANY TIMES AS THERE ARE UNITS ON THE CMD.          01520002
*                                                                       01550002
* NOTES                                                                 01600002
*   DEPENDENCIES   = NONE                                               01650002
*   CHARACTER/CODE DEPENDENCIES                                         01700002
*                  = THIS MODULE IS DEPENDENT ON THE EBCDIC             01750002
*                    REPRESENTATION OF DECIMAL DIGITS                   01800002
*                                                                       01850002
* RESTRICTIONS     = SEE ENTRY POINTS - INPUT DATA                      01900002
*   REGISTER CONVENTIONS                                                01950002
*                  = REGISTERS ARE DEFINED AT LABEL: DEFREG             02000002
*   PATCH LABEL    = PATCH                                              02050002
*                                                                       02100002
* MODULE TYPE      = CSECT                                              02150002
*   PROCESSOR      = ASSEMBLER                                          02200002
*   MODULE SIZE    = VS/2 = '356'                              @ZM30445 02250003
*   ATTRIBUTES     = REENTRANT, REFRESHABLE, REUSABLE,                  02300002
*                    ZERO PSW PROTECT KEY                               02350002
*                                                                       02400002
* ENTRY POINTS     = IEE7303D                                           02450002
*                    FROM IEE4803D                                      02500002
*   PURPOSE        = TO ISSUE THE INFORMATIONAL CONSOLE MESSAGE         02550002
*                    AND ALSO THE HARDCPY MESSAGE IF THE CONSOLE        02600002
*                    IS ACTING AS THE HARDCPY DEVICE AS WELL            02650002
*   LINKAGE        = BRANCH                                             02700002
*   INPUT          = REG2 PTS TO THE DUMMY XSA                          02750002
*                    REG0 HAS COMPOSITE UCME PTR OR 0 IF NONE           02760002
*                    REG4 HAS THE PROCESS BITS                          02770002
*                    REG5 PTS TO UCME OF UNIT OR I-UNIT IF COMP.        02780002
*                    REG 13 PTS TO THE SAVE AREA, WORD 17 OF THE        02800002
*                       SAVE AREA CONTAINS THE PTR TO THE CSCB          02850002
*                    REG1 PTS TO THE MESSAGE CORE GOTTEN BY             02900002
*                    IEE4903D ( WHO ISSUE THE FIRST INFORMATIONAL       02950002
*                    HEADER MSG).                                       03000002
*                    XAR OF THE DUMMY XSA HAS THE PROCESS SWITCHES      03150002
*                    XAL OF THE DUMMY XSA HAS THE POINTER TO THE        03200002
*                       PARMS OF THE COMMAND                            03250002
*                    XRESV MAY HAVE BIT1 SET TO INDICATE IMMEDIATE      03300002
*                    BRANCH TO LABEL: CRT2                              03350002
*                    REG9 POINTS TO THE UNIT                            03550002
*                    REG11 WILL BE ZERO UNLESS HARDCPY MSG IS NEEDED.   03600002
*                    THEN, IT WILL CONTAIN THE POINTER TO THE UCME      03650002
*                    OF THE HARDCPY UNIT                                03700002
*                    REG12 CONTAINS THE ADDRESS OF THE MSG AREA         03750002
*                    XAP CONTAINS THE MLWTO ID AND  THE GRAPHICS        03900002
*                    INDICATOR.                                         03950002
*   REGISTERS SAVED  = ALL                                              04000002
*   REGISTER USAGE = REG1    PTR TO WTO CORE ON INPUT                   04050002
*                    REG2    PTR TO  THE DUMMY XSA                      04100002
*                    REG3    ADDRESSABILITY                             04150002
*                    REG4    PROCESS BITS                               04200002
*                    REG5    UCME PTR                                   04210002
*                    REG10   UCM PTR                                    04350002
*                    REG11   HCPY OF NOHCPY MSG SWITCH                  04400002
*                    REG12   MSG ADDRESSABILITY                         04450002
*                    REG13   SAVE AREA PTR                              04500002
*                    REG14   COMPOSITE SWITCH                           04550002
*   REGISTERS RESTORED                                                  04600002
*                  = ALL                                                04650002
*                                                                       04700002
* EXITS - NORMAL-1-= TO IEE4803D VIA BRANCH                             04750002
*   CONDITIONS     = IF A HARDCPY MESSAGE IS STILL REQUIRED             04800002
*   OUTPUT         = REG2 PTS TO THE DUMMY XSA                          04850002
*                    REG13 PTS TO THE SAVE AREA                         04900002
*                    REG1 PTS TO THE MESSAGE CORE GOTTEN BY 4903D       04950002
*                    REG11 HAS THE INDICATOR FOR THE HARDCPY MSG        05000002
*                    XRESV OF THE XSA WILL HAVE THE HIGH ORDER BIT      05050002
*                       SET TO IMMEDIATELY BRANCH TO LABEL: CENDCHK     05100002
*                    REG4 CONTAINS THE CURRENT PROCESS SWITCHES         05150002
*   RETURN CODES   = NONE                                               05350002
*                                                                       05400002
* EXITS - NORMAL-2-  = RETURN TO CALLER VIA A BR 14 AFTER THE CSCB      05450002
*                    HAS BEEN FREED VIA AN MGCR MACRO AND THE           05500002
*                    DUMMY XSA GOTTEN BY 3603D, AND THE SAVE AREA       05550002
*                    GOTTEN BY 3303D ARE FREED.                         05600002
*   CONDITIONS     = ALL MESSAGES ARE ISSUED, THE COMMAND IS            05650002
*                    COMPLETED                                          05700002
*   OUTPUT         =  MESSAGES HAVE BEEN SENT AND ALL CORE HAS BEEN     05750002
*                    FREED.                                             05800002
*   RETURN CODES   = NONE                                               05850002
*                                                                       05860002
* EXITS - ERROR    = NONE                                               05870002
*                                                                       05880002
* EXTERNAL REFERENCES                                                   05890002
*   ROUTINES       = IEE4803D                                           05892002
*   DATA AREAS     = SEE EXITS - OUTPUT DATA                            05894002
*                                                                       05896002
* CONTROL BLOCKS   = 1. DUMMY EXTENDED AREA (XSA)                       05898002
*                    2. DISPLAY CONTROL MODULE (DCM)                    05898402
*                       FIELDS TESTED -  DCMTOPAR                       05898802
*                       FIEDLS UPDATED - NONE                           05899202
*                    3. CVT                                             05899602
*                       FIELDS TESTED  - CVTCUCB                        05899702
*                       FIELDS UPDATED - NONE                           05899802
*                    4. UNIT CONTROL MODULE (UCM)                       05899902
*                       FIELDS TESTED  - UCMDISP- BIT=UCMDISPC          05933202
*                                                     UCMDISPG          05935202
*                                        UCMID                          05937202
*                                        UCMRTCD                        05939202
*                                        UCMXB                          05941202
*                       FIELDS UPDATED - NONE                           05943202
*                    5. COMMAND SCHEDULING CONTROL BLOCK (CSCB)         05953202
*                       FIELDS TESTED  - NONE                           05963202
*                       FIELDS UPDATED - CHSTS - BIT= CHFC              05965202
*                                                                       05965602
* TABLES           = MESSAGE BUFFER GOTTEN BY IEE4903D                  05966002
*                                                                       05966402
* MACROS           = MGCR,FREEMAIN,WTO,DEQ,SETLOCK                      05966502
*                                                                       05966602
* MAPPING MACROS   = IEEXSA                                             05977702
*                    CVT                                                05987702
*                    IEECUCM                                            05988102
*                    IEERDCM                                            05988602
*                    IEECHAIN                                           05989602
*                    IHAPSA                                             05991602
*   SERIALIZATION  = PROTECTION AGAINST COMM. TASK IS ACCOMPLISHED      05992002
*                    VIA THE CMS AND LOCAL LOCKS OBTAINED AT:           05992402
*                        CSETLOCK IN MODULE IEE4803D                    05992802
*                    AND RELEASED IN THIS MODULE AT:                    05992902
*                        UNSTLOCK                                       05995802
*                    PROTECTION AGAINST OLTEP, VARY/UNLOAD AND          05997802
*                    ALLOCATION IS ACCOMPLISHED VIA THE ENQ             05998202
*                    ISSUE IN MODULE IEE3603D.                          05998602
*                    A DEQ IS ISSUED IN THIS MODULE AT: CDEQUE          05998702
*                    IF THE COMMAND HAS A TERMINAL EXIT FROM HERE.      05998802
*                    OTHERWISE, THE DEQ WILL BE ISSUED IN 4803D         05998902
*                    WHERE THAT MODULE WILL EXIT IF NOT FROM HERE.      05999202
*                                                                       06000002
* CHANGE LEVEL     = Y02669, Y02651, Z30LPTJ, ZM30445          @ZM30445 06001803
*                                                                       06004702
* CHANGE ACTIVITY  = N/A                                                06007602
*                                                                       06010502
* MESSAGES         = REFER TO PROLOGUE OF IEE4903D FOR FULL INFORMATION 06013402
*                                                                       06016302
* ABEND CODES      = NONE                                               06019202
*                                                                       06022102
* PACKAGING        = IEE7303D WILL BE PART OF LOAD MODULE               06032102
*                       IEE3603D                                        06042102
*                    THIS LOAD MODULE ALIASES ARE                       06044102
*                       NONE                                            06046102
*                    THIS LOAD MODULE ENTRY POINTS ARE                  06048102
*                       IEE3603D                                        06056702
*                    MODULE WILL RESIDE IN: LPALIB                      06057102
*                                                                       06058702
* SYSGEN           = SUPPLIED BY THE FOLLOWING SECTIONS:                06060702
*                       LOAD MODULE NAME                                06062702
*                       PACKAGING                                       06064702
*                    THIS CSECT WILL BE INCLUDED AT SYSGEN FROM         06064802
*                    DLIB -AOSB3- BY MACRO -SGIEF441-                   06073602
*                                                                       06078002
* SYSTEM LIBRARIES = NONE                                               06082402
*                                                                       06086802
*********************************************************************** 06091202
         EJECT                                                          06095602
*                                                                 19084 06100001
*********************************************************************** 06200001
*                                                                 19084 06300001
*        REGISTER EQUATES                                         19084 06400001
*                                                                 19084 06500001
*********************************************************************** 06600001
DEFREG   EQU   *                                                 Y02669 06650002
R0       EQU   0                   INPUT = COMPOSITE SWITCH      Y02669 06700002
R1       EQU   1                   IN-PTR TO WTO CORE            Y02669 06800002
R2       EQU   2                   XSA                            19084 06900001
R3       EQU   3                   ADDRESSABILITY                 19084 07000001
R4       EQU   4                   PROCESS BITS                         07100002
R5       EQU   5                   UCME PTR                             07200002
R6       EQU   6                                                  19084 07300001
R7       EQU   7                                                        07400002
R8       EQU   8                                                        07450002
R9       EQU   9                                                        07600002
R10      EQU   10                  UCM                            19084 07700001
R11      EQU   11                  HCPY OR NOHCPY MSG SWITCH      19084 07800001
R12      EQU   12                  MSG ADDRESSABILITY             19084 07900001
R13      EQU   13                  SAVE AREA PTR                 Y02669 08000002
R14      EQU   14                  USED AS COMPOSITE SWITCH      Y02669 08100002
R15      EQU   15                                                 19084 08200001
*                                                                 19084 08300001
         SPACE 10                                                       09200001
*********************************************************************** 09300001
*                                                                 19084 09400001
*        EQUATES                                                  19084 09500001
*                                                                 19084 09600001
*********************************************************************** 09700001
ZERO     EQU   0                                                  19084 09800001
ONE      EQU   1                                                  19084 09900001
TWO      EQU   2                                                  19084 10000001
FOR      EQU   4                                                        10050003
TRE      EQU   3                                                  19084 10100001
FIV      EQU   5                                                  19084 10300001
FIFTN    EQU   15                                                 19084 10500001
D64      EQU   64                                                Y02669 10560002
D132     EQU   132                                               Y02669 10570002
D68      EQU   68                                                Y02669 10572002
SVN      EQU   7                                                        10573002
*                                                                       10580002
DASH     EQU   C'-'                                               19084 10700001
COMMA    EQU   C','                                               19084 10800001
FOXES    EQU   X'FF'                                              19084 10900001
FOXZERO  EQU   X'F0'                                              19084 11000001
NONE     EQU   X'00'                   NO Z FIELD                 21002 11100001
JUSTA    EQU   C'A'                    NO END OF AREA FIELD       21002 11200001
ZONEBIT  EQU   X'0F'                   UNPACK CONSOLE ID          21002 11400001
LOWORDR  EQU   8                  SHIFT MLWTO TO HI ORDER BITS    21002 11500001
EIT      EQU   8                       LENGTH OF ELINE            21002 11550001
BLNK   EQU     X'40'                   BLANK                      21002 11600001
ELEVEN   EQU   11                                                 21002 11800001
TEN      EQU   10                                                 21002 11900001
DISPLAY1 EQU   C'Z'                    CHARACTER Z FOR MESSAGE    21002 12100001
DISPLAY2 EQU   C','                    COMMA FOR AREA FIELD       21002 12200001
DISPLAY3 EQU   C'A'                    CHARACTER A FOR MSG        21002 12300001
DISPLAY4 EQU   C'-'                    DASH SEPARATOR FOR MSG     21002 12400001
*                                                                 19084 12500001
*        LENGTH AND SHIFT EQUATES                                 19084 12600001
SHIFT1   EQU   1                                                  19084 12700001
GRPX     EQU   X'FF'                   GRAPHICS INDICATOR         21002 12750001
*                                                                 19084 12800001
RI       EQU   X'80'                                           @ZM30445 12850003
         EJECT                                                    19084 12900001
*********************************************************************** 12950002
*                                                                Y02669 12960002
*        CONSOLE MESSAGE PROCESSOR                               Y02669 12970002
*                                                                Y02669 12980002
*********************************************************************** 12990002
*                                                                Y02669 12992002
         SPACE 3                                                        12994002
         BALR  R3,ZERO                                            19084 13000001
         USING *,R3                                               19084 13100001
         MODID BR=YES                                            Y01886 13150001
         USING XSA,R2                                             19084 13200001
         USING CMESSAGE,R12        ADDRESS MSG AREA               19084 13300001
*                                                                Y02669 13350002
         STM   R0,R15,ZERO(R13)                                  Y02669 13360002
*  AS OF NOW THE FOLLOWING REGISTERS HAVE THE FOLLOWING CONTENT  Y02669 13362002
*  R0  = COMPOSITE (O-UNIT) UCME PTR OR IS 0                     Y02669 13364002
*  R1  = MSG AREA POINTER                                        Y02669 13366002
*  R2  = DUMMY XSA POINTER                                       Y02669 13368002
*  R4  = CURRENT PROCESS BITS                                    Y02669 13368402
*  R5  = UNIT OR I-UNIT (IF COMP) UCME POINTER                   Y02669 13368802
*  R9  = CURRENT UNITNAME POINTER                                Y02669 13369202
*  R11 = HCPY INDICATOR OR 0 IF NONE REQUIRED                    Y02669 13369602
*  R12 = MSG AREA POINTER = R1                                   Y02669 13369702
*  R13 = SAVE AREA POINTER                                       Y02669 13369802
*  R14 = RETURN ADDRESS                                          Y02669 13376602
*                                                                Y02669 13379902
         LR    R14,R0              SAVE COMPOSITE SWITCH         Y02669 13400002
         L     R10,CVTPTR                                         19084 13500001
         USING XCVT,R10                                           19084 13600001
         L     R10,CVTCUCB         GET PTR TO UCM                 19084 13700001
         DROP  R10                                                19084 13800001
         USING UCM,R10                                           Y02669 13900002
         USING UCMLIST,R5                                         19084 14000001
*********************************************************************** 14100001
*          CONSOLE ID AND DISPLAY AREA ID                        21002* 14200001
*********************************************************************** 14300001
         LTR   R14,R14                 IS THIS A COMPOSITE CONSL Y02669 14320002
         BZ    NOCOMP                  NO                         21002 14340001
         LR    R5,R14                  USE UCME FOR COMPOSITE    Y02669 14360002
NOCOMP   EQU   *                                                  21002 14380001
*                                                                       14390002
*  REG5  HAS UCME POINTER TO UNIT AS PASSED BY 4803D OR                 14392002
*        UCME POINTER OF THE O-UNIT OF A COMP IF THIS IS A COMP         14394002
*                                                                       14396002
         SR    R8,R8              CLEAR REGISTER FOR CONSOLE ID   21002 14400001
         IC    R8,UCMID                CONSOLE ID                 21002 14500001
         CVD   R8,XMSGWK+FOR           CONVERT TO DECIMAL         21002 14600001
         OI    XMSGWK+ELEVEN,ZONEBIT                              21002 14700001
         UNPK  XMSGID(TRE),XMSGWK+TEN(TWO)                        21002 14800001
         MVI   XMSGID,BLNK         BLANK OUT FIRST BYTE OF AREA   21002 14900001
         SPACE                                                          15000001
*********************************************************************** 15050001
* IF XAX + 3 CONTAINS A X'FF' THERE IS AN AREA FIELD.  AT LEAST   21002 15060001
* ONE CONSOLE BEING VARIED IS A GRAPHICS CONSOLE.  IF THIS UNIT  21002* 15070001
* IS NOT A GRAPHICS CONSOLE, THE FIELD REMAINS BLANK.            21002* 15080001
*********************************************************************** 15090001
         SPACE                                                          15092001
         CLI   XAP+TRE,GRPX            IS THIS CONSOLE GRAPHICS  Y02669 15094002
         BNE   NOGRPX                  NO, NO AREA FIELD          21002 15096001
         TM    UCMDISP,UCMDISPC        IS THIS CONSOLE GRAPHICS   21002 15100001
         BNO   RTCDE                   BLANK AREA FIELD           21002 15200001
         TM    UCMDISP,UCMDISPG        GRPX STATUS DISPLAY ONLY   21002 15300001
         BO    CKAREA                  YES, NO Z IN AREA FIELD    21002 15400001
         MVI   XMSGDID,DISPLAY1        MOVE IN Z FOR MSG AREA     21002 15500001
CKAREA   EQU   *                                                  21002 15600001
         L     R8,UCMXB                ADDRESS OF DCM             21002 15700001
         USING DCMRDST,R8                                         21002 15800001
         CLI   DCMTOPAR,NONE           IF THERE IS A ZERO         21002 15900001
         BE    RTCDE                   NO A FIELD                 21002 16000001
         TM    UCMDISP,UCMDISPG        SHOULD COMMA BE INSERTED   21002 16100001
         BO    NOZ                     NO, NO Z FIELD             21002 16200001
         MVI   XMSGDID+ONE,DISPLAY2    MOVE IN COMMA              21002 16300001
NOZ      EQU   *                                                  21002 16400001
         MVI   XMSGDID+TWO,DISPLAY3    MOVE IN BEGINNING OF DISPLAY     16500001
* THE PREVIOUS STATEMENT WAS ADDED FOR SDS                        21002 16600001
         CLI   DCMTOPAR,JUSTA          IF THERE IS AN A           21002 16700001
         BE    RTCDE                   NO END OF AREA FIELD       21002 16800001
         MVI   XMSGDID+TRE,DISPLAY4    MOVE IN SEPARATOR          21002 16900001
         MVC   XMSGDID+FOR(ONE),DCMTOPAR       INSERT END FIELD   21002 17000001
         DROP  R8                                                 21002 17100001
         B     RTCDE                   DSECT POINTER IS RIGHT     21002 17200001
NOGRPX   EQU   *                                                  21002 17300001
         SH    R12,AREAOFS             CORRECT OFFSET INTO MSG DSECT    17400001
*    THE PREVIOUS STATEMENT WAS ADDED FOR SDS                     21002 17500001
RTCDE    EQU   *                                                  21002 17600001
         TM    XARESV,XACRT2    IS THIS A RETURN FROM IEE4803D @Z30LPTJ 17700003
*     THE PREVIOUS STATEMENT WAS ADDED FOR SDS                    21002 17800001
         BO    CRT2                    YES, BRANCH TO CRT2       Y02669 17900002
*********************************************************************** 18000001
*                                                                 19084 18100001
*        ROUTING CODE  DETERMINATION                              19084 18200001
*                                                                 19084 18300001
*********************************************************************** 18400001
*                                                                 19084 18500001
CRTCHK   EQU   *                                                  19084 18600001
         LH    R6,UCMRTCD          ASSUME 10 UNIT, PICK UP RT CODE19084 18700001
*  ROUTS ARE PICKED UP BY USING REG5 AS A POINTER TO THE UCME.   Y02669 18750002
*  R5 IS THE UCME OF THE UNIT (XXX OR O-XXX)                     Y02669 18800002
*  OR THE UCME OF THE O-UNIT IF THIS IS A COMPOSITE.             Y02669 18850002
*                                                                 19084 19500001
CRT2     EQU   *                                                  19084 19600001
          SPACE 10                                                      19650002
**************************************************               Y02651 19652002
*                                                                Y02651 19652402
*  LOCKS ARE NO LONGER NEEDED AND THEY MUST BE RELEASED. VERY    Y02651 19652802
*  SHORTLY A WTO MACRO WILL BE ISSUED.                           Y02651 19653202
*  THESE LOCKS WERE OBTAINED AT CSETLOCK IN MODULE IEE4803D      Y02651 19653602
*                                                                Y02651 19653702
UNSTLOCK EQU   *                                                 Y02651 19653802
         LR    R7,R13             SAVE AREA POINTER              Y02651 19653902
         STM   R11,R14,D68(R7)    SAVE SETLOCK REGS              Y02651 19665402
         SETLOCK  RELEASE,TYPE=CMS,RELATED=(IEE4803D(CSETLOCK))  Y02651 19675402
         SETLOCK  RELEASE,TYPE=LOCAL,RELATED=(IEE4803D(CSETLOCK))       19675802
         LM    R11,R14,D68(R7)                                   Y02651 19676202
**************************************************               Y02651 19677002
         SPACE 10                                                       19688502
         NI    XARESV,FOXES-XACRT2     TURN OFF BRANCH BIT     @Z30LPTJ 19700003
         LTR   R6,R6               ANY                            19084 19800001
         BZ    CNONERT             NO, ROUT IS -NONE-             19084 19900001
         CH    R6,CRTALL           ALL                            19084 20000001
         BE    CROUTALL            YES, ROUT IS -ALL-             19084 20100001
*                                                                 19084 20200001
*        PROCESS INDIVIDUAL ROUTCODES                             19084 20300001
*                                                                 19084 20400001
*        R5 HAS PTR TO UNTS UCME OR O-UNT'S UCME IF THIS IS COMP Y02669 20500002
*        R6 HAS ROUTCODES                                         19084 20600001
*        R4 HAS XAR PROCESS BITS                                  19084 20700002
*        R14 HAS THE COMPOSITE UCME PTR OR IS 0                  Y02669 20850002
*        R10 PTS TO UCM                                           19084 20900001
*        R11 HAS INDICATION FOR HCPY MSG                          19084 21000001
*        R12 HAS ADDRESSABILITY FOR MSG AREA                      19084 21100001
*                                                                 19084 21400001
*                                                                 19084 21500001
CRTIND   EQU   *                                                  19084 21600001
         SLL   R6,FIFTN            SHIFT ROUTS OVER               19084 21700001
         LA    R7,CTABLE           R7 PTS TO COMPARE TAB          19084 21800001
         LA    R1,XMSGWK           R1 PTS TO WORK AREA            19084 21900001
         CLI   XAP+TRE,GRPX           IS THERE A GRAPHICS CONSOLEY02699 22000002
         BE    GRPX11                  YES, PTR IS TO WORD BOUND  21002 22100001
         LA    R1,ONE(R1)              PTR TO WORD BOUNDARY       21002 22200001
GRPX11   EQU   *                                                  21002 22300001
NEXT     EQU   *                                                  19084 22400001
         SLL   R6,SHIFT1           SHIFT TO HIGH ORDER            19084 22500001
         LTR   R6,R6               IS IT ON                       19084 22600001
         BZ    NOMORE              NO, NOMORE                     19084 22700001
         BNM   NEXT1               NOT THIS ONE                   19084 22800001
         MVC   ZERO(TWO,R1),ZERO(R7)    YES, MOVE ROUT TO WORK ARE19084 22900001
         LA    R1,TWO(R1)          INDEX TO NEXT FREE SPACE       19084 23000001
NEXT1    EQU   *                                                  19084 23100001
         LA    R7,TWO(R7)          INDEX TO NEXT ROUT IN TAB      19084 23200001
         B     NEXT                GO THECK NEXT ROUT CODE        19084 23300001
*                                                                 19084 23400001
NOMORE   EQU   *                                                  19084 23500001
         MVI   ZERO(R1),FOXES      SET END DELIMITER              19084 23600001
         LA    R1,XMSGRTCD         ROUT AREA IN MSG               19084 23700001
         LA    R7,XMSGWK           WORK AREA                      19084 23800001
         CLI   XAP+TRE,GRPX           IS THERE A GRAPHICS CONSOLEY02669 23900002
         BE    GRPX22                  YES, PTR IS TO WORD BOUND  21002 24000001
         LA    R7,ONE(R7)              PTR TO WORD BOUNDARY       21002 24100001
GRPX22   EQU   *                                                  21002 24200001
         MVC   ZERO(TWO,R1),ZERO(R7)    MOVE OVER TO MSG          19084 24300001
         CLI   ZERO(R7),FOXZERO    ONE DIGIT                      19084 24400001
         BNE   MOVED                    NO, OK                    19084 24500001
         MVC   ZERO(ONE,R1),ONE(R7)     YES, ELIMINATE LEADING ZER19084 24600001
         BCTR  R1,ZERO                                            19084 24700001
MOVED    EQU   *                                                  19084 24800001
         LA    R1,TWO(R1)          INDEX PAST ROUT                19084 24900001
ENDCHK   EQU   *                                                  19084 25000001
         CLI   TWO(R7),FOXES       END OF WORK                    19084 25100001
         BE    CISSUE              YES GO ISSUE MSG               19084 25200001
         MVI   ZERO(R1),COMMA      NO, DELIMIT ROUT               19084 25300001
         LH    R8,ZERO(R7)                                        21002 25400001
         MVC   ONE(TWO,R1),TWO(R7) MOVE IN NEXT ROUT INTO MSG     19084 25500001
         CH    R8,TAB09                WAS ROUT A 09              21002 25600001
         BNE   ENDCHK3             NO, GO ADD ONE                 19084 25700001
         AH    R8,FOX7                 YES, ADD SPECIAL ALGORITHM 21002 25800001
         B     ENDCHK5             GO CHECK IF                    19084 25900001
*                                                                 19084 26000001
ENDCHK3  EQU   *                                                  19084 26100001
         AH    R8,HONE                 PLUS ONE                   21002 26200001
ENDCHK5  EQU   *                                                  19084 26300001
         LA    R7,TWO(R7)                                         19084 26400001
         CH    R8,ZERO(R7)             IS LINE ROUTS              21002 26500001
         BE    SLASH1               YES, DELIMIT WITH A DASH      19084 26600001
ENDSLASH EQU   *                                                  19084 26700001
         CLI   ONE(R1),FOXZERO     NO, IS IT ONE DIGIT           Y02669 26800002
         BE    MOVEOVER            YES, GET RID OF LEADING F0     19084 26900001
         LA    R1,ONE(R1)                                         19084 27000001
CONT     EQU   *                                                  19084 27100001
         LA    R1,TWO(R1)          INDEX TO NEXT FREE SPACE       19084 27200001
         B     ENDCHK              GO CHECK ENDINGS               19084 27300001
MOVEOVER EQU   *                                                  19084 27400001
         MVC   ONE(ONE,R1),TWO(R1) MOKE IT A SINGLE DIGIT         19084 27500001
         B     CONT                CONTINUE                       19084 27600001
SLASHRTN EQU   *                                                  19084 27700001
         LA    R7,TWO(R7)          INDEX TO NEXT DIGIT IN WORK    19084 27800001
         CLI   TWO(R7),FOXES       END                            19084 27900001
         BE    SLASH6              YES, GO MAKE FINAL PROCEDURES  19084 28000001
SLASH1   EQU   *                                                  19084 28100001
         MVI   ZERO(R1),DASH       MOVE IN A DASH                 19084 28200001
         CH    R8,TAB09                ROUT IS 09                 21002 28300001
         BNE   SLASH2              NO                             19084 28400001
         AH    R8,FOX7                 YES, ADD SPECIAL ALGORITHM 21002 28500001
         B     SLASH4              GO CHECK                       19084 28600001
SLASH2   EQU   *                                                  19084 28700001
         AH    R8,HONE                 PLUS ONE                   21002 28800001
SLASH4   EQU   *                                                  19084 28900001
         CH    R8,TWO(R7)              EQUAL                      21002 29000001
         BE    SLASHRTN            YES, GO CHECK END              19084 29100001
SLASH6   EQU   *                                                  19084 29200001
         MVC   ONE(TWO,R1),ZERO(R7)     NO,MOVE IN LAST ROUT CODE 19084 29300001
         B     ENDSLASH            GO CHECK END                   19084 29400001
*                                                                 19084 29500001
*                                                                 19084 29600001
CNONERT  EQU   *                                                  19084 29700001
         MVC   XMSGRTCD(FOR),CNONE      MOVE IN NONE              19084 29800001
         LA    R1,XMSGRTCD+FOR          INDEX TO END              19084 29900001
         B     CISSUE                   GO ISSUE                  19084 30000001
*                                                                 19084 30100001
CROUTALL EQU   *                                                  19084 30200001
         MVC   XMSGRTCD(TRE),CALL       MOVE IN ALL               19084 30300001
         LA    R1,XMSGRTCD+TRE          INDEX TO END              19084 30400001
*                                                                 19084 30500001
         EJECT                                                    19084 30600001
CISSUE   EQU   *                                                  19084 30700001
         L     R0,XAP                  GET MLWTO ID              Y02669 30750002
         IC    R0,XAU                  CONSOLE ID                 21002 31200001
         TM    XAU,RI               IS THIS FROM INPUT STREAM? @ZM30445 31220003
         BNO   XAUIN1               NO, AVOID NEXT INSTRUCTION @ZM30445 31240003
         IC    R0,ZEROZERO        YES, INDICATE MASTER CONSOLE @ZM30445 31260003
XAUIN1   EQU   *                                               @ZM30445 31280003
*        REG0 CONTAINS THE MLWTO ID IN THE THREE HIGH ORDER BYTES 21002 31300001
*        AND THE CONSOLE ID IN THE LOW ORDER BYTE                 21002 31400001
         CLI   XAP+TRE,GRPX            GRAPHICS INDICATOR SET    Y02669 31500002
         BE    GRPXH                   YES                        21002 31600001
         AH    R12,AREAOFS             RESET PTR TO MSG DSECT     21002 31700001
GRPXH    EQU   *                                                  21002 31800001
*********************************************************************** 31810001
* A DATA LINE IS ISSUED.  THEN A CHECK MADE TO SEE IF ANY MORE   21002* 31820001
* UNITS EXIST (R4 IS NOT ZERO).  IF THERE ARE MORE UNITS, RETURN 21002* 31830001
* IS MADE TO IEE4803D.  IF THERE ARE NO MORE UNITS, A TEST IS MAD21002* 31840001
* TO SEE IF ONE OF THE UNITS WAS THE HARDCOPY DEVICE (R11 WILL CONTAIN* 31842001
* THE ADDRESS OF A UCME).  IF THERE WAS A HARDCOPY UNIT, RETURN Y02669* 31844002
* TO IEE4803D.  OTHERWISE AN END LINE IS ISSUED AND CONTROL RETURNED  * 31846001
* TO THE COMMUNICATION TASK.                                     21002* 31848001
*********************************************************************** 31849701
         SPACE                                                          31849801
         MVC   ZERO(FOR,R12),DLINE       MCSFLAGS                 21002 32600001
         MVC   ZERO(FOR,R1),DLINE+FIV     LINE TYPE AND LINE NO   21002 32700001
         SR    R1,R12                  CALCULATE LENGTH OF        21002 32800001
         STC   R1,ONE(R12)             PUT LENGTH IN MSG          21002 32900001
         LR    R1,R12                  ADDRESS OF MESSAGE         21002 33000001
         WTO   MF=(E,(1))          ISSUE MSG                      19084 33100001
*                                                                 19084 33200001
         SLL   R1,LOWORDR              MLWTO IN THREE HI ORDER BYT21002 33210001
         IC    R1,XAP+TRE              GET GRAPHICS INDICATOR    Y02669 33220002
         ST    R1,XAP                  SAVE  NEWMLWTO ID         Y02669 33250002
         SLL   R4,SHIFT1               THIS UNIT WAS PROCESSED    21002 33252001
         LTR   R4,R4                   ANY MORE UNITS TO PROCESS  21002 33260001
         BNZ   CEXIT                   MULTIPLE UNITS             21002 33294001
         LTR   R11,R11                 HARDCOPY LINE NEEDED       21002 33296001
         BNZ   CEXIT                   YES, RETURN TO 4803D       21002 33298001
         SPACE 10                                                 19084 33300001
RETURN   EQU   *                                                  21002 33650001
         L     R0,XAP                  GET MLWTO ID              Y02669 33652002
         IC    R0,XAU                  GET CONSOLE ID             21002 33656001
         TM    XAU,RI               IS THIS FROM INPUT STREAM? @ZM30445 33656803
         BNO   XAUIN2               NO, AVOID NEXT INSTRUCTION @ZM30445 33657603
         IC    R0,ZEROZERO        YES, INDICATE MASTER CONSOLE @ZM30445 33658403
XAUIN2   EQU   *                                               @ZM30445 33659203
         MVC   ZERO(EIT,R12),ELINE     END LINE                   21002 33660001
         LR    R1,R12                  ADDRESS OF BUFFER          21002 33670001
         WTO   MF=(E,(1))                                         21002 33680001
         SPACE 10                                                       33690002
***************************************************              Y02651 33692002
*  THIS IS A TERMINAL EXIT AND THEREFORE THE ENQ ISSUED IN       Y02651 33692402
*  MODULE IEE3603D WILL BE RELEASED VIA A DEQ ISSUED HERE        Y02651 33692802
*                                                                Y02651 33693202
CDEQUE   EQU   *                                                 Y02651 33693602
         DEQ   MF=(E,IEFDEQUE)                                   Y02651 33693702
***************************************************              Y02651 33694002
         SPACE 10                                                       33696002
         LR    R1,R12                   PTR TO MSG AREA IN 1      19084 33700001
         FREEMAIN R,LV=96,A=(1),SP=229                           Y02669 33800002
         L     R1,D64(R13)         GET CSCB PTR                  Y02669 33850002
         USING CHAIN1,R1                                         Y02669 33860002
         OI    CHSTS,CHFC          SET TO FREE SCB               Y02669 33870002
         MGCR  (1),CHAIN                                         Y02669 33880002
         LM    R0,R15,ZERO(R13)    RESTORE REGS                  Y02669 33890002
         LR    R4,R14              SAVE RETURN ADDRESS           Y02669 33892002
*                                  FREE SAVE AREA GOTTEN IN 3303DY02669 33898402
         LR    R1,R2               PRT TO DUMMY XSA              Y02669 33898802
         LA    R0,D132             SIZE OF DUMMY XSA             Y02669 33899202
         FREEMAIN R,LV=(0),A=(1)                                 Y02669 33899602
*                                  FREEMAIN DUMMY XSA            Y02669 33899702
         LR    R14,R4              RESTORE RETURN REG            Y02669 33899802
         BR    R14                      RETURN                    19084 33900001
         EJECT                                                    19084 34000001
CEXIT    EQU   *                                                  21002 34100001
         OI    XARESV,XACENDCK       INDICTE BRANCH TO CENDCHK @Z30LPTJ 34200003
         MVC   XAX+TRE(TWO),EXITNAME     NAME OF 4803D           Y02669 34550002
         LM    R0,R15,ZERO(R13)                                  Y02669 34600002
         L     R15,VCON48          GET ADDRESS OF 4803D          Y02669 34650002
         BR    R15                                               Y02669 34700002
         SPACE                                                          35100002
*                                                                Y02669 35150002
*  AS OUTPUT THE REGISTER ARE IN THE FOLLOWING STATUS:           Y02669 35160002
*  R0  = POINTER TO THE JUST PROCESSED O-UCME OF 0 IF NON-COMP   Y02669 35170002
*  R1  = MSG CORE POINTER                                        Y02669 35180002
*  R2  = DUMMY XSA POINTER                                       Y02669 35190002
*  R4  = CURRENT PROCESS BITS                                    Y02669 35192002
*  R5  = POINTER TO JUST PROCESSED UNIT OR I-UNIT UMCE IF COMP   Y02669 35194002
*  R9  = POINTER TO CURRENT UNIT NAME                            Y02669 35196002
*  R11 = HCPY INDICATOR OR 0                                     Y02669 35198002
*  R12 = MSG AREA POINTER                                        Y02669 35198402
*  R13 = SAVE AREA POINTER                                       Y02669 35198802
*  R14 = RETURN ADDRESS                                          Y02669 35199202
*                                                                Y02699 35199602
         EJECT                                                          35199702
**************************************************               Y02651 35199802
*  THE LIST FORM OF THE DEQ MACRO FOLLOWS:                       Y02651 35224802
*                                                                Y02651 35234802
IEFDEQUE DEQ   (IEFSQCBS,IEFQ4QCB,TWO,SYSTEM,IEFSQCBS,IEFVQCBS,SVN,    *35244802
               SYSTEM),RET=HAVE,MF=L                           @YM5443P 35245402
IEFVQCBS DC    C'VARYDEV'                                               35246002
IEFSQCBS DC    C'SYSIEFSD'                                       Y02651 35246802
IEFQ4QCB DC    C'Q4'                                             Y02651 35248802
**************************************************               Y02651 35250002
         EJECT                                                          35275002
*********************************************************************** 35300001
*                                                                 19084 35400001
*        DECLARE AREA FOR MODULE                                  19084 35500001
*                                                                 19084 35600001
*********************************************************************** 35700001
*                                                                 19084 35800001
         DS    0F                                                Y02669 35850002
VCON48   DC    V(IEE4803D)                                       Y02669 35860002
EXITNAME DC    C'48'                                             Y02669 35900002
CNONE    DC    C'NONE'             NO CMD AUTH OR NO ROUTS        19084 36000001
SYSLOG   DC    C'SYSLOG'           SEE IF CONSOLE ID IS NEEDED.   21002 36050001
CRTALL   DC    X'FFFF'             ALL ROUTS                      19084 36100001
FOX7     DC    X'00F7'             ..                             19084 36300001
HONE     DC    X'0001'             ..                             19084 36400001
CALL     DC    C'ALL'              ALL ROUT AND CMD AUTH          19084 36500001
ZEROZERO DC    X'00'                                           @ZM30445 36550003
ELINE    WTO   (' ',E),MF=L                                       21002 36600001
DLINE    WTO   (' ',D),MF=L                                       21002 36700001
AREAOFS  DC    H'7'                    CORRECTION FOR MSG DSECT   21002 36800001
         EJECT                                                          36900001
*********************************************************************** 37000001
         DS    0H                                                 19084 37100001
CTABLE   DC    C'01'               ROUTCODE COMPARE TABLE         19084 37200001
         DC    C'02'                      ---**---                19084 37300001
         DC    C'03'                      ---**---                19084 37400001
         DC    C'04'                      ---**---                19084 37500001
         DC    C'05'                      ---**---                19084 37600001
         DC    C'06'                      ---**---                19084 37700001
         DC    C'07'                      ---**---                19084 37800001
         DC    C'08'                      ---**---                19084 37900001
*********************************************************************** 38000001
TAB09    DC    C'09'                      ---**---                19084 38100001
         DC    C'10'                      ---**---                19084 38200001
         DC    C'11'                      ---**---                19084 38300001
         DC    C'12'                      ---**---                19084 38400001
         DC    C'13'                      ---**---                19084 38500001
         DC    C'14'                      ---**---                19084 38600001
         DC    C'15'                      ---**---                19084 38700001
         DC    C'16'                      ---**---                19084 38800001
*                                                                 19084 38900001
         SPACE 5                                                        38950002
PATCH    DC    CL50'***IEE7303D***'                                     38960003
*                                                                       38970002
         EJECT                                                    19084 39000001
CMESSAGE DSECT                                                    19084 39100001
XTEXT    DS    1F                      HEADER FIELD               21002 39200001
*                                                                 19084 39300001
*                                                                 19084 39400001
XUNIT1   DS    CL3                 1ST PHUSICAL UNIT ADDRES       19084 39500001
XBLANK   DS    CL1                 COMMA                          19084 39600001
XUNIT2   DS    CL3                                                19084 39700001
XCOMMA   DS    CL1                                                19084 39800001
XAUNIT1  DS    CL3                                                19084 39900001
XBLK     DS    CL1                                                19084 40000001
XAUNIT2  DS    CL3                                                19084 40100001
XMSGPAD1 DS    CL1                                                19084 40200001
XMSGSTAT DS    CL4                                                19084 40300001
XMSGPAD2 DS    CL1                                                19084 40400001
XMSGAUTH DS    CL1                                                19084 40500001
XMSGPAD3 DS    CL7                     BLANKS                     21002 40600001
XMSGID   DS    CL3                     CONSOLE ID                 21002 40700001
XMSGPAD4 DS    CL1                     BLANK                      21002 40800001
XMSGDID  DS    CL5                     DSIPLAY AREA ID            21002 40900001
XMSGPAD5 DS    CL2                     BLANKS                     21002 41000001
XMSGRTCD DS    CL8                                                19084 41100001
XMSGWK   DS    CL30                                               19084 41200001
*                                                                 19084 41300001
         EJECT                                                          41400001
CXSA     DSECT                                                          41500001
         IEEXSA                                                         41600001
         EJECT                                                          48800001
DCMRDST  DSECT                                                          48900001
         IEECRDCM                                                       49000001
         EJECT                                                          49100001
XCVT     DSECT                                                          49200001
         CVT                                                            49300001
         EJECT                                                          49400001
XUCM     DSECT                                                          49500001
         IEECUCM    FORMAT=NEW                                          49600002
         EJECT                                                          49650002
CHAIN1   DSECT                                                          49660002
         IEECHAIN                                                       49700002
         EJECT                                                          49750002
         IHAPSA                                                         49800002
         END                                                            50000001
