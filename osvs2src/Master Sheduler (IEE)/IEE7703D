         TITLE 'IEE7703D SVC 34 K V COMMAND '                           01200002
*********************************************************************** 02200001
*                                                                     * 02250002
*   MODULE NAME         =      IEE7703D                         Y02669* 02300002
*                                                                     * 02350002
*   DESCRIPTIVE NAME    =      CONTROL VARY (K V) COMMAND       Y02669* 02360002
*                              PROCESSOR                        Y02669* 02362002
*                                                                     * 02370002
*   COPYRIGHT           =      N/A                              Y02669* 02380002
*                                                                     * 02390002
*   STATUS              =      01 - UPDATE FOR VS/2 RELEASE 2   Y02669* 02392002
*                                                                     * 02394002
*   FUNCTION            =      TO VALIDITY CHECK AND PROCESS    Y02669* 02396002
*                              THE K V (CONTROL VARY) COMMAND.  Y02669* 02396102
*                                                                     * 02397202
*      OPERATION        =      THE COMMAND IS FIRST VALIDITY    Y02669* 02398002
*                              CHECKED:  K  V,USE=              Y02669* 02398102
*                              IF INVALID 'IEE156I INVALID      Y02669* 02398202
*                              OPERAND' IS ISSUED.              Y02669* 02399402
*                              THEN THE PARAMETERS ARE          Y02669* 02399802
*                              PROCESSED:                       Y02669* 02401002
*                              THE TARGET CONSOLE IS VARIED TO: Y02669* 02402402
*                               SD - MONITOR ONLY STATUS        Y02669* 02403502
*                                    DISPLAYS (RESULT OF TRACK  Y02669* 02404602
*                                    AND DISPLAY COMMANDS)      Y02669* 02405702
*                               FC - FULL CAPABILITY INPUT/     Y02669* 02407902
*                                    OUTPUT MODE                Y02669* 02409002
*                               MS - MONITOR THE DISPLAY OF     Y02669* 02409402
*                                    NORMAL OPERATOR MASSAGES   Y02669* 02411202
*                              AND THE PROPER BITS ARE SET IN   Y02669* 02411602
*                              THE UCME AND RDCM ACCORDINGLY.   Y02669* 02412602
*                                                                     * 02414202
*                              IF NECESSARY, DIDOCS IS POSTED   Y02669* 02414602
*                              TO COMPLETE THE PROCESSING.      Y02669* 02415002
*                                                                     * 02415402
*   NOTES                                                       Y02669* 02415802
*                                                                     * 02416402
*      CHARACTER CODE                                           Y02669* 02417402
*       DEPENDENCIES    =      ANY CHARACTER CODE OTHER THAN    Y02669* 02418402
*                              EBCDIC WILL REQUIRE REASSEMBLY   Y02669* 02420402
*                              OF THIS MODULE.                  Y02669* 02421402
*                              NOTE: THIS MODULE USES CHARACTER Y02669* 02422702
*                              REPRESENTATION FOR COMMA.        Y02669* 02423302
*                                                                     * 02423902
*      DEPENDENCIES     =      IEE7503D WILL VERIFY THAT ALL    Y02669* 02424702
*                              TARGET CONSOLES ARE GRAPHICS.    Y02669* 02424802
*                                                                     * 02425802
*      RESTRICTIONS     =      THE COMMAND IS INVALID IF:       Y02669* 02428102
*                              THE TARGET CONSOLE IS THE MASTER Y02669* 02429102
*                              THE TARGET CONSOLE IS A 2250     Y02669* 02430102
*                              FC ISSUED FOR OUTPUT-ONLY DEVICE Y02669* 02431602
*                              MS ISSUED WITHOUT PAPER CONSOLE  Y02669* 02432602
*                              ON-LINE                          Y02669* 02433602
*                                                                     * 02434902
*                              THE COMMAND IS APPLICABLE ONLY   Y02669* 02435902
*                              FOR A 2260 0R 3270.              Y02669* 02436902
*                                                                     * 02437902
*                              ONLY A FC CONSOLE CAN K V ITSELF Y02669* 02438902
*                              AND ONLY IF THERE WILL STILL BE  Y02669* 02439902
*                              AN INPUT CONSOLE AVAILABLE.      Y02669* 02440902
*                                                                     * 02441902
*      REGISTER                                                 Y02669* 02442902
*       CONVENTIONS     =      NONE                             Y02669* 02443902
*                                                                     * 02444902
*      PATCH-LABEL      =      PATCH                            Y02669* 02445902
*                                                                     * 02449902
*   MODULE TYPE         =      CSECT                            Y02669* 02459902
*                                                                     * 02461902
*      PROCESSOR        =      N/A                              Y02669* 02469902
*                                                                     * 02471902
*      MODULE SIZE      =      X'19D' + X'48' PATCH             Y02669* 02479902
*                                                                     * 02481902
*      ATTRIBUTES       =      REENTRANT, REFRESHABLE, KEY 0,   Y02669* 02489902
*                              SUPERVISOR MODE, PAGED LPA       Y02669* 02497002
*                                                                     * 02498202
*   ENTRY POINT         =      IEE7703D FROM IEE6703D           Y02669* 02499402
*      PURPOSE          =      TO PROCESS THE K V COMMAND       Y02669* 02500602
*                              FOR CRT DEVICES ONLY             Y02669* 02501002
*      LINKAGE          =      BRANCH                           Y02669* 02501802
*      INPUT DATA       =      REG 2 POINTS TO XSA              Y02669* 02503002
*                                XAS HAS LOCATION ROUTING INFO  Y02669* 02504202
*                                    XASCID - CONSOLE ID OR XAU Y02669* 02504602
*                                    XASDID - AREA ID           Y02669* 02505002
*                                    XASSDS5 - ON LOCKS HELD    Y02651* 02506202
*                                XAU CONTAINS ISSUING CONSOLE IDY02669* 02508802
*                                XAL POINTS TO THE OPERANDS     Y02669* 02510002
*                              REG 14 CONTAINS RETURN ADDRESS   Y02669* 02511202
*                                                                     * 02512402
*      REGISTERS SAVED  =      REG 14 IS SAVED IN XSA. (XAP)    Y02669* 02513602
*                              REGISTERS 11 - 14 ARE SAVED      Y02651* 02513902
*                              BEFORE ISSUING SETLOCK AT        Y02651* 02514202
*                              LOCKSOFF.                        Y02651* 02514502
*                                                                     * 02514802
*      REGISTER CONTENTS                                        Y02669* 02516002
*      DURING PROCESSING=      R0    WORK REG                   Y02669* 02517202
*                              R1    WORK REG                   Y02669* 02518402
*                              R2    XSA BASE REG               Y02669* 02519602
*                              R3    UNUSED                     Y02669* 02520802
*                              R4    OPERAND POINTER            Y02669* 02522002
*                              R5    UNUSED                     Y02669* 02523202
*                              R6    UNUSED                     Y02669* 02524402
*                              R7    UNUSED                     Y02669* 02525602
*                              R8    UCME BASE REG              Y02669* 02526802
*                              R9    UNUSED                     Y02669* 02528002
*                              R10   RESIDENT DCM BASE REG      Y02669* 02529202
*                              R11   UNUSED                     Y02669* 02530402
*                              R12   UCM BASE REG               Y02669* 02531602
*                              R13   MODULE BASE REG            Y02669* 02532802
*                              R14   RETURN REG                 Y02669* 02534002
*                              R15   BRANCH REG                 Y02669* 02535202
*      REGISTERS                                                Y02669* 02536402
*       RESTORED        =      R14 RESTORED AT LABEL RETURN1    Y02669* 02537602
*                              REGISTERS 11 - 14 ARE RESTORED   Y02651* 02537902
*                              AFTER ISSUING SETLOCK AT         Y02651* 02538202
*                              LOCKSOFF.                        Y02651* 02538502
*                                                                     * 02538802
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  02540002
*                                                                     * 02541202
**  EXIT - NORMAL       =      RETURN FROM RETURN1 -> RETURN    Y02669* 02542402
*      CONDITIONS       =      IF NO PROCESSING IS NECESSARY    Y02669* 02543602
*                              FOR MS OR SD, I.E. THE CONSOLE   Y02669* 02544802
*                              IS ALREADY IN THE DESIRED STATE. Y02669* 02546002
*      OUTPUT DATA      =      CMS AND LOCAL LOCKS RELEASED     Y02651* 02548202
*                              REG 2 POINTS TO XSA              Y02669* 02548602
*                                 XASSDS5 - OFF LOCKS RELEASED  Y02651* 02549002
*      RETURN CODES     =      NONE                             Y02669* 02550202
*                                                                     * 02552202
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  02552602
*                                                                     * 02553202
**  EXIT - NORMAL       =      POST DIDOCS & RETURN VIA BR R14  Y02669* 02555202
*                              FROM SETPOST -> RETURN           Y02669* 02555602
*      CONDITIONS       =      TO HAVE THE REQUEST FULFILLED    Y02669* 02557202
*                              BY DIDOCS                        Y02669* 02560202
*                              AFTER RELEASING THE LOCKS        Y02651* 02568002
*                              POST UCMECB (POSTCODE = X'FD')   Y02669* 02571002
*                              FOR DIDOCS PROCESSING AND        Y02669* 02574002
*                              RETURN VIA BR 14.                Y02669* 02577002
*      OUTPUT DATA      =      PROPER BITS SET IN UCM ENTRY TO  Y02669* 02580002
*                              INDICATE REQUESTED CONSOLE STATE Y02669* 02583002
*                                SD - UCMDISP = UCMDISPG  X'02' Y02669* 02586002
*                                               UCMDISPD  X'10' Y02669* 02589002
*                                     UCMATR = UCMIF X'40'(OFF) Y02669* 02591002
*                                     UCMSDS5 = UCMSDS5G  X'02' Y02669* 02592002
*                                MS - UCMDISP = UCMDISPF  X'04' Y02669* 02595002
*                                               UCMDISPD  X'10' Y02669* 02598002
*                                     UCMSDS5 = UCMSDS5G  X'02' Y02669* 02601002
*                                     UCMATR = UCMIF X'40'(OFF) Y02669* 02603002
*                                FC - UCMDISP = UCMDISPE  X'08' Y02669* 02604002
*                                     UCMATR = UCMIF      X'40' Y02669* 02607002
*                                     UCMDISP = UCMDISPD  (OFF) Y02669* 02609102
*                                             = UCMDISPF  (OFF) Y02669* 02609502
*                                             = UCMDISPG  (OFF) Y02669* 02609702
*                                     UCMSDS5 = UCMSDS5G  (OFF) Y02669* 02613002
*                              AND BITS SET IN DCM INDICATING   Y02669* 02616002
*                                K V COMMAND                    Y02669* 02625002
*                                     DCMR3FLG = DCMKVIP        Y02669* 02628002
*                                AND CHANGING STATUS            Y02669* 02631002
*                                     DCMR3FLG = DCMSTSWT.      Y02669* 02634002
*                                REINIT WTO HEADERS TO SYSGEN   Y02669* 02637002
*                                VALUE (HARDCOPY & JOBNAME)     Y02669* 02640002
*                                     UCMDISP2 = UCMDISPI (OFF) Y02669* 02643002
*                                                UCMDISPJ (OFF) Y02669* 02646002
*                              REG 2 POINTS TO XSA              Y02669* 02652002
*                                XASSDS5 - OFF LOCKS RELEASED   Y02651* 02655002
*      RETURN CODES     =      NONE                             Y02669* 02658002
*                                                                     * 02661002
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  02667002
*                                                                     * 02670002
**  EXIT - ERROR        =      BRANCH TO IEE5603D FROM D5603D   Y02669* 02673002
*      CONDITIONS       =      TO ISSUE MESSAGES FOR:           Y02669* 02676002
*                                INVALID OPERAND(S)             Y02669* 02679002
*                                TARGET CONSOLE MASTER OR 2250  Y02669* 02682002
*                                FC ISSUED FOR OUTPUT ONLY      Y02669* 02685002
*                                MS ISSUED WHEN NO PAPER CONSOLEY02669* 02688002
*      OUTPUT DATA      =      REG 2 POINTS TO XSA CONTAINING   Y02669* 02691002
*                              ERROR CODES FOR IEE5603D:        Y02669* 02694002
*                              XAE CONTAINS THE MESSAGE INDEX   Y02669* 02697002
*                                X'04' - IEE156I INVALID        Y02669* 02700002
*                                        OPERAND                Y02669* 02703002
*                                X'08' - IEE345I AUTHORITY      Y02669* 02706002
*                                        INVALID                Y02669* 02709002
*                                X'09' - IEE921I CM OP          Y02669* 02712002
*                                        REJECTED               Y02669* 02715002
*                                X'0C' - IEE926I L=CCA OPERAND  Y02669* 02718002
*                                        INVALID                Y02669* 02721002
*                              XASTSAVE  CONTAINS THE SECONDARY Y02669* 02724002
*                                        THE MESSAGE INDEX      Y02669* 02727002
*                                X'1C' - DEVICE NOT SUPPORTED   Y02669* 02730002
*                                        (IEE921I)              Y02669* 02733002
*                                X'1D' - OUTPUT ONLY            Y02669* 02736002
*                                        (IEE926I)              Y02669* 02739002
*                              XAS CONTAINS TARGET INFO (INPUT) Y02669* 02745002
*                                XASSDS5 - STILL ON LOCKS HELD  Y02651* 02748002
*      RETURN CODES     =      NONE                             Y02669* 02751002
*                                                                     * 02754002
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  02757002
*                                                                     * 02760002
*   EXTERNAL                                                    Y02669* 02763002
*    REFERENCES                                                 Y02669* 02766002
*                                                                     * 02769002
*      ROUTINES         =      POSTS DIDOCS                     Y02669* 02772002
*                              BRANCHES TO IEE5603D             Y02669* 02775002
*                                                                     * 02777002
*      DATA AREAS       =      NONE                             Y02669* 02781002
*                                                                     * 02784002
*      CONTROL BLOCKS   =      CVT      R - ADDRESS UCM         Y02669* 02787002
*                              IEEXSA   R - PARM LIST & L=CCA   Y02669* 02790002
*                                       W - ERR MESSAGE CODES   Y02669* 02793002
*                              IEECUCM  R - CONSOLE STATUS      Y02669* 02796002
*                                       W - CHANGED STATUS BITS Y02669* 02799002
*                              IEERDCM  R - CONSOLE DEVICE TYPE Y02669* 02802002
*                                       W - SHOW K V & CHANGE   Y02669* 02805002
*                              IHAPSA   NECESSARY FOR SETLOCK   Y02651* 02808002
*                                                                     * 02810402
*      TABLES           =      NONE                             Y02669* 02814002
*                                                                     * 02817002
*      MACROS           =      MODID                            Y02669* 02823002
*                              POST UCMECB POSTCODE X'FD'       Y02669* 02826002
*                              SETLOCK - CMS AND LOCAL RELEASED Y02651* 02829002
*                                                                     * 02832002
*      ENQUEUE RESOURCES=      NONE                             Y02669* 02838002
*                                                                     * 02841002
*      LOCKS HELD       =      LOCKS OBTAINED IN IEE7503D ARE   Y02651* 02844002
*                              RELEASED BEFORE POSTING DIDOCS   Y02651* 02847002
*                              AT SETPOST OR BEFORE RETURNING   Y02651* 02850002
*                              AT RETURN1.                      Y02651* 02853002
*                                                                     * 02856002
*      CHANGE LEVEL     =      Y02669                           Y02669* 02859002
*                              Y02651                           Y02651* 02862002
*                              YM1915                           YM1915* 02863002
*                                                                     * 02865002
*   MESSAGES            =      THE FOLLOWING MESSAGES ARE       Y02669* 02868002
*                              CONTAINED IN AND ISSUED FROM     Y02669* 02868602
*                              IEE5603D AND IEE5903D:           Y02669* 02869202
*                                                                     * 02869802
*                               MSGID  CODE  IN MESSAGE TEXT    Y02669* 02870402
*                               _____  ____  __ _______ ____    Y02669* 02871002
*                              IEE156I X'04' 56 INVALID OPERAND Y02669* 03271002
*                              IEE345I X'08' 56 AUTHORITY       Y02669* 03671002
*                                                 INVALID       Y02669* 04071002
*                              IEE921I X'09' 56 REJECTED        Y02669* 04471002
*                                      X'1C' 59 DEVICE NOT      Y02669* 04871002
*                                                 SUPPORTED     Y02669* 05271002
*                              IEE926I X'0C' 56 L OPERAND       Y02669* 05671002
*                                                 INVALID       Y02669* 06071002
*                                      X'1D' 59 'CC' OUTPUT     Y02669* 06471002
*                                                 ONLY          Y02669* 06871002
*                                                                     * 07271002
*   SYSGEN              =      INCLUDED WITH SVC 34 IN LOAD     Y02669* 07671002
*                              MODULE IGC0003D, DLIB AOSB3,     Y02669* 08071002
*                              MACRO SGIEF441, TARGLIB LPALIB   Y02669* 08471002
*                                                                     * 08871002
*   SYSTEM LIBRARIES    =      NONE                             Y02669* 09271002
*                                                                     * 09671002
*********************************************************************** 10071002
         EJECT                                                          10471002
IEE7703D CSECT                                                          10871002
*********************************************************************** 12400001
*                                                                     * 12600002
*                        REGISTERS                                    * 12800002
*                                                                     * 13000002
*********************************************************************** 13200001
R0       EQU   0                   WORK REG                             13250002
R1       EQU   1                   WORK REG                             13300002
PARMREG  EQU   2                   XSA BASE REG                         13350002
R3       EQU   3      (UNUSED)     UNUSED                        Y02669 13360002
KOPS     EQU   4                   OPERAND POINTER                      13400002
R5       EQU   5      (UNUSED)     UNUSED                        Y02669 13450002
R6       EQU   6      (UNUSED)     UNUSED                        Y02669 13500002
R7       EQU   7      (UNUSED)     UNUSED                        Y02669 13550002
UCMEBASE EQU   8                   UCM EMTRY BASE REG                   15150002
R9       EQU   9      (UNUSED)     UNUSED                        Y02669 15152002
RDCMBASE EQU   10                  RESIDENT DCM BASE REG                15160002
R11      EQU   11     (UNUSED)     UNUSED                        Y02669 15170002
UCMBASE  EQU   12                  UCM BASE REG                         15180002
MYBASE   EQU   13                  MODULE BASE REG                      15190002
RE       EQU   14                  RETURN REG                           16800002
R15      EQU   15                  BRANCH REG                           16850002
         EJECT                                                          16860002
*********************************************************************** 16900002
*                                                                     * 17200002
*                 ERROR MESSAGE FLAG BIT SETTINGS                     * 17300002
*                                                                     * 17400002
*********************************************************************** 17650002
IEE156I  EQU   X'04'               IEE156I INVALID OPERAND              18000002
IEE345I  EQU   X'08'               IEE345I INVALID AUTHORITY            18050002
IEE921I  EQU   X'09'               IEE921I REJECTED                     18600002
ERR28    EQU   X'1C'                       DEVICE NOT SUPPORTED         18610002
IEE926I  EQU   X'0C'               IEE926I L OPERAND INVALID            18650002
ERR29    EQU   X'1D'                       CC OUTPUT ONLY               18700002
*********************************************************************** 19000002
*                                                                     * 19050002
*                 DISPLACEMENTS AND INCREMENTS                        * 19100002
*                                                                     * 19150002
*********************************************************************** 19200002
N0       EQU   0                   FIELD INCREMENT                      19400001
N1       EQU   1                   FIELD INCREMENT                      19600001
N2       EQU   2                   FIELD INCREMENT                      19800001
N3       EQU   3                   FIELD INCREMENT               Y02669 19850002
N4       EQU   4                   FIELD INCREMENT                      20200001
N5       EQU   5                   FIELD INCREMENT                      20400001
*********************************************************************** 22450002
*                                                                       22500002
*                           CONSTANTS                                   22550002
*                                                                       22560002
*********************************************************************** 22570002
M7       EQU   7                   MASK FOR ICM INSTRUCTION      Y02669 22590002
PTRCVT   EQU   16                  ADDR OF CVT                          22600002
ZERO     EQU   X'00'               ZERO CONSTANT                        23000002
COMMA    EQU   C','                COMMA CHARACTER CONSTANT             23600002
XFF      EQU   255                 MASK FOR TURNING OFF BITS     Y02669 23650002
POSTCOD1 EQU   X'FD'               CODE USED IN POSTING UCM ECB         23800001
         EJECT                                                          24200001
*********************************************************************** 24400001
*                                                                     * 24600002
*                     ESTABLISH ADDRESSABILITY                        * 24800002
*                                                                     * 25600002
*           ON ENTRY, REGISTER 2 CONTAINS ADDRESS OF XSA              * 25800002
*            TARGET CONSOLE IS ALWAYS A GRAPHICS DEVICE          Y02669 25850002
*            CHECK MADE IN IEE7503D                              Y02669 25900002
*                                                                     * 26000002
*********************************************************************** 26050002
         SPACE 2                                                        26100002
         BALR  MYBASE,N0           ESTABLISH ROUTINE 'S                 26400001
         USING *,MYBASE            BASE REGISTER                        26600001
         MODID BRANCH=YES                                        Y01886 26650001
         USING FAUXSA,PARMREG      ESTABLISH XSA ADDRESSABILITY         26800001
         L     UCMBASE,PTRCVT      LOAD CVT POINTER              Y02669 27000002
         USING CVTSECT,UCMBASE     BASE CVT REG                         27400001
         L     UCMBASE,CVTCUCB     GET UCM POINTER FROM CVT             27600002
         DROP  UCMBASE                                           Y20669 27650002
         USING UCM,UCMBASE         ESTABLISH UCM ADDRESSABILITY  Y02669 27800002
         USING UCMLIST,UCMEBASE    BASE UCM ENTRY LIST                  29000001
         USING DCMTSRT,RDCMBASE    ESTABLISH RDCM BASE REG       Y02669 29200002
         ST    RE,XAP              SAVE RETURN POINTER                  29800001
         EJECT                                                          30650002
*********************************************************************** 30700002
*                                                                     * 30750002
*    FIND AND BASE TARGET UCM ENTRY AND RESIDENT DCM (ALWAYS CRT)     * 30800002
*    REG 1-TARGET CONSOLE ID RIGHT JUSTIFIED, HIGH ORDER BYTES ZERO   * 30850002
*    OUTPUT-POINTER TO TARGET UCMENTRY IN UCMEBASE REG                * 30900002
*    REG USAGE-DESTROYS CONTENTS OF: REG 0,1,UCMEBASE                 * 30950002
*                                                                     * 31000002
*********************************************************************** 31050002
         SPACE 2                                                        31100002
         SR    R1,R1               CLEAR REG                            31110002
         IC    R1,XASCID           LOAD TARGET CONSOLE ID               31120002
         BCTR  R1,ZERO             SUBTRACT ONE FROM CONSOLE ID         31300002
         L     UCMEBASE,UCMVEA     POINT TO FIRST UCM ENTRY             31310002
         M     R0,UCMVEZ           MULTIPLY ENTRY SIZE BY REDUCED ID    31350002
         AR    UCMEBASE,R1         POINT TO DESIRED UCM ENTRY           31400002
         L     RDCMBASE,UCMXB      LOAD ADDRESS OF RESIDENT DCM         31500002
         EJECT                                                          31550002
*********************************************************************** 31600002
*                                                                     * 31650002
*                      VALIDITY CHECK THE COMMAND                     * 31700002
*                                                                     * 31750002
*  ERR - IEE156I INVALID OPERAND - IF SYNTAX CHECK FAILS         Y02669 31760002
*********************************************************************** 31800002
         SPACE 2                                                        31850002
VALID    EQU   *                                                        69600001
         L     KOPS,XAL            LOAD ADDRESS OF OPERANDS             69610002
         LA    KOPS,N0(KOPS)       CLEAR HIGH ORDER BYTE                69620002
         ST    KOPS,XAD            SAVE CURSOR POSITION          Y02669 69630002
         LA    KOPS,N1(KOPS)       INCREMENT OPERAND POINTER            69650001
         CLI   N0(KOPS),COMMA      IS SECOND CHARACTER A COMMA?         69700002
         BNE   BADKOP              NO, IEE156I INVALID OPERAND          69750002
         SPACE 2                                                        69752002
         LA    KOPS,N1(KOPS)       INCREMENT OPERAND POINTER     Y02669 69762002
         CLC   N0(N4,KOPS),USE     IS NEXT 4 CHARS 'USE='?       Y02669 69770002
         BNE   BADKOP              NO, IEE156I INVALID OPERAND          69780002
         SPACE 2                                                        69780402
*********************************************************************** 69782002
*                                                                     * 69782402
*          TARGET CONSOLE CAN NOT BE MASTER CONSOLE OR A 2250         * 69782802
*                                                                     * 69782902
*  ERR - IEE345I AUTHORITY INVALID - IF TARGET IS MASTER CONSOLE Y02669 69783202
*        IEE921I REJECTED COMMAND-DEVICE NOT SUPPORTED - IF 2250 Y02669 69783602
*                                                                     * 69783702
*********************************************************************** 69784002
         SPACE                                                          69788402
         TM    UCMDISP,UCMDISPA    IS TARGET THE MASTER CONSOLE?        69790002
         BO    NOTMAST             YES, ERROR - CAN'T V MASTER          69792002
*                                  IEE345I AUTHORITY INVALID     Y02669 69792102
         SPACE 2                                                        69792402
         TM    DCMDEVTY,DCMTY50    IS TARGET A 2250?                    69794002
         BO    ERRHARD             YES, ERROR - CAN'T V 2250            69796002
*                                  IEE921I DEVICE NOT SUPPORTED         69796102
         EJECT                                                          69796402
*********************************************************************** 69796802
*        VALIDITY CHECK AND VARY CONSOLE TO FULL CAPABILITY      Y02669 69796902
*********************************************************************** 69797202
         SPACE 2                                                        69797602
         LA    KOPS,N4(KOPS)       INCREMENT OPERAND POINTER     Y02669 69798002
SETFC    EQU   *                                                 Y02669 69798402
         CLC   N0(N3,KOPS),FC      WAS FC SPECIFIED? (& BLANK)   Y02669 69800002
         BNE   SETSD               NO                                   70000002
         SPACE                                                          70050002
         TM    UCMDISP,UCMDISPD    IS CONSOLE HDWARE OUTPUT ONLY?       73200002
         BZ    FCCONS              NO, OK TO CHANGE MODE                73400002
         SPACE                                                          73410002
         TM    UCMSDS5,UCMSDS5G    YES, IS CONSOLE REALLY OUTPUT ONLY?  73450002
         BZ    OUTERROR            IF OFF, OUTPUT ONLY HARDWARE         73500002
*                                  IT'S IN OUTPUT-ONLY MODE BUT NOT AN  73500402
*                                  INPUT-OUTPUT DEVICE IN OUTPUT-ONLY.  73500802
*                                  MUST HAVE BOTH IN & OUT CAPABILITY   73502002
*                                  TO SERVE AS FULL CAPABILITY          73504002
         SPACE  2                                                       73510002
*********************************************************************** 73550002
*   TURN OFF FLAGS IN TARGET UCM ENTRY:                          Y02669 73800002
*        UCMDISPF - CONSOLE IS MESSAGE STREAM ONLY               Y02669 73802002
*        UCMDISPG - CONSOLE IS STATUS DISPLAY ONLY               Y02669 73804002
*        UCMDISPD - OUTPUT ONLY                                  Y02669 73806002
*        UCMSDS5G - I/O HARDWARE IN OUTPUT-ONLY STATUS           Y02669 73808002
*   TURN ON FLAGS IN TARGET UCM ENTRY:                           Y02669 73811002
*        UCMIF    - INPUT-OUTPUT CAPABILITY                      Y02669 73814002
*        UCMDISPE - FULL CAPABILITY MODE                         Y02669 73817002
*********************************************************************** 73820402
         SPACE 2                                                        73820802
FCCONS   EQU   *                                                        73822001
         NI    UCMDISP,XFF-UCMDISPF-UCMDISPG-UCMDISPD            Y02669 73830002
         NI    UCMSDS5,XFF-UCMSDS5G                              Y02669 73832002
         OI    UCMATR,UCMIF        INDICATE I/O STATUS TO MCS           73840002
         OI    UCMDISP,UCMDISPE    SET FULL CAPABILITY BIT ON           73850002
         B     SETPOST             NOTIFY DIDOCS CHANGING STATUS        74000002
         EJECT                                                          74200002
*********************************************************************** 74250002
*            VALIDITY CHECK AND VARY CONSOLE TO STATUS DISPLAY   Y02669 74260002
*********************************************************************** 74300002
         SPACE 2                                                        74350002
SETSD    EQU   *                                                 Y02669 74650002
         CLC   N0(N3,KOPS),SD      WAS SD SPECIFIED? (& BLANK)   Y02669 74700002
         BNE   SETMS               NO                            Y02669 74750002
         TM    UCMDISP,UCMDISPG    IS IT ALREADY IN SD MODE?            74800002
         BO    RETURN1             YES, NO WORK REQUIRED                75000002
         SPACE                                                          75050002
         OI    UCMDISP,UCMDISPG    NO, SET STATUS DISPLAY BIT ON        75200002
         NI    UCMDISP,XFF-UCMDISPE-UCMDISPF  TURN FC & MS OFF   Y02669 75250002
         B     SETOUT              NOTIFY DIDOCS CHANGING STATUS        75400002
         EJECT                                                          75600002
*********************************************************************** 75650002
*            VALIDITY CHECK AND VARY CONSOLE TO MESSAGE STREAM   Y02669 75700002
*********************************************************************** 75750002
         SPACE 2                                                        75800002
SETMS    EQU   *                                                 Y02669 76010002
         CLC   N0(N3,KOPS),MS      WAS MS SPECIFIED? (& BLANK)   Y02669 76020002
         BNE   BADFNS              NO, IEE156I INVALID OPERAND   YM1915 76030002
         SPACE                                                          76080002
         TM    UCMDISP,UCMDISPF    IS IT ALREADY IN MS MODE?            76200002
         BO    RETURN1             YES, NO WORK REQUIRED                76400002
         SPACE                                                          76450002
         TM    UCMMODE,UCMOGCE     ONLY CRT CONSOLES IN SYSTEM?         76570002
         BO    ERRHARD             YES, ERR - MUST HAVE 1 PAPER         76580002
         SPACE                                                          76590002
         OI    UCMDISP,UCMDISPF    NO, SET MSG STREAM BIT ON            76600002
         NI    UCMDISP,XFF-UCMDISPE-UCMDISPG  TURN FC & SD OFF   Y02669 76650002
         SPACE 2                                                        76660002
*********************************************************************** 76670002
*  SET ALL BITS NECESSARY TO VARY A CONSOLE TO OUTPUT-ONLY MODE  Y02669 76680002
*  FOR STATUS DISPLAY AND MESSAGE STREAM:                        Y02669 76682002
*       UCMSDS5G - INPUT-OUTPUT CAPABILITIES BUT IN OUTPUT MODE  Y02669 76684002
*       UCMDISPD - SOFTWARE OUTPUT ONLY MODE                     Y02669 76686002
*********************************************************************** 76690002
SETOUT   EQU   *                                                        76700001
         NI    UCMATR,XFF-UCMIF    INDICATE OUTPUT ONLY TO MCS   Y02669 76710002
         TM    UCMSDS5,UCMSDS5G    IS DEVICE IN OUTPUT ONLY MODE?       76720002
         BO    SETPOST             YES                                  76730002
         SPACE                                                          76740002
         TM    UCMDISP,UCMDISPD    NO, IS THIS AN OUTPUT DEVICE?        76750002
         BO    SETPOST             YES                                  76760002
         SPACE                                                          76762002
         OI    UCMDISP,UCMDISPD    NO, FORCE OUTPUT ONLY                76770002
         OI    UCMSDS5,UCMSDS5G    SET OUTPUT ONLY BIT ON               76780001
         EJECT                                                          76790402
*********************************************************************** 76792002
*                                                                     * 76800001
*    TURN ON BITS IN RESIDENT DCM TO TELL DIDOCS WHAT TO DO      Y02669 76850002
*       DCMSTSWT - CHANGING STATUS OF OUTPUT ONLY CONSOLE        Y02669 76900002
*       DCMKVIP - ENTRY AS THE RESULT OF K VARY COMMAND          Y02669 76950002
*    REINIT HARDCOPY AND JOBNAME BITS TO SYSGEN VALUE            Y02669 77050002
*    INDICTAES ALL HEADER INFORMATION ON MESSAGE SENT TO THE     Y02669 77150002
*    CONSOLE SHOULD BE DELETED I.E. R.C. + TIME STAMP + JOBNAME  Y02669 77250002
*                                                                     * 77600001
* NOTE: LOCKS ARE ALWAYS HELD ON ENTRY TO IEE7703D               Y02651 77610002
*    AND MUST BE RELEASED BEFORE POSTING DIDOCS OR               Y02651 77620002
*    RETURNING CONTROL TO THE SYSTEM                             Y02651 77630002
*********************************************************************** 77650002
         SPACE 3                                                        77800001
SETPOST  EQU   *                                                        78200001
         OI    DCMR3FLG,DCMSTSWT+DCMKVIP                                78400002
         NI    UCMDISP2,XFF-UCMDISPI-UCMDISPJ                    Y02669 78450002
         BAL   R15,LOCKSOFF        GO RELEASE LOCKS AND          Y02651 78500002
         POST  UCMECB,POSTCOD1     POST THE ECB                         78600001
         B     RETURN              THEN RETURN TO SYSTEM         Y02651 78650002
         SPACE 3                                                        78750002
RETURN1  EQU   *                                                        79248002
         BAL   R15,LOCKSOFF                                      Y02651 79298002
RETURN   EQU   *                                                 Y02651 79299902
         L     RE,XAP                                            Y02669 79349902
         BR    RE                  RETURN TO CALLER                     79400001
         SPACE 2                                                        79410002
LOCKSOFF EQU   *                                                 Y02651 79410402
         STM   R11,RE,XASAVLOC     SAVE REGS AROUND SETLOCK      Y02651 79412002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(K,IEE7503D(LOCKSET))         79414002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(K,IEE7503D(LOCKSET))       79416002
         LM    R11,RE,XASAVLOC     RESTORE REGS AFTER SETLOCK    Y02651 79418002
         NI    XASSDS,XFF-XASSDS5  INDICATE LOCKS NOW OFF        Y02651 79418402
         BR    R15                                               Y02651 79418502
         EJECT                                                          79418802
*********************************************************************** 79420002
*                                                                     * 79422002
*                        ERROR EXITS                                  * 79424002
*                                                                     * 79426002
*********************************************************************** 79430002
         SPACE  2                                                       79432002
NOTMAST  EQU   *                   CAN'T K VARY MASTER CONSOLE          79440002
         MVI   XAE,IEE345I         IEE345I AUTHORITY INVALID            79442002
         MVC   XASOPTR(N3),XAD+N1  SAVE ADDR INVALID OPERAND   @YM4792P 79443002
         B     D5603D              BRANCH TO ERROR EXIT          Y02669 79444002
         SPACE  2                                                       79446002
OUTERROR EQU   *                   CAN'T VARY OUTPUT ONLY TO FC  Y02669 79450002
         MVI   XASTSAVE,ERR29      SECOND ERROR CODE-OUTPUT ONLY Y02669 79500002
         MVI   XAE,IEE926I         ERROR CODE - L OPERAND INVALID       79550001
         B     STOREOP             BRANCH FOR ERROR EXIT         Y02669 79560002
         SPACE  2                                                       79562002
ERRHARD  EQU   *                   CAN'T K VARY A 2250                  79570002
         MVI   XASTSAVE,ERR28      MINOR - DEVICE NOT SUPPORTED  Y02669 79580002
         MVI   XAE,IEE921I         ERROR CODE - CM OP REJECTED          79590001
         MVC   XASOPTR(N3),XAD+N1  SAVE ADDR OF INVALID OPERAND  Y02669 79592002
         B     D5603D              BRANCH FOR ERROR EXIT         Y02669 79592102
         SPACE  2                                                       79592402
BADFNS   EQU   *                                                 YM1915 79592702
         CLI   N2(KOPS),COMMA      IS FNS FOLLOWED BY ,?         YM1915 79593002
         BNE   BADKOP              NO, WHOLE OPERAND BAD         YM1915 79593302
         LA    KOPS,N2(KOPS)       YES, POINT TO BAD INFO        YM1915 79593602
BADKOP   EQU   *                                                        79594002
         MVI   XAE,IEE156I         IEE156I INVALID OPERAND              79596002
STOREOP  EQU   *                                                        79598002
         STCM  KOPS,M7,XASOPTR     SAVE ADDR OF INVALID OPERAND  Y02669 79598402
D5603D   EQU   *                                                 Y02669 79599202
         L     RE,XAP              RESTORE RETURN ADDRESS        Y02669 79599702
         L     R15,VCON5603        GET ADDRESS OF ERR MODULE     Y02669 79599802
         BR    R15                 GO ISSUE ERROR MESSAGES       Y02669 79599902
         EJECT                                                          79649902
*********************************************************************** 79699902
*                                                                     * 84000002
*                            CONSTANTS                                * 84400002
*                                                                     * 84600002
*********************************************************************** 84650002
         SPACE  2                                                       84700002
VCON5603 DC    V(IEE5603D)         SVC 34 MSG MOD NAME           Y02669 85800002
USE      DC    C'USE='             CONSTANT FOR VARY COMMAND            86800001
FC       DC    C'FC '              FULL CAPCITY CONSTANT         Y02669 87000002
SD       DC    C'SD '              STATUS DISPLAY CONSTANT       Y02669 87200002
MS       DC    C'MS '              MASTER CONSOLE CONSTANT       Y02669 87400002
         SPACE  5                                                       87410002
*********************************************************************** 87450002
*                                                                     * 87500002
*                         PATCH AREA                                  * 87550002
*                                                                     * 87560002
*********************************************************************** 87570002
         SPACE  2                                                       87580002
PATCH    DC    C'****PATCH AREA****'                                    87600001
PATCH2   DC    C'IEE7703D-TEST ONLY'                                    87800001
PATCH3   DC    36C' '                                                   88000001
         EJECT                                                          89200001
         IEECUCM FORMAT=NEW                                             89600002
         EJECT                                                          89650002
         IEERDCM                                                        90000002
         EJECT                                                          90050002
FAUXSA   DSECT                                                          90200001
         IEEXSA                                                         90400001
         EJECT                                                          90450002
CVTSECT  DSECT                                                          93000001
         CVT                                                            93200001
         EJECT                                                          93250002
         IHAPSA                                                         93300002
         END                                                            93800001
