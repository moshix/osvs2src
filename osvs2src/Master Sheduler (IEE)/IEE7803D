         TITLE 'IEE7803D SVC 34 K C,D,ID COMMAND '                      01400002
*********************************************************************** 01600001
*                                                                     * 01650002
* MODULE NAME         =  IEE7803D                               Y02669* 01700002
*                                                                     * 01750002
* DESCRIPTIVE NAME    =  CONTROL (K) C,D,ID COMMAND             Y02669* 01800002
*                                                                     * 01850002
* COPYRIGHT           =  N/A                                    Y02669* 01900002
*                                                                     * 01950002
* STATUS              =  01 - UPDATE FOR VS/2 RELEASE 2         Y02669* 02000002
*                                                                     * 02050002
* FUNCTION            =  PROCESSES K C,D,MLWTOID CONTROL        Y02669* 02100002
*                        COMMAND WHICH CANCELS AN INLINE        Y02669* 02150002
*                        MLWTO BY PURGING THE UNDISPLAYED       Y02669* 02200002
*                        MINORS FROM THE OUTPUT QUEUE.          Y02669* 02210002
*                                                                     * 02242402
*   OPERATION         =  THE COMMAND BUFFER IS CHECKED FOR      Y02669* 02300002
*                        THE PRESENCE OF A VALID MLWTO ID.      Y02669* 02310002
*                        IF NOT FOUND, 'IEE927I REQUEST         Y02669* 02320002
*                        AMBIGUOUS' IS ISSUED. IF THE VALUE     Y02669* 02330002
*                        FOUND IS INVALID ( NOT A DIGIT ),      Y02669* 02340002
*                        'IEE156I INVALID OPERAND' IS ISSUED.   Y02669* 02342002
*                                                                     * 02342402
*                        THE TARGET CONSOLE ID FOUND IN XASCID  Y02669* 02344002
*                        IS THEN PACKED AND CONVERTED TO BINARY Y02669* 02346002
*                        AND THE RESULTING VALUE IS USED TO     Y02669* 02348002
*                        INDEX THE CORRESPONDING UCME.          Y02669* 02348402
*                                                                     * 02348802
*                        IF THIS CONSOLE'S WQE QUEUE ADDRESS,   Y02669* 02349202
*                        FOUND IN THE UCME, IS ZERO, 'IEE156I   Y02669* 02349302
*                        INVALID OPERAND' IS ISSUED.            Y02669* 02349402
*                                                                     * 02362002
*                        OTHERWISE, THE WQE QUEUE IS SEARCHED   Y02669* 02372002
*                        FOR A MATCHING MLWTO ID. IF NOT FOUND, Y02669* 02374002
*                        'IEE156I INVALID OPERAND' IS ISSUED.   Y02669* 02374402
*                                                                     * 02374502
*                        IF FOUND ISSUE A DOM MACRO TO         @Y02668P 02374602
*                        BUILD AN SSIB AND SSOB TO INFORM      @Y02668P 02374802
*                        THE SUBSYSTEM THAT A MLWTO HAS        @Y02668P 02375802
*                        BEEN DELETED                          @Y02668P 02376802
*                            WMJMSEQ - IS THE DOM SEQUENCE     @Y02668P 02377802
*                                      NUMBER IN THE MAJOR WQE @Y02668P 02378802
*                                                                     * 02379802
*                        THE USE COUNT FOR ALL THE MINOR WQES   Y02669* 02380802
*                        ON EACH MINOR WQE QUEUE IS DECREMENTED Y02669* 02384802
*                        UNTIL THEY ARE ZERO.                   Y02669* 02386802
*                        THE UCME IS RESET TO MAKE IT APPEAR    Y02669* 02391502
*                        AS IF THE MINORS HAD ALL BEEN WRITTEN: Y02669* 02392302
*                           OUTPUT PENDING BIT IS TURNED ON     Y02669* 02395302
*                               UCMSTS - UCMPF X'40'            Y02669* 02398302
*                           WORKING ON INLINE MLWTO TURNED OFF  Y02669* 02402502
*                               UCMSTS - UCMTC X'01'            Y02669* 02405502
*                           WAITING ON INLINE MLWTO TURNED OFF  Y02669* 02408502
*                               UCMSDS5 - UCMSDS5A X'80'        Y02669* 02411502
*                           DEQUEUE OUTPUT QUEUE ENTRIES        Y02669* 02414502
*                               UCMSTS - UCMTB X'04'            Y02669* 02417502
*                           PURGE CQE TURNED ON                 Y02669* 02420502
*                               CQEFLAG - CQEAVAIL X'02'        Y02669* 02423502
*                           CQU ACTIVE FLAG TURNED OFF          Y02669* 02426502
*                               CQEFLAG - CQEENTR               Y02669* 02429502
*                        AND CONTROL IS RETURNED.               Y02669* 02432502
*                                                                     * 02435502
* NOTES                                                         Y02669* 02438502
*                                                                     * 02450002
*   CHARACTER CODE                                              Y02669* 02500002
*    DEPENDENCIES     =  ANY CHARACTER CODE OTHER THAN EBCDIC   Y02669* 02550002
*                        WILL REQUIRE REASSEMBLY OF THIS MODULE.Y02669* 02600002
*                        NOTE THAT THIS MODULE IS DEPENDENT     Y02669* 02610002
*                        UPON THE CHARACTER REPRESENTATION OF   Y02669* 02620002
*                        DECIMAL DIGITS, IE. X'F1' = 1.         Y02669* 02630002
*                                                                     * 02650002
*   DEPENDENCIES      =  THE CMS LOCK AND LOCAL LOCK WILL       Y02651* 02700002
*                        REPLACE SSM (DISABLE AND ENABLE) FOR   Y02651* 02702002
*                        PURGING THE MINOR WQE'S.               Y02651* 02704002
*                                                                     * 02750002
*   RESTRICTIONS      =  NONE                                   Y02669* 02800002
*                                                                     * 02850002
*   REGISTER                                                    Y02669* 02900002
*    CONVENTIONS      =  NONE                                   Y02669* 02950002
*                                                                     * 03000002
*   PATCH-LABEL       =  PATCH                                  Y02669* 03050002
*                                                                     * 03100002
* MODULE TYPE         =  CSECT                                  Y02669* 03150002
*                                                                     * 03200002
*   PROCESSOR         =  N/A                                    Y02669* 03250002
*                                                                     * 03300002
*   MODULE SIZE       =  X'1A8' + X'48' PATCH AREA              Y02669* 03350002
*                                                                     * 03400002
*   ATTRIBUTES        =  REFRESHABLE, REENTRANT, PAGED LPA,     Y02669* 03450002
*                        KEY 0, SUPERVISOR MODE                 Y02669* 03550002
*                                                                     * 03800002
* ENTRY POINT         =  IEE7803D FROM IEE7503D                 Y02669* 03810002
*   PURPOSE           =  TO PROCESS THE K C,D,ID COMMAND FOR    Y02669* 03820002
*                        ALL NON-CRT DEVICES                    Y02669* 03822002
*   LINKAGE           =  BRANCH                                 Y02669* 03840002
*   INPUT DATA        =  REG 2 POINTS TO THE XSA                Y02669* 03842002
*                           XAS CONTAINS ROUTING INFORMATION    Y02669* 03842102
*                              XASCID - TARGET CONSOLE ID       Y02669* 03842202
*                              XASSDS5 ON -  LOCKS HELD         Y02651* 03861602
*                           XAL POINTS TO 1ST OPERAND IN BUFFER Y02669* 03863602
*                     =  REG 14 CONTAINS THE RETURN ADDRESS     Y02669* 03871202
*                                                                     * 03880802
*   REGISTERS SAVED   =  REGISTERS 11, 12, 13, 14 ARE SAVED     Y02651* 03890402
*                        BEFORE ISSUING SETLOCK RELEASE AT      Y02651* 03892402
*                        ENDSRCH.                               Y02651* 03894402
*                                                                     * 03900002
*   REGISTER CONTENTS                                           Y02669* 03950002
*    DURING PROCESSING=  R0  =  WORK REG                        Y02669* 04000002
*                        R1  =  WORK REG                        Y02669* 04050002
*                        R2  =  BASE REG FOR XSA                Y02669* 04100002
*                        R3  =  USUSED                          Y02669* 04150002
*                        R4  =  BASE REG FOR WQE                Y02669* 04200002
*                        R5  =  BASE REG FOR CQE                Y02669* 04250002
*                        R6  =  WORK REG                        Y02669* 04300002
*                        R7  =  WORK REG                        Y02669* 04350002
*                        R8  =  BASE REG FOR UCM ENTRY          Y02669* 04400002
*                        R9  =  UNUSED                          Y02669* 04450002
*                        R10 =  OPERAND POINTER                 Y02669* 04500002
*                        R11 =  BASE REG FOR THIS MODULE        Y02669* 04550002
*                        R12 =  BASE REG FOR UCM                Y02669* 04600002
*                        R13 =  UNUSED                          Y02669* 04650002
*                        R14 =  RETURN ADDRESS                  Y02669* 04700002
*                        R15 =  WORK REG & BRANCH REG           Y02669* 04750002
*                                                                     * 04800002
*   REGISTERS RESTORED=  REGISTERS 11, 12, 13, 14 ARE RESTORED  Y02651* 04850002
*                        AFTER ISSUING SETLOCK AT ENDSRCH.      Y02651* 04860002
*                                                                     * 04900002
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  04910002
*                                                                     * 04920002
* EXIT - NORMAL       =  RETURN VIA BR 14 FROM ENDSRCH          Y02669* 04950002
*   CONDITIONS        =  PROCESSING OF K C,D COMPLETE           Y02669* 05000002
*   OUTPUT DATA       =  ALL UNDISPLAYED MINORS OF MLWTO        Y02669* 05050002
*                        ARE PURGED AND THE LOCKS RELEASED      Y02651* 05100002
*                        REG 2 STILL POINTS TO XSA              Y02669* 05110002
*                           XASSDS5 IS TURNED OFF -  LOCKS      Y02651* 05150002
*                           RELEASED                            Y02651* 05200002
*   RETURN CODES      =  NONE                                   Y02669* 05250002
*                                                                     * 05300002
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  05641602
*                                                                     * 05643602
* EXIT - ERROR        =  BRANCH TO IEE5603D FROM D5603D         Y02669* 05644802
*   CONDITIONS        =  TO ISSUE ERROR MESSAGES 'IEE156I       Y02669* 05650002
*                        INVALID OPERAND' AND 'IEE927I REQUEST  Y02669* 05660002
*                        AMBIGUOUS'                             Y02669* 05670002
*   OUTPUT DATA       =  REG 2 POINTS TO XSA                    Y02669* 05700002
*                           XAE CONTAINS MAJOR MESSAGE INDEX    Y02669* 05710002
*                           FOR IEE5603D   X'04' - IEE156I      Y02669* 05712002
*                                          X'0D' - IEE927I      Y02669* 05720002
*                           XASTSAVE POINTS TO INVALID OPERAND  Y02669* 05730002
*                            & CONTAINS ERROR CODE FOR IEE5903D Y02669* 05732002
*                              X'16' - SPECIFY DISPLAY ID       Y02669* 05734002
*                           XASSDS5 IS STILL ON - LOCKS HELD    Y02651* 05740002
*   RETURN CODES      =  NONE                                   Y02669* 05750002
*                                                                     * 05800002
*  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  05810002
*                                                                     * 05820002
* EXTERNAL REFERENCES                                           Y02669* 05850002
*                                                                     * 05900002
*   ROUTINES          =  IEE5603D                               Y02669* 05950002
*                                                                     * 06000002
*   DATA AREAS        =  NONE                                   Y02669* 06050002
*                                                                     * 06100002
         EJECT                                                          06110002
*   CONTROL BLOCKS    =  IEECUCM  R - ADDR CONSOLE'S WQE QUEUE  Y02669* 06150002
*                                 W - RESET WQE QUEUE BITS      Y02669* 06160002
*                        IEEXSA   R - INPUT                     Y02669* 06200002
*                                 W - ERROR MSG INDEX           Y02669* 06250002
*                        CVT      R - ADDRESS UCM               Y02669* 06350002
*                        IHAWQE   R - COMPARE ID'S              Y02669* 06400002
*                                 W - DEQUEUE MINORS            Y02669* 06410002
*                        IHAPSA   NECESSARY FOR SETLOCK         Y02651* 06500002
*                        IHACTM   (CQE) R - RIGHT WQE           Y02669* 06510002
*                                       W - RESET BITS          Y02669* 06520002
*                                                                     * 06550002
*   TABLES            =  NONE                                   Y02669* 06600002
*                                                                     * 06610002
*   MACROS            =  SETLOCK - CMS AND LOCK LOCKS RELEASED  Y02651* 06650002
*                                                                     * 06800002
*   ENQUEUE RESOURCES =  NONE                                   Y02669* 06850002
*                                                                     * 06900002
*   LOCKS HELD        =  CMS AND LOCAL LOCKS ARE OBTAINED IN    Y02651* 06950002
*                        IEE7503D AND HELD THROUGHOUT IEE7803D. Y02651* 06952002
*                        UNDER NORMAL CONDITIONS THEY ARE       Y02651* 06962002
*                        RELEASED AND XASSDS5 IS RESET BEFORE   Y02651* 07000002
*                        RETURNING AT ENDSRCH.                  Y02651* 07010002
*                        FOR ERROR CONDITIONS THEY ARE RELEASED Y02651* 07012002
*                        IN IEE5603D OR IEE5903D.               Y02651* 07014002
*                                                                     * 07020002
*   CHANGE LEVEL      =  Y02669                                 Y02669* 07050002
*                        Y02651                                 Y02651* 07060002
*                        YM1911  (PROLOGUE & COMMENT CHANGES)   YM1911* 07080002
*                                                                     * 07100002
* MESSAGES            =  THE FOLLOWING MESSAGES ARE CONTAINED   Y02669* 07157002
*                        IN AND ISSUED FROM IEE5603D & IEE5903D:Y02669* 07164002
*                                                                     * 07171002
*                         MSGID   CODE  IN  MESSAGE TEXT        Y02669* 07178002
*                        IEE156I  X'04' 56  INVALID OPERAND     Y02669* 07185002
*                        IEE927I  X'0D' 56  REQUEST AMBIGUOUS   Y02669* 07192002
*                                 X'16' 59  SPECIFY DISPLAY ID  Y02669* 07199002
*                                                                     * 07206002
* SYSGEN              =  INCLUDED WITH SVC 34 IN LOAD MODULE    Y02669* 07213002
*                        IGC0003D,DLIB AOSB3, MACRO SGIEF441,   Y02669* 07220002
*                        TARGLIB LPALIB.                        Y02669* 07227002
*                                                                     * 07234002
* SYSTEM LIBRARIES    =  NONE                                   Y02669* 07241002
*                                                                     * 07250002
*********************************************************************** 08800001
         EJECT                                                          09000001
IEE7803D CSECT                                                          09050002
*********************************************************************** 09200001
*                                                                     * 09400002
*                            REGISTERS                                * 09600002
*                                                                     * 09800002
*********************************************************************** 10000001
R0       EQU   0                   WORK REGISTER                        13450002
R1       EQU   1                   WORK REGISTER                        13800001
PARMREG  EQU   2                   BASE REGISTER FOR XSA                13810002
R3       EQU   3      (UNUSED)     UNUSED                        Y02669 13860002
WQEREG   EQU   4                   BASE REGISTER FOR MINOR WQE   Y02669 13900002
CQEREG   EQU   5                   BASE REGISTER FOR CQE         Y02669 14010002
R5       EQU   5                   WORK REGISTER                 Y02669 14020002
R6       EQU   6                   WORK REGISTER                        14050002
R7       EQU   7                   WORK REGISTER                        14100002
UCMEBASE EQU   8                   BASE REGISTER FOR UCM ENTRY          14150002
R9       EQU   9                   DOM SEQUENCE NUMBER         @Y02668P 14160002
KOPS     EQU   10                  OPERAND POINTER                      14170002
MYBASE   EQU   11                  THIS ROUTINES BASE REGISTER          14180002
UCMBASE  EQU   12                  UCM BASE REGISTER                    14190002
R13      EQU   13                  UNUSED                        Y02669 14192002
R14      EQU   14                  RETURN REGISTER               Y02669 14194002
R15      EQU   15                  WORK REGISTER                 Y02669 14196002
         EJECT                                                          14246002
*********************************************************************** 14450002
*                                                                     * 14500002
*                          CHARACTER CONSTANTS                        * 14550002
*                                                                     * 14560002
*********************************************************************** 14562002
COMMA    EQU   C','                COMMA CHAR FOR SYNTAX CHECK   Y02669 14572002
BLANK    EQU   C' '                BLANK CHAR FOR SYNTAX CHECK          14590002
ZERO     EQU   X'00'               ZERO CONSTANT                        14592102
*********************************************************************** 14592402
*                                                                     * 14592802
*                             MASKS                                   * 14593202
*                                                                     * 14593602
*********************************************************************** 14593702
DIGIT    EQU   X'F0'               MASK TO TEST FOR VALID DIGIT  Y02669 14649702
XFF      EQU   255                 USED IN NI INSTRUCTIONS TO TURN      14649802
*                                  OFF BITS FOR TM INSTRUCTIONS  Y02669 14652002
*********************************************************************** 14654502
*                                                                     * 14656702
*                       ERROR MESSAGE CODES                           * 14658902
*                                                                     * 14661102
*********************************************************************** 14663302
MSG156   EQU   4                   IEE156I INVALID OPERAND       Y02669 14665502
MSG927   EQU   13                  IEE927I K REQUEST AMBIGUOUS   Y02669 14667702
MSG927I  EQU   22                          SPECIFY DISPLAY ID    Y02669 14669902
*********************************************************************** 14679902
*                                                                     * 14689902
*                   DISPLACEMENTS AND INCREMENTS                      * 14691902
*                                                                     * 14718002
*********************************************************************** 14726702
N0       EQU   0                   FIELD INCREMENT                      14744102
N1       EQU   1                   FIELD INCREMENT                      14752802
N2       EQU   2                   FIELD INCREMENT                      14761502
N3       EQU   3                   FIELD INCREMENT                      14770202
N4       EQU   4                   FIELD INCREMENT                      14778902
N7       EQU   7                   MASK FOR ICM INSTRUCTION      Y02669 14780902
N8       EQU   8                   FIELD INCREMENT                      14787602
         EJECT                                                          14788902
*********************************************************************** 14800001
*                                                                     * 15000001
*      ESTABLISH ADDRESSABILITY                                       * 15200001
*                                                                     * 15400001
*      ON ENTRY, REGISTER 2 CONTAINS ADDRESS OF XSA                   * 16000001
*                                                                     * 16200001
*********************************************************************** 16250001
         BALR  MYBASE,N0           ESTABLISH ROUTINE 'S                 17200001
         USING *,MYBASE            BASE REGISTER                        17400001
         MODID BRANCH=YES                                        Y01886 17450001
         USING FAUXSA,PARMREG      ESTABLISH XSA ADDRESSABILITY         17600001
         L     UCMBASE,CVTPTR      GET CVT POINTER                      17800001
         USING CVTSECT,UCMBASE     BASE CVT REG                         18000001
         L     UCMBASE,CVTCUCB     GET UCM POINTER FROM CVT             18200001
         DROP  UCMBASE                                           Y02669 18250002
         USING UCM,UCMBASE         ESTABLISH UCM ADDRESSABILITY  Y02669 18400002
         USING UCMLIST,UCMEBASE    BASE UCM ENTRY LIST                  18600001
         USING WQE,WQEREG          ADDRESS WQE                   YM2304 18800001
         USING CQE,CQEREG          ESTABLISH BASE FOR CQE        Y02669 18850002
         SPACE 2                                                        18900002
*********************************************************************** 19050002
*                                                                     * 19400001
*              ESTABLISH POINTER TO K OPERANDS                   Y02669 19650002
*           'C,D' IS VALIDITY CHECKED IN IEE7503D                Y02669 19700002
*  IEE7503D ENSURES THAT TARGET CONSOLES ARE ALWAYS GRAPHICS DEVICES  * 19750002
*                                                                     * 19800001
*********************************************************************** 19850002
         SPACE 1                                                        20200001
         L     KOPS,XAL            LOAD POINTER TO OPERANDS             20800002
         LA    KOPS,N0(KOPS)       CLEAR HIGH ORDER BYTE                21000001
         EJECT                                                          21816402
*********************************************************************** 22850002
*                                                                     * 23000002
*                          K C,D                                      * 23010002
*                                                                     * 23020002
*   THE MLWTO ID IS OBTAINED FROM THE COMMAND BUFFER, VALIDITY        * 23050002
*   CHECKED, AND PACKED INTO XAP, FINDUCME IS THEN INVOKED TO         * 23100002
*   CONVERT THE VALUE TO BINARY AND DETERMINE WHETHER IT SPECIFIES    * 23150002
*   A VALID CONSOLE.                                                  * 23200002
*                                                                     * 23250002
*   ERR - IEE927I REQUEST AMBIGIOUS - IF MLWTO ID NOT SPECIFIED       * 24010002
*         IEE156I INVALID OPERAND - IF MLWTO ID NOT DIGIT             * 24020002
*********************************************************************** 24050002
         SPACE 2                                                        24100002
KCDRTN   EQU   *                                                        24200001
         CLI   N3(KOPS),BLANK      IS AN MLWTO ID SPECIFIED?     Y02669 24600002
         BE    DERR927             NO, IEE927I REQUEST AMBIGIOUS Y02669 24800002
         LA    KOPS,N3(KOPS)       INCREMENT POINTER TO COMMA           24802002
         CLI   N0(KOPS),COMMA      IS NEXT CHARACTER COMMA?      Y02669 24810002
         BNE   BADKOP              NO, IEE156I INVALID OPERAND   Y02669 24820002
         SPACE                                                          24850002
         LA    KOPS,N1(KOPS)       INCREMENT OPERAND POINTER TO ID      25000001
         TM    N0(KOPS),DIGIT      IS 1ST CHAR OF ID A DIGIT?    Y02669 25200002
         BNO   BADKOP              NO, IEE156I INVALID OPERAND          25400002
         SPACE                                                          25450002
         TM    N1(KOPS),DIGIT      IS 2ND CHAR OF ID A DIGIT?    Y02669 25600002
         BO    TWODIGIT            YES, BRANCH                          25800002
         CLI   N1(KOPS),BLANK      IS 2ND CHARACTER A BLANK?     Y02669 25900002
         BNE   BADKOP              NO, IEE156I INVALID OPERAND   Y02669 25950002
         SPACE                                                          25960002
         PACK  XAP(N8),N0(N1,KOPS) PACK EBCDIC MLWTO ID                 26000001
         B     FINDUCME            BRANCH TO CONVERT NUMBER             26200001
         SPACE  2                                                       26250002
TWODIGIT EQU   *                                                        26400001
         TM    N2(KOPS),DIGIT      IS 3RD CHAR OF ID A DIGIT?    Y02669 26600002
         BO    THRDIGIT            YES, BRANCH                          26800002
         CLI   N2(KOPS),BLANK      IS 3RD CHARACTER A BLANK?     Y02669 26900002
         BNE   BADKOP              NO, IEE156I INVALID OPERAND   Y02669 26950002
         SPACE                                                          26960002
         PACK  XAP(N8),N0(N2,KOPS) PACK EBCDIC MLWTO ID                 27000001
         B     FINDUCME            BRANCH TO CONVERT NUMBER             27200001
         SPACE  2                                                       27250002
THRDIGIT EQU   *                                                        27400001
         CLI   N3(KOPS),BLANK      IS 4TH CHARACTER A BLANK?     Y02669 27450002
         BNE   BADKOP              NO, IEE156I INVALID OPERAND   Y02669 27500002
         SPACE                                                          27550002
         PACK  XAP(N8),N0(N3,KOPS) PACK EBCDIC MLWTO ID                 27600001
         EJECT                                                          27602002
*********************************************************************** 27610002
*                                                                     * 27650002
*             THE MLWTO ID ENTERED IS IN EBCDIC AND MUST         Y02669 27700002
*             BE CONVERTED TO BINARY FOR COMPARE                 Y02669 27750002
*                                                                     * 27750402
*    FIND AND BASE UCM ENTRY                                          * 27752002
*    INPUT- REG 1-CONSOLE ID RIGHT JUSTIFIED, HIGH ORDER BYTES ZERO   * 27754002
*    OUTPUT-POINTER TO UCMENTRY SPECIFIED BY CONSOLE ID IN UCMEBASE REG 27756002
*    REG USAGE-DESTROYS CONTENTS OF: REG 0,1,UCMEBASE                 * 27758002
*                                                                     * 27758102
*  ERR - IEE156I INVALID OPERAND - IF TARGET CONSOLE'S WQE ADDRESS    * 27758402
*                                  IS ZERO                            * 27758802
*********************************************************************** 27760002
         SPACE 2                                                        27800001
FINDUCME EQU   *                                                        28400001
         CVB   R7,XAP              CONVERT TO BINARY                    28600001
         SR    R1,R1               CLEAR REG                            31600001
         IC    R1,XASCID           LOAD TARGET CONSOLE ID               31800002
         L     UCMEBASE,UCMVEA     POINT TO FIRST UCM ENTRY             32000002
         BCTR  R1,ZERO             SUBTRACT ONE FROM CONSOLE ID         32200001
         M     R0,UCMVEZ           MULTIPLY ENTRY SIZE BY REDUCED ID    32400001
         AR    UCMEBASE,R1         POINT TO DESIRED UCM ENTRY           32600001
         L     CQEREG,UCMOUTQ      GET CQE POINTER FROM UCME     Y02669 32800002
         LTR   CQEREG,CQEREG       IS THERE A CQE CHAIN?         Y02669 33000002
         BZ    BADKOP              NO, IEE156I INVALID OPERAND          33200002
         EJECT                                                          33250001
*********************************************************************** 34400001
*                                                                     * 34402002
*        SEARCH CONSOLE OUTPUT QUEUE FOR PROPER MLWTO WQE        Y02669 34412002
*                                                                     * 34420002
*********************************************************************** 34450002
         SPACE 2                                                        34500002
RETEST   EQU   *                                                        34600001
         TM    CQEFLAG,CQEENTR     IS THIS QUE ENTRY ACTIVE?     Y02669 34800002
         BNO   NXTENTRY            BRANCH NO FOR NEXT ELEMENT    Y02669 35000002
         SPACE 2                                                        35050002
         TM    CQEFLAG,CQEMAJOR    IS THIS A MLWTO?              Y02669 36200002
         BNO   NXTENTRY            BRANCH NO FOR NEXT ELEMENT    Y02669 36400002
         SPACE 2                                                        36450002
         TM    CQEFLAG,CQEMLQHC    IS THIS A HARD COPY MLWTO?    Y02669 36600002
         BO    NXTENTRY            BRANCH YES FOR NEXT ELEMENT   Y02669 36800002
         SPACE 2                                                        36850002
         SR    WQEREG,WQEREG       CLEAR REG FOR ADDRESS         Y02669 36900002
         ICM   WQEREG,N7,CQEWQEA   GET MAJOR WQE POINTER FROM CQEY02669 36950002
         L     R6,WMJMMSGN         LOAD WQE MLWTO ID                    37000002
         SR    R9,R9               ZERO OUT REGISTER           @Y02668P 37003002
         ICM   R9,N7,WMJMSEQ       SAVE DOM SEQUENCE #         @Y02668P 37006002
LOOP     EQU   *                                                 Y02669 37010002
         C     R6,B1000            IS ID GREATER THAN 1000?       M2722 37050002
         BL    COMPARE             NO, GO COMPARE                 M2722 37100001
         S     R6,B1000            YES, REDUCE BY 1000            M2722 37150001
         B     LOOP                TRY AGAIN                      M2722 37200001
         SPACE 2                                                        37400001
COMPARE EQU   *                                                   M2722 37850001
         CR    R6,R7               COMPARE THE 2 MLWTO ID'S             38000001
         BE    SETSUBQ             COMMAND ID EQUALS WQE ID             38200002
         EJECT                                                          38400002
*********************************************************************** 38800001
*                                                                     * 38802002
*    BRANCH HERE IF:  WQE NOT ACTIVE                             Y02669 38810002
*                     WQE NOT MLWTO                              Y02669 38820002
*                     WQE REPRESENTS HARD COPY MLWTO             Y02669 38830002
*                     WQE ID DOES NOT MATCH COMMAND'S ID         Y02669 38840002
*   ERR - IEE156I INVALID OPERAND - IF END OF QUEUE AND NO MATCH Y02669 38842002
*                                                                     * 38844002
*********************************************************************** 38850002
         SPACE 2                                                        38900002
NXTENTRY EQU   *                                                 Y02669 39000002
         TM    CQEFLAG,CQEEOB      IS IT A POINTER TO NEW BLOCK? Y02669 39200002
         BO    BUMPSUBQ            NO, JUST BUMP BLOCK POINTER          39400002
         SPACE 2                                                        39600001
         TM    CQEFLAG,CQEEOQ      END OF LIST?                  Y02669 40200002
         BO    BADKOP              YES, IEE156I INVALID OPERAND         40400002
         SPACE 2                                                        40600001
         LA    CQEREG,N4(CQEREG)   INCREMENT Q PTR TO NEXT ENTRY Y02669 41200002
         B     RETEST              CONTINUE SEARCH                      41400001
         SPACE 2                                                        41600002
BUMPSUBQ EQU   *                                                        42400001
         L     CQEREG,N0(CQEREG)   LOAD POINTER TO NEXT SECTION  Y02669 42600002
         B     RETEST              CONTINUE SEARCH                      42800001
         EJECT                                                          42850002
*********************************************************************** 43650002
*                                                                     * 43800002
*           DELETION OF THE MLWTO                              @Y02669P 44000002
*             1. OBTAIN DOM SEQUENCE NUMBER - WMJMSEQ          @Y02669P 44030002
*             2. THEN MAKE IT LOOK AS IF THE MLWTO HAS         @Y02669P 44120002
*                   BEEN PROCESSED                             @Y02669P 44150002
*                                                                     * 44200002
*********************************************************************** 44250002
         SPACE 3                                                        44400001
SETSUBQ  EQU   *                                                        45000001
         OI    CQEFLAG,CQEAVAIL    SET PURGE BIT ON IN CQE       Y02669 45200002
         NI    CQEFLAG,XFF-CQEENTR TURN OFF ACTIVE BIT IN CQE    Y02669 45400002
         OI    UCMSTS,UCMTB        SET DEQUEUE BIT ON IN UCME           45600001
         SPACE 2                                                        45610002
*********************************************************************** 45650002
*                                                                     * 45800002
*              GET MINOR WQE POINTER FROM UCME                        * 46050002
*                1. IF ZERO, RETURN TO SYSTEM                         * 46100002
*                OR UCMMLAST MAY PT TO THE MINOR                      * 46150002
*                   THAT WAS JUST WRITTEN AND MAY                     * 46160002
*                   HAVE USE COUNT DECREMENTED                        * 46170002
*                1. IF NOT FULL CAPABILITY, GET POINTER TO NEXT       * 46180002
*                2. IF GRAPHICS CONSOLE, GET POINTER TO NEXT          * 46190002
*                                                                     * 46200002
*********************************************************************** 46250002
         SPACE 2                                                        46300002
         L     WQEREG,UCMMLAST     MINOR WQE PTR FROM UCME       YM2304 46400001
         LTR   WQEREG,WQEREG       IS MINOR POINTER ZERO?        YM2304 46600002
         BZ    ENDSRCH             YES, END SEARCH                      46800002
         TM    UCMDISP,UCMDISPE    IS TARGET CONSOLE FULL CAPABILITY?   47200002
         BZ    NXTMINOR            NO, GET NEXT MINOR            Y02669 47400002
         SPACE                                                          47450002
         TM    UCMDISP,UCMDISPC    IS THIS CONSOLE A GRAPHIC DEVICE?    47500002
         BO    NXTMINOR            YES, GET NEXT MINOR           Y02669 47550002
         EJECT                                                          48400002
*********************************************************************** 48450002
*                                                                     * 48500002
*                 DECREMENT USE COUNT IN MINOR WQE'S                  * 48550002
*                                                                     * 48600002
*********************************************************************** 48610002
         SPACE 2                                                        48650002
MINLOOP  EQU   *                                                        49000001
         LA    WQEREG,N0(WQEREG)   ZERO HI ORDER BYTE OF MIN WQE YM2304 49200001
         LTR   WQEREG,WQEREG       IS IT A VALID POINTER?        YM2304 49400002
         BZ    ENDSRCH             NO, END SCAN                         49600002
         DROP  CQEREG                                                   49650002
         SR    R5,R5               CLEAR REG                     Y02669 49800002
         IC    R5,WMNMUC1          GET USE COUNT FROM MINOR      Y02669 50600002
         BCTR  R5,N0               DECREMENT USE COUNT BY ONE    Y02669 50800002
         STC   R5,WMNMUC1          PUT NEW COUNT BACK IN MINOR   Y02669 51000002
         LTR   R5,R5               IS THE USE COUNT ZERO?        Y02669 51200002
         BNZ   NXTMINOR            NO                            Y02669 51400002
         OI    WMJMMLW,WMJMMLWG    SERVICE THIS CHAIN = ON     @YM8168P 51800002
NXTMINOR EQU   *                                                        52200001
         L     WQEREG,N0(WQEREG)   LOAD PTR TO NEXT MINOR WQE    YM2304 52400001
         B     MINLOOP                                                  52600001
         EJECT                                                          55400002
*********************************************************************** 55450002
*                                                                     * 55460002
*                       NORMAL EXIT                                   * 55470002
*                                                                     * 55480002
* NOTE: LOCKS ARE ALWAYS HELD ON ENTRY TO IEE7803D                    * 55490002
*             1. RELEASE LOCKS                                        * 55492002
*             2. ISSUE A DOM MACRO TO BUILD AN SSIB AND SSOB   @Y02669P 55494002
*                   TO INFORM THE SUBSYSTEM THE MLWTO HAS BEEN @Y02669P 55496002
*                   DELETED                                    @Y02669P 55498002
*********************************************************************** 55500002
         SPACE 2                                                        55550002
ENDSRCH  EQU   *                                                        55600002
         OI    UCMSTS,UCMPF        TURN ON OUTPUT PENDING BIT           55650002
         NI    UCMSTS,XFF-UCMTC    WORKING ON INLINE MLWTO=OFF   Y02669 55700002
         NI    UCMSDS5,XFF-UCMSDS5A WAITING ON INLINE MLWTO=OFF  Y02669 55750002
         STM   MYBASE,R14,XASAVLOC SAVE REGS AROUND SETLOCK      Y02651 55900002
         SETLOCK RELEASE,TYPE=CMS,RELATED=(K,IEE7503D(LOCKSET))         55950002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(K,IEE7503D(LOCKSET))       56000002
         LM    MYBASE,R14,XASAVLOC RESTORE REGS AFTER SETLOCK    Y02651 56050002
         NI    XASSDS,XFF-XASSDS5  INDICATE LOCKS NOW OFF        Y02651 56100002
         DOM   MSG=(9)                                         @Y02668P 65100002
         BR    R14                 RETURN TO SYSTEM              Y02669 69800002
         EJECT                                                          69802002
*********************************************************************** 69810002
*                                                                     * 69820002
*                       ERROR EXITS                                   * 69830002
*                                                                     * 69840002
*********************************************************************** 69842002
         SPACE 2                                                        69844002
BADKOP   EQU   *                                                 Y02669 69850002
         MVI   XAE,MSG156          IEE156I INVALID OPERAND       Y02669 69900002
         ST    KOPS,XASTSAVE       ADDR OF INVALID OPERAND       Y02669 69950002
         B     D5603D              GO TO WRITE ERROR MSG         Y02669 69960002
         SPACE 2                                                        69970002
DERR927  EQU   *                                                 Y02669 70000002
         ST    KOPS,XASTSAVE       CURSOR ADDRESS FOR MSG RTN           70200001
         MVI   XAE,MSG927          IEE927I REQUEST AMBIGIOUS     Y02669 70400002
         MVI   XASTSAVE,MSG927I    2ND CODE - SPECIFY DISPLAY ID Y02669 70600002
         SPACE 2                                                        70650002
D5603D   EQU   *                                                 Y02669 71400002
         L     R15,VCON5603        GET ADDRESS OF MESSAGE MODULE Y02669 73250002
         BR    R15                 GO ISSUE ERROR MESSAGES       Y02669 73300002
        EJECT                                                           84450002
*********************************************************************** 84600001
*                                                                     * 84800002
*                           CONSTANTS                                 * 85000002
*                                                                     * 85200002
*********************************************************************** 85400001
         SPACE 2                                                        85450002
         DS    0F                  ALIGN ON WORD BOUNDARY               85600001
B1000    DC    F'1000'             COMPARE FOR MLWTOID OVER 1000  M2772 85850002
VCON5603 DC    V(IEE5603D)         MSG MOD                       Y02669 86406002
         SPACE 5                                                        86410002
*********************************************************************** 86412002
*                                                                     * 86420002
*                             PATCH AREA                              * 86430002
*                                                                     * 86450002
*********************************************************************** 86500002
         SPACE 2                                                        86550002
PATCH    DC    C'****PATCH AREA****'                                    86600001
PATCH2   DC    C'IEE7803D-TEST ONLY'                                    86800001
PATCH3   DC    36C' '                                                   87000001
         EJECT                                                          87200001
         IEECUCM  FORMAT=NEW                                            88200002
         EJECT                                                          88400001
         IHACTM CQE                                              Y01939 88410001
         EJECT                                                          88420001
         IHAWQE DSECT=YES                                        YM2304 88450001
         EJECT                                                          89600001
FAUXSA   DSECT                                                          89800001
         IEEXSA                                                         90000001
         EJECT                                                          91800001
CVTSECT  DSECT                                                          92000001
         CVT                                                            92200001
         EJECT                                                          92250002
         IHAPSA                                                         92300002
         END                                                            92800001
