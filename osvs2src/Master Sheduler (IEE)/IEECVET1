         TITLE 'IEECVET1, ALIAS - IGC5107B - PROCESSOR 1'               00100000
IEECVET1 CSECT                                                          00200000
         ENTRY IGC5107B                                                 00300000
* A 085100-085492,253530-253546,312404-313621                 JE YM6718 00600003
* ET1RTY(A,C,D) APPROX. 817000                                 @ZA29665 00620003
* CONSWTCH(A) APPROX. 870000                                   @ZA29665 00640003
* NOESTAE(C) APPROX. 164000                                    @ZA29401 00660003
         EJECT                                                          00700000
*                                                                       00800000
* STATUS       CHANGE LEVEL 1 VS2 RELEASE 3                             00900000
*                                                                       01000000
*                                                                       01200000
* FUNCTION     ROUTE CONTROL TO ROUTINES ON THE BASIS OF FUNCTION       01300000
*              NEEDED.                                                  01400000
*                                                                       01500000
* STATUS -                                                              01600000
*                                                                       01700000
*  PTMS FIXED @YM8452                                                   01800000
*  APARS FIXED ZA00506,ZA00513,ZA00539,ZA02303,ZA02341,ZA02835,ZA04689, 01900000
*              ZA06411,ZA10109,ZA13458,ZA14126,ZA16376,ZA16389,ZA13189, 02000003
*              ZA29665,ZA29401                                          02030003
* ENTRY POINT  IEECVET1                                                 02100000
*                                                                       02200000
* INPUT        REGISTER 1 CONTAINS A POINTER TO A PARAMETER LIST MAPPED 02300000
*              BY CXSA                                                  02400000
*              BIT SETTINGS ON INPUT INDICATING TYPE OF ACTION REQUIRED 02500000
*                UCMSTS                                                 02600000
*                  UCMAF  ATTENTION                                     02700000
*                  UCMPF  OUTPUT PENDING                                02800000
*                  UCMCF  CLOSE REQUEST                                 02900000
*                  UCMTA  OPEN PENDING                                  03000000
*                UCMSDS5                                                03100000
*                  UCMSDS5B  INLINE OUTPUT PENDING                      03200000
*                  UCMSDSD8  OUT OF LINE OUTPUT PENDING                 03300000
*                UCMDEVC                                                03400000
*                  UCMDEVD  DOM ISSUED                                  03500000
*                DCMCS                                                  03600000
*                  DCMCSO   REOPEN DEVICE                               03700000
*                UCMMODE                                                03800000
*                  HARDBIT  NO HARD COPY                                03900000
*                                                                       04000000
*                DCMCOM1                                                04100000
*                  DCMIOPRD  A READ WAS PERFORMED- EXAMINE INPUT        04200000
*                                  (FOR DEVICES THAT DO RMI AND READ    04300000
*                                   IN SEPARATE I/O)                    04400000
*                  DCMCOMRM  RMI PERFORMED -CHECK RMI INPUT             04500000
*                DCMCOM2                                                04600000
*                   DCMCMIN5 RETURN TO INTERFACE 5                      04700000
*                DCMCOM3                                                04800000
*                  DCMRTPFK  RETURN TO PFK ROUTINE                      04900000
*                  DCMVLPFK  COMMAND BEING VERIFIED                     05000000
*                  DCMOLUNV  NEED UNVIEWABLE MSG MESSAGE                05100000
*                  DCMSTSWT  SWITCH USE OF CONSOLE                      05200000
*                  DCMCMIN7  RETURN TO INTERFACE 7                      05300000
*                DCMIOCM3                                               05400000
*                  DCMPFKAT  PFK ATTENTION                              05500000
*                  DCMACPFK  LIGHT ACTIVE PFK                           05600000
*                  DCMLTPFK  LIGHT ALLOCATED PFKS                       05700000
*                DCMTIMES                                               05800000
*                  DCMTIMER  TIMER HAS ELAPSED                          05900000
*                  DCMGROLL  READY FOR ROLL                             06000000
*                  DCMTASYN  PERFORM CANCEL AFTER AN ASYNCHRONOUS       06100000
*                                   ERROR                               06200000
*                DCMADKP - WORD                                         06300000
*                  IF NON-ZERO, INDICATES ROUTED COMMAND ON Q           06400000
*                                                                       06500000
* OUTPUT       STATUS IN UCM ENTRY AND DCM                              06600000
*              ON EXIT TO THE SECOND LOAD, REGISTER 2 CONTAINS          06700000
*                   A BRANCH CODE ACCORDING TO THE FUNCTION             06800000
*                   TO BE PERFORMED                                     06900000
*                                                                       07000000
* EXTERNAL REFERENCES  NONE                                             07100000
*                                                                       07200000
* EXITS-NORMAL      1. IEECVETG OPEN-CLOSE                              07300000
*                   2. IEECVETC ASYNCHRONOUS ERROR                      07400000
*                   3. IEECVET4 COMMAND                                 07500000
*                   4. IEECVET2 DISPLAY 1                               07600000
*                   5. IEECVET7 DELETE 2                                07700000
*                   6. IEECVET9 DELETE 4                                07800000
*                   7. IEECVFTP STATUS DISPLAY INTERFACE 5              07900000
*                   8. IEECVETJ ROLL                                    08000000
*                   9. IEECVETK TIMER-INTERPRETER                       08100000
*                   10.IEECVFTM STATUS DISPLAY INTERFACE 2              08200000
*                   11.IEECVETF LIGHT PEN-CURSOR                        08300000
*                   12.IEECVETH OR P OR R  DEVICE-DEPENDENT IO          08400000
*                   13.ROUTER                                 MD Y01958 08500000
*                   14.IEECVFTA PFK ROUTINE 1                           08600000
*                   15.IEECVFTL STATUS DISPLAY INTERFACE 1              08700000
*                   16.IEECVFT1 PROCESSOR 0                             08800000
*                   17.IEECVFT7 STATUS DISPLAY INTERFACE 7              08900000
*                   18.IEECVETD MESSAGE 1                               09000000
*                                                                       09100000
* TABLES/WORK AREAS                                                     09200000
*                   DCM - DISPLAY CONTROL MODULE                        09300000
*                        SPLIT IN TWO PORTIONS                          09400000
*                        1. RESIDENT PORTION - ALWAYS IN CORE           09500000
*                        2. PAGEABLE  PORTION - IN VIRTUAL MEMORY       09600000
*                   UCM - UNIT CONTROL MODULE                           09700000
*                   CXSA - COMMUNICATIONS TASK EXTENDED SAVE AREA       09800000
*                                                                       09900000
* ATTRIBUTES   REFRESHABLE, PRIVILEGED, TYPE 4 SVC                      10000000
*                                                                       10100000
* NOTES        THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON        10200000
*              A PARTICULAR INTERNAL REPRESENTATION OF THE              10300000
*              EXTERNAL CHARACTER SET                                   10400000
*                                                                       10500000
*                                                                       10600000
*                                                                       10700000
*        REGISTER EQUATES                                               10800000
*                                                                       10900000
XFBRANCH EQU   15        BRANCH EXIT TO OTHER ROUTINES                  11000000
*                        CONTENTS MAY CHANGE FOR SVC CALLS              11100000
XERTRN   EQU   14        RETURN BRANCH REG                              11200000
*                        CONTENTS MAY CHANGE FOR SVC CALLS              11300000
XDCXSA   EQU   13        CXSA BASE REG                                  11400000
XCPBASE  EQU   12        PROGRAM BASE REG                               11500000
XBTDCM   EQU   11        PAGEABLE DCM BASE REG                          11600000
XARDCM   EQU   10        RESIDENT DCM BASE REG                          11700000
X9UCM    EQU   9         UCM BASE REG                                   11800000
X8UCME   EQU   8         UCM ENTRY BASE REG                             11900000
X7UCB    EQU   7         UCB BASE                                       12000000
X6       EQU   6                                                        12100000
X5       EQU   5                                                        12200000
X4WORK   EQU   4                                                        12300000
X3MASK   EQU   3         MASK REGISTER                                  12400000
X2WORK   EQU   2         WORK REG                                       12500000
X1PARM   EQU   1         CXSA ADDRESS ON ENTRY AND EXIT                 12600000
*                        CONTENTS MAY CHANGE FOR SVC CALLS              12700000
X0       EQU   0         CONTENTS MAY CHANGE FOR SVC CALLS              12800000
         EJECT                                                          12900000
IGC5107B BALR  XCPBASE,N0          ESTABLISH REG FOR                    13000000
         USING *,XCPBASE           PROGRAM ADDRESSABILITY               13100000
         B     BEGIN               BRANCH AROUND PATCH AREA             13200000
ICATCH   DC    CL8'IEECVET1'       EYECATCHER AND FIELD MAINTENANCE     13300000
         DC    CL16' ALIAS IGC5107B'                                    13400000
         DC    XL2'4309'           JULIAN DATE LAST CHANGE  JE @ZA02303 13500000
         DC    CL8'&SYSDATE'       DATE LAST ASSEMBLY                   13600000
         DC    S(*)                                                     13700000
         DC    CL40' '             PATCH AREA                           13800000
BEGIN    EQU   *                   END OF PATCH AREA                    13900000
         USING CXSA,XDCXSA         CXSA ADDRESSABILITY                  14100000
         LR    XDCXSA,X1PARM       SET CXSA ADDRESS           MB YM6305 14200000
         L     X8UCME,CSAUCM       ESTABLISH REG FOR                    14300000
         USING UCMLIST,X8UCME      UCM ENTRY ADDRESSABILITY             14400000
*                                                                       14500000
*                 SETUP ESTAE ENVIRONMENT                               14600000
*                                                                       14700000
         ICM   X4WORK,15,CSANPTR   GET RECOVERY AREA          JE YM6718 14800000
         BZ    NOESTAE             NOT THERE, BYPASS          JE YM6718 14900000
         USING PARMLIST,X4WORK                                          15000000
         LA    X2WORK,ET1RTY       GET COMMON RECOVERY       JE @YM8452 15100000
         C     X2WORK,PARMRTAD    OUR RETRY ALREADY IN STACK JE @YM8452 15200000
         BE    NOESTAE             YES, LEAVE IT             JE @YM8452 15300000
         MVC   CSAXB(N8),RELEASED  NO,ESTAB LOCKING ADDRESSES          *15400000
                                   FOR RETRY ROUTINE         JE @YM8452 15500000
         MVC   CSANAME(8),PARMRTAD SAVE RETRY & REGSAVE       JE YM6718 15600000
         ST    X2WORK,PARMRTAD      ADDR & SAVE IT            JE YM6718 15700000
         DROP X4WORK                                                    15800000
NOESTAE  DS    0H                                             JE YM6718 15900000
         L     XARDCM,UCMXB        ESTABLISH REG FOR                    16000000
         USING DCMTSRT,XARDCM      RESIDENT DCM ADDRESSABILITY          16100000
         L     XBTDCM,DCMADTRN     ESTABLISH REG FOR                    16200000
         USING DCMSTRT,XBTDCM      PAGEABLE DCM ADDRESSABILITY          16300000
         ICM   X4WORK,15,DCMCXSVE  CSA POINTER INIT            @ZA29401 16350003
         BNZ   GOTDCM              YES DCM EXISTS              @ZA29401 16500003
         LA    0,SP241             SUBPOOL FOR GETMAIN        MB YM4087 16600000
         SLL   0,24                PUT IT IN HI ORDER BYTE    MB YM4087 16700000
         ICM   0,M3,DCMLEN         LENGTH FOR GETMAIN         MB YM4087 16800000
         GETMAIN R,LV=(0)          GET DCM CORE               MB YM4087 16900000
         LH    X3MASK,DCMLEN       DCM LENGTH                 MB YM4087 17000000
         LR    X5,X3MASK           FOR COPYING DCM            MB YM4087 17100000
         LR    X2WORK,X1PARM       MOVE TO ADDRESS            MB YM4087 17200000
         LR    X4WORK,XBTDCM       MOVE FROM ADDRESS          MB YM4087 17300000
         MVCL  X2WORK,X4WORK       COPY TDCM                  MB YM4087 17400000
         LR    X4WORK,XBTDCM       MODEL ADDRESS              MB YM4087 17500000
         LR    XBTDCM,X1PARM       NEW TDCM ADDRESS           MB YM4087 17600000
         ST    XBTDCM,DCMADTRN     RDCM POINTS TO TDCM        MB YM4087 17700000
         ST    X4WORK,DCMSTRT      TDCM POINTS TO MODEL       MB YM4087 17800000
         LA    X5,DCMBUFAD         FIRST ADCON                MB YM4087 17900000
         LA    X2WORK,4            BXLE INCREMENT             MB YM4087 18000000
         LA    X3MASK,DCMPFKLN     LAST ADCON                 MB YM4087 18100000
RELOC    EQU   *         TOP OF BXLE LOOP                     MB YM4087 18200000
         L     X1PARM,N0(X5)       GET ADCON VALUE            MB YM4087 18300000
         SR    X1PARM,X4WORK       GET DCM DISPLACEMENT       MB YM4087 18400000
         BM    NXTADDR             SKIP NEG DISPLACEMENT      MB YM4087 18500000
         AR    X1PARM,XBTDCM       GET RELOCATED VALUE        MB YM4087 18600000
         ST    X1PARM,N0(X5)       STORE IT                   MB YM4087 18700000
NXTADDR  BXLE  X5,X2WORK,RELOC     DO THE REST                MB YM4087 18800000
GOTDCM   ST    XDCXSA,DCMCXSVE     SAVE CXSA POINTER                    18900000
         L     X9UCM,CSACTLM       ESTABLISH REG FOR                    19000000
         USING UCM,X9UCM           UCM ADDRESSABILITY                   19100000
         TM    DCMMCSST,DCMDUSE    RE-ENTRY FROM DIDOCS                 19200000
         BZ    SAVE14              NO, SET UP INITIAL TRACE ENTRY       19300000
         TM    UCMSTS,UCMTA        OPEN PENDING ON RE-ENTRY             19400000
         BZ    TRACE               NO, ET1 ENTRY IS RECURSIVE           19500000
* NOTE: IF DCMDUSE AND UCMTA ARE BOTH ON, THIS IS AND ENTRY             19600000
*       TO OPEN THE CONSOLE AFTER A COMTASK ABEND THAT HAPPENED         19700000
*       WHILE DIDOCS WAS IN CONTROL FOR THIS CONSOLE AND DCMDUSE        19800000
*       WAS NEVER TURNED OFF.                                           19900000
SAVE14   EQU   *                                                        20000000
         ST    XERTRN,CSAXA        SAVE RETURN REG                      20100000
         OI    DCMMCSST,DCMDUSE    INDICATE OUR ROUTINES IN CONTROL     20200000
         MVC   CSAXB(N8),RELEASED INITIALIZE SETLOCK ADDRESSES  @YM8452 20300000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD ENTRIES            20400000
         MVI   DCMTREN1,CSTAR      MOVE IN '**' TO                      20500000
         MVI   DCMTREN2,CSTAR      INDICATE NEW DIDOCS ENTRY            20600000
         B     OBTAIN              GET LOCKS                            20700000
TRACE    EQU   *                   LOG ET1 ENTRY                        20800000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2 SHIFT OLD ENTRIES            20900000
         MVI   DCMTREN1,ID1        MOVE IN MODULE ID OF                 21000000
         MVI   DCMTREN2,ID2        'E1' FOR IEECVET1                    21100000
OBTAIN   EQU   *                                                        21300000
         LR    X1PARM,XDCXSA       SET INPUT ADDRESS          MB YM6305 21400000
         L     XFBRANCH,CSAXB      ADDRESS GETLOCK SUBROUTINE           21500000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS                         21600000
TESTOP   EQU   *                                               @ZA16376 21620000
         TM    UCMSTS,UCMTA        Q. OPEN PENDING             @ZA16376 21640000
         BO    SETOPEN             YES, GO OPEN                @ZA16376 21660000
TSTDOM   EQU   *                                                        21700000
*        TEST FOR DOM BEFORE ALL ELSE                                   21800000
         TM    UCMDEVC,UCMDEVD     WAS A DOM DONE                       22000000
         BNO   BUSY                NO, CONTINUE                         22100000
         L     XFBRANCH,DCMNDEL2   LOAD DELETE 2 ADDRESS                22300000
         B     PGONE               EXIT TO IEECVET7            @ZA10109 22400000
*  THIS SECTION OF CODE WILL TEST FOR POSTING OF THE ECB                22500000
*    IF THE ECB WAS POSTED FOR THE TIMER, AN EXIT WILL EVENTUALLY BE    22600000
*      MADE TO THE ROLL MODE OR TIMER INTERVAL CONTROL RTN              22700000
*    IF THE ECB WAS POSTED TO SIGNAL QUEUEING OF A ROUTED               22800000
*      COMMAND, THE COMMAND WILL EVENTUALLY BE FOUND ON THE             22900000
*      QUEUE AND HANDLED.                                               23000000
*    IF THE ECB WAS POSTED TO SIGNAL THAT THE USE OF THE USE OF         23100000
*      THE CONSOLE IS TO BE CHANGED, ALL OTHER WORK IS HANDLED          23200000
*      FIRST, AND THEN EXIT IS MADE TO THE DEVICE DEPENDENT IO          23300000
*      MODULE                                                           23400000
*    IF THE ECB WAS POSTED FOR AN I/O COMPLETE, A TEST WILL BE MADE TO  23500000
*      DETERMINE IF THE I/O WAS GOOD                                    23600000
*    IF THE I/O WAS NOT GOOD, AN EXIT WILL BE MADE TO THE ERROR RTN SO  23700000
*      THAT CONSOLE SWITCHING CAN BE PERFORMED                          23800000
BUSY     EQU   *                                                        23900000
         CLI   UCMECB,BLANK        ECB POSTED OTHER THAN FOR IO         24100000
         BNE   CHKIO               NO, GO CHECK FOR IO                  24200000
         CLI   UCMECB+N3,N255      LOW ORDER BYTE FF (ROLL MODE)        24500000
         BE    ZEROECB             YES, ZERO ECB                        24600000
         CLI   UCMECB+N3,CMNDCODE  ECB POSTED FOR ROUTED COMMAND        24700000
         BE    ZEROECB             YES, ZERO ECB                        24800000
         CLI   UCMECB+N3,KV        CONSOLE USE TO BE CHANGED            24900000
         BE    ZEROECB             YES, ZERO ECB                        25000000
         B     ERROR               IF NONE OF THESE, GO TO              25100000
*                                  ASYNCHRONOUS ERROR                   25200000
CHKIO    EQU   *                                                        25300000
         TM    UCMSTS,UCMBF        CONSOLE BUSY                         25500000
         BNO   TEST                NO. TEST REASON FOR ENTRY  MB YM5671 25600000
         TM    UCMECB,IOWAIT       WAIT BIT ON                          25800000
         BO    TEST                YES, TEST REASON FOR ENTRY MB YM5671 25900000
         CLI   UCMECB,ZERO         Q.IS ECB ZERO                        26000000
         BNE   CHKPFK1             YES, TEST FOR PFK I/O    JE @ZA00513 26100000
         TM    UCMDEVC,UCMDEVE     I/O COMPLETE ON          JE @ZA00513 26200000
         BO    ERROR               YES, GO SWITCH CONSOLES  JE @ZA00513 26300000
         B     TEST                ELSE, SEE WHY ENTERED    JE @ZA00513 26400000
         SPACE 5                                                        26500000
CHKPFK1  DS    0H                                           JE @ZA00513 26600000
         TM    DCMR3FLG,DCMR3PKA   IS THIS IO COMPLETE FOR PFK          26700000
         BO    PRC0EXIT            YES LET PROC 0 HANDLE IT             26800000
         SPACE 5                                                        26900000
         NI    UCMDEVC,N255-UCMDEVE  TURN OFF I/O COMPLETE FLAG         27100000
         NI    UCMSTS,N255-UCMBF   YES, TURN OFF BUSY BIT               27200000
         TM    UCMECB,IOGOOD       WAS I/O GOOD                         27400000
         BO    ZEROECB             YES, GO ZERO ECB                     27500000
         TM    DCMR3FLG,DCMCLPR    CLOSE IN PROGRESS                    27600000
         BO    ZEROECB             YES, IGNORE BAD I/O                  27700000
ERROR    EQU   *                                                        27800000
         L     XFBRANCH,DCMNERRO   LOAD ERROR RTN ADDRESS               28000000
         B     PMGONE              EXIT TO IEECVETC                     28100000
SETOPEN  EQU   *                                                        28200000
         MVI   CSACODE,CSAOPEN     INDICATE OPEN                        28400000
*              ONE LINE OF CODE DELETED HERE                   @ZA16389 28500000
         NI    UCMDEVC,N255-UCMDEVE  TURN OFF I/O COMPLETE     @ZA13458 28600000
OPENEXT  EQU   *                   EXIT TO IEECVETG                     28700000
         L     XFBRANCH,VOPCL      LOAD OPEN RTN ADDRESS                28800000
PMGONE   EQU   *                                                        28900000
         NI    DCMCOM1,N255-DCMLPENT-DCMCOMRM  TURN OFF BITS            29000000
PGONE    EQU   *                                               @ZA10109 29050000
         L     X1PARM,DCMCXSVE     RESTORE CXSA ADDRESS                 29100000
         BR    XFBRANCH            EXIT TO ADDRESSED ROUTINE            29200000
ZEROECB  EQU   *                                                        29300000
         MVI   UCMECB,ZERO         CLEAR I/O ECB                        29500000
         NI    UCMDEVC,N255-UCMDEVE TURN OFF I/O COMPLETE   JE @ZA00513 29600000
TEST     EQU   *                   TEST ASYNCHRONOUS SENSE    MB YM5671 29700000
         TM    UCMSTS,UCMAF        ATTENTION RECEIVED         MB YM5671 29800000
         BNO   TSTBSY              NO, GO TO NEXT TEST        MB YM5671 29900000
         L     X7UCB,UCMUCB        ADDRESS CONSOLE UCB        MB YM5671 30000000
         USING UCBOB,X7UCB         UCB ADDRESSABILITY         MB YM5671 30100000
         TM    UCBSNS,ASYNCHK      ASYNCHRONOUS ERROR         MB YM5671 30200000
         BNZ   ERROR               YES, GO CHECK IT OUT       MB YM5671 30300000
         NI    DCMASYNC,N255-DCMASDA-DCMASIN-DCMASBA-DCMASLOG           30330000
*                                  RESET ERROR BITS            @ZA14126 30360000
TSTBSY   EQU   *                                                        30400000
         TM    UCMSTS,UCMBF        Q. IS BUSY BIT ON                    30600000
         BO    REST14              YES, WAIT FOR I/O                    30700000
         TM    DCMR3FLG,DCMCLPR    Q. CLOSE IN PROGRESS                 30800000
         BO    TESTCL              YES, CONTINUE HANDLING CLOSE         30900000
*********************************************************************** 31100000
*              THREE LINES MOVED JUST PRIOR TO LABEL TSTDOM   @ZA16376* 31200000
*********************************************************************** 31300000
TESTREO  EQU   *                                                        31500000
         TM    DCMCS,DCMCSO        Q. REOPEN DEVICE                     31600000
         BNO   TESTCL              NO, GO TEST FOR CLOSE                31700000
         OI    DCMR3FLG,DCMSTSWT   YES,INDICATE STATUS CHANGING         31800000
IOEXIT   EQU   *                                                        32000000
         L     XFBRANCH,DCMIORTN   LOAD IO ROUTINE ADDRESS              32100000
         B     PMGONE              EXIT TO IEECVET(H,P,R, OR U)         32200000
TESTCL   EQU   *                                                        32400000
         TM    UCMSTS,UCMCF        Q.WAS CLOSE REQUESTED                32500000
         BO    CLOSE            EXIT TO LOAD 2                          32600000
TSTCLCL  EQU   *                                                        32700000
         TM    DCMR3FLG,DCMCLPR    Q. CLOSE IN PROGRESS                 32900000
         BNO   TESTRD             NO, GO TEST FOR DOM                   33000000
         NI    DCMR3FLG,N255-DCMCLPR  TURN OFF CLOSE IN PROGRESS        33100000
         B     PFKCODE             RETURN TO MCS                        33200000
TESTRD   EQU   *                                                        33400000
         TM    DCMCOM1,DCMIOPRD    Q.WAS A READ PERFORMED               33500000
         BO    FIND                YES, GO EXAMINE INPUT                33600000
         TM    DCMCOM1,DCMCOMRM    Q. WAS A RMI PERFORMED               33800000
         BO    TSTRMI              YES, GO CHECK RMI INPUT              33900000
CHKCMDQ  EQU   *                                                        34000000
         L     X2WORK,DCMADKP      GET POINTER TO QUEUE OF              34200000
*                                       ROUTED COMMANDS                 34300000
* A NON-ZERO POINTER INDICATES A ROUTED COMMAND ON THE QUEUE.           34400000
*    IF THE COMMAND HAS BEEN HANDLED ALREADY, THE PARAMETER LIST        34500000
*    MUST BE FREED.  OTHERWISE BRANCH TO THE MODULE ADDRESSED IN        34600000
*    THE PARAMETER LIST TO HANDLE THE COMMAND.                          34700000
TESTKQ   EQU   *                                                        34800000
         LTR   X2WORK,X2WORK       ANY COMMANDS ON Q                    34900000
         BZ    LPCENT              NO, GO TEST NEXT FUNCTION            35000000
         USING KPARAM,X2WORK                                            35100000
RTCMDQ   EQU   *                                                        35300000
         TM    KFLGS,KGM           WAS THIS PARAMETER LIST             X35400000
                                        GETMAINED                       35500000
         BO    GMPARAM             YES, GO HANDLE GETMAINED TYPE        35600000
         XC    DCMADKP(N4),DCMADKP NO, THERE CAN ONLY BE ONE           X35800000
                                   COMMAND - DEQUEUE IT                 35900000
         B     KMODEXIT            EXIT TO INDICATED ROUTINE            36000000
GMPARAM  EQU   *                                                        36100000
         TM    KFLGS,KSRVCD        HAS THIS COMMAND BEEN SERVICED       36300000
         BO    FREE                YES, BRANCH TO FREE THE              36400000
*                                       PARAMETER LIST                  36500000
         OI    KFLGS,KSRVCD        INDICATE SERVICED                    36700000
KMODEXIT EQU   *                                                        36800000
         LA    X4WORK,KOPN         GET ADDRESS OF OPERAND FIELD         37000000
         ST    X4WORK,DCMADOPN     STORE ADDR OF OPERAND FIELD          37100000
         L     XFBRANCH,KMOD       BRANCH TO MODULE INDICATED IN        37200000
         B     PMGONE                   PARAMETER LIST                  37300000
FREE     EQU   *                                                        37400000
         L     X1PARM,KCHAIN     BASE NEXT KPARAM LIST                  37600000
         ST    X1PARM,DCMADKP    AND SAVE ITS ADDRESS                   37700000
         LR    X1PARM,XDCXSA       ADDRESS CXSA FOR FREELOCK  MB Y02958 37900000
         L     XFBRANCH,CSAXC      ADDRESS RELEASE SUBROUTINE MB Y02958 38000000
         BALR  XERTRN,XFBRANCH     RELEASE LOCKS FOR FREEMAIN MB Y02958 38100000
         FREEMAIN R,SP=SP241,LV=KPLLNGTH,A=(X2WORK)           MB Y02958 38200000
         LR    X1PARM,XDCXSA       ADDRESS CXSA FOR FREELOCK  MB Y02958 38300000
         L     XFBRANCH,CSAXB      ADDRESS OBTAIN SUBROUTINE  MB Y02958 38400000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS               MB Y02958 38500000
         B     CHKCMDQ           BRANCH TO CHECK NEXT LIST              38600000
         DROP  X2WORK                                                   38700000
         EJECT                                                          38800000
CLOSE    EQU   *                                                        38900000
*   ERASE SCREEN BEFORE CLOSING DEVICE                                  39000000
         TM    DCMCOM2,DCMERPF     Q. HAS SCREEN BEEN ERASED            39200000
         BO    FINCLOSE            YES, EXIT TO OPEN/CLOSE RTN          39300000
         OI    DCMR3FLG,DCMCLPR    INDICATE CLOSE IN PROGRESS           39500000
         OI    DCMCOM2,DCMERPF     INDICATE ERASE PERFORMED             39700000
         OI    DCMIOCM2,DCMERASE   INDICATE ERASE SCREEN                39800000
         OI    DCMIOCM3,DCMACPFK   INDICATE TURN OFF PFKS               40000000
         B     IOEXIT              EXIT TO I/O RTN                      40100000
FINCLOSE EQU   *                                                        40200000
         OI    DCMCS,DCMCSO        INDICATE REOPEN FOR NEXT ENTRY       40400000
         MVI   CSACODE,CSACLOSE    CLOSE INDICATION TO CLOSE RTN        40500000
         B     OPENEXT             EXIT TO IEECVETG                     40600000
LPCENT   EQU   *                                                        40700000
         TM    DCMCOM1,DCMLPENT    Q. ENTER PERFORMED USING CURSOR OR   40900000
*                                   LIGHT PEN                           41000000
         BO    FIND                YES, GO EXAMINE INPUT                41100000
         TM    UCMSTS,UCMAF        Q. IS THERE AN ATTENTION             41300000
         BO    ATTEN               YES GO FIND TYPE                     41400000
TEST1    EQU   *                                                        41500000
         TM    DCMR2FLG,DCMRXTIM   HAS TIMER ELAPSED                    41700000
         BNO   TSTINT7             NO, CONTINUE TESTS                   41800000
TIMEXIT  EQU   *                                                        42000000
         L     XFBRANCH,DCMNTIMR   LOAD TIMER RTN ADDRESS               42100000
         B     PMGONE              EXIT TO IEECVETK                     42200000
TSTINT7  EQU   *                                                        42300000
         TM    DCMCOM3,DCMCMIN7    RETURN TO INTERFACE 7                42600000
         BNO   TSTINT5             NO, GO TO NEXT TEST                  42700000
INT7EXIT EQU   *                                                        42800000
         L     XFBRANCH,DCMNINT7   LOAD INTERFACE 7 ADDRESS             43000000
         B     PMGONE              EXIT TO IEECVFTT                     43100000
TSTINT5        EQU                 *                                    43200000
         TM    DCMCOM2,DCMCMIN5    Q. RETURN CONTROL TO                X43500000
                                        INTERFACE 5 FOR BLANKING        43600000
         BNO   SEARCH              NO, CONTINUE LOOKING FOR            X43700000
                                        SOMETHING TO DO                 43800000
INT5EXIT EQU   *                                                        43900000
         L     XFBRANCH,DCMNINT5   LOAD INTERFACE 5 ADDRESS             44100000
         B     PMGONE              EXIT TO IEECVFTQ                     44200000
         SPACE                                                          44300000
SEARCH   EQU   *                                                        44400000
* CHECK FOR ANY MESSAGES ON THE QUEUE TO BE OUTPUT                      44500000
* THE OUTPUT PENDING BITS OPERATE AS FOLLOWS:                           44600000
*     UCMPF - OUTPUT PENDING, EITHER INLINE OR OUT OF LINE              44700000
*              THIS BIT CAUSES THE PROCESSOR TO RECEIVE CONTROL.        44800000
*     UCMSDS5B - INLINE OUTPUT PENDING                                  44900000
*              THIS BIT IS ON WHENEVER MESSAGES TO BE WRITTEN           45000000
*              IN LINE ARE ON THE QUEUE, EVEN IF A FULL SCREEN          45100000
*              CONDITION EXISTS, UNLESS THE CONSOLE IS IN THE           45200000
*              MIDDLE OF WRITING OUT AN INLINE MLWTO.  IF THE           45300000
*              CONSOLE IS HANDLING AN MLWTO, THE INLINE PENDING         45400000
*              BIT WILL BE TURNED ON ONLY WHEN MORE LINES OF THE        45500000
*              SAME MLWTO ARE ADDED.                                    45600000
*     UCMSDS5C - OUT OF LINE OUTPUT PENDING                             45700000
*              THIS BIT IS ON WHENEVER A MESSAGE WHICH CAN NOW          45800000
*              BE WRITTEN OUT OF LINE IS ON THE QUEUE.  THIS BIT        45900000
*              IS NOT ON IF THE ONLY MESSAGES ON THE QUEUE TO BE        46000000
*              WRITTEN OUT OF LINE ARE TO BE WRITTEN TO AN AREA         46100000
*              WITH A FULL FRAME CONDITION.  IT IS TURNED OFF           46200000
*              IF THE CONSOLE IS IN HOLD MODE.                          46300000
         TM    UCMSDS5,UCMSDS5B    Q. INLINE OUTPUT PENDING             46500000
         BO    DISPTST             YES                                  46600000
         CLI   DCMDEL,R            CONSOLE IN ROLL MODE     JE @ZA02835 46700000
         BNE   OUTLNTST            NO, BYPASS NEXT TEST     JE @ZA02835 46800000
         TM    DCMR2FLG,DCMRXRLL   Q. READY FOR ROLL                    47000000
         BO    ROLEXIT             YES, EXIT TO ROLL ROUTINE            47100000
OUTLNTST EQU   *                                                        47200000
         TM    UCMSDS5,UCMSDS5C    Q. OUT OF LINE OUTPUT PENDING        47400000
         BO    TESTHOLD            YES, GO TEST FOR HOLD MODE           47500000
         TM    DCMCOM3,DCMOLHLD    Q. OUT OF LINE MSGS HELD             47700000
         BNO   OFFOP               NO, GO TURN OFF OUTPUT               47800000
*                                       PENDING FLAG                    47900000
TESTHOLD EQU   *                                                        48000000
         TM    DCMIOUNQ,DCMFRSCN   Q. SCREEN IN HOLD MODE               48200000
         BO    ONOLHLD             YES, HOLD OUT OF LINE MSGS           48300000
         NI    DCMCOM3,N255-DCMOLHLD TURN OFF OUT OF LINE               48500000
*                                       MSGS HELD BIT                   48600000
INT2EXIT EQU   *                                                        48700000
         L     XFBRANCH,DCMNINT2   LOAD INTERFACE 2 ADDRESS             48900000
         B     PMGONE              EXIT TO IEECVFTM                     49000000
ONOLHLD  EQU   *                                                        49100000
         OI    DCMCOM3,DCMOLHLD    INDICATE OUT OF LINE                 49300000
*                                       MESSAGES HELD                   49400000
         NI    UCMSDS5,N255-UCMSDS5C TURN OFF OUT OF LINE BIT           49600000
OFFOP    EQU   *                                                        49700000
         NI    UCMSTS,X'FF'-UCMPF  TURN OFF OUTPUT PENDING FLAG,        49900000
*                                       SINCE BOTH INLINE AND           50000000
*                                       OUT OF LINE OUTPUT HAVE         50100000
*                                       BEEN HANDLED BY THIS            50200000
*                                       POINT                           50300000
         SPACE                                                          50400000
TSTUNVW  EQU   *                                                        50500000
         TM    DCMCOM3,DCMOLUNV    DID OUT OF LINE MSG CAUSE           X50700000
                                        UNVIEWABLE MSGS                 50800000
         BNO   TSTPFK              NO, CONTINUE LOOKING FOR            X50900000
                                        SOMETHING TO DO                 51000000
         NI    DCMCOM3,N255-DCMOLUNV  YES, TURN OFF BIT                 51100000
         TM    DCMR2FLG,DCMRXUNV+DCMRXSFL Q. UNVIEWABLE MSG MSG        X51200000
                                        ALREADY ON SCREEN OR            51300000
*                                       SCREEN FULL (MSG WAITING       X51400000
                                        MSG ON SCREEN)                  51500000
         BNZ   TSTPFK              YES, CONTINUE LOOKING FOR           X51600000
                                   SOMETHING TO DO                      51700000
         CLI   DCMDEL,Y            DEL = Y                              51900000
         BNE   WRUNVW              NO, GO WRITE UNVIEWABLE MSG          52000000
         OI    DCMCOM1,DCMCOMAU    YES, INDICATE PERFORM AUTO          X52100000
                                        DELETE                          52200000
         OI    DCMDSTAT,DCMDSAUT   INDICATE AUTO DELETE TRIED           52300000
DEL4EXIT EQU   *                                                        52400000
         L     XFBRANCH,DCMNDEL4   LOAD DELETE 4 ADDRESS                52600000
         B     PMGONE              EXIT TO IEECVET9                     52700000
WRUNVW   EQU   *                                                        52800000
         OI    DCMCMSG1,DCMUNMSG   TURN ON UNVIEWABLE MSG BIT           53000000
         CLI   DCMDEL,R            ROLL MODE (OR ROLL DELETABLE)        53200000
         BE    XDISP               YES, EXIT TO DISPLAY 1               53300000
         L     XFBRANCH,DCMNMSG1   NO, LOAD MESSAGE 1 ADDRESS           53400000
         B     PMGONE              EXIT TO IEECVETD                     53500000
TSTPFK   EQU   *                                                        53600000
         TM    DCMIOCM3,DCMACPFK+DCMLTPFK   ANY PFKS TO BE LIT          53800000
         BO    IOEXIT              YES, GO DO IT                        53900000
         TM    DCMCOM3,DCMRTPFK    MORE PFK WORK TO DO                  54100000
         BNO   ONWARD              NO, CHECK NEXT FUNCTION              54200000
         TM    DCMCOM3,DCMVLPFK     YES, ARE WAITING FOR A VERIFY       54400000
         BNO   PFK1A                 NO, GO TO FINISH PFK WORK          54500000
ONWARD   EQU   *                                                        54600000
*** TESTS FOR MORE MORE FUNCTIONS MAY BE MADE HERE ***                  54700000
         TM    DCMR3FLG,DCMSTSWT   CONSOLE USE TO BE CHANGED            54900000
         BO    IOEXIT              YES, EXIT TO IO ROUTINE              55000000
PFKCODE  TM    DCMCOM3,DCMPFKWR    SHOULD PFKS BE WRITTEN               55200000
         BO    PRC0EXIT            YES, GO TO PROC ZERO                 55300000
         B     ROUTOUT             EXIT TO ROUTER                       55400000
DISPTST  EQU   *                                                        55600000
         CLI   DCMDEL,R            CONSOLE IN ROLL MOD      JE @ZA02835 55700000
         BNE   SCRFUL              NO, CONTINUE LOOKING     DC @ZA04689 55800000
         TM    DCMR2FLG,DCMRXRLL    Q. READY FOR ROLL                   55900000
         BO    ROLEXIT             YES                                  56000000
SCRFUL   TM    DCMR2FLG,DCMRXSFL   IS SCREEN FULL           DC @ZA04689 56200000
         BO    TSTROLL             GO TEST FOR ROLL MODE         A38905 56300000
         TM    UCMSTS,UCMTC        WORKING ON AN INLINE MLWTO           56500000
         BO    INT1EXIT            YES, CALL INTERFACE ROUTINES         56600000
XDISP    L     XFBRANCH,DCMNDSP1   LOAD DISPLAY ROUTINE ADDRESS         56800000
         B     PMGONE              EXIT TO IEECVET6                     56900000
INT1EXIT EQU   *                                                        57000000
         L     XFBRANCH,DCMNINT1   LOAD INTERFACE 1 ADDRESS             57200000
         B     PMGONE              EXIT TO IEECVFTN                     57300000
         SPACE 2                                                        57400000
TSTROLL  EQU   *                                                        57600000
         CLI   DCMDEL,R            Q. ROLL MODE                         57700000
         BNE   OUTLNTST            NO, CONTINUE LOOKING                 57800000
         L     X2WORK,DCMSUBAD     ESTABLISH REG FOR                    58000000
         USING DSUB,X2WORK         SUB ADDRESSABILITY                   58100000
         L     X2WORK,SUBPBASE     ESTABLISH REG FOR                    58200000
         USING SUBDCMB,X2WORK      BASE DCM ADDRESSABILITY              58300000
         TM    DCMIND,DCMTMRST     IS STIMER IN EFFECT YET              58500000
         BO    OUTLNTST            YES, CONT LOOKING FOR                58600000
*                                  SOMETHING TO DO                      58700000
         CLC   DCMWTBUF(N4),DCMASCRN STATUS DISPLAYS COVER             *58800000
               THE SCREEN                                     MB YM4360 58900000
         BE    OUTLNTST            YES,LOOK FOR OTHER WORK    MB YM4360 59000000
         B     XDISP               NO, GO TO DISPLAY ROUTINE            59100000
*                                  TO GET TIMER SET                     59200000
PRC0EXIT EQU   *                                                        59300000
         NI    DCMR3FLG,N255-DCMR3PKA     TURN OFF EXIT BIT             59500000
         L     XFBRANCH,DCMNPRZ    LOAD PROC 0 ADDRESS                  59600000
         B     PMGONE              EXIT TO IEECVETZ                     59700000
ROUTOUT  EQU   *      EXIT TO ROUTER                                    59800000
         TM    DCMRFLGS,DCMDOM     DOM DONE WHILE BUSY        MB YM4087 60000000
         BNO   REST14              NO, CONTINUE LOOKING       MB YM4087 60100000
         TM    UCMSTS,UCMBF        STILL BUSY                 MB YM4087 60200000
         BO    REST14              YES, WAIT FOR IO COMPLETE  MB YM4087 60300000
         NI    DCMRFLGS,N255-DCMDOM TURN OFF DOM DONE         MB YM4087 60400000
         TM    UCMATR,UCMUF        CONSOLE STILL ACTIVE     JE @ZA02303 60500000
         BNO   REST14              NO, EXIT TO COMM TASK    JE @ZA02303 60600000
         OI    DCMIOCM1,DCMWRMSG   WRITE MESSAGE AREA         MB YM4087 60700000
         B     IOEXIT              EXIT TO IO ROUTINE         MB YM4087 60800000
REST14   EQU   *                   NO LEFTOVER DOM WORK       MB YM4087 60900000
         NI    DCMMCSST,N255-DCMDUSE  INDIC OUR RTNS NO LONGER IN CONT  61000000
         L     XERTRN,CSAXA        RESET RETURN REG                     61100000
         ICM   X4WORK,15,CSANPTR   GET RECOVERY AREA          JE YM6718 61200000
         BZ    NOESTAE1            NOT THERE, BYPASS          JE YM6718 61300000
         USING PARMLIST,X4WORK                                          61400000
         MVC   PARMRTAD(8),CSANAME RESOTRE RETRY & REGSAVE    JE YM6718 61500000
NOESTAE1 DS    0H                                             JE YM6718 61600000
         TM    UCMATR,UCMUF        CONSOLE STILL ACTIVE       MB YM4087 61700000
         BO    DONTFREE            YES,KEEP GETMAINED DCM     MB YM4087 61800000
         MVC   DCMADTRN(N4),DCMSTRT POINT RDCM TO MODEL DCM   MB YM4087 61900000
         LA    XERTRN,FREEDCM      RETURN FROM FREELOCK       MB YM4087 62000000
DONTFREE EQU   *        RELEASE LOCKS FOR EXIT OR FREEMAIN    MB YM4087 62100000
         LR    X1PARM,XDCXSA       GET CXSA ADDR                        62200000
         LA    XFBRANCH,FREELOCK   ADDRESS FREELOCK SUBROUTINE          62300000
         BR    XFBRANCH            RELEASE LOCKS                        62400000
FREEDCM  EQU   *         FREE TDCM IF CONSOLE NOT ACTIVE      MB YM4087 62500000
         LH    X0,DCMLEN           FREEMAIN LENGTH            MB YM4087 62600000
         FREEMAIN RC,SP=SP241,LV=(0),A=(XBTDCM)               MB YM4087 62700000
         LR    X1PARM,XDCXSA       RESET CXSA IN REG 1        MB YM4087 62800000
         L     XERTRN,CSAXA        RESET RETURN REG           MB YM4087 62900000
         BR    XERTRN              EXIT FROM DIDOCS           MB YM4087 63000000
ROLEXIT  EQU   *                                                        63100000
         TM    DCMTIMES,DCMTASYN   Q. HAS TIMER ELAPSED FOR ASYN ERROR  63400000
         BO    CANCEL              YES, GO TO REWRITE SCREEN            63500000
         CLI   DCMRQDEL,BLANK      Q. IS A DELETE REQUEST PENDING       63700000
         BNE   XDISP               YES DO NOT ROLL                      63800000
         L     XFBRANCH,DCMNROLL   LOAD ROLL RTN ADDRESS                64000000
         B     PMGONE              EXIT TO IEECVETJ                     64100000
FIND     EQU   *                                                        64200000
         NI    DCMCOM1,N255-DCMLPENT-DCMIOPRD  TURN OFF BITS            64400000
* CODE WAS MOVED FROM HERE TO IEECVET4                                  64500000
CMD1EXIT EQU   *                                                        64600000
         L     XFBRANCH,DCMNCMD1        LOAD COMMAND RTN ADDRESS        64800000
         B     PMGONE                   EXIT TO IEECVET4                64900000
CANCEL   EQU   *                                                        65000000
         OI    DCMCOM1,DCMCANCL         INDICATE CANCEL KEY             65200000
         B     CMD1EXIT                 EXIT                            65300000
* ROUTINE FOR ROUTING ATTENTIONS                                        65400000
ATTEN    EQU   *                                                        65500000
         NI    UCMSTS,N255-UCMAF   TURN OFF ATTENTION FLAG              65700000
         TM    UCMDISP,UCMDISPG    Q. STATUS DISPLAY CONSOLE            65900000
         BO    TEST1               YES, IGNORE ATTENTION                66000000
         OI    DCMIOCM1,DCMDORMI   TURN ON BIT - ISSUE RMI              66200000
         B     IOEXIT              GO TO ROUTINE                        66300000
TSTRMI   EQU   *                                                        66400000
         TM    DCMIOUNQ,DCMIO226   Q.READ RMI PERF FOR 2260             66600000
         BO    IOEXIT              YES, EXIT TO I/O RTN -FIND CURSOR    66700000
         LA    X2WORK,DCMDSAV      GET ADDR WHERE RMI INFO RETURNED     66800000
         AH    X2WORK,DCMRMINC     ADD INCRE TO IT TO ACCOUNT FOR       66900000
*                                  DIFFERENT DEVICES                    67000000
         IC    X3MASK,DCMASKEN      LOAD REG WITH MASK FOR ENTER        67100000
         EX    X3MASK,TESTMASK      Q. ENTER KEY                        67300000
         BO    ENTER               YES, GO READ INPUT                   67400000
         IC    X3MASK,DCMASKLP      LOAD MASK FOR LIGHT PEN             67500000
         EX    X3MASK,TESTMASK      Q. LIGHT PEN                        67700000
         BO    ENTER                YES, GO READ INPUT                  67800000
         IC    X3MASK,DCMASKCN      LOAD MASK FOR CANCEL                67900000
         EX    X3MASK,TESTMASK      Q. CANCEL KEY                       68100000
         BO    CANCEL              YES, GO HANDLE CANCEL                68200000
PFK      IC    X3MASK,DCMASKPF      LOAD MASK FOR PFK ATTENTION         68300000
         EX    X3MASK,TESTMASK     WAS IT A PFK                         68500000
         BNO   ENTER               NO, CHECK NEXT FUNCTION              68600000
         B     PFK1                YES, GO TO TAKE CARE OF PFK          68700000
* ASSUME ENTER                                                          68800000
ENTER    EQU   *                                                        68900000
         TM    DCMTIMES,DCMTASYN   IS ASYNCHRONOUS ERR MSG ON SCREEN    69100000
         BO    CANCEL              YES, GO CANCEL                       69200000
         IC    X3MASK,DCMASKCR     INSERT CURSOR MASK                   69400000
         EX    X3MASK,TESTMASK      Q.CURSOR FOR 22D0C OR               69500000
         BO    TSTCRS              YES, GO TEST FOR CURSOR POSITION     69600000
* ANY DEVICE WITH PFK CAPABILITY MUST HAVE RMI & READ DONE SEPARATELY   69700000
         TM    DCMIOUNQ,DCMRDARM   Q. PERFORM A READ                    69900000
         BNO   FIND                NO, TEST INPUT                       70000000
         OI    DCMIOCM2,DCMIOCRD   TURN ON BIT- ISSUE READ              70100000
         B     IOEXIT              GO ISSUE  I/O                        70300000
TSTCRS   EQU   *                   MUST BE 220C,22D0C -CURS POS IN BYTE 70400000
         L     X3MASK,DCMBUFAD      GET DISPLACEMENT                    70600000
         LA    X3MASK,N4(X3MASK)      OF DCMBAENT                       70700000
         CLC   DCMDSAV(N2),N0(X3MASK)  Q. CURSOR IN MESSAGE AREA        70800000
         BL    FNDCRS              YES, GO TO LIGHT PEN/CURSOR          70900000
         CLC   DCMDSAV(N2),N2(X3MASK)  Q.CURSOR IN WARNING LINE         71000000
         BL    FIND                NO, GO EXAMINE INPUT                 71100000
FNDCRS   EQU   *                                                        71200000
         L     XFBRANCH,DCMNLPCR  LOAD CURSOR/LIGHT PEN ADDRESS         71400000
         B     PMGONE              EXIT TO IEECVETF                     71500000
PFK1     EQU   *                                                        71600000
         OI    DCMIOCM3,DCMPFKAT  INDICATE PFK ATTENTION OCCURRED       71800000
PFK1A    EQU   *                                                        71900000
         L     XFBRANCH,DCMNPFK1   LOAD PFK1 ROUTINE ADDRESS            72100000
         B     PMGONE              EXIT TO IEECVFTA                     72200000
*                                                                       72300000
*        EXECUTED INSTRUCTIONS                                          72400000
TESTMASK TM    N0(X2WORK),ZERO  TEST FOR DETERMINING ATTENTION TYPE     72500000
         EJECT                                                          72600000
*                                                                       72700000
*        OBTAIN LOCKS SUBROUTINE                                        72800000
*                                                                       72900000
         DROP X8UCME,X9UCM                                  JE @ZA02341 73000000
         USING UCM,14                                       JE @ZA02341 73100000
GETLOCK  EQU   *                                                        73200000
         USING *,XFBRANCH          SUBROUTINE ADDRESSABILITY BASED ON   73300000
*                                  ENTRY REGISTER                       73400000
         DROP  XDCXSA              DROP OLD CXSA BASE                   73500000
         USING CXSA,X1PARM         REG 1 ADDRESSES THE CXSA AS          73600000
*                                  AN INPUT PARAMETER                   73700000
         STM   11,13,CSAXD SAVE REGS OVER SETLOCK CALL       JE @YM8452 73800000
         LR    0,14                SAVE 14 OVER SETLOCK      JE @YM8452 73900000
GETLOCL  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        *74000000
               RELATED=(WQE,IEECVET1(FREELOCL))                         74100000
GETCMS   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                          *74200000
               RELATED=(UCM,IEECVET1(FREECMS))                          74300000
         L     14,CSACTLM          GET UCME ADDR             JE @YM8452 74400000
         L     11,UCMFRRAD         GET VCTR FRR RTN ADDR     JE @YM8452 74500000
         USING PSA,0                                         JE @YM8452 74600000
GETFRR   SETFRR A,FRRAD=(11),PARMAD=(13),WRKREGS=(12,13),              *74700000
                RELATED=(CMSLOCK,IEECVET1(FREEFRR))          JE @YM8452 74800000
         ST    13,CSADCBP  SAVE FRR PARMLIST PTR             JE @YM8452 74900000
         USING PARMLIST,13                                   JE @YM8452 75000000
         ICM   12,15,CSANPTR       GET ESTAE PARMLIST PTR    JE @YM8452 75100000
         BZ    FRRA                NOT THERE                 JE @YM8452 75200000
         MVC   PARMLIST(PARMSIZE),0(12) COPY ESTAE PARMLIST TO         *75300000
                                   FRR PARMLIST              JE @YM8452 75400000
FRRA     MVC   PARMID,SVC72ID      SET UP PROCESSOR ID       JE @YM8452 75500000
         LM    11,13,CSAXD         RESTORE REGS AFTER SETLOCK   @YM8452 75600000
         LR    14,0                RESTORE 14                JE @YM8452 75700000
GETEXIT  MVC   CSAXB(N8),OBTAINED  RESET SUBROUTINE ADDRESSES           75800000
         LR    XFBRANCH,XERTRN     COPY EXIT ADDRESS                    75900000
         BR    XERTRN              EXIT FROM GETLOCK SUBROUTINE         76000000
         SPACE 5                                                        76100000
*                                                                       76200000
*        RELEASE LOCKS SUBROUTINE                                       76300000
*                                                                       76400000
FREELOCK EQU   *                                                        76500000
         USING *,XFBRANCH          SUBROUTINE ADDRESSABILITY BASED ON   76600000
*                                  ENTRY REGISTER                       76700000
         USING CXSA,X1PARM         REG 1 ADDRESSES THE CXSA AS          76800000
*                                  AN INPUT PARAMETER                   76900000
         STM   11,13,CSAXD         SAVE REGS OVER SETLOCK CALL  @YM8452 77000000
         LR    0,14                SAVE REG 14               JE @YM8452 77100000
FREEFRR SETFRR D,WRKREGS=(12,13),                                      *77200000
                RELATED=(CMSLOCK,IEECVET1(GETFRR))           JE @YM8452 77300000
         XC    CSADCBP,CSADCBP     ZERO PTR                  JE @YM8452 77400000
FREECMS  SETLOCK RELEASE,TYPE=CMS,                                     *77500000
               RELATED=(UCM,IEECVET1(GETCMS))                           77600000
FREELOCL SETLOCK RELEASE,TYPE=LOCAL,                                   *77700000
               RELATED=(WQE,IEECVET1(GETLOCL))                          77800000
         DROP  13,14,0                                       JE @YM8452 77900000
         USING UCMLIST,X8UCME                                JE @YM8452 78000000
         LM    11,13,CSAXD        RESTORE REGS AFTER SETLOCK JE @YM8452 78100000
         LR    14,0                RESTORE 14                JE @YM8452 78200000
FREEXIT  MVC   CSAXB(N8),RELEASED  RESET SUBROUTINE ADDRESSES           78300000
NOOPLOCK LR    XFBRANCH,XERTRN     COPY EXIT ADDRESS                    78400000
         BR    XERTRN              EXIT FROM FREELOCK SUBROUTINE        78500000
         EJECT                                                          78600000
*                                                                       78700000
*              ESTAE RETRY ROUTINE FOR DIDOCS PROCESSING                78800000
*                                                                       78900000
ET1RTY   DS    0D                                             JE YM6718 79000000
         BALR  XFBRANCH,0          GET BASE                   JE YM6718 79100000
         USING *,XFBRANCH          TELL ASSM                  JE YM6718 79200000
         L     XCPBASE,ADET1       SETUP STND BASE            JE YM6718 79300000
         DROP XFBRANCH,X1PARM                                 JE YM6718 79400000
         USING CXSA,XDCXSA                                   JE @YM8452 79500000
         USING IGC5107B+2,XCPBASE                             JE YM6718 79600000
         USING PSA,0                                          JE YM6718 79700000
         L     X5,PSATOLD          GET OUR TCB PTR            JE YM6718 79800000
         L     X5,TCBRBP-TCB(X5)   GET SVRB PTR               JE YM6718 79900000
         LA    XDCXSA,RBEXSAVE-RBSECT(X5) GET CXSA PTR      JE @ZA00539 80000000
         L     X8UCME,CSAUCM       RELOAD UCME PTR            JE YM6718 80100000
         L     XARDCM,UCMXB        RELOAD RDCM PTR            JE YM6718 80200000
         L     XBTDCM,DCMADTRN     RELOAD TDCM PTR            JE YM6718 80300000
*                                                                       80400000
*              END OF REGISTER SETUP CODE                               80500000
*                                                                       80600000
         MVC   DCMTRACE(DCMTRLEN),DCMTRAC2  SHIFT OLD ENTRIES           80700000
         MVI   DCMTREN1,ID3        MOVE IN MOD ID OF 'ES'               80800000
         MVI   DCMTREN2,ID4        FOR IEECVET1 ESTAE RTN               80900000
*                                                                       81000000
*     GET LOCAL AND CMS LOCKS                                           81100000
*                                                                       81200000
         LR    X1PARM,XDCXSA       POINT TO CXSA             JE @YM8452 81300000
         L     XFBRANCH,CSAXB      ADDR GETLOCKS RTN         JE @YM8452 81400000
         BALR  XERTRN,XFBRANCH     OBTAIN LOCKS              JE @YM8452 81500000
*                                                                       81600000
         ICM   X4WORK,15,CSANPTR      GET RECOVERY AREA       JE YM6718 81700000
         BZ    NORCVRY             NOT THERE SWITCH CONSOLES   @ZA29665 81800003
         MVI   PARMFTPT,0          CLEAR FOOTPRINTS           JE YM6718 81900000
         TM    UCMSTS,UCMBF        CONSOLE BUSY               JE YM6718 82000000
         BO    BSYRCVRY            YES, GO HANDLE             JE YM6718 82100000
         TM    UCMSTS,UCMCF        CLOSE PENDING              JE YM6718 82200000
         BO    CLSRCVRY            YES, GO HANDLE             JE YM6718 82300000
         TM    UCMSTS,UCMTA        OPEN PENDING               JE YM6718 82400000
         BO    OPNRCVRY            YES, GO HANDLE             JE YM6718 82500000
*                                                                       82600000
*     ADDITIONAL RECOVERY CODE CAN GO HERE                              82700000
*                                                                       82800000
NORCVRY  NI    UCMDEVC,N255-UCMDEVE   TURN OFF I/O COMPLETE  JE @YM8452 82900000
         NI    DCMMCSST,N255-DCMDUSE  RTN NO LONGER IN CTRL D02 ZA06411 83000000
         L     XFBRANCH,CSAXC      ADDR RELEASE LOCK SBRTN   JE @YM8452 83100000
         BALR  XERTRN,XFBRANCH     GO RELEASE LOCKS          JE @YM8452 83200000
*                                                                       83300000
         L     XERTRN,CSAXA        RESET RETURN REGISTER       @ZA29665 83400003
         ICM   X4WORK,15,CSANPTR   RECOVERY AREA PRESENT?      @ZA29665 83410003
         BZ    SETSWCH          NO,SET CONSOLE SWITCH PARMLIST @ZA29665 83420003
PARMCTN  MVC   PARMRTAD(N8),CSANAME RESTORE RETRY AND REGSAVE  @ZA29665 83440003
SETSWCH  MVI   CSACODE,CSASWTCH    INDICATE CONSOLE SWITCH     @ZA29665 83470003
         MVC   CSANAME(N8),CONSWTCH MODULE NAME OF SWITCH      @ZA29665 83480003
         L     XFBRANCH,CSACTLM    SET UCM BASE ADDRESS        @ZA29665 83550003
         L     XFBRANCH,UCMSWCH-UCM(XFBRANCH) ADDR OF CON SW   @ZA29665 83600003
         LR    X1PARM,XDCXSA       ADDRESS OF CXSA IN REG1     @ZA29665 83650003
         BR    XFBRANCH            EXIT TO CONSOLE SWITCH      @ZA29665 83700003
*                                                                       83800000
*      CLOSE RECOVERY                                                   83900000
*                                                                       84000000
CLSRCVRY DS    0H                                             JE YM6718 84100000
         MVI   CSACODE,CLSRCV      SET CLOSE RECOVERY CODE    JE YM6718 84200000
         B     OPENEXT             GO TO ETG                  JE YM6718 84300000
*                                                                       84400000
*     OPEN RECOVERY                                                     84500000
*                                                                       84600000
OPNRCVRY DS    0H                                             JE YM6718 84700000
         MVI   CSACODE,OPNRCV      SET OPEN RECOVERY CODE     JE YM6718 84800000
         B     OPENEXT             GO TO ETG                  JE YM6718 84900000
*                                                                       85000000
*     EXCP ERECOVERY                                                   85100000
*                                                                       85200000
BSYRCVRY DS    0H                                             JE YM6718 85300000
         NI    UCMSTS,N255-UCMBF   TURN OFF BUSY              JE YM6718 85400000
         NI    UCMDEVC,N255-UCMDEVE   TURN OFF I/O COMPLETE  JE @YM8452 85500000
         MVI   UCMECB,BADIO        SET PERM I/O ERROR       JE @ZA02303 85600000
         L     XFBRANCH,CSAXC      ADDR RELEASE LOCK SBRTN    JE YM6718 85700000
         BALR  XERTRN,XFBRANCH     GO RELEASE LOCKS           JE YM6718 85800000
         B     ERROR               TREAT AS BAD I/O AND       JE YM6718 85900000
*                                  SWITCH CONSOLES            JE YM6718 86000000
*                                                                       86100000
CLSRCV   EQU   12                  CLOSE RECOVERY CODE        JE YM6718 86200000
OPNRCV   EQU   8                   OPEN RECOVERY CODE         JE YM6718 86300000
BADIO    EQU   X'41'               PERM I/O ERROR POST CODE JE @ZA02303 86400000
         SPACE 5                                                        86500000
*                                                                       86600000
*   CONSTANTS                                                           86700000
*                                                                       86800000
         DS    0F                                                       86900000
SVC72ID  DC    CL4'VCTR'                                     JE @YM8452 87000000
CONSWTCH DC    CL8'IGC0407B'  NAME OF CONSOLE SWITCH RTN       @ZA29665 87050003
VOPCL    DC    V(IEECVETG)                                              87100000
ADET1    DC    A(IGC5107B+2)       BASE OF MODULE             JE YM6718 87200000
RELEASED DC    A(GETLOCK)                                               87300000
OBTAINED DC    A(NOOPLOCK)                                              87400000
         DC    A(FREELOCK)                                              87500000
*                                                                       87600000
*   EQUATES                                                             87700000
*                                                                       87800000
ID1      EQU   C'E'                1ST CHAR OF CSECT ID                 87900000
ID2      EQU   C'1'                2ND CHAR OF CSECT ID                 88000000
ID3      EQU   C'E'                1ST CHAR OF ESTAE ID                 88100000
ID4      EQU   C'S'                2ND CHAR OF ESTAE ID                 88200000
CSTAR    EQU   C'*'                ID ENTRY TO INDICATE 1ST TIME        88300000
SP241    EQU   241                                            MB Y02958 88400000
IOBCOUNT EQU   14                  IOB COUNT FIELD                      88500000
CMNDCODE EQU   X'FE'               POST CODE FOR ROUTED COMMAND         88600000
KV       EQU   X'FD'               POST CODE FOR K V                    88700000
IOWAIT   EQU   X'80'               WAIT FOR I/O                         88800000
DISPBIT  EQU   X'10'        DISPLAY BIT                                 88900000
IOGOOD   EQU   X'7F'     I/O GOOD                                       89000000
BLANK    EQU   X'40'     BLANK CHAR.                                    89100000
UCMPOST  EQU   X'80'          POST BIT FOR ECB                          89200000
ZERO     EQU   X'00'               ZERO FOR UTILITY BYTE& ECB           89300000
R        EQU   C'R'                DEL = R OR RD                        89400000
Y        EQU   C'Y'                DEL = Y                              89500000
N0       EQU   0              ZERO                                      89600000
N1       EQU   1              ONE                                       89700000
N2       EQU   2                       2                                89800000
N3       EQU   3                       3                                89900000
N4       EQU   4         FIELD INCREMENT FOR CXSA                       90000000
N8       EQU   8                                                        90100000
N22      EQU   22        FIELD INCREMENT FOR  UCB                       90200000
N255     EQU   255       USED TO TURN OFF SINGLE BITS                   90300000
ASYNCHK  EQU   X'1B'                    ASYNCH ERRORS                   90400000
CONSOLE  EQU   X'02'               UCB CONSOLE FLAG                     90500000
M3       EQU   3                   MASK FOR INSERT CHARACTER  MB YM4087 90600000
         EJECT                                                          90700000
DKPARAM  DSECT                                                          90800000
         IEECVMAP KPARAM                                                90900000
         EJECT                                                          91000000
         IHACTM FTPT               RECOVERY WORKAREA MAPPING  JE YM6718 91100000
         EJECT                                                          91200000
         IHAFRRS                   MAP FRR PARMLIST          JE @YM8452 91300000
         EJECT                                                          91400000
         IHARB DSECT=YES                                      JE YM6718 91500000
         EJECT                                                          91600000
         IKJTCB                                               JE YM6718 91700000
         EJECT                                                          91800000
         IEERDCM                                                        91900000
         EJECT                                                          92000000
         IEETDCM                                                        92100000
         EJECT                                                          92200000
         IHACTM  CXSA                                                   92300000
         EJECT                                                          92400000
         IEECUCM  FORMAT=NEW                                            92500000
         EJECT                                                          92600000
*                                                                       92700000
DSUB     DSECT                                                          92800000
         IEECSUB Y,N,N,N,N,Y                                            92900000
         EJECT                                                          93000000
         IHAPSA                                                         93100000
         EJECT                                                          93200000
         CVT   DSECT=YES                                                93300000
         EJECT                                                          93400000
ET1UCB   DSECT                                                          93500000
         IEFUCBOB LIST=YES                                              93600000
         END                                                            93800000
