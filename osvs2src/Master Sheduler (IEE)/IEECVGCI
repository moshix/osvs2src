* /* START OF SPECIFICATIONS ****************************************** 00100000
*                                                                       00200000
*01*  MODULE-NAME = IEECVGCI                                            00300000
*                                                                       00400000
*01*  DESCRIPTIVE-NAME = GRAPHIC CONSOLES INITIALIZATION ROUTINE        00500000
*                                                                       00600000
*01*  COPYRIGHT = NONE                                                  00700000
*                                                                       00800000
*01*  STATUS = VS/2 MVS 3033 PROCESSOR SUPPORT (SCP)           @G51AK02 00900000
*                                                                       01000000
*          APARS FIXED ZA02819,ZA04664,ZA17730,ZA18574                  01100000
* A 100100-100800, 529400-529800                               @ZA18574 01130000
*01*  FUNCTION = OPEN THE SYS1.DCMLIB DATA SET, READ PFK DEFINITIONS    01200000
*     INTO THE NUCLEUS PFK AREA, AND IF A GRAPHIC CONSOLE WAS USED      01300000
*     DURING NIP, MARK THAT CONSOLE'S RESIDENT DCM ACCORDINGLY FOR THE  01400000
*     DIDOCS DISPLAY ROUTINES.                                          01500000
*                                                                       01600000
*01*  NOTES =                                                           01700000
*                                                                       01800000
*02*    CHARACTER-CODE-DEPENDENCIES = NONE                              01900000
*                                                                       02000000
*02*    DEPENDENCIES = NONE                                             02100000
*                                                                       02200000
*02*    RESTRICTIONS = NONE                                             02300000
*                                                                       02400000
*02*    REGISTER-CONVENTIONS = SEE REGISTER EQUATES                     02500000
*                                                                       02600000
*02*    PATCH-LABEL = ZAPAREA                                  @ZA18574 02700000
*                                                                       02800000
*01*  MODULE-TYPE = MODULE                                              02900000
*                                                                       03000000
*02*    PROCESSOR = ASSEMF-370R                                         03100000
*                                                                       03200000
*02*    MODULE-SIZE = X'592' BYTES                                      03300000
*                                                                       03400000
*02*    ATTRIBUTES = REUSABLE                                           03500000
*                                                                       03600000
*01*  ENTRY-POINT = IEECVGCI                                            03700000
*                                                                       03800000
*02*    PURPOSE = THIS IS THE ONLY ENTRY POINT TO PERFORM ALL FUNCTIONS 03900000
*                                                                       04000000
*02*    LINKAGE = LINKED TO BY IEEVIPL DURING COMMUNICATIONS TASK       04100000
*       INITIALIZATION                                                  04200000
*                                                                       04300000
*02*    INPUT = REGISTER 1 ADDRESSES THE TIOT                           04400000
*       SEE ALSO CONTROL BLOCKS USAGE                                   04500000
*                                                                       04600000
*02*    OUTPUT = OPEN DCB FOR SYS1.DCMLIB, AND INITIALIZED PFK AREAS IN 04700000
*       THE NUCLEUS.                                                    04800000
*                                                                       04900000
*02*    EXIT-NORMAL = IEEVIPL VIA BR 14.                                05000000
*                                                                       05100000
*02*    EXIT-ERROR = NONE                                               05200000
*                                                                       05300000
*01*  EXTERNAL-REFERENCES = NONE                                        05400000
*                                                                       05500000
*02*    ROUTINES = NONE                                                 05600000
*                                                                       05700000
*02*    DATA-SETS = SYS1.DCMLIB                                         05800000
*                                                                       05900000
*02*    DATA-AREA = IEEPFKEY, IN THE NUCLEUS                            06000000
*                                                                       06100000
*02*    CONTROL-BLOCKS = DCB,TIOT,RDCM,TDCM                             06200000
*                                                                       06300000
*01*  TABLES = NONE                                                     06400000
*                                                                       06500000
*01*  MACROS = EXECUTABLE - OPEN,GETMAIN,FREEMAIN,LOCATE,EXCP,WAIT      06600000
*              MAPPING - IEECUDX CONSOLE I/O CONTROL BLOCKS             06700000
*                        IEECUCM UCM DSECT                              06800000
*                        IEERDCM RESIDENT DCM DSECT                     06900000
*                        IEECSUB DIDOCS STORAGE UTILIZATION BLOCK       07000000
*                        IEETDCM TRANSIENT DCM DSECT           @ZA18574 07100000
*                                                                       07130000
*01*  CHANGE ACTIVITY = ZA02819,ZA04664,ZA17730,ZA24414,ZA18574@G51AK02 07160000
*                                                                       07230000
**** END OF SPECIFICATIONS *******************************************/ 07260000
         TITLE 'IEECVGCI - GRAPHIC CONSOLES INITIALIZATION'             07290000
IEECVGCI CSECT                                                          07320000
* A (EXPON) APPROX 371500 - NUCLEUS OVERLAY                    @ZA24414 07350000
* A (ICATCH) APPROX 100000 - EQUIP. CHECK                      @ZA18574 07380000
* A (SEARCH) APPROX 152700                                     @G51AK02 07400000
* A (N3036) APPROX 464700                                      @G51AK02 07420000
* A (TLOAD) APPROX 125000                                      @ZA18574 07440000
* A (SDSYES) APPROX 160000                                     @ZA18574 07460000
         EJECT                                                          07500000
*********************************************************************** 07600000
*        PROGRAM INITIALIZATION                                       * 07700000
*********************************************************************** 07800000
*************************************************************           08200000
START    STM   R14,R12,N12(R13)    SAVE REGISTERS                       08300000
         BALR  RBASE,N0            ESTABLISH PROGRAM                    08400000
         USING *,RBASE             ADDRESSABILITY                       08500000
         B     ICATCH              BRANCH AROUND EYECATCHER             08600000
         DC    C'00 MODULE IEECVGCI, FICHE IEECVGCI  ' EYECATCHER AND   08700000
         DC    XL2'4211'           JULIAN DATE LAST CHANGE              08800000
         DC    CL8'&SYSDATE'       DATE OF LAST ASSEMBLY                08900000
         DC    S(*)                BASE/DISPL OF PATCH AREA             09000000
ZAPAREA  DC    12C'ZAP'            RESERVED FOR FIELD MODIFICATION      09100000
ICATCH   LA    R12,SAVEAREA        LOAD SAVE AREA POINTER               09200000
         ST    R12,N8(R13)         SAVE IN CALLERS AREA                 09300000
         ST    R13,SAVEAREA+N4     SAVE POINTER TO CALLERS SAVE AREA    09400000
         LR    R13,R12             LOAD SAVE AREA POINTER               09500000
         ST    RA,ADRDSAB          SAVE DCMLIB DSAB ADDR      MB Y02958 09600000
         L     RCVT,CVTPTR         LOAD CVT ADDRESS                     09700000
         USING CVT,RCVT            ESTABLISH ADDRESSABILITY             09800000
         L     RUCM,CVTCUCB        LOAD UCM ADDRESS                     09900000
         USING UCM,RUCM            UCM BASE                             10000000
         L     RSUB,CVTIXAVL       GET IOCOM ADDRESS           @ZA18574 10010000
         USING IOCOM,RSUB                                      @ZA18574 10020000
         L     RSUB,IOCATTBL       GET ATTEN TABLE ADDR        @ZA18574 10030000
         DROP  RSUB                                            @ZA18574 10040000
         USING ATB,RSUB                                        @ZA18574 10050000
         LA    RSUB,N8(RSUB)       GET SECOND ENTRY            @ZA18574 10060000
         OI    ATBFLA,ATBITF       TURN ON INTERCEPT BIT       @ZA18574 10070000
         DROP  RSUB                                            @ZA18574 10080000
         SR    RSUB,RSUB           ZERO SUB BASE REGISTER               10100000
         DROP  RCVT                DROB ADDRESSABILITY                  10200000
         SPACE 3                                                        10300000
*************************************************************           10500000
GETCONS  LM    RENTRY,RLAST,UCMVEA LOAD BXLE REGISTERS                  10600000
         USING UCMLIST,RENTRY      UCMENTRY BASE                        10700000
         SPACE 3                                                        10800000
*************************************************************           11000000
LOOPA    TM    UCMDISP,UCMDISPC    GRAPHICS CONSOLE                     11100000
         BZ    NEXTCON             NO, BRANCH                           11200000
         SPACE 3                                                        11300000
*************************************************************           11500000
         L     RUCB,UCMUCB         GET UCB ADDRESS                      11600000
         LTR   RUCB,RUCB           VALID UCB ADDRESS                    11700000
         BZ    BADCON              NO, INACTIVATE CONSOLE               11800000
         USING UCBBLK,RUCB         ESTABLISH ADDRESSABILITY             11900000
         L     RRDCM,UCMXB         LOAD R DCM BASE                      12000000
         LTR   RRDCM,RRDCM         VALID RDCM ADDRESS         MB Y02958 12100000
         BZ    BADCON              NO, INACTIVE CONSOLE       MB Y02958 12200000
         USING DCMTSRT,RRDCM       R DCM BASE                  @ZA18574 12300000
         EJECT                                                          12350000
*************************************************************           12400000
TLOAD    L     RTDCM,DCMADTRN      LOAD T DCM ADDRESS                   12450000
         USING DCMSTRT,RTDCM       ESTABLISH ADDRESSABILITY    @ZA18574 12500000
         LTR   RTDCM,RTDCM         IS ADDRESS VALID                     12900000
         BNZ   GOODADDR            YES, BRANCH                          13000000
         SPACE 2                                                        13100000
*************************************************************           13300000
BADCON   MVI   UCMATR,N0           ZERO CONSOLE SUPPORT FLAGS           13400000
         MVI   UCMSTS,N0           ZERO WORK FLAGS            MB YM6335 13500000
         B     NEXTCON             GET NEXT CONSOLE                     13600000
         SPACE 2                                                        13700000
*************************************************************           13900000
GOODADDR L     RA,DCMADPFK         LOAD POINTER TO PFK AREA             14000000
         LTR   RA,RA               VALID ADDRESS                        14100000
         BZ    SEARCH              NO, BRANCH                           14200000
         SPACE 2                                                        14300000
*************************************************************           14500000
         L     RSUB,DCMSUBAD       LOAD SUB BASE REGISTER               14600000
         USING SUB,RSUB            SUB BASE                             14700000
         SPACE 3                                                        14800000
*************************************************************           15000000
SEARCH   CLI   UCBTBYT4,N2260      IS CONSOLE A 2260                    15100000
         BE    SDYES               YES, BRANCH                          15200000
         CLI   UCBTBYT4,N3158      IS THIS A 3158 CONSOLE      @ZA17730 15230000
         BE    SDYES               YES, BRANCH                 @ZA17730 15260000
         CLI   UCBTBYT4,N3036      IS CONSOLE A 3036           @G51AK02 15270000
         BE    SDYES               YES, BRANCH                 @G51AK02 15280000
         CLI   UCBTBYT4,N3277      IS CONSOLE A 3277                    15300000
         BNE   SDNO                NO, BRANCH                           15400000
         TM    UCBTBYT1,MOD1       IS 3277 A MOD ONE                    15500000
         BNO   SDYES               NO, BRANCH                           15600000
SDNO     OI    DCMDEVTY,DCMTY50    NOT USABLE FOR SD                    15700000
         B     SDSYES              BRANCH                               15800000
SDYES    OI    DCMDEVTY,DCMTY60    IS USABLE FOR SD                     15900000
SDSYES   MVC   DCMLEN(N2),DCMSTRT       SAVE DCM LENGTH        @ZA18574 16000000
         MVC   DCMRMSAL(N2),DCMMSGAL    SAVE NUMBER MSG LINES           16100000
         SPACE 2                                                        16200000
*************************************************************           16400000
NIPTEST  L     RB,DCMMSGSV         POINT TO GETMAIN AREA                16500000
         LTR   RB,RB               THIS CONSOLE USED BY NIP?            16600000
         BZ    NEXTCON             NO, BRANCH                           16700000
         OI    DCMRFLGS,DCMNIPP    IND DCM USED BY NIP                  16800000
         EJECT                                                          16900000
*************************************************************           17100000
         L     RA,N4(RB)           POINT TO FIRST SAVED MESSAGE         17200000
         LA    RX,N8               LOAD BCT COUNT                       17300000
         LH    RY,DCMLGNTH         LOAD LINE LENGTH                     17400000
         BCTR  RY,N0               DECREMENT FOR EXECUTE MOVE           17500000
         L     RZ,DCMASCRN         DCM MESSAGE AREA                     17600000
LOOPER   EX    RY,MOVER            MOVE IN MESSAGE                      17700000
         AH    RA,DCMLGNTH         BUMP FROM POINTER          MB YM2531 17800000
         AH    RZ,DCMCORLN         BUMP TO POINTER                      17900000
         BCT   RX,LOOPER           LOOP FOR MORE                        18000000
         L     RA,N16(RB)          POINT TO SAVED SCT'S                 18100000
         L     RZ,DCMAMTAB         DCM SCT POINTER                      18200000
         MVC   N0(N16,RZ),N0(RA)   RESTORE SAVED SCT'S                  18300000
         LA    P0,N255             LOAD SUBPOOL VALUE         MB YM2531 18400000
         SLL   P0,N24              SHIFT TO HI-ORDER BYTE     MB YM2531 18500000
         L     P1,DCMMSGSV         POINT TO GETMAIN AREA      MB YM2531 18600000
         L     R2,N20(P1)          POINT TO LAST SCT          MB YM2531 18700000
         LA    R2,N3(R2)           POINT JUST BEYOND STOPPER  MB YM2531 18800000
         SR    R2,P1               COMPUTE LENGTH FOR FREEING MB YM2531 18900000
         OR    P0,R2               SUBPOOL AND LENGTH IN REG  MB YM2531 19000000
         FREEMAIN  R,LV=(0),A=(1)                             MB YM2531 19100000
         SPACE 3                                                        19200000
*************************************************************           19400000
NEXTCON  BXLE  RENTRY,RLEN,LOOPA   GET NEXT ENTRY                       19500000
         DROP  RTDCM               DROP T DCM ADDRESSABILITY            19600000
         SPACE 3                                                        19700000
*************************************************************           19900000
         LTR   RSUB,RSUB           ANY PFK'S IN SYSTEM                  20000000
         BNZ   LOCATE              YES, BRANCH                          20100000
         SPACE 3                                                        20200000
*************************************************************           20400000
RETURN   L     R13,SAVEAREA+N4     LOAD CALLERS SAVE AREA               20500000
         LM    14,12,12(13)        RESTORE REGISTERS                    20600000
         BR    14                  RETURN TO CALLER                     20700000
         EJECT                                                          20800000
*********************************************************************** 20900000
*        EXECUTE A LOCATE TO DETERMINE IF SYS1.DCMLIB IS PRESENT      * 21000000
*        AND IF SO, WHERE. ATTEMPT OPEN.                              * 21100000
*********************************************************************** 21200000
*************************************************************           21400000
LOCATE   L     RDCB,SUBBLK         LOAD CONTROL BLOCK BASE              21500000
         USING SUBDCB,RDCB         CONTROL BLOCK ADDRESSABILITY         21600000
         LOCATE  INDAB                                                  21700000
         LTR    R15,R15            WAS LIBRARY MOUNTED                  21800000
         BNZ   ERROR1              NO,  BRANCH                          21900000
         SPACE 3                                                        22000000
*************************************************************           22200000
OPEN     MVC   SUBVOL(N6),SYSVOL   STORE VOLID IN JFCB                  22300000
         L     RCVT,CVTPTR         LOAD CVT BASE                        22400000
         USING CVT,RCVT            ESTABLISH ADDRESSABILITY             22500000
         SPACE 3                                                        22600000
*************************************************************           22800000
         L     RX,CVTILK2          GET UCB                    MC  M2522 22900000
LOOP     DS    0H                                              @Z30AAJE 23000000
         SR    RY,RY               CLEAR REGISTER              @Z30AAJE 23100000
         ICM   RY,3,N0(RX)           ADDRESS                   @Z30AAJE 23200000
         BZ    BUMP                NULL ENTRY GET NEXT         @Z30AAJE 23300000
         CLM   RY,3,TABEND           REACHED END OF TABLE      @Z30AAJE 23400000
         BE    ERROR1              YES, BRANCH TO ERROR       MC  M1984 23500000
         CLC   N28(N6,RY),SUBVOL   VOLID SAME AS IN TIOT      MB Y02958 23600000
         BE    FOUND               YES, UCB FOR DCMLIB FOUND  MB Y02958 23700000
BUMP     LA    RX,N2(RX)           GET NEXT UCB ADDRESS       MB Y02958 23800000
         B     LOOP                CHECK FOR END OF UCBS      MB Y02958 23900000
FOUND    EQU   *                                                        24000000
         L     RC,ADRDSAB          LOCATE DSAB FOR DCMLIB     MB Y02958 24100000
         USING DSAB,RC             DSAB ADDRESSABILITY        MB Y02958 24200000
         L     RC,DSABTIOT         TIOT ENTRY FOR DCMLIB      MB Y02958 24300000
         USING TIOENTRY,RC         TIOT ENTRY ADDRESSABILITY  MB Y02958 24400000
         STCM  RY,N7,TIOEFSRT      POINT TIOT ENTRY TO UCB    MB Y02958 24500000
         L     RB,UCMPXA           COMM TASK TCB              MB Y02958 24600000
         USING TCB,RB              TCB ADDRESSABILITY         MB Y02958 24700000
         MVC   COMTIOT,TCBTIO      COMM TASK TIOT             MB Y02958 24800000
         L     RC,TCBJSCB          COMM TASK JSCB             MB Y02958 24900000
         USING IEZJSCB,RC          JSCB ADDRESSABILITY        MB Y02958 25000000
         MVC   COMQDB(N4),JSCDSABQ COMM TASK DSAB QUEUE       MB Y02958 25100000
         L     RB,CVTTCBP          CURRENT TCB POINTER        MB Y02958 25200000
         L     RB,N0(RB)           MASTER TCB ADDRESS         MB Y02958 25300000
         L     RC,TCBJSCB          MASTER JSCB ADDRESS        MB Y02958 25400000
         MVC   MSTRTIOT,TCBTIO     SAVE MASTER TIOT ADDRESS   MB Y02958 25500000
         MVC   TCBTIO,COMTIOT      SET COMM TASK TIOT         MB Y02958 25600000
         MVC   MSTRQDB,JSCDSABQ    SAVE MASTER DSAB QDB       MB Y02958 25700000
         MVC   JSCDSABQ,COMQDB     SET COMM TASK QDB FOR OPEN MB Y02958 25800000
         SPACE 3                                                        25900000
*************************************************************           26100000
         LA    RA,PNXLST           SET UP DCB EXLST           MB Y02958 26200000
         STCM  RA,N7,N37(RDCB)     LEAVE HI BYTE ALONE        MB Y02958 26300000
         SPACE 3                                                        26400000
*************************************************************           26600000
         MVC   CVTDATE(N4),DATE    PUT DATE INTO CVT                    26700000
         OI    JSCBSWT1,JSCBPASS                              MB Y02958 26800000
         OI    PNJEF,STOPPER       LAST ENTRY                 MB YM3194 26900000
         SPACE 3                                                        27000000
*************************************************************           27200000
         OPEN  ((RDCB),INOUT),TYPE=J,MF=(E,PNJEF)                       27300000
         MVC   TCBTIO,MSTRTIOT     RESTORE TIOT ADDRESS       MB Y02958 27400000
         MVC   JSCDSABQ,MSTRQDB    RESTORE DSAB QDB           MB Y02958 27500000
         NI    JSCBSWT1,N255-JSCBPASS REINSTATE PASSWORD CHECKING       27600000
         DROP  RC                  DROP JSCB ADDRESSABILITY   MB Y02958 27700000
         DROP  RB                  DROP TCB ADDRESSABILITY    MB Y02958 27800000
         SPACE 3                                                        27900000
*************************************************************           28100000
OPENOK   TM    N48(RDCB),OFLAG     IS DCB OPEN                          28200000
         BZ    ERROR1              NO, BRANCH                           28300000
         EJECT                                                          28400000
*********************************************************************** 28500000
*        READ IN COPY OF PFK DEFINITIONS FROM SYS1.DCMLIB             * 28600000
*********************************************************************** 28700000
*************************************************************           28900000
         L     P1,SUBBLK           LOAD DCB ADDRESS                     29000000
         BLDL  (1),LIST            ISSUE BLDL FOR PFK MEMBER            29100000
         LTR   R15,R15             WAS IT FOUND                         29200000
         BNZ   ERROR2              NO, BRANCH                           29300000
         SPACE 3                                                        29400000
*************************************************************           29600000
         LA    RA,SUBECB           GET ECB ADDRESS                      29700000
         ST    RA,IOB+N4           STORE IT IN IOB                      29800000
         L     R2,SUBPFKAD         LOAD PFK AREA POINTER                29900000
         L     RX,N0(R2)           POINT TO DEFINATIONS                 30000000
         ST    RX,DEFSAVE          SAVE DEFINATION POINTER              30100000
         LA    R2,N4(R2)           POINT TO ELEMENT                     30200000
         MVC   LENGTH(N2),N0(RX)   MOVE LENGTH TO CCW                   30300000
         MVI   TYPE,NE             SET CCW READ CODE                    30400000
         MVC   DATA(N3),SUBPFKAD+N1    STORE DATA ADDR IN CCW           30500000
         SPACE 3                                                        30600000
*************************************************************           30800000
TEE      STM   R14,R12,SAVEAREA+N12    SAVE REGISTERS                   30900000
         L     P0,TTR              GET RELATIVE TTR                     31000000
         L     P1,SUBBLK           GET DCB ADDRESS                      31100000
         L     P1,N44(P1)          GET DEB ADDRESS                      31200000
         LA    R2,SEEK             WHERE TO PUT CONVERSION              31300000
         L     R15,CVTPCNVT        GET POINTER TO CONVERT ROUTINE       31400000
         BALR  R14,R15             BRANCH TO CONVERT ROUTINE            31500000
         LM    R14,R12,SAVEAREA+N12     RESTORE REGISTERS               31600000
         SPACE 3                                                        31700000
*************************************************************           31900000
         LA    P1,IOB              LOAD IOB ADDRESS                     32000000
         SVC   0                   ISSUE EXCP                           32100000
         WAIT  ECB=SUBECB          WAIT FOR I/O COMPLETE                32200000
         SPACE 3                                                        32300000
*************************************************************           32500000
         TM    IOBSEN,IOBNR        WAS RECORD FOUND                     32600000
         BO    NOREC               NO, BRANCH                           32700000
         SPACE 3                                                        32800000
*************************************************************           33000000
         CLI   SUBECB,GOODIO       WAS I/O GOOD                         33100000
         BNE   ERROR2              NO, BRANCH                           33200000
         SPACE 3                                                        33300000
*************************************************************           33500000
         MVI   SUBECB,N0           CLEAR ECB                            33600000
         TM    SUBDAIO,SUBEXP      CONTROL RECORD EXPECTED              33700000
         BZ    EXPON               NO, BRANCH                           33800000
         SPACE 3                                                        33900000
*************************************************************           34100000
         L     RA,TYPE             LOAD DATA ADDRESS                    34200000
         LA    RA,N0(RA)           CLEAR HIGH BYTE                      34300000
         TM    N0(RA),CONTROL      CONTROL RECORD                       34400000
         BZ    BUMPER              NO, BRANCH                           34500000
         SPACE 3                                                        34600000
*************************************************************           34800000
         NI    SUBDAIO,N255-SUBEXP SET OFF EXPECT FLAG                  34900000
         SPACE 3                                                        35000000
*************************************************************           35200000
BUMPER   IC    RA,TTR+N2           GET R OF TTR                         35300000
         LA    RA,N1(RA)           BUMP BY ONE                          35400000
         STC   RA,TTR+N2           STORE UPDATED VALUE                  35500000
         B     TEE                 BRANCH                               35600000
         EJECT                                                          35700000
*************************************************************           35900000
NOREC    LH    RA,TTR              GET TT OF TTR                        36000000
         LA    RA,N1(RA)           BUMP BY ONE                          36100000
         STH   RA,TTR              STORE UPDATED VALUE                  36200000
         MVI   TTR+N2,N1           SET R OF TTR TO ONE                  36300000
         B     TEE                 BRANCH                               36400000
         SPACE 3                                                        36500000
*************************************************************           36700000
EXPON    MVC   N2(N8,R2),SEEK      MOVE TTR TO ELEMENT                  36800000
         LH    RA,RESCNT           LOAD RESIDUAL COUNT                  36900000
         LH    RX,LENGTH           LOAD CCW COUNT                       37000000
         N     RX,MASK1            CLEAR UNWANTED BITS      JE @ZA02819 37100000
         N     RA,MASK1            CLEAR UNWANTED BITS         @ZA24414 37150000
         SR    RX,RA               COMPUTE LENGTH READ                  37200000
         STH   RX,N0(R2)           STORE IN ELEMENT                     37300000
         SPACE 3                                                        37400000
*************************************************************           37600000
         LTR   RA,RA               IS RESIDUAL COUNT ZERO               37700000
         BNZ   COMPUT              NO, BRANCH                           37800000
         SPACE 3                                                        37900000
*************************************************************           38100000
         OI    N0(R2),STOPPER      SET ELEMENT STOPPER                  38200000
         OI    SUBFLGS,SUBPKLIB    IND PFKS ARE SUPPORTED               38300000
         L     R2,SUBPFKAD         LOAD PFK AREA ADDRESS                38400000
         L     RX,DEFSAVE          LOAD SAVED POINTER                   38500000
         ST    RX,N0(R2)           RESTORE DEFINATION POINTER           38600000
         B     RETURN              EXIT                                 38700000
         SPACE 3                                                        38800000
*************************************************************           39000000
COMPUT   STH   RA,LENGTH           STORE NEW LENGTH IN CCW              39100000
         L     RA,TYPE             LOAD DATA ADDRESS                    39200000
         AR    RA,RX               ADD LENGTH READ                      39300000
         ST    RA,TYPE             STORE UPDATED DATA ADDRESS           39400000
         LA    R2,N10(R2)          UPDATE ELEMENT POINTER               39500000
         OI    SUBDAIO,SUBEXP      SET ON EXPECT FLAG                   39600000
         B     BUMPER              BRANCH                               39700000
         EJECT                                                          39800000
*************************************************************           40000000
ERROR1   WTO   'IEE933I DCMLIB OPEN FAILED',ROUTCDE=(1)                 40100000
         B     RETURN              EXIT                                 40200000
         SPACE 3                                                        40300000
*************************************************************           40500000
ERROR2   WTO   'IEE934I PFK UPDATE FAILED',ROUTCDE=(1)                  40600000
         B     RETURN              EXIT                                 40700000
         SPACE 3                                                        40800000
*************************************************************           41000000
         EJECT                                                          41100000
*********************************************************************** 41200000
*        REGISTER EQUATES                                             * 41300000
*********************************************************************** 41400000
P0       EQU   0                   REGISTER                             41500000
P1       EQU   1                   PARAMETER REGISTER                   41600000
RA       EQU   1                   WORK REGISTER                        41700000
R2       EQU   2                   REGISTER                             41800000
RB       EQU   2                   WORK REGISTER                        41900000
RENTRY   EQU   3                   UCMENTRY BASE                        42000000
RC       EQU   3                   WORK REG                   MB Y02958 42100000
RLEN     EQU   4                   ENTRY LENGTH FOR BXLE                42200000
RLAST    EQU   5                   LAST ENTRY FOR BXLE                  42300000
RBASE    EQU   6                   PROGRAM BASE                         42400000
RUCB     EQU   7                   UCB POINTER                          42500000
RDCB     EQU   8                   CONTROL BLOCK BASE                   42600000
RRDCM    EQU   9                   R DCM BASE                           42700000
RCVT     EQU   10                  CVT BASE REGISTER                    42800000
RTDCM    EQU   10                  T DCM BASE                           42900000
RSUB     EQU   11                  SUB BASE                             43000000
RUCM     EQU   12                  UCM BASE                             43100000
R12      EQU   12                  WORK REGISTER                        43200000
R13      EQU   13                  SAVE AREA POINTER                    43300000
RZ       EQU   13                  WORK REGISTER                        43400000
RX       EQU   14                  WORK REGISTER                        43500000
RY       EQU   15                  WORK REGISTER                        43600000
         EJECT                                                          43700000
*********************************************************************** 43800000
*        MISC PROGRAM EQUATES                                         * 43900000
*********************************************************************** 44000000
N0       EQU   0                   NUMBER                               44100000
N1       EQU   1                   NUMBER                               44200000
N2       EQU   2                   NUMBER                               44300000
N3       EQU   3                   NUMBER                               44400000
N4       EQU   4                   NUMBER                               44500000
N6       EQU   6                   NUMBER                               44600000
N7       EQU   7                   NUMBER                     MB Y02958 44700000
N8       EQU   8                   NUMBER                               44800000
N10      EQU   10                  NUMBER                               44900000
N12      EQU   12                  NUMBER                               45000000
N16      EQU   16                  NUMBER                               45100000
N20      EQU   20                  NUMBER                     MB YM2531 45200000
N24      EQU   24                  NUMBER                     MB YM2531 45300000
N28      EQU   28                  NUMBER                               45400000
N37      EQU   37                  NUMBER                     MB Y02958 45500000
N44      EQU   44                  NUMBER                               45600000
N48      EQU   48                  NUMBER                               45700000
N64      EQU   64                  NUMBER                               45800000
N148     EQU   148                 DEB MOVE LENGTH                      45900000
N255     EQU   255                 NUMBER                               46000000
OFLAG    EQU   X'10'               NUMBER                               46100000
UCMPT    EQU   100                 DISPLACEMENT OF UCM ADDR IN CVT      46200000
N2260    EQU   X'03'               2260 DEVICE TYPE                     46300000
N3277    EQU   X'09'               3277 DEVICE BYTE                     46400000
N3158    EQU   X'0C'               3158 DEVICE TYPE FLAG       @ZA17730 46450000
N3036    EQU   X'0D'               3036 DEVICE TYPE FLAG       @G51AK02 46470000
MOD1     EQU   X'01'               3277 MODEL ONE FLAG                  46500000
NE       EQU   X'0E'               READ CODE                            46600000
CONTROL  EQU   X'01'               CONTROL RECORD IDENTIFIER            46700000
STOPPER  EQU   X'80'               ELEMENT STOPPER                      46800000
GOODIO   EQU   X'7F'               GOOD I/O INDICATION                  46900000
         EJECT                                                          47000000
*********************************************************************** 47100000
*        MISC PROGRAM CONSTANTS                                       * 47200000
*********************************************************************** 47300000
         CNOP  2,4                                                      47400000
LIST     DC    H'1'                                                     47500000
         DC    H'22'                                                    47600000
         DC    C'IEE'                                                   47700000
         DC    CL5'PFKEY'                                     MB Y02958 47800000
         DC    XL6'0'                                                   47900000
TTR      DC    XL8'0'                                                   48000000
SAVEAREA DS    18F                 REGISTER SAVE AREA                   48100000
INDAB    CAMLST  NAME,AB,,LOCAREA                                       48200000
AB       DC    CL44'SYS1.DCMLIB'                                        48300000
LOCAREA  DS    0D                                                       48400000
         DS    6C                                                       48500000
SYSVOL   DS    253C                                                     48600000
NEEDED   DS    6C                                                       48700000
DEFSAVE  DS    F                   PFK DEFINITION POINTER     MB Y02958 48800000
COMTIOT  DS    F                   ADDRESS COMM TASK TCB      MB Y02958 48900000
COMQDB   DS    F                   COMM TASK DSAB QDB ADDRESS MB Y02958 49000000
MSTRTIOT DS    F                   MASTER TIOT ADDRESS        MB Y02958 49100000
MSTRQDB  DS    F                   MASTER DSAB QDB ADDRESS    MB Y02958 49200000
ADRDSAB  DS    F                   DSAB FOR DCMLIB            MB Y02958 49300000
DATE     DC    X'0099366F'         DATE IN PACKED DECIMAL               49400000
SUBECB   DC    F'0'                SPECIAL ECB FOR PFK READ             49500000
MASK1    DC    XL4'0000FFFF'                                JE @ZA04664 49600000
TABNULL  DC    H'0'                UCB TABLE NULL ENTRY       MC  M1984 49700000
TABEND   DC    X'FFFF'             UCB TABLE END INDICATOR     @Z30AAJE 49800000
MOVER    MVC   N0(N0,RZ),N0(RA)    RESTORE NIPS MESSAGES                49900000
         EJECT                                                          50000000
*********************************************************************** 50100000
*        PROGRAM DSECT AREA                                           * 50200000
*********************************************************************** 50300000
         CVT        DSECT=YES                                           50400000
         EJECT                                                          50500000
UCBBLK   DSECT                                                          50600000
         IEFUCBOB                                                       50700000
         EJECT                                                          50800000
         IEFTIOT1                                                       50900000
         EJECT                                                          51000000
         IHADSAB                                                        51100000
         EJECT                                                          51200000
         IEZJSCB                                                        51300000
         EJECT                                                          51400000
         IKJTCB                                                         51500000
         EJECT                                                          51600000
         IEECUCM  FORMAT=NEW                                            51700000
         EJECT                                                          51800000
         IHAPSA                                                         51900000
         EJECT                                                          52000000
         IEERDCM                                                        52100000
         EJECT                                                          52150000
         IEETDCM                                                        52200000
         EJECT                                                          52250000
SUB      DSECT                                                          52300000
         IEECSUB Y,Y,N,N,Y,Y                                            52900000
         EJECT                                                          52920000
         IECDIOCM                                              @ZA18574 52940000
         EJECT                                                          52960000
         IECDATB                                               @ZA18574 52980000
         END                                                            53000000
