         TITLE '(IEEVIPL) MASTER SCHEDULE BASE INITIALIZATION'   Y02669 00010002
IEEVIPL  CSECT                                                          00050002
         EJECT                                                          00100002
*********************************************************************** 00150002
* MODULE NAME   = IEEVIPL                                             * 00200002
*                                                                     * 00250002
* CSECT NAME    = IEEVIPL                                             * 00300002
*                                                                     * 00350002
* DESCRIPTION   = MASTER SCHEDULER BASE INITIALIZATION                * 00400002
*                                                                     * 00450002
* COPY RIGHT    = NONE                                                * 00500002
*                                                                     * 00550002
* STATUS        = OS-VS2 RELEASE 037                          @ZA30544* 00600003
*                                                                     * 00650002
* FUNCTION      = THIS IS THE FIRST MODULE OF MASTER SCHEDULER.       * 00700002
*                 IT IS RESPONSIBLE FOR SCHEDULER INITIALIZATION.     * 00750002
*                 IT WILL INVOKE THE SUBSYSTEM INTERFACE INITIAL-     * 00800002
*                 IZATION FUNCTION, COMMUNICATION TASK                * 00850002
*                 INITIALIZATION, TIME OF DAY CLOCK PROCESSOR, AND    * 00880002
*                 VARIABLE INITIALIZATION.                            * 00910002
*                                                                     * 00950002
* OPERATION     = THE MASTER SCHEDULER INITIALIZATION ROUTINE         * 01000002
*                 (IEEVIPL) RECEIVES CONTROL FROM THE NIP             * 01050002
*                 PROCESSOR VIA A LINK MACRO INSTRUCTION AND          * 01100002
*                 OPERATES IN ITS OWN REGION.                         * 01150002
*                 IEEVIPL OPERATES UNDER THE PROTECTION OF A          * 01200002
*                 ESTAE ENVIRONMENT.  ESTAE PROVIDES INTER-           * 01250002
*                 VENTION IN CASE OF AN ABEND CONDITION.  IF          * 01300002
*                 AN ABEND CONDITION OCCURS, ABEND PROCESSES          * 01350002
*                 NORMALLY UNTIL THE ESTAE INTERFACE ROUTINE          * 01400002
*                 SYNCHES TO THE EXIT ROUTINE (IPSTAR). WHEN          * 01450002
*                 THE EXIT ROUTINE COMPLETES, IT WILL ENTER           * 01500002
*                 A PERMANENT WAIT STATE VIA LOADING A WAIT           * 01550002
*                 STATE PSW OR A WAIT SVC.                            * 01600002
*                 THE OPERATION OF THIS MODULE IS AS FOLLOWS:         * 01850002
*                   . GET CORE FOR THE ESTAE PARAMETER AREA           * 01890002
*                   . CREATE A ESTAE ENVIRONMENT                      * 01940002
*                   . GET CORE FOR THE JSCB                           * 01980002
*                   . GET CORE FOR THE CSCB                           * 02020002
*                   . GET CORE FOR THE SSIB                           * 02060002
*                   . GET CORE FOR THE IEL                            * 02100002
*                   . GET ADDRESS OF IKJEFLF AND PUT IT IN CVTSIC     * 02140002
*                   . GET ADDRESS OF IEFQB550 AND PUT IT IN JESCT     * 02180002
*                   . GET ADDRESS OF IEFQB555 AND PUT IT IN JESCT     * 02220002
*                   . GET ADDRESS OF IEFQB580 AND PUT IT IN JESCT     * 02260002
*                   . GET ADDRESS OF IEFW21SD AND PUT IT IN JESCT     * 02265003
*                                                             @Z40FPPJ* 02270003
*                   . GET ADDRESS OF IEFBB410 AND PUT IT IN JESCT     * 02275003
*                                                             @Z40FPPJ* 02280003
*                   . GET ADDRESS OF IEFAB4F5 AND PUT IT IN JESCT     * 02285003
*                                                             @Z40FPPJ* 02290003
*                   . CALC NUMBER OF UCB'S IN SYSTEM          @Z40FPPJ* 02295003
*                   . GET ADDRESS OF IEFJRECM AND PUT IT IN CVT       * 02300002
*                   . GET ADDRESS OF IEFIRECM AND PUT IT IN CVT       * 02340002
*                   . GET ADDRESS OF IEFAB4E5 AND PUT IT IN CVT       * 02380002
*                   . INITIALIZE AND CHAIN THE ABOVE BLOCKS           * 02420002
*                   . MOVE THE ASCB ADDRESS TO BASEA                  * 02460002
*                   . GET A REGISTER SAVE AREA                        * 02500002
*                   . INVOKE SUBSYSTEM INTERFACE INITIALIZATION       * 02540002
*                   . INVOKE COMMUNICATION TASK INITIALIZATION        * 02580002
*                   . POST COMMUNICATION TASK COMPLETE                * 02620002
*                   . INVOKE MASTER SCHEDULER VARIABLE INITIALIZATION * 02660002
*                   . INVOKE TSO SERVICE ROUTINE               @YM2225P 02680002
*                   . LOAD TOD CLOCK CONVERSION ROUTINE               * 02700002
*                   . INVOKE TOD CLOCK CONVERSION ROUTINE             * 02740002
*                   . DELETE TOD CLOCK CONVERSION ROUTINE             * 02780002
*                   . FREE THE REGISTER SAVE AREA                     * 02820002
*                   . IF TOD WAS SUCCESSFUL, INVOKE THE INITIATOR     * 02860002
*                   . IF TOD FAILED, INFORM OPERATOR AND WAIT         * 02900002
*                 THE OPERATION OF THE ESTAE ROUTINE IS:              * 02910002
*                   . TAKE DUMP IF NOT PERCOLATION OR MCH CHK  @YM3509P 02920002
*                   . INFORM OPERATOR OF FAILURE AND DUMP STATUS      * 02930002
*                   . ISSUE WAIT                                      * 02940002
*                                                                     * 02950002
* NOTES:                                                              * 03000002
*  CHARACTER-                                                         * 03050002
*  CODE         = MODULE MAY BE REASSEMBLED WITH A NEW CODE SET       * 03100002
*  DEPENDENCIES = NONE                                                * 03150002
*  RESTRICTIONS = NONE                                                * 03200002
*  REGISTER-                                                          * 03250002
*  CONVENTIONS  = NONE                                                * 03300002
*  PATCH-LABEL  = VPATCH                                              * 03350002
*                                                                     * 03400002
* MODULE TYPE:                                                        * 03450002
*  PROCESSOR    = ASSEMBLER                                           * 03500002
*  MODULE SIZE  = X'628'                                              * 03550002
*  ATTRIBUTES   = REENTRANT                                           * 03600002
*                 REFRESHABLE                                         * 03650002
*                 SUPERVISOR MODE                                     * 03700002
*                 ZERO PSW PROTECT KEY                                * 03750002
*                 MASTER SCHEDULER REGION                             * 03800002
*                                                                     * 03850002
* ENTRY POINT   = IEEVIPL                                             * 03900002
*  PURPOSE      = MASTER INITIALIZATION                               * 03950002
*  LINKAGE      = LINK                                                * 04000002
*  INPUT DATA   = NONE                                                * 04050002
*                                                                     * 04100002
* ENTRY POINT   = IPSTAR                                              * 04150002
*  PURPOSE      = MASTER INITIALIZATION RECOVERY FUNCTION             * 04200002
*  LINKAGE      = SYNCH                                               * 04250002
*  INPUT DATA   = ESTAE WORKAREA (REGISTER 1)                         * 04300002
*                 ESTAE PARAMETER LIST (ESTAE WORKAREA)               * 04350002
*                                                                     * 04360002
* ENTRY POINT   = IPSTAR1                                             * 04370002
*  PURPOSE      = MASTER INITIALIZATION RECOVERY FUNCTION (FAILURE)   * 04380002
*  LINKAGE      = BRANCH                                              * 04390002
*  INPUT DATA   = ESTAE PARAMETER LIST (REGISTER 2)                   * 04392002
*                                                                     * 04400002
* REGISTER USAGE:                                                     * 04450002
*  SAVED        = NONE                                                * 04500002
*  CONTAINED    = UNPREDICTABLE                                       * 04550002
*  RESTORED     = NONE                                                * 04600002
*                                                                     * 04650002
* PROGRAM FLOW  = .CREATE THE ESTAE ENVIRONMENT                       * 04700002
*                 .SETS UP THE INTERFACE REQUIRED TO INVOKE THE       * 04750002
*                  INITIATOR                                          * 04800002
*                 .LOAD AND SET ADDRESS OF SIC MODULE IN CVT          * 04820002
*                 .LOAD AND SET ADDRESSES OF SWA MANAGEMENT           * 04850002
*                  ROUTINES IN THE JESCT                              * 04900002
*                 .LOAD AND SET ADDRESSES OF ALLOCATION               * 04902003
*                  ROUTINES IN JESCT                          @Z40FPPJ* 04904003
*                 .CALCULATE NUMBER OF UCB'S IN SYSTEM AND SAVE       * 04906003
*                  IN JESCT                                   @Z40FPPJ* 04908003
*                 .LOAD AND SET ADDRESSES OF THE RESOURCE             * 04910002
*                  MANAGER ROUTINES IN THE CVT                        * 04920002
*                 .BALR TO SUBSYSTEM INTERFACE INITIALIZATION         * 04950002
*                  FUNCTION (IEFJSINT)                                * 05000002
*                 .LINK TO THE CONSOLE INITIALIZATION MODULE          * 05050002
*                  (IEAVVINT) AND POSTS THE COMMUNICATIONS TASK       * 05100002
*                 .LOAD THE TIME OF DAY CLOCK ROUTINE (IEAVRINT)      * 05150002
*                 .BALR TO TOD CLOCK CONVERSION ROUTINE               * 05200002
*                  TO SET THE CLOCK AND ISSUE WTOR REQUESTING         * 05250002
*                  THE PARAMETERS: ISSUE SVC 34 FOR SET COMMAND       * 05300002
*                 .DELETE THE TIME OF DAY CLOCK ROUTINE (IEAVRINT)    * 05330002
*                 .BALR TO MASTER VARIABLE INITIALIZATION (IEEMB850)  * 05360002
*                 .ATTACH THE INITIATOR TO START MASTER SCHEDULER     * 05390002
*                                                                     * 05450002
* EXIT - NORMAL  = IEFSD060                                           * 05500002
*  CONDITIONS    = NORMAL PROCESSING                                  * 05550002
*  OUTPUT DATA   = REGISTER 1 POINTS TO INITIATOR ENTRANCE LIST (IEL) * 05600002
*                  IEL CONTAINS THE FOLLOWING:                        * 05670002
*                      SIZE OF THE MASTER TIOT                        * 05750002
*                      SUBPOOL FOR MASTER SCHEDULER WORK AREA         * 05800002
*                  MASTER TCB WILL POINT TO A JSCB                    * 05850002
*                  THE JSCB WILL POINT TO: A DUMMY CSCB               * 05900002
*                                          THE SSIB                   * 05950002
*                                          THE ASCB                   * 06000002
*                  BASEA WILL CONTAIN THE ASCB                        * 06050002
*                  CVT CONTAINS ADDRESS OF SIC MODULE                 * 06060002
*                  CVT CONTAINS ADDRESSES OF RESOURCE MANAGER ROUTINES* 06070002
*                  JESCT CONTAINS ADDRESSES OF SWA MANAGEMENT ROUTINES* 06100002
*  RETURN CODE   = NONE                                               * 06150002
*                                                                     * 06200002
* EXIT - ERROR   = IPSTAR                                             * 06250002
*  CONDITIONS    = MASTER INITIALIZATION FAILURE                      * 06300002
*  OUTPUT DATA   = MESSAGE, DUMP                                      * 06350002
*                 '00B' INDICATES 'DUMP WAS TAKEN' WAIT CODE          * 06400002
*                 '00D' INDICATES 'NO DUMP WAS TAKEN' WAIT CODE       * 06450002
*  RETURN CODE   = NONE - PERMANENT WAIT STATE                        * 06500002
*                                                                     * 06550002
* EXTERNAL:                                                           * 06600002
*  REFERENCES    = NONE                                               * 06650002
*  ROUTINES      = IEFJSINT - SYBSYSTEM INTERFACE INITIALIZATION      * 06700002
*                  IEAVVINT - CONSOLE INITIALIZATION                  * 06750002
*                  IEAVRINT - TOD CLOCK CONVERSION ROUTINE            * 06800002
*                  IKJEFLF  - SYSTEM INITIATED CANCEL (SIC) ROUTINE   * 06810002
*                  IEFQB550 - SWA MANAGER MANAGEMENT ROUTINE          * 06850002
*                  IEFQB555 - SWA MANAGER MANAGEMENT ROUTINE          * 06900002
*                  IEFQB580 - SWA MANAGER MANAGEMENT ROUTINE          * 06950002
*                  IEFW21SD - DEVICE ALLOCATION ROUTINE       @Z40FPPJ* 06950503
*                  IEFBB410 - DEVICE UNALLOCATION ROUTINE     @Z40FPPJ* 06951003
*                  IEFAB4F5 - PRIVATE CATALOG ALLOC ROUTINE   @Z40FPPJ* 06951503
*                  IEFJRECM - SUBSYSTEM INTERFACE RESOURCE ROUTINE    * 06952002
*                  IEFIRECM - INITIATOR RESOURCE ROUTINE              * 06954002
*                  IEFAB4E5 - DEVICE ALLOCATION RESOURCE ROUTINE      * 06956002
*                  IEEMB850 - MASTER VARIABLE INITIALIZATION          * 06960002
*                  IEFSD060 - INITIATOR                               * 06970002
*  DATA AREAS    = ESTAE PARM AREA                                    * 07000002
*  CONTROL BLOCK = INITIATOR ENTRANCE LIST (IEL)            G,U       * 07050002
*                  ESTAE DIAGNOSTIC WORK AREA (SDWA)        R,U       * 07100002
*                  COMMUNICATION VECTOR TABLE (CVT)         R         * 07150002
*                  JOB ENTRY SUB-SYS CONTROL TABLE (JESCT)  U         * 07200002
*                  M.S. RESIDENT DATA AREA (BASEA)          R,U       * 07250002
*                  JOB STEP CONTROL BLOCK (JSCB)            G,U       * 07300002
*                  COMMAND SCHEDULING CONTROL BLOCK (CSCB)  G,U       * 07350002
*                  SUBSYSTEM IDENTIFICATION BLOCK (SSIB)    G,U       * 07400002
*                  ADDRESS SPACE VECTOR TABLE (ASVT)        R         * 07450002
*                  ADDRESS SPACE CONTROL BLOCK (ASCB)       R         * 07500002
*                  TASK CONTROL BLOCK (TCB)                 R,U       * 07510002
*                   KEY: G=GETMAIN                                    * 07550002
*                        U=UPDATE                                     * 07600002
*                        R=REFERENCE                                  * 07650002
*                        F=FREEMAIN                                   * 07700002
*  TABLES        = NONE                                               * 07750002
*  MACROS        = MODID      MODULE IDENTIFICATION                   * 07800002
*                  GETMAIN    STAE WORK AREA SIZE FROM SUBPOOL 253    * 07850002
*                  ESTAE      CREATE STAE ENVIRONMENT                 * 07900002
*                  GETMAIN    JSCB FROM SUBPOOL 241                   * 07950002
*                  GETMAIN    CSCB FROM SUBPOOL 245                   * 08000002
*                  GETMAIN    SSIB FROM SUBPOOL 241                   * 08050002
*                  GETMAIN    IEL FROM SUBPOOL 230                    * 08100002
*                  LOAD       IKJEFLF - SIC ROUTINE                   * 08160002
*                  DELETE     IKJEFLF - SIC ROUTINE                   * 08170002
*                  LOAD       IEFQB550 - SWA MANAGEMENT ROUTINE       * 08180002
*                  DELETE     IEFQB550 - SWA MANAGEMENT ROUTINE       * 08190002
*                  LOAD       IEFQB555 - SWA MANAGEMENT ROUTINE       * 08200002
*                  DELETE     IEFQB555 - SWA MANAGEMENT ROUTINE       * 08210002
*                  LOAD       IEFQB580 - SWA MANAGEMENT ROUTINE       * 08220002
*                  DELETE     IEFQB580 - SWA MANAGEMENT ROUTINE       * 08230002
*                  LOAD       IEFW21SD - DEVICE ALLOCATION ROUTINE    * 08231003
*                                                             @Z40FPPJ* 08232003
*                  DELETE     IEFW21SD - DEVICE ALLOC ROUTINE @Z40FPPJ* 08233003
*                  LOAD       IEFBB410 - DEVICE UNALLOC RTN   @Z40FPPJ* 08234003
*                  DELETE     IEFBB410 - DEVICE UNALLOC RTN   @Z40FPPJ* 08235003
*                  LOAD       IEFAB4F5 - PRIVATE CATALOG ALLOC RTN    * 08236003
*                                                             @Z40FPPJ* 08237003
*                  DELETE     IEFAB4F5 - PRIVATE CATALOG ALLOC RTN    * 08238003
*                                                             @Z40FPPJ* 08239003
*                  LOAD       IEFJRECM - SUBSYSTEM INTERFACE RESOURCE * 08240002
*                  DELETE     IEFJRECM - SUBSYSTEM INTERFACE RESOURCE * 08250002
*                  LOAD       IEFIRECM - INITIATOR RESOURCE           * 08260002
*                  DELETE     IEFIRECM - INITIATOR RESOURCE           * 08270002
*                  LOAD       IEFAB4E5 - DEVICE ALLOCATION RESOURCE   * 08280002
*                  DELETE     IEFAB4E5 - DEVICE ALLOCATION RESOURCE   * 08290002
*                  GETMAIN    COMMUNICATION TASK AREA FROM SUBPOOL 255* 08295002
*                  LINK       IEAVVINT - COMMUNICATION TASK           * 08300002
*                                                 INITIALIZATION      * 08310002
*                  POST       POST COMMUNICATION TASK COMPLETE        * 08400002
*                  LOAD       IEAVRINT - TOD CLOCK CONVERSION         * 08450002
*                  DELETE     IEAVRINT - TOD CLOCK CONVERSION         * 08500002
*                  FREEMAIN   THE COMMUNICATION TASK AREA             * 08550002
*                  ATTACH     IEFSD060 - INITIATOR                    * 08570002
*                  WAIT       ECB=WAITECB                             * 08590002
*                  SETRP    * RETURN TO ASIR                          * 08610002
*                  SDUMP    * TO SYS1.DUMP DATA SET                   * 08650002
*                  WTO      * MESSAGE IEE479W                         * 08700002
*                  WAIT     * PERMANENT WAIT STATE                    * 08720002
*                          '*' INDICATES ERROR PROCESSING             * 08750002
*  ENQUEUED-                                                          * 08800002
*   RESOURCES    = NONE                                               * 08850002
*  LOCKS         = NONE                                               * 08900002
*  CHANGE LEVEL  = Y02669, Y02653, Y02668, Z40RPSQ,@Z40FPPJ,ZA30544   * 08950003
*  SYSGEN        = IEEVIPL RESIDES IN LINKLIB                         * 09000002
*                  IEEMB850 IS IN THE IEEVIPL LOAD                    * 09050002
*                  IEFJSINT IS IN THE IEEVIPL LOAD                    * 09100002
*  LIBRARIES     = NONE                                               * 09150002
*                                                                     * 09200002
* MESSAGES       = IEE479W MASTER SCHEDULER ABEND XXX, DUMPED, REIPL  * 09250002
*                = IEE479W MASTER SCHEDULER FAILED, DUMPED, REIPL     * 09260002
*                     'XXX' IS THE ABEND CODE                         * 09300002
*                     'DUMPED' WILL APPEAR ONLY IF A DUMP WAS TAKEN   * 09350002
*                                                                Y02653 09360002
* WAIT STATE CODES= 00B - DUMP TAKEN                             Y02653 09370002
*                   00D - NO DUMP TAKEN                          Y02653 09380002
*********************************************************************** 09400002
* THIS APAR SUPPORTS MERGE OF SU 4 CODE TO REL. 037 BASE       @ZA30544 09420003
         EJECT                                                          09450002
*********************************************************************** 09500002
*                                                                       09550002
*                      REGISTER EQUATES                                 09600002
*                                                                       09650002
*********************************************************************** 09700002
R0       EQU   0                  REGISTER USED IN MACRO CALLS   Y02669 09750002
R1       EQU   1                  REGISTER USED IN MACRO CALLS   Y02669 09800002
R2       EQU   2                  PARAMETER BASE IN ESTAE EXIT   Y02653 09850002
R3       EQU   3                  USED TO CREATE THE STAE        Y02653 09900002
R4       EQU   4                  USED AS SAVE AND WORK REGISTER Y02669 09950002
R5       EQU   5                  BASE FOR IEL AND WORK REGISTER Y02669 10000002
R6       EQU   6                  USED AS A WORK REGISTER        Y02669 10050002
R7       EQU   7                  UNUSED REGISTER                Y02669 10100002
R8       EQU   8                  MODULE BASE REGISTER           Y02669 10150002
R9       EQU   9                  ABEND CODE REGISTER            Y02653 10200002
R10      EQU   10                 DUMP RETURN CODE REGISTER      Y02653 10250002
R11      EQU   11                 BASEA BASE REGISTER            Y02669 10300002
R12      EQU   12                 CVT BASE REGISTER              Y02669 10350002
R13      EQU   13                 SAVE AREA POINTER              Y02669 10400002
R14      EQU   14                 RETURN ADDRESS REGISTER        Y02669 10450002
R15      EQU   15                 RETURN CODE AND WORK REGISTER  Y02669 10500002
*                                                                       10550002
K0       EQU   0                                                 Y01043 10600002
K1       EQU   1                                                 Y02669 10650002
K2       EQU   2                                                 Y02653 10660002
K3       EQU   3                                                 Y01043 10700002
K4       EQU   4                                                 Y01043 10750002
K5       EQU   5                                                 Y01043 10800002
K8       EQU   8                                                 Y02669 10850002
K12      EQU   12                                                Y01043 10900002
K15      EQU   15                                                Y02653 10950002
K40      EQU   40                                                Y01043 11000002
K64      EQU   64                                                Y02669 11010002
*                                                                       11050002
BLANK    EQU   C' '               USED IN MESSAGE BUILDING       Y02653 11100002
COMMA    EQU   C','               USED IN MESSAGE BUILDING       Y02653 11150002
TIOTSIZE EQU   1                  # OF 4K BLOCKS FOR TIOT        Y02669 11200002
SWAPOOL  EQU   237                SWA SUBPOOL # FOR MASTER      @YM2429 11250002
COMMONSP EQU   241                CSA SUBPOOL                   @YM2429 11270002
         EJECT                                                          11300002
*********************************************************************** 11350002
*              INITIALIZE SYSTEM TO SYSTEM RESIDENCE                    11400002
*********************************************************************** 11450002
MODSTRT  EQU   *                                                 Y01043 11500002
         BALR  R8,0               SET BASE REGISTER                OC43 11550002
         USING *,R8                                                OC43 11600002
         MODID BR=YES                                            Y01886 11650002
         EJECT                                                          11700002
*********************************************************************** 11750002
*        THE FOLLOWING CODE WILL GET AN AREA FOR USE BY THE STAE      * 11800002
*        ROUTINE.  IT WILL SET UP AND CREATE THE STAE ENVIRONMENT.    * 11850002
*        IPL WILL CONTINUE ONLY IF THE STAE IS SUCCESSFUL.            * 11900002
*********************************************************************** 11950002
         L     R0,PARMAR          SP/SIZE FOR STAE AREA          Y01043 12000002
         GETMAIN R,LV=(0)         GET AREA                       Y01043 12050002
         LR    R4,R1              SAVE PARMAREA ADDRESS          Y02653 12100002
         USING PARMAREA,R4        BASE THE PARMAREA              Y02653 12150002
         MVC   STAELIST(STAEL),LSTAE   SET UP TO ISSUE STAE      Y02653 12200002
         XC    PROSCDE(ENDAREA-STRTAREA),PROSCDE  ZERO STAE    @YM3523P*12250002
                                                   PARM AREA   @YM3523P 12280002
         LA    R3,IPSTAR          ADDRESS OF STAE CODE           Y02653 12310002
         LA    R1,STAELIST        ADDRESS OF STAE LIST           Y02653 12340002
         ESTAE (3),RECORD=YES,PARAM=(4),MF=(E,(1))               Y02653 12400002
         LTR   R15,R15            STAE ENVIRONMENT CREATED?      Y01043 12450002
         BZ    STAEOK             YES, CONTINUE INITIALIZATION   Y02653 12500002
         OI    FLGS,PDUMP         NO, INDICATE DUMP REQUIRED     Y02653 12550002
         LR    R2,R4              SET PARAMETER AREA ADDRESS     Y02653 12600002
         B     BRENTY             INFORM OPERATOR OF FAILURE     Y02653 12650002
         EJECT                                                          12700002
*********************************************************************** 12750002
*        THE FOLLOWING CODE WILL SET UP THE ENVIRONMENT REQUIRED      * 12800002
*        TO CONTINUE WITH THE MASTER SCHEDULER INITIALIZATION.        * 12850002
*        THE FOLLOWING CONTROL BLOCKS WILL BE GOTTEN AND CHAINED:     * 12900002
*            JOB STEP CONTROL BLOCK (JSCB)                            * 12950002
*            COMMAND SCHEDULING CONTROL BLOCK (CSCB)                  * 13000002
*            SUBSYSTEM INTERFACE BLOCK (SSIB)                         * 13050002
*            INITIATOR ENTRANCE LIST (IEL)                            * 13100002
*        IN ADDITION, THE ASCB ADDRESS WILL BE FOUND AND              * 13150002
*        PUT INTO BASEA FOR USE IN POSTING THE MASTER.                * 13200002
*********************************************************************** 13250002
STAEOK   EQU   *                                                 Y02669 13300002
         L     R12,CVTPTR         GET CVT POINTER                Y02669 13350002
         USING CVT,R12            SET CVT BASE                   Y02669 13400002
         L     R11,CVTMSER        GET BASEA POINTER              Y02669 13450002
         USING BASE,R11           SET BASEA BASE                 Y02669 13500002
         XC    BAMSLNK(BAPMLGTH),BAMSLNK                         Y02669*13600002
                                  CLEAR THE NIP LINK AREA        Y02669 13620002
*********************************************************************** 13650002
*        GET THE JOB STEP CONTROL BLOCK                               * 13690002
*********************************************************************** 13730002
         L     R0,JSCBINF         SP/SIZE FOR GETMAIN            Y02669 13770002
         GETMAIN R,LV=(0)         GET THE JSCB                   Y02669 13810002
         XC    K0(JSCBAOS2,R1),K0(R1)  ZERO OUT THE JSCB         Y02669 13850002
         LA    R15,JSCBDISP       DISPLACE OF FIRST BYTE         Y02669 13890002
         SR    R1,R15             COMPUTE THE ADDRESS FOR TCB    Y02669 13930002
         USING IEZJSCB,R6         BASE THE JSCB                  Y02669 13970002
         LR    R6,R1              SET THE JSCB ADDRESS           Y02669 14010002
         MVI   JSCBSWSP,SWAPOOL   INDICATE SWA SUBPOOL          @YM2429 14050002
         ST    R6,JSCBACT         SET THE ACTIVE JSCB FIELD      Y02669 14090002
         L     R1,CVTTCBP         GET THE TCB POINTERS           Y02669 14130002
         USING TCBASCB,R1         BASE THE BLOCK POINTERS        Y02669 14170002
         L     R1,TCBPTR          GET THE CURRENT TCB            Y02669 14210002
         DROP  R1                 RELEASE THE BASE               Y02669 14250002
         USING TCB,R1             BASE THE TCB                   Y02669 14290002
         ST    R6,TCBJSCB         SET THE JSCB ADDRESS IN TCB    Y02669 14330002
         DROP  R1                 RELEASE THE TCB BASE REGISTER  Y02669 14370002
         EJECT                                                          14510002
*********************************************************************** 14550002
*        GET THE COMMAND SCHEDULING CONTROL BLOCK                     * 14600002
*********************************************************************** 14650002
         L     R0,CSCBINF         SP/SIZE OF CSCB                Y02669 14700002
         GETMAIN R,LV=(0)         GET CORE FOR THE CSCB          Y02669 14750002
         XC    K0(CSCBLEN,R1),K0(R1)   ZERO OUT THE CSCB         Y02669 14800002
         ST    R1,JSCBCSCB        SET THE CSCB ADDRESS IN JSCB   Y02669 14850002
*********************************************************************** 14900002
*        GET THE SUBSYSTEM IDENTIFICATION BLOCK                       * 14950002
*********************************************************************** 15000002
         L     R0,SSIBINF         SP/SIZE OF SSIB                Y02669 15050002
         GETMAIN R,LV=(0)         GET CORE FOR THE SSIB          Y02669 15100002
         XC    K0(SSIBSIZE,R1),K0(R1)  ZERO OUT THE SSIB         Y02669 15150002
         USING SSIB,R1            BASE THE SSIB                  Y02669 15200002
         LA    R5,SSIBSIZE        GET THE LENGTH OF SSIB         Y02669 15250002
         STH   R5,SSIBLEN         SET THE LENGTH OF SSIB IN SSIB Y02669 15300002
         MVC   SSIBID(L'SSID),SSID     INDICATE SSIB BLOCK       Y02669 15400002
         MVC   SSIBSSNM(L'MINF-4),MINF INDICATE MASTER SSIB      Y02669 15450002
         MVC   SSIBJBID(L'MINF),MINF   INDICATE MASTER JOB ID    Y02669 15500002
         DROP  R1                 RELEASE THE BASE FOR SSIB      Y02669 15550002
         ST    R1,JSCBSSIB        SET THE SSIB ADDRESS IN JSCB   Y02669 15580002
         EJECT                                                          15610002
*********************************************************************** 15650002
*        GET THE INITIATOR ENTRANCE LIST                              * 15700002
*********************************************************************** 15750002
         L     R0,IELINF          SP/SIZE OF THE IEL             Y02669 15800002
         GETMAIN R,LV=(0)         GET CORE FOR THE IEL           Y02669 15850002
         XC    K0(IELLLEN,R1),K0(R1)   ZERO OUT THE IEL          Y02669 15900002
         USING IEL,R5             BASE THE IEL                   Y02669 15950002
         LR    R5,R1              SET BASE REGISTER              Y02669 16000002
         MVI   IELTSIZ,TIOTSIZE   SET SIZE OF MASTER TIOT        Y02669 16050002
         MVI   IELSWAS,COMMONSP  SUBPOOL FOR MASTER SWA         @YM2429 16100002
*********************************************************************** 16150002
*        INDICATE TO THE INITIATOR NOT TO USE 'DON'T SHARE SWA        * 16200002
*        OPTION' ON THE ATTACH; TO DO PROCESSING FOR ONLY ONE         * 16250002
*        JOB, AND THAT THIS IS AN INITIATOR TASK.                     * 16300002
*********************************************************************** 16350002
         OI    IELOPSW1,IELDPSWA+IELONEJF+IELICMDF               Y02669 16400002
         MVC   IELCSCB(K4),JSCBCSCB    SET CSCB ADDRESS IN IEL   Y02669 16450002
         LA    R1,IELOPTS         GET ADDRESS OF OPTION LIST     Y02669 16500002
         ST    R1,IELOPLST        STICK IT IN ENTRANCE LIST      Y02669 16550002
         LA    R1,IELEXITS        GET EXIT LIST ADDRESS          Y02669 16600002
         ST    R1,IELEXIT         PUT IT IN ENTRANCE LIST        Y02669 16650002
         OI    IELEXIT,IELEND     INDICATE END OF LIST           Y02669 16700002
         LA    R1,IELOPTLN        LENGTH OF OPTION LIST          Y02669 16750002
         STH   R1,IELOPLEN        PUT IT IN THE OPTION LIST      Y02669 16800002
         DROP  R5                 RELEASE IEL BASE REGISTER      Y02669 16850002
*********************************************************************** 16900002
*        GET TO THE MASTER ASCB WHICH WILL ALWAYS BE THE FIRST        * 16950002
*        ASCB POINTED TO BY THE ASVT AND COPY THE ASCB ADDRESS        * 17000002
*        INTO THE MASTER SCHEDULER DATA AREA (BASEA).                 * 17050002
*********************************************************************** 17100002
         L     R1,CVTTCBP         GET ADDRESS OF BLOCKS        @YM00015 17150002
         USING TCBASCB,R1         BASE THE SYSTEM POINTERS     @YM00015 17200002
         L     R1,ASCBPTR         GET TO THE ASCB'S            @YM00015 17250002
         ST    R1,BAASCB          PUT IT IN BASEA              @YM00015 17300002
         USING ASCB,R1            BASE THE ASCB                @YM00015 17350002
         MVC   JSCBTJID(K2),ASCBASID   MOVE ASID FROM ASCB     @YM00015*17420002
                                           INTO JSCB           @YM00015 17430002
         DROP  R1                 RELEASE BASEA BASE REGISTER  @YM00015 17440002
         DROP  R6                 RELEASE JSCB BASE REGISTER   @YM00015 17470002
         EJECT                                                          17500002
*********************************************************************** 17550002
*        THE SYSTEM INITIATED CANCEL (SIC) ROUTINE WILL BE            * 17590002
*        LOADED AND ITS ADDRESS PUT IN THE CVT.  THE SWA MANAGER      * 17610002
*        ROUTINES ARE LOADED AND THEIR ADDRESSES PUT IN THE JESCT.    * 17630002
*        THE ALLOCATION,UNALLOCATION, AND PRIVATE CATALOG RTN @Z40FPPJ* 17636003
*        ARE LOADED AND THEIR ADDRESSES PUT IN THE JESCT      @Z40FPPJ* 17642003
*********************************************************************** 17650002
         LOAD  EP=IKJEFLF         LOAD THE SIC ROUTINE           Y02669 17670002
         ST    R0,CVTSIC          SET ADDRESS IN CVT             Y02669 17690002
         DELETE EP=IKJEFLF        ELIMINATE ITS CDE ENTRY        Y02669 17710002
         L     R6,CVTJESCT        ADDRESS OF THE JESCT           Y02669 17730002
         USING JESCT,R6           BASE THE JESCT                 Y02669 17750002
         MVC   JESUNITS(K4),CVTSYSAD   UCB ADDRESS TO JESCT      Y02669 17810002
         LOAD  EP=IEFQB550        GET ADDRESS OF IEFQB550        Y02669 17850002
         ST    R0,JESQMGR         PUT ITS ADDRESS IN JESCT       Y02669 17880002
         DELETE EP=IEFQB550       ELIMINATE ITS CDE ENTRY        Y02669 17910002
         LOAD  EP=IEFQB555        GET ADDRESS OF IEFQB555        Y02669 17940002
         ST    R0,JESWAA          PUT ITS ADDRESS IN JESCT       Y02669 17970002
         DELETE EP=IEFQB555       ELIMINATE ITS CDE ENTRY        Y02669 18000002
         LOAD  EP=IEFQB580        GET ADDRESS OF IEFQB580        Y02669 18030002
         ST    R0,JESRESQM        PUT ITS ADDRESS IN JESCT       Y02669 18060002
         DELETE EP=IEFQB580       ELIMINATE ITS CDE ENTRY        Y02669 18090002
         LOAD  EP=IEFW21SD        GET ADDR ALLOCATION          @Z40FPPJ 18091003
         ST    R0,JESALLOC        SAVE EP IN JESCT             @Z40FPPJ 18092003
         DELETE EP=IEFW21SD       DELETE CDE                   @Z40FPPJ 18093003
         LOAD  EP=IEFBB410        GET ADDR UNALLOCATION        @Z40FPPJ 18094003
         ST    R0,JESUNALC        SAVE EP IN JESCT             @Z40FPPJ 18095003
         DELETE EP=IEFBB410       DELETE CDE                   @Z40FPPJ 18096003
         LOAD  EP=IEFAB4F5        GET ADDR PVT CATL RTN        @Z40FPPJ 18097003
         ST    R0,JESCATL         SAVE ADDR IN JESCT           @Z40FPPJ 18098003
         DELETE EP=IEFAB4F5       DELETE CDE                   @Z40FPPJ 18099003
*** THIS SECTION OF CODE COUNTS THE NUMBER OF UCB'S IN THE     @Z40FPPJ 18100003
*** SYSTEM AND STORES IT FOR USE BY DEVICE ALLOCATION          @Z40FPPJ 18101003
         L     R1,CVTILK2        GET ADDRESS OF LUT            @Z40FPPJ 18102003
         L     R13,LUTEND        END OF LUT INDICATOR          @Z40FPPJ 18103003
         SLR   R7,R7             CLEAR COUNT REG               @Z40FPPJ 18104003
CHKNXT   L     R2,0(R1)          LOAD TWO UCB ADDRS            @Z40FPPJ 18105003
         SRL   R2,16             GET RID OF SECOND & FILL      @Z40FPPJ 18106003
*                                IN WITH LEADING ZEROS         @Z40FPPJ 18107003
         LTR   R2,R2             CHECK FOR ZERO ADDR           @Z40FPPJ 18108003
         BZ    SKIPIT            BYPASS THIS CASE              @Z40FPPJ 18109003
         CR    R13,R2            CHECK FOR END OF TABLE        @Z40FPPJ 18110003
         BE    ENDOFLUT          WE ARE FINIS                  @Z40FPPJ 18111003
         USING UCBOB,R2          MUST BE VALID UCB ADDR        @Z40FPPJ 18112003
         TM    UCBTBYT3,UCB3TAPE IS IT FOR TAPE                @Z40FPPJ 18113003
         BO    GOODONE           YES, COUNT IT                 @Z40FPPJ 18114003
         TM    UCBTBYT3,UCB3DACC IS IT FOR DIR. ACCESS         @Z40FPPJ 18115003
         BNO   SKIPIT            BYPASS IF NOT DA              @Z40FPPJ 18116003
GOODONE  LA    R7,1(R7)          INCR COUNT OF TAPE AND        @Z40FPPJ 18117003
*                                DIRECT ACCESS UCB'S           @Z40FPPJ 18118003
SKIPIT   LA    R1,2(R1)          INCR PTR TO NEXT LUT ENTRY    @Z40FPPJ 18119003
         B     CHKNXT            DO AGAIN                      @Z40FPPJ 18120003
ENDOFLUT ST    R7,JESNUCBS       SAVE COUNT IN JESCT           @Z40FPPJ 18121003
         DROP  R6                                                Y02669 18150002
         EJECT                                                          18200002
*********************************************************************** 18210002
*        THE FOLLOWING CODE WILL LOAD THE ADDRESSES OF THE            * 18214002
*        SCHEDULER RESOURCE MANAGERS INTO THE CVT.                    * 18218002
*********************************************************************** 18222002
         LOAD   EP=IEFJRECM       LOAD THE SUBSYTEM INTERFACE    Y02669*18226002
                                      RESOURCE MANAGER           Y02669 18230002
         ST     R0,CVTJRECM       PUT ITS ADDRESS INTO THE CVT   Y02669 18234002
         DELETE EP=IEFJRECM       DELETE THE CDE ENTRY           Y02669 18238002
         LOAD   EP=IEFIRECM       LOAD THE INITIATOR             Y02669*18242002
                                      RESOURCE MANAGER           Y02669 18246002
         ST     R0,CVTIRECM       PUT ITS ADDRESS INTO THE CVT   Y02669 18250002
         DELETE EP=IEFIRECM       DELETE THE CDE ENTRY           Y02669 18254002
         LOAD   EP=IEFAB4E5       LOAD THE DEVICE ALLOCATION     Y02669*18258002
                                      RESOURCE MANAGER           Y02669 18262002
         ST     R0,CVTDARCM       PUT ITS ADDRESS INTO THE CVT   Y02669 18266002
         DELETE EP=IEFAB4E5       DELETE THE CDE ENTRY           Y02669 18270002
         EJECT                                                          18276602
*********************************************************************** 18283302
*        THE FOLLOWING CODE WILL GET A REGISTER SAVE AREA TO BE       * 18323302
*        USED BY ROUTINES INVOKED OUT OF IEEVIPL.  THEN THE SUBSYSTEM * 18363302
*        INITIALIZATION ROUTINE (IEFJSINT) IS INVOKED.  THEN THE      * 18403302
*        VARIABLE INITIALIZATION ROUTINE (IEEMB850) IS INVOKED.       * 18443302
*        THE TSO SERVICE ROUTINE(IKJEFXSR) IS THEN LINKED TO , @YM2225P 18453302
*        WITH NO INPUT SUPPLIED TO IT.                         @YM2225P 18463302
*        THE COMMUNICATION TASK INITIALIZATION MODULE (IEAVVINT) WILL * 18483302
*        BE LINKED TO AND THERE WILL BE NO INPUT SUPPLIED TO IT.      * 18523302
*********************************************************************** 18563302
         GETMAIN R,SP=255,LV=72   AREA FOR COMUNICATION TASK     Y02669 18603302
         LR    R13,R1             STANDARD SAVE POINTER          Y02669 18643302
         L     R15,IEFJSINT       LOAD ADDRESS OF SUB-ROUTINE    Y02669 18683302
         BALR  R14,R15                                           Y02669 18750002
         LINK  EP=IEAVVINT        INVOKE COMMUNICATION TASK             18800002
         SR    R0,R0              POST CODE                             18850002
         LA    R1,BAIPL           ECB ADDRESS                           18900002
         POST  (1),(0)            POST COMMUNICATION TASK               18950002
         NI    CVTOPTA,X'FF'-CVTNIP    COMM TASK INIT COMPLETE   Y01045 19000002
         LA    R1,K15             'F' FOR SIGN                   Y02669 19050002
         ST    R1,CVTDATE         SET IT IN CVT                         19080002
         XC    BAIPL,BAIPL        CLEARED FOR SET COMMAND               19110002
         NI    BASFL,255-BAIN     CLEAR IPL SWITCH                      19140002
         XC    BAQ(K8),BAQ        ZERO OUT AREA                  Y02669 19170002
         L     R15,IEEMB850       ADDRESS OF VARIABLE INITIALIZATION    19200002
         BALR  R14,R15            CALL THE ROUTINE               Y02669 19230002
         LINK  EP=IKJEFXSR        INVOKE THE TSO SERVICE RTN   @YM2225P 19260002
         EJECT                                                          19300002
*********************************************************************** 19350002
*        THE TIME OF DAY CLOCK PROCESSOR WILL BE LOADED, BRANCHED     * 19400002
*        TO, AND THEN DELETED.  REGISTER ONE WILL POINT TO BASEA.     * 19450002
*        THE TOD CLOCK PROCESSOR WILL ISSUE AN INTERNAL SET           * 19500002
*        COMMAND, AND WAIT FOR RETURN FROM SVC 34.  ON RETURN         * 19550002
*        FROM SVC 34, IF THE SET COMMAND IS INVALID, IT WILL          * 19600002
*        REISSUE THE WTOR ASKING FOR SET PARAMETERS.                  * 19650002
*********************************************************************** 19700002
         LOAD  EP=IEAVRINT        LOAD TOD ROUTINE               Y02669 19750002
         LR    R1,R11             PASS BASEA ADDRESS             Y02669 19800002
         LR    R15,R0             SET TOD ROUTINE ADDRESS        Y02669 19850002
         BALR  R14,R15            INVOKE ROUTINE                 Y02669 19900002
         LR    R6,R15             SAVE RETURN CODE               Y02669 19950002
         DELETE EP=IEAVRINT       GET RID OF TOD MODULE          Y02669 20000002
         LR    R1,R13             ADDRESS OF AREA TO FREE        Y02669 20050002
         FREEMAIN R,LV=72,SP=255,A=(1)                           Y02669 20100002
         LTR   R6,R6              TOD CLOCK PROCESS OK?          Y02669 20150002
         BZ    CLOCKOK            YES, CONTINUE IPL              Y02669 20190002
         OI    FLGS,PDUMP         NO, INDICATE DUMP REQUIRED     Y02669 20230002
         LR    R2,R4              SET PARAMTER AREA ADDRESS      Y02669 20270002
         B     BRENTY             INFORM OPERATOR OF FAILURE     Y02669 20310002
         EJECT                                                          20350002
*********************************************************************** 20400002
*        THE FOLLOWING WILL INVOKE THE INITIATOR MODULE (IEFSD060)    * 20450002
*        VIA THE ATTACH MACRO INSTRUCTION, PASSING TO IT A POINTER TO * 20500002
*        THE IEL CREATED EARLIER.                                     * 20550002
*        IF CONTROL IS EVER RETURNED TO THIS ROUTINE, THEN A DUMP     * 20600002
*        WILL BE TAKEN, AND A MESSAGE ISSUED AND THE SYSTEM WILL      * 20650002
*        BE PUT INTO A WAIT STATE.                                    * 20700002
*********************************************************************** 20750002
CLOCKOK  EQU   *                                                 Y02669 20800002
         OI    BASFL,BAIN         TURN ON 'NO IPL' BIT            20071 20900002
         LR    R1,R5              SET POINTER TO IEL             Y02669 20930002
         STM   R0,R15,IELLLEN(R1) SAVE REGISTERS                 Y02669 20960002
         ATTACH EP=IEFSD060,ECB=WAITECB,JSTCB=YES,SM=SUPV      @YM01706*21000002
                                       ATTACH THE INITIATOR      Y02669 21002002
         WAIT  ECB=WAITECB        WAIT ON ECB                    Y02669 21010002
         EJECT                                                          21012002
*********************************************************************** 21015802
*        THIS CODE SHOULD NEVER RECEIVE CONTROL, SINCE THE            * 21018802
*        MASTER SCHEDULER SHOULD NEVER TERMINATE.  IF CONTROL IS      * 21021802
*        RECEIVED, IT WILL BE TREATED AS A FAILURE, AND CONTROL WILL  * 21024802
*        BE PASSED TO THE BRANCH ENTRY OF THE RECOVERY CODE, WITH     * 21027802
*        AN INDICATOR THAT A DUMP SHOULD BE TAKEN.                    * 21030802
*********************************************************************** 21033802
         SPACE                                                          21042402
         LM    R0,R15,IELLLEN(R5) RESTORE REGISTERS              Y02669 21046202
         LR    R2,R4              POINTER TO THE STAE PARAMETER  Y02653*21050202
                                       AREA                      Y02653 21054202
         OI    FLGS,PDUMP         INDICATE DUMP REQUIRED         Y02653 21060002
         B     BRENTY             INVOKE STAE ROUTINE            Y02669 21100002
         DROP  R4                 RELEASE PARMAREA BASE          Y02653 21140002
         DROP  R11                RELEASE BASE FOR BASEA         Y02669 21180002
         DROP  R12                RELEASE BASE FOR CVT           Y02669 21220002
         EJECT                                                          21260002
*********************************************************************** 21300002
*       STAE EXIT CODE FOR THE PROTECTION OF IEEVIPL PROCESSING       * 21350002
*        THIS CODE WILL:                                              * 21400002
*              .INVOKE SVC DUMP IF NECESSARY                          * 21450002
*              .ISSUE A MESSAGE TO INFORM OPERATOR OF PROBLEM         * 21500002
*              .INFORM OPERATOR OF DUMP STATUS                        * 21550002
*              .ENTER A PERMANENT WAIT STATE                          * 21600002
*        THE MESSAGES ISSUED ARE:                                     * 21650002
*               IEE479W MASTER SCHEDULER ABEND XXX, DUMPED, REIPL     * 21700002
*                  XXX - THIS IS THE ABEND COMPLETION CODE            * 21750002
*               IEE479W MASTER SCHEDULER FAILED, DUMPED, REIPL        * 21800002
*                  THE 'DUMPED' PART OF MESSAGE WILL APPEAR ONLY IF   * 21850002
*                    THE DUMP WAS TAKEN AND WAS SUCCESSFUL.           * 21900002
*********************************************************************** 21950002
IPSTAR   EQU   *                  START OF STAE CODE             Y01043 22000002
         BALR  R8,R0              SET ADDRESSABILITY             Y01043 22030002
         LA    R15,IPSTAR-MODSTRT FIND DIFFERENCE FROM BEGINNING Y01043 22060002
         SR    R8,R15             SET UP THE BASE REGISTER       Y01043 22090002
         C     R0,TWELVE          WAS WORKAREA SUPPLIED?         Y02653 22120002
         BE    IPSTAR1            NO, SKIP WORKAREA PROCESS      Y02653 22150002
         LR    R11,R1             SET BASE REGISTER FOR SDWA     Y02653 22180002
         USING SDWA,R11           SET BASE TO SDWA               Y02653 22210002
         USING PARMAREA,R2        BASE TO PARAMETER AREA         Y02653 22240002
         L     R2,SDWAPARM        ADDRESS OF PARAMETER AREA      Y02653 22270002
         L     R1,SDWAABCC        SAVE ABEND CODE                Y02653 22300002
         ST    R2,SDWASR01        SAVE PARAMETER BASE ADDRESS    Y02653 22330002
         TM    SDWAERRC,SDWAPERC  IS IT PERCOLATION?             Y02653 22360002
         BO    IPSTAR2            YES, BYPASS DUMP INDICATOR     Y02653 22390002
         TM    SDWAERRA,SDWAMCHK  ENTERED BECAUSE OF MACH CHK? @YM3509P 22430002
         BO    IPSTAR2            YES, BYPASS DUMP INDICATOR   @YM3509P 22470002
         DROP  R11                                                      22532002
IPSTAR1  EQU   *                                                 Y02653 22540002
         OI    FLGS,PDUMP         INDICATE DUMP REQUIRED         Y02653 22542002
IPSTAR2  EQU   *                                                 Y02653 22544002
         ST    R8,PSAVER          SAVE ROUTINE BASE ADDRESS      Y02653 22550002
         OI    FLGS,PABND         INDICATE CODE SUPPLIED         Y02653 22570002
         ST    R1,PABEND          SAVE ABEND CODE                Y02653 22590002
         C     R0,TWELVE          WAS SDWA PASSED?               Y02653 22610002
         BE    IPSTAR3            NO, BYPASS SDWA SETUP          Y02653 22630002
         LR    R1,R11             RESET SDWA ADDRESS             Y02653 22650002
         SETRP RETADDR=COMMON,RETREGS=YES,RECORD=YES,                  *22700002
               RECPARM=LRECINF,RC=4,FRESDWA=YES,DUMP=NO        @YM3510P 22750002
         BR    R14                RETURN TO ASIR                 Y02653 22760002
IPSTAR3  EQU   *                                                 Y02653 22800002
         LA    R15,K4             INDICATE RETRY                 Y02653 22850002
         LA    R0,COMMON          INDICATE RETRY ADDRESS         Y02653 22860002
         BR    R14                RETURN TO ASIR                 Y02653 22870002
COMMON   EQU   *                                                 Y01043 22900002
         LR    R2,R1              SET PARAMETER AREA ADDR        Y02653 22902002
         L     R8,PSAVER          LOAD BASE ADDRESS              Y02653 23002002
         EJECT                                                          23250002
*********************************************************************** 23300002
*        THIS IS THE BRANCH ENTRY POINT TO RECOVERY FOR               * 23307002
*        FAILURES DISCOVERED BY IEEVIPL, AS WELL AS THE               * 23314002
*        STARTING POINT FOR ESTAE RETRY PROCESSING.                   * 23321002
*                                                                     * 23328002
*        INPUT FOR THE BRANCH ENTRY SHOULD BE:                        * 23335002
*             PDUMP BIT 'ON' IN ALL CASES                             * 23342002
*                                                                     * 23349002
*        RECURSION CAN OCCUR IF A FAILURE OCCURS DURING THE           * 23356002
*        DUMP OR WRITING THE MESSAGE.  SINCE THESE FUNCTIONS ARE      * 23363002
*        PERFORMED IN RETRY CODE, THEY ARE PROTECTED BY THE           * 23370002
*        ESTAE.  THE RECURSION INDICATOR IS INCREMENTED ON ENTRY      * 23377002
*        TO EACH FUNCTION AND THE USE OF THE BRANCH TABLE AT THE      * 23384002
*        START OF RETRY PROCESSING ASSURES THAT FAILING RETRY         * 23391002
*        FUNCTIONS WILL NOT BE ATTEMPTED A SECOND TIME.               * 23398002
*********************************************************************** 23405002
BRENTY   EQU   *                                                 Y02653 23424002
         LH    R4,PROSCDE         GET RECURSION INDICATOR        Y02653 23424102
         B     BRTAB1(R4)         (RE-)START PROCESSING          Y02653 23427102
BRTAB1   EQU   *                                                 Y02653 23430402
         B     TRYDUMP            DUMP SYSTEM                    Y02653 23432402
         B     TRYMSG0            ISSUE MESSAGE                  Y02653 23432502
         B     DOWAIT             KILL SYSTEM                    Y02653 23432602
         EJECT                                                          23432702
*********************************************************************** 23432802
*        DETERMINE IF A DUMP IS NECESSARY.  IF ENTERED BECAUSE        * 23452802
*        OF A SYSTEM FAILURE, OR PROGRAM CHECK, OR THE SYSTEM         * 23472802
*        RESTART KEY WAS DEPRESSED, THEN A DUMP WILL BE TAKEN.        * 23492802
*********************************************************************** 23550002
TRYDUMP  EQU   *                                                 Y01043 23600002
         LH    R4,PROSCDE         OBTAIN PROCESS CODE            Y02653 23650002
         LA    R4,K4(R4)          INCREMENT BY 4                 Y02653 23730002
         STH   R4,PROSCDE         STORE NEW PROCESS CODE         Y02653 23810002
         TM    FLGS,PDUMP         IS DUMP REQUIRED?              Y02653 23890002
         BNO   TRYMSG0            NO, BYPASS DUMP                Y02653 23970002
         MVC   MSGAREA(DUMPL),DUMPPARM MOVE IN DUMP LIST         Y01043 24050002
         LA    R1,MSGAREA         ADDRESS OF LIST                Y01043 24100002
         SDUMP MF=(E,(1))         DUMP SYSTEM                    Y01043 24150002
         LR    R10,R15            SAVE RETURN CODE               Y01043 24200002
         B     TRYMSG1            GO PUT OUT MESSAGE             Y01043 24250002
TRYMSG0  EQU   *                                                 Y01043 24300002
         LA    R10,K4             INDICATE DUMP NOT TAKEN        Y02653 24350002
         EJECT                                                          24400002
*********************************************************************** 24405002
*        IF THE COMMTASK HAS NOT BEEN INITIALIZED, THE                * 24410002
*        SYSTEM IS PUT IN A DISABLED WAIT STATE VIA LPSW.             * 24415002
*********************************************************************** 24420002
TRYMSG1  EQU   *                                               @YM01904 24425002
         LH    R4,PROSCDE         OBTAIN PROCESS CODE          @YM01904 24426002
         LA    R4,K4(R4)          INCREMENT BY 4               @YM01904 24456002
         STH   R4,PROSCDE         STORE NEW PROCESS CODE       @YM01904 24486002
         L     R1,CVTPTR          GET THE ADDRESS OF THE CVT   @YM01904 24516002
         USING CVT,R1             BASE THE CVT                 @YM01904 24546002
         TM    CVTOPTA,CVTNIP     COMMTASK INIT COMPLETE?      @YM01904 24576002
         BO    DOWAIT             NO, GO LOAD WAIT PSW         @YM01904 24606002
*********************************************************************** 24636002
*        THE REST OF THIS ROUTINE IS TO CONSTRUCT AND ISSUE THE       * 24666002
*        MASTER SCHEDULER FAILURE MESSAGE, AFTER WHICH A WAIT         * 24696002
*        STATE WILL BE ENTERED.                                       * 24726002
*********************************************************************** 24756002
         MVC   MSGAREA(LEN7),ABMSG     MOVE IN BASE MESSAGE      Y01043 24850002
         LA    R5,MSGAREA         ADDRESS OF MESSAGE BUFFER      Y01043 24900002
         LR    R6,R5              ADDRESS OF MESSAGE BUFFER      Y01043 24950002
         AH    R6,MSGLEN          BUMP TO END OF MESSAGE         Y01043 25000002
         TM    FLGS,PABND         IS THERE AN ABEND CODE?        Y01043 25050002
         BO    DOABND             YES, ABEND ENTRY               Y01043 25100002
         MVC   K0(LEN0,R6),INCERT0     MOVE IN FAILURE PART      Y01043 25150002
         LA    R6,LEN0(R6)        BUMP BUFFER POINTER            Y01043 25200002
         B     DODUMP             CONTINUE CONSTRUCTION          Y01043 25250002
DOABND   EQU   *                                                 Y01043 25300002
         MVC   K0(LEN1,R6),INCERT1     MOVE IN ABEND PART        Y01043 25350002
         LA    R6,LEN1(R6)        BUMP BUFFER POINTERS           Y01043 25400002
         L     R9,PABEND          GET THE ABEND CODE             Y02653 25440002
         N     R9,MASK1           'AND' OFF THE DUMP BIT         Y01043 25480002
         SRL   R9,K12             SHIFT TO LOW ORDER BYTE        Y01043 25520002
         STH   R9,CODE            PUT IT IN PARAMETER AREA       Y01043 25560002
         UNPK  ABEND1(K5),CODE(K3)     UNPACK ABEND INTO BUFFER  Y01043 25600002
         TR    ABEND2(K3),TABLE   TRANSLATE CODE                 Y01043 25650002
         MVI   ABEND1,BLANK       BLANK THE FIRST BYTE           Y01043 25700002
         MVI   ABEND5,COMMA       ADD COMMA TO END               Y01043 25750002
DODUMP   EQU   *                                                 Y01043 25800002
         LTR   R10,R10            DUMP SUCCESSFUL?               Y01043 25850002
         BNZ   NXTPRT             NO, BYPASS DUMPED PART         Y01043 25900002
         MVC   K0(LEN2,R6),INCERT2     MOVE IN SUCCESSFUL PART   Y01043 25950002
         LA    R6,LEN2(R6)        BUMP BUFFER POINTER            Y01043 26000002
NXTPRT   EQU   *                                                 Y01043 26050002
         MVC   K0(LEN6,R6),INCERT6     MOVE IN REIPL PART        Y01043 26100002
         LA    R6,LEN6(R6)        BUMP BUFFER POINTER            Y01043 26150002
         MVC   K0(K4,R6),RETCDE   MOVE IN WTO ROUTING CODES      Y01043 26210002
         SR    R6,R5              CALCULATE MESSAGE LENGTH       Y01043 26270002
         STH   R6,MSGLEN          PUT IT IN MESSAGE              Y01043 26330002
         LA    R1,MSGAREA         ADDRESS FOR WTO                Y01043 26390002
         WTO   MF=(E,(1))         ISSUE MESSAGE                  Y01043 26450002
         EJECT                                                          26510002
*********************************************************************** 26550002
*        IF THE COMMUNICATIONS TASK HAS BEEN INITIALIZED,             * 26560002
*        ONLY THE MASTER SCHEDULER TASK IS PUT IN A WAIT, VIA         * 26570002
*        THE WAIT SVC.  THIS IS DONE IN ORDER THAT THE OPERATOR       * 26580002
*        CAN CONTINUE TO ISSUE COMMANDS AND RECEIVE MESSAGES          * 26590002
*        BEFORE RE-IPLING THE SYSTEM.                                 * 26600002
*                                                                     * 26610002
*        IF THE COMMTASK HAS NOT BEEN INITIALIZED, THE                * 26620002
*        SYSTEM IS PUT IN A DISABLED WAIT STATE VIA LPSW.  A WAIT     * 26630002
*        STATE CODE OF X'00B' INDICATES THAT A DUMP WAS TAKEN; A      * 26640002
*        CODE OF X'00D' INDICATES THAT NO DUMP WAS TAKEN.             * 26650002
*********************************************************************** 26660002
         SPACE 2                                                        26698802
         XC    PROSCDE(K4),PROSCDE     ZERO AREA FOR WAIT        Y02653 27300002
         LA    R1,PROSCDE         SET ADDRESS OF THE AREA        Y02653 27350002
         WAIT  ECB=(1)            ENTER WAIT STATE               Y02653 27400002
DOWAIT   EQU   *                                                 Y01043 27450002
         LTR   R10,R10            WAS DUMP TAKEN?                YM2740 27500002
         BNZ   DOWAIT1            NO, ISSUE NO DUMP WAIT CODE    YM2740 27550002
         LPSW  GODUMP             INDICATE DUMP TAKEN            YM2470 27600002
DOWAIT1  EQU   *                                                 YM2740 27650002
         LPSW  NODUMP             YES, ISSUE NO DUMP WAIT CODE   YM2740 27700002
         DROP  R2                 RELEASE PARMAREA BASE REGISTER Y02653 27750002
         EJECT                                                          27800002
*********************************************************************** 27850002
*        CONSTANTS FOR STAE'S USE                                     * 27900002
*********************************************************************** 27950002
         DS    D                                                 YM2740 28000002
GODUMP   DC    X'000200000000000B'     WAIT PSW, DUMP            Y02653 28050002
NODUMP   DC    X'000200000000000D'     WAIT PSW, NO DUMP         Y02653 28100002
TWELVE   DC    F'12'              ENTRY TYPE TESTER              Y02653 28110002
LRECINF  DC    CL8'IEEVIPL '      RECORD PARAMETER LIST          Y02653 28150002
         DC    CL8'IEEVIPL '                                     Y02653 28200002
         DC    CL8'        '                                     Y02653 28250002
RETCDE   DC    X'80004040'        WTO ROUTING CODES              Y01043 28300002
MASK1    DC    X'7FFFFFFF'        MASK FOR DUMP BIT              Y01043 28320002
PARMAR   DC    AL1(253)           SP/SIZE FOR PARM AREA          Y02653 28340002
         DC    AL3(ENDAREA-STRTAREA)                           @YM02606 28360002
WAITECB  DC    F'0'                                                     28410002
LUTEND   DC    XL4'0000FFFF'    END OF IOS LOOK-UP-TABLE       @Z40FPPJ 28430003
         EJECT                                                          28450002
*********************************************************************** 28500002
*        MESSAGE PARTS FOR STAE'S USE                                 * 28550002
*********************************************************************** 28600002
         SPACE 3                                                        28650002
STRT0    EQU   *                                                 Y01043 28700002
INCERT0  DC    C'FAILED,'                                        Y01043 28750002
END0     EQU   *                                                 Y01043 28800002
STRT1    EQU   *                                                 Y01043 28850002
INCERT1  DC    C'ABEND     '                                     Y01043 28900002
END1     EQU   *                                                 Y01043 28950002
STRT2    EQU   *                                                 Y01043 29000002
INCERT2  DC    C' DUMPED,'                                       Y01043 29050002
END2     EQU   *                                                 Y01043 29100002
STRT6    EQU   *                                                 Y01043 29150002
INCERT6  DC    C' REIPL'                                         Y01043 29200002
END6     EQU   *                                                 Y01043 29250002
TABLE    EQU   *-240                                             Y01043 29300002
         DC    C'0123456789ABCDEF'                               Y01043 29350002
         EJECT                                                          29400002
*********************************************************************** 29450002
*        MACRO LIST FORMS FOR STAE'S USE                              * 29500002
*********************************************************************** 29550002
         DS    0F                                                Y01043 29600002
STRT7    EQU   *                                                 Y01043 29650002
ABMSG    WTO   'IEE479W MASTER SCHEDULER ',MF=L,                       *29700002
               ROUTCDE=(2,10),DESC=(1)                           Y02653 29750002
END7     EQU   *                                                 Y01043 29800002
         DS    0F                                                Y01043 29850002
STRT8    EQU   *                                                 Y01043 29900002
LSTAE    ESTAE MF=L                                              Y02653 29950002
END8     EQU   *                                                 Y01043 30000002
         DS    0F                                                Y01043 30050002
STRT9    EQU   *                                                 Y01043 30100002
DUMPPARM SDUMP HDR='IEEVIPL ',SDATA=(SQA,PSA,NUC,LSQA,RGN,LPA,TRT,CSA),*30150002
               MF=L                                            @YM3599P 30200002
END9     EQU   *                                                 Y01043 30250002
VPATCH   DC    CL80'*** IEEVIPL PATCH AREA ***'                         30270002
         EJECT                                                          30300002
*********************************************************************** 30350002
*        MESSAGE LENGTHS FOR STAE'S USE                               * 30400002
*********************************************************************** 30450002
         SPACE 3                                                        30500002
LEN0     EQU   END0-STRT0                                        Y01043 30550002
LEN1     EQU   END1-STRT1                                        Y01043 30600002
LEN2     EQU   END2-STRT2                                        Y01043 30650002
LEN6     EQU   END6-STRT6                                        Y01043 30700002
LEN7     EQU   END7-STRT7                                        Y01043 30750002
STAEL    EQU   END8-STRT8                                        Y01043 30800002
DUMPL    EQU   END9-STRT9                                        Y01043 30850002
         EJECT                                                          30900002
*********************************************************************** 30950002
*        MODULE CONSTANTS FOR USE BY THIS ROUTINE                     * 31000002
*********************************************************************** 31050002
         DS    0F                                                       31100002
CSCBINF  DC    AL1(245)           SUBPOOL NUMBER FOR CSCB        Y02669 31150002
         DC    AL3(CSCBLEN)       SIZE OF THE CSCB               Y02669 31200002
JSCBINF  DC    AL1(241)           SUBPOOL NUMBER FOR JSCB      @YM01566 31250002
         DC    AL3(JSCBAOS2)      SIZE OF THE JSCB               Y02669 31300002
SSIBINF  DC    AL1(241)           SUBPOOL NUMBER FOR SSIB      @YM01566 31350002
         DC    AL3(SSIBSIZE)      SIZE OF THE SSIB               Y02669 31400002
IELINF   DC    AL1(230)           SUBPOOL NUMBER FOR IEL         Y02669 31450002
         DC    AL3(IELLLEN+K64)   SIZE OF THE IEL                Y02669 31500002
MINF     DC    C'MSTR    '        NAME OF MASTER SUBSYSTEM       Y02669 31550002
SSID     DC    C'SSIB'            CONTROL BLOCK NAME             Y02669 31600002
IEFJSINT DC    V(IEFJSINT)        ADDRESS OF SUBSYSTEM MODULE    Y02669 31650002
IEEMB850 DC    V(IEEMB850)        ADDRESS OF VARIABLE INITITIALIZATION  31700002
         EJECT                                                          31800002
*********************************************************************** 31850002
*        MAPPING OF THE STAE PARAMETER LIST/AREA                      * 31900002
*********************************************************************** 31950002
         SPACE 3                                                        32000002
PARMAREA DSECT                                                   Y01043 32050002
STRTAREA EQU   *                                               @YM02606 32070002
PROSCDE  DS    H                  RECURSION INDICATOR            Y01043 32100002
FLGS     DS    C                  FLAG BYTE                      Y01043 32140002
PENTY    EQU   X'80'              BRANCH ENTRY                   Y02653 32180002
PABND    EQU   X'40'              ABEND CODE PRESENT             Y02653 32220002
PDUMP    EQU   X'20'              DUMP REQUIRED                  Y02653 32260002
         DS    C                  RESERVED                       Y01043 32300002
STAELIST DS    0F                 LIST FORM OF ESTAE             Y02653 32340002
MSGAREA  DS    0F                 MESSAGE BUFFER                 Y01043 32380002
MSGLEN   DS    H                  LENGTH OF MESSAGE              Y01043 32420002
MSGFLG   DS    H                  WTO FLAGS                      Y01043 32460002
         DS    CL30               FIRST PART OF MESSAGE          Y01043 32500002
ABEND1   DS    C                                                 Y01043 32550002
ABEND2   DS    C                                                 Y01043 32600002
ABEND3   DS    C                                                 Y01043 32650002
ABEND4   DS    C                                                 Y01043 32700002
ABEND5   DS    C                                                 Y01043 32750002
         DS    CL47               LAST PART OF MESSAGE           Y01043 32800002
PABEND   DS    F                  ABEND CODE SAVER               Y02653 32820002
PSAVER   DS    F                  BASE ADDRESS SAVER             Y02653 32840002
CODE     DS    H                  AREA FOR ABEND CODE WORK       Y01043 32860002
ENDAREA  EQU   *                                               @YM02606 32880002
         EJECT                                                          32900002
         IEFPTRS                                                        32950002
         EJECT                                                          33200002
         IEEBASEA                                                       33250002
         EJECT                                                          33300002
CVT      DSECT                                                          33350002
         CVT                                                            33400002
         EJECT                                                          33450002
JESCT    DSECT                                                   Y02669 33500002
         IEFJESCT                                                       33550002
         EJECT                                                          33600002
         IKJTCB                                                         33650002
         EJECT                                                          33700002
IEL      DSECT                                                   Y02669 33750002
         IEZIEL EXITS=RTN                                               33800002
IELLLEN  EQU   IELLEN+IELOPTLN+IELEXTLN                          Y02669 33850002
         EJECT                                                          33900002
         IEFJSSIB                                                Y02668 33950002
         EJECT                                                          34000002
CSCB     DSECT                                                   Y02669 34050002
         IEECHAIN                                                       34100002
CSCBLEN  EQU   CHLAST-CHAIN                                      Y02669 34150002
         EJECT                                                          34200002
         IEZJSCB                                                        34250002
         EJECT                                                          34300002
         IHAASCB                                                        34350002
         EJECT                                                          34400002
         IHASDWA                                                        34450002
         IEFUCBOB    PREFIX=YES                                         34500003
         END                                                            34550003
