IEEVSDIO CSECT                                                          00050020
* C 086000                                                      ZA30374 00051003
         ENTRY IEEVSND5                                          Y02676 00053002
IEEVSND5 DS    0H                   LABEL FOR OPERATOR SEND CMD  Y02676 00056002
          TITLE  'IEEVSDIO - I/O ROUTINE FOR USER SEND CMD FOR TSO'     00060020
*********************************************************************** 00400002
*                                                                     * 00420002
*   MODULE-NAME= IEEVSDIO (ALSO KNOWN AS IEEVSND5)                    * 00440002
*                                                                     * 00460002
*   DESCRIPTIVE-NAME= BROADCAST DATA SET I/O MODULE                   * 00480002
*                                                                     * 00500002
*   COPYRIGHT= NONE                                                   * 00520002
*                                                                     * 00540002
*   STATUS= OS/VS2, REL.2, LEVEL=0                                    * 00560002
*                                                                     * 00580002
*   FUNCTION= IEEVSDIO PERFORMS I/O OPERATIONS FOR SEND AND OTHER     * 00600002
*     COMMAND PROCESSORS WHICH HAVE A REQUIREMENT FOR ACCESSING       * 00620002
*     THE BROADCAST DATA SET, SYS1.BRODCAST.                          * 00640002
*                                                                     * 00660002
*     OPERATION= ONE OF THE FOLLOWING OPERATIONS MAY BE REQUESTED     * 00680002
*       PER ENTRY TO IEEVSDIO (SEE SDIOPARM):                         * 00700002
*       - OPEN (OPTIONAL INITIALIZATION CHECK OF SYS1.BRODCAST)       * 00720002
*       - CLOSE                                                       * 00740002
*       - READ                                                        * 00760002
*       - WRITE 'DI'                                                  * 00780002
*       - WRITE 'DAF'                                                 * 00800002
*       - INITIALIZE SYS1.BRODCAST (SEE IKJZT301-05 FOR RECORD        * 00820002
*         FORMATS)--REQUESTED ONLY BY SYNC SUBCOMMAND OF ACCOUNT      * 00840002
*       A DCB IS OBTAINED AUTOMATICALLY WITH RECOGNITION OF AN        * 00860002
*       OPEN REQUEST. THE ADDRESS IS STORED IN THE PERMANENT DATA     * 00880002
*       SECTION OF SDIOPARM, FROM WHICH IT IS RETRIEVED TO IMPLEMENT  * 00900002
*       SUBSEQUENT REQUESTS. THE DCB IS RELEASED AFTER CLOSE.         * 00920002
*       THE CALLER MAY SPECIFY REAL TRACK OR RELATIVE BLOCK ADDRESS   * 00940002
*       FEEDBACK. TO CHECK FOR INITIALIZATION OF SYS1.BRODCAST, THE   * 00960002
*       FIRST RECORD (RECORD1) IS READ AND THE CONTENTS OF THE        * 00980002
*       HEADER CHECKED AGAINST 'SYS1.BRODCAST DATA SET LEVEL 2'.      * 01000002
*                                                                     * 01020002
*   NOTES=                                                            * 01040002
*                                                                     * 01060002
*     DEPENDENCIES=                                                   * 01080002
*                                                                     * 01100002
*       CHARACTER-CODE-DEPENDENCIES= THE OPERATION OF THIS MODULE     * 01120002
*         DEPENDS UPON AN INTERNAL REPRESENTATION OF THE EXTERNAL     * 01140002
*         CHARACTER SET WHICH IS EQUIVALENT TO THE ONE USED AT        * 01160002
*         ASSEMBLY TIME. THE DEPENDENCY CODE IS C.                    * 01180002
*                                                                     * 01200002
*     RESTRICTIONS= NONE                                              * 01220002
*                                                                     * 01240002
*     REGISTER-CONVENTIONS= SEE PROGRAM LABEL 'REGS'                  * 01260002
*                                                                     * 01280002
*     PATCH-LABEL= SPARE                                              * 01300002
*                                                                     * 01320002
*   MODULE-TYPE= PROCEDURE                                            * 01340002
*                                                                     * 01360002
*     PROCESSOR= ASM                                                  * 01380002
*                                                                     * 01400002
*     MODULE-SIZE= 2012 BYTES                                         * 01420002
*                                                                     * 01440002
*     ATTRIBUTES= REENTERABLE                                         * 01460002
*                                                                     * 01480002
*   ENTRY-POINT= IEEVSDIO                                             * 01500002
*                                                                     * 01520002
*     PURPOSE= PERFORM I/O ON SYS1.BRODCAST                           * 01540002
*                                                                     * 01560002
*     LINKAGE= CALLED BY ANY OF THE FOLLOWING:                        * 01580002
*       IKJRBBCR (ACCOUNT CP SYNC SUBCOMMAND)                         * 01600002
*       IKJEES10 (SEND CP)                                            * 01620002
*       IKJEES40 (ACCOUNT CP BROADCAST INTERFACE)                     * 01640002
*       IEEVSND9 (OPERATOR CP SEND SUBCOMMAND)                        * 01660002
*       IEEVSND2 "                                                    * 01680002
*       IEEVSND3 "                                                    * 01700002
*       IEEVSND8 "                                                    * 01720002
*                                                                     * 01740002
*     INPUT= REGISTER 1 CONTAINS THE ADDRESS OF A PARAMETER LIST,     * 01760002
*       SEE 'SDIOPARM'                                                * 01780002
*                                                                     * 01800002
*   ENTRY-POINT= IEEVSND5 (IDENTICAL TO IEEVSDIO)                     * 01820002
*                                                                     * 01840002
*   ENTRY-POINT= SYNAD0                                               * 01860002
*                                                                     * 01880002
*     PURPOSE= SYNAD ROUTINE FOR INITIALIZATION-CHECK READ            * 01900002
*                                                                     * 01920002
*     LINKAGE= BRANCHED TO BY CHECK SERVICE ROUTINE                   * 01940002
*                                                                     * 01960002
*     INPUT= REGISTER 0 CONTAINS THE ADDRESS OF THE DECB              * 01980002
*                                                                     * 02000002
*   ENTRY-POINT= SYNAD1                                               * 02020002
*                                                                     * 02040002
*     PURPOSE= SYNAD ROUTINE FOR ALL OTHER READ/WRITE OPERATIONS      * 02060002
*                                                                     * 02080002
*     LINKAGE= BRANCHED TO BY CHECK SERVICE ROUTINE                   * 02100002
*                                                                     * 02120002
*     INPUT= REGISTER 0 CONTAINS THE ADDRESS OF THE DECB              * 02140002
*                                                                     * 02160002
*   EXIT-NORMAL=                                                      * 02180002
*                                                                     * 02200002
*     CONDITION= RETURN TO ADDRESS PASSED IN REGISTER 14 UPON         * 02220002
*       COMPLETION OF PROCESSING.                                     * 02240002
*                                                                     * 02260002
*     OUTPUT= REQUESTED OPERATION HAS BEEN ATTEMPTED.                 * 02280002
*                                                                     * 02300002
*     RETURN-CODES= A RETURN CODE (HEX) IS PLACED IN REGISTER 15:     * 02320002
*       00 -- SUCCESS                                                 * 02340002
*       01 -- SYS1.BRODCAST FULL (WRITE 'DA')                         * 02360002
*       02 -- OPEN FAILURE                                            * 02380002
*       08 -- READ/WRITE FAILURE                                      * 02400002
*       10 -- SYS1.BRODCAST NOT INITIALIZED/NOT LEVEL 2               * 02420002
*             (OR RECORD1 READ FAILURE)                               * 02440002
*       40 -- GETMAIN FAILURE                                         * 02460002
*                                                                     * 02480002
*   EXIT-ERROR= NONE                                                  * 02500002
*                                                                     * 02520002
*   EXTERNAL-REFERENCES=                                              * 02540002
*                                                                     * 02560002
*     ROUTINES= NONE                                                  * 02580002
*                                                                     * 02600002
*     DATA-AREAS=                            DSECT-MACROS=            * 02620002
*       SDIOPARM                                  --                  * 02640002
*       READ/WRITE BUFFERS (CALLER SUPPLIED)      --                  * 02660002
*       SYS1.BRODCAST DATA SET                    --                  * 02680002
*       DCB                                  X    DCBD                * 02700002
*       MACRO LIST FORMS, DECB               X    --                  * 02720002
*       RECORD1 BUFFER, FORMATTING BUFFER    X    IKJZT301-05         * 02740002
*                                                                     * 02760002
*     CONTROL-BLOCKS=                        DSECT-MACROS=            * 02780002
*       CVT                                  (R)  CVT                 * 02800002
*       MASTER SCHEDULAR RESIDENT DATA AREA  (R)  IEEBASEA            * 02820002
*                                                                     * 02840002
*   TABLES= NONE                                                      * 02860002
*                                                                     * 02880002
*   MACROS=                                  SERVICE-ROUTINES=        * 02900002
*     SAVE                                        --                  * 02920002
*     MODID                                       --                  * 02940002
*     DCB                                         --                  * 02960002
*     READ                                        READ                * 02980002
*     WRITE                                       WRITE               * 03000002
*     CHECK                                       CHECK               * 03020002
*     OPEN                                        SVC19               * 03040002
*     CLOSE                                       SVC20               * 03060002
*     GETMAIN                                     SVC4,SVC10          * 03080002
*     FREEMAIN                                    SVC10               * 03100002
*                                                                     * 03120002
*     SERIALIZATION= NONE                                             * 03140002
*                                                                     * 03160002
*   CHANGE-ACTIVITY= S/D SUPPORT CODE IS Y02993.                      * 03180002
*                                                                     * 03200002
*   MESSAGES= NONE                                                    * 03220002
*                                                                     * 03240002
*   ABEND-CODES= NONE                                                 * 03260002
*                                                                     * 03280002
*********************************************************************** 03300002
         EJECT                                                          04350020
*********************************************************************** 04400020
*                                                                     * 04450020
*                   R E G I S T E R    E Q U A T E S                  * 04500020
*                                                                     * 04550020
*********************************************************************** 04600020
*                                                                     * 04650020
REGS     DS    0H                  REGISTER DEFINITION           Y02676 04670002
R0       EQU   0                   REGISTER USED IN GETMAIN, FREEMAIN   04700020
R1       EQU   1                   TEMPORARY WORK REG                   04750020
R2       EQU   2                   TEMPORARY USE                        04800020
R3       EQU   3                   ADDRESS OF 129 BYTE READ/WRITE AREA  04850020
R4       EQU   4                   ADDRESS OF RBA (RELATIVE BLOCK       04900020
*                                  ADDRESS) OF DESIRED BLOCK            04950020
R5       EQU   5                   WORK REGISTER                        05000020
R6       EQU   6                   COUNTER FOR LOOP CONTROL             05050020
R7       EQU   7                   ADDRESS OF PARAMETER LIST            05100020
R8       EQU   8                   WORK REGISTER                        05150020
R9       EQU   9                   BASE REGISTER FOR CONTROL BLOCKS     05200020
R10      EQU   10                  BASE REGISTER FOR DSECT FOR DCB      05250020
R11      EQU   11                  BASE REGISTER FOR CSECT              05300020
R12      EQU   12                  BASE REGISTER FOR DATA AREA DSECT    05350020
R13      EQU   13                  ADDRESS OF THIS ROUTINE'S SAVE AREA  05400020
R14      EQU   14                  ADDRESS OF CALLING ROUTINE RETURN    05450020
R15      EQU   15                  RETURN CODE                        * 05500020
         EJECT                                                          05550020
*                                                                     * 05600020
*                                                                     * 05650020
         SAVE  (14,12)             SAVE ALL REGISTERS                   05750020
         LR    R7,R1               SAVE ADDRESS OF PARMLIST IN REG7     05800020
         LR    R11,R15             R11 = ADDRESS IEEVSDIO CSECT         05850020
         USING IEEVSDIO,R11        SET ADDRESSABILITY FOR CSECT         05950020
         MODID BRANCH=YES                                        Y01886 06000000
         LA    R0,DATAEND-DATABEG  SET R0 FOR GETMAIN FOR WORK AREA     06200020
         GETMAIN  R,LV=(0)         GET CORE FOR WORK AREA               06250020
         LR    R12,R1              MOVE ADDR OF GOTTEN CORE TO REG 12   06300020
         USING DATABEG,R12         SET ADDRESSABILITY FOR DATA AREA     06350020
         ST    R13,SAVER+OFFCALLR  SAVE ADDRESS OF CALLER'S SAVE AREA   06400020
         LR    R5,R13              GET ADDRESS CALLERS SAVE AREA        06450020
         LA    R13,SAVER                                                06500020
         ST    R13,OFFCALLD(R5)    SAVE ADDRESS OF THIS RTN'S SAVE AREA 06550020
         MVC   DECB1(LISTSL),DEC01 MOVE LISTS FOR MACRO INSTRUCTIONS    06750020
*                                  INTO GOTTEN CORE (DSECT)             06800020
         USING IHADCB,R10          ESTABLISH ADDRESSABILITY FOR IHADCB  06850020
         USING BCD,R3              RECORD ADDRESSABILITY         Y02676 06870002
         USING SDIOPARM,R7         SET ADDRESSABILITY FOR PARMLIST DSEC 06900020
         XC    RETCODE,RETCODE     SET ZERO RETURN CODE          Y02676 06920002
         TM    PARM1,P1OPEN        IS OPEN REQUESTED                    07000020
         BZ    TESTREAD            NO, BRANCH                           07050020
         LA    R5,DCBLNG+BCDLEN    DCB AND RECORD LENGTH         Y02676 07100002
         GETMAIN EC,LV=(R5),A=PARMDCB,MF=(E,GETML) OBTAIN CORE   Y02676 07200002
         LTR  R15,R15              TEST GETMAIN RETURN CODE IN REG 15   07250020
         BNZ  BADGM                IF NOT SUCCESSFUL (0), RETURN TO     07300020
*                                  CALLER WITH ERROR INDICATION         07350020
         L     R10,PARMDCB         SET DCB BASE                  Y02676 07400002
*        R10 HAS ADDRESS OF CORE GOTTEN FOR DCB VIA GETMAIN             07450020
         LA    R3,DCBLNG(R10)      SET RECORDS BASE              Y02676 07460002
*        R3 HAS ADDRESS OF CORE FOR RECORD1                      Y02676 07470002
         TM    PARM2,P2DEVAD       DEVICE ADDR FEEDBACK          Y02676 07510002
         BO    MOVEDCB             YES, MOVE IN SPECIAL DCB             07530020
OPEN0    MVC   0(DCBLNG,R10),BDAMDCB COPY BDAM DCB               Y02676 07550002
         B     OPEN1               STEP TO OPEN                  Y02676 07570002
MOVEDCB  DS    0H                  ACTUAL DEVICE ADDRESS         Y02676 07600002
         MVC   0(DCBLNG,R10),ACCTDCB COPY SPECIAL BDAM DCB       Y02676 07620002
OPEN1    MVC   DCBDDNAM(L'DCBDDNAM),PARMDDNM COPY DDNAME TO DCB  Y02676 07900002
         OPEN  ((R10),(OUTPUT)),MF=(E,OPENL) OPEN DATA SET FOR UPDATE   08000020
         TM    DCBOFLGS,DCBOFOPN   OPEN SUCCESSFUL               Y02676 08150002
         BZ    BADOPEN             IF NOT SUCCESSFUL OPEN, BRANCH       08200020
         TM    PARM1,P1READ1       READ OF RECORD1 SKIP          Y02676 08250002
         BO    ENDIO               YES, NO CHECK REQUIRED        Y02676 08300002
*                                                                       08350020
* READ RECORD 1 OF SYS1.BRODCAST DATA SET TO DETERMINE IF DATA SET HAS* 08400020
* BEEN INITIALIZED.                                                   * 08450020
*                                                                     * 08500020
         LA    R5,SYNAD0           RECORD1 HAS SPECIAL SYNAD     Y02676 08560002
         STCM  R5,PTR24,DCBSYNAD+1 PUT SYNAD ADDR IN DCB         Y02676 08570002
         READ  DECB1,DI,(R10),(R3),'S',KEY,R1RBA,MF=E READ REC1 ZA30374 08600003
         CHECK DECB1                                                    08650020
         LA    R5,SYNAD1           RESTORE SYNAD ADDRESS TO DCB         08700020
         STCM  R5,PTR24,DCBSYNAD+1 PUT SYNAD ADDR IN DCB         Y02676 08770002
         CLC   R1DSN(L'DSNAME),DSNAME DATA SET NAME PRESENT      Y02676 08850002
*                                  (IS DATA SET INITIALIZED)     Y02676 08900002
         BNE   SYNAD0              NO, TREAT AS BAD READ RECORD1 Y02676 08950002
         CLC   R1LEVEL(L'LEVEL2),LEVEL2 RELEASE 2 LEVEL          Y02676 08960002
         BNE   SYNAD0              NO, TREAT AS BAD READ RECORD1 Y02676 08970002
         ST    R3,PARMRCD1         SET RECORD1 PTR PARM          Y02676 08980002
         MVC   PARMLMCT,R1RECNUM   SAVE LIMIT COUNT PARM         Y02676 09100002
         B     ENDIO               END OF PROCESSING                    09250020
         EJECT                                                          09300020
TESTREAD DS    0H                  READ BY BLOCK ID                     09350020
         TM    PARM1,P1READ        IS READ REQUESTED                    09450020
         BZ    TESTWRDI            NO, BRANCH                           09500020
         L     R10,PARMDCB         R10 = ADDRESS OF DCB FROM PARM       09600020
         L     R3,PARMIOAD         SET AREA ADDRESS FROM PARM LIST      09650020
         L     R4,PARMRBA          SET BLOCK ID (RBA) FROM PARM LIST    09700020
         READ  DECB1,DIF,(R10),(R3),'S',0,(R4),MF=E  READ A RECORD      09800020
         CHECK DECB1               CHECK THE READ                       09850020
         MVC   PARMFDBK(L'PARMFDBK),RECPOS(R4)   PUT FEEDBACK OF RECORD 09900020
*                                  POSITION ON TRACK INTO PARM LIST     09950020
         B     ENDIO               END OF PROCESSING                    10100020
         EJECT                                                          10150020
TESTWRDI DS    0H                  WRITE BY BLOCK ID                    10200020
         TM    PARM2,P2WRDI        IS WRITE 'DI' REQUESTED              10300020
         BZ    TESTWRDA            NO, BRANCH                           10350020
         L     R10,PARMDCB         R10 = ADDRESS OF DCB FROM PARM       10450020
         L     R3,PARMIOAD         SET AREA ADDRESS FROM PARMLIST       10500020
         L     R4,PARMRBA          SET BLOCK ID (RBA) FROM PARMLIST     10550020
         MVC   KEY(L'PARMKEY),PARMKEY   SET KEY FROM PARMLIST           10600020
         TM    PARM2,P2DEL         TEST IF THIS WRITE IS A DELETION     10700020
         BNO   NOTDEL              NO, BRANCH AROUND FIRST BYTE SETTING 10750020
         MVC   0(L'PARMFDBK,R3),PARMFDBK  PUT POSITION OF RECORD ON     10850020
*                                  TRACK INTO FIRST BYTE OF DATA RECORD 10900020
*                                  TO SHOW 'AVAILABLE' TO BDAM          10950020
NOTDEL   DS    0H                  THIS WRITE IS NOT FOR A DELETION     11000020
         WRITE DECB2,DI,(R10),(R3),'S',KEY,(R4),MF=E  WRITE A RECORD    11100020
*                                                     BY BLOCK ID (RBA) 11150020
         CHECK DECB2               CHECK WRITE                          11200020
         B     ENDIO               END OF PROCESSING                    11350020
         SPACE 4                                                        11400020
TESTWRDA DS    0H                  WRITE 'DA'                           11450020
         TM    PARM2,P2WRDAF       IS WRITE 'DA' REQUESTED              11550020
         BZ    TESTCLOS            NO, BRANCH                           11600020
         L     R10,PARMDCB         R10 = ADDRESS OF DCB FROM PARM       11700020
         MVC   DCBLIMCT,PARMLMCT+1 SET LIMIT COUNT IN            Y02676 11950002
*                                  DCB FOR EXTENDED SEARCH              12000020
*                                  TO NO. RECORDS IN DAT SET FROM REC 1 12050020
         L     R3,PARMIOAD         SET AREA ADDR FROM PARMLIST          12100020
         L     R4,PARMRBA          SET BLOCK ID FROM PARMLIST           12150020
         MVC   KEY(L'PARMKEY),PARMKEY   SET KEY FROM PARMLIST           12200020
         WRITE DECB3,DAF,(R10),(R3),'S',KEY,(R4),MF=E WRITE RECORD      12300020
         CHECK DECB3               CHECK THE WRITE                      12350020
*                                  R4 = ADDRESS OF FEEDBACK RBA         12400020
         MVC   PARMRBA+1(RBAL),0(R4)                             Y02676 12450002
         B     ENDIO               END OF PROCESSING                    12700020
         EJECT                                                          12750020
TESTCLOS DS    0H                  CLOSE                                12800020
         TM    PARM2,P2CLOSE       IS CLOSE REQUESTED                   12900020
         BZ    INITDS              NO, BRANCH                    Y02676 12950002
*                                  CLOSE SYS1.BRODCAST DATA SET         13000020
CLOSEDCB L     R10,PARMDCB         R10 = PARM DCB ADDR           Y02676 13100002
         CLOSE  ((R10)),MF=(E,CLOSEL)  CLOSE DATA SET                   13200020
FREEDCB  DS    0H                  FREE CORE GOTTEN FOR DCB             13230020
         LA    R0,DCBLNG+BCDLEN    LENGTH OF DCB AND RECORD      Y02676 13250002
         FREEMAIN  R,LV=(0),A=(R10)  FREE CORE FOR DCB                  13350020
         B     ENDIO               END OF PROCESSING                    14000020
         EJECT                                                          14050020
INITDS   DS    0H                                                       14100020
         TM    PARM1,P1CREATE      CREATE REQUESTED              Y02676 14104002
         BNO   ENDIO               NO PROCESSING REQUIRED        Y02676 14106002
         L     R10,PARMDCB         SET DCB BASE                  Y02676 14108002
         LA    R3,DCBLNG(R10)      SET RECORDS BASE              Y02676 14110002
         CLOSE  ((R10)),MF=(E,CLOSEL)  CLOSE DCB FOR BDAM               14200020
         NC    PARMRCD1,PARMRCD1   DATA SET FORMATTED OK?        Y02676 14250002
         BZ    BSAMCR              NO, REWRITE ENTIRE DATA SET  Y02676  14300002
         MVC   0(DCBLNG,R10),ACCTDCB  COPY SPECIAL BDAM DCB      Y02676 14310002
         MVC   DCBDDNAM(L'DCBDDNAM),PARMDDNM MOVE DDNAM INTO DCB Y02676 14320002
         OPEN   ((10),(OUTPUT)),MF=(E,OPENL)  OPEN TO CREATE BDAM       14330002
         TM    DCBOFLGS,DCBOFOPN   OPEN SUCCESSFUL               Y02676 14340002
         BZ    BADOPEN             NO, BRANCH                    Y02676 14342002
         L     R8,R1RECNUM         TOT # OF RECORDS              Y02676 14344002
         L     R5,R1USPTRP         START OF MAIL SECTION         Y02676 14346002
         SR    R8,R5               TOT # OF MAIL RECORDS         Y02676 14348002
         LA    R4,BCFDBK           ADDR OF 8-BYTE FIELD          Y02676 14348102
         XC    PARMRCD1,PARMRCD1   CLEAR MAIL RECORD             Y02676 14349602
ERASLOOP STCM  R5,PTR24,BCFDBK     RBA OF MAIL RECORD            Y02676 14351602
         READ  DECB1,DIF,(R10),(R3),'S',0,(R4),MF=E ATTEMPT READ Y02676 14353102
         CHECK DECB1               CHECK FOR SUCCESS             Y02676 14354602
         XC    BCD,BCD                                           Y02676 14356102
         MVC   0(L'PARMFDBK,R3),RECPOS(R4)                       Y02676 14357602
         MVI   KEY,X'FF'                                         Y02676 14359102
         STCM  R5,PTR24,BCFDBK     RBA OF MAIL RECORD            Y02676 14360602
         WRITE DECB2,DI,(R10),(R3),'S',KEY,(R4),MF=E  WRITE DIR. RECORD 14362102
         CHECK DECB2                                                    14363602
         LA    R5,NEXT(R5)                                       Y02676 14365102
         BCT   R8,ERASLOOP                                       Y02676 14366602
         CLOSE ((R10)),MF=(E,CLOSEL) CLOSE DCB FOR BDAM                 14376602
         B     OPEN0                                                    14378602
         EJECT                                                          14380602
BSAMCR   MVC   0(DCBLNG,R10),BSAMDCB COPY BSAM DCB               Y02676 14383302
         MVC   DCBDDNAM(L'DCBDDNAM),PARMDDNM  MOVE DDNAME INTO DCB      14400020
         OPEN   ((10),(OUTPUT)),MF=(E,OPENL)  OPEN TO CREATE BDAM       14700020
         TM    DCBOFLGS,DCBOFOPN   OPEN SUCCESSFUL               Y02676 14850002
         BZ    BADOPEN             NO, BRANCH                           14900020
         EJECT                                                          15350020
*********************************************************************** 15400020
*                                                                     * 15450020
* THE FOLLOWING CODE CREATES A BDAM DATA SET BY ISSUING BSAM WRITE    * 15500020
* INSTRUCTIONS TO WRITE DUMMY RECORDS WITH KEY = X'FF'                * 15550020
* AND FIRST BYTE OF DATA = POSITION OF RECORD ON TRACK                * 15600020
* THE BROADCAST DATA SET MUST HAVE ONLY 1 EXTENT.                     * 15650020
* RECORDS ARE WRITTEN UNTIL THE RETURN CODE INDICATES THAT THE NEXT   * 15700020
* BLOCK REQUIRES SECONDARY SPACE ALLOCATION.                          * 15750020
*                                                                     * 15800020
*********************************************************************** 15850020
         SR    R8,R8               R8 = 0 = NO. RECORDS WRITTEN         15950020
*                                                                     * 16050020
WRITESD  DS    0H                                                       16100020
         WRITE DECB4,SD,(R10),DUMREC,'S',,,MF=E WRITE DUMMY      Y02676 16200002
         LA    R8,NEXT(R8)         BUMP COUNT OF RECORDS WRITTEN        16300020
         LR    R5,R15              R15 = RETURN CODE AFTER WRITE        16350020
         CHECK DECB4               CHECK THE WRITE FOR COMPLETION       16400020
         B     BTABLE(R5)          TEST RETURN CODE FROM WRITE          16500020
BTABLE   EQU   *                   BRANCH TABLE FOR RETURN CODE FROM    16550020
*                                  WRITE MACRO                          16600020
         B     WRITESD             RET CODE = 00, WRITE ANOTHER BLOCK   16650020
         B     WRITESD             RET CODE = 04, WRITE ANOTHER BLOCK   16700020
         DS    0H                  RET CODE = 08, STOP WRITING.         16750020
*                                  BLOCK WILL BE WRITTEN. NEXT BLOCK    16800020
*                                  REQUIRES SECONDARY SPACE ALLOCATION  16850020
         ST    R8,RECCNT           SET NO. RECORDS IN DATA SET          16950020
         EJECT                                                          17000020
*                                                                     * 17050020
* CLOSE DATA AND REPOSITION TO CONTINUE FORMATTING                    * 17100020
*                                                                     * 17150020
         CLOSE ((R10),REREAD),MF=(E,CLOSEL)  CLOSE FOR REREAD           17250020
         MVC   0(DCBLNG,R10),BDAMDCB COPY BDAM DCB               Y02676 17350002
         MVC   DCBLIMCT,RECCNT+1                                 Y02676 17400002
*                                         SET LIMCT FIELD IN DCB TO     17450020
*                                         NO. RECORDS IN DATA SET       17500020
         MVC   DCBDDNAM(L'DCBDDNAM),PARMDDNM  MOVE DDNAME INTO DCB      17550020
         OPEN  ((R10),(OUTPUT)),MF=(E,OPENL) OPEN DATA SET FOR UPDATE   17800020
         TM    DCBOFLGS,DCBOFOPN   OPEN SUCCESSFUL               Y02676 17950002
         BZ    BADOPEN             NO, BRANCH                           18000020
         EJECT                                                          18400020
*********************************************************************** 18450020
*                                                                     * 18500020
*  FIND MAXIMUM NO. OF BRODCAST 'NOTICES' MESSAGES FROM MASTER SCHED  * 18550020
*  BASE A                                                             * 18600020
*                                                                     * 18650020
*********************************************************************** 18700020
FINDMAX  DS    0H                  FIND MAX NO. NOTICE MSGS             18750020
         L     R9,CVTPTR           R9 = ADDRESS CVT IN MAIN STORAGE     18850020
         USING CVTD,R9             SET ADDRESSABILITY FOR CVT DSECT     18900020
         L     R9,CVTMSER          R9 = ADDRESS MASTER SCHED BASEA      18950020
         USING BASE,R9             SET ADDRESSABILITY FOR M.S. BASEA    19000020
         MVC   BCMAX,BABCMAX       BCMAX = MAX NOTICES           Y02676 19050002
*                                  SPEC'D AT SYSGEN & KEPT IN           19100020
*                                  MASTER SCHEDULER BASE A              19150020
         DROP  R9                                                Y02676 19170002
         LH    R5,BCMAX                                                 19200020
         LTR   R5,R5               TEST BCMAX FOR ZERO, INVALID VALUE   19250020
         BNZ   BCMAXSET            IF NOT ZERO, BRANCH AROUND SETTING   19300020
*                                  IF ZERO, SET BCMAX TO 1              19350020
         LA    R5,NEXT             R5 = 1                               19400020
         STH   R5,BCMAX            SET BCMAX = 1 TO REPLACE ZERO        19450020
BCMAXSET DS    0H                  BCMAX CONTAINS NONZERO VALUE         19500020
*                                                                     * 19550020
* THE FOLLOWING CALCULATES THE RBA OF THE FIRST BRODCAST NOTICES      * 19600020
* MESSAGE RECORD.  THIS VALUE IS THEN USED IN FORMATTING THE BRODCAST * 19650020
* DIRECTORY RECORDS.  A UNIQUE MSG RBA IS PUT INTO THE DIRECTORY FOR  * 19700020
* EACH POSSIBLE BRODCAST MSG NUMBER.                                  * 19750020
* THE FORMULA USED IS:                                                * 19800020
*                                                                     * 19850020
*   RBA OF FIRST     RBA OF FIRST     NUMBER OF                       * 19900020
*   BRODCAST MSG  =  BRODCAST DIR  +  BRODCAST                        * 19950020
*    RECORD           RECORD          DIR RECORDS                     * 20000020
*                                                                     * 20050020
*                                                                     * 20100020
         LA    R6,BCDNENT          ENTRIES/NOTICE DIR RCD        Y02676 20170002
         SR    R8,R8               CLEAR R8                             20200020
         LH    R9,BCMAX            R9 = MAXIMUM NUMBER OF BC MSG        20250020
*                                  R9 = DIVIDEND                        20300020
         DR    R8,R6               DIVIDE BY ENTRIES             Y02676 20350002
*                                  PER BC DIRECTORY RECORD              20400020
*                                  R9 = QUOTIENT = NO. BC DIRECTORY REC 20450020
         LTR   R8,R8               R8 = REMAINDER                       20550020
         BZ    NOREM               IF NO REMAINDER, BYPASS BUMP         20600020
         LA    R9,NEXT(R9)         BUMP R9 BY 1                         20700020
NOREM    DS    0H                                                       20750020
         A     R9,BDRBA1           ADD OFFSET TO RBA START       Y02676 20850002
         ST    R9,BMRBA            BMRBA = RBA OF FIRST BC MSG RECORD   20900020
         MVC   BCMNUM,BCMNUM1      INIT NOTICE NUMBER            Y02676 21000002
         MVC   BDRBA,BDRBA1        INIT NOTICE DIR RCD RBA       Y02676 21100002
         SPACE 4                                                        21150020
BCDL1    DS    0H             FORMAT 1 BRODCAST DIRECTORY RECORD        21200020
         L     R8,BMRBA            R8 = RBA OF BRODCAST MESSAGE RECORD  21300020
         XC    BCD(BCDLEN),BCD     CLEAR NOTICE DIRECTORY RECORD Y02676 21310002
         MVI   BCDREND,ENDREC      SET END-OF-RECORD INDICATOR   Y02676 21320002
         LA    R4,BDRBA+1          RBA NEXT RECORD               Y02676 21330002
         LH    R1,BCMNUM           R1 = BRODCAST MESSAGE NUMBER         21400020
         CH    R1,BCMAX            TEST FOR MAXIMUM BRODCAST MSG NUM    21410020
         BH    DIREND              YES, END OF NOTICE DIRECTORY,        21420020
*                                  GO TO WRITE NOTICE MSG RECORDS       21430020
         LA    R6,BCDNENT          SET LOOP CONTROL              Y02676 21500002
         SPACE 4                                                        21550020
BCDLOOP  DS    0H            FORMAT 25 BRODCAST DIRECTORY RECORD ENTRY  21650020
         CH    R1,BCMAX            IS IT MAXIMUM BRODCAST MSG NUM       21750020
         BH    ENDLOOP             YES, RECORD FORMAT DONE       Y02676 21800002
         MVC   BCDMSGNO,BCMNUM     SET MESSAGE NUMBER            Y02676 21900002
         OI    BCDMFLG,BCDNOMSG    SET BIT0 = 1, NO MSG FOR THIS Y02676 22000002
*                                  BRODCAST MESSAGE NUMBER              22050020
         MVC   BCDMRBA,BMRBA+1     SET NOTICE RBA                Y02676 22100002
         LA    R1,NEXT(R1)         BUMP BRODCAST MESSAGE NUMBER         22200020
         STH   R1,BCMNUM                                                22250020
         LA    R8,NEXT(R8)         BUMP BRODCAST MESSAGE RECORD RBA     22300020
         ST    R8,BMRBA                                                 22350020
         LA    R3,L'BCDENTRY(R3)   STEP TO NEXT ENTRY            Y02676 22450002
         BCT   R6,BCDLOOP          EXECUTE LOOP 25 TIMES                22550020
ENDLOOP  DS    0H                                                       22560002
         LA    R3,DCBLNG(R10)      RESTORE BCD BASE              Y02676 22570002
         L     R5,BDRBA            BUMP BC DIRECTORY POINTER            22750020
         LA    R5,NEXT(R5)                                              22800020
         CH    R1,BCMAX            CHECK FOR MAXIMUM BROADCAST MSGNO    22900020
         BH    WRITBCD             RECORD FORMAT DONE            Y02676 22950002
         STCM  R5,PTR24,BCDNEXT    SET CHAIN PTR                 Y02676 22970002
WRITBCD  DS    0H                  WRITE NOTICE DIRECTORY RECORD        23100020
         MVI   KEY,BDKEY           SET KEY = X'0                        23200020
         WRITE DECB2,DI,(R10),(R3),'S',KEY,(R4),MF=E  WRITE DIR. RECORD 23300020
         CHECK DECB2                                                    23350020
         ST    R5,BDRBA             SET RBA NEXT DIRECTORY REC          23400020
         B     BCDL1               BRANCH TO FORMAT ANOTHER RECORD      23500020
         EJECT                                                          23660020
         SPACE 4                                                        24900020
*********************************************************************** 24950020
*        WRITE BROADCAST NOTICE MSG RECORDS TO RESERVE MAXIMUM SPACE  * 25000020
*********************************************************************** 25050020
DIREND   DS    0H                  CREATE NOTICE RECORDS         Y02676 25055002
         ST    R5,BMRBAS           SAVE R5                              25400020
         XC    BCD(BCDLEN),BCD     CLEAR NOTICE MODEL            Y02676 25410002
         LH    R6,BCMAX            INIT LOOP CONTROL REG TO NO. OF      25420020
*                                  BC NOTICE MSG RECORDS TO WRITE       25430020
         LA    R4,BMRBAS+1         RBA ADDR FOR WRITE            Y02676 25450002
         MVI   KEY,BMKEY           SET KEY FOR BROADCAST NOTICE MSG     25550020
*                                  RECORD                               25600020
BCMLOOP  DS    0H                  WRITE A NULL BC NOTICE MSG RECORD    25650020
         WRITE DECB2,DI,(R10),(R3),'S',KEY,(R4),MF=E                    25700020
*                                  WRITE NOTICE RECORD                  25750020
         CHECK DECB2                                                    25800020
         L     R5,BMRBAS                                                25850020
         LA    R5,NEXT(R5)         BUMP RBA OF NEXT NOTICE MSG TO       25900020
*                                  WRITE                                25950020
         ST    R5,BMRBAS                                                26000020
         BCT   R6,BCMLOOP          LOOP UNTIL ALL NOTICES MSG           26050020
*                                  ARE WRITTEN                          26100020
         EJECT                                                          26150020
*********************************************************************** 26200020
*                                                                     * 26250020
* SET UP RECORD 1 FOR SYS1.BRODCAST DATA SET                          * 26300020
*                                                                     * 26350020
*********************************************************************** 26400020
         XC    BCD(BCDLEN),BCD     CLEAR RECORD1 MODEL           Y02676 26500002
         MVC   R1BCPTR,BDRBA1+1    PTR TO NOTICES DIRECTORY      Y02676 26600002
         MVC   R1USPTR,BMRBA+1     PTR TO MAIL DIRECTORY         Y02676 26650002
         MVC   R1BCMAX,BCMAX       NOTICES MAXIMUM               Y02676 26750002
*                                  SET NO. RECORDS IN DATA SET          26800020
         MVC   R1RECNUM(L'R1RECNUM),RECCNT                              26850020
*                                                                     * 26900020
         MVC   R1DSN(L'DSNAME),DSNAME   DATA SET NAME                   26950020
         MVC   R1LEVEL(L'R1LEVEL),LEVEL2 DATA SET FORMAT LEVEL   Y02676 26970002
         L     R5,RECCNT                R5 = NO. RECORDS IN D S         27000020
         S     R5,BMRBA                 R5 = NO. RECORDS IN D S MINUS   27050020
*                                       RBA OF FIRST USER DIR REC       27100020
         ST    R5,PARMLMCT              SAVE LIMIT CNT IN PARM LIST =   27150020
*                                       NO. RECORDS IN USER SECTION     27200020
         EJECT                                                          27250020
*********************************************************************** 27300020
*                                                                     * 27350020
* WRITE RECORD 1 OF SYS1.BRODCAST DATA SET                            * 27400020
*                                                                     * 27450020
*********************************************************************** 27500020
         LA    R4,R1RBA            SET ADDRESS OF BLOCK ID (RBA)        27600020
         MVI   KEY,R1KEY           SET KEY                              27650020
         WRITE  DECB2,DI,(R10),(R3),'S',KEY,(R4),MF=E  WRITE RECIRD 1   27750020
         CHECK DECB2                                                    27800020
         ST    R3,PARMRCD1         SET RECORD1 PTR FOR CALLER    Y02676 27810002
         DROP  R3                                                Y02676 27820002
         B     ENDIO               END OF PROCESSING                    28800020
         EJECT                                                          28850020
ENDIO    DS    0H                  EXIT CODE                            36050020
         L     R13,SAVER+OFFCALLR  RELOAD R13 WITH CALLER SAVE AREA ADD 36100020
         SR    R14,R14             CLEAR REG 14                         36150020
         IC    R14,RETCODE         SAVE RETURN CODE IN REG 14           36200020
*                                  BEFORE ISSUING FREEMAIN              36250020
         LA    R0,DATAEND-DATABEG  SET R0 FOR FREEMAIN FOR WORK AREA    36300020
*        R12 HAS ADDRESS OF WORK AREA GOTTEN VIA GETMAIN                36350020
         FREEMAIN  R,LV=(0),A=(R12)  FREE CORE FOR WORK AREA DSECT      36450020
         LM    R0,R12,OFF0(R13)    RELOAD REGS ZERO THRU 12             36500020
         LR    R15,R14             PUT RETURN CODE INTO REG 15          36600020
                    L     R14,OFF14(R13)      RELOAD REG 14             36650020
         BR    R14                 RETURN TO CALLER                     36750020
         SPACE 4                                                        36800020
*                                                                     * 37250020
SYNAD1   DS    0H                  SYNAD ROUTINE, WRITE 'DAF'    Y02676 37300002
         LR    R5,R0               REG0 = ADDRESS OF DECB               37500020
         TM    ECBSTAT1(R5),ECBSPAC 'SPACE NOT FOUND'            Y02676 37600002
         BNO   SYNAD2              IF OFF, BRANCH                Y02676 37650002
         OI    RETCODE,DSFULL      SET RETURN FOR DATA SET FULL         37750020
         B     ENDIO               END OF PROCESSING                    37800020
SYNAD2   DS    0H                  SYNAD ROUTINE, REGULAR I/O    Y02676 37810002
         OI    RETCODE,IOERR       SET RETURN CODE TO I/O ERROR  Y02676 37830002
         B     ENDIO               END OF PROCESSING             Y02676 37840002
         SPACE 4                                                        37850020
SYNAD0   DS    0H                  SYNAD USED ON FIRST READ WHEN OPEN   37950020
*                                  IS REQUESTED                         38000020
         OI    RETCODE,BADFMT      INDICATE FORMAT BAD           Y02676 38150002
         B     ENDIO               END OF PROCESSING             Y02676 38155002
BADOPEN  DS    0H                  OPEN WAS NOT SUCCESSFUL              38170020
         OI    RETCODE,OPENERR     SET RETURN CODE FOR OPEN ERROR       38180020
         B     FREEDCB             GO TO FREE CORE GOTTEN FOR DCB       38190020
*                                                                     * 38200020
         SPACE 2                                                        38950020
BADGM    DS    0H                  GETMAIN FOR JFCB UNSUCCESSFUL        39050020
         OI    RETCODE,NOCORE      SET RETURN CODE FOR NOT ENOUGH CORE  39100020
         B     ENDIO               BRANCH TO EXIT                       39150020
         EJECT                                                          39550020
BCMNUM1  DC    H'1'                FIRST BRODCAST MSG NUMBER            40600020
BDRBA1   DC    F'1'                RBA FIRST BRODCAST DIR. RECORD       40650020
DSNAME   DC    C' SYS1.BRODCAST DATA SET '                              40700002
LEVEL2   DC    C'LEVEL 2'          LEVEL INDICATOR               Y02676 40720002
R1RBA    DC    X'000000'           RELATIVE BLOCK ADDR OF FIRST RECORD  40750020
SPARE    DC    50X'00'             PATCH AREA                    Y02676 40770002
         EJECT                                                          40900020
ENDREC   EQU   X'7F'               END OF RECORD INDICATOR              41000020
NEXT     EQU   1                   USED AS INCREMENT VALUE              41350020
RBAL     EQU   3                   RELATIVE BLOCK ADDRESS LENGTH        41600020
OFFCALLR EQU   4                   OFFSET IN MY SAVE AREA TO ADDR OF    41700020
*                                  CALLER'S SAVE AREA                   41750020
PTR24    EQU   7                   MASK FOR STCM OF ADDRESS      Y02676 41780002
RECPOS   EQU   7                   POSITION OF RECORD BYTE IN           41850020
*                                  2-WORD FEEDBACK AREA AFTER READ      41900020
OFFCALLD EQU   8                   OFFSET IN SAVE AREA TO CALLED ADDR   41950020
OFF0     EQU   20                  OFFSET TO REG0 IN SAVE AREA          42000020
OFF14    EQU   12                  OFFSET TO REG14 IN SAVE AREA         42050020
         EJECT                                                          42250020
*********************************************************************** 42300020
*                                                                     * 42350020
*  THE FOLLOWING ARE EXCEPTION CODE BIT SETTINGS IN ECB+1 WHICH ARE     42400020
*  TESTED IN THE SYNAD ROUTINES.                                        42450020
*                                                                     * 42500020
*********************************************************************** 42550020
*                                                                     * 42600020
ECBSTAT1 EQU   1                   OFFSET IN ECB TO 1ST          Y02676 42610002
*                                  EXCEPTION FLAG BYTE           Y02676 42620002
ECBSPAC  EQU   X'20'               SPACE NOT FOUND TO WRITE REC         42700020
         SPACE 2                                                        42800020
*********************************************************************** 42850020
*                                                                     * 42900020
*        THE FOLLOWING ARE USED TO SET THE RETURN CODE FOR CALLER     * 42950020
*                                                                     * 43000020
*********************************************************************** 43050020
NOCORE   EQU   X'40'               NOT ENOUGH CORE FOR IO RTN           43150020
BADFMT   EQU   X'10'               WRONG LEVEL DATA SET          Y02676 43170002
IOERR    EQU   X'08'               I/O ERROR - SYNAD ENTERED            43200020
OPENERR  EQU   X'02'               ERROR OCCURRED DURING OPEN           43300020
DSFULL   EQU   X'01'               DATA SET FULL  ON   WRITE 'DA'       43350020
*                                                                     * 43400020
*                                                                     * 43450020
*                                                                     * 43500020
         EJECT                                                          43550020
BDKEY    EQU   X'00'               KEY FOR BROADCAST DIRECTORY REC      43600020
USDKEY   EQU   X'01'               KEY FOR USER MAIL DIRECTORY RECS     43650020
BMKEY    EQU   X'02'               KEY FOR BROADCAST NOTICE MSG REC     43700020
R1KEY    EQU   X'04'               KEY FOR RECORD1                      43750020
*                                                                     * 43800020
*        THE FOLLOWING ARE LIST FORMS OF MACROS WHICH ARE MOVED TO    * 43850020
*        GOTTEN CORE AT EXECUTION TIME.                               * 43900020
*        THE ORDER OF THE MACROS MUST NOT BE CHANGED             Y02676 43950002
*                                                                     * 44000020
         READ  DEC01,DIF,,,,,,MF=L  READ BY BLOCK ID (RBA) LIST         44050020
         WRITE DEC02,DI,,,,,,MF=L  WRITE BY BLOCK ID (REL. BLOCK ADDR)  44100020
         WRITE DEC03,DAF,,,,,,MF=L WRITE TO ADD A RECORD W/FEEDBACK     44150020
         WRITE DEC04,SD,,,,,,MF=L  WRITE DUMMY RECORD LIST              44200020
         OPEN  0,MF=L              OPEN LIST FORM                       44250020
         CLOSE 0,MF=L              CLOSE LIST FORM                      44300020
         GETMAIN  EC,MF=L          GETMAIN LIST FORM                    44350020
LISTSEND EQU   *                   END OF LISTS FOR MACRO INSTRUCTIONS  44500020
*                                  TO BE USED TO MOVE INTO DSECT        44550020
LISTSL   EQU   LISTSEND-DEC01      LENGTH OF LISTS FOR MACRO INSTRUCT.  44600020
         EJECT                                                          46850020
*                                                                     * 46900020
*                                                                     * 46950020
*                                                                     * 47000020
*********************************************************************** 47050020
*                                                                     * 47100020
* BSAM DCB - USED TO CREATE SYS1.BRODCAST DATA SET                    * 47150020
*                                                                     * 47200020
*********************************************************************** 47250020
BSAMDCB  DCB   BLKSIZE=129,                                            X47300020
               BUFL=129,                                               X47350020
               DEVD=DA,            DIRECT ACCESS                       X47400020
               DDNAME=SYSLBC,      DDNAME FOR BROADCAST DATA SET       X47450020
               DSORG=PS,           PHYSICAL SEQUENTIEL                 X47500020
               KEYLEN=1,           KEY LENGTH = 1 BYTE                 X47550020
               MACRF=(WL),         CREATE DIRECT DATA SET              X47600020
               RECFM=F,            FIXED                               X47700020
               SYNAD=SYNAD1                                             47750020
         EJECT                                                          47800020
*********************************************************************** 47850020
*                                                                     * 47900020
* BDAM DCB - USED TO ACCESS SYS1.BRODCAST DATA SET                    * 47950020
*   OPTCD='FR' CAUSES FEEDBACK TO BE IN RELATIVE BLOCK ADDRESS FORM.  * 48000020
*                                                                     * 48010020
*********************************************************************** 48050020
BDAMDCB  DCB   BLKSIZE=129,                                            X48100020
               BUFL=129,                                               X48150020
               DDNAME=SYSLBC,      DDNAME FOR BROADCAST DATA SET       X48200020
               DSORG=DA,           DIRECT ACCESS                       X48250020
               KEYLEN=1,           KEY LENGTH = 1 BYTE                 X48300020
               LIMCT=5,            SET AT EXECUTION TIME, NEVER ZERO   X48350020
               MACRF=(RIC,WAIC),   READ, ID, CHECK, WRITE              X48400020
               OPTCD=EFR,          RELATIVE BLOCK ADDRESSING           X48450002
               RECFM=F,            FIXED                               X48500020
               SYNAD=SYNAD1                                             48550020
         EJECT                                                          48560020
*********************************************************************** 48570020
*                                                                     * 48580020
* DCB FOR USE BY IKJEES40, ACCOUNT / BROADCAST DATA SET INTERFACE RTN * 48590020
*     OPTCD DOES NOT SPECIFY 'F',  FEEDBACK WILL BE IN ACTUAL DEVICE  * 48592020
*     ADDRESS FORM.                                                   * 48594520
*                                                                     * 48595020
*********************************************************************** 48595520
ACCTDCB  DCB   BLKSIZE=129,                                            X48596020
               BUFL=129,                                               X48598020
               DDNAME=SYSLBC,      DDNAME FOR BROADCAST DATA SET       X48598420
               DSORG=DA,           DIRECT ACCESS                       X48598820
               KEYLEN=1,           KEY LENGTH = 1 BYTE                 X48599220
               LIMCT=5,            SET AT EXECUTION TIME, NEVER ZERO   X48599620
               MACRF=(RIC,WAIC),   READ, ID, CHECK, WRITE              X48599720
               OPTCD=ER,           RELATIVE BLOCK ADDRESSING           X48599802
               RECFM=F,            FIXED                               X48600020
               SYNAD=SYNAD1                                             48616620
         EJECT                                                          48633320
*********************************************************************** 48650020
*                                                                     * 48700020
*        DSECT FOR PARAMETER LIST FROM CALLER                         * 48750020
*                                                                     * 48800020
*********************************************************************** 48850020
*                                                                     * 48900020
SDIOPARM DSECT                     DSECT FOR PARM LIST FROM IEEVSEND    48950020
*                                                                       49000020
PARM1    DS    1C                  FLAG1 FOR OPERATIONS TO BE PERFORMED 49050020
P1OPEN   EQU   X'80'               OPEN - INITIAL FORMATTING IF FIRST   49100020
*                                       TIME DATA SET HAS BEEN USED     49150020
P1READ   EQU   X'40'               READ SPECIFIED RECORD                49200020
P1CREATE EQU   X'20'               CREATE BROADCAST DS (BSAM)    Y02676 49250002
P1READ1  EQU   X'10'               SKIP RECORD1 CHECK            Y02676 49300002
PARM2    DS    1C                  FLAG2 FOR OPERATIONS TO BE PERFORMED 49350020
P2WRDI   EQU   X'80'               WRITE SPECIFIED RECORD BY BLOCK ID   49400020
P2WRDAF  EQU   X'40'               WRITE SPECIFIED RECORD IN NEXT       49450020
*                                       AVAILABLE SPACE WITH FEEDBACK   49500020
P2CLOSE  EQU   X'20'               CLOSE                                49550020
P2DEL    EQU   X'10'               DELETION OF THIS RECORD.             49600020
*                                  PUT PARMFDBK INTO FIRST BYTE OF DATA 49650020
P2DEVAD  EQU   X'08'               DEVICE ADDRESS FEEDBACK       Y02676 49710002
PARMKEY  DS    C                   KEY FOR READ/WRITE INSTRUCTION       49750020
PARMFDBK DS    C                   FEEDBACK FROM READ - POSITION        49800020
*                                  OF RECORD ON TRACK.  PUT INTO        49850020
*                                  FIRST BYTE OF DATA FOR DELETE        49900020
PARMRBA  DS    F                   ADDRESS OF RBA FOR READ/WRITE        49950020
PARMIOAD DS    F                   ADDRESS OF BUFFER FOR IO INSTRUCTION 50000020
PARMDDNM DS    CL8                 DDNAME FOR BROADCAST DATA SET        50050020
*        THE FOLLOWING FIELDS ARE NEVER CLEARED FROM PARM LIST          50100020
PARMLMCT DS    F                   LIMIT COUNT FOR EXTENDED SEARCH      50150020
PARMDCB  DS    F                   ADDRESS OF DCB                       50200020
PARMRCD1 DS    F                   ADDRESS OF RECORD1 BUFFER     Y02676 50220002
*                                  PROVIDED FOR CALLER WITH      Y02676 50240002
*                                  RECORD1 READ AT OPEN          Y02676 50260002
         EJECT                                                          50300020
*********************************************************************** 50350020
*                                                                     * 50400020
DATABEG  DSECT                     DSECT FOR    WORK DATA AREA          50450020
         READ  DECB1,DIF,,,,,,MF=L  READ BY BLOCK ID (RBA) LIST         50500020
         WRITE DECB2,DI,,,,,,MF=L  WRITE BY BLOCK ID (REL. BLOCK ADDR)  50550020
         WRITE DECB3,DAF,,,,,,MF=L WRITE TO ADD A RECORD W/FEEDBACK     50600020
         WRITE DECB4,SD,,,,,,MF=L  WRITE DUMMY RECORD LIST              50650020
OPENL    OPEN  0,MF=L              OPEN LIST FORM                       50700020
CLOSEL   CLOSE 0,MF=L              CLOSE LIST FORM                      50750020
GETML    GETMAIN  EC,MF=L          GETMAIN LIST FORM                    50800020
         EJECT                                                          50950020
SAVER    DS    18F                 REGISTER SAVE AREA                   51000020
RETCODE  DS    C                   RETURN CODE                   Y02676 51350002
KEY      DS    C                   KEY FOR READ/WRITE            Y02676 51850002
         SPACE 4                                                        52450020
*                                                                     * 52500020
* THE FOLLOWING ARE USED FOR INITIAL FORMATTING OF DATA SET           * 52550020
*                                                                     * 52600020
BCMAX    DS    H                   MAXIMUM NUMBER BRODCAST MSGS ALLOWED 52800020
BCMSG1   DS    F                   ADDR FIRST BRODCAST MESSAGE RECORD   52850020
BMRBA    DS    F                   BRODCAST MESSAGE RBA                 52900020
BMRBAS   DS    F                   RBA OF BROADCAST NOTICE MSG RECORD   52950020
*                                  TO BE WRITTEN WITH KEY '02'X TO      53000020
*                                  RESERVE IT AS UNAVAILABLE TO BDAM    53050020
BDRBA    DS    F                   BRODCAST DIRECTORY RBA               53100020
BCMNUM   DS    H                   BRODCAST MESSAGE NUMBER              53150020
DUMREC   DS    H                   DUMMY RECORD FOR BSAM CREATE  Y02676 53160002
BCFDBK   DS    2F                  TTR FEEDBACK AREA             Y02676 53170002
RECCNT   DS    F                   NUMBER OF RECORDS IN DATA SET        53250020
DATAEND  DS    0H                  END OF WORK DATA AREA                53300020
*                                                                     * 53350020
*********************************************************************** 53400020
         EJECT                                                          53402002
         IEZBITS                                                 Y02676 53404002
*********************************************************************** 53406002
* THE FOLLOWING DSECT DESCRIBES BROADCAST DS RECORDS BUFFER      Y02676 53408002
*********************************************************************** 53410002
BCD      DSECT                                                   Y02676 53412002
         IKJZT301 DSECT=NO                                       Y02676 53414002
         ORG   BCD                                               Y02676 53416002
         IKJZT302 DSECT=NO                                       Y02676 53418002
         ORG   BCD                                               Y02676 53420002
         IKJZT303 DSECT=NO                                       Y02676 53422002
         ORG   BCD                                               Y02676 53424002
         IKJZT304 DSECT=NO                                       Y02676 53426002
         ORG   BCD                                               Y02676 53428002
         IKJZT305 DSECT=NO                                       Y02676 53430002
BCDLEN   EQU   *-BCD               LENGTH OF RECORDS BUFFER      Y02676 53432002
         EJECT                                                          53450020
CVTD     DSECT                DSECT TO MAP COMMUNICATIONS VECTOR TABLE. 53500020
         CVT                                                            53550020
         EJECT                                                          53600020
         IEEBASEA                                                       53610020
         EJECT                                                          53650020
         DCBD  DSORG=DA,DEVD=DA                                         54300020
DCBEND   EQU   *                   END OF DCB                           54350020
DCBLNG   EQU   DCBEND-IHADCB       LENGTH OF DCB TO USE IN GETMAIN      54400020
*                                                                     * 54450020
         END                                                            54550020
