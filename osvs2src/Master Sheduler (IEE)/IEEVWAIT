         TITLE 'IEEVWAIT MASTER SCHEDULER WAIT ROUTINE'                 00250002
*********************************************************************** 00300002
* MODULE NAME   = IEEVWAIT                                            * 00350002
*                                                                     * 00400002
* LOAD MODULE   = IEEVWAIT                                            * 00450002
*                                                                     * 00500002
* DESCRIPTION   = MASTER SCHEDULER WAIT PROCESSOR                     * 00550002
*                                                                     * 00600002
* COPY RIGHT    = NONE                                                * 00650002
*                                                                     * 00700002
*STATUS        = OS-VS/2- DUMPING IMPROVEMENTS                @ZA29984* 00702000
*                                                                     * 00800002
* FUNCTION      = IT IS THE RESPONSIBILITY OF THIS MODULE TO          * 00850002
*                 ISSUE MASTER'S MAJOR WAIT.  UPON BEING FREED        * 00900002
*                 FROM THAT WAIT, THE ECBS ARE CHECKED TO SEE         * 00950002
*                 IF THEY WERE POSTED TO PROCESS FOR A COMMAND        * 01000002
*                 OR TO COMPLETE THE SYSTEM INITIALIZATION            * 01050002
*                 AND RELEASE THE SERIALIZATION RESOURCES.            * 01100002
*                 A GETMAIN IS ISSUED FOR THE CORE TO BE USED         * 01250002
*                 AS THE WORK AND ESTAE PARM AREA.  IF IT IS A        * 01280002
*                 POST FROM THE PRIMARY SUBSYSTEM, THEN THE           * 01310002
*                 SYSTEM TRACE FUNCTION IS SHUT OFF AND THE           * 01360002
*                 TRACE TABLE IS FREED, AND THEN THE SUBSYSTEM        * 01370002
*                 SERIALIZATION RESOURCES ARE RELEASED.               * 01400002
*                 IF IT IS A POST FOR A COMMAND, THE CSCB CHAIN       * 01410002
*                 IS SCANNED FOR THE COMMAND TO BE SERVICED.  A       * 01420002
*                                                                     * 01450002
* OPERATION     = IEEVWAIT OPERATES UNDER THE PROTECTION OF           * 01500002
*                 A ESTAE ENVIRONMENT.  ESTAE PROVIDES INTERVENTION   * 01550002
*                 IN CASE OF AN ABEND CONDITION.  IF AN ABEND         * 01600002
*                 CONDITION OCCURS, ABEND PROCESSES NORMALLY          * 01650002
*                 UNTIL THE ESTAE INTERFACE ROUTINE SYNCHES           * 01700002
*                 TO THE EXIT ROUTINE (STAE0000).  WHEN THE           * 01750002
*                 ESTAE EXIT COMPLETES, IT RETURNS TO THE STAE        * 01800002
*                 ROUTINE WITH AN INDICATOR THAT RETRY WILL           * 01850002
*                 BE ATTEMPTED.  STAE THEN MODIFIES THE RESUME        * 01900002
*                 PSW IN THE RB TO POINT TO THE ADDRESS INDICATED.    * 01950002
*                 THE ESTAE ROUTINE'S OPERATION IS AS FOLLOWS:        * 02000002
*                  . SAVE ABEND'S REGISTERS.                          * 02050002
*                  . SET UP THE ENVIRONMENT FOR RETRY.                * 02100002
*                  . INDICATE RETRY WITHIN THE ESTAE PROCESSOR.       * 02150002
*                  . IF IT WAS A TRACE TABLE ABEND, DO A FREEPAGE.    * 02170002
*                  . TAKE A DUMP FOR ALL BUT PERCOLATION AND          * 02200002
*                    MACHINE CHECK ENTRIES.                  @YM3505P * 02250002
*                  . INFORM OPERATOR OF FAILURE/DUMP STATUS.          * 02300002
*                  . VERIFY THE VALIDITY OF THE CSCB CHAIN AND        * 02350002
*                    IF FOUND TO BE BAD, TRUNCATE IT AND INFORM THE   * 02400002
*                    OPERATOR.                                        * 02450002
*                  . IF REENTERED WITH THE INTERNAL FAILURE           * 02500002
*                    INDICATOR BIT ON, CONTINUE WITH THE NEXT         * 02550002
*                    FUNCTION INDICATED BY THE PROCESS CODE.          * 02600002
*                    SUCH REENTRY IS POSSIBLE SINCE THE               * 02610002
*                    RETRY CODE IS PROTECTED BY ESTAE.                * 02620002
*                  . IF ENTERED WITH EXTERNAL RECURSION       @ZA29984* 02650000
*                    INDICATOR ON, TEST FOR TRACE OFF         @ZA29984* 02660000
*                    PROCESSING COMPLETE. IF COMPLETED,       @ZA29984* 02670000
*                    CONTINUE WITH THE ABEND.                 @ZA29984* 02680000
*                    IF NOT COMPLETED, FREE THE FIXED PAGE    @ZA29984* 02690000
*                    AND ATTEMPT RE-TRY AT SYSLOG             @ZA29984* 02700000
*                    INITIALIZATION.                          @ZA29984* 02710000
*                 THE MASTER WAIT ROUTINE AFTER BASIC SETUP           * 02750002
*                 WILL ISSUE A WAIT ON A LIST OF TWO ECBS.  THE       * 02800002
*                 FIRST IS THE MASTER WAIT ECB AND THE OTHER          * 02850002
*                 IS THE PRIMARY SUBSYSTEM INITIALIZATION ECB.        * 02900002
*                 THE SUBSYSTEM ECB WILL BE POSTED TO INDICATE        * 02950002
*                 THAT IT HAS COMPLETED INITIALIZATION AND IS         * 03000002
*                 READY TO PROCESS.  THE MASTER WILL THEN             * 03050002
*                 RELEASE THE SUBSYSTEM SERIALIZATION RE-             * 03100002
*                 SOURCES.  IF THE MASTER ECB WAS POSTED THEN         * 03150002
*                 THE CSCB CHAIN WILL BE SCANNED, LOOKING FOR         * 03200002
*                 A PENDING CSCB, AND IF FOUND, IT WILL BE PROCESSED. * 03250002
*                                                                     * 03300002
* NOTES:                                                              * 03350002
*  CHARACTER-                                                         * 03400002
*   CODE        = MAY BE ASSEMBLED WITH ANY CODE SET                  * 03450002
*  DEPENDENCIES = NONE                                                * 03500002
*  RESTRICTIONS = NONE                                                * 03550002
*  REGISTER-                                                          * 03600002
*  CONVENTIONS  = NONE                                                * 03650002
*  PATCH-LABEL  = VPATCH                                              * 03700002
*                                                                     * 03750002
* MODULE TYPE:                                                        * 03800002
*  PROCESSOR    = ASSEMBLER                                           * 03850002
*  MODULE SIZE  = X '9C9'                                     @ZA29984* 03852000
*  ATTRIBUTES   = REENTRANT                                           * 03900002
*                 SUPERVISOR MODE                                     * 03950002
*                 ZERO PSW PROTECT KEY                                * 04000002
*                 PAGED LPA                                           * 04050002
*                                                                     * 04100002
* ENTRY POINT   = IEEVWAIT                                            * 04150002
*  PURPOSE      = MASTER WAIT ISSUANCE                                * 04200002
*  LINKAGE      = XCTL FROM IEEMB860                                  * 04250002
*  INPUT DATA   = NONE                                                * 04300002
*                                                                     * 04350002
* ENTRY POINT   = STAE0000                                            * 04400002
*  PURPOSE      = MASTER SCHEDULER WAIT RECOVERY                      * 04450002
*  LINKAGE      = SYNCH TO FROM ASIR                                  * 04500002
*  INPUT DATA   = ESTAE DIAGNOSTIC WORKAREA (REGISTER 1)              * 04550002
*                 ESTAE PARM LIST (ESTAE DIAGNOSTIC WORK AREA)        * 04600002
*                                                                     * 04650002
* REGISTER USAGE:                                                     * 04700002
*  SAVED        = NONE                                                * 04750002
*  CONTAINED    = REGISTER 0  = UNPREDICTABLE                         * 04800002
*                 REGISTER 1  = UNPREDICTABLE                         * 04850002
*                 REGISTER 2  = UNPREDICTABLE                         * 04900002
*                 REGISTER 3  = UNPREDICTABLE                         * 04950002
*                 REGISTER 4  = CSCB BASE REGISTER                    * 05000002
*                 REGISTER 5  = LAGGING CSCB BASE REGISTER            * 05050002
*                 REGISTER 6  = PARAMETER LIST ADDR FOR ATTACH        * 05100002
*                 REGISTER 7  = CVT BASE REGISTER                     * 05150002
*                 REGISTER 8  = WORKER BASE REGISTER                  * 05200002
*                 REGISTER 9  = BASEA BASE REGISTER                   * 05250002
*                 REGISTER 10 = UNPREDICTABLE                         * 05300002
*                 REGISTER 11 = UNPREDICTABLE                         * 05350002
*                 REGISTER 12 = IEEVWAIT BASE REGISTER                * 05400002
*                 REGISTER 13 = UNPREDICTABLE                         * 05450002
*                 REGISTER 14 = UNPREDICTABLE                         * 05500002
*                 REGISTER 15 = UNPREDICTABLE                         * 05550002
*  RESTORED     = NONE                                                * 05600002
*                                                                     * 05650002
* COMMANDS      = DISPLAY ACTIVE                   START              * 05700002
*                 DISPLAY CONSOLES                 MOUNT              * 05750002
*                 DISPLAY UNITS                    SEND               * 05800002
*                 DISPLAY C,K                      HALT EOD           * 05850002
*                 DISPLAY PFK                      SWITCH SMF         * 05900002
*                 DISPLAY M                        SET IPS            * 05950002
*                 DISPLAY JOBS                     UNLOAD             * 06000002
*                 DISPLAY TS                       RESET              * 06010002
*                 DISPLAY DMN                      PAGEADD    @Z40BPSV* 06012040
*                 DISPLAY DUMP                                @G33CPMR* 06016043
*                 TRACK   ACTIVE                   DUMP               * 06020002
*                 VARY    PATH                     QUIESCE            * 06050002
*                 VARY    CHANNEL                  LOGON              * 06100002
*                 VARY    CPU                                         * 06150040
*                 VARY    STORAGE                                     * 06200002
*                 VARY    ONLINE                                      * 06250002
*                 VARY    OFFLINE                                     * 06300002
*                 VARY    CONSOLES                                    * 06350002
*                 VARY    CN                                  @Y02668P* 06370002
*                                                                     * 06400002
* PROGRAM FLOW  = SET UP ESTAE ENVIRONMENT                            * 06450002
*                 ENQUEUE ON THE SERIALIZATION RESOURCE               * 06500002
*                 ENQUEUE SHR ON THE CSCB CHAIN                       * 06550002
*                 SCAN THE CSCB CHAIN                                 * 06600002
*                 CHECK EACH CSCB FOR ASSIGNMENT PENDING BIT          * 06650002
*                 WHEN CSCB WITH PENDING BIT ON IS FOUND:             * 06700002
*                   IF OTHER THAN 'START' 'MOUNT' OR 'LOGON'          * 06750002
*                   DECHAIN THE CSCB AND ATTACH THE COMMAND IN        * 06800002
*                   MASTER REGION.  IF ONE OF THE ABOVE IS FOUND,     * 06850002
*                   ATTACH THE MEMORY CREATE FUNCTION EXCEPT FOR      * 06900002
*                   LOGON, THEN ATTACH THE TIOC PROCESSOR.            * 06950002
*                   PRIOR TO DECHAINING THE CSCB THE CSCB RESOURCE    * 07000002
*                   IS DEQUEUED.                                      * 07050002
*                 CONTINUE SCANNING CSCB CHAIN AND PROCESSING         * 07100002
*                 ALL CSCB'S WITH ASSIGNMENT PENDING BIT ON.          * 07150002
*                 WHEN NO MORE PENDING CSCB'S ARE LEFT, REISSUE       * 07200002
*                 WAIT.  WHEN POSTED, CHECK WHICH ECB WAS POSTED.     * 07250002
*                 IF THE MASTER ECB WAS THEN POSTED, REPEAT THE       * 07300002
*                 ABOVE PROCESSING.  IF IT WAS THE SUBSYSTEM ECB,     * 07350002
*                 SHUT OFF THE TRACE FUNCTION, FREE THE TABLE, THEN   * 07360002
*                 RELEASE THE SERIALIZATION RESOURCE AND REISSUE      * 07400002
*                 THE WAIT.  THE WAIT WILL NEVER BE ISSUED WHILE      * 07450002
*                 ENQUEUED ON THE CSCB CHAIN.                         * 07500002
*                                                                     * 07550002
* NOTES:        = FOR START COMMANDS, THE INTERPRETER COUNTER         * 07600002
*                 WITHIN MASTER RESIDENT CORE IS INCREMENTED          * 07650002
*                 BY ONE.  THE COUNTER IS ALSO PASSED TO THE          * 07700002
*                 READER IN THE CSCB-CHINC FIELD.                     * 07750002
*                 WITH SU33, THIS MODULE HAS BEEN             @G33CPMR* 07760043
*                 RECONSTRUCTED SO THAT THE SEARCH FOR THE    @G33CPMR* 07770043
*                 MODULES TO BE ATTACHED ARE TABLE DRIVEN.    @G33CPMR* 07780043
*                                                                     * 07800002
* EXIT - NORMAL = NONE                                                * 07850002
*  CONDITIONS   = NONE                                                * 07900002
*  OUTPUT DATA  = NONE                                                * 07950002
*  RETURN CODE  = NONE                                                * 08000002
*                                                                     * 08050002
* EXIT - ERROR  = ENTER A WAIT STATE OR RESTART MASTER SCHEDULER      * 08100002
*  CONDITIONS   = RECURSIVE EXTERNAL ABEND OR NORMAL ABEND/FAILURE    * 08150002
*  OUTPUT DATA  = NONE                                                * 08200002
*  RETURN CODE  = NONE                                                * 08250002
*                                                                     * 08300002
* EXTERNAL:                                                           * 08350002
*  REFERENCES   = NONE                                                * 08400002
*  ROUTINES     = IEEVEMCR (START, MOUNT)                             * 08450002
*                 IEEDAY3  (LOGON)                                    * 08500002
*                 IEE3603D (VARY ONLINE, OFFLINE, CONSOLES)           * 08550002
*                 IEECB800 (DISPLAY ACTIVE, TRACK ACTIVE)             * 08600002
*                 IEEVSEND (SEND)                                     * 08650002
*                 IEEPALTR (DISPLAY PFK, DISPLAY C,K, DISPLAY UNITS)  * 08700002
*                 IEECB866 (DUMP)                                     * 08750002
*                 IEE70110 (HALT, SWITCH)                             * 08800002
*                 IEEXEDNA (DISPLAY CONSOLES)                         * 08850002
*                 IEEMB813 (UNLOAD)                                   * 08900002
*                 IEEVPTH  (VARY PATH)                                * 08950002
*                 IEEVCH   (VARY CHANNEL)                             * 09000002
*                 IEEVCPU  (VARY CPU)                                 * 09050002
*                 IEEMPVST (VARY STOR)                                * 09100002
*                 IEEMPS03 (QUIESCE)                                  * 09150002
*                 IEEMPDM  (DISPLAY MATRIX)                           * 09200002
*                 IEEMB810 (RESET)                                    * 09250002
*                 IEEMB811 (SET)                                      * 09300002
*                 IEEMB803 (LOG - AT IPL TIME ONLY)                   * 09310002
*                 IEECB900 (VARY 'CN' SYNTAX CHECKER)         @Y02668P* 09330002
*                 IEEPGEXP (PAGEADD)                          @Z40WPSS* 09332041
*                 IEEDISPD (DISPLAY DMN)                      @Z40BPSV* 09338040
*                 IEECB905 (SLIP)                             @G17SPTJ* 09342041
*                 IEECB907 (DISPLAY SLIP)                     @G17SPTJ* 09346041
*                 IEECB910 (DISPLAY DUMP)                     @G33CPMR* 09348043
*                                                                     * 09350002
*  DATA AREAS   = ATTACH WORK AREA                                    * 09400002
*                 STAE PARAMETER WORK AREA                            * 09420002
*                                                                     * 09450002
*  CONTROL BLOCK= COMMUNICATIONS VECTOR TABLE (CVT)            R      * 09500002
*                 MASTER RESIDENT CORE (BASEA)                 R,U    * 09550002
*                 COMMAND SCHEDULING CONTROL BLOCK (CSCB)      R,U    * 09600002
*                 ESTAE DIAGNOSTIC WORK AREA (SDWA)            R,U    * 09650002
*                 SECONDARY COMMUNICATION VECTOR TABLE (SCVT)  R,U    * 09660002
*                 PHYSICAL CONFIGURATION COMMUNICATION AREA           * 09670002
*                                                       (PCCA) R      * 09673002
*                 PCCA VECTOR TABLE (PCCAT)                    R      * 09676002
*                 PREFIXED SAVE AREA (PSA)                     R,U    * 09680002
*                 COMMON SYSTEM DATA AREA (CSD)                R      * 09690002
*                 I/O SUPERVISOR COMMUNICATION AREA            R,U    * 09700002
*                                                                     * 09720002
*                 R=REFERENCE     U=UPDATE                            * 09750002
*                                                                     * 09800002
*  TABLES       = ESTAE PARAMETER LIST                                * 09850002
*                 COMMAND TABLE (MODTABLE)                    @G33CPMR* 09860043
*                 BRANCH TABLE (BRTABLE)                      @G33CPMR* 09870043
*                                                                     * 09900002
*  MACROS       = MODID       MODULE IDENTIFICATION                   * 09950002
*                 GETMAIN     X'08' BYTES FROM SUBPOOL 251            * 09970002
*                 GETMAIN     STAE WORK AREA SIZE FROM SUBPOOL 253    * 10000002
*                 ESTAE       CREATE ESTAE ENVORONMENT                * 10050002
*                 GETMAIN     X'08' BYTES FROM SUBPOOL 251            * 10070002
*                 ENQ         SUBSYSTEM SERIALIZATION FOR STC         * 10100002
*                 ENQ         SUBSYSTEM SERIALIZATION FOR TSO         * 10150002
*                 WAIT        ECB = BALAD                             * 10300002
*                             ECB = BASUBECB                          * 10350002
*                 ENQ         ON THE CSCB CHAIN                       * 10400002
*                 DEQ      X  OFF THE SERIALIZATION FOR STC           * 10401002
*                 DEQ      X  OFF THE SERIALIZATION FOR TSO           * 10407002
*                 PGFIX    X  IEEVWAIT ACROSS SETLOCK                 * 10413002
*                 WAIT     X  ECB=FIXECB                              * 10419002
*                 SETLOCK  X  OBTAIN THE DISPATCHER LOCK              * 10425002
*                 SETLOCK  X  RELEASE THE DISPATCHER LOCK             * 10431002
*                 PGFREE   X  IEEVWAIT                                * 10437002
*                 FREEMAIN X  THE SYSTEM TRACE TABLE FROM SP 245      * 10443002
*                 ATTACH      OF/FOR COMMANDS                         * 10450002
*                 DEQ         OFF THE CSCB CHAIN                      * 10550002
*                 MGCR        DECHAIN OR FREE THE CSCB                * 10560002
*                 SETRP    *  RETURN TO ASIR                          * 10570002
*                 DEQ      *  OFF THE CSCB CHAIN                      * 10620002
*                 PGFREE  X*  IEEVWAIT                                * 10670002
*                 SDUMP    *  TO SYS1.DUMP DATA SET                   * 10720002
*                 WTO      *  MESSAGE IEE481I, OR IEE479W             * 10770002
*                 ENQ      *  ON THE CSCB CHAIN                       * 10820002
*                 DEQ      *  OFF THE CSCB CHAIN                      * 10870002
*                 DEQ      *  OFF THE CSCB CHAIN                      * 10920002
*                 WTO      *  MESSAGE IEE513I                         * 10970002
*                 WTO      *  MESSAGE IEE482E                         * 11020002
*                         '*' INDICATES ERROR PROCESSING              * 11200002
*                         'X' INDICATES SUBSYSTEM PROCESSING          * 11250002
*                                                                     * 11300002
*  ENQUEUED                                                           * 11350002
*   RESOURCES   = QUEUE 10 (CSCB)                                     * 11400002
*                 SHR IN MAINLINE                                     * 11410002
*                 EXCLUSIVE IN RECOVERY                               * 11420002
*                 SUBSYSTEM SERIALIZATION FOR STC                     * 11450002
*                 SUBSYSTEM SERIALIZATION FOR TSO                     * 11500002
*                                                                     * 11550002
*  LOCKS        = A DISPATCHER LOCK IS OBTAINED JUST AFTER THE        * 11570043
*                 PAGEFIX FOR TRACE TABLE DELETIONS AND IS RELEASED   * 11600043
*                 BEFORE THE PAGEFREE                                 * 11606043
*                                                                     * 11650002
*  SYSGEN       = IN ITS OWN LOAD WITH NO ALIASES                     * 11700002
*                                                                     * 11750002
*  LIBRARIES    = NONE                                                * 11800002
*                                                                     * 11850002
*  CHANGE LEVEL = Y02669, Y02653, Y02668, Z40WPSS, Z40BPSV            * 11870040
*                 G17SPTJ, G33CPMR, ZA29984                   @ZA29984* 11890000
*                                                                     * 11950002
* MESSAGES      = IEE481I MASTER SCHEDULER ABEND XXX, DUMPED,         * 12000002
*                                                   RESTARTING        * 12010002
*                                                                     * 12020002
*                 IEE479W MASTER SCHEDULER FAILED, DUMPED, REIPL      * 12150002
*                                                                     * 12200002
*                 IEE513I COMMAND PROCESSING LIMITED                  * 12250002
*                                                                     * 12260002
*                 IEE482E MASTER SCHEDULER RESTART FAILED, ABEND      * 12300002
*                                                   RECURSION, REIPL  * 12310002
*                                                                     * 12320002
*                      'XXX' IS THE ABEND CODE                        * 12330002
*                      'DUMPED' WILL APPEAR ONLY IF A DUMP WAS TAKEN  * 12340002
*********************************************************************** 12350002
* C (WAIT0060) MOVE SETTING BTRACE TO TRACE TERMINATION       @ZA29984* 12370000
* C (STAE0030) CHANGE RECURSIVE ABEND BRANCH TARGET           @ZA29984* 12380000
* C (STAE0215) NEW LABEL.TEST TRACE OFF PROCESSING            @ZA29984* 12390000
         EJECT                                                          12400002
*********************************************************************** 12450002
*                                                                     * 12500002
*        REGISTER  EQUATES                                            * 12550002
*                                                                     * 12600002
*********************************************************************** 12650002
IEEVWAIT  CSECT                                                         12700002
R0       EQU  0                   RETURN CODE REGISTER FROM STAE Y01043 12750002
R1       EQU  1                   PARAMETER REGISTER             Y01043 12800002
R2       EQU  2                                                         12850002
R3       EQU  3                                                         12900002
R4       EQU  4                   CSCB BASE REGISTER             Y01043 12950002
R5       EQU  5                   LAGGING CSCB ADDRESS           Y01043 13000002
R6       EQU  6                   PARAMETER LIST ADDR FOR ATTACH Y01043 13050002
R7       EQU  7                   CVT BASE REGISTER              Y01043 13100002
R8       EQU  8                   TCB BASE REGISTER              Y01043 13150002
R9       EQU  9                   RESIDENT CORE BASE REGISTER    Y01043 13200002
R10      EQU  10                  STAE WORK AREA BASE REGISTER   Y01043 13250002
R11      EQU  11                                                        13300002
R12      EQU  12                  IEEVWAIT BASE REGISTER         Y01043 13350002
R13      EQU  13                                                        13400002
R14      EQU  14                                                        13450002
R15      EQU  15                                                        13500002
         EJECT                                                          13550002
*********************************************************************** 13600002
*                                                                     * 13650002
*        EQUATES                                                      * 13700002
*                                                                     * 13750002
*********************************************************************** 13800002
D0       EQU   0                                                        13850002
D1       EQU   1                                                        13900002
D2       EQU   2                  LENGTH FOR MOVE TO CVT         Y02669 13910002
D3       EQU   3                                                        13950002
D4       EQU   4                                                        14000002
D5       EQU   5                                                        14050002
D8       EQU   8                                                        14100002
D12      EQU   12                                                       14150002
D16      EQU   16                 LOOP CONTROL FOR PCCA SCAN     Y02669 14152002
D29      EQU   29                                                Y01043 14200002
D128     EQU   128                HIGH ORDER BIT SETTER          Y02669 14250002
XFF      EQU   X'FF'                                                    14300002
BLNK     EQU   C' '               BLANK FOR MESSAGE BUILDING     Y01043 14350002
COMA     EQU   C','               COMMA FOR MESSAGE BUILDING     Y01043 14400002
POSTBIT  EQU   X'40'              FOR TESTING IF ECB IS POSTED   Y02669 14500002
         EJECT                                                          15800002
*********************************************************************** 15850002
*                                                                     * 15900002
*        START PROCESSING                                             * 15950002
*                                                                     * 16000002
*********************************************************************** 16050002
WAIT00   EQU   *                                                 Y02669 16100002
         BALR  R12,R0             ESTABLISH ADDRESSABILITY              16150002
         USING *,R12              USE REGISTER 12 FOR IEEVWAIT BASE     16200002
         MODID BRANCH=YES                                        Y01886 16250002
         EJECT                                                          16300002
*********************************************************************** 16350002
*        ISSUE ESTAE                                                  * 16400002
*********************************************************************** 16450002
         L    R0,ATCHINF          SP/SIZE OF ATTACH AREA         Y02669 16500002
         GETMAIN R,LV=(0)                                        Y02669 16550002
         LR    R6,R1              SAVE ADDR ACROSS GETMAIN       Y01043 16600002
         L     R0,PARMAR          SP/SIZE OF STAE WORKAREA       Y01043 16650002
         GETMAIN R,LV=(0)         GET STAE PARAMETER AREA        Y01043 16700002
         USING PARMAREA,R4        BASE THE STAE PARAMETER AREA   Y02653 16740002
         LR    R4,R1              SET PARAMETER ADDRESS FOR STAE Y02653 16780002
         XC    PARMAREA(ENDAREA-STRTAREA),PARMAREA             @YM3526P*16790002
                                  ZERO ESTAE PARMAREA          @YM3526P 16800002
         LR    R10,R4             SAVE PARMAREA ADDRESS          Y02669 16820002
         ST    R6,PASSER          PASS ADDRESS TO RETRY          Y01043 16850002
         USING PSA,R0                                          @YM3529P 16860002
         MVC   TRACEPTR(D4),FLCTRACE  SAVE ADDR OF TRACE TABLE @YM3529P 16870002
         DROP  R0                                              @YM3529P 16880002
         MVC   MSGAREA(STAEL),LSTAE                                    *16900002
                                  MOVE IN THE LIST FORM OF STAE  Y01043 16950002
         LA    R3,STAE0000        ADDRESS OF STAE EXIT           Y02653 17150002
         LA    R1,MSGAREA         ADDRESS OF STAE LIST FORM      Y02653 17200002
         ESTAE (3),RECORD=YES,PARAM=(4),MF=(E,(1))               Y02669 17250002
         LTR   R15,R15            STAE O.K.?                     Y01043 17300002
         BZ    WAIT0000           YES, CONTINUE                  Y02653 17350002
         OI    INDCATOR,BFAIL     NO, INDICATE BRANCH ENTRY      Y02653 17400002
         OI    INDCATOR,BDUMP     INDICATE DUMP TO BE TAKEN      Y02653 17450002
         DROP  R4                 RELEASE BASE FOR PARAMETER AREAY02653 17500002
         LR    R2,R4              PASS PARAMETER AREA ADDRESS    Y01043 17600002
         B     STAE0020           TAKE DUMP/ISSUE MESSAGE        Y02653*17700002
                                       AND ENTER PERMANENT WAIT  Y02653 17800002
         EJECT                                                          17900002
*********************************************************************** 17910002
*        TWO RESOURCES ARE ENQUEUED ON:                               * 17960002
*            STCQUE - STARTED TASK CONTROL                            * 17980002
*            TSOQUE - TIME SHARING                                    * 18000002
*        THE ENQS ISSUED HERE ARE DEQUEUED AFTER THE PRIMARY          * 18020002
*        JOB ENTRY SUBSYSTEM HAS BEEN INITIALIZED.  SINCE THESE       * 18040002
*        NAMES ARE ALSO ENQUEUED ON BY STC AND TSO LOGON,             * 18060002
*        RESPECTIVELY, REQUESTS FOR SUBSYSTEM SERVICES ARE            * 18080002
*        PREVENTED FROM REACHING THE SUBSYSTEM UNTIL IT IS            * 18100002
*        INITIALIZED.                                                 * 18120002
*********************************************************************** 18144402
         SPACE 2                                                        18146002
WAIT0000 EQU   *                                                 Y02653 18150002
         L     R0,WORKINF         SP/SIZE OF WORKER AREA         Y02669 18200002
         GETMAIN R,LV=(0)         GET THE WORKER                 Y02669 18250002
         LR    R8,R1              SET ADDRESS OF GOTTEN AREA     Y02669 18300002
         USING WORKER,R8          BASE THE WORK AREA FOR LIFE    Y02669 18350002
         MVC   SENQDEQ(ENQLEN),SENQSTC                                 *18400002
                                  SET ENQ LIST FOR SUBSYSTEM STC Y02669 18450002
         LA    R1,SENQDEQ         GET ADDRESS OF ENQ LIST        Y02669 18500002
         ENQ   MF=(E,(1))         ENQ ON SERIALIZATION RESOURCE  Y02669 18550002
         MVC   SENQDEQ(ENQLEN),SENQTSO                                 *18600002
                                  SET ENQ LIST FOR SUBSYSTEM TSO Y02669 18650002
         LA    R1,SENQDEQ         GET ADDRESS OF ENQ LIST        Y02669 18700002
         ENQ   MF=(E,(1))         ENQ ON SERIALIZATION RESOURCE  Y02669 18750002
         EJECT                                                          18752002
**************************************************************** Y01012 18760002
*        SET UP THE BASE REGISTERS REQUIRED FOR EXECUTION.       Y02669 18770002
*        SET UP THE ENQ, DEQ, AND ATTACH LISTS FORMS             Y02669 18780002
**************************************************************** Y01012 18790002
         SPACE                                                          18792002
         USING PARMAREA,R4        BASE THE ESTAE PARAMETER AREA  Y02653 18800002
         LA    R8,D0(R0,R8)       ZERO HIGH ORDER BYTE         @YM3527P 18820002
         ST    R8,PASSER1         SAVE WORKER ADDRESS FOR RESTARTY02653 18850002
         L     R3,PASSER          GET ADDRESS OF ATTACH AREA     Y02669 18900002
         DROP  R4                 RELEASE PARAMETER AREA BASE    Y02653 18950002
         USING ATTACHDC,R3        SET BASE FOR ATTACH DSECT      Y02669 19000002
         MVC   ENQLIST(ENQLEN),LISTENQ                                 *19050002
                                  SET UP ENQ LIST FORM           Y02669 19100002
         MVC   DEQLIST(DEQLEN),LISTDEQ                                 *19150002
                                  SET UP DEQ LIST FORM           Y02669 19200002
         MVC   ATCHEXP(ATCHLEN),ATCHLST                                *19250002
                                  SET UP ATTACH LIST FORM        Y02669 19300002
         L     R7,CVTPTR          GET CVT ADDRESS                Y02669 19350002
         USING CVTSECT,R7         BASE THE CVT                   Y02669 19400002
         L     R9,CVTMSER         GET BASEA ADDRESS              Y01012 19450002
         USING BASE,R9            BASE THE MASTER RESIDENT DATA  Y01012*19500002
                                      AREA                       Y01012 19520002
         LA    R1,BALAD           GET ADDRESS OF COMMAND ECB     Y02669 19550002
         ST    R1,WAITECB         COMMAND PROCESS ECB SETUP      Y02669 19600002
         LA    R1,BASUBECB        GET ADDRESS OF SUBSYSTEM ECB   Y02669 19650002
         ST    R1,SSYSECB         SUBSYSTEM ECB ADDRESS SETUP    Y02669 19700002
         OI    SSYSECB,D128       INDICATE END OF LIST           Y02669 19750002
         EJECT                                                          19800002
*********************************************************************** 19850002
*        ISSUE  WAIT                                                  * 19900002
*********************************************************************** 19950002
WAITING  EQU   *                                                 Y02669 20000002
         LA    R1,ECBLIST         LOAD ADDRESS OF ECB LIST       Y02669 20050002
         WAIT  ,ECBLIST=(R1)      WAIT ON EVENT                  Y02669 20100002
         TM    BALAD,POSTBIT      WAS WAIT ECB POSTED?           Y02669 20150002
         BZ    WAIT0055           DO SUBSYSTEM INITIALIZATION  @YM02665 20200002
         XC    BALAD(D4),BALAD    ZERO THE WAIT ECB              Y02669 20250002
         B     WAIT0030           SCAN CSCB CHAIN                Y02669 20300002
WAIT0010 EQU   *                                                 Y02669 20350002
         LR    R10,R6             RESTORE PARMAREA ADDRESS     @YM3524P 20370002
         L     R7,CVTPTR          CVT ADDRESSABILITY             YM3821 20400002
         L     R9,CVTMSER         @ MASTER RESIDENT DATA AREA           20450002
         NI    BASPBYTE,XFF-BAMSSTAR                                   *20500002
                                  INDICATE STAE PROCESS OK       Y01043 20550002
         B     WAIT0030           SCAN CSCB CHAIN                Y02669 20600002
         EJECT                                                          20650002
*********************************************************************** 20700002
*        RESTART POINT                                           Y02653 20750002
*********************************************************************** 20800002
WAIT0020 EQU   *                                                 Y02653 20850002
         USING PARMAREA,R4        BASE THE ESTAE PARMAREA      @YM3528P 20860002
         XC    PROSCDE(D3),PROSCDE ZERO ESTAE RECURSION CODE   @YM3467P*20880002
                                     AND PROCESSING INDICATORS @YM3467P 20900002
         DROP  R4                                                       20930002
         LTR   R8,R8              IS THERE A WORKER?             Y02653 20950002
         BZ    WAIT0000           NO, THEN DO BASE INITIAL       Y02653 21000002
         EJECT                                                          21050002
*********************************************************************** 21100002
*        SCAN CSCB CHAIN                                              * 21150002
*********************************************************************** 21200002
WAIT0030 EQU   *                                                 Y02669 21250002
         LA    R1,ENQLIST         SET ADDRESS OF LIST FORM ENQ   Y02651 21300002
         ENQ   MF=(E,(1))         ENQ SHR ON CSCB CHAIN          Y02651 21350002
         L     R4,BACHN           ADDRESS CSCB CHAIN                    21400002
         USING CHN,R4             BASE REGISTER FOR CSCB CHAIN          21450002
         LA    R5,BACHN           INITIALIZE LAGGING CSCB ADDR          21500002
WAIT0040 EQU   *                                                 Y02669 21550002
         LTR   R4,R4              IS CSCB ADDRESS 0?                    21600002
         BZ    WAIT0050           YES, STOP CSCB SCAN            Y02669 21650002
         TM    CHSTS,CHAP         NO, TEST ASSIGN PENDING BIT           21700002
         BO    WAIT0070           IF ON, BRANCH AND PROCESS      Y02669 21750002
         LR    R5,R4              IF NOT, UPDATE LAGGING CSCB ADDRESS   21800002
         L     R4,CHPTR           UPDATE CSCB POINTER                   21850002
         B     WAIT0040           BRANCH AND TEST THIS CSCB      Y02669 21900002
WAIT0050 EQU   *                                                 Y02669 21950002
         BAL   R11,WAIT0510       GET OFF THE CSCB CHAIN         Y02669 22000002
         B     WAITING            REWAIT FOR MORE WORK           Y02669 22050002
         EJECT                                                          22100002
*********************************************************************** 22150002
*        SYSTEM INITIALIZATION                                   Y02669 22200002
*        SUBSYSTEM SERIALIZATION RESOURCE PROCESSING             Y02669 22210002
*********************************************************************** 22250002
WAIT0055 EQU   *                                                        22260002
         LR    R10,R6            RESTORE STAE PARMAREA POINTER @YM02665 22270002
WAIT0060 EQU   *                                                 Y02668 22300002
         LR    R11,R10            GET PARMAREA ADDRESS           Y02669 22306002
         USING PARMAREA,R11       BASE THE PARMAREA              Y02669 22312002
         XC    PROSCDE(D3),PROSCDE ZERO ESTAE RECURSION CODE   @YM3467P*22314002
                                     AND PROCESSING INDICATORS @YM3467P 22316002
         XC    BASUBECB(D4),BASUBECB                                   *22350002
                                  ZERO THE SERIALIZATION ECB     Y02668 22400002
         TM    MSFLAGS,MSSUBUP    SUBSYSTEM ALREADY UP?        @YM3467P 22410002
         BO    WAIT0010           YES DON'T REATTEMPT,         @YM3467P*22420002
                                  GO SCAN CSCB CHAIN INSTEAD   @YM3467P 22430002
         MVC   SENQDEQ(DEQLEN),SDEQSTC                           Y02669*22461002
                                  MOVE IN SUBSYSTEM DEQ LIST STC Y02669 22461902
         LA    R1,SENQDEQ         SET POINTER TO DEQ LIST        Y02669 22462802
         DEQ   MF=(E,(1))         GET OFF SERIALIZATION RESOURCE Y02669 22463702
         MVC   SENQDEQ(DEQLEN),SDEQTSO                           Y02669*22464602
                                  MOVE IN SUBSYSTEM DEQ LIST TSO Y02669 22465502
         LA    R1,SENQDEQ         SET POINTER TO DEQ LIST        Y02669 22466402
         DEQ   MF=(E,(1))         GET OFF SERIALIZATION RESOURCE Y02669 22467302
         EJECT                                                          22468202
*********************************************************************** 22468402
*        THE FOLLOWING WILL TERMINATE IPL/NIP TRACE TABLE             * 22468802
*        MAINTENANCE BY INVOKING A DISPATCHER LOCK WHICH DISABLES THE * 22468902
*        SIGNAL INTERRUPTS, THUS ASSURING THE INTEGRITY OF THE        * 22469002
*        CSDCPUAL BITS.  THIS, IN TURN, ASSURES THAT ANY PCCA/PSA'S   * 22469102
*        REFERENCED IS NOT FREED WHILE THIS CODE IS PROCESSING IT.    * 22469202
*********************************************************************** 22469602
         OI    INDCATOR,BTRACE    TURN TRACE TABLE BIT ON      @ZA29984 22469700
         TM    BASPBYTE,BATRACE   SYSTEM TRACE TO CONTINUE?    @Y02669P 22469800
         BO    WAIT0069           YES - DON'T TURN OFF TRACE   @Y02669P 22469900
         MVC   CVTTRACE(D2),TRACEOFF                                   *22470000
                                  SHUT OFF THE TRACE FUNCTION    Y02669 22470100
         LA    R4,FIXECB          SET ECB REGISTER FOR PAGEFIX   Y02669 22470502
         PGFIX R,A=STARTFIX,EA=ENDFIX,ECB=(R4),LONG=N            Y02669 22471002
         WAIT  ECB=FIXECB                                        Y02669 22472002
         LA    R13,LOCKSAV        POINTER TO SETLOCK SAVE AREA   Y02669 22473002
STARTFIX EQU   *                                                 Y02669 22474002
LOCKON   SETLOCK OBTAIN,TYPE=DISP,MODE=UNCOND,REGS=SAVE,         Y02669*22475002
               RELATED=(PCCA,IEEVWAIT(LOCKOFF))                  Y02669 22476002
         EJECT                                                          22476202
*********************************************************************** 22476402
*        THE FOLLOWING WILL TURN OFF THE TRACE TABLE POINTERS IN      * 22476602
*        THREE PLACES: IN THIS IEEVWAIT ENVIRONMENT - LOW CORE        * 22477002
*                      IN THE SECONDARY CVT                           * 22477202
*                      IN EACH CPU'S PSA.                             * 22477402
*                                                                     * 22477602
*        IN THE LOOP STARTING AT THE 'WAIT0063' LABEL, THE CPU'S      * 22477802
*        ARE REPRESENTED BY A 16-BIT CONFIGURATION FROM THE COMMON    * 22478002
*        SYSTEM DATA AREA WHICH IS LOADED INTO THE HIGH ORDER 2 BYTES * 22478202
*        OF REGISTER 10.  THE 'LTR' AND BNM' TESTS EACH HIGH ORDER    * 22478402
*        BIT FOR EACH 'ALIVE' CPU BIT IN A LOOP WHICH SHIFTS OFF EACH * 22478602
*        BIT 16 TIMES.                                                * 22478802
*********************************************************************** 22479002
         USING PSA,R0             BASE THE LOW CORE              Y02669 22479202
         SR    R1,R1              SET TO ZERO                    Y02669 22479602
         ST    R1,FLCTRACE        ZERO THE TRACE TABLE POINTER   Y02669*22479802
                                      IN THE LOW CORE            Y02669 22480002
         DROP  R0                 RELEASE LOW CORE BASE          Y02669 22482002
         USING SCVTSECT,R1        BASE THE SECONDARY CVT         Y02669 22484002
         L     R1,CVTABEND        GET ADDRESS OF SECONDARY CVT   Y02669 22486002
         SR    R0,R0              SET TO ZERO                    Y02669 22490002
         ST    R0,SCVTRPTR        ZERO THE TRACE TABLE POINTER   Y02669*22491002
                                      IN THE SECONDARY CVT       Y02669 22492002
         ST    R0,CVTTRCA     ZERO ADDR OF TRACE TABLE HEADER  @Z40WPSS 22493040
         DROP  R1                 RELEASE SCVT BASE              Y02669 22494002
         LA    R6,D16             SET THE LOOP CONTROL COUNTER   Y02669 22521402
         L     R4,CVTPCCAT        GET ADDRESS OF PCCA VECTOR     Y02669*22521802
                                      TABLE                      Y02669 22521902
         USING CSD,R1             BASE THE COMMON SYSTEM DATA    Y02669*22525102
                                      AREA                       Y02669 22528702
         L     R1,CVTCSD          GET THE CSD                    Y02669 22531102
         SR    R10,R10            ZERO OUT THE ICM REGISTER      Y02669 22536002
         ICM   R10,D12,CSDCPUAL   OBTAIN THE CPU 'ALIVE' BITS    Y02669 22538002
         DROP  R1                 RELEASE CSD BASE               Y02669 22540802
WAIT0063 EQU   *                                                 Y02669 22543802
         LTR   R10,R10            CURRENT CPU'S 'ALIVE' BIT ON?  Y02669 22546802
         BNM   WAIT0065           NO, GET NEXT CPU'S 'ALIVE' BIT Y02669 22549802
         L     R5,D0(R4)          YES, PICK UP POINTER TO PCCA   Y02669 22552802
         LTR   R5,R5              IS THERE A PCCA TO PROCESS?    Y02669 22555802
         BZ    WAIT0065           NO, CONTINUE WITH THE LOOP     Y02669 22558802
         USING PCCA,R5            YES, BASE THE PCCA             Y02669 22561802
         L     R5,PCCAPSAV        PICK UP THE ADDRESS OF PSA     Y02669 22564802
         DROP  R5                 RELEASE PCCA BASE              Y02669 22567802
         USING PSA,R5             BASE THE PSA                   Y02669 22570802
         SR    R0,R0              SET TO ZERO                    Y02669 22573802
         ST    R0,FLCTRACE        ZERO THE TRACE TABLE POINTER   Y02669*22576802
                                      IN THE PSA                 Y02669 22579802
         DROP  R5                 RELEASE PSA BASE               Y02669 22582802
WAIT0065 EQU   *                                                 Y02669 22585802
         SLL   R10,D1             BUMP TO NEXT CPU'S 'ALIVE' BIT Y02669 22588802
         LA    R4,D4(R4)          BUMP TO NEXT CPU'S PCCA POINTERY02669 22591802
         BCT   R6,WAIT0063        ANY MORE PCCA'S TO PROCESS?    Y02669 22594802
         EJECT                                                          22596802
*********************************************************************** 22597602
*        THE FOLLOWING WILL RELEASE THE LOCK AND FREE THE PAGE        * 22598402
*********************************************************************** 22599202
LOCKOFF  SETLOCK RELEASE,TYPE=DISP,REGS=SAVE,                    Y02669*22600002
               RELATED=(PCCA,IEEVWAIT(LOCKON))                   Y02669 22610002
ENDFIX   EQU   *                                                 Y02669 22620002
         PGFREE R,A=STARTFIX,EA=ENDFIX                           Y02669 22630002
         L     R1,TRACEPTR        GET ADDR OF TRACE TABLE      @YM3529P 22640002
         L     R0,D12(R1)         SP/LENGTH OF TRACE TABLE       Y02669 22650002
         FREEMAIN R,LV=(0),A=(1)  FREE THE TRACE TABLE           Y02669 22700002
         EJECT                                                          22750002
*********************************************************************** 22760002
*        THE FOLLOWING WILL DEACTIVATE MF/1 I/O STATISTICS AND        * 22763002
*        SIO SUPERVISOR TRACE ENTRIES.                                * 22766002
*********************************************************************** 22769002
         L     R1,CVTIXAVL        GET THE IOS COMMUNICATION AREA Y02669 22772002
         USING IOCOM,R1           BASE THE IOS                   Y02669 22775002
         L     R5,IOCMFCNT        TRACE ACTIVATOR POINTER        Y02669 22778002
         LA    R5,D4(R5)          INCREMENT TO THE FOUR-BYTE     Y02669*22781002
                                      INSTRUCTION ADDRESS        Y02669 22784002
         L     R6,IOCMFHK         TRACE DEACTIVATOR POINTER      Y02669 22787002
         MVC   D0(D4,R6),D0(R5)   MOVE THE INSTRUCTION TO THE    Y02669*22790002
                                      DEACTIVATOR ADDRESS        Y02669 22793002
         LR    R6,R11             RESTORE PARMAREA POINTER     @YM3467P 22794002
         DROP  R1                 RELEASE IOS BASE               Y02669 22796002
         EJECT                                                          22799002
*********************************************************************** 22802002
*        THE FOLLOWING WILL PREPARE FOR THE ATTACH TO THE SYSTEM      * 22810002
*        LOG MODULE - IEEMB803.                                       * 22812002
*********************************************************************** 22814002
WAIT0069 EQU   *                                                        22814502
         SR    R4,R4              ZERO OUT PARAMETER LIST        Y02669*22815002
                                      ADDRESS FOR ATTACH         Y02669 22817002
         LA    R10,LOGGER         GET LOG MODULE NAME            Y02669 22820002
         MVC   PMODID(D3),IEE     PUT MODULE PREFIX IN PARAMETER Y02669 22830002
         NI    BASPBYTE,XFF-BAMSSTAR                             Y02669*22832002
                                  TURN OFF STAE RECURSION BIT    Y02669 22834002
         NI    INDCATOR,XFF-BTRACE                               Y02669*22836002
                                  TURN OFF TRACE TABLE BIT       Y02669 22842002
         OI    MSFLAGS,MSSUBUP    TURN ON BIT INDICATING       @YM3467P*22843002
                                  SUBSYSTEM INITIALIZED        @YM3467P 22844002
         DROP  R11                RELEASE PARMAREA BASE          Y02669 22846002
         B     WAIT0495           GO AND ATTACH LOG              Y02668 22850002
         EJECT                                                          22900002
*********************************************************************** 22950002
*                                                                     * 23000002
*        DETERMINE VERB CODE AND SET MODULE TO BE ATTACHED            * 23050002
*                                                                     * 23100002
*********************************************************************** 23150002
WAIT0070 EQU   *                                                 Y02669 23200002
         LR    R6,R10             SAVE STAE PARMAREA POINTER   @YM02665 23220002
         NI    CHSTS,255-CHAP     TURN OFF ASSIGN PENDING BIT           23250002
         MVC   PMODID(D3),IEE     PUT MODULE PREFIX IN PARAMETER        23300002
         LA    R11,MODTABLE       ESTABLISH MODULE TABLE       @G33CPMR 23308043
         USING TABLEDEF,R11                                    @G33CPMR 23338043
WAIT0080 EQU   *                                               @G33CPMR 23368043
         CLC   CHVCD(D1),VERBCODE HIT THE DESIRED VERB CODE?   @G33CPMR 23398043
         BE    WAIT0090           YES, GET OUT OF LOOP         @G33CPMR 23428043
         LA    R11,TABENT(R11)    NO, BUMP TO NEXT TABLE ENTRY @G33CPMR 23458043
         CLC   VERBCODE(4),TABLEND END OF TABLE REACHED?       @G33CPMR 23488043
         BE    WAIT0100           YES, NO ENTRY FOUND - EXIT   @G33CPMR 23518043
         B     WAIT0080           NO, CONTINUE SCAN            @G33CPMR 23548043
WAIT0090 EQU   *                                               @G33CPMR 23578043
         LA    R10,MODULEID       SAVE MODULE NAME ADDRESS     @G33CPMR 23608043
         SR    R15,R15            CLEAR BRANCH POINTER         @G33CPMR 23638043
         IC    R15,BRANCHID       OBTAIN BRANCH ELEMENT        @G33CPMR 23668043
         DROP  R11                                             @G33CPMR 23698043
         LA    R11,BRTABLE        ESTABLISH BRANCH TABLE       @G33CPMR 23728043
         LA    R15,D0(R11,R15)    COMPILE BRANCH ADDRESS       @G33CPMR 23758043
         L     R15,D0(R15)        GET THE DESIRED ADDRESS      @G33CPMR 23788043
         BR    R15                BRANCH TO DESIRED LOCATION   @G33CPMR 23818043
WAIT0100 EQU   *                                               @G33CPMR 23848043
         BAL   R11,WAIT0510       GET OFF THE CSCB CHAIN         Y02669 29150002
         OI    CHSTS,CHFC         SET THE FREE BIT               Y02669 29200002
         BAL   R11,WAIT0520       GO FREE AND DECHAIN THE CSCB   Y02669 29250002
         B     WAIT0010           CONTINUE CSCB SCAN             Y02669 29300002
         EJECT                                                          29350002
*********************************************************************** 29400002
*        MEMORY CREATING COMMAND ATTACH SETUP                         * 29450002
*********************************************************************** 29500002
WAIT0460 EQU   *                                                 Y02669 29550002
         LH    R2,BAICTR          LOAD INTERPRETER COUNTER              29600002
         LA    R2,D1(R2)          ADD ONE TO COUNTER              M6201 29650002
         STH   R2,BAICTR          STORE COUNTER IN MASTER CORE          29700002
         STH   R2,CHINC           STORE COUNTER IN CSCB                 29750002
WAIT0470 EQU   *                                                 Y02669 29800002
         BAL   R11,WAIT0510       DEQUEUE THE CSCB               Y02669 29850002
         LA    R4,CHASID          PASS ADDR OF ASID TO MEM CR    Y02669 29900002
         SR    R11,R11            SET LPMOD VALUE                Y02669 29950002
         SR    R9,R9              SET DPMOD VALUE                Y02669 30000002
         B     WAIT0500           DO REGULAR ATTACH              Y02669 30050002
         EJECT                                                          30100002
**************************************************************** Y02669 30150002
*        TASK CREATING COMMAND ATTACH SETUP                      Y02669 30200002
**************************************************************** Y02669 30250002
WAIT0480 EQU   *                                                 Y02669 30300002
         OI    CHTYPE,CHDSTAT     SET THE SYSTEM STATUS BIT ON   21002  30350002
WAIT0490 EQU   *                                                 Y02669 30400002
         BAL   R11,WAIT0510       DEQ THE CSCB                   Y02669 30450002
         BAL   R11,WAIT0520       DECHAIN THE CSCB               Y02669 30500002
WAIT0495 EQU   *                                                 Y02669 30510002
         LA    R11,D3             SET LPMOD VALUE                       30550002
         LCR   R9,R11             SET DPMOD VALUE: -3                   30600002
         EJECT                                                          30650002
**************************************************************** Y02669 30700002
*        ATTACH CODE FOR THIS MODULE                             Y02669 30750002
**************************************************************** Y02669 30800002
WAIT0500 EQU  *                                                  Y02669 30850002
         MVC   PMODID+D3(D5),D0(R10)                                   *30900002
                                  SET UP NAME TO BE ATTACHED     Y02669 30950002
         LR    R1,R4              SET PARM ADDRESS IN REG 1      Y02669 31000002
         LA    R15,ATCHEXP        ADDRESS OF ATTACH LIST FORM    Y02669 31050002
         ATTACH EPLOC=(R3),LPMOD=(R11),DPMOD=(R9),MF=(E,(1)),          *31100002
               SF=(E,(15))                                       Y02669 31150002
         B     WAIT0010           CONTINUE CSCB SCAN             Y02669 31200002
         DROP  R4                 RELEASE BASE FOR THE CSCB      Y02669 31250002
         DROP  R7                 RELEASE BASE FOR THE CVT       Y02669 31300002
         DROP  R9                 RELEASE BASE FOR BASEA         Y02669 31350002
         EJECT                                                          31400002
**************************************************************** Y02669 31450002
*        THIS RTN GETS CONTROL WHEN A CMD HAS BEEN IDENTIFIED    Y01012 31500002
*        -A MATCH HAS BEEN FOUND AGAINST CSCB COMMAND CODE       Y01012 31550002
*        -A MATCH HAS BEEN FOUND AGAINST CSCB COMMAND PARAMETERS Y01012 31600002
*        THIS ROUTINE IS ENTERED ENQUEUED ON THE CSCB CHAIN      Y02669 31650002
*        INPUT - REG  4 - CSCB POINTER                           Y01012 31700002
*                REG 11 - CALLER'S RETURN ADDRESS                Y01012 31750002
*        OUTPUT- CSCB HAS BEEN DEQUEUED                          Y02669 31800002
*                CSCB HAS BEEN DECHAINED                         Y02669 31850002
**************************************************************** Y02669 31900002
WAIT0510 EQU   *                                                 Y02669 31950002
         USING CHN,R4             SET BASE FOR THE CSCB          Y02669 32000002
         LA    R1,DEQLIST         SET ADDRESS OF DEQ LIST        Y02651 32050002
         DEQ   MF=(E,(1))         GET OFF CSCB CHAIN             Y02651 32100002
         BR    R11                RETURN TO CALLER               Y02669 32150002
WAIT0520 EQU   *                                                 Y02669 32200002
         OI    CHSTS,CHDL         SET DECHAIN INDICATOR          Y01012 32250002
         MGCR  (4),CHAIN          DECHAIN THE CSCB               Y02669 32300002
         BR    R11                RETURN TO CALLER               Y01012 32350002
         DROP  R4                 RELEASE BASE FOR THE CSCB      Y02669 32400002
         DROP  R8                 RELEASE BASE FOR WORKER        Y02669 32410002
         EJECT                                                          32450002
*********************************************************************** 32500002
*                                                                     * 32550002
*        DEFINED CONSTANTS                                            * 32600002
*                                                                     * 32650002
*********************************************************************** 32700002
         DS    0F                                                Y01043 32750002
WORKINF  DC    AL1(255)           SUBPOOL FOR WORKER             Y02669 32800002
         DC    AL3(WORKSIZ)       SIZE OF WORKER                 Y02669 32850002
ATCHINF  DC    AL1(251)           SUBPOOL FOR ATTACH AREA        Y02669 32900002
         DC    AL3(D8)            SIZE OF AREA                   Y02669 32950002
IEE      DC    CL3'IEE'           MODULE PREFIX                  Y02669 33000002
LOGGER   DC    CL5'MB803'         LOG (IEEMB803)               @G33CPMR 33005043
MAJOR    DC    CL8'SYSIEFSD'      SYSTEM MAJOR NAME              Y02669 33950002
STCMIN   DC    CL8'STCQUE'        SUBSYSTEM MINOR NAME STC       Y02669 34000002
TSOMIN   DC    CL8'TSOQUE'        SUBSYSTEM MINOR NAME TSO       Y02669 34050002
MICSCB   DC    CL8'Q10'           CSCB MINOR NAME                Y02669 34100002
TRACEOFF BR    R11                USED TO SHUT OFF TRACE TABLE   Y02669 34110002
         EJECT                                                          34110843
*********************************************************************** 34111643
*                                                                     * 34112443
*                       BRANCH TABLE                                  * 34113243
*                                                                     * 34114043
*********************************************************************** 34114843
         SPACE 2                                                        34115643
BRTABLE  DS    0F                                              @G33CPMR 34116443
         DC    A(WAIT0460)         BRANCH TO 'WAIT0460' LABEL  @G33CPMR 34117043
         DC    A(WAIT0470)         BRANCH TO 'WAIT0470' LABEL  @G33CPMR 34117643
         DC    A(WAIT0480)         BRANCH TO 'WAIT0480' LABEL  @G33CPMR 34118243
         DC    A(WAIT0490)         BRANCH TO 'WAIT0490' LABEL  @G33CPMR 34118843
         EJECT                                                          34120443
*********************************************************************** 34121243
*                                                                     * 34122043
*                      COMMAND TABLE                                  * 34122843
*                                                                     * 34123643
*  EACH ENTRY IN THIS TABLE IS COMPOSED OF THREE ELEMENTS AS FOLLOWS: * 34124443
*     A) ONE BYTE VERB CODE COMPARAND ASSIGNED IN SVC 34              * 34125243
*     B) FIVE BYTE MODULE NAME SUFFIX                                 * 34125843
*     C) ONE BYTE BRANCH TABLE INDEX                                  * 34126443
*                                                                     * 34127643
*  THE TABLE IS ORDERED BY VERB CODE WITH THE EXCEPTION OF COMMANDS   * 34128043
*  WHOSE FREQUENCY OF INVOCATION REQUIRES THAT THE TABLE SEARCH FOR   * 34128443
*  THEM BE AS SHORT AS POSSIBLE.                                      * 34128843
*                                                                     * 34129243
*********************************************************************** 34130043
         SPACE                                                          34130143
MODTABLE DS    0F                                              @G33CPMR 34135343
         SPACE                                                          34136243
*********************************************************************** 34136343
*                                                                     * 34136443
*             PERFORMANCE ORDERED GROUP                               * 34136543
*                                                                     * 34136643
*********************************************************************** 34136743
         SPACE 2                                                        34136843
*********************************************************************** 34136943
         SPACE                                                          34137143
         DC    X'04'                                           @G33CPMR 34137243
         DC    CL5'VEMCR'         START (IEEVEMCR)             @G33CPMR 34137443
         DC    X'00'                                           @G33CPMR 34137643
         SPACE                                                          34138343
*********************************************************************** 34138443
         SPACE                                                          34138543
         DC    X'0C'                                           @G33CPMR 34138643
         DC    CL5'VEMCR'         MOUNT (IEEVEMCR)             @G33CPMR 34138843
         DC    X'04'                                           @G33CPMR 34139043
         SPACE                                                          34139743
*********************************************************************** 34139843
         SPACE                                                          34139943
         DC    X'68'                                           @G33CPMR 34140043
         DC    CL5'CB800'         DISPLAY ACTIVE (IEECB800)    @G33CPMR 34140243
         DC    X'0C'                                           @G33CPMR 34140443
         SPACE                                                          34141143
*********************************************************************** 34141243
         SPACE                                                          34141343
         DC    X'98'                                           @G33CPMR 34141443
         DC    CL5'DAY3 '         LOGON (IEEDAY3)              @G33CPMR 34141643
         DC    X'04'                                           @G33CPMR 34141843
         SPACE                                                          34142543
*********************************************************************** 34142643
         EJECT                                                          34142743
*********************************************************************** 34142843
*                                                                     * 34142943
*             VERB CODE ORDERED GROUP                                 * 34143043
*                                                                     * 34143143
*********************************************************************** 34143243
         SPACE 2                                                        34143343
*********************************************************************** 34143443
         SPACE                                                          34143543
         DC    X'24'                                           @G33CPMR 34143643
         DC    CL5'MB811'         SET (IEEMB811)               @G33CPMR 34143843
         DC    X'0C'                                           @G33CPMR 34144043
         SPACE                                                          34144743
*********************************************************************** 34144843
         SPACE                                                          34144943
         DC    X'28'                                           @G33CPMR 34145043
         DC    CL5'3603D'         VARY ONLINE, VARY CONSOLES,  @G33CPMR*34145243
                                    VARY OFFLINE (IEE3603D)    @G33CPMR 34145443
         DC    X'0C'                                           @G33CPMR 34145643
         SPACE                                                          34146443
*********************************************************************** 34146543
         SPACE                                                          34146643
         DC    X'2C'                                           @G33CPMR 34146743
         DC    CL5'MB813'         UNLOAD (IEEMB813)            @G33CPMR 34147043
         DC    X'0C'                                           @G33CPMR 34147343
         SPACE                                                          34148043
*********************************************************************** 34148143
         SPACE                                                          34148243
         DC    X'2E'                                           @G33CPMR 34148343
         DC    CL5'PALTR'         DISPLAY C,K (IEEPALTR)       @G33CPMR 34148643
         DC    X'08'                                           @G33CPMR 34148943
         SPACE                                                          34149543
*********************************************************************** 34149643
         SPACE                                                          34149743
         DC    X'32'                                           @G33CPMR 34149843
         DC    CL5'MPDM '         DISPLAY MATRIX (IEEMPDM)     @G33CPMR 34150043
         DC    X'0C'                                           @G33CPMR 34150243
         SPACE                                                          34150943
*********************************************************************** 34151043
         SPACE                                                          34151143
         DC    X'34'                                           @G33CPMR 34151243
         DC    CL5'70110'         SWITCH (IEE70110)            @G33CPMR 34151443
         DC    X'0C'                                           @G33CPMR 34151643
         SPACE                                                          34152343
*********************************************************************** 34152443
         EJECT                                                          34152543
*********************************************************************** 34152643
         SPACE                                                          34152743
         DC    X'36'                                           @G33CPMR 34152843
         DC    CL5'PALTR'         DISPLAY PFK (IEEPALTR)       @G33CPMR 34153243
         DC    X'08'                                           @G33CPMR 34153643
         SPACE                                                          34154543
*********************************************************************** 34154643
         SPACE                                                          34154743
         DC    X'3C'                                           @G33CPMR 34154843
         DC    CL5'70110'         HALT (IEE70110)              @G33CPMR 34155043
         DC    X'0C'                                           @G33CPMR 34155243
         SPACE                                                          34155943
*********************************************************************** 34156043
         SPACE                                                          34156143
         DC    X'3E'                                           @G33CPMR 34156243
         DC    CL5'XEDNA'         DISPLAY CONSOLES (IEEXEDNA)  @G33CPMR 34156443
         DC    X'0C'                                           @G33CPMR 34156643
         SPACE                                                          34157343
*********************************************************************** 34157443
         SPACE                                                          34157543
         DC    X'50'                                           @G33CPMR 34157643
         DC    CL5'VPTH '         VARY PATH (IEEVPTH)          @G33CPMR 34157843
         DC    X'0C'                                           @G33CPMR 34158043
         SPACE                                                          34158743
*********************************************************************** 34158843
         SPACE                                                          34158943
         DC    X'52'                                           @G33CPMR 34159043
         DC    CL5'PALTR'         DISPLAY U (IEEPALTR)         @G33CPMR 34159143
         DC    X'08'                                           @G33CPMR 34159243
         SPACE                                                          34159543
*********************************************************************** 34159643
         SPACE                                                          34159743
         DC    X'54'                                           @G33CPMR 34159843
         DC    CL5'VCPU '         VARY CPU (IEEVCPU)           @G33CPMR 34159943
         DC    X'0C'                                           @G33CPMR 34160043
         SPACE                                                          34160343
*********************************************************************** 34160443
         SPACE                                                          34160543
         DC    X'58'                                           @G33CPMR 34160643
         DC    CL5'VCH  '         VARY CHANNEL (IEEVCH)        @G33CPMR 34160743
         DC    X'0C'                                           @G33CPMR 34160843
         SPACE                                                          34161143
*********************************************************************** 34161243
         SPACE                                                          34161343
         DC    X'5C'                                           @G33CPMR 34161443
         DC    CL5'MPVST'         VARY STORAGE (IEEMPVST)      @G33CPMR 34161643
         DC    X'0C'                                           @G33CPMR 34161843
         SPACE                                                          34162543
*********************************************************************** 34162643
         EJECT                                                          34162743
*********************************************************************** 34162843
         SPACE                                                          34162943
         DC    X'60'                                           @G33CPMR 34163043
         DC    CL5'MPS03'         QUIESCE (IEEMPS03)           @G33CPMR 34163243
         DC    X'0C'                                           @G33CPMR 34163443
         SPACE                                                          34164143
*********************************************************************** 34164243
         SPACE                                                          34164343
         DC    X'74'                                           @G33CPMR 34164443
         DC    CL5'MB810'         RESET (IEEMB810)             @G33CPMR 34164643
         DC    X'0C'                                           @G33CPMR 34164843
         SPACE                                                          34165543
*********************************************************************** 34165643
         SPACE                                                          34165743
         DC    X'78'                                           @G33CPMR 34165843
         DC    CL5'CB900'         VARY CN (IEECB900)           @G33CPMR 34166043
         DC    X'0C'                                           @G33CPMR 34166243
         SPACE                                                          34166943
*********************************************************************** 34167043
         SPACE                                                          34167143
         DC    X'7C'                                           @G33CPMR 34167243
         DC    CL5'PGEXP'         PAGEADD (IEEPGEXP)           @G33CPMR 34167443
         DC    X'0C'                                           @G33CPMR 34167643
         SPACE                                                          34168343
*********************************************************************** 34168443
         SPACE                                                          34168543
         DC    X'80'                                           @G33CPMR 34168643
         DC    CL5'CB905'         SLIP (IEECB905)              @G33CPMR 34168843
         DC    X'0C'                                           @G33CPMR 34169043
         SPACE                                                          34169743
*********************************************************************** 34169843
         SPACE                                                          34169943
         DC    X'88'                                           @G33CPMR 34170043
         DC    CL5'DISPD'         DISPLAY DMN (IEEDISPD)       @G33CPMR 34170243
         DC    X'0C'                                           @G33CPMR 34170443
         SPACE                                                          34171143
*********************************************************************** 34171243
         SPACE                                                          34171343
         DC    X'A0'                                           @G33CPMR 34171443
         DC    CL5'VSEND'         SEND (IEEVSEND)              @G33CPMR 34171643
         DC    X'0C'                                           @G33CPMR 34171843
         SPACE                                                          34172543
*********************************************************************** 34172643
         SPACE                                                          34172743
         DC    X'A8'                                           @G33CPMR 34172843
         DC    CL5'CB907'         DISPLAY SLIP (IEECB907)      @G33CPMR 34173043
         DC    X'0C'                                           @G33CPMR 34173243
         SPACE                                                          34173943
*********************************************************************** 34174043
         EJECT                                                          34174143
*********************************************************************** 34174243
         SPACE                                                          34174343
         DC    X'AC'                                           @G33CPMR 34174443
         DC    CL5'CB866'         DUMP (IEECB866)              @G33CPMR 34174643
         DC    X'0C'                                           @G33CPMR 34174843
         SPACE                                                          34175543
*********************************************************************** 34175643
         SPACE                                                          34175743
         DC    X'B0'                                           @G33CPMR 34175843
         DC    CL5'CB910'         DISPLAY DUMP (IEECB910)      @G33CPMR 34176043
         DC    X'0C'                                           @G33CPMR 34176243
         SPACE                                                          34176843
*********************************************************************** 34177043
         SPACE                                                          34177943
         DC    X'C4'                                           @G33CPMR 34178843
         DC    CL5'CB800'         TRACK ACTIVE (IEECB800)      @G33CPMR 34179443
         DC    X'0C'                                           @G33CPMR 34180043
         SPACE                                                          34181543
*********************************************************************** 34182443
         SPACE                                                          34183343
TABLEND  DC    X'FFFF'                                         @G33CPMR 34184243
         EJECT                                                          34185143
*********************************************************************** 34186043
*                                                                     * 34186943
*           DSECT TO DEFINE LABELS IN MAINLINE CODE                   * 34187843
*                                                                     * 34188743
*********************************************************************** 34189643
         SPACE 2                                                        34190543
TABLEDEF DSECT                                                 @G33CPMR 34191443
TABSTART EQU   *                  TABLE ENTRY START            @G33CPMR 34191843
VERBCODE DS    CL1                ONE BYTE VERB CODE COMPARAND @G33CPMR 34192243
MODULEID DS    CL5                FIVE BYTE MODULE COMPLETER   @G33CPMR 34192643
BRANCHID DS    CL1                ONE BYTE BRANCH INDEX        @G33CPMR 34193043
TABEND   EQU   *                  TABLE ENTRY END              @G33CPMR 34193443
TABENT   EQU   TABEND-TABSTART    TABLE ENTRY SIZE             @G33CPMR 34193843
         EJECT                                                          34195043
IEEVWAIT CSECT                                                 @G33CPMR 34195943
         DS    0F                                                Y02669 34196843
ENQST    EQU   *                                                 Y02669 34200002
LISTENQ  ENQ   (MAJOR,MICSCB,S,3,SYSTEM),RET=HAVE,MF=L           Y02669 34250002
ENQEND   EQU   *                                                 Y02669 34300002
DEQST    EQU   *                                                 Y02669 34350002
LISTDEQ  DEQ   (MAJOR,MICSCB,3,SYSTEM),RET=HAVE,MF=L             Y02669 34400002
DEQEND   EQU   *                                                 Y02669 34450002
SENQSTC  ENQ   (MAJOR,STCMIN,E,6,SYSTEM),RET=HAVE,MF=L           Y02668 34500002
SENQTSO  ENQ   (MAJOR,TSOMIN,E,6,SYSTEM),RET=HAVE,MF=L           Y02668 34550002
         EJECT                                                          34570002
SDEQSTC  DEQ   (MAJOR,STCMIN,6,SYSTEM),RET=HAVE,MF=L             Y02668 34600002
SDEQTSO  DEQ   (MAJOR,TSOMIN,6,SYSTEM),RET=HAVE,MF=L             Y02668 34650002
ATCHST   EQU   *                                                 Y02669 34700002
ATCHLST  ATTACH SF=L,SM=SUPV,SZERO=NO,JSTCB=YES,SVAREA=NO,KEY=ZERO      34750002
ATCHEND  EQU   *                                                 Y02669 34800002
         EJECT                                                          34850002
*********************************************************************** 34900002
*                                                                     * 34950002
*         THE STAE EXIT ROUTINE WILL SET UP AND RETRY UPON ENTRY.     * 35000002
*         THE FUNCTION FOR THIS RETRY ROUTINE IS AS FOLLOWS:          * 35050002
*                                                                     * 35060002
*              .TAKE A DUMP OF THE SYSTEM, IF APPLICABLE              * 35100002
*              .INFORM OPERATOR OF THE ABEND AND DUMP STATUS          * 35150002
*         IEE481I MASTER SCHEDULER ABEND XXX, DUMPED, RESTARTING      * 35200002
*         IEE479W MASTER SCHEDULER FAILED, DUMPED, REIPL              * 35210002
*                 'XXX' IS THE ABEND CODE                             * 35250002
*                 'DUMPED' WILL APPEAR ONLY IF A DUMP WAS TAKEN       * 35300002
*                                                                     * 35350002
*              .SCAN THE CSCB CHAIN AND TRUNCATE IF BAD (ABEND ONLY)  * 35450002
*         IEE513I COMMAND PROCESSING LIMITED                          * 35500002
*                                                                     * 35510002
*              .ATTEMPT MASTER SCHEDULER RESTART (ABEND ONLY)         * 35550002
*              .KILL THE MASTER SCHEDULER IF RESTART FAILS            * 35600002
*         IEE482E MASTER SCHEDULER RESTART FAILED, ABEND RECURSION,   * 35650002
*                                                               REIPL * 35700002
*                                                                     * 35750002
*         RECURSION THROUGH FAILING RECOVERY FUNCTIONS IS PREVENTED   * 35760002
*         THROUGH THE USE OF A PROCESS CODE WHICH IS INCREMENTED BY   * 35770002
*         FOUR ON ENTRY TO EACH RECOVERY PROCESS. THE PROCESS CODE IS * 35780002
*         USED AS AN INDEX INTO THE BRANCH TABLE WHICH DETERMINES     * 35790002
*         WHICH RECOVERY PROCESS WILL BE PERFORMED FIRST.             * 35792002
*                                                                     * 35794002
*         IF THE RECOVERY CODE IS ENTERED WITH BASEA BIT BAMSSTAR     * 35796002
*         ON, A FAILURE HAS OCCURED DURING AN ATTEMPT TO RESTART      * 35798002
*         THE MASTER.  (RESTART OCCURS AFTER THE RECOVERY CODE IN     * 35798402
*         THIS SECTION EXECUTES AND CONSISTS OF AN ATTEMPT TO SCAN    * 35798802
*         THE CSCB CHAIN, PROCESS ANY PENDING CSCB'S, AND WAIT.  ONCE * 35799202
*         THIS WAIT IS SATISFIED, THE RESTART IS CONSIDERED SUCCESS-  * 35799602
*         FUL AND BAMSSTAR IS TURNED OFF.)  A FAILURE IN RESTART WILL * 35799702
*         RESULT IN ISSUANCE OF THE LAST MESSAGE ABOVE, FOLLOWED BY   * 35799802
*         ENTRY INTO A NEVER-ENDING WAIT.  THIS PROCESSING ALSO       * 35799902
*         OCCURS IF RECURSION OCCURS ON THE RECOVERY CODE WHICH       * 35809902
*         SETS UP THE RESTART.                                        * 35811902
*                                                                     * 35816602
*         IF THE BRANCH ENTRY TO RECOVERY IS ENTERED, A DUMP WILL     * 35826602
*         BE TAKEN, A MESSAGE ISSUED AND A NEVER ENDING WAIT WILL     * 35828602
*         BE ENTERED.                                                 * 35830602
*********************************************************************** 35833302
STAE0000 EQU   *                  START OF ESTAE EXIT ROUTINE    Y02653 35850002
         BALR  R12,R0             GET THIS ADDRESS               Y01043 35900002
         LA    R15,STAE0000-WAIT00                                     *35950002
                                  DIFFERENCE FROM BEGINNING      Y02653 36000002
         SR    R12,R15            SET BASE TO BEGINNING          Y01043 36050002
         C     R0,TWELVE          STAE WORKAREA PASSED?          Y02653 36100002
         BE    STAE0005           NO, REQUIRED INFO IN REGISTERS Y02653 36150002
         LR    R11,R1             SET ESTAE PARMAREA ADDRESS     Y02653 36200002
         USING SDWA,R11           BASE FOR ABEND WORKAREA        Y02653 36250002
         USING PARMAREA,R2        SET BASE TO PARMAREA           Y02653 36300002
         L     R2,SDWAPARM        ADDRESS OF PARMAREA            Y02653 36350002
         L     R1,SDWAABCC        GET ABEND CODE                 Y02653 36400002
         ST    R2,SDWASR01        PASS PARM ADDRESS PAST ASIR    Y02653 36450002
         TM    SDWAERRC,SDWAPERC  IS IT PERCOLATION?             Y02653 36610002
         BO    STAE0010           YES, BYPASS DUMP INDICATOR     Y02653 36620002
         TM    SDWAERRA,SDWAMCHK  IS FAILURE A MACHINE CHECK?  @YM3505P 36630002
         BO    STAE0010           YES, BYPASS INDICATING DUMP  @YM3505P 36640002
STAE0005 EQU   *                                                 Y02653 36650002
         OI    INDCATOR,BDUMP     INDICATE DUMP REQUIRED         Y02653 36700002
         DROP  R11                RELEASE SDWA BASE              Y02653 36750002
STAE0010 EQU   *                                                 Y02653 36800002
         OI    INDCATOR,BABND     INDICATE ABEND CODE SUPPLIED   Y02653 36850002
         ST    R1,PABEND          STORE ABEND CODE IN AREA       Y02653 36900002
         ST    R12,PASSER2        PASS BASE ADDRES PAST ASIR     Y02653 36950002
         C     R0,TWELVE          WAS WORK AREA PASSED?          Y02653 37000002
         BE    STAE0013           NO, DO QUICK RETRY             Y02653 37050002
         LR    R1,R11             SET SDWA ADDRESS FOR EXIT      Y02653 37100002
         SETRP RETADDR=STAE0015,RECORD=YES,RETREGS=YES,                *37150002
               RECPARM=LRECINF,RC=4,FRESDWA=YES,DUMP=NO        @YM3507P 37200002
         BR    R14                RETURN TO ASIR                 Y02653 37250002
STAE0013 EQU   *                                                 Y02653 37300002
         LA    R0,STAE0015        SET RETRY ADDRESS              Y02653 37350002
         LA    R15,D4             INDICATE RETRY                 Y02653 37400002
         BR    R14                RETURN TO ASIR                 Y02653 37450002
         EJECT                                                          37470002
STAE0015 EQU   *                  ESTAE RETRY POINT              Y02653 37500002
         LR    R2,R1              SET PARMAREA ADDRESS           Y02653 37550002
         L     R12,PASSER2        SET BASE REGISTER              Y02653 37600002
         L     R6,PASSER1         ADDRESS OF WORKER              Y02653 37650002
         LTR   R6,R6              WAS WORKER GOTTEN BEFORE ABEND?Y02653 37700002
         BZ    STAE0030           NO, THEN BYPASS THE DEQ        Y02653 37750002
         USING WORKER,R6          BASE THE WORKER                Y02653 37800002
         LA    R1,DEQLIST         ADDRESS OF DEQ LIST            Y02653 37850002
         DEQ   MF=(E,(1))         RELEASE THE CSCB CHAIN         Y02653 37900002
         DROP  R6                 RELEASE BASE FOR WORKER        Y02653 37950002
         B     STAE0030           GO TO COMMON CODE              Y02653 38000002
STAE0020 EQU   *                                                 Y02653 38050002
STAE0030 EQU   *                                                 Y02653 38150002
         LH    R4,PROSCDE         GET RECURSION CODE             Y01043 38200002
         L     R5,CVTPTR          ADDRESS OF CVT                 Y01043 38250002
         USING CVTSECT,R5         BASE CVT                       Y01043 38300002
         L     R5,CVTMSER         ADDRESS OF MASTER DATA AREA    Y01043 38350002
         DROP  R5                 RELEASE BASE FOR CVT           Y02653 38400002
         USING BASE,R5            BASE MASTER DATA AREA          Y01043 38450002
         TM    BASPBYTE,BAMSSTAR  ABEND OUT OF STAE?             Y01043 38500002
         BO    STAE0215           YES, TEST FOR TRACE OFF      @ZA29984 38600000
         B     STAE0040(R4)       START STAE PROCESSING          Y02653 38650002
STAE0040 EQU   *                                                 Y02653 38700002
         B     STAE0045           TEST FOR PSA PAGEFREE          Y02669 38720002
         B     STAE0050           DUMP SYSTEM                    Y02653 38750002
         B     STAE0070           INFORM OPERATOR                Y02653 38800002
         B     STAE0140           CLEAN UP CHAINS                Y02653 38850002
         B     STAE0160           GO RETRY                       Y02653 38900002
         B     STAE0220           KILL SYSTEM                    Y02653 38950002
         EJECT                                                          38955002
*********************************************************************** 38960002
*                                                                     * 38965002
*        THE FOLLOWING WILL TEST FOR THE PSA-TRACE TABLE 'IN PROCESS' * 38970002
*        BIT AND IF IT IS ON, DO A 'PAGEFREE' BEFORE DOING FURTHER    * 38975002
*        RECOVERY PROCEDURES.                                         * 38980002
*                                                                     * 38985002
*********************************************************************** 38990002
STAE0045 EQU   *                                                 Y02669 38995002
         LH    R4,PROSCDE         GET CURRENT PROCESSING CODE    Y02669 39006002
         LA    R4,D4(R4)          BUMP PROCESSING CODE           Y02669 39012002
         STH   R4,PROSCDE         STORE IN PARAMETER AREA        Y02669 39018002
         TM    INDCATOR,BTRACE    TRACE TABLE BIT ON?            Y02669 39024002
         BNO   STAE0050           NO, NOT AN ABEND FROM PSA      Y02669 39030002
         PGFREE R,A=STARTFIX,EA=ENDFIX                           Y02669 39036002
         EJECT                                                          39042002
**************************************************************** Y02653 39050002
*                                                              * Y02653 39100002
*        THE FOLLOWING WILL DETERMINE IF A DUMP IS NECESSARY.  * Y02653 39150002
*        IF ENTERED BECAUSE OF PERCOLATION FROM A LOWER LEVEL  * Y02653 39200002
*        ESTAE EXIT, A DUMP WILL NOT BE TAKEN.                 * Y02653 39250002
*        NOTE:  IF EXECUTION OF THIS CODE HAS PREVIOUSLY BEEN  * Y02653 39310002
*        ATTEMPTED FOR THE CURRENT MAINLINE FAILURE, IT WILL   * Y02653 39320002
*        BE BYPASSED.                                          * Y02653 39330002
*                                                              * Y02653 39350002
**************************************************************** Y02653 39400002
STAE0050 EQU   *                                                 Y02653 39450002
         LH    R4,PROSCDE         GET CURRENT PROCESSING CODE    Y02669 39470002
         LA    R4,D4(R4)          BUMP PROCESS CODE              Y02653 39500002
         STH   R4,PROSCDE         PUT IN PARAMETER AREA          Y01043 39560002
         TM    INDCATOR,BDUMP     DUMP REQUIRED?                 Y02653 39620002
         BNO   STAE0070           NO, BYPASS DUMP                Y02653 39680002
         MVC   MSGAREA(DUMPL),DUMPPARM                                 *39750002
                                  MOVE IN LIST FORM OF DUMP      Y02653 39800002
         LA    R1,MSGAREA         ADDRESS OF LIST FORM           Y01043 39850002
         SDUMP MF=(E,(1))         TAKE DUMP                      Y01043 39900002
         LR    R10,R15            SAVE RETURN CODE               Y01043 39950002
         B     STAE0080           INFORM OPERATOR                Y02653 40000002
         EJECT                                                          40010002
*********************************************************************** 40020002
*        THE FOLLOWING CODE WILL FORMAT AND ISSUE THE MESSAGE         * 40030002
*        DESCRIBING THE FAILURE.                                      * 40040002
*        NOTE:  IF EXECUTION OF THIS CODE HAS PREVIOUSLY BEEN         * 40042002
*        ATTEMPTED FOR THE CURRENT MAINLINE FAILURE, IT WILL          * 40044002
*        BE BYPASSED.                                                 * 40046002
*********************************************************************** 40048002
         SPACE 2                                                        40048402
STAE0070 EQU   *                  RECURSIVE ABEND MESSAGE ENTRY  Y02653 40050002
         LA    R10,D4             INDICATE DUMP NOT TAKEN        Y02653 40100002
STAE0080 EQU   *                  NORMAL MESSAGE ENTRY           Y02653 40150002
         LH    R4,PROSCDE         GET CURRENT PROCESSING CODE    Y02669 40170002
         LA    R4,D4(R4)          INDICATE MESSAGE ATTEMPTED     Y01043 40200002
         STH   R4,PROSCDE         RETURN TO AREA                 Y01043 40250002
         TM    INDCATOR,BABND     IS THERE AN ABEND CODE?        Y02653 40300002
         BO    STAE0090           YES, SET ABEND MESSAGE         Y02653 40350002
         MVC   MSGAREA(MSGLEN12),ABMSG1                          Y02653*40400002
                                  MOVE IN FAILED MESSAGE         Y02653 40450002
         B     STAE0100           CONTINUE CONSTRUCTION          Y01043 40500002
STAE0090 EQU   *                                                 Y02653 40550002
         L     R9,PABEND          PICK UP ABEND CODE             Y02653 40600002
         MVC   MSGAREA(MSGLEN5),ABMSG                                  *40650002
                                  MOVE IN BASE ABEND MESSAGE     Y02653 40700002
         N     R9,MASK1           TURN OFF DUMP BIT              Y01043 40750002
         SRL   R9,D12             SHIFT TO LOW ORDER BYTES       Y01043 40800002
         STH   R9,CODE            PUT IT IN WORKAREA             Y01043 40850002
         UNPK  ABEND1(D5),CODE(D3)                                     *40900002
                                  UNPACK FOR TRANSLATE           Y02653 40950002
         TR    ABEND2(D3),TABLE   TRANSLATE FOR PRINT            Y01043 41000002
         MVI   ABEND1,BLNK        BLANK FIRST PART               Y01043 41050002
         MVI   ABEND5,COMA        ADD COMMA TO END               Y01043 41100002
STAE0100 EQU   *                                                 Y02653 41150002
         LA    R5,MSGAREA         ADDRESS OF MESSAGE START       Y01043 41200002
         LR    R6,R5              ADDRESS OF MESSAGE START       Y01043 41250002
         AH    R6,MSGLEN          BUMP TO NEXT POSITION IN BUFFERY01043 41300002
         LTR   R10,R10            DUMP SUCCESSFUL?               Y01043 41350002
         BNZ   STAE0110           NO, BYPASS DUMPED PART         Y02653 41400002
         MVC   D0(MSGLEN0,R6),INCERT0                                  *41450002
                                  MOVE IN GOODDUMP MESSAGE       Y02653 41500002
         LA    R6,MSGLEN0(R6)     BUMP TO NEXT POSITION IN BUFFERY01043 41550002
STAE0110 EQU   *                                                 Y02653 41600002
         TM    INDCATOR,BFAIL     IS THIS A BRANCH ENTRY?        Y02653 41650002
         BNO   STAE0120           NO, INDICATE RESTARTING        Y02653 41700002
         MVC   D0(MSGLEN9,R6),INCERT5                                  *41750002
                                  SET UP REIPL PART OF MESSAGE   Y02653 41800002
         LA    R6,MSGLEN9(R6)     BUMP TO END OF BUFFER          Y01043 41850002
         MVC   D0(D4,R6),RETCDE1  MOVE IN ROUTING CODES          Y02653 41900002
         B     STAE0135           CONTINUE                       Y02653 41950002
         EJECT                                                          41970002
STAE0120 EQU   *                                                 Y02653 42000002
         MVC   D0(MSGLEN4,R6),INCERT4                                  *42050002
                                  SET UP LAST PART OF MESSAGE    Y01043 42100002
         LA    R6,MSGLEN4(R6)     BUMP TO END OF BUFFER          Y01043 42160002
         MVC   D0(D4,R6),RETCDE   MOVE IN ROUTING CODES          Y01043 42220002
STAE0135 EQU   *                                                 Y02653 42300002
         SR    R6,R5              CALCULATE LENGTH OF MESSAGE    Y01043 42350002
         STH   R6,MSGLEN          PUT LENGTH IN MESSAGE          Y01043 42400002
         LA    R1,MSGAREA         ADDRESS OF MESSAGE             Y01043 42450002
         WTO   MF=(E,(1))         PUT OUT MESSAGE                Y01043 42500002
         EJECT                                                          42550002
**************************************************************** Y02653 42600002
*                                                                Y02653 42650002
*        THE FOLLOWING WILL VERIFY THE VALIDITY OF THE CSCB      Y02653 42700002
*        CHAIN.  THE ADDRESS OF EACH CSCB IS CHECKED TO SEE IF   Y02653 42710002
*        IT IS WITHIN THE BOUNDS OF SQA AND ON A DOUBLE WORD     Y02653 42740002
*        BOUNDARY.                                               Y02653 42770002
*                                                                Y02653 42802002
*        BRANCH ENTRY IS POSSIBLE ONLY ON FAILURE TO OBTAIN      Y02653 42803002
*        AN ESTAE ENVIRONMENT.  SINCE FAILURE AT THAT TIME COULD Y02653 42804002
*        NOT HAVE BEEN INDUCED BY AN INVALID CSCB CHAIN, THE     Y02653 42805002
*        CHAIN SCAN IS BYPASSED.                                 Y02653 42806002
*                                                                Y02653 42807002
*        NOTE:  IF EXECUTION OF THIS CODE HAS PREVIOUSLY BEEN    Y02653 42810002
*        ATTEMPTED FOR THE CURRENT MAINLINE FAILURE, IT WILL     Y02653 42820002
*        BE BYPASSED.                                            Y02653 42830002
*                                                                Y02653 42840002
**************************************************************** Y02653 42900002
STAE0140 EQU   *                                                 Y02653 42950002
         LH    R4,PROSCDE         GET CURRENT PROCESSING CODE    Y02669 42970002
         LA    R4,D4(R4)          INDICATE SCAN ATTEMPTED        Y01043 43000002
         STH   R4,PROSCDE         PUT IT IN AREA                 Y01043 43050002
         TM    INDCATOR,BFAIL     BRANCH ENTRY ?                 Y02653 43100002
         BO    STAE0240           YES WAIT, NO CSCB'S TO CHECK   Y02653 43150002
         L     R8,PASSER1         ADDRESS OF THE WORKER          Y02653 43200002
         LTR   R8,R8               WAS WORKER OBTAINED?        @YM3527P 43210002
         BZ    STAE0160            NO - ATTEMPT NEXT FUNCTION  @YM3527P 43220002
         USING WORKER,R8          BASE THE WORKER FOR ENQ/DEQ    Y02653 43250002
         MVC   ENQLIST(ENQLEN),LISTENQ                                 *43300002
                                  SET UP THE LIST FORM OF ENQ    Y02653 43350002
         LA    R1,ENQLIST         SET ADDRESS OF ENQ LIST        Y02653 43400002
         ENQ   (,,E,,),MF=(E,(1)) ENQ EXCLUSIVE ON CSCB CHAIN    Y02653 43410002
         L     R4,CVTPTR          ADDRESS OF CVT                 Y02653 43500002
         USING CVTSECT,R4         BASE THE CVT                   Y02653 43550002
         L     R7,CVTGDA          OBTAIN THE GDA ADDRESS         Y02653 43600002
         L     R4,CVTMSER         ADDRESS OF MASTER DATA AREA    Y02653 43650002
         DROP  R4                 RELEASE BASE ADDRESS           Y02653 43700002
         USING GDA,R7             BASE THE GDA                   Y02653 43750002
         L     R7,SQASPQEP        OBTAIN THE SPQE ADDRESS        Y02653 43770002
         USING SPQESECT,R7        BASE THE SPQE                  Y02653 43790002
         L     R7,SPDQEPTR        OBTAIN THE DQE ADDRESS         Y02653 43810002
         USING DQESECT,R7         BASE THE DQE                   Y02653 43830002
         EJECT                                                          43890002
STAE0150 EQU   *                                                 Y02653 43900002
         L     R3,DQELNTH         GET LENGTH OF SQA              Y02653 43950002
         L     R6,DQEBLKAD        GET START OF SQA               Y02653 43980002
         LA    R6,D0(R6)          CLEAR THE HIGH ORDER BYTE      Y02653 44010002
         LR    R10,R7             SAVE BASE DQE ADDRESS          Y02653 44050002
         ST    R6,LOW             SET START OF SQA               Y02653 44150002
         AR    R6,R3              FIND END OF SQA                Y02653 44180002
         ST    R6,HIGH            SET END OF SQA                 Y02653 44210002
         USING CHN,R5             BASE THE CSCB                  Y02653 44240002
         L     R5,D0(R4)          ADDRESS OF CSCB TO CHECK       Y01043 44300002
         LA    R5,D0(R5)          ZERO HIGH ORDER BYTE           Y01043 44350002
         LTR   R5,R5              END OF CSCB CHAIN?             Y01043 44400002
         BZ    STAE0160           YES, DO NEXT FUNCTION          Y02653 44450002
STAE0155 EQU   *                                                 Y02653 44500002
         C     R5,LOW             IS IT ABOVE SQA LOW ADDRESS?   Y01043 44550002
         BL    STAE0158           NO, CHECK NEXT DQE             Y02653 44600002
         C     R5,HIGH            IS IT BELOW SQA HIGH ADDRESS?  Y01043 44650002
         BNL   STAE0158           NO, CHECK NEXT DQE             Y02653 44700002
         LR    R0,R5              PUT ADDRESS IN WORK REGISTER   Y02653 44750002
         SLL   R0,D29             SHIFT OUT UNWANTED BITS        Y02653 44800002
         LTR   R0,R0              ON DOUBLE WORD BOUNDRY?        Y02653 44850002
         BNZ   STAE0210           NO, CHOP OFF CHAIN             Y02653 44900002
         LR    R4,R5              PICK UP NEXT CSCB              Y02653 44950002
         B     STAE0150           GO AND CHECK NEXT CSCB         Y02653 45000002
STAE0158 EQU   *                                                 Y02653 45050002
         DROP  R7                                                Y02653 45060002
         USING DQESECT,R10        ESTABLISH DQE ADDRESSABILITY   Y02653 45100002
         L     R10,DQEPTR         GET ADDRESS OF NEXT DQE        Y02653 45140002
         LA    R10,D0(R10)        ZERO OUT THE HIGH ORDER BYTE   Y02653 45180002
         LTR   R10,R10            ANY MORE SQA DQE'S?            Y02653 45220002
         BZ    STAE0210           NO, ERROR CONDITION            Y02653 45260002
         L     R3,DQELNTH         GET LENGTH OF SQA SEGMENT      Y02653 45300002
         L     R6,DQEBLKAD        GET START OF SQA SEGMENT       Y02653 45340002
         LA    R6,D0(R6)          ZERO OUT THE HIGH ORDER BYTE   Y02653 45380002
         ST    R6,LOW             SET END OF LSQA                Y02653 45420002
         AR    R6,R3              FIND HIGH ADDRESS OF SQA       Y02653 45460002
         ST    R6,HIGH            SET HIGH ADDRESS OF SQA        Y02653 45500002
         B     STAE0155                                          Y02653 45600002
         EJECT                                                          45650002
*********************************************************************** 45700002
*                                                                Y02653 45750002
*        THIS CODE WILL DEQ OFF THE CSCB CHAIN RESOURCE AND      Y02653 45760002
*        INITIALIZE THE REGISTERS REQUIRED TO RESTART THE        Y02653 45770002
*        MASTER.  AFTER INDICATING THAT A RESTART IS IN PROCESS, Y02653 45780002
*        IT BRANCHES BACK TO THE MAINLINE.                       Y02653 45790002
*                                                                Y02653 46000002
*********************************************************************** 46050002
STAE0160 EQU   *                                                 Y02653 46100002
         LH    R4,PROSCDE         GET THE RECURSION INDICATOR    Y02653 46150002
         LA    R4,D4(R4)          INDICATE RETRY ATTEMPTED       Y02653 46200002
         STH   R4,PROSCDE         PUT IT IN AREA                 Y02653 46250002
         L     R8,PASSER1          SET ADDRESS OF WORKER       @YM3527P 46260002
         LTR   R8,R8               WAS WORKER OBTAINED         @YM3527P 46270002
         BZ    STAE0165            NO - SKIP DEQ               @YM3527P 46280002
         MVC   DEQLIST(DEQLEN),LISTDEQ                                 *46300002
                                  SET UP THE LIST FORM OF DEQ    Y02653 46350002
         LA    R1,DEQLIST         SET ADDRESS OF DEQ LIST        Y02653 46400002
         DEQ   MF=(E,(1))         DEQ OFF THE CSCB CHAIN         Y02653 46450002
STAE0165 EQU   *                                               @YM3527P 46500002
         L     R3,PASSER          SET ADDRESS OF ATTACH AREA     Y02653 46550002
         L     R7,CVTPTR          GET THE ADDRESS OF THE CVT     Y02653 46650002
         USING CVTSECT,R7         BASE THE CVT                   Y02653 46700002
         L     R9,CVTMSER         SET ADDRESS OF BASEA           Y02653 46750002
         USING BASE,R9            BASEA ADDRESSIBILITY           Y02653 46810002
         OI    BASPBYTE,BAMSSTAR  INDICATE ESTAE RESTART         Y02653 46820002
         LR    R4,R2              SET PARMAREA ADDRESS           Y02653 46850002
         LR    R10,R4             SAVE PARMAREA ADDRESS        @YM02665 46855002
         TM    INDCATOR,BTRACE    TRACE TABLE ABEND OR SUBSYS-   Y02669*46860002
                                  TEM INITIALIZATION FAILURE?  @Y02669P 46865002
         BNO   WAIT0020           NO, RESTART MASTER SCHEDULER   Y02669 46870002
         B     WAIT0060           RETRY TRACE TABLE ONCE AGAIN   Y02669 46900002
         DROP  R7                 RELEASE CVT BASE               Y02669 46960002
         DROP  R9                 RELEASE BASEA BASE             Y02669 47020002
         EJECT                                                          47100002
**********************************************************************  47150002
*                                                                Y02653 47200002
*        THIS CODE WILL TRUNCATE THE CSCB CHAIN AND INFORM       Y02653 47250002
*        THE OPERATOR VIA MESSAGE IEE513I THAT THE CHAIN WAS     Y02653 47300002
*        TRUNCATED.                                              Y02653 47350002
*                                                                Y02653 47400002
*********************************************************************** 47450002
STAE0210 EQU   *                                                 Y02653 47500002
         SR    R10,R10            ZERO REGISTER FOR CHOP         Y02653 47550002
         ST    R10,D0(R4)         CHOP OFF CSCB CHAIN            Y01043 47600002
         MVC   DEQLIST(DEQLEN),LISTDEQ                                 *47650002
                                  SET UP THE LIST FORM OF DEQ    Y02653 47700002
         LA    R1,DEQLIST         SET ADDRESS OF DEQ LIST        Y02653 47750002
         DEQ   MF=(E,(1))         DEQ OFF THE CSCB CHAIN         Y02653 47800002
         MVC   MSGAREA(MSGLEN6),CSCBCHOP                               *47850002
                                  MOVE MESSAGE TO BUFFER         Y02653 47900002
         LA    R1,MSGAREA         ADDRESS OF BUFFER              Y02653 47950002
         WTO   MF=(E,(1))         PUT OUT MESSAGE                Y02653 48000002
         B     STAE0160           END CHAIN SCAN                 Y02653 48050002
         EJECT                                                          48100002
*********************************************************************** 48104000
*                                                             @ZA29984* 48104800
*        THIS CODE IS EXECUTED FOR ABEND RECURSIONS. IF TRACE @ZA29984* 48105600
*        PROCESSING IS COMPLETED, THE ABEND PATH WILL BE      @ZA29984* 48106400
*        CONTINUED. OTHERWISE, SET UP TO ATTEMPT RE-TRY AT    @ZA29984* 48107200
*        SYSTEM LOG INITIALIZATION.                           @ZA29984* 48108000
*                                                             @ZA29984* 48108800
*********************************************************************** 48109600
STAE0215 EQU   *                                               @ZA29984 48110400
         USING BASE,R5            SET MSRDA ADDRESSIBILITY     @ZA29984 48110800
         TM    INDCATOR,BTRACE    TRACE PROCESS COMPLETE       @ZA29984 48111200
         BNO   STAE0220           YES, CONTINUE TERMINATION    @ZA29984 48112000
         NI    BASPBYTE,XFF-BAMSSTAR                           @ZA29984 48112800
*                                 TURN OFF STAE RECURSION BIT  @ZA29984 48113600
         DROP  R5                                              @ZA29984 48114400
         NI    INDCATOR,XFF-BTRACE                             @ZA29984 48115400
*                                 TURN OFF TRACE TABLE BIT     @ZA29984 48116400
         PGFREE R,A=STARTFIX,EA=ENDFIX FREE FIXED PAGE         @ZA29984 48120000
         L     R3,PASSER          GET ATTACH LIST AREA         @ZA29984 48124000
         LR    R8,R6              SET UP WORKER REG            @ZA29984 48128000
         LR    R6,R2              SET PARMAREA ADDRESSIBILITY  @ZA29984 48132000
         LR    R9,R5              SET MSRDA BASE REG.          @ZA29984 48136000
         LR    R11,R2             PARMAREA ADDRESS             @ZA29984 48140000
         B     WAIT0069           CONTINUE SUBSYSTEM INIT.     @ZA29984 48144000
         EJECT                                                          48147000
*********************************************************************** 48150002
*                                                                Y02653 48200002
*        THIS CODE WILL INFORM THE OPERATOR OF A RECURSIVE       Y02653 48250002
*        ABEND CONDITION.  IT WILL ALSO INDICATE TO THE          Y02653 48300002
*        OPERATOR THAT THE MASTER SCHEDULER COULD NOT BE         Y02653 48350002
*        RESTARTED.  UPON COMPLETION OF THIS PROCESS, IT         Y02653 48400002
*        WILL PUT THE ABENDED TASK INTO A HARD WAIT.             Y02653 48450002
*                                                                Y02653 48500002
*********************************************************************** 48550002
STAE0220 EQU   *                                                 Y02653 48600002
         MVC   MSGAREA(MSGLEN8),KILLMSG                                *48650002
                                  MOVE KILL MSG TO BUFFER        Y02653 48700002
         LA    R1,MSGAREA         ADDRESS OF BUFFER              Y01043 48750002
         WTO   MF=(E,(1))         PUT OUT MESSAGE                Y01043 48800002
STAE0240 EQU   *                                                        48810002
         XC    MSGAREA(D4),MSGAREA CLEAR ECB                     Y02653 48820002
         LA    R1,MSGAREA         ADDRESS OF THE WORK AREA       Y02653 48850002
         WAIT  ECB=(1)            PUT THE SYSTEM INTO WAIT       Y02653 48900002
         DROP  R2                 RELEASE BASE FOR PARM AREA     Y02653 48950002
         DROP  R8                 RELEASE BASE FOR THE WORKER    Y02653 49050002
         EJECT                                                          49100002
*********************************************************************** 49150002
*                                                                     * 49200002
*        CONSTANTS FOR STAE                                           * 49250002
*                                                                     * 49300002
*********************************************************************** 49350002
         SPACE                                                          49400002
         DS    0F                                                Y02653 49450002
TWELVE   DC    F'12'              ESTAE WORKAREA TESTER          Y02653 49500002
RETCDE   DC    X'10004040'        MESSAGE ROUTING CODES          Y01043 49550002
RETCDE1  DC    X'80004040'        MESSAGE ROUTING CODES          Y02653 49600002
MASK1    DC    X'7FFFFFFF'        AND MASK                       Y01043 49650002
PARMAR   DC    AL1(253)           SP/SIZE OF PARMAREA            Y02669 49700002
         DC    AL3(ENDAREA-STRTAREA)                             Y02669 49720002
LRECINF  DC    CL8'IEEVWAIT'      MODULE NAME FOR LOGREC         Y02653 49750002
         DC    CL8'IEEVWAIT'      CSECT NAME FOR LOGREC          Y02653 49800002
         DC    CL8'        '      PADDING FOR LOGREC WRITE       Y02653 49850002
TABLE    EQU   *-240              TRANSLATE TABLE                Y01043 49900002
         DC    C'0123456789ABCDEF'                               Y01043 49920043
         EJECT                                                          50000002
*********************************************************************** 50050002
*                                                                     * 50100002
*        MESSAGES FOR STAE                                            * 50150002
*                                                                     * 50200002
*********************************************************************** 50250002
         SPACE                                                          50300002
         DS    0F                                                Y01043 50350002
STRT0    EQU   *                                                 Y01043 50400002
INCERT0  DC    C' DUMPED,'        SUCESSFUL DUMP MESSAGE         Y01043 50450002
END0     EQU   *                                                 Y01043 50500002
STRT4    EQU   *                                                 Y01043 50550002
INCERT4  DC    C' RESTARTING'     INDICATE RESTART               Y02653 50600002
END4     EQU   *                                                 Y01043 50650002
STRT9    EQU   *                                                 Y01043 50700002
INCERT5  DC    C' REIPL'          INDCIATE REIPL REQUIRED        Y01043 50750002
END9     EQU   *                                                 Y01043 50800002
         DS    0F                                                Y01043 50850002
         EJECT                                                          50870002
STRT5    EQU   *                                                 Y01043 50900002
ABMSG    WTO   'IEE481I MASTER SCHEDULER ABEND     ',                  *50950002
               MF=L,ROUTCDE=(2,10),DESC=(4)                      Y01043 51000002
END5     EQU   *                                                 Y01043 51050002
         DS    0F                                                Y01043 51100002
STRT12   EQU   *                                                 Y01043 51150002
ABMSG1   WTO   'IEE479W MASTER SCHEDULER FAILED,',                     *51200002
               MF=L,ROUTCDE=(2,10),DESC=(1)                      Y01043 51250002
END12    EQU   *                                                 Y01043 51300002
         DS    0F                                                Y01043 51350002
STRT6    EQU   *                                                 Y01043 51400002
CSCBCHOP WTO   'IEE513I COMMAND PROCESSING LIMITED',                   *51450002
               MF=L,ROUTCDE=(2,10),DESC=(4)                      Y01043 51500002
END6     EQU   *                                                 Y01043 51550002
         DS    0F                                                Y01043 51600002
STRT8    EQU   *                                                 Y01043 51650002
KILLMSG  WTO   'IEE482E MASTER SCHEDULER RESTART FAILED, ABEND RECURSIO*51700002
               N, REIPL',MF=L,ROUTCDE=(2,10),DESC=(1)            Y02653 51750002
END8     EQU   *                                                 Y02653 51800002
         DS    0F                                              @ZA29984 51810000
VPATCH   DC    5CL25'** IEEVWAIT PATCH AREA**'                @ZA29984  51820000
         EJECT                                                          51850002
*********************************************************************** 51900002
*                                                                     * 51950002
*        MACRO LIST FORMS FOR STAE                                    * 52000002
*                                                                     * 52050002
*********************************************************************** 52100002
         DS    0F                                                Y01043 52150002
STRT10   EQU   *                                                 Y01043 52200002
LSTAE    ESTAE  MF=L                                             Y02669 52250002
END10    EQU   *                                                 Y01043 52300002
STRT11   EQU   *                                                 Y01043 52350002
DUMPPARM SDUMP HDR='IEEVWAIT',SDATA=(SQA,PSA,NUC,LSQA,RGN,LPA,TRT,CSA),*52400002
               MF=L    DUMP OPTIONS FOR STAE DUMP              @YM3522P 52450002
END11    EQU   *                                                 Y01043 52500002
         EJECT                                                          52550002
*********************************************************************** 52600002
*                                                                     * 52650002
*        LENGTH EQUATES                                               * 52700002
*                                                                     * 52750002
*********************************************************************** 52800002
         SPACE                                                          52850002
MSGLEN0  EQU   END0-STRT0                                        Y01043 52900002
MSGLEN4  EQU   END4-STRT4                                        Y01043 52950002
MSGLEN5  EQU   END5-STRT5                                        Y01043 53000002
MSGLEN6  EQU   END6-STRT6                                        Y01043 53050002
MSGLEN8  EQU   END8-STRT8                                        Y01043 53100002
MSGLEN9  EQU   END9-STRT9                                        Y01043 53150002
MSGLEN12 EQU   END12-STRT12                                      Y01043 53200002
STAEL    EQU   END10-STRT10                                      Y01043 53250002
DUMPL    EQU   END11-STRT11                                      Y01043 53300002
ENQLEN   EQU   ENQEND-ENQST       LENGTH OF ENQ LIST             Y02669 53350002
DEQLEN   EQU   DEQEND-DEQST       LENGTH OF DEQ LIST             Y02669 53400002
ATCHLEN  EQU   ATCHEND-ATCHST     LENGTH OF ATCH LIST            Y02669 53450002
WORKSIZ  EQU   ENQLEN*2+DEQLEN+ATCHLEN+D8+STAEL                  Y02669 53500002
         EJECT                                                          53550002
*********************************************************************** 53600002
*                                                                     * 53650002
*        DSECT FOR STAE WORKAREA                                      * 53700002
*                                                                     * 53750002
*********************************************************************** 53800002
         SPACE                                                          53850002
PARMAREA DSECT                                                   Y01043 53900002
STRTAREA EQU   *                  PARMAREA STARTING ADDRESS      Y02669 53905002
LOCKSAV  DC    5F'0'              SETLOCK 5 WORD SAVEAREA        Y02669 53910002
FIXECB   DC    F'0'               ECB FOR PAGEFIX                Y02669 53920002
PROSCDE  DS    H                  STAE RECURSION INDICATOR       Y01043 53950002
INDCATOR DS    C                  INDICATOR BYTE                 Y02653 54000002
BFAIL    EQU   X'80'              INDICATES FAILURE ENTRY        Y02653 54050002
BABND    EQU   X'40'              INDICATES ABEND CODE PRESENT   Y02653 54100002
BDUMP    EQU   X'20'              INDICATES DUMP REQUIRED        Y02653 54150002
BTRACE   EQU   X'10'              INDICATES TRACE TABLE          Y02669*54160002
                                      PROCESSING                 Y02669 54170002
MSFLAGS  DS    C                  M/S FLAGS                    @YM3467P 54200002
MSSUBUP  EQU   X'80'              SUBSYSTEM ALREADY UP         @YM3467P 54220002
PASSER   DS    F                  AREA FOR VWAIT WORK ADDRESS    Y01043 54250002
PASSER1  DS    F                  ADDRESS OF WORKER              Y02653 54300002
PASSER2  DS    F                  ROUTINE BASE ADDRESS           Y02653 54350002
PABEND   DS    F                  ABEND CODE IF SUPPLIED         Y02653 54400002
MSGAREA  DS    0F                 MESSAGE BUFFER                 Y01043 54450002
MSGLEN   DS    H                  LENGTH OF MESSAGE              Y01043 54500002
MSGFLG   DS    H                  WTO FLAGS                      Y01043 54550002
         DS    CL30               FIRST PART OF MESSAGE          Y01043 54600002
ABEND1   DS    C                  FIRST BYTE OF ABEND CODE       Y01043 54650002
ABEND2   DS    C                  SECCOND BYTE OF ABEND CODE     Y01043 54700002
ABEND3   DS    C                  THIRD BYTE OF ABEND CODE       Y01043 54750002
ABEND4   DS    C                  FOURTH BYTE OF ABEND CODE      Y01043 54800002
ABEND5   DS    C                  LAST BYTE OF ABEND CODE        Y01043 54850002
         DS    CL37               END OF MESSAGE BUFFER          Y01043 54900002
HIGH     DS    F                  HIGH ADDRESS OF SQA            Y01043 54950002
LOW      DS    F                  LOW ADDRESS OF SQA             Y01043 55000002
SVREN    DS    F                  RETURN ADDRESS                 Y01043 55050002
CODE     DS    H                  FOR ABEND CONVERSION           Y02653 55100002
TRACEPTR DS    F                  TRACE TABLE POINTER(LOC54)   @YM3529P 55110002
ENDAREA  EQU   *                  PARMAREA ENDING ADDRESS        Y02669 55120002
         EJECT                                                          55150002
**************************************************************** Y02669 55200002
*                                                                Y02669 55250002
*        DSECT FOR VWAIT WORKER                                  Y02669 55300002
*                                                                Y02669 55350002
**************************************************************** Y02669 55400002
WORKER   DSECT                                                   Y02669 55450002
ENQLIST  ENQ   (MAJOR,MICSCB,E,3,SYSTEM),RET=HAVE,MF=L           Y02669 55500002
DEQLIST  DEQ   (MAJOR,MICSCB,3,SYSTEM),RET=HAVE,MF=L             Y02669 55550002
SENQDEQ  ENQ   (MAJOR,STCMIN,E,6,SYSTEM),RET=HAVE,MF=L           Y02669 55600002
ECBLIST  DS    0F                 ECB LIST ADDRESS               Y02669 55650002
WAITECB  DS    F                  COMMAND PROCESS ECB ADDRESS    Y02669 55700002
SSYSECB  DS    F                  SUBSYSTEM ECB ADDRESS          Y02668 55750002
         EJECT                                                          55770002
ATCHEXP  ATTACH SF=L,SZERO=NO,JSTCB=YES,KEY=0,SM=SUPV,SVAREA=NO  Y02669 55800002
*                                                                Y02669 55810002
STAELIST ESTAE MF=L               ESTAE LIST FORM SPACE          Y02653 55850002
         EJECT                                                          55900002
         IHAGDA                                                         55902002
         EJECT                                                          55910002
         IHASPQE                                                        55914002
         EJECT                                                          55914602
         IHADQE                                                         55926602
         EJECT                                                          55930402
CVTSECT  DSECT                                                   Y01012 55950002
         CVT                                                            56000002
         EJECT                                                          56050002
         IEEBASEA                                                       56100002
         EJECT                                                          56150002
CHN      DSECT                                                          56200002
         IEECHAIN                                                       56250002
         EJECT                                                          56300002
         IHASDWA                                                 Y02669 56350002
         EJECT                                                          56360002
         IHASCVT                                                 Y02669 56370002
         EJECT                                                          56380002
         IHAPSA                                                  Y02669 56390002
         EJECT                                                          56392002
         IHAPCCA                                                 Y02669 56394002
         EJECT                                                          56396002
         IHACSD                                                  Y02669 56396502
         EJECT                                                          56397002
         IHAPCCAT                                                Y02669 56397502
         EJECT                                                          56397602
         IECDIOCM                                                Y02669 56397702
         EJECT                                                          56398002
*****************************************************************       56400002
ATTACHDC DSECT                                                          56450002
PMODID  DS    D                   ATTACH DSECT                          56500002
         END                                                            56550002
