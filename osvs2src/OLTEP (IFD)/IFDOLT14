 TITLE  'IFDOLT14  SCAN, HEADER AND DESCRIPTION LINE SECTIONS'          00200020
****************************** PROLOGUE ******************************* 00400020
*                                                                     * 00600020
*  MODULE NAME: IFDOLT14                                              * 00800002
*                                                                     * 00840002
*  DESCRIPTIVE NAME: SCAN, HEADER AND DESCRIPTION LINES SECTION       * 00880002
*                                                                     * 00920002
*  COPYRIGHT: NONE                                                    * 00960002
*                                                                     * 01000020
*  STATUS: CHANGE LEVEL - 001                                         * 01200001
*                                                                     * 01400020
*  FUNCTION: THIS MODULE IS DESIGNED AS FOLLOWS:                      * 01600020
*                                                                     * 01800020
*            SCAN SECTION                                             * 02000020
*            1) DPRINT OPTIONS CHECKED; ALSO FIRST ERROR AND          * 02200020
*               CATASTROPHIC ERROR CONDITIONS.                        * 02400020
*            2) FORMS CONTROL SETUP                                   * 02600020
*            3) SCAN DPRINT CONTROL WORD AND CALL DPRINT MODULES      * 02800020
*               REQUIRED FOR UNIT TEST ERROR PRINTOUT.                * 03000020
*            4) PRINT FIRST ERROR OR CATASTROPHIC ERROR MESSAGE       * 03200020
*                                                                     * 03400020
*            HEADER, DESCRIPTION SECTION                              * 03600020
*            1) SETUP HEADER LINE FOR PRINT                           * 03800020
*            2) SETUP DESCRIPTION LINES FOR PRINT                     * 04000020
*                                                                     * 04200020
*  ENTRY POINT: IFDOLT14                                              * 04400020
*                                                                     * 04600020
*  INPUTS: DPRINT PARAMETER LISTS                                     * 04800020
*                                                                     * 05000020
*  REGISTER USAGE: R1  - ADDRESS OF DPRINT PARAMETERS                 * 05200020
*                  R2  - ADDRESS OF SECTION CTRL TABLE IN OLTEP ROOT  * 05400020
*                  R3  - BASE REG FOR UNIT TEST SECTION PREFACE       * 05600020
*                  R4  - BASE REG FOR THIS MODULE                     * 05800020
*                  R5-R11 - MISC.                                     * 06000020
*                  R12 - ADDRESS OF DPRINT PARAMETER CTRL WORD        * 06200020
*                  R13 - ADDRESS OF CALLERS SAVE AREA; CONVERT ADDR   * 06400020
*                  R14 - ADDRESS OF CALLERS RETURN PT; CONVERT ADDR   * 06600020
*                  R15 - LINK ADDR; CONVERT COUNT; RETURN CODE        * 06800020
*                                                                     * 07000020
*  EXTERNAL ROUTINES: IFDOLT39- PARALLEL PRINT OUTPUT WRITER          * 07200020
*                                                                     * 07400020
*  EXITS - NORMAL: RETURN TO ENTRY-EXIT SECTION OF IFDOLT39           * 07600020
*           ERROR: NONE                                               * 07800020
*                                                                     * 08000020
*  ATTRIBUTES: SERIALLY REUSABLE                                      * 08200020
*                                                                     * 08400020
* APAR OX01058 SAVE RTN CODES                                  0X01058* 08450002
*********************************************************************** 08600020
*  CHANGE 03/71 - HANDLING OF EP/NEP,FE/NFE,ETC PARAMETERS            * 08630001
*               - CHAIN=YES SUPPORT                                   * 08660001
*               - SPACE BETWEEN OLT DPRINTS                           * 08690001
*               - SYMBOLIC NAME IN HEADER                             * 08720001
*                                                                     * 08724002
*  CHANGE ACTIVITY: AS FOLLOWS                                        * 08728002
*                                                                     * 08732002
*    CLEANUP:                                                   Y02906* 08736002
*      C170000,A170600,D828000                                        * 08740002
*    PTM #05407:                                                YM5407* 08741002
*      A936460                                                        * 08745002
*********************************************************************** 08750001
         EJECT                                                          08800020
IFDOLT14 CSECT                                                          09000020
*A646000                                                         A52641 09060001
*        TO FIX ABEND DUE TO FE OPTION,ERROR DPRINT W/O HEADER        * 09120001
         SPACE                                                          09200020
         USING IFDOLT14,R4         HEADER MODULE BASE REG               09400020
         USING CHASCT,R2                                                09600020
         USING RTN#,R3             BASE REG FOR SECTION PREFACE         09800020
         SPACE                                                          10000020
R1       EQU   1                                                        10200020
R2       EQU   2                                                        10400020
R3       EQU   3                                                        10600020
R4       EQU   4                                                        10800020
R5       EQU   5                                                        11000020
R6       EQU   6                                                        11200020
R7       EQU   7                                                        11400020
R8       EQU   8                                                        11600020
R9       EQU   9                                                        11800020
R10      EQU   10                                                       12000020
R11      EQU   11                                                       12200020
R12      EQU   12                                                       12400020
R13      EQU   13                                                       12600020
R14      EQU   14                                                       12800020
R15      EQU   15                                                       13000020
WTOFLG   EQU   X'01'                                                    13200020
RSTRFLG  EQU   X'80'                                                    13400020
WRTFLG   EQU   X'10'                                                    13600020
NFEFLG   EQU   X'08'                                                    13800020
DPRFLG   EQU   X'40'                                                    14000020
HDRFLG   EQU   X'80'                                                    14200020
FERINT   EQU   X'02'                                                    14400020
NDRFLG   EQU   X'04'                                                    14600020
FFEFLG   EQU   X'20'                                                    14800020
FCEFLG   EQU  X'10'                                                     15000020
PFEMSG   EQU  X'08'                                                     15200020
PCEMSG   EQU  X'04'                                                     15400020
NPROPT   EQU   X'04'                                                    15600020
NEPOPT   EQU   X'04'                                                    15800020
SYMNAME  EQU   X'08'                                                    15860001
SYMBFLG  EQU   X'02'                                                    15920001
         EJECT                                                          16000020
*********************************************************************** 16200020
*        SCAN DPRINT PARAMETERS                                       * 16400020
*********************************************************************** 16600020
         SPACE                                                          16800020
DPR000   SAVE (14,12),,IFDOLT14&SYSDATE                                 17000002
*        ESTABLISH DATE AND SAVE REGS                                   17060002
         SPACE  3                                                       17120002
         LR    R4,R15              LOAD BASE REG                        17200020
         L     R3,SECPTR           BASE REG FOR UNIT TEST SECT PREF.    17400020
         AH    R3,10(R3)           ADD DISPLACEMENT FOR RTN# ADDR       17600020
         LA    R5,SHDSA            ADDRESS OF MODULE REG SAVE AREA      17800020
         ST    R5,8(R13)           STORE IT IN CALLER'S SA              18000020
         ST    R13,4(R5)           STORE ADDR OF CALLER'S SA            18200020
         L     R1,4(R1)            DPRINT PARAMETER ADDRESS       M4506 18400020
         ST    R1,SAVER1           SAVE IT                              18600020
         SPACE                                                          18800020
         XC    DPRTRNCD(4),DPRTRNCD  CLEAR RETURN CODE WORD             19000020
         CLI   1(R1),X'03'         MACRO LEVEL OK?                      19200001
         BNH   DPRSCAN             YES.                                 19400001
         MVI   DPRTRNCD+3,X'04'    NO.  SET RETURN CODE TO 04           19600020
         B     DPR111A             RETURN VIA COMM INTERVAL RTN         19800001
         SPACE                                                          20000020
DPRSCAN  L     R12,4(R1)           DPRINT CONTROL WORD ADDR             20200020
         MVI   PRTBUFR+1,C' '      FILL PRINT BUFFER WITH BLANKS        20400020
         MVC   PRTBUFR+2(120),PRTBUFR+1                                 20600020
         SPACE                                                          20800020
* CHECK DPRINT OPTIONS; FIRST ERROR, CATASTROPHIC ERROR CONDITIONS.     21000020
         SPACE                                                          21200020
DPR100   TM    0(R12),X'02'        ERROR DPRINT REQUESTED               21400001
         BZ    DPR100A             NO.  BRANCH                          21600001
         OI    CHASCT+3,X'C0'      YES. SET TEST ERR, ASTERIK BITS      21800001
DPR100A  TM    CHASCT+3,X'03'      ERROR LOOP OR TEST LOOP REQUESTED    22000001
         BZ    DPR100B             NO.  BR IF BOTH OFF                  22200001
         TM    CHASCT+2,NPROPT     YES. PRINT OPTION ON                 22400001
         BZ    DPR113              NO.  BYPASS PRINT                    22600001
         SPACE                                                          22800001
DPR100B  TM    0(R12),X'02'        ERROR DPRINT REQUESTED               23000001
         BZ    DPR101              NO.  CONTINUE                        23200001
         TM    CHASCT+3,X'20'      YES. CATASTROPHIC ERROR BIT ON       23400001
         BZ    DPR100C             NO.  BRANCH                          23600001
         TM    CESWT5,FCEFLG       YES. FIRST CAT ERROR FLAG ON         23800001
         BNZ   DPR100C             YES. BRANCH                          24000001
         OI    CESWT5,FCEFLG       NO.  SET IT ON                       24200001
         OI    CESWT5,PCEMSG       TURN ON PRINT CAT ERR MSG FLAG       24400001
         SPACE                                                          24600001
DPR100C  TM    CHASCT+2,X'01'      FE COMM OPTION ON                    24800001
         BNZ   DPR100D             YES.  BRANCH                         25000001
         TM    CHASCT+3,NEPOPT     NO.  ERROR PRINT OPTION ON           25200001
         BZ    DPR101              YES. CONTINUE                        25400001
         B     DPR100E             BRANCH                               25500001
DPR100D  TM    CESWT5,FFEFLG       FIRST FE FLAG                        25600001
         BNZ   DPR100E             YES. BRANCH                          25800001
         OI    CESWT5,FFEFLG       NO.  SET IT ON                       26000001
         OI    CESWT5,PFEMSG       TURN ON PRINT FE MSG FLAG            26200001
DPR100E  TM    CHASCT+3,NEPOPT     ERROR PRINT OPTION ON                26400001
         BZ    DPR101              YES. BRANCH                          26600001
         TM    CESWT5,PFEMSG+PCEMSG  NO. PRINT FE OR CAT ERR MSG.       26800001
         BZ    DPR113                                                   27000001
         SPACE                                                          27600020
* FORMS CONTROL SETUP                                                   27800020
         SPACE                                                          28000020
DPR101   SR    R8,R8               CLEAR R8                             28200020
         IC    R8,0(R12)           GET FORMS CONTROL BITS               28400020
         SRL   R8,5                SHIFT BITS                           28600020
         XC    FORMS(2),FORMS      CLEAR                                28800020
         STC   R8,FORMS            STORE FORMS CONTROL                  29000020
         CLI   FORMS,X'05'         RESTORE PAGE ?                       29200020
         BE    DPR110C             YES.                                 29400020
         MVI   PRTBUFR,X'09'       NO. LOAD CTRL CHARC-SPACE 1 LINE     29600020
         SPACE                                                          29800020
* CHECK DPRINT CONTROL WORD FOR ACTIVE PARAMETERS                       30000020
         SPACE                                                          30200020
DPR106   TM    0(R12),X'10'        PRINT HEADER LINE                    30400020
         BZ    DPR107              NO.                                  30600020
         BAL   R14,DPRHDR          YES. HEADER SECTION                  30800020
         B     DPR108              BRANCH TO CHECK RSLTS PRINTOUT       31000020
         SPACE                                                          31200020
* TEST FOR DESCRIPTION LINES PRINT                                      31400020
         SPACE                                                          31600020
DPR107   TM    2(R12),X'80'        PRINT DESCRIPTION LINES              31800020
         BZ    DPR108              NO.                                  32000020
         BAL   R14,DPR030          YES. DESCRIPTION SECTION             32200020
         SPACE                                                          32400001
* TEST FOR RESULTS PRINT                                                32800020
         SPACE                                                          33000020
DPR108   LA    R13,SHDSA           SAVE AREA ADDRESS              M4506 33200020
         TM    2(R12),X'7F'        PRINT RESULTS                  M4506 33400020
         BZ    DPR109              NO PRINT                       M4506 33600020
         B     DPR109A             PRINT                          M4506 33800020
DPR109   TM    3(R12),X'EC'        PRINT DATA, CC                 M4506 34000020
         BZ    DPR110              NO PRINT                       M4506 34200020
DPR109A  BAL   R9,DPRCL15          CALL MODULE ROUTINE            M4506 34400020
         CLI   DPRTRNCD+3,X'00'    ANY RETURN CODE ALREADY SET?         34600001
         BNE   DPR109B             YES.  BYPASS STORE                   34800001
         STC   R15,DPRTRNCD+3      NO.  STORE IT                        35000001
DPR109B  OI    CESWT3,X'08'        SUSPEND DELETION               M4506 35200020
         BAL   R9,DPRCL15          CALL MODULE ROUTINE            M4506 35400020
         B     DPR110                                             M4506 35600020
DPRCL15  IFDMOD CALL='15',LIST=SAVER1                             M4506 35800020
         BCR   15,R9               RETURN                         M4506 36000020
DPRCL17  IFDMOD CALL='17',LIST=SAVER1                             M4506 36200020
         BCR   15,R9               RETURN                       0X01058 36400002
         SPACE                                                          36600001
* TEST FOR MESSAGE LINES PRINT                                          37000020
         SPACE                                                          37200020
DPR110   TM    1(R12),X'01'        PRINT MESSAGES                       37400020
         BZ    DPR110A             NO.                                  37600020
         LA    R13,SHDSA           SAVE AREA ADDRESS                    37800020
         BAL   R9,DPRCL17          CALL MODULE ROUTINE            M4506 38000020
         LTR   R15,R15      IS RET ZERO?                        0X01058 38050002
         BZ    DPRCL17X   IF ZERO DONT SAVE                     0X01058 38060002
         ST    R15,DPRTRNCD        SAVE RETURN CODE              XM0796 38070002
DPRCL17X OI    CESWT3,X'08'        SUSPEND DELETION               M4506 38200002
         BAL   R9,DPRCL17          CALL MODULE ROUTINE            M4506 38400020
         SPACE                                                          38600020
* FORMS CONTROL- SPACE 2, 3 LINES, OR RESTORE PAGE.                     38800020
         SPACE                                                          39000020
DPR110A  CLI   FORMS,X'04'         PRINT RESTORE ?                      39200020
         BE    DPR110C             YES.                                 39400020
         CLI   FORMS,X'02'         NO. SPACE 2 LINES ?                  39600020
         BNE   DPR110B             NO.                                  39800020
         MVI   PRTBUFR,X'09'       YES. LOAD CTRL CHARC FOR 1 LINE      40000020
         B     DPR110D                                                  40200020
DPR110B  CLI   FORMS,X'03'         SPACE 3 LINES ?                      40400020
         BNE   DPR111              NO.                                  40600020
         MVI   PRTBUFR,X'11'       YES. LOAD CTRL CHARC FOR 2 LINES     40800020
         B     DPR110D                                                  41000020
DPR110C  MVI   PRTBUFR,X'8B'       RESTORE PAGR CTRL CHARC              41200020
         OI    CESWT4,RSTRFLG                                           41400020
DPR110D  LA    R13,SHDSA           SAVE AREA ADDRESS                    41600020
         PWRT  SIZE=70             RESTORE PAGE                         41800020
         MVI   PRTBUFR,X'09'       DEFAULT TO SPACE 1 LINE              42000020
         CLI   FORMS,X'05'         RESTORE PAGE OP ?                    42200020
         BE    DPR113              YES. TO EXIT ROUTINE                 42400020
         SPACE 2                                                        42600001
*********************************************************************** 43000020
*        FIRST ERROR, CATASTROPHIC ERROR MESSAGES OUTPUT              * 43200020
*********************************************************************** 43400020
         SPACE                                                          43600020
DPR111   TM    0(R12),X'08'        DPRINT CHAINING REQUESTED            43800001
         BO    DPR113              YES.                                 43860001
         TM    0(R12),X'02'        NO.  IS IT AN ERROR DPRINT     M5076 43862001
         BZ    DPR113              BRANCH IF NO                   M5076 43864001
         TM    CESWT5,PFEMSG+PCEMSG  PRINT FIRST ERR OR CAT ERR MSG?   X43867001
                                                                  21051 43874001
         BZ    DPR113              NO.                            21051 43881001
         TM    0(R12),X'10'        YES. HAS HEADER BEEN PRINTED?  21051 43888001
         BO    DPR111A             YES.                           21051 43895001
         BAL   R9,DPR010           NO. USE HDR RTN TO GET DEVADR, ETC. X43902001
                                                                  21051 43909001
DPR111A  TM    CESWT5,PFEMSG       NO.  PRINT FIRST ERROR MSG           43920001
         BO    DPR117              YES.  GO PRINT IT                    44000020
DPR112   TM    CESWT5,PCEMSG       NO.  PRINT FIRST CAT ERROR MSG       44200020
         BO    DPR118              YES.  GO PRINT IT.                   44400020
         SPACE                                                          44800020
* RETURN TO ENTRY-EXIT ROOT SECTION                                     45000020
         SPACE                                                          45200020
DPR113   L     R13,SHDSA+4         ADDRESS OF CALLER'S SA               45400020
         MVC   16(4,R13),DPRTRNCD  RETURN CODE IN R15 SAVE AREA         45600020
         LM    R14,R12,12(R13)     RESTORE REGS                         45800020
         BR    R14                 RETURN TO ENTRY-EXIT DPRINT ROOT     46000020
         SPACE                                                          46200020
* INITIATE FIRST ERROR COMMUNICATION MESSAGE                            46400020
         SPACE                                                          46600020
DPR117   LA    R1,IFDMSG14         MESSAGE TABLE ADDRESS                46800020
         L     R1,0*4(R1)          GET MESSAGE ADDRESS                  47000020
         L     R7,SECPTR           SECTION PREFACE POINTER              47200020
         MVC   38(8,R1),0(R7)      UNIT TEST ID                         47400020
         SPACE                                                          47600020
         MVC   47(3,R1),RTNNUM+1   ROUTINE NUMBER INTO MSG              47800001
         MVC   56(4,R1),DEVADR     DEVICE ADDR INTO MSG- EBCDIC         48800001
         MVC   61(8,R1),SYMBNM     SYMBOLIC NAME  OR BLANKS             49800001
         SPACE                                                          51000020
         LA    R13,SHDSA           SAVE AREA ADDRESS                    51200020
         PWTO  REG=(1)             WRITE TO OPERATOR MESSAGE            51400020
         B     DPR112              RETURN HERE                          51600020
         SPACE                                                          51800001
* INITIATE CATASTROPHIC ERROR MESSAGE TO OPERATOR                       52400020
         SPACE                                                          52600020
DPR118   LA    R1,IFDMSG14         MESSAGE TABLE ADDRESS                52800001
         L     R1,1*4(R1)          GET MESSAGE ADDRESS                  53200001
         MVC   41(4,R1),DEVADR     DEVICE ADDRESS - EBCDIC              53600001
         MVC   46(8,R1),SYMBNM     SYMBOLIC NAME OR BLANKS              54000001
         SPACE                                                          54600020
         LA    R13,SHDSA           SAVE AREA ADDRESS                    54800020
         PWTO  REG=(1)             WRITE TO OPERATOR MESSAGE            55000020
         B     DPR113              RETURN HERE                          55200020
         SPACE                                                          55400020
         CNOP  0,8                                                      55600020
SHDSA    DS    18F                 REGISTER SAVE AREA                   55800020
         CNOP  0,4                                                      56000020
SAVER1   DC    XL4'0'                                                   56200020
RTNNUM   DS    CL4' '              ROUTINE NUMBER- EBCDIC               56250001
DEVADR   DS    CL4' '              DEVICE ADDRESS- EBCDIC               56300001
SYMBNM   DS    CL8' '              DEVICE SYMBOLIC NAME                 56350001
DPRTRNCD DC    XL4'0'              RETURN CODE                          56400020
FORMS    DC    XL2'0'              FORMS CONTROL                        56600020
         SPACE 2                                                        56800001
*********************************************************************** 57000020
*        HEADER                                                       * 57200020
*********************************************************************** 57400020
         SPACE                                                          57600020
DPRHDR   ST    R14,SAVE14          SAVE LINK ADDRESS                    57800020
         L     R12,4(R1)           ADDRESS OF DPRINT CONTROL WORD       58000020
         TM    0(R12),X'10'        PRINT HEADER ?                       58200020
         BZ    DPR030+4            NO                                   58400020
         BAL   R10,DPRWRT          YES. PRINT BLANK LINE FOR SPACE      58600001
         TM    0(R12),X'02'        IS IT AN ERROR HEADER                58700001
         BZ    DPR010              NO                                   58800020
         MVI   PB,C'*'             YES.  PREFIX WITH '*'                59000020
         OI    3(R2),X'C0'         SET ERROR MSG BITS IN SCT            59100001
         SPACE                                                          59200020
* GET TEST SECTION ID, ROUTINE NO. FROM SECTION PREFACE.                59400020
         SPACE                                                          59600020
DPR010   L     R7,SECPTR           POINTER TO SECTION PREFACE           59800020
         MVC   PB+1(8),0(R7)       UNIT TEST ID FROM SECT PREF          60000020
         MVI   PB+9,X'60'          PUT DASH IN BUFFER                   60200020
         MVC   PB+10(2),8(R7)      ADD LEVEL TO IT                      60400020
         MVC   PB+14(3),=C'RTN'    PUT 'RTN' IN PRINT BUFFER            60600020
         SR    R7,R7              CLEAR R7.                             60800020
         IC    R7,RTN#            GET ROUTINE NUMBER.                   61000020
         CVD   R7,WRK             CONVERT TO DECIMAL.                   61200020
         SPACE                                                          61400020
         LA    R13,WRK+6          GET ADDR OF RTN NO.                   61600020
         LA    R14,WRK            GET OUTPUT ADDR.                      61800020
         LA    R15,2              GET COUNT                             62000020
         BAL   R10,DPRCNV         CONVERT RTN NO. TO EBCDIC.            62200020
         MVC   PB+18(3),WRK        PUT RTN NUMBER IN PRINT BUFFER       62400020
         MVC   RTNNUM+1(3),WRK     SAVE FOR FIRST ERR MSG               62500001
         SPACE                                                          62600020
* GET DEVICE ADDRESS FROM EITHER DPRINT PARAM TABLE, TECB, OR SCT.      62800020
         SPACE                                                          63000020
         MVC   PB+24(11),=C'DEV/LN NONE'  PUT IN PRINT BUFFER           63200001
         TM    CESWT2,NDRFLG       IS A DEVICE REQUESTED                63400020
         BZ    DPR011              YES                                  63600020
         B     DPR016              BRANCH TO BYPASS DEV ADDRESS LOAD    63800001
DPR011   MVC   DPRDEVAD+2(2),9(R12)  GET DEVICE ADDRESS PARAMETER       64200001
         CLC   DPRDEVAD+2(2),=X'0000'  IS IT ZERO                       64400001
         BNE   DPR015              BRANCH IF NO                         64600001
         L     R1,SAVER1               GET PARM LIST ADDR       A52641  64700001
         SPACE                                                          64800020
         L     R13,12(R1)         GET TECB ADDRESS.                     65000020
         LTR   R13,R13            IS A TECB ADDRESS SUPPLIED ?          65200020
         BZ    DPR012              NO. GET ADDRESS FROM SCT             65400020
         CLI   7(R13),X'00'        YES. IS THERE A POSTED EVENT FIELD   65600020
         BE    DPR012              NO.                                  65800020
         MVC   DPRDEVAD+1(3),9(R13)     GET DEV ADDR FROM TECB          66000001
         B     DPR015                                                   66200020
DPR012   MVC   DPRDEVAD(4),CHASCT+12  GET PRIME DEV ADDR FROM SCT       66400001
         SPACE                                                          66600020
DPR015   LA    R13,DPRDEVAD+2      INPUT ADDRESS FOR CONVERT            66800001
         LA    R14,PB+31           OUTPUT ADDRESS FOR CONVERT           66900001
         LA    R15,2              GET COUNT.                            67000020
         BAL   R10,DPRCNV         CONVERT DEV ADDR TO EBCDIC.           67200020
         CLC   DPRDEVAD(4),CHASCT+12   SAME DEV AS IN SCT?              67400001
         BNE   DPR016              NO. BYPASS SYMBOLIC NAME CHECK       67430001
         TM    CHASCT+11,SYMNAME   YES.  DEV SYMBOLIC NAME GIVEN?       67460001
         BZ    DPR016              NO.                                  67490001
         MVC   PB+36(8),CHASCT+24  YES. PUT IT IN PRINT BUFFER          67520001
         MVC   SYMBNM(8),CHASCT+24 SAVE FOR FIRST ERR, CAT ERR MSGS     67550001
         OI    CESWT5,SYMBFLG      SYMBOLIC NAME FLAG                   67580001
         B     DPR016A                                                  67610001
DPR016   MVI   SYMBNM,C' '         CLEAR WITH BLANKS                    67640001
         MVC   SYMBNM+1(7),SYMBNM                                       67670001
DPR016A  MVC   DEVADR(4),PB+31     SAVE DEV ADDR FOR FE, CAT ERR MSGS   67700001
         TM    0(R12),X'10'        REGULAR PRINT HEADER ENTRY?    21051 67706001
         BO    DPR020              YES.                           21051 67712001
         BR    R9                  NO.  RETURN TO FIRST ERROR MSG RTN. X67718001
                                                                  21051 67724001
         SPACE                                                          67730001
* GET REFERENCE NO., ECA NO. FROM SECTION PREFACE.                      67800020
         SPACE                                                          68000020
DPR020   LA    R6,PB+3             GET PRINT BUFR ADDR FOR ADJUSTMENT   68200001
         TM    CESWT5,SYMBFLG      IS SYMBOLIC NAME TO BE PRINTED       68250001
         BZ    DPR020A             NO                                   68300001
         LA    R6,8(R6)            YES.  MOVE OVER ECA                  68350001
DPR020A  MVC   35(3,R6),=C'ECA'    PUT 'ECA' IN PRINT BUFFER            68400001
         MVC   39(3,R6),ECA#       ALSO ECA NUMBER                      68450001
         SPACE                                                          68500001
DPR023   TM    0(R12),X'01'        IS REFNUM TO BE PRINTED              68600020
         BZ    DPR025              BRANCH IF NO                         68800020
         SPACE                                                          69000020
         MVC   44(6,R6),=C'REFNUM'  PUT IN PRINT BUFFER                 69200001
         MVC   WRK(1),REFNUM      MOVE 1ST 2 DIGITS TO WORK AREA.       69400020
         MVC   WRK+1(2),7(R12)     MOVE LAST 3 DIGITS TO WORK AREA      69600020
         LA    R13,WRK            GET INPUT ADDR FOR CONVERT.           69800020
         LA    R14,WRK+8          GET OUTPUT ADDR FOR CONVERT.          70000020
         LA    R15,3              GET COUNT.                            70200020
         BAL   R10,DPRCNV         CONVERT REFNUM TO EBCDIC.             70400020
         MVC   51(2,R6),WRK+8      PUT FIRST 2 DIGITD IN PRINT BUFFER   70600001
         MVC   53(3,R6),WRK+11     PUT NEXT 3 DIGITS IN PRINT BUFFER    70800001
         SPACE                                                          71000020
DPR025   OI    CESWT5,HDRFLG       SET HEADER FLAG                      71200020
         BAL   R10,DPRWRT          PRINT HEADER LINE                    71400020
         NI    CESWT5,255-HDRFLG    RESET THIS FLAG                     71600020
         NI    CESWT5,255-HDRFLG-SYMBFLG  RESET THESE FLAGS             71700001
         B     DPR030+4            PRINT DESCRIPTION LINES              71800020
         SPACE 2                                                        72000020
*********************************************************************** 72200020
*        DESCRIPTION                                                  * 72400020
*********************************************************************** 72600020
         SPACE                                                          72800020
DPR030   ST    R14,SAVE14          SAVE LINK ADDR FOR RETURN            73000020
         TM    2(R12),X'80'        PRINT DESCRIPTION LINES?             73200020
         BZ    DPR041              NO.  EXIT ROUTINE                    73400020
         SR    R7,R7               YES.  CLEAR R7                       73600020
         IC    R7,16(R12)          GET NUMBER OF DESC LINES             73800020
         LTR   R7,R7               NO. OF LINES = 0 ?                   74000020
         BZ    DPR042              YES.  EXIT RTN                 M5076 74200001
         LA    R11,60(R1)          POINTER TO DESC LINE ADDRESS         74400020
         LA    R8,23(R12)          ADDRESS OF BYTE COUNT                74600020
         SPACE                                                          74800020
DPR035   SR    R6,R6              CLEAR R6.                             75000020
         IC    R6,0(R8)           GET COUNT.                            75200020
         LTR   R6,R6              COUNT = 0 ?                           75400020
         BZ    DPR040             BRANCH YES.                           75600020
         LH    R5,MAXCNT          GET MAX NO. BYTES ALLOWED.            75800020
         CR    R6,R5              COUNT GREATER THAN MAX ?              76000020
         BNH   DPR037             BRANCH IF NO.                         76200020
         LR    R6,R5               SET COUNT TO MAX                     76400020
         SPACE                                                          76600001
DPR037   L     R5,0(R11)           GET DESC LINE ADDR                   77000020
         BCTR  R6,0               REDUCE COUNT FOR EXECUTE OF MVC.      77200020
         EX    R6,DPR605          MOVE DESC LINE TO PRINT BUFFER.       77400020
         BAL   R10,DPRWRT          GO PRINT DESCRIPTION LINE            77600020
         SPACE                                                          77800020
DPR040   LA    R11,4(R11)         GET ADDR OF DESC LINE 2 ADDR.         78000020
         LA    R8,1(R8)            GET NEXT COUNT ADDRESS         M1010 78200020
         BCT   R7,DPR035          PROCESS LINE 2.                       78400020
         SPACE                                                          78600020
DPR041   L     R14,SAVE14          RESTORE LINK ADDRESS                 78800020
         BR    R14                 RETURN TO SCAN SECTION               79000020
DPR042   MVI   DPRTRNCD+3,X'0C'    SET RETURN CODE                M5076 79060001
         B     DPR041                                             M5076 79120001
         SPACE                                                          79200020
DPR605   MVC   PB(0),0(R5)         MOVE TO PRINT BUFFER                 79400020
         EJECT                                                          79600001
*********************************************************************** 79800020
*    PRINT HEADER, DESCRIPTION LINE VIA PARALLEL PRINT OUTPUT WRITER  * 80000020
*********************************************************************** 80200020
         SPACE                                                          80400020
DPRWRT   LA    R13,SHDSA           SAVE AREA ADDRESS                    80600020
         PWRT  SIZE=120                                         SA46329 80800001
         MVI   PB,C' '             CLEAR PRINT BUFFER WITH BLANKS       81000020
         MVC   PB+1(120),PB                                             81200020
         L     R1,SAVER1           RESTORE DPRINT PARAMETER PTR         81400020
         L     R12,4(R1)           ADDRESS OF DPRINT CTRL WORD          81600020
         BR    R10                 RETURN TO CALLING ROUTINE            81800020
         SPACE                                                          82000020
WRK      DS    16D                                                      82200020
DPRDEVAD DC    XL4'0'              DEVICE ADDRESS - HEX                 82300001
SAVE14   DC    XL4'0'                                                   82400020
MAXCNT   DC    H'119'              MAX PRINT CHARACTERS           M1010 82600020
         SPACE                                                          83000020
*********************************************************************** 83200020
*              DPRINT MESSAGE SECTION                                 * 83400020
*********************************************************************** 83600020
         SPACE 1                                                        83800020
IFDMSG14 DC    A(IFD129)                                                84000020
         DC    A(IFD157)                                                84200020
         SPACE                                                          84400020
IFD129   WTO   'IFD129I FIRST ERROR COMMUNICATION XXXXXXXX YYY UNIT ZZZX84600001
               Z SSSSSSSS',MF=L,ROUTCDE=10,DESC=7                       84800001
IFD157   WTO   'IFD157I CATASTROPHIC ERROR ON DEVICE XXXX SSSSSSSS',MF=X85000001
               L,ROUTCDE=10,DESC=7                                      85200001
         EJECT                                                          85400020
*********************************************************************** 85600020
*        DPRCNV - HEX TO EBCDIC CONVERT                               * 85800020
*                                                                     * 86000020
*              CALL SEQ -  R13 = INPUT ADDRESS                        * 86200020
*                          R14 = OUTPUT ADDRESS                       * 86400020
*                          R15 = INPUT BYTE COUNT                     * 86600020
*                                                                     * 86800020
*                          BAL R10,DPRCNV                             * 87000020
*********************************************************************** 87200020
         SPACE                                                          87400020
DPRCNV   STM   R5,R6,SAVREGS2      SAVE REGS 5, 6                       87600020
         STM   R13,R15,SAVREGS3    SAVE REGS 13-15                      87800020
         SPACE                                                          88000020
         LTR   R15,R15            COUNT = 0 ?                           88200020
         BZ    DPRCNV8            BRANCH IF YES.                        88400020
         SPACE                                                          88600020
         AR    R14,R15         ADD COUNT TO OUTPUT ADDR.                88800020
         AR    R14,R15            ADD COUNT AGAIN.                      89000020
         AR    R13,R15            ADD COUNT TO INPUT ADDR.              89200020
         SR    R5,R5              CLEAR R5.                             89400020
         SR    R6,R6              CLEAR R6.                             89600020
         SPACE                                                          89800020
DPRCNV4  S     R14,=F'2'          GET ADDR OF LAST BYTE OF OUTPUT.      90000020
         BCTR  R13,0              GET ADDR OF LAST BYTE OF INPUT.       90200020
         IC    R6,0(R13)          GET HEX BYTE.                         90400020
         LR    R5,R6              PUT IN R5.                            90600020
         SRL   R6,4               GET BITS 0-3 IN R6.                   90800020
         N     R5,=F'15'          GET BITS 4-7 IN R5.                   91000020
         IC    R6,DPREBC(R6)      CONVERT BITS 0-3 TO EBCDIC CHAR.      91200020
         IC    R5,DPREBC(R5)      CONVERT BITS 4-7 TO EBCDIC CHAR.      91400020
         STC   R6,0(R14)          STORE 1ST EBCDIC CHAR IN OUTPUT.      91600020
         STC   R5,1(R14)          STORE 2ND EBCDIC CHAR IN OUTPUT.      91800020
         BCT   R15,DPRCNV4        GET NEXT HEX BYTE.                    92000020
DPRCNV8  LM    R5,R6,SAVREGS2      RESTORE REGS 5, 6                    92200020
         LM    R13,R15,SAVREGS3    RESTORE REGS 13-15                   92400020
         BR    R10                RETURN TO CALLER.                     92600020
         SPACE                                                          92800020
DPREBC   DC    C'0123456789ABCDEF' HEX TO EBCDIC CONVERT TABLE.         93000020
         CNOP  0,4                                                      93200020
SAVREGS2 DC    2F'00'                                                   93400020
SAVREGS3 DC    3F'00'                                                   93600020
SECPREF  DSECT                         SECTION PREFACE                  93607002
RTN#     DS    CL1                                                      93614002
         DS    CL16                                                     93621002
REFNUM   DS    CL1                                                      93628002
         DS    CL14                                                     93635002
ECA#     DS    CL3                                                      93642002
IFDOLT14 CSECT                                                   YM5407 93646002
DPRCOM   IFDCOM                                                         93650002
PB       EQU   PRTBUFR+1                                                93720002
         SPACE                                                          93800020
         SPACE                                                          95200020
         END                                                            95800020
