 TITLE  'IFDOLT15  RESULTS AND DATA SECTIONS'                           00100020
*                                                                       00130002
*                                                                       00160002
****************************** PROLOGUE ******************************* 00200020
*                                                                     * 00300020
*  MODULE NAME: IFDOLT15                                              * 00400002
*                                                                     * 00420002
*  DESCRIPTIVE NAME: DPRINT RESULTS AND DATA                          * 00440002
*                                                                     * 00460002
*  COPYRIGHT: NONE                                                    * 00480002
*                                                                     * 00500020
*  STATUS: CHANGE LEVEL - 000                                         * 00600020
*                                                                     * 00700020
*  FUNCTION: THIS MODULE IS DESIGNED AS FOLLOWS:                      * 00800020
*                                                                     * 00900020
*            1) TEST DPRINT CONTROL FIELD DEFINITION BITS TO          * 01000020
*               DETERMINE IF THE FOLLOWING  ARE TO BE PRINTED:        * 01100020
*                 CAW, CCW'S, ICW                                     * 01200020
*                 EXPECTED, RECEIVED CONDITION CODE                   * 01300020
*                 EXPECTED, RECEIVED CSW                              * 01400020
*                 EXPECTED, RECEIVED SENSE DATA                       * 01500020
*                 EXPECTED, RECEIVED, WRITTEN DATA                    * 01600020
*            2) GET THE ADDRESS AND BYTE COUNT FOR THE ITEM.          * 01700020
*               IF EITHER IS NOT GIVEN, SET THE RETURN CODE TO 0C.    * 01800020
*            3) GET, CONVERT TO EBCDIC, AND LOAD A RESULT OR DATA     * 01900020
*               LINE IN THE PRINT BUFFER.                             * 02000020
*            4) IDENTIFY AN ERROR LINE WITH AN ASTERISK.              * 02100020
*            5) PRINT THE RESULT OR DATA LINE WITH A COMMON           * 02200020
*               PWRT INNER MACRO ROUTINE.                             * 02300020
*            6) DO THE ABOVE UNTIL ALL LINES HAVE BEEN PRINTED.       * 02400020
*                                                                     * 02500020
*  ENTRY POINT: IFDOLT15 - FROM THE SCAN SECTION OF IFDOLT14.         * 02600020
*                                                                     * 02700020
*  INPUT: DPRINT PARAMETER LIST IN TEST SECTION.                      * 02800020
*                                                                     * 02900020
*  REGISTER USAGE: R1  - ADDRESS OF DPRINT PARAMETER LIST.            * 03000020
*                  R2  - ADDRESS OF SECT CTRL TABLE IN OLTEP ROOT.    * 03100020
*                  R3  - ADDRESS OF TECB MAP.                         * 03200020
*                  R4  - BASE REG FOR THIS MODULE.                    * 03300020
*                  R5-R11 - MISCELLANEOUS                             * 03400020
*                  R12 - ADDRESS OF DPRINT CONTROL FIELD WORD.        * 03500020
*                  R13 - ADDR OF CALLER'S SAVE AREA; ALSO CONVERT RTN * 03600020
*                  R14 - ADDR OF CALLER'S RETURN PT; ALSO CONVERT RTN * 03700020
*                  R15 - LINK ADDR; CONVERT COUNT; RETURN CODE.       * 03800020
*                                                                     * 03900020
*  EXTERNAL ROUTINES: IFDOLT39 -PARALLEL PRINT OUTPUT WRITER.         * 04000020
*                                                                     * 04100020
*  EXITS - NORMAL: RETURN TO SCAN SECTION OF IFDOLT14.                * 04200020
*        -  ERROR: NONE                                               * 04300020
*                                                                     * 04400020
*  ATTRIBUTES: SERIALLY REUSABLE                                      * 04500020
*                                                                     * 04600020
*  CHANGE ACTIVITY: CLEANUP - C072000,A072300,D696000           Y02906* 04630002
*                   PTM #03338 - C313000,D313070-313140,D313600,Y03338* 04640002
*                                A313620                        Y03338* 04650002
*                   PTM #05407 - A709500                        Y05407* 04655002
*                                                                     * 04660002
*********************************************************************** 04700020
         EJECT                                                          04800020
         SPACE 2                                                        04900020
IFDOLT15 CSECT                                                          05000020
*  IMPLEMENT EMPTY TECB FUNCTION                                 Y01906 05020002
*D282000                                                         A42315 05050001
*A147300,A147600                                                SA53321 05070001
         USING IFDOLT15,R4         BASE REG FOR MODULE                  05100020
         USING CHASCT,R2           BASE REG FOR SECTION CTRL TABLE      05200020
         USING TECBMAP,R3                                               05300020
         SPACE                                                          05400020
R1       EQU   1                                                        05500020
R2       EQU   2                                                        05600020
R3       EQU   3                                                        05700020
R4       EQU   4                                                        05800020
R5       EQU   5                                                        05900020
R6       EQU   6                                                        06000020
R7       EQU   7                                                        06100020
R8       EQU   8                                                        06200020
R9       EQU   9                                                        06300020
R10      EQU   10                                                       06400020
R11      EQU   11                                                       06500020
R12      EQU   12                                                       06600020
R13      EQU   13                                                       06700020
R14      EQU   14                                                       06800020
R15      EQU   15                                                       06900020
RSLTFLG  EQU   X'40'                                                    07000020
         SPACE                                                          07100020
DPRRSLTS SAVE (14,12),,IFDOLR15&SYSDATE                                 07200002
*        ESTABLISH DATE AND SAVE REGS                                   07230002
         SPACE  3                                                       07260002
         LR    R4,R15              LOAD BASE REG                        07300020
         LA    R5,RSLTSA           ADDRESS OF RESULTS SAVE AREA         07400020
         ST    R5,8(R13)           STORE IN CALLER'S SA                 07500020
         ST    R13,4(R5)           STORE ADDRESS OF CALLER'S SA         07600020
         L     R5,4(R1)            ADR PTR SAVE AREA              M4506 07700020
         L     R1,0(R5)            GET DPRINT PARAMETER PTR             07800020
         L     R12,4(R1)           PTR TO DPRINT CTRL FIELD WORD        07900020
         L     R3,12(R1)           TECB ADDRESS                         08000020
         ST    R1,SAVER1           SAVE DPRINT PARAMETER PTR            08100020
         XC    RETCODE(4),RETCODE  CLEAR IT                             08200020
         EJECT                                                          08300020
*********************************************************************** 08400020
*              SET UP DEVICE ADDRESS                                  * 08500020
*********************************************************************** 08600020
         SPACE                                                          08700020
DPR001   MVC   DPRDEVAD+2(2),9(R12)  GET DEV ADDR FROM OLT              08800020
         CLC   DPRDEVAD+2(2),=X'0000'  IS IT 0?                         08900020
         BNE   DPR050              BRANCH IF NO                         09000020
         L     R9,12(R1)           PTR TO TECB                          09100020
         LTR   R9,R9               IS TECB ADDR GIVEN ?                 09200020
         BZ    DPR002              BR IF NO                             09300020
         CLI   TCBEVOC,X'00'       IS THERE A POSTED EVENT FIELD        09400020
         BE    DPR002              BR IF NO                             09500020
         MVC   DPRDEVAD+1(3),TCBFD01+1  PUT DEV ADDR IN BUFFER          09600020
         B     DPR050                                                   09700020
DPR002   MVC   DPRDEVAD(4),12(R2)  GET PRIME DEV ADDR                   09800020
         SPACE                                                          09900020
*********************************************************************** 10000020
*   CAW   CCW                                                           10100020
*********************************************************************** 10200020
         SPACE                                                          10300020
DPR050   TM    2(R12),X'40'        PRINT CCW?                           10400020
         BZ    DPR060              BR IF NO                             10500020
         L     R7,20(R1)           GET CCW ADDRESS                      10600020
         LTR   R7,R7               IS IT 0?                             10700020
         BNZ   DPR052              BR IF NO                             10800020
DPR050A  MVI   DPRTRNCD,X'0C'      SET RETURN CODE 0C                   10900020
         B     DPR060              GO CHK FOR CC PRINT                  11000020
         SPACE                                                          11100020
DPR052   MVC   PB+32(3),=C'CAW'    PUT ' CAW' IN PRINT BUFFER           11200020
         LA    R13,20(R1)          GET CCW ADDRESS                      11300020
         LA    R14,PB+37           GET OUTPUT ADDR FOR CONVERT          11400020
         LA    R15,4               GET COUNT                            11500020
         BAL   R10,DPRCNV          CONVERT CCW ADDR TO EBCDIC           11600020
         SR    R8,R8               CLEAR                                11700020
DPR052A  IC    R8,11(R12)          GET CCW COUNT                        11800020
         LTR   R8,R8               IS IT 0?                             11900020
         BZ    DPR050A             BR IF YES                            12000020
         SR    R5,R5               CLEAR                                12100020
         IC    R5,12(R12)          GET NO. OF FAILING CCW               12200020
         LA    R6,1                SET CCW NO.                          12300020
DPR053   MVC   PB+1(3),=C'CCW'     PUT 'CCW' IN PRINT BUFFER            12400020
         TM    3(R12),X'10'        ICW ?                                12500020
         BZ    DPR053A             BR IF NO                             12600020
         MVI   PB+1,C'I'           PUT 'I' IN BUFFER                    12700020
DPR053A  CVD   R6,WRK              CONVERT CCW NO. TO DECIMAL           12800020
         SPACE                                                          12900020
         LA    R13,WRK+6           GET ADDR OF CCW NO.                  13000020
         LA    R14,WRK             GET OUTPUT ADDR                      13100020
         LA    R15,2               GET COUNT                            13200020
         BAL   R10,DPRCNV          CONVERT CCW NO. TO EBCDIC            13300020
DPR054   MVC   PB+4(2),WRK+1       PUT CCW NO. IN PRINT BUFFER          13400020
         SPACE                                                          13500020
DPR056   LR    R13,R7              GET CCW ADDR                         13600020
         LA    R14,WRK             GET OUTPUT ADDR FOR CONVERT          13700020
         LA    R15,8               GET COUNT                            13800020
         BAL   R10,DPRCNV          CONVERT CCW TO EBCDIC                13900020
         MVC   PB+7(2),WRK         MOVE CMND CODE                       14000020
         MVC   PB+10(6),WRK+2         DATA ADDR                         14100020
         MVC   PB+17(2),WRK+8           FLAGS                           14200020
         MVC   PB+20(2),WRK+10             UNUSED FLD                   14300020
         MVC   PB+23(4),WRK+12               BUTE COUNT TO BUFFER       14400020
         SPACE                                                          14500020
         CR    R6,R5               IS THIS FAILING CCW?                 14600020
         BNE   DPR058              BR IF NO                             14700020
         TM    1(R12),X'40'            IS IT ERROR CCW?         SA53321 14730001
         BZ    DPR058                  BR IF NOT                SA53321 14760001
         MVI   PB,C'*'             PREFIX CCW WITH *                    14800020
DPR058   BAL   R10,DPRWRT          GO PRINT CCW LINE                    14900020
         SPACE                                                          15000020
         LA    R6,1(R6)            BUMP CCW NO.                         15100020
         LA    R7,8(R7)            POINT TO NEXT CCW                    15200020
         BCT   R8,DPR053           GO PROCESS NEXT CCW                  15300020
         SPACE                                                          15400020
*********************************************************************** 15500020
*   CONDITION CODE                                                    * 15600020
*********************************************************************** 15700020
         SPACE                                                          15800020
DPR060   DS    0H                                                Y01906 15900002
         MVI   DPRFLAG,X'00'           CLEAR IT                  Y01906 15930002
         TM    3(R12),X'04'            PRINT CC?                 Y01906 15960002
         BZ    DPR080              BR IF NO                             16000020
         SR    R6,R6               CLEAR                                16100020
         IC    R6,6(R12)           GET EXPECTED CC                      16200020
         LTR   R6,R6               IS IT GIVEN?                         16300020
         BZ    DPR070              BR IF NO                             16400020
         L     R5,16(R1)           GET RECEIVED CC ADDRESS              16500020
         LTR   R5,R5               IS IT 0?                             16600020
         BNZ   DPR061              BR IF NO                       21051 16700001
         SPACE                                                          16800020
* GET RECEIVED CONDITION CODE FROM A TECB FIELD.                        16820001
         SPACE                                                          16840001
         OI    DPRFLAG,DPRLKCC     TURN ON LOOK FOR CC FLAG       21051 16860001
         LTR   R3,R3                   TECB ADDR 0?              Y01906 16870002
         BZ    DPR070                  YES-BRANCH                Y01906 16880002
         BAL   R10,DPR175          GO FIND FLD IN TECB                  16900020
         TM    DPRFLAG,DPRSCHFL    SEARCH FAIL?                         17000020
         BO    DPR061A                 YES-BRANCH                Y01906 17100002
         TM    DPRFLAG,DPRQUED         QUEUED?                   Y01906 17110002
         BNO   DPR060A                 NO-BRANCH                 Y01906 17120002
         MVC   PB+22(6),=C'QUEUED'     YES-SAY SO                Y01906 17130002
         B     DPR064                  GO AROUND                 Y01906 17140002
DPR060A  DS    0H                                                Y01906 17150002
         LR    R5,R13              PUT POINTER IN R5                    17200020
DPR061   DS    0H                                                 21051 17250001
         CLI   0(R5),X'FF'         IS CODE 'FF'                         17300020
         BNE   DPR062              BR IF NO                             17400020
DPR061A  DS    0H                                                Y01906 17450002
         MVI   PB+22,X'F0'         PUT CC 0 IN PRINT BUFFER             17500020
         B     DPR064                                                   17600020
         SPACE                                                          17700020
DPR062   CLI   0(R5),C'0'          IS CC=0,1,2,3?                 21051 17730001
         BE    DPR063                                             21051 17760001
         CLI   0(R5),C'1'                                         21051 17790001
         BE    DPR063                                             21051 17820001
         CLI   0(R5),C'2'                                         21051 17850001
         BE    DPR063                                             21051 17880001
         CLI   0(R5),C'3'                                         21051 17910001
         BNE   DPR070              NO.  SET RETURN CODE TO 0C     21051 17940001
DPR063   MVC   PB+22(1),0(R5)      MOVE CC TO PRINT BUFFER              18000020
DPR064   STC   R6,PB+9             PUT XPTD CC IN BUFFER                18100020
         MVC   PB+1(7),=C'XPTD CC'  PUT 'XPTD CC' IN BUFFER             18200020
         MVC   PB+14(7),=C'RCVD CC'  PUT 'RCVD CC' IN BUFFER            18300020
         TM    3(R12),X'02'        IS CC IN ERROR?                      18400020
         BZ    DPR066              BR IF NO                             18500020
         MVI   PB,C'*'             PUT * IN BUFFER                      18600020
         SPACE                                                          18700020
DPR066   BAL   R10,DPRWRT          GO PRINT CC LINE                     18800020
         B     DPR080              GO CHK FOR XPTD CSW PRINT            18900020
         SPACE                                                          19000020
DPR070   MVI   DPRTRNCD,X'0C'      SET RTRN CODE TO 0C                  19100020
         MVI   DPRFLAG,X'00'           CLEAR IT                  Y01906 19200002
         B     DPR080              GO CHK FOR XPTD CSW PRINT            19300020
         SPACE                                                          19400020
*********************************************************************** 19500020
*        EXPECTED  CSW                                                * 19600020
*********************************************************************** 19700020
         SPACE                                                          19800020
DPR080   DS    0H                                                Y01906 19900002
         MVI   DPRFLAG,X'00'           CLEAR IT                  Y01906 19930002
         SR    R7,R7                   CLEAR IT                  Y01906 19960002
         IC    R7,13(R12)          GET XPTD CSW MASKS                   20000020
         STC   R7,DPRMASK          SAVE IT                              20100020
         TM    2(R12),X'20'        PRINT CSW1?                          20200020
         BNZ   DPR086              BR IF YES                            20300020
         SPACE                                                          20400020
DPR082   LA    R11,DPR100          GET RTRN ADDR                        20500020
         LA    R5,PB+11            POINT TO FLD IN BUFR                 20600020
         BAL   R10,DPR092          GO CHK FOR XCSW2 PRINT               20700020
         SPACE                                                          20800020
         MVC   PB+1(9),=C'XPTD CSW2'  PUT 'XPTD CSW2' IN BUFR           20900020
         TM    3(R12),X'01'        PSW PRINT?                           21000020
         BZ    DPR084              BR IF NO                             21100020
         MVI   PB+6,C'P'           PUT 'P' IN BUFR                      21200020
DPR084   B     DPR098              GO PRINT                             21300020
         SPACE                                                          21400020
DPR086   L     R13,24(R1)          GET XPTD CSW1 ADDRESS                21500020
         LTR   R13,R13             IS IT 0?                             21600020
         BNZ   DPR088              BR IF NO                             21700020
         MVI   DPRTRNCD,X'0C'      SET RTRN CODE 0C                     21800020
         B     DPR082              BR TO CHK XCSW2                      21900020
         SPACE                                                          22000020
DPR088   MVC   PB+1(9),=C'XPTD CSW1'  PUT 'XPTD CSW1' IN BUFR           22100020
         TM    3(R12),X'01'        PSW?                                 22200020
         BZ    DPR090              BR IF NO                             22300020
         MVI   PB+6,C'P'           PUT 'P' IN BUFR                      22400020
DPR090   LA    R5,PB+11            GET FLD IN BUFR                      22500020
         BAL   R11,DPR450          GO SET UP FOR PRINT                  22600020
         SPACE                                                          22700001
         LA    R11,DPR098          GET RTRN ADDR                        22900020
         LA    R5,PB+37            GET FLD ADDR IN BUFR                 23000020
         BAL   R10,DPR092          GO CHK FOR XCSW2 PRINT               23100020
         MVC   PB+32(4),=C'CSW2'   PUT 'CSW2' IN BUFR                   23200020
         TM    3(R12),X'01'        PSW ?                                23300020
         BZ    DPR098              BR IF NO                             23400020
         MVI   PB+32,C'P'          PUT 'P' IN BUFR                      23500020
         B     DPR098              BR TO PRINT                          23600020
         SPACE                                                          23700020
DPR092   TM    2(R12),X'08'        PRINT XCSW2?                         23800020
         BNZ   DPR094              BR IF YES                            23900020
         BR    R11                 RETURN                               24000020
         SPACE                                                          24100020
DPR094   SR    R7,R7               CLEAR                                24200020
         IC    R7,DPRMASK          GET MASK                             24300020
         SLL   R7,28                  FOR XCSW2                         24400020
         SRL   R7,24                                                    24500020
         STC   R7,DPRMASK          PUT BACK                             24600020
         L     R13,32(R1)          GET XCSW2 ADDRESS                    24700020
         LTR   R13,R13             IS IT 0?                             24800020
         BNZ   DPR096              BR IF NO                             24900020
         MVI   DPRTRNCD,X'0C'      SET RTRN CODE 0C                     25000020
         BR    R11                 RETURN                               25100020
         SPACE                                                          25200020
DPR096   BAL   R11,DPR450          GO SET UP FOR PRINT                  25300020
         BR    R10                 RETURN                               25400020
         SPACE                                                          25500020
DPR098   BAL   R10,DPRWRT          GO PRINT EXPECTED CSW LINE           25600020
         B     DPR100                                                   25700020
         SPACE                                                          25800020
*********************************************************************** 25900020
*        RECEIVED  CSW                                                * 26000020
*********************************************************************** 26100020
         SPACE                                                          26200020
DPR100   MVI   DPRMASK,X'FF'           SET MASK TO ONES                 26300020
         MVI   DPRFLAG,X'00'           CLEAR IT                  Y01906 26350002
         TM    2(R12),X'10'            PRINT RCVD CSW1?                 26400020
         BNZ   DPR102              BR IF YES                            26500020
DPR101   LA    R11,DPR200          GET RTRN ADDR                        26600020
         LA    R5,PB+11            GET FIELD ADDR IN PRINT BUFFER       26700020
         BAL   R10,DPR150          GO CHK FOR CSW2 PRINT                26800020
         BAL   R11,DPR450              GO SET UP                 Y01906 26850002
         MVC   PB+1(9),=C'RCVD CSW2'  PUT 'RCVD CSW2 IN PRINT BUFFER    26900020
         TM    3(R12),X'01'        PSW PRINT?                           27000020
         BZ    DPR101A             BR IF NO                             27100020
         MVI   PB+6,C'P'           PUT 'P' IN BUFFER                    27200020
DPR101A  B     DPR110B             GO PRINT                             27300020
         SPACE                                                          27400020
DPR102   L     R13,28(R1)          GET RCVD CSW1 ADDRESS                27500020
         LTR   R13,R13             IS ADDR GIVEN?                       27600020
         BNZ   DPR105              BR IF YES                            27700020
         LTR   R3,R3                   TECB ADDR 0?              Y01906 27710002
         BNZ   DPR102A                 NO-BRANCH                 Y01906 27720002
         MVI   DPRTRNCD,X'0C'          SET RTRN CODE X'0C'       Y01906 27730002
         B     DPR200                  GO CHK FOR SNS PRINT      Y01906 27740002
DPR102A  DS    0H                                                Y01906 27750002
         BAL   R10,DPR175          GO FIND EVENT IN TECB                27800020
         MVC   PB+11(4),DPRNONE        ASSUME NONE               Y01906 27900002
         LA    R13,4(R13)              ASSUME SOME               Y01906 28000002
         SPACE                                                          28300020
DPR105   TM    1(R12),X'20'        RCVD CSW1 ERROR ?                    28400020
         BZ    DPR110              BR IF NO                             28500020
         MVI   PB,C'*'             PREFIX CSW WITH '*'                  28600020
DPR110   MVC   PB+1(9),=C'RCVD CSW1'  PUT 'RCVD CSW1' IN PRINT BUFFER   28700020
         TM    3(R12),X'01'        PSW PRINT?                           28800020
         BZ    DPR110A             BR IF NO                             28900020
         MVI   PB+6,C'P'           PUT 'P' IN BUFFER                    29000020
DPR110A  LA    R5,PB+11            GET FLD ADDR IN PRINT BUFFER         29100020
         BAL   R11,DPR450          GO SET UP FOR PRINT                  29200020
         NI    DPRFLAG,255-DPRSCHFL-DPRQUED  CLEAR EM            Y01906 29250002
         SPACE                                                          29300020
         LA    R11,DPR115          GET RETURN ADDR                      29400020
         LA    R5,PB+37            GET FLD ADDR IN BUFR                 29500020
         BAL   R10,DPR150          GO CHK FOR CSW2 PRINT                29600020
         BAL   R11,DPR450                                        Y01906 29650002
         MVC   PB+32(4),=C'CSW2'   PUT 'CSW2' IN PRINT BUFFER           29700020
         TM    3(R12),X'01'        PSW PRINT?                           29800020
         BZ    DPR110B             BR IF NO                             29900020
         MVI   PB+32,C'P'          PUT PSW IN BUFFER                    30000020
DPR110B  TM    1(R12),X'10'        CSW2 ERROR?                          30100020
         BZ    DPR115              BR IF NO                             30200020
         MVI   PB,C'*'             PREFIX LINE WITH *                   30300020
         SPACE                                                          30400020
DPR115   BAL   R10,DPRWRT          GO PRINT RECEIVED CSW LINE           30500020
         B     DPR200              GO CHK FOR XPTD SNS PRINT            30600020
         SPACE                                                          30700020
DPR150   TM    2(R12),X'04'        PRINT CSW2 ?                         30800020
         BNZ   DPR155              BR IF YES                            30900020
         BR    R11                 RETURN ON R11                        31000020
DPR155   L     R13,36(R1)          GET RECEIVED CSW2 ADDRESS            31100020
         LTR   R13,R13             IS ADDRESS GIGEN                     31150002
         BCR   7,R10               YES, GO AROUND CHECK          Y03338 31200002
DPR160   DS    0H                                                Y01906 31321002
         LTR   R3,R3                   TECB ADDR ZERO?           Y01906 31330002
         BNZ   DPR160A                 YES-GO AROUND             Y03338 31337002
         MVI   DPRTRNCD,X'0C'          NO-SET RTN CODE 0C        Y01906 31344002
         BR    R11                     GO BACK                   Y01906 31351002
DPR160A  DS    0H                                                Y03338 31360002
         MVI   DPRFLAG,DPRSCH02    TURN ON FLG FOR CSW2 SEARCH          31400020
         ST    R10,DSAVERGS        SAVE REG 10                          31500020
         MVC   0(4,R5),DPRNONE         SAY NONE                  Y01906 31550002
         BAL   R10,DPR175          GO FIND CSW2 IN TECB                 31600020
         L     R10,DSAVERGS        RESTORE R10                          31700020
         LA    R13,4(R13)              ASSUME SOME               Y01906 31800002
         BR    R10                 RETURN ON R10                        32300020
         SPACE                                                          32400020
*********************************************************************** 32500020
* ENTER HERE TO FIND FLD IN TECB FOR CC, CSW, PSW                     * 32600001
*********************************************************************** 32700020
         SPACE                                                          32800020
DPR175   SR    R15,R15             CLEAR                                32900020
         SR    R14,R14             CLEAR                                33000020
         NI    DPRFLAG,255-DPRSCHFL-DPRQUED  CLEAR EM            Y01906 33200002
         IC    R15,TCBEVOC             GET NO FLDS TO CHK        Y01906 33250002
         CLC   TCBEVOC(1),TCBFDCT  COMPARE CNT TO EVNT COUNT            33300020
         BC    12,DPR177           BR ON EVNT CNT LE TO FLD CNT         33400020
         IC    R15,TCBFDCT         GET NO. OF FIELDS TO CHECK           33500020
DPR177   DS    0H                                                Y01906 33600002
         LTR   R15,R15             IS EVOC 0 ?                          33900020
         BZ    DPR185              BR IF 0                              34000020
DPR179   IC    R14,TCBFDLN         GET FLD LNGTH                        34100020
         LA    R13,TCBFD01         PTR TO FIRST EVENT FLD               34200020
DPR181   CLC   1(3,R13),DPRDEVAD+1  EVENT FLD FOR DEV?                  34300020
         BNE   DPR183              BR IF NO                             34400020
         TM    DPRFLAG,DPRLKCC     LOOKING FOR CC?                21051 34408001
         BZ    DPR181A             NO.                            21051 34416001
         TM    0(R13),X'F0'        YES.  IS THERE A CC ENTRY?     21051 34424001
         BO    DPR187              YES.                           21051 34432001
         B     DPR183              NO.  TRY NEXT FIELD.           21051 34440001
         SPACE                                                          34448001
DPR181A  TM    3(R12),X'01'        LOOKING FOR A PSW?             21051 34456001
         BNZ   DPR183A             YES.                           21051 34464001
         CLI   0(R13),X'F0'        NO.  CC=0 FIELD?               21051 34472001
         BE    DPR183              YES                            21051 34480001
DPR182A  DS    0H                                                 21051 34488001
         TM    DPRFLAG,DPRSCH02    THIS THE ONE I WANT?                 34500020
         BZ    DPR187              BR IF YES                            34600020
         SPACE                                                          34700020
         NI    DPRFLAG,255-DPRSCH02  TURN OFF SEARCH CSW2 FLAG          34800020
DPR183   AR    R13,R14             BUMP TO NEXT FLD                     34900020
         BCT   R15,DPR181          GO CHK IF CORRECT FLD                35000020
         SPACE                                                          35100020
DPR185   DS    0H                                                Y01906 35200002
         TM    TCBFLGS,QUEUED          SIO QUEUED?               Y01906 35210002
         BNO   DPR185A                 NO-BRANCH                 Y01906 35220002
         OI    DPRFLAG,DPRQUED         TURN ON Q FLG             Y01906 35230002
         BR    R10                     GO                        Y01906 35240002
DPR185A  DS    0H                                                Y01906 35250002
         OI    DPRFLAG,DPRSCHFL    TURN ON SEARCH FAIL FLAG             35300020
DPR187   BR    R10                 RETURN                               35400020
DPR183A  DS    0H                                                 21051 35420001
         TM    0(R13),X'F0'        IS IT A PSW ENTRY?             21051 35440001
         BNO   DPR182A             BRANCH IF NOT A COND CODE      21051 35460001
         B     DPR183              CHECK NEXT ENTRY               21051 35480001
         SPACE                                                          35500020
*********************************************************************** 35600020
*        EXPECTED SENSE                                               * 35700020
*********************************************************************** 35800020
         SPACE                                                          35900020
         SPACE                                                          36000020
DPR200   DS    0H                                                Y01906 36100002
         MVI   DPRFLAG,X'00'           CLEAR IT                  Y01906 36130002
         TM    2(R12),X'02'            PRINT XPTD SNS?           Y01906 36160002
         BZ    DPR210              NO. BRANCH                     M1005 36200020
         L     R13,40(R1)          YES. GET EXPECTED SENSE ADDR   M1005 36300020
         LTR   R13,R13             IS ADDRESS GIVEN               M1005 36400020
         BNZ   DPR201              YES. BRANCH                    M1005 36500020
DPR200A  MVI   DPRTRNCD,X'0C'      NO. SET RETURN CODE 0C         M1005 36600020
         B     DPR210              GO CHK FOR RCVD SENSE PRINT    M1005 36700020
         SPACE                                                          36800020
DPR201   SR    R7,R7               CLEAR REG                      M1005 36900020
         IC    R7,14(R12)          GET EXPECTED SENSE BYTE COUNT  M1005 37000020
         LTR   R7,R7               IS IT 0?                       M1005 37100020
         BZ    DPR200A             YES. BRANCH                    M1005 37200020
         SPACE                                                          37300020
DPR203   MVC   PB+1(8),=C'XPTD SNS'  LOAD IN PRINT BUFFER         M1005 37400020
         BAL   R10,DPR218AA        LOAD SENSE DATA IN PB          M1005 37500020
         B     DPR210              GO CHK FOR RCVD SENSE PRINT    M1005 37600020
         SPACE                                                          37700020
*********************************************************************** 37800020
*        RECEIVED SENSE                                               * 37900020
*********************************************************************** 38000020
         SPACE                                                          38100020
DPR210   DS    0H                                                Y01906 38200002
         MVI   DPRFLAG,X'00'           CLEAR IT                  Y01906 38230002
         TM    2(R12),X'01'            PRINT RCVD SNS?           Y01906 38260002
         BZ    DPR230              NO. BRANCH                     M1005 38300020
         L     R13,44(R1)          YES. GET RCVD SENSE ADDRESS    M1005 38400020
         LTR   R13,R13             IS ADDRESS GIVEN?              M1005 38500020
         BZ    DPR211              NO. CHK IF TECB ADDR GIVEN     M1005 38600020
         SPACE                                                          38700020
         SR    R7,R7               CLEAR REG                      M1005 38800020
         IC    R7,15(R12)          GET SENSE BYTE COUNT           M1005 38900020
         LTR   R7,R7               IS IT 0?                       M1005 39000020
         BZ    DPR212              YES. BRANCH                    M1005 39100020
DPR210A  MVC   PB+1(8),=C'RCVD SNS'  LOAD IN PRINT BUFFER         M1005 39200020
         TM    1(R12),X'02'        IS THERE A SENSE ERROR?        M1005 39300020
         BZ    DPR210B             NO. BRANCH                     M1005 39400020
         MVI   PB,C'*'             YES. IDENTIFY IT WITH AN *     M1005 39500020
DPR210B  BAL   R10,DPR218AA        LOAD SENSE INFO IN PRINT BUFR  M1005 39600020
         B     DPR230              GO CHECK FOR DATA PRINT        M1005 39700020
         SPACE                                                          39800020
* GET RECEIVED SENSE DATA FROM TECB                                     39900020
         SPACE                                                          40000020
DPR211   DS    0H                                                Y01906 40100002
         LTR   R3,R3                   ZERO?                     Y01906 40200002
         BZ    DPR212                  BR IF YES                  M1005 40300002
         BAL   R10,DPR213          GET RCVD SENSE FROM TECB       M1005 40400020
         B     DPR210A             GO LOAD IT IN PRINT BUFFER     M1005 40500020
DPR212   MVI   DPRTRNCD,X'0C'      SET RETURN CODE 0C             M1005 40600020
         B     DPR230              GO CHECK FOR DATA PRINT        M1005 40700020
         SPACE                                                          40800020
DPR213   ST    R10,SAVER10         SAVE R10                       M1005 40900020
         SR    R10,R10             CLEAR REG                      M1005 41000020
         SR    R14,R14             CLEAR REG                      M1005 41100020
         IC    R10,TCBSNOC             GET NO FLDS TO CHK        Y01906 41150002
         CLC   TCBSNOC(1),TCBSNCT  COMPARE EVENT COUNT TO FLD CNT M1005 41200020
         BC    12,DPR215               BR IF EVNT CNT LE FLD CNT Y01906 41300002
         IC    R10,TCBSNCT         GET NUMBER OF FLDS TO CHECK    M1005 41400020
DPR215   LTR   R10,R10             IS IT 0?                       M1005 41800020
         BNZ   DPR215B                 NO-BRANCH                 Y01906 41900002
DPR215A  DS    0H                                                Y01906 41920002
         OI    DPRFLAG,DPRSCHFL        TURN ON FAIL FLAG         Y01906 41940002
         B     DPR218                  GO RTRN                   Y01906 41960002
DPR215B  DS    0H                                                Y01906 41980002
         LH    R14,TCBSNLN         NO. GET FIELD LENGTH           M1005 42000020
         SR    R6,R6               CLEAR REG                      M1005 42100020
         SR    R7,R7               CLEAR REG                      M1005 42200020
         SR    R8,R8               CLEAR REG                      M1005 42300020
         IC    R7,TCBFDLN          GET FIELD SIZE                 M1005 42400020
         IC    R8,TCBFDCT          GET NUMBER OF FIELDS           M1005 42500020
         MR    R6,R8               MULTIPLY BY NUMBER OF FIELDS   M1005 42600020
         LA    R8,8                ADD 8 TO                       M1005 42700020
         AR    R7,R8               TOTAL LENGTH OF FIELDS         M1005 42800020
         AR    R7,R3                   POINT TO 1ST TECB SNSFLD  Y01906 42900002
         LR    R13,R7              PUT SENSE FIELD ADDRESS IN R13 M1005 43000020
         SPACE                                                          43100020
DPR216   CLC   0(3,R13),DPRDEVAD+1  CHK DEV ADDR FOR RIGHT FIELD  M1005 43200020
         BE    DPR217              YES. BRANCH TO GET SENSE INFO  M1005 43300020
         AR    R13,R14             NO. BUMP TO NEXT FIELD         M1005 43400020
         BCT   R10,DPR216          GO CHECK FIELD                 M1005 43500020
         B     DPR215A                 NO FLD FOUND              Y01906 43600002
         SPACE                                                          43700020
DPR217   LA    R13,3(R13)          POINT TO SENSE DATA            M1005 43800020
         SR    R7,R7               CLEAR REG                      M1005 43900020
         IC    R7,15(R12)          GET RCVD SNS CNT FROM PARM LISTM1005 44000020
         LTR   R7,R7               IS IT 0?                       M1005 44100020
         BNZ   DPR218              NO. BRANCH                     M1005 44200020
         LH    R7,TCBSNLN              GET TECB RCVD SNS CNT     Y01906 44300002
         SH    R7,THREE                MINUS 3                   Y01906 44350002
         LTR   R7,R7               IS IT 0?                       M1005 44400020
         BZ    DPR215A                 YES-BRANCH                Y01906 44500002
DPR218   L     R10,SAVER10         RESTORE REG                    M1005 44600020
         BR    R10                 RETURN                         M1005 44700020
         SPACE                                                          44800020
* CONVERT EXPECTED OR RECEIVED SENSE DATA AND LOAD PRINT BUFFER   M1005 44900020
         SPACE                                                          45000020
DPR218AA ST    R10,SAVER10         SAVE REG                       M1005 45100020
DPR218AB DS    0H                                                Y01906 45200002
         TM    DPRFLAG,DPRSCHFL        SEARCH FAIL?              Y01906 45210002
         BZ    DPR218AC                NO- BRANCH                Y01906 45220002
         MVC   PB+12(4),DPRNONE        YES-SAY NONE              Y01906 45230002
         OI    DPRFLAG,DPRLINE         TURN ON LAST LINE FLG     Y01906 45240002
         B     DPR219A                 GO                        Y01906 45250002
DPR218AC DS    0H                                                Y01906 45260002
         LA    R14,WRK                 GET OUTPUT ADDR FOR CNVRT Y01906 45270002
         CH    R7,MAXSNS           COUNT GREATER THAN LINE MAX?   M1005 45300020
         BNH   DPR218A             NO. BRANCH                     M1005 45400020
         LH    R15,MAXSNS          YES. PUT MAX COUNT IN R15      M1005 45500020
         B     DPR218B                                            M1005 45600020
         SPACE                                                          45700020
DPR218A  OI    DPRFLAG,DPRLINE     TURN ON LAST SENSE LINE FLAG   M1005 45800020
         LR    R15,R7              PUT COUNT IN R15               M1005 45900020
DPR218B  BAL   R10,DPRCNV          CONVERT RCVD SENSE TO EBCDIC   M1005 46000020
         LA    R6,PB+12            PRINT BUFR ADDR FOR FIRST BYTE M1005 46100020
         LA    R5,WRK              GET ADDR OF 1ST SENSE BYTE     M1005 46200020
DPR219   MVC   0(2,R6),0(R5)       MOVE SENSE ONE BYTE AT A TIME  M1005 46300020
         LA    R6,3(R6)            GET NEXT PRINT BUFR ADDRESS    M1005 46400020
         LA    R5,2(R5)            GET NEXT SENSE BYTE ADDRESS    M1005 46500020
         BCT   R15,DPR219          MOVE NEXT BYTE                 M1005 46600020
DPR219A  DS    0H                                                Y01906 46650002
         BAL   R10,DPRWRT          PRINT SENSE LINE               M1005 46700020
         TM    DPRFLAG,DPRLINE     LAST LINE?                     M1005 46800020
         BZ    DPR220              NO. BRANCH FOR NEXT LINE       M1005 46900020
         NI    DPRFLAG,255-DPRLINE  YES.  CLEAR FLAG              M1005 47000020
         L     R10,SAVER10         RESTORE R10                    M1005 47100020
         BR    R10                 RETURN TO XPTCD/RCVD RTN       M1005 47200020
         SPACE                                                          47300020
DPR220   AH    R13,MAXSNS          POINT TO NEXT LINE OF SENSE    M1005 47400020
         SH    R7,MAXSNS           SUBTRACT FOR REMAINING BYTES   M1005 47500020
         B     DPR218AB            GO SET UP NEXT LINE FOR PRINT  M1005 47600020
         SPACE                                                          47700020
*********************************************************************** 47800020
*        EXPECTED DATA                                                * 47900020
*********************************************************************** 48000020
         SPACE                                                          48100020
DPR230   MVI   DPRFLAG,X'00'           CLEAR IT                  Y01906 48200002
         TM    3(R12),X'80'            PRINT XPTD DATA?          Y01906 48250002
         BZ    DPR240              BR IF NO                             48300020
         L     R8,48(R1)           GET EXPECTED DATA ADDRESS            48400020
         MVC   WRK(2),17(R12)      GET EXPECTED DATA COUNT              48500020
         LH    R7,WRK              GET XPTD DATA COUNT                  48600020
         LA    R11,DPR240          GET RTRN ADDR                        48700020
         MVC   PB+1(9),=C'XPTD DATA'  MOVE 'XPTD DATA' TO PRINT BUFFER  48800020
         BAL   R9,DPR260           GO SET UP AND PRINT                  48900020
         SPACE                                                          49000020
*********************************************************************** 49100020
*        RECEIVED DATA                                                * 49200020
*********************************************************************** 49300020
         SPACE                                                          49400020
DPR240   TM    3(R12),X'40'        PRINT RCVD DATA?                     49500020
         BZ    DPR250              BR IF NO                             49600020
         L     R8,52(R1)           GET RECEIVED DATA ADDRESS            49700020
         MVC   WRK(2),19(R12)      GET RECEIVED DATA COUNT              49800020
         LH    R7,WRK              GET RCVD DATA COUNT                  49900020
         LA    R11,DPR250          GET RTRN ADDR                        50000020
         TM    3(R12),X'08'        RCVD DATA ERROR ?                    50100020
         BZ    DPR242              BR IF NO                             50200020
         MVI   PB,C'*'             PUT * IN LINE                        50300020
DPR242   MVC   PB+1(9),=C'RCVD DATA' MOVE 'RCVD DATA' TO PRINT BUFFER   50400020
         BAL   R9,DPR260           GO SET UP AND PRINT                  50500020
         SPACE                                                          50600020
         EJECT                                                          50700020
*********************************************************************** 50800020
*        WRITTEN DATA                                                 * 50900020
*********************************************************************** 51000020
         SPACE                                                          51100020
DPR250   TM    3(R12),X'20'        PRINT WRITTEN DATA ?                 51200020
         BZ    DPREXIT             NO.  EXIT RTN                        51300020
         L     R8,56(R1)           GET WRITTEN DATA ADDRESS             51400020
         MVC   WRK(2),21(R12)      GET WRITTEN DATA COUNT               51500020
         LH    R7,WRK              GET WRTN DATA COUNT                  51600020
         LA    R11,DPREXIT         GET EXIT RTN ADDRESS                 51700020
         MVC   PB+1(9),=C'WRTN DATA'  PUT 'WRTN DATA INTO PRINT BUFFER  51800020
         BAL   R9,DPR260           GO SET UP AND PRINT                  51900020
         B     DPREXIT             BRANCH TO EXIT MODULE                52000020
         SPACE                                                          52100020
DPR260   LTR   R8,R8               ADDR GIVEN ?                         52200020
         BNZ   DPR262              BR IF YES                            52300020
DPR261   MVI   DPRTRNCD,X'0C'      SET RETURN CODE 0C                   52400020
         XC    PB(10),PB           CLEAR BUFFER                         52500020
         BR    R11                 BRANCH TO EXIT RTN             M1005 52600020
DPR262   LTR   R7,R7               IS COUNT 0 ?                         52700020
         BZ    DPR261              BRANCH IF NO                   M1005 52800020
         SPACE                                                          52900020
DPR262A  TM    1(R12),X'08'        DON'T CONVERT BIT ON?          M1005 53000020
         BZ    DPR262B             NO.  BRANCH                    M1005 53100020
         MVI   LIMIT+1,50          YES. CHANGE LIMIT TO 50        M1005 53200020
DPR262B  CH    R7,LIMIT            MORE THAN 1 LINE?              M1005 53300020
         BNH   DPR263              BR IF NO                       M1005 53400020
         LH    R15,LIMIT           SET MAX COUNT                  M1005 53500020
         B     DPR264              GO SET UP FOR CONVERT          M1005 53600020
DPR263   LR    R15,R7              SET COUNT                      M1005 53700020
         OI    DPRFLAG,DPRLINE     TURN ON LAST LINE FLAG         M1005 53800020
         SPACE                                                          53900020
DPR264   TM    1(R12),X'08'        DONT CONVERT BIT ON            M1005 54000020
         BZ    DPR264A             YES. BRANCH                    M1005 54100020
         BCTR  R15,0               NO. SUBT 1 FOR MVC CNT         M1005 54200020
         EX    R15,DPRMVDAT        MOVE DATA TO PRINT BUFFER      M1005 54300020
         B     DPR264B                                            M1005 54400020
DPR264A  LR    R13,R8                                             M1005 54500020
         LA    R14,PB+11           GET OUTPUT ADDR FOR CONVERT    M1005 54600020
         BAL   R10,DPRCNV          GO CONVERT TO EBCDIC           M1005 54700020
DPR264B  BAL   R10,DPRWRT                                         M1005 54800020
         SPACE                                                          54900020
         TM    DPRFLAG,DPRLINE     LAST LINE?                           55000020
         BZ    DPR265              BR IF NO                             55100020
         NI    DPRFLAG,255-DPRLINE TURN OFF LAST LINE FLAG              55200020
         BR    R9                  RETURN                               55300020
         SPACE                                                          55400020
DPR265   AH    R8,LIMIT            POINT TO NEXT LINE OF DATA           55500020
         SH    R7,LIMIT            GET NO BYTES                         55600020
         B     DPR262A             GO SET UP FOR LINE PRINT             55700020
         SPACE                                                          55800020
DPRMVDAT MVC   PB+11(0),4(R8)                                     M1005 55900020
*********************************************************************** 56000020
*   ENTER HERE TO MOVE CSW/PSW INFO INTO PRINT BUFFER                 * 56100020
*********************************************************************** 56200020
         SPACE                                                          56300020
DPR450   ST    R10,DSAVERGS+20     SAVE R10                             56400020
         TM    DPRFLAG,DPRSCHFL+DPRQUED   FAIL?                  Y01906 56430002
         BCR   7,R11                   YES-GO BACK               Y01906 56460002
         LA    R14,WRK             GET OUTPUT ADDR FOR CONVERT          56500020
         LA    R15,8               GET COUNT                            56600020
         BAL   R10,DPRCNV          GO CONVERT                           56700020
         L     R10,DSAVERGS+20     RESOTRE R10                          56800020
         LA    R6,WRK                                                   56900020
         LA    R7,DPRMASK          POINT TO CSW MASK                    57000020
         TM    3(R12),X'01'        IS IT PSW PRINT?                     57100020
         BZ    DPR450A             BR IF NO                             57200020
         MVC   0(16,R5),0(R6)      PUT PSW IN BUFFER                    57300020
         B     DPR460                                                   57400020
DPR450A  MVC   0(19,R5),=C'XX XXXXXX XXXX XXXX'  SET UP FOR UNUSED      57500020
         TM    0(R7),X'80'         KEY GIVEN?                           57600020
         BO    DPR452              BR IF YES                            57700020
         SPACE                                                          57800020
         TM    0(R7),X'40'         CMND ADDR GIVEN?                     57900020
         BO    DPR454              BR IF YES                            58000020
         SPACE                                                          58100020
         TM    0(R7),X'20'         STATUS GIVEN?                        58200020
         BO    DPR456              BR IF YES                            58300020
         SPACE                                                          58400020
         TM    0(R7),X'10'         RESIDUAL COUNT GIVEN?                58500020
         BO    DPR458              BR IF YES                            58600020
         BR    R11                 RETURN                               58700020
         SPACE                                                          58800020
DPR452   MVC   0(2,R5),0(R6)       PUT KEY IN PRINT BUFFER              58900020
         LA    R6,2(R6)            POINT TO CMND ADDR                   59000020
         SPACE                                                          59100020
DPR454   TM    0(R7),X'40'         CMND ADDR GIVEN?                     59200020
         BZ    DPR460              BR IF NO                             59300020
         MVC   3(6,R5),0(R6)       PUT CMND ADDR IN PRINT BUFFER        59400020
         LA    R6,6(R6)            POINT TO STATUS                      59500020
         SPACE                                                          59600020
DPR456   TM    0(R7),X'20'         STATUS GIVEN?                        59700020
         BZ    DPR460              BR IF NO                             59800020
         MVC   10(4,R5),0(R6)      PUT STATUS IN PRINT BUFFER           59900020
         LA    R6,4(R6)            POINT TO RESIDUAL COUNT              60000020
         SPACE                                                          60100020
DPR458   TM    0(R7),X'10'         RESIDUAL COUNT GIVEN?                60200020
         BZ    DPR460              BR IF NO                             60300020
         MVC   15(4,R5),0(R6)      PUT RESIDUAL COUNT IN PRINT BUFFER   60400020
DPR460   BR    R11                 RETURN                               60500020
         SPACE                                                          60600020
         EJECT                                                          60700020
*********************************************************************** 60800020
*              RETURN TO SCAN SECTION                                 * 60900020
*********************************************************************** 61000020
         SPACE                                                          61100020
DPREXIT  L     R13,RSLTSA+4        ADDRESS OF CALLER'S SA               61200020
         MVC   16(4,R13),RETCODE   RETURN CODE TO R15 SAVE AREA LOC     61300020
         LM    R14,R12,12(R13)     RESTORE REGS                         61400020
         BR    R14                 RETURN                               61500020
         SPACE                                                          61600020
*********************************************************************** 61700020
*        PRINT RESULTS, DATA LINE VIA PARALLEL PRINT OUTPUT WRITER    * 61800020
*********************************************************************** 61900020
         SPACE                                                          62000020
DPRWRT   ST    R13,DSAVERGS        SAVE R13                       M1010 62100020
         LA    R13,RSLTSA          SAVE AREA ADDRESS              M1010 62200020
         OI    CESWT5,RSLTFLG      SET RESULTS LINE PRINT FLAG          62300020
         PWRT  SIZE=120                                         SA46329 62400001
         MVI   PB,C' '             CLEAR PRINT BUFFER WITH BLANKS       62500020
         MVC   PB+1(120),PB                                             62600020
         L     R1,SAVER1           RESTORE DPRINT PARAMETER PTR         62700020
         L     R12,4(R1)           ADDRESS OF DPRINT CTRL WORD          62800020
         L     R13,DSAVERGS        RESTORE R13                    M1010 62900020
         BR    R10                 RETURN TO CALLING ROUTINE            63000020
         EJECT                                                          63100020
*********************************************************************** 63200020
*        DPRCNV - HEX TO EBCDIC CONVERT                               * 63300020
*                                                                     * 63400020
*              CALL SEQ -  R13 = INPUT ADDRESS                        * 63500020
*                          R14 = OUTPUT ADDRESS                       * 63600020
*                          R15 = INPUT BYTE COUNT                     * 63700020
*                                                                     * 63800020
*                          BAL R10,DPRCNV                             * 63900020
*********************************************************************** 64000020
         SPACE                                                          64100020
DPRCNV   STM   R5,R6,DSAVERGS      SAVE R5,R6                           64200020
         STM   R13,R15,DSAVERGS+8  SAVE R13,R14,R15                     64300020
         SPACE                                                          64400020
         LTR   R15,R15            COUNT = 0 ?                           64500020
         BZ    DPRCNV8            YES. BYPASS CONVERT                   64600020
         AR    R14,R15         ADD COUNT TO OUTPUT ADDR.                64700020
         AR    R14,R15            ADD COUNT AGAIN.                      64800020
         AR    R13,R15            ADD COUNT TO INPUT ADDR.              64900020
         SR    R5,R5              CLEAR R5.                             65000020
         SR    R6,R6              CLEAR R6.                             65100020
         SPACE                                                          65200020
DPRCNV4  S     R14,=F'2'          GET ADDR OF LAST BYTE OF OUTPUT.      65300020
         BCTR  R13,0              GET ADDR OF LAST BYTE OF INPUT.       65400020
         IC    R6,0(R13)          GET HEX BYTE.                         65500020
         LR    R5,R6              PUT IN R5.                            65600020
         SRL   R6,4               GET BITS 0-3 IN R6.                   65700020
         N     R5,=F'15'          GET BITS 4-7 IN R5.                   65800020
         IC    R6,DPREBC(R6)      CONVERT BITS 0-3 TO EBCDIC CHAR.      65900020
         IC    R5,DPREBC(R5)      CONVERT BITS 4-7 TO EBCDIC CHAR.      66000020
         STC   R6,0(R14)          STORE 1ST EBCDIC CHAR IN OUTPUT.      66100020
         STC   R5,1(R14)          STORE 2ND EBCDIC CHAR IN OUTPUT.      66200020
         BCT   R15,DPRCNV4        GET NEXT HEX BYTE.                    66300020
DPRCNV8  LM    R5,R6,DSAVERGS      RESTORE R5,R6                        66400020
         LM    R13,R15,DSAVERGS+8  RESTORE R13,R14,R15                  66500020
         BR    R10                RETURN TO CALLER.                     66600020
         SPACE                                                          66700020
DPREBC   DC    C'0123456789ABCDEF' HEX TO EBCDIC CONVERT TABLE.         66800020
         SPACE 2                                                        66900020
*********************************************************************** 67000020
*              CONSTANTS, ETC.                                        * 67100020
*********************************************************************** 67200020
         SPACE                                                          67300020
RSLTSA   DS    18F                 REG SAVE AREA                        67400020
LIMIT   DC    H'25'               MAX NO. OF DATA BYTES PER LINE        67500020
MAXCNT   DC    H'61'               MAX NO. BYTES TO PRINT               67600020
MAXSNS  DC    H'17'               MAX NO. SNS BYTES PER LINE            67700020
THREE    DC    H'03'                                             Y01906 67750002
DPR600   MVC   PB(0),0(R11)       MOVE MSGE TO PRINT BUFFER.            67800020
DPR605   MVC   PB+1(0),0(R5)       MOVE DESC LINE TO PRINT BUFFER       67900020
         CNOP  0,8                                                      68000020
WRK      DS    12F                 WORKAREA                             68100020
SAVER1   DC    XL4'0'                                                   68200020
DSAVERGS DS    6F                  REG SAVE BUFRS                       68300020
DPRDEVAD DS    1F                  DEV ADDR                             68400020
DPROLTSP DC    XL4'0'              TO SAVE OLT SECT PREF ADDR           68500020
DPROLTLP DC    XL4'0'              TO SAVE OLT LOAD POINT ADR           68600020
RETCODE  DC    XL4'0'              RETURN CODE                          68700020
DPRTFORM DC    X'00'               FORMS                                68800020
DPRFLAG  DC    X'00'               FLAGS                                68900020
DPRMASK  DC    X'00'               CSW MASK                             69000020
DPRNONE  DC    C'NONE'                                           Y01906 69050002
DPRLINE  EQU   X'04'               LINECOUNT FLAG IN DPRFLAG            69100020
DPRSCHFL EQU   X'02'               SEARCH FAIL FLAG IN DPRFLAG          69200020
DPRSCH02 EQU   X'01'               SEARCH FOR CSW2 FLAG IN DPRFLAG      69300020
DPRLKCC  EQU   X'10'               CC FLAG IN DPRFLAG             21051 69350001
DPRTRNCD EQU   RETCODE+3                                                69400020
SAVER10  EQU   DSAVERGS+20                                              69500020
DPRQUED  EQU   X'80'                   Q FLAG IN DPRFLAG         Y01906 69530002
QUEUED   EQU   X'80'                   Q FLAG IN TECB            Y01906 69560002
         SPACE 2                                                        69700020
         LTORG                                                          69800020
         SPACE                                                          69900020
TECBMAP  DSECT                                                          70000020
TCBFDCT  DS    C                                                        70100020
TCBFDLN  DS    C                                                        70200020
TCBSNLN  DS    2C                                                       70300020
TCBFLGS  DS    C                                                        70400020
TCBSNCT  DS    C                                                        70500020
TCBSNOC  DS    C                                                        70600020
TCBEVOC  DS    C                                                        70700020
TCBFD01  DS    C                                                        70800020
         SPACE                                                          70900020
IFDOLT15 CSECT                                                   YM5407 70950002
DPRCOM   IFDCOM                                                         71000020
PB       EQU   PRTBUFR+1                                                71100020
         END                                                            71200020
