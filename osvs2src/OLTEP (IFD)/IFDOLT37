         TITLE '        NEW CECOM WTO/R INTERFACE--IFDOLT37.'           00010000
         PRINT OFF                                                      00020000
         MACRO                                                          00030000
&NAME    CECOM &OUTMSG=,&INMSG=,&OUTSD=,&FREE=,&POLL=,&MF=,            X00040000
               &MAP=NO,&LSTNAME=                                        00050000
.*                                                                      00060000
         GBLB  &EXECUTV,&E536454                                        00070000
         LCLA  &A,&COUNT                                                00080000
         LCLC  &F,&Z,&CHAR                                              00090000
.*                                                                      00100000
         AIF   ('&MAP' EQ 'YES').MAP1                                   00110000
         AIF   (T'&MF EQ 'O').STD                                       00120000
         AIF   ('&MF' EQ 'L' OR '&MF' EQ 'S').STD                       00130000
         AIF   ('&MF'(1,3) NE '(E,').MFERROR                            00140000
&CHAR    SETC  '&NAME'                                                  00150000
         AIF   ('&MF'(4,3) EQ '(1)').RG1                                00160000
         AIF   ('&MF'(4,1) EQ '(').RG2                                  00170000
&CHAR    LA    R1,&MF(2) .         ADDRESS OF PARAMETER LIST            00180000
&CHAR    SETC  ' '                                                      00190000
         AGO   .RG1                                                     00200000
.RG2     ANOP                                                           00210000
&COUNT   SETA  K'&MF(2)-2                                               00220000
&F       SETC  '&MF(2)'(2,&COUNT)                                       00230000
         AIF   ('&F'(1,1) EQ 'R').C724                                  00240000
&CHAR    LR    R1,R&F .            ADDRESS OF PARAMETER LIST            00250000
&CHAR    SETC  ' '                                                      00260000
         AGO   .RG1                                                     00270000
.C724    ANOP                                                           00280000
&CHAR    LR    R1,&F .             ADDRESS OF PARAMETER LIST            00290000
&CHAR    SETC  ' '                                                      00300000
.RG1     ANOP                                                           00310000
&CHAR    BAL   R14,#EXIT .         BRANCH TO LINKAGE SUBROUTINE         00320000
         MEXIT                                                          00330000
.MFERROR MNOTE 8,'MF VALUE (&MF) INCORRECT, NO STATEMENTS GENERATED.'   00340000
         MEXIT                                                          00350000
.STD     ANOP                                                           00360000
         AIF   (T'&FREE NE 'O').FREE                                    00370000
         AIF   (T'&POLL NE 'O').POLL                                    00380000
         AIF   (T'&OUTMSG EQ 'O').ERR1                                  00390000
         AIF   (N'&OUTMSG EQ 1).ERR2                                    00400000
         AGO   .NO3                                                     00410000
.FREE    ANOP                                                           00420000
         AIF   (T'&OUTMSG NE 'O' OR T'&INMSG NE 'O').ERR4               00430000
         AIF   (T'&POLL NE 'O' OR T'&OUTSD NE 'O').ERR4                 00440000
&A       SETA  64                                                       00450000
         AGO   .NO3                                                     00460000
.POLL    ANOP                                                           00470000
         AIF   (T'&OUTMSG NE 'O' OR T'&INMSG NE 'O').ERR4               00480000
         AIF   (T'&FREE NE 'O' OR T'&OUTSD NE 'O').ERR4                 00490000
&A       SETA  32                                                       00500000
.NO3     ANOP                                                           00510000
         AIF   (T'&INMSG EQ 'O').NO3A                                   00520000
         AIF   (N'&INMSG NE 2).ERR3                                     00530000
.NO3A    ANOP                                                           00540000
         AIF   (T'&OUTSD EQ 'O').NO5A                                   00550000
         AIF   (T'&OUTMSG NE 'O' AND T'&INMSG NE 'O').NO5               00560000
         MNOTE 8,'OUTSD WITHOUT BOTH OUTMSG AND INMSG INVALID'          00570000
         MEXIT                                                          00580000
.NO5     ANOP                                                           00590000
&A       SETA  128                                                      00600000
.NO5A    ANOP                                                           00610000
         AIF   ('&MF(1)' EQ 'L').LST                                    00620000
&NAME    LA    R14,R&SYSNDX        RETURN ADDRESS                       00630000
         CNOP  0,4                                                      00640000
         BAL   R1,#EXIT .          BRANCH TO LINKAGE SUBROUTINE         00650000
&CHAR    SETC  '&LSTNAME'                                               00660000
         AGO   .STD1                                                    00670000
.LST     ANOP                                                           00680000
&CHAR    SETC  '&NAME'                                                  00690000
.STD1    ANOP                                                           00700000
         AIF   (&EXECUTV).OLTSEP                                        00710000
&CHAR    DC    B'00000000' .       CONTROL PROGRAM FLAGS                00720000
         AGO   .OLTSEP1                                                 00730000
.OLTSEP  ANOP                                                           00740000
&CHAR    DC    B'00000001' .       CONTROL PROGRAM FLAGS                00750000
.OLTSEP1 ANOP                                                           00760000
         DC    AL1(2) .            MACRO LEVEL                          00770000
         DC    CL2'37' .           MACRO ID                             00780000
         AIF   (T'&OUTMSG NE 'O').NO6                                   00790000
         DC    A(0) .              OUTMSG ADDRESS                       00800000
         DC    A(0) .              OUTMSG COUNT                         00810000
         AGO   .NO6A                                                    00820000
.NO6     ANOP                                                           00830000
         DC    A(&OUTMSG(1)) .     OUTMSG ADDRESS                       00840000
         DC    A(&OUTMSG(2)) .     OUTMSG COUNT                         00850000
.NO6A    ANOP                                                           00860000
         AIF   (T'&INMSG NE 'O').NO7                                    00870000
         DC    A(0) .              INMSG ADDRESS                        00880000
         DC    A(0) .              INMSG COUNT                          00890000
         AGO   .NO9                                                     00900000
.NO7     ANOP                                                           00910000
         DC    A(&INMSG(1)) .      INMSG ADDRESS                        00920000
         DC    A(&INMSG(2)) .      INMSG COUNT                          00930000
.NO9     ANOP                                                           00940000
         DC    AL1(&A) .           FLAGS                                00950000
** FLAGS                                                                00960000
** POLL  32                                                             00970000
** FREE  64                                                             00980000
** OUTSD 128                                                            00990000
         AIF   ('&MF' EQ 'L').EXIT                                      01000000
R&SYSNDX DS    0H                                                       01010000
         MEXIT                                                          01020000
.ERR1    MNOTE 8,'NO OUTMSG OPERAND'                                    01030000
         MEXIT                                                          01040000
.ERR2    MNOTE 8,'INVALID OUTMSG PARAMETER'                             01050000
         MEXIT                                                          01060000
.ERR3    ANOP                                                           01070000
         MNOTE 8,'INVALID INMSG OPERAND'                                01080000
         MEXIT                                                          01090000
.ERR4    ANOP                                                           01100000
         MNOTE 8,'FREE OR POLL OPERAND MUST BE ALONE'                   01110000
         MEXIT                                                          01120000
.MAP1    ANOP                                                           01130000
CECOMMAP DSECT                                                          01140000
&Z       SETC  '$'                                                      01150000
         AIF   (&E536454).ZIPPER                                        01160000
           DC  XL1'0' .            CONTROL PROGRAM FLAGS                01170000
           DC  XL1'0' .            MACRO LEVEL                          01180000
           DC  XL2'0' .            MACRO ID                             01190000
         AGO   .ZIPPED                                                  01200000
.ZIPPER  ANOP                                                           01210000
&Z.CECTRMG DC  XL1'0' .            CONTROL PROGRAM FLAGS                01220000
&Z.CECLEVL DC  XL1'0' .            MACRO LEVEL                          01230000
&Z.CECIDNT DC  XL2'0' .            MACRO ID                             01240000
.ZIPPED  ANOP                                                           01250000
&Z.CEOUTAD DC  A(0) .              ADDRESS OF OUTPUT MESSAGE            01260000
&Z.CEOUTCT DC  A(0) .              LENGTH  OF OUTPUT MESSAGE            01270000
&Z.CEINADR DC  A(0) .              ADDRESS OF INPUT  MESSAGE            01280000
&Z.CEINCT  DC  A(0) .              LENGTH  OF INPUT  MESSAGE            01290000
&Z.CECFLAG DC  XL1'0' .            FLAGS                                01300000
.EXIT    MEND                                                           01310000
         EJECT                                                          01320000
         PRINT ON                                                       01330000
         LCLA  &T,&SPN                                            0002  01340000
.@001    ANOP                                                     0002  01350000
IFDOLT37 CSECT ,                                                  0002  01360000
         BC    15,24(0,@F)                                              01370000
         DC    C'IFDOLT37 14 SEP 73'                             0002  01380000
         ST    @E,12(0,@D)                                        0002  01390000
         STM   @0,@C,20(@D)                                       0002  01400000
         BALR  @B,0                                               0002  01410000
@PSTART  DS    0H                                                 0002  01420000
         USING @PSTART+00000,@B                                   0002  01430000
         ST    @D,@SAV001+4                                       0002  01440000
         LA    @F,@SAV001                                         0002  01450000
         ST    @F,8(0,@D)                                         0002  01460000
         LR    @D,@F                                              0002  01470000
*         GEN   (USING CHASCT,2);                                       01480000
         USING CHASCT,2                                                 01490000
         DS    0H                                                       01500000
*         GENERATE DATA;                                                01510000
*         RESTRICT(2,6);                 /* REGISTERS USED BY PROGRAM * 01520000
*         DCL R0 REG(0) PTR;             /* CONTAINS ADDRESS OF ROPT  * 01530000
*         DCL R1 REG(1) PTR;             /* ADDRESS OF PARAMETER LIST * 01540000
*         DCL R4 REG(4) PTR;             /* REPLY COUNT               * 01550000
*         DCL R6 REG(6) PTR;             /* ADDRESS OF PARAMETER LIST * 01560000
*         DCL R14 REG(14) PTR;           /* RETURN REGISTER           * 01570000
*         DCL R15 REG(15) PTR;           /* RETURN CODE REGISTER      * 01580000
*         DCL ECBCE37 FIXED INIT(0);     /* ECB USED BY WTOR AND WAIT * 01590000
*   GEN(EJECT);                                                         01600000
         EJECT                                                          01610000
         DS    0H                                                       01620000
*         /************************************************************ 01630000
*         /* THE FOLLOWING LABELS DEFINE IFDOLT37 REFERENCES TO THE   * 01640000
*         /* CECOM PARAMETER LIST. THEY ARE FOLLOWED BY THE MAP       * 01650000
*         /* SUPPLIED BY DIAGNOSTIC ENGINEERING WITH EQUATED LABELS.  * 01660000
*         /************************************************************ 01670000
*         DCL TRNMGR CHAR(1) GENERATED;  /* INDICATORS                * 01680000
*         DCL LEVEL CHAR(1) GENERATED;   /* MACRO LEVEL               * 01690000
*         DCL MACID CHAR(2) GENERATED;   /* MACRO ID                  * 01700000
*         DCL OUTMSGAD PTR GENERATED;    /* ADDRESS OF OUTPUT MESSAGE * 01710000
*         DCL OUTCNT FIXED GENERATED;    /* LENGTH OF OUTPUT MESSAGE  * 01720000
*         DCL INMSGAD PTR GENERATED;     /* ADDRESS OF INPUT MESSAGE  * 01730000
*         DCL INCNT FIXED GENERATED;     /* IN MESSAGE COUNT          * 01740000
*         DCL FLAGS CHAR(1) GENERATED;   /* FLAG AREA-OUTSD,FREE,POLL * 01750000
*         DECLARE                                                       01760000
*             1 * BASED(ADDR(INCNT)),    /* IN MESSAGE COUNT AREA     * 01770000
*               2 * CHAR(3),             /* NOT USED                  * 01780000
*               2 INCNT3 CHAR(1);        /* IN MESSAGE LENGTH         * 01790000
*   GEN(  USING CECOMMAP,6);             /* PARAMETER LIST POINTER    * 01800000
           USING CECOMMAP,6                                             01810000
         DS    0H                                                       01820000
*   GENERATE DATA;                                                      01830000
*         DCL IFDMSG37 EXT ENTRY;         /* IFDOLT37 MESSAGE MODULE  * 01840000
*         DCL   MSGMOD37 PTR INIT(ADDR(IFDMSG37)); /* ADDRESS OF      * 01850000
*                                                  /* MESSAGE MODULE  * 01860000
*   GEN(EJECT);                                                         01870000
         EJECT                                                          01880000
         DS    0H                                                       01890000
*         /************************************************************ 01900000
*         /* THE FOLLOWING MAP DESCRIBES THE POINTERS TO THE LIST     * 01910000
*         /* FORM OF WTO'S AND WTOR'S IN MESSAGE MODULE IFDMSG37.     * 01920000
*         /************************************************************ 01930000
*         DECLARE                                                       01940000
*             1 * BASED(MSGMOD37),       /* MESSAGE MODULE ADDRESS    * 01950000
*               2 WTOPTR PTR,            /* ADDRESS OF WTO IFD100I    * 01960000
*               2 WTORPTR PTR;           /*ADDRESS WTOR IFD101D X02008* 01970000
*         DECLARE                                                       01980000
*             1 * BASED(WTOPTR),         /* LIST FORM OF WTO          * 01990000
*               2 WTOLEN PTR(15),        /* MESSAGE LENGTH            * 02000000
*               2 * CHAR(10),            /* MESSAGE ID                * 02010000
*               2 MSAGE CHAR(63);        /* MESSAGE AREA              * 02020000
*         DECLARE                                                       02030000
*             1 * BASED(WTORPTR),        /* LIST FORM OF WTOR         * 02040000
*               2 REPLYCNT CHAR(1),      /* WTOR REPLY COUNT          * 02050000
*               2 INBUFRAD PTR(24),      /* REPLY BUFFER ADDRESS      * 02060000
*               2 ECBCE37A PTR,          /* REPLY ECB ADDRESS         * 02070000
*               2 WTORLEN PTR(15),       /* MESSAGE LENGTH            * 02080000
*               2 * CHAR(10),            /* MESSAGE ID                * 02090000
*               2 WRMSAGE CHAR(63);      /* MESSAGE AREA              * 02100000
*   GEN(EJECT);                                                         02110000
         EJECT                                                          02120000
         DS    0H                                                       02130000
*         /************************************************************ 02140000
*         /* THE FOLLOWING MAP DESCRIBES THE AREA'S GENERATED BY      * 02150000
*         /* OLTEP'S COMMON AREA DSECT MAPPING.                       * 02160000
*         /************************************************************ 02170000
*         DCL INBUFR CHAR(72) GENERATED;      /* INPUT BUFFER         * 02180000
*         DECLARE                                                       02190000
*             1 * BASED(INMSGAD),                                       02200000
*               2 INRPCNT CHAR(1),       /* REPLY LENGTH RECEIVED     * 02210000
*               2 UTINMSG CHAR(61);      /* OLT REPLY BUFFER AREA     * 02220000
*         DCL UTOUTMSG CHAR(61) BASED(OUTMSGAD); /* OUT MESSAGE AREA  * 02230000
*         DCL   RESCNT37 CHAR(1);        /* ACTUAL REPLY LENGTH       * 02240000
*         DCL   OUTMSCNT FIXED;          /* ACTUAL MESSAGE LENGTH     * 02250000
*   GEN(EJECT);                                                         02260000
         EJECT                                                          02270000
         DS    0H                                                       02280000
*  /* THE FOLLOWING BITS ARE OLTEP'S ROUTING & DESCRIPTOR CODES       * 02290000
*         DCL ROUTCD BIT(32) INIT('00000010000000000000000001000000'B); 02300000
*   GEN(EJECT);                                                         02310000
         EJECT                                                          02320000
         DS    0H                                                       02330000
*         /************************************************************ 02340000
*         /* THE FOLLOWING CODE WILL TAKE CARE OF EVERYTHING.         * 02350000
*         /************************************************************ 02360000
*         R6 = R1;                       /* POINT REG 6 TO PARM LIST  * 02370000
         LR    @6,@1                                              0040  02380000
*         IF LEVEL ^= '02'X THEN         /* NOT A LEVEL 2 MACRO       * 02390000
         CLI   LEVEL,X'02'                                        0041  02400000
         BC    08,@9FF                                            0041  02410000
*           DO;                                                         02420000
*           R15 = '04'X;                 /* SET RETURN CODE HEX 4     * 02430000
         LA    @F,X'04'                                           0043  02440000
*           GO TO FINISH;                /* BRANCH TO EXIT ROUTINE    * 02450000
         BC    15,FINISH                                          0044  02460000
*           END;                         /* END-NOT LEVEL 2 MACRO RTN * 02470000
*       IF OUTMSGAD = 0 THEN             /* NON-MESSAGE REQUEST       * 02480000
@9FF     SR    @F,@F                                              0046  02490000
         C     @F,OUTMSGAD                                        0046  02500000
*           GO TO RTRN8;                 /* ERROR RETURN POINT. X02008* 02510000
         BC    08,RTRN8                                           0047  02520000
*         IF OUTCNT < '01'X THEN        /* IF COUNT IS ZERO           * 02530000
         LA    @F,X'01'                                           0048  02540000
         C     @F,OUTCNT                                          0048  02550000
         BC    12,@9FE                                            0048  02560000
*           DO;                         /* DO THE FOLLOWING:          * 02570000
* RTRN8:                                 /* LABEL               X02008* 02580000
*           R15 = '08'X;                /* SET ERROR RETURN CODE 8    * 02590000
RTRN8    LA    @F,X'08'                                           0050  02600000
*           GO TO FINISH;               /* BRANCH TO EXIT ROUTINE     * 02610000
         BC    15,FINISH                                          0051  02620000
*           END;                        /* END OF OUT COUNT CHECK     * 02630000
*         IF OUTCNT > 61 THEN            /* IF OUT MESSAGE LENGTH IS  * 02640000
@9FE     LA    @F,61                                              0053  02650000
         C     @F,OUTCNT                                          0053  02660000
         BC    10,@9FD                                            0053  02670000
*           OUTMSCNT = 61;               /* GREATER THAN 61-SET TO 61 * 02680000
         ST    @F,OUTMSCNT                                        0054  02690000
         BC    15,@9FC                                            0055  02700000
*         ELSE                           /* IF NOT GREATER            * 02710000
*           OUTMSCNT = OUTCNT;           /* SET ACTUAL LENGTH         * 02720000
@9FD     MVC   OUTMSCNT(4),OUTCNT                                 0055  02730000
*         IF INMSGAD = 0 THEN            /* IS WTOR REQUESTED         * 02740000
@9FC     SR    @F,@F                                              0056  02750000
         C     @F,INMSGAD                                         0056  02760000
*           GO TO SETWTO;                /* NO-BRANCH TO WTO ROUTINE  * 02770000
         BC    08,SETWTO                                          0057  02780000
*         IF INCNT < '01'X THEN          /* IF INCOUNT IS ZERO   M1005* 02790000
         LA    @F,X'01'                                           0058  02800000
         C     @F,INCNT                                           0058  02810000
         BC    12,@9FB                                            0058  02820000
*           DO;                          /* DO THE FOLLOWING:         * 02830000
*           R15 = '08'X;                 /* SET ERROR RETURN CODE 8   * 02840000
         LA    @F,X'08'                                           0060  02850000
*           GO TO FINISH;                /* BRANCH TO EXIT ROUTINE    * 02860000
         BC    15,FINISH                                          0061  02870000
*           END;                         /* END OF IN COUNT CHECK     * 02880000
*         IF INCNT> 61 THEN              /* IF IN MSG LENGTH IS  M1005* 02890000
@9FB     LA    @F,61                                              0063  02900000
         C     @F,INCNT                                           0063  02910000
         BC    10,@9FA                                            0063  02920000
*           RESCNT37 = '3D'X;            /* GREATER THAN 61-SET TO 61 * 02930000
         MVI   RESCNT37,X'3D'                                     0064  02940000
         BC    15,@9F9                                            0065  02950000
*         ELSE                           /* IF NOT GREATER            * 02960000
*           RESCNT37 = INCNT3;           /* SET LENGTH           M1005* 02970000
@9FA     MVC   RESCNT37(1),A00000+3                               0065  02980000
*         GO TO SETWTOR;                 /* GO TO WTOR ROUTINE  X02008* 02990000
         BC    15,SETWTOR                                         0066  03000000
*   GEN(EJECT);                                                         03010000
         EJECT                                                          03020000
         DS    0H                                                       03030000
*         /************************************************************ 03040000
*         /* THE FOLLOWING CODE WILL HANDLE WTO REQUESTS.             * 03050000
*         /************************************************************ 03060000
* SETWTO:                                                               03070000
*         WTOLEN = OUTMSCNT+12;          /* SET OUT MESSAGE LENGTH    * 03080000
SETWTO   LA    @F,12                                              0068  03090000
         A     @F,OUTMSCNT                                        0068  03100000
         L     @3,MSGMOD37                                        0068  03110000
         L     @3,0(0,@3)          A00002                         0068  03120000
         STH   @F,0(0,@3)                                         0068  03130000
*         MSAGE(OUTMSCNT+1:OUTMSCNT+5)=ROUTCD; /* SET ROUTING & DESC  * 03140000
         LA    @E,ROUTCD                                          0069  03150000
         LA    @7,5                                               0069  03160000
         A     @7,OUTMSCNT                                        0069  03170000
         LA    @C,1                                               0069  03180000
         A     @C,OUTMSCNT                                        0069  03190000
         SR    @7,@C                                              0069  03200000
         LA    @A,11(@C,@3)                                       0069  03210000
         EX    @7,@MVC                                            0069  03220000
*         MSAGE(1:OUTMSCNT) = UTOUTMSG(1:OUTMSCNT); /* SETUP MESSAGE  * 03230000
         L     @7,OUTMSGAD                                        0070  03240000
         LR    @E,@7                                              0070  03250000
         L     @8,OUTMSCNT                                        0070  03260000
         BCTR  @8,0                                               0070  03270000
         LA    @A,12(0,@3)                                        0070  03280000
         EX    @8,@MVC                                            0070  03290000
*         R1 = WTOPTR;                   /* SET POINTER TO WTO        * 03300000
         L     @8,MSGMOD37                                        0071  03310000
         L     @1,0(0,@8)                                         0071  03320000
*   GEN(  PWTO  REG=(1));                /* INVOKE PARALLEL PRINT RTN * 03330000
           PWTO  REG=(1)                                                03340000
         DS    0H                                                       03350000
*         R15 = '00'X;                   /* SET NORMAL RETURN CODE    * 03360000
         LA    @F,X'00'                                           0073  03370000
*         GO TO FINISH;                  /* BRANCH TO EXIT ROUTINE    * 03380000
         BC    15,FINISH                                          0074  03390000
*         /*                *** END OF WTO ROUTINE ***                * 03400000
*   GEN(EJECT);                                                         03410000
         EJECT                                                          03420000
         DS    0H                                                       03430000
*         /************************************************************ 03440000
*         /* THE FOLLOWING CODE WILL HANDLE WTOR REQUESTS.            * 03450000
*         /************************************************************ 03460000
* SETWTOR:                                                              03470000
*         REPLYCNT = RESCNT37;           /* SET ACTUAL REPLY LENGTH   * 03480000
SETWTOR  L     @3,MSGMOD37                                        0076  03490000
         L     @3,4(0,@3)          A00002                         0076  03500000
         MVC   0(1,@3),RESCNT37                                   0076  03510000
*         INBUFRAD = ADDR(INBUFR);       /* SET REPLY BUFFER ADDRESS  * 03520000
         LA    @F,INBUFR                                          0077  03530000
         ST    @F,@TEMP4                                          0077  03540000
         MVC   1(3,@3),@TEMP4+1                                   0077  03550000
*         ECBCE37A = ADDR(ECBCE37);      /* SET REPLY ECB ADDRESS     * 03560000
         LA    @F,ECBCE37                                         0078  03570000
         ST    @F,4(0,@3)                                         0078  03580000
*         WTORLEN = OUTMSCNT+12;         /* SET OUT MESSAGE LENGTH    * 03590000
         LA    @F,12                                              0079  03600000
         A     @F,OUTMSCNT                                        0079  03610000
         STH   @F,8(0,@3)                                         0079  03620000
*       WRMSAGE(OUTMSCNT+1:OUTMSCNT+5)=ROUTCD; /* SET ROUTING & DESC  * 03630000
         LA    @E,ROUTCD                                          0080  03640000
         LA    @7,5                                               0080  03650000
         A     @7,OUTMSCNT                                        0080  03660000
         LA    @C,1                                               0080  03670000
         A     @C,OUTMSCNT                                        0080  03680000
         SR    @7,@C                                              0080  03690000
         LA    @A,19(@C,@3)                                       0080  03700000
         EX    @7,@MVC                                            0080  03710000
*         WRMSAGE(1:OUTMSCNT) = UTOUTMSG(1:OUTMSCNT);/* SETUP MESSAGE * 03720000
         L     @7,OUTMSGAD                                        0081  03730000
         LR    @E,@7                                              0081  03740000
         L     @8,OUTMSCNT                                        0081  03750000
         BCTR  @8,0                                               0081  03760000
         LA    @A,20(0,@3)                                        0081  03770000
         EX    @8,@MVC                                            0081  03780000
*         INBUFR = INBUFR && INBUFR;     /* ZERO OUT REPLY BUFFER.    * 03790000
         XC    INBUFR(72),INBUFR                                  0082  03800000
*         ECBCE37 = 0;                   /* ZERO OUT REPLY ECB        * 03810000
         SR    @F,@F                                              0083  03820000
         ST    @F,ECBCE37                                         0083  03830000
*         R1 = WTORPTR;                  /* SET WTOR POINTER          * 03840000
         L     @8,MSGMOD37                                        0084  03850000
         L     @1,4(0,@8)                                         0084  03860000
*   GENERATE;                                                           03870000
         PWTOR REG=(1)             INVOKE PARALELL PRINT ROUNTINE       03880000
         DS    0H                                                       03890000
*         RESTRICT(R4);                                                 03900000
*         DO R4 = 1 BY 1 TO RESCNT37;    /* SCAN REPLY BUFFER FOR CNT * 03910000
         LA    @4,1                                               0087  03920000
         BC    15,@DO9F7                                          0087  03930000
*            IF INBUFR(R4) = '00'X THEN  /* SHORT RESPONSE WILL BE    * 03940000
@DO9F8   LR    @3,@4                                              0088  03950000
         LA    @A,INBUFR-1(@3)                                    0088  03960000
         CLI   0(@A),X'00'                                        0088  03970000
*             GO TO SHRTRPLY;            /* PADDED WITH HEX ZERO'S    * 03980000
         BC    08,SHRTRPLY                                        0089  03990000
*         END;                                                          04000000
*         INRPCNT = RESCNT37;            /* SET CNT IN 1ST BYTE OF    * 04010000
         AH    @4,@D1                                             0090  04020000
@DO9F7   SR    @0,@0                                              0090  04030000
         IC    @0,RESCNT37                                        0090  04040000
         CR    @4,@0                                              0090  04050000
         BC    12,@DO9F8                                          0090  04060000
         L     @3,INMSGAD                                         0091  04070000
         MVC   0(1,@3),RESCNT37                                   0091  04080000
*         GO TO SKIPSHRT;                /* CALLER'S REPLY BUFFER     * 04090000
         BC    15,SKIPSHRT                                        0092  04100000
* SHRTRPLY:                                                             04110000
*         INRPCNT = R4-1;                /* SET CNT IN OLT BUFFER     * 04120000
SHRTRPLY LR    @F,@4                                              0093  04130000
         BCTR  @F,0                                               0093  04140000
         L     @3,INMSGAD                                         0093  04150000
         STC   @F,0(0,@3)                                         0093  04160000
* SKIPSHRT:                                                             04170000
*         RELEASE(4);                                                   04180000
*         UTINMSG(1:RESCNT37) = INBUFR(1:RESCNT37); /* MOVE REPLY     * 04190000
SKIPSHRT LA    @E,INBUFR                                          0095  04200000
         SR    @3,@3                                              0095  04210000
         IC    @3,RESCNT37                                        0095  04220000
         BCTR  @3,0                                               0095  04230000
         L     @7,INMSGAD                                         0095  04240000
         LA    @A,1(0,@7)                                         0095  04250000
         EX    @3,@MVC                                            0095  04260000
*                                                   /* TO OUT AREA    * 04270000
*         R15 = '00'X;                   /* SET NORMAL RETURN CODE    * 04280000
         LA    @F,X'00'                                           0096  04290000
* FINISH:                                /* EXIT ROUTINE              * 04300000
*         RETURN;                        /* RETURN TO CALLER          * 04310000
*         END   IFDOLT37;                /* END OF IFDOLT37           * 04320000
@EL01    L     @D,4(0,@D)                                         0098  04330000
         L     @E,12(0,@D)                                        0098  04340000
         LM    @0,@C,20(@D)                                       0098  04350000
         BCR   15,@E                                              0098  04360000
@DATA1   EQU   *                                                        04370000
@0       EQU   00                  EQUATES FOR REGISTERS 0-15           04380000
@1       EQU   01                                                       04390000
@2       EQU   02                                                       04400000
@3       EQU   03                                                       04410000
@4       EQU   04                                                       04420000
@5       EQU   05                                                       04430000
@6       EQU   06                                                       04440000
@7       EQU   07                                                       04450000
@8       EQU   08                                                       04460000
@9       EQU   09                                                       04470000
@A       EQU   10                                                       04480000
@B       EQU   11                                                       04490000
@C       EQU   12                                                       04500000
@D       EQU   13                                                       04510000
@E       EQU   14                                                       04520000
@F       EQU   15                                                       04530000
@D1      DC    H'1'                                                     04540000
@MVC     MVC   0(1,@A),0(@E)                                            04550000
         DS    0F                                                       04560000
         DS    0D                                                       04570000
@DATA    EQU   *                                                        04580000
@SAV001  EQU   @DATA+00000000      72 BYTE(S) ON WORD                   04590000
X        EQU   00000000            FULLWORD INTEGER                     04600000
R0       EQU   00000000            FULLWORD POINTER REGISTER            04610000
R1       EQU   00000001            FULLWORD POINTER REGISTER            04620000
R4       EQU   00000004            FULLWORD POINTER REGISTER            04630000
R6       EQU   00000006            FULLWORD POINTER REGISTER            04640000
R14      EQU   00000014            FULLWORD POINTER REGISTER            04650000
R15      EQU   00000015            FULLWORD POINTER REGISTER            04660000
         ORG   @DATA+00000072                                           04670000
ECBCE37  EQU   *                   FULLWORD INTEGER                     04680000
         DC    FL4'0'                                                   04690000
MSGMOD37 EQU   *                   FULLWORD POINTER                     04700000
         DC    VL4(IFDMSG37)                                            04710000
A00002   EQU   00000000            8 BYTE(S) ON WORD                    04720000
WTOPTR   EQU   A00002+00000000     FULLWORD POINTER                     04730000
WTORPTR  EQU   A00002+00000004     FULLWORD POINTER                     04740000
A00003   EQU   00000000            75 BYTE(S) ON WORD                   04750000
WTOLEN   EQU   A00003+00000000     HALFWORD POINTER                     04760000
A00004   EQU   A00003+00000002     10 BYTE(S)                           04770000
MSAGE    EQU   A00003+00000012     63 BYTE(S)                           04780000
A00005   EQU   00000000            83 BYTE(S) ON WORD                   04790000
REPLYCNT EQU   A00005+00000000     1 BYTE(S)                            04800000
INBUFRAD EQU   A00005+00000001     3  BYTE  POINTER ON WORD+1           04810000
ECBCE37A EQU   A00005+00000004     FULLWORD POINTER                     04820000
WTORLEN  EQU   A00005+00000008     HALFWORD POINTER                     04830000
A00006   EQU   A00005+00000010     10 BYTE(S)                           04840000
WRMSAGE  EQU   A00005+00000020     63 BYTE(S)                           04850000
A00007   EQU   00000000            62 BYTE(S) ON WORD                   04860000
INRPCNT  EQU   A00007+00000000     1 BYTE(S)                            04870000
UTINMSG  EQU   A00007+00000001     61 BYTE(S)                           04880000
UTOUTMSG EQU   00000000            61 BYTE(S)                           04890000
RESCNT37 EQU   @DATA+00000080      1 BYTE(S)                            04900000
OUTMSCNT EQU   @DATA+00000084      FULLWORD INTEGER                     04910000
         ORG   @DATA+00000088                                           04920000
ROUTCD   EQU   *                   32 BIT(S) ON BYTE                    04930000
         DC    B'00000010000000000000000001000000'                      04940000
         ORG   @DATA                                                    04950000
         DS    00000092C                                                04960000
@TEMPS   DS    0F                                                       04970000
@TEMP4   DC    F'0'                                                     04980000
DSECT37  IFDCOM                                                         04990000
         GLOBAL                                                         05000000
         CECOM MAP=YES                                                  05010000
TRNMGR   EQU   $CECTRMG            LABEL FOR TRANSIENT MANAGER FLAGS    05020000
LEVEL    EQU   $CECLEVL            LABEL FOR MACRO LEVEL                05030000
MACID    EQU   $CECIDNT            LABEL FOR MACRO ID                   05040000
OUTMSGAD EQU   $CEOUTAD            LABEL FOR OUT MESSAGE ADDRESS        05050000
OUTCNT   EQU   $CEOUTCT            LABEL FOR OUT MESSAGE COUNT          05060000
INMSGAD  EQU   $CEINADR            LABEL FOR IN MESSAGE ADDRESS         05070000
INCNT    EQU   $CEINCT             LABEL FOR IN MESSAGE COUNT           05080000
FLAGS    EQU   $CECFLAG            LABEL FOR FLAGS                      05090000
A00000   EQU   INCNT+00000000      4 BYTE(S) ON WORD                    05100000
A00001   EQU   A00000+00000000     3 BYTE(S)                            05110000
INCNT3   EQU   A00000+00000003     1 BYTE(S)                            05120000
@DATEND  EQU   *                                                        05130000
@9F9     EQU   SETWTOR                                                  05140000
FINISH   EQU   @EL01                                                    05150000
         END   IFDOLT37                                                 05160000
