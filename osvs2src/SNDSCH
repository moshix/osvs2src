         MACRO                                                          00000105
&NAME    SNDSCH  &GEN=MAXI                                              00000205
.*A-000000-999999                                              @X31X8I0 00000308
.*                                                                      00010308
.******************* MICROFICHE FLAGS *********************** SUPT CODE 00020308
.*C341000                                                        X02004 00030308
.*A573700                                                        Y01948 00040308
.*C556000,567423                                                 Y01948 00050308
.*D557000,558000,567432,567441                                   Y01948 00060308
.*A388000,573000                                                 S99228 00130022
.*A186000,217000,462600,488000                                   S22029 00130122
.*C001000-002000                                                 S22029 00130222
.*A355600,355700                                                 A42390 00130322
.*A400000,420000,426000,439000,446000,457000                     S21101 00130422
.*A507000,524000,528000,544000,566000                            S21101 00130522
.*C128000,442000,447000,458000,534000-537000                     S21101 00130622
.*D549000,606000-608000,614000                                   S21101 00130722
.*A114000,124000,403000,427050,427560,508400,535000,550000,      S22025 00130822
.*A558000,567126,567459                                          S22025 00130922
.*C128000,267000-268000,292000-293000,296000,534000,567000       S22025 00131022
.*D221000-225000,417000,427055,427085,427100-427300,427400-427700S22025 00131122
.*D439060-439240,439360-439840,505000,514000-515000,566180-566900S22025 00131222
.*D567000,567639,567657                                          S22025 00131322
.*A340450                                                         M2173 00131422
.*A220000                                                       SA56891 00131822
.*D177000-178000                                                SA56891 00131922
.*A565000,565200                                                SA52971 00132022
.*C567297-567324                                                SA52971 00132122
.*D545000,565400,567225,567477,567630-567648,569000             SA52971 00132222
.*A427020-427040,534000-534840                                  SA56606 00132322
.*D427420-427480,427560,427580-427800,534000-534500             SA56606 00132422
.*A561000                                                       SA60792 00132505
.*C567072,573200-573400                                         SA60792 00132605
.*C407500,409080,412000,443500,446000-446320                    SA61773 00132705
.*A409800,599800                                                SA58984 00132805
.*C015100-016000                                                SA58984 00132905
.*A461000,447200,524800                                         SA59034 00133005
.*C456000                                                       SA59034 00133105
.*D524100-524200                                                SA59034 00133205
.*C498000                                                       SA62953 00133305
.*A357000,357500                                                SA65412 00203352
.*A311050-311950                                                 Y05331 00203408
.*A427000,427400                                                OX02199 00233454
.*C389100,441600                                                SA65379 00243454
.*A389800                                                       SA65379 00253454
.*C357800-357900                                                SA68703 00253508
*A357500                                                       @ZA02054 00253761
*A183000                                                       @SA70324 00253861
*A248000,279000,573000                                         @SA71683 00253961
*A544600                                                       @SA72478 00254061
*D547300                                                       @SA72478 00254161
*C339200                                                       @YA08088 00254209
*A341660                                                       @YA08088 00254309
*C455000-461700                                                @ZA03063 00254409
.*A561400                                                       SA69635 00260508
.*A015000,017000,020000,024000,026000,065000,066000,101000       X03039 00260608
.*A146000,147000,189000,358600,362000,388000,392000,403000       X03039 00260708
.*A405600,409020,409080,409800,409930,416000,427020,427040,      X03039 00260808
.*A427540,428000,428070,434000,435000,437000,439000,442200,      X03039 00260908
.*A446500,469000,480000,483000,488500,492000,493000,507500,      X03039 00261008
.*A524800,526000,527000,528000,535500,536000,561000,561800,      X03039 00261108
.*A566000,567540,575000,599900,602000,605000,610000,613000       X03039 00261208
.*C004000,016500,088000,089000,090000,091000,431000,564000       X03039 00261308
.*D565000                                                        X03039 00261408
.*A427060,427090,427430,427520,                                  X03039 00261508
.*A000002                                                      @Z30X8IG 00267508
.*C002841,016500                                               @Z30X8IG 00275508
.*A080000,098000,101400,358715,474000,476000,599918            @Z30X8IR 00279508
.*A427170                                                      @Z30X8IM 00279608
.*A-365100,368300,384000                                       @X50X9IH 00280609
.*C-368300                                                     @X50X9IH 00281609
.*A358630,358680,358835,439095,439200                          @ZA03122 00281709
.*A413000                                                      @XA09773 00281809
.*A435100,435300                                               @X50X9II 00281909
.*D311280-311440,D312000                                       @YA11169 00282000
*D419000                                                       @OS76313 00282181
*C467000                                                       @OX11964 00282281
*C553000-555000                                                @OZ07113 00282391
*C553000-555000                                                @OY12395 00282491
*C405400                                                       @XA08073 00282591
*A156000,157000,160000,162200,C161600                          @OZ09912 00282691
*A256000                                                       @OY12421 00282791
*C467000,A469000                                               @OY12969 00282891
*A465000,C469200,A613000,A409930                               @OX13500 00282991
*A453000                                                       @OX12563 00283091
*D339400-339600,D353100-353200,A243000,A341400,C354200         @OS77835 00283191
*C341000,A610500                                               @OS77835 00283291
*C441600                                                       @OY14503 00283391
*D469100-469200                                                @OS77867 00283491
*C400000                                                       @OY14092 00283591
*C439720,439900                                                @OX17153 00283600
*A123000,567540                                                @OZ24185 00283700
*C567297                                                       @OZ24185 00283800
         SPACE 3                                                        00284022
*A124000                                                       @OY19438 00284111
*A567288,567297                                                @OY19438 00287111
*D123500                                                       @OY19438 00287611
* DUMMY APAR                                                   @OZ27328 00288111
.*                                                                      00288611
.*                  VERSION DATED 11/06/74                     @Z30X8IG 00289111
.*                                                                      00290108
.********************************************************************** 00293108
         AIF   ('&GEN' EQ 'MAXI' OR '&GEN' EQ 'MINI' OR '&GEN' EQ 'NTSO-00300020
               ' OR '&GEN' EQ 'VTAM').OK                         X03039 00400008
         MNOTE 12,'XXX IHB     -INVALID OPERAND.'                       00500020
         MEXIT                                                          00600020
.OK      ANOP                                                           00700020
         TITLE '&NAME     SEND SCHEDULER'                               00800020
&NAME    CSECT                                                          00900020
.L1      ANOP                                                           01000020
*                                                                     * 01100020
*********************************************************************** 01200020
*                                                                     * 01300020
*TITLE --  SEND SCHEDULER MODULE                                      * 01400020
*                                                                     * 01500020
         AIF   ('&GEN' NE 'VTAM').TAG0                           X03039 01502008
*  MODULE NAME = IEDIAQ (VTAM)                                   X03039 01504008
         AGO   .TAG3                                             X03039 01506008
.TAG0    ANOP                                                    X03039 01508008
         AIF   ('&GEN' NE 'MINI').TAG1                                  01510005
*  MODULE NAME = IGG019Q6 (MINI)                                      * 01520005
         AGO   .TAG3                                                    01530005
.TAG1    AIF   ('&GEN' NE 'NTSO').TAG2                                  01540005
*  MODULE NAME = IGG019Q7 (NTSO)                                      * 01550005
         AGO   .TAG3                                                    01560005
.TAG2    ANOP                                                           01570005
*  MODULE NAME = IGG019R4 (MAXI)                                      * 01580005
.TAG3    ANOP                                                           01590005
*                                                                     * 01600005
*  DESCRIPTIVE NAME = SEND SCHEDULER                                  * 01610005
*                                                                     * 01620005
*  COPYRIGHT = 'NONE'                                                 * 01630005
*                                                                     * 01640005
*STATUS -- CHANGE LEVEL 8                                      @Z30X8IG 01650008
*                                                                     * 01700020
         AIF   ('&GEN' EQ 'VTAM').VFUNC                          X03039 01750008
*FUNCTION -- TO SCHEDULE A SENDING OPERATION AND TO FIND THE ADDRESS  * 01800020
*   OF THE DESTINATION LCB WHEN A MESSAGE IS POSTED TO A DESTINATION  * 01900020
*   QUEUE OR WHEN A DIAL QCB COMES OUT OF A TIME DELAY.               * 02000020
         AGO   .ENTPNT                                           X03039 02010008
.VFUNC   ANOP                                                    X03039 02020008
*FUNCTION -- TO SCHEDULE A SENDING OPERATION AND TO REQUEST A    X03039 02030008
*   LOGON IF NEEDED TO PERFORM THE SEND OPERATION.               X03039 02040008
.ENTPNT  ANOP                                                    X03039 02050008
*                                                                     * 02100020
*ENTRY POINTS --                                                      * 02200020
*   FIRST EXECUTABLE INSTRUCTION                                      * 02300020
*                                                                     * 02400020
         AIF   ('&GEN' EQ 'VTAM').VENTPT2                        X03039 02450008
*   'LCBSCAN'  WHEN CALLED BY DESTINATION ASSIGNMENT OR BY THE SEND   * 02500020
*   SCHEDULER (INITIATE MODE AND FOR A DIAL QCB).                     * 02600020
         AGO   .INPUT                                            X03039 02610008
.VENTPT2 ANOP                                                    X03039 02620008
*   'LCBSCAN' WHEN CALLED BY DESTINATION ASSIGNMENT, THE TIME    X03039 02630008
*   DELAY SUBTASK, OR THE SEND SCHEDULER ITSELF.                 X03039 02640008
.INPUT   ANOP                                                    X03039 02650008
*                                                                     * 02700020
*INPUT --                                                             * 02800020
*   WHEN ACTIVATED BY THE DISPATCHER -                                * 02900020
*   R1 POINTS TO BUFFER, LCB OR QCB                                   * 03000020
*   R11  DISPATCHER BASE                                              * 03100020
*   R13  ADDRESS OF AVTSAVE2                                          * 03200020
*   R15  ENTRY POINT ADDRESS                                          * 03300020
*   'LCBSCAN' -                                                       * 03400020
*   R7  ADDRESS OF QCB                                                * 03500020
*   R13  ADDRESS OF AVTSAVE2                                          * 03600020
*   R14  RETURN ADDRESS                                               * 03700020
*   R15  ADDRESS OF LCBSCAN                                           * 03800020
*                                                                     * 03900020
*OUTPUT --                                                            * 04000020
*   WHEN ACTIVATED BY THE DISPATCHER                                  * 04100020
*   R11  ADDRESS OF DISPATCHER                                        * 04200020
*   R13  ADDRESS OF AVTSAVE2                                          * 04300020
*                                                                     * 04400020
*   'LCBSCAN' -                                                       * 04500020
*   R13  ADDRESS OF AVTSAVE2                                          * 04600020
*   R14  RETURN ADDRESS                                               * 04700020
*                                                                     * 04800020
*EXITS-NORMAL --                                                      * 04900020
*   WHEN CALLED BY DISPATCHER                                         * 05000020
*   R13  ADDRESS OF AVTSAVE2                                          * 05100020
*   R11  DISPATCHER BASE                                              * 05200020
*   RETURN IS MADE ON R11 WITH AN OFFSET TO HAVE THE DISPATCHER       * 05300020
*   PERFORM THE DESIRED FUNCTION.                                     * 05400020
*                                                                     * 05500020
*   'LCBSCAN'                                                         * 05600020
*   R11  DISPATCHER BASE                                              * 05700020
*   R13  ADDRESS OF AVTSAVE2                                          * 05800020
*   R14  RETURN ADDRESS                                               * 05900020
*   BR  R14                                                           * 06000020
*                                                                     * 06100020
*EXTERNAL ROUTINES --                                                 * 06200020
*   'IEDQTNT' - TO CONVERT A TWO BYTE TNT OFFSET TO TERMINAL ENTRY    * 06300020
*   ADDRESS                                                           * 06400020
*                                                                     * 06500020
         AIF   ('&GEN' EQ 'VTAM').VEXTRTN                        X03039 06550008
*   'IOHALT' MACRO - TO HALT AN ENABLE OR PREPARE COMMAND IN          * 06600020
         AGO   .EXITS                                            X03039 06610008
.VEXTRTN ANOP                                                    X03039 06620008
*   'IEDQHG01' - TO PUT THE QCB ON THE TIME DELAY QUEUE WHEN     X03039 06630008
*   MSGLIMIT IS REACHED ON OUTPUT.                               X03039 06640008
*                                                                X03039 06650008
*   'IEDIAF2' - TO ISSUE A RESET CONDITIONAL.                    X03039 06660008
.EXITS   ANOP                                                    X03039 06670008
*                                                                     * 06700020
*EXITS-ERROR -- NONE                                                  * 06800020
*                                                                     * 06900020
*TABLES/WORK AREAS --VARIOUS CONTROL BLOCKS EXPANDED BY MACROS        * 07000020
*   TAVTD                                                             * 07100020
*   TCCWD                                                             * 07200020
*   DCBD                                                              * 07300020
*   TDEBD                                                             * 07400020
*   TLCBD                                                             * 07500020
*   TPRFD                                                             * 07600020
*   TQCBD                                                             * 07700020
*   TSCBD                                                             * 07800020
*   TSTCBD                                                            * 07900020
*   TTRMD                                                             * 08000020
*   TTSID                                                      @Z30X8IR 08050008
*                                                                     * 08100020
*ATTRIBUTES -- RE-USABLE, REFRESHABLE, ENABLED, PROBLEM PROGRAM MODE  * 08200020
*                                                                     * 08300020
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 08400020
*   PARTICUALR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER      * 08500020
*   SET.                                                              * 08600020
*                                                                     * 08700020
*   ROUTINES CALLING THE LCBSCAN ROUTINE EXPECT THE OFFSET TO    X03039 08800008
*   LCBSCAN ALWAYS TO BE THE FIRST TWO BYTES OF THE SEND         X03039 08900008
*   SCHEDULER.                                                   X03039 09000008
*                                                                     * 09200020
*********************************************************************** 09300020
         EJECT                                                          09400020
         DC    AL2(LCBSCAN-&NAME) .     USED BY OPEN TO                 09500020
*                                         SET ADDRESS IN AVT            09600020
*                                 REGISTER EQUATES                      09700020
         SPACE 1                                                        09800020
         AIF   ('&GEN' NE 'VTAM').REG0                         @Z30X8IR 09820008
RSELECT  EQU   0                  IEDAYG ENTRY PNT INDEX REG   @Z30X8IR 09840008
.REG0    ANOP                                                  @Z30X8IR 09860008
R0       EQU   0                  FLAG REG                              09900020
RTEMP    EQU   1                        WORK REGISTER                   10000020
RWORK    EQU   2                        WORK REGISTER                   10100020
         AIF   ('&GEN' NE 'VTAM').EQRSTCB                        X03039 10120008
RQCBP    EQU   2                        QCB PREFIX REGISTER      X03039 10130008
RSCB     EQU   3                        SCB REGISTER FOR LCBSCAN X03039 10140008
RRTN     EQU   3                  RETURN REG FOR IEDAYG        @Z30X8IR 10150008
.EQRSTCB ANOP                                                    X03039 10160008
RSTCB    EQU   3                  STCB BASE                             10200020
RLCB     EQU   4                  LCB BASE                              10300020
R5       EQU   5                        WORK REGISTER                   10400020
R6       EQU   6                                                    TSO 10500020
RQCB     EQU   7                  QCB ADDR                              10600020
RHOLD    EQU   8                  FIRST LCB SCANNED FOR AVAILABLE       10700020
RLAST    EQU   9                  COUNT OF LCB'S TO SCAN                10800020
RDCB     EQU   10                 DCB BASE                              10900020
RSUPBASE EQU   11                 DISPATCHER BASE REG                   11000020
RBASE    EQU   12                 SUBTASK BASE REG                      11100020
R13      EQU   13                 SAVE AREA ADDR (AVTSAVE2)             11200020
R14      EQU   14                 RETURN ADDR REG                       11300020
R15      EQU   15                 ENTRY BASE REG                        11400020
CLEAR0F  EQU   X'0F'                                             S22025 11450022
         SPACE 1                                                        11500020
         SPACE 2                                                        11600020
         USING IEDQSTCB,RSTCB                                           11700020
         USING IEDQLCB,RLCB                                             11800020
         USING IEDQQCB,RQCB                                             11900020
         USING IHADCB,RDCB                                              12000020
         USING IEDQDISP,RSUPBASE                                        12100020
         USING AVTSAVE2,R13                                             12200020
         USING *,R15                    TEMPORARY USING          Y05330 12300005
         BAL   RBASE,ID                 BYPASS ID / SET BASE     Y05330 12400005
TAG      EQU   *                                               @OY19438 12450011
         USING *,RBASE                  SET NEW USING            Y05330 12500005
         DROP  R15                                               Y05330 12600005
         SPACE 1                                                 Y05330 12700005
&NAME    IEDHJN                                                         12800005
ID       DS    0H                                                Y05330 12900005
         LA    RSTCB,IEDQSTCB     ZERO HI-ORDER BYTE                    13000020
         LA    RQCB,QCBSTVTO-IEDQQCB GET QCB'S STCB OFFSET              13100020
         LCR   RQCB,RQCB          SET NEGATIVE                          13200020
         AR    RQCB,RSTCB         BACK UP TO QCB BASE                   13300020
         SPACE 2                                                        13400020
*** ANALYZE THE PASSED ELEMENT.  IT MIGHT BE:                           13500020
*        1. BUFFER (+8 IS A 'TIC' COMMAND CODE)                         13600020
*             IF END OF MESSAGE, SEARCH FOR AN AVAILABLE LINE ON SHICH  13700020
*             TO SEND.                                                  13800020
*        2. LCB (+8 IS THE RECEIVE SCHEDULER'S STCBVTO)                 13900020
*             LOOK FOR THE MESSAGE TO SEND, AND TELL DISK ROUTINES TO   14000020
*             START READING MESSAGE.                                    14100020
         AIF   ('&GEN' EQ 'MINI').L5                                    14200020
*        3. QCB (+8 IS THE SEND SCHEDULER'S STCBVTO)                    14300020
*             SEND TIME DELAY HAS JUST EXPIRED.  LOOK FOR AN AVAILABLE  14400020
*             LINE ON WHICH TO CONTACT THE DIAL TERMINAL.               14500020
         SPACE 1                                                        14600020
         AIF   ('&GEN' EQ 'VTAM').VTAMVTO                        X03039 14650008
         CLI   PRFTIC-IEDQPRF(RTEMP),DSPSNDSC IS THIS A QCB?        TSO 14700020
         AGO   .QCBBR                                            X03039 14720008
.VTAMVTO ANOP                                                    X03039 14740008
         CLI   PRFTIC-IEDQPRF(RTEMP),DSPVSSCH IS THIS A QCB      X03039 14760008
.QCBBR   ANOP                                                    X03039 14780008
         BE    QCBTSO                   BRANCH IF IT IS A QCB       TSO 14800020
.L5      ANOP                                                           14900020
         CLI   LCBPRI-IEDQLCB(RTEMP),PRILNFRE  LCB                      15000020
         BE    SENDSCH                  YES                             15100020
         L     RLCB,PRFLCB-1-IEDQPRF(,RTEMP) LCB ADDRESS                15200020
         TM    LCBSTAT1,LCBINITN        INITIATE MODE                   15300020
         BZ    EXIT                     NO                              15400020
         LA    R15,LCBSCAN              ADDRESSABILITY                  15500020
         ST    RQCB,AVTDOUBL            SAVE QCB ADDRES                 15600020
         AIF   ('&GEN' EQ 'VTAM').STCBTSO                               15610091
         L     R6,QCBSLINK-1                                   @OZ09912 15620091
         LR    R5,RTEMP                 SAVE VALUE             @OZ09912 15630091
         AGO   .STCB2                                          @OZ09912 15640091
.STCBTSO ANOP                                                  @OZ09912 15650091
         ST    RTEMP,AVTDOUBL+4         SAVE BUFFER ADDRESS    @AS09778 15700009
.STCB2   ANOP                                                  @OZ09912 15800091
         BALR  R14,R15                  LINK TO FIND LCB                15900020
         L     RQCB,AVTDOUBL            SET  QCB ADDRES                 16000020
         AIF   ('&GEN' EQ 'VTAM').STCB3                        @OZ09912 16010091
         LR    RTEMP,R5                 RESTORE VALUE          @OZ09912 16020091
         LR    RSTCB,R6                 RESTORE VALUE          @OZ09912 16030091
         AGO   .STCB4                                          @OZ09912 16040091
.STCB3   ANOP                                                  @OZ09912 16050091
         L     RTEMP,AVTDOUBL+4         RESTORE BUFFER ADDR    @AS09778 16100009
         L     RSTCB,QCBSTCHN-1         1ST STCB ON DEST QCB   @AS09778 16120009
         CLI   0(RSTCB),DSPMCPL6        IS IT IEDQHM'S STCB    @AS09778 16140009
         BNH   FOUNDHM                  BRANCH IF YES          @OZ09912 16160091
         L     RSTCB,QCBSLINK-1         NO, GET HM'S STCB      @AS09778 16180009
*                                       FROM STCB LINK FIELD   @AS09778 16200009
FOUNDHM  EQU   *                                               @AS09778 16220009
.STCB4   ANOP                                                  @OZ09912 16260091
         B     DSPBYPAS                 DISPATCH NEXT SSTCB             16300020
         AIF   ('&GEN' EQ 'MINI').L7                                    16400020
QCBTSO   LA    R15,LCBSCAN              ESTABLISH ADDRESSABILITY    TSO 16500020
         LA    R14,DSPDISP              SET EXIT FROM SUBROUTINE        16600020
        AIF   ('&GEN' EQ 'NTSO').L6                                     16700020
         TM    QCBFLAG,QCBTSSES         IS THIS FOR TIME SHARING?   TSO 16800020
         BZ    SETEXIT                  BRANCH IF NO                    16900020
         NI    QCBTSOF2,X'FF'-QCBPOSTO  TURN OFF QCB POSTED BIT     TSO 17000020
         B     TSO1                                                 TSO 17100020
.L6      ANOP                                                           17200020
         SPACE 1                                                        17300020
*** A QCB QPOST'ED TO ITSELF IS ASSUMED                                 17400020
         SPACE 1                                                        17500020
SETEXIT  EQU   *                                                        17600020
         EJECT                                                          17900020
.L7      ANOP                                                           18000020
         USING *,R15                                                    18100020
LCBSCAN  EQU   *                                                        18200020
         LA    RQCB,0(,RQCB)            LCRER HI ORDER BYTE FOR COM     18300020
         TM    QCBDSFLG,QCBHELD         REUS USING QCB ?       @SA70324 18330061
         BOR   R14                      YES, EXIT              @SA70324 18360061
         AIF   ('&GEN' EQ 'MINI' OR '&GEN' EQ 'NTSO').L8                18400020
         TM    QCBDSFLG,QCBDISK+QCBCORE TIME-SHARING QUEUES?        TSO 18500020
         BCR   8,R14                    YES. RETURN TO CPB INIT     TSO 18600020
         TM    QCBFLAG,QCBTSSES .      QCB IN TSO SESSION        S22029 18630022
         BCR   7,R14 .                 YES RETURN TO CPB INIT    S22029 18660022
         SPACE                                                          18700020
TSO1     EQU   *                                                    TSO 18800020
.L8      ANOP                                                           18900020
         AIF   ('&GEN' EQ 'VTAM').VSCAN                          X03039 18950008
         L     RDCB,QCBDCBAD-1    GET DCB ADDR                          19000020
         TM    DCBOFLGS,OPEN      IS DCB OPEN                           19100020
         BCR   8,R14                    NO EXIT                         19200020
RETRY    EQU   *                                                        19300020
         L     RTEMP,DCBDEBAD     GET DEB ADDR                          19400020
         USING DEBNMSUB,RTEMP                                           19500020
         TM    DEBOPATB,OUTPUT          OPENED FOR OUTPUT               19600020
         BCR   8,R14                    NO, RETURN                      19700020
         DROP  RTEMP                                                    19800020
         SR    RLAST,RLAST        ZERO COUNT REG                        19900020
         IC    RLAST,X'10'(,RTEMP)      DEB NUMBER OF EXTENTS           20000020
         SR    RTEMP,RTEMP        ZERO ODD REG                          20100020
         IC    RTEMP,QCBRELLN     GET QCB'S STARTING RLN                20200020
         LR    RLCB,RTEMP               COPY RLN FOR NEXT TEST          20300020
         BCTR  RLCB,R0                  RLN MINUS 1                     20400020
         SR    RLAST,RLCB               GET COUNT OF LCB'S TO SCAN      20500020
         BCR   13,R14                   NO, EXIT                        20600020
         SR    RWORK,RWORK        ZERO SIZE REG                         20700020
         IC    RWORK,DCBEIOBX     GET LCB SIZE                          20800020
         MR    RTEMP-1,RWORK      GET STARTING LCB OFFSET               20900020
         AL    RTEMP,DCBIOBAD           POINT TO IOB OF LCB             21000020
         SH    RTEMP,LCBSIZE            ADJUST TO START OF LCB          21100020
         LR    RLCB,RTEMP               LCB BASE                        21200020
         AIF   ('&GEN' EQ 'MINI').LNODL                                 21300020
         SR    RHOLD,RHOLD              CLEAR WORK REGISTER             21400020
        AIF   ('&GEN' EQ 'NTSO').L9                                     21500020
         TM    QCBDSFLG,QCBDISK+QCBCORE TIME-SHARING QUEUES?        TSO 21600020
         BZ    NONDIAL                  YES. TREAT AS IF LEASED     TSO 21700020
         TM    QCBFLAG,QCBTSSES .      QCB IN TSO SESSION        S22029 21730022
         BO    NONDIAL .               YES TREAT AS LEASED       S22029 21760022
.L9      ANOP                                                           21800020
         TM    LCBSTAT2,LCBDIAL   ARE THESE DIAL LINES                  21900020
         BZ    NONDIAL            NO, THIS IS THE LINE                  22000020
         CLI   QCBSTPRI,CALLOPT         CLOCK OR INTERVAL       SA56891 22100022
         BL    DIALLOOP                 BRANCH IF NOT           SA56891 22200022
         OI    QCBSTAT,QCBSCHDL         FORCE RECEIVE OPERATION SA56891 22300022
*                                         PRIOR TO SENDING      SA56891 22400022
DIALLOOP EQU   *                                                        22600020
         TM    LCBTSTSW,CONNECT         LCB CONNECTED                   22700020
         BZ    NOTCONNT                  NOT CONNECTED                  22800020
         SPACE                                                          22900020
         LH    RTEMP,LCBTTCIN           CURRENTLY CONNECTED             23000020
         LTR   RTEMP,RTEMP              ORIGIN SPECIFIED                23100020
         BZ    TRYNEXT                  NO                              23200020
         STM   14,15,AVTSAVE3           SAVE REGISTERS                  23300020
         SPACE                                                          23400020
         L     R15,AVTRNMPT             CONVERT ROUTINE                 23500020
         BALR  R14,R15                  GET TERMINAL CADDRESS           23600020
         LM    14,15,AVTSAVE3            SET REGISTERS                  23700020
         L     RTEMP,TRMDESTQ-1-IEDQTRM(,RTEMP) QCB ADDRESS             23800020
         LA    RTEMP,0(,RTEMP)          CLEAR HI ORDER BYTE FOR CR      23900020
         CR    RTEMP,RQCB               ARE WE CONNECTED TO THIS        24000020
         BNE   TRYNEXT                  NO CONNECTION                   24100020
         SPACE                                                          24200020
         NI    QCBSTAT,AVTEFF-QCBSCHDL  TNT WOURCE SET                  24300020
         AIF   ('&GEN' EQ 'NTSO').L9A                          @OS77835 24310091
         TM    QCBFLAG,QCBNOBRK         CAN TERMINAL BE BROKEN @OS77835 24320091
         BO    LEAVE                    NO,EXIT                @OS77835 24330091
         TM    LCBTSOB,LCB2741N         2741?                  @OS77835 24340091
         BO    NONDIAL                  YES,TREAT AS LEASED    @OS77835 24350091
.L9A     ANOP                                                  @OS77835 24360091
         B     LEAVE                    EXIT                            24400020
         SPACE                                                          24500020
NOTCONNT EQU   *                                                        24600020
         CLI   QCBSTPRI,CALLPRI         CALL=NONE SPECIFIED             24700020
         BE    TRYNEXT                  BRANCH YES                      24800020
         TM    LCBSTCBA+TWO,CLOSEDWN    LINE STOPPED BY        @SA71683 24820061
*                                        CLOSEDOWN ?           @SA71683 24840061
         BO    TRYNEXT                  BR IF YES              @SA71683 24860061
         LTR   RHOLD,RHOLD              PREVIOUS LCB SELECTED           24900020
         BNZ   TRYNEXT                  YES,ALREADY HAVE AVAILABEL      25000020
         LR    RHOLD,RLCB               SAVE FOUND LCB                  25100020
TRYNEXT  EQU   *                                                        25200020
         AR    RLCB,RWORK               ADDRESS OF NEXT LCB             25300020
         BCT   RLAST,DIALLOOP           LOOK AT NEXT LCB                25400020
         LTR   RLCB,RHOLD               WAS AVAILABLE LINE FOUND        25500020
         BZ    CALLQ                    BRANCH NO                       25600020
         LA    RTEMP,DSPDISP            GET DISPATCHER EXIT    @OY12421 25610091
         CR    RTEMP,R14                WAS THIS A QCB ENTRY   @OY12421 25620091
         BE    NOHOLD                   BRANCH-YES DO DIAL UP  @OY12421 25630091
         TM    QCBSTAT,QCBTRMHO         IS TERMINAL HELD       @OY12421 25640091
         BO    CALLQ                    BRANCH YES             @OY12421 25650091
NOHOLD   EQU   *                                               @OY12421 25660091
         TS    LCBTSTSW                 LINE STILL AVAILABLE            25700020
         BNZ   RETRY                    LOOP AGAIN ON LINE GROUP        25800020
         OI    LCBSTAT2,LCBNEGRP        SET NEGATIVE RESPONSE IN        25900020
*                                         CASE TERMINAL IS HELD         26000020
*                                         IF NOT SET, AN ERRONEOUS      26100020
*                                         'CONNECTION' APPEARS TO       26200020
*                                         RCV SCHED AND ACTIVATE        26300020
         NI    LCBTPCD+11,AVTEFF-DISDLEOT DONT SEND DLE EOTSINCE WE     26400020
*                                         ARE NOT DISCONNECTING         26500020
*                                         A CALL                        26600020
         TM    LCBSTAT1,LCBFREEN .      LCB FREE                        26700022
         BZ    HALTLINE .               BRANCH IF NO TO HIO      S22025 26800022
         B     POSTLCB                  GET LCB                         26900020
         SPACE                                                          27000020
CALLQ    EQU   *                                                        27100020
         L     RSTCB,DCBIOBAD           1ST IOB                         27200020
         AR    RSTCB,RWORK              POINT TO 1ST IOB                27300020
         SH    RSTCB,DOCQAD             BACK UP TO CALL Q               27400020
         B     DSPUNAVR                 USE UNAVAIL AND RETURN          27500020
*                                         TO CALLER                     27600020
         SPACE                                                          27700020
NONDIAL  EQU   *                                                        27800020
.LNODL   ANOP                                                           27900020
         TM    LCBSTCBA+TWO,CLOSEDWN    LINE STOPPED BY        @SA71683 27920061
*                                        CLOSEDOWN?            @SA71683 27940061
         BOR   R14                      BR IF YES              @SA71683 27960061
         CLI   LCBRSPRI,SENDPRI         LINE HAVE SEND PRIORITY         28000020
         BH    OBTAIN             NO, GO GET THE LINE                   28100020
         OI    LCBSTAT2,LCBSNDPR  SET SEND SCHEDULER WANTS LINE         28200020
OBTAIN   EQU   *                                                        28300020
         AIF   ('&GEN' EQ 'NTSO' OR '&GEN' EQ 'MINI').L10               28400020
         TM    QCBFLAG,QCBTSSES         IS THIS TIME SHARING?       TSO 28500020
         BZ    TSO2                     BRANCH ON NO                TSO 28600020
         L     R6,AVTTSOPT              ADDRESS OF TSINPUT QCB      TSO 28700020
         L     R6,TSISCHED-IEDQTSI(,R6) ADDRESS OF TS SCHEDULER     TSO 28800020
         BAL   RSTCB,8(,R6)             BRANCH TO ROUTINE           TSO 28900020
TSO2     EQU   *                                                    TSO 29000020
.L10     ANOP                                                           29100020
         TM    LCBSTAT1,LCBFREEN .      IS LINE FREE             S22025 29200022
         BZ    TESTPOLL .               NO, GO LOOK FOR NON-REGULS22025 29260022
*                                       AR INTERUPTING TERMINALS S22025 29320022
*                                      INTERRUPTING TERMINALS           29400020
POSTLCB  EQU   *                                                        29500020
         XI    LCBSTAT1,LCBSENDN+LCBFREEN . CHANGE LCB STATE TO  S22025 29600022
*                                         A MULTIPE POST OF LCB         29700020
         MVI   LCBPRI,PRILNFRE          POST PRIORITY                   29800020
         ST    14,AVTSAVE3+4            SAVE REGISTER                   29900020
         ST    RQCB,AVTSAVE3            SAVE REGISTER                   30000020
         ST    RLCB,LCBQCBA-1           LCB IS QCB                      30100020
         LR    1,RLCB                   PARAMETER FOR POST              30200020
         BAL   R14,DSPPOSTR             PUT LCB ON READY Q              30300020
         L     RQCB,AVTSAVE3            SET  REGISTER                   30400020
         L     14,AVTSAVE3+4            SET  REGISTER                   30500020
         B     LEAVE                    EXIT                            30600020
         SPACE                                                          30700020
TESTPOLL EQU   *                                                        30800020
         CLI   LCBCPA+24,POLL           LINE IN AUTOPOLL                30900020
         BNE   BASIC                    BRANCH NO                       31000020
         SPACE                                                          31100020
         ST    RLCB,AVTSAVE2            LCB POINTER              Y05331 31104005
         L     RWORK,AVTSAVTP           POINTER TO SECONDARY AVT Y05331 31108005
         USING IEDNSVTD,RWORK                                    Y05331 31112005
         TM    SAVTDIAF,SAVTVIRT        IN VM ENVIRONMENT?       Y05331 31116005
         BNO   NOVIRT                   NO, BRANCH               Y05331 31120005
         STM   R14,R15,AVTSAVE2+24      SAVE REGISTERS 14 AND 15 Y05331 31124005
         LA    R0,LCBCPA+56             TIC ADDRESS              Y05331 31148005
         L     R15,SAVTDIAG             VIRTUAL DIAGNOSE ROUTINE Y05331 31152005
         DROP  RWORK                                             Y05331 31156005
         MVI   LCBCPA+56,CCWNOP         NOP 2ND VIRTUAL TIC      Y05331 31160005
         BAL   R14,4(,R15)              NOP CORRESPONDING REAL   Y05331 31164005
*                                         TIC                    Y05331 31168005
         LM    R14,R15,AVTSAVE2+24      RESTORE REGISTERS 14,15  Y05331 31172005
         B     LEAVE                    EXIT                     Y05331 31176005
         SPACE                                                          31180005
NOVIRT   EQU   *                                                 Y05331 31184005
         MVI   LCBCPA+56,CCWNOP         NOP 2ND TIC                     31300020
         B     LEAVE                    EXIT                            31400020
         SPACE                                                          31500020
BASIC    EQU   *                                                        31600020
         TM    LCBSTAT2,LCBSYNC         BSC LINE                        31700020
         BZ    NOTBSC                   BRANCH NO                       31800020
         SPACE                                                          31900020
         CLI   LCBCPA+16,CCWPREP        RECEIVE STATE                   32000020
         BNE   LEAVE                    NO                              32100020
         TS    LCBTSTSW                 LINE FREE                       32200020
         BNZ   LEAVE                    BRANCH BUSY                     32300020
         B     HALTLINE                 ISSUE HALT IO                   32400020
NOTBSC   EQU   *                                                        32500020
         CLI   LCBCPA+24,CCWSENSE       SENSE COMMAND                   32600020
         BE    CHKSENSE                 YES, SEE IF NIO REQUIRED        32700020
         CLI   LCBCPA+32,CCWSENSE       START STOP CONTENTION           32800020
*                                         MAY BE REQUIRED)              32900020
         AIF   ('&GEN' EQ 'MAXI').L11A                                  33000020
         BNE   LEAVE .                  BRANCH IF NOT A BASIC           33100020
*                                                                       33300020
         AGO   .L11B                                                    33380020
.L11A    ANOP                                                           33460020
         BNE   CKTSO .                  BRANCH IF NOT A BASIC           33540020
.L11B    ANOP                                                           33620020
CHKSENSE EQU   *                                                        33700020
         TM    LCBCSWSV,AVTEFF          SENSE BEEN EXECUTED             33800020
         AIF   ('&GEN' NE 'MAXI').L11                                   33860020
         BNO   CKTSO                    BRANCH IF SENSE DONE   @YA08088 33920009
         TM    QCBFLAG,QCBTSSES         TSO OPERATION          @YA08088 33922009
         BO    HALTLINE                 IF SO, ISSUE HIO       @YA08088 33924009
         TM    LCBTSOB,LCB2741N         IS THIS A 2741         @YA08088 33926009
         BNO   HALTLINE                 IF NOT,ISSUE HIO       @YA08088 33928009
CKTSO    EQU   *                                                        33930020
         TM    LCBSTAT1,LCBRECVN .      IS LINE RECEIVING           TSO 33964020
         BZ    LEAVE .                  BRANCH IF NO                TSO 33968020
         TM    LCBSTAT2,LCBMSGNN .      MSGEN IN PROGRESS           TSO 33972020
         BO    LEAVE .                  BRANCH IF YES                   33976020
         SPACE                                                          33980020
         TM    QCBFLAG,QCBNOBRK         CAN TERMINAL BE BROKEN?    2741 34000020
         BO    LEAVE                    BRANCH ON NO               2741 34020020
         L     RWORK,LCBLSPCI-1         GET ADDRESS OF FIRST BUFFER2741 34040020
         LA    RWORK,0(,RWORK) .        TEST ADDRESS ONLY         M2173 34045093
         LTR   RWORK,RWORK .            TEST FOR ADDRESS          M2173 34050093
         BZ    LEAVE .                  IF NO BFR, CAN NOT BREAK  M2173 34055093
         TM    PRFSTAT1-IEDQPRF(RWORK),PRFNHDRN IS IT FIRST BUFFER?2741 34060020
         BO    LEAVE                    BRANCH ON NO               2741 34080020
         L     RTEMP,PRFIOADR-1-IEDQPRF(,RWORK) GET DATA ADDR  @OS77835 34100091
         N     RTEMP,CLRHI              GET OFFSET IN PAGE     @OS77835 34105091
         N     RWORK,CLRLOW             GET ADDR OF PAGE       @OS77835 34110091
         AR    RWORK,RTEMP              GET DATA ADDRESS       @OS77835 34115091
         CLI   1(RWORK),0               HAS USER ENTERED ANY DATA? 2741 34120020
         BNE   LEAVE                                                    34140020
         TM    QCBFLAG,QCBTSSES         TSO IN CONTROL?        @OS77835 34142091
         BO    HALTLINE                 YES,CONTINUE           @OS77835 34144091
         TM    LCBTSOB,LCB2741N         2741?                  @OS77835 34146091
         BZ    LEAVE                    NO,EXIT                @OS77835 34148091
         AGO   .L11C                                                    34150020
.L11     ANOP                                                           34160020
         BNO   LEAVE                                                    34166020
         TM    LCBTSOB,LCB2741N         IS THIS A 2741         @YA08088 34168009
         BO    LEAVE                    IF SO, DO NOT HIO      @YA08088 34170009
.L11C    ANOP                                                           34172020
HALTLINE EQU   *                                                        34180020
         SR    RWORK,RWORK              CLEAR FOR INDEXING              34800020
         IC    RWORK,LCBUCBX            RLN MINUS 1                     34900020
         SLL   RWORK,2                   MULTIPLY BY 4 FOR INDEX        35000020
         L     RTEMP,DCBDEBAD           DEB ADDRESS                     35100020
         L     RTEMP,X'20'(RTEMP,RWORK) UCB ADDRESS                     35200020
         LA    RTEMP,0(,RTEMP)          CLEAR HI ORDER BYTE             35230020
*                                         ENSURE POSTIVE POINTER        35260020
         AIF   ('&GEN' EQ 'MINI' OR '&GEN' EQ 'NTSO').L13               35300020
         TM    19(RTEMP),AVTEFF-AIBM1   CAN DEVICE BE A 1050 OR 2741TSO 35330020
         BNZ   ISSUESVC                 BRANCH ON NO                TSO 35360020
         CLI   16(RTEMP),T1050          IS IT A 1050                TSO 35390020
         BNE   TEST2741                 NO,BRANCH              @OS77835 35420091
         TM    QCBFLAG,QCBTSSES         TSO IN CONTROL?        @OS77835 35422091
         BO    SETBRK                   YES,BRANCH             @OS77835 35424091
TEST2741 EQU   *                                               @OS77835 35426091
         CLI   16(RTEMP),T2741C .       IS IT A 2741 CORRES         TSO 35430020
         BE    SETBRK .                 BRANCH IF YES               TSO 35440020
         CLI   16(RTEMP),T2741B .       IS IT A 2741 BCD            TSO 35450020
         BNE   ISSUESVC .               BRANCH IF NO                TSO 35460020
SETBRK   EQU   *                                                    TSO 35510020
         TM    QCBFLAG,QCBNOBRK .       CAN WRITE BREAK BE USED  A42390 35540030
         BO    ISSUESVC .               BRANCH NO                A42390 35570030
         OI    LCBTSOB,LCBWRBRK         SET SWITCH FOR LINE END 2741    35600020
.L13     ANOP                                                           35650020
ISSUESVC EQU   *                                                   2741 35700020
         DROP  R15                                              SA65412 35710052
         LR    RSTCB,R15                COPY BASE ADDRESS       SA65412 35720052
         USING LCBSCAN,RSTCB                                    SA65412 35730052
*                                         PREVENT LOSS OF LINE IF       35733006
*                                         ERROR OCCURRED AND LCB IS     35736006
*                                         ON WAY TO ERP OR UNDER ERP    35739006
*                                         CONTROL                       35742006
         MVI   LCBECBCC,HIOCC           SET HALT I/O COMPLETION  Y02027 35745006
         IOHALT (1)                                                     35750020
         LTR   R15,R15                  RETURN CODE ZERO       @ZA02054 35758061
         BZ    HIODONE                  BR YES, HIO COMPLETE   @ZA02054 35766061
         SR    R15,R15                  CLEAR FOR COMPARE      @ZA02054 35774061
         CLM   R15,15,LCBCSW+THREE      CHANNEL PROGRAM STILL  @ZA02054 35782061
*                                       OUTSTANDING            @ZA02054 35790061
         LR    R15,RSTCB                COPY BASE REGISTER     @ZA02054 35798061
         BZ    HALTLINE                 BR YES, REISSUE IOHALT @ZA02054 35806061
HIODONE  EQU   *                                               @ZA02054 35814061
         LR    R15,RSTCB                BASE REGISTER           SA65412 35830052
         DROP  RSTCB                                            SA65412 35840052
         USING LCBSCAN,R15                                      SA65412 35850052
         USING IEDQSTCB,RSTCB                                   SA65412 35860052
         AGO   .NOTVTAM                                          X03039 35860508
.VSCAN   ANOP                                                    X03039 35861008
         L     RTEMP,AVTSAVTP           SECONDARY AVT ADDRESS    X03039 35861508
*                                                                X03039 35862008
         USING IEDNSVTD,RTEMP           ADDRESSABILITY FOR SAVT  X03039 35862508
         L     RDCB,SAVTACB             ACB ADDRESS              X03039 35863008
         DROP  RTEMP                                           @ZA03122 35863209
*                                       ACB OPEN                 X03039 35863508
         TM    ACBOFLGS-IFGACB(RDCB),ACBOPEN                     X03039 35864008
         BNOR  R14                      BR NO                    X03039 35864508
*                                                                X03039 35865008
         LA    RQCBP,QCBPRFSZ           QCB PREFIX SIZE          X03039 35865508
         LNR   RQCBP,RQCBP              MAKE NEGATIVE FOR BACKUP X03039 35865808
         AR    RQCBP,RQCB               BACK UP TO QCB PREFIX    X03039 35866108
*                                                                X03039 35866509
         USING IEDNQCB,RQCBP            ESTABLISH ADDRESSABILITY X03039 35866609
         TM    QCBSTAT1,QCBNIDLE        LINE STOPPED             X03039 35866709
         BZR   R14                      BR YES                   X03039 35866809
*                                                                X03039 35866909
         TM    QCBSTAT,QCBTRMHO         TERMINAL HELD            X03039 35867009
         BOR   R14                      BR YES                   X03039 35867109
*                                                                X03039 35867209
         TM    QCBSTAT1,QCBPLCBN        IS DEST LOGGED ON        X03039 35867309
         BZ    REQLOGON                 BRANCH NO                X03039 35867409
*                                                                X03039 35867509
         L     RLCB,QCBPLCBA-1          PLCB ADDRESS             X03039 35867609
         LR    RHOLD,R14                SAVE RETURN REGISTER   @ZA03122 35867709
         LH    RTEMP,LCBTTCIN           GET TNT OFFSET         @ZA03122 35868009
         N     RTEMP,AVTCLRHI           CLEAR HI ORDER BYTES   @ZA03122 35868109
         LR    R6,R15                   SAVE BASE REGISTER     @ZA03122 35868209
         L     R15,AVTRNMPT             ADDR OF TNT            @ZA03122 35868309
         BALR  R14,R15                  GET TERM ENTRY ADDR    @ZA03122 35868509
         LR    R14,RHOLD                RESTORE RETURN REGISTER@ZA03122 35868609
         LR    R15,R6                   RESTORE BASE REG       @ZA03122 35868709
         USING IEDNTRM,RTEMP            TERMINAL DSECT BASE    @ZA03122 35868809
         SH    RTEMP,AVTHA4             BACK UP TO TRM PREFIX  @ZA03122 35868909
         TM    TRMSTAT1,TRMSESSN        IS TERMINAL IN SESSION @ZA03122 35869009
         BZ    TMDELAY                  NO, PUT QCB ON TIME    @ZA03122 35869109
*                                         DELAY QUEUE          @ZA03122 35869209
         DROP  RTEMP                                           @ZA03122 35869309
         L     RTEMP,AVTSAVTP           SECONDARY AVT ADDR     @ZA03122 35869409
         USING IEDNSVTD,RTEMP           ADDRESSABILITY         @ZA03122 35869509
         EJECT                                                          35869609
         TM    QCBFLAG,QCBTSSES         IS TSO IN SESSION      @Z30X8IR 35869709
         BZ    INPUT                    BRANCH ON NO           @Z30X8IR 35869809
         L     R6,AVTTSOPT              GET TSINPUT QCB ADDR   @Z30X8IR 35869909
         L     R6,TSIRNSCH-IEDQTSI(,R6) VTAM TSO SCHED ADDR    @Z30X8IR 35870009
         LA    RSELECT,THREE            INDEX TO IEDA1C ENTRY  @Z30X8IR 35870109
*                                         PT OF VTAM TSO SCHED @Z30X8IR 35870209
         BALR  RRTN,R6                  BRANCH TO VTAM TSO     @Z30X8IR 35870309
*                                         SCHED,IEDAYG         @Z30X8IR 35870409
INPUT    EQU   *                                               @Z30X8IR 35870509
         TM    LCBSTAT1,LCBFREEN        LINE FREE                X03039 35870609
         BO    PRIME                    BR YES                   X03039 35871508
*                                                                X03039 35871608
         L     RSCB,LCBSCBA-1           SCB ADDRESS              X03039 35871708
*                                       IN MIDDLE OF MESSAGE     X03039 35871808
         TM    SCBQTYPE-IEDQSCB(RSCB),SCBBFMM                    X03039 35871908
         BO    LEAVE                    BR YES                   X03039 35872008
*                                                                X03039 35872108
         TM    LCBSTAT4,LCBINPTP        INPUT PENDING?           X03039 35872608
         BO    PRIME                    BR YES                   X03039 35873008
*                                                                X03039 35873508
         TM    LCBSTAT3,LCBRDOUT        READ OUTSTANDING         X03039 35874008
         BZ    LEAVE                    BR NO                    X03039 35874508
*                                                                X03039 35875008
         TS    LCBTSTSW                 READ BACK INTO TPIO/FDBK X03039 35875508
         BNZ   LEAVE                    BR YES                   X03039 35876008
*                                                                X03039 35876508
         STM   R0,R15,AVTSAVE3          SAVE REGISTERS           X03039 35877008
*                                       ADDR LCCW GEN'R STCB VTO X03039 35878008
         L     R15,SAVTLCWQ+(QCBSTVTO-IEDQQCB)                   X03039 35878508
         L     R15,AVTEZERO(,R15)       RESET ENTRY POINT ADDR   X03039 35879008
         LA    R0,LXC                   PASS RESET CONDITIONAL   X03039 35879508
         SR    RTEMP,RTEMP              INDICATE NO DATA TO IAF2 X03039 35880008
         SR    R5,R5                    INDICATE - USE RESET LCPBX03039 35880508
         BALR  R14,R15                  GO ISSUE RESET COND'L    X03039 35881008
*                                                                X03039 35881508
         LTR   R15,R15                  RESET REQUEST ACCEPTED   X03039 35882008
         LM    R0,R15,AVTSAVE3          RESTORE REGISTERS        X03039 35882508
         BZ    LEAVE                    BR RESET REQUEST ACCEPTEDX03039 35883008
*                                                                X03039 35883508
         SPACE 1                                               @ZA03122 35883609
TMDELAY  EQU   *                                               @ZA03122 35883709
         TM    QCBTSOF1,QCBDELAY        IS QCB ALREADY ON T-D Q@ZA03122 35883809
         BOR   R14                      YES-BRANCH             @ZA03122 35883909
         MVC   QCBSTCHN,QCBSLINK        REMOVE SS FROM QCB       X03039 35884008
         LA    RTEMP,ONESECD            FORCE 1 SECOND DELAY     X03039 35884508
         STH   RTEMP,QCBEOLDT           SET DELAY TIME IN QCB    X03039 35885008
         MVI   QCBLKRLN,AVTEZERO        SET QCB INDICATOR        X03039 35885508
         LA    RTEMP,AVTDELYB           ADDR OF TIME DELAY QCB   X03039 35886008
         STCM  RTEMP,AD,QCBELCHN        SET TIME DELAY QCB ADDR  X03039 35886508
         MVI   QCBPRI,PRITIME           SET TIME DELAY PRIORITY  X03039 35887008
         LR    RTEMP,RQCB               PASS QCB AS ELEMENT      X03039 35887508
         B     DSPPOSTR                 POST QCB TO TIME DELAY   X03039 35888008
*                                       AND RETURN               X03039 35888508
PRIME    EQU   *                                                 X03039 35889008
         NI    LCBSTAT4,AVTEFF-LCBINPTP   RESET INPUT PENDING    X03039 35889508
*                                       MARK LINE SENDING        X03039 35890008
         XI    LCBSTAT1,LCBSENDN+LCBFREEN                        X03039 35890508
         ST    RQCB,AVTSAVE3            SAVE QCB REG             X03039 35891008
         ST    R14,AVTSAVE3+WORD2       SAVE RETURN REG          X03039 35891508
         STCM  RLCB,AD,LCBQCBA          POST LCB TO ITSELF       X03039 35892008
         MVI   LCBPRI,PRILNFRE          SET INITIAL POST PRIORITYX03039 35892508
         LR    RTEMP,RLCB               SET LCB AS POST ELEMENT  X03039 35893008
         BAL   R14,DSPPOSTR             POST LCB                 X03039 35893508
*                                                                X03039 35894008
         L     RQCB,AVTSAVE3            RESTORE QCB ADDRESS      X03039 35894508
         L     R14,AVTSAVE3+WORD2       RESTORE RETURN ADDRESS   X03039 35895008
*                                                                X03039 35895508
.NOTVTAM ANOP                                                    X03039 35896008
LEAVE    EQU   *                                                        35900020
         LR    RSTCB,RLCB                                               36000020
         B     DSPUNAVR                 LINK STCB INTO CHAIN            36100020
*                                         AND RETURN TO CALLER          36200020
         AIF   ('&GEN' NE 'VTAM').EXIT                           X03039 36270008
*                                                                X03039 36340008
REQLOGON EQU   *                                                 X03039 36410008
         OI    QCBSTAT,QCBSEND          INDICATE THAT SEND     @XM10739 36480009
*                                       SCHED SHOULD BE PUT IN @XM10739 36500009
*                                       CHAIN WHEN PLCB IS     @XM10739 36520009
*                                       ASSIGNED               @XM10739 36540009
         NI    QCBSTAT,AVTEFF-QCBSCHDL  INIT SCHDL SWITCH      @XM10739 36560009
         BAL   R5,GETTERM               GET TERMINAL ENTRY     @XM10739 36580009
         TM    TRMSTAT0-IEDNTRM(RTEMP),TRMLUNIT LOGICAL UNIT   @XM10739 36600009
         BZ    CKCALL                   NO-BRANCH              @XM10739 36620009
         CLI   QCBSTPRI,LUINIT          TCMSESN=LUINIT         @XM10739 36640009
         BER   R14                      YES-BRANCH             @XM10739 36660009
         B     TSPOSTED                 NO-BRANCH              @XM10739 36680009
CKCALL   EQU   *                                               @XM10739 36700009
         CLI   QCBSTPRI,NOCALL          CALL=NONE              @XM10739 36720009
         BE    SETSCHDL                 YES-BRANCH             @XM10739 36740009
         CLI   QCBSTPRI,CALLOPT         CLOCK OR CINTVL        @XM10739 36760009
         BL    TSPOSTED                 NO-BRANCH              @XM10739 36780009
         OI    QCBSTAT,QCBSCHDL         SCHED RECEIVE FIRST    @XM10739 36800009
         B     TSPOSTED                                        @XM10739 36820009
SETSCHDL EQU   *                                               @XM10739 36840009
         OI    QCBSTAT,QCBSCHDL         SCHED RECEIVE FIRST    @XM10739 36860009
         BR    R14                      RETURN                 @XM10739 36880009
TSPOSTED EQU   *                                                 X03039 37040008
         TS    QCBTSTSW                 QCB POSTED BY LOGON EXIT X03039 37110008
         BNZR  R14                      BR YES                   X03039 37180008
*                                                                X03039 37250008
*   POST QCB TO PLCB RETURN TO GET A PLCB AND REQUEST A LOGON    X03039 37320008
*                                                                X03039 37390008
         L     RTEMP,AVTSAVTP     SEC'ND AVT ADDR              @XM10729 37460009
         LA    RTEMP,SAVTPRTQ           PLCB RETURN QCB ADDRESS  X03039 37530008
         STCM  RTEMP,AD,QCBELCHN        POST QCB TO PLCB RETURN  X03039 37600008
         MVI   QCBPRI,PRILCBRQ          PLCB REQUEST PRIORITY    X03039 37670008
         LR    RTEMP,RQCB               SET QCB AS ELEMENT       X03039 37740008
         B     DSPPOSTR                 POST QCB TO PLCB RETURN  X03039 37810008
*                                       AND RETURN TO CALLER     X03039 37880008
.EXIT    ANOP                                                    X03039 37950008
EXIT     EQU   *                                                        38200020
         L     RSTCB,QCBSLINK-1         NEXT STCB (DEST SCHED)          38300020
         B     DSPBYPAS           GO ACTIVATE DESTINATION SCHEDULER     38400020
         AIF   ('&GEN' NE 'VTAM').XGTERM                       @X50X9IH 38406009
         SPACE 1                                               @X50X9IH 38412009
GETTERM  EQU   *                                               @X50X9IH 38418009
         LH    RTEMP,QCBTTCIN     GET TERMNAME TABLE OFFSET    @X50X9IH 38424009
         N     RTEMP,AVTCLRHI     CLEAR HALF                   @X50X9IH 38430009
         LR    R6,R15             SAVE REG15                   @X50X9IH 38436009
         ST    R14,AVTSAVE3       SAVE REG 14                  @XM10729 38442009
         L     R15,AVTRNMPT       GET ADDR OF TNT CODE         @X50X9IH 38448009
         BALR  R14,R15            LINK TO LOCATE TERM ENTRY    @X50X9IH 38454009
         LR    R15,R6             RESTORE REG 15               @X50X9IH 38460009
         L     R14,AVTSAVE3       RESTORE REG 14               @XM10729 38466009
         SPACE 2                                               @X50X9IH 38472009
         SH    RTEMP,AVTHA4  SET BASE TO TERMINAL PREFIX       @X50X9IH 38478009
         BR    R5                 RETURN                       @X50X9IH 38484009
.XGTERM  ANOP                                                  @X50X9IH 38490009
         DROP  15                                                       38500020
         EJECT                                                          38600020
SENDSCH  EQU   *                                                        38700020
         LA    RLCB,AVTEZERO(,RTEMP)    PASSED LCB ADDRESS              38800020
         AIF   ('&GEN' EQ 'VTAM').VSNDSCH                        X03039 38810008
         SR    RHOLD,RHOLD              CLEAR WORK REGISTER      S99228 38820022
         L     RDCB,LCBDCBPT            LOAD DCB ADDRESS         S99228 38840022
         IC    RHOLD,DCBEIOBX           INSERT LCB LENGTH        S99228 38850022
         SH    RHOLD,AVTHA4             REDUCE LCB LENGTH BY     S99228 38860022
         SH    RHOLD,AVTHA4             8 BYTES FOR ADDR LCB EXT S99228 38870022
         LA    RHOLD,ZERO(RHOLD,RLCB)   LOAD LCB EXTENSION ADDR  S99228 38880022
         USING IEDQLCBX,RHOLD                                    S99228 38890022
         TM    LCBXFLAG,LCBGPCTV        GENERAL POLL IN PROGRESS?S99228 38900022
         BO    CKDLY1                   BRANCH YES TO RCV SCH   SA65379 38910054
         TM    LCBXFLAG,LCBERPND        SOH%R MESSAGE PENDING?   S99228 38920022
         DROP  RHOLD                                             S99228 38930022
         BZ    NOERP                    NO, SPEC ERP NOT PENDING S99228 38980022
CKDLY1   EQU   *                                                SA65379 38990054
         TM    LCBINSRC+TWO,DELAY       LCB ON TIME DELAY Q?     S99228 39000022
         BZ    NODELAY                  NO, NOT IN POLL DELAY    S99228 39020022
         LR    RTEMP,RLCB               LOAD LCB ADDR            S99228 39040022
         L     R15,AVTHG02              LOAD ADDR TIME DELAY RTN S99228 39060022
         BALR  R14,R15                  BRANCH TO TIME DELAY     S99228 39080022
         LA    RQCB,LCBRSKEY            INSERT RCV SCHED IN CHAI S99228 39100022
         LR    RTEMP,RQCB               LOAD QCB ADDR            S99228 39120022
         BAL   R14,DSPPRIOR             BRANCH TO DISPATCHER     S99228 39140022
NODELAY  EQU   *                                                 S99228 39160022
         B     RCVSCHED                 BYPASS TO RCV SCHED      S99228 39180022
NOERP    EQU   *                                                 S99228 39200022
.VSNDSCH ANOP                                                    X03039 39300008
         MVC   AVTDOUBL(1),LCBSTAT1     SAE CURRENT STATE               39400020
         NI    LCBSTAT1,LCBOCNI+LCBOCWTN SAVE STOP LINE BIT    @OY14092 40000091
         OI    LCBSTAT1,LCBSENDN .      SET LCB STATE            S21101 40300020
         AIF   ('&GEN' EQ 'VTAM').VSCB                           X03039 40310008
FNDSCB   EQU   * .                                               S22025 40320022
         TM    LCBSTAT2,LCBDIAL .       IS THIS A DIAL LINE      S22025 40340022
         BO    TSTSCB .                 YES-BRANCH               S22025 40360022
         SR    R0,R0 .                  CLEAR REG FOR MULTIPLY   S22025 40380022
         SR    RTEMP,RTEMP .            CLEAR REG FOR MULTIPLY   S22025 40400022
         IC    R0,AVTSCBSZ .            PICK UP SCB SIZE         S22025 40420022
         IC    RTEMP,QCBSCBOF .         PICK UP SCB OFFSET       S22025 40440022
         MR    R0,R0 .  .               OFFSET X SIZE = PROPER   S22025 40460022
*                                       SCB OFFSET IN RTEMP      S22025 40480022
         L     R5,LCBSCBDA-1 .          SCB DIRECTORY START ADDR S22025 40500022
         LA    R5,0(RTEMP,R5) .         GET SCB FOR THIS QCB     S22025 40520022
         STCM  R5,AD,LCBSCBA            SET SCB ADDR IN LCB    @XA08073 40540091
TSTSCB   EQU   * .                                               S22025 40560022
.VSCB    ANOP                                                    X03039 40580008
         USING IEDQSCB,RLAST                                            40600020
         L     RLAST,LCBSCBA-1          GET SCB ADDRESS                 40700020
         L     RSTCB,STCBLINK-1         NEXT STCB ADDRESS       SA61773 40750005
         TM    SCBSTATE,SCBLCK1N+SCBMSGLN EXTENDD LOCK                  40800020
         BZ    NOLOCK                   NO                              40900020
         SPACE 2                                                 S22025 40901022
         TM    SCBQTYPE,SCBBFMM  .      MIDDLE MSG               S22025 40902022
         AIF   ('&GEN' NE 'VTAM').L13A                           X03039 40902208
         BO    CHKDLY                   BR YES                   X03039 40902408
         AGO   .L13B                                             X03039 40902608
.L13A    ANOP                                                    X03039 40902808
         BZ    TYPELOCK                 NO-BR                    S22025 40903022
         SPACE 2                                                 S22025 40904022
         TM    QCBSTAT,QCBSEND          MIDDLE OF SENDING LOCK MSG22025 40905022
         BO    NOLOCK                   YES-BR                   S22025 40906022
         SPACE 2                                                 S22025 40907022
         B     CHKDLY                   BRANCH IF NO            SA61773 40908005
.L13B    ANOP                                                    X03039 40908508
         SPACE 2                                                 S22025 40909022
TYPELOCK EQU   *                                                 S22025 40910022
         TM    SCBSTATE,SCBLCK1N+SCBMSGLN EXTENDED LOCK          S22025 40911022
         BM    EXTEND                   BRANCH IF EXTENDED LOCK         40920020
         SPACE                                                          40940020
         MVI   QCBLKRLN,AVTEZERO        CLEAR TO PREVENT POSSIBLE       40960020
*                                       DOUBLE POST OF LCB              40980020
         AIF   ('&GEN' EQ 'VTAM').L13C                           X03039 40980508
         CLI   LCBRSPRI,RECVPRI         RECEIVE PRIORITY        SA58984 40981005
         BNE   LOCKTEST                 BR NO, HANDLE NORMALLY  SA58984 40982005
         LR    RDCB,RQCB                SAVE QCB ADDRESS        SA58984 40983005
         LR    RSTCB,RLCB               QCB TO BE UPDATED       SA58984 40984005
         LR    RQCB,RLCB                QCB WITH SEND SCHED STCBSA58984 40985005
*                                         AT TOP OF CHAIN       SA58984 40986005
         BAL   R14,DSPUNAVR             FOR MESSAGE LOCK AND    SA58984 40987005
*                                         RECV PRIORITY, SEND   SA58984 40988005
*                                         SCHED IS ON TOP OF    SA58984 40989005
*                                         LCB STCB CHAIN OUT OF SA58984 40990005
*                                         PRIORITY ORDER. MUST  SA58984 40991005
*                                         BE REINSERTED BY PRI  SA58984 40992005
         LR    RQCB,RDCB                RESTORE QCB ADDRESS     SA58984 40993005
         L     RDCB,LCBDCBPT            RESTORE DCB REG        @OX13500 40994091
.L13C    ANOP                                                    X03039 40996008
         B     LOCKTEST            USE COMMON CODE                      41000020
         SPACE                                                          41020020
EXTEND   EQU   *                                                        41040020
         TM    AVTDOUBL,LCBRECVN        LAST OPERATION A RECEIVE        41100020
         BZ    CHKDLY                   BRANCH IF NO            SA61773 41200005
LOCKTEST EQU   *                                                        41300020
         TM    AVTDOUBL,LCBSENDN        WAS LAST OP A SEND     @XA09773 41320009
         BO    SENDEOT                  BRANCH-YES             @XA09773 41340009
         NI    SCBBSCFM,AVTEFF-SCBNOEOT ACTIVATE WILL NOT EOT  @XA09773 41360009
SENDEOT  EQU   *                                               @XA09773 41380009
         OC    QCBLKRRN,QCBLKRRN        IS THERE LOCK MSG               41400020
         BZ    NOLOCK                   NO                              41500055
         SPACE                                                          41600020
         AIF   ('&GEN' NE 'VTAM').LOCKMSG                        X03039 41630008
         TM    LCBSTAT3,LCBERLCK        ERROR LOCK SET           X03039 41660008
         BO    LCBTOIAF                 BR YES                   X03039 41690008
*                                                                X03039 41720008
.LOCKMSG ANOP                                                    X03039 41750008
         MVC   SCBSCHDR,QCBLKRRN        SET HEADER                      41800020
         B     SENDINIT .               SEND LOCK MESSAGE       SA52971 42000022
         SPACE 2                                                 S21101 42050020
         SPACE 3                                                 S21101 42650020
NOLOCK   EQU   *                                                        42700020
         TM    LCBSTAT2,LCBDIAL         IS THIS A DIAL LINE     OX02199 42700654
         BO    CKMIDMSG                 YES,SKIP STOPLINE TEST  OX02199 42701254
         TM    LCBSTAT1,LCBOCNI         STOPLINE IN PROGRESS    SA56606 42702022
         AIF   ('&GEN' EQ 'VTAM').BHELD                          X03039 42703008
         BO    NEXTSTCB                 YES-BRANCH              SA56606 42704022
         AGO   .MMTEST                                           X03039 42704208
.BHELD   ANOP                                                    X03039 42704408
         BO    REMOVESS                 BR YES                   X03039 42704608
.MMTEST  ANOP                                                    X03039 42704808
CKMIDMSG EQU   *                                                OX02199 42705054
         TM    SCBQTYPE,SCBBFMM .       MIDDLE OF MSG            S22025 42706022
         AIF   ('&GEN' NE 'VTAM').BDELAY                         X03039 42706108
         BO    NEXTSTCB                 BR YES                   X03039 42706208
         AGO   .TSTLGOF                                          X03039 42706308
.BDELAY  ANOP                                                    X03039 42706408
         BZ    TSTDELAY .               NO-BRANCH                S22025 42706522
         TM    QCBSTAT,QCBSEND .        QCB IN SEND MODE         S22025 42707022
         BO    SETSCERB .               YES GO SET ERB AND SCB UPS22025 42707522
*                                       FOR RECALL               S22025 42708022
         B     NEXTSTCB .               GET NEXT STCB            S22025 42709022
         AGO   .TSTDELY                                          X03039 42713008
.TSTLGOF ANOP                                                    X03039 42717008
         TM    QCBFLAG,QCBTSSES         IN TSO SESSION         @Z30X8IM 42718008
         BO    TSTDELAY                 BRANCH YES             @Z30X8IM 42719008
         TM    LCBSTAT4,LCBLGOFF        LOGOFF REQUESTED         X03039 42721008
         BO    DELAYSND                 BR YES                   X03039 42725008
.TSTDELY ANOP                                                    X03039 42729008
         SPACE 2                                                        42735020
TSTDELAY EQU   * .                                               S22025 42740022
         TM    LCBSTAT1,LCBOCNI .       STOPLINE IN PROGRESS    OX02199 42743054
         AIF   ('&GEN' NE 'VTAM').BNSTCB                         X03039 42743508
         BO    REMOVESS                 BR YES                   X03039 42744008
*                                                                X03039 42744508
         AGO   .TSTCLOS                                          X03039 42745008
.BNSTCB  ANOP                                                    X03039 42745508
         BO    NEXTSTCB                 YES,BRANCH              OX02199 42746054
         TM    AVTBIT1,AVTDLAYN .       SYSTEM DELAY             S22025 42750022
         BO    NEXTSTCB .               BRANCH-YES               S22025 42752022
.TSTCLOS ANOP                                                    X03039 42753008
         TM    AVTBIT1,AVTCLOSN+AVTQUCKN QUICK CLOSE             S22025 42754022
         AIF   ('&GEN' NE 'VTAM').L14                            X03039 42754608
         BO    REMOVESS                 BR YES                   X03039 42755208
         AGO   .L15                                              X03039 42755808
.L14     ANOP                                                    X03039 42756408
         BO    NEXTSTCB .               QUICK CLOSE              S22025 42757022
         AIF   ('&GEN' EQ 'MINI').L16                                   42800020
         AIF   ('&GEN' NE 'VTAM').TSTSCHD                        X03039 42807008
.L15     ANOP                                                    X03039 42810008
*                                                                X03039 42814008
         L     RTEMP,AVTSAVTP           SECONDARY AVT ADDRESS    X03039 42821008
*                                                                X03039 42828008
         USING IEDNSVTD,RTEMP           ESTABLISH ADDRESSABILITY X03039 42835008
*                                       VTAM QUICK CLOSEDOWN     X03039 42842008
         TM    SAVTSTAT,SAVTVCLS+SAVTVQCK                        X03039 42849008
         BO    REMOVESS                 BR YES                   X03039 42856008
*                                                                X03039 42863008
         TM    LCBSTAT3,LCBERLCK        ERROR LOCK SET           X03039 42870008
         BO    LCBTOIAF                 BR YES                   X03039 42877008
*                                                                X03039 42884008
.TSTSCHD ANOP                                                    X03039 42891008
         TM    QCBSTAT,QCBSCHDL         HAS SOURCE BEEN SET FOR         42900020
*                                         CLOCK OR INTVL                43000020
         BZ    NOTDIALQ                 BR NO                    X03039 43100008
*                                                                X03039 43110008
         AIF   ('&GEN' NE 'VTAM').ACTDIAL                        X03039 43120008
         NI    QCBSTAT,AVTEFF-QCBSCHDL  RESET RCV BEFORE SEND    X03039 43130008
         B     RCVSCHED                 GO ACTIVATE RCV SCHEDULERX03039 43140008
*                                                                X03039 43150008
         AGO   .NOTDIAL                                          X03039 43160008
.ACTDIAL ANOP                                                    X03039 43170008
         LR    RTEMP,RQCB     SET FOR DIAL SCHEDULER                    43200020
         LA    RSTCB,LCBRSKEY           NEXT STCB                       43300020
         B     DSPBYPAS                 ACTIVATE DIAL RCV SCHED         43400020
.NOTDIAL ANOP                                                    X03039 43450008
NOTDIALQ EQU   *                                                        43500020
         AIF   ('&GEN' NE 'VTAM').L16                            X03039 43510008
         TM    LCBBSMST,LCBRTRRO        RESP OWED TO RTR       @X50X9II 43513009
         BO    CKSSOUT                  YES-BRANCH             @X50X9II 43516009
         TM    LCBSTAT3,LCBUNSIP        UNSOLICITED INPUT RCV'D  X03039 43520008
         BO    RCVSCHED                 BR YES                   X03039 43530008
CKSSOUT  EQU   *                                               @X50X9II 43540009
         TM    LCBSTAT3,LCBSSOUT        REMOVE SS FOR SPECOUT    X03039 43550008
         BZ    GOSEND                   BR NO                    X03039 43560008
*                                                                X03039 43570008
         AGO   .VNMSGLT                                          X03039 43580008
.L16     ANOP                                                           43600020
         TM    SCBBSCFM,SCBMLMTN        MESSAGE LIMIT REACHED           43700020
         BZ    NOLMT                    NO                              43800020
         NI    SCBBSCFM,SCBMLMTF        RESET BIT                       43900020
         AGO   .NEVTAM                                           X03039 43900508
.VNMSGLT ANOP                                                    X03039 43901508
DELAYSND EQU   *                                                 X03039 43903008
         LR    R5,RSTCB                 SAVE NEXT STCB ADDRESS   X03039 43904008
         LR    R6,RQCB                  SAVE QCB ADDR            X03039 43904508
         LR    RSTCB,RQCB               UNAVAIL PARAMETER        X03039 43905008
         LR    RQCB,RLCB                UNAVAIL PARAMETER        X03039 43905508
         BAL   R14,DSPUNAVR             PUT SS BACK INTO QCB     X03039 43906008
*                                                                X03039 43906508
         LR    RSTCB,R5                 RESTORE NEXT STCB ADDR   X03039 43907008
         LR    RQCB,R6                  RESTORE QCB ADDR         X03039 43907508
         MVC   QCBSTCHN,QCBSLINK        REMOVE SEND SCH FROM QCB X03039 43908008
*                                                                X03039 43908508
*   PREPARE TO PUT QCB ON THE TIME DELAY QUEUE                   X03039 43909008
*                                                                X03039 43909508
         TM    LCBSTAT3,LCBSSOUT        REMOVE SS FOR SPECOUT  @ZA03122 43909609
         BO    DELAY1                   YES, FORCE 1 SEC DELAY @ZA03122 43909709
         LH    R5,QCBINTVL              ASSUME CLOCK OR CINTVL   X03039 43910008
         N     R5,AVTCLRHI              CLEAR HI HALF            X03039 43910508
         CLI   QCBSTPRI,CLOCK           CLOCK SPECIFIED          X03039 43911008
         BNE   INTVL                    BR NO                    X03039 43911508
*                                                                X03039 43912008
         AR    R5,R5                    DOUBLE VALUE             X03039 43912508
         TIME  BIN                      GET TIME OF DAY          X03039 43913008
         SRDL  R0,HALF                  SHIFT TO REG1            X03039 43913508
         D     R0,HUND                  TIME IN SECONDS          X03039 43914008
         CLR   RTEMP,R5                 IS TIME TODAY            X03039 43914508
         BL    TODAY                    BR YES                   X03039 43915008
*                                                                X03039 43915508
         A     R5,TWNTY4HR              ADD 24 HOURS             X03039 43916008
TODAY    EQU   *                                                 X03039 43916508
         SR    R5,RTEMP                 AMOUNT OF DELAY          X03039 43917008
         B     CHKTIME                  CONTINUE CLOCK PROCESSINGX03039 43917508
*                                                                X03039 43918008
INTVL    EQU   *                                                 X03039 43918508
         CLI   QCBSTPRI,CINTVL          CINTVL SPECIFIED         X03039 43919008
         BE    CHKTIME                  BR YES                   X03039 43919508
*                                                                X03039 43920008
DELAY1   EQU   *                                               @ZA03122 43920209
         LA    R5,ONESECD               SET DELAY TO 1 SECOND    X03039 43920508
CHKTIME  EQU   *                                                 X03039 43921008
         C     R5,TWELVHR               MORE THAN 12 HOURS       X03039 43921508
         BNH   LESS12                   BR NO                    X03039 43922008
*                                                                X03039 43922508
         S     R5,TWELVHR               MAKE LESS THAN 12 HOURS  X03039 43923008
         OI    QCBSTAT,QCBTIME          INDICATE MORE THAN 12 HRSX03039 43923508
LESS12   EQU   *                                                 X03039 43924008
         STH   R5,QCBEOLDT              SET DELAY TIME           X03039 43924508
         MVI   QCBLKRLN,AVTEZERO        SET QCB INDICATOR        X03039 43925008
         LR    RTEMP,RQCB               QCB ADDR FOR TIME DELAY  X03039 43925508
         LA    R14,NEXTSTCB             SET RETURN ADDRESS       X03039 43926008
         L     R15,AVTHG01              ADDRESS OF TIME DELAY    X03039 43926508
         BR    R15                      GO PUT QCB ON TIME DELAY X03039 43927008
         AGO   .VSCHL                                            X03039 43927508
.NEVTAM  ANOP                                                    X03039 43928008
         LR    RSTCB,RLCB .             UNAVAIL PARAMETER        S21101 43930020
         LR    RQCB,RLCB .              RESTORE QCB ADDR         S22025 43936022
         B     POSTIT .                 POST LCB TO ITSELF       S21101 43954020
         SPACE 2                                                 S21101 43960020
NOLMT    EQU   *                                                 S21101 43966020
         TM    QCBELCHN+2,QCBCNTEN      CONTENTION,RVI,OR OTHER@OX17153 43972000
*                                         BUFFER BUSY CONDITION  S21101 43978020
         BZ    NOTBUSY .                BRANCH IF NO             S21101 43984020
         NI    QCBELCHN+2,AVTEFF-QCBCNTEN RESET CONTENTION BIT @OX17153 43990000
         L     RSTCB,QCBSLINK-1         GET NEXT STCB                   44000020
         CLI   STCBPRI-IEDQSTCB(RSTCB),0   QEVENT NEXT                  44100020
         BE    CHKDLY                   BRANCH-YES GO RCV      @OY14503 44160091
         B     NEXTSTCB                 TRY TO SEND TO NEXTTERM@OY14503 44190091
*                                         RECEIVE SCHEDULER      S21101 44220020
.VSCHL   ANOP                                                    X03039 44260008
         SPACE                                                          44300020
CHKDLY   EQU   *                                                SA61773 44350005
         TM    LCBINSRC+2,DELAY         IN DELAY Q                      44400020
         BNZ   NEXTSTCB                 YES DISPATCH                    44500020
RCVSCHED EQU   *                                                SA61773 44600005
         LA    RSTCB,LCBRSKEY           RCV SCHED STCB          SA61773 44608005
NEXTSTCB EQU   *                                                SA61773 44616005
         AIF   ('&GEN' NE 'VTAM').NORMVSS                        X03039 44618008
         NI    LCBSTAT3,AVTEFF-LCBSSOUT RESET REMOVE SS BIT      X03039 44620008
.NORMVSS ANOP                                                    X03039 44622008
         LR    RTEMP,RLCB               SET ELEMENT REG         SA61773 44624005
         LR    RQCB,RLCB                SET QCB REG             SA61773 44632005
         B     DSPBYPAS                 BYPASS                  SA61773 44640005
         SPACE 3                                                 S21101 44650020
         AIF   ('&GEN' NE 'VTAM').NOTBUSY                        X03039 44655008
*                                                                X03039 44660008
LCBTOIAF EQU   *                                                 X03039 44665008
         MVC   LCBSTAT1,AVTDOUBL        RESTORE PREVIOUS STATUS  X03039 44667008
         L     RTEMP,AVTSAVTP           SECONDARY AVT ADDRESS    X03039 44670008
         LA    RTEMP,SAVTLCWQ           LCCW GEN'R QCB ADDRESS   X03039 44675008
         STCM  RTEMP,AD,LCBQCBA         PUT QCB ADDR IN LCB      X03039 44680008
         LR    RTEMP,RLCB               SET LCB AS ELEMENT       X03039 44685008
         B     DSPPOST                  POST LCB TO LCCW GEN'R   X03039 44690008
*                                                                X03039 44695008
         AGO   .VSEND                                            X03039 44700008
.NOTBUSY ANOP                                                    X03039 44705008
NOTBUSY  EQU   *                                                 S21101 44720020
         MVC   AVTDOUBL+1(1),SCBBSCFM   SAVE FLAGS              SA59034 44760005
         AIF   ('&GEN' EQ 'MINI').L17                                   44800020
         TM    LCBSTAT2,LCBDIAL+LCBSYNC DIAL BSC                        44900020
         BNO   NOBSD                    BRANCH IF NOT BSC DIAL          45000020
         SPACE                                                          45100020
         CLI   LCBTSTSW,AVTEFF          WAS THERE HARD ERROR INA        45200020
*                                         PREVIOUS SELSECTION           45300020
         MVC   LCBSENS0(2),AVTDOUBL                            @OX12563 45350091
         BE BSDIAL                      BRANCH IF YES                   45400020
************************************************************** @ZA03063 45500009
*                                                            * @ZA03063 45520009
*        SCBNOEOT IS USED TO CONTROL QUEUE FLUSH FOR BSC     * @ZA03063 45540009
*        DIAL WITH SEND PRIORITY. SCBNOEOT IS ALSO USED TO   * @ZA03063 45560009
*        FORCE A RECEIVE OPERATION AFTER TCAM HAS SENT AN    * @ZA03063 45580009
*        EOT. THIS IS REQUIRED FOR ALL BSC DIAL OPERATIONS.  * @ZA03063 45600009
*        IT IS SET ON EVERY RECEIVE OPERATION AND RESET ON   * @ZA03063 45620009
*        THE FIRST SEND AFTER A RECEIVE. LINE END APPENDAGE  * @ZA03063 45640009
*        WILL TURN ON SCBNOEOT AND NOT SEND AN EOT FOR BSC   * @ZA03063 45660009
*        DIAL WITH SEND PRIORITY. LINE END APPENDAGE RESETS  * @ZA03063 45680009
*        SCBNOEOT WHENEVER IT SENDS AN EOT, FOR EXAMPLE ON A * @ZA03063 45700009
*        MSGGEN.                                             * @ZA03063 45720009
*                                                            * @ZA03063 45740009
************************************************************** @ZA03063 45760009
         TM    SCBBSCFM,SCBNOEOT        TCAM SEND AN EOT       @ZA03063 45780009
         BZ    GORCV                    BRANCH IF YES          @ZA03063 45790009
         NI    SCBBSCFM,AVTEFF-SCBNOEOT INDICATE EOT SENT      @ZA03063 45820009
         TM    AVTDOUBL,LCBSENDN        LAST OPERATION A SEND  @ZA03063 45830009
         BZ    GOSEND                   BRANCH IF NO           @ZA03063 45850009
         OI    SCBBSCFM,SCBNOEOT        INDICATE EOT NOT SENT  @ZA03063 45870009
         CLI   LCBRSPRI,SENDPRI         SEND PRIORITY          @ZA03063 45900009
         BE    GOSEND                   BRANCH IF YES          @ZA03063 45920009
GORCV    EQU   *                                               @ZA03063 45940009
         OI    SCBBSCFM,SCBNOEOT        INDICATE EOT NOT SENT  @ZA03063 45960009
         NI    LCBSTAT2,AVTEFF-LCBNEGRP FORCE THE ADDITIONAL   @ZA03063 45980009
*                                       RECEIVE OPERATION      @ZA03063 46000009
*                                       REQUIRED BY BSC DIAL   @ZA03063 46020009
*                                       ARCHITECTURE           @ZA03063 46040009
         B     RCVSCHED                 GO RECEIVE             @ZA03063 46060009
NOBSD    EQU   *                                                        46200020
         AIF   ('&GEN' EQ 'NTSO').L17A                                  46220020
         TM    QCBDSFLG,QCBDISK+QCBCORE NON-TSO QUEUES              TSO 46240020
         BZ    GOSEND                   BRANCH ON NO                TSO 46260020
         TM    QCBFLAG,QCBTSSES         TIME-SHARING SESSION?    S22029 46266022
         BO    GOSEND                   YES, START SEND OPRATION S22029 46272022
.L17A    ANOP                                                           46280020
         CLI   LCBTSTSW,AVTEFF          REQUEST FOR NEW CONNECTION      46300020
         BNE   GOSEND                   BRANCH IF NO                    46400020
BSDIAL   EQU   *                                                        46500020
         L     RTEMP,DCBDEBAD           DEB ADDRESS            @OX13500 46510091
         USING DEBNMSUB,RTEMP           ADDRESSABILITY         @OX13500 46520091
         TM    DEBOPATB,OUTONLY         OUTPUT ONLY DEVICE?    @OX13500 46530091
         BO    GOSEND                   YES WE WANT TO SEND    @OX13500 46540091
         DROP  RTEMP                                           @OX13500 46550091
         CLI   QCBSTPRI,CALLPRI         CALL=NONE                       46600020
         BE    TRMHELD                  BRANCH IF YES - THIS IS@OY12969 46700091
*                                         POSSIBLE IF HARD ERROR ON     46800020
*                                         PREVIOUS ATTEMPT TO SEND      46900020
.VSEND   ANOP                                                    X03039 46950008
GOSEND   EQU   *                                                        47000020
         AIF   ('&GEN' EQ 'NTSO').L17                                   47100020
         TM    AVTBIT1,AVTTSON          IS IT TIME SHARING?         TSO 47200020
         BZ    TSO3                     BRANCH ON NO                TSO 47300020
         L     R6,AVTTSOPT              GET ADDRESS OF TSINPUT QCB  TSO 47400020
         AIF   ('&GEN' EQ 'VTAM').VTSO                         @Z30X8IR 47450008
         L     R6,TSISCHED-IEDQTSI(R6)  ADDRESS OF TS SCHEDULER     TSO 47500020
         BAL   RWORK,12(,R6)            BRANCH TO ROUTINE           TSO 47600020
         AGO   .SEND                                           @Z30X8IR 47610008
.VTSO    ANOP                                                  @Z30X8IR 47620008
         L     R6,TSIRNSCH-IEDQTSI(,R6) VTAM TSO SCHED ADDR    @Z30X8IR 47630008
         LA    RSELECT,FOUR             INDEX TO IEDA20 ENTRY  @Z30X8IR 47640008
*                                         PT OF VTAM TSO SCHED @Z30X8IR 47650008
         BALR  RRTN,R6                  BRANCH TO VTAM TSO     @Z30X8IR 47660008
*                                         SCHED,IEDAYG         @Z30X8IR 47670008
.SEND    ANOP                                                  @Z30X8IR 47680008
         B     TSO4                     PUT SEND SCHED IN QCB       TSO 47700020
         B     SENDPREP                 GO TO START SENDING.        TSO 47800020
TSO3     EQU   *                                                    TSO 47900020
.L17     ANOP                                                           48000020
         AIF   ('&GEN' EQ 'VTAM').VHELD                          X03039 48050008
         TM    QCBFLAG,QCBTERMQ         QUEUED BY TERMINAL?             48100020
         BZ    NOTRMQ                   BRANCH IF NOT                   48200020
         SPACE 2                                                        48300020
.VHELD   ANOP                                                    X03039 48350008
         TM    QCBSTAT,QCBTRMHO         HAS TERMINAL BEEN INTERCEPTED   48400020
         BO    TRMHELD                  BRANCH IF  TERMINAL WAS HELD    48500020
*                                         TO AVOID GETTING MSG OFF QUE  48600020
         SPACE 2                                                        48700020
NOTRMQ   EQU   *                                                        48800020
         AIF   ('&GEN' EQ 'NTSO' OR '&GEN' EQ 'MINI').MIX0010    S22029 48810022
         TM    QCBDSFLG,QCBTSQ          TIME-SHARING QUEUEING    S22029 48820022
         BO    NOINIT                   YES. SKIP SENDING INIT   S22029 48830022
*                                       MODE MSGS.               S22029 48840022
.MIX0010 ANOP                                                    S22029 48850022
         AIF   ('&GEN' NE 'VTAM').NOSAVE                         X03039 48860008
         LR    R5,RSTCB                 SAVE NEXT STCB ADDR      X03039 48870008
.NOSAVE  ANOP                                                    X03039 48880008
         L     RSTCB,QCBINSRC-1   GET INITIATE SOURCE LCB CHAIN         48900020
         N     RSTCB,CLEAR              CLEAR LOW ORDER BYTE            49000020
         LA    RQCB,0(,RQCB)            CLEAR HI ORDER BYTE             49100020
         CLR   RSTCB,RQCB               INITIATE MODE                   49200020
         AIF   ('&GEN' EQ 'VTAM').VINIT                          X03039 49250008
         BE    NOINIT                   NO                              49300020
         AGO   .NVINIT                                           X03039 49320008
.VINIT   ANOP                                                    X03039 49340008
         BE    RSTRSTCB                 BR NO                    X03039 49360008
.NVINIT  ANOP                                                    X03039 49380008
         MVC   QCBINSRC(3),LCBINSRC-IEDQLCB(RSTCB) REMOVE LCB FROM      49400020
*                                      INITIATE CHAIN                   49500020
         NI    LCBINSRC+2-IEDQLCB(RSTCB),X'FF'-LCBNSRCD TURN OFF        49600020
*                                      INITIATE FLAG                    49700020
         STCM  RLCB,AD,LCBINSRC-IEDQLCB(RSTCB) DEST LCB INTO SRCSA62953 49750005
         L     RSTCB,LCBSCBA-1-IEDQLCB(RSTCB) SOURCE SCB                49900020
         MVC   SCBSCHDR,SCBDCHDR-IEDQSCB(RSTCB)  LOAD SOURCE SCB        50000020
         TM    QCBDSFLG,QCBREUS+QCBNREUS  DISK                          50100020
         BNZ   MOVER                    YES                             50200020
         MVC   SCBSCHDR,SCBCCHDR-IEDQSCB(RSTCB)   PARAMETER             50300020
MOVER    EQU   *                                                        50400020
         MVI   SCBPRI,AVTEZERO          RESET PRIORITY           A      50500022
         OI    LCBSTAT1,LCBSENDN+LCBINITN SET LCB STATE                 50600020
         B     SENDINIT                 SEND MSG                        50700020
         SPACE 3                                                 S21101 50750020
         AIF   ('&GEN' NE 'VTAM').NRESTR                         X03039 50760008
RSTRSTCB EQU   *                                                 X03039 50770008
         LR    RSTCB,R5                 RESTORE NEXT STCB ADDR   X03039 50780008
.NRESTR  ANOP                                                    X03039 50790008
NOINIT   EQU   *                                                        50800020
         TM    QCBDSFLG,QCBHELD         IS FEFO CHAIN BEING CHANGED     50810020
*                                         BY REUS IN DISABED CODE       50820020
         BO    TRMHELD                  BRANCH YES, TO REMOVE STCB.     50830020
*                                         WILL BE RE-INSERTED LATER     50840020
         SPACE                                                          50850020
         SR    R0,R0                    CLEAR COUNT REGISTER            50900020
         LA    RTEMP,IEDQQCB+QCBMSIZE-QCBPSIZE INITIALIZE SCAN FOR      51000020
*                                      LOOP                             51100020
SCANLOOP EQU   *                                                        51200020
         LA    RTEMP,QCBPSIZE(0,RTEMP) BUMP TO NEXT PRIORITY QCB        51300020
         MVC   SCBSCHDR-IEDQSCB(3,RLAST),QCBFFEFO-IEDQPQCB(RTEMP)       51600020
*                                      NEXT FEFO MESSAGE                51700020
         OC    QCBFFEFO-IEDQPQCB(3,RTEMP),QCBFFEFO-IEDQPQCB(RTEMP) IS   51800020
*                                      THERE AN UNSENT FEFO MESSAGE     51900020
         BNZ   PREPARE            YES, GO PREPARE SCB                   52000020
         BCTR  R0,R0                    BUMP COUNT                      52100020
         CLI   QCBPRIPQ-IEDQPQCB(RTEMP),0 LAST PRIORITY QCB             52200020
         BNE   SCANLOOP           NO, LOOK AT NEXT ONE                  52300020
         AIF   ('&GEN' EQ 'MINI').L19                                   52400020
         MVI   QCBPRLVL,AVTEZERO .      RESET HIGHEST PRIORITY LES21101 52430020
*                                         MESSAGE INDICATOR FOR DS21101 52440020
*                                         LINES.  HM WILL INDICATS21101 52450020
*                                         HIGHEST LEVEL IN USE   S21101 52460020
.L19     ANOP                                                    S22025 52470022
TRMHELD  EQU   * .                                               S22025 52480022
         AIF   ('&GEN' EQ 'VTAM').VRMOVSS                        X03039 52482008
         MVC   SCBBSCFM,AVTDOUBL+1      RESTORE FLAGS           SA59034 52485005
         AIF   ('&GEN' EQ 'MINI').L19A                           S22025 52490022
         LA    RSTCB,LCBRSKEY           RCV SCHED STCB                  52500020
         LR    RTEMP,RQCB               SET ELEMENT FOR DIAL RCV SN     52600020
         CLI   QCBSTPRI,CALLOPT         THIS CLOCK OR INTVL             52700020
         BNL   DSPBYPAS                 YES TO RESET DELAY              52800020
         AGO   .NRMOVSS                                          X03039 52807008
.VRMOVSS ANOP                                                    X03039 52817008
REMOVESS EQU   *                                                 X03039 52827008
         NI    LCBSTAT3,AVTEFF-LCBSSOUT RESET REMOVE SS BIT      X03039 52832008
.NRMOVSS ANOP                                                    X03039 52837008
         SPACE 3                                                 S21101 52850020
.L19A    ANOP                                                    S22025 52900022
         AIF   ('&GEN' EQ 'MINI' OR '&GEN' EQ 'NTSO').L18               53000020
TSO4     EQU   *                                                    TSO 53100020
.L18     ANOP                                                           53200020
         LA    RSTCB,LCBSTCBA-(STCBLINK-IEDQSTCB)               SA56606 53400022
*                                       SET REG                 SA56606 53406022
STCBLP   EQU   *                                                SA56606 53412022
         LR    RTEMP,RSTCB              SAVE PREVIOUS STCB      SA56606 53418022
         L     RSTCB,STCBLINK-IEDQSTCB-1(RSTCB)                 SA56606 53424022
*                                       LOAD NEXT STCB          SA56606 53430022
         LA    R0,QCBSTVTO-IEDQQCB      STCB OFFSET             SA56606 53436022
         LR    RWORK,RSTCB              SET REG                 SA56606 53442022
         LA    RWORK,ZERO(,RWORK)       CLEAR HO BYTE           SA56606 53448022
         SR    RWORK,R0                 QCB ADDR                SA56606 53454022
         CLR   RWORK,RQCB               CORRECT QCB             SA56606 53460022
         BNE   STCBLP                   BRANCH IF NO            SA56606 53466022
         SH    RTEMP,AVTHA4             SET REG                 SA56606 53472022
         LR    RSTCB,RQCB               UNAVAIL REG             SA56606 53478022
         LR    RQCB,RTEMP               UNAVAIL REG             SA56606 53484022
POSTIT   EQU   *                                                 S21101 53500020
         BAL   R14,DSPUNAVR .           REMOVE STCB              S22025 53550022
         AIF   ('&GEN' EQ 'VTAM').VNMGLMT                        X03039 53570008
         MVI   SCBSNDCT,AVTEZERO .      RESET SEND LIMIT COUNT   S21101 53600020
.VNMGLMT ANOP                                                    X03039 53700008
         LR    RTEMP,RLCB               SET LCB TO BE QPOST'ED          53800020
         ST    RTEMP,LCBQCBA-1          GO QPOST                        53900020
         B     DSPPOST            GO QPOST                              54000020
         SPACE 1                                                        54100020
PREPARE  EQU   *                                                        54200020
         LPR   R0,R0                    MAK COUNT POSITIVE              54300020
         STC   R0,SCBPRI-IEDQSCB(,RLAST)  SET PRIORITY LEVEL INDEX      54400020
         AIF   ('&GEN' EQ 'MINI').L21                            S21101 54420020
         STC   R0,QCBPRLVL .            SET HIGHEST LEVEL MSG IN S21101 54440020
.L21     ANOP                                                    S21101 54460020
SENDINIT EQU   *                                               @SA72478 54530061
         XC    SCBFEFO,SCBFEFO          CLEAR FOR PRIORITY LEVEL        54600020
*                                         MESSAGES                      54700020
         OI    QCBFLAG,QCBSDFFO         SET AS SENDING A MESG   SA52971 54760022
SENDPREP EQU   *                                                        54800020
         NI    LCBERBST,AVTEFF-LCBDLNKN . RESET DLINK SWITCH     S22025 55050022
         NI    LCBSTAT2,AVTEFF-LCBSNDPR RESET SEND PRIORITY    @OY12395 55300091
         STCM  RQCB,AD,SCBDESTQ-IEDQSCB(RLAST) SET QCB ADDRESS   Y01948 55600005
         MVC   SCBSCSEG(3),SCBSCHDR .   SET SCB SEG              S22025 55820022
         MVI   SCBUNTCT,AVTEZERO .      SET UNIT COUNT TO BUILD  S22025 55840022
*                                       FROM BEGINNING OF BUFFER S22025 55860022
COMMON1  EQU   *                                                 S22025 55900022
         XC    LCBRECAD,LCBRECAD .      CLEAR Q RECORD ADDRESS   S22025 56000022
         XC    LCBRECOF,LCBRECOF .      ALSO OFFSETR FOR LINEEND S22025 56100022
         AIF   ('&GEN' EQ 'VTAM').VSPOUT                         X03039 56110008
         TM    LCBSTAT2,LCBDIAL                                 SA60792 56120022
         BO    NORESET                                          SA60792 56140022
         NC    LCBTTCIN,LCBTTCIN        CONNECTED TERMINAL ?    SA69635 56146005
         BNZ   NORESET                  YES, BR-LEAVE AS IS     SA69635 56152005
         MVI   LCBTTCIN+ONE,ONE                                 SA60792 56160022
NORESET  EQU   *                                                        56180022
.VSPOUT  ANOP                                                    X03039 56182008
         AIF   ('&GEN' NE 'VTAM').SETERB                         X03039 56184008
         TM    LCBSTAT3,LCBSPOUT        SPECOUT PROCESSING       X03039 56186008
         BZ    BUILDERB                 BR NO                    X03039 56188008
*                                                                X03039 56190008
         OI    LCBSTAT3,LCBNLOUT        REQUEST NULL WRITE       X03039 56192008
BUILDERB EQU   *                                                 X03039 56194008
.SETERB  ANOP                                                    X03039 56196008
         MVI   LCBERBPY,PRIINTRQ        INITIAL REQUEST PRIORITY        56200020
         L     RDCB,LCBDCBPT            DCB BASE                        56300020
         MVC   LCBRBCT1,DCBBUFOU        REQUEST BUFOUT           X03039 56400008
         NI    LCBRBCT1,X0F             CLEAR 1ST 4 BITS         X03039 56430008
         MVI   LCBRBCT2,AVTEZERO        ZERO DISABLED COUNT      X03039 56460008
COMMON   EQU   *                                                 S22025 56510022
         LA    RTEMP,AVTDSIOB .         GET DISK I/O QCB ADDRESS S22025 56520022
COMMON2  EQU   *                                                 S22025 56525022
         ST    RTEMP,LCBERB .           SET TO POST ERB TO IT    S22025 56530022
         LA    RTEMP,LCBERB             ADDR OF ERB              S22025 56550022
         B     DSPPOST            GO QPOST ERB TO DISK READ ROUTINE     56600020
         AIF   ('&GEN' EQ 'VTAM').EQUATES                        X03039 56604008
         SPACE 7                                                 S21101 56609020
         EJECT                                                   S22025 56700922
SETSCERB EQU   * .                                               S22025 56701822
         TM    SCBQTYPE,SCBCOREQ .      CORE QUEUEING            S22025 56702722
         BO    GOCORE .                 YES-BR                   S22025 56703622
         TM    SCBSTAT1,PRFNLSTN  .     EOM BUFFER               S22025 56704522
         BO    NOTALL .                 BRANCH IF NO             S22025 56705422
         CLC   SCBDEOB+1(3),SCBCRCD .   SENDING LAST SEGMENT     S22025 56706322
         BNL   GOCORE                                           SA60792 56707222
         NC    SCBXTRA(THREE),SCBXTRA                           SA60792 56707322
         BZ    RSET                                             SA60792 56707422
         CLC   SCBDEOB+ONE(THREE),SCBXTRA                       SA60792 56707522
         BNL   GOCORE                                           SA60792 56707622
RSET     EQU   *                                                SA60792 56707722
         OI    SCBSTAT1,PRFNLSTN .      FLAG NOT LAST            S22025 56708122
NOTALL   EQU   * .                                               S22025 56709022
         XC    SCBXTRA(3),SCBXTRA .     CLEAR FOR RECALL         S22025 56709922
         XC    SCBNTXT(3),SCBNTXT .     CLEAR FOR RECALL         S22025 56710822
GOCORE   EQU   *                                                 S22025 56711722
         MVZ   SCBHBFNO,SCBQTYPE        SET QTYPE FLGS FOR FA   SA52971 56712122
         MVC   LCBCPA(4),SCBDEOB .      SAVE ACROSS RECALL       S22025 56712622
         MVC   LCBCPA+4(3),SCBTRANS .   SAVE SCB TRANS ACROSS RCLS22025 56713022
         MVI   LCBERBPY,PRIDKEOB .      RECALL PRIORITY          S22025 56713522
         MVI   LCBERBCT,1 .             RECALL BUFFER COUNT      S22025 56714422
         MVI   LCBERBCT+1,AVTEZERO .    CLEAR DISABLED COUNT     S22025 56715322
         OI    LCBSTAT1,LCBRCLLN .      SET RECALL BIT IN LCB    S22025 56716222
         LA    R0,ERBRETRN .            RETURN ADDR FOR ERB      S22025 56717122
         ST    R0,LCBRCQCB .            IN LCB                   S22025 56718022
         B     COMMON                   GO POST ERB              S22025 56718922
         SPACE 3                                                 S22025 56723422
         DS    0F .                     WORD BOUNDARY            S22025 56724322
ERBRETRN EQU   *-8 .                    QCB                      S22025 56725222
         DC    AL1(DSPMCPL4),AL3(*-1) . STCB THAT GETS CONTROL   S22025 56726122
*                                       WHEN ERB FOR RECALL IS   S22025 56727022
*                                       POSTED BACK TO R4 WHEN   S22025 56727922
*                                       READ IS DONE             S22025 56728822
         USING *,R15                                           @OY19438 56729211
         L     RBASE,BASE               LOAD BASE REGISTER     @OZ24185 56729700
         DROP  R15                                             @OY19438 56730711
         USING TAG,RBASE                                       @OY19438 56731711
         LA    RWORK,LCBERB-IEDQLCB .   ERB OFFSET INTO LCB      S22025 56733322
         SR    RTEMP,RWORK .            COMPUTE LCB ADDRESS      S22025 56734222
         LR    RLCB,RTEMP .             LCB ADDR                 S22025 56735122
         L     RLAST,LCBSCBA-1 .        SCB ADDRESS              S22025 56736022
         L     RTEMP,LCBERBCH-1 .       RECALLED BUFFER ADDRESS  S22025 56737822
         OI    PRFSTAT1-IEDQPRF(RTEMP),PRFCNCLN . SET CNCL FLG   S22025 56738722
         MVC   LCBISZE(1),PRFSCAN+1-IEDQPRF(RTEMP) . SET IDLES CTS22025 56739622
         MVC   LCBTTBIN,SCBDCHDR .      SETUP TNTOFFSET          S22025 56740522
         LA    RTEMP,AVTINOUT .         INMSG/OUTMSG DELIMITER   S22025 56741422
         STCM  RTEMP,AD,SCBMACR         RESET MACRO ADDRESS      Y01948 56742305
         MVC   SCBUNTCT(1),SCBDEOB .    SET UNIT COUT            S22025 56745022
         MVC   SCBDEOB(4),LCBCPA .      RESTORE DEOB OFTER RECALLS22025 56745922
         MVC   SCBTRANS(3),LCBCPA+4 .   RESTORE SCB TRANS        S22025 56746222
         NI    SCBHBFNO,CLEAR0F         RESET HBFNO              S22025 56746522
         LA    RTEMP,AVTACTIB .         ACTIVATE ROUTINE QCB ADDRS22025 56746822
         L     RQCB,SCBDESTQ-1 .        PICK UP QCB ADDR         S22025 56748622
         NI    SCBQTYPE,AVTEFF-SCBBFMM .RESET MIDDLE OF MSG BIT  S22025 56749522
         NI    QCBSTAT,AVTEFF-QCBSEND .RESET QCB SEND BIT        S22025 56750422
         NI    LCBSTAT1,AVTEFF-LCBRCLLN RESET RECALL BIT         S22025 56751322
         TM    LCBERBST,LCBEOMSG .      EOM IN RECALLED BUFFER   S22025 56752222
         BO    COMMON2                  GO POST ERB              S22025 56753122
         B     COMMON1                  GO POST ERB              S22025 56754022
BASE     DC    A(TAG)                   BASE ADDRESS CONSTANT  @OZ24185 56764000
.EQUATES ANOP                                                    X03039 56774008
         EJECT                                                          56800020
*                                 OTHER EQUATES                         57000020
         SPACE 1                                                        57100020
AUTOPOLL EQU   X'01'              INVITATION LIST IS CURRENTLY BEING    57200020
*                                      AUTOPOLLED                       57300020
CLOSEDWN EQU   X'01'                    LINE STOPPED BY        @SA71683 57303061
*                                        CLOSEDOWN             @SA71683 57306061
ZERO     EQU   0                                                 S99228 57310022
ONE      EQU   1                        CONSTANT OF ONE         SA60792 57320022
THREE    EQU   3                        CONSTANT OF THREE       SA60792 57330022
TWO      EQU   2                                                 S99228 57350022
AD       EQU   7                        MASK FOR STCM OF ADDRESS Y01948 57370005
CALLOPT  EQU   X'70'                    MASK STCB PRI DIAL UP           57400020
*                                         CLOCK OR INTVL                57500020
XB0      EQU   X'B0'                    MASK FOR 1ST TIME SWITCH X03039 57550008
SENDPRI  EQU   X'20'                    MASK FOR SEND PRIORITY          57600020
CONNECT  EQU   X'80'                    MASK FOR DIAL CONNECTION        57700020
CALLPRI  EQU   X'50'                    PRIORITY OF DIAL SEND WITH      57800020
*                                         CALL=NONE                     57900020
DELAY    EQU   X'02'                    MASK FOR LCB IN DELAY Q         58000020
STATUS   EQU   X'03'              OFFSET OF STATUS INFORMATION IN       58100020
*                                      INVITATION LIST                  58200020
*                                      FOR OUTPUT                       58300020
NOP      EQU   X'03'              NO-OP CHANNEL COMMAND CODE            58400020
TIC      EQU   X'08'              TIC CHANNEL COMMAND CODE              58500020
OPEN     EQU   X'10'              DCB FLAG INDICATING LINE GROUP OPEN   58600020
SENSE    EQU   X'FF'              VALUE SET IN SENSE BYTE OF COMMAND    58700020
*                                      FOLLOWING PREPARE ON CONTENTION  58800020
*                                      TERMINALS                        58900020
F0       EQU   X'F0'                    DIAL CONNECTION AND NO DIAL     59000020
X0F      EQU   X'0F'                    MASK USED FOR INITIAL BUFF      59100020
X12      EQU   X'12'                                               2741 59200020
POLL     EQU   X'09'                    POLL COMMAND                    59300020
LCBNSRCD EQU   X'01'                    FLAG FOR INITIATE MODE          59400020
ERPCTL   EQU   X'24'                    BITS IN LCBFLAG1-ERP IS IN      59500020
*                                         CONTROL                       59600020
LINEADD  EQU   4                        OFFSET IN UNCB-LINE ADDRESS     59700020
SENSMASK EQU   X'FF'                    VALUE OF SENSE FIELD IN         59800020
*                                         LCB BEFORE SENSE              59900020
AIBM1    EQU   X'1F'                                                TSO 59920020
T1050    EQU   X'51'                                                TSO 59940020
T2741B   EQU   X'56' .                                              TSO 59960020
T2741C   EQU   X'55' .                                              TSO 59980020
RECVPRI  EQU   X'80'                    LCB RECV PRI VALUE      SA58984 59990005
         AIF   ('&GEN' NE 'VTAM').NVTAM                          X03039 59990908
ONESECD  EQU   1                        ONE SECOND DELAY         X03039 59991808
FOUR     EQU   4                        IEDAYG ENTRY PNT INDEX @Z30X8IR 59992208
WORD2    EQU   4                        OFF TO 2ND WORD OF SAVE  X03039 59992708
HALF     EQU   32                                                X03039 59993608
LUINIT   EQU   X'50'                    TCMSESN=LUINIT (FOR LU)@XM10739 59994009
NOCALL   EQU   X'50'                    CALL=NONE SS PRIORITY    X03039 59994508
CINTVL   EQU   X'70'                    CHECK CINTVL SPECIFIED   X03039 59995408
CLOCK    EQU   X'80'                    CHECK CLOCK SPECIFIED    X03039 59996308
LXC      EQU   X'1B'                    VTAM LCCW RESET COND'L   X03039 59997208
*                                       OP CODE                  X03039 59998108
.NVTAM   ANOP                                                    X03039 59999008
HIOCC    EQU   X'48'                    IOHALT COMPLETION CODE   Y02027 60000006
         SPACE 1                                                        60100020
         AIF   ('&GEN' EQ 'MINI').L20                                   60200020
         AIF   ('&GEN' NE 'VTAM').DOCQAD                         X03039 60210008
HUND     DC    F'100'                   ONE HUNDRED              X03039 60220008
TWELVHR  DC    F'43200'                 NUMBER SECONDS IN 12 HRS X03039 60230008
TWNTY4HR DC    F'86400'                 NUMBER SECONDS IN 24 HRS X03039 60240008
         AGO   .VCLEAR                                           X03039 60250008
.DOCQAD  ANOP                                                    X03039 60260008
DOCQAD   DC    AL2(LCBFLAG1-IEDQLCB+12) CONSTANT TO OBTAIN CALL Q       60300020
.L20     ANOP                                                           60400020
LCBSIZE  DC    AL2(LCBFLAG1-IEDQLCB)    SIZE OF LCB FROM RCB TO IOB     60500020
.VCLEAR  ANOP                                                    X03039 60700008
CLEAR    DS    0F                                                       60900020
         DC    X'00FFFFFC'                                              61000020
         AIF   ('&GEN' EQ 'VTAM').VDSECTS                        X03039 61050008
CLRLOW   DS    0F                                              @OS77835 61080091
         DC    X'00FFF000'              CLEAR FOR ADDRESS TRANS@OS77835 61110091
CLRHI    DC    X'00000FFF'              CLEAR FOR ADDR TRANS   @OS77835 61140091
DISDLEOT EQU   X'01'                    FLAG TO WRITE DLE EOT           61200020
OUTPUT   EQU   X'01'                    DEB MASK OPEN OUTPUT            61300020
OUTONLY  EQU   X'03'                    OUTPUT ONLY DEVICE FLAG@OX13500 61310091
         AGO   .DSECTS                                           X03039 61320008
.VDSECTS ANOP                                                    X03039 61340008
         EJECT                                                          61360008
         IFGACB                                                  X03039 61380008
         EJECT                                                          61400008
         TLGBD                                                   X03039 61420008
         EJECT                                                          61440008
.DSECTS  ANOP                                                    X03039 61460008
         TPRIOR                                                         61500020
         TAVTD                                                          61600020
         TPRFD                                                          61700020
         DCBD  DSORG=TX                                                 61800020
         TDISPD                                                         61900020
         TLCBD                                                          62000020
         TQCBD                                                          62100020
         TSCBD                                                          62200020
         TSTCBD                                                         62300020
         TTRMD                                                          62400020
         TTSID                                                      TSO 62500020
         TCCWD                                                          62600020
         TDEBD                                                          62700020
         MEND                                                           62750011
