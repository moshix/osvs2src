AMAPTFLE CSECT                                                          00030002
         TITLE 'AMAPTFLE - PTF APPLICATION PROGRAM'                     00060002
*C 613500                                                       YA01764 00060202
*A 682900-683352                                                SA55374 00060402
*A 611420-611680,614500-614696,637600-637740                    SA55373 00060802
*C 611700,612600,637800                                         SA55373 00061202
*D 336984-337165                                                 YM1475 00062002
*A 194400                                                        Y01006 00066002
*A 369400-369500,377980-377988,599899-600499                     YM1466 00068002
*C 360600,369900,599799                                          YM1466 00070002
*D 599699                                                        YM1466 00072002
*D 490197                                                        YM1467 00074002
*A 367222-367281,367535-367563,490193                            YM1467 00076002
*C 490199                                                        YM1467 00078002
*A 693920-694140                                                 YM1469 00080002
*A 210100,780100                                                 A48079 00082002
*A 377800-377960,372400-372500,734096,772572,772668              Y01045 00084002
*A 336904-337426                                                 Y01045 00086002
*A 359500,380200,399700,764800,355000                            Y01036 00088002
*A 288700-288880,315700-315900,734092                            Y01036 00090002
*D 728100,594000-604200,773100,653100-653400                     Y01983 00092002
*D 363600-366600,465600-489900                                   Y01036 00094002
*C 728400-729300                                                 Y01983 00096002
*C 653700,654840                                                 Y01036 00098002
*A 654700-654860,597700-599799                                   A40797 00100002
*A 336700-336884,442300,772496-772497,775000,734084              Y01045 00102002
*C 336900                                                        Y01045 00104002
*A 733900-734020,772400-772492,360200,360700-367333,689800       Y01036 00106002
*A 465800-484300,485800-491063                                   Y01036 00108002
*A 734060-734080,360100,360400-360500,607900-608000              A40797 00110002
*A 642700-642880,758500-758600,754300,484800-485300              A40797 00112002
*A 771400,301300-301400,374800-374900                            Y01048 00114002
*C 360000,644700                                                 A40797 00116002
*A 318600-319500,3363000-3375000,3921000-393000,783000-783300    X01983 00118002
*********************************************************************** 00120002
*********************************************************************** 00150002
* TITLE        AMAPTFLE                                               * 00180002
****                                                               **** 00210002
* STATUS       OS/VS2 RELEASE 02.0                                    * 00240002
****                                                               **** 00270002
* FUNCTION     GENERATE-                                              * 00300002
*              PRODUCES AN INPUT STREAM WHICH WHEN EXECUTED WILL APPLY* 00330002
*              PTFS TO A SYSTEM.IT PRODUCES THIS INPUT STREAM BY      * 00360002
*              ANALYZING THE STAGE 1 OUTPUT TAPE FROM SYSGEN          * 00390002
*              APPLICATION-                                           * 00420002
*              ASSISTS AMAPTF01 IN BUILDING A SYSLIN DATA SET         * 00450002
*              AND INVOKES THE REQUIRED FUNCIONS OF AMAPTF01          * 00480002
*              TO DIRECTLY APPLY PTFS TO THE SYSTEM                   * 00510002
****                                                               **** 00540002
** ENTRY POINT  TLKEDT                                                * 00570002
****                                                               **** 00600002
* INPUT     STAGE OUTPUT TAPE FROM SYSGEN                             * 00630002
*              GENERATE FUNCTION-                                     * 00660002
*              COMPONENT LIBRARY MODULE NAMES FOR WHCIH JCL IS TO BE  * 00690002
*              PRODUCED.                                              * 00720002
*              APPLICATION FUNCTION-                                  * 00750002
*              COMPONENT LIBRARY MODULE NAMES FOLLOWED BY THE OBJ     * 00780002
*              FOR THE PRECEDING NAMED CONTROL STATEMENT.             * 00810002
****                                                               **** 00840002
* OUTPUT       NORMAL- A JOBSTREAM WHEN USING THE GENERATE FUNCTION   * 00870002
*                      A SYSLIN INPUT DATA SET WHEN USING THE         * 00900002
*                      APPLICATION FUNCTION.                          * 00930002
*              ERROR- IF THE NUMBER OF INPUT MODULE NAMES EXCEEDS 150 * 00960002
*                     A MESSAGE IS PUT OUT INFORMING THE USER OF THE  * 00990002
*                     ERROR AND CONTROL IS RETURNED TO THE SYSTEM VIA * 01020002
*                     REGISTER  FOURTEEN WITHOUT PROCESSING ANY INPUT * 01050002
****                                                               **** 01080002
* EXTERNAL ROUTINES      AMAPTF01                                     * 01110002
****                                                               **** 01140002
* EXITS         NORMAL - TO SYSTEM VIA REGISTER FOURTEEN              * 01170002
*                                                                     * 01200002
****                                                               **** 01230002
* TABLES/WORKAREAS                                                    * 01260002
*                                                                     * 01290002
*                  MODTBL-DEFINES INPUT MODULE NAME AREA              * 01320002
*                                                                     * 01350002
*                  PCHAREA-INPUT CARD BUFFER  FOR STAGE 1 OUTPUT TAPE * 01380002
*                                                                     * 01410002
*                  OUTAREA1-LINKEDIT OUTPUT AREA                      * 01440002
*                                                                     * 01470002
*                  OUTAREA2-LINKEDIT OUTPUT AREA                      * 01500002
*                                                                     * 01530002
*                  P2OUT-MOVE/COPY OUTPUT AREA                        * 01560002
*                  BRPRMLST-PARAMETER LSIT FOR AMAPTF01               * 01590002
* ATTRIBUTES   NON-REUSEABLE                                          * 01620002
****                                                               **** 01650002
* NOTES        INPUT MODULE NAMES MUST NOT EXCEED 150 NAMES           * 01680002
****                                                               **** 01710002
*********************************************************************** 01740002
*********************************************************************** 01770002
*/*AMAPTFLE: CHART  AMAPTFLE AOS/1 RELEASE 1 */                         01800002
*/* E AMAPTFLE */                                                       01830002
*/* P SAVE POINTER TO PARAMETER LIST */                                 01860002
*/* L OPEN MODF,PCHF, OUTF,PRINT DDS */                                 01890002
*/* D (YES,%MODF:R,NO,) OPEN FOR PRINT DD SUCCESSFUL */                 01920002
*/*%AMA002: I WRITE MESSAGE AMA002I */                                  01950002
*/*RET16: P SET RETURN CODE TO 16 */                                    01980002
*/*FILCLOSE: L CLOSE MODF,PCHF, OUTF,PRINT DDS */                       02010002
*/* D (NO,,YES,%RETURN) MODULE TABLE EMPTY SWITCH SET */                02040002
*/* D (NO,,YES,%AMACLOS) APPLICATION FUNCTION REQUESTED */              02070002
*/*%RETURN: P INSERT HIGHEST RETURN CODE */                             02100002
*/* R RETURN */                                                         02130002
*/*%MODF: D (NO,%AMA002:RR,YES,%PCHF) OPEN FOR MODF DD SUCCESSFUL */    02160002
*/*%PCHF: D (NO,%AMA002:RR,YES,%OUTF) OPEN FOR OUTF DD SUCCESSFUL */    02190002
*/*%OUTF: D (NO,%AMA002:RR,YES,%PARM) OPEN FOR OUTF DD SUCCESSFUL */    02220002
*/*%PARM: D (NO,,YES,LODBLOK) PARAMETER LENGTH = 0 */                   02250002
*/* P INDICATE APPLICATION FUNCTION REQUESTED */                        02280002
*/* P LOAD MODULES AMAPTF01 AND AMAPTF02 AND SAVE ENTRY POINTS */       02310002
*/* P SET AMAPTF01 ROUTINE INDICATOR TO 1 (SPOOL DATA) */               02340002
*/*LODBLOK: D (NO,,YES,%AMA009) BLOCKSIZE FOR PCHF DD = 0 */            02370002
*/* L GET STORAGE FOR PCHF INPUT BUFFER */                              02400002
*/* P COMPUTE NUMBER OF LOGICAL RECORDS PER BLOCK */                    02430002
*/* D (NO,,YES,GETBUFS) APPLICATION FUNCTION REQUESTED */               02460002
*/* S AMAWRITE:WRITE JOB CARD TO OUTF */                                02490002
*/*GETBUFS: L GET STORAGE FOR TABLES */                                 02520002
*/* P COMPUTE AND SAVE ADDRESS FOR IDENTIFY TABLE */                    02550002
*/* P INITIALIZE IDENTIFY INDEX */                                      02580002
*/* P COMPUTE AND SAVE ADDRESS FOR MODULE NAME TABLE */                 02610002
*/* P SET MODULE TABLE EMPTY SWITCH */                                  02640002
*/* P COMPUTE AND SAVE ADDRESS FOR SSI TABLE */                         02670002
*/* P COMPUTE AND SAVE END OF MODULE NAME TABLE */                      02700002
*/* P SAVE ADDRESS OF OVERLAY TABLE */                                  02730002
*/*READMOD: I READ A RECORD FROM MODF */                                02760002
*/* D (NO,,YES,ENDMOD:R) END OF MODF FILE */                            02790002
*/*MOVEMOD1: D (NO,,YES,%IDENT) COLUMN 1 BLANK */                       02820002
*/*MOVEMOD2: D (YES,,NO,%FRSTNAM) PART OF OBJECT DECK */                02850002
*/* D (YES,,NO,%AMA008:R) FIRST CARD SWITCH SET */                      02880002
*/* D (NO,%AMA008:R,YES,) APPLICATION FUNCTION REQUESTED */             02910002
*/*%FRSTNAM: P SET NEW CARD AND FIRST CARD SWITCHES */                  02940002
*/* D (NO,,YES,%AMA008) IDENT CONTIN SW SET */                          02970002
*/*SPOOLCD: D (YES,,NO,NMEMOV:R) APPLICATION FUNCTION REQUESTED */      03000002
*/* L AMAPTF01 SPOOL CARD TO WORK FILE */                               03030002
*/* D (NO,,YES,READMOD) CARD PART OF OBJECT DECK */                     03060002
*/* D (NO,NMEMOV:R,YES,READMOD) COLUMN 1 BLANK (IDENTIFY CARD) */       03090002
*/*NMEMOV: P MOVE NAME INTO MODULE NAME TABLE */                        03120002
*/* P SET IDENTIFY INDEX IN TABLE TO 0 */                               03150002
*/* P MOVE SSI INFORMATION INTO SSI TABLE */                            03180002
*/* P INCREMENT MODULE NAME AND SSI TABLE POINTERS */                   03210002
*/* D (YES,,NO,READMOD:R) MODULE NAME TABLE OVERFLOW */                 03240002
*/*MESSAGE: P SET MODULE TABLE OVERFLOW SWITCH */                       03270002
*/*%FLUSH: I READ RECORD FROM MODF TO FLUSH INPUT STREAM */             03300002
*/* D (NO,%FLUSH,YES,ENDMOD) END OF MODF FILE */                        03330002
*/*%AMA008: I WRITE CARD IMAGE */                                       03360002
*/* I (,RET16) WRITE MESSAGE AMA008I */                                 03390002
*/*%AMA009: I (,RET16) WRITE MESSAGE AMA009I */                         03420002
*/*%AMACLOS: P SET AMAPTF01 ROUTINE INDICATOR TO 4 */                   03450002
*/* L (,%RETURN) AMAPTF01  CLOSE WORK FILE */                           03480002
*/*%IDENT: D (NO,,YES,MOVECON) IDENT CONTIN SW SET */                   03510002
*/* D (NO,,YES,SPOOLCD) CONTINUATION (PTF01) */                         03540002
*/* S CHKSPACE:POINT TO NEXT OPERAND */                                 03570002
*/* D (YES,,NO,%AMA008) IDENTIFY CARD */                                03600002
*/* D (NO,,YES,%AMA008) FIRST CARD SWITCH SET */                        03630002
*/* D (NO,,YES,MOVEMOD2) APPLICATION FUNCTION REQUESTED */              03660002
*/* D (YES,,NO,MOVECON:R) NEW NAME CARD SWITCH SET */                   03690002
*/* P STORE IDENTIFY INDEX AFTER MODULE NAME IN TABLE */                03720002
*/* P TURN OFF NEW NAME CARD SWITCH */                                  03750002
*/* P (,MOVECON:R) INDICATE NEW SET OF IDENTIFY CARDS */                03780002
*/*MOVECON: P INCREMENT IDENTIFY INDEX */                               03810002
*/* D (NO,,YES,%AMA011) IDENTIFY TABLE OVERFLOW */                      03840002
*/* P TURN OFF IDENTIFY CONTINUATION SWITCH */                          03870002
*/* P MOVE IDENTIFY CARD INTO IDENTIFY TABLE */                         03900002
*/* P INCREMENT TABLE POINTER */                                        03930002
*/* D (NO,,YES,READMOD) COLUMN 72 BLANK */                              03960002
*/* P (,READMOD) TURN ON IDENTIFY CONTINUATION SWITCH */                03990002
*/*%AMA011: I (,RET16) WRITE MESSAGE AMA011I */                         04020002
*/*ENDMOD: D (NO,,YES,FILCLOSE) MODULE TABLE EMPTY SWITCH SET */        04050002
*/* D (NO,,YES,%AMA001) MODULE TABLE OVERFLOW SWITCH SET */             04080002
*/* P BLANK 'INCLUDE' AND 'INCLUDE SYSLMOD' BUFFERS */                  04110002
*/* P INDICATE END OF MODULE NAME TABLE */                              04140002
*/*READPCH1: P SET NON-JCL ADDRESS TO READ NEXT CARD */                 04170002
*/* S PGMRTN: DETERMINE THE PROGRAM INVOKED ON STAGE I TAPE */          04200002
*/*EXECRTN: P TURN OFF JCL COPIED AND CHANGE/REPLACE SWITCHES */        04230002
*/* P SET ENTRY/ALIAS SWITCH */                                         04260002
*/* P TURN OFF OVERLAY SWITCH */                                        04290002
*/* S NOTERTN:NOTE TAPE POSITION OF LAST BLOCK READ */                  04320002
*/*READPCH2: P SET NON-JCL ADDRESS TO TESTCON*/                         04350002
*/* S (,TESTCON:R) PGMRTN: DETERMINE THE PROGRAM INVOKED ON STAGE I     04380002
*/*TAPE */                                                              04410002
*/*TESTCON: D (NO,,YES,%OVLY) COLUMN 1 BLANK */                         04440002
*/* D (YES,ENDCDRTN,NO,READPCH2:R) END OF STEP CARD */                  04470002
*/*%OVLY: D (NO,%A1,YES,) OVERLAY CONTINUATION SWITCH SET */            04500002
*/* P (,OVLYRTN1) TURN OFF OVERLAY CONTINUATION SWITCH */               04530002
*/*%A1: S CHKSPACE: POINT TO NEXT OPERAND */                            04560002
*/* D (YES,%NMECHK,NO,) OVERLAY NOGO SWITCH SET */                      04590002
*/* D (NO,,YES,OVLYRTN) OVERLAY CARD */                                 04620002
*/* D (YES,,NO,NOOVLY) OVERLAY SWITCH SET */                            04650002
*/* D (NO,,YES,OVLYRTN1) INSERT CARD */                                 04680002
*/*NOOVLY: D (NO,,YES,INCLDRTN) INCLUDE CARD */                         04710002
*/*%NMECHK: D (NO,,YES,NAMERTN) NAME CARD */                            04740002
*/* D (NO,,YES,READPCH2) OVERLAY NOGO SWITCH SET */                     04770002
*/* D (NO,,YES,CHGRPRTN) CHANGE CARD */                                 04800002
*/* D (NO,,YES,CHGRPRTN) REPLACE CARD */                                04830002
*/* D (NO,READPCH2,YES,) JCL COPIED SWITCH SET */                       04860002
*/* D (NO,,YES,ENTRYRTN) ALIAS CARD */                                  04890002
*/* D (NO,,YES,ENTRYRTN) PAGE CARD */                                   04920002
*/* D (NO,,YES,ENTRYRTN) ORDER CARD */                                  04950002
*/* D (NO,,YES,ENTRYRTN) SETCODE CARD */                                04960002
*/* D (NO,READPCH2,YES,ENTRYRTN) ENTRY CARD */                          04980002
*/*INCLDRTN: S CHKSPACE: POINT TO NEXT OPERAND */                       05010002
*/*BLLIBETC: P BLANK 'INCLUDE' BUFFER */                                05040002
*/*STORELIB: P MOVE NEXT CHARACTER FROM CARD TO 'INCLUDE' BUFFER */     05070002
*/* D (NO,,YES,REGPOS:R) CHARACTER = '(' */                             05100002
*/* P (,STORELIB) INCREMENT CARD AND BUFFER POINTERS */                 05130002
*/*REGPOS: P INCREMENT CARD AND BUFFER POINTERS */                      05160002
*/*CHECKMOD: P BLANK MODULE NAME BUFFER */                              05190002
*/*STOREMOD: P MOVE 1 CHARACTER FROM CARD TO MODULE NAME BUFFER */      05220002
*/* P INCREMENT MODULE NAME BUFFER AND CARD POINTERS */                 05250002
*/* D (NO,,YES,COMPMOD1) NEXT CHARACTER = ')' */                        05280002
*/* D (NO,STOREMOD,YES,COMPMOD1) NEXT CHARACTER = ',' */                05310002
*/*COMPMOD1: D (YES,,NO,COMPMOD5) DDNAME FOR DSS (PARMLIB) */           05320002
*/* D (YES,,NO,COMPMOD5) DSS PARMLIB MEMBER IQAORDER */                 05330002
*/* P SET DSS SWITCH */                                                 05332002
*/*COMPMOD5: D (YES,,NO,COMPMOD) OVERLAY SWITCH SET */                  05340002
*/* P OBTAIN CURRENT OVERLAY TABLE ADDRESS */                           05370002
*/* D (NO,,YES,%AMA012) OVERLAY TABLE OVERFLOW */                       05400002
*/* P BLANK NEXT RECORD IN OVERLAY TABLE */                             05430002
*/* P MOVE 'INSERT' INTO TABLE */                                       05460002
*/* P MOVE MODULE NAME FROM MODULE NAME BUFFER TO OVERLAY TABLE */      05490002
*/* P INCREMENT CURRENT OVERLAY TABLE ADDRESS */                        05520002
*/*COMPMOD: D (NO,,YES,MODFOUND) MODULE NAME BUFFER = MODULE NAME TABLE 05550002
*/* */                                                                  05580002
*/* P INCREMENT MODULE NAME TABLE POINTER TO NEXT NAME */               05610002
*/* D (NO,COMPMOD,YES,MODNOTBL) END OF MODULE NAME TABLE FOUND*/        05640002
*/*%AMA012: P TURN OFF OVERLAY SWITCH */                                05670002
*/* P (,READPCH2) SET OVERLAY NOGO SWITCH */                            05700002
*/*MODNOTBL: P SET CHANGE/REPLACE SWITCH */                             05730002
*/* D (YES,,NO,%NEXT) NEXT CHARACTER ON CARD = ',' */                   05760002
*/* P (,CHECKMOD:RB) INCREMENT CARD POINTER PASSED ',' */               05790002
*/*%NEXT: D (YES,,NO,READPCH2) NEXT 2 CHARACTERS ON CARD = '),' */      05820002
*/* P (,BLLIBETC) INCREMENT POINTER PASSED '),' */                      05850002
*/*MODFOUND: P SAVE ADDRESS OF NAME IN MODULE NAME TABLE AFTER MATCH */ 05880002
*/* D (NO,COPYJCL,YES,) JCL COPIED SWITCH SET */                        05910002
*/* D (YES,,NO,RBTILLNM) ENTRY/ALIAS SWITCH SET */                      05940002
*/*CHEKCHRP: D (NO,CRTEINCL,YES,COPYCHRP) CHANGE/ REPLACE SWITCH SET */ 05970002
*/*COPYJCL: P SAVE MATCHED INCLUDE CARD */                              06000002
*/*RBJCL: S POINTRTN: POINT TO BEGINNING OF THIS SET OF JCL */          06030002
*/*JCLCOPY5: S READPCH: READ RECORD FROM STAGE 1 TAPE */                06060002
*/* D (YES,,NO,CHKPARMS) COPY ASSEMBLY JCL SWITCH SET */                06070002
*/*JCLCOPY: S COPYRTN: WRITE CARD AMAGE */                              06090002
*/* D (YES,JCLCOPY4,NO,) COPY ASSEMBLY JCL SWITCH SET */                06100002
*/* S READPCH: READ NEXT RECORD FROM STAGE 1 TAPE */                    06120002
*/* D (NO,CHKBLANK,YES,) EXEC CONTINUATION SWITCH SET */                06170002
*/* P TURN OFF CONTINUATION SWITCH */                                   06180002
*/* S (,PARMCHK) CHKSPACE: POINT TO NEXT KEYWORD */                     06190002
*/*JCLCOPY4: D (NO,JCLCOPY5,YES,PGMRTN1) /* CARD */                     06200002
*/*CHKBLANK: D (YES,,NO,JCLCOPY) FIRST CHARACTER IN INPUT AREA BLANK */ 06210002
*/* P SET JCL COPIED SWITCH */                                          06240002
*/* D (YES,,NO,RFTILLNM) ENTRY/ALIAS SWITCH SET */                      06270002
*/* D (NO,,YES,CHEKCHRP) REACHED MATCHED INCLUDE CARD */                06300002
*/*ALENRTRN: S CHKSPACE: POINT TO NEXT OPERAND */                       06330002
*/* D (NO,,YES,%COPRF) ALIAS CARD */                                    06360002
*/* D (NO,,YES,%COPRF) ENTRY CARD */                                    06390002
*/* D (NO,,YES,%COPRF) PAGE CARD */                                     06420002
*/* D (NO,,YES,%COPRF) ORDER CARD */                                    06450002
*/* D (NO,,YES,%COPRF) SETCODE CARD */                                  06460002
*/* D (NO,,YES,RFCOPY) OVERLAY SWITCH SET */                            06480002
*/* D (YES,,NO,RFCOPY) INSERT STATEMENT */                              06510002
*/*%COPRF: S COPYRTN: COPY CARD */                                      06540002
*/*RFCOPY: S READPCH: READ NEXT RECORD FROM STAGE 1 TAPE */             06570002
*/* D (YES,CHEKCHRP,NO,ALENRTRN) REACHED MATCHED INCLUDE CARD */        06600002
*/*RBTILLNM: P SAVE MATCHED INCLUDE CARD */                             06690002
*/* S (,RFCOPY) POINTRTN: POINT TO SAVED NAME CARD */                   06720002
*/*RFTILLNM: S READPCH: READ NEXT RECORD FROM STAGE 1 TAPE */           06750002
*/* D (NO,RFTILLNM,YES,RFCOPY) REACHED SAVED NAME CARD */               06780002
*/*CRTEINCL: P INCREMENT TABLE POINTER BY 8 */                          06810002
*/* P INDICATE MATCH IN MODULE NAME TABLE */                            06840002
*/* P OBTAIN IDENTIFY INDEX FROM MODULE NAME TABLE FOR MATCHED NAME */  06870002
*/* D (NO,,YES,%MON) IDENTIFY INDEX = 0 */                              06900002
*/* P INDICATE MATCH FOR CORRESPONDING SET OF IDENTIFY CARDS */         06930002
*/*%MON: P MOVE MODULE NAME INTO OUTPUT INCLUDE BUFFER */               06960002
*/*INCCOMP: D (NO,,YES,CLOSEINC) CHARACTER MOVED BLANK */               06990002
*/* P (,INCCOMP) INCREMENT POINTER TO MODULE NAME IN OUTPUT AREA TO     07020002
*/*NEXT CHARACTER */                                                    07050002
*/*CLOSEINC: P MOVE RIGHT PARENTHESIS TO OUTPUT AREA */                 07080002
*/* D (YES,,NO,WRTINCL) APPLICATION FUNCTION REQUESTED */               07110002
*/* P SET AMAPTF01 ROUTINE INDICATOR TO 2 */                            07140002
*/* L AMAPTF01 SPOOL OBJECT MODULE TO OUTF */                           07170002
*/*WRTINCL: S AMAWRITE: WRITE INCLUDE CARD */                           07200002
*/*COMWBLNK: P REPLACE ) WITH BLANK IN BUFFER */                        07230002
*/* P (,MODNOTBL) SET ENTRY/ALIAS SWITCH */                             07260002
*/*OVLYRTN: D (YES,,NO,OVLYRTN1) FIRST OVERLAY CARD */                  07290002
*/* P PICK UP ADDRESS OF BEGINNING OF OVERLAY TABLE */                  07320002
*/*OVLYRTN1: D (YES,,NO,OVLYRTN2) CARD TO BE CONTINUED */               07350002
*/* P SET OVERLAY CONTINUATION SWITCH */                                07380002
*/*OVLYRTN2: D (NO,,YES,%AMA012) OVERLAY TABLE OVERFLOW */              07410002
*/* P MOVE OVERLAY/ INSERT STATEMENT TO OVERLAY TABLE */                07440002
*/* P INCREMENT CURRENT TABLE POSITION */                               07470002
*/* P (,READPCH2) SET OVERLAY SWITCH */                                 07500002
*/*CHGRPRTN: D (NO,,YES,SETUP) CHANGE/ REPLACE SWITCH SET */            07530002
*/*CHGRPGO: P MOVE STATEMENT TO CHANGE/ REPLACE BUFFER */               07560002
*/* P (,READPCH2) INCREMENT POINTER TO BUFFER */                        07590002
*/*SETUP: P TURN OFF CHANGE/ REPLACE SWITCH */                          07620002
*/* P (,CHGRPGO) GET ADDRESS OF CHANGE/ REPLACE BUFFER */               07650002
*/*ENTRYRTN: D (YES,,NO,READPCH2) ENTRY/ ALIAS SWITCH SET */            07680002
*/* S (,READPCH2) COPYRTN: COPY STATEMENT TO OUTPUT */                  07710002
*/*NAMERTN: D (NO,,YES,CRTSYSLM) OVERLAY NOGO SWITCH SET */             07740002
*/* D (NO,STORENAM:R,YES,) JCL COPIED SWITCH SET */                     07770002
*/* S NOTERTN: NOTE TAPE POSITION OF LAST BLOCK READ */                 07800002
*/* D (YES,,NO,STORENAM) ENTRY/ ALIAS SWITCH SET */                     07830002
*/*CRTSYSLM: P INCREMENT CARD POINTER PAST NAME KEYWORD */              07860002
*/* S CHKSPACE: POINT TO NEXT OPERAND */                                07890002
*/*NAMELOOP: P MOVE 1 CHARACTER OF NAME TO INCLUDE SYSLMOD BUFFER */    07920002
*/* P INCREMENT CARD AND BUFFER POINTERS */                             07950002
*/* D (NO,,YES,NMELOOP1:R) NEXT CHARACTER  ( */                         07980002
*/* D (YES,,NO,NAMELOOP) NEXT CHARACTER A BLANK */                      08010002
*/*NMELOOP1: D (NO,,YES,%AMA12W) OVERLAY NOGO SWITCH SET */             08040002
*/* P MOVE ) TO BUFFER */                                               08070002
*/* D (NO,,YES,IDENEXIT) APPLICATION FUNCTION REQUESTED */              08100002
*/* P BLANK OUTPUT BUFFER */                                            08130002
*/*LOOP: D (YES,IDENEXIT,NO,) END OF IDENTIFY TABLE REACHED */          08160002
*/* D (NO,,YES,IDFOUND) MATCH INDICATED FOR THIS SET */                 08190002
*/* P (,LOOP) INCREMENT POINTER TO NEXT ENTRY IN IDENTIFY TABLE */      08220002
*/*%AMA12W: P MOVE LOAD MODULE NAME TO MESSAGE AMA012I */               08250002
*/* I (,RET16) WRITE MESSAGE AMA012I */                                 08280002
*/*IDFOUND: P TURN OFF MATCH INDICATOR */                               08310002
*/* P MOVE IDENTIFY CARD TO OUTPUT BUFFER */                            08340002
*/* S AMAWRITE: WRITE IDENTIFY CARD */                                  08370002
*/* P INCREMENT POINTER TO NEXT ENTRY IN IDENTIFY TABLE */              08400002
*/* D (YES,LOOP,NO,IDFOUND) NEW SET OF IDENTIFY CARDS */                08430002
*/*IDENEXIT: S AMAWRITE: WRITE INCLUDE SYSLMOD CARD */                  08460002
*/* P BLANK INCLUDE SYSLMOD BUFFER */                                   08490002
*/* D (YES,,NO,COPYNAME) OVERLAY SWITCH SET */                          08520002
*/*OVLYLOOP: I WRITE CARD FROM OVERLAY TABLE */                         08550002
*/* P POINT TO NEXT RECORD IN OVERLAY TABLE */                          08580002
*/* D (NO,OVLYLOOP,YES,) END OF OVERLAY TABLE */                        08610002
*/* P TURN OFF OVERLAY SWITCH */                                        08640002
*/*COPYNAME: P TURN ON NAME SWITCH */                                   08670002
*/* S CHKSPACE: POINT TO NEXT OPERAND */                                08700002
*/* P SKIP PASSED NAME KEYWORD */                                       08730002
*/* S CHKSPACE: POINT TO NEXT OPERAND */                                08760002
*/* P BLANK MODULE NAME BUFFER */                                       08790002
*/*COPYLOOP: D (NO,,YES,CPYNAME1:R) CHARACTER = ( */                    08820002
*/* D (NO,,YES,NEEDTHER) CHARACTER A BLANK */                           08850002
*/* P MOVE CHARACTER TO MODULE NAME BUFFER */                           08880002
*/* P (,COPYLOOP) INCREMENT CARD POINTER TO NEXT CHARACTER */           08910002
*/*NEEDTHER: P MOVE (R) TO NAME CARD */                                 08940002
*/*CPYNAME1: P OBTAIN SSI INFORMATION FROM SSI TABLE FOR MATCHED MODULE 08970002
*/* NAME */                                                             09000002
*/* P MOVE SSI INFORMATION TO OUTPUT BUFFER */                          09030002
*/* D (YES,,NO,%WRSSI) SSI INFORMATION BLANK */                         09060002
*/* P SET SSI TO 0 */                                                   09090002
*/*%WRSSI: S AMAWRITE: WRITE SETSSI CARD */                             09120002
*/* S COPYRTN: COPY CARD */                                             09150002
*/* D (YES,,NO,SLSHCHK:R) APPLICATION FUNCTION REQUESTED */             09180002
*/* P SET AMAPTF01 ROUTINE INDICATOR TO 3 */                            09210002
*/* L AMAPTF01 INVOKE LINKAGE EDITOR */                                 09240002
*/*SLSHCHK: D (NO,STORENAM,YES,ENDCRTN1) SLASH SWITCH SET */            09270002
*/*STORENAM: P STORE NAME CARD */                                       09300002
*/* P TURN OFF OVERLAY SWITCH */                                        09330002
*/* P TURN OFF DSS SWITCH */                                            09340002
*/* P TURN OFF ENTRY/ALIAS SWITCH */                                    09360002
*/*ENDCDRTN: D (NO,,YES,COPYNAM1) NAME SWITCH SET */                    09390002
*/* D (NO,,YES,COPYNAM1) SYSLNAME BUFFER BLANK */                       09420002
*/* P SAVE END OF STEP CARD */                                          09450002
*/* P BLANK PCHF INPUT BUFFER */                                        09480002
*/* P MOVE NAME KEYWORD AND NAME FROM SYSLNAME TO PCHF BUFFER */        09510002
*/* P (,CRTSYSLM) SET SLASH SWITCH */                                   09540002
*/*ENDCRTN1: P TURN OFF SLASH SWITCH */                                 09570002
*/* P RESTORE END OF STEP CARD */                                       09600002
*/*COPYNAM1: P BLANK SYSLNAME BUFFER */                                 09630002
*/* P TURN OFF NAME SWITCH */                                           09660002
*/* D (NO,READPCH1,YES,) JCL COPIED SWITCH SET */                       09690002
*/* S (,READPCH1) COPYRTN: COPY CARD */                                 09720002
*/* E CHECK PARAMETER ROUTINE */                                        09770002
*/*CHKPARMS: P LOAD ADDRESS OF PCHAREA */                               09820002
*/* S CHKSPACE: POINT TO 'EXEC' */                                      09870002
*/* S CHKSPACE: POINT TO PROC NAME */                                   09920002
*/* D (YES,,NO,%A2) LINK EDIT STEP ('LINKS') */                         09970002
*/* P (,PARMCHK) INCREMENT PAST 'LINKS,' */                             10020002
*/*%A2: P INCREMENT PAST 'ASMS,' */                                     10070002
*/*PARMCHK: D (YES,MODKEY,NO,) MOD= KEYWORD */                          10120002
*/* D (YES,NKEY,NO,) N= KEYWORD */                                      10170002
*/* D (YES,PKEY,NO,) P1= KEYWORD */                                     10220002
*/* D (YES,PKEY,NO,) P2= KEYWORD */                                     10270002
*/* %I1: P INCREMENT 1 CHAR */                                          10320002
*/*COMMACHK: D (YES,%ICOMMA,NO,) IS THIS A COMMA */                     10370002
*/* D (NO,%I1,YES,CHKBLANK) IS THIS A BLANK */                          10420002
*/*%ICOMMA: P INCREMENT PAST COMMA */                                   10430002
*/* D (YES,,NO,PARMCHK) IS THIS A BLANK */                              10470002
*/*%CONT1: P (,CHKBLANK) TURN ON EXEC CONTINUATION SWITCH */            10520002
*/*MODKEY: P INCREMENT PAST 'MOD=' */                                   10580002
*/* P SAVE POINTER TO DATA SET NAME */                                  10630002
*/* P ZERO COUNTER */                                                   10680002
*/* P OBTAIN ADDR OF NAME BUFFER */                                     10730002
*/*%COMMA1: D (NO,,YES,%BLANK4) IS THIS A COMMA */                      10780002
*/* D (NO,,YES,%BLANK1) IS THIS A BLANK */                              10830002
*/* P MOVE 1 CHAR TO NAME BUFFER */                                     10882002
*/* P INCREMENT TO NEXT CHARACTER */                                    10882402
*/* P INCREMENT PTR TO NAME BUFFER */                                   10884002
*/* P (,%COMMA1) INCREMENT COUNTER TO REFLECT # OF CHAR READ */         10886002
*/*%BLANK4: D (YES,COMMACHK,NO,%ASMCHK) IS COUNTER ZERO */              10886402
*/*%BLANK1: D (YES,CHKBLANK,NO,) COUNTER EQUAL ZERO */                  10888002
*/*%ASMCHK: D (YES,ASMCHK1,NO,) IN ASSEMBLY STEP */                     10888402
*/* P MOVE '(R)' TO NAME BUFFER */                                      10888802
*/* D (YES,COMMACHK,NO,) APPLICATION FUNCTION */                        10889202
*/*MODCARD: P SAVE CURRENT CARD ADDRESS */                              10889602
*/* P SUBTRACT # OF CHAR MOVED */                                       10889702
*/*%BLANK2: D (YES,COMMACHK,NO,) PRESENT LOCATION BLANK */              10889802
*/* P MOVE NEXT CHARACTER IN PLACE */                                   10889902
*/* P INCREMENT PRESENT CARD ADDRESS */                                 10899902
*/* P (,%BLANK2) INCREMENT POSITION TO MOVE CHAR BY 1 */                10909902
*/*ASMCHK1: P GET ADDRESS OF MODULE NAME TABLE */                       10911902
*/*ASMCMPM: D (YES,ASMFOUND,NO,) MATCH WITH MODULE NAME */              10912302
*/* P POINT TO NEXT ENTRY IN TABLE */                                   10912702
*/* D (NO,ASMCMPM,YES,) END OF MODULE NAME TABLE */                     10913102
*/*PGMRTN1: P (,READCD) RESET ASSEMBLY INDICATORS */                    10913802
*/*ASMFOUND: P INDICATE ASSEMBLY MATCH */                               10914202
*/* P (,RBJCL) INCICATE ASSEMBLY JCL TO BE WRITTEN */                   10914602
*/*PKEY: P INCREMENT PAST P1=' OR P2=' */                               10924602
*/* P MAKE CHAR A BLANK */                                              10926602
*/* P (,COMMACHK) INCREMENT PAST  ' */                                  10928602
*/*NKEY: D (YES,COMMACHK,NO,) APPLICATION FUNCTION */                   10928902
*/* P INCREMENT PAST 'N=' */                                            10930902
*/* D (YES,%I2,NO,) IS VALUE 'SYS1,' */                                 10932902
*/* D (YES,%I2,NO,) IS VALUE 'SYS1 ' */                                 10933302
*/* P CLEAR MEF BUFFER */                                               10942602
*/* P MOVE // TO BUFFER */                                              10944602
*/* P (,%ENDSYS) MOVE 'N=SYS1' TO BUFFER */                             10946602
*/*%I2: P (,COMMACHK) INCREMENT PAST 'SYS1' */                          10951402
*/*%ENDSYS: P BLANK TEMPORARY BUFFER */                                 10951902
*/* P MOVE CARD IMAGE TO TEMPORARY BUFFER */                            10952002
*/* P BLANK CARD BUFFER */                                              10961602
*/*%FOUNDN: D (YES,%N1,NO,) 'N=' FOUND IN TEMPORARY BUFFER */           10963602
*/* P MOVE 1 CHAR BACK TO CARD BUFFER */                                10965602
*/* P (,%FOUNDN) INCREMENT CARD AND TEMP BUFFER POINTERS */             10967602
*/*%N1: P INCREMENT BEFORE 'N=' IN TEMP BUFFER */                       10969602
*/* D (NO,%I7,YES,) CHARACTER BEFORE 'N=' A BLANK */                    10970002
*/* P INCREMENT PTR TO TEMPORARY BUFFER */                              10970402
*/* P SET DSN FIRST ON CARD SWITCH */                                   10970802
*/*%I7: P (,SKIPDSN1) INCREMENT TEMPORARY BUFFER PTR PAST 'N=' */       10971202
*/* E COPY CHANGE/REPLACE CARD ROUTINE */                               10971602
*/*COPYCHRP: P INDICATE END OF CHANGE/REPLACE TABLE */                  10981202
*/*CHRPCOPY: P MOVE NEXT CHANGE/REPLACE CARD TO OUTPUT BUFFER */        10990802
*/* I WRITE CHANGE/REPLACE CARD */                                      11000402
*/* P POINT TO NEXT CHANGE/REPLACE CARD */                              11010002
*/* D (YES,,NO,CHRPCOPY) REACHED END OF CHANGE/ REPLACE TABLE */        11040002
*/* P TURN OFF CHANGE/REPLACE SWITCH */                                 11070002
*/* R RETURN TO CRTEINCL */                                             11100002
*/*PART2: P TURN OFF JCL COPIED SWITCH */                               11130002
*/* S NOTERTN: NOTE TAPE POSITION OF LAST BLOCK READ */                 11160002
*/*P2READ: P SET NON-JCL ADDRESS TO P2TEST */                           11190002
*/* P SET BLANKSW TO A BLANK */                                         11220002
*/* S PGMRTN: DETERMINE THE PROGRAM INVOKED ON STAGE I TAPE */          11250002
*/*P2TEST: D (NO,,YES,P2STAT) COLUMN 1 BLANK */                         11280002
*/* D (YES,,NO,P2READ:R) END OF STEP CARD */                            11310002
*/* D (YES,,NO,READPCH1) JCL COPIED SWITCH SET */                       11340002
*/* S (,READPCH1) COPYRTN: COPY CARD */                                 11370002
*/*P2STAT: S CHKSPACE: POINT TO NEXT OPERAND */                         11400002
*/* D (NO,,YES,P2SELECT:R) IS THIS CHARACTER AN 'S' */                  11430002
*/* D (NO,P2READ:R,YES,P2COPYRT) IS THIS CHARACTER A 'C' */             11460002
*/*P2SELECT: S CHKSPACE: POINT TO NEXT OPERAND */                       11490002
*/* D (YES,P2MBRFND,NO,) 'MEMBER=' KEYWORD */                           11520002
*/* P (,%P2COMPA) SKIP PASSED 'M=' KEYWORD */                           11550002
*/*P2MBRFND: P INCREMENT PASSED 'MEMBER' KEYWORD */                     11580002
*/*%P2COMPA: D (YES,,NO,%P2MOD) IS THIS CHARACTER AN '=' */             11610002
*/* P INCREMENT PASSED '=' */                                           11640002
*/*%P2MOD: D (YES,,NO,P2MODINI) IS THIS CHARACTER A '(' */              11670002
*/* P INCREMENT PASSED '(' */                                           11700002
*/* P SET BLANK SWITCH TO NON-BLANK */                                  11730002
*/*P2MODINI: P BLANK OUTPUT AREA */                                     11760002
*/* P BLANK MODULE NAME BUFFER */                                       11790002
*/* P (,P2CHKSVC:R) OBTAIN MODULE NAME TABLE POINTER */                 11820002
*/*P2CHKSVC: D (NO,,YES,P2SVCS) NEXT CHARACTER A'(' */                  11850002
*/* S P2STORP: STORE MODULE NAME */                                     11880002
*/*P2COMPN: D (NO,,YES,P2FOUNDN) MODULE NAME BUFFER = MODULE NAME TABLE 11910002
*/* */                                                                  11940002
*/* P INCREMENT MODULE NAME TABLE POINTER TO NEXT NAME */               11970002
*/* D (NO,P2COMPN,YES,P2NOTFN) END OF MODULE NAME TABLE REACHED */      12000002
*/*P2SVCS: P MOVE '(' TO OUTPUT AREA */                                 12030002
*/* P INCREMENT CARD AND OUTPUT POINTERS */                             12060002
*/* S P2STOR:STORE MODULE NAME */                                       12090002
*/*P2COMPS: D (NO,,YES,P2FOUNDS) MODULE NAME BUFFER = MODULE NAME TABLE 12120002
*/**/                                                                   12150002
*/* P INCREMENT MODULE NAME TABLE POINTER TO NEXT NAME */               12180002
*/* D (NO,P2COMPS,YES,P2NOTFS) END OF MODULE NAME TABLE REACHED */      12210002
*/*P2NOTFN: D (YES,,NO,P2READ) ANY MORE NAMES ON SELECT CARD */         12240002
*/* P (,P2MODINI) INCREMENT POINTER PASSED ',' */                       12270002
*/*P2NOTFS: P INCREMENT CARD POINTER */                                 12300002
*/* D (YES,,NO,P2NOTFS) NEXT CHARACTER = ')' */                         12330002
*/* P (,P2NOTFN) INCREMENT PASSED ')' */                                12360002
*/*P2FOUNDN: D (YES,,NO,P2FOUNDC) APPLICATION FUNCTION REQUESTED */     12390002
*/* P SAVE POINTER TO NAME IN MODULE NAME TABLE */                      12420002
*/* P SAVE POINTER TO NAME TO BUILD NAME CARD */                        12450002
*/* P SET AMAPTF01 ROUTINE INDICATOR TO 5 */                            12480002
*/* L AMAPTF01  SPOOL OBJ MODULE AND DO LINK EDIT */                    12510002
*/*P2FOUNDC: S P2COPY: COPY CARD */                                     12540002
*/* P MOVE ',,R))' AFTER NAME IN OUTPUT BUFFER */                       12570002
*/*P2FOUND: S (,P2NOTFN) P2WRTE: WRITE CARD */                          12600002
*/*P2FOUND2: P (,P2FOUND1) INCREMENT PAST ',R' ON SELECT CARD */        12630002
*/*P2FOUND1: P MOVE ',R)' TO OUTPUT BUFFER */                           12660002
*/* P INCREMENT PASSED ',R)' */                                         12690002
*/* P MOVE ')' TO OUTPUT BUFFER */                                      12720002
*/* P (,P2FOUND) INCREMENT CARD POINTER TO COMMA BETWEEN PARENTHESES */ 12750002
*/*P2FOWNDS: S (,P2FCOMP) P2COPY: COPY JCL FOR SVC MATCH */             12780002
*/*P2FOUNDS: D (YES,,NO,P2FOWNDS) APPLICATION FUNCTION REQUESTED */     12810002
*/* P SAVE POINTER TO NEW NAME ON SELECT CARD */                        12840002
*/* P SAVE POINTER TO NAME IN MODULE NAME TABLE TO GET SSI */           12870002
*/* P SET AMAPTF01 ROUTINE INDICATOR TO 5 */                            12900002
*/* L AMAPTF01 SPOOL OBJ MODULE AND DO LINK EDIT */                     12930002
*/*P2FCOMP: D (NO,,YES,P2FOUND1) NEXT CHARACTER A ')' */                12960002
*/* D (NO,,YES,P2FOUND2) REPLACE OPTION ALREADY ON CARD */              12990002
*/* P MOVE CHARACTER TO OUTPUT AREA */                                  13020002
*/* P (,P2FCOMP:R) INCREMENT CARD AND OUTPUT POINTERS */                13050002
*/*P2COPYRT: D (YES,,NO,P2STCOPY) JCL COPIED SWITCH SET */              13080002
*/* S NOTERTN: NOTE TAPE POSITION OF LAST BLOCK READ */                 13110002
*/*P2STCOPY: P SAVE COPY STATEMENT */                                   13140002
*/* P (,P2READ:R) TURN OFF COPY CARD SWITCH */                          13170002
*/*P2STORP: E PART 2 MODULE NAME STORE ROUTINE */                       13200002
*/* P MOVE '(' TO OUTPUT BUFFER */                                      13230002
*/* P INCREMENT POINTER TO OUTPUT BUFFER */                             13260002
*/*P2STOR: P MOVE CHARACTER FROM CARD TO OUTPUT BUFFER */               13290002
*/* P MOVE CHARACTER FROM CARD TO MODULE NAME BUFFER */                 13320002
*/* P INCREMENT CARD,MODULE NAME AND OUTPUT BUFFER POINTERS */          13350002
*/* D (NO,,YES,P2STOREX) NEXT CHARACTER A ',' */                        13380002
*/* D (NO,,YES,P2STOREX) NEXT CHARACTER A ')' */                        13410002
*/* D (YES,,NO,P2STOR) NEXT CHARACTER A '*' */                          13440002
*/*P2STOREX: R RETURN TO CALLER */                                      13470002
*/*P2WRTE: E PART 2 WRITE ROUTINE */                                    13500002
*/* P INCREMENT MODULE NAME TABLE POINTER PASSED NAME */                13530002
*/* P INDICATE NAME MATCHED IN MODULE NAME TABLE */                     13560002
*/* D (NO,,YES,BMPCTR) APPLICATION FUNCTION REQUESTED */                13590002
*/* S AMAWRITE: WRITE SELECT STATEMENT */                               13620002
*/*BMPCTR: P SET COPY CARD SWITCH */                                    13650002
*/* R RETURN TO CALLER */                                               13680002
*/*P2COPY: E PART 2 COPY ROUTINE */                                     13710002
*/* D (NO,P2CJCL,YES,) JCL COPIED SWITCH SET */                         13740002
*/* D (NO,P2RB,YES,%P2RET) COPY CARD SWITCH SET */                      13770002
*/*%P2RET: R RETURN TO CALLER */                                        13800002
*/*P2CJCL: P SET JCL COPIED SWITCH */                                   13830002
*/* P SAVE SELECT STATEMENT */                                          13860002
*/* S POINTRTN: GO BACK TO BEGINNING OF JCL */                          13890002
*/*P2CJCL1: S READPCH: READ NEXT RECORD FROM STAGE I TAPE */            13920002
*/* D (YES,,NO,P2RF) JCL STATEMENT */                                   13950002
*/*JCLCHECK: D (NO,,YES,DSNCHECK) FOUND DSNAME QUALIFIER ON CARD */     13980002
*/* P INCREMENT CARD POINTER */                                         14010002
*/* D (YES,,NO,JCLCHECK) SCANNED THROUGH COLUMN 64 */                   14040002
*/*DOWRITE: D (NO,,YES,R23REST:R) APPLICATION FUNCTION REQUESTED */     14070002
*/* S (,R23REST:R) AMAWRITE: WRITE STATEMENT */                         14100002
*/*R23REST: D (YES,,NO,P2CJCL1:R) MULTI PROGRAMMING ENVIRONMENT FEATURE 14130002
*/* USED */                                                             14160002
*/* S AMAWRITE: WRITE CONINTUED JCL STATEMNT */                         14190002
*/* P (,P2CJCL1:R) TURN OFF MEF INDICATOR */                            14220002
*/*DSNCHECK: D (NO,,YES,DOWRITE) IS DATA SET QUALIFIER 'SYS1.' */       14250002
*/* P POSITION CARD POINTER AFTER QUALIFIER */                          14280002
*/* S (,DOWRITE:R) SYSGMEF: RESTRUCTURE DD CARD FOR MEF */              14310002
*/*P2RF: D (NO,,YES,P2CCOPY) REACHED SAVED COPY STATEMENT */            14340002
*/* D (NO,P2CJCL1,YES,P2COPYEX) REACHED SAVED SELECT STATEMENT */       14370002
*/*P2COPYEX: P (,%P2RET) TURN OFF DUPLICATE COPY CARD SWITCH */         14400002
*/*P2RB: P SAVE SELECT STATEMENT */                                     14430002
*/* S (,P2CJCL1) POINTRTN:  POINT TO LAST BLOCK NOTED */                14460002
*/*P2CCOPY: D (NO,,YES,P2CJCL1:R) DUPLICATE COPY SW SET */              14490002
*/* P SET DUPLICATE COPY CARD SWITCH */                                 14520002
*/* D (NO,,YES,P2CJCL1) APPLICATION FUNCTION REQUESTED */               14550002
*/* S (,P2CJCL1:R) AMAWRITE: WRITE CARD */                              14580002
*/*EOJRTN: P OBTAIN MODULE NAME TABLE ADDRESS */                        14970002
*/* P INDICATE MESSAGE HEAD NOT WRITTEN */                              15000002
*/*EOJMLOOP: D (NO,,YES,FILCLOSE) REACHED END OF MODULE NAME TABLE */   15030002
*/* P INCREMENT TABLE POINTER PASSED MODULE NAME */                     15060002
*/* D (YES,ASMSG,NO,) ASSEMBLY MATCH ONLY */                            15070002
*/* D (YES,,NO,MSGNOMOD) MATCH FOUND FOR THIS NAME */                   15090002
*/* P (,EOJMLOOP) INCREMENT TABLE POINTER PASSED MATCH INDICATOR */     15120002
*/*ASMSG: D (YES,%NOCHG,N0,) RETURN CODE MORE THAN 4 */                 15130002
*/* P SET RETURN CODE TO 4 */                                           15140002
*/*%NOCHG: P MOVE MSG AMA015I TO BUFFER */                              15142002
*/* P (,MSGRTNC) RESET HEADING WRITTEN INDICATOR */                     15144002
*/*MSGNOMOD: D (YES,,NO,MSGHEAD) MESSAGE HEADING WRITTEN FOR AMA000I */ 15150002
*/*MSGRTNC: P PICK UP NAME IN MODULE NAME TABLE */                      15180002
*/* P MOVE NAME TO OUTPUT BUFFER */                                     15210002
*/* I WRITE NAME UNDER HEADING */                                       15240002
*/* P (,EOJMLOOP) INCREMENT TABLE POINTER TO NEXT NAME */               15270002
*/*MSGHEAD: D (YES,RETNOCHG,NO,) RETURN CODE MORE THAN 4 */             15300002
*/* P SET RETURN CODE TO 4 */                                           15330002
*/*RETNOCHG: I WRITE AMA000I-NO MATCH HEADING */                        15360002
*/* P (,MSGRTNC) INDICATE MESSAGE HEADING WRITTEN */                    15390002
*/*%AMA001: I (,RET16) WRITE MODULE NAME TABLE OVERFLOW MESSAGE         15420002
*/*AMA001I */                                                           15450002
*/*COPYRTN: E COPY ROUTINE */                                           15480002
*/* D (YES,,NO,COPYRTN1) APPLICATION FUNCTION REQUESTED */              15510002
*/* D (NO,,YES,COPYRTN1) COLUMN 1 BLANK */                              15540002
*/* P SET AMAPTF01 ROUTINE INDICATOR TO 6 */                            15570002
*/* L AMAPTF01  CHECK CARD FOR LINKAGE PARAMETERS */                    15600002
*/*%COPRET: R RETURN TO CALLER */                                       15630002
*/*COPYRTN1: S AMAWRITE: WRITE CARD */                                  15660002
*/* D (YES,,NO,%COPRET:R) MEF SWITCH SET */                             15690002
*/* S (,%COPRET:R) AMAWRITE: WRITE CONTINUATION CARD */                 15720002
*/*AMAWRITE: E COMMON WRITE ROUTINE */                                  15750002
*/* I WRITE CARD FROMM BUFFER ADDRESS PASSED */                         15780002
*/* R RETURN TO CALLER */                                               15810002
*/*PGMRTN: E SEARCH STAGE I TAPE */                                     15840002
*/*READCD: S READPCH: READ NEXT RECORD FROM STAGE I TAPE */             15870002
*/* D (YES,,NO,READOUT) JCL CARD */                                     15900002
*/* S CHKSPACE: POINT TO NEXT OPERAND */                                15930002
*/* D (YES,,NO,READCD) EXEC STATEMENT */                                15960002
*/* S CHKSPACE: POINT TO NEXT OPERAND */                                15990002
*/* D (NO,,YES,PART2:R) PGM = IEBCOPY */                                16020002
*/* D (NO,,YES,EXECRTN) PROC = LINKS */                                 16080002
*/* D (NO,,YES,STG1MSG) PGM = IEHMOVE */                                16110002
*/* D (YES,READCD:R,NO,) APPLICATION FUNCTION REQUESTED */              16120002
*/* D (NO,READCD:R,YES,) PROC = ASMS */                                 16130002
*/*ASMRTN: S NOTERTN: NOTE POSITION OF ASSEMBLY EXEC CARD */            16132002
*/*ASMCHK: P (,CHKPARMS) INDICATE ASSEMBLY STEP SEARCH */               16134002
*/*STG1MSG: I (,RET16) WRITE MESSAGE AMA004I */                         16140002
*/*READOUT: R GO TO NON-JCL ADDRESS PASSED */                           16170002
*/*SYSGMEF: E MULTI PROGRAMMING ENVIRONMENT RTN */                      16200002
*/* D (NO,,YES,%SYSGRET) APPLICATION FUNCTION REQUESTED */              16230002
*/* D (NO,,YES,%SYSGRET) IS DATA SET QUALIFIER 'SYS1.' */               16260002
*/* P BLANK MEF BUFFER */                                               16290002
*/* P MOVE '//' TO MEF BUFFER */                                        16320002
*/* P MOVE 'DSN=' TO MEF BUFFER */                                      16350002
*/* P MOVE 'SYS1.' TO MEF BUFFER */                                     16380002
*/*PERLOOP: P INCREMENT CARD POINTER */                                 16410002
*/* D (YES,,NO,PERLOOP) FOUND '.' ON CARD */                            16440002
*/* P INCREMENT CARD POINTER PASSED '.' */                              16470002
*/*MOVEDSN: P MOVE CHARACTER OF DSNAME TO MEF BUFFER */                 16500002
*/* P INCREMENT CARD AND BUFFER POINTERS */                             16530002
*/* D (NO,,YES,CHKCONT) NEXT CHARACTER A ',' */                         16560002
*/* D (NO,MOVEDSN,YES,) NEXT CHARACTER A BLANK */                       16590002
*/*CHKCONT: P BLANK TEMPORARY BUFFER */                                 16620002
*/* P MOVE CARD AMAGE TO TEMPORARY BUFFER */                            16650002
*/* P BLANK CARD BUFFER */                                              16680002
*/*DSNCHK: D (NO,,YES,SKIPDSN) 'DSN' FOUND IN TEMPORARY                 16710002
*/*BUFFER */                                                            16740002
*/* P MOVE 1 CHARACTER BACK TO CARD BUFFER */                           16770002
*/* P (,DSNCHK:R) INCREMENT CARD AND TEMPROARY BUFFER POINTERS */       16800002
*/*SKIPDSN: P POSTION TEMPROARY BUFFER POINTER BEFORE 'DSN' */          16830002
*/* D (YES,,NO,PASSDSN) CHARACTER BEFORE 'DSN' A BLANK */               16860002
*/* P INCREMENT POINTER TO TEMPROARY BUFFER */                          16890002
*/* P SET DSN FIRST ON CARD SWITCH */                                   16920002
*/*PASSDSN: P INCREMENT TEMPORARY BUFFER POINTER PASSED 'DSN=' */       16950002
*/*SKIPDSN1: D (NO,,YES,MOVEREST) NEXT CHARACTER A ',' */               16980002
*/* D (NO,,YES,MOVEDONE) NEXT CHARACTER A BLANK */                      17010002
*/* P (,SKIPDSN1) INCREMENT TEMPORARY BUFFER POINTER */                 17040002
*/*MOVEREST: P INCREMENT TEMPROARY BUFFER POINTER PASSED ',' */         17070002
*/* D (NO,,YES,MOVEDONE:R) NEXT CHARACTER A BLANK */                    17100002
*/*MOVREST1: P MOVE CHARACTER FROM TEMPORARY BUFFER BACK TO CARD        17130002
*/*BUFFER */                                                            17160002
*/* P INCREMENT CARD AND TEMPORARY BUFFER POINTERS */                   17190002
*/* D (YES,LOC,NO,MOVREST1) NEXT CHARACTER A BLANK */                   17220002
*/*MOVEDONE: D (NO,,YES,DSNCONT) DSN FIRST ON CARD SWITCH SET */        17250002
*/*LOC: P TURN OFF DSN FIRST ON CARD SWITCH */                          17280002
*/* P SET POINTER TO PREVIOUS CHARACTER IN CARD BUFFER */               17310002
*/* D (NO,,YES,MOVECONT) IS THAT CHARACTER A ',' */                     17340002
*/* P INCREMENT POINTER */                                              17370002
*/* P MOVE ',' TO CARD BUFFER TO INDICATE CONTINUATION */               17400002
*/*MOVECONT: P MOVE 'X' TO COLUMN 72 TO INDICATE CONTINUATION */        17430002
*/* D (NO,MEF,YES,) IS CARD IN TEMP BUFFER CONTINUED */                 17460002
*/* P MOVE 'X' TO COLUMN 72 OF MEF BUFFER */                            17490002
*/* P MOVE ',' TO MEF BUFFER */                                         17520002
*/*MEF: P SET MEF SWITCH TO INDICATE MULTI PROGRAMMING ENVIRONMENT */   17550002
*/*%SYSGRET: R RETURN TO CALLER */                                      17580002
*/*DSNCONT: P MOVE MEF BUFFER TO CARD BUFFER */                         17610002
*/* P (,%SYSGRET) TURN OFF MEF SWITCH */                                17640002
*/*READPCH: E STAGE I READ ROUTINE */                                   17670002
*/* D (NO,,YES,POINTRD) HAS POINT JUST BEEN DONE */                     17700002
*/* D (YES,,NO,MOVTOPCH) USED ALL LOGICAL RECORDS IN THIS BLOCK */      17730002
*/*POINTRD: I READ A BLOCK FROM STAGE I TAPE TO INPUT BUFFER */         17760002
*/* P GET IOB ADDRESS */                                                17790002
*/* P LOAD RESIDUAL COUNT FROM CSW IN IOB */                            17820002
*/* P GET LOGICAL RECORD LENGTH FROM PCHF DSB */                        17850002
*/* P GET BLOCK SIZE FROM PCHF DCB */                                   17880002
*/* P SUBTRACT RESIDUAL COUNT FROM BLOCKSIZE TO GIVE # BYTES IN BUFFER  17910002
*/**/                                                                   17940002
*/* P DIVIDE BY LOGICAL RECORD LENGTH TO GIVE # LOGICAL RECORDS READ */ 17970002
*/* P SAVE NUMBER OF LOGICAL RECORDS READ */                            18000002
*/* D (NO,,YES,MOVTOPCH:R) HAS A POINT BEEN DONE */                     18030002
*/* P (,MOVTOPCH:R) SAVE NUMBER OF LOGICAL RECORDS REMAINING */         18060002
*/*MOVTOPCH: P LOAD NUMBER OF LOGICAL RECORDS LAST READ */              18090002
*/* P SUBTRACT NUMBER OF LOGICAL RECORDS REMAING */                     18120002
*/* P MULTIPLY DIFFERENCE BY LOGICAL RECORD LENGTH */                   18150002
*/* P ADD TO BUFFER ADDRESS */                                          18180002
*/* P MOVE ONE LOGINCAL RECORD LENGTH FROM BUFFER TO CARD BUFFER */     18210002
*/* P DECREMENT REMAINING COUNT */                                      18240002
*/* P TURN OFF POINT INDICATOR */                                       18270002
*/* R RETURN TO CALLER */                                               18300002
*/*NOTERTN: E NOTE ROUTINE */                                           18330002
*/* L NOTE POSITION OF LAST BLOCK READ FROM PCHF DD */                  18360002
*/* P SAVE BLOCK ADDRESS */                                             18390002
*/* P INCREMENT NUMBER OF RECORDS REMAINING BY 1 */                     18420002
*/* R RETURN TO CALLER */                                               18450002
*/*POINTRTN: E POINT ROUTINE */                                         18480002
*/* L POINT TO BLOCK ADDRESS SAVED BY NOTE */                           18510002
*/* P SET NUMBER REMAINING TO NUMBER IN BUFFER */                       18540002
*/* P TURN ON POINT INDICATOR */                                        18570002
*/* R RETURN TO CALLER */                                               18600002
*/*CHKSPACE: E OPERAND POSITIONING ROUTINE */                           18630002
*/* D (NO,,YES,CHKNOTSP) NEXT CHARACTER A BLANK */                      18660002
*/* P (,CHKSPACE) INCREMENT POINTER */                                  18690002
*/*CHKNOTSP: P INCREMENT POINTER */                                     18720002
*/* D (NO,,YES,CHKNOTSP) NEXT CHARACTER A BLANK */                      18750002
*/* R RETURN TO CALLER */                                               18780002
*/*SYNADEXT: E I/O ERROR ROUTINE */                                     18810002
*/* L OBTAIN ERROR INFORMATION */                                       18840002
*/* P MOVE INFORMATION TO OUTPUT BUFFER */                              18870002
*/* I WRITE MESSAGE AMA003I */                                          18900002
*/* R RETURN TO RET16 */                                                18930002
*/*AMAPTFLE: END */                                                     18960002
         EJECT                                                          18990002
*********************************************************************** 19020002
*                                                                     * 19050002
*            SET UP STANDARD LINKAGE AND ADDRESSABILITY               * 19080002
*            USING REGISTERS 11 AND 12 AS BASE REGISTERS.             * 19110002
*                                                                     * 19140002
*********************************************************************** 19170002
         SPACE                                                          19200002
         USING *,R12,R11                                                19230002
GO       STM   R14,R12,12(R13)         SAVE CALLERS REGISTERS           19260002
         LR    R12,R15                 SET UP FIRST BASE REGISTER       19290002
         L     R11,BASEADR2            SET UP SECOND BASE REGISTER      19320002
         LA    R2,SCSAVE               GET SAVE AREA ADDRESS            19350002
         ST    R2,8(R13)               SET UP FORWARD AND               19380002
         ST    R13,4(R2)               BACKWARD SAVE AREA LINKAGE       19410002
         LR    R13,R2                  SET UP POINTER TO SAVE AREA      19440002
         USING SCSAVE,R13                                               19450002
         B     ADDRSET                 BRANCH AROUND DC                 19470002
BASEADR2 DC    A(GO+4096)              TO SET UP ADDRESSABILITY         19500002
         SPACE                                                          19530002
*********************************************************************** 19560002
*                                                                     * 19590002
*       PICK UP PARAMETER PASSED ON EXEC CARD.                        * 19620002
*       OPEN INPUT-OUTPUT FILES                                       * 19650002
*              INPUT   - MODULE NAMES,OBJECT MODULES,AND              * 19680002
*                        IDENTIFY CARDS                               * 19710002
*                      - STAGE1 OUTPUT FROM SYSGEN                    * 19740002
*              OUTPUT  - EXTRACTS OF SYSGEN STAGE1 OUTPUT             * 19770002
*                      - MESSAGES                                     * 19800002
*                                                                     * 19830002
*********************************************************************** 19860002
         SPACE                                                          19890002
ADDRSET  L     R2,0(R1)                PICK UP POINTER TO PARM          19920002
         ST    R2,PARMPTR              SAVE ADDRESS OF PARAMETER        19950002
         OPEN  (MODFDCB,,PCHFDCB,,OUTFDCB,(OUTPUT),MSGDCB,(OUTPUT))     19980002
         SPACE                                                          20010002
*********************************************************************** 20040002
*                                                                     * 20070002
*             TEST FOR SUCCESSFUL OPEN OF ALL DCBS                    * 20100002
*                                                                     * 20130002
*********************************************************************** 20160002
         SPACE                                                          20190002
         LA    RA,MSGDCB                                                20220002
         USING IHADCB,RA                                                20250002
         TM    DCBOFLGS,OPENBIT        MSG DCB OPEN SUCCESSFUL          20280002
         BZ    MSGWRITE                NO - WRITE ERROR MESSAGE         20310002
         LA    RA,MODFDCB                                               20340002
         TM    DCBOFLGS,OPENBIT        MODF DCB OPEN SUCCESSFUL         20370002
         BZ    MODFRITE                NO - WRITE ERROR MESSAGE         20400002
         LA    RA,PCHFDCB                                               20430002
         TM    DCBOFLGS,OPENBIT        PCHF DCB OPEN SUCCESSFUL         20460002
         BZ    PCHFRITE                NO - WRITE ERROR MESSAGE         20490002
         LA    RA,OUTFDCB                                               20520002
         TM    DCBOFLGS,OPENBIT        OUTF DCB OPEN SUCCESSFUL         20550002
         BZ    OUTFRITE                NO - WRITE ERROR MESSAGE         20580002
         SPACE                                                          20610002
*********************************************************************** 20640002
*                                                                     * 20670002
*                 CHECK IF ANY PARAMETER IS PRESENT.                  * 20700002
*                 IF PRESENT, INDICATE APPLICATION FUNCTION           * 20730002
*                 AND LOAD AMAPTF01 AND AMAPTF02.                     * 20760002
*                                                                     * 20790002
*********************************************************************** 20820002
         SPACE                                                          20850002
         L     R2,PARMPTR              GET POINTER TO PARAMETER LIST    20880002
         LH    R3,0(R2)                GET COUNT OF PARM LIST           20910002
         LTR   R3,R3                   IS PARM LENGTH ZERO              20940002
         BC    8,LODBLOK               YES - GENERATE FUNCTION          20970002
         OI    PARM,X'80'              INDICATE APPLICATION FUNCTION    21000002
         LOAD  EPLOC=LOADOVR           LOAD IEWSZOVR             A48079 21010002
         LOAD  EPLOC=LOAD01            LOAD AMAPTF01                    21030002
         ST    R0,PTF01                SAVE THE ENTRY POINT ADDRESS     21060002
         LOAD  EPLOC=LOAD02            LOAD AMAPTF02                    21090002
         ST    R0,PTF02                SAVE THE ENTRY POINT ADDRESS     21120002
         OI    BRPRMLST,SPOOLUT2       INDICATE AMAPTF01 TO SPOOL       21150002
*                                      MODF INPUT TO SYSUT2 WORK FILE   21180002
         EJECT                                                          21210002
*********************************************************************** 21240002
*                                                                     * 21270002
*        THIS ROUTINE GETS CORE FOR THE READ BUFFER BASED ON BLKSIZE  * 21300002
*                                                                     * 21330002
*********************************************************************** 21360002
         SPACE                                                          21390002
LODBLOK  LA    RA,PCHFDCB              GET PCHF DCB ADDRESS             21420002
         LH    R0,DCBBLKSI             OBTAIN BLKSIZE FROM PCHF DCB     21450002
         LTR   R0,R0                   IS BLKSIZE ZERO            M3991 21480002
         BNP   NOBLKSZ                 YES-BLKSIZE NOT SPECIFIED  M3991 21510002
         GETMAIN EC,LV=(0),A=BUFFADDR  GET CORE FOR READ BUFFER  A45397 21540002
         LTR   R15,R15                 GETMAIN SUCCESSFUL        A45397 21570002
         BNZ   AMA014W1                NO - WRITE ERROR MESSAGE SA55373 21600002
         SPACE                                                          21630002
*********************************************************************** 21660002
*                                                                     * 21690002
*        DETERMINE NUMBER OF LOGICAL RECORDS PER BUFFER               * 21720002
*                                                                     * 21750002
*********************************************************************** 21780002
         SPACE                                                          21810002
         LA    RA,PCHFDCB              GET PCHFDCB ADDRESS              21840002
         SR    R3,R3                   CLEAR REGISTERS FOR DIVIDE       21870002
         SR    R2,R2                                                    21900002
         SR    R1,R1                                                    21930002
         LH    R3,DCBBLKSI             OBTAIN THE BLKSIZE               21960002
         LH    R1,DCBLRECL             OBTAIN THE LOGICAL RECORD LENGTH 21990002
         DR    R2,R1                   DIVIDE THE BLKSIZE BY LRECL AND  22020002
         ST    R3,RECCNT               SAVE NUMBER OF LOGICAL RECORDS   22050002
         SPACE                                                          22080002
*********************************************************************** 22110002
*                                                                     * 22140002
*        WRITE JOB CARD IF GENERATE FUNCTION IS BEING PERFORMED       * 22170002
*                                                                     * 22200002
*********************************************************************** 22230002
         SPACE                                                          22260002
         TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   22290002
         BO    GETBUFS                 YES - DO NOT WRITE JOB CARD      22320002
         LA    R3,JOBCARD              GET ADDRESS OF OUTPUT BUFFER     22350002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              22380002
         SPACE                                                          22410002
*********************************************************************** 22440002
*                                                                     * 22470002
*                 OBTAIN STORAGE FOR ALL TABLES                       * 22500002
*                                                                     * 22530002
*********************************************************************** 22560002
         SPACE                                                          22590002
GETBUFS  GETMAIN EC,LV=30424,A=OVLYREC DO GETMAIN FOR BUFFERS    A45397 22620002
         LTR   R15,R15                 GETMAIN SUCCESSFUL        A45397 22650002
         BNZ   AMA014W                 NO - WRITE ERROR MESSAGE  A45397 22680002
         L     R2,OVLYREC              GET BEGINNING ADDR OF BUFFER     22710002
         A     R2,AOVLYREC             ADD LENGTH OF OVERLAY TABLE      22740002
         ST    R2,OVLYEND              SAVE END OF OVERLAY TABLE S21995 22770002
         LA    R2,1(R2)                END OF TABLE BYTE         S21995 22800002
         ST    R2,IDENTBL              STORE BEGINNING ADDRESS   S21016 22830002
*                                      OF IDENTIFY TABLE         S21016 22860002
         MVI   0(R2),X'FF'             SET END OF TABLE MARK     S21016 22890002
         A     R2,IDENTSZ              ADD LENGTH,IDENTIFY TABLE S21016 22920002
         ST    R2,IDENTEND             SAVE END-IDENTIFY TABLE   S21016 22950002
         LA    R2,1(R2)                END OF TABLE BYTE         S21016 22980002
         ST    R2,MODTBL               STORE BEGINNING ADDRESS          23010002
*                                      OF MODULE NAME TABLE             23040002
         MVI   0(R2),X'FF'             SET TABLE EMPTY SWITCH     M4002 23070002
         SPACE                                                          23100002
*********************************************************************** 23130002
*            THIS SWITCH IS RESET BY THE FIRST CHARACTER              * 23160002
*            PLACED IN THE MODULE NAME TABLE                          * 23190002
*********************************************************************** 23220002
         SPACE                                                          23250002
         A     R2,AMODTBL              ADD LENGTH OF MODULE NAME TABLE  23280002
         ST    R2,TABLEND              SAVE END,MODULE NAME TBL  S21995 23310002
         LA    R2,1(R2)                END OF TABLE BYTE         S21995 23340002
         ST    R2,SSITABLE             STORE BEGINNING ADDRESS          23370002
*                                      OF SSI TABLE                     23400002
         A     R2,ASSITBL              ADD LENGTH OF SSI TABLE          23430002
         ST    R2,CHGRPSTR             STORE BEGINNING ADDRESS          23460002
*                                      OF CHANGE/REPLACE TABLE          23490002
         L     RA,MODTBL               OBTAIN ADDR OF MODULE NAME TABLE 23520002
         L     R7,SSITABLE             OBTAIN ADDR OF SSI TABLE         23550002
         L     R9,OVLYREC              GET POINTER TO BUFFER            23580002
         ST    R9,OVTABADR             SAVE BEGINNING OF OVERLAY TABLE  23610002
         LA    R4,1                    INITIALIZE IDENTIFY INDEX S21016 23640002
         L     R6,IDENTBL              GET ADDRESS,IDENTIFY TBL  S21016 23670002
         EJECT                                                          23700002
*********************************************************************** 23730002
*                                                                     * 23760002
*         READ CONTROL CARDS,OBJECT MODULES AND IDENTIFY CARDS.       * 23790002
*           STORE MODULE NAMES IN MODULE NAME TABLE,                  * 23820002
*           SSI INFORMATION IN SSI TABLE,                             * 23850002
*           IDENTIFY CARDS IN IDENTIFY TABLE(GENERATE FUNCTION ONLY), * 23880002
*           AND SPOOL ENTIRE INPUT STREAM (APPLICATION FUNCTION ONLY).* 23910002
*                                                                     * 23940002
*********************************************************************** 23970002
         SPACE                                                          24000002
READMOD  GET   MODFDCB,MODAREA         READ CONTROL CARDS FROM MODF     24030002
         LA    R3,MODAREA              OBTAIN THE INPUT AREA ADDRESS    24060002
         CLI   0(R3),SPACE             IS COLUMN 1 BLANK                24090002
         BNE   MOVEMOD2                NO-CHECK FOR VALID CONTROL CARD  24120002
*                                                                S21995 24150002
         SPACE                                                          24180002
*********************************************************************** 24210002
*                                                                     * 24240002
*                 CHECK FOR IDENTIFY CARDS -                          * 24270002
*              VERIFY PROPER ORDER OF CARDS,                          * 24300002
*              MOVE CARDS TO IDENTIFY TABLE AND                       * 24330002
*              STORE IDENTIFY INDEX (GENERATE FUNCTION ONLY).         * 24360002
*                                                                     * 24390002
*********************************************************************** 24420002
         SPACE                                                          24450002
         TM    IDENTCON,X'80'          IDENTIFY CONT. SWITCH SET S21016 24480002
         BO    MOVECON                 YES - HANDLE CONTINUATION S21016 24510002
         TM    IDENTCON,X'08'          CONTINUATION (AMAPTF01)    M0861 24540002
         BO    SPOOLCD                 YES-SPOOL CARD(WORK FILE)  M0861 24570002
         BAL   R2,CHKSPACE             POINT TO FIRST OPERAND    S21016 24600002
         CLC   0(8,R3),IDENTIFY        IDENTIFY CARD             S21016 24630002
         BNE   AMA008WR                NO - WRITE ERROR MESSAGE  S21016 24660002
         TM    FIRSTNEW,X'80'          FIRST NAME CARD READ YET  S21016 24690002
         BNO   AMA008WR                NO - WRITE ERROR MESSAGE  S21016 24720002
         TM    PARM,X'80'              APPLICATION FUNC REQUEST  S21016 24750002
         BO    MOVEMOD2                YES-DON'T PUT CARD IN TBL S21016 24780002
         TM    FIRSTNEW,X'08'          NEW SET OF CARDS                 24810002
         BNO   MOVECON                 NO - DO NOT STORE IDENTIFY INDEX 24840002
         BCTR  RA,0                    POINT TO INDEX BYTE IN MODTBL    24870002
         STC   R4,0(RA)                STORE IDENTIFY INDEX             24900002
         LA    RA,1(RA)                INCREMENT MODTBL POINTER         24930002
         NI    FIRSTNEW,X'F0'          TURN OFF NEW SET SWITCH          24960002
         OI    MODAREA,X'80'           NEW SET OF IDENTIFY CARDS        24990002
MOVECON  LA    R4,1(R4)                INCREMENT IDENTIFY INDEX         25020002
         C     R6,IDENTEND             IDENTIFY TABLE OVERFLOW          25050002
         BNL   AMA011WR                YES - WRITE ERROR MESSAGE        25080002
         NI    IDENTCON,X'00'          RESET IDENTIFY CONTINUATION SW   25110002
         MVC   0(80,R6),MODAREA        MOVE IDENTIFY CARD TO TBL S21016 25140002
         LA    R6,80(R6)               NEXT TABLE POSITION       S21016 25170002
         MVI   0(R6),X'FF'             SET END OF TABLE MARK     S21016 25200002
         CLI   MODAREA+71,C' '         CARD TO BE CONTINUED      S21016 25230002
         BE    READMOD                 NO - READ NEXT CARD       S21016 25260002
         OI    IDENTCON,X'80'          SET CONTINUATION SWITCH   S21016 25290002
         B     READMOD                 READ NEXT CARD            S21016 25320002
         SPACE                                                          25350002
*********************************************************************** 25380002
*                                                                     * 25410002
*                 PROCESS CONTROL CARDS                               * 25440002
*                                                                     * 25470002
*********************************************************************** 25500002
         SPACE                                                          25530002
MOVEMOD2 EQU   *                                                        25560002
         CLI   0(R3),X'02'             PART OF OBJECT MODULE     S21995 25590002
         BNE   TURNNAM                 NO - HANDLE NAME CARD     S21995 25620002
         TM    FIRSTNEW,X'80'          FIRST NAME CARD READ      S21995 25650002
         BNO   AMA008WR                NO - WRITE ERROR MESSAGE  S21995 25680002
         TM    PARM,X'80'              APPLICATION FUNC REQUEST  S21995 25710002
         BNO   AMA008WR                NO - WRITE ERROR MESSAGE  S21995 25740002
TURNNAM  OI    FIRSTNEW,X'88'          SET NEW SET,FIRST CARD SW S21995 25770002
         TM    IDENTCON,X'88'          IDENTIFY CONT. SWITCH SET  M0861 25800002
         BM    AMA008WR                YES - WRITE ERROR MESSAGE S21016 25830002
SPOOLCD  TM    PARM,X'80'              APPLICATION FUNCT REQUEST  M0861 25860002
         BNO   NMEMOV                  NO - DO NOT SPOOL THE CARD       25890002
         LA    R1,BRPRMLST             GET ADDRESS OF PARAMETER LIST    25920002
         L     R15,PTF01               GET AMAPTF01 ROUTINE ADDRESS     25950002
         BALR  R14,R15                 SPOOL CARD TO SYSUT2 WORK FILE   25980002
         CLI   MODAREA,X'02'           IS CARD PART OF OBJECT DECK      26010002
         BE    READMOD                 NO - CHECK FOR IDENTIFY   S21016 26040002
         CLI   MODAREA,C' '            IS CARD AN IDENTIFY CARD  S21016 26070002
         BE    READMOD                 YES - READ NEXT CARD      S21016 26100002
         SPACE                                                          26130002
*********************************************************************** 26160002
*                                                                     * 26190002
*              FILL MODULE NAME AND SSI TABLES                        * 26220002
*                                                                     * 26250002
*********************************************************************** 26280002
         SPACE                                                          26310002
NMEMOV   C     RA,TABLEND              MODULE NAME TBL OVERFLOW  S21995 26340002
         BNL   MESSAGE                 YES-FLUSH INPUT           S21995 26370002
         MVC   0(8,RA),0(R3)           MOVE MODULE NAME TO TABLE A46339 26400002
         MVI   8(RA),SPACE             BLANK STATUS FIELD        A46339 26430002
         MVI   9(RA),X'00'             ZERO IDENTIFY INDEX BYTE  S21016 26460002
         MVC   0(8,R7),9(R3)           MOVE SSI NUMBER INTO SSI TABLE   26490002
         CLC   0(8,R7),BLANK           IS SSI BLANK              S21995 26520002
         BNE   BUMPRA                  NO - CONTINUE             S21995 26550002
         MVC   0(8,R7),ZEROES          REPLACE SSI WITH ZERO     S21995 26580002
BUMPRA   LA    RA,10(RA)               BUMP MODULE NAME TBL PTR  S21016 26610002
         LA    R7,8(R7)                UPDATE SSI TABLE POINTER         26640002
         B     READMOD                 NO-READ NEXT CARD                26670002
         EJECT                                                          26700002
*********************************************************************** 26730002
*                                                                     * 26760002
*                 END OF FILE ROUTINE :                               * 26790002
*        - CHECK FOR EMPTY MODULE NAME TABLE                          * 26820002
*        - CHECK FOR MODULE NAME TABLE OVERFLOW                       * 26850002
*                                                                     * 26880002
*********************************************************************** 26910002
         SPACE                                                          26940002
ENDMOD   EQU   *                                                        26970002
         L     R3,MODTBL               GET MODULE NAME TABLE ADDR M4002 27000002
         CLI   0(R3),X'FF'             TABLE EMPTY SWITCH SET     M4002 27030002
         BE    FILCLOSE                YES,TABLE EMPTY-RETURN     M4002 27060002
         TM    SWITCH1,X'80'           IS OVERFLOW SWITCH SET           27090002
         BO    MESSAGE1                YES,PUT OUT MSG                  27120002
         NI    BRPRMLST,TURNOFF        TURN OFF SPOOL ROUTINE INDICATOR 27150002
*                                                                 M4000 27180002
         MVC   LIBETCB(69),LIBETC      BLANK INCLUDE BUFFER             27210002
         MVC   LMODETCB(60),LMODETC    BLANK INCLUDE SYSLMOD BUFFER     27240002
         MVI   0(RA),SPACE             INDICATE LAST MODULE NAME S21995 27270002
         SPACE                                                          27300002
*********************************************************************** 27330002
*                                                                     * 27360002
*       READ INPUT FILE AND SCAN FOR FIRST EXEC STATEMENT             * 27390002
*              DETERMINE PROPER ROUTINE                               * 27420002
*                                                                     * 27450002
*********************************************************************** 27480002
         SPACE                                                          27510002
READPCH1 LA    R9,PGMRTN               SET NON JCL RETURN ADDR   S21995 27540002
         B     PGMRTN                  SEARCH STAGE I TAPE       S21995 27570002
         EJECT                                                          27600002
*********************************************************************** 27630002
*                                                                     * 27660002
*        PART I     CHECK FOR MODULE MATCHES                          * 27690002
*                   IN IEWL STEP OF STAGE 1 OUTPUT                    * 27720002
*                                                                     * 27750002
*                  - TURN OFF JCL COPIED SWITCH (R8)                  * 27780002
*                  - TURN OFF CHANGE-REPLACE SWITCH (R4)              * 27810002
*                  - SET ENTRY-ALIAS SWITCH (R6)                      * 27840002
*                  - NOTE POSITIONING OF INPUT-FILE                   * 27870002
*                                                                     * 27900002
*********************************************************************** 27930002
         SPACE                                                          27960002
EXECRTN  LA    R4,0                    TURN OFF CHANGE-REPL SW   S21995 27990002
         LA    R6,4                    SET ENTRY-ALIAS SWITCH    S21995 28020002
         LA    R8,0                    TURN OFF JCL COPIED SW    S21995 28050002
         XC    OVLYREC(4),OVLYREC      TURN OFF OVERLAY SWITCH          28080002
         BAL   R14,NOTERTN             NOTE THE LAST BLOCK READ         28110002
         SPACE                                                          28140002
*********************************************************************** 28170002
*                                                                     * 28200002
*                 READ PCHF INPUT FILE AND SCAN FOR                   * 28230002
*                 LINKAGE EDITOR CONTROL CARDS OR                     * 28260002
*                 /* CARD. IF NEITHER, DETERMINE                      * 28290002
*                 TYPE OF PROGRAM INVOKED ON EXEC CARD.               * 28320002
*                                                                     * 28350002
*********************************************************************** 28380002
         SPACE                                                          28410002
READPCH2 BAL   R9,PGMRTN               SET NON JCL RETURN ADDR   S21995 28440002
*                                      SEARCH STAGE I TAPE       S21995 28470002
TESTCON  CLI   0(R3),SPACE             IS COLUMN 1 BLANK         S21995 28500002
         BE    STATEX                  YES-CONTROL CARD                 28530002
         CLC   0(2,R3),ENDCARD         IS THIS END OF STEP              28560002
         BNE   READPCH2                NO-READ NEXT STATEMENT           28590002
         B     ENDCDRTN                YES-PREPARE TO TERMINATE         28620002
STATEX   EQU   *                                                        28650002
         TM    CONTSW2,X'80'           IS THERE AN OVERLAY/INSERT       28680002
*                                      CONTINUATION TO BE PROCESSED     28710002
         BNO   STATEX1                 NO-CHECK TYPE OF CONTROL CARD    28740002
         MVI   CONTSW2,X'00'           YES-TURN OFF THE CONTINUATION    28770002
*                                      SWITCH                           28800002
         B     OVLYRTN1                PROCESS THE CONTINUATION BY      28830002
*                                      MOVING IT TO THE OVERLAY TABLE   28860002
STATEX1  EQU   *                                                        28870002
         TM    CONTSW2,CHRCONT       CHANGE-REPLACE CONTINUATION Y01983 28880002
         BNO   STATEX2                 NO - CONTINUE             Y01983 28884002
         MVI   CONTSW2,TURNOFF         TURN OFF SWITCH           Y01983 28886002
         B     CHGRPRTN                GO COPY CARD              Y01983 28888002
         EJECT                                                          28890002
*********************************************************************** 28920002
*                                                                     * 28950002
*                 DETERMINE TYPE OF LINKAGE EDITOR                    * 28980002
*                 CONTROL CARD AND PROCESS ACCORDINGLY.               * 29010002
*                                                                     * 29040002
*********************************************************************** 29070002
         SPACE                                                          29100002
STATEX2  EQU   *                                                        29130002
         BAL   R2,CHKSPACE             POINT TO THE FIRST LETTER OF THE 29160002
*                                      LINKAGE EDITOR CONTROL STATEMENT 29190002
         TM    OVNOGO,X'08'            OVERLAY NO GO SWITCH SET  S21995 29220002
         BO    NMENOGO                 YES - FIND MODULE NAME    S21995 29250002
         CLC   0(2,R3),OVCARD          IS THIS AN OVERLAY STMT   S21995 29280002
         BE    OVLYRTN                 YES,PROCESS THE OVERLAY CARD     29310002
         TM    OVLYREC,X'80'           IS THE OVERLAY SWITCH SET        29340002
         BNO   NOOVLY                  NO-IGNORE ALL INSERT STATEMENTS  29370002
         CLC   0(3,R3),CHARINS         IS THIS AN INSERT STATEMENT      29400002
         BE    OVLYRTN1                YES-PROCESS THE INSERT STATEMENT 29430002
NOOVLY   EQU   *                                                        29460002
         CLC   0(3,R3),CHARINC         IS THIS AN INCLUDE STATEMENT     29490002
         BE    INCLDRTN                YES - HANDLE INCLUDE STATEMENT   29520002
NMENOGO  CLI   0(R3),LETTERN           IS THIS A NAME STATEMENT  S21995 29550002
         BE    NAMERTN                 YES - HANDLE NAME STATEMENT      29580002
         TM    OVNOGO,X'08'            OVERLAY NO GO SWITCH SET  S21995 29610002
         BO    READPCH2                YES - SEARCH FOR NAME     S21995 29640002
         CLI   0(R3),LETERC            IS THIS A CHANGE STMT     S21995 29670002
         BE    CHGRPRTN                YES - HANDLE CHANGE STATEMENT    29700002
         CLI   0(R3),LETTERR           IS THIS A REPLACE STMT    S21995 29730002
         BE    CHGRPRTN                YES - HANDLE REPLACE STATEMENT   29760002
         B     INCLUDBR(R8)            JCL COPIED ALREADY               29790002
INCLUDBR B     READPCH2                NO - NO MATCH IN INCLUDE         29820002
*                                      STATEMENT PREVIOUSLY FOUND.      29850002
*                                      CONTINUE IF JCL ALREADY COPIED   29880002
         CLI   0(R3),LETTERA           IS THIS AN ALIAS STMT     S21995 29910002
         BE    ENTRYRTN                YES - HANDLE ALIAS STATEMENT     29940002
         CLI   0(R3),LETTERE           IS THIS AN ENTRY STMT     S21995 29970002
         BE    ENTRYRTN                YES - HANDLE ENTRY STATEMENT     30000002
         CLC   0(4,R3),PAGECD          IS THIS A PAGE STMT       X01983 30030002
         BE    ENTRYRTN                YES - HANDLE PAGE STMT    X01983 30060002
         CLC   0(5,R3),ORDERCD         IS THIS AN ORDER STMT     X01983 30090002
         BE    ENTRYRTN                YES - HANDLE ORDER STMT   X01983 30120002
         CLC   0(7,R3),APFCD           IS THIS A SETCODE STMT    Y01048 30130002
         BE    ENTRYRTN                YES- HANDLE SETCODE STMT  Y01048 30140002
         B     READPCH2                READ NEXT RECORD                 30150002
         EJECT                                                          30180002
*********************************************************************** 30210002
*                                                                     * 30240002
*    THE FOLLOWING CODE PROCESSES OVERLAY STATEMENTS,                 * 30270002
*    INITIALIZING THE FIRST TIME SWITCH(OVLYREC).  INSERT             * 30300002
*    STATEMENTS ARE PROCESSED AT THE SECOND ENTRY (OVLYRTN1) WITH     * 30330002
*    BOTH STATEMENTS MOVED TO THE OVERLAY TABLE                       * 30360002
*                                                                     * 30390002
*********************************************************************** 30420002
         SPACE                                                          30450002
OVLYRTN  EQU   *                                                        30480002
         TM    OVLYREC,X'80'           IS OVERLAY SWITCH SET            30510002
         BO    OVLYRTN1                YES-CONTINUE PROCESSING          30540002
         L     R9,OVTABADR             OBTAIN BEGINNING OF OVERLAY TBL  30570002
         ST    R9,OVLYREC                                               30600002
OVLYRTN1 EQU   *                                                        30630002
         L     R9,OVLYREC              OBTAIN PTR TO NEXT POS    S21995 30660002
         CLI   PCHAREA+71,SPACE        IS THE OVERLAY/INSERT     S21995 30690002
*                                      STATEMENT CONTINUED       S21995 30720002
         BE    OVLYRTN2                NO-CONTINUE PROCESSING           30750002
         OI    CONTSW2,X'80'           SET CONTINUATION SWTIITCH        30780002
OVLYRTN2 EQU   *                                                        30810002
         C     R9,OVLYEND              OVERLAY TABLE OVERFLOW    S21995 30840002
         BNE   PCHOVLY                 NO - CONTINUE PROCESSING  S21995 30870002
SETNOGO  MVI   OVNOGO,X'08'            SET OVERLAY NO GO SWITCH         30900002
         B     READPCH2                SEARCH FOR MODULE NAME           30930002
PCHOVLY  MVC   0(80,R9),PCHAREA        MOVE OVLY/INSERT CARD TO THE     30960002
*                                      OVERLAY TABLE                    30990002
         LA    R9,80(R9)               POINT TO NEXT POSITION           31020002
         ST    R9,OVLYREC              SAVE FOR THE NEXT INPUT CARD     31050002
         MVI   OVLYREC,X'80'           TURN ON THE OVERLAY SWITCH       31080002
         MVI   OVLYEND,X'80'           HIGH ORDER BIT,END ADDR   S21995 31110002
         B     READPCH2                READ NEXT INPUT CARD             31140002
         EJECT                                                          31170002
*********************************************************************** 31200002
*                                                                     * 31230002
*       CHANGE-REPLACE ROUTINE                                        * 31260002
*              STORE ANY CONSECUTIVE CHANGE AND/OR REPLACE STATMENTS  * 31290002
*              INTO CHANGE-REPLACE TABLE (R5)                         * 31320002
*              SET CHANGE-REPLACE SWITCH (R4 TO 4)                    * 31350002
*                                                                     * 31380002
*********************************************************************** 31410002
         SPACE                                                          31440002
CHGRPRTN B     CHANGBR(R4)             IS CHANGE-REPLACE SWITCH SET     31470002
CHANGBR  B     SETUP                   NO-SET UP ADDRESS         S21995 31500002
CHGRPGO  MVC   0(80,R5),PCHAREA        MOVE CARD TO CHANGE-REPLACE TBL  31530002
         LA    R5,80(R5)               POINT TO NEXT POSITION IN TABLE  31560002
         CLI   PCHAREA+71,SPACE        CONTINUATION EXPECTED     Y01983 31570002
         BE    READPCH2                NO - CONTINUE             Y01983 31580002
         OI    CONTSW2,CHRCONT         TURN ON CHANGE-REPLACE SW Y01983 31582002
         B     READPCH2                READ NEXT CARD                   31590002
SETUP    LA    R4,4                    SET CHANGE-REPLACE SWITCH S21995 31620002
         L     R5,CHGRPSTR             GET ADDR OF CHANGE-REPLACE TABLE 31650002
         B     CHGRPGO                 GO TO MOVE CARD TO TABLE         31680002
         SPACE                                                          31710002
*********************************************************************** 31740002
*                                                                     * 31770002
*       ENTRY-ALIAS-PAGE-ORDER ROUTINE                          X01983* 31800002
*                 COPY ANY ENTRY,ALIAS,PAGE AND/OR ORDER        X01983* 31830002
*                 STATEMENTS IF A MATCH HAS BEEN FOUND AND      X01983* 31860002
*                 THE JCL HAS BEEN WRITTEN OUT ALREADY. THIS    X01983* 31890002
*                 WILL BE TRUE IF THE ENTRY-ALIAS SWITCH HAS    X01983* 31920002
*                 BEEN SET (R6 SET TO 4).                             * 31950002
*                                                                     * 31980002
*********************************************************************** 32010002
         SPACE                                                          32040002
ENTRYRTN B     READNEXT(R6)            IS ENTRY-ALIAS SWITCH SET        32070002
READNEXT B     READPCH2                NO-READ NEXT CARD                32100002
         BAL   R2,COPYRTN              YES-COPY CARD                    32130002
         B     READPCH2                READ NEXT CARD                   32160002
         EJECT                                                          32190002
*********************************************************************** 32220002
*                                                                     * 32250002
*       INCLUDE ROUTINE                                               * 32280002
*               - SAVE DDNAME IN INCLUDE BUFFER                       * 32310002
*               - SEARCH INCLUDE CARDS FOR MATCHES                    * 32340002
*                 WITH MODULE NAME TABLE                              * 32370002
*               - BUILD INSERT CARDS FOR OVERLAY STRUCTURES           * 32400002
*               - INDICATE MATCH WITH IDENTIFY CARDS (GENERATE)       * 32430002
*                                                                     * 32460002
*********************************************************************** 32490002
         SPACE                                                          32520002
INCLDRTN BAL   R2,CHKSPACE             POINT TO NEXT OPERAND     S21995 32550002
BLLIBETC MVI   LIBETC,C' '             BLANK INCLUDE BUFFER       M4756 32580002
         MVC   LIBETCB(69),LIBETC                                       32610002
         LA    R9,LIBETC               GET INCLUDE BUFFER ADDRESS       32640002
STORELIB MVC   0(1,R9),0(R3)           MOVE ONE CHARACTER OF DDNAME     32670002
         CLI   0(R3),PARNLEFT          BEGINING OF MODULE NAME   S21995 32700002
         BE    REGPOS                  YES-PROCESS MODULE NAME          32730002
         LA    R3,1(R3)                NO-INCREMENT CARD POINTER        32760002
         LA    R9,1(R9)                INCREMENT BUFFER POINTER         32790002
         B     STORELIB                CONTINUE SEARCH FOR MODULE NAME  32820002
REGPOS   LA    R3,1(R3)                INCREMENT CARD POINTER           32850002
         LA    R9,1(R9)                INCREMENT BUFFER POINTER         32880002
CHECKMOD MVC   MODSTORE(8),BLANK       BLANK MODULE NAME BUFFER         32910002
         ST    R5,R5SAVE                                                32940002
         L     RA,MODTBL               GET ADDR OF MODULE NAME TABLE    32970002
         LA    R5,MODSTORE             GET ADDR OF MODULE NAME BUFFER   33000002
         SPACE                                                          33030002
*********************************************************************** 33060002
*                                                                     * 33090002
*              MOVE MODULE NAME INTO MODULE NAME BUFFER               * 33120002
*                                                                     * 33150002
*********************************************************************** 33180002
         SPACE                                                          33210002
STOREMOD MVC   0(1,R5),0(R3)           MOVE CHARACTER TO BUFFER         33240002
         LA    R3,1(R3)                                                 33270002
         LA    R5,1(R5)                                                 33300002
         CLI   0(R3),PARNRITE          END OF MODULE NAME        S21995 33330002
         BE    COMPMOD1                YES-PROCESS NAME                 33360002
         CLI   0(R3),COMMA1            END OF MODULE NAME        S21995 33390002
         BNE   STOREMOD                NO-CONTINUE TO MOVE TO BUFFER    33420002
         SPACE                                                          33450002
*********************************************************************** 33480002
*                                                                     * 33510002
*         THE MODULE NAME IS CURRENTLY LOCATED IN MODSTORE            * 33540002
*                                                                     * 33570002
*********************************************************************** 33600002
         SPACE                                                          33630002
COMPMOD1 EQU   *                                                        33660002
         CLC   LIBETC(7),DSSDNME       DSS DDNAME PARMLIB        Y01045 33670002
         BNE   COMPMOD5                NO - CONTINUE PROCESSING  Y01045 33680002
         CLI   LIBETC+7,PARNLEFT       NEXT CHAR A LEFT PAREN    Y01045 33682002
         BNE   COMPMOD5                NO - CONTINUE PROCESSING  Y01045 33684002
         CLC   MODSTORE,DSSMEMB        DSSPARMLIB MEMBER         Y01045 33686002
         BNE   COMPMOD5                NO - CONTINUE PROCESSING  Y01045 33688002
         LTR   R8,R8                   COPY JCL SW SET           Y01045 33690402
         BZ    COMPMOD5                NO - CONTINUE             Y01045 33692402
OUTDSS   OI    COMSW,DSSSW             SET DSS SWITCH            Y01045 33694402
WRTDSS   STM   R2,R3,RITESAVE                                    Y01045 33716602
         LA    R3,PCHAREA              GET ADDRESS OF BUFFER     Y01045 33724902
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE       Y01045 33726902
         LM    R2,R3,RITESAVE                                    Y01045 33728902
BRCHBACK TM    SWITCH1,CPYDSS          COPY DSS SWITCH SET       Y01045 33730902
         BZ    READPCH2                NO - GO TO READPCH2       Y01045 33732902
         MVI   SWITCH1,TURNOFF         ZERO SWITCH               Y01045 33733302
         B     RFCOPY                  CONTINUE                  Y01045 33742602
COMPMOD5 TM    OVLYREC,X'80'           IS OVERLAY SWITCH SET            33752102
         BNO   COMPMOD2                NO-DO NOT BUILD INSERT CARD      33761402
         L     R5,OVLYREC              YES-GET OVERLAY TABLE POINTER    33770702
         C     R5,OVLYEND              OVERLAY TABLE OVERFLOW    S21995 33780002
         BNL   SETNOGO                 YES-SET OVLY NO GO SWITCH S21995 33810002
         MVI   0(R5),X'40'             BLANK THE OVERLAY TABLE POSITION 33840002
         MVC   1(79,R5),0(R5)                                           33870002
         MVC   0(8,R5),INSERTCD        PLACE 'INSERT' IN THE TABLE      33900002
         MVC   8(8,R5),MODSTORE        MOVE MODULE NAME INTO TABLE      33930002
         LA    R5,80(R5)               POINT TO NEXT AVAILABLE POSITION 33960002
         ST    R5,OVLYREC              SAVE ADDRESS OF NEXT POSITION    33990002
         MVI   OVLYREC,X'80'           SET OVERLAY SWITCH               34020002
COMPMOD2 EQU   *                                                        34050002
         L     R5,R5SAVE               RESTORE REGISTER FIVE            34080002
         SPACE                                                          34110002
*********************************************************************** 34140002
*                                                                     * 34170002
*    COMPARE NAME IN MODULE NAME BUFFER TO NAMES IN MODULE NAME TABLE * 34200002
*                   MATCH  -  GO TO MODFOUND                          * 34230002
*                NO MATCH  -  GO TO MODNOTBL                          * 34260002
*                                                                     * 34290002
*********************************************************************** 34320002
         SPACE                                                          34350002
COMPMOD  CLC   0(8,RA),MODSTORE        FOUND NAME IN MODULE NAME TABLE  34380002
         BE    MODFOUND                YES - HANDLE MATCH               34410002
         LA    RA,10(RA)               POINT TO NEXT NAME        S21016 34440002
         CLI   0(RA),SPACE             END OF MODULE NAME TABLE  S21995 34470002
         BE    MODNOTBL                YES - NAME NOT FOUND             34500002
         B     COMPMOD                 CONTINUE SEARCH                  34530002
         SPACE                                                          34560002
*********************************************************************** 34590002
*                                                                     * 34620002
*       MODULE NOT FOUND IN TABLE - CHECK IF THIS WAS LAST MODULE     * 34650002
*       ON INCLUDE CARD. IF YES, READ NEXT RECORD FROM STAGE 1 TAPE.  * 34680002
*       IF NO, GO TO CHECK NEXT MODULE NAME (CHECKMOD).               * 34710002
*                                                                     * 34740002
*********************************************************************** 34770002
         SPACE                                                          34800002
MODNOTBL LA    R4,0                    RESET CHANGE-REPLACE SW   S21995 34830002
         CLI   0(R3),COMMA1            LAST NAME ON INCLUDE CARD S21995 34860002
         BE    INCR                    NO - CHECK FOR THE REST    M4756 34890002
         CLI   1(R3),COMMA1            IS THERE ANOTHER DDNAME   S21995 34920002
*                                      ON THE INCLUDE CARD        M4756 34950002
         BNE   READPCH2                NO - READ ANOTHER CARD           34980002
         LA    R3,2(R3)                YES-INCREMENT PASSED THE '),'    35010002
         B     BLLIBETC                PROCESS THE NEXT DDNAME    M4756 35040002
INCR     LA    R3,1(R3)                                           M4756 35070002
         B     CHECKMOD                PROCESS NEXT MODULE NAME         35100002
         SPACE                                                          35130002
*********************************************************************** 35160002
*                                                                     * 35190002
*                MODULE FOUND IN TABLE                                * 35220002
*              - WRITE JCL IF NOT ALREADY WRITTEN (GENERATE)          * 35250002
*              - INDICATE MATCH IN IDENTIFY TABLE (GENERATE)          * 35280002
*              - CREATE INCLUDE CARD (GENERATE) OR                    * 35310002
*                SPOOL OBJECT MODULE TO OUTF (APPLICATION)            * 35340002
*              - WRITE CHANGE-REPLACE CARDS IF PRESENT                * 35370002
*                                                                     * 35400002
*********************************************************************** 35430002
         SPACE                                                          35460002
MODFOUND ST    RA,SSISAVE              SAVE LOCATION OF MATCHED NAME    35490002
         ST    R3,R3SAV2               SAVE R3                   Y01036 35500002
         B     JCLCOPY1(R8)            IS JCL COPIED SWITCH SET         35520002
JCLCOPY1 B     COPYJCL                 NO-COPY JCL (GENERATE FUNCTION)  35550002
         B     BYPASS(R6)              YES-IS ENTRY-ALIAS SWITCH SET    35580002
BYPASS   B     RBTILLNM                NO-READ BACK TILL PREVIOUS NAME  35610002
CHEKCHRP B     CPYCHANG(R4)            YES-IS CHANGE-REPLACE SWITCH SET 35640002
CPYCHANG B     CRTEINCL                NO-CREATE INCLUDE CARD OR SPOOL  35670002
         B     COPYCHRP                YES-COPY CHANGE-REPLACE CARDS    35700002
         EJECT                                                          35730002
*********************************************************************** 35760002
*                                                                     * 35790002
*        THIS ROUTINE COPIES THE PRECEEDING SET OF JCL-CARDS          * 35820002
*                                                                     * 35850002
*********************************************************************** 35880002
         SPACE                                                          35910002
COPYJCL  MVC   INCSTORE(80),PCHAREA    SAVE MATCHED INCLUDE CARD        35940002
         ST    R3,R3SAV2               SAVE R3                   Y01036 35950002
RBJCL    BAL   R14,POINTRTN            POINT TO BEGINNING OF STEP JCL   35970002
JCLCOPY5 BAL   R14,READPCH             READ A RECORD             A40797 36000002
         TM    ASMSW,ASMPCH            COPY ASSEMBLY JCL SW SET  A40797 36010002
         BZ    CHKPARMS                NO - CHECK PARMS ON EXEC  Y01036 36020002
JCLCOPY  BAL   R2,COPYRTN              GO TO COPY EXEC CARD             36030002
         TM    ASMSW,ASMPCH            COPY ASSEMBLY JCL SW SET  A40797 36040002
         BO    JCLCOPY4                YES - BRANCH TO CHECK /*  A40797 36050002
JCLREAD  BAL   R14,READPCH             READ A RECORD             XXXXXX 36060002
         LA    R3,PCHAREA              GET ADDRESS OF PCH BUFFER Y01036 36062002
         TM    CONTSW1,EXECCONT        EXEC CONTINUATION SW SET  Y01036 36070002
         BZ    CHKBLANK                NO - CONTINUE PROCESSING  Y01036 36080002
         NI    CONTSW1,HEX00           TURN OFF EXEC CONTIN SW   Y01036 36082002
         BAL   R2,CHKSPACE             POINT TO NEXT KEYWORD     Y01036 36084002
         B     PARMCHK                 GO CHECK PARAMETERS       Y01036 36086002
         SPACE                                                          36090002
*********************************************************************** 36120002
*                                                                     * 36150002
*        THIS SECTION OF CODE EXAMINES THE PARAMETERS ON THE          * 36180002
*        EXEC STATEMENT                                               * 36240002
*                                                                     * 36270002
*********************************************************************** 36300002
         SPACE                                                          36330002
CHKPARMS EQU   *                                                        36380002
         LA    R3,PCHAREA              GET PCHF BUFFER ADDRESS   Y01036 36530002
         BAL   R2,CHKSPACE             POINT TO 'EXEC'           Y01036 36580002
         BAL   R2,CHKSPACE             POINT TO PROC NAME        Y01036 36630002
         CLC   0(5,R3),LINKSPRC        LINK EDIT STEP            Y01036 36680002
         BE    LINKS1                  YES - BRANCH              Y01036 36682002
         LA    R3,4(R3)                INCREMENT PAST 'ASMS'     Y01036 36684002
         B     COMMACHK                BRANCH TO CHECK NEXT CHAR Y01036 36686002
LINKS1   LA    R3,5(R3)                INCREMENT PAST 'LINKS'    Y01036 36688002
         B     COMMACHK                BRANCH TO CHECK NEXT CHAR Y01036 36688102
PARMCHK  EQU   *                                                        36688402
         CLC   0(4,R3),MODPARM         IS THIS MOD= KEYWORD      Y01036 36688802
         BE    MODKEY                  YES - BRANCH              Y01036 36689202
         CLC   0(2,R3),NPARM           IS THIS N= KEYWORD        Y01036 36689602
         BE    NKEY                    YES - BRANCH              Y01036 36689702
         CLC   0(3,R3),P1PARM          IS THIS P1= KEYWORD       Y01036 36689802
         BE    PKEY                    YES - BRANCH              Y01036 36689902
         CLC   0(3,R3),P2PARM          IS THIS P2= KEYWORD       Y01036 36699902
         BE    PKEY                    YES - BRANCH              Y01036 36709902
INC1     LA    R3,1(R3)                INCREMENT 1 CHAR          Y01036 36713202
COMMACHK CLI   0(R3),COMMA1            IS THIS A COMMA           Y01036 36715202
         BE    INC2                    YES - BRANCH              Y01036 36715602
         CLI   0(R3),SPACE             IS THIS A BLANK           Y01036 36716002
         BNE   INC1                    NO - INCREMENT TO NEXT CHAR      36716402
*                                                                Y01036 36716502
         TM    MEFSW,X'80'             MEF IN STAGE 1            Y01036 36722202
         BNO   CHKBLANK                NO - BRANCH               Y01036 36724202
         CLI   MEFBUFF+71,SPACE        CONTINUATION EXPECTED     Y01036 36727302
         BE    CHKBLANK                NO - BRANCH               Y01036 36727702
         OI    CONTSW1,EXECCONT        YES - SET SWITCH          Y01036 36728102
         B     CHKBLANK                CONTINUE PROCESSING       Y01036 36728702
         SPACE 1                                                        36734402
INC2     LA    R3,1(R3)                INCREMENT PAST COMMA      Y01036 36740102
         CLI   0(R3),SPACE             IS THIS A BLANK           Y01036 36745802
         BNE   PARMCHK                 NO CHECK PARAMETERS       Y01036 36751502
         TM    MEFSW,X'80'             MEF IN STAGE 1            Y01036 36753502
         BNO   SETCONT                 NO - BRANCH               Y01036 36755502
         CLI   MEFBUFF+71,SPACE        CONTINUATION EXPECTED     Y01036 36755902
         BE    CHKBLANK                NO - BRANCH               Y01036 36756302
SETCONT  OI    CONTSW1,EXECCONT        TURN ON EXEC CONTINUE SW  Y01036 36757202
         EJECT                                                          36762902
*********************************************************************** 36768602
*                                                                     * 36774302
*        CHECK IF DATA RECORDS HAVE TO BE BYPASSED UNTIL THE          * 36780002
*        PROPER LOAD MODUE OR INCLUDE CARD IS FOUND                   * 36810002
*                                                                     * 36840002
*********************************************************************** 36870002
         SPACE                                                          36900002
CHKBLANK EQU   *                                                        36930002
         TM    ASMSW,ASMPCH            ASSEMBLY PUNCH STEP       Y01036 36940002
         BO    JCLCOPY                 YES - BRANCH              Y01036 36950002
         CLI   PCHAREA,C' '            IS THIS A CONTROL CARD           36960002
         BNE   JCLCHKAS                NO-COPY JCL CARD          Y01036 36990002
         LA    R8,4                    YES-SET JCL COPIED SWITCH S21995 37020002
         B     DOREAD(R6)              IS ENTRY-ALIAS SWITCH SET        37050002
DOREAD   B     RFTILLNM                NO-SKIP TILL SAVED NAME CARD     37080002
         CLC   PCHAREA,INCSTORE        YES-IS THIS SAVED INCLUDE CARD   37110002
         BE    CHEKCHRP                YES-CHECK FOR CHANGE-REPLACE CDS 37140002
COPYALEN ST    R3,R3SAV                                                 37170002
ALENRTRN LA    R3,PCHAREA              GET PCHF INPUT BUFFER ADDRESS    37200002
         BAL   R2,CHKSPACE             POINT TO NEXT OPERAND            37230002
         CLC   0(3,R3),CHARINC         INCLUDE CARD              Y01045 37240002
         BE    CHECKDSS                CHECK IF DSS CARD         Y01045 37250002
         CLI   0(R3),LETTERA           IS THIS AN ALIAS CARD     S21995 37260002
         BE    INSCOPY                 COPY ALIAS CARD           S21995 37290002
         CLI   0(R3),LETTERE           IS THIS AN ENTRY CARD     S21995 37320002
         BE    INSCOPY                 COPY ENTRY CARD           S21995 37350002
         CLC   0(4,R3),PAGECD          IS THIS A PAGE STMT       X01983 37380002
         BE    INSCOPY                 YES - HANDLE PAGE STMT    X01983 37410002
         CLC   0(5,R3),ORDERCD         IS THIS AN ORDER STMT     X01983 37440002
         BE    INSCOPY                 YES - HANDLE ORDER STMT   X01983 37470002
         CLC   0(7,R3),APFCD           IS THIS A SETCODE STMT    Y01048 37480002
         BE    INSCOPY                 YES - HANDLE SETCODE STMT Y01048 37490002
         TM    OVLYREC,X'80'           OVERLAY CARD ENCOUNTERED   M4006 37500002
         BO    RFCOPY                  YES - GO TO RFCOPY         M4006 37530002
         CLC   0(3,R3),CHARINS         YES - IS THIS INSERT STATEMENT   37560002
         BNE   RFCOPY                  NO - GO TO RFCOPY                37590002
INSCOPY  BAL   R2,COPYRTN              YES - COPY INSERT STATEMENT      37620002
RFCOPY   BAL   R14,READPCH             READ A RECORD                    37650002
         CLC   PCHAREA,INCSTORE        REACHED MATCHED INCLUDE CARD     37680002
         BNE   ALENRTRN                NO-CHECK FOR ENTRY OR ALIAS CARD 37710002
         L     R3,R3SAV                                                 37740002
         B     CHEKCHRP                CHECK FOR CHANGE-REPLACE CARDS   37770002
CHECKDSS BAL   R2,CHKSPACE             FIND DDNAME               Y01045 37780002
         CLC   0(17,R3),DSSDNME        CHECK IF DSS              Y01045 37790002
         BNE   RFCOPY                  NO - CONTINUE             Y01045 37792002
         OI    SWITCH1,CPYDSS          SET SWITCH                Y01045 37794002
         B     OUTDSS                  GO COPY CARD              Y01045 37796002
JCLCHKAS TM    ASMSW,ASMMOD            ASSEMBLY STEP             Y01036 37798002
         BNO   JCLCOPY                 NO - BRANCH TO COPY JCL   Y01036 37798402
         B     JCLREAD                 YES - BRANCH TO READ      Y01036 37798802
         SPACE                                                          37800002
*********************************************************************** 37830002
*                                                                     * 37860002
*      READ BACK TO LOAD MODULE BEGINNING, GO TO COPY ALIAS/ENTRY     * 37890002
*                                                                     * 37920002
*********************************************************************** 37950002
         SPACE                                                          37980002
RBTILLNM MVC   INCSTORE(80),PCHAREA     SAVE MATCHED INCLUDE CARD       38010002
         ST    R3,R3SAV2               SAVE R3                   Y01036 38020002
         BAL   R14,POINTRTN             POINT TO PREVIOUS NAME CARD     38040002
         ST    R3,R3SAV                                                 38070002
         B     RFCOPY                   START READING CONTROL CARDS     38100002
         SPACE                                                          38130002
*********************************************************************** 38160002
*                                                                     * 38190002
*           READ FORWARD TO LOAD MODULE BEGINNING,                    * 38220002
*           SKIPPING PREVIOUSLY CHECKED CONTROL CARDS.                * 38250002
*           GO TO COPY ALIAS AND/OR ENTRY CARDS.                      * 38280002
*                                                                     * 38310002
*********************************************************************** 38340002
         SPACE                                                          38370002
RFTILLNM BAL   R14,READPCH             READ A RECORD                    38400002
         CLC   PCHAREA,NAMESTOR        IS THIS SAVED NAME CARD          38430002
         BNE   RFTILLNM                NO-CONTINUE READING CARDS        38460002
         ST    R3,R3SAV                                                 38490002
         B     RFCOPY                  YES-CHECK FOR ENTRY-ALIAS CARDS  38520002
         EJECT                                                          38550002
*********************************************************************** 38580002
*                                                                     * 38610002
*        CREATE INCLUDE ROUTINE                                       * 38640002
*           - MOVE 'X' INTO TABLE TO INDICATE MATCH                   * 38670002
*           - MOVE MODULE INTO OUTPUT INCLUDE BUFFER                  * 38700002
*           - WRITE INCLUDE CARD (GENERATE) OR                        * 38730002
*             SPOOL OBJECT MODULE (APPLICATION)                       * 38760002
*           - INDICATE MATCH IN IDENTIFY TABLE                        * 38790002
*             GO CHECK NEXT MODULE                                    * 38820002
*                                                                     * 38850002
*********************************************************************** 38880002
         SPACE                                                          38910002
CRTEINCL STM   R0,R2,READSTOR                                    S21995 38940002
         ST    R9,R9SAV                                          S21995 38970002
         MVI   8(RA),LETTERX           INDICATE MATCH IN TABLE   S21995 39000002
         CLI   9(RA),X'00'             IS IDENTIFY INDEX 0       S21016 39030002
         BE    MVMODST                 YES - NO IDENTIFY CARDS   S21016 39060002
         LA    R2,80                   FOR MULTIPLY              S21016 39090002
         SR    R1,R1                                             S21016 39120002
         LR    R0,R1                                             S21016 39150002
         IC    R1,9(RA)                IDENTIFY INDEX (MODTBL)   S21016 39180002
         BCTR  R1,0                    DECREMENT INDEX BY 1      S21016 39210002
         MR    R0,R2                   MULTIPLY BY 80 (OFFSET)   S21016 39240002
         A     R1,IDENTBL              ADD BEGINNING ADDR OF TBL S21016 39270002
         OI    0(R1),X'08'             INDICATE MATCH FOR SET    S21016 39300002
MVMODST  LM    R0,R2,READSTOR          RESTORE REGISTERS         S21016 39330002
         LA    RA,10(RA)               NEXT NAME IN MODTBL       S21016 39360002
         MVC   0(8,R9),MODSTORE        MOVE MODULE NAME TO INCLUDE AREA 39390002
INCCOMP  CLI   0(R9),ABLANK            BLANK (IN MODULE NAME)    S21995 39420002
         BE    CLOSEINC                YES-FINISH PROCESSING            39450002
         LA    R9,1(R9)                POINT TO NEXT CHARACTER IN NAME  39480002
         B     INCCOMP                 CONTINUE TO SEARCH FOR BLANK     39510002
CLOSEINC MVI   0(R9),PARNRITE          MOVE IN RIGHT PARENTHESIS S21995 39540002
         TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   39570002
         BNO   WRTINCL                 NO-WRITE THE INCLUDE STATEMENT   39600002
         OI    BRPRMLST,SPOOLI         INDICATE OBJ TO BE SPOOLED       39630002
         LA    R1,BRPRMLST             GET ADDRESS OF PARAMETER LIST    39660002
         L     R15,PTF01               GET ADDRESS OF AMAPTF01          39690002
         BALR  R14,R15                 GO TO AMAPTF01 TO SPOOL TO OUTF  39720002
         B     COMWBLNK                SKIP THE WRITE                   39750002
WRTINCL  STM   R2,R3,RITESAVE                                           39780002
         LA    R3,OUTAREA1             GET ADDRESS OF INCLUDE BUFFER    39810002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              39840002
         LM    R2,R3,RITESAVE                                           39870002
COMWBLNK MVI   0(R9),SPACE                                              39900002
         L     R9,R9SAV                                                 39930002
         LA    R6,4                    SET ENTRY ALIAS SWITCH    S21995 39960002
         L     R3,R3SAV2               RESTORE R3                Y01036 39970002
         B     MODNOTBL                CHECK FOR MORE NAMES             39990002
         EJECT                                                          40020002
*********************************************************************** 40050002
*                                                                     * 40080002
*             NAME CARD ROUTINE -                                     * 40110002
*             NOTE POSITION OF NAME CARD                              * 40140002
*             CREATE SYSLMOD CARD FOR PREVIOUS LOAD MODULE            * 40170002
*             SAVE AND COPY NAME CARD                                 * 40200002
*             PERFORM LINK EDIT (APPLICATION)                         * 40230002
*                                                                     * 40260002
*********************************************************************** 40290002
         SPACE                                                          40320002
NAMERTN  TM    OVNOGO,X'08'            OVERLAY NO GO SWITCH SET  S21995 40350002
         BO    CRTSYSLM                YES-SKIP NORMAL PROCESS   S21995 40380002
         B     STORENM1(R8)            IS JCL COPIED SWITCH SET  S21995 40410002
STORENM1 B     STORENAM                NO-SAVE NAME CARD                40440002
         BAL   R14,NOTERTN             NOTE THE LAST BLOCK READ         40470002
         B     STORENM2(R6)            IS ENTRY-ALIAS SWITCH SET        40500002
STORENM2 B     STORENAM                NO-SAVE NAME CARD                40530002
CRTSYSLM LA    R7,LMODETC              ADDR OF INCLUDE SYSLMOD BUFFER   40560002
         BAL   R2,CHKSPACE             POINT TO MODULE NAME ON CARD     40590002
NAMELOOP MVC   0(1,R7),0(R3)           MOVE CHAR FROM CARD TO BUFFER    40620002
         LA    R3,1(R3)                                                 40650002
         LA    R7,1(R7)                                                 40680002
         CLI   0(R3),PARNLEFT          IS THIS A LEFT PAREN      S21995 40710002
         BE    NMELOOP1                YES, A REPLACE EXISTS-OUTPUT     40740002
*                                      THE SYSLMOD INCLUDE CARD         40770002
         CLI   0(R3),SPACE             END OF MODULE NAME        S21995 40800002
         BNE   NAMELOOP                NO-CONTINUE TO SCAN NAME         40830002
NMELOOP1 EQU   *                                                        40860002
         TM    OVNOGO,X'08'            OVERLAY NO GO SWITCH SET  S21995 40890002
         BO    AMA012WR                YES - WRITE ERROR MESSAGE S21995 40920002
         MVI   0(R7),PARNRITE          CHECK FOR RIGHT PAREN     S21995 40950002
         STM   R2,R4,RITESAVE                                    S21995 40980002
         SPACE                                                          41010002
*********************************************************************** 41040002
*                                                                     * 41070002
*             PUT OUT IDENTIFY CARDS FOR THIS LOAD MODULE.            * 41100002
*             THIS IS DONE ONLY FOR THE GENERATE FUNCTION.            * 41130002
*                                                                     * 41160002
*********************************************************************** 41190002
         SPACE                                                          41220002
         TM    PARM,X'80'              APPLICATION FUNC REQUEST  S21016 41250002
         BO    IDENEXIT                YES-DO NOT WRITE IDENTIFY S21016 41280002
         LA    R3,SSIAREA              ADDRESS OF OUTPUT BUFFER  S21016 41310002
         MVI   SSIAREA,C' '            BLANK FIRST BYTE OF BUFF  S21016 41340002
         L     R4,IDENTBL              IDENTIFY TABLE ADDRESS    S21016 41370002
LOOP     CLI   0(R4),X'FF'             END OF IDENTIFY TABLE     S21016 41400002
         BE    IDENEXIT                YES - EXIT                S21016 41430002
         TM    0(R4),X'08'             MATCH FOR THIS MODULE     S21016 41460002
         BO    IDFOUND                 YES-WRITE IDENTIFY CARDS  S21016 41490002
         LA    R4,80(R4)               NEXT ENTRY IN TABLE       S21016 41520002
         B     LOOP                    SEARCH FOR MATCHES        S21016 41550002
IDFOUND  NI    0(R4),X'F7'             TURN OFF MATCH INDICATOR  S21016 41580002
         MVC   SSIAREA+1(79),1(R4)     IDENTIFY CARD TO BUFFER   S21016 41610002
         BAL   R2,AMAWRITE             WRITE IDENTIFY RECORD     S21016 41640002
         LA    R4,80(R4)               NEXT ENTRY IN TABLE       S21016 41670002
         TM    0(R4),X'80'             NEW SET OF IDENTIFY CARDS S21016 41700002
         BNO   IDFOUND                 NO - WRITE RECORDS        S21016 41730002
         B     LOOP                    CHECK FOR MATCH OR END    S21016 41760002
IDENEXIT LA    R3,OUTAREA2             INCLUDE SYSLMOD BUFFER    S21016 41790002
         BAL   R2,AMAWRITE             WRITE INCLUDE SYSLMOD CARD       41820002
         LM    R2,R4,RITESAVE                                    S21995 41850002
         MVI   LMODETC,C' '            BLANK INCLUDE SYSLMOD BUFFER     41880002
         MVC   LMODETCB(60),LMODETC                                     41910002
         SPACE                                                          41940002
*********************************************************************** 41970002
*                                                                     * 42000002
*          THIS CODE EXAMINES IF OVERLAY WAS SPECIFIED. IF SO         * 42030002
*          THE OVERLAY TABLE IS WRITTEN PRIOR TO THE NAME CARD.       * 42060002
*                                                                     * 42090002
*********************************************************************** 42120002
         SPACE                                                          42150002
         TM    OVLYREC,X'80'           IS OVERLAY SWITCH SET            42180002
         BNO   COPYNAME                NO-SKIP OVERLAY PROCESSING       42210002
         L     R3,OVTABADR             GET OVERLAY TABLE ADDRESS S21995 42240002
         MVI   OVLYREC,X'00'           TURN OFF THE OVERLAY SWITCH      42270002
         L     R9,OVLYREC              CURRENT POSITION IN TABLE S21995 42300002
OVLYLOOP EQU   *                                                        42330002
         BAL   R2,AMAWRITE             WRITE OVERLAY/INSERT CARD S21995 42360002
         LA    R3,80(R3)               POINT TO NEXT RECORD             42390002
         CR    R9,R3                   REACHED LAST RECORD       S21995 42420002
         BNE   OVLYLOOP                NO-WRITE THE NEXT RECORD         42450002
         XC    OVLYREC(4),OVLYREC      YES-ZERO ADDR FOR NEXT MEMBER    42480002
         SPACE                                                          42510002
*********************************************************************** 42540002
*                                                                     * 42570002
*             THIS SECTION DETERMINES IF THE NAME CARD HAS            * 42600002
*             THE 'REPLACE' OPTION ON THE CARD. IF NOT, IT            * 42630002
*             PLACES THE (R) ON THE CARD PRIOR TO WRITING IT.         * 42660002
*                                                                     * 42690002
*********************************************************************** 42720002
         SPACE                                                          42750002
COPYNAME EQU   *                                                        42780002
         OI    NAMESWCH,X'80'          TURN ON NAME SWITCH TO INDICATE  42810002
*                                      A NAME CARD HAS BEEN PROCESSED   42840002
         LA    R3,PCHAREA              GET PCHF INPUT BUFFER ADDRESS    42870002
         BAL   R2,CHKSPACE             POINT TO NAME                    42900002
         BAL   R2,CHKSPACE             CYCLE TO THE MODULE NAME         42930002
         MVC   MODSTORE(8),BLANK       BLANK MODSTORE             M3999 42960002
         LA    R1,MODSTORE             SET UP POINTER TO MODSTORE M3999 42990002
COPYLOOP CLI   0(R3),PARNLEFT          IS THIS A LEFT PAREN      S21995 43020002
         BE    CPYNAME1                YES-REPLACE OPTION IS PRESENT    43050002
         CLI   0(R3),SPACE             IS THIS A BLANK           S21995 43080002
         BE    NEEDTHER                YES-REPLACE OPTION IS NEEDED     43110002
         MVC   0(1,R1),0(R3)           MOVE 1 CHAR OF MODULE NAME M3999 43140002
         LA    R1,1(R1)                INCREMENT MODSTORE POINTER M3999 43170002
         LA    R3,1(R3)                INCREMENT TO CHECK NEXT LETTER   43200002
         B     COPYLOOP                CHECK NEXT CHARACTER             43230002
NEEDTHER EQU   *                                                        43260002
         MVC   0(4,R3),REPLACE         MOVE THE REPLACE(R) OPTION       43290002
CPYNAME1 EQU   *                                                        43320002
         ST    R4,SAVE4                                                 43350002
         ST    R5,SAVE5                                                 43380002
         L     R5,SSISAVE              OBTAIN ADDR OF MATCHED NAME      43410002
         L     R4,MODTBL               OBTAIN ADDR OF MODULE TABLE      43440002
         SR    R5,R4                   OBTAIN OFFSET OF MATCHED NAME    43470002
         SR    R4,R4                                                    43500002
         D     R4,TEN                  DIVIDE OFFSET BY TEN      S21016 43530002
         SLL   R5,3                    MULTIPLY THIS BY 8               43560002
         L     R4,SSITABLE             OBTAIN ADDR OF SSI TABLE         43590002
         AR    R5,R4                   ADD OFFSET OF SSI INFO           43620002
         MVC   SSIAREA(80),SSIAREA-1   BLANK SSIAREA             S21016 43650002
         MVC   SSIAREA+11(8),0(R5)     MOVE SSI INFO INTO OUTPUT BUFFER 43680002
         MVC   SSIAREA+2(6),SSICARD    MOVE 'SETSSI' TO BUFFER   S21016 43710002
         STM   R2,R3,RITESAVE                                           43740002
         LA    R3,SSIAREA              GET ADDRESS OF OUTPUT BUFFER     43770002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              43800002
         LM    R2,R3,RITESAVE                                           43830002
         L     R4,SAVE4                                                 43860002
         L     R5,SAVE5                                                 43890002
         BAL   R2,COPYRTN              WRITE OUT THE 'NAME' CARD        43920002
         TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   43950002
         BNO   SLSHCHK                 CHECK FOR /* ROUTINE             43980002
         OI    BRPRMLST,LINK           YES - INDICATE LINK ROUINTE      44010002
         LA    R1,BRPRMLST             GET ADDRESS OF PARAMETER LIST    44040002
         L     R15,PTF01               GET ADDRESS OF AMAPTF01          44070002
         BALR  R14,R15                 GO TO THE LINK ROUTINE           44100002
SLSHCHK  TM    SLASHSW,X'80'           SHOULD WE RETURN TO /* ROUTINE   44130002
         BO    ENDCRTN1                YES--RETURN TO /* ROUTINE        44160002
STORENAM MVC   NAMESTOR(80),PCHAREA    SAVE NAME CARD                   44190002
         XC    OVLYREC(4),OVLYREC      TURN OFF OVERLAY SWITCH    M6106 44220002
         NI    COMSW,TURNOFF           TURNOFF DSS SWITCH        Y01045 44230002
         LA    R6,0                    SET ENTRY-ALIAS SWITCH    S21995 44250002
         B     READPCH2                READ NEXT CARD                   44280002
         EJECT                                                          44310002
*********************************************************************** 44340002
*                                                                     * 44370002
*    THIS SECTION PROCESSES THE NAME STATEMENT AT '/*' TIME. IF A NAME  44400002
*    CARD HAS NOT BEEN PRODUCED FOR THIS LOAD MODULE,THE NAME           44430002
*    OBTAINED FROM THE SYSLMOD INPUT SAVE AREA AND WRITTEN AT           44460002
*    THIS TIME. IF NO NAME EXISTS IN THIS AREA, THE MATCH IS IGNORED.   44490002
*                                                                     * 44520002
*********************************************************************** 44550002
         SPACE                                                          44580002
ENDCDRTN EQU   *                                                        44610002
         TM    NAMESWCH,X'80'          HAS A NAME CARD BEEN FOUND       44640002
         BO    COPYNAM1                YES-WRITE THE /* CARD            44670002
         CLC   SYSLNAME(8),BLANK       IS THE SYSLNAME AREA BLANK       44700002
         BE    COPYNAM1                YES, NO PROCESSING HAS BEEN DONE 44730002
*                                      FOR THIS MODULE--IGNORE IT       44760002
         MVC   SYSLSAVE(80),PCHAREA    SAVE THE /*                      44790002
         MVI   PCHAREA,X'40'                                            44820002
         MVC   PCHAREA+1(79),PCHAREA   BLANK THE PCHF INPUT BUFFER      44850002
         MVC   PCHAREA+1(5),NAMECARD   MOVE THE 'NAME' STATEMENT        44880002
         MVC   PCHAREA+7(11),SYSLNAME  MOVE THE MODULE NAME AND (R)     44910002
         OI    SLASHSW,X'80'           INDICATE THE NAME ROUTINE SHOULD 44940002
*                                      RETURN TO THE /* ROUTINE         44970002
         LA    R3,PCHAREA+1            INITIALIZATION FOR NAME ROUTINE  45000002
         B     CRTSYSLM                WRITE OUT THE OVERLAY,SYSLMOD,   45030002
*                                      AND NAME STATEMENTS              45060002
ENDCRTN1 EQU   *                                                        45090002
         MVI   SLASHSW,X'00'           TURN OFF THE NAME RETURN SWITCH  45120002
         MVC   PCHAREA(80),SYSLSAVE    PREPARE TO WRITE THE '/*' CARD   45150002
COPYNAM1 EQU   *                                                        45180002
         MVI   SYSLNAME,X'40'                                           45210002
         MVC   SYSLNAME+1(10),SYSLNAME BLANK SYSLNAME AREA              45240002
         NI    NAMESWCH,X'00'          TURN OFF THE NAME SWITCH         45270002
         B     DOREAD1(R8)             IS JCL COPIED SWITCH SET         45300002
DOREAD1  B     READPCH1                NO-READ NEXT CARD          M0868 45330002
         BAL   R2,COPYRTN              YES-WRITE CARD                   45360002
         B     READPCH1                READ NEXT CARD             M0868 45390002
         EJECT                                                          45420002
*********************************************************************** 45450002
*                                                                     * 45480002
*        SUBROUTINE TO COPY INPUT TO OUTPUT.                          * 45510002
*        CHECKS FOR LINKAGE EDITOR PARAMETERS (APPLICATION)           * 45540002
*                                                                     * 45570002
*********************************************************************** 45600002
         SPACE                                                          45630002
COPYRTN  TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   45660002
         BNO   COPYRTN1                NO - WRITE THE STATEMENT  S21995 45690002
         CLI   PCHAREA,SPACE           IS IT A CONTROL STATEMENT        45720002
         BE    COPYRTN1                YES - WRITE THE STATEMENT        45750002
         OI    BRPRMLST,PARMCHEK       INDICATE PARAMETER CHECK NEEDED  45780002
         LA    R1,BRPRMLST             GET PARAMETER LIST ADDRESS       45810002
         L     R15,PTF01               GET ADDRESS OF AMAPTF01          45840002
         BALR  R14,R15                 GO TO AMAPTF01 TO CHECK FOR PARM 45870002
         BR    R2                      RETURN TO CALLER          S21995 45900002
COPYRTN1 STM   R2,R3,RITESAVE                                           45930002
         LA    R3,PCHAREA              GET ADDRESS OF PCHF INPUT BUFFER 45960002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              45990002
         LM    R2,R3,RITESAVE                                           46020002
         TM    MEFSW,X'80'             IS MEF IN EFFECT                 46050002
         BNO   NOMEF                   NO-ADDITIONAL WRITE NOT NEEDED   46080002
         STM   R2,R3,RITESAVE                                           46110002
         LA    R3,MEFBUFF              GET ADDRESS OF MEF BUFFER        46140002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              46170002
         LM    R2,R3,RITESAVE                                           46200002
         NI    MEFSW,X'00'             CLEAR MEF INDICATOR              46230002
NOMEF    BR    R2                      RETURN TO CALLER                 46260002
         EJECT                                                          46290002
*********************************************************************** 46320002
*                                                                     * 46350002
*        THIS SECTION OF CODE HANDLES THE PARAMETERS ON THE EXEC      * 46380002
*        STATEMENT                                                    * 46390002
*                                                                     * 46470002
*********************************************************************** 46500002
         SPACE                                                          46530002
PKEY     LA    R3,4(R3)              INCREMENT PAST P1=' OR P2=' Y01036 46580002
         MVI   0(R3),SPACE             MAKE CHAR BLANK           Y01036 46630002
         LA    R3,2(R3)                INCREMENT PAST  '         Y01036 46680002
         B     COMMACHK                YES - CONTINUE PROCESSING Y01036 47380002
         SPACE 1                                                        47430002
MODKEY   EQU   *                                                        47480002
         LA    R3,4(R3)                INCREMENT PAST MOD=       Y01036 47530002
         ST    R3,DSNPNTR              SAVE PTR TO DSNAME        Y01036 47580002
         ST    R9,R9SAVE1              SAVE R9                   Y01036 47590002
         SR    R2,R2                   ZERO COUNTER              Y01036 47630002
         LA    R9,SYSLNAME             OBTAIN ADDR OF NAME AREA  Y01036 47680002
         MVC   SYSLNAME(8),BLANK       SET BUFFER TO BLANKS      Y01036 47730002
COMCHK1  CLI   0(R3),COMMA1            IS THIS A COMMA           Y01036 47780002
         BE    CNTCHK2                 YES - CONTINUE PROCESSING Y01036 47830002
         CLI   0(R3),SPACE             IS THIS A BLANK           Y01036 47880002
         BE    CNTCHK2                 YES - CONTINUE PROCESSING Y01036 47930002
         MVC   0(1,R9),0(R3)           MOVE ONE LETTER OF NAME   Y01036 47980002
         LA    R3,1(R3)                INCREMENT TO NEXR CHAR    Y01036 48030002
         LA    R9,1(R9)                POINT TO NEXT IN BUFFER   Y01036 48080002
         LA    R2,1(R2)                INCREMENT COUNTER         Y01036 48130002
         B     COMCHK1                 CHECK NEXT LETTER         Y01036 48180002
CNTCHK2  LTR   R2,R2                   IS COUNTER ZERO           Y01036 48230002
         BZ    RESTR9                  YES- CONTINUE PROCESSING  Y01036 48430002
CHKASM   TM    ASMSW,ASMMOD            IN ASSEMBLY STEP          A40797 48480002
         BO    ASMCHK1               YES - CHECK NAMES FOR MATCH A40797 48530002
         MVC   0(3,R9),REPLACE         REPLACE OPTION TO BUFFER  Y01036 48580002
         TM    PARM,APPLFUNC           APPLICATION FUNCTION      Y01036 48630002
         BO    RESTR9                  YES - CONTINUE PROCESSING Y01036 48680002
MODCARD  LR    R9,R3                 SAVE CURRENT BUFFER ADDRESS Y01036 48730002
         SR    R3,R2                   POINT TO BEFORE NAME      Y01036 48830002
BLCHK    CLI   0(R3),SPACE             IS THIS A BLANK           Y01036 48930002
         BE    RESTR3                  YES BRANCH                Y01036 48980002
         MVC   0(1,R3),0(R9)           NO - OVERLAY THIS CHAR    Y01036 48990002
         LA    R9,1(R9)                POINT TO NEXT LETTER      Y01036 49000002
         LA    R3,1(R3)                POINT TO NEXT LETTER      Y01036 49010002
         B     BLCHK                   CHECK NEXT LETTER         Y01036 49012002
RESTR3   L     R3,DSNPNTR              RESTORE R3 POINTER        Y01036 49014002
RESTR9   L     R9,R9SAVE1              RESTORE R9                Y01036 49014402
         B     COMMACHK             CONTINUE CHECKING PARAMETERS Y01036 49016002
         SPACE 1                                                        49018402
NKEY     TM    PARM,APPLFUNC           APPLICATION FUNCTION      Y01036 49018802
         BO    COMMACHK                YES - CONTINUE PROCESSING Y01036 49019202
         ST    R3,R3SAVE1              SAVE PTR                  Y01036 49019302
         LA    R3,2(R3)                INCREMENT PAST N=         Y01036 49019602
         ST    R9,R9SAVE               SAVE R9                   Y01036 49019802
         LA    R2,PARMCHK              GET RETURN ADDRESS        Y01036 49019902
         ST    R2,R2SAV2               SAVE FOR RETURN           Y01036 49020002
         CLC   0(5,R3),SYS1COM         IS VALUE 'SYS1,'          Y01036 49029902
         BE    INCSYS                  YES INCREMENT PTR         Y01036 49043202
         CLC   0(5,R3),SYS1BLK         IS VALUE 'SYS1 '          Y01036 49045202
         BE    INCSYS                  YES - BRANCH BACK         Y01036 49045602
         MVI   MEFBUFF,SPACE           CLEAR MEF BUFFER          Y01036 49046002
         MVC   MEFBUFF+1(79),MEFBUFF                             Y01036 49046402
         MVC   MEFBUFF(2),SLASHES      MOVE '//' INTO BUFFER     Y01036 49046502
         MVC   MEFBUFF+15(2),NPARM     MOVE 'N=' INTO BUFFER     Y01036 49046602
         MVC   MEFBUFF+17(4),SYS1COM   MOVE 'SYS1' INTO BUFFER   Y01036 49054902
         MVC   TEMPBUFF(72),PCHAREA    MOVE CARD TO TEMP BUFFER  Y01036 49056902
         LA    R9,MEFBUFF+21           SET UP REGISTER 9         Y01036 49057302
         MVI   PCHAREA,SPACE           CLEAR CARD BUFFER         Y01036 49058902
         MVC   PCHAREA+1(71),PCHAREA                             Y01036 49062902
         LA    R3,TEMPBUFF             POINT TO TEMP BUFFER      Y01036 49063302
         ST    R4,R4SAVE               SAVE R4                   Y01036 49065302
         LA    R4,PCHAREA              POINT TO PCHAREA          Y01036 49072602
FINDN    CLC   0(2,R3),NPARM           FOUND N=                  Y01036 49074602
         BE    FOUNDN                  YES - BRANCH              Y01036 49076602
         MVC   0(1,R4),0(R3)           NO - MOVE BACK TO CARD    Y01036 49078602
         LA    R3,1(R3)                INCREMENT POINTER         Y01036 49080602
         LA    R4,1(R4)                INCREMENT CARD POINTER    Y01036 49081002
         B     FINDN                   CHECK NEXT CHARACTER      Y01036 49081402
FOUNDN   BCTR  R3,0                    POINT TO BEFORE N=        Y01036 49081802
         CLI   0(R3),SPACE             IS N= FIRST ON CARD       Y01036 49081902
         BNE   PASSN                   NO - DONT SET SWITCH      Y01036 49082002
         OI    MEFSW,X'40'            INDICATE DSN FIRST ON CARD Y01036 49093602
PASSN    LA    R3,3(R3)                CYCLE PAST N=             Y01036 49101102
         B     SKIPDSN1                CONTINUE                  Y01036 49101502
INCSYS   LA    R3,4(R3)                INCREMENT PAST 'SYS1'     Y01036 49104302
         B     COMMACHK                CONTINUE PROCESSING       Y01036 49106302
         EJECT                                                          49110002
*********************************************************************** 49111202
*                                                                     * 49120802
*        COPY CHANGE-REPLACE ROUTINE                                  * 49130402
*              INDICATE END OF TABLE BY INSERTING 'X'                 * 49140002
*              COPY ALL ENTRIES IN TABLE TO OUTPUT                    * 49170002
*              GO TO CREATE INCLUDE CARD                              * 49200002
*                                                                     * 49230002
*********************************************************************** 49260002
         SPACE                                                          49290002
COPYCHRP MVI   0(R5),C'X'              INDICATE END OF ENTRIES          49320002
         STM   R2,R3,RITESAVE          SAVE REGISTERS 2 AND 3    S21995 49350002
         L     R3,CHGRPSTR             CHANGE-REPLACE TABLE      S21995 49380002
CHRPCOPY EQU   *                                                        49410002
         BAL   R2,AMAWRITE             WRITE CHANGE/REPLACE CARD S21995 49440002
         LA    R3,80(R3)               POINT TO NEXT ENTRY       S21995 49470002
         CLI   0(R3),C'X'              END OF CHANGE/REPLACE TBL S21995 49500002
         BNE   CHRPCOPY                NO - CONTINUE TO WRITE CARDS     49530002
         LA    R4,0                    RESET CHANGE-REPLACE SW   S21995 49560002
         LM    R2,R3,RITESAVE          RESTORE REGISTERS 2 AND 3 S21995 49590002
         B     CRTEINCL                RETURN TO CRTEINCL               49620002
         EJECT                                                          49650002
*********************************************************************** 49680002
*                                                                     * 49710002
*        PART II    CHECK FOR MODULE-MATCHES                          * 49740002
*                   IN IEBCOPY STEP OF STAGE 1 OUTPUT                 * 49770002
*                                                                     * 49800002
*********************************************************************** 49830002
         SPACE                                                          49860002
PART2    EQU   *                                                        49890002
         LA    R8,0                    TURN OFF JCL COPIED SWITCH       49920002
         BAL   R14,NOTERTN             NOTE THE LAST BLOCK READ         49950002
*                                                                       49980002
P2READ   MVI   BLANKSW,C' '                                      S21995 50010002
         BAL   R9,PGMRTN               SEARCH STAGE I TAPE       S21995 50040002
P2TEST   CLI   0(R3),SPACE             BLANK (CONTROL CARD)      S21995 50070002
         BE    P2STAT                  YES - CHECK IF SELECT OR COPY    50100002
         CLC   0(2,R3),ENDCARD         IS THIS /* CARD                  50130002
         BNE   P2READ                  NO - READ NEXT RECORD            50160002
P2JCLEND B     DOREAD2(R8)             IS THE JCL COPIED SWITCH SET     50190002
DOREAD2  B     READPCH1                NO - READ NEXT RECORD      M0868 50220002
         BAL   R2,COPYRTN              COPY RECORD                      50250002
         B     READPCH1                READ NEXT RECORD           M0868 50280002
P2STAT   EQU   *                                                        50310002
         BAL   R2,CHKSPACE             POINT TO CONTROL CARD TYPE       50340002
         CLI   0(R3),LETERS            IS THIS SELECT STATEMENT  S21995 50370002
         BE    P2SELECT                YES - GO TO SELECT ROUTINE       50400002
         CLI   0(R3),LETERC            IS THIS COPY STATEMENT    S21995 50430002
         BE    P2COPYRT                YES - GO TO COPY ROUTINE         50460002
         B     P2READ                  READ NEXT RECORD                 50490002
         EJECT                                                          50520002
*********************************************************************** 50550002
*                                                                     * 50580002
*              THIS ROUTINE ANALYZES SELECT CONTROL CARDS             * 50610002
*               -BUILD A NEW CONTROL CARD                             * 50640002
*               -CHECK FOR MATCHES WITH MODULE NAME TABLE             * 50670002
*                                                                     * 50700002
*********************************************************************** 50730002
P2SELECT BAL   R2,CHKSPACE             POINT TO 'MEMBER=' KEYWORD       50760002
         CLC   0(7,R3),P2MBR           'MEMBER=' KEYWORD          M0869 50790002
         BE    P2MBRFND                YES - POINT PASSED IT      M0869 50820002
         LA    R3,2(R3)                POINT PASSED 'M=' KEYWORD  M0869 50850002
         B     P2COMPA                 CONTINUE                   M0869 50880002
P2MBRFND LA    R3,7(R3)                SKIP PASSED 'MEMBER='      M0869 50910002
P2COMPA  CLI   0(R3),C'('              IS THIS A LEFT PARENTHESIS       50940002
         BNE   P2MODINI                NO-GO TO BLANK SELECT BUFFER     50970002
         LA    R3,1(R3)                POINT TO NEXT CHARACTER          51000002
         MVI   BLANKSW,C'*'                                             51030002
P2MODINI MVI   P2DATA,C' '                                              51060002
         MVC   P2DATA+1(62),P2DATA     BLANK SELECT BUFFER              51090002
         LA    R9,P2DATA               GET ADDR OF SELECT BUFFER        51120002
         MVC   MODSTORE,BLANK          BLANK MODULE NAME BUFFER         51150002
         L     RA,MODTBL               GET ADDR OF MODULE NAME TABLE    51180002
         LA    R5,MODSTORE             GET ADDR OF MODULE NAME BUFFER   51210002
P2CHKSVC CLI   0(R3),C'('              IS THIS MODULE RENAMED           51240002
         BE    P2SVCS                  YES - GO TO RENAME ROUTINE       51270002
         SPACE                                                          51300002
*********************************************************************** 51330002
*                                                                     * 51360002
*              THIS ROUTINE PROCESSES MODULES WHICH ARE NOT RENAMED   * 51390002
*                                                                     * 51420002
*********************************************************************** 51450002
         SPACE                                                          51480002
P2NORM   BAL   R2,P2STORP              STORE MODULE NAME IN MODSTORE    51510002
P2COMPN  CLC   0(8,RA),MODSTORE        IS THIS NAME IN THE TABLE        51540002
         BE    P2FOUNDN                YES-GO TO MODULE FOUND (NORMAL)  51570002
         LA    RA,10(RA)               NO-NEXT MODULE NAME       S21016 51600002
         CLI   0(RA),SPACE             END OF MODULE NAME TABLE  S21995 51630002
         BE    P2NOTFN                 YES-MODULE NOT FOUND (NORMAL)    51660002
         B     P2COMPN                 NO-CONTINUE COMPARING WITH TABLE 51690002
         SPACE                                                          51720002
*********************************************************************** 51750002
*                                                                     * 51780002
*              THIS ROUTINE PROCESSES MODULES WHICH ARE RENAMED       * 51810002
*                                                                     * 51840002
*********************************************************************** 51870002
         SPACE                                                          51900002
P2SVCS   MVC   0(1,R9),0(R3)           PUT PARENTHESIS IN SELECT BUFFER 51930002
         LA    R3,1(R3)                POINT TO NEXT LETTER ON CARD     51960002
         LA    R9,1(R9)                POINT TO NEXT POSITION IN BUFFER 51990002
         BAL   R2,P2STOR               STORE MODULE NAME IN MODSTORE    52020002
P2COMPS  CLC   0(8,RA),MODSTORE        IS THIS NAME IN THE TABLE        52050002
         BE    P2FOUNDS                YES-GO TO MODULE FOUND (RENAMED) 52080002
         LA    RA,10(RA)               POINT TO NEXT TABLE ENTRY S21016 52110002
         CLI   0(RA),SPACE             END OF MODULE NAME TABLE  S21995 52140002
         BE    P2NOTFS                 YES-MODULE NOT FOUND (RENAMED)   52170002
         B     P2COMPS                 CONTINUE TO SEARCH TABLE         52200002
         EJECT                                                          52230002
*********************************************************************** 52260002
*                                                                     * 52290002
*              THIS ROUTINE OBTAINS THE NEXT MODULE NAME              * 52320002
*              FROM THE SELECT CARD AND MOVES IT TO THE               * 52350002
*              SELECT BUFFER AND THE MODULE NAME BUFFER.              * 52380002
*                                                                     * 52410002
*********************************************************************** 52440002
         SPACE                                                          52470002
P2STORP  MVI   0(R9),C'('              PUT PARENTHESIS IN SELECT BUFFER 52500002
         LA    R9,1(R9)                POINT TO NEXT POSITION IN BUFFER 52530002
P2STOR   MVC   0(1,R9),0(R3)           MOVE ONE LETTER TO SELECT BUFFER 52560002
         MVC   0(1,R5),0(R3)           PUT LETTER IN MODULE NAME BUFFER 52590002
         LA    R3,1(R3)                                                 52620002
         LA    R9,1(R9)                                                 52650002
         LA    R5,1(R5)                                                 52680002
         CLI   0(R3),C','              REACHED END OF OLD MODULE NAME   52710002
         BE    P2STOREX                YES - RETURN TO CALLER           52740002
         CLI   0(R3),C')'              IS THIS END OF THE MODULE NAME   52770002
         BE    P2STOREX                YES - RETURN TO CALLER           52800002
         CLC   0(1,R3),BLANKSW         IS THIS EQUAL TO BLANKSW         52830002
         BNE   P2STOR                  NO - CONTINUE TO MOVE NAME       52860002
P2STOREX BR    R2                      RETURN TO CALLER                 52890002
         EJECT                                                          52920002
*********************************************************************** 52950002
*                                                                     * 52980002
*              PREPARE TO CONTINUE SEARCH OF SELECT CARD              * 53010002
*                                                                     * 53040002
*********************************************************************** 53070002
         SPACE                                                          53100002
P2NOTFN  CLI   0(R3),COMMA1            ANY MORE NAMES ON CARD    S21995 53130002
         BNE   P2READ                  NO - READ NEXT CARD              53160002
         LA    R3,1(R3)                POINT TO NEXT NAME               53190002
         B     P2MODINI                CONTINUE SEARCH OF SELECT CARD   53220002
P2NOTFS  LA    R3,1(R3)                POINT PASSED COMMA BETWEEN NAMES 53250002
         CLI   0(R3),PARNRITE          REACHED END OF RENAME     S21995 53280002
         BNE   P2NOTFS                 NO -CONTINUE TO SCAN             53310002
         LA    R3,1(R3)                YES-SKIP RIGHT PARENTHESIS       53340002
         B     P2NOTFN                 CHECK FOR MORE NAMES ON CARD     53370002
         EJECT                                                          53400002
*********************************************************************** 53430002
*                                                                     * 53460002
*              MATCH FOUND FOR MODULE NOT RENAMED                     * 53490002
*               - BUILD SELECT CARD WITH REPLACE OPTION (GENERATE)    * 53520002
*               - SPOOL OBJ AND PERFORM LINK EDIT (APPLICATION)       * 53550002
*                                                                     * 53580002
*********************************************************************** 53610002
         SPACE                                                          53640002
P2FOUNDN EQU   *                                                        53670002
         TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   53700002
         BNO   P2FOUNDC                NO-SEE IF JCL SHOULD BE WRITTEN  53730002
         ST    RA,SSISAVE              SAVE POINTER TO NAME       M4000 53760002
*                                      IN ORDER TO FIND SSI             53790002
         ST    RA,SELNAME              SAVE POINTER TO NAME IN          53820002
*                                      ORDER TO BUILD NAME CARD   M4000 53850002
         LA    R1,BRPRMLST             GET ADDRESS OF PARAMETER LIST    53880002
         OI    BRPRMLST,SPOOLS         INDICATE OBJ TO BE SPOOLED M4000 53910002
         L     R15,PTF01               GET ADDRESS OF AMAPTF01          53940002
         BALR  R14,R15                 AMAPTF01(TO SPOOL AND LINK EDIT) 53970002
P2FOUNDC BAL   R2,P2COPY               SEE IF JCL SHOULD BE WRITTEN     54000002
         MVI   0(R9),C','              PUT COMMA AFTER MODULE NAME      54030002
         MVC   1(4,R9),COMMAR          IEBCOPY REPLACE OPTION    S21995 54060002
P2FOUND  BAL   R2,P2WRTE               WRITE CONSTRUCTED SELECT CARD    54090002
         B     P2NOTFN                 CHECK FOR MORE NAMES ON CARD     54120002
P2FOUND2 LA    R3,2(R3)                INCREMENT PAST ,R ON CARD  M6108 54150002
P2FOUND1 MVC   0(4,R9),COMMAR          IEBCOPY REPLACE OPTION    S21995 54180002
         LA    R9,4(R9)                                          S21995 54210002
         LA    R3,1(R3)                POINT TO NEXT CHARACTER   S21995 54240002
         B     P2FOUND                 WRITE CONSTRUCTED SELECT CARD    54270002
         EJECT                                                          54300002
*********************************************************************** 54330002
*                                                                     * 54360002
*              MATCH FOUND FOR MODULE WHICH IS RENAMED                * 54390002
*               - BUILD SELECT CARD WITH REPLACE OPTION (GENERATE)    * 54420002
*               - SPOOL OBJ AND PERFORM LINK EDIT (APPLICATION)       * 54450002
*                                                                     * 54480002
*********************************************************************** 54510002
P2FOUNDS TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   54540002
         BNO   P2FOWNDS                CHECK IF JCL SHOULD BE WRITTEN   54570002
         LA    R3,1(R3)                POINT TO NEW NAME          M4000 54600002
         ST    R3,SELNAME              SAVE ADDRESS OF NEW NAME   M4000 54630002
         ST    RA,SSISAVE              SAVE POINTER TO NAME TO GET SSI  54660002
         LA    R1,BRPRMLST             GET ADDRESS OF PARAMETER LIST    54690002
         OI    BRPRMLST,SPOOLS         INDICATE OBJ TO BE SPOOLED       54720002
         L     R15,PTF01               GET ADDRESS OF AMAPTF01          54750002
         BALR  R14,R15                 AMAPTF01(TO SPOOL AND LINK EDIT) 54780002
         B     P2FCOMP                 CONTINUE PROCESSING              54810002
P2FOWNDS BAL   R2,P2COPY               COPY JCL IF NEEDED               54840002
P2FCOMP  EQU   *                                                        54870002
         CLI   0(R3),C')'              REACHED END OF RENAME PAIR       54900002
         BE    P2FOUND1                YES - BUILD REPLACE OPTION       54930002
         CLC   0(2,R3),COMMAR          IS REPLACE OPTION ON CARD  M6108 54960002
         BE    P2FOUND2                YES - BUILD REPLACE OPTION M6108 54990002
         MVC   0(1,R9),0(R3)           MOVE NEW NAME TO SELECT BUFFER   55020002
         LA    R3,1(R3)                                                 55050002
         LA    R9,1(R9)                                                 55080002
         B     P2FCOMP                 CONTINUE TO MOVE NEW NAME        55110002
         EJECT                                                          55140002
*********************************************************************** 55170002
*                                                                     * 55200002
*              PART 2 WRITE ROUTINE                                   * 55230002
*               - WRITE RECORDS ONLY FOR GENERATE FUNCTION            * 55260002
*               - SET COPY SWITCH (R6 TO 4)                           * 55290002
*                                                                     * 55320002
*********************************************************************** 55350002
         SPACE                                                          55380002
P2WRTE   MVI   8(RA),C'X'              INDICATE MATCH            S21995 55410002
         TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   55440002
         BO    BMPCTR                  YES - DO NOT DO THE WRITE        55470002
         STM   R2,R3,RITESAVE                                           55500002
         LA    R3,P2OUT                GET ADDRESS OF SELECT BUFFER     55530002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              55560002
         LM    R2,R3,RITESAVE                                           55590002
BMPCTR   LA    R6,4                    SET COPY SWITCH (R6 TO 4) S21995 55620002
         BR    R2                      RETURN TO CALLER                 55650002
         SPACE                                                          55680002
*********************************************************************** 55710002
*                                                                     * 55740002
*              PART 2 JCL WRITE ROUTINE                               * 55770002
*                                                                     * 55800002
*********************************************************************** 55830002
         SPACE                                                          55860002
P2COPY   B     JCLCOPY2(R8)            IS JCL COPIED SWITCH SET         55890002
JCLCOPY2 B     P2CJCL                  NO - WRITE JCL                   55920002
         B     COPYCD1(R6)             YES - IS COPY SWITCH SET         55950002
COPYCD1  B     P2RB                    NO - WRITE COPY CARD             55980002
         BR    R2                      RETURN TO CALLER                 56010002
P2COPYEX EQU   *                                                        56040002
         NI    DUPCOPY,X'00'           CLEAR IDENTICAL COPY CARD SW     56070002
         BR    R2                      RETURN TO CALLER                 56100002
P2CJCL   EQU   *                                                        56130002
         LA    R8,4                    SET JCL COPIED SWITCH     S21995 56160002
         MVC   INCSTORE(80),PCHAREA    SAVE MATCHED SELECT STATEMENT    56190002
         BAL   R14,POINTRTN            POINT TO JCL FOR THIS STEP       56220002
P2CJCL1  BAL   R14,READPCH             READ A RECORD                    56250002
         CLC   PCHAREA(2),SLASHES      IS THIS A JCL CARD               56280002
         BNE   P2RF                    NO - CHECK IF COPY OR SELECT     56310002
         ST    R2,R2SAV                                                 56340002
         ST    R3,R3SAVE1                                               56370002
         SPACE                                                          56400002
*********************************************************************** 56430002
*                                                                     * 56460002
*              CHECK IF MEF CONVERSION IS NECESSARY                   * 56490002
*                                                                     * 56520002
*********************************************************************** 56550002
         SPACE                                                          56580002
         LA    R2,PCHAREA+63           LAST COLUMN OF SCAN              56610002
         LA    R3,PCHAREA              GET PCHF INPUT BUFFER ADDRESS    56640002
JCLCHECK CLI   4(R3),C'.'              REACHED DSNAME QUALIFIER         56670002
         BE    DSNCHECK                YES-CHECK IF QUALIFIER IS 'SYS1' 56700002
         LA    R3,1(R3)                POINT TO NEXT COLUMN ON CARD     56730002
         CR    R3,R2                   REACHED COLUMN 63                56760002
         BNH   JCLCHECK                NO-CONTINUE SCAN FOR QUALIFIER . 56790002
DOWRITE  TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   56820002
         BO    R23REST                 YES - DO NOT DO THE WRITE  M4001 56850002
         STM   R2,R3,RITESAVE                                           56880002
         LA    R3,PCHAREA              GET ADDRESS OF PCHF INPUT BUFFER 56910002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              56940002
R23REST  L     R3,R3SAVE1                                         M4001 56970002
         L     R2,R2SAV                                                 57000002
         TM    MEFSW,X'80'             MEF CONTINUATION TO BE COPIED    57030002
         BNO   P2CJCL1                 NO-CONTINUE WRITING IEBCOPY JCL  57060002
         STM   R2,R3,RITESAVE                                           57090002
         LA    R3,MEFBUFF              GET ADDRESS OF MEF BUFFER        57120002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              57150002
         LM    R2,R3,RITESAVE                                           57180002
         NI    MEFSW,X'00'             TURN OFF MEF SW                  57210002
         B     P2CJCL1                 CONTINUE WRITING IEBCOPY JCL     57240002
DSNCHECK CLC   0(5,R3),SYS1            IS THE QUALIFIER 'SYS1.'         57270002
         BE    DOWRITE                 YES-WRITE CARD (NO MEF)          57300002
         LA    R3,3(R3)                POINT TO '.' IN QUALIFIER        57330002
         BAL   R2,SYSGMEF              GO RESTRUCTURE DD CARD FOR MEF   57360002
         B     DOWRITE                 WRITE CARD AND MEF CONTINUATION  57390002
         EJECT                                                          57420002
*********************************************************************** 57450002
*                                                                     * 57480002
*              READ FORWARD TILL SAVED COPY CARD IS REACHED.          * 57510002
*              THIS IS TO IGNORE PREVIOUSLY ANALYZED CONTROL          * 57540002
*              CARDS AND GET TO THE COPY CARD FOR WHICH THERE         * 57570002
*              IS A MATCH.                                            * 57600002
*                                                                     * 57630002
*********************************************************************** 57660002
         SPACE                                                          57690002
P2RF     CLC   PCHAREA,NAMESTOR        IS THIS SAVED COPY STATEMENT     57720002
         BE    P2CCOPY                 YES - WRITE COPY CARD            57750002
         CLC   PCHAREA,INCSTORE        IS THIS MATCHED SELECT STATEMENT 57780002
         BE    P2COPYEX                YES-GO TO COPY EXIT              57810002
         B     P2CJCL1                 NO-READ NEXT RECORD              57840002
         SPACE                                                          57870002
*********************************************************************** 57900002
*                                                                     * 57930002
*              SAVE MATCHED SELECT IN ORDER TO                        * 57960002
*              FIND PROPER COPY CARD AND SKIP                         * 57990002
*              INTERVENING SELECT CARDS.                              * 58020002
*                                                                     * 58050002
*********************************************************************** 58080002
         SPACE                                                          58110002
P2RB     MVC   INCSTORE(80),PCHAREA    SAVE MATCHED SELECT CARD         58140002
         BAL   R14,POINTRTN            DO A POINT                       58170002
         B     P2CJCL1                 CHECK FOR COPY CARD              58200002
         EJECT                                                          58230002
*********************************************************************** 58260002
*                                                                     * 58290002
*              OUTPUT COPY CARD IF NEEDED (GENERATE)                  * 58320002
*                                                                     * 58350002
*********************************************************************** 58380002
         SPACE                                                          58410002
*                                                                       58440002
P2CCOPY  EQU   *                                                        58470002
         TM    DUPCOPY,X'80'           IDENTICAL COPY CARD SWITCH SET   58500002
         BO    P2CJCL1                 YES-CHECK FOR SELECT CARD        58530002
         OI    DUPCOPY,X'80'           SET IDENTICAL COPY CARD SWITCH   58560002
         TM    PARM,X'80'              APPLICATION FUNCTION REQUESTED   58590002
         BO    P2CJCL1                 YES - DO NOT DO THE WRITE        58620002
         STM   R2,R3,RITESAVE                                           58650002
         LA    R3,PCHAREA              GET ADDRESS OF PCHF INPUT BUFFER 58680002
         BAL   R2,AMAWRITE             GO TO WRITE ROUTINE              58710002
         LM    R2,R3,RITESAVE                                           58740002
         B     P2CJCL1                 READ NEXT RECORD                 58770002
         SPACE                                                          58800002
*********************************************************************** 58830002
*                                                                     * 58860002
*              POSITION OF COPY CARD IS NOTED IF JCL                  * 58890002
*              HAS BEEN COPIED. THIS ALLOWS IT TO BE                  * 58920002
*              FOUND WITHOUT SEARCHING THROUGH THE                    * 58950002
*              PRECEDING CONTROL STATEMENTS. IF THE                   * 58980002
*              JCL HAS NOT BEEN COPIED, THE COPY CARD                 * 59010002
*              IS SAVED AND THE COPY SWITCH IS TURNED                 * 59040002
*              OFF (R6 SET TO 0).                                     * 59070002
*                                                                     * 59100002
*********************************************************************** 59130002
         SPACE                                                          59160002
P2COPYRT B     JCLCOPY3(R8)            IS THE JCL COPIED SWITCH SET     59190002
JCLCOPY3 B     P2STCOPY                NO - COPY JCL                    59220002
         BAL   R14,NOTERTN             YES - NOTE POSITION OF COPY CARD 59250002
P2STCOPY MVC   NAMESTOR(80),PCHAREA    SAVE COPY CARD                   59280002
         LA    R6,0                    RESET COPY SWITCH         S21995 59310002
         B     P2READ                  READ NEXT RECORD                 59340002
         EJECT                                                          59370002
*********************************************************************** 59420002
*                                                                     * 59470002
*        PART III - ASSEMBLER ROUTINE                                 * 59520002
*                                                                     * 59570002
*                                                                     * 59620002
*********************************************************************** 59670002
         SPACE 1                                                 A40797 59720002
ASMRTN   BAL   R14,NOTERTN             YES - NOTE POSITION OF    A40797 59770002
*                                      ASSEMBLY EXEC CARD        A40797 59820002
ASMCHK   OI    ASMSW,ASMMOD            INDICATE ASSEMBLY SEARCH  A40797 59870002
         B     CHKPARMS                CHECK PARAMETERS          A40797 59920002
         SPACE 1                                                 A40797 59930002
ASMCHK1  L     RA,MODTBL               POINT TO MODULE           A40797 59940002
ASMCMPM  CLC   0(8,RA),SYSLNAME        CHECK MODULE NAME MATCH   A40797 59950002
         BE    ASMFOUND                BR IF SO                  A40797 59960002
         LA    RA,10(RA)               MOVE TO NEXT MODULE ENTRY A40797 59962002
         CLI   0(RA),SPACE             Q. END OF TABLE           A40797 59964002
         BE    PGMRTN1                 YES. NO MATCH             A40797 59966002
         B     ASMCMPM                 CHECK NEXT ENTRY          A40797 59968002
         SPACE 1                                                 A40797 59968402
ASMFOUND MVI   8(RA),LETTERA           MARK ASSEMBLY MATCH       A40797 59968802
         OI    ASMSW,ASMPCH            SET ASSEM SW TO PUNCH JCL A40797 59969202
         B     RBJCL                   GO PUNCH ASSEMBLY JCL     A40797 59969602
         SPACE 1                                                 A40797 59969702
JCLCOPY4 CLC   PCHAREA(2),ENDCARD      IS THIS A /* CARD         A40797 59969802
         BE    PGMRTN1                 RESUME MAIN SEARCH        A40797 59979902
         TM    CONTSW1,EXECCONT       EXEC CONTINUATION EXPECTED Y01036 59989902
         BO    JCLREAD                 YES - BRANCH TO READ IT   Y01036 59999902
         B     JCLCOPY5                NO - USE OTHER READ       Y01036 60049902
         EJECT                                                          60099902
*********************************************************************** 60450002
*                                                                     * 60480002
*        END OF JOB ROUTINE                                           * 60510002
*              CHECK MODULE TABLE FOR MODULES THAT DID                * 60540002
*              NOT FIND ANY MATCH AND PRINT THEM                      * 60570002
*                                                                     * 60600002
*********************************************************************** 60630002
         SPACE                                                          60660002
EOJRTN   L     RA,MODTBL               OBTAIN ADDR OF MODULE NAME TABLE 60690002
         LA    R4,0                    MESSAGE HEAD NOT WRITTEN  S21995 60720002
EOJMLOOP CLI   0(RA),SPACE             END OF MODULE NAME TABLE  S21995 60750002
         BE    FILCLOSE                YES - CLOSE ALL FILES AND EXIT   60780002
         CLI   8(RA),LETTERA           CHECK IF ONLY FOUND ASMB  A40797 60790002
         BE    ASMSG                   THATS ALL - WRITE MESSAGE A40797 60800002
         CLI   8(RA),LETTERX           MATCH FOR THIS NAME       S21995 60810002
         BNE   MSGNOMOD                NO - WRITE MODULE NAME           60840002
INCREASE LA    RA,10(RA)               POINT TO NEXT NAME        S21016 60870002
         B     EOJMLOOP                CONTINUE SEARCH FOR NON-MATCHES  60900002
         SPACE                                                          60930002
*********************************************************************** 60960002
*                                                                     * 60990002
*              CLOSE ALL FILES AND RETURN TO SYSTEM                   * 61020002
*                                                                     * 61050002
*********************************************************************** 61080002
         SPACE                                                          61110002
RET16    MVI   RETCDE,RETCDE16         SET UP RETURN CODE 16     A48711 61140002
FILCLOSE  EQU   *                                               SA55373 61142002
         L     R15,BUFFADDR        ADDR OF INPUT BUFFER TO FREE SA55373 61150002
         LTR   R15,R15             IS THE ADDR ZERO?            SA55373 61160002
         BZ    FILCLOS             YES,DON'T TRY TO FREE CORE   SA55373 61162002
         LA    RA,PCHFDCB          ADDR OF INPUT DCB FOR LENGTH SA55373 61164002
         LH    R0,DCBBLKSI      INPUT BUFFER LNG USED IN GETMAIN A55373 61166002
         FREEMAIN R,LV=(0),A=BUFFADDR FREE READ BUFFERS         SA55373 61168002
FILCLOS  CLOSE (MODFDCB,,PCHFDCB,,OUTFDCB,,MSGDCB)              SA55373 61170002
         TM    PARM,X'80'              APPLICATION FUNC REQUEST  S21995 61180002
         BNO   FREETBLS                NO - RETURN TO SYSTEM    SA55373 61190002
         L     R1,MODTBL               MODULE NAME TABLE ADDRESS S21995 61200002
         CLI   0(R1),X'FF'             TABLE EMPTY SWITCH SET    S21995 61230002
         BE    DELETMOD                YES-RETURN TO SYSTEM     SA55373 61260002
         MVI   BRPRMLST,CLSEDCBS       DCBS TO BE CLOSED        YA01764 61350002
         LA    R1,BRPRMLST             ADDR OF PARAMETER LIST    S21995 61380002
         L     R15,PTF01               GET ADDRESS OF AMAPTF01   S21995 61410002
         BALR  R14,R15                 AMAPTF01 (CLOSE DCBS)     S21995 61440002
DELETMOD EQU   *                   DELETE APPL FUNC MODULES     SA55373 61450002
         DELETE EPLOC=LOAD01       DELETE IMAPTF01              SA55373 61460002
         DELETE EPLOC=LOAD02       DELETE IMAPTF02              SA55373 61462002
         DELETE EPLOC=LOADOVR      DELETE IEWSZOVR              SA55373 61464002
FREETBLS EQU   *                   FREE THE WORK TABLES         SA55373 61466002
         L     R15,OVTABADR        ADDRESS OF OVERLAY TABLE     SA55373 61468002
         LTR   R15,R15             IS THERE CORE FOR TABLES?    SA55373 61468402
         BZ    RET                 NO,GO RETURN TO CALLER       SA55373 61468802
         FREEMAIN E,LV=26800,A=OVTABADR                         SA55373 61469202
         L    R15,MODTBL          STARTING ADDR OF MODULE TABLE SA55373 61469302
         SH   R15,TWO             CALC ADDR OF THE CORE TO FREE SA55373 61469502
         ST   R15,MODTBL          STORE ADDRESS FOR FREEMAIN    SA55373 61477102
         FREEMAIN E,LV=3624,A=MODTBL FREE MODULE TABLE          SA55373 61484802
         SPACE                                                          61492402
*********************************************************************** 61500002
*                                                                     * 61530002
*              STANDARD RETURN CONVENTION                             * 61560002
*                                                                     * 61590002
*********************************************************************** 61620002
         SPACE                                                          61650002
RET      L     R13,4(R13)              PTR TO CALLER SAVE AREA   S21995 61680002
         L     R14,12(R13)             RESTORE CALLER REG 13     A48711 61710002
         SR    R15,R15                 ZERO REGISTER 15          A48711 61740002
         IC    R15,RETCDE              INSERT RETURN CODE        A48711 61770002
         LM    R0,R12,20(R13)          RESTORE REGS 0 TO 12      A48711 61800002
         MVI   12(R13),X'FF'                                     S21995 61830002
         BR    R14                     RETURN VIA REGISTER 14    S21995 61860002
         EJECT                                                          61890002
*********************************************************************** 61920002
*                                                                     * 61950002
*              THIS CODE IS ENTERED WHEN AN I/O ERROR OCCURS          * 61980002
*                                                                     * 62010002
*********************************************************************** 62040002
         SPACE                                                          62070002
SYNADEXT SYNADAF ACSMETH=BSAM                                    S21995 62100002
         MVC   MSGBUFF+41(78),42(R1)   MOVE SYNAD MSG TO BUFFER  S21995 62130002
         MVC   MSGBUFF(40),MSGAREA4    MOVE MESSAGE ID TO BUFFER S21995 62160002
         OI    PRINTSW,X'80'           SET SYNAD SWITCH          S21995 62190002
         B     WRTPRINT                WRITE MESSAGE             S21995 62220002
SYNADRLS SYNADRLS                      RELEASE SYNAD BUFFER      S21995 62250002
         B      RET16                  PERMANENT I/O ERROR       A48711 62280002
         EJECT                                                          62310002
*********************************************************************** 62340002
*                                                                     * 62370002
*              THIS SECTION OF CODE BUILDS THE VARIOUS MESSAGES       * 62400002
*              REFLECTIONG DIFFERENT ERROR CONDITIONS.                * 62430002
*                                                                     * 62460002
*********************************************************************** 62490002
         SPACE                                                          62520002
NOBLKSZ  MVC   MSGBUFF(67),AMA009I     MOVE AMA009I TO BUFFER    S21995 62550002
         B     WRTPRINT                WRITE MESSAGE AND EXIT    S21995 62580002
*********************************************************************** 62610002
MESSAGE  EQU   *                                                        62640002
         MVI   SWITCH1,X'80'           MODULE NAME TBL OVERFLOW  S21995 62670002
READMOD1 GET   MODFDCB,MODAREA         FLUSH MODF INPUT          S21995 62700002
         B     READMOD1                FLUSH REMAINING INPUT     S21995 62730002
MESSAGE1 MVC   MSGBUFF(78),MSGAREA3    MSG AMA001I TO BUFFER     S21995 62760002
         B     WRTPRINT                WRITE MESSAGE AND RETURN  S21995 62790002
*********************************************************************** 62820002
MODFRITE MVC   MSGAREA+40(4),MODFDD    MOVE 'MODF' DDNAME        S21995 62850002
         B     MESSAGE2                WRITE MESSAGE AMA002I     S21995 62880002
PCHFRITE MVC   MSGAREA+40(4),PCHFDD    MOVE 'PCHF' DDNAME        S21995 62910002
         B     MESSAGE2                WRITE MESSAGE AMA002I     S21995 62940002
OUTFRITE MVC   MSGAREA+40(4),OUTFDD    MOVE 'OUTF' DDNAME        S21995 62970002
         B     MESSAGE2                WRITE MESSAGE AMA002I     S21995 63000002
MSGWRITE EQU   *                                                 S21995 63030002
         LA    R1,WTOPROG              SET UP WTO PARAMETER LIST S21995 63060002
         WTO   MF=(E,(1))              ISSUE WTO FOR 'PRINT' DD  S21995 63090002
         B     RET16                   CLOSE ALL FILES AND EXIT  A48711 63120002
WTOPROG  WTO   'AMA002I  DATA SET ASSOCIATED WITH THE //PRINT DD CARD CX63150002
               ANNOT BE OPENED',MF=L,ROUTCDE=11,DESC=6           S21995 63180002
MESSAGE2 MVC   MSGBUFF(73),MSGAREA     MSG AMA002I TO BUFFER     S21995 63210002
         B     WRTPRINT                WRITE ERROR MESSAGE       S21995 63240002
*********************************************************************** 63270002
STG1MSG  MVC   MSGBUFF(51),MSGAREA5    MOVE MESSAGE AMA004I      S21995 63300002
         B     WRTPRINT                CLOSE DCBS AND RETURN     S21995 63330002
*********************************************************************** 63360002
AMA008WR MVC   MSGBUFF(80),MODAREA     MOVE CARD IN ERROR        S21995 63390002
         OI    PRINTSW,X'08'           SET RETURN SWITCH         S21995 63420002
         B     WRTPRINT                WRITE CARD IN ERROR       S21995 63450002
AMA0080  NI    PRINTSW,X'F7'           TURN OFF RETURN SWITCH    S21995 63480002
         MVC   MSGBUFF(43),AMA008                                S21995 63510002
         B     WRTPRINT                                          S21995 63540002
*********************************************************************** 63570002
AMA011WR MVC   MSGBUFF(61),AMA011      MOVE MESSAGE AMA011I      S21016 63600002
         B     WRTPRINT                WRITE MESSAGE AND EXIT    S21016 63630002
*********************************************************************** 63660002
AMA012WR MVC   MSGBUFF(71),AMA012      MOVE MESSAGE AMA012I      S21995 63690002
         MVC   MSGBUFF+49(8),LMODETC   MOVE MODULE NAME TO BUFF  S21995 63720002
         B     WRTPRINT                WRITE ERROR MESSAGE       A45397 63750002
AMA014W1 SR    R15,R15             PREPARE TO ZERO INPUT POINTER A55373 63760002
         ST    R15,BUFFADDR       GETMAIN NOT GOOD,ZERO PTR     SA55373 63770002
AMA014W  MVC   MSGBUFF(69),AMA014I     MOVE MESSAGE AMA014I     SA55373 63780002
         SPACE                                                          63810002
*********************************************************************** 63840002
*                                                                     * 63870002
*              MESSAGE OUTPUT ROUTINE                                 * 63900002
*                                                                     * 63930002
*********************************************************************** 63960002
         SPACE                                                          63990002
WRTPRINT WRITE MSGDECB4,SF,MSGDCB,MSGBUFF                        S21995 64020002
         CHECK MSGDECB4                                          S21995 64050002
         MVC   MSGBUFF(121),MSGBUFF-1  BLANK MESSAGE BUFFER      S21995 64080002
         TM    PRINTSW,X'08'           RETURN SWITCH SET         S21995 64110002
         BO    AMA0080                 YES - RETURN TO AMA0080   S21995 64140002
         TM    PRINTSW,X'80'           SYNAD SWITCH SET          S21995 64170002
         BO    SYNADRLS                YES - RETURN TO SYNADRLS  S21995 64200002
         B     RET16                   CLOSE FILES AND EXIT      A48711 64230002
*********************************************************************** 64260002
ASMSG    CLI   RETCDE,RETCDE4          RETURN CODE MORE THAN 4   A40797 64270002
         BH    RETANOCG                YES - DO NOT CHANGE       A40797 64280002
         MVI   RETCDE,RETCDE4          SET RETURN CODE 4         A40797 64282002
RETANOCG MVC   MSGBUFF(58),AMA015I     MOVE IN MSG SKELETON      A40797 64284002
         SR    R4,R4                   RESET HEADER WRITTEN SW   A40797 64286002
         B     MSGRTNC                 GO FILL IN AND WRITE MSG  A40797 64288002
MSGNOMOD B     MODWRITE(R4)            HAS MESSAGE HEAD BEEN WRITTEN    64290002
MODWRITE B     MSGHEAD                 NO-WRITE MESSAGE HEAD AMA000I    64320002
MSGRTNC  MVC   MSGBUFF+15(8),0(RA)     MODULE NAME TO BUFFER     S21995 64350002
         WRITE MSGDECB2,SF,MSGDCB,MSGBUFF WRITE MODULE NAME      S21995 64380002
         CHECK MSGDECB2                                          S21995 64410002
         B     INCREASE                SEARCH FOR NON-MATCHES    S21995 64440002
MSGHEAD  MVC   MSGBUFF(58),MSGAREA1    MOVE MESSAGE TO BUFFER    A40797 64470002
         CLI   RETCDE,RETCDE4          RETURN CODE MORE THAN 4   A48711 64500002
         BH    RETNOCHG                YES - DO NOT CHANGE       A48711 64530002
         MVI   RETCDE,RETCDE4          SET RETURN CODE 4         A48711 64560002
RETNOCHG WRITE MSGDECB1,SF,MSGDCB,MSGBUFF WRITE MESSAGE AMA000I  A48711 64590002
         CHECK MSGDECB1                                                 64620002
         MVC   MSGBUFF(121),MSGBUFF-1  BLANK MESSAGE BUFFER      S21995 64650002
         LA    R4,4                    INDICATE MESSAGE WRITTEN  S21995 64680002
         B     MSGRTNC                 WRITE MODULE NAME                64710002
         EJECT                                                          64740002
*********************************************************************** 64770002
*                                                                     * 64800002
*              THIS ROUTINE SEARCHES THE STAGE 1 OUTPUT TAPE.         * 64830002
*              IT GOES TO THE PROPER ROUTINE AS DETERMINED            * 64860002
*              BY THE EXEC CARD FOUND.                                * 64890002
*                                                                     * 64920002
*********************************************************************** 64950002
         SPACE                                                          64980002
PGMRTN1  NI    ASMSW,TURNOFF           CLEAR ASSEMBLY SWITCH     A40797 64990002
         MVC   SYSLNAME(8),BLANK       SET BUFFER TO BLANKS      A40797 65000002
         LA    R9,PGMRTN               RESET R9 FOR SEARCH       A40797 65002002
         SPACE                                                          65004002
PGMRTN   BAL   R14,READPCH             READ RECORD(STAGE I TAPE) S21995 65010002
         LA    R3,PCHAREA              OBTAIN BUFFER ADDRESS     S21995 65040002
         CLC   0(2,R3),SLASHES         IS THIS A JCL STATEMENT   S21995 65070002
         BCR   7,R9                    NO-RETURN TO NON JCL ADDR S21995 65100002
         BAL   R2,CHKSPACE             POINT TO FIRST OPERAND    S21995 65130002
         CLC   0(4,R3),EXECCARD        IS THIS AN EXEC STATEMENT S21995 65160002
         BNE   PGMRTN                  NO  - READ NEXT RECORD    S21995 65190002
         BAL   R2,CHKSPACE             POINT TO NEXT OPERAND     S21995 65220002
         CLC   0(11,R3),IEBCOPY        IS THIS PGM=IEBCOPY       S21995 65250002
         BE    PART2                   YES - GO TO PART2         S21995 65280002
         CLC   0(5,R3),LINKSPRC        IS THIS LINKS PROCEDURE   Y01036 65370002
         BE    EXECRTN                 YES - GO TO PART1         S21995 65400002
         CLC   0(11,R3),IEHMOVE        IEHMOVE STEP              S21995 65430002
         BE    STG1MSG                 YES - INVALID TAPE - MSG  S21995 65460002
         TM    PARM,APPLFUNC           APPLICATION FUNC REQUEST  A40797 65470002
         BO    PGMRTN                  YES - READ NEXT CARD      A40797 65482002
         CLC   0(4,R3),ASMSPROC        IS THIS ASMS PROCEDURE    Y01036 65484002
         BE    ASMRTN                  YES - GO TO PART III      A40797 65486002
         B     PGMRTN                  READ NEXT RECORD          S21995 65490002
         EJECT                                                          65520002
*********************************************************************** 65550002
*                                                                     * 65580002
*       SUBROUTINE TO FIND NEXT OPERAND ON CARDS                      * 65610002
*                                                                     * 65640002
*********************************************************************** 65670002
         SPACE                                                          65700002
CHKSPACE CLI   0(R3),SPACE              CHARACTER A BLANK        S21995 65730002
         BE    CHKNOTSP                 YES - SKIP TO NON-BLANK  S21995 65760002
         LA    R3,1(R3)                                          S21995 65790002
         B     CHKSPACE                 SKIP NON-BLANKS          S21995 65820002
CHKNOTSP LA    R3,1(R3)                                          S21995 65850002
         CLI   0(R3),SPACE              CHARACTER A BLANK        S21995 65880002
         BE    CHKNOTSP                 YES - SKIP BLANKS        S21995 65910002
         BR    R2                       NO - RETURN TO CALLER    S21995 65940002
         EJECT                                                          65970002
*********************************************************************** 66000002
*                                                                     * 66030002
*              THIS ROUTINE HANDLE SYSGEN WITH THE                    * 66060002
*              MULTI-PROGRAMMING ENVIRONMENT FEATURE.                 * 66090002
*              IT IS USED TO RESTRUCTURE DD CARDS SO AS               * 66120002
*              TO MAKE THE FIRST LEVEL QUALIFIER OF EACH              * 66150002
*              DSNAME 'SYS1.'.                                        * 66180002
*                                                                     * 66210002
*********************************************************************** 66240002
         SPACE                                                          66270002
SYSGMEF  EQU   *                                                        66300002
         TM    PARM,X'80'              APPLICATION FUNC REQUEST  S21995 66330002
         BCR   1,R2                    YES-DO NOT MODIFY DD CARD S21995 66360002
         ST    R2,R2SAV2                                                66390002
         ST    R4,R4SAVE                                                66420002
         ST    R9,R9SAVE                                                66450002
         CLC   0(5,R3),SYS1            IS THE QUALIFIER 'SYS1.'         66480002
         BCR   8,R2                    YES-RETURN TO CALLER             66510002
         MVI   MEFBUFF,C' '                                             66540002
         MVC   MEFBUFF+1(79),MEFBUFF   CLEAR THE MEF BUFFER             66570002
         MVC   MEFBUFF(2),SLASHES      MOVE '//' INTO BUFFER            66600002
         MVC   MEFBUFF+15(4),CHARDSN   MOVE 'DSN=' INTO BUFFER          66630002
         MVC   MEFBUFF+19(5),SYS1      MOVE 'SYS1.' INTO BUFFER         66660002
         LA    R9,MEFBUFF+24           POINT TO DSNAME POSITION (MEF)   66690002
PERLOOP  EQU   *                                                        66720002
         LA    R3,1(R3)                POINT TO DSNAME ON CARD          66750002
         CLI   0(R3),C'.'              HAS PERIOD BEEN FOUND            66780002
         BNE   PERLOOP                 NO - CONTINUE SEARCH FOR PERIOD  66810002
         LA    R3,1(R3)                YES-POINT ONE CHAR BEYOND PERIOD 66840002
MOVEDSN  EQU   *                                                        66870002
         MVC   0(1,R9),0(R3)           MOVE DSNAME TO MEF BUFFER        66900002
         LA    R9,1(R9)                                                 66930002
         LA    R3,1(R3)                                                 66960002
         CLI   0(R3),C','              REACHED END OF DSNAME OPERAND    66990002
         BE    CHKCONT                 YES-DSNAME MOVE IS COMPLETE      67020002
         CLI   0(R3),C' '              IS NEXT CHAR A BLANK             67050002
         BNE   MOVEDSN                 NO - FINISH MOVING DSNAME        67080002
CHKCONT  EQU   *                                                        67110002
         MVC   TEMPBUFF(72),PCHAREA    PLACE CARD IN TEMPORARY BUFFER   67140002
         MVI   PCHAREA,C' '                                             67170002
         MVC   PCHAREA+1(71),PCHAREA   CLEAR CARD BUFFER                67200002
         LA    R3,TEMPBUFF                                              67230002
         LA    R4,PCHAREA                                               67260002
DSNCHK   EQU   *                                                        67290002
         CLC   0(3,R3),CHARDSN         FOUND DSNAME KEYWORD             67320002
         BE    SKIPDSN                 YES - SKIP DSNAME                67350002
         MVC   0(1,R4),0(R3)           NO-MOVE BACK TO CARD             67380002
         LA    R3,1(R3)                                                 67410002
         LA    R4,1(R4)                                                 67440002
         B     DSNCHK                  CONTINUE TO MOVE LETTERS BACK    67470002
SKIPDSN  EQU   *                                                        67500002
         BCTR  R3,0                    POINT TO BEFORE DSNAME           67530002
         CLI   0(R3),C' '              IS DSNAME FIRST ON CARD          67560002
         BNE   PASSDSN                 NO - DO NOT SET DSN FIRST SWITCH 67590002
         LA    R3,1(R3)                POINT BACK TO DSNAME             67620002
         OI    MEFSW,X'40'             INDICATE DSN FIRST ON CARD       67650002
PASSDSN  EQU   *                                                        67680002
         LA    R3,4(R3)                CYCLE PAST DSN=                  67710002
SKIPDSN1 EQU   *                                                        67740002
         CLI   0(R3),C','              REACHED END OF DSNAME OPERAND    67770002
         BE    MOVEREST                YES - MOVE REMAINDER OF CARD     67800002
         CLI   0(R3),C' '              IS THIS CHARACTER A BLANK        67830002
         BE    MOVEDONE                YES - MOVE IS COMPLETED          67860002
         LA    R3,1(R3)                                                 67890002
         B     SKIPDSN1                CONTINUE TO SKIP DSNAME OPERAND  67920002
MOVEREST EQU   *                                                        67950002
         LA    R3,1(R3)                                                 67980002
         CLI   0(R3),C' '              ANY MORE AFTER DSN               68010002
         BE    MOVECOMM                NO - DSNAME LAST ON CARD SA55374 68040002
MOVREST1 EQU   *                                                        68070002
         MVC   0(1,R4),0(R3)           MOVE REST OF DD CARD BACK TO     68100002
*                                      PCHF BUFFER                      68130002
         LA    R3,1(R3)                                                 68160002
         LA    R4,1(R4)                                                 68190002
         CLI   0(R3),C' '              FINISHED WITH MOVE OF CARD       68220002
         BNE   MOVREST1                NO - CONTINUE MOVE               68250002
         CLI   1(R3),APOSTR            APOSTROPHE AFTER BLANK    Y01036 68260002
         BE    MOVREST1                YES - CONTINUE MOVE       Y01036 68270002
         B     LOC                     YES - CHECK FOR CONTINUATION     68280002
MOVECOMM EQU   *                  MOVE IN ',' IF NEEDED         SA55374 68290002
         TM    MEFSW,X'40'        IS DSN 1ST & LAST ?           SA55374 68300002
         BNO   LOC                NO,DO NOT MOVE IN THE COMMA   SA55374 68302002
         MVI   0(R9),C','         MOVE IN CONTINUATION COMMA    SA55374 68304002
DSNCONT  EQU  *                                                         68306002
         LA    R9,MEFBUFF+14      ADDRESS OF START OF DSN IN MEF A55374 68308002
         BCTR  R4,0               DECR PTR TO PCHAREA FOR MOVE  SA55374 68308402
DSNCONT1 EQU   *                  MOVE IN DSN =                 SA55374 68308802
         LA    R9,1(R9)           POINT TO NEXT CHARACTER TO MOVE 55374 68309202
         LA    R4,1(R4)           PT TO NEXT AREA TO MOVE INTO  SA55374 68309602
         MVC   0(1,R4),0(R9)      MOVE IN NEXT CHARACTER        SA55374 68309702
         CLI   0(R9),C' '         DID WE MOVE A BLANK           SA55374 68309802
         BE    CLRSW              YES,MOVE IS COMPLETE          SA55374 68309902
         CLI   0(R9),C','         DID WE MOVE A COMMA?          SA55374 68319902
         BNE   DSNCONT1           NO,CONTINUE MOVING            SA55374 68329902
         MVI   PCHAREA+71,C'X'    MOVE IN CONTINUATION          SA55374 68333202
CLRSW    EQU   *                                                SA55374 68335202
         NI    MEFSW,X'00'             CLEAR SWITCH                     68335602
         B     LOADR2                  RETURN TO CALLER                 68336002
MOVEDONE EQU   *                                                        68336702
         TM    MEFSW,X'40'             IS DSNAME FIRST ON CARD          68340002
         BO    DSNCONT                 YES - IT'S ALSO LAST ON CARD     68370002
LOC      EQU   *                                                        68400002
         NI    MEFSW,X'00'             CLEAR SWITCH                     68430002
         BCTR  R4,0                    POINT TO LAST CHAR IN PCHAREA    68460002
         CLI   0(R4),C','              IS CONTINUATION ALREADY THERE    68490002
         BE    MOVECONT                YES - MOVE IN CONTINUATION       68520002
         LA    R4,1(R4)                                                 68550002
         MVI   0(R4),C','              MOVE COMMA TO PCHAREA FOR CONTIN 68580002
MOVECONT EQU   *                                                        68610002
         MVI   PCHAREA+71,C'X'         MOVE IN CONTINUATION CHARACTER   68640002
         BCTR  R3,0                    DECREMENT BUFFER POINTER  S21995 68670002
         CLI   0(R3),C','              CONTINUATION REQUIRED ON CARD    68700002
         BNE   MEF                     NO - RETURN               S21995 68730002
         MVI   MEFBUFF+71,C'X'         MAKE CONTINUATION ON NEW CARD    68760002
         MVI   0(R9),C','              MOVE IN COMMA FOR CONTINUATION   68790002
MEF      EQU   *                                                        68820002
         OI    MEFSW,X'80'             INDICATE MEF                     68850002
LOADR2   EQU   *                                                        68880002
         L     R2,R2SAV2                                                68910002
         L     R4,R4SAVE                                                68940002
         L     R9,R9SAVE                                                68970002
         L     R3,R3SAVE1              RESTORE R3                Y01036 68980002
         BR    R2                      RETURN TO CALLER                 69000002
         EJECT                                                          69150002
*********************************************************************** 69180002
*                                                                     * 69210002
*       THE FOLLOWING WRITE IS A COMMON WRITE FOR THE OUTF FILE       * 69240002
*                                                                     * 69270002
*********************************************************************** 69300002
         SPACE                                                          69330002
AMAWRITE WRITE  OUTFDECB,SF,OUTFDCB,(R3)                                69360002
         CHECK  OUTFDECB                                                69390002
         TM    PARM,APPLFUNC           APPLICATION FUNCTION      Y01006 69392002
         BCR   1,2                     YES - BRANCH BACK         Y01006 69394002
         MVC   MSGBUFF(80),0(R3)       MOVE TO OUTPUT BUFFER     Y01006 69400002
         WRITE MSGDECB3,SF,MSGDCB,MSGBUFF  WRITE TO MSG DATA SET Y01006 69410002
         CHECK MSGDECB3                                          Y01006 69412002
         MVC   MSGBUFF(121),MSGBUFF-1  CLEAR BUFFER              Y01006 69414002
         BR   R2                       RETURN TO THE CALLER      Y01006 69420002
         EJECT                                                          69450002
*********************************************************************** 69480002
*                                                                     * 69510002
*        READ STAGE 1 TAPE AND/OR MOVE LOGICAL RECORD INTO PCHAREA    * 69540002
*                                                                     * 69570002
*********************************************************************** 69600002
         SPACE                                                          69630002
READPCH  STM   14,12,READSTOR          SAVE THE REGISTERS               69660002
         LA    RA,PCHFDCB              GET PCHFDCB ADDRESS FOR BASE     69690002
         TM    POINTBIT,X'80'          HAS POINT JUST BEEN DONE         69720002
         BO    POINTRD                 YES - READ THE POINTED BLOCK     69750002
         SR    R2,R2                                                    69780002
         C     R2,TEMPCNT              SHOULD A NEW BLOCK BE READ       69810002
         BNE   MOVTOPCH                NO - MOVE RECORD TO PCHAREA      69840002
POINTRD  L     R3,BUFFADDR             LOAD ADDRESS OF READ BUFFER      69870002
         READ  PCHDECB,SF,PCHFDCB,(3)  READ A BLOCK                     69900002
         CHECK PCHDECB                                                  69930002
         SPACE                                                          69960002
*********************************************************************** 69990002
*       USE RESIDUAL COUNT FOR CALCULATING NO. OF LOGICAL RECS  A38341* 70020002
*       SHORT BLOCKS MAY OCCUR DUE TO CONCATENATED INPUT        A38341* 70050002
*       ALSO, RESET RECCNT TO REFLECT NO. OF LOGICAL RECS READ  A38341* 70080002
*                                                                     * 70110002
*********************************************************************** 70140002
         SPACE                                                          70170002
         L     R4,DCBIOBA              GET THE IOB ADDRESS              70200002
         LH    R7,22(R4)               LOAD RESIDUAL COUNT FROM CSW     70230002
         LH    R8,DCBLRECL             GET LRECL FOR DIVISOR            70260002
         LH    R9,DCBBLKSI             GET THE BLKSIZE                  70290002
         SR    R9,R7                   SUBTRACT RESIDUAL FROM BLKSIZE   70320002
         LR    R7,R9                   R7 = NUMBER OF BYTES IN BUFFER   70350002
         SR    R6,R6                   CLEAR DIVIDEND REG               70380002
         DR    R6,R8                   DIVIDE RESIDUAL COUNT BY LRECL   70410002
         ST    R7,RECCNT               NO. OF LOGICAL RECS READ  A38341 70440002
         TM    POINTBIT,X'80'          HAS POINT BEEN DONE       A38341 70470002
         BO    MOVTOPCH                YES- DON'T CHANGE TEMPCNT A38341 70500002
         ST    R7,TEMPCNT              INIT NO. OF RECS REMAINING       70530002
MOVTOPCH L     R5,RECCNT               GET NUMBER OF LOG RECS LAST READ 70560002
         S     R5,TEMPCNT              GET MULTIPLICATION FACTOR        70590002
         L     R4,BUFFADDR             LOAD THE BUFFER ADDRESS          70620002
         SR    R6,R6                   CLEAR REGISTERS                  70650002
         LH    R7,DCBLRECL             GET THE LOGICAL RECORD LENGTH    70680002
         MR    R6,R5                   R7 CONTAINS INDEX INTO BUFFER    70710002
         AR    R4,R7                   ADD INDEX TO START OF BUFFER     70740002
         LH    R6,DCBLRECL             LOAD THE LOGICAL RECORD LENGTH   70770002
         BCTR  R6,0                    DECREMENT BY 1 FOR THE EXECUTE   70800002
         EX    R6,MOVLRECL             MOVE THE LOGICAL REC TO PCHAREA  70830002
         L     R8,TEMPCNT              PICK UP COUNT OF REMAINING RECS  70860002
         BCTR  R8,0                    DECREMENT TEMPCNT FOR REC MOVED  70890002
         ST    R8,TEMPCNT              AND RESTORE NEW COUNT            70920002
         NI    POINTBIT,X'00'          TURN OFF POINT INDICATOR         70950002
         LM    14,12,READSTOR          RESTORE THE REGS                 70980002
         BR    R14                     RETURN TO CALLER                 71010002
         EJECT                                                          71040002
*********************************************************************** 71070002
*                                                                     * 71100002
*    THIS SUBROUTINE DOES A NOTE TO SAVE THE LAST BLOCK ADDRESS READ  * 71130002
*                                                                     * 71160002
*********************************************************************** 71190002
         SPACE                                                          71220002
NOTERTN  STM   14,12,READSTOR          SAVE ALL REGISTERS               71250002
         NOTE  PCHFDCB                 NOTE THE LAST BLOCK READ         71280002
         ST    R1,BLKADR               SAVE THE BLOCK ADDRESS FOR POINT 71310002
         L     R2,TEMPCNT              LOAD NUMBER OF RECORDS LEFT      71340002
         LA    R2,1(R2)                POINT TO RECORD JUST NOTED       71370002
         ST    R2,NOTECNT              SAVE IT FOR A LATER READ OF REC  71400002
         LM    14,12,READSTOR          RESTORE THE REGISTERS            71430002
         BR    R14                     RETURN TO THE CALLER             71460002
         SPACE                                                          71490002
*********************************************************************** 71520002
*                                                                     * 71550002
*  THIS SUBROUTINE DOES A POINT TO POSITION A BLK ADDRESS THAT WAS    * 71580002
*  RETRIEVED FROM A PREVIOUS NOTE.  THE TEMPCNT IS THEN MADE EQUAL    * 71610002
*  TO THE NOTECNT SO THAT AFTER THE NEXT READ, THE REQUIRED RECORD    * 71640002
*  FOR THE POINT WILL BE MOVED INTO PCHAREA.                          * 71670002
*                                                                     * 71700002
*********************************************************************** 71730002
         SPACE                                                          71760002
POINTRTN STM   14,12,READSTOR          SAVE ALL REGISTERS               71790002
         POINT PCHFDCB,BLKADR          POINT TO BLK FROM PREVIOUS NOTE  71820002
         L     R2,NOTECNT              MAKE THE TEMPCNT                 71850002
         ST    R2,TEMPCNT              EQUAL TO THE NOTECNT             71880002
         OI    POINTBIT,X'80'          INDICATE POINT HAS BEEN DONE     71910002
         LM    14,12,READSTOR          RESTORE THE REGISTERS            71940002
         BR    R14                     RETURN TO THE CALLER             71970002
         EJECT                                                          72000002
*********************************************************************** 72030002
*                                                                     * 72060002
*              EQUATES                                                * 72090002
*                                                                     * 72120002
*********************************************************************** 72150002
         SPACE                                                          72180002
R0       EQU   0                                                        72210002
R1       EQU   1                                                        72240002
R2       EQU   2                       BAL  CHKSPACE RTN                72270002
R3       EQU   3                       SCAN THRU INPUT                  72300002
R4       EQU   4                       CHANGE-REPLACE RTN               72330002
R5       EQU   5                       STORE CHANGE-REPLACE             72360002
R6       EQU   6                       ENTRY-ALIAS SW                   72390002
R7       EQU   7                       SCAN SYSLMOD                     72420002
R8       EQU   8                       JCL-SW                           72450002
R9       EQU   9                       SCAN THRU OUTPUT                 72480002
RA       EQU   10                      STORE MODULE NAMES               72510002
RB       EQU   11                      SCAN THRU MOD WORK               72540002
R11      EQU   11                      BASE REGISTER                    72570002
R12      EQU   12                      BASE REGISTER                    72600002
R13      EQU   13                      SAVE AREA POINTER                72630002
R14      EQU   14                                                       72660002
R15      EQU   15                                                       72690002
TURNOFF  EQU   X'00'                   TO TURN OFF FLAGS                72720002
SPOOLUT2 EQU   X'01'                   SPOOL TO WORKFILE FLAG           72750002
SPOOLI   EQU   X'02'                   SPOOL TO OUTF FLAG               72780002
LINK     EQU   X'03'                   INVOKE SERVICE PROG FLAG  Y01983 72840002
CLSEDCBS EQU   X'04'                   CLOSE DCBS FLAG           Y01983 72870002
SPOOLS   EQU   X'05'                   SPOOL OBJ FOR MOVE/COPY MODULE   72900002
*                                                                Y01983 72910002
PARMCHEK EQU   X'06'                   CHECK FOR PARAMETERS FLAG Y01983 72930002
OPENBIT  EQU   X'10'                   USED TO TEST DCB OPEN FLAG       72960002
LETTERX  EQU   C'X'                                              S21995 72990002
ABLANK   EQU   C' '                                              S21995 73020002
PARNLEFT EQU   C'('                                              S21995 73050002
LETERS   EQU   C'S'                                              S21995 73080002
LETTERN  EQU   C'N'                                              S21995 73110002
LETERC   EQU   C'C'                                              S21995 73140002
LETTERR  EQU   C'R'                                              S21995 73170002
LETTERA  EQU   C'A'                                              S21995 73200002
LETTERE  EQU   C'E'                                              S21995 73230002
PARNRITE EQU   C')'                                              S21995 73260002
COMMA1   EQU   C','                                              S21995 73290002
SPACE    EQU   C' '                                              S21995 73320002
RETCDE16 EQU   X'10'                   TO SET RETURN CODE        A48711 73350002
RETCDE4  EQU   X'04'                   TO SET RETURN CODE        A48711 73380002
EXECCONT EQU   X'80'                   EXEC CONTINUATION SWITCH  Y01036 73390002
HEX00    EQU   X'00'                                             Y01036 73400002
APPLFUNC EQU   X'80'              APPLICATION FUNCTION REQUESTED Y01036 73402002
ASMMOD   EQU   X'01'                   WORKING ON ASM SEARCH     A40797 73406002
ASMPCH   EQU   X'02'                   NOW PUNCHING ASM JCL      A40797 73408002
DSSSW    EQU   X'80'                   DSS SWITCH                Y01045 73408402
APOSTR   EQU   C''''                   APOSTROPHE                Y01036 73408802
CHRCONT  EQU   X'08'                 CHANGE-REPLACE CONTINUATION Y01983 73409202
CPYDSS   EQU   X'08'                   DSS SWITCH                Y01045 73409602
         SPACE                                                          73410002
*********************************************************************** 73440002
*                                                                     * 73470002
*              CONSTANTS AND STORAGE ALLOCATION                       * 73500002
*                                                                     * 73530002
*********************************************************************** 73560002
         SPACE                                                          73590002
POINTBIT DC    X'00'                   POINT INDICATOR                  73620002
SWITCH1  DC    X'00'                                                    73650002
TWO      DC    H'2'                    ADJUSTS ADDRESS TO FREE  SA55373 73660002
         DS    0H                                                       73680002
MOVLRECL MVC   PCHAREA(0),0(R4)        MOVE RECORD TO PCHAREA           73710002
PRINTSW  DC    X'00'                                             S21995 73740002
MEFSW    DC    X'00'                                             S21995 73770002
READSTOR DS    15F                     INTERNAL REGISTER SAVE AREA      73800002
BUFFADDR DC    F'0'                    ADDRESS OF READ BUFFER           73830002
RECCNT   DC    F'0'                    NUMBER OF LOGICAL RECORDS READ   73860002
TEMPCNT  DC    F'0'                    NUMBER OF LOG RECS REMAINING     73890002
NOTECNT  DC    F'0'                    INDEX INTO BUFFER FOR NOTED REC  73920002
TABLEND  DC    F'0'                                              S21995 73950002
IDENTEND DC    F'0'                                              S21016 73980002
OVLYEND  DC    F'0'                                              S21995 74010002
RITESAVE DS    3F                                                S21995 74070002
BLKADR   DS    F                                                        74100002
ZEROES   DC    C'00000000'                                        M4757 74130002
DSNPNTR  DS    F                                                        74160002
TEMPBUFF DS    CL80                                                     74190002
MEFBUFF  DS    CL80                                                     74220002
R9SAVE   DS    F                                                        74250002
R2SAV    DS    F                                                        74280002
R3SAV    DS    F                                                        74310002
R4SAVE   DS    F                                                        74340002
R5SAVE   DS    F                                                        74370002
R9SAV    DS    F                                                        74400002
MODSPACE DC    C' '                                                     74430002
MODAREA  DS    CL80                    MODF INPUT BUFFER                74460002
         DC    C'? '                   USED TO END BLANK INPUT   S21995 74490002
SSIAREA  DC    CL80' '                                           S21995 74520002
PCHAREA  DS    CL80                                                     74550002
BLANKS   DC    X'4040404040404040'     USED TO COMPLETE MVC FROM        74580002
*                                 SYSLMOD AREA--MUST BE AFTER PCHAREA   74610002
INCSTORE DS    CL80                                                     74640002
NAMESTOR DS    CL80                                                     74670002
OUTAREA1 DS    0CL80                                                    74700002
         DC    C'  '                                                    74730002
         DC    C'INCLUDE '                                              74760002
LIBETC   DC    C' '                                                     74790002
LIBETCB  DS    CL69                                                     74820002
OUTAREA2 DS    0CL80                                                    74850002
         DC    C'  INCLUDE  SYSLMOD('                                   74880002
LMODETC  DC    C' '                                                     74910002
LMODETCB DS    CL70                                                     74940002
P2OUT    DS    0CL80                                                    74970002
         DC    C'  SELECT '                                       M0868 75000002
P2MBR    DC    C'MEMBER=('                                        M0868 75030002
P2DATA   DS    CL63                                                     75060002
BLANKSW  DC    C' '                                                     75090002
COMMAR   DC    C',R))'                                                  75120002
SYS1     DC    C'SYS1.'                                                 75150002
MODFDD   DC    C'MODF'                                                  75180002
PCHFDD   DC    C'PCHF'                                                  75210002
OUTFDD   DC    C'OUTF'                                                  75240002
         DC    C' '                    MUST BE BEFORE MSGBUFF    S21995 75270002
MSGBUFF  DC    CL121' '                                          S21995 75300002
MSGAREA  DC    C'AMA002I  DATA SET ASSOCIATED WITH THE //         DD C' 75330002
         DC    C'ARD CANNOT BE OPENED'                           S21995 75360002
SSICARD  DC    C'SETSSI'                                         S21995 75390002
MSGAREA1 DC    C'AMA000I  THE FOLLOWING MODULE(S) DID NOT FIND A MATCH' 75420002
         DC    CL5'     '              BLANK AFTER MSG AMA015I   A40797 75430002
MSGAREA3 DC    C'AMA001I  INPUT MODULE TABLE HAS OVERFLOWED '    S21995 75450002
         DC    C'BREAK INPUT INTO TWO JOBS AND RERUN'            S21995 75480002
MSGAREA4 DC    C'AMA003I UNCORRECTABLE I/O ERROR OCCURRED'       S21995 75510002
         DS    0F                                                S21995 75540002
MSGAREA5 DC    C'AMA004I  UNIDENTIFIED FORMAT ON SYSGEN STAGE 1 TAPE'   75570002
AMA008   DC    C'AMA008I  THE PRECEDING STATEMENT IS INVALID'    S21995 75600002
AMA009I  DC    C'AMA009I  AMAPTFLE TERMINATED; NO BLOCKSIZE ON THE '    75630002
         DC    C'PCHF DD STATEMENT.'                             S21995 75660002
AMA011   DC    C'AMA011I  NUMBER OF IDENTIFY CARDS IN INPUT STREAM '    75690002
         DC    C'EXCEEDS 150'                                    S21016 75720002
AMA012   DC    C'AMA012I  OVERLAY STRUCTURE DEFINITION FOR MODULE '     75750002
         DC    C'         EXCEEDS LIMIT'                         S21995 75780002
AMA014I  DC    C'AMA014I INSUFFICIENT MAIN STORAGE FOR PROCESSING,'     75810002
         DC    C' AMAPTFLE TERMINATED'                           A45397 75840002
AMA015I  DC    CL58'AMA015I MODULE XXXXXXXX FOUND MATCH ON ASSEMBLY STEX75850002
               P ONLY.'                                          A40797 75860002
JOBCARD  DS    0CL80                                                    75870002
         DC    C'//SYSGENS JOB  1,''SYSTEM GENERATION'',MSGLEVEL=(1,1)' 75900002
         DC    C'                             '                         75930002
MODSTORE DS    CL8                                                      75960002
SLASHES  DC    C'//'                                                    75990002
BLANK    DC    C'        '                                              76020002
OVLYREC  DS    0F                                                       76050002
OVNOGO   DC    X'00'                   OVERLAY NO GO SWITCH      S21995 76080002
         DC    AL3(0)                  ADDRESS OF OVERLAY TABLE  S21995 76110002
SYSLSAVE DS    CL80                    SAVE AREA FOR "/*" OUTPUT        76140002
CONTSW1  DC    X'00'                   SYSLMOD CONTINUATION SWITCH      76170002
CONTSW2  DC    X'00'                   INDICATES AN OVERLAY/INSERT CARD 76200002
*                                      HAS A CONTINUATION/COMMENT CARD  76230002
NAMESWCH DC    X'00'                   USED TO INDICATE "NAME" WRITTEN  76260002
SLASHSW  DC    X'00'                   USED TO NOTIFY THE NAME ROUTINE  76290002
*                                      THAT IT WAS ENTERED FROM THE /*  76320002
*                                      ROUTINE AND MUST RETURN          76350002
R2SAV2   DS    F                                                        76380002
SAVE4    DS    F                                                        76410002
SAVE5    DS    F                                                        76440002
R3SAVE1  DC    F'0'                                                     76470002
R3SAV2   DC    F'0'                                              Y01036 76480002
SYSLNAME DC    C'           '          MEMBER NAME(R) AREA              76500002
R9SAVE1  DC    F'0'                                                     76530002
IEHMOVE  DC    C'PGM=IEHMOVE'                                    995200 76560002
AOVLYREC DC    F'14800'                LENGTH OF OVLYREC BUFFER  S21995 76590002
IDENTSZ  DC    F'12000'                LENGTH OF IDENTIFY TABLE  S21016 76620002
AMODTBL  DC    F'1500'                 LENGTH OF MODTBL BUFFER   S21016 76650002
ASSITBL  DC    F'1200'                 LENGTH OF SSITABLE BUFFER        76680002
IDENTBL  DC    F'0'                    IDENTIFY TABLE ADDRESS    S21016 76710002
IDENTIFY DC    C'IDENTIFY'             CHECK FOR IDENTIFY CARDS  S21016 76740002
FIRSTNEW DC    X'00'                   FIRST,NEW NAME CARD SW    S21016 76770002
IEBCOPY  DC    C'PGM=IEBCOPY'                                           76800002
CHGRPSTR DC    F'0'                                                     76830002
REPLACE  DC    C'(R) '                                                  76860002
TEN      DC    F'10'                                             S21995 76890002
CHARDSN  DC    C'DSN='                                                  76950002
NAMECARD DC    C'NAME '                                                 76980002
CHARINS  DC    C'INS'                                                   77010002
CHARINC  DC    C'INC'                                                   77040002
INSERTCD DC    C' INSERT '                                              77070002
PAGECD   DC    C'PAGE'                                           X01983 77100002
ORDERCD  DC    C'ORDER'                                          X01983 77130002
APFCD    DC    C'SETCODE'                                        Y01048 77140002
EXECCARD DC    C'EXEC'                                                  77190002
LINKSPRC DC    C'LINKS'                                          Y01036 77240002
ASMSPROC DC    C'ASMS'                                           Y01036 77242002
MODPARM  DC    C'MOD='                                           Y01036 77244002
NPARM    DC    C'N='                                             Y01036 77246002
P1PARM   DC    C'P1='                                            Y01036 77248002
P2PARM   DC    C'P2='                                            Y01036 77248402
SYS1BLK  DC    C'SYS1 '                                          Y01036 77248802
SYS1COM  DC    C'SYS1,'                                          Y01036 77249202
DSSDNME  DC    C'PARMLIB'              DSS DDNAME                Y01045 77249602
         DC    C'('                                              Y01045 77257202
DSSMEMB  DC    C'IQAORDER'             DSS PARMLIB MEMBER NAME   Y01045 77264802
         DC    C')'                                              Y01045 77266802
OVCARD   DC    C'OV'                                             S21995 77272402
ENDCARD  DC    C'/*'                                                    77280002
DUPCOPY  DC    X'00'                                                    77340002
PARM     DC    X'00'                                                    77370002
ASMSW    DC    X'00'                   ASSEMBLY CONTROL SWITCH   A40797 77380002
         DS    0F                                                       77400002
BRPRMLST DC    X'00'                   BRANCH SETTINGS FOR PTF01        77430002
IDENTCON DC    X'00'                   IDENTIFY CONT. SWITCH     S21016 77460002
RETCDE   DC    X'00'                   RETURN CODE SAVE AREA     A48711 77490002
COMSW    DC    X'00'                   SWITCHES                  Y01045 77500002
         DC    A(MODSTORE)             ADDR OF MODULE NAME BUFFER       77520002
OVTABADR DC    F'0'                    ADDR OF OVERLAY TABLE      M4000 77550002
PTF01    DS    F                       ENTRY POINT OF AMAPTF01          77580002
PTF02    DS    F                       ENTRY POINT OF AMAPTF02          77610002
PCH      DC    A(PCHAREA)              ADDR OF PCHAREA BUFFER           77640002
MODAR    DC    A(MODAREA)              ADDR OF MODAREA BUFFER           77670002
OUTFCB   DC    A(OUTFDCB)              ADDR OF OUTFDCB                  77700002
SYNADADR DC    A(SYNADEXT)             ADDR OF SYNAD ROUTINE            77730002
DDMSG    DC    A(MSGAREA)              ADDR OF MSGAREA                  77760002
PRINTDCB DC    A(MSGDCB)               ADDR OF MSGDCB                   77790002
SELNAME  DC    F'0'                    ADDR OF MODULE NAME        M4000 77820002
SSISAVE  DC    F'0'                    ADDR OF FOUND MODULE       M4000 77850002
MSGRITE  DC    A(MESSAGE2)             ADDR OF OPEN MESSAGE ROUTINE     77880002
MODTBL   DC    F'0'                    ADDR OF MODULE NAME TABLE  M4000 77910002
SSITABLE DC    F'0'                    ADDR OF SSI TABLE          M4000 77940002
PARMPTR  DS    F                                                        77970002
CLOSEADR DC    A(FILCLOSE)             ADDR OF CLOSE DCBS ROUTINE       78000002
LOADOVR  DC    C'IEWSZOVR'                                       A48079 78010002
LOAD01   DC    C'AMAPTF01'                                              78030002
LOAD02   DC    C'AMAPTF02'                                              78060002
SCSAVE   DS    9D                                                       78070002
PTCHAREA DC    174H'0'                 PATCH AREA FOR AMAPTFLE   Y01983 78090002
         DS    0F                                                S21995 78120002
MODFDCB  DCB   DSORG=PS,MACRF=GM,DDNAME=MODF,LRECL=80,RECFM=FB,        C78150002
               EODAD=ENDMOD,SYNAD=SYNADEXT                       S21995 78180002
PCHFDCB  DCB   DSORG=PS,MACRF=RP,DDNAME=PCHF,RECFM=FB,LRECL=80,        C78210002
               SYNAD=SYNADEXT,EODAD=EOJRTN                       S21995 78240002
OUTFDCB  DCB   DSORG=PS,MACRF=(W,R),DDNAME=OUTF,BLKSIZE=80,RECFM=F,    C78270002
               SYNAD=SYNADEXT                                    S21995 78300002
MSGDCB   DCB   DSORG=PS,MACRF=W,DDNAME=PRINT,BLKSIZE=121,RECFM=F,      X78330002
               SYNAD=SYNADEXT                                    S21995 78360002
         DCBD  DSORG=PS                                          S21995 78390002
         END                                                            78420002
