         TITLE 'IGC0001I                      OPEN - SVC 19 INITIAL MODU00200002
               ULE'                                                     00210002
IGC0001I CSECT                                                          00800021
         ENTRY IGC0101I                 ENTRY FROM CLOSE DURING  Y02082 00850002
*                                       UNLIKE CONCAT PROCESSING Y02082 00950002
*********************************************************************** 00960002
*                                                                     * 00970002
*        VS2 RELEASE 03 DELETIONS/CHANGES                               00972002
*0000371488,509556,509576,510280-510420                         ZA00705 00974002
*                                                                       00976002
*               VS2-037 CHANGES/DELETIONS/ADDITIONS                   * 00977037
*A800100-801100,A808100-808200                                 @ZA29752 00978037
*                                                                     * 00979037
* MODULE NAME = IGC0001I (OS/VS2)                                     * 00980002
*                                                                     * 00990002
* DESCRIPTIVE NAME = OPEN INITAL MODULE                               * 00992002
*                                                                     * 00994002
* COPYRIGHT = NONE                                                    * 00996002
*                                                                     * 00998002
* STATUS = RELEASE 2, LEVEL 0                                         * 00998402
*                                                                     * 00998802
* FUNCTION =                                                          * 00999202
*        1. DETERMINE IF THIS REQUEST IS FOR A VSAM RESOURCE   @Y30DSDT 00999337
*        POOL (VRP). IF IT IS, GET A WORK AREA AND BRANCH TO   @Y30DSDT 01001837
*        IFG0192Y. IF THIS IS AN OPEN REQUEST, SAVE REGISTERS  @Y30DSDT 01002237
*        2-12 IN SVRB EXTENDED SAVE AREA AND GET MAIN STORAGE  @Y30DSDT 01003837
*        (VIA RESIDENT ROUTINE) FOR:                           @Y30DSDT 01004937
*           A. WHERE-TO-GO TABLE;                                     * 01007437
*           B. A WORK AREA FOR EACH DCB IN THE PARAMETER LIST. (IF    * 01009937
*           THE DDNAME FOR THE DCB IS NOT IN THE TIOT, THE WORK AREA  * 01012437
*           IS FREED);                                                * 01014937
*           C. A PROTECTED COPY OF THE DCB.                           * 01017437
*                                                                     * 01019937
*        2. INITIALIZE EACH WHERE-TO-GO TABLE ENTRY.                  * 01022437
*                                                                     * 01024937
*        3. CONSTRUCT IN EACH O/C/EOV WORK AREA THE CONTROL BLOCKS    * 01027437
*        NEEDED TO EXCP:                                              * 01029937
*           A. DEB                                                    * 01032437
*           B. ECB                                                    * 01034937
*           C. DCB                                                    * 01037437
*           D. IOB                                                    * 01039937
*           E. CHANNEL PROGRAMS                                       * 01042437
*                                                                     * 01044937
*        4. OBTAIN THE JFCB THROUGH THE TIOT ENTRY FOR EACH DCB.      * 01047437
*        CHECK TO SEE IF THE TRACE ROUTINE HAS BEEN REQUESTED. IF IT  * 01049937
*        HAS, THEN TURN ON THE TRACE ROUTINE INDICATOR AT WTGPATHS+K1.* 01052437
*                                                                     * 01054937
* NOTES = SEE BELOW                                                   * 01057437
*                                                                     * 01059937
*    DEPENDENCIES =                                                   * 01062437
*            CLASS ONE CHARACTER CODE.  THE EBCDIC CHARACTER CODE     * 01064937
*            WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED   * 01067437
*            IF A DIFFERENT CHARACTER SET IS USED FOR EXECUTION.      * 01069902
*                                                                     * 01079902
*    RESTRICTIONS = NONE                                              * 01089902
*                                                                     * 01091902
*    REGISTER CONVENTIONS =                                           * 01093902
*            R2 POINTS TO DCB                                         * 01095902
*            R4 POINTS TO OPEN WORK AREA                              * 01097902
*            R5 POINTS TO THE RESIDENT ROUTINE                        * 01098302
*            R6 POINTS TO THE WTG TABLE                               * 01098702
*            R7 POINTS TO THE CURRENT PARAMETER LIST ENTRY            * 01099102
*            R8 POINTS TO THE CURRENT WTG TABLE ENTRY                 * 01099502
*            R9 POINTS TO THE DD ENTRY IN THE TIOT                    * 01099602
*            R10 POINTS TO THE UCB                                    * 01099702
*                                                                     * 01099802
*    PATCH LABEL = SEE NEXT TO LAST LABEL BEFORE ORG STATEMENT AT END * 01133202
*                  OF LISTING.                                        * 01143202
*                                                                     * 01153202
* MODULE TYPE = CONTROL (OPEN, CLOSE, EOV DATA MANAGEMENT)            * 01163202
*                                                                     * 01165202
*    PROCESSOR = ASSEMBLER XF                                         * 01165602
*                                                                     * 01166002
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY OR LOC FIELD ON     * 01166402
*                  ORG STATEMENT AT END OF LISTING                    * 01166502
*                                                                     * 01177602
*    ATTRIBUTES = REENTRANT, REFRESHABLE,READ-ONLY, ENABLED,          * 01187602
*                 PRIVILEGED, SUPERVISOR STATE, DATA MANAGEMENT KEY,  * 01188002
*                 LINK PACK AREA RESIDENT/PAGEABLE                    * 01188402
*                                                                     * 01188802
* ENTRY POINT = IGC0001I  FROM OPEN MACRO OR SVC 19 IN KEY ZERO       * 01192502
*               IGC0101I  FROM CLOSE - UNLIKE ATTRIBUTE CONCATENATION * 01192902
*                         AND IN DATA MANAGEMENT KEY                  * 01193702
*                                                                     * 01194502
*    PURPOSE = INITIALIZE WORK AREAS FOR OPEN PROCESSING              * 01194902
*                                                                     * 01195302
*    LINKAGE = STANDARD LINKAGE FOR TYPE 4 SVC                        * 01195702
*                                                                     * 01196102
* INPUT = REGISTER 1 POINTING TO VARIABLE PARAMETER LIST.             * 01196202
*                                                                     * 01216202
* OUTPUT = OPEN WTG TABLE AND WORK AREAS INITIALIZED FOR OPEN         * 01219602
*          PROCESSING.                                                * 01221602
*                                                                     * 01229602
* EXIT-NORMAL =                                                       * 01231602
*          IFG0193A - NORMAL OPEN PROCESSING                          * 01232102
*          IFG0191X - VSAM CATALOG                                    * 01232202
*                                                                     * 01233602
* EXIT-ERROR = CALLER - NO DCB'S TO OPEN                              * 01235602
*                                                                     * 01385602
* EXTERNAL REFERENCES = SEE BELOW                                     * 01435602
*                                                                     * 01485602
*    ROUTINES = IFG0193A,IFG0191X,IFG019RA.                           * 01535602
*                                                                     * 01585602
*    DATA AREAS = SEE PARAMETERS ON IECDSECS MACRO.                   * 01635602
*                                                                     * 01685602
*    CONTROL BLOCK = SEE PARAMETERS ON IECDSECS MACRO.                * 01735602
*                                                                     * 01785602
* TABLES = SEE XCTLTABL MACRO.                                        * 01835602
*                                                                     * 01885602
* MACROS = IECDSECS,IECEQU,IECRES,MODESET,WTO,XCTLTABL.               * 01935602
*                                                                     * 01985602
* CHANGE ACTIVITY = NEW RELEASE (LEVEL 0)                             * 02035602
*                                                                     * 02085602
*********************************************************************** 02135602
         EJECT                                                          26400021
         IECDSECS CVT,TCB,RB,TIOT,UCB,DCB,ACB,MAIN,WTG,PREFX,    Y02080*26600002
               RRPL,IEZDEB                                      YA03003 26650002
*                                                                       27000021
TIOTSPOL EQU   X'06'                    JES SPOOL D.S.  INDICATORS      27290000
ACBMJEP  EQU   X'40'                    ACB JEPS INDICATOR              27300000
VRPREGSV EQU   92                       SAVEAREA SIZE FOR VRP   Z30SSRL 27310037
         IECEQU AOS=YES,IEZDEB=YES                              YA03003 27320002
*                                                                       27400021
         USING IHADCB,RDCB              DEFINE BASE TO USER'S DCB       27600021
         USING FORCORE,RCORE            DEFINE BASE TO MAIN WORK AREA   27800021
         USING TIOENTRY,RTIOT           DEFINE BASE TO TIOT DD ENTRY    28000021
         USING RRPLIST,RC               DEFINE BASE TO RRPLIST   Y02144 28250002
         USING WTG,RWTG                 DEF BASE TO WTG TABLE  @Y30DSDT 28300037
*                                                                       28400021
         BALR  RBASE,R0                 ESTABLISH BASE REGISTER         28600002
         USING *,RBASE                  DEFINE BASE REGISTER            28800021
OIN00000 EQU   *                        TOP OF MODULE            Y02082 28850002
*                                                              @Y30DSDT 31836037
************************************************************** @Y30DSDT 31842037
*                                                              @Y30DSDT 31848037
*  TEST FOR VSAM BLDVRP OR DLVRP REQUEST                       @Y30DSDT 31848437
*                                                              @Y30DSDT 31850037
************************************************************** @Y30DSDT 31852037
*                                                              @Y30DSDT 31852437
         L     RDCB,PLISTDCB(R1)        POINT TO FIRST DCB/ACB @Y30DSDT 31852537
         TM    DCBMACR,DCBMEXCP         EXCP                   @Y30DSDT 31852637
         BO    OIN10000                 BRANCH IF YES          @Y30DSDT 31852737
         TM    DCBDSRG2,ACBDORGA        ACB                    @Y30DSDT 31856337
         BZ    OIN10000                 BRANCH IF NO           @Y30DSDT 31858337
         CLI   ACBSTYP-IFGACB(RDCB),ACBSVRP  VRP REQUEST       @Y30DSDT 31860337
         BNE   OIN10000                 BRANCH IF NO           @Y30DSDT 31864437
         TM    PLISTOPT(R1),X80         CHECK FOR ONE PARM     @Y30DSDT 31864837
         BZ    OIN10000                 BRANCH IF MORE         @Y30DSDT 31864937
         LR    RPARC,R1                 SAVE PT TO PARM LIST   @Y30DSDT 31865137
         SR    R1,R1                    NO PREVIOUS PREFIX     @Y30DSDT 31867637
         USING RBBASIC,R5               RB ADDRESSIBILITY      @Y30DSDT 31868137
         IECRES GET,LV=DXXEND+VRPREGSV,STM=(2,12,RBEXSAVE),    @Y30DSDT*31868337
               PREFIX=YES,A=(1),SP=252,KEY=K0,ID=VRP   VRP WA  @Y30DSDT 31869037
         DROP  R5                       DROP RB ADDRESSING     @Y30DSDT 31869937
         LR    RCORE,R1                 EST WORK AREA BASE     @Y30DSDT 31870637
         LA    R0,IECSTART-IECPREFX     GET LENGTH OF PREFIX   @Y30DSDT 31870937
         SR    R1,R0                    POINT R1 AT PREFIX     @Y30DSDT 31871237
         ST    R1,DXXPREFX              PT TO PREFIX FROM WTG  @Y30DSDT 31871837
         MVI   DXXWTOPR+1,K12           LGTH IN WTG WTO PREFIX @Y30DSDT 31872537
         IECRES LOAD,MODNM=VSAMVRP,PREFIX=DXXPREFX,            @Y30DSDT*31873237
               BRANCH=DIRECT            GO PROCESS VRP REQUEST @Y30DSDT 31873937
OIN10000 EQU   *                        CONTINUE OPEN PROCESS  @Y30DSDT 31874637
*                                                                       31875337
*********************************************************************** 31876037
*                                                                       31876737
*  GETMAIN THE WHERE-TO-GO TABLE                                        31877437
*                                                                       31878137
*                                                                Y02080 31878837
* SAVE REGISTERS 2-12 IN SVRB EXTENDED SAVE AREA                 Y02080 31879237
*                                                                Y02080 31879637
         L     RF,CVTPTR                GET POINTER TO CVT       Y02080 31880537
         L     RF,CVTTCBP-CVT(,RF)      GET TCB WORDS            Y02080 31882002
         L     RF,K4(,RF)               TCB ADDRESS              Y02080 31882402
         L     RF,K0(,RF)               POINTER TO SVRB          Y02080 31883237
         USING RBBASIC,RF               ADDRESS RB               Y02080 31883637
         IECRES GET,PREFIX=WTG,         GETMAIN FOR WTG TABLE    Y02080*31883702
               STM=(2,12,RBEXSAVE),A=(R1)                        Y02080 31883802
*        CONTROL RETURNED IN DATA MANAGEMENT KEY                 Y02082 31885802
*        REGISTER 0 CONTAINS RESULT OF SYSZTIOT ENQ              YM2869 31890002
         DROP  RF                       DROP ADDRESSING TO RB    Y02080 31893802
*                                                                       31896021
         LR    RWTG,R1                  WTG ADDR TO RWTG REG     Y02080 31902002
         IECRES LOAD,MODNM=OPEN,PREFIX=WTGPREFX,BRANCH=NO        Y02080*31908102
                                        GIVE OPT TRACE A SHOT    Y02080 31908302
         L     RPAR,WTGPREFX            GET PTR TO WTG PREFIX    Y02144 31908402
         L     RC,IECRRPRM-IECPREFX(,RPAR) GET RRPLIST ADDRESS   Y02144 31908802
         MVI   RRFUNCTN,RRFOPEN         INDICATE OPEN FUNCTION   Y02144 31909202
*                                                                       31950000
*********************************************************************** 31951200
*                                                                       31957300
*  INITIALIZE EACH WHERE-TO-GO TABLE ENTRY                              31963400
*                                                                       31969500
         SR    RD,RD                    SET GO SWITCH OFF        A39979 31975600
         L     RPAR,IECUPRML-IECPREFX(,RPAR) ADDR OF USER'S PARAM LIST *31979602
                                        IN WTG AREA              Y02134 31981602
         LR    RPARC,RPAR               ADDR FIRST ENT PARM LIST A39979 31981700
         LA    RWTGC,WTGENTRY           ADDR FIRST ENT WTG TABLE A39979 31987800
         USING WTGENTRY,RWTGC           BASE TO CURRENT WTG ENT  A39979 31993900
*                                                                       32000021
*        TEST RESULT OF SYSZTIOT ENQ                             YM2869 32005002
*              REGISTER 0 NONZERO INDICATES CALLER OF OPEN       YM2869 32010002
*              OBTAINED SYSZTIOT RESOURCE EXCLUSIVELY.           YM2869 32015002
*        THIS WILL BE ALLOWED ONLY IF THE CALLER IS IN A SYSTEM  YM2869 32020002
*              PROTECT KEY AND IS OPENING AN ACB TO A VSAM       YM2869 32025002
*              CATALOG INDICATED BY THE ACBCAT BIT BEING SET     YM2869 32030002
*                                                                       32035002
         LTR   R0,R0                    IS RETURN CODE ZERO      YM2869 32040002
         BZ    OIN10200                 BRANCH IF YES            YM2869 32045002
         L     RDCB,PLISTDCB(,RPARC)    GET DCB/ACB              YM2869 32050002
         L     RA,CVTPTR                CVT                      YM2869 32055002
         L     RA,CVTTCBP-CVT(,RA)      TCB WORDS                YM2869 32060002
         L     RA,K4(,RA)               CURRENT TCB              YM2869 32065002
         USING TCB,RA                                            YM2869 32070002
         MODESET EXTKEY=RBT234,WORKREG=1 USER KEY                YM2869 32075002
         TM    DCBMACR,DCBMEXCP         EXCP                     YM2869 32080002
         BO    OIN13250                 BR IF YES                YM2869 32085002
         TM    DCBDSRG2,ACBDORGA        ACB                      YM2869 32090002
         BZ    OIN13250                 BR IF NO                 YM2869 32095002
         TM    ACBINFLG-IFGACB(RDCB),(ACBCAT+ACBSCRA)           Z30SSRL 32100037
*                                       IS IT CATALOG OR SCRA   Z30SSRL 32102037
         BZ    OIN13250                 BR IF NO                 YM2869 32105002
         MODESET EXTKEY=DATAMGT         KEY OF DATA MANAGEMENT   YM2869 32110002
         TESTAUTH KEY=YES               CALLER IN SYSTEM KEY     YM2869 32115002
         LTR   RF,RF                    RETURN CODE              YM2869 32120002
         BNZ   OIN13250                 BR IF NOT IN SYSTEM KEY  YM2869 32125002
         DROP  RA                                                YM2869 32130002
OIN10200 EQU   *                        LOOP FOR EACH DCB               32200002
         XC    WTGENTRY,WTGENTRY        CLEAR WTG TABLE ENTRY    A39979 32300021
         L     RDCB,PLISTDCB(,RPARC)    LOAD CURRENT DCB ADDR           32400021
*                                                                Y02082 32425002
*        MAKE SURE THIS DCB IS NOT PREVIOUSLY DUPLICATED IN THE  Y02082 32450002
*        PARAMETER LIST                                          Y02082 32475002
*                                                                Y02082 32500002
         DROP  RWTGC                    DROP WTGC TEMPORARILY    Y02082 32510002
         LA    R1,WTGENTRY              FIRST DCB'S WTG ENTRY    Y02082 32525002
         USING WTGENTRY,R1              TEMPORARY USING FOR R1   Y02082 32545002
OIN10220 EQU   *                        PROCESS EACH DCB         Y02082 32575002
         CR    R1,RWTGC                 AT CURRENT ENTRY YET     Y02082 32600002
         BE    OIN10225                 BR IF YES-NO DUPLICATE   Y02082 32650002
         L     RCORE,WTGCORE-K1         GET WORKAREA IF PRESENT  Y02082 32700002
         LA    RCORE,K0(,RCORE)         CLEAR HIGH BYTE          Y02082 32702002
         LTR   RCORE,RCORE              IS THERE A WORKAREA      Y02082 32710002
         BZ    OIN10222                 BRANCH IF NO             Y02082 32720002
         CLM   RDCB,B'0111',DXUDCBAD+K1 IS CURRENT DCB BEING     Y02082 32730002
*                                       PROCESSED ALREADY        Y02082 32740002
         BE    OIN10400                 BR IF YES-DON'T DO IT    Y02082 32742002
*                                       AGAIN                    Y02082 32744002
OIN10222 EQU   *                        GET NEXT ENTRY           Y02082 32746002
         LA    R1,L'WTGENTRY(,R1)       GO TO NEXT ENTRY         Y02082 32748002
         B     OIN10220                 CHECK NEXT ENTRY         Y02082 32750002
         DROP  R1                       R1 NO LONGER NEEDED      Y02082 32760002
         USING WTGENTRY,RWTGC           REESTABLISH RWTGC USING  Y02082 32770002
OIN10225 EQU   *                        GET WORK AREA            Y02082 32775002
         L     RA,CVTPTR                GET CVT ADDRESS          Y02082 33222002
         L     RA,CVTTCBP-CVT(,RA)      ADDR OF TCB POINTERS     Y02082 33224002
         L     RA,K4(,RA)               GET CURRENT TCB ADDR     Y02082 33224402
         USING TCB,RA                   PROVIDE ADDRESSABILITY   Y02082 33224802
         MODESET EXTKEY=RBT234,WORKREG=15 USER KEY               Y02082 33232602
         DROP  RA                                                Y02082 33234602
         TM    DCBOFLGS,DCBOFOPN+DCBOFIOF OPEN OR BUSY BITS ON?  Y02134 33236302
         BNZ   OIN10400                 BR IF YES-GET NEXT DCB   Y02134 33240002
*        DETERMINE SIZE OF DCB/ACB FOR COPYING IT INTO WORKAREA  Y02134 33250002
         MODESET EXTKEY=DATAMGT         ASSUME KEY 5             Y02082 33261002
         IECRES GET,LV=OPENSIZE,PREFIX=YES,STM=(2,14,WTGPREFX),  Y02134*33262002
               ID=OPWA                                           Y02144 33262402
         LR    RCORE,R1                 ESTABLISH WORKAREA BASE  Y02134 33264002
         ST    RCORE,WTGCORE-K1         SAVE IN WTG TABLE ENTRY  Y02134 33266002
         ST    RC,DXATCOM3              SAVE RRPLIST PTR IN W/A  Y02144 33266402
*        INITIALIZE WORKAREA WITH CONTROL BLOCK POINTERS AND     Y02134 33268002
*        COPY DCB INTO WORKAREA                                  Y02134 33268402
         IECRES INIT,DCBCOPY=TOWKAR,DEB=NO,STM=(3,14,WTGPREFX),  Y02134*33268802
               PREFIX=WTGPREFX                                   Y02082 33273802
         CLI   DXWCOPYE,K0              WAS COPY/INIT OK         Y02082 33278802
         BE    OIN10228                 BRANCH IF YES            Y02082 33283802
         CLI   DXWCOPYE,K2              WAS DDNAME MISSING       Y02082 33288802
         BNE   OIN10350                 BRANCH IF NO-SOME OTHER  Y02082 33293802
*                                       REASON                   Y02082 33298802
*                                                                       33303802
*********************************************************************** 33308802
*                                                                       33313802
*  WRITE  'IEC130I DDNAMEXX DD STATEMENT MISSING'  ERROR MESSAGE        33318802
*                                                                       33319802
*                                                                X02989 33321902
*  SET ERROR FLAG FOR ACB                                        X02989 33322602
*                                                                X02989 33322802
         TM    DCBMACR,DCBMEXCP         IS ACCESS METHOD EXCP    X02989 33323002
         BO    OIN10227                 BRANCH IF YES            X02989 33323202
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  X02989 33324902
         BNO   OIN10227                 BRANCH IF NO             X02989 33325902
         USING IFGACB,RACB              DEFINE BASE TO ACB       X02989 33326102
         MVI   ACBERFLG,VSONODDN        SET ACB ERROR FLAG       X02989 33326302
*                                       TO DD NAME NOT IN TIOT   X02989 33326502
         USING IHADCB,RDCB              DEFINE BASE TO DCB       X02989 33327102
OIN10227 EQU   *                        ISSUE MESSAGE            X02989 33327302
         LR    R1,RCORE                 MSG ADDR FOR WTO         Y02134 33327602
         MVC   0(OIN1500L,R1),OIN1500K  MOVE MSG TO WORKAREA     Y02134 33328202
         MVC   K12(L'DCBDDNAM,R1),DCBDDNAM MOVE DDNAME TO MSG    Y02134 33328402
*                                                                       33328602
         WTO   MF=(E,(1))               WRITE MESSAGE TO PROGRAMMER     33328702
*                                                                       33330902
         B     OIN10350                 BR TO PROCESS NEXT DCB   Y02134 33331902
         EJECT                                                          33332102
OIN10228 EQU   *                        CONTINUE                 Y02028 33332902
         TM    DCBMACR,DCBMEXCP         IS ACCESS METHOD EXCP    X02989 33333402
         BO    OIN10240                 BR IF YES                X02989 33335602
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  X02989 33337802
         BNO   OIN10240                 BR IF NO                 X02989 33340002
         USING IFGACB,RDCB              DEFINE BASE TO ACB       X02989 33350002
         TM    ACBOFLGS,ACBOPEN         IS ACB ALREADY OPEN      X02989 33352002
         BNO   OIN10230                 BR IF NO                 X02989 33354002
         MVI   ACBERFLG,VSOACBOP        SET ACB ALREADY OPEN     X02989 33356002
*                                       ERROR FLAG               X02989 33358002
         B     OIN10350                 BR TO PROC NEXT ACB/DCB  Y02134 33358402
OIN10230 EQU   *                        CLEAR ERROR              X02989 33358802
         XC    ACBERFLG,ACBERFLG        ZERO ACB ERROR FLAG      X02989 33359202
         B     OIN10300                 BR TO CONTINUE           X02989 33359602
         USING IHADCB,RDCB              REDEFINE BASE TO DCB     X02989 33359702
OIN10240 EQU   *                        TEST IF ALREADY OPEN     X02989 33359802
         TM    DCBOFLGS,DCBOPEN         IS DCB ALREADY OPEN      X02989 33359902
         BO    OIN10350                 BR IF YES                Y02134 33366602
OIN10300 EQU   *                        ERROR ENCOUNTERED        X02989 33376602
         TM    DCBOFLGS,DCBOCON         CONCATENATION BIT = 1    Y02082 33390002
         BO    OIN10350                 YES, GO FREE WORK AREA   Y02082 33392002
         TM    DCBOFLGS,DCBOLOCK        IS DCB NOT-LOCKED BIT ON        33400021
         BO    OIN10600                 BR IF YES                Y02134 33600002
*                                                                       34200021
OIN10350 EQU   *                         FREE WORKAREA           Y02134 34250002
         NI    DCBOFLGS,X'FF'-DCBOBUSY  RESET BUSY BIT           Y02082 34255002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(2,14,WTGPREFX)          Y02082 34256002
         XC    WTGENTRY,WTGENTRY        NO PROCESSING THIS DCB   Y02134 34260002
OIN10400 EQU   *                        GET NEXT DCB                    34400002
         MODESET EXTKEY=DATAMGT         ASSUME KEY 5             Y02082 34425002
         TM    PLISTOPT(RPARC),LASTNTRY  CHECK FOR LAST ENTRY           34600021
         LA    RPARC,K4(,RPARC)         INCR TO NEXT DCB IN PARM LIST   35000021
         LA    RWTGC,L'WTGENTRY(,RWTGC) ADVANCE WTG ENTRY        A39979 35200021
         BZ    OIN10200                 BR IF NOT LAST ENTRY     A39979 35260021
         B     OIN13000                 BR TO EXIT OR XCTL       A39979 35320021
*                                                                       35400021
*********************************************************************** 35600021
*                                                                       35800021
*  DCB NEEDS TO BE OPENED.                                              36000021
*  SEARCH TIOT FOR MATCHING DDNAME.                                     36200021
*                                                                       36400021
OIN10600 EQU   *                        INITIALIZE FOR NEXT LOAD        36600002
         MVC   WTGIDTTR-WTGENTRY(L'WTGIDTTR,RWTGC),OPENNEXT 3A   Y02080 36650002
         XC    DXREGE,DXREGE            IND INIT ENTRY 193A      Y02080 36660002
         XC    DXREG0,DXREG0            IND NO ERROR             Y02080 36670002
*                                                                X02989 36700002
*  IF OPEN IS FOR VSAM CATALOG, BYPASS TIOT SEARCH               X02989 36750002
*                                                                X02989 36760002
         TM    DCBMACR,DCBMEXCP         IS ACCESS MEHOD EXCP     X02989 36770002
         BO    OIN10650                 BR IF YES, NOT AN ACB    X02989 36780002
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  X02989 36790002
         BNO   OIN10650                 BR IF NO                 X02989 36792002
*  IS ACB FOR VSAM CATALOG                                     @Y30DSDT 36792437
         TM    ACBINFLG-IFGACB(RDCB),ACBCAT+ACBSCRA CATLG/SCRA  Z30SSRL 36794037
         BZ    OIN10640                 BR IF NO               @Y30DSDT 36798037
OIN10620 EQU   *                        PREPARE TO XCTL         Z30SSRL 36798137
         OI    DCBOFLGS,DCBOBUSY        SET BUSY BIT ON          X02989 36798402
         MVC   WTGIDTTR-WTGENTRY(L'WTGIDTTR,RWTGC),VSAMCATL VSAM Y02080 36798802
         MVC   DXRETMOD,OPENNEXT        SET RETURN TO 193A       Y02080 36898802
         XC    DXRETCOD,DXRETCOD        SET 193A INIT INDR       Y02080 36948802
         B     OIN11500                 BR TO GET WORK AREA      X02989 36998802
OIN10640 EQU   *                        TEST FOR SPECIAL DDNAME         37048802
         CLC   ACBDDNM-IFGACB(L'ACBDDNM,RDCB),=X'FF00000000000000'      37098802
*                                       TEST FOR SPECIAL DDNAME  Y02004 37108802
         BNE   OIN10650                 BRANCH IF NOT VTAM      ZA00705 37148802
         USING IFGACB,RACB              ADDRESS THE ACB         ZA00705 37150802
         MVI   ACBAMETH,ACBVTAM         FLAG VTAM ACCESS METHOD ZA00705 37158802
         USING IHADCB,RDCB              RESTORE DCB ADDRESSING  ZA00705 37160802
         B     OIN11600                 BRANCH TO COPY VTAM ACB ZA00705 37168802
*                                                                       37198802
OIN10650 EQU   *                        CONTINUE                 X02989 37248802
         L     RTIOT,DXTIOTAD           GET TIOT ENTRY ADDR      Y02134 38600002
*                                                                       46212021
OIN11300 EQU   *                        EXCP NOT ALLOWED FOR SUBSYSTEM  46216002
         TM    TIOELINK,TIOTSPOL        IS THIS A SPOOLED DATA SET      46218000
         BNM   OIN11400                 NO, BR TO CONTINUE NORMALLY     46220002
         TM    DCBMACR,DCBMEXCP         IS ACCESS METHOD EXCP           46222000
         BZ    OIN11400                 NO,BR TO CONTINUE               46222402
*                                                                       46222621
*********************************************************************** 46222800
*                                                                       46223200
*   WRITE  'IEC132I DDNAMEXX, MACRF=E WAS SPECIFIED FOR A SYSIN OR      46223600
*   SYSOUT DATA SET' ERROR MESSAGE                                      46223700
*                                                                       46223800
         LR    R1,RCORE                 MSG ADDR FOR WTO         Y02134 46223902
         MVC   0(OIN1500N,R1),OIN1500M  MOVE MSG TO WORKAREA     Y02134 46233902
         MVC   K12(L'DCBDDNAM,R1),DCBDDNAM MOVE DDNAME TO MSG    Y02134 46235902
         WTO   MF=(E,(1))               WRITE MSG TO PROGRAMMER         46239900
         B     OIN10350                 BR TO PROCESS NEXT DCB   Y02134 46267502
*                                                                       46584400
*  THIS DCB IS OPENABLE.                                         Y02134 46600002
*  INITIALIZE CONTROL BLOCKS IN MAIN WORK AREA.                         46800021
*                                                                       47000021
OIN11400 EQU   *                        CALCULATE TIOT OFFSET           47200002
         LR    RF,RTIOT                 CALC TIOT DD ENTRY OFFSET       47400021
         L     RET,DXTCBADR             GET TCB ADDRESS          Y02134 47450002
         L     RET,TCBTIO-TCB(RET)      GET TIOT ADDRESS         Y02134 47500002
         SR    RF,RET                   FROM START OF TIOT              47600021
         STH   RF,DCBTIOT               STORE TIOT OFFSET IN DCB        47800021
         TM    DCBMACR,DCBMEXCP         IS ACCESS MEHOD EXCP    Z30SSRL 47802037
         BO    OIN11500                 BR IF YES, NOT AN ACB   Z30SSRL 47804037
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB Z30SSRL 47806037
         BNO   OIN11500                 BR IF NO                Z30SSRL 47808037
         TM    ACBINFLG-IFGACB(RDCB),ACBUCRA IF IT IS UCRA      Z30SSRL 47810037
         BO    OIN10620                 BRANCH TO XCTL          Z30SSRL 47820037
OIN11500 EQU   *                        MOVE MACRF, TURN ON OPEN GO SW  47850002
         MVC   DCBMACRF,DCBMACR         MOVE MACRF                      48000021
*                                                                       48200021
OIN11600 EQU   *                        INDICATE OPEN IN PROGRESS       48400002
         OI    DCBOFLGS,DCBOBUSY        SET DCB BUSY BIT ON             49000021
         LR    RD,RCORE                 SET OPEN GO SWITCH ON    Y02080 49200002
*                                                                       49400021
OIN11650 EQU   *                        PROCESS                  Y02134 49450002
         ST    RCORE,DCBDEBAD           SAVE CORE ADDR IN DCB DEB SLOT  50200021
         MVC   DCBIFLGS,DCBIFLG         MOVE IN DCB IOS FLAGS           50400021
         IECRES INIT,DCBCOPY=FRWKAR,STM=(0,14,WTGPREFX) UPDATE   YM5702*50450002
                                        THE USER'S DCB           YM5702 50550002
         TM    DCBMACR,DCBMEXCP         IS ACCESS METHOD EXCP    XM1037 50950402
         BO    OIN11670                 BR IF YES, NOT ACB       X02989 50950802
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  X02989 50951202
         BNO   OIN11670                 BR IF NO                 X02989 50951602
         USING IFGACB,RACB              ADDRESS THE ACB          Y02004 50953602
         CLI   ACBAMETH,ACBVTAM         IS ACB FOR VTAM?        ZA00705 50955602
         BE    OIN10400                 BRANCH IF YES           ZA00705 50957602
         TM    ACBINFLG,(ACBCAT+ACBSCRA+ACBUCRA)                Z30SSRL 50959637
*                                       IF CATALOG/SCRA/UCRA    Z30SSRL 50961637
         BZ    OIN11670                 BR IF NO                Z30SSRL 50969237
         MVC   DXWORK1,ACBINFLG         SET FLAG                Z30SSRL 50973637
         B     OIN10400                 BR TO NEXT DCB/ACB       X02989 50978002
         EJECT                                                          51042402
         USING IHADCB,RDCB              RESTORE DCB ADDRESSING   Y02004 51044002
*                                                                Y02004 51044402
**************************************************************** Y02082 51054402
*                                                                Y02082 51055202
**  1. THE FOLLOWING LABEL (IGC0101I) IS THE ENTRY POINT TO      Y02082 51058002
**     OPEN FROM CLOSE FOR UNLIKE CONCATENATION PROCESSING.      Y02082 51058802
**  2. REGISTER R1 CONTAINS A POINTER TO A SINGLE-MEMBER         Y02082 51059602
**     OPEN PARAMETER LIST.                                      Y02082 51060402
**  3. THE EOV WORK AREA AND WTG TABLE WHICH WERE PASSED TO      Y02082 51061202
**     CLOSE ARE NOW PASSED TO OPEN, WITH REGISTERS RCORE AND    Y02082 51062002
**     RWTG ALREADY INITIALIZED WITH THE WORK AREA ADDRESS AND   Y02082 51062802
**     THE WTG TABLE ADDRESS, RESPECTIVELY.                      Y02082 51063602
*                                                                Y02082 51064402
IGC0101I EQU   *                        SECONDARY ENTRY POINT    Y02082 51065202
         BALR  RBASE,R0                 ESTABLISH BASE AT TOP    Y02082 51066002
OIN11665 EQU   *                        CALCULATE TOP            Y02082 51066402
         LA    RBASE,0(RBASE)           INSURE HI-ORDER BYTE = 0 Y02082 51066802
         LA    RF,OIN11665-OIN00000     SET RF FOR BASE REG CALC Y02082 51068402
         SR    RBASE,RF                 SET RBASE AS BASE REG    Y02082 51069202
*                                                                Y02082 51070002
         LR    RPAR,R1                  LOAD PARM LIST ADDRESS   Y02082 51070802
         LR    RPARC,RPAR               INIT CURR PARM LIST ADDR Y02082 51071602
         L     RDCB,PLISTDCB(,RPARC)    GET DCB ADDRESS          Y02082 51072402
         LA    RWTGC,WTGENTRY-WTG(,RWTG) INIT CURR WTG ADDRESS   Y02082 51073202
         MVC   WTGIDTTR-WTGENTRY(L'WTGIDTTR,RWTGC),OPENNEXT 3A   Y02080 51078202
         L     RC,DXATCOM3              GET RRPLIST PTR          Y02144 51093702
         MVI   RRFUNCTN,RRFOPEN         INDICATE OPEN FUNCTION   Y02144 51098602
         LR    RD,RCORE                 SET GO SWITCH ON         Y02082 51103502
         L     RB,CVTPTR                GET CVT ADDRESS          Y02082 51108402
         L     RTIOT,DXTIOTAD           GET NEXT TIOT ENTRY ADDR Y02082 51113302
*                                       AS SET UP BY IFG0202L    Y02082 51118202
*                                                                       51118402
*        A NEW COPY OF THE DCB MUST BE CREATED - THE DEVICE      YM7983 51118502
*        TYPE AND, HENCE, THE SIZE OF THE DCB MAY HAVE CHANGED   YM7983 51119002
*                                                                       51119502
         L     RB,DXUDCBAD              SAVE USER DCB ADDRESS    YM7983 51120002
         ICM   RB,B'1000',DXUKEY        SAVE USER KEY            YM7983 51120502
         MVC   DXUDCBAD,DXPDCBAD        USER DCB = COPY DCB SO   YM7983 51121002
*                                       INIT BUILDS NEW COPY     YM7983 51121502
         MVI   DXUKEY,K5                SET KEY TO THAT OF COPY  YM7983 51122002
         IECRES INIT,DCBCOPY=TOWKAR,STM=(3,14,WTGPREFX) NEW COPY YM7983 51122502
*        REG 2 RETURNED POINTING TO NEW COPY OF OLD COPY         YM7983 51123002
         STCM  RB,B'0111',DXUDCBAD+K1   REESTABLISH USER DCB ADD YM7983 51123502
         STCM  RB,B'1000',DXUKEY        REESTABLISH USER KEY     YM7983 51124002
*        MERGE REAL USER DCB INTO NEW COPY                       YM7983 51124502
         IECRES INIT,DCBCOPY=TOWKAR,STM=(2,14,WTGPREFX) UPD.COPY YM7983 51125002
*        COPY CREATE CLOBBERS DXREG9-DXREGE, DXREG0-DXREG1       YM8542 51125502
         XC    DXREGE,DXREGE            IND INIT ENTRY 193A      YM8542 51126002
         XC    DXREG0,DXREG0            IND NO ERROR             YM8542 51126502
*                                                                       51127002
OIN11670 EQU   *                        CONTINUE                 X02989 51128002
         ST    RCORE,DCBDEBAD           SAVE CORE ADDR IN DCB    X02989 51132902
*                                                                       51168902
*        CONSTRUCT CONTROL BLOCKS TO READ JFCB                          51200021
*                                                                       51400021
*        DEB, FIRST 36-BYTE                                             51600021
*                                                                       51800021
*              LOAD CVT POINTER TO AVOID DEPENDENCY ON RB STILL  Y02134 51850002
*              CONTAINING IT SINCE LAST TIME IT WAS LOADED       Y02134 51900002
         L     RB,CVTPTR                LOAD CVT ADDRESS         Y02134 51950002
         L     R1,CVTSVDCB-CVT(,RB)     ADDRESS OF SVCLIB DCB    Y02080 52000002
         L     R1,DCBDEBAD-IHADCB(,R1)  ADDR OF TASK SCHEDULER DEB      52200021
         MVC   DXDEB(K48),0(R1)         COPY TASK SCHEDULER DEB         52400021
         MVI   DXDEB+(DEBNMEXT-DEBBASIC),K1 SET NO. EXTS TO 1   YA03003 52410002
         MVC   DXDEBAPP,CVTXAPG-CVT(RB) SET DUMMY APP V T        Y02080 52450002
         MVI   DXDEBMOD,K0              SET FILE MASK TO ZERO    YM6841 52460002
         XC    DXDEBECB+K1(K3),DXDEBECB+K1  ZERO PURGE ECB ADDR  M0032  52500021
         LA    RF,DXDCB                 STORE ADDR OF WORK DCB IN WORK  52600021
         ST    RF,DXDCBAD               DEB FOR EXCP VALIDITY CHECK     52800021
         ST    RF,IOBWGHT               STORE WORK DCB ADDR IN IOB      53000021
         MVI   DXDEBID,DEBIDENT         DEB ID                          53200021
*                                                                       53400021
*        ECB, NEXT 4-BYTE                                               53600021
*                                                                       53800021
*                                                                       54000021
*        DCB, NEXT 8-BYTE                                               54200021
*                                                                       54400021
         LA    RF,DXDEB                 STORE ADDR OF WORK DEB IN WORK  54600021
         ST    RF,DXDCBDEB              DCB FOR EXCP VALIDITY CHECK     54800021
*                                                                       55000021
*        IOB, NEXT 32-BYTE                                              55200021
*                                                                       55400021
         MVI   IOBFLAG1,IOBUNREL        MAKE I/O REQUESTS UNRELATED     55600021
         LA    RF,DXECB                 STORE ADDR OF WORK ECB IN       55800021
         ST    RF,IOBECBPT              WORK IOB                        56000021
         LA    RF,DXCCW1                STORE START CCW ADDR IN         56200021
         ST    RF,IOBSTART-K1           WORK IOB                        56400021
*                                                                       56600021
         LA    RET,TIOEJFCB             JFCB PREFIX POINTER      Y02134 69878002
         IECRES LOCJFCB,(RET)           LOCATE JFCB              Y02134 69928002
*                                                                Y02134 69930002
         MVC   DXJBF,0(RET)             MOVE JFCB TO WORK AREA   Y02134 69932002
*                                                                       69938000
         ST    RTIOT,DXREG9             SAVE RTIOT ACROSS XCTL   A39979 69941021
*                                                                       69944000
         MVI   DXECB,K32                INDICATE SUCCESSFUL READ        69950000
         TM    JFCBMASK+K6,JFCTRACE     IS TRACE ROUTINE DESIRED Y02080 69960002
         BZ    OIN10400                 NO, GO TO NEXT PARM      Y02080 69960402
         OI    WTGPATHS+K1,WTGTRACE     YES, SET TRACE INDR ON   Y02080 69960802
         B     OIN10400                 PROCESS NEXT PARM.              69962000
*                                                                       70000021
*********************************************************************** 70200021
*                                                                       70400021
*  IF NO DCB CAN BE OPENED, FREEMAIN WHERE-TO-GO TABLE                  70450021
*  AND EXIT TO CALLER OF OPEN                                           70500021
*                                                                       70550021
OIN13000 EQU   *                        CHECK FOR ERROR                 70600002
         LTR   RD,RD                    CHECK THE GO SWITCH             70800021
         BNZ   OIN13200                 BR IF ON                        71000021
*                                                                       71320021
         IECRES FREE,PREFIX=WTG,A=(RWTG) FREMAIN WTG TABLE       Y02080 71360002
*                                                                       71380021
         LA    RF,K8                    SET RETURN CODE TO 8     X02989 71530402
*                                                                       71600021
*                                                                Y02080 71650002
*        RETURN TO CALLER                                        Y02080 71700002
*                                                                Y02080 71750002
         IECRES EXIT                    RETURN                   Y02080 71800002
*                                                                Y02080 71950002
*                                                                       72000021
*********************************************************************** 72200021
*                                                                       72400021
*  INITIALIZE WHERE-TO-GO TABLE BASE FOR XCTL                           72600021
*                                                                       73600021
OIN13200 EQU   *                        SET UP FOR NEXT LOAD     A39979 74600002
         MVC   WTGMODNM,OIN1500A        SET LOWEST OPEN NAME     Y02080 77800002
*                                                                       78400021
*  XCTL TO NEXT LOAD OF OPEN                                            78600002
*                                                                       78800021
         OI    RRFLAGS2,RRFFIN1         SET 1ST LOAD COMPLETED   Y02144 79050002
         LR    RCORE,RD                 GET LAST VALID WORK AREA Y02080 79100002
         LM    RTIOT,RET,DXREG9         REST REGS FOR THIS DCB   Y02080 79150002
         LM    R0,R1,DXREG0             FOR BRANCH QUEUED        Y02080 79200002
         L     R5,CVTPTR                PTR CVT                  Y02080 79250002
         L     R5,CVTDMSR-CVT(,R5)      ADDRESS OF RESIDENT RTN  Y02080 79300002
         IECRES XCTL                    BRANCH QUEUED            Y02080 79350002
*                                                                       79600021
         DROP  RWTG                                                     79800021
*                                                                       80000021
OIN13250 EQU   *                        SYSZTIOT ENQ ERROR       YM2869 80005002
*     THE CALLER OF OPEN HOLDS THE TIOT RESOURSE EXCLUSIVELY.  @ZA29752 80010037
*     THIS SHOULD NEVER VALIDLY HAPPEN AND CANNOT BE ALLOWED.  @ZA29752 80020037
         SR    RF,RF                    ZERO REG               @ZA29752 80030037
         SR    RC,RC                    ZERO REG               @ZA29752 80040037
         LA    RF,K0                    RETURN CODE            @ZA29752 80050037
         L     RC,ABND50D               ABEND CODE             @ZA29752 80060037
         ABEND (RC),DUMP                                       @ZA29752 80110037
*********************************************************************** 80200021
*                                                                       80400021
*        CONSTANTS                                                      80600021
*                                                                       80800021
ABND50D  DS    0F                                              @ZA29752 80810037
         DC    XL4'0000050D'                                   @ZA29752 80820037
OIN1500A DC    CL8'IFG0190 '            LOWEST OPEN NAME         Y02080 80850002
OIN1500K WTO   'IEC130I DDNAMEXX DD STATEMENT MISSING',MF=L,           X81000021
               DESC=6,                  JOB STATUS                     X81200021
               ROUTCDE=(11)             PROGRAMMER INFORMATION          81400021
OIN1500L EQU   *-OIN1500K               LENGTH OF ERROR MESSAGE         81600021
         DS    0F                                                       81640000
ONEK     DC    X'00000400'              1024 BYTES FOR LENGTH CALC      81660000
OIN1500M WTO   'IEC132I DDNAMEXX, MACRF=E SPECIFIED FOR A SYSIN OR SYSOX81710000
               UT DATA SET',MF=L,                                      X81712000
               DESC=6,                  JOB STATUS                     X81714000
               ROUTCDE=(11)             PROGRAMMER INFORMATION          81716000
OIN1500N EQU   *-OIN1500M               LENGTH OF MESSAGE               81718000
*                                                                       85200021
         XCTLTABL ID=(OPEN,IGC0001I,OPENNEXT,3A,VSAMCATL,1X,   @Y30DSDT*85330037
               VSAMVRP,IFG0192Y),SVC=019,BRT=YES,LENGTH=       @Y30DSDT 85342037
*                                                                       85400021
         IECDSECS EXPAND=YES            EXPAND DESIRED DSECTS HERE      86000021
*                                                                       86200021
         END                                                            86400021
