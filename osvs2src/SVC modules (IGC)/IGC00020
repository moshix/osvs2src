         TITLE 'IGC00020 - CLOSE INITIAL MODULE'                        00200021
IGC00020 CSECT                                                          00800021
         ENTRY IGC01020                 ENTRY FROM EOV DURING    Y02082 00850002
*                                       UNLIKE CONCAT PROCESSING Y02082 00900002
*********************************************************************** 01000021
*                                                                       01050037
*               VS2-037 CHANGES                                         01100037
*A724800-725600,A761100                                        @ZA29752 01150037
*                                                                     * 01200021
*          VS2 RELEASE 03 DELETIONS                                   * 01210003
*0000343373,546337-546499                                       Y30ASJC 01220003
*0000414776                                                      ZM0798 01230003
*0000                                                           ZM30765 01240003
*          VS1 RELEASE 02 DELETIONS                                   * 01260002
*0000414520                                                      X02989 01270002
*0000                                                            XM0478 01280002
*0000762578                                                      XM1250 01290002
*0000                                                            XM1037 01290102
*          VS2 RELEASE 01 DELETIONS                                   * 01300000
*0000                                                            YM0903 01350000
*0000                                                            YM0850 01352000
*0000                                                            YM0954 01354000
*0000                                                            YM0992 01356000
*0000414280                                                      YM4395 01358000
*0000                                                           YA00180 01358402
*0000                                                           YA00312 01358802
*                                                                     * 01400021
*          RELEASE 21 DELETIONS/CHANGES                               * 02400021
*                                                                S21042 02600021
*                                                                M0001  02800021
*                                                                A37193 03000021
*                                                                M0039  03100021
*1141416000,682000                                               A38013 03150021
*0000442000,532000                                               M0115  03160021
* 528000-530000                                                  M1793  03170021
*0000568000                                                      M2275  03180021
*0000646000                                                      A49961 03190021
*0000478000,482000                                              SA53294 03192000
*                                                                     * 03200021
* MODULE NAME = IGC00020                                              * 03250002
*                                                                     * 03300002
* DESCRIPTIVE NAME = CLOSE INITIAL MODULE                             * 03350002
*                                                                     * 03360002
* COPYRIGHT = NONE                                                    * 03370002
*                                                                     * 03380002
* STATUS CHANGE LEVEL 000                                             * 03400021
*                                                                     * 03600021
* FUNCTION -                                                          * 03800021
*    THIS MODULE CONTAINS THE FUNCTION(S) OR PART(S) OF FUNCTION(S)-- * 04000021
*    CLOSE INITIALIZATION FUNCTION.                                   * 04200021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)' FOR DETAILS.         * 04400021
*                                                                     * 04600021
* ENTRY POINTS -                                                      * 04800021
*         IGC00020 - ENTRY WHEN AN SVC 20 OR A CLOSE MACRO-           * 05000021
*                    INSTRUCTION IS ISSUED.                           * 05200021
*         IGC01020 - ENTRY VIA BRANCH FROM EOV FOR               Y02082 05250002
*                    CONCATENATION WITH UNLIKE ATTRIBUTES.       Y02082 05300002
*                                                                     * 05400021
* INPUT -                                                             * 05600021
*    ENTERED IN SUPERVISOR KEY                                   Y02082 05650002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 05800021
*                                                                     * 06000021
* OUTPUT -                                                            * 06200021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 06250002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 06400021
*                                                                     * 06600021
* EXTERNAL REFERENCES -                                               * 06800021
*         IFG019RA - OPEN/CLOSE/EOV RESIDENT ROUTINE FOR XCTL AND     * 07000002
*                    WAIT.                                            * 07200021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 07400021
*                                                                     * 07600021
* EXITS, ERROR-                                                  XM1037 08750002
*    XCTL TO IFG0200V IF CLOSE NOT ENTERED FOR A VSAM CATALOG.   XM1037 08760002
*    XCTL TO IFG0200N IF CLOSE ENTERED FOR A VSAM CATALOG.       XM1037 08770002
*    EXIT VIA AN SVC 3 TO CALLING PROGRAM IN NONE OF THE DCB'S   XM1037 08780002
*      IN THE PARAMETER LIST CAN BE CLOSED.                      XM1037 08790002
*      THE WTG TABLE IS FREED AND THE TIOT IS DEQED USING        Y02134 08840002
*      THE IECRES MACRO                                          Y02134 08890002
*    EXIT IS TO THE PROBLEM DETERMINATION MODULE IFG0200P, IF AN      * 09200021
*    ABEND SITUATION OCCURS IN THIS MODULE.  REFER TO THE FOLLOWING   * 09400021
*    'FUNCTION PROLOG(S)'.                                            * 09600021
*    DMABCOND PCK IF CALLER HOLDS TIOT RESOURCE EXCLUSIVELY      YM7883 09605002
*                                                                     * 09800021
* TABLES/WORK AREAS -                                                 * 10000021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 10200021
*                                                                     * 10400021
* ATTRIBUTES -                                                        * 10600021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 10800021
*                                                                     * 11000021
* CHARACTER CODE DEPENDENCY -                                         * 11200021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 11400021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 11600021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 11800021
*                                                                     * 12000021
* NOTES -                                                             * 12200021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG(S)'.                     * 12400021
*                                                                     * 12600021
*********************************************************************** 12800021
         EJECT                                                          13000021
         USING TIOENTRY,RTIOT                                           13200021
         USING FORCORE,RCORE                                            13400021
         USING TCB,RET                                                  13600021
         USING IHADCB,RDCB                                              13800021
         USING UCBOB,RUCB                                               14000021
         USING DEB,RDEB                                                 14400021
         USING WTG,RWTG                                                 14600021
         USING WTGENTRY,RWTGC                                           14800021
*********************************************************************** 15000021
*                                                                     * 15200021
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        15400021
         USING *,RBASE                                                  15600021
CIN00000 EQU   *                        GET WTG TABLE            Y02082 15650002
*                                                                     * 15800021
*********************************************************************** 16000021
         EJECT                                                          16200021
*                                                                     * 16400021
*                          FUNCTION PROLOG                            * 16600021
*                                                                     * 16800021
*********************************************************************** 17000021
*                                                                     * 17200021
* FUNCTION NAME -                                                     * 17400021
*    CLOSE INITIALIZATION FUNCTION.                                   * 17600021
*                                                                     * 17800021
* (STATUS) -                                                          * 18000021
*    NOT APPLICABLE                                                   * 18200021
*                                                                     * 18400021
* FUNCTION -                                                          * 21250000
*    DETERMINE IF THE DCB IS TO BE CLOSED.                            * 21300000
*    OBTAIN MAIN STORAGE FOR THE WHERE-TO-GO TABLE BY            Y02134 21350002
*     BRANCHING TO THE RESIDENT ROUTINE. THIS WILL ALSO RESULT   Y02134 21352002
*     IN THE TIOT BEING ENQED.                                   Y02134 21354002
*    OBTAIN MAIN STORAGE FOR THE WORKAREA AND CLEAR IT. ONE WORKAREA  * 21360000
*    PER DCB PROCESSED.                                               * 21370000
*    CONSTRUCT CONTROL BLOCKS NEEDED TO PERFORM I/O OPERATION.        * 21380000
*    PURGE QUEUED AND ACTIVE I/O REQUESTS ASSOCIATED WITH DATA SETS   * 21390000
*    THAT ARE BEING ACCESSED ON THE EXCP LEVEL.                       * 21392000
*    DETERMINE WHICH STRING IS TO CONTINUE PROCESSING.                * 21394000
*    READ JFCB INTO THE WORKAREA.                                     * 21396000
*    DETERMINE IF SMF DATA SET INFORMATION IS REQUESTED.              * 21398000
*    OBTAIN MAIN STORAGE FOR THE ECBLIST.                             * 21398400
*    INTERFACE WITH THE TRACE INITIALIZATION FUNCTION IF OPTIONAL     * 21398800
*    TRACE FACILITY IS REQUESTED.                                     * 21399200
*    DEB VALIDITY CHECKING IS ACCOMPLISHED VIA A DEB VALIDITY CHECK   * 21399300
*    ROUTINE WHICH MAINTAINS AND UPDATES A TABLE OF VALID DEB POINTERS* 21399400
*    IN PROTECTED CORE (LSQS).                                        * 21399500
*                                                                     * 21399600
*    IF A DCB IS ENCOUNTERED, THE FIRST FOUR BYTES OF WHOSE      YM6804 21400502
*    DDNAME IS 'IMGL', IT IS ASSUMED THAT THIS IS AN IMAGELIB    YM6804 21401002
*    DCB WHICH WILL BE CLOSED BY ISSUING SVC 105 WITH THE DCB    YM6804 21401502
*    ADDRESS IN REGISTER 1. UPON RETURNING FROM THE SVC 105,     YM6804 21402002
*    THE CALLER OF CLOSE WILL BE RETURNED CONTROL WITH A         YM6804 21402502
*    RETURN CODE OF ZERO IF THE IMAGELIB DCB IS THE ONLY         YM6804 21403002
*    DCB IN THE PARAMETER LIST. IF THERE ARE OTHER DCBS,         YM6804 21403502
*    PROCESSING ON THEM WILL CONTINUE, BUT SINCE NO CLOSE        YM6804 21404002
*    WORKAREA WAS OBTAINED FOR THE IMAGELIB DCB, AN EVENTUAL     YM6804 21404502
*    ERROR RETURN CODE WILL BE RETURNED TO THE CALLER.           YM6804 21405002
*    THIS METHOD OF CLOSING AN IMAGELIB DCB IS NOT INTENDED TO   YM6804 21405502
*    BE USED BY ANY OTHER ROUTINE THAN TASK CLOSE IN THE EVENT   YM6804 21406002
*    THAT IMAGELIB IS NOT CLOSED BEFORE TASK TERMINATION.        YM6804 21406502
*                                                                     * 21406602
* ENTRY POINTS -                                                      * 21407002
*    ENTERED FROM THE FOLLOWING--                                     * 21600021
*    WHEN AN SVC 20 OR A CLOSE MACRO-INSTRUCTION IS ISSUED.           * 21800021
*    WHEN A BRANCH ENTRY IS MADE FROM EOV FOR                    Y02082 21850002
*    CONCATENATION WITH UNLIKE ATTRIBUTES.                       Y02082 21900002
*                                                                     * 22000021
* INPUT -                                                             * 22200021
*    A POINTER IN REGISTER 1 TO THE PARAMETER LIST.                   * 22400021
*    FOR TSO TASKS WITH CONCATENATION OF UNLIKE ATTRIBUTES, REG 5     * 22500000
*    WILL CONTAIN THE VALUE 0 UPON ENTRY TO CLOSE IF EOV DID NOT      * 22550000
*    ISSUE A SUCCESSFUL ENQ ON THE TIOT.  REG 5 WILL CONTAIN THE      * 22560000
*    VALUE 1 IF EOV'S ENQ WAS SUCCESSFUL.                             * 22570000
*                                                                     * 22600021
* OUTPUT -                                                            * 22800021
*    A POINTER TO EACH OF THE FOLLOWING--                             * 23000021
*       CURRENT PARAMETER LIST ENTRY- RPARC                           * 23200021
*       DD ENTRY IN THE TIOT- RTIOT                                   * 23400021
*       WTG TABLE- RWTG                                               * 23600021
*       CURRENT WTG TABLE ENTRY- RWTGC                                * 23800021
*       DCB- RDCB                                                     * 24000021
*       WORK AREA- RCORE                                              * 24200021
*       RESIDENT ROUTINE- RES                                         * 24400021
*       UCB- RUCB                                                     * 24600021
*       DEB- RDEB                                                     * 24800021
*    THE JFCB IS IN THE WORKAREA.                                     * 25000021
*                                                                     * 25200021
* EXTERNAL REFERENCES -                                               * 25400021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 25600021
*    CONVERT ROUTINE TTR TO MBBCCHHR.                                 * 25800021
*                                                                     * 26000021
* EXITS, NORMAL -                                                     * 26200021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 26400021
*    CLOSE TAPE ACCESS METHOD EXECUTOR INTERFACE FUNCTION.            * 26600021
*    CLOSE UNIT RECORD/TELEPROCESSING FUNCTION.                       * 26800021
*    CLOSE DA READ DSCB FUNCTION.                                     * 27000021
*                                                                     * 27200021
* EXITS, ERROR -                                                      * 27400021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 27600021
*    EXIT WITH ONE OF THE FOLLOWING INTERNAL CODES--                  * 27800021
*       111 - 514 ABEND - I/O ERROR READING JFCB.                     * 28000021
*       112 -           - INVALID CONTROL BLOCK(S) FOUND.             * 28200021
*                                                                     * 28400021
* TABLES/WORK AREAS -                                                 * 28600021
*    THE OPEN, CLOSE, OR EOV WORK AREA AND THE WHERE-TO-GO (WTG)      * 28800021
*    TABLE ARE DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.     * 29000021
*                                                                     * 29200021
* ATTRIBUTES -                                                        * 29400021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 29600021
*                                                                     * 29800021
* CHARACTER CODE DEPENDENCY -                                         * 30000021
*    REFER TO THE PRECEEDING MODULE PROLOG.                           * 30200021
*                                                                     * 30400021
* NOTES -                                                             * 30600021
*    NOT APPLICABLE                                                   * 30800021
*                                                                     * 31000021
*********************************************************************** 31200021
         EJECT                                                          31400021
*                                                                       31600021
*****          INITIALIZATION                                           31800021
*                                                                       32000021
*********************************************************************** 33190000
*                                                                       33192000
*        GETMAIN THE WHERE-TO-GO TABLE                                  33194000
*                                                                       33196000
*                                                                Y02080 33198502
* SAVE REGISTERS 2-12 IN SVRB EXTENDED SAVE AREA                 Y02080 33198602
*                                                                Y02080 33198702
         L     RF,CVTPTR                GET POINTER TO CVT       Y02080 33205102
         L     RF,CVTTCBP-CVT(,RF)      GET TCB WORDS            Y02080 33207102
         L     RF,K4(,RF)               TCB ADDRESS              Y02080 33209102
         L     RF,K0(,RF)               POINTER TO SVRB          Y02080 33211102
         USING RBBASIC,RF                                        Y02080 33213502
*                                                                Y02080 33216302
         IECRES GET,PREFIX=WTG,            GETMAIN FOR WTG TABLE Y02080*33218702
               STM=(2,12,RBEXSAVE),A=(1)                         Y02080 33221102
*                                                                       33221402
* IF REG 0 IS NONZERO, IT IS BECAUSE THE CALLER HAS ENQUEUED     YM7883 33221702
* EXCLUSIVELY ON THE TIOT. THIS CAN NOT BE TOLERATED.            YM7883 33222002
*                                                                       33222302
         LTR   R0,R0                    IS R0 ZERO               YM7883 33222602
         BNZ   CIN01705                 BRANCH IF NOT            YM7883 33222902
*                                                                       33223502
* RETURN FROM GET IN DATAMGT KEY                                 Y02082 33225502
*                                                                       33225602
         DROP  RF                                                Y02080 33225902
         LR    RWTG,R1                  WTG ADDR TO RWTG REG     Y02080 33228302
         IECRES LOAD,PREFIX=WTGPREFX,MODNM=CLOSE,BRANCH=NO       Y02080*33243502
                                        GIVE OPT TRACE A SHOT    Y02080 33293502
         XC    WTGMODEP,WTGMODEP        CLEAR ADDR NEXT MOD      Y02080 33303502
CIN00075 EQU   *                        INITIALIZE POINTERS      Y01018 33353202
         L     RPAR,WTGPREFX            PT TO BASE               Y02134 33363202
         L     RC,IECRRPRM-IECPREFX(,RPAR) GET RRPLIST ADDRESS   Y02144 33364402
         MVI   RRFUNCTN-RRPLIST(RC),RRFCLOS  INDICATE CLOSE      Y02144 33366802
         L     RPAR,IECUPRML-IECPREFX(,RPAR) PT COPY USER PLIST  Y02134 33367002
         LR    RPARC,RPAR               SET CURRENT TO FIRST     Y02134 33368602
         SR    RC,RC                    SET GO SWITCH TO 0       YM0903 33370202
         LA    RWTGC,WTGENTRY-WTG(,RWTG) GET CURRENT WTG ENTRY   Y02134 33371802
CIN00100 EQU   *                                                        33375002
*                                                                Y02134 34010102
* SEMI-FORCED CLOSE ON IMAGELIB                                  Y02134 34010402
*                                                                Y02134 34010802
         L     RDCB,PLISTDCB(,RPARC)    LD ADDR OF ACB/DCB       Y02134 34011202
         L     RET,CVTPTR               GET POINTER TO CVT       Y02080 34012102
         L     RET,CVTTCBP-CVT(,RET)    GET TCB WORDS            Y02080 34012202
         L     RET,K4(,RET)             TCB ADDRESS              Y02080 34012302
         MODESET EXTKEY=RBT234,WORKREG=1 USER'S KEY              Y02134 34012402
         CLC   DCBDDNAM(K4),IMGDDNAM    IS THIS IMGLIB DCB      YA00180 34012802
         BNE   CIN0010A                 NO  BRANCH              YA00180 34013202
         LR    K1,RDCB                  YES  DET DCB ADDRESS    YA00180 34013602
         SVC   105                      ISSUE IMGLIB CLOSE      YA00180 34014002
         TM    PLISTOPT(RPARC),LASTNTRY LAST ENTRY IN THE PLIST  YM6804 34014202
         BNO   CIN01500                 BRANCH IF NOT            YM6804 34014402
         CR    RPAR,RPARC               IS THIS THE ONLY ENTRY   YM6804 34014602
*                                       IN THE PARM LIST         YM6804 34014802
         BNE   CIN01500                 BRANCH IF NO             YM6804 34015002
         MODESET EXTKEY=DATAMGT         RETURN TO D.M. KEY       YM6804 34015102
         LA    RTIOT,K0                 ZERO RETURN CODE         YM6804 34015702
         B     CIN01700                 EXIT                     YM6804 34016002
*                                                                Y02134 34016102
CIN0010A EQU   *                        TEST DUPLICATE DCB ADDR  YM2869 34018102
*                                                                       34018202
*        DON'T PROCESS DCB IF IT IS PREVIOUSLY DUPLICATED IN     YM2869 34018302
*        THE PARAMETER LIST                                      YM2869 34018402
*                                                                       34018502
         DROP  RWTGC                                             YM2869 34018602
         LA    R1,WTGENTRY              FIRST DCB'S WTG ENTRY    YM2869 34018702
         USING WTGENTRY,R1                                       YM2869 34018802
CIN0010C EQU   *                        CHECK EACH DCB           YM2869 34018902
         CR    R1,RWTGC                 ARE WE AT CURRENT DCB    YM2869 34019002
         BE    CIN0010G                 BR IF YES-NO DUPLICATES  YM2869 34019102
         L     RCORE,WTGCORE-K1         GET WORKAREA IF ANY      YM2869 34019202
         LA    RCORE,K0(,RCORE)         CLEAR FOR LTR            YM2869 34019302
         LTR   RCORE,RCORE              IS WORKAREA PRESENT      YM2869 34019402
         BZ    CIN0010E                 BR IF NO TO CHECK NEXT   YM2869 34019502
         CLM   RDCB,B'0111',DXUDCBAD+K1 IS CURRENT DCB BEING     YM2869 34019602
*                                       PROCESSED ALREADY        YM2869 34019702
         BE    CIN01500                 BR IF YES TO AVOID IT    YM2869 34019802
CIN0010E EQU   *                        GET NEXT DCB'S WTG ENTRY YM2869 34019902
         LA    R1,WTGENTRY+L'WTGENTRY   INCREMENT WTG ENTRY PTR  YM2869 34020002
         B     CIN0010C                 CHECK NEXT DCB           YM2869 34020102
         DROP  R1                                                YM2869 34020202
         USING WTGENTRY,RWTGC                                    YM2869 34020302
CIN0010G EQU   *                        NO DUPLICATES            YM2869 34020402
         TM    DCBOFLGS,DCBOLOCK        IS LOCK BIT OFF (1)      X02989 34021202
         BNO   CIN01500                 BR IF NO                 Y02134 34024802
         TM    DCBOFLGS,DCBOBUSY        BUSY BIT ALREADY ON?     Y02134 34028402
         BO    CIN01500                 BR IF YES-NO WORKAREA    Y02134 34032002
         TM    DCBOFLGS,DCBOPEN         OPEN BIT ON?             Y02134 34032402
         BNO   CIN01460                 BR IF NO                 Y02134 34032802
         LA    R0,CLOSSIZE              SIZE OF CLOSE WORKAREA   Y02134 34034002
*****                                                                   34036002
*****          TEST FOR DEFERRED TRAILER LABEL PROCESSING ON NSL Y02134 34037302
*****          VOLUME AT EOF TIME                                Y02134 34039302
*****                                                                   34039702
         TM    DCBMACRF,DCBMEXCP        EXCP DCB                 Y02134 34039802
         BO    CIN00101                 BRANCH IF YES            Y02134 34039902
         TM    DCBDSRG2,ACBDORGA        ACB/AMB                  Y02134 34040002
         BNO   CIN00101                 BRANCH IF NO             YM4688 34040602
         CLI   AMBID-IDAAMB(RDCB),AMBIDENT  TEST FOR AMB         YM4688 34040702
         BE    CIN01500                 BRANCH IF AMB            YM4688 34040802
         B     CIN00105                 BRANCH IF ACB            YM4688 34040902
CIN00101 EQU   *                        TEST FOR EOF AND NSL     Y02134 34041002
         L     RDEB,DCBDEBAD            ADDR OF CURRENT DEB      Y02134 34041402
         TM    DEBOFLGS,DEBOFEOF+DEBOFNSL  EOF AND NSL ON THIS   Y02134 34041502
*                                       DCB                      Y02134 34041602
         BNO   CIN00105                 NO,CONTINUE NORMAL CLOSE Y02134 34041702
         L     R1,DCBEXLST              ADDR OF DCB EXIT LIST    Y02134 34041802
         LA    R1,0(,R1)                CLEAR HIGH ORDER BYTE    Y02134 34041902
         LTR   R1,R1                    IS THERE AN ADDR PRESENT Y02134 34042302
         BZ    CIN00105                 NO,CONTINUE NORMAL CLOSE Y02134 34042402
         LA    R0,DXEWAEND-FORCORE      SPECIFY EOV WKAR SIZE    YM3062 34042502
CIN00103 EQU   *                        CHECK EXIT LIST          Y02134 34042702
         CLI   0(R1),XLDEFNSL           EXIT LIST CODE BYTE      Y02134 34043502
*                                       MATCH?                   Y02134 34043602
         BE    CIN00105                 YES,GO GET MORE          Y02134 34043702
*                                       CORE FOR EOV             Y02134 34043802
         CLI   0(R1),XLDEFNSL+LASTNTRY  EXIT LIST LAST CODE BYTE Y02134 34043902
*                                       MATCH?                   Y02134 34044002
         BE    CIN00105                 YES,GO GET MORE          Y02134 34044202
*                                       CORE FOR EOV             Y02134 34044302
         TM    0(R1),LASTNTRY           LAST CODE BYTE IN LIST   Y02134 34044502
         LA    R1,K4(,R1)               INCR CODE BYTE POINTER   Y02134 34044602
         BNO   CIN00103                 NO,GO CHECK NEXT         Y02134 34044702
         LA    R0,CLOSSIZE              SIZE OF WORK AREA RQD    Y02134 34044802
         SPACE 1                                                        34044902
*        GET CORE FOR CONTROL BLOCKS FOR THIS PARTICULAR DCB     Y02134 34045002
CIN00105 EQU   *                        GET DCB WORK AREA        Y02134 34045102
         MODESET EXTKEY=DATAMGT         KEY OF REG SAVE AREA     Y02134 34046002
*                                                                       34048602
         IECRES GET,LV=(0),PREFIX=YES,STM=(2,14,WTGPREFX),       Y02134*34049502
               ID=CLWA                  GETMAIN FOR WORK AREA    Y02144 34050402
*                                                                       34051302
*        STORE THE ADDRESS OF THE GOTTEN CORE IN ITS PROPER      Y02134 34052202
*        PLACE IN THE WTG TABLE                                  Y02134 34053102
*                                                                       34054002
         LR    RCORE,R1                 SET UP BASE WORK AREA    Y02134 34054902
         LR    RC,RCORE                 SET GO SWITCH            Y02080 34055302
*                                                                       34055802
*        PLACE ADDRESS OF CONTROL BLOCK CORE IN WTG TABLE        Y02134 34056702
*        FOR THIS PARTICULAR DCB                                 Y02134 34057602
*                                                                       34058502
         ST    RCORE,WTGCORE-K1         STORE WORK AREA ADDRESS  Y02134 34059402
         MVC   WTGIDTTR,INITMOD         SET DEFAULT NEXT MODULE  Y02080 34060302
         L     RF,WTGPREFX              GET ADDR OF PREFIX       Y02144 34064002
         L     RF,IECRRPRM-IECPREFX(,RF) GET RRPLIST PTR         Y02144 34064902
         ST    RF,DXATCOM3              SAVE RRPLIST PTR IN W/A  Y02144 34065802
         IECRES INIT,DEB=YES,DCBCOPY=TOWKAR,STM=(3,14,WTGPREFX)  Y02134 34066702
         CLI   DXWCOPYE,K0              CHECK IF ERROR           Y02134 34067602
         BNE   CIN00808                 BR IF ERROR IN INIT      Y02134 34068502
*                                                                Y02083 34069002
*        IF A CHECKPOINT DATA SET SECURITY INTERFACE EXISTS;     Y02083 34069102
*        FREE THE COPY OF THE USER'S DCB AND COPY THE            Y02083 34069302
*        PROTECTED DCB.                                          Y02083 34069602
*                                                                Y02083 34069702
         L     RF,DXDSAB                FETCH DSAB ADDRESS       Y02083 34069802
         LTR   RF,RF                    IS THERE A DSAB PTR      YM1342 34069902
         BZ    CIN00102                 BRANCH IF NO             YM1342 34070102
         USING DSAB,RF                  ADDRESS DSAB             Y02083 34070302
         TM    DSABFLG4,DSABCKSI        Q - CHKPT SI PRESENT     Y02083 34070402
         BZ    CIN00102                 IF NOT, BRANCH           Y02083 34070502
         DROP  RF                       DSAB ADDRESSABILITY      Y02083 34070602
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02083 34070702
         L     RDCB,DEBDCBAD            GET PROTECTED DCB ADDRESSY02083 34070802
         ST    RDCB,DXUDCBAD            UPDATE WA USER DCB ADDR  Y02083 34070902
         MVI   DXUKEY,K0                SET USER KEY TO ZERO     Y02083 34071002
         L     R1,DXPDCBAD              GET ADDR OF COPIED DCB   Y02083 34071102
*                                       TO BE FREED              Y02083 34071202
         IECRES FREE,A=(R1),PREFIX=YES,STM=(2,14,WTGPREFX)       Y02083 34071502
         MVC   DXPDCBAD,DXUDCBAD        TELL INIT TO COPY        Y02083 34071602
         IECRES INIT,DCBCOPY=TOWKAR,STM=(3,14,WTGPREFX)          Y02083 34072002
         CLI   DXWCOPYE,K0              CHECK FOR ERROR          Y02083 34072102
         BNE   CIN00808                 BR IF ERROR IN INIT      Y02083 34072202
         OI    DCBOFLGS,DCBOBUSY        TURN ON BUSY BIT         YM5932 34076502
*                                       IN COPIED DCB            YM5932 34078502
         L     RF,DXUDCBAD              GET PTR TO USER DCB      YM5932 34079702
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET USER KEY         YM5932 34080502
         OI    DCBOFLGS-IHADCB(RF),DCBOBUSY  TURN ON BUSY BIT    YM5932 34080902
*                                       IN USER DCB              YM5932 34081302
         MODESET  EXTKEY=DATAMGT        RESUME DM KEY            YM5932 34081502
CIN00102 EQU   *                        TEST DCBOFLAGS           Y02083 34082102
         TM    DCBOFLGS,DCBOLOCK+DCBOPEN+DCBOBUSY                Y02134 34085702
         BNO   CIN00808                 BR IF NOT ALL ON         Y02134 34090002
CIN00106 EQU   *                        CHECK VSAM CATALOG       X02989 34094302
         L     RTIOT,DXTIOTAD           TIOT ADDRESS             Y02080 34098602
         L     RUCB,DXUCBADR            ESTABLISH UCB ADDR       Y02080 34102902
         L     RDEB,DCBDEBAD            GET DEB ADDR             Y02080 34107202
         NI    DCBOFLGS,X'FF'-DCBOCON   INSURE EOVC BIT = 0      Y02082 34111502
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    Y02080 34115802
         BO    CIN00602                 YES - DO DEB CHK         Y02080 34120102
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  Y02080 34124402
         BNO   CIN00601                 NO - DO DEBCHK           Y02080 34128702
         USING IFGACB,RDCB              DEFINE BASE TO ACB       Y02080 34133002
         XC    ACBERFLG,ACBERFLG        RESET ACB ERROR FLAGS    Y02080 34137302
         CLI   ACBAMETH,ACBSUBS         SUBSYSTEM ACB?           Y02120 34187302
         BE    CIN00602                 YES - DO DEBCHK          Y02120 34237302
         CLI   ACBAMETH,ACBVTAM         VTAM DCB?                YM3011 34287302
         BE    CIN00200                 YES - DO DEBCHK         Y30ASJC 34337303
         TM    ACBINFL,ACBCAT+ACBSCRA+ACBUCRA  TEST VSAM CATLG @Y30DSDT 34387337
         BZ    CIN00110                 SKIP IF NOT VSAM CATLOG@Y30DSDT 34487337
         XR    RET,RET                  SET RETURN CODE TO 200V  Y02080 34537302
         STC   RET,DXRETCOD             RET CODE FOR INIT ENTRY  Y02080 34587302
         MVC   DXRETMOD,INITMOD         RET FROM CATLG TO 200V   Y02080 34637302
         MVC   WTGIDTTR,VSCATMOD        SET NEXT MOD VSAM CTLG   Y02080 34737302
         B     CIN00650                 CONTIN PROC VSAM CATLG   Y02080 34787302
CIN00110 EQU   *                        CHECK VSAM               Y02080 34837302
         CLI   ACBAMETH,ACBVSAM         VSAM ACB?                Y02134 41460202
         BNE   CIN00808                 BRANCH IF NO             Y02134 41460302
         B     CIN00650                 CONTINUE                 Y02134 41462802
*                                                                       41463203
*********************************************************************** 41463603
*                                                                       41464003
*        LINK TO VTAM ACDEB VALIDITY CHECK ROUTINE                      41464403
*                                                                       41464503
*              EP=ISTOCMDC                                              41464603
*              R0=ACB COPY PTR                                          41464703
*              R1=USER ACB PTR                                          41465503
*              R13=18 FW KEY 5 SAVE AREA                                41465903
*              R14=RETURN ADDRESS                                       41466303
*              R15=EP ADDRESS OF ISTOCMDC                               41467103
*              R2-R12 RESTORED                                          41467503
*                                                                       41467903
*********************************************************************** 41468803
*                                                                       41469203
CIN00200 EQU   *                        LINK TO VTAM ISTOCMDC   Y30ASJC 41469903
*                                                                       41470303
         L     R0,DXPDCBAD              ACB COPY PTR            Y30ASJC 41470403
         L     R1,DXUDCBAD              USER ACB PTR            Y30ASJC 41471103
         L     RD,WTGPREFX              18 FW SAVE AREA         Y30ASJC 41471503
         LA    RD,IECREGSV-IECPREFX(,RD) PTR TO 18 FW SAVE AREA ZM30765 41471603
*                                                                       41471903
         IECRES LOAD,MODNM=ISTOCMDC,BRCODE=CIN00250,            Y30ASJCX41472003
               BRANCH=DIRECT,PREFIX=WTGPREFX                    Y30ASJC 41472103
*                                                                       41472303
CIN00250 EQU   *                        RETURN FROM ISTOCMDC    Y30ASJC 41472703
*                                                                       41473303
         MODESET EXTKEY=DATAMGT         DM KEY                  Y30ASJC 41474203
         LR    RET,RF                   SAVE RETURN CODE         ZM0798 41474303
*                                                                       41474603
         IECRES LOAD,PREFIX=WTGPREFX,MODNM=CLOSE,BRANCH=NO      Y30ASJC*41474903
                                        GIVE OPT TRACE A SHOT   Y30ASJC 41475403
         XC    WTGMODEP,WTGMODEP        CLEAR ADDR NEXT MOD     Y30ASJC 41475803
*                                                                       41477003
         LTR   RET,RET                  INVALID VTAM ACB         ZM0798 41477603
         BZ    CIN01450                 BRANCH IF OK            Y30ASJC 41477803
         MVC   DXRETMOD,PDMOD           INDICATE ERROR          Y30ASJC 41479503
         B     CIN00830                 BRANCH IF NOT ACDEB     Y30ASJC 41482003
*                                                                       41483603
         USING IHADCB,RDCB              REDEFINE BASE TO DCB     Y02080 41485203
*                                                                       41486803
*    BYPASS DEBCHK IF BTAM OR SPOOLED DCB                        Y02120 41488403
*                                                                       41490003
CIN00601 EQU   *                        CHECK BTAM               Y02120 41491603
         TM    DCBDSRG1,DCBDSGCX        BTAM?                    Y02120 41493203
         BO    CIN00650                 BRANCH IF YES            Y02120 41494803
CIN00602 EQU   *                        INITIALIZE DEB REG       Y02120 41496403
         L     RET,DXTCBADR             RELOAD TCB ADDRESS       Y02134 41498002
         LA    RDEB,K4(,RET)            POINT RDEB TO TCBPIE SO  A38013 41500021
*                                       THAT NEXT INST. WILL GET        41600021
*                                       THE DEB ADDR                    41700021
*    CHECK THE DEB CHAIN OFF OF THE TCB FOR VALID DCB'S          YM3017 41750002
*    FOR A SPOOLED DCB THE DEBECBAD POINTS TO THE DCB.           YM3017 41760002
*                                                                YM3017 41770002
CIN00610 EQU   *                                                        41800021
         L     RDEB,DEBDEBAD            GET DEB ADDR                    42000021
         LA    RDEB,0(,RDEB)            CLEAR REG HI-ORDER BYTE         42200021
         LTR   RDEB,RDEB                ANY DEB ADDR                    42400021
         BZ    CIN00808                 NO, BR TO SET ERROR      Y02080 42600002
         TM    DCBDSRG2,DCBACBM         IS IT AN ACB             YM3062 42610002
         BO    CIN00620                 YES, GO CHECK DEBDCBAD   YM3062 42620002
         TM    TIOELINK,TIOTSPOL        IS IT A SPOOLED DCB      YM3017 42650002
         BZ    CIN00620                 NO, CHECK DEBDCBAD       YM3017 42700002
         CLC   DEBECBAD+K1(K3),DXUDCBAD+K1 CHECK DEBECBAD        YM3017 42750002
         B     CIN00630                 BRANCH TO CONTINUE LOOP  YM3017 42760002
CIN00620 EQU   *                        NOT A SPOOLED DCB        YM3017 42770002
         CLC   DEBDCBAD+K1(K3),DXUDCBAD+K1 CHK IF DEB PTS TO DCB Y02134 42800002
CIN00630 EQU   *                        DO DCB POINTERS MATCH    YM3017 42850002
         BNE   CIN00610                 NO, GO CHK NEXT DEB             43000021
         L     R1,DCBDEBAD              GET DEB ADDR FROM DCB           43200021
         LA    R1,0(,R1)                CLEAR HI-ORDER BYTE             43400021
         CR    RDEB,R1                  IS DEB ADDR IN DCB OK           43600021
         BNE   CIN00610                 CONTINUE DEB  SEARCH    SA51581 43800002
CIN00650 EQU   *                                                        44600021
*                                                                       52614002
*        BYPASS DEBCHK FOR VSAM, BTAM.                           Y02120 52616002
*                                                                       52618002
*        FOR A SPOOLED DCB THE DEBDCBAD POINTS TO AN ACB - THE   Y02120 52618402
*        DEBECBAD POINTS TO THE DCB                              Y02120 52618802
*                                                                       52619202
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP           52620000
         BO    CIN00810                 YES-GO CHECK FOR SPOOLED DCB    52630000
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB         52640000
         BNO   CIN00807                 NO-TEST FOR BTAM, SPOOL  Y02120 52650002
         CLI   ACBAMETH-IFGACB(RDCB),ACBVSAM  IS ACB FOR VSAM    X02989 52652002
         BNE   CIN00810                 BR IF NO: DEBCHK         Y02120 52654002
         B     CIN01450                 PROC NEXT ENTRY          Y02080 52658002
CIN00807 EQU   *                        SPOOLED DCB OR BTAM      Y02120 52668002
*                                                                       52718002
*        BYPASS DEBCHK FOR BTAM.                                 Y02120 52728002
*        DO SPECIAL PROCESSING FOR SPOOLED DCB.                  Y02120 52730002
*                                                                       52738002
         TM    DCBDSRG1,DCBDSGCX        BTAM?                    Y02120 52740002
         BO    CIN00830                 BRANCH IF YES            Y02120 52742002
         TM    TIOELINK,TIOTSPOL        SPOOLED DCB?             Y02120 52742402
         BZ    CIN00810                 BRANCH IF NO             Y02120 52742802
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02120 52743202
         LA    RDEB,K0(RDEB)            CLEAR FOR COMPARE        Y02120 52743602
         CLC   DEBECBAD+K1(K3),DXUDCBAD+K1 DEB -> TO OUR DCB?    Y02120 52743702
         BNE   CIN00808                 BRANCH IF NO             Y02120 52743802
         L     R1,DEBDCBAD              ACB ADDRESS              Y02120 52743902
         DEBCHK (R1),AM=SUBSYS          IS DEB VALID?            Y02120 52744002
         CR    RDEB,R1                  IS IT OUR DEB?           Y02120 52793902
         BE    CIN00830                 BRANCH IF YES            Y02120 52803902
CIN00808 EQU   *                        ERROR                    Y02120 52815902
         MVC   DXRETMOD,PDMOD           MOVE IN P.D. MOD ID      Y02120 52817902
* TURN OFF THE BUSY BIT IN BOTH THE USER AND COPIED DCB'S        YM7304 52818302
         NI    DCBOFLGS,ALLBITS-DCBOBUSY                         YM7304 52818702
         L     RF,DXUDCBAD              POINT TO USER'S DCB      YM7304 52819102
         MODESET KEYADDR=DXUKEY,WORKREG=1                        YM7304 52819502
         NI    DCBOFLGS-IHADCB(RF),ALLBITS-DCBOBUSY              YM7304 52819602
         MODESET EXTKEY=DATAMGT         RETURN TO DM KEY         YM7304 52819702
         B     CIN00830                 GO GET ERROR CODE        Y02120 52819902
CIN00810 EQU   *                        VALIDATE DEB             Y02120 52823902
*        VALIDATE DEB                                            Y02120 52833902
*                                                                       52835902
         L     R1,DXUDCBAD              POINT TO USER'S DCB      Y02082 52839902
         DEBCHK (R1)                    VALIDATE DEB             Y02082 52841902
         LR    RDEB,R1                  LOAD VERIFIED DEB ADDR   Y01021 52843902
         STCM  RDEB,B'0111',DCBDEBAD+K1 REFRESH DCBCOPY'S DEBAD  Y02082 52893902
CIN00830 EQU   *                        TEST FOR ERROR           Y02120 52993902
         CLC   DXRETMOD,PDMOD           ERROR INDICATED          Y02080 53200002
         BNE   CIN00845                 NO,CONSTRUCT CONTROL BLOCKS     53400002
         LA    R0,CABD112               ERR- INVALID CNTRL BLOCK        53600021
*    THE CALLING MOD ID 'DXCALLID' WILL BE SET IN IFG0200V.      YM6507 53650002
         B     CIN01450                 BRANCH TO P. D. RTN             54400002
*                                                                Y02082 54450002
**************************************************************** Y02082 54460002
*                                                                Y02082 54470002
**  1. THE FOLLOWING LABEL (IGC01020) IS THE ENTRY POINT TO      Y02082 54500002
**     CLOSE FROM EOV FOR THE FOLLOWING PURPOSES:                Y02082 54520002
**        (A) UNLIKE CONCATENATION PROCESSING.                   Y02082 54550002
**        (B) CLOSING OF A DCB IF AN EOV ERROR IS TO BE IGNORED. Y02082 54550102
**  2. REGISTER R1 CONTAINS A POINTER TO A SINGLE-MEMBER         Y02082 54550402
**     CLOSE PARAMETER LIST.                                     Y02082 54551202
**  3. THE EOV WORK AREA (WHICH INCLUDES THE WTG TABLE) IS       Y02082 54552002
**     PASSED TO CLOSE, WITH REGISTER RCORE ALREADY              Y02082 54554002
**     INITIALIZED WITH THE WORK AREA ADDRESS. THE EOV WTG       Y02082 54560002
**     TABLE BEGINS AT 'DXXMODNM' IN THE EOV WORK AREA.          Y02082 54562002
*                                                                Y02082 54570002
IGC01020 EQU   *                        EOV ENTRY                Y02082 54580002
         BALR  RBASE,K0                 ESTABLISH ADDR           Y02082 54590002
CIN00840 EQU   *                        RESET BASE               Y02082 54590102
         LA    RBASE,0(RBASE)           INSURE HI-ORDER BYTE = 0 Y02082 54592002
         LA    RF,CIN00840-CIN00000     SET RF FOR BASE REG CALC Y02082 54592802
         SR    RBASE,RF                 SET RBASE AS BASE REG    Y02082 54593202
*                                                                Y02082 54593702
         LR    RPAR,R1                  LOAD PARM LIST ADDRESS   Y02082 54594002
         LA    RWTG,DXXMODNM            SET UP WTG TABLE ADDRESS Y02082 54596002
         LR    RPARC,RPAR               INIT CURR PARM LIST ADDR Y02082 54598002
         L     RDCB,PLISTDCB(,RPARC)    GET DCB ADDRESS          Y02082 54598402
         LA    RWTGC,WTGENTRY-WTG(,RWTG) INIT CURR WTG ADDRESS   Y02082 54598802
         XC    WTGMODEP,WTGMODEP        CLEAR ENTRY POINT        Y02080 54599202
         MVC   WTGIDTTR,INITMOD         SET NEXT MOD             Y02080 54599702
         L     RTIOT,DXTIOTAD           GET TIOT DD ENTRY ADDR   Y02082 54599902
         L     RUCB,DXUCBADR            SET UP UCB ADDRESS       Y02082 54626602
         LR    RC,RCORE                 SET GO SWITCH            Y02080 54628602
         L     RDEB,DCBDEBAD            SET UP DEB ADDRESS       Y02082 54630602
         LA    RDEB,0(RDEB)             CLEAR HI-ORDER BYTE      Y02082 54632602
         L     RF,DXATCOM3              GET ADDR OF RRPLIST      Y02144 54633002
         MVI   RRFUNCTN-RRPLIST(RF),RRFCLOS  SET CLOSE FUNCTION  Y02144 54633402
CIN00845 EQU   *                        CHECK FOR DUMMY         Y30ASJC 54633703
*                                                                       54650021
*        FOR DUMMY DATA SETS, NO JFCB IS READ. THEREFORE,               54700021
*        THERE IS NO NEED TO BUILD THE CONTROL BLOCKS.                  54750021
*                                                                       54760021
         TM    TIOELINK,TIOTSPOL        SPOOLED DATA SET         Y02120 54762002
         BM    CIN00860                 BRANCH IF YES            Y02120 54764002
         LTR   RUCB,RUCB                TEST FOR NULL DATA SET   M1793  54770021
         BZ    CIN01450                 Y - PROC NEXT DCB ENTRY  Y02080 54780002
CIN00860 EQU   *                        RESET TCB PTR            Y02120 54790002
         L     RD,CVTPTR                PT CVT                   Y02080 54792002
         USING CVT,RD                   CVT ADDR                 Y02080 54794002
         L     RET,DXTCBADR             TCB ADDR                 Y02080 54796002
         USING TCB,RET                  TCB ADDR                 Y02080 54798002
*                                                                       54800021
*                                                                       55000021
*        CONSTRUCT CONTROL BLOCKS TO READ JFCB                          55200021
*                                                                       55400021
*                                                                       55600021
*        DEB                                                            55800021
         L     RF,CVTSVDCB              ADDRESS OF SVCLIB DCB    Y02080 56000002
         L     RF,K44(,RF)              ADDRESS OF TASK SCHEDULER DEB   56200021
         MVC   DXDEBDEB(K44),K4(RF)     USE TASK SCHEDULER DEB          56400021
         MVI   DXDEB+(DEBNMEXT-DEB),K1  SET NO. OF EXTENTS TO 1 YA03003 56410002
         MVC   DXDEBAPP,CVTXAPG         SET DUMMY APP VEC TBL    Y02080 56450002
         MVI   DXDEBMOD,K0              SET FILE MASK TO ZERO    YM6841 56500002
         XC    DXDEBECB+1(K3),DXDEBECB+1  ZERO DEBECBAD                 56600021
         MVC   DXDEBSCC(K5),MYZERO      SET EXTENTS FOR DISK     Y02080 57000002
         MVC   DXDEBECC,ANTR            SET UP HIGHEST ENDING CC IN DEB 57200021
         MVC   DXDEBNTR,ANTR            SET UP HIGHEST NUM OF TRACKS    57400021
*                                                                       57600021
*        DCB 8-BYTE                                                     57800021
*                                                                       58000021
         LA    RF,DXDEB                 DEB ADDRESS                     58200021
         ST    RF,DXDCBDEB              STORE DEB ADDRESS IN DCB        58400021
         LA    RF,DXDCB                 DCB ADDRESS                     58600021
         ST    RF,DXDCBAD               STORE DCB ADDRESS IN DEB        58800021
         MVI   DXDEBID,DEBIDENT         MOVE IN ID OF DEB        M2275  58850021
*                                                                       59000021
*        IOB 32-BYTE                                                    59200021
*                                                                       59400021
         ST    RF,IOBWGHT               STORE DCB ADDRESS IN IOB        59600021
         MVI   IOBFLAG1,IOBUNREL        MAKE I/O REQUESTS UNRELATED     59800021
*                                                                       60000021
*        ECB 4-BYTE                                                     60200021
*                                                                       60400021
         LA    RF,DXECB                 ECB ADDRESS                     60600021
         ST    RF,IOBECBPT              STORE ECB ADDRESS IN IOB        60800021
         LA    RF,DXCCW                 START CCW ADDRESS               61000021
         ST    RF,IOBSIOCC              STORE IN IOB                    61200021
*                                                                       61400021
         TM    TIOELINK,TIOTSPOL        SPOOLED DATA SET?        Y02120 61450002
         BM    CIN01450                 BRANCH IF YES            Y02120 61550002
         TM    DCBMACRF,DCBMEXCP        CK FOR EXCP                     61600021
         BO    CIN00900                 BR IF YES TO PURGE I/O          61800021
*                                                                X02989 61900002
* IF VSAM TO ISAM COMPATIBILITY INTERFACE, BYPASS I/O PURGE      X02989 61950002
*                                                                X02989 61970002
         TM    DEBFLGS1,DEBCIFLG        IS CI INDICATED          X02989 61980002
         BO    CIN01450                 PROC NEXT DCB            Y02080 61990002
CIN00875 EQU   *                        TEST FOR DELAYED ABEND   X02989 61998002
         TM    TCBFLG,TCBFA             IS ABEND BIT ON                 62000021
         BZ    CIN01450                 NO - PROC NEXT DCB ENTRY Y02080 62200002
*                                                                       62400021
*****   PURGE I/O TO HALT ANY OUTSTANDING I/O FOR THIS DCB              62600021
*              ***  PURGE WITH HALT I/O  ***                            62800021
*                                                                       63000021
         TM    DCBDSORG,DCBORGIS        CHECK FOR ISAM                  63200021
         BZ    CIN00900                 NO, PURGE THIS DEB       M0001  63400021
         MVC   DXCCW6+K4(K4),DEBUCBAD   SAVE FIRST 4 BYTES OF    A37193 63600002
*                                       ISAM SECTION OF DEB      A37193 63800021
         MVC   DEBUCBAD,K48(RDEB)       SHIFT FIRST UCB ADDRESS         64000021
CIN00900 EQU   *                                                        64200021
         ST    RDEB,DXCCW5              SETTING UP PURGE PARAMETER      64400021
         MVI   DXCCW5,PURGPOST          PURGE PARAMETER          A49961 64600021
         LA    R0,DEBUSRPG              IOB CHAIN FIELD FOR PURGE       64800021
         ST    R0,DXCCW6                SAVE IN CCW                     65000021
         LA    R1,DXCCW5                POINT TO PURGE PARAMETER        65200021
         PURGE (1)                      SVC PURGE                       65400021
         WAIT  ,ECB=DXCCW5+K4           WAIT FOR PURGE COMPLETION       65600021
         TM    DCBMACRF,DCBMEXCP        CK FOR EXCP              A38013 65660021
         BO    CIN01450                 BR IF YES                A38013 65720002
         TM    DCBDSORG,DCBORGIS        CHECK FOR ISAM           A37193 65800021
         BZ    CIN01450                 NO, CONTINUE PROCESSING  A37193 66000002
         MVC   DEBUCBAD,DXCCW6+K4       MOVE IN FIRST 4 BYTES OF A37193 66200002
*                                       ISAM SECTION OF DEB      A37193 66400021
CIN01450 EQU   *                                                        68800021
         XR    RET,RET                  SET INIT ENTRY           Y02080 68850002
         STM   RTIOT,RET,DXREGSAV       SAVE REG 9 THRU 14              69000021
         STM   R0,R1,DXREG0             SAVE REG 0 AND 1                69200021
         B     CIN01500                 PROC NEXT DCB ENTRY      Y02080 69250002
CIN01460 EQU   *                        ERROR DCB NOT OPEN       Y02080 69300002
         TM    DCBMACR,DCBMEXCP         CHK IF EXCP              Y02080 69350002
         BO    CIN01500                 Y - PROC NEXT DCB        Y02080 69360002
         TM    DCBDSORG+K1,ACBDORGA     CHK IF ACB               Y02080 69370002
         BNO   CIN01500                 NO - PROC NEXT DCB ENTRY Y02080 69380002
         MVI   ACBERFLG-IFGACB(RDCB),ACBCALR IND CLOSE ERROR   @ZA02186 69390000
CIN01500 EQU   *                                                        69400021
         MODESET EXTKEY=DATAMGT         RET TO CLOSE KEY         Y02082 69450002
         TM    PLISTOPT(RPARC),LASTNTRY  CK LAST ENTRY ON LIST          69600021
         LA    RWTGC,K8(,RWTGC)         NEXT WTG ENTRY                  69800021
         BO    CIN01600                 BRANCH IF LAST ENTRY            70000021
         LA    RPARC,K4(,RPARC)         NEXT DCB ENTRY                  70200021
         B     CIN00100                 BRANCH TO NEXT ENTRY     Y02080 70400002
CIN01600 EQU   *                                                        70600021
         LTR   RC,RC                    CHK IF ANYTHING TO CLOSE Y02080 70610002
         LA    RTIOT,K4                 ERROR RETURN IF NO       YM6804 70615002
         BZ    CIN01700                 BR - NOTHING TO CLOSE    Y02080 70620002
         L     RD,CVTPTR                GET CVT ADDRESS          Y02080 70650002
         L     RES,CVTDMSR              LOAD ADDR OF RES ROUT    Y02080 70800002
         ST    RES,K4(RWTGC)            SAVE RES RTN ADDR IN WTG Y02080 71000002
         LR    RCORE,RC                 SET LAST GOOD WORK AREA  Y02080 71050002
         L     RF,DXATCOM3              GET ADDR OF RRPLIST      YM7099 71060002
         OI    RRFLAGS2-RRPLIST(RF),RRFFIN1 1ST LOAD COMPLETED   YM7099 71070002
         MVC   WTGMODNM,LOWMOD          SET LOWEST MOD ID        YM7099 71080002
         LM    R0,R1,DXREG0             GET HIS REGS             Y02080 71100002
         LM    RTIOT,RET,DXREGSAV       GET REGS 9-14            Y02080 71150002
         IECRES XCTL                    EXIT NEXT MOD QUEUED     Y02080 71200002
CIN01700 EQU   *                        DCB UNCLOSEABLE                 72200021
*                                                                       72409202
*        FREEMAIN THE WHERE-TO-GO TABLE                                 72419202
*                                                                       72421202
         IECRES FREE,PREFIX=WTG,A=(RWTG) FREEMAIN WTG TABLE CORE Y02080 72429002
         LR    RF,RTIOT                 SET RETURN CODE          YM6804 72431802
*                                                                Y02080 72436402
*        RETURN TO CALLER                                        Y02080 72438402
*                                                                Y02080 72438802
         IECRES EXIT                    RETURN                   Y02080 72439202
*                                                                       72440002
*        THE CALLER OF CLOSE HOLDS THE TIOT RESOURCE EXCLUSIVELY YM7883 72445002
*        THIS SHOULD NEVER VALIDLY HAPPEN AND CAN NOT BE ALLOWED YM7883 72450002
*                                                                       72455002
CIN01705 EQU *                                                          72460037
         SR    RF,RF                   ZERO REG                @ZA29752 72480037
         SR    RC,RC                   ZERO REG                @ZA29752 72500037
         LA    RF,K8                   RETURN CODE             @ZA29752 72520037
         L     RC,ABND50D              ABEND CODE              @ZA29752 72530037
         ABEND (RC),DUMP                                       @ZA29752 72560037
         EJECT                                                          72600021
         SPACE 1                                                        72800021
*********************************************************************** 73000021
*                                                                     * 73200021
*                       CONSTANTS                                     * 73400021
*                                                                     * 73600021
*********************************************************************** 73800021
         SPACE 1                                                        74000021
MYZERO   DC    XL8'00000000'            CONSTANT                 Y02080 74050002
ANTR     DC    X'7FFF'                  DEB END CC AND NUM TRACKS       75600021
LOADID   DC    X'F2C0'                  ID OF FIRST LOAD OF CLOSE       76000021
IMGDDNAM DC    CL8'IMGLIB  '            IMAGELIB DDNAME          XM1250 76010002
LOWMOD   DC    CL8'IFG0200 '            LOWEST CLOSE MOD NAME    Y02080 76060002
ABND50D  DC    XL4'0000050D'            ABEND 50D              @ZA29752 76110037
         XCTLTABL ID=(,ISTOCMDC,INITMOD,0V,PDMOD,0P,            Y30ASJCX76259503
               VSCATMOD,0N,CLOSE,IGC00020),                     Y30ASJCX76259903
               SVC=020,BRT=YES,LENGTH=                           Y02080 76263502
TIOTSPOL EQU   X'06'                    JES SPOOL D.S. INDICATORS     $ 76290000
*                                                                       76310000
         IECDSECS CVT,TCB,TIOT,RB,                               Y02080X76400002
               DSAB,                                             Y02083X76400502
               DCB,ACB,DEB,UCB,MAIN,WTG,PREFX,RRPL,EXPAND=YES    Y02144 76500002
         IDAAMB                                                  YM4688 76550002
         EJECT                                                          76650002
         IECEQU AOS=YES                                                 76720002
         END                                                            76800021
