         TITLE 'IGC0002C - TCLOSE INITIAL FUNCTION'                     00100037
IGC0002C CSECT                                                          00400021
*                                                                       00500021
*********************************************************************** 00600021
*                                                                     * 00700021
*           VS2-037 ADD/DE/CH                                           00750037
*A519020-519041,A549500-550000                                 @ZA29752 00756037
*                                                                     * 00770000
*          VS1 RELEASE 02 DELETIONS                                   * 00772002
*0000199432,530940,530960,530999,531000,531532,531666            XM1037 00772402
*0000199200-199300,563920                                        X02989 00774002
*0000                                                            XM0630 00776002
*          VS2 RELEASE 01 DELETIONS                                   * 00780000
*0000182719                                                      YM0897 00790000
*0000                                                            YM0955 00790100
*0000                                                            YM8269 00790200
*0000                                                            YM0898 00790300
*0000                                                            YM0850 00790400
*0000                                                            YM2069 00790800
*0000                                                            YM0992 00791200
*                                                                     * 00792000
*          VS2 RELEASE 02 DELETIONS/CHANGES                           * 00800002
*0000180000-184500,195429,205000,208000-225000,261667-261700,    YM1272 00801002
*0000338504-338940,517904,526000-540000,553000-555000            YM1272 00802002
*0000426000-450000                                               YM1493 00803002
*0000198850                                                      YM3011 00804002
*0000433500                                                      YM5310 00805002
*0000420500-420900,424500                                       ZA01326 00855002
*          VS2 RELEASE 03 DELETIONS/CHANGES                           * 00905002
*0000435500-436000                                             @ZA02878 00955037
*          VS2 RELEASE 04 DELETIONS/CHANGES                           * 01005037
*0000457000-458000,517500-517920                               @ZA04905 01055037
*          RELEASE 21.7 DELETIONS/CHANGES                             * 01200002
*          RELEASE 21 DELETIONS/CHANGES                               * 01300021
*                                                                S21042 01400021
*                                                                M0039  01450021
*D076000-077000,079000-080000,211000-212000,218000              SA53260 01460021
*0000120000-123000,176000-179000,480000-488000,503000-504000,   SA53293 01470002
*0000514000-517000,563000                                       SA53293 01480002
*0000395000-399000,551000-552000                                 S21940 01490002
*                                                                     * 01500021
* MODULE NAME - IGC0002C                                              * 01510002
*                                                                     * 01520002
* DESCRIPTIVE NAME - TCLOSE INITIAL FUNCTION                          * 01530002
*                                                                     * 01540002
* COPYRIGHT - NONE                                                    * 01550002
*                                                                     * 01560002
* CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING THE CSECT CARD    * 01570002
*                                                                     * 01580002
* STATUS CHANGE LEVEL 000                                             * 01600021
*                                                                     * 01700021
* FUNCTION -                                                          * 01800021
*    THIS MODULE CONTAINS THE 'TCLOSE INITIAL FUNCTION'.              * 01900021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG' FOR DETAILS.            * 02000021
*                                                                     * 02100021
* ENTRY POINTS -                                                      * 02200021
*         IGC0002C - ENTERED BY THE SUPERVISOR FROM THE SECOND-LEVEL  * 02300021
*                    INTERRUPT HANDLER (SLIH) WHEN SVC 23 (CLOSE,     * 02400021
*                    TYPE=T) IS ISSUED.                               * 02500021
*                                                                     * 02600021
* INPUT -                                                             * 02700021
*    ENTERED IN SUPERVISOR KEY ZERO                              Y02082 02750002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 02800021
*                                                                     * 02900021
* OUTPUT -                                                            * 03000021
*    EXIT IN DATA MANAGEMENT KEY                                 Y02082 03050002
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 03100021
*                                                                     * 03200021
* EXTERNAL REFERENCES -                                               * 03300021
*         IECPCNVT - CONVERTS A RELATIVE TRACK ADDRESS 'TTRN' TO AN   * 03400021
*            ABSOLUTE TRACK ADDRESS 'MBBCCHHR' UTILIZING THE          * 03500021
*            FOLLOWING REGISTER CONVENTUONS -                         * 03600021
*            REG    CONTENTS AT ENTRY      CONTENTS AT EXIT           * 03700021
*             0     TTRN TO BE CONVERTED   DESTROYED                  * 03800021
*             1     DEB ADDRESS            TRANSPARENT                * 03900021
*             2     ADDR OF 8-BYTE AREA    RESULTANT MBBCCHHR         * 04000021
*                   FOR MBBCCHHR                                      * 04100021
*            3-8    IGNORED                TRANSPARENT                * 04200021
*            9-13   IGNORED                DESTROYED                  * 04300021
*             14    RETURN ADDRESS         TRANSPARENT                * 04400021
*             15    ENTRY POINT ADDRESS    ERROR CODE                 * 04500021
*         THE ERROR CODE WILL BE '0' IF THE CONVERSION IS SUCCESSFUL  * 04600021
*         AND '1' IF THE 'TT' EXCEEDS THE TOTAL EXTENTS ASSIGNED.     * 04700021
*                                                                     * 04800021
* EXITS, NORMAL -                                                     * 04900021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 05000021
*                                                                     * 05100021
* EXITS, ERROR -                                                      * 05200021
*         NONE                                                        * 05300002
*                                                                     * 05500021
* TABLES/WORK AREAS -                                                 * 05600021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 05700021
*                                                                     * 05800021
* ATTRIBUTES -                                                        * 05900021
*    REENTRANT, REFRESHABLE, READ-ONLY, ENABLED, PRIVILEGED           * 06000021
*                                                                     * 06100021
* CHARACTER CODE DEPENDENCY -                                         * 06200021
*    CLASS ONE CHARACTER CODE DEPENDENCY - THE EBCDIC CHARACTER CODE  * 06300021
*    WAS USED FOR ASSEMBLY.  THE MODULE MUST BE REASSEMBLED IF A      * 06400021
*    DIFFERENT CHARACTER SET IS USED FOR EXECUTION.                   * 06500021
*                                                                     * 06600021
* NOTES -                                                             * 06700021
*    REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                        * 06800021
*                                                                     * 06900021
*********************************************************************** 07000021
*                                                                       07100021
         BALR  RBASE,0                  ESTABLISH ADDRESSABILITY        07200021
         USING *,RBASE                                                  07300021
         USING FORCORE,RCORE                                            07400021
         USING IHADCB,RDCB                                              07500021
         USING WTG,RWTG                                                 07800021
         USING TIOT,RTIOT                                               08100021
         USING UCB,RUCB                 UCB ADDRESSABILITY       YM1272 08120002
         USING CVT,RET                                                  08150000
         USING TCB,RD                                                   08160000
         USING DEBBASIC,RDEB                                     Y02134 08162002
         EJECT                                                          08200021
*********************************************************************** 08300021
*                                                                     * 08400021
*                          FUNCTION PROLOG                            * 08500021
*                                                                     * 08600021
*********************************************************************** 08700021
*                                                                     * 08800021
* FUNCTION NAME -                                                     * 08900021
*    'TCLOSE INITIAL FUNCTION'                                        * 09000021
*                                                                     * 09100021
* (STATUS) -                                                          * 09200021
*    NOT APPLICABLE                                                   * 09300021
*                                                                     * 09400021
* FUNCTION -                                                          * 11550000
*     1) VERIFIES THAT THE DCB(S) IS TO BE PROCESSED;                 * 11560000
*     2) OBTAINS MAIN STORAGE FOR THE 'WHERE-TO-GO' (WTG) TABLE;      * 11570000
*        THE IECRES MACRO IS USED, WHICH ALSO ENQS THE TIOT;     Y02134 11572002
*     3) OBTAINS MAIN STORAGE FOR A WORK AREA FOR EACH DCB TO BE      * 11580000
*        PROCESSED;                                                   * 11590000
*     4) INITIALIZES EACH WORK AREA WITH I/O CONTROL BLOCKS AND       * 11600002
*        CHANNEL PROGRAMS;                                            * 11610002
*     5) VALIDITY CHECKS THE DEB USING THE DEBCHK MACRO AND      Y02082 11620002
*        POINTS THE DEB'S DCB ADDRESS TO THE PROTECTED COPY OF   Y02082 11630002
*        THE DCB EXCEPT FOR VSAM.                                Y02082 11640002
*     6) PURGES (QUIESCES) OUTSTANDING I/O REQUESTS FOR EACH DCB;     * 11650002
*     7) MOVES THE 'JOB FILE CONTROL BLOCK' (JFCB) INTO THE WORK AREA * 11660002
*        FOR EACH DCB;                                                * 11670002
*     8) MOVES THE ID/EPA OF THE NEXT REQUIRED MODULE INTO THE WTG    * 11680002
*        TABLE ENTRY FOR EACH DCB;                                    * 11690002
*     9) BRANCHES TO THE RESIDENT ROUTINE TO CONTINUE TCLOSE          * 11700002
*        PROCESSING, OR                                               * 11710002
*    10) EXITS TO THE SUPERVISOR IF THERE ARE NO VALID DCBS TO        * 11720002
*        PROCESS AFTER FREEING THE WTG TABLE USING               Y02134 11730002
*        THE IECRES MACRO WHICH DEQS THE TIOT.                   Y02134 11740002
*                                                                     * 11750002
* ENTRY POINTS -                                                      * 11760002
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 11770002
*                                                                     * 11800021
* INPUT -                                                             * 11900021
*    REGISTER CONTENTS AT ENTRY ARE AS FOLLOWS-                       * 11950002
*       1 - CONTAINS THE ADDRESS OF THE TCLOSE PARAMETER LIST.        * 11960002
*           EACH ENTRY IS A FULLWORD WHICH CONTAINS THE ADDRESS OF    * 11970002
*           A DCB IN THE 3 LOW ORDER BYTES AND THE TCLOSE POSITIONING * 11980002
*           OPTION IN THE HIGH ORDER BYTE. THE POSITIONING OPTIONS    * 11990002
*           ARE AS FOLLOWS-                                           * 12030002
*              X'00' - LEAVE;                                         * 12070002
*              X'10' - REREAD;                                        * 12110002
*              X'30' - LEAVE;                                         * 12150002
*           THE LAST ENTRY IN THE PARAMETER LIST HAS THE HIGH ORDER   * 12190002
*           BIT OF ITS FIRST BYTE TURNED ON (I.E., X'80').            * 12230002
*       3 - ADDRESS OF THE CVT - INITIALIZED BY THE SLIH.             * 12270002
*       4 - ADDRESS OF THE TCB - INITIALIZED BY THE SLIH.             * 12310002
*       5 - ADDRESS OF THE TCLOSE SVRB - INITIALIZED BY THE SLIH.     * 12350002
*                                                                     * 12400021
* OUTPUT -                                                            * 12500021
*    1) REGISTER CONTENTS FOR A NORMAL EXIT ARE AS FOLLOWS -          * 12600021
*          'RES'   - ADDRESS OF THE RESIDENT ROUTINE;                 * 12700021
*          'RWTG'  - ADDRESS OF THE WTG TABLE;                        * 12800021
*       IF EXIT IS TO MODULE IFG0230P BECAUSE OF AN ERROR READING THE * 12900021
*       JFCB, THE FOLLOWING ADDITIONAL REGISTER CONTENTS APPLY -      * 13000021
*          'R0'    - TCLOSE INTERNAL ERROR CODE 121;                  * 13100021
*          'RDCB'  - ADDRESS OF THE DCB CURRENTLY BEING PROCESSED;    * 13200021
*          'RCORE' - ADDRESS OF THE CURRENT DCB'S WORK AREA;          * 13300021
*          'RWTGC' - ADDRESS OF THE CURRENT DCB'S WTG ENTRY;          * 13400021
*          'RTIOT' - ADDRESS OF THE CURRENT DCB'S CURRENT TIOT ENTRY; * 13500021
*          'RUCB'  - ADDRESS OF THE CURRENT DCB'S CURRENT UCB;        * 13600021
*          'RDEB'  - ADDRESS OF THE CURRENT DCB'S DEB.                * 13700021
*    2) INTERNAL INDICATORS -                                         * 13800021
*          'WTGPATHS' - X'20' - NSL PROCESSING IS REQUIRED;           * 13900021
*                                                                     * 14100021
* EXTERNAL REFERENCES -                                               * 14200021
*         REFER TO THE FOLLOWING 'FUNCTION PROLOG'.                   * 14300021
*                                                                     * 14400021
* EXITS, NORMAL -                                                     * 14500021
*    MODULE IFG0232D WITH 'RET' EQUAL 0 FOR DIRECT ACCESS PROCESSING; * 14600021
*    MODULE IFG0232G WITH 'RET' EQUAL 0 FOR SL TAPE OUTPUT PROCESSING;* 14700021
*    MODULE IFG0232M WITH 'RET' EQUAL 4 FOR SL TAPE INPUT PROCESSING; * 14800021
*    MODULE IFG0232S WITH 'RET' EQUAL 0 FOR NL TAPE POSITIONING;      * 14900021
*    MODULE IFG0232Y WITH 'RET' EQUAL 0 FOR NSL TAPE PROCESSING -     * 15000021
*       THIS MODULE IS AN ALIAS FOR IFG0202B, WHICH INTERFACES WITH   * 15100002
*       MODULES NSLETRLI (DEFERRED NSL PROCESSING) AND NSLCTRLO;      * 15200021
*    MODULE IFG0232Z WITH 'RET' EQUAL 4 FOR UNIT RECORD, GRAPHICS, OR * 15300021
*       COMMUNICATIONS DEVICE TYPES;                                  * 15400021
*                                                                     * 15700021
* EXITS, ERROR -                                                      * 15800021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 15900002
*                                                                     * 16000021
* TABLES/WORK AREAS -                                                 * 16100021
*    THE TCLOSE WORK AREA AND THE WHERE-TO-GO (WTG) TABLE ARE         * 16200021
*    DESCRIBED BY THE DSECTS AT THE END OF THE LISTING.               * 16300021
*                                                                     * 16400021
* ATTRIBUTES -                                                        * 16500021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 16600002
*                                                                     * 16700021
* CHARACTER CODE DEPENDENCY -                                         * 16800021
*    REFER TO THE PRECEDING MODULE PROLOG.                            * 16900002
*                                                                     * 17000021
* NOTES -                                                             * 17100021
*                                                                     * 17200021
*********************************************************************** 17300021
*                                                                       17400021
*********************************************************************** 17450002
*                                                                       17500002
*  THIS SECTION OBTAINS CORE FOR THE WHERE-TO-GO TABLE AND SAVES        17550002
*  REGISTERS 2-12 IN THE SVRB EXTENDED SAVE AREA.                       17600002
*                                                                       17650002
         USING RBBASIC,R5                                        YM1272 17700002
         IECRES GET,PREFIX=WTG,         GETMAIN FOR WTG TABLE    Y02080*17750002
               STM=(2,12,RBEXSAVE),A=(R1)                        YM1272 17800002
         DROP  R5                                                YM1272 17850002
*                                                                       17900002
         LTR   R0,R0                    CALLER ENQED EXCLUSIVELY YM3185 17910002
         BNZ   TCM15050                 BRANCH IF YES            YM3185 17930002
         LR    RWTG,R1                  LOAD WTG ADDRESS         YM1272 17950002
         L     RPAR,WTGPREFX            GET EXT PREFX ADDRSBLTY  Y02134 18000002
         L     RC,IECRRPRM-IECPREFX(,RPAR) GET RRPLIST PTR       Y02144 18050002
         MVI   RRFUNCTN-RRPLIST(RC),RRFTCLOS  INDICATE TCLOSE    Y02144 18100002
         IECRES LOAD,BRANCH=NO,MODNM=TCLOSE,PREFIX=WTGPREFX      Y02080X18150002
                                        GIVE OPT TRACE A SHOT    Y02080 18200002
         XC    WTGMODEP,WTGMODEP        CLEAR NEXT MOD ADDR      Y02080 18250002
*                                                                       18300002
         L     RPAR,IECUPRML-IECPREFX(,RPAR) PT PROT PARAM LIST  Y02134 18350002
*                                                                       18600021
*********************************************************************** 18700021
*              DETERMINE IF ENTRY IS TO BE PROCESSED                  * 18800021
*********************************************************************** 18900021
*                                                                       19000021
         LR    RPARC,RPAR               SET UP PARM PTR          YM0898 19220000
         LA    RWTGC,WTGENTRY           INIT CURRENT WTG ENTRY   Y02134 19222002
TCM00500 EQU   *                                                        19400021
         L     RD,CVTPTR                CVT ADDRESS              Y02082 19450002
         L     RD,CVTTCBP-CVT(,RD)      NEXT/CURRENT TCB ADDR    Y02082 19460002
         L     RD,K4(,RD)               CURRENT TCB              Y02082 19470002
         MODESET EXTKEY=RBT234,WORKREG=2 ASSUME USER KEY         Y02082 19480002
         L     RDCB,PLISTDCB(,RPARC)    ESTABLISH ADDRESS OF USER'S DCB 19500021
*                                                                       19500502
*        MAKE SURE THIS DCB IS NOT PREVIOUSLY DUPLICATED IN      YM2869 19501002
*        THE PARAMETER LIST                                      YM2869 19501502
*                                                                       19502002
         LA    RF,WTGENTRY              FIRST DCB'S WTG ENTRY    YM2869 19502502
         USING WTGENTRY,RF                                       YM2869 19503002
TCM00502 EQU   *                        PROCESS EACH DCB         YM2869 19503502
         CR    RF,RWTGC                 AT CURRENT YET           YM2869 19504002
         BE    TCM00506                 BR IF YES-NO DUPLICATES  YM2869 19504502
         L     RCORE,WTGCORE-K1         GET WORKAREA             YM2869 19505002
         LA    RCORE,K0(,RCORE)         CLEAR HIGH BYTE FOR LTR  YM2869 19505502
         LTR   RCORE,RCORE              IS THERE A WORKAREA      YM2869 19506002
         BZ    TCM00504                 BR IF NO-TRY NEXT DCB    YM2869 19506502
         CLM   RDCB,B'0111',DXUDCBAD+K1 IS CURRENT DCB BEING     YM2869 19507002
*                                       PROCESSED ALREADY        YM2869 19507502
         BE    TCM03000                 BR IF YES-DON'T PROCESS  YM2869 19508002
TCM00504 EQU   *                        GET NEXT DCB'S WTG ENTRY YM2869 19508502
         LA    RF,WTGENTRY+L'WTGENTRY   INCREMENT TO NEXT WTG    YM2869 19509002
         B     TCM00502                 CHECK NEXT DCB           YM2869 19509502
         DROP  RD                                                YM2869 19510002
         DROP  RF                                                YM2869 19510102
TCM00506 EQU   *                        NO DUPLICATES            YM2869 19510502
         TM    DCBOFLGS,DCBOBUSY        IS BUSY BIT ON?          Y02134 19510902
         BO    TCM03000                 BR IF YES-DON'T PROCESS  Y02134 19511402
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02134 19515002
         TM    DCBOFLGS,DCBOLOCK+DCBOPEN  IS DCB OPEN & UNLOCKED Y02134 19520002
         BNO   TCM03000                 BRANCH IF NO             Y02134 19525002
         TM    DCBMACRF,DCBMEXCP        TEST IF EXCP             YM4688 19526002
         BO    TCM00510                 BRANCH IF EXCP           YM4688 19527002
         TM    DCBDSRG2,DCBACBM         TEST FOR ACB/AMB         YM4688 19528002
         BNO   TCM00510                 BRANCH IF NOT ACB/AMB    YM4688 19529002
         CLI   AMBID-IDAAMB(RDCB),AMBIDENT  TEST FOR AMB         YM4688 19530002
         BE    TCM03000                 BRANCH IF YES - DO NOT   YM4688X19531002
                                        PROCESS AN AMB           YM4688 19532002
TCM00510 EQU   *                        TEST TASK CLOSE BIT      YM2869 19532502
*                                                                       19533002
*        DON'T PROCESS IF DEB HUNG OFF ANOTHER TCB'S DEB CHAIN   YM2869 19533502
*        AND TASK CLOSE IS PROCESSING                            YM2869 19534002
*                                                                       19534502
         CLM   RD,B'0111',DEBTCBAD+K1   IS DEB ON THIS TCB       YM2869 19535002
         BE    TCM00515                 BR IF YES TO CONTINUE    YM2869 19535502
         LA    RF,DEBBASIC              CLEAR HIGH BYTE          YM2869 19536002
         LA    R0,DEBBASIC-DEBXTNP      OFFSET TO DEBX ADDR      YM2869 19536502
         SR    RF,R0                    RF POINTS TO DEBX ADDR   YM2869 19537002
         USING DEBXTNP,RF                                        YM2869 19537502
         L     RF,DEBXTNP               RF POINTS TO DEBX        YM2869 19538002
         USING DEBXTN,RF                                         YM2869 19538502
         TM    DEBXFLG1,DEBXTSK         IS TASK CLOSE PROCESSING YM2869 19539002
         BO    TCM03000                 DON'T PROCESS IF YES     YM2869 19539502
         DROP  RF                                                YM2869 19540002
DEBXTSK  EQU   X'40'                    TASK CLOSE PROCESSING    YM2869 19540502
TCM00515 EQU   *                        GET CORE FOR TCLOSE      YM2869 19541002
*                                                                       19541502
*****          GET MAIN STORAGE FOR WORKAREA FOR THIS DCB        YM2869 19542002
*                                                                       19542502
         LA    R0,CLOSSIZE              LOAD SIZE OF TCLOSE WK   Y02134 19545002
*                                                                Y02134 19550002
         TM    DEBOFLGS,DEBOFEOF+DEBOFNSL  TEST FOR NSL AND EOF  Y02134 19555002
         BNO   TCM00575                 ..BRANCH IF NOT          Y02134 19560002
         TM    DEBOPATB,DEBOPOUT        IS DCB OPENED FOR INPUT  Y02134 19565002
         BNZ   TCM00575                 ..BRANCH IF NOT          Y02134 19570002
         L     RD,DCBEXLST              LD ADDR OF DCB EXIT LIST Y02134 19575002
         LA    RD,K0(,RD)               ..CLEAR HIGH-ORDER BYTE  Y02134 19580002
         LTR   RD,RD                    IS THERE A DCB EXIT LIST Y02134 19585002
         BZ    TCM00575                 ..BR IF NOT TO GET WKA   Y02134 19590002
*                                                                Y02134 19595002
TCM00525 EQU   *                        TEST IF MORE CORE NEEDED Y02134 19600002
         CLI   K0(RD),XLDEFNSL          WAS LABEL PROC DEFERRED  Y02134 19605002
         BE    TCM00550                 ..BRANCH IF YES TO GET   Y02134 19610002
*                                       EXTRA CORE               Y02134 19615002
         CLI   K0(RD),XLDEFNSL+LASTNTRY  IS 'LAST ENTRY' BIT ON  Y02134 19620002
         BE    TCM00550                 ..YES - GET EXTRA CORE   Y02134 19625002
         TM    K0(RD),LASTNTRY          IS THIS THE LAST ENTRY   Y02134 19630002
         LA    RD,K4(,RD)               POINT TO NEXT LIST ENTRY Y02134 19635002
         BNO   TCM00525                 ..BR IF NOT TO CHK NEXT  Y02134 19640002
         B     TCM00575                 ..BR IF YES TO GET WKA   Y02134 19645002
*                                                                Y02134 19650002
TCM00550 EQU   *                        LOAD SIZE OF EOV WKAREA  Y02134 19655002
         LA    R0,EOVSIZE               LOAD SIZE OF WORK AREA   Y02134 19660002
*                                       ..DEFERRED NSL INPUT     Y02134 19665002
*                                       PROCESSING               Y02134 19670002
*                                                                Y02134 19675002
TCM00575 EQU   *                        ISSUE IECRES GET         Y02134 19680002
         MODESET EXTKEY=DATAMGT         ASSUME DM KEY            Y02082 19685002
         IECRES GET,PREFIX=YES,STM=(2,14,WTGPREFX),LV=(0),       Y02134*19690002
               ID=TCWA                  GET CORE FOR TCLOSE WKA  Y02144 19695002
         LR    RCORE,R1                 SAVE ITS ADDRESS IN:     Y02134 19700002
         ST    R1,K4(,RWTGC)            ..WORK AREA BASE REG AND Y02134 19705002
*                                       ..IN CURRENT WTG ENTRY   Y02134 19710002
         ST    RC,DXATCOM3              SAVE RRPLIST PTR IN W/A  Y02144 19715002
*                                                                       19720002
         IECRES INIT,DEB=YES,DCBCOPY=TOWKAR,STM=(3,14,WTGPREFX)  Y02134X19725002
                                        COPY THE DCB AND         Y02134X19730002
                                        INITIALIZE THE WORK AREA Y02134 19735002
         CLI   DXWCOPYE,K0              WAS INIT/COPY PROSPEROUS Y02082 19740002
         BNE   TCM00600                 BRANCH IF NO             Y02082 19745002
*                                                                       19750002
*        IF A CHECKPOINT DATA SET SECURITY INTERFACE EXISTS,     Y02083 19755002
*        FREE THE COPY OF THE USER'S DCB AND COPY THE            Y02083 19760002
*        PROTECTED DCB.                                          Y02083 19765002
*                                                                       19770002
TCB00580 EQU   *                        TEST FOR CHKPT SI        Y02083 19775002
         L     RF,DXDSAB                FETCH DSAB ADDRESS       Y02083 19780002
         USING DSAB,RF                  DSAB ADDRESSABILITY      Y02083 19785002
         TM    DSABFLG4,DSABCKSI        Q - CHKPT SI PRESENT     Y02083 19790002
         BZ    TCM00590                 IF NOT, BRANCH           Y02083 19795002
         DROP  RF                       DSAB ADDRESSABILITY      Y02083 19800002
         L     RDEB,DCBDEBAD            FETCH DEB ADDRESS        Y02083 19805002
         L     RDCB,DEBDCBAD            FETCH PROTECTED DCB ADDR Y02083 19810002
         ST    RDCB,DXUDCBAD            UPDATE WA USER DCB ADDR  Y02083 19815002
         MVI   DXUKEY,K0                SET USER KEY TO ZERO     Y02083 19820002
         L     R1,DXPDCBAD              GET ADDR OF COPIED DCB   Y02083 19825002
*                                       TO BE FREED              Y02083 19830002
         IECRES FREE,A=(R1),PREFIX=YES,STM=(2,14,WTGPREFX)       Y02083 19835002
         MVC   DXPDCBAD,DXUDCBAD        TELL INIT TO COPY        Y02083 19840002
         IECRES INIT,DCBCOPY=TOWKAR,STM=(3,14,WTGPREFX)          Y02083 19845002
         CLI   DXWCOPYE,K0              WAS COPY SUCCESSFUL      Y02083 19850002
         BNE   TCM00600                 IF NOT, BRANCH           Y02083 19855002
         OI    DCBOFLGS,DCBOBUSY        TURN ON BUSY BIT         YM5932 19857002
*                                       IN COPIED DCB            YM5932 19859002
         L     RF,DXUDCBAD              GET PTR TO USER DCB      YM5932 19859402
         MODESET  KEYADDR=DXUKEY,WORKREG=1  GET USER KEY         YM5932 19859802
         OI    DCBOFLGS-IHADCB(RF),DCBOBUSY  TURN ON BUSY BIT    YM5932 19859902
*                                       IN USER DCB              YM5932 19864502
         MODESET  EXTKEY=DATAMGT        RESUME DM KEY            YM5932 19866502
TCM00590 EQU   *                        TEST FOR VSAM ACB        Y02083 19869402
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    Y02134 19874002
         BO    TCM00700                 BR IF YES, NOT ACB       Y02134 19878602
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  Y02134 19883202
         BNO   TCM00700                 BRANCH IF NO             Y02134 19887802
         CLI   ACBAMETH-IFGACB(RDCB),ACBVTAM  IS ACB FOR VTAM    YM3011 19892402
         BE    TCM00650                 BRANCH IF YES            Y02004 19897002
         CLI   ACBAMETH-IFGACB(RDCB),ACBVSAM  IS ACB FOR VSAM    Y02134 19901602
         BNE   TCM00650                 BRANCH IF NO             Y02134 19906202
         B     TCM03000                 GET NEXT ENTRY           Y02134 19910802
TCM00600 EQU   *                        SET ACB ERROR FLAGS      Y02134 19915402
         TM    DCBMACR,DCBMEXCP         IS ACCESS METHOD EXCP    X02989 19920002
         BO    TCM00650                 BR IF YES                Y02134 19925002
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  X02989 19930002
         BNO   TCM00650                 BR IF NO                 Y02134 19935002
         MVI   ACBERFLG-IFGACB(RDCB),VSCACBCL  SET ACB ERROR FLG Y02134 19940002
TCM00650 EQU   *                        REFRESH USER'S DCB       Y02134 19945002
         NI    DCBOFLGS,X'FF'-DCBOBUSY  ZERO OUT BUSY BIT        Y02082 19950002
         IECRES INIT,DCBCOPY=FRWKAR,STM=(2,14,WTGPREFX) REFRESH  Y02082*19955002
                                        USER'S DCB               Y02082 19960002
         LR    R1,RCORE                 PREPARE FOR FREEMAIN     Y02134 19965002
         IECRES FREE,A=(R1),PREFIX=YES,STM=(2,14,WTGPREFX)       Y02134 19970002
         XC    K0(K8,RWTGC),K0(RWTGC)   INDICATE NO WORK AREA    Y02004 19975002
         B     TCM03000                 GET NEXT ENTRY           Y02134 19980002
TCM00700 EQU   *                                                 X02989 19985002
         L     RTIOT,DXTIOTAD           GET TIOT ENTRY ADDR      Y02134 19990002
         TM    TIOELINK-TIOENTRY(RTIOT),TIOSPOOL TEST IF SPOOLED Y02134 19995002
         BM    TCM00650                 YES BYPASS THIS PARM     Y02134 19996002
         TM    DCBMACRF,DCBMREAD        IS THIS A BSAM READ DCB-        20000021
         BO    TCM01000                 ..BR IF YES TO PROCESS ENTRY    20100021
         TM    DCBMACRF+K1,DCBMWRIT     IS THIS A BSAM WRITE DCB-       20200021
         BNO   TCM00650                 ..BRANCH IF NOT          Y02134 20300002
*                                                                       20400021
*****    THIS SECTION TESTS FOR A TSO DATA SET.                         20500002
*                                                                       20600021
TCM01000 EQU   *                                                        20700021
         L     RUCB,DXUCBADR            LOAD UCB ADDRESS         YM1272 20800002
         LTR   RUCB,RUCB                TEST FOR DUMMY DATA SET OR TSO- 22600021
         BNZ    TCM03000                BR IF NEITHER            Y02134 23054002
TCM02500 EQU   *                                                        23300021
         CLI   DCBDEVT,DCBDEVTM         IS THIS TSO-                    23400021
         BNE   TCM00650                 ..BRANCH IF NOT          Y02134 23500002
         NI    DCBCIND1,X'FF'-DCBC1EOB  TURN OFF EOF BIT IN DCB ( THIS  23600021
*                                       ..IS THE ONLY TCLOSE            23700021
*                                       ..PROCESSING FOR TSO )          23800021
         B     TCM00650                 GO GET NEXT ENTRY        Y02134 23850002
TCM03000 EQU   *                                                        23900021
         MODESET EXTKEY=DATAMGT         RETURN TO DM KEY         Y02082 23950002
         TM    PLISTDCB(RPARC),LASTNTRY IS THIS THE LAST TCLOSE ENTRY-  24000021
         LA    RPARC,K4(,RPARC)         POINT TO THE NEXT TCLOSE ENTRY  24200021
         LA    RWTGC,L'WTGENTRY(,RWTGC) PT TO NEXT WTG ENTRY     Y02134 24250002
         BNO   TCM00500                 ..BR IF NOT TO GET NEXT ENTRY   24300021
         LR    RPARC,RPAR               PT FIRST DCB             Y02082 24400002
         LA    RWTGC,WTGENTRY           PT TO FIRST WTG ENTRY    Y02082 24500002
         USING WTGENTRY,RWTGC           ADDR CURRENT WTG ENTRY   Y02082 24600002
TCM03500 EQU   *                        CHECK FOR VALID ENTRY    Y02082 24700002
         L     RCORE,WTGCORE-K1         GET WORK AREA ADDRESS    Y02082 24800002
         LTR   RCORE,RCORE              CHECK IF TCLOSING        Y02082 24900002
         BNZ   TCM03600                 BRANCH IF VALID TCLOSE   Y02082 25000002
         TM    PLISTDCB(RPARC),LASTNTRY  CHECK IF LAST ENTRY     Y02082 25100002
         LA    RWTGC,WTGEND-WTGENTRY(,RWTGC)  ADDR NEXT ENTRY    Y02082 25200002
         LA    RPARC,K4(,RPARC)         ADDR NEXT PARAM LIST     Y02082 25300002
         BNO   TCM03500                 NO - TRY NEXT            Y02082 25400002
         B     TCM15500                 NO VALID TCLOSE ENTRIES  Y02082 25500002
         EJECT                                                   Y02082 25900002
TCM03600 EQU   *                        PROCESS THE DCB'S        Y02082 26000002
*                                                                       26200021
*********************************************************************** 26300021
*              PREPARE TO PROCESS THE DCBS                            * 26400021
*********************************************************************** 26500021
*                                                                       26600021
TCM04000 EQU   *                                                        27000021
         L     RDCB,PLISTDCB(,RPARC)    POINT TO DCB FOR THIS ENTRY     27100021
         L     RCORE,WTGCORE-K1         LOAD WORKAREA ADDRESS    Y02134 27102002
         LTR   RCORE,RCORE              IS THIS DCB PROCESSABLE  Y02134 27104002
         BZ    TCM13000                 BRANCH IF NO             Y02134 27106002
         L     RDEB,DCBDEBAD            LOAD DEB ADDRESS FROM DCB       27400021
         L     RUCB,DEBSUCBA            LOAD UCB ADDRESS         Y02134 27500002
         L     RTIOT,DXTIOTAD           GET CURRENT TIOT ENTRY   Y02134 27600002
         DROP  RWTGC                                             Y02082 28150002
*                                                                       31400021
*********************************************************************** 31500021
*              INITIALIZE THE 'TCLOSE' WORK AREA                      * 31600021
*********************************************************************** 31700021
*                                                                       31800021
*****          INITIALIZE CONTROL BLOCKS IN WORK AREA                   31900021
*                                                                       32000021
TCM06500 EQU   *                                                        32100021
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    X02989 32360002
         BO    TCM06600                 BR IF YES, NOT ACB       X02989 32370002
         TM    DCBDSORG+K1,ACBDORGA     IS CONTROL BLOCK AN ACB  X02989 32380002
         BNO   TCM06600                 BR IF NO                 X02989 32390002
         TM    ACBAMETH-IFGACB(RDCB),ACBVSAM  IS ACB FOR VSAM    X02989 32392002
         BO    TCM07600                 BR IF YES, READ JFCB     X02989 32394002
TCM06600 EQU   *                                                 X02989 32396002
         LA    RD,DXDCB                 PLACE ADDRESS OF WORK AREA DCB  32400021
         ST    RD,DXDEBDCB              ..INTO WORK AREA DEB            32500021
         ST    RD,IOBDCBPT-K1           ..AND INTO WORK AREA IOB        32600021
         MVI   DXDEBID,DEBIDENT         MOVE DEB ID INTO WORK AREA DEB  32700021
         MVC   DXDEBUCB,DEBSUCBA        MOVE DEVICE MODIFIER,UCB Y02134 32800002
*                                       ..ADDRESS INTO WORK AREA DEB    32900021
         LA    RD,DXDEB                 PLACE ADDRESS OF WORK AREA DEB  33000021
         ST    RD,DXDCBDEB              ..INTO WORK AREA DCB            33100021
         LA    RD,DXECB                 PLACE ADDRESS OF WORK AREA ECB  33200021
         ST    RD,IOBECBPT              ..INTO WORK AREA IOB            33300021
         LA    RD,DXCCW1                PLACE ADDRESS OF WORK AREA CCW  33400021
         ST    RD,IOBSTART-K1           ..INTO WORK AREA IOB            33500021
         OI    IOBFLAG1,IOBUNREL        SET UNRELATED BIT IN IOB        33600021
         L     RET,CVTPTR               LOAD CVT ADDRESS         Y02134 33650002
         MVC   DXDEBAPP,CVTXAPG         MOVE IOS' APPENDAGE VECTOR TBL  33700021
*                                       ..ADDRESS INTO WORK AREA DEB    33800021
         TM    DCBMACRF,DCBMEXCP        IS ACCESS METHOD EXCP    Y02082 33805002
         BO    TCM06700                 YES-DO DEBCHK            Y02082 33810002
         TM    DCBDSRG2,ACBDORGA        TEST FOR ACB             Y02082 33815002
         BO    TCM07500                 YES, DO NOT DELETE DEB   Y02082 33820002
*                                                                Y02082 33825002
TCM06700 EQU   *                        CHECK THE DEB            Y02082 33830002
         L     R1,DXUDCBAD              POINT TO USER'S DCB      Y02082 33835002
         DEBCHK (1)                     CHECK DEB                Y02082 33840002
         LR    RDEB,R1                  LOAD VERIFIED DEB ADDR   Y01021 33845002
         STCM  RDEB,B'0111',DCBDEBAD+K1  REFRESH DCBCOPY'S DEBAD Y02082 33850002
         MVC   DEBDCBAD+K1(L'DEBDCBAD-K1),DXPDCBAD+K1  POINT DEB Y02082*33855002
                                        TO PROTECTED DCB COPY    Y02082 33860002
         LA    RF,DEBBASIC-DEBXTNP      NEGATIVE OFFSET TO DEB   YM1272 33865002
*                                       EXTENSION ADDRESS        YM1272 33870002
         SR    R1,RF                    POINT R1 TO DEB PREFIX   YM1272 33875002
         L     RF,DEBXTNP-DEBXTNP(,R1)  LOAD DEB EXTENSION ADDR  YM1272 33880002
         OI    DEBXFLG1-DEBXTN(RF),DEBXCDCB  INDICATE DEBDCBAD   YM1272 33885002
*                                       POINTS TO THE COPIED DCB YM1272 33890002
*                                                                       33900021
*****          PURGE I/O TO HALT ANY OUTSTANDING I/O FOR THIS DCB       34000021
*                                                                       34100021
TCM07000 EQU   *                                                        34200021
         ST    RDEB,DXCCW5              INITLZ PURGE PARAMETER LIST     34300021
         MVI   DXCCW5,PURGEFLG          INITLZ FLAGS- DO NOT POST COMP  34400021
         LA    R0,DEBUSRPG              LOAD ADDRESS OF IOB PURGE CHAIN 34500021
         ST    R0,DXCCW6                ..AND STORE IN PARAMETER LIST   34600021
         LA    R1,DXCCW5                POINT TO PURGE PARAMETER LIST   34700021
         PURGE (1)                      SVC PURGE                       34800021
         WAIT  ,ECB=DXCCW5+K4           WAIT FOR PURGE COMPLETION       34900021
         TM    DCBCIND2,DCBC2CHN        IS THIS A CHAINED SCHED DCB-    35000021
         BZ    TCM07500                 ..BRANCH IF NOT                 35100021
         L     R1,DCBIOBAD              LOAD ADDR OF IOB PREFIX         35200021
         MODESET KEYADDR=DXUKEY,WORKREG=15 IOB KEY               Y02082 35250002
         L     R1,IOBECBPT-DXIOB+K16(R1)   GET ECB ADDR                 35300021
         MVI   DXECB-DXECB(R1),ECBCOD7F SET ECB COMPLETE                35400021
         MODESET EXTKEY=DATAMGT         RET TCLOSE KEY           Y02082 35450002
TCM07500 EQU   *                                                        35500021
         LA    RF,MOD232Z               POINT TO ID/TTR OF FINAL MOD    35600021
         LA    RET,K4                   BR TABLE OFFSET FOR THAT MOD    35700021
         TM    UCBTBYT3,UCB3TAPE+UCB3DACC IS THIS A TAPE OR DA DEVICE-  35800021
         BZ    TCM12500                 ..BR IF NOT- PROCESSING DONE    35900021
*                                                                       36000021
*                                                                       36050002
*        LOCATE JFCB AND MOVE INTO WORKAREA                      Y02082 36100002
*                                                                       36150002
TCM07600 EQU   *                        MOVE JFCB INTO WORK AREA X02989 36160002
         L     RTIOT,DXTIOTAD           GET TIOT ENTRY ADDRESS   Y02082 36200002
         LA    RET,TIOEJFCB-TIOENTRY(,RTIOT) GET TIOT ENTRY ADDR Y02082 36250002
         IECRES LOCJFCB,(RET)           LOCATE JFCB              Y02082 36300002
         MVC   DXJBF(JFCBLGTH),INFMJFCB-INFMJFCB(RET) GET JFCB   Y02082 36350002
*                                       INTO WORKAREA            Y02082 36400002
*                                                                       36450002
         TM    JFCBMASK+K6,JFCTRACE     IS THE TRACE FACILITY SPEC'D-   40500021
         BNO   TCM09500                 ..BRANCH IF NOT                 40600021
         OI    WTGPATHS+K1,WTGTRACE     IND THAT TRACE FACILITY REQ'D   40800021
TCM09500 EQU   *                                                        40900021
         LA    RF,MOD231T               PT TO IDTTR OF VSAM MOD  X02989 40952002
         TM    JFCDSRG2,JFCORGAM        IS DATA SET VSAM         X02989 40960002
         BNO   TCM09570                 NO, GO CHK FOR DA DEVICE Y02144 40970002
         OI    DXATGENS,DXATVSMG        VSAM STRING TO GET CNTRL Y02144 40972002
         B     TCM12500                 BR TO PROCESS VSAM       Y02144 40974002
TCM09570 EQU   *                        INIT FOR DA PROCESSING   Y02144 40976002
         LA    RF,MOD232D               PT TO ID/TTR OF DA MODULE       41000021
         SR    RET,RET                  BR TABLE OFFSET FOR THAT MOD    41100021
         MVC   DXDEBUCB,DEBSUCBA        RESTORE USER'S UCB ADDR  Y02134 41200002
         TM    UCBTBYT3,UCB3DACC        IS THIS A DIRECT ACCESS DEVICE  41300021
         BO    TCM12500                 ..BR IF YES TO PROCESS DA       41400021
*                                                                       41500021
*********************************************************************** 41600021
*              TAPE PROCESSING                                        * 41700021
*********************************************************************** 41800021
*                                                                       41900021
TCM10000 EQU   *                                                        42000021
         TM    UCBTBYT2,UCB3TAPE        IS IT 7 TRK TAPE        ZA01326 42050002
         BO    TCM10100                 BRANCH IF YES           ZA01326 42060002
         MVC   DXDEBMOD(K1),DEBSDVM     SET MODE CODE-9 TRK     ZA01326 42070002
         B     TCM10200                 BRANCH TO CONTINUE      ZA01326 42080002
TCM10100 EQU   *                        SET MODE CODE-7 TRK     ZA01326 42090002
         MVI   DXDEBMOD,DCBTRTET        SET MOD TO EVEN PARITY WITH     42100021
*                                       ..TRANSLATION                   42200021
         OC    DXDEBMOD,JFCDEN          SET DENSITY TO TO THAT WHICH    42300021
*                                       ..WAS USED TO CREATE TAPE       42400021
TCM10200 EQU   *                        CONTINUE TAPE PROCESS   ZA01326 42450002
         SR    RET,RET                  BR TABLE OFFSET FOR NSL/SL OUT  42500021
*                                                                YM1493 42550002
*****    NON-STANDARD LABEL (NSL) TAPE EXIT DETERMINATION        YM1493 42600002
*                                                                YM1493 42650002
TCM10500 EQU   *                        TEST FOR NSL TAPE        YM1493 42700002
         TM    DEBOFLGS,DEBOFNSL        TEST FOR NSL TAPE        YM1493 42750002
         BNO   TCM11000                 BRANCH IF NOT NSL        YM1493 42800002
         OI    WTGPATHS,WTGTCLOS        INDICATE THAT TCLOSE     YM1493X42850002
                                        IS PERFORMING NSL        YM1493X42900002
                                        TAPE PROCESSING          YM1493 42950002
         LA    RF,MOD232Y               POINT TO ID/EPA OF THE   YM1493X43000002
                                        CLOSE MODULE WHICH DOES  YM1493X43050002
                                        NSL TAPE PROCESSING      YM1493 43100002
         B     TCM12500                 BR TO FINISH THIS DCB    YM1493 43150002
*                                                                YM1493 43200002
*****    NO-LABEL (NL) TAPE EXIT DETERMINATION                   YM1493 43250002
*                                                                YM1493 43300002
TCM11000 EQU   *                        TEST IF A WRITE OCCURRED YM5310 43350002
         TM    DCBOFLGS,DCBOWRIT        TEST IF A WRITE OCCURRED YM5310 43360002
         BNO   TCM11100                 BRANCH IF NOT            YM5310 43370002
         OI    DEBOFLGS,DEBOFEOF        SET EOF BIT IN DEBOFLGS  YM5310 43380002
TCM11100 EQU   *                        TEST FOR NL TAPE         YM5310 43390002
         LA    RF,MOD232S               POINT TO ID/EPA OF THE   YM1493X43400002
                                        POSITIONING MODULE (FOR  YM1493X43450002
                                        SL/AL INPUT AND ALL NL)  YM1493 43500002
         TM    JFCBLTYP,JFCNL+JFCBLP    TEST FOR NL OR BLP TAPE@ZA02878 43550002
         BM    TCM12500                 BR IF YES TO FINISH DCB@ZA02878 43600002
*                                                                YM1493 43650002
*****    STANDARD LABEL (AL, AUL, SL, OR SUL) OUTPUT TAPE        YM1493 43700002
*        EXIT DETERMINATION                                      YM1493 43750002
*                                                                YM1493 43800002
TCM11500 EQU   *                        TEST FOR OUTPUT          YM1493 43850002
         TM    DCBOFLGS,DCBOWRIT        HAS A WRITE OCCURRED     YM1493 43900002
         BNO   TCM12000                 BRANCH IF NOT            YM1493 43950002
         LA    RF,MOD232G               POINT TO ID/EPA OF THE   YM1493X44000002
                                        AL/AUL/SL/SUL OUTPUT MOD YM1493 44050002
         B     TCM12500                 BR TO FINISH THIS DCB    YM1493 44100002
*                                                                YM1493 44150002
*****    STANDARD LABEL (AL, AUL, SL, OR SUL) INPUT TAPE         YM1493 44200002
*        EXIT DETERMINATION                                      YM1493 44250002
*                                                                YM1493 44300002
TCM12000 EQU   *                        TEST FOR USER LABELS     YM1493 44350002
         TM    JFCBLTYP,JFCBUL          TEST FOR USER LABELS     YM1493 44400002
         BNO   TCM12500                 BRANCH IF NOT TO THE     YM1493X44450002
                                        TAPE POSITIONING MODULE  YM1493X44500002
                                        (FOR AL AND SL INPUT)    YM1493 44550002
         LA    RF,MOD232M               POINT TO ID/EPA OF       YM1493X44600002
                                        THE USER LABEL MODULE    YM1493X44650002
                                        (FOR AUL AND SUL INPUT)  YM1493 44700002
         LA    RET,K4                   BRANCH TABLE OFFSET FOR  YM1493X44750002
                                        AUL AND SUL INPUT -      YM1493X44800002
                                        FALL THRU TO FINISH DCB  YM1493 44850002
*                                                                       45100021
*****    INITIALIZE WORK AREAS FOR RESIDENT ROUTINE                     45200021
*                                                                       45300021
TCM12500 EQU   *                                                        45400021
         MVC   K0(K5,RWTGC),K0(RF)      MOVE ID/TTR OF NEXT MODULE      45500021
*                                       ..INTO WTG TABLE ENTRY          45600021
         STM   RTIOT,RET,DXREG9          STORE REGS 9-14       @ZA04905 45700037
         STM   R0,R1,DXREG0              STORE REGS 0,1        @ZA04905 45750037
TCM13000 EQU   *                                                        45900021
         TM    PLISTDCB(RPARC),LASTNTRY IS THIS THE LAST TCLOSE ENTRY-  46000021
         LA    RPARC,K4(,RPARC)         POINT TO NEXT TCLOSE ENTRY      46100021
         LA    RWTGC,WTGEND-WTGENTRY(,RWTGC) PT TO NEXT WTG TABLE ENTRY 46200021
         BNO   TCM04000                 BR TO GET NEXT ENTRY            46300021
         L     RF,WTGPREFX              GET BASE PREFIX PTR      YM7099 46310002
         L     RPARC,IECUPRML-IECPREFX(,RF) PT FIRST DCB       @ZA04905 46312037
         L     RF,IECRRPRM-IECPREFX(,RF) GET RRPLIST PTR         YM7099 46320002
         OI    RRFLAGS2-RRPLIST(RF),RRFFIN1 INDIC 1ST LOAD DONE  YM7099 46330002
         L     RES,CVTPTR               LOAD ADDRESS OF CVT    @ZA04905 46382037
         L     RES,CVTDMSR-CVT(RES)     LD ADDR OF RESIDENT RTN@ZA04905 46384037
         ST    RES,K4(RWTGC)            SAVE RES RTN ADDRESS IN@ZA04905 46386037
*                                       ..LAST WTG TABLE ENTRY @ZA04905 46388037
         LA    RWTGC,WTGENTRY           PT TO FIRST WTG ENTRY  @ZA04905 46390037
         USING WTGENTRY,RWTGC           ADDR CURRENT WTG ENTRY @ZA04905 46392037
TCM14000 EQU   *                        CHECK FOR VALID ENTRY  @ZA04905 46394037
         L     RCORE,WTGCORE-K1         GET WORK AREA ADDRESS  @ZA04905 46396037
         LTR   RCORE,RCORE              CHECK IF TCLOSING      @ZA04905 46398037
         BNZ   TCM15000                 BRANCH IF VALID TCLOSE @ZA04905 46398437
         TM    PLISTDCB(RPARC),LASTNTRY  CHECK IF LAST ENTRY   @ZA04905 46398837
         LA    RWTGC,WTGEND-WTGENTRY(,RWTGC)  ADDR NEXT ENTRY  @ZA04905 46399237
         LA    RPARC,K4(,RPARC)         ADDR NEXT PARAM LIST   @ZA04905 46399637
         BNO   TCM14000                 NO - TRY NEXT          @ZA04905 46399737
         B     TCM15500                 NO VALID TCLOSE ENTRIES@ZA04905 46399837
*                                                                       46400021
*********************************************************************** 49500021
*              EXITS                                                  * 49600021
*********************************************************************** 49700021
*                                                               SA53293 51350002
*****          OBTAIN THE ADDRESS OF THE OPEN/CLOSE/EOV         SA53293 51400002
*****          RESIDENT ROUTINE                                 SA53293 51450002
*                                                               SA53293 51500002
TCM15000 EQU   *                                                SA53293 51700002
         LM    RTIOT,RET,DXREG9         LOAD REGS 9-14         @ZA04905 51750037
         LM    R0,R1,DXREG0             LOAD REGS 0,1          @ZA04905 51770037
         MVC   WTGMODNM,INITNAME        MOVE BASIC NAME TO WTG   YM1272 51793002
*                                                               SA53293 51794002
*****          EXIT TO RESIDENT ROUTINE TO BEGIN SERIAL PROCESSING      51796002
*                                                               SA53293 51798002
         IECRES XCTL                    BR TO RES RTN TO XCTL    S21940 51800002
         SPACE 2                                                        51900021
*                                                                       51901002
*  THE CALLER OF T-CLOSE HOLDS THE TIOT RESOURSE EXCLUSIVELY.  @ZA29752 51902037
*  THIS SHOULD NEVER VALIDLY HAPPEN AND CANNOT BE ALLOWED.     @ZA29752 51902337
*                                                                       51902637
TCM15050 SR    RF,RF                    ZERO REG               @ZA29752 51902937
         SR    RC,RC                    ZERO REG               @ZA29752 51903237
         LA    RF,K12                   RETURN CODE            @ZA29752 51903537
         L     RC,ABND50D               ABEND CODE             @ZA29752 51903837
         ABEND (RC),DUMP                                       @ZA29752 51904137
         SPACE 2                                                        51905002
*                                                                       52000021
*****          RETURN TO CALLER- THERE ARE NO VALID DCBS TO PROCESS     52100021
*                                                                       52200021
TCM15500 EQU   *                                                        52300021
         IECRES FREE,PREFIX=WTG,A=(RWTG) FREE WTG CORE           Y02080 52400002
         LA    RF,K4                    SET RETURN CODE          X02989 52500002
*                                                                Y02080 52600002
         IECRES EXIT                    RETURN                   Y02080 52700002
         SPACE 2                                                        54500021
*********************************************************************** 54600021
*              CONSTANTS                                              * 54700021
*********************************************************************** 54800021
*                                                                       54900021
ABND50D  DS    0F                                              @ZA29752 54950037
         DC    XL4'0000050D'            ABEND CODE             @ZA29752 55000037
INITNAME DC    CL8'IFG023'              CHARACTERS 'IFG023  '    YM1272 55300002
         EJECT                                                          55600021
*********************************************************************** 55700021
*        TABLE OF MODULE IDS AND ENTRY POINT ADDRESSES                  55800002
*********************************************************************** 55900021
*                                                                       56000021
XCTLTB23 XCTLTABL ID=(MOD232D,2D,MOD232G,2G,MOD232M,2M,          YM1272X56100002
               MOD232S,2S,MOD232Y,2Y,MOD232Z,2Z,MOD231T,1T,      YM1272X56200002
               TCLOSE,IGC0002C),SVC=023,BRT=YES,LENGTH=          YM1272 56300002
         SPACE 2                                                        56400002
         IECDSECS CVT,                                                 C56500002
               RB,                                                     C56550002
               TCB,                                                    C56600002
               TIOT,                                                   C56650002
               DCB,                                                    C56700002
               DSAB,                                             Y02083C56750002
               ACB,                                              Y02080C56800002
               IEZDEB,                                           Y02134C56850002
               UCB,                                                    C56900002
               MAIN,                                                   C56950002
               PREFX,                                            Y02080C57000002
               WTG,                                                    C57050002
               IDAPDPRM,                                               C57100002
               RRPL,                                             Y02144*57150002
               EXPAND=YES                                        XM0630 57200002
         IDAAMB                                                  YM4688 57210002
         EJECT                                                   YM4688 57220002
*                                                                       57250002
TIOSPOOL EQU   X'06'                    TEST FOR SPOOLED         Y02134 57300002
         IECEQU AOS=YES,IEZDEB=YES                               Y02134 57350002
         END                                                            57700021
