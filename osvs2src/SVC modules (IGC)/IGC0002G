 TITLE 'IGC0002G - OBTAIN - ENTRY POINT - READ DSCB'                    00020000
IGC0002G CSECT                                                          00022021
*                                                                       00024021
*          VS2 RELEASE 037 CHANGES                                      00024137
*A0000                                                         @ZA17992 00024237
*          VS2 RELEASE 03 DELETIONS/CHANGES                             00024403
*000023200-24000                                                Z30AAJC 00024803
*0000                                                            ZM0144 00024903
*          VS1 RELEASE 02 DELETIONS                                     00025002
*0000                                                            X02989 00025402
*0000                                                           XA00356 00025802
*0000049797                                                      XM0876 00028702
*0000                                                            XM1039 00030702
*          VS2 RELEASE 02 DELETIONS/CHANGES                             00032502
*0000018600-019600                                               YM0117 00032702
*0000000971,003000-003200,004120-004400,008600,009000,016673,    Y02080 00032802
*0000016703,016766-016797,016859,016887-016889,016977,017200-    Y02080 00032902
*0000017400,017900-018120,018260,019790-020000,020400,021250-    Y02080 00033002
*0000021321,021346-021617,021640,021761-021850,021964,022600,    Y02080 00033102
*0000024600-026600,028260,031000,032600,033860,035400-036400,    Y02080 00033202
*0000037000,037600,045500,045600-046200,049700,049744-049900,    Y02080 00033302
*0000053730-053750,053770-053800,058800,060250-060340,060584-    Y02080 00033402
*0000060592,062000,063000,073420-080700                          Y02080 00033502
*0000000030-000150,005200,007000,008800,016885,017135,039400-    Y02078 00033602
*0000039600,042000-042200,043000,043400-043600,045400,046480,    Y02078 00033702
*0000046600,047800-048000,048400,055600,056200,056600-057200,    Y02078 00033802
*0000058400,063600-063800,064800,068400,069000-069200,070200,    Y02078 00033902
*0000072800-073000                                               Y02078 00034002
*0000                                                            Y02132 00034202
*0000                                                            Y02082 00034402
*0000021480                                                      YM1312 00034502
*0000005000-005200,050540-050700,060290-060300                   YM3996 00034602
*0000060260                                                      YM5902 00034702
*0000051420,053020,053140,053340                                 YM5378 00035002
*          RELEASE 22 DELETIONS                                         00036202
*          RELEASE 21 DELETIONS                                         00039102
*1195008600,009000,010480,016200-016400,038400,043600            A38860 00042002
*1195016010-016020                                               A37199 00044902
*1195037000,037600                                               A44463 00047802
*0000018400,020200,020600                                        A42200 00050702
*0000019800,045800                                              SA49351 00053602
*          RELEASE 21.7 DELETIONS                                       00059402
*0000011100-016270,016704-016750,016770-016794,016800-016811,   SA56452 00062302
*0000016874,016937,017000,017070,017800,020600-021000,021200,   SA56452 00065202
*0000021400,021600,021970-021998,022100,050000-053400,053691-   SA56452 00068102
*0000053709,053714-053719,080700                                SA56452 00071002
*0000043600                                                     SA56392 00071402
*0000                                                           SA56450 00071802
*0000042800,066400                                              SA48172 00073002
*          RELEASE 20 DELETIONS                                         00073902
*3510000250-000420,000500-000650,053800,079400                   S20201 00076802
*3510                                                            A34440 00079702
*3510051200-051780,051790                                        M0696  00082602
*          RELEASE 19 DELETIONS                                         00085502
*2741024440-024560                                               A25499 00088402
*                                                                       00093302
*MODULE NAME - IGC0002G                                                 00093702
*                                                                       00094102
*DESCRIPTIVE NAME - OBTAIN - ENTRY POINT - READ DSCB                    00099202
*                                                                       00101202
*COPYRIGHT - NONE                                                       00103202
*                                                                       00103602
*CHANGE ACTIVITY - SEE DELETIONS/CHANGES FOLLOWING CSECT CARD           00104002
*                                                                       00104402
*STATUS CHANGE LEVEL 005                                                00104702
*                                                                       00106702
*ATTRIBUTES - REENTRANT                                                 00109802
*                                                                       00114902
*FUNCTION - THIS MODULE IS THE ENTRY POINT TO OBTAIN. THIS MODULE HAS   00120000
*          TWO OPTIONS. THE SEARCH OPTION SEARCHES THE VTOC FOR THE     00140000
*          NAMED DSCB AND THE SEEK OPTION SEEKS TO THE APPROPRIATE      00160000
*          TRACK AND SEARCHES THAT TRACK FOR THE GIVEN CCHHR. THE       00180000
*          DATA PORTION OF THE DSCB IS READ FOR THE SEARCH OPTION;      00200000
*          THE KEY AND DATA PORTIONS ARE READ FOR THE SEEK OPTION.      00210000
*          FOR THE SEARCH OPTION WITH A VIO DATA SET, THE DATA          00211002
*          PORTION OF THE FORMAT 1 DSCB IS MOVED FROM THE VDSDSCB       00212002
*          INTO THE USER'S WORK AREA, AND THE CCHHR IS SET TO ZERO.     00213002
*          VSAM SUPPORT REQUIRES THAT IF A DSCB IS NOT FOUND IN  X02989 00214002
*          A SEARCH OPERATION AND IF VSAM IS ON THE VOLUME,      X02989 00216002
*          CONTROL IS TRANSFERRED TO MODULE IGC0102G TO TRY TO   X02989 00218002
*          FIND THE DATA SET WITHIN A VSAM DATA SPACE.OTHERWISE, X02989 00218402
*          A NORMAL ERROR EXIT IS EFFECTED.                      X02989 00218502
*                                                                       00220000
*ENTRIES - THE ONLY ENTRY POINT TO THIS MODULE IS IGC0002G. ENTRY IS    00240000
*          MADE UPON SVC 27 FROM ANY SYSTEM OR PROBLEM PROGRAM.         00260000
*                                                                       00280000
*SUPERVISOR CALLS AND MACROS. THE FOLLOWING ARE SUPERVISOR CALLS        00340000
*          ISSUED IN THE MACRO EXPANSIONS:                              00360000
*                    EXCP(0) READ FROM DIRECT ACCESS DEVICE             00380000
*                    WAIT(1) WAIT ON EVENT CONTROL BLOCK                00400000
*                    ENQ(56) ENQ ON SYSZTIOT                            00410002
*                    DEQ(48) DEQ FROM SYSZTIOT                          00420002
*                                                                       00430002
*OTHER MACROS USED:                                                     00460000
*          IECOBTWA - OBTAIN WORK AREA EXPANSION                        00470002
*          IECSDSL1 - ENABLES SYMBOLIC ADDRESSING OF DSCBS              00480002
*          IDDVDSCB - EXPANDS THE VDSCB                                 00490002
*          IECDSECS - EXPANDS THE ASCB, CVT, DSAB, JSCB, PSA, QDB, RB,  00500002
*                     RRPL, TCB, TIOT, AND UCB DSECTS                   00520002
*                                                                       00540000
*INPUT -   AT ENTRY TO THIS MODULE REG 1 POINTS TO THE PARAMETER LIST.  00560000
*          THE PARAMETER LIST CONSISTS OF FOUR WORDS:                   00580000
*                    WORD 1 - SEARCH CODE = X'C1000000'                 00600000
*                             SEEK CODE = X'C0800000'                   00620000
*                    WORD 2 - SEARCH = ADDR OF DATA SET NAME            00640000
*                             SEEK = ADDR OF CCHHR OF DSCB              00660000
*                    WORD 3 - ADDR OF VOLUME SERIAL NUMBER              00680000
*                    WORD 4 - ADDR OF 140 BYTE WORK AREA.               00700002
*                                                                       00720000
*OUTPUT -  THE DSCB IS RETURNED IN THE GIVEN WORK AREA. IF THE OPTION   00740000
*          WAS SEARCH, THE DSCB WILL OCCUPY THE FIRST 96 BYTES OF THE   00760000
*          WORK AREA, AND THE CCHHR OF THE DSCB WILL BE THE NEXT 5      00780000
*          BYTES. IF THE OPTION WAS SEEK, THE DSCB WILL OCCUPY THE      00800000
*          FIRST 140 BYTES OF THE WORK AREA.                            00820000
*          WHEN CONTROL IS PASSED TO IGC0102G, REGISTER 10 POINTS       00824002
*          TO THE PARAMETER LIST, AND REGISTER 13 POINTS TO THE         00828002
*          OBTAIN WORK AREA.                                            00832002
*                                                                       00840000
*STORAGE - PROGRAM CODE CSECT = LESS THAN 2048 BYTES                    00860002
*          USER WORK AREA = 140 BYTES                                   00880002
*          OBTAIN WORK AREA = 580 BYTES                                 00900002
*                                                                       00920000
*ERROR CONDITIONS - UPON EXIT REGISTER 15 WILL CONTAIN THE COMPLETION   00940000
*          CODE OF OBTAIN AS FOLLOWS--                                  00960000
*              00 - SUCCESSFUL OBTAIN                                   00980000
*              04 - VOLUME NOT MOUNTED                                  01000000
*              08 - DSCB NOT FOUND IN VTOC                              01020000
*              0C - PERMANENT I/O ERROR                                 01040000
*              10 - INVALID WORK AREA POINTER                     13395 01044000
*              14 - (SEEK MODE) ABSOLUTE TRACK ADDRESS IS OUT     13395 01052000
*                   OF THE BOUNDARY OF THE VTOC EXTENT.           13395 01056000
*                                                                       01060000
*RESTRICTIONS - NO SECURITY PROTECTION                                  01080000
*                                                                       01100000
*REGISTER USAGE:                                                        01110002
*                                                                       01120002
R0       EQU   0                        REGISTER ZERO                   01130002
R1       EQU   1                        REGISTER ONE                    01140002
R2       EQU   2                        REGISTER TWO                    01150002
RDSAB    EQU   2                        DSAB POINTER             Y02132 01155002
R3       EQU   3                        REGISTER THREE                  01160002
P1       EQU   3                        REGISTER THREE                  01170002
R4       EQU   4                        REGISTER FOUR                   01180002
P2       EQU   4                        REGISTER FOUR                   01190002
R5       EQU   5                        REGISTER FIVE                   01200002
P3       EQU   5                        POINTER TO VOL SER              01210002
R6       EQU   6                        REGISTER SIX                    01220002
P4       EQU   6                        PTR TO CALLER'S WORK AREA       01230002
R7       EQU   7                        REGISTER SEVEN                  01240002
R8       EQU   8                        REGISTER EIGHT                  01250002
RCVT     EQU   8                        CVT POINTER                     01260002
R9       EQU   9                        REGISTER NINE                   01270002
RWKAPTR  EQU   9                        OBTAIN WORK AREA POINTER        01280002
PL       EQU   10                       PARAMETER LIST POINTER          01290002
RUCB     EQU   11                       UCB POINTER                     01300002
RB       EQU   11                       REGISTER ELEVEN          A37199 01310002
RBASE    EQU   12                       BASE REGISTER                   01320002
RWKAREA  EQU   13                       PTR TO CALLER'S WORK AREA       01330002
RETURN   EQU   14                       RETURN REGISTER                 01340002
RE       EQU   14                       REGISTER FOURTEEN        A37199 01350002
R15      EQU   15                       EQUATE FOR REGISTER 15   Y02080 01360002
WORKREG  EQU   15                       WORK REGISTER                   01370002
*                                                                       01380002
* OTHER EQUATES                                                         01390002
*                                                                       01400002
K0       EQU   0                        CONSTANT OF ZERO         YM0839 01410002
K1       EQU   1                        CONSTANT OF ONE          Y02078 01420002
ONE      EQU   1                        ONE CHARACTER            S20201 01430002
K2       EQU   2                        CONSTANT OF TWO          Y02132 01435002
K3       EQU   3                        CONSTANT OF THREE        YM8538 01436002
K4       EQU   4                        CONSTANT OF FOUR         YM0839 01440002
NONZERO  EQU   4                        NON-ZERO VALUE           YM1312 01445002
FW       EQU   4                        BYTES IN FULL WORD       S20201 01450002
C7       EQU   7                        CHARACTER OF SEVEN       S20201 01460002
K8       EQU   8                        CONSTANT OF EIGHT        Y02078 01465002
K12      EQU   12                       CONSTANT OF 12          SA56452 01470002
K16      EQU   16                       CONSTANT OF 16          SA56452 01480002
CSWAD    EQU   8                        CSW OFFSET IN IOB       SA56392 01485002
NOVSAM   EQU   X'00'                    NO VSAM ON VTOC FLAG     X02989 01490002
NOF1DSCB EQU   8                        NO F1 DSCB ERROR CODE    Y02132 01495002
CCHHRL   EQU   5                        LENGTH OF CCHHR          Y02078 01500002
VDATALN  EQU   81                       VDSDSCB DATA LENGTH      Y02132 01505002
DATAL    EQU   96                       DSCB DATA PORTION LENGTH Y02078 01510002
F1       EQU   C'1'                     FORMAT 1 DSCB ID         Y02078 01520002
F4       EQU   C'4'                     FORMAT 4 DSCB ID         Y02078 01530002
SEEKCODE EQU   X'80'                    SEEK OPTION CODE         Y02132 01535002
DOSBIT   EQU   X'80'                    DOS BIT IN DS4VTOCI      Y02078 01540002
DIRFBIT  EQU   X'04'                    DIRF BIT IN DS4VTOCI     Y02078 01550002
WKALNGTH EQU   139                      LENGTH-1 OF WORK AREA    Y02078 01560002
UNRELATD EQU   X'02'                    UNRELATED FLAG IN IOB   SA56452 01570002
RPSMSK   EQU   X'10'                    TESTS RPS BIT IN UCB    SA56452 01580002
SKIP     EQU   X'10'                    CCW SKIP FLAG           SA48172 01590002
SLI      EQU   X'20'                    CCW SUPPRESS LENGTH     SA48172 01600002
*                                       INDICATOR               SA48172 01610002
*                                                                       01690002
         BALR  RBASE,K0                 INITIALIZE BASE REGISTER Y02080 01700002
         USING BEGIN,RBASE              CSECT ADDRESSABILITY     Y02080 01710002
         USING OBTNWKA,RWKAPTR          WORK AREA ADDRESSABILITY Y02080 01720002
         USING UCB,RUCB                                                 01760000
*                                                                       01770002
* THIS SECTION OBTAINS THE OBTAIN WORK AREA.                            01780002
*                                                                       01782000
BEGIN    EQU   *                                                 Y01077 01814000
         LR    PL,R1                    PARAMETER LIST POINTER          01826000
         LM    P3,P4,K8(PL)             LOAD VOL SER NUMBER ADDR YM0117 01860002
*                                       AND WORK AREA ADDRESS    YM0117 01880002
         LA    RWKAREA,0(P4)            LOAD BASE REGISTER FOR   A42200 01966021
*                                       USER'S WORK AREA         A42200 01972021
         L     R9,K0(R4)                LOAD SVRB ADDRESS        Y02080 01976002
         IECRES GET,PREFIX=FIRST,LV=OWALNGTH,ID=OBWA,            Y02080X01980002
               STM=(R2,RWKAREA,96(R9))  OBTAIN WORK AREA         Y02080 01984002
         LR    RWKAPTR,R1               LOAD BASE REGISTER FOR   A42200 02010021
*                                       OBTAIN'S WORK AREA       A42200 02020021
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO AFTER Y02082X02024002
                                        ISSUING THE IECRES GET   Y02082X02028002
                                        FOR CORE IN KEY 5        Y02082 02032002
*                                                                       02036002
         IECRES LOAD,EXTPR=(RWKAPTR),MODNM=FIRSTLD,BRANCH=NO     Y02080X02040002
                                        LET OPTIONAL TRACE PRINT Y02080X02044002
                                        THIS MODULE'S NAME       Y02080 02048002
*                                                                       02052002
         L     R1,IECRRPRM              RECOVERY RTN LIST ADDR   Y02144 02056002
         USING RRPLIST,R1               PARM LIST ADDRESSABILITY Y02144 02060002
         OI    RRFUNCTN,RRFOBTN         SET OBTAIN FUNCTION BIT  Y02144 02064002
         DROP  R1                                                Y02144 02068002
*                                                                       02072002
         ST    R4,TCBADDR               SAVE INPUT TCB ADDRESS   Y02078 02080002
         L     RCVT,CVTPTR              LOAD CVT ADDRESS         Y02080 02084002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 02088002
*                                                                       02103402
* THIS SECTION CHECKS VALIDITY OF USER'S WORK AREA POINTER              02106702
*                                                                       02110002
VALCK    EQU   *                                                SA56452 02120002
         STM   RB,R3,IECREGSV+K12       SAVE REGISTERS 11-3      Y02080 02130002
         XR    R7,R7                    INITIALIZE REGISTER      Y02080 02131002
*                                                                       02133102
* IF THE CALLER IS IN PROTECT KEY OF ZERO OR IN SUPERVISOR              02133402
* STATE, THE WORK AREA DOES NOT HAVE TO BE CHECKED SINCE                02133702
* HE MAY USE ANY REGION IN MAIN STORAGE                                 02134002
*                                                                       02134302
         TESTAUTH FCTN=1,KEY=YES,STATE=YES,BRANCH=YES  TEST IF   Y02080X02136002
                                        CALLER IS IN KEY 0 OR    Y02080X02137002
                                        IN SUPERVISOR STATE      Y02080 02138002
         LTR   R15,R15                  TEST IF ANY TRUE         Y02080 02139002
         BZ    RESTORE                  BRANCH IF YES            Y02080 02140002
         LA    R1,K0(P4)                STARTING ADDRESS         Y02080 02141002
         LA    R2,WKALNGTH(R1)          ENDING ADDRESS           Y02080 02142002
OBTNLOCK SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02080X02143002
               RELATED=(LOCAL,IGC0002G(RLSELOCK))  OBTAIN LOCK   Y02080 02144002
         LM    RB,RE,IECREGSV+K12       RESTORE REGISTERS 11-14  Y02080 02145002
         L     R15,CVT0VL00             VALIDITY CHECK RTN ADDR  Y02080 02146002
         BALR  RETURN,R15               LINK TO VALIDITY CHECK   Y02080 02147002
         BZ    RLSELOCK                 BRANCH IF VALID ADDRESS  YM1312 02147502
         LA    R7,NONZERO               INDICATE INVALID ADDRESS YM1312 02148002
*                                                                       02148502
RLSELOCK SETLOCK RELEASE,TYPE=LOCAL,                             Y02080X02149002
               RELATED=(LOCAL,IGC0002G(OBTNLOCK))  RELEASE LOCK  Y02080 02150002
RESTORE  EQU   *                        RESTORE REGISTERS        Y02080 02151002
         LM    RB,R3,IECREGSV+K12       RESTORE REGISTERS 11-3   Y02080 02152002
         LTR   R7,R7                    TEST IF ADDRESS VALID    Y02080 02153002
         BZ    ADDROK                   BRANCH IF VALID          Y02080 02154002
         LA    WORKREG,K16              INSERT ERROR CODE       SA56452 02162002
         B     SETCODE                  BR TO STORE ERROR CODE  SA56452 02166002
PERMERR  EQU   *                                                SA56452 02167002
         LA    WORKREG,K12              LOAD ERROR CODE         SA56452 02168002
SETCODE  EQU   *                                                SA56452 02169002
         STH   WORKREG,ERCODE           STORE ERROR CODE        SA56452 02170002
         B     LEAVE                    RETURN TO CALLER        SA56452 02171002
*                                                                       02172002
* THIS SECTION SEARCHES THE UCB LOOKUP TABLE TO FIND THE UCB ADDRESS.   02173002
*                                                                       02174002
ADDROK   EQU   *                        FIND THE UCB ADDRESS     Y02080 02175002
         OC    0(6,P3),0(P3)            CHECK FOR ZERO VOL       A25499 02176002
*                                       SERIAL                   A25499 02177002
         BZ    ENDADDR                  DON'T LOOK FOR UCB IF 0  A25499 02178002
         TM    K1(PL),SEEKCODE          TEST FOR THE SEEK OPTION Y02132 02179002
         BO    UCBSRCH                  BRANCH IF SEEK SPECIFIED Y02132 02180002
*                                                                Y02132 02181002
         L     P2,K4(,PL)               LOAD DSNAME ADDRESS      Y02132 02182002
         ST    P2,DSMADTW3              SAVE DSNAME ADDRESS      Y02144 02183002
         CLC   BLANKS,K0(P3)            TEST FOR A VALID VIRTUAL Y02132 02184002
*                                       UCB VOLUME SERIAL NUMBER Y02132 02185002
         BNE   UCBSRCH                  BRANCH IF NOT BLANKS     Y02132 02186002
         CLC   CSYS,K0(P2)              TEST FOR CHARACTERS SYS  Y02132 02187002
*                                       IN BYTES 0-2 OF THE DSN  Y02132 02188002
         BNE   UCBSRCH                  BRANCH IF NOT A VIO DSCB Y02132 02189002
         CLC   CDOTT,K8(P2)             TEST FOR .T IN BYTES 8-9 Y02132 02190002
         BNE   UCBSRCH                  BRANCH IF NOT A VIO DSCB Y02132 02191002
         CLC   CDOTR,K16(P2)            TEST FOR CHARACTERS .R   Y02132 02192002
*                                       IN BYTES 16-17           Y02132 02193002
         BE    VIODSTST                 BRANCH IF A POSSIBLE     Y02132 02194002
*                                       VIRTUAL DATA SET         Y02132 02195002
*                                                                       02196002
UCBSRCH  EQU   *                        UCB SEARCH               Y02132 02197002
         L     RCVT,CVTPTR              SET UP CVT BASE REGISTER Y01077 02200000
         L     R2,CVTILK2               LOAD ADDR OF UCB ADDR TABLE     02240000
UCBLOOP  EQU   *                                                        02280000
         SR    WORKREG,WORKREG          CLEAR SUBUCB POINTRR.           02300000
         SR    RUCB,RUCB                CLEAR UCB POINTER        ZM0144 02300103
         ICM   RUCB,3,0(R2)             LOAD 16 BIT UCB ADDR    Z30AAJC 02320003
         BZ    NEXTADDR                 BRANCH IF NO UCB        Z30AAJC 02340003
         CLM   RUCB,3,EXTCONST          LAST TABLE ENTRY?       Z30AAJC 02360003
         BE    ENDADDR                  BRANCH IF AT END OF TBL Z30AAJC 02380003
         TM    UCBTBYT3,UCB3DACC       TEST FOR DIRECT ACCESS           02420000
         BZ    NEXTADDR                BR IF NOT                        02440000
         TM    SRTESTAT,SRTEONLI        SEE IF THIS UCB IS       A25499 02665019
*                                       ONLINE                   A25499 02670019
         BZ    NEXTADDR                 IF NOT, TRY NEXT UCB     A25499 02675019
         CLC   SRTEVOLI(6),0(P3)       COMPARE VOLUME SERIAL NUMBERS    02680000
         BE    PRIMUCB                 BR IF FOUND                      02700000
NEXTADDR LA    R2,2(R2)                TRY NEXT ADDR IN UCB ADDR TABLE  02720000
         B     UCBLOOP                                                  02740000
*                                                                       02760000
ENDADDR  LA    WORKREG,4               LOAD ERROR CODE                  02780000
         B     SETCODE                                                  02800000
*                                                                       02820000
*                                                                       02832000
PRIMUCB  EQU   *                                                        02840000
         L     R1,IECRRPRM              RECOVERY RTN LIST ADDR   Y02144 02850002
         USING RRPLIST,R1               PARM LIST ADDRESSABILIT  Y02144 02860002
         ST    RUCB,RRUCBPTR            SAVE UCB ADDRESS         Y02144 02870002
         DROP  R1                                                Y02144 02880002
*                                                                       03020000
* BUILD DEB                                                             03040000
*                                                                       03060000
BUILDEB  EQU   *                       BUILD DEB                 Y02144 03070002
         LA    R1,DEB                  BUILD DEB                        03080000
         MVI   16(R1),X'01'            NUM OF EXTS = 1                  03120000
         LA    R2,DCB                                                   03140000
         ST    R2,24(R1)               INSERT DCB ADDR                  03160000
         MVI   24(R1),X'0F'            INSERT DEB ID                    03180000
         MVC   29(3,R1),CVTXAPG+1      INSERT IOS APPAD TAB ADDR        03200000
         MVI   28(R1),X'04'            INSERT EXT SCALE                 03220000
         ST    RUCB,32(R1)             INSERT UCB ADDR                  03240000
         MVI   32(R1),X'C0'            INSERT DEVICE MOD                03280000
         MVC   42(6,R1),EXTCONST       INSERT EXTS AND TK COUNT         03300000
         ST    R1,DEBPTR               BUILD DCB                        03320000
*                                                                       03340000
* BUILD IOB                                                             03360000
*                                                                       03380000
         OI    IOB,UNRELATD             SET UNRELATED BIT IN IOB A37199 03392021
         LA    R0,ECB                                                   03400000
         ST    R0,IOB+4                 POINT TO ECB.                   03420000
         TM    UCBTBYT2,RPSMSK          DOES DEVICE HAVE RPS     S20201 03421002
         BZ    NORPS1                   NO, CONTINUE AS NORMAL   S20201 03422002
         LA    R0,THETA                 GET ADDRESS OF THETA     S20201 03423002
         O     R0,RPSCCW                GET SET SECTOR COMMAND   S20201 03424002
*                                       CODE                     S20201 03425002
         ST    R0,CCW0                  BUILD SET SECT. CCW      S20201 03426002
         MVC   CCW0+FW(FW),RPSCCW+FW    BUILD FLAGS & LENGTH     S20201 03427002
         LA    R0,CCW0                  ADDR OF RPS CHANNEL PGM. S20201 03428002
         B     IOBCONT                  CONTINUE                 S20201 03429002
NORPS1   EQU   *                                                 S20201 03430002
         LA    R0,CCW1                                                  03440000
IOBCONT  EQU   *                                                 S20201 03450002
         ST    R0,IOB+16                POINT TO START OF CHANL PRGRM.  03460000
         LA    R0,DCB                                                   03480000
         ST    R0,IOB+20                POINT TO DCB.                   03500000
         L     R0,SRTEFSCT              PICK UP TTR0 OF VTOC     Y02080 03640002
         L     WORKREG,CVTPCNVT        LOAD ADDR OF CONVERT ROUTINE     03660000
         LA    R2,SEEK                 PUT MBBCCHHR IN SEEK FIELD       03680000
         STM   RWKAPTR,RWKAREA,IECREGSV+K12  SAVE REGISTERS 9-13 Y02080 03700002
         LR    R3,RWKAPTR               SAVE WORK AREA POINTER.         03720000
         BALR  RETURN,WORKREG          CONVERT TTR0 TO MBBCCHHR         03740000
         LM    RWKAPTR,RWKAREA,IECREGSV+K12-OBTNWKA(R3)  RESTORE Y02080 03760002
         TM    0(PL),X'01'             TEST FOR SEARCH CODE             03780000
         BZ    SEEKDSCB                BR IF NOT                        03800000
*                                                                       03820000
* THIS SECTION RELOCATES & EXECUTES THE SEARCH OPTION CHANNEL PROGRAM.  03840021
*                                                                       03860000
SRCHDSCB EQU   *                       BUILD CCW                 Y02144 03870002
         L     WORKREG,4(0,PL)          LOAD DSNAME PTR          YM8538 03871002
         CLC   F4NAME,0(WORKREG)        CHECK IF F4 ONLY         YM8538 03872002
         BNE   F1SEARCH                 GO READ FORMAT 1         YM8538 03873002
         LM    R0,R5,CHANPROG           CCWS TO READ F4 ONLY     YM8538 03874002
         AR    R0,RWKAPTR               RESOLVE CCW1 ADDRESS     YM8538 03875002
         AR    R2,RWKAPTR               RESOLVE CCW2 ADDRESS     YM8538 03875202
         AR    R4,RWKAPTR               RESOLVE CCW3 ADDRESS     YM8538 03876002
         LA    R5,0(0,R5)               CLEAR FLAGS              YM8538 03877002
         STM   R0,R5,CCW1               SETUP 3 CCWS             YM8538 03878002
         BAL   RETURN,EXECIO            READ F4 ONLY             YM8538 03879002
         CLI   DS4IDFMT,F4             TEST FOR FORMAT 4 ID      YM8538 03879102
         BNE   PERMERR                 BRANCH IF NOT             YM8538 03879202
         MVC   DS1FMTID(L'F4DSCB),F4DSCB MOVE F4 TO F1 BUFFER    YM8538 03879402
         MVC   NEWCCHHR,SEEK+K3         RETURN F4 CCHHR          YM8538 03879802
         B     RETPARMS                 BRANCH TO RETURN INFO    YM8538 03879902
*                                                                YM8538 03880902
F1SEARCH EQU   *                        SEARCH FOR F1 DSCB       YM8538 03881102
*                                                                YM8538 03881302
         LM    R0,R7,CHANPROG          LOAD CCW1 TO CCW4 CONSTANTS      03881902
         AR    R0,RWKAPTR               RESOLVE ADDR IN CCW1.           03900000
         AR    R2,RWKAPTR               RESOLVE ADDR IN CCW2.           03920000
         AR    R4,RWKAPTR              RESOLVE ADDR IN CCW3      Y02078 03940002
         AR    R6,RWKAPTR              RESOLVE ADDR IN CCW4      Y02078 03960002
         STM   R0,R7,CCW1              STORE CCW1 TO CCW4               03980000
         LA    WORKREG,CCW9-CCW1                                        04000000
         AR    R2,WORKREG              RESOLVE ADDR IN CCW5             04020000
         STM   R2,R3,CCW5              STORE CCW5                       04040000
         LA    WORKREG,CCW11-CCW9                                       04060000
         AR    R2,WORKREG              RESOLVE ADDR IN CCW8             04080000
         STM   R2,R3,CCW8              STORE CCW8                       04100000
         LM    R0,R7,CHANPROG+32       LOAD CCW9 TO CCW12 CONSTANTS     04120000
         L     WORKREG,4(0,PL)         LOAD ADDR OF DATA SET NAME       04140000
         LA    WORKREG,0(WORKREG)      CLEAR HIGH ORDER BYTE    SA56450 04150002
         AR    R0,WORKREG              RESOLVE ADDR IN CCW9             04160000
         AR    R2,RWKAPTR               RESOLVE ADDR IN CCW2.           04180000
         AR    R4,RWKAPTR              RESOLVE ADDR IN CCW11     Y02078 04200002
         AR    R6,RWKAPTR              RESOLVE ADDR IN CCW12     Y02078 04220002
         STM   R0,R7,CCW9              STORE CCW9 TO CCW 12             04240000
         STM   R0,R1,CCW6              STORE CCW6                       04260000
         STM   R4,R5,CCW7              STORE CCW7               SA48172 04280002
         MVI   CCW7+4,SLI+SKIP         SET SLI AND SKIP BITS    SA48172 04292002
EXECUTE  BAL   RETURN,EXECIO           EXECUTE THE CHANNEL PROGRAM      04320000
         L     R2,IOB+CSWAD            GET CSW COMMAND ADDRESS  SA56392 04322002
         LA    R2,0(R2)                CLEAR HIGH BYTE          SA56392 04324002
         LA    R3,CCW8                 GET CCW8 ADDRESS         SA56392 04326002
         CLR   R2,R3                   DOES CSW POINT TO CCW8   SA56392 04328002
         BE    TESTDOS                 YES, FORMAT 1 DSCB       SA56392 04330002
*                                      WAS NOT FOUND            SA56392 04332002
         CLI   DS1FMTID,F1             TEST FOR FORMAT 1 ID      Y02078 04340002
         BNE   PERMERR                 BAD VTOC - I/O ERR CODE  SA56392 04360002
         SR    WORKREG,WORKREG         ZERO REG                         04380000
         STC   WORKREG,ERCODE          TURN OFF FIRST PASS INDICATOR    04400000
         IC    WORKREG,NEWCCHHR+4      PICK UP R OF NEXT RECORD         04420000
         BCTR  WORKREG,R0              DECREMENT R BY ONE               04440000
         LTR   WORKREG,WORKREG         CHECK FOR DSCB LAST ON TRACK     04460000
         BNE   NOTLAST                 BR IF NOT                        04480000
         IC    WORKREG,DS4DEVDT        SET R TO LAST DSCB ON THE TRACK  04500000
NOTLAST  STC   WORKREG,NEWCCHHR+4      STORE R OF DSCB READ INTO CORE   04520000
*                                                                YM8538 04521002
RETPARMS EQU   *                        UPDATE USER PARM LIST    YM8538 04522002
*                                                                YM8538 04523002
         L     R1,TCBADDR              LOAD TCB ADDRESS          Y02078 04524002
         USING TCB,R1                  TCB ADDRESSABILITY        Y02078 04528002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 04532002
         MVC   K0(DATAL,RWKAREA),DS1FMTID  MOVE IN F1 DSCB DATA  Y02078 04540002
         MVC   DATAL(CCHHRL,RWKAREA),NEWCCHHR  MOVE IN CCHHR     Y02078 04541002
         MODESET EXTKEY=ZERO           RETURN TO KEY ZERO        Y02082 04542002
         DROP  R1                                                Y02078 04543002
*                                                                       04545021
* THIS SECTION FREES THE WORK AREA AND RETURNS TO THE CALLER.           04550002
*                                                                       04555021
LEAVE    EQU   *                        SAVE RETURN CODE         Y02080 04560002
         LH    R8,ERCODE                SAVE RETURN CODE         Y02080 04570002
         IECRES FREE,PREFIX=FIRST,A=(RWKAPTR)  FREE WORK AREA    Y02080 04580002
         USING CVT,WORKREG              CVT ADDRESSABILITY       Y02080 04590002
         L     WORKREG,CVTPTR           LOAD CVT ADDRESS         Y02080 04600002
         L     RETURN,CVTEXPRO          LOAD EXIT PROLOG ADDRESS Y02080 04610002
         LR    WORKREG,R8               RESTORE RETURN CODE      Y02080 04620002
         RETURN ,                       RETURN                   Y02080 04630002
         DROP  WORKREG                                           Y02080 04634002
*                                                                       04640000
* IF THE FORMAT 1 DSCB WAS NOT FOUND ON THE FIRST PASS, AND THE         04644021
* DOS OR DIRF BIT IS SET IN THE FORMAT 4 DSCB, THIS SECTION             04648002
* MODIFIES THE CHANNEL PROGRAM TO READ EVERY DSCB IN THE VTOC.          04652021
*                                                                       04656021
TESTDOS  EQU   *                       TEST IF DOS OR DIRF SET   Y02078 04658002
         TM    DS4VTOCI,DOSBIT+DIRFBIT  TEST IF DOS OR DIRF SET  Y02078 04660002
         BZ    NODSCB                  BR IF NOT                        04680000
         TM    ERCODE,X'80'            TEST FOR SECOND PASS             04700000
         BO    NODSCB                  BR IF YES                        04720000
         OI    ERCODE,X'80'            TURN ON FIRST PASS INDICATOR     04740000
         CLC   DS4HPCHR(4),DS4VTOCE+6   IS HIGH PRIME CCHH END OF VTOC. 04760000
         BNE   NEWHIGH                  BRANCH IF NOT            Y02078 04780002
         CLC   DS4HPCHR+K4(K1),DS4DEVDT  IS HIGH PRIME R THE     Y02078 04800002
*                                       LAST RECORD ON THE TRACK Y02078 04810002
         BE    NODSCB                   BRANCH IF YES.                  04820000
NEWHIGH  EQU   *                       SET NEW HIGH              Y02078 04840002
         MVC   DS4HPCHR(4),DS4VTOCE+6     INSERT CCHH OF VTOE END.      04860000
         MVC   DS4HPCHR+4(1),DS4DEVDT  PICK UP NEW R                    04880000
         MVI   CCW3+4,X'50'            STORE NEW CCW3                   04900000
         B     EXECUTE                                                  04920000
*                                                                       04940000
NODSCB   LA    WORKREG,8               LOAD ERROR CODE                  04960000
         CLI   DS4AMCAT,NOVSAM         CHECK FOR NO VSAM ON VOL  X02989 04972002
         BE    SETCODE                 NORMAL PATH FOR ERROR     X02989 04974002
         LR    RWKAREA,RWKAPTR          W/A ADDR IN REGISTER 13  Y02080 04978002
         IECRES LOAD,EXTPR=(RWKAPTR),MODNM=VSAMMOD,BRANCH=DIRECT Y02080 04982002
*                                                                       04984002
* FOR A POSSIBLE VIO DATA SET, THIS SECTION FIRST ATTEMPTS TO ENQ       04986002
* ON THE TIOT.  IT THEN SEARCHES THE DSAB CHAIN FOR A TIOT ENTRY        04990002
* CONTAINING A VIRTUAL UCB WHOSE VDSDSCB CONTAINS THE DATA SET NAME     04994002
* BEING OBTAINED AND WHOSE VOLUME SERIAL MATCHES THE VOLUME SERIAL      04998002
* IN THE PARAMETER LIST.  IF A DSNAME/VOL SER MATCH IS FOUND, IT        05002002
* MOVES THE 81 BYTE DATA PORTION OF THE VDSDSCB INTO THE CALLER'S       05006002
* WORK AREA.  NOTE THAT IF THE ENQ RETURN CODE INDICATED THAT THE TASK  05010002
* PREVIOUSLY HAD CONTROL OF THE RESOURCE, NO SUBSEQUENT DEQ IS ISSUED.  05014002
*                                                                       05018002
VIODSTST EQU   *                        TEST FOR VIO DATA SET    Y02132 05022002
         L     RDSAB,TCBADDR            GET TCB ADDRESS          Y02132 05026002
         USING TCB,RDSAB                TCB ADDRESSABILITY       Y02132 05030002
         L     RDSAB,TCBJSCB            GET JSCB ADDRESS         Y02132 05034002
         USING IEZJSCB,RDSAB            JSCB ADDRESSABILITY      Y02132 05038002
         L     RDSAB,JSCBACT            GET ACTIVE JSCB ADDRESS  Y02132 05042002
         L     RDSAB,JSCDSABQ           GET DSAB QDB ADDRESS     Y02132 05046002
         ST    RDSAB,DSABQDB            SAVE FOR TIOT ENQ        Y02132 05050002
         L     WORKREG,CVTPTR           LOAD CVT ADDRESS         YM3996 05053002
         L     WORKREG,CVTTCBP-CVT(,WORKREG)  LOAD TCB/ASID PTRS YM3996 05056002
         L     WORKREG,K12(,WORKREG)    LOAD CURRENT ASID ADDR   YM3996 05059002
         USING ASCB,WORKREG             ASCB ADDRESSABILITY      YM3996 05062002
         MVC   TIOTMNR(K2),ASCBASID     MOVE ASID INTO ENQ MINOR YM3996 05065002
         DROP  WORKREG                                           YM3996 05068002
         MVC   MJELNAME(L'TIOTMJR),TIOTMJR  MAJOR RESOURCE NAME  Y02132 05074002
         MVC   ENQAREA(ENQLTH),ENQLIST  MOVE IN ENQ PARM LIST    Y02132 05078002
         ENQ   (MJELNAME,TIOTMNR),MF=(E,ENQAREA)  ISSUE ENQ      Y02132 05082002
*                                                                Y02132 05086002
         LTR   R15,R15                  TEST IF SUCCESSFUL ENQ   Y02132 05090002
         BNZ   DSABSRCH                 BRANCH IF NOT            Y02132 05094002
         OI    DSMADTB2,DSMTIOTE        SET TIOT ENQ'ED SWITCH   Y02144 05098002
         LA    R15,TIOTMNR              MINOR RESOURCE ADDRESS   Y02144 05102002
         ST    R15,DSMADTW2             SAVE MINOR RESOURCE ADDR Y02144 05106002
*                                                                       05110002
DSABSRCH EQU   *                        GET DSAB                 Y02132 05114002
         L     RDSAB,DSABQDB            GET DSAB QDB ADDR        Y02132 05118002
         USING QDB,RDSAB                QDB ADDRESSABILITY       Y02132 05122002
         L     RDSAB,QDBFELMP           GET PTR TO FIRST DSAB    Y02132 05126002
         USING DSAB,RDSAB               DSAB ADDRESSABILITY      Y02132 05130002
VDSABTST EQU   *                        IS THERE ANOTHER DSAB    Y02132 05134002
         LTR   RDSAB,RDSAB              IS THERE ANOTHER DSAB    Y02132 05138002
         LA    RB,UCBSRCH               SET UP RETURN ADDRESS    YM5378 05142002
         BZ    DEQTEST1                 BRANCH IF NOT            Y02132 05146002
         L     R3,DSABTIOT              GET TIOT ADDRESS         Y02132 05150002
         USING TIOENTRY,R3              TIOT ADDRESSABILITY      Y02132 05154002
         L     RUCB,TIOEFSRT-K1         GET UCB ADDRESS          Y02132 05158002
         LA    RUCB,K0(RUCB)            CLEAR HIGH BYTE          Y02132 05162002
         LTR   RUCB,RUCB                IS THERE A UCB ADDRESS   Y02132 05166002
         BZ    TRYNEXT                  BRANCH IF NOT            Y02132 05170002
         TM    UCBJBNR,UCBVRDEV         TEST IF A VIRTUAL UCB    Y02132 05174002
         BZ    TRYNEXT                  BRANCH IF NOT            Y02132 05178002
         CLC   SRTEVOLI,K0(P3)          COMPARE VOL SER'S        Y02132 05182002
         BNE   TRYNEXT                  BRANCH IF NOT EQUAL      Y02132 05186002
         LR    R3,RUCB                  VDSCB ADDRESS            Y02132 05190002
         USING VDSCB,R3                 VDSCB ADDRESSABILITY     Y02132 05194002
         CLC   VDSDSCB(L'DS1DSNAM),K0(P2)  COMPARE DSNAME'S      Y02132 05198002
         BE    SCRTHTST                 BRANCH IF EQUAL          Y02132 05202002
TRYNEXT  EQU   *                        GET NEXT DSAB            Y02132 05206002
         L     RDSAB,DSABFCHN           GET NEXT DSAB ADDRESS    Y02132 05210002
         B     VDSABTST                 GO TEST IT               Y02132 05214002
*                                                                       05218002
SCRTHTST EQU   *                        IS VDSCB SCRATCHED       Y02132 05222002
         CLC   VDSABSTT,EXTCONST        TEST IF VDSCB SCRATCHED  Y02132 05226002
         BNE   VIOBTAIN                 BRANCH IF NOT SCRATCHED  Y02132 05230002
         LA    WORKREG,NOF1DSCB         NO F1 DSCB ERROR CODE    Y02132 05234002
         STH   WORKREG,ERCODE           SAVE ERROR CODE          Y02132 05238002
         B     DEQTEST                  GO DEQ FROM THE TIOT     Y02132 05242002
*                                                                       05246002
VIOBTAIN EQU   *                        OBTAIN VIO DATA SET DSCB Y02132 05250002
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02132 05254002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02132 05258002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02132 05262002
         MVC   K0(VDATALN,RWKAREA),VDSDSCB+L'DS1DSNAM            Y02132 05266002
         XC    VDATALN(DATAL-VDATALN,RWKAREA),VDATALN(RWKAREA)   Y02132 05270002
*                                       CLEAR REST OF DATA AREA  Y02132 05274002
         XC    DATAL(CCHHRL,RWKAREA),DATAL(RWKAREA)              Y02132 05278002
*                                       CLEAR CCHHR AREA         Y02132 05282002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02132 05286002
         DROP  R1                                                Y02132 05290002
*                                                                       05294002
DEQTEST  EQU   *                        DEQ TIOT                 Y02132 05298002
         LA    RB,LEAVE                 SET UP RETURN ADDRESS    YM5378 05302002
DEQTEST1 EQU   *                        TEST IF TIOT ENQ'ED      Y02132 05306002
         TM    DSMADTB2,DSMTIOTE        TEST IF TIOT ENQ'ED      Y02132 05310002
         BCR   8,RB                     BRANCH IF NOT            YM5378 05314002
         MVC   ENQAREA(DEQLTH),DEQLIST  MOVE IN DEQ PARM LIST    Y02132 05318002
         DEQ   (MJELNAME,TIOTMNR),MF=(E,ENQAREA)  ISSUE DEQ      Y02132 05322002
*                                                                       05326002
         NI    DSMADTB2,X'FF'-DSMTIOTE  RESET TIOT ENQ'ED BIT    Y02144 05330002
         BR    RB                       RETURN                   YM5378 05334002
*                                                                       05346021
* THIS SECTION EXECUTES A CHANNEL PROGRAM.                              05352021
*                                                                       05360000
EXECIO   EQU   *                                                 S20201 05361002
         TM    UCBTBYT2,RPSMSK          DOES DEVICE HAVE RPS     S20201 05362002
         BZ    NORPS3                   NO, CONTINUE AS NORMAL   S20201 05363002
         LA    R2,THETA                 GET THETA ADDRESS        S20201 05364002
         XC    CCW2+FW(FW),CCW2+FW      CLEAR WORK WORD          S20201 05365002
         MVC   CCW2+FW(ONE),UCBTBYT4    GET DEVICE CODE          S20201 05366002
         O     R2,CCW2+FW               PUT IN HIGH BYTE         S20201 05367002
         L     R0,PARM0                 GET DDK FOR SCR          S20201 05368002
         IC    R0,SEEK+C7               GET RECORD NUMBER        S20201 05369002
         USING CVT,RCVT                 CVT ADDRESSABILITY       Y02080 05370002
         L     WORKREG,CVT0SCR1         GET ROUTINE ADDRESS      Y01077 05371000
         LR    R3,R9                    SAVE REGISTER            S20201 05372002
         STM   RWKAPTR,RETURN,IECREGSV+K12   SAVE REGISTERS 9-14 Y02080 05373002
         BALR  RETURN,WORKREG           GET SECTOR VALUE         S20201 05376002
         LM    RWKAPTR,RETURN,IECREGSV+K12-OBTNWKA(R3)  RESTORE  Y02080 05377002
NORPS3   EQU   *                                                 S20201 05381002
         EXCP  IOB                                               S20201 05382002
         WAIT  1,ECB=ECB                                                05400000
         TM    ECB,X'20'               TEST ECB FOR PERMANENT ERROR     05420000
         BZ    PERMERR                 BR IF ERROR                      05440000
         BR    RETURN                                                   05460000
*                                                                       05464002
* THIS SECTION READS THE FORMAT 4 DSCB AND ENSURES THAT THE USER'S      05468002
* CCHHR IS WITHIN THE EXTENTS OF THE VTOC.                              05472002
*                                                                       05480000
SEEKDSCB LM    R0,R5,CHANPROG          LOAD CCW1 TO CCW3 CONSTANTS      05500000
         AR    R0,RWKAPTR               RESOLVE ADDR IN CCW1.           05520000
         AR    R2,RWKAPTR               RESOLVE ADDR IN CCW10.          05540000
         AR    R4,RWKAPTR               RESOLVE ADDR IN CCW3     Y02078 05560002
         STM   R0,R5,CCW1              STORE CCW1 TO CCW3               05580000
         MVI   CCW3+4,X'00'            TURN OFF COMMAND CHAIN BIT       05600000
         BAL   RETURN,EXECIO           EXECUTE THE CHANNEL PROGRAM      05640000
         CLI   DS4IDFMT,F4             TEST FOR FORMAT 4 ID      Y02078 05660002
         BNE   PERMERR                 BRANCH IF NOT             Y02078 05720002
FIX      LA    R1,DEB                                                   05740000
         MVC   38(8,R1),DS4VTOCE+2     MOVE EXTENTS OF VTOC INTO DEB    05760000
         L     WORKREG,4(0,PL)         LOAD ADDR OF DATA SET CCHHR      05780000
         CLC   0(4,WORKREG),DS4VTOCE+2 CHECK FOR EXTENT WITHIN @ZA17992 05782037
         BC    4,ERROR20                VTOC                   @ZA17992 05784037
         CLC   0(4,WORKREG),DS4VTOCE+6  CHECK ABSOLUTE TRACK ADDR 13395 05786016
         BC    2,ERROR20               BRANCH IF OUT OF VTOC EXT  13395 05792016
         CLC   SEEK+K3(CCHHRL),0(WORKREG) CHECK IF F4 WANTED     YM8538 05793002
         BNE   READF1                   BRANCH TO READ F1 DSCB   YM8538 05795002
         MVC   DS1DSNAM,F4NAME          FORMAT 4 DSNAME          YM8538 05796002
         MVC   DS1FMTID(L'F4DSCB),F4DSCB F4 DSCB TO RETURN AREA  YM8538 05797002
         B     RETPARM2                 RETURN TO CALLER         YM8538 05799002
*                                                                YM8538 05799202
READF1   EQU   *                        READ FORMAT 1 DSCB       YM8538 05799402
*                                                                YM8538 05799602
         MVC   SEEK+3(5),0(WORKREG)    MOVE DATA SET CCHHR TO IOS SEEK  05800000
         LM    R0,R1,CHALPROG          LOAD CCW3 CONSTANT               05820000
         AR    R0,RWKAPTR              RESOLVE ADDR IN CCW3      Y02078 05840002
*                                                                       05842000
* THIS SECTION RELOCATES AND EXECUTES THE SEEK OPTION CHANNEL PROGRAM.  05846021
*                                                                       05852021
         STM   R0,R1,CCW3              STORE CCW3                       05860000
         BAL   RETURN,EXECIO           EXECUTE THE CHANNEL PROGRAM      05900000
*                                                                YM8538 05901002
RETPARM2 EQU   *                        RETURN PARMS TO CALLER   YM8538 05901202
*                                                                YM8538 05901402
         L     R1,TCBADDR               LOAD TCB ADDRESS         Y02078 05902002
         USING TCB,R1                   TCB ADDRESSABILITY       Y02078 05904002
         MODESET EXTKEY=RBT234,WORKREG=2  SWITCH TO CALLER'S KEY Y02078 05906002
         MVC   K0(L'OBTDSCB,RWKAREA),OBTDSCB  MOVE IN DSCB       Y02078 05910002
         MODESET EXTKEY=ZERO            RETURN TO KEY ZERO       Y02082 05920002
         DROP  R1                                                Y02078 05930002
         B     LEAVE                                                    05960000
ERROR20  EQU   *                                                  13395 05965016
         LA    WORKREG,20              CCHH OUT OF VTOC EXTENT    13395 05970016
         B     SETCODE                 BRANCH TO RETURN           13395 05975016
*                                                                       05980000
*** PROGRAM CONSTANTS                                                   06000000
*                                                                       06020000
CSYS     DC    CL3'SYS'                 CONSTANT OF 'SYS'        Y02132 06021002
CDOTT    DC    CL2'.T'                  CONSTANT OF '.T'         Y02132 06022002
CDOTR    DC    CL2'.R'                  CONSTANT OF '.R'         Y02132 06023002
BLANKS   DC    CL6' '                   SIX EBCDIC BLANKS        Y02132 06024002
F4NAME   DC    0XL44'04',44X'04'        FORMAT 4 DSNAME          YM8549 06025002
DEQLIST  DEQ   (,,6,SYSTEM),MF=L        DEQ PARAMETER LIST       YM5902 06026002
DEQLTH   EQU   *-DEQLIST                LENGTH OF DEQ PARM LIST  Y02132 06027002
TIOTMJR  DC    CL8'SYSZTIOT'            TIOT MAJOR RESOURCE NAME Y02132 06028002
ENQLIST  ENQ   (,,S,6,SYSTEM),RET=HAVE,MF=L  ENQ PARAMETER LIST  Y02132 06031002
ENQLTH   EQU   *-ENQLIST                LENGTH OF ENQ PARM LIST  Y02132 06032002
EXTCONST DC    X'FFFFFFFF7FFF'         LAST CCHH AND NUM OF TKS         06040000
RPSCCW   DS    0F                       SET SECTOR COMMAND       S20201 06042002
         DC    X'23'                    COMMAND CODE             S20201 06044002
         DC    X'000000'                ADDR                     S20201 06046002
         DC    X'4000'                  FLAGS                    S20201 06048002
         DC    H'1'                     COUNT                    S20201 06050002
PARM0    DS    0F                       AREA TO BUILD PARAMETERS S20201 06052002
DD       DC    X'0060'                  DATA LENGTH              S20201 06054002
K        DC    X'2C'                    KEY  LENGTH              S20201 06056002
R        DC    X'0'                     RECORD NUMBER            S20201 06058002
*                                                                       06060000
*** THE FOLLOWING CHANNEL PROGRAM SEARCHES THE VTOC FOR THE NAMED DSCB. 06080000
*** THE NAMED DSCB IS READ INTO THE INPUT AREA.                         06100000
*                                                                       06120000
CHANPROG DS    0F                                                       06140000
*CCW1                                                                   06160000
         DC    X'31'                   SEARCH EQUAL ID (SEEK+3)         06180000
         DC    AL3(3+SEEK-OBTNWKA)     SEEK ADDR                 Y02080 06200002
         DC    X'4000'                                                  06220000
         DC    H'5'                                                     06240000
*CCW2                                                                   06260000
         DC    X'08'                   TIC TO CCW1                      06280000
         DC    AL3(0+CCW1-OBTNWKA)     TIC TO ADDR               Y02080 06300002
         DC    F'0'                                                     06320000
*CCW3                                                                   06340000
         DC    X'06'                    READ DATA OF F4 DSCB     Y02078 06360002
         DC    AL3(0+F4DSCB-OBTNWKA)    DATA ADDR                Y02078 06380002
         DC    X'4000'                                                  06400000
         DC    H'96'                                                    06420000
*CCW4                                                                   06440000
         DC    X'F1'                    SEARCH HI OR EQ LST FMT1.       06460000
         DC    AL3(0+DS4HPCHR-OBTNWKA)  SEARCH ADDR              Y02078 06480002
         DC    X'4000'                                                  06500000
         DC    H'5'                                                     06520000
*CCW5                                   TO BE CONSTRUCTED               06540000
*                                       TIC TO CCW9                     06560000
*CCW6                                   TO BE CONSTRUCTED               06580000
*                                       SEARCH EQUAL KEY (DS NAME)      06600000
*CCW7                                   TO BE CONSTRUCTED               06620000
*                                       READ DATA OF THE LAST   SA48172 06622002
*                                       FORMAT 1 WITH THE SKIP  SA48172 06624002
*                                       BIT SET IN ORDER TO END SA48172 06626002
*                                       THE CHANNEL PROGRAM     SA48172 06628002
*CCW8                                   TO BE CONSTRUCTED               06660000
*                                       TIC TO CCW11                    06680000
*CCW9                                                                   06700000
         DC    X'29'                   SEARCH EQUAL KEY (DS NAME)       06720000
         DC    AL3(0)                                                   06740000
         DC    X'6000'                                                  06760000
         DC    H'44'                                                    06780000
*CCW10                                                                  06800000
         DC    X'08'                   TIC TO CCW4                      06820000
         DC    AL3(0+CCW4-OBTNWKA)     TIC TO ADDR               Y02078 06840002
         DC    F'0'                                                     06860000
*CCW11                                                                  06880000
         DC    X'06'                    READ DATA OF F1 DSCB     Y02078 06900002
         DC    AL3(DS1FMTID-OBTNWKA)    DATA ADDR                Y02078 06920002
         DC    X'4000'                                                  06940000
         DC    H'96'                                                    06960000
*CCW12                                                                  06980000
         DC    X'12'                   READ COUNT (NEWCCHHR)            07000000
         DC    AL3(0+NEWCCHHR-OBTNWKA) DATA ADDR                 Y02078 07020002
         DC    X'2000'                                                  07040000
         DC    H'5'                                                     07060000
*                                                                       07080000
*** THE FOLLOWING CHANNEL PROGRAM SEARCHES A TRACK AND READS A DSCB     07100000
*** INTO THE INPUT AREA.                                                07120000
*                                                                       07140000
CHALPROG DS    0F                                                       07160000
*CCW1                                   TO BE CONSTRUCTED               07180000
*                                       SEARCH EQUAL ID (SEEK+3)        07200000
*CCW2                                   TO BE CONSTRUCTED               07220000
*                                       TIC TO CCW1                     07240000
*CCW3                                                                   07260000
         DC    X'0E'                    READ KEY & DATA OF DSCB  Y02078 07280002
         DC    AL3(OBTDSCB-OBTNWKA)     DATA ADDR                Y02078 07300002
         DC    X'0000'                                                  07320000
         DC    H'140'                                                   07340000
*                                                                       07350002
* TABLE OF MODULE NAMES AND ENTRY POINT ADDRESSES                       07360002
*                                                                       07370002
         XCTLTABL ID=(FIRSTLD,IGC0002G,VSAMMOD,IGC0102G),        Y02080X07380002
               SVC=027,LENGTH=,BRT=YES                           Y02080 07390002
         SPACE 2                                                 Y02080 07400002
         IECDSECS CVT,DSAB,JSCB,QDB,PSA,RB,RRPL,TCB,TIOT,UCB,    Y02132X07410002
               ASCB,                                             YM3996X07413002
               EXPAND=YES                                        Y02132 07420002
WORKAREA IECOBTWA EP,F4,D1=(1),ADT=YES  OBTAIN WORK AREA         Y02144 07500002
         EJECT                                                   Y02132 07550002
         IDDVDSCB                       VDSCB MAPPING MACRO      Y02132 07600002
         END                                                            08080000
