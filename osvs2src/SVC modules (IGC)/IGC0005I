         TITLE '   ROOT MODULE FOR SVC 59   OLTEP OWNED '               00140002
IGC0005I CSECT     ROOT MODULE FOR SVC 59   OLTEP OWNED                 00150002
         SPACE 3                                                        00180002
****************************************************************X03008* 00270002
*                                                               X03008* 00360002
* MODULE NAME = IGC0005I.    DECEMBER 20, 1972                  X03008* 00450002
*                                                               X03008* 00540002
* DESCRIPTIVE NAME = SVC-59, OLTEPS PRIVILIGED SVC.             X03008* 00630002
*                                                               X03008* 00720002
* COPYRIGHT =                                                   X03008* 00810002
*                                                               X03008* 00900002
* STATUS = THIS MODULE WAS COMPLETLY REWRITTEN FOR VS1/3        X03008* 00990002
*          AND VS2/2.                                           X03008* 01080002
*                                                               X03008* 01170002
* FUNCTION = THE FUNCTION WHICH THIS SVC WILL PERFORM IS        X03008* 01260002
*            DEPENDENT UPON THE CALLING CODE IN REGISTER        X03008* 01350002
*            ONE AT ENTRY TIME. THIS IS A TYPE IV SVC AND       X03008* 01440002
*            ACCESSES OTHER SVC 59 LOAD MODULES VIA XCTL.       X03008* 01530002
*                                                               X03008* 01540002
*                                                               X03008* 01550002
*                                                               X03008* 01560002
*            THE FOLLOWING TABLE WILL IDENTIFY THE FUNCTIONS OF X03008* 01580002
*            SVC 59.                                            X03008* 01590002
*                                                               X03008* 01620002
*            IF R1 = 00 AN OUTSTANDING WTOR WILL BE REMOVED     X03008* 01670002
*                    FROM THE RQE CHAIN. A DUMMY RESPONSE       X03008* 01680002
*                    OF  'S' WILL BE USED. SVC34 WILL BE        X03008* 01690002
*                    USED.                                      X03008* 01700002
*                                                               X03008* 01702002
*            IF R1 = 04 THE UCBS REQUESTED FOR CUTEST SUPPORT   Y02008* 01704002
*                    WILL BE LOOKED-UP. THIS FUNCTION WILL      Y02008* 01804002
*                    ALTER THE UCBNALOC.                        Y02008* 01904002
*                                                               Y02008* 02004002
*            IF R1 = 08 IT WILL BE DETERMINED IF OLTEP IS IN    Y02008* 02104002
*                    AN MP ENVIRONMENT                          Y02008* 02204002
*                                                               Y02008* 02304002
*            IF R1= 0C A 3830 ATTACHED TO A 3850 MASS        @Y30LPAW*/ 02404003
*                    STORAGE SYSTEM WILL BE VARIED OFF       @Y30LPAW*/ 02454003
*                                                               Y02008* 02604002
*           IF R1 = 10 A 3330 SSID (WHEN ATTACHED TO A       @Y30LPAW*/ 02704003
*                    3850 MASS STORAGE SYSTEM) WILL BE       @Y30LPAW*/ 02734003
*                    PUT INTO A LIST FOR US BY CLEANUP       @Y30LPAW*/ 02764003
*                                                               X03008* 02970002
*            IF R1 = 14 THE CLEANUP OF UCBS AND DEB             X03008* 03060002
*                    CHAIN WILL OCCUR. THE CVTOLTEP             X03008* 03150002
*                    WORD WILL ALSO BE ZEROED.                  X03008* 03240002
*                                                               X03008* 03330002
*            IF R1 = 18 NO FUNCTION WILL BE PERFORMED           X03008* 03420002
*                    AND R15 WILL CONTAIN A 04 ON EXIT.         X03008* 03510002
*                                                               X03008* 03600002
*            IF R1 = 1C NO FUNCTION WILL BE PERFORMED           Y02008* 03690002
*                    AND R15 WILL CONTAIN A 04 ON EXIT          Y02008* 03780002
*                                                               X03008* 03870002
*            IF R1 = 20 NO FUNCTION WILL BE PERFORMED           X03008* 03960002
*                    AND REG15 WILL CONTAIN AN 04 ON EXIT       X03008* 04050002
*                                                               X03008* 04140002
*            IF R1 = 24 NO FUNCTION WILL BE PERFORMED           Y02008* 04230002
*                    AND R15 WILL CONTAIN A 04 ON EXIT          Y02008* 04330002
*                                                               Y02008* 04430002
*            IF R1 = 28 NO FUNCTION WILL BE PERFORMED           Y02008* 04530002
*                    AND R15 WILL CONTAIN A 04 ON EXIT          Y02008* 04630002
*                                                               Y02008* 04730002
*            IF R1 = 2C NO FUNCTION WILL BE PERFORMED           Y02008* 04830002
*                    AND R15 WILL CONTAIN A 04 ON EXIT          Y02008* 04930002
*                                                               Y02008* 05030002
*            IF R1 = 30 NO FUNCTION WILL BE PERFORMED           Y02008* 05130002
*                    AND R15 WILL CONTAIN A 04 ON EXIT          Y02008* 05230002
*                                                               Y02008* 05330002
*            IF R1 = 34 NO FUNCTION WILL BE PERFORMED           Y02008* 05590002
*                    AND R15 WILL CONTAIN A 04 ON EXIT          Y02008* 05690002
*                                                               X03008* 05760002
*            IF R1 = 38 NO FUNCTION WILL BE PERFORMED AND       X03008* 05850002
*                    REGISTER 15 WILL CONTAIN AN 04 ON EXIT     X03008* 05940002
*                                                               X03008* 06030002
*            IF R1 = 3C A CHECK OF UCB ON-OFFLINE STATUS        X03008* 06120002
*                    WILL BE PERFORMED. IF UCB IS ONLINE        X03008* 06210002
*                    R15 WILL EQ 'F0'. IF THE UCB IS IN-        X03008* 06300002
*                    VALID R15 WILL= 'FF'. ALSO IF R1 =         X03008* 06390002
*                    803C THE VOL=SER WILL BE MOVED.            X03008* 06480002
*                                                               X03008* 06570002
*            IF R1 = 40 A UCBLOOK UP FOR EACH DEVTAB            X03008* 06660002
*                    ENTRY WILL BE PERFORMED. THIS              X03008* 06750002
*                    FUNCTION WILL USE THE IOSGEN               X03008* 06840002
*                    MACRO.                                     X03008* 06930002
*                                                               X03008* 07020002
*            IF R1 = 44 NO FUNCTION WILL BE PERFORMED           Y02008* 07110002
*                    AND R15 WILL CONTAIN A 04 ON EXIT          Y02008* 07310002
*                                                               X03008* 07650002
*            IF R1 = 48 THE OLTEP REI DEB WILL BE MOVED TO A    Y02008* 07740002
*                    PROTECTED SUBPOOL AND PLACED AT THE        Y02008* 07940002
*                    BEGINNING OF THE TCB DEB CHAIN.            Y02008* 08140002
*                                                               X03008* 08370002
*            IF R1 = 4C A REAL ADDRESS WILL BE TRANSLATED TO    Y02008* 08460002
*                    A VIRTUAL ADDRESS                          Y02008* 08560002
*                                                               X03008* 08820002
*            IF R1 = 50 OLTEP WILL PURGE AN IO EVENT AND FREE   Y02008* 08910002
*                    NECESSARY CONTROL BLOCKS AND AREAS. IF     Y02008* 08950002
*                    R1 = 8050 OLTEP WILL FREE NECESSARY BLOCKS Y02008* 08990002
*                    AND AREAS ASSOCIATED WITH A COMPLETE EVENT Y02008* 09030002
*                                                               X03008* 09090002
*            IF R1 = 54 THE UCB NOTREADY BIT WILL BE TESTED.    X03008* 09180002
*                    IF THE NR BIT = ON, R15 WILL BE FF ON      X03008* 09270002
*                    EXIT.                                      X03008* 09360002
*                                                               X03008* 09450002
*            IF R1 = 58 OLTEP INITIALIZATION WILL BE PERFORMED. Y02008* 09490002
*                    OLTEP INITIALIZATION INCLUDES              Y02008* 09530002
*                       - CHECK FOR 2 OLTEPS                    Y02008* 09570002
*                       - SAVE ASCB MEMORY ID IN THE DIE        Y02008* 09610002
*                       - MOVE IFDOLT57 TO PROTECTED CORE- SP245Y02008* 09650002
*                       - OBTAIN CPU ID AND STORE IN SCT       @ZA15468 09670041
*                       - OBTAIN & SET UP UCB MASK TABLE        Y02008* 09690002
*                       - OBTAIN SPACE FOR REI DEB              Y02008* 09730002
*                       - SET TCBOLTEP FLAG ON IN TCB           Y02008* 09770002
*                       - FIND 2955 UCB IF ONE EXISTS           Y02008* 09810002
*                       - TELL CALLER IF OLTEP HAS BEEN INVOKED Y02008* 09850002
*                         V=R OR V=V                            Y02008* 09890002
*                                                               Y02008* 09930002
*            IF R1 = 5C AN IO OPERATION WILL BE PERFORMED. IN   Y02008* 09970002
*                    ORDER TO PERFORM IO OLTEP BUILDS THE       Y02008* 10010002
*                    APPROPRIATE CONTROL BLOCKS AND USES THE    Y02008* 10050002
*                    STARTIO MACRO.                             Y02008* 10090002
*                                                               Y02008* 10130002
*            IF R1 = 60 VERIFICATION OF A CHOSEN CPU AFFINITY   Y02008* 10170002
*                    WILL BE DONE                               Y02008* 10210002
*                                                               Y02008* 10250002
* NOTES = A BRANCH TABLE WILL BE USED TO LOCATE THE REQUIRED    X03008* 10350002
*         FUNCTION.                                             X03008* 10440002
*                                                               X03008* 10530002
*    DEPENDENCIES : THE TESTAUTH MACRO                          X03008* 10620002
*                       CVT DSECT                               X03008* 10710002
*                       TCB DSECT                               X03008* 10800002
*                       UCM DSECT                               X03008* 10890002
*                       RQE MAP MUST ALL APPEAR IN THIS CSECT.  X03008* 10980002
*                                                               X03008* 11070002
* RESTRICTIONS = THE CALL MUST BE AN AUTHORIZED PROGRAM         X03008* 11160002
*                AS DEFINED BY THE TESTAUTH MACRO               X03008* 11250002
*                                                               X03008* 11340002
* REGISTER CONVENTIONS = ON ENTRY:  R0 = ADDRESS OF PARAMETER   X03008* 11430002
*                                        LIST                   X03008* 11520002
*                                                               X03008* 11610002
*                                   R1 = A VALID CALL CODE      X03008* 11700002
*                                                               X03008* 11790002
*                                   R3 = CVT POINTER            X03008* 11880002
*                                                               X03008* 11970002
*                                   R4 = TCB POINTER            X03008* 12060002
*                                                               X03008* 12150002
*                                   R5 = RB  POINTER            X03008* 12240002
*                                                               X03008* 12330002
*                                   R14= RETURN POINT TO        X03008* 12420002
*                                        C.P.                   X03008* 12510002
*                                                               X03008* 12600002
*   PATCH LABEL = PATCH5I, THIS LABEL WILL BE ON THE OLTEP      X03008* 12690002
*                          IFDPATCH.                            X03008* 12780002
*                                                               X03008* 12870002
* MODULE TYPE = TYPE IV SVC.                                    X03008* 12960002
*    PROCESSOR = ANY 370 MACHINE WITH THE 370 INSTRUCTION SET.  X03008* 13050002
*                                                               X03008* 13140002
*    MODULE SIZE = LESS THAN 2K BYTES.                          X03008* 13230002
*                                                               X03008* 13320002
*    ATTRIBUTES = REENTRANT.                                    X03008* 13410002
*                                                               X03008* 13500002
* ENTRY POINT = IGC0005I.                                       X03008* 13590002
*                                                               X03008* 13680002
*    PURPOSE = PROVIDE OLTEP WITH PRIVILIGED OPERATIONS.        X03008* 13770002
*                                                               X03008* 13860002
*    LINKAGE = XCTL AND BRANCH TABLE.                           X03008* 13950002
*                                                               X03008* 14040002
* INPUT = SAME AS REGISTER CONVENTIONS ABOVE.                   X03008* 14130002
*                                                               X03008* 14220002
* OUTPUT = SEE FUNCTION DESCRIPTION ABOVE.                      X03008* 14310002
*                                                               X03008* 14400002
* EXIT NORMAL = AT LABEL EXIT00.                                X03008* 14490002
*                                                               X03008* 14580002
* EXIT ABNORMAL = AT LABEL EXIT04.                              X03008* 14670002
*                                                               X03008* 14760002
* EXTERNAL REFERENCES = SEE BELOW                               X03008* 14850002
*                                                               X03008* 14940002
*    ROUTINES = TESTAUTH AND IOSGEN AND SVC34 AND GETMAIN       X03008* 15030002
*               AND XCTL AND FREEMAIN MODESET                   X03008* 15120002
*    DATA AREA = OLTEP COMMON AREA                              X03008* 15210002
*                                                               X03008* 15300002
*    CONTROL BLOCKS = CVT TCB RQE UCB UCM                       X03008* 15390002
*                                                               X03008* 15480002
* TABLES = NONE                                                 X03008* 15570002
*                                                               X03008* 15660002
* MACROS = SAME AS DEPENDENCIES ABOVE                           X03008* 15750002
*                                                               X03008* 15840002
* CHANGE ACTIVITY                                               X03008* 15930002
*  VS2-2.0 PTM YM08149 ADDED FOR VIRTUAL SUPPORT (3705,REI), OLTEP IS   15960002
*  NON-SWAPPABLE IN VIRTUAL STORAGE.                           YM08149  15990002
*  VS2R3.7(SU10)--10/10/77--OZ26394                                   * 16000010
*                                                               X03008* 16020002
****************************************************************X03008* 16110002
         SPACE 3                                                 X03008 16200002
*****************************************************************X03008 16290002
*                                                               *X03008 16380002
*  EQUATES, DISPLACEMENTS, MASKS, ADDRESS CONSTANTS AND         *X03008 16470002
*  OTHER  STUFF AND THINGS                                      *X03008 16560002
*                                                               *X03008 16650002
*****************************************************************X03008 16740002
D0       EQU   0                       DISPLACEMENT OF ZERO      X03008 16830002
POOLADR  EQU   0                       SAVE SUBPOOL ADDR HERE    X03008 16920002
POOLSIZE EQU   0                       REG FOR GETMAIN           X03008 17010002
L0       EQU   0                                               @ZA12058 17050041
R0       EQU   0                       REGISTER ZERO             X03008 17150002
REG0     EQU   0                       REGISTER ZERO             X03008 17190002
ZEROO    EQU   0                       USED IN BASE REG WORK     X03008 17280002
RCREG1   EQU   1                       GENERAL PURPOSE REGISTER 1X03008 17550002
ONE      EQU   1                       SHIFT COUNT               X03008 17590002
L1       EQU   1                       DISPLACEMENT CONSTANT     X03008 17640002
R1       EQU   1                       GENERAL PURPOSE REGISTER  X03008 17820002
REG1     EQU   1                       WORK REGISTER 1           X03008 17910002
VIRTUAL  EQU   1                       REG 1, IF MINUS V=V ASSUMEX03008 18000002
HEX01    EQU   X'01'                   PSEUDO DEVTAB BIT         X03008 18050002
D1       EQU   1                       LOW BYTE UCB ADDR NEVER   X03008 18090002
*                                      BY INITILIZATION MODULES  X03008 18270002
PARMREG  EQU   1                       POINTER TO REQUESTORS     X03008 18450002
*                                      PARAMETER LIST.           X03008 18540002
WKREG1   EQU   1                       REGISTER WORKING REG.     X03008 18630002
HEX00    EQU   X'00'                   OPTION FOR XLATE          Y02008 18670002
HEX02    EQU   X'02'                   TCB OLTEP BIT MASK        X03008 18720002
WORKREG2 EQU   2                       WORKING REGISTER          X03008 18810002
D2       EQU   2                       DISP TO NEXT UCB PTR      X03008 18900002
L2       EQU   2                       DISPLACEMENT CONSTANT     X03008 19080002
R2       EQU   2                                               @ZA12058 19090041
SRBREG   EQU   2                       SRB POINTER               Y02008 19100002
CVTOLT   EQU   2                       CVT OLT REG               Y02008 19120002
THREE    EQU   3                       USED IN SHIFT INST        Y02008 19140002
CVTREG   EQU   3                       POINTER TO SYS CVT.       X03008 19170002
L3       EQU   3                       LENGTH ATTRIBUTE          X03008 19260002
D3       EQU   3                       DISPLACEMENT OF UCB FLAGS X03008 19350002
D4       EQU   4                       DISP INTO XCTL PARM LIST  X03008 19440002
BCTREG   EQU   4                       BCT ON 32 BIT MASK        X03008 19480002
TCBREG   EQU   4                       POINTER TO OLTEP TCB      X03008 19530002
HEX04    EQU   X'04'                   UCBNALOC MASK             X03008 19620002
L4       EQU   4                       DISPLACEMENT CONSTANT     X03008 19710002
IOSBREG  EQU   5                       IOSB PTR                  Y02008 19810002
WORKRG   EQU   5                       WORK REG                  Y02008 19820002
UCBTAB   EQU   5                       POINTER REGISTER          X03008 19850002
D5       EQU   5                       DISPLACEMENT FIELD        X03008 19890002
R5       EQU   5                       GENERAL PURPOSE REGISTER  X03008 19980002
HEX06    EQU   X'06'                   ZUES I  MASK IN UCB       X03008 20070002
HEXADDR  EQU   6                       DEVICE ADDR IN HEX        X03008 20160002
D6       EQU   6                       DISPLACEMENT FIELD        X03008 20250002
UCMREG   EQU   6                       USED IN FENC 33 WTOR      X03008 20340002
SCAN     EQU   6                       POINTER REGISTER          X03008 20390002
WKREG6   EQU   6                       WORKING REGISTER          X03008 20430002
DEVTBL   EQU   6                       PTR TO DEVTAB             Y02008 20530002
WORKREG  EQU   6                       REG USED IN GETTIN CORE   Y02008 20540002
ASCBREG  EQU   6                       DE SECT REG               Y02008 20550002
R6       EQU   6                       WORK REG                  Y02008 20560002
CSDREG   EQU   6                       CSD POINTER               Y02008 20580002
CALLER   EQU   6                       SAVE CALLCODE HERE        X03008 20660002
L6       EQU   6                       DISPLACEMENT CONSTANT     X03008 20790002
UCBREG   EQU   6                       POINTER TO UCB            X03008 20880002
PPLREG   EQU   6                       PTR TO PURGE PARMLIST     Y02008 20920002
LDAREG   EQU   6                       LDA REGISTER              Y02008 20940002
HEX07    EQU   X'07'                   ZUES II MASK IN UCB       X03008 20970002
D7       EQU   7                       LOW BYTE DEV ADDR         X03008 21060002
TDEBREG  EQU   7                       USED IN MOVE DEB FUNCTION X03008 21150002
R7       EQU   7                       REGISTER SEVEN            Y02008 21160002
WKREG7   EQU   7                       WORKING REG               Y02008 21170002
SAVE1    EQU   7                       SAVE REG FOR UCBTAB SIZE  Y02008 21190002
RQEREG   EQU   7                       USED IN FENC 33 WTOR      X03008 21240002
UCBADDR  EQU   7                       POINTER TO UCB            X03008 21420002
D8       EQU   8                       DISP TO UCB ADDR IN DEVTABX03008 21600002
SHIFTER  EQU   8                       SHIFT REG FOR MASKS       X03008 21640002
R8       EQU   8                       GENERAL PURPOSE REGISTER  X03008 21690002
TCCWREG  EQU   8                       POINTER TO TCCW           Y02008 21700002
DUMMY1   EQU   8                       USED TO CLEAR UCBTAB      Y02008 21710002
DIEPTR   EQU   8                       POINTER TO DIE PREFACE    Y02008 21720002
MODELREG EQU   8                       POINTER TO MODEL IOSB     Y02008 21730002
PARM1    EQU   8                       1ST PARAMETER             Y02008 21740002
L8       EQU   8                       DISPLACEMENT CONSTANT     X03008 21780002
ERRCODE  EQU   8                       RETURN CODE               X03008 21870002
DEB254RG EQU   8                       USED IN MOVE DEB FUNCTION X03008 21960002
DEVTAB   EQU   8                       POINTER TO DEVTAB ENTRY   X03008 22050002
DEVREG   EQU   DEVTAB                  OLTEP DEVTEB ENTRY POINTERX03008 22140002
VOLSERAD EQU   8                       REG POINTER TO VOLSER     X03008 22230002
HEX08    EQU   X'08'                   ALLOCATED FLAG IN UCB     X03008 22320002
HEX09    EQU   X'09'                   3277 TYPE                 X03008 22410002
ODDREG   EQU   9                       HOLDS WORD OF MASKS       X03008 22450002
D9       EQU   9                       DISPLACEMENT FIELD        X03008 22500002
PARMRG9  EQU   9                       PARM LIST REG             Y02008 22520002
PARM2    EQU   9                       PARAMETER REG             Y02008 22530002
R9       EQU   9                       WORK REG 9                Y02008 22540002
SAVEREG9 EQU   9                       SAVE ROPT ADDR HERE       X03008 22590002
DEVCNT   EQU   9                       COUNT OF DEVTAB ENTRIES   X03008 22680002
CNTREG   EQU   DEVCNT                  NUMBER OF DEVTABS         X03008 22770002
HEX10    EQU   X'10'                   COMMO EQUIP CLASS         X03008 22860002
DUMMY2   EQU   9                       USED TO CLEAR UCBTAB      Y02008 22870002
LINK     EQU   10                      BALR TO GETMAIN REG       Y02008 22880002
PARM3    EQU   10                      PARAMETER REG             Y02008 22890002
FREERG   EQU   10                      SAVE AREA FOR 160 BYTE AREA      22900002
SAVE     EQU   10                      SAVE REG FOR UCB COUNT    Y02008 22910002
SAVEPTR  EQU   10                      POINTER TO 16 WORD SAVE   X03008 22950002
R10      EQU   10                                              @ZA12058 23040041
BASEREG  EQU   11                      BASE REG FOR IGC0005I     X03008 23130002
D11      EQU   11                      DISP TO UCB ATTN INDEX    X03008 23180002
HEX0B    EQU   X'0B'                   USED IN ANR CHECKS        X03008 23220002
IODEVAD  EQU   12                      PTR TO 12 BYTE BLOCK      Y02008 23260002
D12      EQU   12                      DISP TO DEVTAB FLGS       X03008 23310002
WRKREG12 EQU   12                      WORK REGISTER             Y02008 23320002
L12      EQU   12                      LENGTH 12                 Y02008 23340002
COUNT    EQU   12                      USED IN LOOKUP            X03008 23360002
INDEX    EQU   13                      USED IN LOOKUP            X03008 23370002
FIXED    EQU   13                      POINTER TO ASVE AREA (BEB)Y02008 23377002
SAVEM    EQU   13                      POINTER TO DIE SAVE AREA  Y02008 23384002
SAVEREG  EQU   SAVEM                   SAVE AREA ADDR            Y02008 23391002
L13      EQU   13                      LENGTH ATTRIBUTE          X03008 23400002
R13      EQU   13                      USED IN LOOKUP            X03008 23450002
REG13    EQU   13                      AREA IN CALLING MODULE.   X03008 23580002
RETURN   EQU   14                      EXIT REGISTER             X03008 23670002
HEX14    EQU   X'14'                   CALL CODE IF FROM ABEND   X03008 23720002
D14      EQU   14                      DISP TO DEVTAB FLGS       X03008 23760002
R14      EQU   14                      SYSTEM RETURN REG         Y02008 23800002
EXIT     EQU   14                      REG TO RETURN ON          X03008 23850002
PKEYREG  EQU   15                      CONTAINS PROT. KEY        X03008 23940002
RCREG    EQU   15                      RETURN CODE REGISTER      X03008 24030002
R15      EQU   15                      SYSTEM GOTO REG           Y02008 24050002
D15      EQU   15                      DISP OF SOME FIFTEENS     Y02008 24070002
IOCREG   EQU   15                      REGISTER 15               Y02008 24090002
RETCODE  EQU   15                      REG 15, FUNC17 USES IT    X03008 24120002
*                                      ODD DIGET                 X03008 24210002
RTNCODE  EQU   RETCODE                 CONTAINS RETURN CODE      X03008 24300002
MAIN15   EQU   15                      WORK AREA REG ON XCTL     X03008 24390002
D16      EQU   16                      DISPLACEMENT 16           Y02008 24510002
L16      EQU   16                      LENGTH 16                 Y02008 24540002
D18      EQU   18                      DISP TO UCB CDS CLASS     X03008 24570002
D19      EQU   19                      DISP TO UCB CDS TYPE      X03008 24660002
D20      EQU   20                      DISP TO TCBOLTEP BIT      X03008 24750002
HEX0C    EQU   X'0C'                   OPTION TO RE-ENTER XLATE  Y02008 24790002
HEX20    EQU   X'20'                   DASD CLASS                X03008 24840002
REPLY    EQU   X'22'                   SVC NUMBER                X03008 24930002
D24      EQU   24                      DISPLACEMENT FIELD        X03008 25020002
D28      EQU   28                      VOL=SER DISP IN UCB       X03008 25290002
D31      EQU   31                      DISP TO ZUES EXPOSURE FLD X03008 25380002
D32      EQU   32                      DISP TO DEVTAB HEX ADDR   X03008 25470002
D35      EQU   35                      DISPLACEMENT FIELD        X03008 25560002
D40      EQU   40                      DISPLACEMENT 40           Y02008 25620002
HEX40    EQU   X'40'                   A FINE HEX 40             X03008 25650002
DEBVALID EQU   X'40'                   VALID DEB IDENTIFIER      X03008 25740002
D38      EQU   38                      DISPLACEMENT 38           Y02008 25850002
L48      EQU   48                      LENGTH ATTRIBUTE          X03008 25920002
D56      EQU   56                      DEVTAB ENTRY SIZE         X03008 26010002
D64      EQU   64                      DISPLACEMENT FIELD        X03008 26100002
HEX1C    EQU   X'1C'                   BTAM ATTENTION INDEX      X03008 26150002
HEX7F    EQU   X'7F'                   USED TO ZAP THE UCB ONLINEX03008 26190002
HEX80    EQU   X'80'                   OLTEP EXECUTING FLAG      X03008 26280002
HEX82    EQU   X'82'                   ALLOCATED AND ACTIVE OPER X03008 26370002
HEX88    EQU   X'88'                   MASK FOR ALLOCATED/ONLINE X03008 26420002
*                                      CONSOLE                   X03008 26460002
HEXA0    EQU   X'A0'               MASK FOR TAPE OR DASD       @ZM42051 26500037
HEXBF    EQU   X'BF'                   UCB NRDY BIT              X03008 26550002
HEXFB    EQU   X'FB'                   UCB NACL BIT              X03008 26690002
HEXF0    EQU   X'F0'                   SET IF DEV ONLINE         X03008 26700002
HEXFF    EQU   X'FF'                   MASK USED AT LOOKUP TIME  X03008 26730002
HEX200   EQU   X'200'                  HEX 200                   Y02008 26750002
L133     EQU   133                     LENGTH 133                Y02008 26770002
SMFREC   EQU   6                       PTR TO SMF RECORD         Y02008 26772002
SMCAREG  EQU   12                      SMCA ADDRESSABILITY       Y02008 26774002
TYPE11   EQU   11                      SMF RECORD TYPE 11        Y02008 26776002
SMFRECSZ EQU   24                      TOTAL SIZE OF SMF RECORD  Y02008 26778002
L24      EQU   24                      LENGTH OF 24              Y02008 26780002
K72      EQU   X'48'               SIZE OF SSIDLIST            @Y30LPAW 26781003
CPUIDOFF EQU   X'49'               OFFSET IN OCA TO CPU ID     @ZA15468 26781541
*****************************************************************Y02008 26782002
*                       SMF RECORD EQUATES                       Y02008 26784002
*****************************************************************Y02008 26786002
RECDSCWD EQU   1                       SMF REC DESC WORD         Y02008 26788002
RECTYPE  EQU   5                       SMF RECORD TYPE           Y02008 26790002
VARLNGTH EQU   19                      LENGTH OF REST OF RECORD  Y02008 26792002
UCBCLTYP EQU   20                      UCB CLASS & TYPE INFO     Y02008 26794002
DEVADDR  EQU   22                      DEVICE ADDR IN HEX        Y02008 26796002
         EJECT                                                          26800002
         BALR  BASEREG,ZEROO           SET BASE REGISTER                26960002
         USING *,BASEREG               ID BASE REGISTER          X03008 27000002
         B     IGC00CDE                BRANCH AROUND NAME & DATE Y02008 27020002
         DC    C'IGC0005I&SYSDATE'     MODULE NAME & ASSEM DATE  Y02008 27040002
IGC00CDE EQU   *                       START OF ACTUAL CODE      Y02008 27060002
         SPACE  4                                                       27090002
         USING TCB,TCBREG                                        Y02008 27150002
         USING CVTMAP,CVTREG                                     Y02008 27210002
         TM    TCBFLGS1,TCBFA          IS ABEND IN PROCESS       X03008 27270002
         BNO   AUTHCHCK                BRANCH IF NO,             X03008 27320002
         LA    REG1,HEX14              ELSE SET 14 IN REG 1      X03008 27330002
AUTHCHCK EQU   *                       ISSUE APF MACR0           X03008 27450002
         LR    SAVEREG9,REG0           SAVE PARMLIST ADDR        X03008 27540002
         LR    CALLER,REG1             SAVE CALLCODE             X03008 27630002
         SPACE 2                                                 X03008 27720002
         TESTAUTH  FCTN=D1             CHECK CALLERS AUTHORITY   X03008 27810002
         SPACE 2                                                 X03008 27900002
         LTR   RETCODE,RETCODE         SET RETURNED COND CODE    X03008 28080002
         BNZ   EXIT04                  IF CALL ILLEGAL TAKE BR.  X03008 28170002
*********************************************************************** 28260002
*  THE FOLLOWING BRANCH TABLE WILL DIRECT CONTROL TO THE              * 28350002
*  REQUESTED FUNCTION.                                                * 28440002
*                                                                     * 28530002
*********************************************************************** 28620002
         LR    REG1,CALLER             RESTORE CALL CODE         X03008 28670002
         ICM   REG1,B'0010',ZERO       ZAP OUT POSSIBLE 80 BYTE  X03008 28710002
         B     BRTAB(REG1)             LOCATE REQUESTED FUNCTION X03008 28800002
BRTAB    B     FUNC33                  REMOVE WTOR          X'00'X03008 28890002
         B     XCTLMOD9                $CUTEST              X'04'X03008 28980002
         B     FUNC2                   IS THIS MP SYSTEM    X'08'Y02008 29070002
         B     XCTLMOD9            $CUTEST SSIDCHK       X'0C' @Y30LPAW 29160003
         B     XCTLMOD9            SSIDLIST STORE        X'10' @Y30LPAW 29250003
         B     XCTLMOD5                OLTEPS CLEANUP       X'14'X03008 29340002
         B     EXIT04                  RESERVED             X'18'X03008 29430002
         B     EXIT04                  RESERVED             X'1C'Y02008 29520002
         B     EXIT04                  RESERVED             X'20'X03008 29610002
         B     EXIT04                  RESERVED             X'24'Y02008 29700002
         B     EXIT04                  RESERVED             X'28'Y02008 29790002
         B     EXIT04                  RESERVED             X'2C'Y02008 29880002
         B     EXIT04                  RESERVED             X'30'X03008 29970002
         B     EXIT04                  RESERVED             X'34'Y02008 30060002
         B     EXIT04                  RESERVED             X'38'X03008 30150002
         B     FUNC15                  VOL=SER AND UCB CHK  X'3C'X03008 30240002
         B     FUNC16                  UCBLOOKUP            X'40'X03008 30330002
         B     EXIT04                  RESERVED             X'44'Y02008 30420002
         B     FUNC18                  MOVE DEB             X'48'X03008 30510002
         B     REXLATE                  TRANSLATE ADDR      X'4C'Y02008 30600002
         B     PURGERTN                PURGE ROUTINE        X'50'Y02008 30690002
         B     FUNC21                  UCB NOT RDY CHK-SET  X'54'X03008 30780002
         B     INITALIZ                GO SET UP OLTEP JOB  X'58'Y02008 30790002
         B     STARTIO                 GO ISSUE IO OPERATN  X'5C'Y02008 30800002
         B     CPUVRFY                 VERIFY CHOSEN AFFN   X'60'Y02008 30810002
         SPACE  5                                                       30820002
EXIT04   LA    RETCODE,HEX04           SET ABNORMAL COMPLETION   X03008 30870002
         BR    EXIT                    CODE AND EXIT MODULE      X03008 30960002
         SPACE 4                                                 X03008 31050002
XCTLMOD5 L     MAIN15,IGC05            GET IGC0505I ADDRESS      Y02008 31590002
         B     GETMAIN                 GO GET XCTL STG           X03008 31680002
XCTLMOD9 L     MAIN15,IGC09            GET IGC0905I ADDRESS      Y02008 31950002
         SPACE 4                                                        32040002
GETMAIN  EQU   *                       GET STG FOR REMOTE LIST   X03008 32130002
         BR    MAIN15                  GO TO IGC0505I            Y02008 32220002
*                                      OR IGC0905I               Y02008 32820002
         EJECT                                                          33570002
FUNC15   EQU   *                                                 X03008 33660002
         LR    REG1,SAVEREG9           RESTORE ROPT ADDR         X03008 33750002
         LM    UCBADDR,VOLSERAD,D0(PARMREG) OBTAIN UCB ADDRESS   X03008 33840002
*                                      AND VOLUME  SER RETURN    X03008 33930002
*                                      ADDRESS.                  X03008 34020002
         XR    RETCODE,RETCODE         ZERO RETURN CODE REGISTER X03008 34110002
         SPACE 3                                                        34200002
         L     CVTOLT,CVTEXT2          GET PTR TO CVT EXTENSION  Y02008 34290002
         L     WKREG6,D28(CVTOLT)      GET PTR TO DIE            Y02008 34300002
         STM   ZEROO,R15,D40(WKREG6)   SAVE ALL REGS             Y02008 34310002
C   SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,RELATED=(LOCAL,IGC0005I(D)), X34320002
               REGS=USE                                          Y02008 34330002
         LM    ZEROO,R15,D40(WKREG6)   RSTR ALL REGS             Y02008 34340002
         SPACE 3                                                        34380002
         TM    D3(UCBADDR),HEX80       IS THIS FINE UCB ONLINE   X03008 34470002
         BNO   VOLSERCK                NO, GO CK VOL=SER REQUEST X03008 34560002
         SPACE 3                                                        34610002
         SPACE 3                                                        34710002
         LA    RETCODE,HEXF0           SET ONLINE INDICATOR      X03008 34920002
VOLSERCK EQU   *                       CHECK FOR VOL=SER REQUEST X03008 35100002
         SPACE 3                                                        35110002
         STM   ZEROO,R15,D40(WKREG6)   SAVE ALL REGS             Y02008 35150002
D        SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCAL,IGC0005I(C)),       X35152002
               REGS=USE                                          Y02008 35154002
         LM    ZEROO,R15,D40(WKREG6)   RSTR ALL REGS             Y02008 35156002
         SPACE 3                                                        35160002
         CLM   CALLER,B'0010',MASKTBL    IS SECOND BYTE OF CALL  X03008 35190002
*                                      CODE A X'80'              X03008 35280002
         BNE   FINIS                   NO, DO NOT RETURN VOLSER  X03008 35370002
         ICM   WKREG6,B'0001',TCBPKF   GET OLTEP PROTECT KEY     Y02008 35400002
         SPKA  0(WKREG6)               GET INTO OLTEP PROTECT KEYY02008 35430002
         MVC   D0(L6,VOLSERAD),D28(UCBADDR)  MOVE VOL=SER        X03008 35460002
         SR    WKREG6,WKREG6           KEY ZERO                  Y02008 35500002
         SPKA  0(WKREG6)               GET BACK IN SUP STATE     Y02008 35520002
FINIS    BR    EXIT                    RETURN TO CALLER                 35550002
         EJECT                                                          35640002
FUNC16   EQU   *             CALL CODE = R1 = HEX '40'                  35730002
         SPACE 1                                                        35820002
         LR    REG1,SAVEREG9           RESTORE ROPT ADDR         X03008 35910002
         LM    DEVTAB,SAVEPTR,D0(PARMREG) OBTAIN PARAMETER LIST  X03008 36000002
*                                      FROM IFDOLT61. AT THIS    X03008 36090002
*                                      POINT DEVTAB = ADDR DEVTABX03008 36180002
*                                            DEVCNT = NUMBER OF  X03008 36270002
*                                                     DEVICES    X03008 36360002
*                                            SAVEPTR = ADDR OF   X03008 36450002
*                                                      A 16 WORD X03008 36540002
*                                                      SAVEAREA  X03008 36630002
         LR    REG13,SAVEPTR       MOVE SAVE AREA ADDRESS      @ZA12058 36640041
         L     R0,ENQDQGM          GET SPACE FOR ENQ           @ZA12058 36650041
         GETMAIN R,LV=(R0)         AND DEQ ON UCB              @ZA12058 36660041
         LR    SAVEPTR,R1          SAVE THE ADDRESS            @ZA12058 36670041
         SPACE 3                                                 X03008 36720002
LOOKUP   L     HEXADDR,D32(DEVTAB)       GET THE TWO BYTE DEVICE X03008 36990002
*                                      ADDRESS FROM DEVTAB ENTRY X03008 37080002
         SPACE 3                                                 X03008 37260002
IOSGEN   IOSGEN  UCBLOOK,REG13         GET A FINE UCB ADDR       Y02008 37350002
         SPACE 3                                                 X03008 37440002
*                                      ON RETURN FROM IOSGEN THE X03008 37530002
*                                      FOLLOWING REGS ARE VALID  X03008 37620002
*                                       UCBADDR = ADDRESS OF UCB X03008 37710002
*                                       REG 15  = RTN CODE       X03008 37800002
*                                                 0= SUCCESS     X03008 37890002
*                                                 4 = NO UCB     X03008 37980002
         SPACE 3                                                 X03008 38070002
         LTR   RTNCODE,RTNCODE         TEST FOR ZERO RETURN      X03008 38160002
         BNZ   NODEQ               GO GET NEXT DEVTAB ENTRY    @ZA12058 38250041
*                                      AT THIS POINT A VALID UCB X03008 38340002
*                                      ADDRESS IS IN UCBADDR REG X03008 38430002
         ICM   R6,B'0001',TCBPKF       GET OLTEP PROTECT KEY     Y02008 38460002
         SPKA  0(R6)                   GET IN OLTEP PROTECT KEY  Y02008 38490002
         ST    UCBADDR,D8(DEVREG)      SAVE UCB POINTER IN DEVTABX03008 38520002
         SPKA  0(0)                GET SUPERVISOR STATE AGAIN  @ZA06006 38525037
         CLC   D35(L1,DEVREG),D5(UCBADDR) DOES UCB MATCH DEVTAB  X03008 38530002
         BE    SETMODE                 YES, CONTINUE             X03008 38540002
         SPKA  0(R6)                   GET IN OLTEP PROTECT KEY  Y02008 38545002
         XC    D8(L4,DEVREG),D8(DEVREG) CLEAR UCB PTR IN DEVTAB  X03008 38550002
         SPKA  0(0)                    GET SUPERVISOR STATE AGAINY02008 38555002
         B     NODEQ               GO GET NEXT DEVTAB ENTRY    @ZA12058 38560041
SETMODE  EQU   *                                                 X03008 38570002
         SPACE  2                                                       38610002
*********************************************************************** 38700002
*                      ENQ ON Q4 FOR UCB-LOOK-UP                      * 38701002
*********************************************************************** 38702002
         LA    WORKRG,10               INITIALIZE COUNT REG      Y02008 38703002
         USING UCBOB,UCBADDR       UCB ADDRESSIBILITY          @ZA02796 38703137
         CLI   UCBDVCLS,X'08'      UNIT RECORD DEVICE?         @ZA02796 38703237
         BNE   ENQIT               NO, ENQ ON UCB              @ZA12058 38703341
         CLI   UCBUNTYP,X'42'      IS IT AN MSC?               @ZA04291 38703437
         BE    ZEUS                IF YES, BYPASS VARYOFF      @ZA02796 38703537
ENQIT    EQU   *                                               @ZA12058 38704041
         MVC   D0(L12,SAVEPTR),ENQUCB MOVE THE ENQ             @ZA12058 38704541
ENQAGAIN EQU   *                                               @ZA12058 38705041
         ENQ   ,MF=(E,(SAVEPTR))   AND EXECUTE IT              @ZA12058 38705541
         LTR   R15,R15                 WAS ENQ SUCCESSFUL        Y02008 38706002
         BZ    ALOCDCRR                ENQ SUCCESSFUL-CONTINUE   Y02008 38707002
         CLI   THREE(RETCODE),HEX08 IS RET CODE AN 8           @ZA06017 38708037
         BE    ALOCDCRR                YES, ENQ OK - CONTINUE    Y02008 38710002
         STIMER WAIT,DINTVL=FIVE       DELAY FOR 5 SECONDS       Y02008 38711002
         BCT   WORKRG,ENQAGAIN         TRY ENQ ON Q4 AGAIN - MAX Y02008 38712002
*                                      OF 10 TIMES               Y02008 38713002
         OI    D15(DEVTAB),HEX04       INDICATE TO IFDOLT31 THAT Y02008X38715002
                                       ENQ FOR THAT DEVICE WAS   Y02008X38715602
                                       UNSUCCESSFUL              Y02008 38716202
         OI    D14(DEVTAB),HEX08   SET NO GO SWITCH            @ZA12058 38717041
         B     NODEQ               GO GET NEXT DEVTAB ENTRY    @ZA12058 38717541
ALOCDCRR EQU   *                       ENQ ON Q4 OK-CONTINUE     Y02008X38718002
                                       DCRR CODE FOR ALLOCATION  Y02008 38719002
         TM    UCBDVCLS,UCB3COMM+UCB3DISP+UCB3UREC  IS THIS      Y02008C38721002
                                       DEVICE TP, GRAPHICS OR    Y02008C38722002
                                       UNIT RECORD               Y02008 38723002
         BZ    ZEUS                    NO - GO MAKE ZEUS CHECK   Y02008 38724002
         L     R6,UCBEXTPT         GET UCB COMMON              @Z40MIJR 38724100
         USING UCBCMEXT,R6         EXTENSION                   @Z40MIJR 38724200
         TM    UCBFLP1,UCBERLOG    DOES THIS DEV HAVE A        @Z40MIJR 38724300
*                                  BUFFERED ERROR LOG          @Z40MIJR 38724400
         BO    ZEUS                YES, DONT VARY OFFLINE      @Z40MIJR 38724500
         DROP  R6                                              @Z40MIJR 38724600
ALOCDCR1 DS    0H                                              @ZA06006 38724700
         TM    UCBSTAT,UCBALOC         IS DEVICE ALLOCATED       Y02008 38725002
         BO    ZEUS                    YES, BYPASS ALOC DCRR-DEV Y02008X38726002
                                       DOES NOT MEET REQUIREMENTSY02008 38727002
         TM    UCBSTAT,UCBONLI         IS DEVICE ONLINE          Y02008 38728002
         BNO   ZEUS                    NO , BYPASS ALOC DCRR-DEV Y02008X38729002
                                       DOES NOT MEET REQUIREMENTSY02008 38730002
         TM    UCBSTAT,UCBSYSR         IS THIS ACTIVE CONSOLE    Y02008 38730202
         BO    ZEUS                    YES, DONT TAKE DEVICE     Y02008X38730402
                                       OFFLINE                   Y02008 38730602
         TM    UCBSTAT,UCBDADI         IS STATUS CHANGING        Y02008 38731002
         BO    ZEUS                    YES, BYPASS ALOC DCRR-DEV Y02008X38732002
                                       DOES NOT MEET REQUIREMENTSY02008 38733002
         NI    UCBSTAT,HEXFF-UCBONLI-UCBCHGS DEVICE IS OFFLINE & Y02008X38734002
                                       PENDING OFFLINE BIT IS 0  Y02008 38735002
         OI    UCBWGT,UCBVORSN         INDICATE TO RE-CONFIG     Y02008C38736002
                                       COMMANDS THAT OPERATOR HASY02008C38737002
                                       TAKEN DEVICE OFFLINE      Y02008 38738002
         OI    D15(DEVTAB),HEX08       INDICATE TO IFDOLT31 THAT Y02008X38739002
                                       DEVICE WAS VARIED OFFLINE Y02008X38739602
                                       MSG MUST BE OUTPUTTED     Y02008 38740402
**           WRITE SMF RECORD IF IT CAN BE DONE                  Y02008 38741202
         USING SMCABASE,SMCAREG        SMCA ADDRESSABILITY       Y02008 38742002
         L     SMCAREG,CVTSMCA         GET PTR TO SMF CONTROL BLKY02008 38742802
         LTR   SMCAREG,SMCAREG         IS PTR ZERO               Y02008 38743002
         BZ    ZEUS                    YES, DONT WRITE RECORD    Y02008 38743202
         TM    SMCAOPT,SMCAOPT1        IS JOB ACCOUNTING ACTIVE  Y02008 38743602
         BNO   ZEUS                    NO, CANNOT WRITE SMF REC  Y02008 38744402
         TM    SMCAMISC,SMCAUSER+SMCAMAN IS SMF RECORDING REQ OR Y02008X38745202
                                         IS THERE A SYS1.MAN DS  Y02008 38746002
         BNO   ZEUS                    NO, CANNOT WRITE SMF REC  Y02008 38746802
         L     SMFREC,CVTEXT2          USE SAVE AREA IN IFDOLT57 Y02008 38747602
         L     SMFREC,D28(SMFREC)      AS WORK AREA TO CONSTRUCT Y02008 38748402
         LA    SMFREC,D40(SMFREC)      SMF RECORD.NOTE PTR TO    Y02008X38749202
                                       IFDOLT57 IS IN CVTEXT     Y02008 38750002
         XC    D0(L24,SMFREC),D0(SMFREC) CLEAR SMF RECORD AREA   Y02008 38750802
         MVI   RECDSCWD(SMFREC),SMFRECSZ PUT TOTAL SIZE OF REC   Y02008X38751602
                                         IN REC DESC WORD        Y02008 38752402
         MVI   RECTYPE(SMFREC),TYPE11  PUT RECORD TYPE IN RECORD Y02008 38753202
         MVI   VARLNGTH(SMFREC),L6     PUT LENGTH OF REST OF REC Y02008X38754002
                                       IN THE RECORD             Y02008 38754802
         MVC   UCBCLTYP(L2,SMFREC),UCBTBYT3 PUT CLASS AND TYPE INY02008X38755602
                                             RECORD              Y02008 38756402
         MVC   DEVADDR(L2,SMFREC),UCBCHAN PLACE HEX DEVICE ADDR  Y02008X38757202
                                          IN RECORD              Y02008 38758002
         LR    R1,SMFREC               PUT PTR TO SMF REC IN R1  Y02008 38758802
         SVC   83                      ISSUE SMF SVC TO WRITE RECY02008 38759602
         DROP  SMCAREG                                                  38760402
ZEUS     EQU   *                       MAKE SPECIAL ZEUS 2305 CK X03008 38761202
         CLI   D18(UCBADDR),HEX20      IS THIS A DASD            X03008 38762002
         BNE   SETFALSE                NO, SET FAKE EXPOSURE     X03008 38763002
         CLI   D19(UCBADDR),HEX06      YES, IS THIS A ZEUS I     X03008 38764002
         BE    EXPOSURE                YES, GO CALCULATE BASE    X03008 38765002
*                                      UCB ADDR                  X03008 38766002
         CLI   D19(UCBADDR),HEX07      IS THIS A ZEUS II 2305    X03008 38767002
         BE    EXPOSURE                                          X03008 38768002
SETFALSE EQU   *                       AT THIS POINT A FALSE     X03008 38769002
*                                      EXPOSURE WILL BE PLACED   X03008 38770002
*                                      IN THE DEVTAB FOR IFDOLT35X03008 38771002
         ICM   R6,B'0001',TCBPKF       GET OLTEP PROTCT KEY      Y02008 38771302
         SPKA  D0(R6)                  GET INTO OLTEP PROTECT KEYY02008 38771602
         MVI   D31(DEVREG),HEXFF       SET FF IN DEVTAB          X03008 38772002
         B     ALOCHK                  GO CHECK ALLOCATION       X03008 38773002
EXPOSURE EQU   *                       CALCULATE ZEUS BASE UCB   X03008 38774002
*                                      ADDRESS AND EXPOSURE      X03008 38775002
         ICM   R6,B'0001',TCBPKF       GET OLTEP PROTCT KEY      Y02008 38775302
         SPKA  D0(R6)                  GET INTO OLTEP PROTECT KEYY02008 38775602
         MVC   D31(L1,DEVREG),D7(DEVREG) MOVE IN EBCDIC CHAR     X03008 38776002
         NI    D31(DEVREG),HEX07       CHANGE IT TO AN EXPOSURE  X03008 38777002
*                                      NUMBER FROM 00 TO 07 RANGEX03008 38778002
         LA    WKREG1,HEX200           GET HEX 200 OFFSET        YM4987 38779002
         L     UCBADDR,UCBBASE         GET PTR TO BASE UCB-200   YM4987 38780002
         AR    UCBADDR,WKREG1          POINT TO COMMON BASE UCB  YM4987 38781002
         ST    UCBADDR,D8(DEVTAB)      SAVE ZEUS UCB ADDRESS            38784002
ALOCHK   EQU   *                       UCBNALOC CHECK IS HERE    X03008 38785002
         SR    R6,R6                   KEY ZERO                  Y02008 38786002
         SPKA  D0(R6)                  GET SUPERVISOR STATE AGAINY02008 38787002
         SPACE 3                                                 X03008 38790002
         B     ALOCATED                YES, CONTINUE SCAN        YM7205 38970002
     EJECT                                                              38972002
*                                      THIS SUB ROUTINE WILL     X03008 38974002
*                                      DETERMINE IF OLTEP TURNED X03008 38976002
*                                      ON THE UCBNALOC FOR A     X03008 38978002
*                                      UCB RETURNED FROM IOSGEN  X03008 38980002
UNALCCHK EQU   *                                                 YM7205 38981002
         SPACE 3                                                        38982002
         STM   ZEROO,RCREG,D0(REG13)   SAVE ALL REGS             X03008 38984002
         L     UCBTAB,CVTEXT2          GET CVT EXTENTION         X03008 38986002
         L     UCBTAB,D28(UCBTAB)      GET CVTOLTEP WORD         X03008 38988002
         L     UCBTAB,D28(UCBTAB)      GET MASK TABLE ADDRESS    Y02008 38990002
         L     SCAN,CVTILK2            GET IOS UCB LOOK ADDR     X03008 38992002
         SPACE  3                                                       38994002
SETCOUNT EQU   *                       CHECK EACH UCB            X03008 38996002
         LA    UCBTAB,D4(UCBTAB)       BUMP TO MASK BITS (NEXT)  X03008 38998002
         LA    BCTREG,32               SET COUNT TO 32 SHIFTS    X03008 39000002
         L     ODDREG,D0(UCBTAB)       GET A WORD OF MASK BITS   X03008 39002002
         SPACE 2                                                        39004002
SHIFTIT  EQU   *                       GET A FINE BIT            X03008 39006002
         XR    SHIFTER,SHIFTER         ZERO REG FOR SHIFT        X03008 39008002
         SLDL  SHIFTER,ONE             GET THE NEXT BIT          X03008 39010002
         LTR   SHIFTER,SHIFTER         WAS THE BIT ON..          X03008 39012002
         BZ    BUMPUP                  NO, GO GET NEXT UCB ADDR  X03008 39014002
         SPACE 1                                                        39016002
         ICM   SHIFTER,B'0011',D0(SCAN) GET UCB ADDR FROM TBL    X03008 39018002
         CR    SHIFTER,UCBADDR         IS THE DEVICE OLTEPS..... X03008 39020002
         BNE   BUMPUP                  TRY NEXT UCB              YM7205 39022002
SHIFTIT1 EQU   *                                               @Y30LPAW 39022303
         LM    ZEROO,RCREG,D0(REG13)   RESTORE REGS              YM7205 39022602
         B     NEXTUCB                 GO TO NEXT DEVTAB ENTRY   YM7205 39023202
         SPACE 4                                                        39024002
BUMPUP   EQU   *                       GET THE NEXT UCB ADDR FROMX03008 39026002
         LA    SCAN,D2(SCAN)           IOS  LOOK UP TABLE        X03008 39028002
         CLI   D1(SCAN),HEXFF          IS THIS THE TABLES END..  X03008 39030002
         BE    ERRORDEV                IF YES, NO GO DEVICE      X03008 39032002
         SPACE 2                                                        39034002
         BCT   BCTREG,SHIFTIT          GO GET NEXT MASK BIT     X03008  39036002
         B     SETCOUNT                GO GET NEXT WORD OF MASKS X03008 39038002
         SPACE 2                                                        39040002
ERRORDEV EQU   *                       AT THIS POINT DEV IS NOT  X03008 39042002
*                                      OLTEPS TO TEST..          X03008 39044002
         TM    UCBDVCLS,X'08'      UNIT RECORD DEV?            @Y30LPAW 39044303
         BZ    ERRORDV1            IF NOT-GO AROUND            @Y30LPAW 39044603
         CLI   UCBUNTYP,X'42'      IS IT AN MSC?               @ZA04291 39044937
         BE    SHIFTIT1            IF YES-ITS OK               @Y30LPAW 39045203
ERRORDV1 EQU   *                                               @Y30LPAW 39045503
         LM    ZEROO,RCREG,D0(REG13)   RESTORE ALL REGS          X03008 39046002
NOGODEV  EQU   *                                                 Y02008 39053002
         OI    D14(DEVTAB),HEX08       YES, SET NO GO SWITCN     X03008 39060002
         B     NEXTUCB                 GO TO NEXT DEVTAB ENTRY   X03008 39150002
         SPACE  2                                                       39240002
ALOCATED TM    D3(UCBADDR),HEX08       IS DEVICE ALLOCATED       X03008 39370002
         BNO   ONLINECK                NO, GO CHECK ONLINE STATUSX03008 39420002
         OI    D14(DEVTAB),HEX04       SET ALLOCATED BIT IN TAB  X03008 39600002
         SPACE  2                                                       39780002
ONLINECK TM    D3(UCBADDR),HEX80       IS DEVICE ONLINE          X03008 39870002
         BNO   PSEUDO                  NO, GO CHK REI DEVTAB     X03008 39960002
         OI    D12(DEVTAB),HEX80       SET ONLINE BIT IN DEVTAB  X03008 40100002
         SPACE  2                                                       40150002
PSEUDO   TM    D14(DEVREG),HEX01       IS THIS A PSEUDO DEVTAB   X03008 40160002
         BO    REICHECK                YES, GET OUT OF MAIN LINE X03008 40170002
         SPACE 2                                                        40180002
MIXEDCK  TM   D3(UCBADDR),HEX88        IS DEV ALLOC OR ONLINE    X03008 40200002
         BNZ  ANRCHECK                 EITHER ON CHECK ANR GUYS  X03008 40250002
         SPACE 2                                                        40320002
UCBUNALC EQU   *                       SET UCBNALOC ON           Y02008 40410002
         TM    UCBFL5,UCBNALOC     IS UCBNALOC ON              @ZA12058 40414041
         BO    UNALCCHK            BR IF YES                   @ZA12058 40424041
         OI    UCBFL5,UCBNALOC     SET IT ON IF NO             @ZA12058 40434041
         L     UCBTAB,CVTEXT2          GET CVT EXTENTION ADDR    X03008 40460002
         L     UCBTAB,D28(UCBTAB)      GET CVT OLTEP POINTER     X03008 40470002
         L     UCBTAB,D28(UCBTAB)      GET MASK TABLE ADDRESS    Y02008 40480002
         L     SCAN,CVTILK2            GET IOS UCBLOOK TAB       X03008 40482002
         XR    COUNT,COUNT             ZERO THE REG              X03008 40490002
         SPACE 3                                                        40494002
MATCHUP  EQU   *                                                 X03008 40496002
         CLM   UCBADDR,B'0011',D0(SCAN) IS THIS THE UCB        @ZA12058 40498041
         BE    MASKUP                  IF YES GO SET BIT         X03008 40498402
         LA    SCAN,D2(SCAN)       IF NO, GET NEXT UCB DISP    @ZA12058 40498841
         LA    COUNT,D1(COUNT)         AND BUMP COUNTER          X03008 40499202
         B     MATCHUP                 GO CHECK NEW UCB ADDR     X03008 40499602
         SPACE 2                                                        40499702
MASKUP   EQU   *                                                 X03008 40499802
         LR    SCAN,COUNT          SAVE THE OFFSET             @ZA12058 40499941
         SRL   COUNT,D3            SHIFT OFF BIT OFFSET        @ZA12058 40519941
         N     SCAN,COUNTMSK       MASK OFF BYTE OFFSET        @ZA12058 40539941
         LA    SCAN,MASKTBL(SCAN)  LOCATE MASK TO BE USED      @ZA12058 40559941
         LA    COUNT,D4(UCBTAB,COUNT) LOCATE BYTE TO BE SET    @ZA12058 40579941
         OC    D0(D0,COUNT),D0(SCAN) OR ON THE BIT             @ZA12058 40599941
         B     NEXTUCB                                         @ZA12058 40619941
         SPACE  2                                                       40656702
ANRCHECK EQU   * AT THIS POINT DEV IS ONLINE, ALLOC ,OR BOTH     X03008 40680002
         SPACE   3                                                      40730002
         CLI   D18(UCBADDR),HEX10      IS THIS COMMO EQUIPMENT   X03008 40770002
         BNE   NEXTUCB                 GO GET NEXT DEVTAB ENTRY  X03008 40860002
         CLI   D19(UCBADDR),HEX09      IS THIS A 3277 DISPLAY    X03008 40950002
         BL    NEXTUCB                 GO GET NEXT DEVTAB ENTRY  X03008 41040002
         CLI   D19(UCBADDR),HEX0B      IS THIS A 3284 OR 3286    X03008 41130002
         BH    NEXTUCB                 GO GET NEXT DEVTAB ENTRY  X03008 41220002
         TM    D3(UCBADDR),HEX82       IS THIS THE ACTIVE OP     X03008 41310002
*                                      CONSOLE                   X03008 41400002
         BNO   SETOLTEX                NO, GO SET OLTEX FLG = 1  X03008 41490002
SETERRON OI    D14(DEVTAB),HEX80       SET ANR NO TEST SWITCH    X03008 41580002
         B     NEXTUCB                 GO GET NEXT DEVTAB ENTRY  X03008 41670002
         SPACE 2                                                        41760002
SETOLTEX EQU   *                       IS THIS A BTAM DEVICE     X03008 41810002
         L     R6,UCBEXTPT         GET ADD OF UCB EXT          @ZA06016 41820037
         USING UCBCMEXT,R6         EST ADD OF UCB EXT          @ZA06016 41822037
         CLI   UCBATI,HEX1C        IS IT A BTAM DEVICE         @ZA06016 41824037
         DROP  R6                                              @ZA06016 41826037
         BNE   SETERRON                GO SET ANR NO GO SW       X03008 41830002
         OI    UCBGCB,UCBOLTEP     TURN ON UCBOLTEP BIT        @ZA12058 41850041
         B     UCBUNALC                SET UCBNALOC & MSK BITS   Y02008 41940002
         SPACE 3                                                 X03008 42030002
         SPACE 3                                                 X03008 43380002
REICHECK EQU   * MAKE SPECIAL CKS FOR REI BOX (NON-TEST DEVICE)  X03008 43440002
         TM    D3(UCBADDR),HEX08       IS DEVICE ALLOCATED?      X03008 43450002
         BO    NEXTUCB                 IF YES, EXIT AS A NO GO   X03008 43460002
         NI    D3(UCBADDR),HEX7F       ZERO OUT ONLINE BIT       X03008 43462002
         TM    UCBFL5,UCBNALOC     IS THE BIT ON               @ZA12058 43464041
         BO    REICHK2             BR IF YES                   @ZA12058 43464641
         OI    UCBFL5,UCBNALOC     SET THE BIT ON              @ZA12058 43465241
         L     SCAN,CVTEXT2            GET CVT EXTEN ADDR        X03008 43466002
         L     SCAN,D28(SCAN)          GET ADDR OF OLTEPS TABLE  X03008 43468002
         ST    UCBADDR,D32(SCAN)       SAVE REI UCB ADDR                43468402
         B     NEXTUCB                 AND CONTINUE AS IF NON-   X03008 43578802
*                                      PSEUDO DEVTAB ENTRY       X03008 43588802
REICHK2  EQU   *                                                 Y02008 43598802
         L     R6,CVTEXT2              GET CVT EXTENSION PTR     Y02008 43608802
         L     R6,D28(R6)              GET CVT OLTEP PTR         Y02008 43618802
         TM    D4(R6),X'40'            IS REI ACTIVE             Y02008 43669602
         BNO   NOGODEV                 CAN'T USE THIS DEVICE     Y02008 43869602
         SPACE  3                                                       44069602
         SPACE 3                                                 X03008 44460002
NEXTUCB  EQU   *                                               @ZA12058 44550041
         SPACE 3                                                 X03008 44560002
         MVC   D0(L12,SAVEPTR),DEQUCB MOVE THE DEQ             @ZA12058 44600041
         DEQ   ,MF=(E,(SAVEPTR))   AND EXECUTE IT              @ZA12058 44602041
NODEQ    EQU   *                                               @ZA12058 44604041
         LA    DEVREG,D56(DEVREG)  GET NEXT DEVTAB ENTRY       @ZA12058 44606041
         SPACE 3                                                 X03008 44610002
         BCT   CNTREG,LOOKUP           GO PROCESS NEXT DEVICE    X03008 44640002
         L     R0,ENQDQGM          FREE THE SPACE FOR ENQ AND  @ZA12058 44670041
         FREEMAIN R,LV=(R0),A=(SAVEPTR) DEQ                    @ZA12058 44700041
         SPACE 3                                                 X03008 44730002
         XR    RETCODE,RETCODE         SET SUCCESSFUL RTN        X03008 44910002
         BR    EXIT                    LEAVE LOOKUP FUNCTION     X03008 45000002
         EJECT                                                          45090002
*****************************************************************Y02008 45180002
*                                                                Y02008 45180602
*                    IS THIS AN MP ENVIRONMENT                   Y02008 45181202
*                                                                Y02008 45181802
*****************************************************************Y02008 45182402
         SPACE 2                                                        45183002
FUNC2    EQU   *                       IS THIS MP                Y02008 45183602
         USING CSD,CSDREG              ESTABLISH CSD ADDRESSABILITY     45184202
         L     CSDREG,CVTCSD           GET CSD POINTER           Y02008 45184802
         SR    R1,R1                   ZERO RETURN REG           Y02008 45185402
         TM    CSDFLAGS,CSDMP          IS THIS MP                Y02008 45186002
         BNO   D0(RETURN)              NO - RETURN 00 IN R1      Y02008 45186602
         LA    R1,X'80'                YES, RETURN 80 IN R1      Y02008 45187202
         BR    RETURN                  RETURN TO CALLER          Y02008 45187802
         EJECT                                                          45188402
*****************************************************************Y02008 45189002
*                                                                Y02008 45189602
* THIS IS FUNCTION 58-----OLTEP INITIALIZATION                   Y02008 45190202
*                                                                Y02008 45190802
*****************************************************************Y02008 45191402
INITALIZ EQU   *                       INITIALIZATIONNNN                45192002
*****************************************************************Y02008 45192602
*                                                                Y02008 45193202
*              OBTAIN STORAGE FOR DISABLED INTERRUPT EXIT      @ZA15468 45193841
*                                                              @ZA15468 45194041
*              PARM1 POINTS TO ADDRESS OF IFDOLT57             @ZA15468 45194241
*              PARM2 POINTS TO ADDR IN OCA FOR MOVED IFDOLT57  @ZA15468 45194441
*              PARM3 POINTS TO ADDRESS OF SCT                  @ZA15468 45194641
*                                                              @ZA15468 45194841
***************************************************************@ZA15468 45195041
         LM    PARM1,PARM3,D0(PARMRG9) GET PARM LIST                    45195602
         L     R0,D12(PARM1)      GET DIE SIZE                          45196202
         ICM   R0,B'1000',SUB245  GET SUBPOOL NAME '245'                45196802
         GETMAIN R,LV=(0)         ISSUE GETMAIN FOR DIE                 45197402
         STIDP D0(R1)              GET CPU ID                  @ZA15468 45197741
         ICM   R6,B'0001',TCBPKF       GET OLTEP PROTECT KEY     Y02008 45198002
         SPKA  0(R6)                   GET IN OLTEP PROTECT KEY  Y02008 45198602
         ST    R1,D0(PARM2)       SAVE DIE (NEW) ADDR IN OCA            45199202
         MVC   CPUIDOFF(D5,PARM3),D1(R1) MOVE CPUID TO OCA     @ZA15468 45199541
         SR    R6,R6                   KEY ZERO                  Y02008 45199802
         SPKA  0(R6)                   GET SUPERVISOR STATE AGAINY02008 45200102
         LR    WORKRG,R1          SAVE ADDR                             45200402
         SPACE 2                                                        45201002
*****************************************************************Y02008 45201602
*                                                                Y02008 45202202
*                       IS THIS THE 2ND OLTEP                    Y02008 45202802
*                                                                Y02008 45203402
*****************************************************************Y02008 45204002
         L     CVTOLT,CVTEXT2     GET EXTENTION ADDR                    45204602
         SR    WORKREG,WORKREG         ZERO  WORKREG FOR CS      Y02008 45205202
         CS    WORKREG,WORKRG,D28(CVTOLT) IS THIS 2ND OLTEP      Y02008 45205802
         BNE   FREEUP1                 YES, TERMINATE            Y02008 45206402
         LA    CVTOLT,D28(CVTOLT) SET REG TO CVTOLTEP WORD              45207002
         B     MOVEAPDG                MOVE DIE                  Y02008 45207602
         SPACE 2                                                        45208202
*****************************************************************Y02008 45208802
*                                                                Y02008 45209402
*                       FREE STORAGE FOR DIE AREA                Y02008 45210002
*                                                                Y02008 45210602
*****************************************************************Y02008 45211202
FREEUP1  EQU   *                  FREE DIE SPACE                 Y02008 45211802
         L     R1,D0(PARM2)       GET STG ADDR TO BE FREED              45212402
         L     R0,D12(PARM1)      GET DIE SIZE FOR FREEING              45213002
         ICM   R0,B'1000',POOL245 SET SUBPOOL ADDR                      45213602
         FREEMAIN R,LV=(0),A=(1)       RELEASE STORAGE           Y02008 45214202
         LA    R15,8              SET NO GO RETURN CODE                 45214802
         BR    RETURN             AND EXIT MODULE                       45215402
*****************************************************************Y02008 45216002
*                                                                Y02008 45216602
*                            MOVE DIE TO SUBPOOL                 Y02008 45217202
*                                                                Y02008 45217802
*****************************************************************Y02008 45218402
MOVEAPDG EQU   *                  MOVE DIE                              45219002
         L     R0,D0(PARM2)       GET SUBPOOL 245 ADDR   =TO AD         45219602
         L     R1,D12(PARM1)      GET DIE SIZE           =TO SZ         45220202
         LR    R6,PARM1           GET DIE ADDR           =FROM AD       45220802
         LR    R7,R1              GET DIE SIZE           =FROM SZ       45221402
         SPACE 2                                                        45222002
*****************************************************************Y02008 45222602
*                                                                Y02008 45223202
*              MOVE THE DIE                                      Y02008 45223802
*                                                                Y02008 45224402
*****************************************************************Y02008 45225002
         MVCL  R0,R6              MOVE IT TO 245                        45225602
         L     WORKRG,D0(PARM2)   GET SP 245 ADDR                       45226202
         ST    TCBREG,D8(WORKRG)  SAVE TCB IN DIE PREFACE               45226802
         ST    WORKRG,D0(CVTOLT)     PUT 245 ADDR IN CVTOLTEP           45227402
         SPACE 2                                                        45228002
*****************************************************************Y02008 45228602
*                                                                Y02008 45229202
*                     SAVE ASCBASID IN DIE                       Y02008 45229802
*                                                                Y02008 45230402
*****************************************************************Y02008 45231002
         USING ASCB,ASCBREG                                      Y02008 45231602
         L     R6,CVTTCBP              FIND PTR TO CURRENT ASCB  Y02008 45232202
         L     ASCBREG,D12(R6)                                   Y02008 45232802
         MVC   D38(L2,WORKRG),ASCBASID SAVE ASID IN DIE          Y02008 45233402
         DROP  ASCBREG                                                  45234002
         XR    R15,R15                 SET GO RETURN CODE               45234602
         SPACE 2                                                        45235202
*****************************************************************Y02008 45235802
*                                                                Y02008 45236402
*         OBTAIN STORAGE AND BUILD UCB MASK TABLE                Y02008 45237002
*                                                                Y02008 45237602
*****************************************************************Y02008 45238202
         L     SCAN,CVTILK2        GET CVT LOOK UP ADDR          X03008 45238802
         XR    COUNT,COUNT         ZERO COUNT REG                X03008 45239402
         XR    WKREG7,WKREG7           CLEAR OUT WORK REG        Y02008 45240002
FETCHUCB ICM   WKREG7,B'0011',D0(SCAN)  GET UCB ADDR             Y02008 45240602
         CLM   WKREG7,B'0001',TABEND   IS THIS THE LAST          Y02008 45241202
*                                      UCB IN THE SYSTEM         X03008 45241802
         BE    GETSTORG                GO GET STORAGE            Y02008 45242402
         LA    SCAN,D2(SCAN)           NO, GET NEXT UCB ADDR     X03008 45243002
         LA    COUNT,D1(COUNT)         AND BUMP COUNT            X03008 45243602
         B     FETCHUCB                THEN COUNT TO END         X03008 45244202
GETSTORG EQU   *                       GET STORAGE FOR MASK TABLEY02008 45244802
         LR    SAVE,COUNT              SAVE ACTUAL COUNT         X03008 45245402
         L     WORKREG,CVTEXT2         GET CVT EXT ADDR          X03008 45246002
         L     WORKREG,D28(WORKREG)    GET CVT OLTEP ADDR        X03008 45246602
         SRL   COUNT,THREE         DIVIDE BY 8                 @Y30LPAW 45246903
         LA    COUNT,K72(COUNT)    PLUS SIZE FOR SSIDLIST      @Y30LPAW 45247003
         LA    COUNT,D15(COUNT)        BUMP BY 15                X03008 45247202
         SRL   COUNT,THREE         AND ROUND OFF                 X03008 45247802
         SLL   COUNT,THREE         TO A DOUBLE WORD              X03008 45248402
         LR    SAVE1,COUNT         SAVE UPDATED VERSION          X03008 45249002
         ICM   COUNT,B'1100',SP245     GET SUBPOOL NUMBER        Y02008 45249602
         LR    R0,COUNT            SET R0 FOR GETMAIN            X03008 45250202
         GETMAIN R,LV=(0)          OBTAIN STG FOR UCBMSKTBL      X03008 45250802
         ST    R1,D28(WORKREG)         SAVE TABLE ADDR IN DIE    Y02008 45251402
         ST    TCBREG,D8(WORKREG)      SAVE TCB ADDR IN DIE      Y02008 45252002
         LR    WORKREG,R1              ZERO AREA OBTAINED               45252602
         XR    DUMMY1,DUMMY1           ZERO OUT REG                     45253202
         XR    DUMMY2,DUMMY2           ZERO OUT REG                     45253802
         MVCL  WORKREG,DUMMY1          MOVE TO SUBPOOL                  45254402
         ST    SAVE,D0(R1)         SAVE UCB ACTUAL COUNT         X03008 45255002
         SPACE 2                                                        45255602
*****************************************************************Y02008 45256202
*                                                                Y02008 45256802
*                   OBTAIN STORAGE FOR REI DEB                   Y02008 45257402
*                                                                Y02008 45258002
*****************************************************************Y02008 45258602
         L     POOLSIZE,POOLCNST       SET REG ZERO FOR SP+SIZE  X03008 45270002
         GETMAIN R,LV=(0)              OBTAIN STORAGE FOR        X03008 45360002
         LR    WORKRG,R1               SAVE REI DEB  ADDR IN R5 YM08149 45450002
         SPACE 3                                                 X03008 45540002
         OI    D20(TCBREG),HEX02       SET TCBOLTEP BIT TO ONE   X03008 45630002
*                                      FOR ABEND CONDITION       X03008 45720002
         SPACE 2                                                        45730002
*****************************************************************Y02008 45740002
*                                                                Y02008 45750002
*           FIND 2955 UCB, IF ONE EXISTS                         Y02008 45760002
*                                                                Y02008 45770002
*****************************************************************Y02008 45780002
         SPACE 3                                                 X03008 45810002
         L     UCBREG,CVTILK2          GET UCBADDRS TABLE FROM   X03008 46350002
         SR    RETCODE,RETCODE         CVT, SET RI5 TO ZERO      X03008 46440002
         SR    WORKREG2,WORKREG2       REG FOR REIUCB ADR       YM08149 46460002
         SR    UCBADDR,UCBADDR         AND ZERO UCB ADDR REG     X03008 46490002
LOOKUP2  ICM   UCBADDR,B'0011',D0(UCBREG)   GET UCB ADDR         X03008 46530002
         LTR   UCBADDR,UCBADDR         SET CONDITION CODE        X03008 46580002
         BZ    BUMPUCB                 IS THIS A NULL UCB ADDR   X03008 46710002
         TM    D1(UCBREG),HEXFF        IS THIS THE TABLES END    X03008 46800002
         BO    VIRTEST                 GO MAKE V=V TESTS         X03008 46890002
         CLC   D18(L2,UCBADDR),HEX4014 IS THIS A 2955            X03008 46980002
         BNE   BUMPUCB                 NO- GET NEXT UCB ADDR     X03008 47070002
         LR    WORKREG2,UCBADDR        SAVE RETAIN UCB ADDRESS  YM08149 47430002
         B     VIRTEST                 GO SEE IF VIRTUAL         X03008 47480002
         SPACE 3                                                 X03008 47700002
BUMPUCB  LA    UCBREG,D2(UCBREG)       GET PTR TO NEXT UCB       X03008 47790002
         B     LOOKUP2                 CONTINUE SCAN OF UCB'S    X03008 47880002
         SPACE 2                                                        47881002
*****************************************************************Y02008 47882002
*                                                                Y02008 47883002
*                  DETERMINE IF OLTEP IS IN VIRTUAL OR REAL      Y02008 47884002
*                                                                Y02008 47885002
*****************************************************************Y02008 47886002
         SPACE   3                                                      47890002
VIRTEST  SR    VIRTUAL,VIRTUAL         ZERO OUT REG FOR V=V CKS  X03008 47900002
         TM    TCBFLGS6,TCBRV          IS OLTEP OPERATING V=V    X03008 47930002
         BO    NOTVIRT                 NO, DONOT SET VIRT INDICATX03008 47940002
         SR     R7,R7                  CLEAR REG 7 FOR ASID    @YM08149 47941002
         L     SAVEREG,CVTEXT2     LOAD ADD OF CVT EXT         @ZA09691 47941141
         L     SAVEREG,D28(SAVEREG) LOAD ADD OF DIE FROM CVTOL @ZA09691 47941241
         LA    SAVEREG,D40(SAVEREG) LOAD ADD OF SA FROM DIE    @ZA09691 47941341
LOKIT    SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,REGS=SAVE,RELATED=UNLOKT 47941441
         LTR   R15,R15             CHECK RETURN CODE           @ZA09691 47941541
         BZ    LOKT                ZERO AND                    @ZA09691 47941641
         CH    R15,FOUR            FOUR ARE OKAY               @ZA09691 47941741
         BE    LOKT                                            @ZA09691 47941841
         B     RETCODE4            ALL ELSE BAD                @ZA09691 47941941
LOKT     EQU   *                                               @ZA09691 47942041
         USING ASCB,ASCBREG            ASCB ADDRESSABILITY     @YM08149 47943002
         L     R6,CVTTCBP              GET PTR TO 4 WORD LIST  @YM08149 47945002
         L     ASCBREG,D12(R6)         GET ASCB PTR            @YM08149 47945202
         OI    ASCBFLG1,ASCBNSWP       NON SWAPPABLE MEMORY    @YM08149 47945402
UNLOKT   SETLOCK RELEASE,TYPE=LOCAL,REGS=SAVE,RELATED=LOKIT    @ZA09691 47945641
         LTR   R15,R15                                         @ZA09691 47945741
         BZ    UNLOCKED                                        @ZA09691 47945841
         CH    R15,FOUR                                        @ZA09691 47945941
         BE    UNLOCKED                                        @ZA09691 47946041
         B     RETCODE4                                        @ZA09691 47946141
UNLOCKED EQU   *                                               @ZA09691 47946241
         ICM   R7,B'0011',ASCBASID GET ASID IN R7              @ZA09691 47946341
         SR    R1,R1                                           @ZA17683 47946441
         SYSEVENT REQSWAP,ASID=(R7) SWAP ON                    @ZA17683 47946541
         CLM   R1,B'0001',FOUR+1   SWAP OK ?                   @ZA17683 47946641
         BH    RETCODE4            NO ERROR                    @ZA17683 47946741
*  SWAP-OUT HONORED OR ADDR SPACE NON SWAPPABLE                @ZA17683 47946841
         SYSEVENT DONTSWAP,ASID=(R7) MEMORY NOT SWAPPABLE      @ZA17683 47946941
         CLM   R1,B'0001',ZERO     EVERYTHING OK               @ZA17683 47947041
         BNE  RETCODE4                 NO, FNCTN NOT DONE      @YM08149 47947502
         SR    VIRTUAL,VIRTUAL         ZERO OUT REG FOR V=V CKS YM08149 47947702
         L     R6,CVTTCBP              GET PTR TO 4 WORD LIST    Y02008 47954002
         L     ASCBREG,D12(R6)         GET PTR TO ACTIVE ASCB    Y02008 47958002
         L     LDAREG,ASCBLDA          GET PTR TO LDA            Y02008 47964002
         USING LDA,LDAREG              LDA ADDRESSABILITY        Y02008 47970002
         ST    VIRTUAL,VVREGSZ         ZERO REGION SIZE IN LDA   Y02008 47975002
         ST    VIRTUAL,LDALIMIT        ZERO LDA REGION LIMIT     Y02008 47980002
HERE     ICM   VIRTUAL,B'1000',HERE    SET RET INDICATING VIRTUALX03008 47985002
NOTVIRT  EQU   *                                                 X03008 47990002
         LR    R15,WORKREG2            REIUCB ADDR IN R15        Y02008 47991002
         LR    POOLADR,WORKRG          REI DEB ADDR IN REG0      Y02008 47992002
ENDFUN   BR    14                                                X03008 47995002
RETCODE4 LA    R15,4                   SET RC=4 FOR MSG 899I   @YM08149 48000002
         BR    14                                              @YM08149 48030002
         EJECT                                                          48060002
FUNC21   EQU   *                       CALL CODE= 54 UCB CHECKER X03008 48150002
         LR    PARMREG,SAVEREG9    RESTORE PARMS POINTER         X03008 48200002
         L     UCBADDR,D0(PARMREG)     GET UCB ADDRESS           X03008 48240002
         TM    D4(PARMREG),HEX40       SHOULD NRDY BIT BE SET ='1'      48330002
*                                                                X03008 48420002
         BNO   NORESET                 NO, DONT SET BIT          X03008 48510002
         OI    D6(UCBADDR),HEX40       YES, SET BIT ON           X03008 48600002
         BR    RETURN                  EXIT THE FINE MODULE      X03008 48690002
         SPACE  2                                                       48780002
NORESET  EQU   *                       CHECK NRDY BIT            X03008 48870002
         TM    D6(UCBADDR),HEX40       IS NTRDY BIT =1           X03008 48960002
         BNO   D0(RETURN)              NO, EXIT MODULE           X03008 49050002
         TM    D18(UCBADDR),HEXA0  TAPE OR DASD CLASS?         @ZM42051 49140037
         BZ    SETFF               NO, GO SET RTN CODE.        @ZM42051 49230037
         NI    D6(UCBADDR),HEXBF   TURN OFF THE NTRDY BIT      @ZM42051 49320037
         BR    RETURN              EXIT THIS MODULE            @ZM42051 49410037
SETFF    LA    RCREG,HEXFF         RETRN CODE FOR IFDOLT52     @ZM42051 49500037
         BR    RETURN                  EXIT THIS MODULE          Y02008 49590002
         EJECT                                                          49660002
*****************************************************************Y02008 49730002
*                                                                Y02008 49800002
*                            PURGE FUNCTION                      Y02008 49870002
*                                                                Y02008 49940002
*****************************************************************Y02008 50010002
PURGERTN EQU   *                       PURGE ROUTINE             Y02008 50080002
         USING IOSB,IOSBREG            IOSB ADDRESSABILITY       Y02008 50150002
         USING PPL,PPLREG              PURGE PARMLIST            Y02008 50220002
         USING TCCW,TCCWREG            TCCW ADDRESSABILITY       Y02008 50240002
         USING IOCOM,IOCREG            ADDRESSABILITY IOCOM AREA Y02008 50260002
         L     IOSBREG,D0(SAVEREG9)    GET IOSB PTR              Y02008 50290002
         LR    WRKREG12,CALLER         GET CALL CODE IN REG 12   Y02008 50300002
         SLL   WRKREG12,16             SHIFT IT TO LEFT 16 BITS  Y02008 50310002
         LTR   WRKREG12,WRKREG12       IS IT NEGATIVE            Y02008 50320002
         BM    UNFIXRTN                REQUEST WAS CALL CODE 8050Y02008 50330002
         L     R0,SUBPOOL              GET 16 BYTES-SUBPOOL 254  Y02008 50360002
         GETMAIN R,LV=(0)              GET PURGE PARMLIST        Y02008 50430002
         LR    PPLREG,R1               INITIALIZE PPLREG         Y02008 50500002
         XC    D0(16,PPLREG),D0(PPLREG) CLEAR PPL AREA           Y02008 50570002
         MVI   PPLOPT1,PPLDS+PPLHIO+PPLEXR+PPLRB DSID PRGE,NO RBYM03325X50640002
                                       DO HIO, DONT BUILD A PIRL Y02008X50710002
                                       PPLEXR-OPT BYTE 2 IS VALIDY02008 50780002
         MVC   PPLDSIDA(3),IOSDSID+1   PLACE DATA SET IDENTIFIER Y02008X50850002
                                       IN PURGE PARMLIST         Y02008 50920002
         MVI   PPLDVRID,IOSOLTID       PLACE DRIVER ID IN PPL    Y02008 50950002
         CLI   D4(SAVEREG9),HEXFF      IS THIS A TP DEVICE       Y02008 50990002
         BNE   PURGE16                 NO, GO ISSUE SVC 16       Y02008 51060002
         L     R1,IOSUCB               PUT UCB ADDR IN REG 1     Y02008X51080002
                                       FOR SVC 33                Y02008 51100002
         SVC   33                      PURGE SVC-33              Y02008 51130002
         B     UNFIXRTN                GO UNFIX & FREE TCCW BLKS Y02008 51200002
PURGE16  EQU   *                       SVC 16 - PURGE            Y02008 51340002
         SVC   16                      NORMAL PURGE SVC          Y02008 51410002
UNFIXRTN EQU   *                       UNFIX & FREE TCCW BLK RTN Y02008 51480002
         TM    USEFLAGA,VIRTCCW        ARE CCWS VIRTUAL          Y02008 51500002
         BNO   FREEPPL                 NO FREEING OR UNFIXING    Y02008 51520002
*                                      FREE UP IOSB AND EXIT     Y02008 51540002
         L     TCCWREG,TCCWPTR         TCCW ADDRESSABILITY       Y02008 51560002
         LR    R1,TCCWREG              REG 1 MUST POINT TO TCCW  YM5415X51566002
                                       BLOCK TO GO TO CCW XLATOR YM5415 51572002
         MVI   TCCWOPTN,TCCWUNFX       OPTION TO UNFIX AND CHAIN Y02008X51580002
                                       FOR FREEMAIN              Y02008 51600002
         L     SAVEREG,CVTEXT2         GET CVT EXTENSION PTR     Y02008 51620002
         L     SAVEREG,D28(SAVEREG)    GET CVTOLTEP PTR          Y02008 51640002
         LA    SAVEREG,D40(SAVEREG)    GET PTR TO SAVE AREA IN   Y02008X51660002
                                       IFDOLT57 (DIE)            Y02008 51680002
         STM   R0,R15,D0(SAVEREG)      SAVE ALL REGS             Y02008 51700002
PRGELCK0 EQU   *                       OBTAIN LOCK               Y02008 51720002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        X51740002
               RELATED=(LOCAL,IGC0005I(PRGELCK1)),REGS=USE       Y02008 51760002
         LM    R0,R15,D0(SAVEREG)      RESTORE ALL REGS          Y02008 51780002
         L     IOCREG,CVTIXAVL-CVTMAP(CVTREG) IO COM AREA ADDR   Y02008 51800002
         L     R15,IOCTCCW-IOCOM(IOCREG) CCW XLATOR ADDRESS      Y02008 51820002
         BALR  R14,R15                 GO TO CCW XLATOR TO UNFIX Y02008X51840002
                                       DATA AREAS & CHAIN TCCW   Y02008X51860002
                                       BLKS FOR FREEING          Y02008 51880002
PRGELCK1 EQU   *                       RELEASE LOCK              Y02008 51900002
         SETLOCK RELEASE,TYPE=LOCAL,                                   X51920002
               RELATED=(LOCAL,IGC0005I(PRGELCK0)),REGS=USE       Y02008 51940002
         LM    R0,R15,D0(SAVEREG)      RESTORE ALL REGS          Y02008 51960002
         LR    R1,TCCWREG              PUT TCCWPTR IN REG1       Y02008 51980002
TCCWFREE EQU   *                       TCCW FREE ROUTINE         Y02008 52110002
         L     FREERG,D0(R1)           GET PTR TO NEXT 160 BYTE  Y02008X52180002
                                       BLOCK TO BE FREED         Y02008 52250002
         L     R0,SP245                GET SUBPOOL ID & SIZE TO  Y02008X52320002
                                       BE FREED                  Y02008 52390002
         FREEMAIN R,LV=(0),A=(1)       FREE BLOCK                Y02008 52460002
         LTR   FREERG,FREERG           ARE THERE ANY MORE 160    Y02008X52530002
                                       BYTE BLOCKS TO FREE       Y02008 52600002
         BZ    FREEPPL                 GO FREE UP PPL            Y02008 52670002
         LR    R1,FREERG               PLACE ADDR OF BLOCK TO BE Y02008X52740002
                                       FREED IN R1               Y02008 52810002
         B     TCCWFREE                GO FREE IT UP             Y02008 52880002
FREEPPL  EQU   *                       FREE PURGE PARM LIST IF   Y02008X52950002
                                       NEEDED                    Y02008 52980002
         LTR   WRKREG12,WRKREG12       DOES PPL NEED TO BE FREED Y02008 53010002
         BM    PURGEOK                 NO, WE NEVER HAD ONE      Y02008 53040002
         L     R0,SUBPOOL              GET SUBPOOL ID & SIZE     Y02008 53090002
         LR    R1,PPLREG               GET ADDRESS OF PURGE AREA Y02008 53160002
         FREEMAIN R,LV=(0),A=(1)       FREE IT UP                Y02008 53230002
PURGEOK  EQU   *                       THIS IS EXIT RTN          Y02008 53300002
         LTR   WRKREG12,WRKREG12       IS THIS PURGE OR FREE REQ Y02008 53310002
         BM    PURGEOK1                FREE REQ-DONT TURN PURGED Y02008X53320002
                                       FLAG ON IN IOSB                  53330002
         OI    USEFLAGA,PURGED         PURGE DONE                Y02008 53370002
PURGEOK1 EQU   *                       PART OF EXIT RTN          Y02008 53400002
         NI    USEFLAGA,HEXFF-INUSE    IOSB IS FREE TO USE AGAIN Y02008 53440002
         BR    EXIT                    RETURN TO CALLER          Y02008 53510002
         EJECT                                                          53580002
*****************************************************************Y02008 53650002
*                             FUNCTION 18                             * 53900020
*****************************************************************Y02008 54000002
FUNC18   EQU   *                       MOVE DEB  FOR REI ONLY    Y02008 54002002
         LR    PARMREG,SAVEREG9         RESTORE PARM LIST PTR    Y02008 54004002
         LM    TDEBREG,DEB254RG,D0(PARMREG) PUT PTR TO REI DEB INY02008 54006002
*                                       REG 7 & PUT PTR TO SUB-  Y02008 54008002
*                                       POOL IN REG 8.           Y02008 54010002
         IC    PKEYREG,TCBPKF           GET PROTECT KEY FROM TCB Y02008 54012002
         O     PKEYREG,DEVMSK           OR IN DEB ID OF 0000000F Y02008 54014002
         STC   PKEYREG,D24(TDEBREG)     STORE PROTECT KEY IN DEB Y02008 54016002
         ST    TCBREG,D0(TDEBREG)      PUT TCB ADDR IN DEB       YM4984 54017002
         MVC   D20(L1,TDEBREG),TCBDSP   SET DISPATCHING PRIORITY Y02008 54018002
*                                       IN DEB                   Y02008 54020002
         MVC   D0(L48,DEB254RG),D0(TDEBREG) MOVE DEB TO SUB-POOL Y02008 54022002
         L     R9,TCBDEB                PREPARE TO CHAIN DEB TO  Y02008 54024002
*                                       TCB                      Y02008 54026002
CHAINIT  EQU   *                        CHAIN ROUTINE            Y02008 54028002
         ST    R9,D4(DEB254RG)          PLACE NEXT DEB ADDR INTO Y02008 54030002
*                                       REI DEB                  Y02008 54032002
         CS    R9,DEB254RG,TCBDEB       CHAIN DEBS               Y02008 54034002
         BNE   CHAINIT                  CHAIN NOT OK, TRY AGAIN  Y02008 54036002
         L     R9,CVTEXT2               GET CVT EXTENSION ADDR   Y02008 54038002
         L     R9,D28(R9)               GET PTR TO DIE FROM CVT  Y02008 54040002
*                                       OLTEP WORD               Y02008 54042002
         TM    D4(R9),DEBVALID          HAS DEB BEEN VALIDATED   Y02008 54044002
         BO    0(RETURN)                                        ZA16982 54046041
         ST    DEB254RG,D4(R9)          SAVE REI DEB PTR AT DIE+4Y02008 54048002
         OI    D4(R9),HEX80             INDICATE THIS IS REI DEB Y02008 54050002
*                                       POINTER                  Y02008 54052002
         LR    WKREG6,DEB254RG          PREPARE TO SUBTRACT 4    Y02008 54054002
*                                       FROM DEB ADDRESS         Y02008 54056002
         SH    WKREG6,FOUR              PERFORM SUBTRACTION      Y02008 54058002
         XC    D0(L4,WKREG6),D0(WKREG6) ZERO FIRST WORD IN       Y02008 54060002
*                                       SUBPOOL FOR DEBCHK       Y02008 54062002
         L     R5,D24(DEB254RG)         GET DCB ADDRESS          Y02008 54064002
         DEBCHK (R5),TYPE=ADD,AM=EXCP   VALIDATE DEB             Y02008 54066002
         OI    D4(R9),DEBVALID          INDICATE DEB IS OK       Y02008 54068002
         BR    RETURN                  EXIT                      Y02008 54069002
         EJECT                                                          54070002
*****************************************************************Y02008 54170002
*                                                                Y02008 54270002
*              TRANSLATE REAL ADDR TO VIRTUAL ADDRESS            Y02008 54370002
*                                                                Y02008 54470002
*                                                                Y02008 54480002
*              ROPT---------------------------------             Y02008 54490002
*                 | IOSBPTR                        |             Y02008 54500002
*                 ----------------------------------             Y02008 54510002
*               +4| ADDR TO BE TRANSLATED          |             Y02008 54520002
*                 ----------------------------------             Y02008 54530002
*                                                                Y02008 54540002
*****************************************************************Y02008 54570002
         SPACE 2                                                        54670002
REXLATE  EQU   *                       RE-TRANSLATE ROUTINE      Y02008 54770002
         USING TCCW,TCCWREG            TCCW BLK ADDRESSABILITY   Y02008 54870002
         USING IOCOM,IOCREG            IO COM AREA ADDRESSABILITYY02008 54970002
         USING IOSB,IOSBREG            IOSB ADDRESSABILITY       Y02008 54975002
         L     SAVEREG,CVTEXT2         GET CVT EXTENSION PTR     Y02008 54980002
         L     SAVEREG,D28(SAVEREG)    GET DIE ADDRESS           Y02008 54990002
         LA    SAVEREG,D40(SAVEREG)    GET ADDR OF SAVEAREA IN DIE02008 55000002
         STM   ZEROO,R15,D0(SAVEREG)   SAVE REGS TEMPORARILY     Y02008 55010002
TRLOCK0  EQU   *                       GET LOCK FOR TRANSLATION  Y02008 55020002
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        X55030002
               RELATED=(LOCAL,IGC0005I(TRLOCK1)),REGS=USE        Y02008 55040002
         LM    ZEROO,R15,D0(SAVEREG)   RESTORE ALL REGS          Y02008 55070002
         L     IOSBREG,D0(SAVEREG9)    GET IOSB PTR              Y02008 55140002
         L     TCCWREG,TCCWPTR         GET ADDR OF TCCW BLK      Y02008 55210002
         L     R0,D4(SAVEREG9)         GET ADDR TO BE TRANSLATED Y02008 55280002
         MVI   TCCWOPTN,TCCWCSWX       PLACE OPTION BYTE IN TCCW Y02008 55370002
         LR    R1,TCCWREG              REG 1 MUST POINT TO TCCW  YM5415X55400002
                                       BLOCK TO GO TO CCW XLATOR YM5415 55430002
         L     IOCREG,CVTIXAVL         FIND XLATOR ADDRESS       Y02008 55470002
         L     R15,IOCTCCW                                       Y02008 55570002
         BALR  R14,R15                 GO TO XLATOR              Y02008 55670002
         LR    R15,R0                  RETURN XLATED ADDRESS     Y02008 56170002
         STM   ZEROO,R13,D0(SAVEREG)   SAVE  REGS  0-13          YM5413 56370002
         ST    R15,60(SAVEREG)         SAVE REG 15               YM5413 56470002
TRLOCK1  EQU   *                       FREE LOCK USED FOR TRANS  Y02008 56590002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCAL,IGC0005I(TRLOCK0)), X56610002
               REGS=USE                                          Y02008 56630002
         LM    ZEROO,R15,D0(SAVEREG)   RESTORE ALL REGS          Y02008 56650002
         BR    RETURN                  EXIT                             56670002
         EJECT                                                          57270002
*********************************************************************** 57870002
*                             FUNCTION 33                             * 58600020
*********************************************************************** 58700020
 SPACE 2                                                                58800020
FUNC33   EQU   *                                                 X03008 58910002
         LR   R7,CALLER                SAVE CALL CODE          @YM08149 58911002
         L    WKREG6,CVTEXT2           GET CVT EXTENT            X03008 58912002
         TM    D4(WKREG6),X'40'        IS REI ACTIVE             Y02008 58912602
         BNO   LOADUCM                 NO, GO TO NEXT CHECK      Y02008 58913202
         L    WKREG6,D28(WKREG6)       GET CVT OLTEP CONTENTS    X03008 58914002
         L     UCBADDR,D32(WKREG6)     GET REI UCB ADDR                 58916002
         NI   D1(UCBADDR),HEXFB        RESET UCBNALOC TO ZIP     X03008 58918802
         XC   D24(L4,WKREG6),D24(WKREG6) ZERO REI UCB ADDR IN    X03008 58919202
*                                      OLTEP'S TABLE             X03008 58919602
         SPACE  3                                                       58919702
LOADUCM  EQU  *                        ZAP OUT HOT MSG IF HOT    X03008 58980002
         L     UCMREG,CVTCUCB          LOAD UCM ADDRESS          X03008 58986002
         LR    PARMREG,SAVEREG9        SET PARAMETER POINTER     X03008 58992002
         USING UCM,UCMREG          SET UCM DSECT BASE                   59000001
         USING OREF,RQEREG         SET RQE DSECT BASE            Y02008 59100002
         L     RQEREG,UCMRPYQ      LOAD RQE ADDRESS                     59200020
MATCHECB CLC   D1(L3,PARMREG),OREECB+D1 ECB BEING FREED                 59300002
         BE    PROCRPLY            YES - GO PROCESS DUMMY REPLY         59400020
         L     RQEREG,ORELKP       SET NEXT RQE POINTER                 59500002
         LTR   RQEREG,RQEREG       END OF QUEUE                         59600020
         BNE   MATCHECB            NO - GO CHECK NEXT ECB ADDRESS       59700020
         LA    RCREG1,ERRCODE      YES - SET ERROR CODE                 59800020
         BR    RETURN              RETURN TO CALLER                     59900020
PROCRPLY L     REG0,RPLYPOOL       SETUP FOR SUBPOOL 254 GETMAIN        60000020
         GETMAIN  R,LV=(0)         ISSUE SUBPOOL 254 GETMAIN            60100020
         LR    R8,R1               SAVE SUBPOOL 254 ADDRESS             60200020
         MVC   D0(L13,R1),FREEWTOR  SETUP DUMMY REPLY BUFFER            60300020
         LH    R5,OREID            LOAD MESSAGE ID                      60400002
         STH   R5,D6(R1)           STORE ID IN DUMMY REPLY BUFFER       60500020
         XR    REG0,REG0           CLEAR REG FOR REPLY AUTH.            60600020
         SVC   REPLY               FREE MESSAGE                         60700020
         L     REG0,RPLYPOOL       SETUP FOR SUBPOOL 254 FREEMAIN       60800020
         LR    R1,R8               RESTORE FREEMAIN REGISTER            60900020
         FREEMAIN  R,LV=(0),A=(1)  ISSUE SUBPOOL 254 FREEMAIN           61000020
         SR    RCREG1,RCREG1       SET NORMAL RETURN CODE               61100020
         LR    REG0,R5             SET ID IN RETURN REGISTER            61200020
         BR    EXIT                    EXIT TO CALLER            X03008 61208002
         EJECT                                                          61300002
*****************************************************************Y02008 61300702
*                                                                Y02008 61301402
*                      STARTIO FUNCTION                          Y02008 61302102
*                                                                Y02008 61302802
*****************************************************************Y02008 61303502
STARTIO  EQU   *                       MVMS STARTIO FUN          Y02008 61304202
         USING SRB,SRBREG              GENERAL REG 2             Y02008 61304902
         USING IOSB,IOSBREG            GENERAL REG 5             Y02008 61305602
         USING ASCB,ASCBREG            GENERAL REG 6             Y02008 61306302
         USING TCCW,TCCWREG            GENERAL REG 8             Y02008 61307002
         USING IOCOM,IOCREG            GENERAL REG 15            Y02008 61307702
         LR    PARMREG,SAVEREG9        RESTORE PARMLIST PTR      Y02008 61308002
         LM    IOSBREG,DEVTBL,D0(PARMREG)                        Y02008 61308402
         L     IODEVAD,IODEVTAB   GET IO DEVTAB ADDR FROM OCA    Y02008 61309102
         L     SRBREG,CVTEXT2     GET CVT EXTENTION POINTER      Y02008 61309802
         L     SRBREG,D28(SRBREG) GET DIE ADDR                   Y02008 61310502
         LR    DIEPTR,SRBREG      SAVE DIE ADDR                  Y02008 61311202
         LA    SAVEREG,D40(DIEPTR)     GET ADDR OF SAVEAREA IN DIE      61311902
         LR    R15,IOSBREG             SAVE MODEL IOSB REG       Y02008 61312202
         SPACE  4                                                       61312602
*****************************************************************Y02008 61313302
*          DETERMINE WHICH SET OF CONTROL BLOCKS CAN BE USED     Y02008 61314002
*****************************************************************Y02008 61314702
         SPACE  4                                                       61315402
         A     SRBREG,D16(DIEPTR) GET PTR TO THE FIRST SRB IN    Y02008 61316102
*                                      S.P. 245                  Y02008 61316802
         LA    IOSBREG,SRBSIZE(SRBREG)   BUMP TO IOSB HEAD       Y02008 61317502
         USING IOSB,R15                MODEL IOSB ADDRESSABILITY Y02008 61317802
         TM    USEFLAGA,INTRNLCB  IS THIS AN INTERNAL CALL       Y02008 61318202
         DROP  R15                     DROP MODEL IOSB           Y02008 61318402
         USING IOSB,IOSBREG            REAL IOSB ADDRESSABILITY  Y02008 61318602
         BO    INTERNAL           YES, USE FIRST SET OF BLKS     Y02008 61318902
         LA    IODEVAD,D12(IODEVAD) BUMP TO NEXT IODEVTAB SET    Y02008 61319602
         LR    SRBREG,DIEPTR      GET DIE ADDR                   Y02008 61320302
         A     SRBREG,D20(DIEPTR)      GET PTR TO 2ND CTL BLKS   Y02008 61321002
         LA    IOSBREG,SRBSIZE(SRBREG) BUMP TO NEXT IOSB         Y02008 61321702
         TM    USEFLAGA,INUSE          IS THIS SET ACTIVE        Y02008 61322402
         BNO   MOVMODEL                NO, GO MOVE MODEL IOSB    Y02008 61323102
         TM    USEFLAGA,PURGED         HAS IO BEEN PURGED        Y02008 61323802
         BO    MOVMODEL                YES, GO MOVE MODEL        Y02008 61324502
         LA    IODEVAD,D12(IODEVAD)    BUMP TO 3RD SET OF BLKS   Y02008 61325202
         LR    SRBREG,DIEPTR           GET DIE ADDR              Y02008 61325902
         A     SRBREG,D24(DIEPTR)      GET THIRD IO BLK          Y02008 61326602
         LA    IOSBREG,SRBSIZE(SRBREG) BUMP TO NEXT IOSB         Y02008 61327302
INTERNAL TM    USEFLAGA,INUSE          IS SET ACTIVE             Y02008 61328002
         BNO   MOVMODEL                NO, GO MOVE  MODEL        Y02008 61328702
         TM    USEFLAGA,PURGED         HAS IO BEEN PURGED        Y02008 61329402
         BO    MOVMODEL                YES, GO MOVE MODEL        Y02008 61330102
         B     EXIT04                  RET ON BAD SITUATIONS HEREY02008 61330802
         SPACE  4                                                       61331502
*****************************************************************Y02008 61332202
*              MOVE MODEL & SET UP CONTROL BLOCKS                Y02008 61332902
*****************************************************************Y02008 61333602
         SPACE  4                                                       61334302
MOVMODEL L     MODELREG,D0(PARMREG)    GET PTR TO MODEL IOSB     Y02008 61335002
         MVC   D0(L133,IOSBREG),D0(MODELREG) MOVE MODEL          Y02008 61335702
         XC    OECB+1(63),OECB+1       ZERO OECB+1               Y02008 61336402
         XC    SRB(SRBSIZE),SRB   ZERO SRB                       Y02008 61337102
         LA    WKREG7,OECB             PLACE OECB PTR IN USE     Y02008 61337302
         ST    WKREG7,OECBPTR          CONTROL BLOCK             Y02008 61337502
         LA    WKREG7,IOSUSECB         FIND ADD OF OLTEPS IOS USEY02008 61337802
*                                 CONTROL BLOCK                  Y02008 61338502
         ST    WKREG7,IOSUSE           PLACE USE CNTRL BLK ADD INY02008 61339202
*                                 IOSB                           Y02008 61339902
         ST    IODEVAD,IODEVTAB   SET PTR TO IODEVTAB SLOT       Y02008 61340602
         ICM   R15,B'0001',TCBPKF      GET OLTEP PROTCT KEY      Y02008 61341302
         SPKA  0(R15)                  GET INTO OLTEP PROT KEY   Y02008 61342002
         ST    IOSBREG,D4(IODEVAD)  SET PTR TO IOSB IN OCA       Y02008 61342702
         XC    D8(L4,IODEVAD),D8(IODEVAD)  ZERO ECB             Y02008  61343402
         ST    DEVTBL,D0(IODEVAD)  SAVE DEVTAB PTR               Y02008 61344102
         SR    R15,R15                 KEY ZERO                  Y02008 61344802
         SPKA  0(R15)                  GET SUPERVISOR STATE AGAINY02008 61344902
         EJECT                                                          61345002
*********************************************************************** 61345102
         OI    USEFLAGA,INUSE      SET INUSE BIT                 Y02008 61345502
         STM   ZEROO,R15,D0(SAVEM)  SAVE REGS TEMPORARILY        Y02008 61346202
         ST    R14,D64(SAVEM)          SAVE R14 FOR EXIT         Y02008 61346502
SET      SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        X61346902
               RELATED=(LOCAL,IGC0005I(LT)),REGS=USE             Y02008 61347602
         LM    ZEROO,R15,D0(SAVEM)     SAVE REGS TEMPORARILY     Y02008 61348302
         TM    USEFLAGA,VIRTCCW    ARE CCW'S IN V=V              Y02008 61349002
         BNO   COPYREAL           NO, GO SET UP IOSB THINGS      Y02008 61349702
         BAL   LINK,GETCORE            GO GET STG FROM SP239     Y02008 61350402
*                                  TCCW BLK.                     Y02008 61351102
         ST    R1,TCCWPTR          PUT TCCW PTR INTO USE BLK     Y02008 61351802
         LR    TCCWREG,R1              SAVE TCCW ADDR            Y02008 61352502
         BAL   LINK,GETCORE            GO GET STG  FOR BEB       Y02008 61353202
         ST    R1,TCCWBEB              SET BEB ADDR IN TCCW      Y02008 61353902
         ST    TCBREG,TCCWTCB          SAVE TCB ADDR IN TCCW     Y02008 61354602
         BAL   LINK,GETCORE            GO GET STG  FOR FIXLIST   Y02008 61355302
         ST    R1,TCCWFIX              PUT FIXLIST ADDR IN TCCW  Y02008 61356002
         MVC   TCCWUCB(3),IOSUCB+1     MOVE UCB ADDR TO TCCW     Y02008 61356702
         MVC   TCCWFVC(4),IOSVST       MOVE 1ST VIRT CCW ADDRESS Y02008 61357402
*                                      TO TCCW                   Y02008 61358102
         MVI   TCCWOPTN,HEX00          SET OPTION BYTE           Y02008 61358802
         LR    FIXED,R1                GET AREA ADDR WHERE FIX   Y02008 61359502
*                                      WILL TAKE PLACE           Y02008 61360202
XLATEM   EQU   *                                                 Y02008 61360902
         LR    R1,TCCWREG              SET R1 TO CCW XLATE BLOCK Y02008 61361602
         L     IOCREG,CVTIXAVL-CVTMAP(CVTREG) GET IO COM AREA    Y02008 61362302
*                                      ADDRESS                   Y02008 61363002
         L     R15,IOCTCCW-IOCOM(R15)  GET CCW XLATOR ADDR       Y02008 61363702
         BALR  R14,R15                 GO XLATE CCWS             Y02008 61364402
         LTR   R15,R15                 DID XLATE GO              Y02008 61365102
         BZ    SETREAL                 YES, CONTINUE             Y02008 61365802
         CH    R15,FOUR                WAS RETURN CODE 4         Y02008 61366502
         BE    FREERTN                 YES,                      Y02008 61367202
         BAL   LINK,GETCORE            GO GET STG  FOR IOS XLATERY02008 61367902
         LR    R0,R1                   PLACE PTR TO ADDITIONAL   Y02008 61368602
*                                      AREA IN REG 0             Y02008 61369302
         MVI   TCCWOPTN,HEX0C          SET OPTION BYTE FOR       Y02008 61370002
*                                      RE-ENTRY                  Y02008 61370702
         B     XLATEM                                            Y02008 61371402
FREERTN  EQU   *                                                 Y02008 61372102
         SR    WRKREG12,WRKREG12       ZERO WORK REG 12          Y02008 61372802
         IC    WRKREG12,TCCWOPTN       SAVE OPTION BYTE          Y02008 61373502
FREE160  EQU   *                       RTN TO FREE UP 160 BYTES  Y02008 61374202
         L     FREERG,D0(R1)           GET PTR TO 1ST BLOCK OF   Y02008 61374902
*                                      160 BYTES TO BE FREED     Y02008 61375602
         L     R0,SP245                GET SP ID AND SIZE        Y02008 61376302
         L     WKREG7,CVTTCBP          GET PTR TO 4 WORD LIST    Y02008 61376502
         L     WKREG7,D12(WKREG7)      GET PTR TO CURRENT ASCB   Y02008 61376702
         FREEMAIN R,LV=(0),A=(1),BRANCH=YES GO FREE UP CORE      Y02008 61377002
         LTR   FREERG,FREERG           IS THIS THE LAST          Y02008 61377702
         BZ    SETEXIT                 GO EXIT MODULE IF ZERO    Y02008 61378402
         LR    R1,FREERG               GET NEXT ADDR TO BE FREED Y02008 61379102
         B     FREE160                 GO FREE NEXT BLK OF 160 BYTES    61379802
SETEXIT  EQU   *                                                 Y02008 61380502
         LR    R15,WRKREG12            GET OPTION TO BE RETURNED Y02008 61381202
         B     LOCKREL                 EXIT WITH ERROR           Y02008 61381902
COPYREAL EQU   *                                                 Y02008 61382602
         MVC   IOSRST(4),IOSVST        COPY CCW ADDRESS          Y02008 61383302
         B     SETASID                 GO SET ASID               Y02008 61384002
SETREAL  EQU   *                                                 Y02008 61384702
         ST    R0,IOSRST               SET REAL CCW ADDR IN IOSB Y02008 61385402
SETASID  EQU   *                                                 Y02008 61386102
         L     R6,CVTTCBP              GET PTR TO 4 WORD LIST    Y02008 61386802
         L     ASCBREG,D12(R6)         GET PTR TO ACTIVE ASCB    Y02008 61387502
         MVC   IOSASID,ASCBASID        SET IOSB ASID FIELD       Y02008 61388202
         MVC   IOSPKEY,TCBPKF          SET PROTECT KEY           Y02008 61388902
         MVC   IOSCKEY(1),TCBPKF       GET IOS C KEY FROM TCB    Y02008 61389602
         LA    R13,16                  INITIALIZE IOSB AFFN REG  Y02008 61390302
         SR    R1,R1                   ZERO WORK REG FOR AFFN    Y02008 61391002
         ICM   R1,B'0011',ASCBAFFN     GET ASCB AFFN INTO REG    Y02008 61391702
*                                      FOR CONVERSION ROUTINE    Y02008 61392402
         LTR   R1,R1                   IS THERE ANY AFFN         Y02008 61393102
         BNZ   TRYAGAIN                YES, CONTINUE             Y02008 61393802
         LA    WRKREG12,HEX04          PUT ERROR CODE IN REG 12  Y02008 61394102
         TM    USEFLAGA,VIRTCCW        WHERE CCWS VIRTUAL        Y02008 61394402
         BO    FREERTN                 YES, BLOCKS MUST BE FREED Y02008 61394702
         LA    R15,HEX04               ERROR RETURN IN REG 15    Y02008 61395002
         B     LOCKREL                 RELEASE LOCK AND EXIT     Y02008 61395302
TRYAGAIN EQU   *                                                 Y02008 61395902
         BCTR  R13,0                   UPDATE POSSIBLE IOSB AFFN Y02008 61396602
         SRA   R1,1                    FIND AFFN                 Y02008 61397302
         BNZ   TRYAGAIN                AFFN NOT FOUND, TRY AGAIN Y02008 61398002
         STC   R13,IOSAFF              AFFN FOUND, PLACE         Y02008 61398702
*                                      CONVERTED AFFN IN IOSB    Y02008 61399402
         LA    IODEVAD,D1(IODEVAD)     BUMP BY 1 FOR DSID        Y02008 61400102
         ST    IODEVAD,IOSDSID         SET PHONY DSID            |02008 61400802
         MVI   IOSDVRID,IOSOLTID       PUT DRIVER ID IN IOSB     Y02008 61401502
         LA    R1,CVTBRET              GET ADDR OF BR 14 INSTRN  Y02008 61402202
         ST    R1,IOSPGAD              INITIALIZE IOS PGAD       Y02008 61402902
         ST    IOSBREG,SRBPARM         PUT IOSB ADDR IN SRB FOR  Y02008 61403602
*                                      STARTIO                   Y02008 61404302
         L     SAVEPTR,CVTEXT2         GET PTR TO CVT EXTENSION  Y02008 61405002
         L     SAVEPTR,D28(SAVEPTR)    GET PTR TO DIE            Y02008 61405702
         LA    SAVEM,D40(SAVEPTR)      GET PTR TO SAVE AREA      Y02008 61406402
         STM   ZEROO,R15,D0(SAVEM)     SAVE ALL REGS             Y02008 61407102
         STARTIO SRB=(SRBREG),TCB=(TCBREG) DO THE IO  OP         Y02008 61407802
         LM    ZEROO,R15,D0(SAVEM)     RSTR ALL REGS             Y02008 61408502
         XR    R15,R15                 ZERO R15 FOR GOOD RETURN  Y02008 61408702
LOCKREL  EQU   *                                                 Y02008 61408902
         L     SAVEPTR,CVTEXT2       GET PTR TO CVT EXTENSION   ZA16980 61409241
         L     SAVEPTR,D28(SAVEPTR)   GET PTR TO DIE            ZA16980 61409341
         LA    SAVEM,D40(SAVEPTR)    GET PTR TO SAVE AREA       ZA16980 61409441
         STM   ZEROO,R15,D0(SAVEM)    SAVE REGS TEMPORARILY             61409541
LT       SETLOCK RELEASE,TYPE=LOCAL,RELATED=(LOCAL,IGC0005I(SET)),     X61409902
               REGS=USE                                          Y02008 61410602
         LM    ZEROO,R15,D0(SAVEM)     RESTORE ALL REGS          Y02008 61411302
         L     R14,D64(SAVEM)          RESTORE R14 FOR RETURN    Y02008 61412002
         BR    R14                    EXIT MODULE                Y02008 61412702
         EJECT                                                          61413402
*****************************************************************Y02008 61414102
*                                                                Y02008 61414802
*        THIS FINE SUB ROUTINE DOES ALL KINDS OF STUFF           Y02008 61415502
*        AND THINGS. IT WILL BE ENTERED DYNAMICALLY              Y02008 61416202
*        FROM THE IOS CCW TRANSLATOR AS KEY ZERO, NON-           Y02008 61416902
*        PAGEABLE STORAGE BECOMES REQUIRED. IT IS ALSO           Y02008 61417602
*        ENTERED TO OBTAIN STG FOR THE  BEB, THE FIX-            Y02008 61418302
*        LIST AND THE TCCW BLOCK PRIOR TO CCW XLATE.             Y02008 61419002
*        ON ENTRY REG 10 WILL CONTAIN THE RETURN ADDR.           Y02008 61419702
*                                                                Y02008 61420402
*****************************************************************Y02008 61421102
GETCORE  EQU   *                       OBTAIN STORAGE FROM SP239 Y02008 61421802
         L     R0,SP245                SET SUBPOOL ID & SIZE     Y02008 61422502
         L     WKREG7,CVTTCBP          GET PTR TO 4 WORD LIST    Y02008 61422702
         L     WKREG7,D12(WKREG7)      GET PTR TO CURRENT ASCB   Y02008 61422902
         SPACE 1                                                        61423202
         GETMAIN R,LV=(0),BRANCH=YES GET STG FOR CALLER          Y02008 61423902
         SPACE 2                                                        61424602
*                                 AT THIS POINT REG 1            Y02008 61425302
*                                 CONTAIN THE ADDRESS            Y02008 61426002
*                                 OF THE SUBPOOL.                Y02008 61426702
*                                                                       61427402
         BR    LINK                    RETURN TO CALLER ON R10   Y02008 61428102
         EJECT                                                          61428802
*****************************************************************Y02008 61429502
*                                                                Y02008 61430202
*                       VERIFY CPU SELECTION                     Y02008 61430902
*                                                                Y02008 61431602
*****************************************************************Y02008 61432302
         SPACE 2                                                        61433002
CPUVRFY  EQU   *                       VERIFY CPU SELECTION      Y02008 61433702
         USING CSD,CSDREG                                      @ZA09691 61436541
         L     SAVEREG,CVTEXT2     ADD OF CVTEXT               @ZA09691 61437241
         L     SAVEREG,D28(SAVEREG) ADD OF OLTEPS DIE          @ZA09691 61437941
         LA    SAVEREG,D40(SAVEREG) SA OFFSET INTO DIE         @ZA09691 61438641
LOKT2  SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,REGS=SAVE,RELATED=EXITCPU  61439341
         LTR   R15,R15             CHECK RETURN CODE           @ZA09691 61440041
         SPACE 1                                                        61440702
         BZ    ALIVECHK            IF 0, GO AHEAD              @ZA09691 61441441
         CH    R15,FOUR            IF FOUR, GO AHEAD           @ZA09691 61442141
         BE    ALIVECHK                                        @ZA09691 61442841
         LA    R9,8                ELSE, SET A RETURN CODE OF 8@ZA09691 61443141
         SPACE 1                                                        61443502
         B     SETRC                                           @ZA09691 61444941
         SPACE 1                                                        61449802
*****************************************************************Y02008 61450502
*                        IS CHOSEN CPU ALIVE                     Y02008 61451202
*****************************************************************Y02008 61451902
         SPACE 1                                                        61452602
ALIVECHK EQU   *                       CPU ALIVE CHECK           Y02008 61453302
         LR    R1,SAVEREG9             RESTORE PARMLIST REG      Y02008 61453402
         LA    R9,4                    INITIALIZE R9 TO INDICATE Y02008X61453502
                                       FAILURE OF REQUEST        Y02008 61453602
         L     R1,D0(R1)               GET PTR TO CHOSEN AFFN    Y02008 61454002
         L     CSDREG,CVTCSD           GET CSD POINTER           Y02008 61454702
         SR    R7,R7                   CLEAR MASK REG FOR USE IN Y02008 61455402
*                                      EXECUTE INSTRUCTION       Y02008 61456102
         IC    R7,D0(R1)               GET 1ST MASK FOR CPU ALIVEY02008 61456802
*                                      CHECK                     Y02008 61457502
         EX    R7,CPUTEST              IS CHOSEN CPU ALIVE       Y02008 61458202
         BO    CPUOK                   YES, PLACE IT IN ASCB     Y02008 61458902
         LA    CSDREG,D1(CSDREG)       ADD 1 TO CSD REG -- POINT Y02008 61459602
*                                      TO 2ND BYTE OF CSD CPU    Y02008 61460302
*                                      ALIVE FIELD               Y02008 61461002
         IC    R7,D1(R1)               GET 2ND MASK FOR CPU ALIVEY02008 61461702
*                                      CHECK                     Y02008 61462402
         EX    R7,CPUTEST              IS CHOSEN CPU ALIVE       Y02008 61463102
         BNO   EXITCPU                 NO, EXIT TO CALLER WITH   Y02008 61463802
*                                      RETURN CODE 0J            Y02008 61464502
         SPACE 1                                                        61465202
*****************************************************************Y02008 61465902
*                  CPU ALIVE - PLACE AFFN IN ASCB                Y02008 61466602
*****************************************************************Y02008 61467302
         SPACE 1                                                        61468002
CPUOK    EQU   *                                                        61468702
         USING ASCB,ASCBREG            ASCB ADDRESSABILITY       Y02008 61469402
         L     ASCBREG,CVTTCBP         FIND PTR TO CURRENT ASCB  Y02008 61470102
         L     ASCBREG,D12(ASCBREG)    THRU CVT                  Y02008 61470802
         MVC   ASCBAFFN(2),D0(R1)      PLACE SELECTED AFFN IN    Y02008 61471502
*                                      ASCB                      Y02008 61472202
         SR    R9,R9                   RETURN 00 TO CALLER       Y02008 61472902
         SPACE 1                                                        61473602
*****************************************************************Y02008 61474302
*                           EXIT ROUTINE                         Y02008 61475002
*****************************************************************Y02008 61475702
         SPACE 1                                                        61476402
EXITCPU  EQU   *                       EXIT CPU ALIVE ROUTINE    Y02008 61477102
         SETLOCK RELEASE,TYPE=LOCAL,REGS=SAVE,RELATED=LOKT2    @ZA09691 61477841
         LTR   R15,R15             CHECK RETURN CODE           @ZA09691 61477941
         BZ    SETRC               IF 0, SET RECTURN CODE      @ZA09691 61478041
         CH    R15,FOUR            FOUR IS OK                  @ZA09691 61478141
         BE    SETRC                                           @ZA09691 61478241
         LA    R9,8                ELSE, SET RC=8              @ZA09691 61478341
SETRC    EQU   *                                               @ZA09691 61478441
         LR    R15,R9                  DEQ AND PLACE RETURN CODE Y02008 61478502
*                                      IN R15                    Y02008 61479202
         BR    EXIT                    RETURN TO CALLER          Y02008 61479902
         USING CSD,CSDREG              CSD ADDRESSABILITY        YM4763 61480002
CPUTEST  TM    CSDCPUAL,X'00'           VALIDATE AFFINITY        YM4763 61480102
         DROP  CSDREG                   DROP CSD ADDRESSABILITY  YM4763 61480202
         EJECT                                                          61480602
*********************************************************************** 61500020
*                             CONSTANTS                               * 61600020
*********************************************************************** 61700020
 SPACE 2                                                                61800020
         DS    0F                                                       61810002
ENQUCB   ENQ   (MAJORNAM,MINORNAM,E,2,SYSTEM),RET=HAVE,MF=L    @ZA26394 61850010
DEQUCB   DEQ   (MAJORNAM,MINORNAM,2,SYSTEM),RET=HAVE,MF=L      @ZA12058 61852041
COUNTMSK DC    X'00000007'                                     @ZA12058 61854041
ENQDQGM  DC    X'F5000010'         SP245 FOR 16 BYTES FOR GM   @ZA12058 61856041
MASKTBL  DC    X'8040201008040201' MASK TABLR FOR EX INSTR       X03008 61860002
         DS    0F                                                       61900020
IGC05    DC    V(IGC0505I)             IGC0505I ADDR             Y02008 63000002
IGC09    DC    V(IGC0905I)             IGC0905I ADDR             Y02008 63250002
         DS    0D                                                       63260002
SUBPOOL  DC    X'FE000010'             XCTL POOL ID AND SIZE     Y02008 63270002
         DS    0F                                                       63280002
POOLCNST DC    X'FE000040'             SP254 FOR 64 BYTES  S     Y02008 63280602
SP245    DC    X'F50000A0'             SP245 FOR 160 BYTES       Y02008 63281202
         DS    0F                                                Y02008 63281802
TRES     DC    X'F0F0F0F0F0F3F0C0'     3 SECONDS                 Y02008 63283602
FIVE     DC    X'F0F0F0F0F0F5F0C0'     5 SECONDS                 Y02008 63283702
MAJORNAM DC    C'SYSIEFSD'             MAJOR NAME FOR ENQ ALLOC  Y02008C63283802
                                       SYNCRONIZATION            Y02008 63283902
MINORNAM DC    C'Q4'                   MINOR NAME FOR ENQ ALLOC  Y02008C63284002
                                       SYNCRONIZATION            Y02008 63284102
QNAME    DC    C'SYSZVARY'             QNAME FOR ENQ             Y02008 63284202
RNAME    DC    C'CPU'                  RNAME FOR ENQ             Y02008 63284802
TABEND   DC    XL1'FF'                 END OF IOS UCB LOOK TBL   Y02008 63285402
FOUR     DC    X'0004'                 A HALFWORD 4              Y02008 63286002
SUB245   EQU   *                                                 Y02008 63286602
POOL245  DC    XL1'F5'                                           Y02008 63287202
         DS    0F                                                       63289002
DEVMSK   DC    X'0000000F'             SETS VALID DEB ID         X03008 63290002
HEX4014  DC    X'4014'                                           X03008 63292002
ZERO     DC    X'00'                   WORK BYTE                 X03008 63294002
         DS    0F                                                       63300001
RPLYPOOL DC    X'FE0000A8'                                       Y02008 63500002
FREEWTOR DC    X'000D0000D940F0F06B7DE27D40'                            63600020
PATCH00  EQU   *                       PATCH AREA FOR IGC0005I          63650002
         IFDPATCH                                                X03008 63660002
         EJECT                                                          63710002
         DS    0D                                                       64000020
    DS  0D                                                              64100002
         CVT   SYS=AOS2,DSECT=YES                                       64200002
         DS    0D                                                Y02008 64230002
         IEESMCA                                                 Y02008 64260002
         DS    0D                                                       64300020
         IEECUCM FORMAT=NEW                                             64400001
         DS    0D                                                       64600020
RQEMAP   DSECT                                                          64700020
         IHAORE                                                         64800002
         EJECT                                                          64900002
TCB IKJTCB SYS=AOS2,DSECT=YES                                           64980002
         EJECT                                                          65060002
SRB IHASRB                                                              65140002
         EJECT                                                          65220002
IOSB  IECDIOSB                                                          65300002
         EJECT                                                          65380002
IOSUSECB EQU   *                                                        65460002
USERCB   DS    0CL24                   START OF IOSB USER CON BLKY02008 65540002
OECBPTR  DS    F                  POINTER TO OLTEP EVENT CONTROL BLOCK  65620002
TECBPTR  DS    F                  OLT'S TECB POINTER FOR THIS EVENT     65700002
IODEVTAB DS    F                  POINTER TO 3 WORDS IN OLTEP COMMON    65780002
TCCWPTR  DS    F                  POINTER TO THE TCCW SYSTEM CONTROL    65860002
*                                    BLOCK FOR THE CCW TRANSLATOR       65940002
USEFLAGS DS    0F                 A WORD OF FLAGS                       66020002
USEFLAGA DS    1C                 FIRST FLAG BYTE FOR THIS CB SET       66100002
INUSE    EQU   X'80'              THIS IOSB IS IN USE                   66180002
ATTN     EQU   X'40'              ATTENTION=YES REQUEST (OFF IF DONE)   66260002
VIRTCCW  EQU   X'20'              THE CCW'S ARE IN VIRTUAL              66340002
INTRNLCB EQU   X'08'              REQUEST IS INTERNAL (LINE CONNECT,DP) 66420002
PURGED   EQU   X'04'              THIS I/O EVENT IS PURGED              66500002
PCIENTRY EQU   X'02'                   PCI EXIT OPERATING               66510002
USEFLAGB DS    1C                      UNUSED                           66520002
USEFLAGC DS    1C                      UNUSED                           66530002
USEFLAGD DS    1C                      UNUSED                           66540002
USERSVD  DS    F                       RESERVED FOR FUTURE       Y02008 66545002
OECB     DS    0CL64                   OLTEPS OECB                      66550002
         EJECT                                                          66580002
TCCW     IECDTCCW                                                       66660002
         EJECT                                                          66740002
         IECDIOCM                                                       66820002
         EJECT                                                          66900002
         IECDIOCX                                                       66920002
         EJECT                                                          66940002
         IHAPSA                                                         66980002
         EJECT                                                          67060002
         DS    0D                                                       67140002
         IECDLCH                                                        67220002
         EJECT                                                          67300002
         DS    0D                                                       67380002
UCBDSECT DSECT                                                          67420002
         IEFUCBOB                                                       67460002
         EJECT                                                          67540002
         IHACSD                        CSD DSECT                 Y02008 67620002
ASCB     IHAASCB                                                        67700002
PPL      IECDPPL                       PURGE PARAMETER LIST      Y02008 67800002
LDA      IHALDA                        LDA MAP                   Y02008 67850002
         END                                                            67900002
