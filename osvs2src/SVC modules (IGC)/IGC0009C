         TITLE 'IGC0009C - FIRST LOAD OF TGET AND TPUT'                 00100020
*********************************************************************** 00120003
*                                                                       00140003
*                                                                       00160003
*          RELEASE 4 VS/2 CHANGES                               ZA16607 00200003
* A 70750-70920,113000,207414-207462,207485,715050,718800       ZA24648 00200203
* A 153900,217970,218000,219470,219500                          ZA32421 00200403
* C 218040,219540                                               ZA32421 00200603
* D 218140,219640                                               ZA32421 00200803
* A 203200,203300,654700-658200                                 ZA11383 00201003
* C 206928,206948                                               ZA11383 00202003
* D 206960,206970                                               ZA11383 00203003
*                                                               ZA16607 00204003
*C019000,022000,259700,260192,                                  ZA16607 00205003
*C260497,260592,884200                                          ZA16607 00210003
*                                                               ZA16607 00215003
*A019500,022100-022400,072300,072600,074100-074500,             ZA16607 00220003
*A106500,113040,206917,206924,206931,207010-238310              ZA16607 00223003
*A259904-259616,259930,260562                                   ZA16607 00226003
*260712,714860-715040,894700,895200                             ZA16607 00230003
*                                                               ZA16607 00235003
*D022000,206920,206928,206930,206940-206970,260498,             ZA16607 00240003
*D268000-345300                                                 ZA16607 00245003
*                                                               ZA16607 00250003
*                                                               ZA16607 00255003
*          RELEASE 2 VS/2 DELETIONS                                   * 00260002
*          RELEASE 1 VS/2 DELETIONS                                   * 00292002
*          RELEASE 21 DELETIONS                                       * 00300020
*          UY70029 IS THE SAME AS US02278                       YA00677 00302102
*          US02278 FIXES APAR 60002                             SA60002 00304502
*D001760-001800,263000-264000                                   SA60002 00304602
*0834                                                            M1807  00304802
* A498820                                                       ZA12514 00305803
*0834393600,425500,622000                                        M1800  00306902
*0834383300                                                      M1757  00309002
*0834304000                                                      A46079 00311102
*0834155000,158000-159000,170000-173600,174000-176600,183000,    M0094  00313202
*0834185000,200100,200400,202200,202300-202900,203560,213000,    M0094  00315302
*0834215000,263000,265000,271000,278000-279000,316000-317000,    M0094  00317402
*0834320000,322000,332000-334000,346000-347000,369000,383600,    M0094  00319502
*0834461000-471000,498400,507000,520000-520500,525000,526400,    M0094  00321602
*0834589000-590000,593000,639000,643000,645000-646000,654000-    M0094  00323702
*0834657000,694300,707000-708000,749000-750000,764000-765000     M0094  00325802
*0834042000,159000                                               S21A12 00327902
*0834381600-382200,384000-418000,420000-490000,491000,589000,    S21008 00330021
*0834612100-633000,639000,759000-763000                          S21008 00360021
*0834763400                                                      S22028 00380002
*          RELEASE 22 DELETIONS                                       * 00400020
*                                                                     * 01200020
*                                                                M3281  01210020
*                                                                M2152  01220020
*                                                                M3279  01250020
*0000105500,113900,205200-205600                                 M0019  01300020
*0000204200-205200,359400-360200,412200-413000                   M0607  01400020
*                                                                M0661  01500020
*                                                                TS1628 01550020
*                                                                 M2265 01570020
*                                                                 M3491 01575020
*                                                                M2794  01580020
*                                                                M2331  01590020
*                                                                 M3830 01595020
*                                                                M4395  01597020
*                                                                M4424  01598020
*                                                                 M5312 01599020
* STATUS CHANGE LEVEL 003                                       ZA16607 01649003
*                                                                     * 01700020
* FUNCTION -                                                          * 01800020
*    GET INPUT FROM TERMINAL VIA THE TIOC(TCAM TERMINAL) OR     ZA16607 01900003
*    VTIOC(VTAM TERMINAL) AND PASS IT TO THE USER'S BUFFER      ZA16607 01930003
*    PUT OUTPUT FROM THE USER'S BUFFER TO THE TERMINAL VIA THE  ZA16607 01960003
*    TIOC(TCAM TERMINAL) OR VTIOC(VTAM TERMINAL)                ZA16607 02000003
*    TCAM VS. VTAM IS DETERMINED VIA TSBVTAM:                   ZA16607 02050003
*        TSBVTAM=0: TCAM                                        ZA16607 02100003
*        TSBVTAM=1: VTAM                                        ZA16607 02150003
*                                                                     * 02200003
*    PROVIDE LIMITED EDITING OPTIONS FOR BOTH INPUT AND OUTPUT.       * 02300002
*    PROVIDE FOR OUTPUT OF MESSAGES TO TERMINALS OTHER THAN THE       * 02400002
*    ONE ASSOCIATED WITH THE TASK.                                    * 02500020
*                                                                     * 02600020
* ENTRY POINTS -                                                      * 02700002
*    SVC - INITIAL ENTRY TO THIS MODULE WHEN AN SVC 93 OR A           * 02800002
*           TPUT OR TGET MACRO INSTRUCTION IS ISSUED.                 * 02900020
*                                                                     * 03000020
* INPUT -                                                             * 03100002
*    REGISTERS 0, 1, AND POSSIBLY 15 CONTAIN PARAMETERS AS FOLLOWS:   * 03200002
*        **********************************                           * 03260002
*    REG0*RAAAAAAAAAAAAAAARSSSSSSSSSSSSSSS*                           * 03270002
*        **********************************                           * 03280002
*           WHERE - R EQUALS RESERVED                                 * 03290002
*                   A EQUALS ASID OF DESTINATION TERMINAL             * 03292002
*                   S EQUALS USER'S BUFFER SIZE, IN BYTES             * 03294002
*        **********************************                           * 03298002
*    REG1*OULWHBEEPPPPPPPPPPPPPPPPPPPPPPPP*                           * 03298402
*        **********************************                           * 03298802
*           WHERE - O EQUALS OPTION - 0=TPUT, 1=TGET                  * 03299202
*                   U EQUALS USERID SPECIFIED BY REG 15               * 03299602
*                   L EQUALS LEVEL OF PRIORITY /0 HIGHP/1 LOWP          04550002
*                   W EQUALS WAIT  /0 WAIT/1 NOWAIT                   * 04600020
*                   H EQUALS HOLD  /0 NOHOLD/1 HOLD                   * 04700020
*                   B EQUALS BREAR  /0 NOBREAK/1 BREAKIN              * 04800020
*                  EE EQUALS EDIT  /00 EDIT/01 ASIS/10 CONTROL        * 04900020
*                   P EQUALS POINTER TO USER'S BUFFER                 * 05000020
*                                                                     * 05100020
*    REG 15 CONTAINS A POINTER TO THE USER ID, IF 'U,' ABOVE, IS      * 05150002
*    ONE.                                                             * 05160002
*                                                                     * 05170002
* OUTPUT -                                                            * 05200002
*    RETURN CODE IN REGISTER 15 -                                     * 05300002
*        00 SUCCESSFUL.                                               * 05400020
*        04 TPUT - NOWAIT SPECIFIED AND NO TIOC OUTPUT                * 05500020
*                  BUFFER WAS AVAILABLE.                              * 05600020
*           TGET - NOWAIT SPECIFIED AND NO INPUT READY.               * 05700020
*        08 ATTENTION INTERRUPT                                       * 05800020
*        0C TPUT - NO INTER-TERMINAL COMMUNICATION BIT ON             * 05900020
*           TGET THE BUFFER WAS TOO SMALL FOR INPUT GIVEN.            * 06000020
*        10 INVALID PARAMETERS SPECIFIED                              * 06100020
*        14 USER NO LONGER ACTIVE                                     * 06200002
*           OR THE TERMINAL USER HUNG UP                              * 06300020
*                                                                     * 06400020
*   TGET -                                                            * 06500020
*        LENGTH IN BYTES OF MSG GOTTEN IS GIVEN IN REG 1.             * 06600020
*                                                                     * 06700020
* EXTERAL ROUTINES -                                                  * 06800002
*         MODESET                                                     * 06900002
*         QTIP                                                        * 07000002
*         SETLOCK                                                     * 07050002
*         STATUS                                                      * 07060002
*         XCTL                                                        * 07070002
*         IKTTMPX1                                              ZA24648 07070803
*            REG 15 RETURN CODE FROM IKTTMPX1                   ZA24648 07071603
*                    RC < 0 NORMAL PROCESSING SHOULD CONTINUE   ZA24648 07072403
*                       >=0 THE SVC SHOULD RETURN TO THE CALLER ZA24648 07073203
*                           PASSING THRU THE VALUE IN REG 15    ZA24648 07074003
*                                                                     * 07100020
* EXITS,NORMAL -                                                      * 07200020
*                                                                     * 07230003
*  FOR TCAM REQUESTS:                                                 * 07260003
*    RETURN TO SUPERVISOR VIA BR 14, OR                               * 07300002
*    BRANCH TO MODULE IGG09301 TO DO A NORMAL TPUT, OR                * 07350002
*    BR TO MODULE IGG09302 TO DO AN ASID TPUT OR A USERID TPUT, OR    * 07360002
*    BR TO MODULE IGG09303 AFTER A TGET, TO REMOVE WAITS              * 07370002
*                                                                     * 07400020
*  FOR VTAM REQUESTS:                                           ZA16607 07410003
*    BR TO MODULE IKTVTPUT TO DO A NORMAL TPUT, OR              ZA16607 07420003
*    BR TO MODULE IKTASTPT TO DO AN ASID TPUT OR A USERID TPUT, OR      07430003
*    BR TO MODULE IKTVTGET TO DO A TGET.                        ZA16607 07440003
*                                                                     * 07450003
* EXITS,ERROR                                                         * 07500020
*    THERE ARE NO ERROR EXITS FROM THIS ROUTINE.                      * 07600002
*                                                                     * 07700020
* TABLES/WORKAREAS -                                                  * 07800020
*    THE FORMAT AND CONTENTS OF THE WORK AREA USED ARE DESCRIBED      * 07900002
*    BY THE DSECTS AT THE END OF THE LISTING.                         * 08000002
*    ALSO, THE EXTENDED SAVE AREA OF THE SVRB IS USED AS A SAVE AND   * 08030002
*    WORK AREA.                                                       * 08060002
*                                                                     * 08100020
* ATTRIBUTES -                                                        * 08200002
*    REENTRANT, ENABLED, PRIVILEGED, LOCAL LOCK HELD IMPLICITLY,      * 08300002
*    CMS LOCK GOTTEN EXPLICITLY.                                      * 08360002
*                                                                     * 08400020
* CHARACTER CODE DEPENDENCY -                                         * 08500020
*                                                                     * 08600020
*    THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL              08700020
*    REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS              08800020
*    EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE                  08900020
*    CODING HAS BEEN ARRANGED SO THAT REDEFINITION OF                   09000002
*    'CHARACTER' CONSTANTS, BY REASSEMBLY, WILL RESULT IN A             09100020
*    CORRECT MODULE FOR THE NEW DEFINITIONS.                            09200020
*                                                                     * 09300020
*                                                                     * 09400020
* NOTES -                                                             * 09500020
*    NONE                                                             * 09600020
*                                                                     * 09700020
*********************************************************************** 09800020
         SPACE 2                                                        09900020
IGC0009C CSECT                                                          10000020
         SPACE 2                                                        10100020
***                                                                     10200020
***                 REGISTER EQUATES                                    10300020
***                                                                     10400020
R0       EQU   0                        REG USED FOR ASM SPEED          10500020
RP0      EQU   0                        FIRST PARAMETER REGISTER        10600020
RWRK4    EQU   0                        WORK REGISTER           ZA16607 10650003
RP1      EQU   1                        SECOND PARAMETER REGISTER       10700020
RSDWA    EQU   1                        POINT TO SDWA IN ESTAE  YS02019 10750002
RBUF     EQU   2                        POINTER TO TS BUFFER            10800020
RWSA     EQU   2                        POINTER TO ESTAE WSA    YS02019 10850002
RWRK02   EQU   2                        WORK REGISTER           YS02019 10860002
RCVT     EQU   3                        POINTER TO CVT                  10900020
RWRK3    EQU   3                        WORK REGISTER           YS02019 10950002
RTCB     EQU   4                        POINTER TO TCB                  11000020
RSVRB    EQU   5                        POINTER TO SVRB                 11100020
RBASE    EQU   6                        BASE REGISTER                   11200020
RWRK2    EQU   7                        WORK REGISTER           YS02019 11300002
RTSBX    EQU   7                        POINTER TO TSB EXTEN    ZA16607 11304003
REG7     EQU   7                                                ZA24648 11305003
RASCB    EQU   8                        POINTER TO ASCB         YS02019 11308002
RTSB     EQU   9                        POINTER TO TSB                  11500020
RRPT     EQU   10                       POINTER TO TIOCRPT              11600020
RESTAE   EQU   10                       POINTER TO TSO/VTAM ESTAZA16607 11620003
RTCX     EQU   11                       POINTER TO TCAM CVT EXT YS02019 11640002
RECB     EQU   11                       ECB TO BE POSTED POINTER        11800020
RJSCB    EQU   12                       POINTER TO JSCB                 11900020
RTJID    EQU   12                       TJID OF TASK                    12000020
RAVT     EQU   13                       POINTER TO AVT                  12100020
RSAVE    EQU   13                       SAVE REGISTER                   12200020
RWRK     EQU   14                       WORK REGISTER                   12300020
RETURN   EQU   14                       RETURN ADDRESS REGISTER         12400020
RET      EQU   15                       ENTRY POINTER                   12600020
RWRK1    EQU   15                       WORK REGISTER                   12700020
RCODE    EQU   15                       RETURN CODE REGISTER            12800020
***                                                                     12900020
***                 CONSTANTS                                           13000020
***                                                                     13100020
K0       EQU   0                        CONSTANT OFFSET                 13200020
K1       EQU   1                        CONSTANT OFFSET AND SIZE        13300020
K3       EQU   3                        CONSTANT OFFSET         YS02019 13350002
K4       EQU   4                        CONSTANT OFFSET         YS02019 13360002
K12      EQU   12                       CONSTANT OFFSET         YS02019 13370002
WORD4    EQU   12                       OFFSET                  YS02019 13380002
SDTCB    EQU   15                       ENTRY CODE FOR 'STATUS' YS02019 13400002
CLEANTSB EQU   29                       QTIP 29 ENTRY CODE      YS02019 13450002
***                                                                     14300020
***                 RETURN CODES                                        14400020
***                                                                     14500020
RC04     EQU   X'04'                    NOWAIT AND NO DATA              14600002
RC08     EQU   X'08'                    ATTENTION HIT DURING OPERATION  14700002
RC0C     EQU   X'0C'                    BFR TOO SMALL FOR DATA   M0607  14800020
RC10     EQU   X'10'                    INVALID PARAMETERS              14900002
RC14     EQU   X'14'                    USER GONE AWAY                  15000002
***                                                                     15100020
***                 MASKS                                               15200020
***                                                                     15300020
OFF      EQU   X'FF'                    TO TURN OFF BITS        YS02019 15320002
NDISPBIT EQU   X'800'                   MASK FOR 'STATUS'       YS02019 15330002
NP       EQU   13                       FOR BCR INSTRUCTIONS    YS02019 15340002
ICM7     EQU   7                        FOR ICM INSTRUCTIONS    ZA32421 15390003
         SPACE 2                                                        17700020
***                                                                     17800020
***                 OTHER EQUATES                                       17900020
***                                                                     18000020
RETPSW   EQU   20                       LOWER HALF OF RB OLD PSW        18200020
EDITCODE EQU   18                       QTIP ENTRY CODE FOR EDIT        18400020
MULTBY4  EQU   2                        SHIFT VAL FOR TIMES 4   YS02019 18410002
PARTT    EQU   X'400'                   PARTIAL FLAG FOR SYSEVENT       18530002
*                                       NEEDS TO BE SHIFTED LEFT        18560020
CCODE15D EQU   X'15D'                   COMPLETION CODE 15D     YS02019 18594002
         SPACE 2                                                        18600020
         BALR  RBASE,R0                 SET BASE REGISTER               18700020
         USING *,RBASE                  ADDRESSABILITY                  18800020
         SPACE 3                                                        18850002
         EJECT                                                          18900020
*********************************************************************** 18950002
***                                                                 *** 18960002
***      THIS MODULE HOLDS THE LOCAL LOCK AT ENTRY                  *** 18970002
***                                                                 *** 18980002
*********************************************************************** 18990002
         SPACE 3                                                        18992002
*********************************************************************** 19000020
***                                                                 *** 19100020
***                 COMMON  TGET / TPUT  ROUTINE                    *** 19200020
***                                                                 *** 19300020
*********************************************************************** 19400020
         SPACE 3                                                        19500020
         USING CVT,RCVT                                                 19600020
         USING TCB,RTCB                                                 19700020
         USING TIOCBUF,RBUF                                             19800020
         USING RBSECT,RSVRB                                      M0094  19850021
         ST    RETURN,XSARETRG          SAVE RETURN ADDRESS     YS02019 19852002
         ST    RET,XSAUSERP             SAVE USERID POINTER     YS02019 19854002
         STM   RP0,RP1,XSAPRM0          SAVE PARAMETERS IN RB    Y01018 19855000
         B     TGT0005                  BRANCH AROUND I.D.       Y01018 19865000
         DC    C'IGC0009C'              MODULE I.D.              Y01018 19870000
         DC    X'7007'                  JULIAN DATE - 01/07/77  ZA24648 19875003
TGT0005  EQU   *                                                YS02019 19876002
         MVI   XSAFLAG,K0               INITIALIZE FLAGS         M0094  20010021
         MVI   XSAFLAG2,K0              INITIALIZE FLAGS         S22028 20010402
         SPACE 2                                                YS02019 20012002
***                                                                     20014002
***                 TURN ON TCBFX TO PREVENT ASYNCHRONOUS EXITS,        20016002
***                 BUT RECORD PREVIOUS SETTING SO IT CAN BE RESTORED   20018002
***                                                                     20018402
         TM    TCBFLGS1,TCBFX           WAS TCBFX ON AT ENTRY           20020020
         BO    TGT0010                  IF SO, SKIP                     20030020
         OI    XSAFLAG,XSATCBFX         IF NOT, INDICATE THAT WE M0094  20040021
*                                       SHOULD TURN IT OFF LATER        20050020
TGT0010  EQU   *                                                        20060020
         OI    TCBFLGS1,TCBFX           PREVENT ASYNCHRONOUS EXIT       20100020
         SPACE                                                          20110002
***                                                                     20150002
***                 GET TSO CONTROL BLOCK POINTERS                      20200002
***                                                                     20210002
         L     RASCB,PSAAOLD-PSA        GET ASCB ADDRESS        YS02019 20260002
         USING ASCB,RASCB               ASCB ADDRESSABLE        YS02019 20310002
         L RTSB,ASCBTSB             GET TSB POINTER             ZA11383 20313003
         USING TSB,RTSB                                         ZA11383 20316003
         LH    RTJID,ASCBASID           GET ASID                YS02019 20360002
         L     RTCX,CVTASVT             GET ASVT POINTER        YS02019 20682002
         USING ASVT,RTCX                                        YS02019 20683002
         LH    RWRK,XSAPRMTJ            GET DEST ASID FOR CHECK YS02019 20684002
         C     RWRK,ASVTMAXU            CHECK FOR TOO HIGH      YS02019 20685002
         BH    TGT7000                  IF IT IS, YOU'RE OUT    YS02019 20686002
         DROP  RTCX                                             YS02019 20691002
***                                                             ZA16607 20691503
***                CHECK FOR VALID USER BUFFER SIZE             ZA16607 20692003
***                                                             ZA16607 20692803
         LH    RWRK1,XSAPRMSZ           GET BUFFER SIZE         ZA16607 20694003
         LTR   RWRK1,RWRK1              CHECK FOR EXCESSIVE     ZA16607 20704003
*                                       BUFFER SIZE             ZA16607 20714003
         BM    TGT7000                  IF TOO LARGE GO TO      ZA16607 20724003
*                                       ILLEGAL PARAMETER RETURNZA16607 20734003
         L     RET,USEREXIT             GET @ OF TERM MGR EXIT  ZA24648 20734403
         LTR   RET,RET                  IS THERE A USER EXIT    ZA24648 20734803
         BZ    TGTTPT                   BRANCH ON NO            ZA24648 20735203
         LR    REG7,RASCB               PUT ASCB @ IN REG 7     ZA24648 20735603
         BALR  RETURN,RET               BRANCH TO USER EXIT     ZA24648 20744003
         LTR   RCODE,RCODE              TEST RETURN CODE        ZA24648 20744503
         BNM   TGT9000                  BRANCH ON CODE >=0      ZA24648 20745003
*                                                               ZA16607 20745503
****************************************************************ZA16607 20754003
****                                                        ****ZA16607 20764003
****            DETERMINE IF TGET OR TPUT OR TPUT W/ASID    ****ZA16607 20774003
****                                                        ****ZA16607 20784003
****************************************************************ZA16607 20794003
*                                                               ZA16607 20804003
TGTTPT   EQU   *                                                ZA24648 20806003
         LTR   RP1,RP1                  IS  THIS A TGET REQUEST ZA16607 20814003
         BM    TGT0100                  IF  TGET  GO  TEST      ZA16607 20824003
*                                       TCAM/VTAM               ZA16607 20834003
         TM    XSAOPTNS,MUSERID         WAS USERID  SPECIFIED   ZA16607 20844003
         BNO   TGT0008                  NO SKIP CHECK           ZA16607 20854003
         L     RWRK,ASCBCSCB            GET CSCB POINTER        ZA16607 20864003
         L     RET,XSAUSERP             GET USERID POINTER      ZA16607 20874003
         LTR   RWRK,RWRK                IS THERE A CSCB         ZA16607 20884003
         BZ    TGT0012                  NO CSCB..CAN'T BE  SAME ZA16607 20894003
         USING CSCB,RWRK                                        ZA16607 20904003
         CLC   CHKEY,0(RET)             CHECK CALLER'S USERID   ZA16607 20914003
         DROP  RWRK                                             ZA16607 20924003
         BE    TGT0100                  IF SAME, NORMAL TPUT    ZA16607 20934003
*                                       CHECK TCAM/VTAM         ZA16607 20944003
         B     TGT0012                  IF NOT, ASID TPUT       ZA16607 20954003
TGT0008  LH    RWRK,XSAPRMTJ            PICK UP  SPECIFIED ID   ZA16607 20964003
         LTR   RWRK,RWRK                IS ASID POSITIVE        ZA16607 20974003
         BM    TGT7000                  NEGATIVE...INVALID      ZA16607 20984003
         BZ    TGT0100                  NO ASID SPECIFIED...    ZA16607 20994003
*                                       NORMAL TPUT. CHECK      ZA16607 21004003
*                                       TCAM/VTAM               ZA16607 21014003
         CR    RTJID,RWRK               IS ASID SAME AS THAT OF ZA16607 21024003
*                                       THE CALLING TASK        ZA16607 21034003
         BE    TGT0100                  YES. NORMAL TPUT. CHECK ZA16607 21044003
*                                       TCAM/VTAM               ZA16607 21054003
         EJECT                                                          21064003
*                                                               ZA16607 21074003
****************************************************************ZA16607 21084003
****                                                        ****ZA16607 21094003
****           CROSS MEMORY TPUT...DETERMINE WHETHER TARGET ****ZA16607 21104003
****           MEMORY IS USING TCAM OR VTAM AS ACCESS METHOD****ZA16607 21114003
****           BY SEARCHING THE TSB'S                       ****ZA16607 21124003
****                                                        ****ZA16607 21134003
****************************************************************ZA16607 21144003
*                                                               ZA16607 21154003
***                                                             ZA16607 21164003
***            NEED CMS LOCK FOR TSB                            ZA16607 21174003
***                                                             ZA16607 21184003
TGT0012  SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   ZA16607-21194003
               RELATED=(TSB,IGC0009C(TGT0030))                  ZA16607 21204003
*                                                               ZA16607 21214003
****************************************************************ZA16607 21224003
****                                                        ****ZA16607 21234003
****                SEARCH FOR TCAM TSB                     ****ZA16607 21244003
****                                                        ****ZA16607 21254003
****************************************************************ZA16607 21264003
*                                                               ZA16607 21274003
         L     RTCX,CVTAQAVT            GET TCX POINTER         ZA16607 21284003
         LTR   RTCX,RTCX                IS TCAM UP              ZA16607 21294003
         BZ    TGT0038                  NO, SCAN FOR VTAM       ZA11383 21304003
         USING IEDQTCX,RTCX                                     ZA16607 21314003
         L     RRPT,TCXRPT              GET TIOCRPT POINTER     ZA16607 21324003
         LTR   RRPT,RRPT                IS TSO/TCAM UP          ZA16607 21334003
         BZ    TGT0038                  NO, SCAN FOR VTAM       ZA11383 21344003
         SPACE                                                          21354003
         USING TIOCRPT,RRPT                                     ZA16607 21364003
***                                                             ZA16607 21374003
***                INITIALIZE REGS FOR SEARCH                   ZA16607 21384003
***                                                             ZA16607 21394003
         SR    RBUF,RBUF                                        ZA16607 21404003
         IC    RBUF,TIOCTSBS            INCREMENT AMOUNT=SIZE   ZA16607 21414003
         LR    RWRK,RBUF                FOR MULTIPLICATION      ZA16607 21424003
         LH    RWRK1,TIOCNTSB           GET NO. OF TSBS         ZA16607 21434003
         BCTR  RWRK1,R0                 SUBTRACT ONE            ZA16607 21444003
         MR    RWRK,RWRK                GET OFFSET OF LAST TSB  ZA16607 21454003
         LR    RWRK3,RWRK1              CHANGE REGS FOR BXLE    ZA16607 21464003
         L     RTSB,TIOCTSB-K1          GET ORIGIN OF TABLE     ZA16607 21474003
         LA    RTSB,K0(,RTSB)           CLEAR HIGH ORDER BYTE   ZA16607 21484003
         USING TSB,RTSB                                         ZA16607 21494003
         AR    RWRK3,RTSB               ADD TO OFFSET           ZA16607 21504003
*                                                               ZA16607 21514003
****************************************************************ZA16607 21524003
*                                                               ZA16607 21534003
*                   REGISTERS 2,3 AND RTSB ARE SET UP FOR A BXLEZA16607 21544003
*                     LOOP TO SCAN THE TSB TABLE                ZA16607 21554003
*                     RBUF(2),INCREMENT, HAS THE TSB SIZE       ZA16607 21564003
*                    RWRK3(3),COMPARAND, POINTS TO THE LAST TSB ZA16607 21574003
*                       IN THE TSB TABLE, AND                   ZA16607 21584003
*                     RTSB,INDEX, POINTS TO THE FIRST TSB IN THEZA16607 21594003
*                       TSB TABLE                               ZA16607 21604003
*                                                               ZA16607 21614003
*                     NOW, THE TSB'S AND ASSOCIATED ASCB'S      ZA16607 21624003
*                     (AND CSCB'S) WILL BE SCANNED FOR A MATCH  ZA16607 21634003
*                     ON THE ASID OR THE USERID                 ZA16607 21644003
*                                                               ZA16607 21654003
*                     THE ASVT CANNOT BE USED, BECAUSE IT MUST  ZA16607 21664003
*                     BE STABILIZED WITH THE DISPATCHER LOCK,   ZA16607 21674003
*                     AND HOLDERS OF THIS LOCK MUST BE FIXED    ZA16607 21684003
*                     AND DISABLED.                             ZA16607 21694003
*                                                               ZA16607 21704003
****************************************************************ZA16607 21714003
*                                                               ZA16607 21724003
         TM    XSAOPTNS,MUSERID         WAS USERID SPECIFIED    ZA16607 21734003
         BO    TGT0020                  YES, GO LOOK FOR IT.    ZA16607 21744003
***                                                             ZA16607 21754003
***                 SCAN FOR ASID MATCH                         ZA16607 21764003
***                                                             ZA16607 21774003
         LH    RWRK4,XSAPRMTJ           GET SPECIFIED ASID      ZA16607 21784003
TGT0014  EQU   *                                                ZA16607 21794003
         TM    TSBSTAT,TSBINUSE         TSB VALID?              ZA32421 21797003
         BNO   TGT0016                  NO, CONTINUE SCAN       ZA32421 21800003
         ICM   RASCB,ICM7,TSBASCB       GET ASCB POINTER, GOOD? ZA32421 21804003
         BZ    TGT0016                  NO, CONTINUE SCAN       ZA16607 21824003
         USING ASCB,RASCB                                       ZA16607 21834003
         CH    RWRK4,ASCBASID           CHECK ASID              ZA16607 21844003
         BE    TGT0030                  IF SAME, THIS IS IT     ZA16607 21854003
TGT0016  EQU   *                                                ZA16607 21864003
         BXLE  RTSB,RBUF,TGT0014        CONTINUE SCAN           ZA16607 21874003
         B     TGT0040                  NOT IN TCAM LIST        ZA16607 21884003
*                                       GO LOOK AT VTAM         ZA16607 21894003
***                                                             ZA16607 21904003
***                SCAN FOR USERID MATCH                        ZA16607 21914003
***                                                             ZA16607 21924003
TGT0020  EQU   *                                                ZA16607 21934003
         L     RWRK1,XSAUSERP           GET POINTER TO USERID   ZA16607 21944003
TGT0022  TM    TSBSTAT,TSBINUSE         TSB VALID?              ZA32421 21947003
         BNO   TGT0024                  NO, CONTINUE SCAN       ZA32421 21950003
         ICM   RASCB,ICM7,TSBASCB       GET ASCB POINTER, GOOD? ZA32421 21954003
         BZ    TGT0024                  NO, GET  NEXT           ZA16607 21974003
         L     RWRK,ASCBCSCB            GET CSCB POINTER        ZA16607 21984003
         USING CSCB,RWRK                                        ZA16607 21994003
         CLC   CHKEY,0(RWRK1)           CHECK USERID            ZA16607 22004003
         BE    TGT0030                  GO PROCESS IT           ZA16607 22014003
         DROP  RWRK                                             ZA16607 22024003
TGT0024  EQU   *                                                ZA16607 22034003
         BXLE  RTSB,RBUF,TGT0022        LOOK AT EACH TSB        ZA16607 22044003
         B     TGT0040                  NOT IN TCAM LIST        ZA16607 22054003
*                                       GO LOOK AT VTAM         ZA16607 22064003
TGT0030  EQU   *                                                ZA16607 22074003
***                                                             ZA16607 22084003
***  RTSB=DESTINATION TSB, RASCB=DESTINATION ASCB               ZA16607 22094003
***                                                             ZA16607 22104003
         SETLOCK RELEASE,TYPE=CMS,                              ZA16607-22114003
               RELATED=(TSB,IGC0009C(TGT0012))                  ZA16607 22124003
         SPACE 2                                                ZA16607 22134003
         L     RASCB,PSAAOLD-PSA        GET ASCB ADDRESS        ZA16607 22144003
         LH    RTJID,ASCBASID           GET ASID                ZA16607 22154003
         L     RCVT,CVTPTR              RESTORE CVT POINTER     ZA16607 22164003
         BAL   RWRK2,TGT0190            SET UP TCAM ESTAE       ZA16607 22174003
*                                                               ZA16607 22184003
****************************************************************ZA16607 22194003
***                                                         ****ZA16607 22204003
***                BRANCH TO IGG09302 HOLDING THE LOCAL LOCK****ZA16607 22214003
***                ASID TPUT TO A TCAM TERMINAL             ****ZA16607 22224003
***                                                         ****ZA16607 22234003
****************************************************************ZA16607 22244003
         L     RET,VCON9302             GET IGG09302'S EPA      ZA16607 22254003
         BR    RET                      GOTO IGG09302           ZA16607 22264003
TGT0038  EQU   *                                                ZA11383 22274003
         L     RCVT,CVTPTR              RESTORE CVT POINTER     ZA11383 22284003
         L     RWRK,CVTTCASP            GET POINTER TO TCAS TBL ZA11383 22294003
         LTR   RWRK,RWRK                IS TSO/VTAM UP          ZA11383 22304003
         BNZ   TGT0041                  NO. TERMINAL CAN'T BE   ZA11383 22314003
         LTR   RTSB,RTSB                IS THIS TSTASK          ZA11383 22324003
         BZ    TGT9200                  NO, MAKE IT NOP         ZA11383 22334003
         B     TGT6800                  GO RETURN TO CALLER     ZA11383 22344003
         DROP  RTSB                                             ZA16607 22354003
         EJECT                                                  ZA16607 22364003
*                                                               ZA16607 22374003
****************************************************************ZA16607 22384003
***                                                         ****ZA16607 22394003
***                SEARCH FOR VTAM TSB                      ****ZA16607 22404003
***                                                         ****ZA16607 22414003
****************************************************************ZA16607 22424003
*                                                               ZA16607 22434003
TGT0040  EQU   *                                                ZA16607 22444003
         L     RCVT,CVTPTR              RESTORE CVT POINTER     ZA16607 22454003
         L     RWRK,CVTTCASP            GET POINTER TO TCAS TBL ZA16607 22464003
         LTR   RWRK,RWRK                IS TSO/VTAM UP          ZA16607 22474003
         BZ    TGT6800                  NO. TERMINAL CAN'T BE   ZA16607 22484003
*                                       FOUND. RETURN TO        ZA16607 22494003
*                                       CALLER                  ZA16607 22504003
TGT0041  EQU   *                                                        22514003
         USING TCAST,RWRK                                       ZA16607 22524003
         L     RTSB,TCASTSB             INITIALIZE RTSB TO FIRSTZA16607 22534003
*                                       TSO/VTAM TSB FOR  SEARCHZA16607 22544003
         USING TSB,RTSB                                         ZA16607 22554003
         TM    XSAOPTNS,MUSERID         WAS USERID SPECIFIED    ZA16607 22564003
         BO    TGT0050                  YES, GO LOOK FOR IT     ZA16607 22574003
         LH    RWRK4,XSAPRMTJ           GET SPECIFIED ASID      ZA16607 22584003
***                                                             ZA16607 22594003
***                SCAN FOR ASID MATCH                          ZA16607 22604003
***                                                             ZA16607 22614003
TGT0042  EQU   *                                                ZA16607 22624003
         LTR   RTSB,RTSB                ANY MORE TSB'S          ZA16607 22634003
         BZ    TGT6800                  NO MORE. TERMINAL CAN'T ZA16607 22644003
*                                       BE FOUND. RETURN TO     ZA16607 22654003
*                                       CALLER                  ZA16607 22664003
         L     RASCB,TSBASCBA           GET  ASCB POINTER       ZA16607 22674003
         CH    RWRK4,ASCBASID           SAME ASID?              ZA16607 22684003
         BE    TGT0055                  YES, THIS IS IT         ZA16607 22694003
*                                                               ZA16607 22704003
         L     RTSBX,TSBEXTNT           GET ADDRESS OF TSB      ZA16607 22714003
*                                       EXTENSION               ZA16607 22724003
         USING TSBX,RTSBX                                       ZA16607 22734003
         L     RTSB,TSBXFWD             GET TSB POINTER TO      ZA16607 22744003
*                                       NEXT IN LIST            ZA16607 22754003
         B     TGT0042                                          ZA16607 22764003
***                                                             ZA16607 22774003
***                SCAN FOR USERID MATCH                        ZA16607 22784003
***                                                             ZA16607 22794003
TGT0050  EQU   *                                                ZA16607 22804003
         L     RWRK1,XSAUSERP           GET POINTER TO USERID   ZA16607 22814003
TGT0052  EQU   *                                                ZA16607 22824003
         LTR   RTSB,RTSB                ANY MORE TSB'S          ZA16607 22834003
         BZ    TGT6800                  NO MORE.TERMINAL CAN'T  ZA16607 22844003
*                                       BE FOUND. RETURN TO     ZA16607 22854003
*                                       CALLER                  ZA16607 22864003
         L     RASCB,TSBASCBA           GET ASCB POINTER        ZA16607 22874003
         L     RWRK,ASCBCSCB            GET CSCB POINTER        ZA16607 22884003
         USING CSCB,RWRK                                        ZA16607 22894003
         CLC   CHKEY,0(RWRK1)           COMPARE USERID S        ZA16607 22904003
         BE    TGT0054                  FOUND DESIRED ONE       ZA16607 22914003
         DROP  RWRK                                             ZA16607 22924003
         L     RTSBX,TSBEXTNT           GET ADDRESS OF          ZA16607 22934003
*                                       TSB EXTENSION           ZA16607 22944003
         L     RTSB,TSBXFWD             SET TSB POINTER TO      ZA16607 22954003
*                                       NEXT IN LIST            ZA16607 22964003
         B     TGT0052                  CONTINUE  SCAN          ZA16607 22974003
*                                                               ZA16607 22984003
TGT0054  EQU   *                                                ZA16607 22994003
***                                                             ZA16607 23004003
***                WHEN A MATCHING USERID IS FOUND,             ZA16607 23014003
***                SAVE ASID IN TPUT WORK AREA                  ZA16607 23024003
***                                                             ZA16607 23034003
         MVC   XSAPRMTJ,ASCBASID        GET DESTINATION ASID    ZA16607 23044003
*                                       SAVE IT IN WORK AREA    ZA16607 23054003
***                                                             ZA16607 23064003
***    RTSB =  DESTINATION  TSB                                 ZA16607 23074003
***                                                             ZA16607 23084003
TGT0055  SETLOCK RELEASE,TYPE=CMS,                              ZA16607-23094003
               RELATED=(TSB,IGC0009C(TGT0012))                  ZA16607 23104003
         SPACE 2                                                ZA16607 23114003
         L     RASCB,PSAAOLD-PSA        RESTORE CALLERS ASCB    ZA16607 23124003
         BAL   RWRK2,TGT0180            SET UP VTAM ESTAE       ZA16607 23134003
*                                                               ZA16607 23144003
****************************************************************ZA16607 23154003
****                                                        ****ZA16607 23164003
****               BRANCH TO IKTASTPT HOLDING THE LOCAL LOCK****ZA16607 23174003
****                                                        ****ZA16607 23184003
****************************************************************ZA16607 23194003
*                                                               ZA16607 23204003
         L     RET,VCONASTP             GET IKTASTPT'S EPA      ZA16607 23214003
         BR    RET                      GOTO IKTASTPT           ZA16607 23224003
         SPACE 2                                                ZA16607 23234003
*                                                               ZA16607 23244003
****************************************************************ZA16607 23254003
****                                                        ****ZA16607 23264003
****               NORMAL TPUT OR TGET                      ****ZA16607 23274003
****               CHECK CALLER'S TSB FOR ACCESS METHOD     ****ZA16607 23284003
****                                                        ****ZA16607 23294003
****************************************************************ZA16607 23304003
*                                                               ZA16607 23314003
TGT0100  EQU   *                                                ZA16607 23324003
         L     RTSB,ASCBTSB             GET TSB POINTER         ZA16607 23334003
         LTR   RTSB,RTSB                IS THIS A TS TASK       ZA16607 23344003
         BZ    TGT9200                  IF NOT, MAKE THIS A NOOPZA16607 23354003
*                                       USING ON TSB ALREADY    ZA16607 23364003
*                                       IN EFFECT               ZA16607 23374003
         TM    TSBFLG5,TSBVTAM          IS THIS A VTAM TSB      ZA16607 23384003
         BO    TGT0150                  YES, USE VTAM ROUTINES  ZA16607 23394003
***                                                             ZA16607 23404003
***                NORMAL TCAM REQUEST                          ZA16607 23414003
***                                                             ZA16607 23424003
         L     RTCX,CVTAQAVT            GET TCX POINTER         ZA16607 23434003
         LTR   RTCX,RTCX                IS TCAM UP              ZA16607 23444003
         BZ    TGT9200                  NO. NOOP THE REQUEST    ZA16607 23454003
         USING IEDQTCX,RTCX                                     ZA16607 23464003
         L     RRPT,TCXRPT              GET TIOCRPT POINTER     ZA16607 23474003
         LTR   RRPT,RRPT                IS TSO/TCAM UP          ZA16607 23484003
         BZ    TGT9200                  NO. NOOP THE REQUEST    ZA16607 23494003
         SPACE                                                          23504003
         BAL   RWRK2,TGT0190            SET UP TCAM ESTAE       ZA16607 23514003
         SPACE                                                          23524003
         LM    RP0,RP1,XSAPRM0          RESTORE PARM REGISTERS  ZA16607 23534003
         LTR   RP1,RP1                  IS THIS A TGET REQUEST  ZA16607 23544003
         BM    TGT0200                  IF TCAM TGET, REMAIN IN ZA16607 23554003
*                                       THIS MODULE             ZA16607 23564003
*                                                               ZA16607 23574003
****************************************************************ZA16607 23584003
****                                                        ****ZA16607 23594003
****               BRANCH TO IGG09301 HOLDING THE LOCAL LOCK****ZA16607 23604003
****                                                        ****ZA16607 23614003
****************************************************************ZA16607 23624003
*                                                               ZA16607 23634003
         L     RET,VCON9301             GET ADDRESS OF IGG09301 ZA16607 23644003
         BR    RET                      GO TO IGG09301          ZA16607 23654003
         SPACE 4                                                ZA16607 23664003
***                                                             ZA16607 23674003
***                NORMAL VTAM REQUEST                          ZA16607 23684003
***                                                             ZA16607 23694003
TGT0150  EQU   *                                                ZA16607 23704003
         L     RWRK,CVTTCASP            GET POINTER TO TCAS TBL ZA16607 23714003
         LTR   RWRK,RWRK                IS  TSO/VTAM UP         ZA16607 23724003
         BZ    TGT9200                  NO, NOOP THIS REQUEST   ZA16607 23734003
         SPACE                                                          23744003
         BAL   RWRK2,TGT0180            SET UP VTAM ESTAE       ZA16607 23754003
         SPACE                                                          23764003
         LM    RP0,RP1,XSAPRM0          RESTORE PARM REGS       ZA16607 23774003
         LTR   RP1,RP1                  IS THIS A TGET REQUEST  ZA16607 23784003
         BM    TGT0160                  BRANCH TO TGET ROUTINE  ZA16607 23794003
*                                                               ZA16607 23804003
****************************************************************ZA16607 23814003
****                                                        ****ZA16607 23824003
****               BRANCH TO IKTVTPUT HOLDING THE LOCAL LOCK****ZA16607 23834003
****                                                        ****ZA16607 23844003
****************************************************************ZA16607 23854003
*                                                               ZA16607 23864003
         L     RET,VCONVPUT             GET ADDRESS OF IKTVTPUT ZA16607 23874003
         BR    RET                      GOTO IKTVTPUT           ZA16607 23884003
*                                                               ZA16607 23894003
****************************************************************ZA16607 23904003
****                                                        ****ZA16607 23914003
****               BRANCH TO IKTVTGET HOLDING THE LOCAL LOCK****ZA16607 23924003
****                                                        ****ZA16607 23934003
****************************************************************ZA16607 23944003
*                                                               ZA16607 23954003
TGT0160  EQU   *                                                ZA16607 23964003
         L     RET,VCONVGET             GET ADDRESS OF IKTVTGET ZA16607 23974003
         BR    RET                      GOTO IKTVTGET           ZA16607 23984003
         EJECT                                                  ZA16607 23994003
*                                                               ZA16607 24004003
****************************************************************ZA16607 24014003
****                                                        ****ZA16607 24024003
****               SET UP FOR VTAM TGET/TPUT ESTAE          ****ZA16607 24034003
****                                                        ****ZA16607 24044003
****************************************************************ZA16607 24054003
*                                                               ZA16607 24064003
TGT0180  EQU   *                                                ZA16607 24074003
****                                                            ZA16607 24084003
****               RWRK2 CONTAINS RETURN ADDRESS                ZA16607 24094003
****                                                            ZA16607 24104003
         L     RWSA,ASCBASXB            GET ASXB POINTER        ZA16607 24114003
         USING ASXB,RWSA                ASXB ADDRESSABLE        ZA16607 24124003
         L     RWSA,ASXBSPSA            GET WSA VECTOR TABLE    ZA16607 24134003
         DROP  RWSA                     ASXB NOT ADDRESSABLE    ZA16607 24144003
         USING WSAL,RWSA                WSA VECTOR TBL BASE     ZA16607 24154003
         L     RWSA,WSALSTAE            GET ESTAE WORK SAVE ADD ZA16607 24164003
         DROP  RWSA                                             ZA16607 24174003
         MVC   XSAESTAL,ESTAELST        MOVE ESTAE LIST TO WA   ZA16607 24184003
         SPACE 1                                                        24194003
         L     RESTAE,VCONESTE          GET ADDRESS OF SVC'S    ZA16607 24204003
*                                       ESTAE FOR VTAM          ZA16607 24214003
         TM    XSAFLAG,XSATCBFX         SHOULD TCBFX BE RESET   ZA16607 24224003
         BZ    TGT0184                  NO, DON'T RESET         ZA16607 24234003
         SPACE 2                                                        24244003
         ESTAE (RESTAE),TERM=YES,BRANCH=YES,ASYNCH=YES,         ZA16607-24254003
               SVEAREA=(RWSA),PARAM=(RSVRB),MF=(E,XSAESTAL)     ZA16607 24264003
         BR    RWRK2                    RETURN TO CALLING POINT ZA16607 24274003
         SPACE                                                          24284003
TGT0184  EQU   *                                                ZA16607 24294003
         ESTAE (RESTAE),TERM=YES,BRANCH=YES,ASYNCH=NO,          ZA16607-24304003
               SVEAREA=(RWSA),PARAM=(RSVRB),MF=(E,XSAESTAL)     ZA16607 24314003
         BR    RWRK2                    RETURN TO CALLING POINT ZA16607 24324003
*                                                               ZA16607 24334003
         SPACE 2                                                        25900020
*********************************************************************** 25950002
***                                                                     25960002
***                 SET UP FOR TCAM TGET/TPUT ESTAE             ZA16607 25970003
***                                                                     25980002
*********************************************************************** 25990002
TGT0190  EQU   *                                                ZA16607 25990403
****                                                            ZA16607 25990803
****               RWRK2 CONTAINS RETURN ADDRESS                ZA16607 25991203
****                                                            ZA16607 25991603
         L     RWSA,ASCBASXB            GET ASXB POINTER        YS02019 25992002
         USING ASXB,RWSA                ASXB ADDRESSABLE        YS02019 25993003
         L     RWSA,ASXBSPSA            GET WSA VECTOR TABLE    YS02019 25994003
         DROP  RWSA                     ASXB NOT ADDRESSABLE    YS02019 25995003
         USING WSAL,RWSA                WSA VECTOR TBL BASE     YS02019 25996003
         L     RWSA,WSALSTAE            GET ESTAE WORKSAVE ADR  YS02019 25997003
         DROP  RWSA                                             YS02019 25998003
         MVC   XSAESTAL,ESTAELST        MOVE ESTAE LIST TO WA   YS02019 25998103
         SPACE                                                          25999203
         TM    XSAFLAG,XSATCBFX         SHOULD TCBFX BE  RESET  YM05366 26004203
         BZ    TGT0194                  NO, DON'T RESET         ZA16607 26009203
         ESTAE TGT9500,TERM=YES,BRANCH=YES,ASYNCH=YES,          YS02019X26049202
               SVEAREA=(RWSA),PARAM=(RSVRB),MF=(E,XSAESTAL)     YS02019 26049602
         BR    RWRK2                    RETURN TO CALLING POINT ZA16607 26049703
         SPACE 1                                                        26049803
TGT0194  EQU   *                                                YS02019 26055803
         ESTAE TGT9500,TERM=YES,BRANCH=YES,ASYNCH=NO,           YS02019X26062202
               SVEAREA=(RWSA),PARAM=(RSVRB),MF=(E,XSAESTAL)     YS02019 26068202
         BR    RWRK2                    RETURN TO CALLING POINT ZA16607 26071203
         SPACE 3                                                        26075002
         EJECT                                                          34900020
         SPACE 2                                                        35000020
*********************************************************************** 35100020
*****                                                             ***** 35200020
*****               TGET ROUTINE                                  ***** 35300020
*****                                                             ***** 35400020
*********************************************************************** 35500020
TGT0200  EQU   *                                                        35600020
         LTR   RTSB,RTSB                IS THIS A TS TASK       YS02019 35700002
         BZ    TGT9200                  IF NOT MAKE THIS A NOP          35800020
         STH   RTJID,XSAPRMTJ           SAVE TJID                M0094  36600021
         SPACE 2                                                YS02019 36601602
***                                                             YS02019 36602402
***                 GET CMS LOCK, SO TCAM WON'T GO DOWN, AND    YS02019 36603202
***                 SO TSB WILL BE CONSTANT                     YS02019 36604002
***                                                             YS02019 36604802
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*36605602
               RELATED=(TSB,IGC0009C(TGT0340))                  YS02019 36606002
         DROP  RTCX                     SETLOCK DESTROYS 11-14  YS02019 36656002
         LH    RTJID,XSAPRMTJ           GET ASID                YS02019 36706002
         SPACE 1                                                        36920020
***                                                                     36940020
***                 CHECK EXCEPTIONAL CONDITIONS                        36960020
***                                                                     36980020
TGT0210  EQU   *                                                        37000020
         L     RTCX,CVTAQAVT            GET TCX POINTER         YS02019 37002002
         USING IEDQTCX,RTCX                                     YS02019 37004002
         TM    CVTTCMFG,CVTTCRDY        IS TCAM STILL AROUND            37010020
         BNO   TGT6800                  NO, ABORT THIS REQUEST          37020020
         L     RRPT,TCXRPT              GET RPT POINTER AGAIN   YS02019 37020402
         TM    TSBFLG4,TSBCANC          IS USER CANCELLED       YS02019 37025002
         BNZ   TGT6800                  YES, ABORT TGET         YS02019 37027002
         TM    TSBFLG4,TSBHUNG          DID USER HANG UP        YS02019 37027402
         BO    TGT0320                  YES, ENTER IWAIT        YS02019 37027802
TGT0215  EQU   *                                                YS02019 37029002
         LTR   RRPT,RRPT                SEE IF RPT IS THERE     YS02019 37033002
         BZ    TGT6800                  NOT THERE, ABORT REQ    YS02019 37043002
         TM    TCBTSFLG,TCBTIOTG        HAS ATTN BEEN HIT               37050020
         BO    TGT7500                  YES, GIVE ATTN RETURN CODE      37060020
         SPACE 3                                                        37070002
*********************************************************************** 37080002
***                                                                 *** 37090002
***                DETERMINE WHETHER DATA IS AVAILABLE              *** 37092002
***                                                                 *** 37094002
*********************************************************************** 37096002
         L     RBUF,TSBITBFP-K1         TRAILER QUEUE POINTER           37100020
         LA    RBUF,0(,RBUF)            CLEAR FIRST BYTE        YS02019 37200002
         LTR   RBUF,RBUF                ANYTHING ON QUEUE               37300020
         BNZ   TGT0450                  IF DATA GO PROCESS IT           37400020
         L     RBUF,TSBIBFP-K1          INPUT QUEUE POINTER             37500020
         LA    RBUF,K0(R0,RBUF)         CLEAR FIRST BYTE                37600020
         LTR   RBUF,RBUF                IS QUEUE EMPTY                  37700020
         BNZ   TGT0400                  IF NOT PROCESS                  37800020
         SPACE 2                                                        37900020
TGT0220  EQU   *                                                        38000020
***                                                                     38100020
***                 NO DATA AVAILABLE. ASK FOR SOME                     38200021
***                                                                     38300020
         LA    RWRK2,TGT0320            SET RETURN ADDRESS      YS02019 39360002
         SPACE 3                                                YS02019 39363502
TGT0245  EQU   *                                                YS02019 39364002
*********************************************************************** 39364402
***                                                                 *** 39365602
***                 SUBROUTINE TO TPOST TSB TO IEDAYP               *** 39367602
***                                                                 *** 39367702
*********************************************************************** 39367802
         NI    TSBSTAT,OFF-TSBLWAIT     REMOVE PSEUDO-LWAIT     YS02019 39368002
*                                       THAT MIGHT HAVE BEEN    YS02019 39369202
*                                       SET BY TCLEARQ          YS02019 39370402
         LM    RP0,RP1,TSBTPOST         GET TPOSTING FIELD      YS02019 39371602
TGT0250  EQU   *                                                YS02019 39372802
         STM   RP0,RP1,XSAWD6           STORE, TO SET BITS      YS02019 39374002
         LA    RWRK1,XSAWD6             GET ADDRESSABILITY      YS02019 39375202
         USING TSBTPOST,RWRK1           REFERENCES TO TSBTPOST  YS02019 39376402
*                                       WILL REALLY BE TO XSA,  YS02019 39377602
*                                       SINCE DISPLACEMENT IS   YS02019 39378802
*                                       SMALLER                 YS02019 39380002
         TM    TIOCFLG,TIOCSYLW         IS SYSTEM IN LWAIT      YS02019 39381202
         BO    TGT0255                  YES, SKIP               YS02019 39382402
         NI    TSBF1V,OFF-QCBNOBUF      ALLOW INPUT             YS02019 39383602
         OI    TSBF1M,QCBNOBUF          TELL AYP TO CHANGE THIS YS02019 39384802
*                                       BIT                     YS02019 39386002
TGT0255  EQU   *                                                YS02019 39387202
         OI    TSBF1V,QCBTGET           REQUEST DATA            YS02019 39388402
         OI    TSBF1M,QCBTGET           TELL AYP TO CHANGE      YS02019 39389602
         OI    TSBTPFLG,TSBTPQCB+TSBPOSTO TELL AYP WHAT TO DO   YS02019 39390802
         LM    RBUF,RCVT,TSBTPOST       GET NEW BITS IN REG     YS02019 39392002
         DROP  RCVT                                             YS02019 39393202
         DROP  RWRK1                    NOW REFERENCE TSB       YS02019 39394402
         CDS   RP0,RBUF,TSBTPOST        EXCHANGE BIT-SETTINGS   YS02019 39395602
         BNE   TGT0250                  RELOAD IF NO GOOD       YS02019 39396802
         SPACE 3                                                YS02019 39398002
***                                                             YS02019 39399202
***                 TPOST TSB TO IEDAYP, IF TSBPOSTO WAS NOT ON YS02019 39400402
***                 DURING THE COMPARE-AND-SWAP                 YS02019 39401602
***                                                             YS02019 39402802
         L     RCVT,CVTPTR              RESTORE CVT POINTER     YS02019 39406802
         USING CVT,RCVT                                         YS02019 39407202
         LTR   RP0,RP0                  WAS TSBPOSTO ON - NOTE  YS02019 39407302
*                                       THIS TEST SENSITIVE TO  YS02019 39407402
*                                       POSITION OF TSBPOSTO    YS02019 39407502
         BMR   RWRK2                    YES, RETURN TO CALLER   YS02019 39407602
         SPACE 3                                                YS02019 39408802
         L     RTCX,CVTAQAVT            GET TCX POINTER         YS02019 39481402
         USING IEDQTCX,RTCX                                     YS02019 39531402
         L     RWRK,TCXTSI              PTR TO TSINPUT'S QCB    YS02019 39581402
         USING IEDQTSI,RWRK                                     YS02019 39631402
         LA    RWRK,TSITSAP-(QCBSTVTO-IEDQQCB)                  YS02019 39681402
*                                       ADDRESS OF AYP'S 'QCB'  YS02019 39731402
         DROP  RWRK                                             YS02019 39741402
         ST    RWRK,TSBRQCB                                     YS02019 39781402
         LA    RWRK1,TSBRCB             ADDRESS OF ELEMENT      YS02019 39831402
         L     RWRK,TCXREADY            GET OLD HEAD POINTER    YS02019 39881402
TGT0260 EQU    *                                                YS02019 39931402
         ST    RWRK,TSBLINKA            STORE IN LINK FIELD     YS02019 39981402
         MVI   TSBPRI,PRIDESTQ          SET PRIORITY            YS02019 39991402
         CS    RWRK,RWRK1,TCXREADY      PUT NEW ELEM ON QUEUE   YS02019 40031402
         BNE   TGT0260                  IF CHANGED, TRY AGAIN   YS02019 40081402
         SPACE 2                                                YS02019 40131402
***                                                             YS02019 40181402
***                 POST TCAM'S ECB                             YS02019 40191402
***                                                             YS02019 40201402
         SR    RRPT,RRPT                COMPLETION CODE         YS02019 40231402
         LA    RTJID,CVTBRET            'ERRET' ADDRESS         YS02019 40331402
         L     RAVT,TCXASCB             LOAD ASCB OF TCAM       YS02019 40381402
         LR    R0,RTCX                  SAVE TCX POINTER        YS02019 40431402
         L     RTCX,TCXAVT              AVT POINTER             YS02019 40481402
         USING IEDQAVTD,RTCX                                    YS02019 40531402
         LA    RTCX,AVTOSECB            ECB POINTER ** NOTE     YS02019 40581402
*                                       THAT AVT IS NOT REALLY  YS02019 40631402
*                                       ADDRESSABLE **          YS02019 40681402
         DROP  RTCX                                             YS02019 40691402
         O     RTCX,HIGHON              HI-ORDER BIT=XMPOST     YS02019 40731402
         L     RET,CVT0PT01             POST ROUTINE ADDRESS    YS02019 40781402
         BALR  RETURN,RET               GO POST                 YS02019 40831402
         SPACE 2                                                YS02019 40881402
         LR    RTCX,R0                  RESTORE TCX PTR         YS02019 40931402
         USING IEDQTCX,RTCX                                     YS02019 40981402
         LH    RTJID,ASCBASID           RESTORE TJID            YS02019 41031402
         L     RASCB,TSBASCBA           RESTORE ASCB POINTER    YS02019 41081402
         L     RRPT,TCXRPT              RESTORE RPT POINTER     YS02019 41131402
         BR    RWRK2                    RETURN TO MAINLINE      YS02019 48100002
         SPACE 2                                                        49200020
TGT0320  EQU   *                                                        49300020
***                                                                     49810020
***                 ENTER IWAIT IF WAIT OPTION SPECIFIED                49820020
***                                                                     49830020
         TM    XSAOPTNS,MWAIT           WAS 'WAIT' SPECIFIED     M0094  49840021
         BZ    TGT0340                  YES, GO WAIT                    49850020
         LA    RCODE,RC04               NOWAIT RETURN CODE              49860020
         SR    RP1,RP1                  LENGTH OF DATA                  49866020
         B     TGT9000                  GO TO EXIT                      49872020
TGT0340  EQU   *                                                        49880020
***                                                             YS02019 49881002
***            INFORM SYSTEM RESOURCE MANAGER OF WAIT           YS02019 49881502
***                                                             YS02019 49881603
         LA    RP1,0(,RP1)                INDICATE IWAIT TO SRM ZA12514 49881703
         LA    RSAVE,TIOCSAVE           SAVE AREA FOR SYSEVENT  YS02019 49882402
         SYSEVENT TERMWAIT,ASIDL=ASCBASID,ENTRY=BRANCH          YM03948 49882502
         SPACE 2                                                YS02019 49883002
***                                                             YS02019 49883502
***                 SET UP RESUME ENVIRONMENT                   YS02019 49884002
***                                                             YS02019 49884502
         STM   R0,RCODE,TCBGRS          SAVE ALL REGISTERS      YS02019 49885002
         LA    RET,TGT0350              RESUME ADDRESS          YS02019 49885402
         ST    RET,RBOPSW2              SET UP RESUME PSW       YS02019 49886502
         SPACE 2                                                YS02019 49887002
***                                                             YS02019 49887502
***                 BRANCH TO 'STATUS' ROUTINE TO SET UP WAIT.  YS02019 49888002
***                 STATUS WON'T RETURN CONTROL UNTIL DATA HAS  YS02019 49888502
***                 BEEN MADE AVAILABLE.                        YS02019 49889002
***                                                             YS02019 49889502
***      LOCAL LOCK IS HELD AT ENTRY TO STATUS, NO LOCK IS      YS02019 49889902
***      HELD UPON RETURN FROM STATUS                           YS02019 49896602
***                                                                     49896702
         OI    TSBFLG4,TSBIWAIT         REASON FOR NONDISP      YS02019 49896802
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGC0009C(TGT0200))       49899902
         L     RWRK,CVTABEND            SECONDARY CVT POINTER   YS02019 49903002
         USING SCVTSECT,RWRK                                    YS02019 49906102
         LR    RP1,RTCB                 FOR STATUS ROUTINE      YS02019 49909202
         LA    RP0,SDTCB                ENTRY CODE FOR STATUS   YS02019 49912302
         L     RWRK1,SCVTSTAT           BRANCH ENTRY ADDRESS    YS02019 49915402
         LA    RAVT,NDISPBIT            NONDISPATCHABILITY MASK YS02019 49918502
         BALR  RETURN,RWRK1             GO TO STATUS ROUTINE    YS02019 49921602
         SPACE 3                                                YS02019 49924702
***                                                             YS02019 49927802
***                 REOBTAIN LOCKS ON RETURN FROM STATUS        YS02019 49930902
***                                                             YS02019 49934002
TGT0350  EQU   *                                                YS02019 49937102
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                 YS02019*49940202
               RELATED=(TSB,IGG09303(TGT4000),IGC0009C(TGT9100))YS02019 49943302
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                   YS02019*49946402
               RELATED=(TSB,IGG09303(TGT4000),IGC0009C(TGT9100))YS02019 49949502
         B     TGT0210                  RECHECK BFR AVAIL       YS02019 53440002
         SPACE 2                                                        53900020
TGT0400  EQU   *                                                        54000020
*********************************************************************** 54100020
*****                                                             ***** 54200020
*****               SET UP FOR MOVE AND EDIT OF DATA              ***** 54300020
*****                                                             ***** 54400020
*********************************************************************** 54500020
         SPACE 2                                                        54600020
         USING TIOCBUF,RBUF                                             54700020
         TM    BUFFFL2,BUFFFRAG         IS MSG COMPLETE                 54800020
         BO    TGT0220                  IF NOT                          54900020
         SPACE 2                                                        55000020
TGT0450  EQU   *                                                        55100020
***                                                                     55200020
***                                                             YS02019 55300002
***                                                                     55400020
         LA    RP0,EDITCODE             ENTRY CODE                      55500020
         L     RET,TIOCQTIP             BRANCH ENTRY TO QTIP    YS02019 55600002
         STM   RCVT,RTCB,XSAUBFRP       SAVE REG.S 3-4          YS02019 55610002
         STM   RBASE,RTSB,XSAWD6        SAVE REG.S 6-9          YS02019 55620002
         OI    XSAF,XSADMOVE            SHOW DATA MOVEMENT      YS02019 55650002
         BALR  RETURN,RET               GO TO QTIP                      55700020
         NI    XSAF,OFF-XSADMOVE        SHOW MOVE ALL DONE      YS02019 55740002
         LM    RCVT,RTCB,XSAUBFRP       RESTORE REGS 3-4        YS02019 55790002
         LM    RBASE,RTSB,XSAWD6        RESTORE REG.S 6-9       YS02019 55792002
         L     RTCX,CVTAQAVT            RESTORE TCX ADDR        YS02019 55794002
         L     RRPT,TCXRPT-IEDQTCX(,RTCX) RESTORE TIOCRPT ADDR  YS02019 55796002
         SPACE 2                                                        55800020
*********************************************************************** 55900020
***                                                                 *** 56000020
***                 REGISTER CONTENTS AT ENTRY TO QTIP              *** 56100020
***      REG 0 ENTRY CODE    REG 2 TS BFR PTR    REG 3 CVT PTR      *** 56200002
***      REG 4 TCB PTR       REG 5 SVRB PTR      REG 8 ASCB PTR     *** 56300002
***      REG 9 TSB PTR       REG 10 TIOCRPT PTR  REG 11 TCX PTR     *** 56400002
***                                                                 *** 56500020
*********************************************************************** 56600020
         SPACE 2                                                        56700020
***                                                                     56800020
***                 UPON RETURN FROM EDIT CHECK IF SMF IN EFFECT        56900020
***                                                                     57000020
         NC    TCBTCT,TCBTCT            IS SMF UP                       57200020
         BZ    TGT1000                  IF NOT                          57400020
         SPACE 2                                                        57500020
***                                                                     57600020
***                 UPDATE LINE COUNT FOR SMF                           57700020
***                                                                     57800020
         L     RWRK,TCBTCT              GET TCT POINTER                 57850020
         USING SMFTCT,RWRK                                              57900020
         L     RWRK1,TCTLIN             GET INPUT LINE COUNT            58000020
         LA    RWRK1,K1(R0,RWRK1)       ADD ONE TO COUNT                58100020
         ST    RWRK1,TCTLIN             UPDATE COUNT                    58200020
         DROP  RWRK                                                     58300020
         SPACE 2                                                        58400020
TGT1000  EQU   *                                                        58500020
         SPACE 2                                                YS02019 58520002
***                                                             YS02019 58530002
***           INFORM SYSTEM RESOURCE MANAGER OF COMPLETED TGET  YS02019 58540002
***                                                             YS02019 58550002
         STM   RP0,RP1,XSAUBFRP         SAVE QTIP RET CODE & CNT M0094  58900021
         CLI   XSAUBFRP+K3,RC0C         WAS RC FROM QTIP 12 (NOT M0094  59260021
*                                       ALL DATA MOVED)                 59320021
         BNE   TGT1020                  IF ALL DATA MOVED        M0607  59400020
         LA    RWRK1,PARTT              PARTIAL FLAG                    59460020
         SLL   RWRK1,20                 SHIFT TO HI-ORDER               59520020
         OR    RP1,RWRK1                ADD FLAG TO COUNT               59600020
TGT1020  EQU   *                                                        59700020
         LA    RSAVE,TIOCSAVE           SAVE AREA FOR SYSEVENT  YS02019 59720002
         SYSEVENT TGETTPUT,ASIDL=ASCBASID,ENTRY=BRANCH          YS02019 59740002
         SPACE 2                                                        60000020
***                                                                     60100020
***                REMOVE LWAIT IF POSSIBLE                             60200020
***                                                                     60300020
         TM    TSBSTAT,TSBLWAIT         IS USER IN LWAIT                60400020
         BZ    TGT2000                  IF NOT                          60500020
         SR    RWRK1,RWRK1              CLEAR REGISTER                  60600020
         IC    RWRK1,TSBNIBF            NO. OF BFRS ON INPUT Q          60700020
         CH    RWRK1,TIOCRSTH           IF NIBF LTE RSTH, LWAIT         60900020
         BH    TGT2000                  IF LWAIT NOT LEAVABLE           61200020
         NI    TSBSTAT,OFF-TSBLWAIT     SHOW LWAIT REMOVED       M1800  61250021
         LA    RWRK2,TGT2000            RETURN ADDRESS          YS02019 61450002
         TM    TSBFLG3,TSBNOBRK         NOBREAK TERMINAL        YS02019 61550002
         BNO   TGT0245                  TPOST TSB TO UNLOCK KB  YS02019 61650002
         SPACE 2                                                        63700020
TGT2000  EQU   *                                                        63800020
         LM    RP0,RP1,XSAUBFRP         RESTORE CODE AND COUNT   M0094  63900021
         LR    RCODE,RP0                RETURN CODE                     64000020
         NC    TIOCNFBF,TIOCNFBF        ARE THERE ANY FREE TS BUFFERS   64030020
         BZ    TGT9000                  EXIT IF NONE                    64060020
         TM    TIOCFLG,TIOCTJBF+TIOCSYLW+TIOCNOBF                       64100020
*                                       IN ANY OF THESE WAITS           64200020
         BZ    TGT9000                  EXIT IF NOT (OTHERWISE,  M0094  64300021
*                                       XCTL TO IGG09303)               64400002
         ST    RP1,XSAPRM0              SAVE DATA COUNT          M0094  64500021
         ST    RCODE,XSAPRM1            SAVE RETURN CODE         M0094  64600021
         SPACE 2                                                        64700020
*********************************************************************** 64800020
*****                                                             ***** 64900020
*****    BRANCH TO IGG09303 HOLDING BOTH CMS AND LOCAL LOCKS      ***** 64950002
*****                                                             ***** 65100020
*********************************************************************** 65200020
         SPACE 2                                                        65300002
         L     RET,VCON9303             GET IGG09303'S EPA      YS02019 65350002
         BR    RET                      GO TO IGG09303          YS02019 65400002
         SPACE 2                                                        65900020
TGT6800  EQU   *                                                        66000020
***                                                                     66100020
***                 USER HUNG UP RETURN                                 66200020
***                                                                     66300020
         LA    RCODE,RC14               LOAD RETURN CODE                66400020
         B     TGT9000                  GO TO RETURN                    66500020
         SPACE 2                                                        66600020
TGT7000  EQU   *                                                        66700020
***                                                                     66800020
***                 ILLEGAL PARAMETER RETURN                            66900020
***                                                                     67000020
         LA    RCODE,RC10               RETURN CODE                     67100020
         B     TGT9000                  GO TO EXIT                      67200020
         SPACE 2                                                        68200020
TGT7500  EQU   *                                                        68300020
***                                                                     68400020
***                 ATTN HIT RETURN                                     68500020
***                                                                     68600020
         LA    RCODE,RC08               RETURN CODE                     68700020
         SPACE 2                                                        68800020
TGT9000  EQU   *                                                        68900020
***                                                                     69000020
***                 RESET TCB ATTENTION INDR PRIOR TO RETURN            69100020
***                                                                     69200020
         NI    TCBTSFLG,OFF-TCBTIOTG    TURN OFF ATTN INDR              69300020
         TM    XSAFLAG,XSATCBFX         SHOULD WE TURN OFF TCBFX M0094  69380021
         BZ    TGT9100                  IF NOT, DON'T                   69460020
         NI    TCBFLGS1,OFF-TCBFX       ALLOW ASYNCHRONOUS EXITS        69500020
TGT9100  EQU   *                                                        69550020
         SETLOCK RELEASE,TYPE=CMS,RELATED=(TSB,IGC0009C(TGT0350))       69560002
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(TSB,IGC0009C(TGT0350))     69562002
         L     RETURN,XSARETRG          GET RETURN ADDRESS      YS02019 69566002
         BR    RETURN                   RETURN                  YS02019 69574002
         SPACE 2                                                        69700020
*****                                                                   69720020
*****               NOP TGET/TPUT FOR NON-TSO TASKS                     69740020
*****                                                                   69760020
TGT9200  EQU   *                                                        69800020
         SR    RCODE,RCODE              GIVE ZERO RETURN CODE           69900020
         SR    RP1,RP1                  NO DATA MOVED           YM07152 69950002
         B     TGT9000                  EXIT                            70000020
         DROP  RBASE                    MODULE NOT ADDRESSABLE  YS02019 70002002
         SPACE 5                                                        70010002
*********************************************************************** 70050002
***                                                                 *** 70052002
***                 ESTAE EXIT ROUTINE FOR TGET/TPUT                *** 70060002
***                                                                 *** 70070002
***      UPON RECEIVING CONTROL FROM RTM, THE FOLLOWING             *** 70070602
***      CONDITIONS EXIST -                                         *** 70070702
***                                                                 *** 70070802
***      * SUPERVISORY STATE                                        *** 70070902
***      * IN SUPERVISOR'S KEY                                      *** 70073102
***      * NO LOCKS ARE HELD                                        *** 70075002
***                                                                 *** 70076502
***      REGISTER CONTENTS -                                        *** 70078002
***                                                                 *** 70079502
***      REGISTER  0 - RETURN CODE (12 MEANS SDWA NOT AVAILABLE)    *** 70081002
***      REGISTER  1 - ADDRESS OF SDWA                              *** 70082502
***      REGISTER 13 - SAVE AREA                                    *** 70084002
***      REGISTER 14 - RETURN ADDRESS                               *** 70085502
***                                                                 *** 70087002
*********************************************************************** 70088502
TGT9500  EQU   *                                                YS02019 70090002
         BALR  RBASE,R0                 SET UP BASE REGISTER    YS02019 70090402
         USING *,RBASE                  MODULE ADDRESSABLE      YS02019 70090802
         C     R0,NOSDWA                IS SDWA AVAILABLE       YS02019 70092002
         BE    TGT9590                  NO, NOTHING CAN BE DONE YS02019 70094002
         SPACE 1                                                        70094102
         SAVE  (14,12)                  SAVE REGISTERS 14-12    YS02019 70096002
         USING SDWA,RSDWA               SDWA ADDRESSABILITY     YS02019 70098002
         L     RSVRB,SDWAPARM           GET ADDR OF SVRB        YS02019 70098502
         LR    RWRK2,RP1                SAVE SWDA ADDRESS       VS08528 70098902
         SPACE 3                                                        70100502
***                                                                     70104902
***            IF PROGRAM CHECK OCCURRED BECAUSE OF BAD BUFFER          70106902
***            ADDRESS, CHANGE THE COMPLETION CODE TO 15D               70107302
***                                                                     70110102
         TM    XSAF,XSADMOVE            DID DATA MOVE OCCUR     YM05387 70111902
         BZ    TGT9520                  NO, DON'T CHANGE        YM05387 70112702
*                                       COMPLETION CODE         YM05387 70113102
         TM    SDWAERRA,SDWAPCHK        DID PROGRAM CHECK OCCUR YM05387 70113502
         BZ    TGT9520                  NO, DON'T CHANGE        YM05387 70113902
         L     RWRK02,SDWACMPF          GET COMPLETION CODE     YM05387 70114302
         LA    RWRK02,K0(,RWRK02)       CLEAR FLAG BYTE         YM05387 70114402
         SRL   RWRK02,K12               PUT COMPLETION CODE     YM05387 70114502
*                                       IN LOW ORDER            YM05387 70115402
         C     RWRK02,CCODE0C4          CHECK FOR 0C4           YM05387 70115802
         BE    TGT9510                  YES, CHANGE CODE        YM05387 70116202
         C     RWRK02,CCODE0C5          CHECK FOR 0C5           YM05387 70116602
         BE    TGT9510                  YES, CHANGE CODE        YM05387 70117002
         C     RWRK02,CCODE0D0          CHECK FOR 0D0           YM05387 70117102
         BE    TGT9510                  YES, CHANGE CODE        YM05387 70117202
         C     RWRK02,CCODE0D1          CHECK FOR 0D1           YM05387 70117602
         BNE   TGT9520                  NO, NO CHANGE CODE      YM05387 70118002
         SPACE 1                                                        70118102
TGT9510  EQU   *                                                        70118502
         OI    XSAFLAG2,XSA15D          REMEMBER TO CHANGE      YM05387 70118602
*                                       COMPLETION CODE         YM05387 70118702
         SPACE 1                                                        70121202
***                                                             YS02019 70121802
***            IF ASID TPUT DEQUEUE THE ASID                    YS02019 70122402
***                                                             YS02019 70124502
TGT9520  EQU   *                                                YS02019 70127802
         TM    XSAF,XSAIDENQ            IS ASID ENQUEUED        YS02019 70131102
         BZ    TGT9530                  NO, NO NEED TO DEQ      YS02019 70134402
         LA    RP1,XSAENQAD             ADDR OF DEQ WORK AREA   YS02019 70153202
         MVC   XSAENQNM(K12),QNAME      RESET ENQ/DEQ QNAME     YM03998 70163202
         DEQ   (XSAENQNM,XSAPRMTJ,2,SYSTEM),RET=HAVE,MF=(E,(1)) YS02019 70168502
         SPACE 3                                                        70183802
TGT9530  EQU   *                                                YS02019 70199102
         LR    RASCB,RSAVE              SAVE RTM'S SAVE AREA    YM08216 70199202
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,    * GET LOCAL  YM08216-70199302
               RELATED=(TIOCRPT,IGC0009C(TGT9534)) * LOCK       YM08216 70199402
         SPACE 1                                                        70199502
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,      * GET CMS    YM08216-70209402
               RELATED=(TIOCRPT,IGC0009C(TGT9534)) * LOCK       YM08216 70219402
         SPACE 1                                                        70219502
         L     RTCB,CVTPTR              GET CVT ADDRESS         YS02019 70219702
         L     RRPT,CVTAQAVT-CVT(,RTCB) GET TCX ADDRESS         YS02019 70229702
         LA    RRPT,K0(,RRPT)           CLEAR HI ORDER BYTE     YM08216 70231702
         LTR   RRPT,RRPT                IS TCAM UP              YM08216 70233702
         BZ    TGT9534                  NO, TCAM IS GONE        YM08216 70235702
         L     RRPT,TCXRPT-IEDQTCX(,RRPT) GET TIOCRPT ADDRESS   YS02019 70239702
         LTR   RRPT,RRPT                IS TS STILL UP          YM08216 70241702
         BZ    TGT9534                  NO, TS IS GONE          YM08216 70243702
         L     RTCB,CVTTCBP-CVT(,RTCB)  ADDRESS OF TCB WORD     YS02019 70249702
         L     RWRK3,K4(,RTCB)          PASS ABENDING TASK'S    YM08216 70259702
*                                       TCB IN REGISTER 3       YM08216 70295802
         L     RJSCB,PSAAOLD-PSA        GET ASCB ADDRESS        YS02019 70297802
         LH    RWRK02,ASCBASID-ASCB(,RJSCB) GET CALLER'S ASID   YS02019 70298202
         SPACE 2                                                YS02019 70315502
***                                                             YS02019 70321202
***            GO TO QTIP 29 TO CLEAN UP TSB VIA BRANCH ENTRY   YS02019 70326902
***                                                             YS02019 70332602
***            INTERFACE WITH QTIP 29                           YS02019 70338302
***                                                             YS02019 70344002
***            REGISTER  0 HAS ENTRY CODE                       YS02019 70349702
***            REGISTER  2 HAS ASID OF ABENDING TASK            YS02019 70369702
***            REGISTER  3 HAS TCB ADDRESS OF ABENDING TASK     YS02019 70379702
***            REGISTER 14 HAS RETURN ADDRESS                   YS02019 70381702
***            REGISTER 15 HAS QTIP BRANCH ENTRY ADDRESS        YS02019 70383702
***                                                             YS02019 70385702
***            REGISTERS 5 THROUGH 8 ARE PRESERVED ACROSS       YS02019 70387702
***            QTIP 29 CALL                                     YS02019 70388102
***                                                             YS02019 70389702
         LA    R0,CLEANTSB              ENTRY CODE              YS02019 70394102
         L     RWRK1,TIOCQTIP           QTIP BRANCH ADDRESS     YS02019 70394502
         BALR  RETURN,RWRK1             GO TO QTIP 29           YS02019 70395702
         SPACE 3                                                        70395802
***                                                                     70396102
***            UPON RETURN FROM QTIP 29, RESTORE REGISTERS              70396502
***                                                                     70396902
TGT9534  EQU   *                                                YS02019 70397002
         SETLOCK RELEASE,TYPE=CMS,                 * FREE CMS   YS02019-70397102
               RELATED=(TIOCRPT,IGC0009C(TGT9532)) * LOCK       YS02019 70397302
         SPACE 1                                                        70407302
         SETLOCK RELEASE,TYPE=LOCAL,               * FREE LOCAL YS02019-70417302
               RELATED=(TIOCRPT,IGC0009C(TGT9532)) * LOCK       YS02019 70420702
         SPACE 1                                                        70422702
         LR    RSAVE,RASCB              RESTORE RTMS' SAVEAREA  YS02019 70424102
         LR    RSDWA,RWRK2              RESTORE SDWA ADDRESS    YS02019 70427502
         SPACE 3                                                YS02019 70437602
***                                                                     70447702
***            CHANGE THE COMPLETION CODE TO 15D                        70458102
***                                                                     70458502
         TM    XSAFLAG2,XSA15D          SHOULD COMPLETE CODE BE YM05387 70508502
*                                       CHANGED TO 15D          YM05387 70558502
         BZ    TGT9570                  NO, DON'T CHANGE        YM05387 70608502
         LA    RWRK02,CCODE15D          RESET ABEND CODE TO 15D YM05387 70658502
         SPACE 1                                                        70808502
         SETRP RC=0,COMPCOD=((RWRK02),SYSTEM)                   YS02019-70865502
                                        CONTINUE TERMINATION    YS02019 70867502
         B     TGT9580                  READY TO GO BACK TO RTM YM05387 70877502
         SPACE 1                                                YS02019 70899002
TGT9570  EQU   *                                                        70909002
         SETRP RC=0                     CONTINUE TERMINATION    YM05387 70919002
         SPACE 1                                                        70929002
TGT9580  EQU   *                                                        70931002
         LM    RETURN,RTJID,WORD4(RSAVE)   RESTORE REGISTERS    YS02019 70932502
         SPACE 1                                                YS02019 70966002
TGT9590  EQU   *                                                YS02019 70999502
         BR    RETURN                   GO BACK TO RTM          YS02019 71033002
         SPACE 2                                                        71066502
***                                                                     71076502
***            ESTAE LIST                                               71086502
***                                                                     71096502
ESTAELST ESTAE TGT9500,TERM=YES,MF=L                            YS02019 71098502
         SPACE 2                                                        71100020
***                                                                     71200020
***                 CONSTANTS                                           71300020
***                                                                     71400020
VCON9301 DC    V(IGG09301)              ADDR OF IGG09301         Y01018 71460000
VCON9302 DC    V(IGG09302)              ADDR OF IGG09302        YS02019 71470002
VCON9303 DC    V(IGG09303)              ADDR OF IGG09303        YS02019 71480002
VCONASTP DC    V(IKTASTPT)              ADDR OF IKTASTPT        ZA16607 71486003
VCONVGET DC    V(IKTVTGET)              ADDR OF IKTVTGET        ZA16607 71492003
VCONVPUT DC    V(IKTVTPUT)              ADDR OF IKTVTPUT        ZA16607 71498003
VCONESTE DC    V(IKT93EST)              ADDR OF IKT93EST        ZA16607 71504003
USEREXIT DC    V(IKTTMPX1)              TERMINAL CONTROLER EXIT ZA24648 71505003
NOSDWA   DC    F'12'                    CONSTANT                YS02019 71510002
CCODE0C4 DC    X'000000C4'              COMPLETION CODE 0C4     YS02019 71520002
CCODE0C5 DC    X'000000C5'              COMPLETION CODE 0C5     YS02019 71560002
CCODE0D0 DC    X'000000D0'              COMPLETION CODE 0D0     YS02019 71610002
CCODE0D1 DC    X'000000D1'              COMPLETION CODE 0D1     YS02019 71660002
HIGHON   DC    X'80000000'              HI BIT FOR POST         YS02019 71710002
         DS    0F                                               YM03998 71760002
QNAME    DC    CL8'SYSZIGGI'            ENQ/DEQ QNAME           YM03998 71810002
         DC    X'FF000000'              DEQ/ENQ PARM LIST       YM03998 71860002
PATCHREA DC    20F'0'                   PATCH AREA              ZA24648 71910003
         EJECT                                                  YS02019 74100002
         IHAASCB                                                YS02019 74180002
         EJECT                                                  YS02019 74230002
         IHAASXB                                                YS02019 74240002
         EJECT                                                  YS02019 74260002
         IHAASVT                                                YS02019 74340002
         EJECT                                                  YS02019 74420002
         TAVTD                                                  YS02019 74500002
         EJECT                                                  YS02019 74580002
         IKJTIOCB                                               YS02019 74660002
         EJECT                                                  YS02019 74740002
CSCB     DSECT                                                  YS02019 74820002
         IEECHAIN                                               YS02019 74900002
         EJECT                                                  YS02019 74980002
CVT      DSECT                                                  YS02019 75060002
         CVT                                                    YS02019 75140002
         EJECT                                                  YS02019 75220002
         IHAPSA                                                 YS02019 75300002
         EJECT                                                  YS02019 75540002
         TPRIOR                                                 YS02019 75590002
         EJECT                                                  YS02019 75610002
         TQCBD                                                  YS02019 75620002
         EJECT                                                  YS02019 75700002
         IKJRB                                                          75810021
         SPACE 2                                                        75810402
RBOPSW2  EQU   RBOPSW+4                 SECOND HALF OF RBOPSW   YS02019 75812002
         SPACE 2                                                        75814002
***                                                                     75820021
***      EXTENDED SAVE AREA.  THSES STATEMENTS SHOULD FOLLOW            75830021
***      THE MACRO 'IKJRB.'                                             75840021
***                                                                     75850021
         ORG   RBEXSAVE                 START OF SAVE AREA       M0094  75860021
XSAPRM0  DS    0F                       REG 0 AT ENTRY           M0094  75870021
XSAPRMTJ DS    H                        TJID PASSED              M0094  75880021
XSAPRMSZ DS    H                        SIZE PASSED              M0094  75890021
XSAPRM1  DS    0F                       REG 1 AT ENTRY           M0094  75900021
XSAOPTNS DS    X                        USER OPTIONS             M0094  75910021
MASIS    EQU   X'01'                    ASIS OPTION SPECIFIED    M0094  75920021
MCNTRL   EQU   X'02'                    1 MEANS CONTROL          M0094  75930021
*                                                                       75940021
*   BOTH OF THE ABOVE BITS OFF MEANS EDIT OPTION                        75950021
*                                                                       75960021
MBREAK   EQU   X'04'                    BREAKIN SPECIFIED        M0094  75970021
MHOLD    EQU   X'08'                    1 MEANS HOLD             M0094  75980021
MTGET    EQU   X'80'                    1 MEANS TGET REQUESTED   M0094  75990021
MUSERID  EQU   X'40'                    USERID SPECIFIED        YS02019 76000002
MLOWP    EQU   X'20'                    0 HIGHPRI, 1 LOWPRI      M0094  76010021
MWAIT    EQU   X'10'                    1 MEANS NOWAIT           M0094  76020021
         DS    AL3                      REST OF REGISTER ONE     M0094  76030021
XSAWD3   DS    0F                       FOR SAVING REGISTERS     M0094  76040021
XSAFLAG  DS    X                        FLAG PASSED BY 9C TO 01  M0094  76050021
*                                       AND 02                   M0094  76060021
XSATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT   M0094  76070021
         DS    AL3                      REST OF WORD             M0094  76080021
         ORG   XSAWD3+2                 INPUT ED, OUTPUT MOVE    M0094  76090021
XSAUBFRS DS    H                        AMT DATA LEFT TO MOVE    M0094  76100021
XSAUBFRP DS    0F                       LOC DATA LEFT TO MOVE    M0094  76110021
XSAESTAL DS    CL16                     LIST FOR ESTAE MACRO    YS02019 76112002
         ORG   XSAUBFRP+4               USED FOR SAVE AREA WHEN YS02019 76200002
*                                       NOT NEEDED BY ESTAE     YS02019 76210002
XSAWD5   DS    F                        FOR SAVING REGISTERS     M0094  76220021
XSAWD6   DS    F                        FOR SAVING REGISTERS     M0094  76230021
         ORG   XSAWD5                   USE WORDS 5-6 FOR NAME   M0094  76240021
XSAENQNM DS    CL8                      ENQ NAME FOR TJID TPUT   M0094  76250021
XSAWD7   DS    F                        FOR SAVING REGISTERS     M0094  76260021
XSAWD8   DS    F                        FOR SAVING REGISTERS     M0094  76270021
         ORG   XSAWD7                   USE WDS 7-8 FOR ENQ PRMS M0094  76280021
XSAENQAD DS    2F                       WORK AREA FOR ENQ/DEQ    M0094  76290021
XSAUSERP DS    0F                       PTR TO USER ID, IF PRES YS02019 76292002
XSAWD9   DS    F                        FOR SAVING REGISTERS     M0094  76300021
XSARETRG DS    0F                       FOR SAVING RETURN ADDR  YS02019 76302002
XSAWD10  DS    F                        FOR SAVING REGISTERS     M0094  76310021
         DS    CL1                      RESERVED                YS02019 76312002
XSAUSERK DS    CL1                      KEY OF TGET CALLER      YS02019 76314002
XSARC    DS    H                        RETURN CODE SAVE AREA   YS02019 76320002
XSATJID  DS    H                        CALLER'S TJID            M0094  76330021
XSAFLAG2 DS    X                        FLAGS                   YM05387 76340002
XSAATR   EQU   X'80'                    NEXT CHAR IN TS BUFFER   S22028 76344002
*                                       IS A 3270 ATTRIBUTE BYTE        76346002
XSABFRAL EQU   X'40'                    TIOC BUFFER HAS BEEN    YM05387 76346402
*                                       ALLOCATED               YM05387 76346802
XSA15D   EQU   X'20'                    CHANGE COMPLETTION TO   YM05387 76347202
*                                       15D                     YM05387 76347602
*                  NEXT 5 BITS UNUSED                           YM05387 76348002
XSAF     DS    X                        FLAGS USED BY TPUT. INI- M0094  76350021
*                                       TIALIZED FROM XSAFLAG.          76360021
HSW      EQU   X'80'                    HEADER BFR DONE          M0094  76370021
PSW      EQU   X'40'                    NEED TO TPOST QCB        M0094  76380021
*SATCBFX EQU   X'20'                    TURN OFF TCBFX AT EXIT          76390021
OSW      EQU   X'10'                    TSBOWIP TURNED ON BY US  M0094  76400021
*                                       (NOT SOME OTHER TPUT)           76410021
XSADMOVE EQU   X'08'                    DATA IS MOVING          YS02019 76420002
XSAAUTH  EQU   X'04'                    USER IS AUTHORIZED      YS02019 77420002
XSAIDENQ EQU   X'02'                    ASID TPUT ASID ENQUEUED YS02019 77470002
XSAPARTO EQU   X'01'                    QCBPARTO IS SET ON      YM01246 77520002
         EJECT                                                  YS02019 78420002
         IHASCVT                                                YS02019 79420002
         EJECT                                                  YS02019 80420002
         IKJTCB                                                 YS02019 81420002
         EJECT                                                  YS02019 82420002
         IEFTCT                                                 YS02019 83420002
         EJECT                                                  YS02019 84420002
         TTCXD                                                  YS02019 85420002
         IKJTIOCP                                               YS02019 86420002
         EJECT                                                  YS02019 87420002
         IKJTSB EXT=YES,LIST=YES                                YS02019 88420003
         EJECT                                                  YS02019 89420002
         IKTTCAST                                               ZA16607 89720003
         EJECT                                                  ZA16607 90020003
         TTSID                                                  YS02019 90420002
         EJECT                                                  YS02019 90470002
         IHAWSAVT                                               YS02019 90520002
         EJECT                                                  YS02019 90570002
         IHASDWA                                                YS02019 90620002
         END                                                            91420002
