         TITLE 'IGC0110D - TCAM TERMINAL INPUT SCANNER'                 00100022
IGC0110D CSECT                                                          00200022
*A000000,999999                                                @Y16XAR0 00250000
*C406000                                                         SI2024 00300000
*D166000-170000                                                 OY03834 00300105
*C246000                                                       @ZA02642 00340158
*C165000                                                       @XA09783 00340258
*A157600                                                       @OX11950 00340358
*D160000                                                       @OX11950 00340458
*C168000                                                       @OY11970 00340558
*A400000,381000                                                @OZ09297 00342500
*D381000-384000                                                @OZ09297 00344500
*D386000-387000                                                @OZ09297 00346500
*A006000,022000,025000,324000,568500                           @Y17XARX 00350500
*C009000,025000,041000                                         @Y17XARX 00360500
*D010000,024000,046000-048000,057000-060000                    @Y17XARX 00370500
*********************************************************************** 00400022
*                                                                     * 00500022
* MODULE NAME = IGC0110D (TCAM, OPERATOR CONTROL)              @Y17XARX 00510000
*                                                              @Y17XARX 00520000
* DESCRIPTIVE NAME = TERMINAL INPUT SCANNER                    @Y17XARX 00530000
*                                                              @Y17XARX 00540000
* COPYRIGHT = NONE                                             @Y17XARX 00550000
*                                                                     * 00800022
* STATUS = VERSION 10.0                                        @Y17XARX 00900000
*                                                                     * 01100022
*FUNCTION -                                                           * 01200022
*        THIS MODULE GETS CONTROL ON TERMINAL INPUT TO OPERATOR       * 01300022
*        CONTROL.  IT SCANS FOR THE VERB AND VALIDITY CHECKS IT       * 01400022
*        AGAINST A VERB TABLE.  AFTER THE VERB IS CHECKED, THE JOBNAME* 01500022
*        ID IS CHECKED ON THE MODIFY COMMAND.  THE OPERANDS OF THE    * 01600022
*        DATA ARE THEN SCANNED AND THE DATA MOVED FROM BUFFER UNITS   * 01700022
*        TO THE RESIDENT WORK AREA.  WHEN THE DATA HAS BEEN MOVED, ALL* 01800022
*        UNITS OF THE BUFFER EXCEPT THE FIRST ARE PLACED IN THE OPC   * 01900022
*        FREE POOL.  THIS MODULE ALSO CHECKS FOR THE COMMAND CANCEL   * 02000022
*        INDICATION BY CHECKING FOR THE OP CONTROL CHARACTERS         * 02100022
*        BEING REPEATED AFTER THE MESSAGE.                            * 02200022
*        THIS MODULE CHECKS FOR INPUT THAT FLOWS ON SSCP-LU    @Y17XARX 02220000
*        SESSION.   IF SO, OCSSCP IS SET FOR IGC0710D TO       @Y17XARX 02240000
*        INTERFACE WITH SSCP CORRECTLY AFTER COMPLETION OF     @Y17XARX 02260000
*        COMMAND.                                              @Y17XARX 02280000
*                                                                     * 02300022
* NOTES = COMMUNICATIONS BETWEEN VARIOUS TRANSCIENT MODULES    @Y17XARX 02307000
* IS PRIMARILY THROUGH THE OPERATOR CONTROL AVT.               @Y17XARX 02314000
*        DEPENDENCIES = NONE                                   @Y17XARX 02321000
*        RESTRICTIONS = NONE                                   @Y17XARX 02328000
*        REGISTER CONVENTIONS = OPERATOR CONTROL               @Y17XARX 02335000
*        PATCH LABEL = ZAPS                                    @Y17XARX 02342000
*                                                              @Y17XARX 02349000
* MODULE TYPE = PROCEDURE                                      @Y17XARX 02356000
*        PROCESSOR = ASSEMBLER                                 @Y17XARX 02363000
*        MODULE SIZE = 1300 BYTES                              @Y17XARX 02370000
*        ATTRIBUTES = REFRESHABLE,DISABLED,TRANSIENT(TYPE 4),  @Y17XARX 02377000
*        SUPERVISOR MODE,REUSABLE                              @Y17XARX 02384000
*                                                              @Y17XARX 02391000
* ENTRY POINT = IGC0110D                                       @Y17XARX 02500000
*        PURPOSE = SEE FUNCTION                                @Y17XARX 02530000
*        LINKAGE = XCTL                                        @Y17XARX 02560000
*                                                                     * 02600022
*INPUT -                                                              * 02700022
*        POINTER TO THE OPERATOR CONTROL AVT WITH THE ADDRESS OF THE  * 02800022
*        BUFFER IN THE AVT 'OPCCOPCE' FIELD.                          * 02900022
*                                                                     * 03000022
*OUTPUT -                                                             * 03100022
*        THE RESIDENT WORK AREA CONTAINS THE COMMAND CODE, THE DATA   * 03200022
*        LENGTH, AND THE OPERATION DATA FOR THE COMMAND.              * 03300022
*                                                                     * 03400022
*EXTERNAL REFERENCES                                                  * 03500022
*        SVC 7(XCTL)                                                  * 03600022
*                                                                     * 03700022
*EXITS-NORMAL -- IGC0710D,IGCR010D,IGCV010D,IGCD010D,IGCH010D,IGCZ010D* 03800022
*        IGCM010D                                                     * 03900022
*                                                                     * 04000022
* EXIXTS-ERROR = IGC0010D,IGC0310D                             @Y17XARX 04100000
*                                                                     * 04200022
*TABLES/WORKAREAS -                                                   * 04300022
*        TCAM AVT, OP CONTROL AVT, VERBTBL, XCTLTBL                   * 04400022
*                                                                     * 04500022
*CHARACTER CODE DEPENDENCY                                            * 04900022
*        THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL        * 05000022
*        REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS        * 05100022
*        EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE CODING     * 05200022
*        HAS BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER          * 05300022
*        CONSTANTS, BY REASSEMBLY WILL RESULT IN A CORRECT MODULE     * 05400022
*        FOR THE NEW DEFINITION.                                      * 05500022
*                                                                     * 05600022
*        THIS IS A MODULE RE-WRITE OF IGC0110D AS OF OS/TCAM LEVEL II * 06100022
*********************************************************************** 06200022
         EJECT                                                          06300022
*                           E Q U A T E S                               06400022
         SPACE                                                          06500022
RZERO    EQU   0                       PARAMETER REGISTER               06600022
RPARM    EQU   1                       PARAMETER REGISTER               06700022
RUNITNO  EQU   1                        NO. OF UNITS IN BUFFER          06800022
ROPCAVT  EQU   2                       POINTERTTO OPC AVT               06900022
ROPCE    EQU   3                        POINTER TO ELEMENT              07000022
RAVT     EQU   4                       POINTER TO TCAM AVT              07100022
RSCAN    EQU   5                       POINTER FOR SCANNING UNITS       07200022
RWORKA   EQU   6                       POINTER TO RESIDENT WORKAREA     07300022
RPUT     EQU   7                       ADDRESS OF WHERE TO PLACE DATA   07400022
RWORK    EQU   8                       WORK REGISTER                    07500022
RSTART   EQU   9                       BEGINNING OF SEARCH              07600022
RPREFIX  EQU   10                      POINTER TO BUFFER                07700022
RUNIT    EQU   11                      POINTER TO CURRENT UNIT          07800022
RBASE    EQU   12                      BASE REGISTER                    07900022
RRET     EQU   14                      RETURN REGISTER                  08000022
RREMAIN  EQU   15                      COUNT OF BYTES IN BUFFER         08100022
RBRNCH   EQU   15                      BRANCH TO SUBROUTINES REG        08200022
         SPACE 2                                                        08300022
AL0      EQU   0                       LENGTH IN EXECUTED INSTRUCTIONS  08400022
AL1      EQU   1                       LENGTH OF 1 FOR MOVE             08500022
AL2      EQU   2                       LENGTH OF 2                      08600022
AL4      EQU   4                       LENGTH OF 4            @ZM48777  08650011
AL7      EQU   7                       LENGTH OF SEVEN FOR COMAPRE      08700022
AL8      EQU   8                       LENGTH OF EIGTH                  08800022
CANCELSW EQU   8                       CANCEL SEARCH IN PROGRESS        08900022
COMMA    EQU   X'6B'                   EBCDIC COMMA                     09000022
CURRBYTE EQU   0                       BYTE NOW BEING CHECKED           09100022
EIGHT    EQU   8                        VALUE 8                  S22024 09200000
ENDBLOCK EQU   X'26'                   EOB                              09300022
ENDCHAIN EQU   2                        END OF TIC FIELDS               09400022
ENDTRANS EQU   X'37'                   EOT                              09500022
ENDTXT   EQU   X'03'                   ETX                              09600022
EQUAL    EQU   8                       BRANCH ON EQUAL                  09700022
IDSW     EQU   4                        ID PROCESSING IN PROGRESS       09800022
LOW      EQU   4                        VALUE 4                  S22024 09900000
MODCMND  EQU   X'44'                   CODE FOR MODIFY COMMAND          10000022
MSG18    EQU   18                      ERROR MESSAGE NO, 18             10100022
NEWLINE  EQU   X'15'                   NEW LINE AFTER COMMAND           10200022
OFF00    EQU   0                       ZERO OFFSET                      10300022
OFF02    EQU   2                       OFFSET 2 FOR MOVE                10400022
OFF03    EQU   3                        VALUE 3                  S22024 10500000
OFF07    EQU   7                        OFFSET SEVEN                    10600022
OFF08    EQU   8                       LOAD OFFSET                      10700022
OFF09    EQU   9                       MOVE OFFSET                      10800022
OFF0A    EQU   10                      MOVE OFFSET                      10900022
OFF10    EQU   16                      LOAD OFFSET                      11000022
ON       EQU   1                       BRANCH IF BIT IS ON              11100022
ONE      EQU   1                        VALUE 1                  S22024 11200000
QUOTE    EQU   X'7D'                   EBCDIC QUOTE                     11300022
QUOTSW   EQU   X'20'                   INDICATES QUOTE IN DATA          11400022
RETCARR  EQU   X'0D'                   CARRIAGE RETURN AFTER DATA       11500022
TIOT     EQU   12                      TIOT OFFSET IN TCB               11600022
TWELVE   EQU   12                       VALUE 12                 S22024 11700000
VERBFLAG EQU   X'10'                   VERB CHECKING IN PROGRESS        11800022
ERR18    EQU   X'08'                    VALUE 08                 S22024 11900000
         TITLE 'IGC0110D - VERB CHECK ROUTINE'                          12000022
*********************************************************************** 12100022
*                                                                     * 12200022
*        THIS ROUTINE FIRST LOCATES THE LAST BUFFER UNIT POSTED TO    * 12300022
*        OPERATOR CONTROL AND SETS X'02' IN THE LOW BYTE OF THE PRFTIC* 12400022
*        FIELD FOR THAT UNIT.  THIS IS LATER USED WHEN THE UNITS ARE  * 12500022
*        PLACED IN THE OPC UNIT POOL.  A CHECK IS THEN MADE IN THE    * 12600022
*        LCB FOR THE INPUT TERMINAL TO DETERMINE WHETHER OR NOT IT WAS* 12700022
*        A BSC TERMINAL.  IF SO, THE OCBSC FLAG IS SET IN THE ELEMENT.* 12800022
*        THE INPUT UNITS ARE THEN SCANNED FOR THE COMMAND VERB.       * 12900022
*        WHEN FOUND THE VERB IS PLACED IN THE WORKAREA AND VERIFIED   * 13000022
*        USING THE TABLE LOCATED IN THIS MODULE.  THE XCTL MODULE NAME* 13100022
*        IS SET IF THE VERB IS GOOD.  AN ERROR MESSAGE 'INVALID       * 13200022
*        COMMAND' IS GENERATED BY XCTL TO IGC0310D FOR INCORRECT VERBS* 13300022
*********************************************************************** 13400022
         SPACE                                                          13500022
         USING IEDQAVTD,RAVT            AVT ADDRESSABILITY              13600022
         USING IEDQLCB,RWORK            LCB ADDRESSABILITY              13700022
         USING IEDQPRF,RPREFIX          PRF ADDRESSABILITY              13800022
         USING IEDQOPCD,ROPCAVT         OPCD ADDRESSABILITY             13900022
         USING IEDQOPCE,ROPCE      ELEMENT ADDRESSABILITY               14000022
         BALR  RBASE,RZERO              SET UP ADDRESSABILITY           14100022
         USING *,RBASE                                                  14200022
IGC0110D IEDHJN SKIPID                                                  14300022
         LR    ROPCAVT,RPARM       SET BASE FOR OPC AVT                 14400022
         L     RAVT,OPCAVTPT       BASE FOR TCAM AVT                    14500022
         L     RPREFIX,OPCCOPCE         GET FIRST BUFFER POINTER        14600022
         NI    OPCFLAG2,AVTEFF-ERR18    CLEAR ERR SWITCH                14700022
NOTLAST  EQU   *                                                        14800022
         LR    RUNIT,RPREFIX            SAVE FIRST UNIT IN BUFFER ADDR  14900022
         SR    RWORK,RWORK              CLEAR FOR UNIT COUNT            15000022
         IC    RWORK,PRFNBUNT           GET UNITS IN THIS BUFFER        15100022
TICLOOP  EQU   *                                                        15200022
         LR    ROPCE,RPREFIX            SAVE LAST UNIT POINTER          15300022
         L     RPREFIX,PRFTIC           GET UNIT TIC FIELD              15400022
         BCT   RWORK,TICLOOP            LOOP UNTIL ALL UNITS CHECKED    15500022
         SPACE                                                          15600022
         LA    RRET,EXIT                SET EXIT ADDRESS         S22024 15700022
         MVC   OPCLDNME+OFF03(AL2),IGC00 SET MODULE NAME         S22024 15730022
         LR    RPARM,RUNIT              SAVE ELEMENT FOR FREEBFR RTN    15760022
         MVC   PRFTIC-IEDQPRF(AL4,ROPCE),INVALTIC   SET END    @ZM48777 15770011
*                                                   OF UNITS   @ZM48777 15776011
         TM    PRFSTAT1-IEDQPRF(RPARM),PRFNHDRN HEADER           S22024 15790022
         BO    TEXTBFR                  NO, BRANCH TO RETURN ALL S22024 15820022
*                                       TEXT BFRS TO FREE POOL   S22024 15850022
         SPACE                                                          15900022
         L     RUNIT,OPCCOPCE      POINT TO INPUT BUFFER                16100022
         LR    ROPCE,RUNIT              GET FIRST UNIT POINTER          16200022
         L     RWORK,PRFLCB-AL1-IEDQPRF(RUNIT) GET LCB ADDRESS          16300022
         MVI   OCFLAG,AVTEZERO          CLEAR FLAGS                     16400022
         L     RBRNCH,OPPOLSTP          SETUP FOR POLLSTOP     @YM09009 16688000
         BALR  RRET,RBRNCH              GOTO POLLSTOP          @YM09009 16694000
         SPACE                                                          16694400
         TM    AVTSAVTF,AVTVTMCP   SAVT PRESENT                @YM09063 16694800
         BNO   SAVELCB             BRANCH NO                   @YM09063 16695200
         SPACE                                                          16695600
         L     RBRNCH,AVTSAVTP     SAVT ADDRESS                @YM09063 16696000
         USING IEDNSVTD,RBRNCH                                 @YM09063 16696400
         CLC   PRFDEST-IEDQPRF(2,ROPCE),SAVTSCPT  DEST=SSCP    @YM09063 16696800
         BNE   SAVELCB             BRANCH NO                   @YM09063 16697200
         SPACE                                                          16697600
         OI    OCFLAG,OCSSCP       PASS INFO TO 0710D          @YM09063 16698000
         DROP  RBRNCH                                          @YM09063 16698400
SAVELCB  EQU   *                                               @YM09063 16698800
         ST    RWORK,OCMODNME           SAVE LCB ADDRESS       @YM09063 16700000
* THE LCB ADDRESS IS LEFT INVALID FOR IEDVOFF TO AVOID        @OY11970* 16800058
* GETTING MESSAGE IED013I.                                    @OY11970* 16900058
         BAL   RRET,SETPOINT       SET STARTING SCAN POINTER            17100022
         SPACE                                                          17200022
         MVI   OCOPTCDE,AVTEZERO        CLEAR OP CODE                   17300022
         OI    OPCFLAG1,VERBFLAG   INDICATE VERB/ID PROCESSING          17400022
         BAL   RWORKA,FINDDATA          FIND SOMETHING BESIDES A COMMA  17500022
         SPACE                                                          17600022
FINDEND  EQU   *                                                        17700022
         LA    RSCAN,ONE(RSCAN)    POINT TO NEXT BYTE                   17800022
         BAL   RRET,CHKLOCAT       CHECK FOR ENDS                       17900022
         SPACE                                                          18000022
         CLI   OFF00(RSCAN),AVTEBLNK CHARACTER A BLANK?                 18100022
         BNE   FINDEND             NO, CONTINUE SEARCH FOR END          18200022
         SPACE                                                          18300022
         BAL   RRET,MOVEEND        MOVE LAST OF DATA                    18400022
         LA    RRET,VERBNG              SET RETURN FROM ERR SET         18500022
         CH    RWORK,AVTHA7        COUNT GREATER THAN SEVEN?            18600022
         BH    SETERR18                 GO SET ERROR INDICATOR          18700022
         SPACE                                                          18800022
         LA    RSTART,VERBTBL      POINT TO GOOD VERB TABLE             18900022
CHEKVERB EQU   *                                                        19000022
         CLC   OFF08(AL7,RWORKA),OFF00(RSTART) GOOD COMMAND?            19100022
         BE    VERBOK              MATCH, WE HAVE GOOD VERB             19200022
         SPACE                                                          19300022
         CLC   OFF08(AL2,RWORKA),OFF07(RSTART) CHECK SINGLE CHAR VERB   19400022
         BE    VERBOK              MATCH, BRANCH FOR GOOD VERB          19500022
         SPACE                                                          19600022
         LA    RSTART,TWELVE(RSTART) POINT TO NEXT TABLE ENTRY          19700022
         CLI   OFF00(RSTART),AVTEFF END OF TABLE?                       19800022
         BNE   CHEKVERB            NO, CONTINUE CHECKING                19900022
         SPACE                                                          20000022
         B     SETERR18                 GO SET ERROR INDICATOR          20100022
         SPACE                                                          20200022
VERBOK   EQU   *                                                        20300022
         MVC   OCOPTCDE(AL1),OFF09(RSTART) SAVE OPERATION CODE          20400022
         MVC   OPCLDNME+OFF03(AL2),OFF0A(RSTART) SET NEXT MODULE NAME   20500022
VERBNG   EQU   *                                                        20600022
         NI    OPCFLAG1,AVTEFF-VERBFLAG CLEAR VERB SCAN INDICATOR       20700022
         TITLE 'IGC0110D - ID CHECKING ROUTINE'                         20800022
*********************************************************************** 20900022
*                                                                     * 21000022
*        THIS ROUTINE CHECK TO SEE IF THE INPUT WAS A MODIFY COMMAND. * 21100022
*        IF SO, THIS CODE IS EXECUTED TO LOCATE AND VERIFY            * 21200022
*        THE ID ENTERED WITH THE JOBNAME OR PROCNAME IN THE TCAM TIOT.* 21300022
*        'INVALID COMMAND' ERROR MESSAGE IS GENERATED FOR BAD ID.     * 21400022
*                                                                     * 21500022
*********************************************************************** 21600022
         SPACE                                                          21700022
         BAL   RWORKA,FINDDATA          FIND SOMETHING BESIDES A COMMA  21800022
         SPACE                                                          21900022
         CLI   OCOPTCDE,MODCMND    MODIFY COMMAND?                      22000022
         BNE   PROCOP              NO, DO NOT CHECK JOBNAME             22100022
         SPACE                                                          22200022
         OI    OPCFLAG1,IDSW            INDICATE ID PROCESSING          22300022
LOCCOMMA EQU   *                                                        22400022
         LA    RSCAN,ONE(RSCAN)    POINT TO NEXT DATA BYTE              22500022
         BAL   RRET,CHKLOCAT       CHECK CROSS UNIT DATA                22600022
         SPACE                                                          22700022
         CLI   OFF00(RSCAN),COMMA       COMMA FOUND?                    22800022
         BE    GOODDEL                  BYPASS ERROR SET                22900022
         CLI   OFF00(RSCAN),AVTEBLNK    CHECK FOR DELIMETER             23000022
         BH    LOCCOMMA                 GT THAN BLANK                   23100022
         OI    OPCFLAG2,ERR18           SET ERROR SWITCH                23200022
GOODDEL  EQU   *                                                        23300022
         SPACE                                                          23400022
         BAL   RRET,MOVEEND        MOVE LAST OF DATA TO WORKAREA        23500022
         SPACE                                                          23600022
         LA    RRET,GOODID              SET RETURN FROM ERROR SET       23700022
         CH    RWORK,OPCHA8        LONGER THAN EIGHT BYTES              23800022
         BH    SETERR18                 GO SET ERROR INDICATOR          23900022
         SPACE                                                          24000022
         L     RWORK,AVTTCB        PICK UP TCAM TCB POINTER             24100022
         L     RWORK,TIOT(RWORK)   PICK UP TIOT ADDRESS                 24200022
         CLC   OFF08(AL8,RWORKA),OFF00(RWORK) CHECK JOBNAME             24300022
         BE    GOODID              MATCH, VALID SO FAR                  24400022
         SPACE                                                          24500022
         CLC   OFF08(AL8,RWORKA),OFF08(RWORK)                  @ZA02642 24600058
         BNE   SETERR18                 GO SET ERROR INDICATOR          24700022
         SPACE                                                          24800022
GOODID   EQU   *                                                        24900022
         BAL   RWORKA,FINDDATA          FIND SOMETHING BESIDES A COMMA  25000022
         SPACE                                                          25100022
         OI    OPCFLAG1,CANCELSW        SET CANCEL FLAG                 25200022
         BAL   RRET,MOVEEND             MOVE LAST OF DATA TO W/A        25300022
         NI    OPCFLAG1,AVTEFF-IDSW-CANCELSW CLEAR ID AND CANCEL FLAG   25400022
         B     PROCOP              PROCESS OPTIONS                      25500022
         TITLE 'IGC0110D - OPERAND DATA SCAN AND MOVE ROUTINE'          25600022
*********************************************************************** 25700022
*                                                                     * 25800022
*        THIS ROUTINE SCANS THE INPUT BUFFERS FOR DATA AND PLACES     * 25900022
*        THAT DATA IN THE RESIDENT WORKAREA FOR LATER PROCESSING      * 26000022
*        BY A COMMAND DEPENDENT MODULE.                               * 26100022
*                                                                     * 26200022
*********************************************************************** 26300022
         SPACE                                                          26400022
LOCATEND EQU   *                                                        26500022
         LA    RSCAN,ONE(RSCAN)    POINT TO NEXT BYTE OF DATA           26600022
         BAL   RRET,CHKLOCAT       INSURE GOOD POINTER                  26700022
         SPACE                                                          26800022
PROCOP   EQU   *                                                        26900022
         CLI   CURRBYTE(RSCAN),QUOTE CURRENT BYTE A QUOTE               27000022
         BH    LOCATEND            GREATER, CONTINUE SEARCH             27100022
         SPACE                                                          27200022
         BL    CHEKBLNK            NO, LESS THAN '7D', CHECK DELIMITER  27300022
         SPACE                                                          27400022
         TM    OPCFLAG1,QUOTSW     PREVIOUS QUOTE FOUND?                27500022
         BO    PREVQUOT            YES, CHECK FOR DOUBLE QUOTES         27600022
         SPACE                                                          27700022
         OI    OPCFLAG1,QUOTSW     SET QUOTE FOUND SW                   27800022
         B     LOCATEND            CONTINUE SEARCH FOR END OF DATA      27900022
         SPACE                                                          28000022
PREVQUOT EQU   *                                                        28100022
         LA    RSCAN,ONE(RSCAN)    POINT TO NEXT BYTE                   28200022
         BAL   RRET,CHKLOCAT       CHECK FOR IN UNIT                    28300022
         SPACE                                                          28400022
         CLI   CURRBYTE(RSCAN),QUOTE NEXT BYTE ALSO A QUOTE             28500022
         BE    LOCATEND            CONTINUE SEARCH                      28600022
         SPACE                                                          28700022
         B     LASTCHAR            NO, CHECK FOR MORE DATA              28800022
         SPACE                                                          28900022
CHEKBLNK EQU   *                                                        29000022
         TM    OPCFLAG1,QUOTSW     ONE QUOTE FOUND?                     29100022
         BO    LOCATEND            YES, DO NOT CHECK OTHER CHARACTERS   29200022
         SPACE                                                          29300022
LASTCHAR EQU   *                                                        29400022
         CLI   CURRBYTE(RSCAN),AVTEBLNK BLANK FOUND IN DATA             29500022
         BH    LOCATEND            NO, CONTINUE SEARCH                  29600022
         SPACE                                                          29700022
         BE    CANCANCL            YES, CHECK FOR CANCEL CHARACTERS     29800022
         SPACE                                                          29900022
         CLI   CURRBYTE(RSCAN),ENDTRANS EOT LOCATED?                    30000022
         BH    LOCATEND            NO, CONTINUE SEARCH FOR END          30100022
         SPACE                                                          30200022
         BE    ENDMSG              YES, WE HAVE THE END                 30300022
         SPACE                                                          30400022
         CLI   CURRBYTE(RSCAN),ENDBLOCK EOB OR ETB FOUND?               30500022
         BH    LOCATEND            NO, CONTINUE                         30600022
         SPACE                                                          30700022
         BE    ENDMSG              YES, END IS FOUND                    30800022
         SPACE                                                          30900022
         CLI   CURRBYTE(RSCAN),NEWLINE NEW LINE FOUND?                  31000022
         BH    LOCATEND            NO, CONTINUE SEARCH FOR END          31100022
         SPACE                                                          31200022
         BE    ENDMSG              YES, END FOUND                       31300022
         SPACE                                                          31400022
         CLI   CURRBYTE(RSCAN),RETCARR CHECK FOR CARRIAGE RETURN        31500022
         BH    LOCATEND            NO, CONTINUE SEARCH                  31600022
         SPACE                                                          31700022
         BE    ENDMSG              YES, END FOUND                       31800022
         SPACE                                                          31900022
         CLI   CURRBYTE(RSCAN),ENDTXT ETX FOUND?                        32000022
         BNE   LOCATEND            NO, CONTINUE SCANNING                32100022
         SPACE                                                          32200022
ENDMSG   EQU   *                                                        32300022
         BAL   RRET,MOVEEND        MOVE REMAINING CHARACTERS            32400022
         USING IEDQPRF,RPREFIX     REESTABLISH PRF ADDRESS     @YM05661 32490000
         B     FREEBUF             FREE EXTRA BUFFERS                   32600022
         SPACE                                                          32700022
CANCANCL EQU   *                                                        32800022
         NI    OPCFLAG1,AVTEFF-QUOTSW CLEAR QUOTE FLAG                  32900022
         TITLE 'IGC0110D - CANCEL CHECKING ROUTINE'                     33000022
*********************************************************************** 33100022
*                                                                     * 33200022
*        THIS ROUTINE CHECKS FOR THE CONTROL CHARACTERS BEING REPEATED* 33300022
*        AFTER THE INPUT COMMAND.  THIS INDICATES THE COMMAND WAS     * 33400022
*        CANCELLED AND UNITS ARE FREED.                               * 33500022
*                                                                     * 33600022
*********************************************************************** 33700022
         SPACE                                                          33800022
         BAL   RRET,MOVEEND        PLACE REST OF DATA IN WORKAREA       33900022
         SPACE                                                          34000022
         OI    OPCFLAG1,CANCELSW   INDICATE CANCEL PROCESSING           34100022
         BAL   RWORKA,FINDDATA          LOCATE NEXT NON-BLANK           34200022
         SPACE                                                          34300022
         LA    RWORKA,EIGHT        SET COUNTER                          34400022
CANSCAN  EQU   *                                                        34500022
         SPACE                                                          34600022
         LA    RSCAN,ONE(RSCAN)    BUMP POINTER BY ONE                  34700022
         BAL   RRET,CHKLOCAT       CHECK CROSS BUFFER UNIT              34800022
         SPACE                                                          34900022
         CLI   CURRBYTE(RSCAN),C' ' BLANK FOUND?                        35000022
         BNH   ENDSCAN             BRANCH EQUAL OR LESS                 35100022
         SPACE                                                          35200022
         BCT   RWORKA,CANSCAN      GET EIGHT CHARACTERS                 35300022
         SPACE                                                          35400022
ENDSCAN  EQU   *                                                        35500022
         BAL   RRET,MOVEEND        MOVE REMAINING DATA                  35600022
         SPACE                                                          35700022
         NI    OPCFLAG1,AVTEFF-QUOTSW-VERBFLAG-CANCELSW-IDSW CLEAR FLGS 35800022
         CLC   OPCDOUBL(AL8),AVTCTLCH CANCEL ON COMMAND?                35900022
         BNE   FREEBUF             NO, FREE INPUT UNITS                 36000022
         SPACE                                                          36100022
CANCEL   EQU   *                                                        36200022
         MVC   OPCLDNME+OFF03(AL2),FREEXCTL SET TO GO TO 710D           36300022
         MVI   OCFLAG,OCCONSOL     SET CONSOLE INPUT                    36400022
         L     RWORKA,OPCWORK           GET WORK AREA POINTER           36500022
         XC    OFF00(AL2,RWORKA),OFF00(RWORKA) CLEAR COUNT FIELD        36600022
         BAL   RWORK,SKIPCLR            BR TO CLR WORK AREA             36700022
         NI    OPCFLAG2,AVTEFF-ERR18    RESET ERROR SWITCH              36800022
         SPACE                                                          36900022
         B     FREEBUF             PLACE UNITS IN POOL                  37000022
         TITLE 'IGC0110D - BUFFER UNIT FREEING ROUTINE'                 37100022
*********************************************************************** 37200022
*                                                                     * 37300022
*        THIS ROUTINE FREES EXTRA UNITS AFTER THE DATA HAS BEEN       * 37400022
*        MOVED TO THE WORKAREA AND THEN XCTL'S TO THE NEXT CORRECT    * 37500022
*        LOAD OF SVC 104.                                             * 37600022
*                                                                     * 37700022
*********************************************************************** 37800022
         SPACE                                                          37900022
ERROR18  EQU   *                                                        38000022
         OI    OPCFLAG2,ERR18           SET ERROR SWITCH       @OZ09297 38100000
FREEBUF  EQU   *                                                        38500022
         L     RPREFIX,OPCCOPCE    PICK UP CURRENT BUFFER ADDR          38800022
         L     RPARM,PRFTIC        PICK UP LINK FIELD                   38900022
         EX    RPARM,OPCHNEND          CHECK FOR END OF CHAIN           39000022
         BNZ   NOFREE              YES, NO UNITS TO FREE                39200022
         LA    RRET,NOFREE         SET RETURN ADDRESS          @YM07340 39300000
TEXTBFR  EQU   *                                                 S22024 39460022
         L     RBRNCH,OPCFREBF          FREE BUFF ROUTINE        S22024 39520022
         BR    RBRNCH              FREE UNITS TO OPC POOL               39600022
         SPACE                                                          39700022
NOFREE   EQU   *                                                        39800022
         TM    OPCFLAG2,ERR18           TEST ERROR SWITCH      @OZ09297 40010000
         BZ    NOERR                    NO CONTINE             @OZ09297 40020000
         NI    OPCFLAG2,AVTEFF-ERR18    RESET ERROR SWITCH     @OZ09297 40030000
         LA    RZERO,MSG18              SET MESSAGE NO 18      @OZ09297 40040000
         MVC   OPCLDNME+OFF03(AL2),ERRXCTL SET MODULE NAME     @OZ09297 40050000
         MVC   OPCDOUBL(AL8),OFF08(RWORKA) SAVE BAD NAME(VERB) @OZO9297 40060000
NOERR    EQU   *                                               @OZ09297 40070000
         MVC   OCUNIT,INVALTIC       SET END OF BUFFER UNIT    @ZM48777 40500011
         MVI   OCSWITCH,AVTEZERO        CLEAR TO ZERO            S22024 40600000
         XC    OCTRMTBL(TWELVE),OCTRMTBL CLEAR FIELDS                   40700022
         NI    OPCFLAG1,AVTEZERO        CLEAR FLAGS                     40800022
EXIT     EQU   *                                                 S22024 40850022
         LR    RPARM,ROPCAVT       POINT TO AVT                         40900022
         SPACE 2                                                        41000022
         XCTL  SF=(E,OPCXCTL)      CALL NEXT SVC LOAD                   41100022
         TITLE 'IGC0110D - CROSS UNIT SCAN CODE'                        41200022
*********************************************************************** 41300022
*                                                                     * 41400022
*        THIS CODE IS ENTERED EACH TIME THE SCAN POINTER IS MOVED     * 41500022
*        TO INSURE THAT IT IS STILL WITHIN A UNIT AND THAT THE END    * 41600022
*        OF DATA (COUNT) IS NOT ZERO.  EITHER OF THESE CONDITIONS IS  * 41700022
*        HANDLES BY FINDING THE NEXT BUFFER UNIT OR BUFFER AND        * 41800022
*        CONTINUING THE SCAN.                                         * 41900022
*                                                                     * 42000022
*********************************************************************** 42100022
         SPACE                                                          42200022
CHKLOCAT EQU   *                                                        42300022
         BCT   RREMAIN,SEARCH      NO. OF BYTES LEFT ZERO               42400022
         SPACE                                                          42500022
         B     NEWUNIT             YES, GET NEXT BUFFER ADDRESS         42600022
         SPACE                                                          42700022
SEARCH   EQU   *                                                        42800022
         C     RSCAN,OPCBFEND      END OF THIS UNIT                     42900022
         BCR   LOW,RRET            NO, CONTINUE SCAN OF INPUT           43000022
         SPACE                                                          43100022
NEWUNIT  EQU   *                                                        43200022
         SR    RSCAN,RSTART        CALCULATE SCANNED LENGTH             43300022
         LTR   RSCAN,RSCAN         SCANNED LENGTH ZERO?                 43400022
         BZ    SKIPMOVE            YES, MOVE NO CHARACTERS              43500022
         SPACE                                                          43600022
         LR    RWORK,RSCAN         SAVE LENGTH OF DATA                  43700022
         TM    OPCFLAG1,CANCELSW   CANCEL PROCESSING?                   43800022
         BO    SKIPCNT             YES, DO NOT UP COUNT                 43900022
         SPACE                                                          44000022
         AH    RSCAN,OFF02(RWORKA) ADD ALREADY SCANNED COUNT            44100022
         STH   RSCAN,OFF02(RWORKA) PLACE NEW COUNT IN WORKAREA          44200022
         CH    RSCAN,OPCWRKSZ      DATA LONGER THAN WORKAREA?           44300022
         BNL   ERROR18             YES, PUT OUT ERROR                   44400022
         SPACE                                                          44500022
SKIPCNT  EQU   *                                                        44600022
         BCTR  RWORK,RZERO         SUBTRACT ONE FOR EXECUTE             44700022
         EX    RWORK,MOVEDATA      MOVE THIS DATA TO WORKAREA           44800022
         SPACE                                                          44900022
         LA    RPUT,ONE(RWORK,RPUT) UPDATE WORKAREA POINTER             45000022
SKIPMOVE EQU   *                                                        45100022
         L     RUNIT,PRFTIC-IEDQPRF(RUNIT) GET NEXT UNIT ADDR           45200022
         BCTR  RUNITNO,RZERO            DECREMENT FOR UNIT PROCESSED    45300022
         LH    RWORK,AVTKEYLE      GET KEY LENGTH                       45400022
         SR    RSTART,RSTART            CLEAR SCAN OFFSET               45500022
         LTR   RREMAIN,RREMAIN     END OF THIS BUFFER'S DATA            45600022
         BNZ   INBUFF                   CHECK FOR END OF BUFFER         45700022
         SPACE                                                          45800022
         LTR   RUNITNO,RUNITNO          END OF UNITS                    45900022
         BNZ   TESTFLAG                 YES, ARE WE IN MIDDLE OF CHECK  46000022
         SPACE                                                          46100022
         EX    RUNIT,OPCHNEND      TEST FOR END OF CHAIN INDICATOR      46200022
         BZ    SETPOINT            NO, CONTINUE                         46300022
         SPACE                                                          46400022
TESTFLAG EQU   *                                                        46500022
         TM    OPCFLAG1,QUOTSW+VERBFLAG+IDSW MIDDLE OF PROCESSING?      46600022
         BNZ   ERROR18             YES, WE HAVE AN ERROR                46700022
         SPACE                                                          46800022
         B     FREEBUF             GIVE UP BUFFER UNITS                 46900022
         SPACE                                                          47000022
SETPOINT EQU   *                                                        47100022
         LR    RPREFIX,RUNIT       POINT REG TO START OF BUFFER         47200022
         SR    RUNITNO,RUNITNO          CLEAR FOR INSERT                47300022
         IC    RUNITNO,PRFNBUNT         GET NO. OF UNITS IN BUFFER      47400022
         LH    RREMAIN,PRFSIZE     PICK UP NUMBER OF BYTES OF DATA      47500022
         N     RREMAIN,AVTCLRHI    CLEAR HIGH BYTES                     47600022
         LH    RSTART,PRFSCAN      GET SCAN POINTER                     47700022
         N     RSTART,AVTCLRHI     CLEAR HIGH BYTES                     47800022
         LH    RWORK,AVTKEYLE           GET KEY LENGTH FROM AVT         47900022
CHECK    EQU   *                                                        48000022
         CR    RSTART,RWORK        FIRST BYTE OUT OF UNIT               48100022
         BL    INBUFF              NO, CALCULATE ACTUAL SCAN POSITION   48200022
         SPACE                                                          48300022
         L     RUNIT,PRFTIC        PICK UP NEXT UNIT ADDRESS            48400022
         SR    RSTART,RWORK        RESET SCAN POINTER TO REFLECT UNIT   48500022
         SR    RREMAIN,RWORK       SUBTRACT BYTES FROM LENGTH           48600022
         BCTR  RUNITNO,RZERO            DECREMENT FOR UNIT PROCESSED    48700022
         B     CHECK               CONTINUE CHECKING UNTIL LOCATED      48800022
         SPACE                                                          48900022
INBUFF   EQU   *                                                        49000022
         SR    RREMAIN,RSTART      CALCULATE LENGTH OF DATA             49100022
         LA    RSCAN,AVTUMALN(RUNIT) SET SCAN POINTER TO HEADER         49200022
         AR    RWORK,RSCAN         ADD KEY LENGTH TO GET LAST BYTE      49300022
         AR    RSCAN,RSTART        ADD SCAN POINTER TO GET FIRST BYTE   49400022
         LR    RSTART,RSCAN        SAVE STARTING POINTER                49500022
         ST    RWORK,OPCBFEND      SAVE END OF UNIT POINTER             49600022
         BR    RRET                RETURN TO IN LINE CODE               49700022
         SPACE                                                          49800022
MOVEDATA MVC   OFF00(AL0,RPUT),OFF00(RSTART) PLACE DATA IN RECEIVE AREA 49900022
         TITLE 'IGC0110D - SMALL ROUTINES AND VERB TABLE'               50000022
*********************************************************************** 50100022
*                                                                     * 50200022
*        THIS SUBROUTINE IS ENTERED EACH TIME THE END OF A CERTAIN    * 50300022
*        DATA FIELD IS FOUND WITHOUT COMMING TO THE END OF DATA OR A  * 50400022
*        UNIT.  THE REMAINING DATA IS COUNTED AND MOVED TO THE        * 50500022
*        WORKAREA.                                                    * 50600022
*                                                                     * 50700022
*********************************************************************** 50800022
         SPACE                                                          50900022
MOVEEND  EQU   *                                                        51000022
         LR    RWORK,RSCAN         SAVE SCAN POINTER                    51100022
         SR    RWORK,RSTART        CALCULATE REMAINING LENGTH           51200022
         LTR   RWORK,RWORK         ZERO LENGTH?                         51300022
         BCR   EQUAL,RRET          YES, DO NOT MOVE ANY DATA            51400022
         SPACE                                                          51500022
         BCTR  RWORK,RZERO         SUBTRACT ONE FOR MOVE EXECUTE        51600022
         EX    RWORK,MOVEDATA      PLACE DATA INTO WORKAREA             51700022
         CLC   OFF00(AL8,RPUT),AVTCTLCH TEST FOR CANCEL                 51800022
         BE    CANCEL                   YES CANCEL                      51900022
         SPACE                                                          52000022
         LA    RWORK,ONE(RWORK)    ADD ONE FOR DECREMENT BEFORE         52100022
         TM    OPCFLAG1,CANCELSW   CANCEL PROCESSING?                   52200022
         BCR   ON,RRET             YES, SKIP COUNTING                   52300022
         SPACE                                                          52400022
         AH    RWORK,OFF02(RWORKA) GET TOTAL NUMBER OF BYTES            52500022
         STH   RWORK,OFF02(RWORKA) PLACE NEW TOTAL IN WA                52600022
         CH    RWORK,OPCWRKSZ      DATA LARGER THAN WORKAREA            52700022
         BCR   LOW,RRET            NO, CONTINUE                         52800022
         SPACE                                                          52900022
         B     ERROR18             TOO MUCH DATA, INVALID COMMAND       53000022
         SPACE                                                          53100022
FINDDATA EQU   *                                                        53200022
         LA    RSCAN,ONE(RSCAN)    POINT TO NEXT INPUT BYTE             53300022
         LR    RSTART,RSCAN        START IS SAME BYTE                   53400022
         BAL   RRET,CHKLOCAT       END OF DATA HERE?                    53500022
         SPACE                                                          53600022
         CLI   OFF00(RSCAN),AVTEBLNK BLANK FOUND?                       53700022
         BE    FINDDATA                 FIND NON BLANK                  53800022
         SPACE                                                          53900022
         LR    RWORK,RWORKA        SET RETURN ADDRESS                   54000022
         LA    RWORKA,OPCDOUBL       SET POINTER TO DOUBLE WORD         54100022
         SH    RWORKA,OPCHA8       BACK UP FOR CLEAR                    54200022
         TM    OPCFLAG1,CANCELSW   CANCEL PROCESSING                    54300022
         BO    SKIPCLR             YES, DO NOT CLEAR COUNT              54400022
         SPACE                                                          54500022
CLEAR    EQU   *                                                        54600022
         L     RWORKA,OPCWORK           GET WORKAREA POINTER            54700022
         XC    OFF02(AL2,RWORKA),OFF02(RWORKA) CLEAR COUNT FIELD        54800022
SKIPCLR  EQU   *                                                        54900022
         LA    RPUT,EIGHT(RWORKA)  SET PUT POINTER TO FIRST OF AREA     55000022
         MVI   OFF08(RWORKA),AVTEBLNK   BLANK A BYTE                    55100022
         MVC   OFF09(AL7,RWORKA),OFF08(RWORKA) CLEAR REMAINING SEVEN    55200022
         BR    RWORK               RETURN TO PROCESSING                 55300022
         SPACE                                                          55400022
SETERR18 EQU   *                                                        55500022
         OI    OPCFLAG2,ERR18           SET ERROR SWITCH                55600022
         BR    RRET                     RETURN TO CALLER                55700022
VERBTBL  EQU   *                                                        55800022
         DC    CL7'RELEASE',CL2'A',X'70',C'R0'   RELEASE COMMAND        55900022
         DC    CL7'VARY',CL2'V',X'28',C'V0'      VARY COMMAND           56000022
         DC    CL7'HALT',CL2'Z',X'3C',C'Z0'      HALT COMMAND           56100022
         DC    CL7'HOLD',CL2'H',X'6C',C'H0'      HOLD COMMAND           56200022
         DC    CL7'DISPLAY',CL2'D',X'68',C'D0'   DISPLAY COMMAND        56300022
         DC    CL7'MODIFY',CL2'F',X'44',C'M0'    MODIFY COMMAND         56400022
         DC    X'FF'               END OF TABLE                         56500022
         SPACE 2                                                        56600022
INVALTIC DC    XL4'08000002'       INVALID TIC                 @ZM48777 56650011
ERRXCTL  DC    C'03'               IGC0310D ERROR MESSAGE MODULE        56700022
FREEXCTL DC    C'07'               MAKE IGC0710D MODULE NAME            56800022
IGC00    DC    C'00'                    MODULE SET UP            S22024 56850022
ZAPS     DC    100X'FF'                 PATCH AREA             @Y17XARX 56870000
         TITLE 'IGC0110D - DSECTS REFERENCED IN THIS MODULE'            56900022
         TAVTD                                                          57000022
         EJECT                                                          57100022
         TLCBD                                                          57200022
         EJECT                                                          57300022
         TOPCAVTD                                                       57400022
         EJECT                                                          57500022
         TOPCED                                                         57600022
         EJECT                                                          57700022
         TPRFD                                                          57800022
         EJECT                                                          57830000
         TTRMD                                                          57860000
         END                                                            57900022
