IGC018   CSECT                                                          00020002
         TITLE 'IGC018 - FIND/BLDL AND TTR CONVERT ROUTINES'            00021002
*********************************************************************** 00621002
*                                                                     * 00622002
* MODULE NAME = IGC018                                                * 00623002
*                                                                     * 00624002
* DESCRIPTIVE NAME = BLDL/FIND                                        * 00625002
*                                                                     * 00626002
* COPYRIGHT = NONE                                                    * 00627002
*                                                                     * 00628002
* STATUS = RELEASE VS 2/2 - LEVEL 001                                 * 00629002
*                                                                     * 00630002
* FUNCTION- THIS RESIDENT MODULE SEARCHES A DIRECTORY OF A PO         * 00720002
*           DATA SET FOR A NAME OR LIST OF NAMES, AND RETURNS         * 00740002
*           INFORMATION STORED IN THE DIRECTORY ASSOCIATED WITH EACH  * 00760002
*           NAME. THE FORMAT OF THE DIRECTORY AND OF THE RETURNED     * 00780002
*           INFORMATION IS DESCRIBED BY THE MAPPING MACRO IHAPDS.     * 00800002
*                                                                     * 00820002
*           IT WILL ALSO SEARCH A CONCATENATED SERIES OF DIRECTORIES  * 00840002
*           UNDER ANY OF THE FOLLOWING CONDITIONS:                    * 00860002
*           1. THE USER HAS SUPPLIED A DCB OPENED FOR CONCATENATED    * 00880002
*              BPAM INPUT.                                            * 00900002
*           2. THE USER HAS NOT SUPPLIED A DCB.  IN THIS CASE         * 00920002
*              EITHER JOBLIB OR STEPLIB, (THEMSELVES PERHAPS          * 00940002
*              CONCATENATED) FOLLOWED BY LINKLIB WILL BE SEARCHED.    * 00960002
*           3. THE USER HAS SUPPLIED A DCB FOR SVCLIB, AND AN SVC     * 00980002
*              RESIDENT BLDL TABLE IS AVAILABLE; OR BLDL IS SEARCHING * 01000002
*              LINKLIB AND A LINKLIB RESIDENT BLDL TABLE IS AVAILABLE.* 01020002
*              IN THESE CASE THE RESIDENT TABLE WILL BE 'CONCATENATED'* 01040002
*              AHEAD OF THE DIRECTORY TO BE SEARCHED.                 * 01060002
*                                                                     * 01080002
*           THIS MODULE ALSO CONTAINS ENTRY POINTS TO ROUTINES WHICH  * 01100002
*           CONVERT AN ABSOLUTE DIRECT ACCESS ADDRESS, MBBCCHHR, TO   * 01120002
*           AND FROM ITS RELATIVE EQUIVALENT, TTR.                    * 01140002
*                                                                     * 01160002
* NOTES = NONE                                                        * 01161002
*                                                                     * 01162002
*    DEPENDENCIES = NONE                                              * 01163002
*                                                                     * 01164002
*    RESTRICTIONS = NONE                                              * 01165002
*                                                                     * 01166002
*    REGISTER CONVENTIONS = SEE REGISTER EQUATES                      * 01167002
*                                                                     * 01168002
* PATCH LABEL = NONE                                                 *  01169002
*                                                                     * 01170002
* MODULE TYPE = SVC ROUTINE                                           * 01171002
*                                                                     * 01172002
*    PROCESSOR = ASSEMBLER XF                                         * 01173002
*                                                                     * 01174002
*    ATTRIBUTES = REFRESHABLE, ENTERED ENABLED, KEY ZERO,             * 01177002
*                 LOCAL LOCK HELD.                                    * 01178002
*                                                                     * 01179002
* ENTRY POINTS- IGC018                                                * 01180002
*                                                                     * 01180202
*    PURPOSE- ENTERED FROM SVC SUPERVISOR AFTER MAINLINE CODE ISSUES  * 01181002
*             SVC 18.                                                 * 01220002
*                                                                     * 01221002
*    LINKAGE- A CALLING SEQUENCE IS GENERATED BY ONE OF THE           * 01222002
*             FOLLOWING MACROS:                                       * 01240002
*                                                                       01260002
*                    FIND  DCBADDR,NAMEADDR        FIND MACRO           01280002
*                                                                       01300002
*                    LA    0,NAMEADDR                                   01320002
*                    LA    1,DCBADDR                                    01340002
*                    LCR   1,1                                          01360002
*                    SVC   18                                           01380002
*                                                                       01400002
*                    BLDL  DCBADDR,LISTADDR        BLDL MACRO           01420002
*                                                                       01440002
*                    LA    0,LISTADDR                                   01460002
*                    LA    1,DCBADDR                                    01480002
*                    SVC   18                                           01500002
*                                                                     * 01501002
*    INPUT- IN ADDITION TO THE INPUTS SHOWN ABOVE THE SVC SUPERVISOR  * 01502002
*           SETS UP THE FOLLOWING REGISTERS:                          * 01503002
*           REGISTER 3 CVT POINTER                                    * 01504002
*           REGISTER 4 TCB POINTER                                    * 01505002
*           REGISTER 5 SVRB POINTER                                   * 01506002
*           REGISTER 14 RETURN ADDRESS                                * 01507002
*           REGISTER 15 ENTRY ADDRESS                                 * 01508002
*                                                                     * 01509002
*    OUTPUT- THE LIST FILLED IN WITH INFORMATION FROM THE DIRECTORY   * 01510002
*            BLOCK FROM BLDL.  FROM FIND THE TTR IS PASSED TO THE     * 01511002
*            POINT ROUTINE AND IT UPDATES THE DCB AND IOB.            * 01512002
*                                                                     * 01513002
*    EXIT NORMAL- BRANCH TO THE ADDRESS IN REGISTER 14 ON ENTRY       * 01514002
*                 REGISTER 15  CONTAINS A 0                           * 01514202
*                                                                     * 01515002
*    EXIT ERROR - SAME AS EXIT NORMAL EXCEPT REGISTER 15 AND 0        * 01516002
*                 CONTAIN THE FOLLOWING CONDITION CODES:              * 01517002
*                 * REGISTER 15 * REGISTER 0 *   ERROR CONDITION      * 01518002
*                 *    04       *    00      *  PARTIAL LIST          * 01519002
*                 *    08       *    00      *  PERMANENT I/O ERROR   * 01520002
*                 *    08       *    04      *  GETMAIN ERROR         * 01521002
*                 *    08       *    08      *  INVALID DEB  @ZA25435 * 01522037
*                                                                     * 01524002
* ENTRY POINT = EXITRTN                                               * 01525002
*                                                                     * 01526002
*    PURPOSE = ENTERED FROM RTM VIA A SYNCH IN KEY ZERO ENABLED       * 01527002
*              WHEN THERE IS AN ATTEMPT TO ABNORMALLY TERMINATE THE   * 01528002
*              RB LEVEL ON WHICH THIS SVC IS ACTIVE.  THIS ROUTINE    * 01529002
*              WILL FIND THE ADDRESS OF THE TRR BY ISSUING A LOAD.    * 01530002
*              IT WILL ALSO FILL IN SDWACSCT AND SDWAREXN.            * 01531002
*                                                                     * 01533002
*    LINKAGE = REGISTER 0 - CODE.  IF 12 NO RTCA IS PASSED            * 01534002
*              REGISTER 1 - ADDRESS OF THE RTCA.                      * 01535002
*              REGISTER 13 - ADDRESS OF A 18 FULLWORD SAVE AREA.      * 01536002
*              REGISTER 14 - RETURN ADDRESS                           * 01537002
*              REGISTER 15 - ADDRESS OF THE BOOTSTRAP ROUTINE.        * 01538002
*                                                                     * 01539002
*    INPUT = RTCA.                                                    * 01540002
*                                                                     * 01541002
*    OUTPUT = REGS AS PASSED FROM RTM EXCEPT 15 SET TO ADDR OF TRR.   * 01542002
*             SDWACSCT SET TO CSECT NAME.                             * 01543002
*             SDWAREXN SET TO TRR NAME.                               * 01544002
*                                                                     * 01545002
*    EXIT - NORMAL = BRANCH TO TRR.                                   * 01546002
*                                                                     * 01547002
*    EXIT - ERROR = A BRANCH ON REGISTER 14 BACK TO RTM IF NO RTCA    * 01548002
*                   PASSED.                                           * 01549002
*                                                                     * 01553002
* ENTRY POINT- IECPRLTV                                               * 01554002
*                                                                     * 01555002
*    PURPOSE- ENTRY TO ROUTINE VIA A BALR THAT CONVERTS AN ABSOLUTE   * 01880002
*             DIRECT ACCESS ADDRESS, MBBCCHHR, INTO ITS RELATIVE      * 01900002
*             EQUIVALENT, TTR0.                                       * 01920002
*                                                                     * 01921002
*    LINKAGE- REGISTER CONVENTIONS UPON ENTRY AND UPON EXIT ARE AS    * 01940002
*             FOLLOWS:                                                * 01960002
*                 REGISTER         ENTRY             EXIT             * 02000002
*                   0          IGNORED            TTR0 RESULT         * 02020002
*                   1          DEB ADDRESS        TRANSPARENT         * 02040002
*                   2          ADDRESS OF         TRANSPARENT         * 02060002
*                                MBBCCHHR IN CORE                     * 02080002
*                   3-8        IGNORED            TRANSPARENT         * 02100002
*                   9-13       IGNORED            DESTROYED           * 02120002
*                   14         RETURN ADDRESS     TRANSPARENT         * 02140002
*                   15         ENTRY ADDRESS      ZERO                * 02160002
*                                                                     * 02180002
*              NOTE: IECPRLTV DOES NOT VALIDITATE THE INPUT           * 02200002
*              MBBCCHHR.  IF M IS LARGER THAN THE NUMBER OF           * 02220002
*              EXTENTS IN THE DEB, CORE BEYOND THE DEB                * 02240002
*              EXTENT SECTION WILL BE REFERENCED AS IF IT             * 02260002
*              CONTAINED VALID EXTENTS.  IF CCHH AS SPECIFIED         * 02280002
*              IS NOT WITHIN THE EXTENT SPECIFIED BY M,               * 02300002
*              AN UNREASONABLE VALUE OF TT WILL RESULT.               * 02320002
*                                                                     * 02321002
*    INPUT- DEB, MBBCCHHR IN CORE                                     * 02322002
*                                                                     * 02323002
*    OUTPUT- TTR0 IN REGISTER 0                                       * 02324002
*                                                                     * 02325002
*    EXIT NORMAL- BRANCH TO THE ADDRESS ON REGISTER 14 ON INPUT       * 02326002
*                                                                     * 02327002
*    EXIT ERROR - N/A NO ERRORS CHECKED FOR (SEE NOTE ABOVE)          * 02328002
*                                                                     * 02329002
* ENTRY POINT- IECPCNVT                                               * 02330002
*                                                                     * 02331002
*    PURPOSE- ENTRY TO ROUTINE VIA A BALR THAT CONVERTS A RELATIVE    * 02360002
*             DIRECT ACCESS ADDRESS AND CONCATENATION NUMBER, TTRN,   * 02380002
*             INTO ITS ABSOLUTE EQUIVALENT, MBBCCHHR.                 * 02400002
*                                                                     * 02401002
*    LINKAGE- REGISTER CONVENTIONS UPON ENTRY AND UPON EXIT ARE AS    * 02420002
*             FOLLOWS:                                                * 02440002
*                                                                     * 02460002
*                 REGISTER         ENTRY             EXIT             * 02480002
*                   0          ACTUAL TTRN        DESTROYED           * 02500002
*                   1          DEB ADDRESS        TRANSPARENT         * 02520002
*                   2          ADDRESS OF 8 BYTE  TRANSPARENT         * 02540002
*                                AREA FOR MBBCCHHR                    * 02560002
*                   3-8        IGNORED            TRANSPARENT         * 02580002
*                   9-13       IGNORED            DESTROYED           * 02600002
*                   14         RETURN ADDRESS     TRANSPARENT         * 02620002
*                   15         ENTRY ADDRESS      ERROR CODE          * 02640002
*                                                                     * 02660002
*                   THE ERROR CODE FOR IECPCNVT WILL BE 0 FOR         * 02680002
*                   SUCCESSFUL CONVERSION, OR 4 IF VALUE OF TT        * 02700002
*                   EXCEEDS TOTAL EXTENTS ASSIGNED.                   * 02720002
*                                                                     * 02721002
*    INPUT- TTRN IN REGISTER 0                                        * 02722002
*                                                                     * 02723002
*    OUTPUT- MBBCCHHR IN CORE LOCATION  POINTED TO BY REGISTER 2      * 02724002
*                                                                     * 02725002
*    EXIT NORMAL- BRANCH TO THE ADDRESS IN REGISTER 14 ON ENTRY       * 02726002
*                 REGISTER 15 = 0                                     * 02727002
*                                                                     * 02728002
*    EXIT ERROR - BRANCH TO THE ADDRESS IN REGISTER 14 ON ENTRY       * 02729002
*                 REGISTER 15 = 4 IF TT EXCEEDS TOTAL EXTENTS         * 02730002
*                                                                     * 02731002
* EXTERNAL REFERENCES                                                 * 02732002
*                                                                     * 02733002
*    ROUTINES - POINT ROUTINE POINTED TO BY DCBPOINT IF A FIND        * 02734002
*               IEAVVMSR LPA SEARCH ROUTINE USED IN EXITRTN.          * 02736002
*                                                                     * 02737002
*    DATA SETS - NONE                                                 * 02738002
*                                                                     * 02739002
*    DATA AREAS - DSCB, CTV, IOB,DCB,SVRB,TCB,DVCT,DEB,ECB            * 02740002
*                 BOOTSTRAP ROUTINE - RTCA,CVT                        * 02742002
*                                                                     * 02743002
*    TABLES - NONE                                                    * 02744002
*                                                                     * 02746002
*    MACROS - ESTAE, MODESET, IGGSTAE, SYNCH, EXCP, WAIT,             * 02747002
*             GETMAIN, FREEMAIN.                                      * 02747202
*                                                                     * 02748002
* CHANGE ACTIVITY                                                     * 02749002
*                                                                     * 02804002
*              RELEASE 19                                             * 02809002
*D                                                               A28189 02814002
*D                                                               A27543 02819002
*D                                                               A25998 02829002
*D                                                               M3387  02839002
*D                                                               M3385  02844002
*D                                                               M4214  02854002
*D                                                               M4612  02859002
*D                                                               M1596  02864002
*                                                                     * 02865002
*              RELEASE 20                                             * 02869002
*D                                                               TS2466 02874002
*D                                                               M1381  02879002
*                                                                     * 02904002
*              RELEASE 21                                             * 02909002
*                                                                     * 02914002
*              VS 1/1                                                 * 02919002
*                                                                XM5845 02924002
*                                                                     * 02929002
*              VS 1/2                                                 * 02934002
*                                                                     * 02939002
*              VS 1/3                                                 * 02944002
*                                                                     * 02949002
*              VS 2/1                                                 * 02954002
*                                                                     * 02959002
*              VS 2/2                                                 * 02964002
*D54200-54800,59000-59800,67800-69600,71200-72000,182800,183600  Y02072 02969002
*                                                               YM01226 02969202
*                                                               YM01287 02969402
*                                                                YM4640 02969502
*A148400-148450,148550,188300                                  @ZA12201 03169537
*C054030-054036                                                @ZA12201 03369537
*C168800                                                       @ZA11127 03469537
*D169000                                                       @ZA11127 03469637
*A039515-039555,057644-057652,058660-058720,142710-142730      @ZA12953 03519637
*C054030                                                       @ZA12953 03569637
*A057646-057647                                                @ZA17048 03649637
*C054030                                                       @ZA17048 03689637
*A041830-046600,057649-057729,066300-066450,142710-142744      @ZA25435 03699637
*C054030,070705                                                @ZA25435 03709637
*C089400,160720-167300,167700-171200                           @ZA26444 03719637
*A160620-160720,347900                                         @ZA26444 03729637
*A169530-169560                                                @ZA27485 03734637
*C054030                                                       @ZA30955 03735637
*D057649-057729,142710-142744                                  @ZA30955 03736437
*A057647-057709,142710-142748                                  @ZA30955 03737237
*A103800-103900                                                @ZA31343 03738037
         EJECT                                                          03740002
*********************************************************************** 03760002
*              EQUATE STATEMENTS                                      * 03780002
*********************************************************************** 03800002
ADDR3    EQU   B'0111'            MASK FOR ICM/STCM FOR 3 BYTE ADDRESS  03820002
CCHN     EQU   X'40'              COMMAND CHAIN IN CCW FLAGS            03840002
HALVE    EQU   1                  SHIFT AMOUNT TO DIVIDE BY 2           03880002
LOBYTE   EQU   X'FF'              MASK FOR LOW ORDER REGISTER BYTE      03900002
PSWPROB  EQU   X'01'              PROBLEM STATE FLAG--PSW+1             03920002
TIMES16  EQU   4                  SHIFT AMOUNT TO MULT BY 16            03940002
PRIVKEY  EQU   7                  KEYS 7 & LOWER ARE SYSTEM KEYS Y02072 03942002
KEYOFFST EQU   4                  VALUE TO SHIFT KEY IN BYTE     Y02072 03947002
KEYMASK  EQU   X'F0'              POSITION OF KEY IN BYTE       YM01226 03949502
DEBPK    EQU   24                 DEB PROTECT KEY DISPLACEMENT @ZA12953 03951537
JLBDCB   EQU   40                 TCB JOBLIB DISPLACEMENT      @ZA12953 03953537
DCBDB    EQU   44                 DCB DEB DISPLACEMENT         @ZA12953 03955537
         SPACE                                                          03960002
*                                 ***CCW OP CODES***                    03980002
TIC      EQU   X'08'              TRANSFER IN CHANNEL                   04000002
SKHEQ    EQU   X'69'              SEARCH KEY EQUAL OR HIGH              04020002
MRC      EQU   X'92'              MULTI-TRACK READ COUNT                04040002
SIDEQ    EQU   X'31'              SEARCH ID EQUAL                       04060002
RD       EQU   X'06'              READ DATA                             04080002
         SPACE                                                          04100002
*                                 ***USER RETURN CODES***               04120002
CNVTERR  EQU   4                  INVALID TT ON TTR TO CCHHR CONVERT    04140002
RCBADLST EQU   4                  LIST COULD NOT BE FILLED              04160002
RCIOERR  EQU   8                  I/O ERROR ON DIRECTORY READ           04180002
RCGETERR EQU   4                  GETMAIN ERROR - IN REGISTER 0  Y02072 04182002
RCDEBERR EQU   8                  INVALID DEB - IN REGISTER 0  @ZA25435 04183037
*                                 IF ON REGISTER 15 MUST BE 8    Y02072 04184002
         EJECT                                                          04200002
*********************************************************************** 04220002
*              REGISTER USAGE                                         * 04240002
*********************************************************************** 04260002
R0       EQU   0                  AT ENTRY, PARM LIST                   04280002
RCSID    EQU   R0                 DURING CCW RELOCATE--SID CCW          04300002
RSCUR    EQU   R0                 RES TAB SRCH--CURRENT TABLE ENTRY NR  04320002
R1       EQU   1                  AT ENTRY, DCB (COMPLEMENTED IF FIND)  04340002
RSMOVE   EQU   R1                 RES TAB SRCH--LENGTH FOR MOVE INSTR   04360002
RCTIC1   EQU   2                  DURING CCW RELOCATE--FIRST TIC        04380002
RCTIC2   EQU   2                  DURING CCW RELOCATE--SECOND TIC       04385002
RSULEFT  EQU   2                  NUMBER OF USER ENTRIES LEFT           04400002
R2       EQU   2                  USED FOR INPUT TO MODESET      Y02072 04402002
RCVT     EQU   3                  COMMUNICATIONS VECTOR TABLE           04420002
RX       EQU   4                  WORK REGISTER                         04440002
RCMRC    EQU   4                  DURING CCW RELOCATE--READ COUNT (M/T) 04460002
RCRD     EQU   4                  DURING CCW RELOCATE--READ DATA        04465002
RSTUB    EQU   4                  RES TAB SRCH--UPPER BOUNDARY NR       04480002
RY       EQU   5                  WORK REGISTER                         04500002
RSTLB    EQU   5                  RES TAB SRCH--LOWER BOUNDARY NR       04520002
R5       EQU   5                  UPPER LIM FOR STM FOR CCW REL  Y02072 04535002
RRB      EQU   6                  SVRB ADDRESS                   Y02072 04540002
RPDS2    EQU   7                  ENTRY IN USER BLDL LIST               04600002
RPDS1    EQU   8                  ENTRY IN DATA SET DIRECTORY           04620002
RRENT    EQU   8                  ENTRY IN RES BLDL TABLE               04640002
R8       EQU   8                  WORK REG                     @ZA25435 04660037
RDEB     EQU   9                  POINTER TO DEB                        04680002
RRES     EQU   9                  BEGINNING OF RES BLDL TABLE           04700002
R9       EQU   9                  LOWER LIMIT FOR STM IN SRC PDS Y02072 04705002
RLIST    EQU   10                 BLDL OR FIND PARAMETER LIST           04720002
RDCB     EQU   11                 LINKLIB,TASKLIB,SVCLIB, OR USER DCB   04760002
*                                 (TASKLIB INCLUDES JOBLIB OR STEPLIB)  04780002
RBASE    EQU   12                 PROGRAM BASE                          04820002
RAREA    EQU   13                 BLDL/FIND WORK AREA                   04840002
RRET     EQU   14                 RETURN REGISTER FROM MAJOR FUNCTIONS  04860002
RZ       EQU   14                 WORK REGISTER                         04865002
RSUBR    EQU   14                 SUBROUTINE RETURN REGISTER            04870002
R15      EQU   15                 AT EXIT, RETURN CODE                  04880002
RSTLEFT  EQU   R15                RES TAB SRCH--NR OF TABLE ENTS LEFT   04900002
         SPACE 3                                                        04920002
*              REGISTERS FOR TTR CONVERT ROUTINES                       04940002
*              NOTE: REGISTERS FOR THE SECTOR CONVERT ROUTINE           04960002
*                    ARE LISTED WITH THAT ROUTINE                       04980002
RGTTR    EQU   0                  TTR. (INPUT--CNVT, OUTPUT--RLTV)      05000002
RGDEB    EQU   1                  POINTER TO USER DEB                   05020002
RGMBB    EQU   2                  POINTER TO MBBCCHHR (FILLED BY CNVT)  05040002
RGV      EQU   9                  WORK REGISTER                         05060002
RGW      EQU   10                 WORK REGISTER                         05080002
RGX      EQU   11                 WORK REGISTER                         05100002
RGY      EQU   12                 WORK REGISTER                         05120002
RGZ      EQU   13                 WORK REGISTER                         05140002
         EJECT                                                          05160002
IGC018   CSECT                                                          05180002
         ENTRY SVC018                                                   05200002
SVC018   EQU *                                                          05220002
*********************************************************************** 05240002
*        SVC ENTRY POINT TO BLDL OR FIND                              * 05260002
*                                                                     * 05280002
*        THE FUNCTIONS ARE DISTINGUISHED BY R1 COMPLEMENTED FOR FIND  * 05300002
*********************************************************************** 05320002
         SPACE 2                                                        05340002
         BALR  RBASE,0            ESTABLISH BASE FOR CODE               05360002
         USING BASE1,RBASE                                              05380002
BASE1    EQU   *                                                        05400002
         B     BEGIN                   BRANCH AROUND MODULE ID   YM4640 05401002
         DC    C'IGC018  '             MODULE NAME               YM4640 05402002
         DC    C'@ZA30955'             LAST SHIP CODE          @ZA30955 05403037
         DC    C'&SYSDATE'             LAST SHIP DATE          @ZA12201 05403637
BEGIN    DS    0H                      END OF MODULE ID          YM4640 05404202
         LR    RRB,R5             SVRB ADDRESS FROM SVC SLIH     Y02072 05405002
         USING RBBASIC,RRB                                       Y02072 05410002
         USING CVT,RCVT           CVT POINTER FROM SVC SLIH      Y02072 05410402
         XC    RBEXSAVE,RBEXSAVE  CLEAR EXTENDED SAVE AREA       Y02072 05410602
         ST    RRET,EXSRET        SAVE RETURN ADDRESS            Y02072 05411402
         MVC   EXSESTAE(EXSELEN),ESTAEL MOVE IN ESTAE LIST       Y02072 05412002
*                                                                       05412402
*        THE EXTAE MACRO WILL PASS THE BOOTSTRAP ROUTINE ADDRESS        05412802
*        TO RTM.                                                        05413202
*                                                                       05413602
         ESTAE PARAM=(RRB),MF=(E,EXSESTAE)                       Y02072 05414002
         LM    R0,R1,RBGRS0       RESTORE INPUT REGISTERS        Y02072 05419002
         LTR   R1,R1              INPUT REG NEGATIVE(FIND)       Y02072 05419102
         BM    MODE1              YES                            Y02072 05419502
         OI    EXSFLG,EXSBLDL     TURN ON BLDL FLAG              Y02072 05421902
MODE1    EQU   *                                                 Y02072 05422902
         L     R2,RBLINK          ADDRESS OF CALLER RB           Y02072 05423502
         IC    R2,RBOPSW-RBBASIC+1(R2) GET CALLER KEY            Y02072 05425502
         STC   R2,EXSKEY          SAVE CALLER KEY                Y02072 05425902
         MODESET KEYADDR=EXSKEY,WORKREG=10   CALLER KEY          Y02072 05427502
         LR    RLIST,R0           SAVE LIST ADDRESS              A25998 05429502
         LTR   RDCB,R1            SAVE DCB ADDR, TST FOR 'FIND'  A25998 05440002
         BM    GETCORE            BR IF 'FIND' TO GET WK AREA    Y02072 05460002
*********************************************************************** 05500002
*        FOR BLDL ONLY, TEST THE VALIDITY OF                          * 05520002
*        THE USER-GENERATED 'BLDL' LIST                               * 05540002
*********************************************************************** 05560002
*                                                                A25998 05580002
TSTBLDL  EQU   *                                                        05582002
         USING BLDLIST,RLIST                                            05600002
         LA    R15,RCBADLST       LOAD 'BADLIST' ERROR CODE      A25998 05620002
         SR    RZ,RZ              INITLZ FOR ENTRIES TEST        A25998 05640002
         CH    RZ,BLDENTS         TEST FOR ZERO OR NEG ENTRIES,  A25998 05660002
         BNL   GETOUT             BR IF YES TO RETURN- ERROR     A25998 05680002
         LA    RZ,PDS2LIBF-PDS2   MINIMUM ENTRY LENGTH            M3385 05700002
         CH    RZ,BLDELEN         SEE IF ENTRY TOO SHORT         A25998 05720002
         BH    GETOUT             BR IF YES TO RETURN-ERROR       M5729 05740002
         DROP RLIST                                                     05760002
         C     RDCB,CVTLINK       EXPLICIT REQUEST FOR LINKLIB?  Y02072 05760802
         BE    GETSUP             YES - MUST GET KEY ZERO CORE   Y02072 05761202
         C     RDCB,CVTSVDCB      EXPLICIT REQUEST FOR SVC LIB?  Y02072 05761602
         BE    GETSUP             YES - MUST GET KEY ZERO CORE   Y02072 05761702
         LTR   RDCB,RDCB          TEST DCB POINTER               Y02072 05762002
         BNZ   GETCORE            NOT ZERO GETMAIN IN CALLER KEY Y02072 05764002
         L     RDCB,JLBDCB(RX)    GET TASKLIB DCB FROM CUR TCB @ZA12953 05764437
         LTR   RDCB,RDCB          TEST FOR DCB ADDRESS         @ZA17048 05764537
         BZ    GETSUP             NONE-DO NOT CHECK KEY        @ZA17048 05764637
         TM    CVTOPTA,CVTNIP     TEST FOR NIP IN CONTROL      @ZA30955 05764737
         BO    GETSUP             YES BYPASS DEBCHK            @ZA30955 05764837
         USING IHADCB,RDCB                                     @ZA30955 05764937
         L     RDEB,DCBDEBAD      GET DEB ADDRESS              @ZA30955 05765037
         USING DEBBASIC,RDEB                                   @ZA30955 05765137
         L     R9,0(RDEB)         LOAD THE TCB ADDR FROM DEB   @ZA30955 05765237
         LA    R9,0(R9)           CLEAR HI-ORDER BYTE          @ZA30955 05765337
         LTR   R9,R9              IS THEIR A TCB ?             @ZA30955 05765437
         BZ    ERROR              NO THEN ERROR                @ZA30955 05765537
FINDTCB  EQU   *                                               @ZA30955 05765637
         USING TCB,RX                                          @ZA30955 05765737
         LR    R5,RX              SAVE THIS TCB ADDR           @ZA30955 05765837
FINDTCBA EQU   *                                               @ZA30955 05769337
         L     RX,TCBTCB          ADDR OF NEXT TCB ON QUEUE    @ZA30955 05769437
         LA    RX,0(RX)           CLEAR HI-ORDER BYTE          @ZA30955 05769537
         LTR   RX,RX              HIGHEST TCB ?                @ZA30955 05769637
         USING TCB,RX                                          @ZA30955 05769737
         BZ    BACKTCB            CHECK BACK TCB CHAIN         @ZA30955 05769837
         CR    R9,RX              COMPARE CURRENT TCB WITH     @ZA30955 05769937
*                                 TCBS ON TCB QUEUE            @ZA30955 05770037
         BE    DEBCHKBR           BRANCH TO CHECK DEB          @ZA30955 05770137
         B     FINDTCBA           CONTINUE CHECKING TCBS       @ZA30955 05770237
BACKTCB  EQU   *                                               @ZA30955 05770337
         LR    RX,R5              RESTORE SAVED TCB            @ZA30955 05770437
         CR    R9,RX              TCBS THE SAME                @ZA30955 05770537
         BE    DEBCHKBR           THEN GO TO DEBCHK            @ZA30955 05770637
BACKTCBA EQU   *                                               @ZA30955 05770737
         L     RX,TCBBACK         ADDR OF BACK CHAIN TCB'S     @ZA30955 05770837
         LA    RX,0(RX)           CLEAR HI-ORDER BYTE          @ZA30955 05770937
         LTR   RX,RX              TEST FOR ZERO                @ZA30955 05771037
         USING TCB,RX                                          @ZA30955 05771137
         BZ    ERROR              TCB NOT FOUND THEN ERROR     @ZA30955 05771237
         CR    R9,RX              SAME TCB STOP CHECKING?      @ZA30955 05771337
         BE    DEBCHKBR           TCB VALID -CHECK DEB         @ZA30955 05771437
         B     BACKTCBA           CONTINUE CHECKING TCB'S      @ZA30955 05771537
ERROR    LA    R15,RCIOERR        SET R15 = 8 DEB NOT GOOD     @ZA25435 05771637
         LA    R0,RCDEBERR        SET R0 = 8 DEB NOT GOOD      @ZA25435 05771737
         B     GETOUT             CLEANUP AND LEAVE            @ZA25435 05771837
*                                                              @ZA30955 05771937
*  FOR THE BRANCH ENTRY TO DEBCHK THE REGISTERS ARE            @ZA30955 05772037
*   REG 1  - DEB  ADDR                                         @ZA30955 05772137
*   REG 10 - TCB  ADDR                                         @ZA30955 05772237
*                                                              @ZA30955 05772337
*  UPON RETURN FROM DEBCHK THE REGISTERS WILL HAVE             @ZA30955 05772437
*   REG 1 - VERIFIED DEB ADDR                                  @ZA30955 05772537
*   REG 10 - DEB TABLE POINTER                                 @ZA30955 05772637
*   REG 11 - DEB TABLE OFFSET                                  @ZA30955 05772737
*   REG 14 - RETURN ADDRESS                                    @ZA30955 05772837
*   REG 0-9 AND 12-14 REMAIN UNCHANGED                         @ZA30955 05772937
*                                                              @ZA30955 05773037
DEBCHKBR EQU   *                                               @ZA30955 05773137
         LR    R2,RLIST           SAVE USER LIST ADDR          @ZA30955 05773237
         LR    R5,RDCB            SAVE THE DCB ADDR            @ZA30955 05773337
         L     R1,DCBDEBAD        GET DEB ADDRESS FOR DEBCHK   @ZA30955 05773437
         LR    RGW,RX             REG 10 - TCB ADDR            @ZA30955 05773537
         L     RCVT,CVTPTR        GET CVT ADDR                 @ZA30955 05773637
         USING CVT,RCVT                                        @ZA30955 05773737
         L     R15,CVTEXT2        GET ADDR OF CVT EXTENSION    @ZA30955 05773837
         USING CVTXTNT2,R15                                    @ZA30955 05773937
         L     R15,CVTDEBVR       GET BR ENTRY ADDR FOR DEBCHK @ZA30955 05774037
         BALR  RRET,R15           BRANCH TO DEBCHK             @ZA30955 05774137
         NOP   0                  NOP FOR RETURN FROM DEBCHK   @ZA30955 05774237
         LTR   R15,R15            CHECK DEBCHK RET CODE        @ZA30955 05774337
         BNZ   ERROR              BAD DEB                      @ZA30955 05774437
         LR    RDCB,R5            RESTORE DCB ADDR             @ZA30955 05774537
         LR    RLIST,R2           RESTORE LIST ADDR            @ZA30955 05774637
         LR    RDEB,R1            GET DEB ADDR RETURNED        @ZA30955 05774737
         USING DEBBASIC,RDEB                                   @ZA30955 05774837
         L     R15,DEBDCBAD       GET DCB ADDR FROM DEB        @ZA30955 05774937
         LA    R15,0(R15)         CLEAR HI ORDER BYTE          @ZA30955 05775037
         CR    RDCB,R15           DCB ADDR THE SAME ?          @ZA30955 05775137
         BNE   ERROR              NO THEN ERROR - BAD DEB      @ZA30955 05775237
         TM    DEBPK(R1),KEYMASK    USER'S PROTECT KEY 0       @ZA30955 05775337
         BNZ   GETCOREU           NO BRANCH TO GET CALLER KEY  @ZA30955 05775437
         SR    RDCB,RDCB          RESTORE ZERO DCB ADDR        @ZA30955 05775537
GETSUP   EQU   *                                                        05777837
         MODESET EXTKEY=SUPR      USE SUPERVISOR KEY             Y02072 05777937
         OI    EXSFLG,EXSSYDCB    FLAG THAT SYSTEM DCB USED      Y02072 05778002
         B     GET253             GET S.P. 253 CORE             YM01226 05778502
         SPACE 2                                                        05780002
*********************************************************************** 05800002
*        OBTAIN AND INITIALIZE BLDL/FIND WORK AREA                    * 05820002
*********************************************************************** 05840002
*                                                                       05860002
GETCOREU EQU   *                  GET CORE IN USERS KEY        @ZA12953 05866037
         SR    RDCB,RDCB          RESET ZERO DCB ADDR          @ZA12953 05872037
GETCORE  EQU   *                                                 A25998 05880002
         TM    EXSKEY,KEYMASK     CHECK CALLER KEY              YM01226 05882502
         BNZ   GET229             NOT ZERO - GET S.P. 229       YM01226 05885002
GET253   EQU   *                  GET S.P. 253                  YM01226 05885502
         GETMAIN RC,LV=WORKSZ,SP=253 GET WORKAREA KEY 0         YM01226 05887502
         B     TESTGET            CHECK RETURN CODE             YM01226 05890002
GET229   EQU   *                  GET S.P. 229                  YM01226 05892502
         GETMAIN RC,LV=WORKSZ,SP=229 GET WORKAREA IN CALLER KEY  Y02072 05940002
TESTGET  EQU   *                  CHECK RETURN CODE             YM01226 05940502
         LTR   R15,R15            CHECK RETURN CODE              Y02072 05942002
         BNZ   GETERR             GO TO ERROR ROUTINE            Y02072 05944002
         LR    RAREA,R1           ESTABLISH BASE FOR WORK AREA          05960002
         USING WORKAREA,RAREA                                           05980002
         MODESET EXTKEY=SUPR      GET IN SUPV KEY                Y02072 05982002
         ST    RAREA,EXSWKAD      SAVE CORE ADDR                 Y02072 05984002
         OI    EXSFLG,EXSGTM      FLAG THAT CORE OBTAINED        Y02072 05984402
         TM    EXSFLG,EXSSYDCB    SHOULD WE STAY IN KEY 0?       Y02072 05985402
         BO    COREGOT            YES                            Y02072 05986402
         MODESET KEYADDR=EXSKEY,WORKREG=1   CALLER KEY           Y02072 05988002
COREGOT  EQU   *                                                        05990002
*                                                                       05992002
*        AT THIS POINT THE ROUTINE IS EITHER IN SUPERVISOR KEY AND      05994002
*        HAS ITS WORKAREA IN THAT KEY OR IT IS IN CALLER KEY AND ITS    05996002
*        WORKAREA IS IN CALLER KEY.                                     05998002
*                                                                       05998402
         XC    CLRSEG(WORKSZ-L'RDAREA),CLRSEG   CLEAR WORK AREA         06000002
*                                               EXCEPT READIN PORTION   06020002
         SPACE 2                                                        06040002
         LTR   RDCB,RDCB          IF DCB PTR IS 0 OR POSITIVE           06060002
         BNL   BLDLSVC            THEN GO PROCESS AS BLDL               06080002
*********************************************************************** 06100002
*        ROUTINE TO PROCESS FIND REQUEST                              * 06120002
*        THE FIRST STEP WILL BE TO DO BLDL ON NAME PROVIDED           * 06140002
*********************************************************************** 06160002
*                                                                       06180002
         USING FINDLIST,RLIST                                           06200002
         LCR   RDCB,RDCB          MAKE DCB PTR POSITIVE                 06220002
         MVC   FNDLST1,FINDHDR    INIT BLDL LIST FOR FIND               06240002
         MVC   FNDLST2,FINDNAME   MOVE NAME                             06260002
         DROP  RLIST                                                    06280002
         LA    RLIST,FNDLST1      POINT TO GENERATED BLDL LIST          06300002
         B     ALLENTRY           BRANCH TO EXECUTE 'BLDL'        M4214 06320002
FINDRET  LTR   R15,R15            BYPASS THE FOLLOWING STEP             06340002
         BP    CLEANUP            IF THERE IS AN ERROR ON BLDL          06360002
         TM    EXSFLG,EXSBLDL     IS BLDL BEING PROCESSED?       Y02072 06365002
         BO    CLEANUP            YES - SKIP SYNCH               Y02072 06370002
         SPACE 2                                                        06380002
*********************************************************************** 06400002
*        TTR WAS SUCCESSFULLY FOUND FOR SPECIFIED NAME                * 06420002
*        NOW USE POINT ROUTINE TO POSITION TO REQUESTED MEMBER        * 06440002
*********************************************************************** 06460002
*                                                                       06480002
         USING IHADCB,RDCB                                              06500002
         MVC   DCBRELAD,FNDLST3   MOVE TTR TO RELAD                     06520002
         LR    R0,RDCB            POINT TO RELAD                        06540002
         LR    R1,RDCB            POINT TO DCB                   Y02072 06545002
         SR    RZ,RZ              CLEAR REG                      Y02072 06562002
         IC    RZ,EXSKEY          GET CALLER KEY                 Y02072 06564002
         SRL   RZ,KEYOFFST        MOVE KEY TO LOW ORDER BIT      Y02072 06565002
         LA    RX,PRIVKEY         HIGHEST PRIVLEGED KEY          Y02072 06566002
         CR    RZ,RX              COMPARE KEYS                   Y02072 06568002
         BH    SYNCH              CALLER NOT SYSTEM KEY-SYNCH    Y02072 06570002
BALR     EQU   *                                                 Y02072 06572002
         POINT (1),(0)            ISSUE POINT                    Y02072 06580002
         SR    R15,R15            SET NO ERROR                          06600002
         B     CLEANUP                                           Y02072 06602002
*                                                                       06602202
*        SYNCHRTN GETS CONTROL IN USER KEY AND PROBLEM STATE            06602402
*        IT ISSUES A POINT AND THEN A BR 14 TO RETURN TO THE            06602602
*        SVC.  IT SAVES REG 14 ON ENTRY IN REG RX.                      06602802
*                                                                       06602902
SYNCHRTN EQU   *                                                 Y02072 06603502
         LR    RX,RRET            SAVE RETURN ADDRESS            Y02072 06603702
         POINT (1),(0)            ISSUE POINT                    Y02072 06604402
         LR    RRET,RX            RESTORE RETURN ADDRESS         Y02072 06604602
         BR    RRET               RETURN TO SUPERVISOR           Y02072 06605002
SYNCH    EQU   *                                                 Y02072 06605602
         MODESET EXTKEY=SUPR      KEY 0                          Y02072 06606202
         OI    EXSFLG,EXSYNCH     TURN ON IN SYNCHED RTN FLAG    Y02072 06606802
         ST    RBASE,EXSBASE      SAVE BASE ACROSS SYNCH         Y02072 06607402
         SYNCH SYNCHRTN           SYNCH TO POINT ROUTINE         Y02072 06608002
         DROP                                                           06608402
         L     RCVT,CVTPTR        ADDRESS OF CVT                 Y02072 06608802
         USING CVT,RCVT                                          Y02072 06608902
         L     RRB,CVTTCBP        ADDRESS OF TCB WORDS           Y02072 06609202
         USING TCBPTRS,RRB                                       Y02072 06609302
         L     RRB,TCBPTRC        ADDRESS OF TCB                 Y02072 06609602
         USING TCB,RRB                                           Y02072 06612002
         L     RRB,TCBRBP         ADDRESS OF SVRB                Y02072 06613602
         USING RBBASIC,RRB                                       Y02072 06615702
         NI    EXSFLG,X'FF'-EXSYNCH TURN OFF IN SYNCHED RTN FLAG Y02072 06615902
         L     RBASE,EXSBASE      RESTORE BASE REG               Y02072 06616102
         USING BASE1,RBASE                                       Y02072 06616502
         L     RAREA,EXSWKAD      RESTORE WORKAREA PTR           Y02072 06616902
         USING WORKAREA,RAREA                                    Y02027 06617302
         SR    R15,R15            SET NO ERROR                   Y02072 06617702
         SPACE 2                                                        06620002
CLEANUP  EQU   *                                                 M4214  06625037
         SR    R0,R0              CLEAR REG 0                  @ZA25435 06630037
         SPACE 2                                               @ZA25435 06635037
CLEANUP1 EQU   *                                               @ZA25435 06640037
         LR    R8,R0              SAVE ERROR CODE              @ZA25435 06645037
*********************************************************************** 06660002
*        THIS CODE IS ENTERED AT THE CONCLUSION OF EITHER BLDL OR FIND* 06680002
*        PROCESSING, AND PERFORMS VARIOUS CLEAN-UP FUNCTIONS          * 06700002
*********************************************************************** 06720002
*                                                                       06740002
         LR    RZ,R15             SAVE ERROR CODE                M4214  06760002
*                                                                M3385  06980002
***      FREE THE BLDL/FIND WORK AREA                                   07000002
*                                                                       07020002
         MODESET EXTKEY=SUPR      CHANGE TO KEY ZERO             Y02072 07040002
         NI    EXSFLG,X'FF'-EXSGTM TURN OFF GETMAIN FLAG         Y02072 07045002
         TM    EXSFLG,EXSSYDCB    USING SYSTEM DCB?              Y02072 07060002
         BO    FREECORE           YES DIFFERENT KEY ON FREE     YM01226 07062002
         MODESET KEYADDR=EXSKEY,WORKREG=1 FREE USER KEY CORE     Y02072 07067002
         TM    EXSKEY,KEYMASK     CHECK CALLER KEY              YM01226 07067702
         BNZ   FREE229            NOT ZERO FREE S.P. 229        YM01226 07067802
FREECORE EQU   *                                                YM01226 07067902
         FREEMAIN R,LV=WORKSZ,SP=253,A=(RAREA) KEY ZERO CORE    YM01226 07068002
         B     RETURN             RETURN                        YM01226 07068602
FREE229  EQU   *                  FREE S.P. 229                 YM01226 07069102
         FREEMAIN R,LV=WORKSZ,SP=229,A=(RAREA) USER KEY CORE    YM01226 07069302
RETURN   EQU   *                                                 Y02072 07070002
         LR    R0,R8              RESTORE ERROR CODE           @ZA25435 07070537
         LR    R15,RZ             RESTORE ERROR CODE                    07100002
GETOUT   EQU   *                                                        07100402
         L     RRET,EXSRET        LOAD RETURN ADDRESS            Y02072 07102002
         MODESET EXTKEY=SUPR      RETURN TO SUPERVISOR KEY       Y02072 07103002
         BR    RRET               RETURN TO CALLER               Y02072 07104002
GETERR   EQU   *                  AN INVALID RETURN FROM GETMAIN Y02072 07202002
         LA    R15,RCIOERR        SET RETURN CODE 4 IN REG 15    Y02072 07204002
         LA    R0,RCGETERR        SET RETURN CODE 4 IN REG 0     Y02072 07206002
         B     GETOUT             RETURN TO CALLER               Y02072 07208002
         EJECT                                                          07220002
BLDLSVC  EQU   *                                                        07240002
*********************************************************************** 07260002
*        ROUTINE TO PROCESS SVC ENTRY TO BLDL                         * 07280002
*********************************************************************** 07380002
         USING BLDLIST,RLIST                                            07420002
         SPACE 2                                                        08340002
*********************************************************************** 08360002
*        THIS IS THE BEGINNING OF THE ACTUAL BLDL PROCESSING.         * 08380002
*        IT MAY BE ENTERED DUE TO BLDL SVC OR AS A SUBROUTINE OF FIND.* 08400002
*                                                                     * 08440002
*        BEGIN BY TESTING FOR SPECIAL DCB'S                           * 08460002
*********************************************************************** 08480002
*                                                                       08500002
ALLENTRY LA    RAREA,WORKAREA     CLEAR HI-ORDER BYTE                   08520002
*                                                                       08540002
         L     RX,CVTLINK         LOAD LINKLIB DCB LOC                  08560002
         CR    RX,RDCB            TEST FOR EXPLICIT LINKLIB REQUEST     08580002
         BE    INLINK             IF LINKLIB,INDICATE SO                08600002
*                                                                       08640002
         L     RX,CVTSVDCB        LOAD SVCLIB DCB LOC                   08660002
         CR    RX,RDCB            TEST FOR SVC LIB REQUEST              08680002
         BE    INLINK             IF SVCLIB, INDICATE SO                08700002
NOLNKSVC LTR   RDCB,RDCB          DID USER SUPPLY DCB ADDRESS           08740002
         BP    SETCCWS            YES, NOT LINKLIB/TASKLIB DEFAULT      08760002
*                                 NO, LOOK THROUGH SYS LIBS             08780002
*********************************************************************** 08820002
*        IF A JOBLIB, STEPLIB OR TASKLIB EXISTS,                      * 08840002
*        IT WILL BE FOUND THROUGH THE CURRENT TCB.                    * 08860002
*        OTHERWISE THE SEARCH WILL BEGIN WITH LINKLIB.                * 08880002
*********************************************************************** 08900002
*                                                                       08920002
         MVI   LIB,TASKLIB        START JOBLIB SEARCH          @ZA26444 08940037
         L     RZ,CVTTCBP         FIND TCB POINTERS                     08960002
         USING TCBPTRS,RZ                                               08980002
         L     RZ,TCBPTRC         FIND CURRENT TCB                      09000002
         USING TCB,RZ                                                   09020002
         L     RDCB,TCBJLB        JOBLIB DCB ADDR                       09040002
         DROP  RZ                                                       09060002
         LTR   RDCB,RDCB          IF A JOBLIB DCB EXISTS,               09080002
         BP    SETCCWS            GO PROCESS THE LIBRARY                09100002
         L     RDCB,CVTLINK       OTHERWISE GET LINKLIB DCB ADDR        09120002
         USING IHADCB,RDCB                                              09140002
*                                                                       09160002
***            START SEARCH OF LINKLIB (OR SVCLIB)                      09180002
*                                                                       09200002
INLINK   EQU   *                                                        09220002
         MVI   LIB,LINKSVC        INDICATE SEARCHING LINK OR SVC LIB    09240002
         SPACE 2                                                        09260002
SETCCWS  EQU   *                                                        09280002
*********************************************************************** 09300002
*        SAVE REGISTERS WHICH WILL BE USED IN                         * 09320002
*        RELOCATING CHANNEL PROGRAM                                   * 09340002
*********************************************************************** 09360002
         TM    EXSFLG,EXSSYDCB    ARE WE IN KEY 0?               Y02072 09365002
         BO    CHANKYOK           YES DO STM                     Y02072 09370002
         MODESET EXTKEY=SUPR      NO - GET IN KEY 0              Y02072 09375002
CHANKYOK DS    0H                                                Y02072 09376002
*                                 ******************                    09380002
         STM   R0,R5,EXSSAVE      * SAVE REGISTERS *             Y02072 09400002
         PUSH  USING              * AND USINGS     *                    09420002
*                                 ******************                    09440002
         TM    EXSFLG,EXSSYDCB    SHOULD WE BE IN KEY 0?         Y02072 09445002
         BO    CHAN0OK            YES                            Y02072 09450002
         MODESET KEYADDR=EXSKEY,WORKREG=1 NO GET IN CALLER KEY   Y02072 09455002
CHAN0OK  DS    0H                                                Y02072 09456002
*                                 THE FOLLOWING USING/DROP SEQUENCE     09460002
*                                 IS PRIMARILY TO HIGHLIGHT PUSH/POP    09480002
*                                 IN THE CROSS REFERENCE LISTING.       09500002
         USING DUMMY,R1,RSULEFT,RCVT,RX,RY,RZ,RPDS2,RPDS1,RDEB          09520002
         DROP  R1,RSULEFT,RCVT,RX,RY,RZ,RPDS2,RPDS1,RDEB                09540002
         DROP  RLIST,RDCB                                               09560002
         SPACE 2                                                        09580002
*********************************************************************** 09600002
*        CONSTRUCT CHANNEL PROGRAM, ECB, AND IOB FOR READING          * 09620002
*        DIRECTORY BLOCKS                                             * 09640002
*********************************************************************** 09660002
*                                                                       09680002
         LM    R0,R5,CHANPROG     MOVE AND RELOCATE CHAN PROG    Y02072 09700002
         ALR   RCSID,RAREA        RELOCATE SEARCH ID CCW                09720002
         ALR   RCTIC1,RAREA       RELOCATE FIRST TIC                    09740002
         AR    RCMRC,RAREA        RELOCATE READ COUNT CCW               09760002
         STM   R0,R5,CCW1         MOVE CCW'S                     Y02072 09765002
         LM    R0,R5,SKEH         SECOND HALF                    Y02072 09770002
         AR    RCTIC2,RAREA       RELOCATE SECOND TIC                   09780002
         AR    RCRD,RAREA         RELOCATE READ DATA CCW                09800002
         STM   R0,R5,CCW4                                               09820002
*                                                                       09840002
*              INITIALIZE IOB IN WORK AREA (PREVIOUSLY ZEROED)          09860002
         LA    RY,ECB                                            Y02072 09880002
         ST    RY,IOBECBPT        POINT TO ECB                   Y02072 09900002
         LA    RY,CCW                                            Y02072 09920002
         ST    RY,IOBSTART        POINT TO CHANNEL PROGRAM       Y02072 09940002
         MVI   IOBFLAG1,IOBUNREL+IOBSPSVC  SET NON-RELATED FLAG  Y02072 09960002
*                                          AND NOP APPENDAGES    Y02072 09965002
*                                 *************************             09980002
         LM    R0,R5,EXSSAVE      * RESTORE REGISTERS     *      Y02072 10000002
         POP   USING              * AND PREVIOUS USINGS   *             10020002
*                                 *************************             10040002
         SPACE 2                                                        10060002
*********************************************************************** 10080002
*        CYCLE THROUGH USER'S BLDL LIST, SETTING EACH ENTRY 'EMPTY'   * 10100002
*        THIS IS INDICATED BY RECORD # 0 IN THE ENTRY TTR.            * 10120002
*********************************************************************** 10140002
*                                                                       10160002
         LA    RPDS2,BLDENT       SET TO FIRST ENTRY                    10220002
         USING PDS2,RPDS2                                               10240002
*                                                                       10340002
         TM    EXSFLG,EXSSYDCB+EXSBLDL IS IT USING A SYSTEM DCB  Y02072 10344002
*                                      AND BLDL?                 Y02072 10346002
         BNO   CLRENT             NO USE THE SAME KEY AS THE WKA Y02072 10348002
*                                                                       10348402
*        IF IT IS A SYSTEM DCB AND BLDL WE ARE GOING TO MODIFY   Y02072 10350002
*        THE CALLERS CORE SO WE SWITCH TO CALLER KEY             Y02072 10352002
*                                                                       10354002
         MODESET KEYADDR=EXSKEY,WORKREG=1 CALLER KEY             Y02072 10356002
*              LOOP THROUGH ENTRIES                                     10360002
CLRENT   EQU   *                                               @ZA31343 10380037
         LH    RZ,BLDENTS         PICKUP NO. OF ENTRIES        @ZA31343 10385037
CLRENTA  EQU   *                                               @ZA31343 10390037
         MVI   PDS2TTRP+2,0       ZERO R FIELD                          10400037
         AH    RPDS2,BLDELEN      GO TO NEXT ENTRY IN LIST              10410037
         BCT   RZ,CLRENTA         LOOP THROUGH ALL ENTRIES              10420037
         DROP  RPDS2                                                    10440002
*              END OF LOOP                                              10460002
         TM    EXSFLG,EXSSYDCB+EXSBLDL DID WE CHANGE KEY?        Y02072 10462002
         BNO   SEARCH             NO - CONTINUE                  Y02072 10464002
         MODESET EXTKEY=SUPR      CHANGE BACK TO SUPERVISOR KEY  Y02072 10466002
         EJECT                                                          10480002
SEARCH   EQU   *                                                        10500002
*********************************************************************** 10540002
*              RESIDENT TABLE SEARCH                                  * 10560002
*        THIS ROUTINE SEARCHES THE RESIDENT BLDL TABLES FOR LINKLIB   * 10580002
*        OR SVCLIB AS APPROPRIATE, IF THEY ARE PRESENT.               * 10600002
*        IT USES A BINARY SEARCH FOR THE FIRST ENTRY IN THE USER'S    * 10620002
*        LIST, AND THEN SCANS SEQUENTIALLY FOR THE REMAINING ENTRIES. * 10640002
*        NOTE THAT USER ENTRIES MUST BE IN ALPHAMERIC SEQUENCE.       * 10660002
*********************************************************************** 10680002
*              SPECIAL REGISTER USAGE                                 * 10700002
* 0 RSCUR--- NUMBER OF CURRENT ENTRY IN RES TABLE DURING BINARY SEARCH* 10720002
* 1 RSMOVE-- MOVE LENGTH TO BE USED EXECUTING REMOTE MVC INSTRUCTION  * 10740002
* 4 RSTUB=RX-UPPER BOUNDARY FOR BINARY SEARCH                         * 10760002
* 5 RSTLB=RY-LOWER BOUNDARY FOR BINARY SEARCH                         * 10780002
* 8 RRENT--- POINTER TO CURRENT RESIDENT TABLE ENTRY                  * 10800002
* 9 RRES---- POINTER TO RESIDENT TABLE                                * 10820002
*15 RSTLEFT- NUMBER OF RESIDENT TABLE ENTRIES REMAINING DURING SCAN   * 10840002
*********************************************************************** 10860002
*                                                                       10880002
***            FIRST TEST TO SEE IF RESIDENT TABLE CAN BE USED          10900002
*                                                                       10920002
         CLI   LIB,LINKSVC        IF NOT LINKLIB OR SVCLIB              10940002
         BNE   SRCHPDS            BYPASS RESIDENT TABLE SEARCH          10960002
         L     RRES,IEARESBL      FIND LINKLIB RESIDENT TABLE           10980002
         C     RDCB,CVTLINK       IF LINKLIB IS BEING USED              11000002
         BE    TESTRES            GO AHEAD, OTHERWISE MUST BE SVCLIB    11020002
         MVI   LIB,USERLIB        RESET TO INDICATE NOT LINKLIB         11040002
         L     RRES,IEARESBS      AND FIND SVCLIB RESIDENT TABLE        11060002
TESTRES  LTR   RRES,RRES          IF THE APPROPRIATE TABLE              11080002
         BZ    SRCHPDS            IS NOT PRESENT, GET OUT               11100002
         USING RESTAB,RRES                                              11120002
*                                                                       11140002
***            SET UP LENGTH OF DATA PORTION TO BE MOVED.               11160002
***            THIS MAY BE LIMITED EITHER BY USER OR BY RESIDENT TABLE  11180002
*                                                                       11200002
         CLC   BLDELEN,RESELEN    Q. IS USER LL GT RES TABLE            11220002
         BNH   LEN1               NO, USER LL OK SO FAR                 11240002
         LH    RSMOVE,RESELEN     YES, USE RES TABLE LL                 11260002
         B     LEN3               GO DECREMENT FOR NAME FIELD           11280002
*                                                                       11300002
LEN1     CLI   BLDELEN+1,PDS2MIN  Q. IS USER LL LESS THAN MINIMUM       11320002
         BNL   LEN2               NO, USE USER LL                       11340002
         LA    RSMOVE,PDS2MIN-L'PDS2NAME-1  YES, USE MIN LENGTH         11360002
         B     BINSRCH            GO ON                                 11380002
*                                                                       11400002
LEN2     LH    RSMOVE,BLDELEN                                           11420002
LEN3     LA    RX,L'PDS2NAME+1    CALC LENGTH-1 EXCLUDING NAME          11440002
         SR    RSMOVE,RX                                                11460002
         SPACE 2                                                        11480002
BINSRCH  EQU   *                                                        11500002
*********************************************************************** 11520002
*        BINARY SEARCH OF THE RESIDENT TABLE FOR THE FIRST USER ENTRY * 11540002
*********************************************************************** 11560002
*                                                                       11580002
         BAL   RSUBR,FIRSTMTY     GO TO FIND FIRST EMPTY USER ENTRY     11600002
         USING PDS2,RPDS2                                               11620002
*                                 CONSIDER RESTABLE ENTRIES NUMBERED    11640002
         LH    RSTUB,RESNUM       FROM 0 TO RESNUM-1                    11660002
         BCTR  RSTUB,0            UPPER BOUND IS NUMBER OF LAST ENTRY   11680002
         SR    RSTLB,RSTLB        LOWER BOUND IS NUMBER OF FIRST ENTRY  11700002
*                                                                       11720002
***            CHECK THE ENTRY HALF WAY BETWEEN UPPER AND LOWER BOUNDS  11740002
*                                                                       11760002
BISTART  LA    RSCUR,0(RSTLB,RSTUB)  SET CURRENT AS AVERAGE             11780002
         SRL   RSCUR,HALVE           OF UPPER AND LOWER BOUNDS          11800002
         LR    RRENT,RSCUR        DEVELOP POINTER TO CURRENT ENTRY      11820002
         MH    RRENT,RESELEN      RRENT = RSCUR * RES TABLE LL          11840002
         LA    RRENT,RESENT1(RRENT)       + POSITION OF FIRST ENTRY     11860002
         USING RESENT,RRENT                                             11880002
         CLC   PDS2NAME,RESNAME   COMPARE USER NAME WITH TABLE          11900002
         BH    BHI                IF HIGH, LOOK AHEAD                   11920002
         BE    SCAN               IF CORRECT, THIS IS STARTING POSITION 11940002
*                                 IF LOW, BACK UP                       11960002
***            NAME IS LOWER--RESET UPPER BOUND                         11980002
*                                                                       12000002
         LR    RSTUB,RSCUR                                              12020002
         BCTR  RSTUB,0            USE CURRENT-1 AS UPPER BOUND          12040002
         CR    RSCUR,RSTLB        IF CURRENT WAS STILL ABOVE LOW BOUND  12060002
         BH    BISTART            THEN CONTINUE BINARY SEARCH           12080002
         B     SCAN               OTHERWISE START SCAN HERE             12100002
*                                                                       12120002
***            NAME IS HIGHER--RESET LOWER BOUND                        12140002
*                                                                       12160002
BHI      LR    RSTLB,RSCUR        SET LOWER BOUND AT                    12180002
         LA    RSTLB,1(RSTLB)     CURRENT + 1                           12200002
         CR    RSCUR,RSTUB        IF UPPER BOUND NOT YET HIT,           12220002
         BL    BISTART            CONTINUE SEARCH                       12240002
         SPACE 2                                                        12260002
SCAN     EQU   *                                                        12280002
*********************************************************************** 12300002
*        AT THIS POINT WE ARE POSITIONED FROM THE BINARY SEARCH.      * 12320002
*        IF THE FIRST ENTRY EXISTS, RRENT POINTS TO IT                * 12340002
*        BEGINNING WITH THAT FIRST ENTRY, CODE WILL NOW SCAN RESIDENT * 12360002
*        TABLE, MATCHING ENTRIES AS IT GOES.                          * 12380002
*********************************************************************** 12400002
         LH    RSTLEFT,RESNUM     GET NUMBER OF RESTABLE ENTRIES        12420002
         SR    RSTLEFT,RSCUR      REMAINING TO BE SCANNED               12440002
*                                                                       12460002
***            COMPARE USER ENTRY WITH RESIDENT TABLE ENTRY             12480002
*                                                                       12500002
COMP     CLC   PDS2NAME,RESNAME   COMPARE NAMES                         12520002
         BE    FOUND              IF MATCH, GO FILL ENTRY               12540002
         BH    NEXTRES            IF USER HIGH, CONTINUE SCAN           12560002
*                                 IF USER LOW, ENTRY NOT PRESENT        12580002
         MVI   ERCODE,ERRNAME     SET ERROR CODE--NAME NOT FOUND        12600002
         BAL   RSUBR,NEXTUSER     GO TO NEXT USER ENTRY                 12620002
         B     COMP                                                     12640002
         SPACE 2                                                        12660002
*********************************************************************** 12680002
*        THIS SUBROUTINE SCANS FOR EMPTY USER ENTRIES                   12700002
*         IT HAS TWO ENTRY POINTS:                                      12720002
*              FIRSTMTY RESETS TO THE BEGINNING OF THE USER LIST,     * 12740002
*                       THEN SCANS TO THE FIRST ENTRY NOT YET FILLED  * 12760002
*              NEXTUSER SCANS FORWARD FROM CURRENT ENTRY TO NEXT      * 12780002
*                       ONE WHICH HAS NOT YET BEEN FILLED             * 12800002
*        IT NORMALLY RETURNS (ON RSUBR) AFTER UPDATING RPDS2 TO POINT * 12820002
*        TO THE NEW USER ENTRY.  HOWEVER, WHEN IT REACHES THE END OF  * 12840002
*        THE USER LIST, IT EXITS TO THE NORMAL DIRECTORY SEARCH.      * 12860002
*********************************************************************** 12880002
*                                                                       12900002
FIRSTMTY MVI   ERCODE,0           RESET ERROR INDICATION                12920002
         LH    RSULEFT,BLDENTS    RESET USER ENTRY COUNT                12940002
         LA    RPDS2,BLDENT       START WITH FIRST USER ENTRY           12960002
*                                                                       12980002
NXTEMPTY CLI   PDS2TTRP+2,0       Q. IS THIS ENTRY EMPTY                13000002
         BER   RSUBR              YES - RETURN WHENCE YOU CAME          13020002
*                                 NO-GET NEXT USER ENTRY                13040002
***            ENTRY POINT TO GET NEXT UNFILLED ENTRY                   13060002
*                                                                       13080002
NEXTUSER AH    RPDS2,BLDELEN      INCREMENT TO NEXT USER ENTRY          13100002
         BCT   RSULEFT,NXTEMPTY   IF MORE ENTRIES, GO CHECK FOR EMPTY   13120002
         B     ENDRES             ELSE START NORMAL DIRECTORY SEARCH    13140002
         SPACE 2                                                        13160002
*********************************************************************** 13180002
*        A MATCHING ENTRY HAS BEEN FOUND--FILL IT IF APPROPRIATE      * 13200002
*********************************************************************** 13220002
*                                                                       13240002
FOUND    CLI   RESREC,0           IS R OF RES TABLE TTR = 0             13260002
         BE    NOFILL             YES - DON'T PERFORM MOVE              13280002
         TM    EXSFLG,EXSSYDCB+EXSBLDL SYSTEM DCB & BLDL?        Y02072 13282002
         BNO   FOUND1             NO - KEY OK                    Y02072 13284002
         DROP  RCVT               MODESET WORKREG IS RCVT        Y02072 13285002
         MODESET KEYADDR=EXSKEY,WORKREG=3 GET IN CALLER KEY      Y02072 13286002
         L     RCVT,CVTPTR        RESTORE CVT POINTER            Y02072 13288002
         USING CVT,RCVT                                          Y02072 13289002
FOUND1 EQU     *                                                 Y02072 13290002
         EX    RSMOVE,RESMOVE     NO - MOVE ENTRY                       13300002
         TM    EXSFLG,EXSSYDCB+EXSBLDL WAS KEY CHANGED?          Y02072 13302002
         BNO   NEXT               NO - CONTINUE                  Y02072 13304002
         MODESET EXTKEY=SUPR      MODESET BACK TO SUPR KEY       Y02072 13306002
         B     NEXT               AND CONTINUE PROCESSING               13320002
*********EXECUTED INSTRUCTION****************************************** 13340002
RESMOVE  MVC   PDS2TTRP(0),RESDATA    EXECUTED IN 'FOUND' ABOVE         13360002
*********EXECUTED INSTRUCTION****************************************** 13380002
         SPACE 2                                                        13400002
*                                                                       13420002
***            IF R OF RES TABLE TTR IS 0, IGNORE ENTRY                 13440002
*                                                                       13460002
NOFILL   MVI   ERCODE,ERRNAME     SET ERROR CODE--NAME NOT FOUND        13480002
NEXT     BAL   RSUBR,NEXTUSER     GET NEXT USER ENTRY                   13500002
*                                                                       13520002
***            GO TO NEXT ENTRY IN RESIDENT TABLE IF NOT EXHAUSTED      13540002
*                                                                       13560002
NEXTRES  AH    RRENT,RESELEN      INCREMENT TO NEXT RES TABLE ENTRY     13580002
         BCT   RSTLEFT,COMP       IF MORE ENTRIES, CONTINUE PROCESSING  13600002
*                                 ELSE CURRENT ENTRY NOT MATCHED        13620002
         DROP  RRES,RRENT                                               13640002
         MVI   ERCODE,ERRNAME     SET ERROR CODE--NAME NOT FOUND        13660002
         SPACE 2                                                        13680002
*********************************************************************** 13700002
*        SCAN OF RESIDENT TABLE IS NOW COMPLETE                       * 13720002
*        CHECK TO SEE IF MORE PROCESSING IS NEEDED                    * 13740002
*********************************************************************** 13760002
*                                                                       13780002
ENDRES   CLI   ERCODE,0           WERE ALL USER NAMES FOUND             13800002
         BNE   SRCHPDS            IF NOT, TRY DA SEARCH                 13820002
         SR    R15,R15            SET RETURN CODE TO ZERO         M3385 13840002
         B     FINDRET            RETURN                         Y02072 13860002
         EJECT                                                          13880002
*********************************************************************** 13900002
*              SEARCH PDS DIRECTORY FOR REMAINING ENTRIES             * 13920002
*        BEGIN BY CONVERTING THE TTR AT WHICH SEARCH IS TO BEGIN      * 13940002
*        (NORMALLY 000) INTO AN MBBCCHHR. THIS IS DONE BY CALLING     * 13960002
*        IECPCNVT.                                                    * 13980002
*********************************************************************** 14000002
*                                                                       14020002
SRCHPDS  EQU   *                                                        14040002
         BAL   RSUBR,FIRSTMTY     FIND FIRST EMPTY USER ENTRY           14060002
         SR    R0,R0              START AT BEGINNING OF DIRECTORY       14100002
*                                                                       14120002
***            ENTRY HERE FOR TTR SUPPLIED BY CALLER                    14140002
***            TTR IS ALREADY LOADED IN R0                              14160002
*                                                                       14180002
SRCHTTR  IC    R0,CONCAT#         GET CONCATENATION NUMBER              14200002
         TM    EXSFLG,EXSSYDCB    ARE WE IN KEY 0?               Y02072 14205002
         BO    SRCHKYOK           YES - DO STM                   Y02072 14210002
         MODESET EXTKEY=SUPR      NO - GET IN KEY 0              Y02072 14215002
SRCHKYOK DS    0H                                                Y02072 14216002
*                                 ******************                    14220002
         STM   R9,R15,EXSSAVE     * SAVE REGISTERS *             Y02072 14240002
         ST    RGMBB,EXSRG2       ******************             Y02072 14260002
         TM    EXSFLG,EXSSYDCB    SHOULD WE BE IN KEY 0?         Y02072 14265002
         BO    SRCH0OK            YES - CONTINUE                 Y02072 14270002
         TM    CVTOPTA,CVTNIP     TEST FOR NIP IN CONTROL      @ZA30955 14271037
         BO    SRCH0OK            YES - CONTINUE               @ZA30955 14271137
         L     RDEB,DCBDEBAD      GET DEB ADDRESS              @ZA30955 14271237
         USING DEBBASIC,RDEB                                   @ZA30955 14271337
         L     R9,0(RDEB)         LOAD THE TCB ADDR FROM DEB   @ZA30955 14271437
         LA    R9,0(R9)           CLEAR HI-ORDER BYTE          @ZA30955 14271537
         LTR   R9,R9              TCB PRESENT ?                @ZA30955 14271637
         BZ    ERROR2             NO ERROR                     @ZA30955 14274137
         L     RZ,CVTTCBP         GET TCB POINTERS             @ZA30955 14274237
         USING TCBPTRS,RZ                                      @ZA30955 14274337
         L     RZ,TCBPTRC         FIND CURRENT TCB             @ZA30955 14274437
         LR    RX,RZ              LOAD CURRENT TCB INTO REG4   @ZA30955 14274537
         DROP  RZ                                              @ZA30955 14274637
FINDTCB3 EQU   *                                               @ZA30955 14274737
         USING TCB,RX                                          @ZA30955 14274837
         LR    R5,RX              SAVE ORIGINAL TCB ADDR       @ZA30955 14274937
FINDTCBB EQU   *                                               @ZA30955 14275037
         L     RX,TCBTCB          ADDR OF NEXT TCB ON QUEUE    @ZA30955 14275137
         LA    RX,0(RX)           CLEAR HI-ORDER BYTE          @ZA30955 14275237
         LTR   RX,RX              HIGHEST TCB ?                @ZA30955 14275337
         USING TCB,RX                                          @ZA30955 14275437
         BZ    BACKTCB2           CHECK BACK TCB CHAIN         @ZA30955 14275537
         CR    R9,RX              COMPARE CURRENT TCB WITH     @ZA30955 14275637
*                                 TCBS ON TCB QUEUE            @ZA30955 14275737
         BE    DEBCHKB2           BRANCH TO CHECK DEB          @ZA30955 14275837
         B     FINDTCBB           CONTINUE CHECKING TCBS       @ZA30955 14275937
BACKTCB2 EQU   *                                               @ZA30955 14276037
         LR    RX,R5              RESTORE ORIGINAL TCB         @ZA30955 14276137
         CR    R9,RX              TCBS THE SAME                @ZA30955 14276237
         BE    DEBCHKB2           THEN GO TO DEBCHK RTN        @ZA30955 14276337
BACKTCBC EQU   *                                               @ZA30955 14276437
         L     RX,TCBBACK         ADDR OF BACK CHAIN TCB'S     @ZA30955 14276537
         LA    RX,0(RX)           CLEAR HI-ORDER BYTE          @ZA30955 14276637
         LTR   RX,RX              TEST FOR ZERO                @ZA30955 14276737
         USING TCB,RX                                          @ZA30955 14276837
         BZ    ERROR2             TCB NOT FOUND THEN ERROR     @ZA30955 14276937
         CR    R9,RX              SAME TCB STOP CHECKING?      @ZA30955 14277037
         BE    DEBCHKB2           TCB VALID -CHECK DEB         @ZA30955 14277137
         B     BACKTCBC           CONTINUE CHECKING TCB'S      @ZA30955 14277237
ERROR2   LA    R15,RCIOERR        SET R15 = 8 DEB NOT GOOD     @ZA30955 14277337
         LA    R0,RCDEBERR        SET R0 = 8 DEB NOT GOOD      @ZA30955 14277437
         B     CLEANUP1           CLEANUP AND LEAVE            @ZA30955 14277537
DEBCHKB2 EQU   *                                               @ZA30955 14277637
         LR    R5,RDCB            SAVE THE DCB ADDR            @ZA30955 14277737
         L     R1,DCBDEBAD        GET DEB ADDRESS              @ZA30955 14277837
         LR    RGW,RX             REG 10 - TCB ADDR            @ZA30955 14277937
         L     RCVT,CVTPTR        GET CVT ADDR                 @ZA30955 14278037
         USING CVT,RCVT                                        @ZA30955 14278137
         L     R15,CVTEXT2        GET CVT EXTENSION ADDR       @ZA30955 14278237
         USING CVTXTNT2,R15                                    @ZA30955 14278337
         L     R15,CVTDEBVR       GET BR ENTRY ADDR OF DEBCHK  @ZA30955 14278437
         BALR  RRET,R15           BRANCH TO DEBCHK             @ZA30955 14279437
         NOP   0                  NOP FOR RETURN FROM DEBCHK   @ZA30955 14280437
         LTR   R15,R15            CHECK DEBCHK COND CODE       @ZA30955 14281437
         BNZ   ERROR2             BAD DEB                      @ZA30955 14287037
         LR    RDCB,R5            RESTORE RDCB ADDR            @ZA30955 14288037
         LR    RDEB,R1            GOOD DEB ADDR                @ZA30955 14289037
         USING DEBBASIC,RDEB                                   @ZA30955 14290037
         L     R15,DEBDCBAD       GET DCB ADDR FROM GOOD DEB   @ZA30955 14291037
         LA    R15,0(R15)         CLEAR HI-ORDER BYTE          @ZA30955 14292037
         CR    RDCB,R15           SAME DCB ADDRESSES ?         @ZA30955 14293037
         BNE   ERROR2             NO - ERROR BAD DEB           @ZA30955 14294037
         TM    DEBPK(R1),KEYMASK  USER'S PROTECT KEY 0 ?       @ZA30955 14295037
         BZ    SRCH0OK            YES - CONTINUE               @ZA30955 14296037
         MODESET KEYADDR=EXSKEY,WORKREG=9 NO SHIFT TO CALLER KEY Y02072 14297037
SRCH0OK  DS    0H                                                Y02072 14298037
         L     RGDEB,DCBDEBAD     GET ADDRESS OF DEB                    14299037
         LA    RGMBB,IOBSEEK      POINT TO LOC FOR RESULT MBBCCHHR      14300002
         LA    R15,IECPCNVT       CALL TTR CONVERT ROUTINE              14380002
         BALR  RRET,R15                                                 14400002
         LTR   R15,R15            WAS USER TTR VALID?                   14420002
*                                 *********************                 14440002
         LM    R9,R15,EXSSAVE     * RESTORE REGISTERS *          Y02072 14460002
         L     RGMBB,EXSRG2       *********************          Y02072 14480002
         BNZ   BADIO              IF TTR WAS INVALID, CALL IT I/O ERROR 14540002
         ST    RDCB,IOBDCBPT      OTHERWISE FINISH IOB (DCB ADDRESS)    14560002
         SPACE 2                                                        14580002
*********************************************************************** 14600002
*        READ IN BLOCK WHICH SHOULD CONTAIN CURRENT ENTRY             * 14620002
*        THE CHANNEL PROGRAM WILL SEARCH ON KEY FOR THE FIRST BLOCK   * 14640002
*        HAVING AN ENTRY HIGHER OR EQUAL TO CURRENT USER ENTRY NAME   * 14660002
*********************************************************************** 14680002
*                                                                       14700002
READ     STCM  RPDS2,ADDR3,CCWKEYPT   POINT TO NAME SEARCHING FOR       14720002
         EXCP  IOBSTDRD           READ IN THE CORRECT BLOCK             14740002
         TM    ECB,COMPLETE       DID ECB GET POSTED?          @ZA12201 14840037
         BO    BYWAIT             BYPASS WAIT SVC              @ZA12201 14845037
         WAIT  ECB=ECB            ELSE WAIT FOR COMPLETION              14850037
BYWAIT   EQU   *                  ECB HAS BEEN POSTED          @ZA12201 14855037
         TM    ECB,COMPLETE+NORMAL  CHECK COMPLETE AND NO-ERROR BITS    14860002
         BO    GOODIO             IF NO ERRORS, GO AHEAD                14900002
*                                 ELSE COMPLETE WITH ERROR              14920002
BADIO    LA    R15,RCIOERR        SET I/O ERROR CODE                    14940002
         B     FINDRET            RETURN                         Y02072 14960002
         SPACE 2                                                        14980002
GOODIO   EQU   *                                                        15000002
*********************************************************************** 15020002
*              SCAN DIRECTORY BLOCK                                   * 15040002
*        BEGIN BY SETTING UP SCAN LIMITS                              * 15060002
*********************************************************************** 15080002
         LA    RPDS1,PDBENT1      SET START ADDR                        15100002
         USING PDS1,RPDS1                                               15120002
MORESCAN LH    RY,PDBUSE          SET UP RY TO STOP SCAN                15140002
         AR    RY,RAREA           AT END OF IN USE PORTION              15160002
         BCTR  RY,0               BACK UP TO LAST VALID BYTE            15180002
         LA    RZ,PDS2LUSR        SET MASK FOR C BYTE                   15200002
*                                                                       15220002
***            CHECK THIS ENTRY                                         15240002
*                                                                       15260002
CMPARE   CLC   PDS1NAME,PDS2NAME  COMPARE NAMES                         15280002
         BE    DFOUND             IF FOUND, GO FILL ENTRY               15300002
         BL    NAMELO             IF LOW CONTINUE SEARCH         Y02072 15320002
*                                                                       15321002
***            NOT IN THIS DIRECTORY                                    15322002
*                                                                       15323002
         MVI   ERCODE,ERRNAME     SET ERROR CODE 4               Y02072 15325002
         B     UNFILLED           GO GET NEXT USER ENTRY         Y02072 15330002
*                                                                       15340002
***            DIRECTORY NAME LOW--GO TO NEXT DIRECTORY ENTRY           15360002
*                                                                       15380002
NAMELO   EQU   *                                                 Y02072 15385002
         IC    RX,PDS1INDC        GET DE FIELD LENGTH (HALFWORDS)       15400002
         NR    RX,RZ              MASK OFF FLAG BITS                    15420002
         LA    RX,PDS1USRD-PDS1(RX,RX)   ENTIRE ENTRY LENGTH IN BYTES   15440002
*        THE FOLLOWING BXLE ADDS RX TO RPDS1 AND COMPARES WITH RY       15460002
*        IT REQUIRES THAT RX-RY BE AN EVEN-ODD PAIR                     15480002
         BXLE  RPDS1,RX,CMPARE    LOOP IF MORE ENTRIES IN BLOCK         15500002
         MVC   CCHHR,NEWCNT       ELSE SET SEARCH ARG FOR CHANNEL       15520002
*                                 PROGRAM TO CONTINUE SCAN              15540002
         B     READ               AND GO ISSUE EXCP                     15560002
         SPACE 2                                                        15580002
*********************************************************************** 15600002
*        CORRECT ENTRY FOUND -- MOVE IT INTO USER LIST                * 15620002
*********************************************************************** 15640002
*                                                                       15660002
*********EXECUTED INSTRUCTION****************************************** 15680002
MOVE     MVC   PDS2USRD-1(0),PDS1USRD-1   EXECUTED AT E BELOW           15700002
*********EXECUTED INSTRUCTION****************************************** 15720002
*                                                                       15740002
DFOUND   MVC   PDS2TTRP,PDS1TTRP  MOVE TTR                              15760002
         IC    RX,PDS1INDC        GET C FROM DIRECTORY                  15780002
         NR    RX,RZ              MASK OFF FLAG BITS                    15800002
         LA    RY,PDS2USRD-PDS2   LENGTH OF ENTRY STANDARD PORTION      15820002
         LCR   RY,RY              TO BE SUBTRACTED FROM TOTAL LENGTH    15840002
         AH    RY,BLDELEN         YIELDING LENGTH TO MOVE               15860002
         BM    NOMOVE             BYPASS MOVE IF NEGATIVE               15880002
*              THE FOLLOWING BXLE DOUBLES THE DIRECTORY ENTRY LENGTH    15900002
*              IN RX TO CONVERT FROM HALFWORDS TO BYTES, AND USES IT    15920002
*              IF IT IS NOT GREATER THAN THE USER ENTRY LENGTH.         15940002
         BXLE  RX,RX,EXEC                                               15960002
*                                 DROPS THROUGH IF DIRECTORY LENGTH     15980002
*                                 IS GREATER.                           16000002
         LR    RX,RY              IN THIS CASE TAKE USER LENGTH         16020002
EXEC     EQU   *                                                        16040002
         TM    EXSFLG,EXSSYDCB+EXSBLDL SYSTEM DCB AND BLDL?      Y02072 16041702
         BNO   EXEC1              NO KEY CHANGE NOT NEEDED       Y02072 16041802
         DROP  RCVT               MODESET WORKREG IS RCVT        Y02072 16042502
         MODESET KEYADDR=EXSKEY,WORKREG=3 SET TO CALLER KEY      Y02072 16043202
         L     RCVT,CVTPTR        RESTORE CVT POINTER            Y02072 16043902
         USING CVT,RCVT                                          Y02072 16044102
EXEC1    EQU   *                                                        16044302
         EX    RX,MOVE            MOVE USER DATA + INDC BYTE            16045902
         TM    EXSFLG,EXSSYDCB+EXSBLDL KEY CHANGED ?             Y02072 16047902
         BNO   EXEC3              NO - CONTINUE                  Y02072 16049902
         MODESET EXTKEY=SUPR      YES - RETURN TO SUPR KEY       Y02072 16051902
EXEC3    EQU   *                                                        16053902
         SR    RX,RX              CLEAR REG                    @ZA26444 16060037
         IC    RX,LIB             JOBLIB Z BYTE                @ZA26444 16062037
         TM    LIB,JOBLIB         JOBLIB                       @ZA26444 16064037
         BZ    MOVEZ              MOVE Z BYTE                  @ZA26444 16066037
         SRL   RX,4               SHIFT OUT LOWER BIT          @ZA26444 16068037
MOVEZ    EQU   *                                               @ZA26444 16070037
         STC   RX,PDS2LIBF        MOVE LIB # TO USER Z FIELD   @ZA26444 16072037
NOMOVE   IC    RX,CONCAT#         GET CONCATENATION NUMBER              16080002
         STC   RX,PDS2CNCT        PUT IT INTO USERS LIST                16100002
         B     UNFILLED           GO GET NEXT USER ENTRY                16120002
         SPACE 2                                                        16140002
*********************************************************************** 16160002
*        THIS ROUTINE FINDS THE NEXT UNFILLED USER ENTRY              * 16180002
*        IT IS ENTERED AT LABEL 'UNFILLED'                            * 16200002
*********************************************************************** 16220002
*                                                                       16240002
UNFIL2   AH    RPDS2,BLDELEN      GO TO NEXT ENTRY                      16260002
         CLI   PDS2TTRP+2,0       IF IT HAS NOT BEEN FILLED,            16280002
         BE    MORESCAN           THEN GO PROCESS IT             Y02072 16300002
UNFILLED BCT   RSULEFT,UNFIL2     BRANCH IF THERE ARE MORE LIST ENTRIES 16320002
*                                                                       16340002
***      END OF LIST REACHED -- CHECK FOR ANY OMISSIONS                 16360002
*                                                                       16380002
         SR    R15,R15                                                  16400002
         IC    R15,ERCODE         GET ANY SAVED ERROR                   16420002
         LTR   R15,R15            TEST FOR ERROR,                A27543 16440002
         BZ    FINDRET            BR IF NOT TO RETURN            Y02072 16460002
         SPACE 2                                                        16480002
*********************************************************************** 16500002
***      DETERMINE WHETHER OR NOT THERE ARE CONCATENATED DATA    A28189 16520002
***      SETS IN WHICH TO SEARCH FOR A MEMBER. THIS CAN BE       A28189 16540002
***      DONE ONLY IF THE DATA SET IS PARTITIONED AND HAS BEEN   A28189 16560002
***      OPENED FOR INPUT.                                       A28189 16580002
*********************************************************************** 16600002
*                                                                A28189 16620002
         L     RDEB,DCBDEBAD      GET DEB ACCESS METHOD LENGTH          16640002
         USING DEBBASIC,RDEB                                            16660002
         CLC   DEBAMLNG,CONCAT#   TEST FOR MORE DATA SETS,       A28189 16680002
         BH    CNCK               IF LONGER, GO CHECK OPEN TYPE  A28189 16700002
         TM    LIB,JOBLIB         TEST FOR JOBLIB DCB,         @ZA26444 16720037
         BZ    FINDRET            BR IF NOT BACK TO COMMON     @ZA26444 16730037
*                                                                       16740037
***            SEARCH FOR DISTINCT TASK LIBS TO CONCATENATE             16750037
*                                                                       16760037
         L     RZ,CVTTCBP         FIND TCB POINTERS            @ZA26444 16770037
         USING TCBPTRS,RZ                                      @ZA26444 16780037
         L     RZ,TCBPTRC         FIND CURRENT TCB             @ZA26444 16790037
         USING TCB,RZ                                          @ZA26444 16800037
         L     RX,TCBJLB          JOBLIB DCB ADDR              @ZA26444 16810037
         SR    R0,R0              CLEAR REG                    @ZA26444 16820037
         IC    R0,LIB             GET LIBRARY FLAG             @ZA26444 16830037
         MVI   LIB,TASKLIB        MOVE IN TASKLIB FLAG         @ZA26444 16840037
         SRL   R0,4               STRIP OFF LIB IND            @ZA26444 16850037
         BCTR  R0,0               SET LOOP CONTROL             @ZA26444 16860037
TAGZ1    EQU   *                                               @ZA26444 16870037
         CR    RX,RDCB            IS THIS DCB SAME AS          @ZA26444 16880037
*                                 ONE WE JUST SEARCHED         @ZA26444 16890037
         BNE   TAGZ3              NO BRANCH                    @ZA26444 16900037
TAGZ2    EQU   *                                               @ZA26444 16910037
         IC    R15,LIB            ADD 1 TO TOP NIBBLE OF       @ZA26444 16920037
         LA    R15,16(R15)        LIBFLAG BYTE INDICATES       @ZA26444 16930037
         STC   R15,LIB            WHICH TCB LEVEL CURRENT      @ZA26444 16940037
         L     RZ,TCBOTC          LOAD MOTHER TCB              @ZA26444 16950037
         LTR   RZ,RZ              IS THE MOTHER TCB ZERO       @ZA27485 16953037
         BZ    TAGH                NO GO SEARCH LINKLIB        @ZA27495 16956037
         L     RX,TCBJLB          GET JOBLIB FOR MOTHER        @ZA26444 16960037
         LTR   RX,RX              DOES MOTHER HAVE JOBLIB      @ZA26444 16970037
         BZ    TAGH               NO GO SEARCH LINKLIB         @ZA26444 16980037
         B     TAGZ1              YES, GO ON                   @ZA26444 16990037
TAGZ3    EQU   *                                               @ZA26444 17000037
         BCT   R0,TAGZ2           IF NEW DCB PICKED UP &       @ZA26444 17010037
*                                 ITS NOT 1ST, LOOP AROUND TO  @ZA26444 17020037
*                                 UPDATE LIBFLAG BEFORE START  @ZA26444 17030037
*                                 DIRECTORY SEARCH OF THIS LIB @ZA26444 17040037
         LR    RDCB,RX            UPDATE TO NEW DCB            @ZA26444 17050037
         B     CAT8               GO BEGIN DIRECTORY SEARCH    @ZA26444 17060037
*                                                              @ZA26444 17070037
TAGH     EQU   *                                               @ZA26444 17080037
*                                                              @ZA26444 17090037
*              JOBLIB SEARCH COMPLETED                         @ZA26444 17100037
*                                                              @ZA26444 17110037
         MVI   LIB,LINKSVC        START LINKLIB SEARCH         @ZA26444 17120037
         L     RDCB,CVTLINK       LINKLIB DCB ADDR                      17420002
*                                                                       17440002
CAT8     SR    RX,RX              RESET CONCATENATION # TO ZERO   M4612 17460002
         B     STORCAT            PREPARE TO SEARCH NEW LIBRARY         17480002
         SPACE 2                                                        17500002
*********************************************************************** 17520002
*              POSSIBLE CONCATENATION WITHIN DEB                      * 17540002
*        ACCESS METHOD SECTION LENGTH INDICATES THERE MAY BE MORE     * 17560002
*        CONCATENATED DATA SETS WITHIN THIS DEB.                      * 17580002
*        FOR BPAM INPUT THIS SECTION HAS ONE BYTE PER DATA SET.       * 17600002
*        FIRST VERIFY THAT DEALING WITH BPAM INPUT.                   * 17620002
*********************************************************************** 17640002
CNCK     EQU   *                                                  13547 17660002
         TM    LIB,LINKSVC+JOBLIB   CHECK FOR LINKLIB OR JOBLIB   13547 17680002
         BM    CATINCR            IS BPAM IF EITHER               13547 17700002
         TM    DCBDSORG,DCBDSGPO  TEST FOR PARTITIONED DATA SET, A28189 17720002
         BNO   FINDRET            BR IF NOT TO RETURN            Y02072 17740002
         TM    DEBOPATB,DEBACCS   TEST FOR INPUT,                A28189 17760002
         BNZ   FINDRET            BR IF NOT TO RETURN            Y02072 17780002
         DROP  RDEB                                               22232 17800002
*                                                                       17820002
***            INCREMENT CONCATENATION NUMBER                           17840002
*                                                                       17860002
CATINCR  SR    RX,RX              CLEAR REGISTER                        17880002
         IC    RX,CONCAT#         PICK UP PREVIOUS CONCAT NR            17900002
         LA    RX,1(RX)           ADD ONE                               17920002
*                                                                       17940002
***      STORE UPDATED CONCAT NR AND RESET SCAN OF USER LIST            17960002
*                                                                       17980002
STORCAT  STC   RX,CONCAT#                                               18000002
         BAL   RSUBR,FIRSTMTY     RESTART SCAN OF USER LIST             18020002
         B     SEARCH             BEGIN SEARCH AGAIN                    18040002
         DROP  RAREA,RCVT,RPDS2,RPDS1,RDCB,RBASE,RLIST                  18740002
         EJECT                                                          18740402
*                                                                       18740802
*        BOOTSTRAP ROUTINE.  ENTERED FROM RTM ON AN ATTEMPT TO          18741202
*        ABNORMALLY TERMINATE IGC018.  THIS ROUTINE FINDS AND           18741602
*        BRANCHES TO THE TASK RECOVERY ROUTINE - IGCT0018.              18741702
*                                                                       18741802
EXITRTN  IGGSTAE TRR              BOOTSTRAP ROUTINE              Y02072 18742002
         EJECT                                                          18760002
*********************************************************************** 18780002
*              CONSTANTS                                              * 18800002
*********************************************************************** 18820002
PATCH    DC    XL50'00'           PATCH AREA                   @ZA12201 18830037
DECREC   DC    H'256'             USED TO DECREMENT R OF TTR BY 1       18840002
FINDHDR  DC    H'1',AL2(FNDENTSZ)   FIND'S BLDL LIST HEADER             18860002
TRR      DC    CL8'IGCT0018'      TRR NAME                       Y02072 18862002
IEARESBS DC    F'0'               LOC OF RES BLDL SVC-LIB-TABLE         18900002
IEARESBL DC    F'0'               LOC OF RES BLDL LINKLIB TABLE         18920002
         ENTRY IEARESBL           EXTERNAL SYMBOL FOR NIP               18940002
         ENTRY IEARESBS           EXTERNAL SYMBOL FOR NIP               18960002
ESTAEL   ESTAE EXITRTN,RECORD=YES,MF=L LIST TO MOVE TO RB        Y02072 18965002
*                                                                       18980002
***            CHANNEL PROGRAM                                          19000002
*                                                                       19020002
CHANPROG DS    0D                                                       19040002
*CCW1                             SEARCH ID EQUAL                       19060002
         CCW   SIDEQ,CCHHR-WORKAREA,CCHN,L'CCHHR                        19080002
*CCW2                             TRANSFER IN CHANNEL                   19100002
         CCW   TIC,CCW1-WORKAREA,0,0                                    19120002
*CCW3                             MULTI-TRACK READ COUNT                19140002
         CCW   MRC,NEWCNT-WORKAREA,CCHN,L'NEWCNT                        19160002
*CCW4                             SEARCH KEY HIGH OR EQUAL              19180002
SKEH     CCW   SKHEQ,0,CCHN,L'PDS2NAME                                  19200002
*CCW5                             TRANSFER IN CHANNEL                   19220002
         CCW   TIC,CCW3-WORKAREA,0,0                                    19240002
*CCW6                             READ DATA                             19260002
         CCW   RD,RDAREA-WORKAREA,0,L'RDAREA                            19280002
         EJECT                                                          19300002
*********************************************************************** 19320002
*                                                                     * 19340002
*IECPRLTV-- MBBCCHHR TO TTR0 CONVERT ROUTINE                          * 19360002
*REGISTER CONVENTION--                                                * 19380002
*        0     CONTAINS RESULT TTR0                                   * 19400002
*        1     ADDRESS OF DEB                                         * 19420002
*        2     ADDRESS OF MBBCCHHR INPUT                              * 19440002
*        3-8   TRANSPARENT                                            * 19460002
*        9-13  VOLATILE                                               * 19480002
*        14    RETURN ADDRESS                                         * 19500002
*        15    ENTRY ADDRESS-- USED FOR BASE                          * 19520002
*********************************************************************** 19540002
         SPACE 3                                                        19560002
         ENTRY IECPRLTV                                                 19580002
         USING IECPRLTV,R15                                             19600002
         USING SEEKA,RGMBB                                              19620002
IECPRLTV SR    RGTTR,RGTTR        CLEAR OUTPUT REGISTER                 19640002
         LR    RGZ,RGDEB          USED LATER TO INDEX THRU EXTENTS      19660002
         USING DEBBASIC,RGZ                                             19680002
         SR    RGY,RGY                                                  19700002
         IC    RGY,SEEKM          PICKUP M                              19720002
         TM    DEBOFLGS,DEBPOCAT  CHECK FOR PDS CONCATENATION      5798 19740002
         BZ    RLTVZ              BR. IF NOT                       5798 19760002
         SPACE 2                                                        19780002
*********************************************************************** 19800002
*              FOR PDS CONCATENATION, THE DEB CONTAINS EXTENTS FOR    * 19820002
*              ALL DATA SETS.  THE BPAM SECTION OF THE DEB HAS A      * 19840002
*              SERIES OF ONE-BYTE ENTRIES INDICATING THE FIRST        * 19860002
*              EXTENT NUMBER FOR EACH DATA SET (AFTER THE FIRST).     * 19880002
*              THE FOLLOWING CODE SCANS THE BPAM SECTION BACKWARD     * 19900002
*              TO FIND WHICH DATA SET CONTAINS THE USER SPECIFIED     * 19920002
*              EXTENT NUMBER.                                         * 19940002
*********************************************************************** 19960002
         SR    RGV,RGV            ZERO OUT REGISTER                5798 19980002
         IC    RGV,DEBNMEXT       GET NUMBER OF EXTENTS            5798 20000002
         SLL   RGV,TIMES16        MULTIPLY BY 16                   5798 20020002
         AR    RGV,RGDEB          POINT TO DEB, BYPASSING BASIC    5798 20040002
         SR    RGW,RGW                                                  20060002
         IC    RGW,DEBAMLNG       GET LENGTH OF DEB A/M SECTION  A28189 20080002
*                                 THIS IS 1 LESS THAN NUMBER            20100002
*                                 OF CONCATENATED DATA SETS             20120002
         DROP  RGZ                                                 5798 20140002
*                                                                       20160002
***            ADDRESS BPAM SECTION THROUGH REGISTER WHICH HAS          20180002
***            NOT BEEN INCREMENTED PAST BASIC SECTION                  20200002
***            (BUT DOES BYPASS EXTENTS)                                20220002
*                                                                       20240002
         USING DEBACSMD-(DEBBASND-DEBBASIC),RGV                    5798 20260002
         SR    RGX,RGX            GET FIRST M FOR DATA SET N FROM  5798 20280002
RLTVX    IC    RGX,DEBEXTNM-1(RGW)  (N-1)TH BYTE OF BPAM SECTION   5798 20300002
         CR    RGY,RGX            COMPARE WITH USERS M             5798 20320002
         BNL   RLTVY              BR. IF CORRECT DATA SET          5798 20340002
         BCT   RGW,RLTVX          BR. IF ANOTHER D.S. TO CHECK     5798 20360002
         SR    RGX,RGX            M OF FIRST DATA SET IS ZERO      5798 20380002
RLTVY    SR    RGY,RGX            ADJUST USERS M TO EXTENT IN DS   5798 20400002
         SLL   RGX,TIMES16        ADJUST DEB PTR AS IF FIRST       5798 20420002
         AR    RGZ,RGX            EXTENT OF DESIRED DATA SET WERE  5798 20440002
*                                 FIRST EXTENT IN DEB                   20460002
         DROP  RGV                                                 5798 20480002
         USING DEBDASD-(DEBBASND-DEBBASIC),RGZ                     5798 20500002
RLTVZ    EQU   *                                                   5798 20520002
         LTR   RGY,RGY            IF M IS ZERO                          20540002
         BZ    RLTVB              WE ARE NOW IN THE CORRECT EXTENT      20560002
*                                 OTHERWISE GET NEXT EXTENT             20580002
RLTVA    AH    RGTTR,DEBNMTRK     NO. OF TRKS IN EXT                    20600002
         LA    RGZ,DEBDASIZ(RGZ)  GO TO NEXT EXTENT                     20620002
         BCT   RGY,RLTVA          LOOP TILL WE REACH RIGHT EXTENT       20640002
RLTVB    BAL   RGW,CNVTDVC        PICKUP DEVICE CONSTANT                20680002
         USING DVCT,RGY                                                 20700002
         SR    RGW,RGW                                                  20720002
         IC    RGW,SEEKCC         GET FIRST CC BYTE                     20740002
         SLA   RGW,8              SHIFT FOR NEXT CC BYTE                20760002
         IC    RGW,SEEKCC+1       GET ACTUAL C                          20780002
         SH    RGW,DEBSTRCC       MINUS START CC                        20800002
         MH    RGW,DVCTRK         MULTIPLY CYL TIMES TRK/CYL            20820002
         IC    RGX,SEEKHH+1       GET ACTUAL H                          20840002
         AR    RGW,RGX            PLUS TRKS IN CC                       20860002
         SH    RGW,DEBSTRHH       MINUS START HH                        20880002
         AR    RGTTR,RGW          DEVELOP TOTAL TT                      20900002
         SLL   RGTTR,8            SHIFT OVER ONE BYTE                   20920002
         IC    RGTTR,SEEKR        PICKUP R                              20940002
         SLL   RGTTR,8            ALIGH TTR0 IN REGISTER                20960002
         SR    R15,R15            SET NORMAL RETURN CODE                20980002
         BR    RRET               RETURN                                21000002
         DROP  RGZ                                                      21020002
         EJECT                                                          22040002
*********************************************************************** 22060002
*IECPCNVT--- TTRN TO MBBCCHHR CONVERT ROUTINE                         * 22080002
*                                                                     * 22100002
*THIS ROUTINE WILL CONVERT RELATIVE TRACK TT                          * 22120002
*        TO ABSOLUTE TRACK MBBCCHH                                    * 22140002
*REGISTER CONVENTION--                                                * 22160002
*        0     CONTAINS TTRN, WHERE N IS CONCATENATION NO.            * 22180002
*        1     ADDRESS OF DEB                                         * 22200002
*        2     ADDRESS OF 8 BYTE FIELD FOR RESULT MBBCCHHR            * 22220002
*        3-8   TRANSPARENT                                            * 22240002
*        9-13  VOLATILE                                               * 22260002
*        14    RETURN ADDRESS                                         * 22280002
*        15    ENTRY ADDRESS-- USED FOR BASE                          * 22300002
*********************************************************************** 22320002
         ENTRY IECPCNVT                                                 22340002
         USING DEBBASIC,RGDEB                                           22400002
         USING IECPCNVT,R15                                             22420002
IECPCNVT SR    RGV,RGV                                                  22440002
         IC    RGV,DEBNMEXT       NUMBER OF EXTENTS                     22460002
         LR    RGW,RGV            USE FOR LIMIT                         22480002
         LA    RGZ,LOBYTE         SET UP MASK FOR LOW BYTE ONLY         22500002
         NR    RGZ,RGTTR          CONCATENATION NUMBER (N)              22520002
         BZ    CNVTA              Q. N IS ZERO                          22540002
         DROP  RGDEB                                                    22560002
         LR    RGY,RGV            NUMBER OF EXTENTS                     22580002
         SLL   RGY,TIMES16        TIMES 16                              22600002
         AR    RGY,RGZ            ADD N                                 22620002
*                                                                       22640002
***            ADDRESS BPAM SECTION THROUGH REGISTER WHICH POINTS TO    22660002
***            BASIC SECTION BUT IS INDEXED BY RGY TO BYPASS EXTENTS    22680002
*                                                                       22700002
         USING DEBACSMD-(DEBBASND-DEBBASIC),RGDEB                       22720002
         IC    RGZ,DEBEXTNM-1(RGY)      FIRST M OF DATA SET N FROM      22740002
*                                       (N-1)ST BYTE OF BPAM SECTION    22760002
         DROP  RGDEB                                                    22780002
         SR    RGW,RGZ            ADJUST LIMIT                          22800002
         SLL   RGZ,TIMES16        TIMES 16                              22820002
CNVTA    AR    RGZ,RGDEB          ADJUST DEB PTR                        22840002
         USING DEBDASD-(DEBBASND-DEBBASIC),RGZ                          22860002
         SRL   RGTTR,8            SHIFT OUT CONCAT# LEAVING 0TTR        22880002
         STC   RGTTR,SEEKR        SAVE R                                22900002
         LA    RGDEB,0(RGDEB)     CLEAR HI BYTE                  S20076 22920002
         SRL   RGTTR,8            SHIFT OUT R LEAVING TT                23160002
CNVTB    SH    RGTTR,DEBNMTRK     DECREASE BY TRKS IN EXTENT            23180002
         BM    CNVTC              Q. PROPER EXTENT                      23200002
         LA    RGZ,DEBDASIZ(RGZ)  GO TO NEXT EXTENT                     23220002
         BCT   RGW,CNVTB          Q. STILL WITHIN DEB                   23240002
         LA    R15,CNVTERR        SET ERROR CODE                        23300002
         BR    RRET               RETURN                                23320002
CNVTC    SR    RGV,RGW            DEVELOP M                             23340002
         STC   RGV,SEEKM          STORE M                               23360002
         MVC   SEEKBCH,DEBBINUM   MOVE BBCCHH FROM DEB                  23380002
         AH    RGTTR,DEBNMTRK     ADD BACK OVERDRAW                     23420002
         BZ    CNVTEND            IF ZERO, NO DIVIDE NEEDED             23440002
         BAL   RGW,CNVTDVC        PICK UP DEVICE CONSTANT               23460002
         USING DVCT,RGY                                                 23480002
         LH    RGV,DVCTRK         GET TRACKS/ CYL                       23500002
         LR    RGX,RGTTR          DIVIDE REG                            23520002
         AH    RGX,DEBSTRHH       STARTING HH                           23540002
         SR    RGW,RGW            CLEAR HIGH WORD                       23560002
         DR    RGW,RGV            QUO=CYLS, REM=TRKS                    23580002
         STC   RGW,SEEKHH+1       STORE H                               23600002
         AH    RGX,DEBSTRCC       PLUS CC START                         23620002
         STC   RGX,SEEKCC+1       STORE C                               23640002
         SRA   RGX,8              SHIFT FOR HIGH C                      23660002
         STC   RGX,SEEKCC         GET BYTE                              23680002
CNVTEND  SR    R15,R15            SET NORMAL RETURN CODE                23700002
         BR    RRET               RETURN                                23720002
*                                                                       23740002
***            PICKUP LOCATION OF APPROPRIATE DEVICE CONSTANTS          23760002
*                                                                       23780002
CNVTDVC  L     RGY,DEBDVMOD       CB ADDRESS                            23800002
         USING UCB,RGY                                                  23820002
         LA    RGX,DVCTYPMK       MASK                                  23840002
         N     RGX,UCBTYP         DEVICE TYPE CODE                      23860002
         L     RGY,CVTPTR         GET CVT ADDR                          23880002
         USING CVT,RGY                                                  23900002
         L     RGY,CVTZDTAB       GET DEVICE TABLE                      23920002
         USING DVCTI,RGY                                                23940002
         IC    RGX,DVCTIOFF(RGX)  GET DEVICE OFFSET                     23960002
         AR    RGY,RGX            GET DEVICE ENTRY                      23980002
         DROP  RGY                                                      24000002
         BR    RGW                RETURN TO CALLER                      24020002
         TITLE ' IGC018 - IEC0SCR1 - SECTOR CONVERT ROUTINE'            28200002
IEC0SCR1 CSECT                                                          28220002
*                                                                       28240002
**********************************************************************  28260002
*                                                                       28280002
*        RELEASE 22 DELETIONS                                           28300002
*        RELEASE 21 DELETIONS                                           28320002
*        RELEASE 20 DELETIONS                                           28340002
*                                                                       28360002
* FUNCTION     THIS ROUTINE CONVERTS THE RECORD NUMBER OF A FIX-        28380002
*              ED OR VARIABLE LENGTH RECORD DATA SET INTO THE           28400002
*              CORRESPONDING SECTOR VALUE FOR USE WITH AN I/O           28420002
*              DEVICE HAVING THE ROTATIONAL POSITION SENSING            28440002
*              (RPS) FEATURE.                                           28460002
*                                                                       28480002
* INPUT FOR FIXED LENGTH RECORDS --                                     28500002
*            - REGISTER 0 IS LOADED WITH A FOUR-BYTE VALUE IN           28520002
*              THE FORM OF 'DDKR' WHERE 'DD' IS A TWO-BYTE FIELD        28540002
*              CONTAINING THE PHYSICAL BLOCK SIZE, 'K' IS A ONE         28560002
*              BYTE FIELD CONTAINING THE KEY LENGTH, AND 'R' IS         28580002
*              THE RECORD NUMBER FOR WHICH A SECTOR VALUE IS            28600002
*              DESIRED.                                                 28620002
*            - REGISTER 2 CONTAINS THE ONE-BYTE UCB DEVICE TYPE         28640002
*              CODE (UCB + 19) IN THE HIGH ORDER BYTE, AND THE          28660002
*              REMAINING 3 BYTES ARE THE ADDRESS OF A ONE BYTE          28680002
*              AREA THAT IS TO RECEIVE THE SECTOR VALUE.                28700002
*            - REGISTER 14 CONTAINS THE ADDRESS TO WHICH CONTROL        28720002
*              IS TO BE RETURNED AFTER EXECUTION OF THE SECTOR          28740002
*              CONVERT ROUTINE.                                         28760002
*            - REGISTER 15 CONTAINS THE ADDRESS OF THE ENTRY            28780002
*              POINT TO THIS ROUTINE AND IS USED AS A BASE              28800002
*              REGISTER.                                                28820002
*       FOR VARIABLE LENGTH RECORDS --                                  28840002
*            - REGISTER 0 IS LOADED WITH A FOUR-BYTE VALUE IN THE       28860002
*              FORM OF BBIR, WHERE BB IS THE TOTAL NUMBER OF KEY        28880002
*              AND DATA BYTES UP TO BUT NOT INCLUDING THE TARGET        28900002
*              RECORD, I IS A ONE-BYTE KEY INDICATOR ( 1 FOR KEYED      28920002
*              RECORDS, 0 FOR NON-KEYED RECORDS), AND R IS THE SAME     28940002
*              AS FOR FIXED LENGTH RECORDS.  THE HIGH ORDER BIT OF      28960002
*              THIS REGISTER MUST BE TURNED ON TO INDICATE VLR.         28980002
*            - REGISTERS 2, 14, 15 ARE THE SAME AS FOR FIXED LENGTH     29000002
*              RECORDS.                                                 29020002
*                                                                       29040002
* OUTPUT       THE SECTOR VALUE CORRESPONDING TO THE RECORD             29060002
*              NUMBER PASSED TO THE CONVERT ROUTINE IN THE LOW-         29080002
*              ORDER BYTE OF REGISTER 0 IS PLACED AT THE ADDRESS        29100002
*              INDICATED REGISTER 2.                                    29120002
*              REGISTERS 0,9,10, AND 11 ARE MODIFIED AND NOT RESTORED.  29140002
*                                                                       29160002
* EXIT         CONTROL IS RETURNED TO THE ADDRESS PASSED IN REG-        29180002
*              ISTER 14.                                                29200002
*                                                                       29220002
* ATTRIBUTES   REENTRANT                                                29240002
*                                                                       29260002
**********************************************************************  29280002
**********************************************************************  29340002
*        GENERAL REGISTER USAGE                                      *  29360002
**********************************************************************  29380002
*                                                                       29400002
RPAR1    EQU   0                  INPUT PARAMETER REG.                  29420002
RPAR2    EQU   2                  INPUT PARAMETER REG.                  29440002
RDVCT    EQU   9                  ADDR OF DEVICE ENTRY                  29460002
RWK1     EQU   10                 WORK REGISTER                         29480002
RWK2     EQU   11                 WORK REGISTER                         29500002
RETRG    EQU   14                 POINTS TO PLACE OF RETURN             29520002
BASRG    EQU   15                 BASE REGISTER                         29540002
         SPACE 3                                                        29560002
**********************************************************************  29580002
*              SHIFT DISPLACEMENT EQUATES                            *  29600002
**********************************************************************  29620002
*                                                                       29640002
SHFT1    EQU   8                  NO. BITS FOR 1-BYTE SHIFT             29660002
SHFT2    EQU   16                 BITS FOR TWO-BYTE SHIFT               29680002
SHFT3    EQU   24                 NO. BITS FOR 3-BYTE SHIFT             29700002
SHFT4    EQU   32                 BITS FOR FOUR-BYTE SHIFT              29720002
         EJECT                                                          29760002
**********************************************************************  29780002
*        CALCULATE EFFECTIVE BLOCK LENGTH                            *  29800002
**********************************************************************  29820002
*                                                                       29840002
         USING *,R15              ESTABLISH ADDRESSABILITY              29860002
         USING SECTAREA,RPAR2                                           29880002
         STC   RPAR1,SECTAREA     SAVE RECORD # IN SECTOR AREA          29960002
         CLI   SECTAREA,0         DOES R=0 ?                            29980002
         BER   RRET               IF YES, RETURN                        30000002
         LTR   RWK1,RPAR1         VARIABLE-LENGTH RECORDS ?             30020002
         BM    VLR                BRANCH IF YES                         30040002
         SRDL  RWK1,SHFT2         PUT KEYLEN AND RECNO INTO RWK2        30060002
         SRL   RWK2,SHFT3         PUT K IN LOW ORDER BYTE               30080002
         AR    RWK1,RWK2          KEY LENGTH + DATA LENGTH              30100002
         SRDL  RWK1,SHFT4         CLEAR 1, PUT SUM IN 2                 30120002
         IC    RWK1,SECTAREA      GET R                                 30140002
         BCTR  RWK1,0             SUBTRACT 1 FROM R                     30160002
         MR    RWK1,RWK1          (R-1)*(KL+DL) INTO RWK2               30180002
*                                                                       30200002
**********************************************************************  30220002
*        CALCULATE NUMBER OF BYTES ON TRACK PRIOR TO RECORD 'R'      *  30240002
**********************************************************************  30260002
*                                                                       30280002
HERE     EQU   *                                                        30300002
         LR    RWK1,RPAR1         PUT PARAM.S IN WORK REG.              30320002
         LR    RPAR1,RWK2         SAVE TOTAL SO FAR                     30340002
         L     RWK2,CVTPTR        GET CVT ADDRESS                       30360002
         USING CVT,RWK2                                                 30380002
         L     RDVCT,CVTZDTAB     GET DCT INDEX TABLE ADDR              30400002
         USING DVCTI,RDVCT                                              30420002
         DROP  RWK2                                                     30440002
         LR    RWK2,RPAR2                                               30460002
         SRL   RWK2,SHFT3         GET DEVICE CODE                       30480002
         IC    RWK2,DVCTIOFF(RWK2) GET DCT INDEX BYTE                   30500002
         AR    RDVCT,RWK2         GET DCT ENTRY ADDRESS                 30520002
         USING DVCT,RDVCT                                               30540002
         SRDL  RWK1,SHFT2         SHIFT OUT K&R                         30560002
         SRL   RWK2,SHFT3         PUT K IN LOW ORDER BYTE               30580002
         LR    RWK1,RWK2          PUT K IN RWK1 ALSO                    30600002
         IC    RWK2,DVCOVNLB      GET BLOCK OVERHEAD                    30620002
         TM    DVCFLAGS,DVC2BOV   IS THIS A TWO BYTE DEVICE             30640002
         BZ    ONEBYTE            BRANCH IF ONE BYTE                    30660002
         LH    RWK2,DVCOVHD       GET BLOCK OVERHEAD                    30680002
ONEBYTE  EQU   *                                                        30700002
         LTR   RWK1,RWK1          KEYED RECORDS ?                       30720002
         BP    KEYED              BRANCH IF YES                         30740002
         IC    RWK1,DVCOVNK       GET SUBTRACTION FACTOR                30760002
         SR    RWK2,RWK1          SUBTRACT FOR NO KEY                   30780002
KEYED    EQU   *                                                        30800002
         IC    RWK1,SECTAREA      GET R                                 30820002
         BCTR  RWK1,0             SUBTRACT ONE FROM R                   30840002
         MR    RWK1,RWK1          (R-1)(Y-K)                            30860002
         AH    RWK2,DVCOVR0       ADD RECORD 0 OVERHEAD                 30880002
         AR    RWK2,RPAR1         ADD BB OR K+DD                        30900002
*                                                                       30920002
**********************************************************************  30940002
*        CALCULATE AND STORE THE SECTOR VALUE, RETURN                *  30960002
**********************************************************************  30980002
*                                                                       31000002
         IC    RWK1,DVCSECTD      GET NUMBER OF SECTORS                 31020002
         MR    RWK1,RWK1          (#SECTORS)(TOTAL SO FAR)              31040002
         LH    RPAR1,DVCTRKLN     TRACK CAPACITY                        31060002
         DR    RWK1,RPAR1         DIVIDE TOTAL BY TRACK CAP             31080002
         STC   RWK2,SECTAREA      STORE SECTOR                          31100002
         BR    RETRG              RETURN                                31120002
VLR      EQU   *                                                        31140002
         SLL   RWK1,1             SHIFT OUT SIGN                        31160002
         SRL   RWK1,SHFT2+1       SHIFT OUT I&R                         31180002
         LR    RWK2,RWK1          MATCH REG. SETUP                      31200002
         B     HERE                                                     31220002
         DROP  R15,RPAR2,RDVCT                                          31240002
         EJECT                                                          31260002
         TITLE ' IGC018 - DSECTS LOCAL TO THIS MODULE'                  33880002
WORKAREA DSECT                                                          33900002
*********************************************************************** 33920002
*        THIS DSECT DESCRIBES THE AREA OBTAINED BY GETMAIN AS A WORK  * 33940002
*        AREA FOR THIS MODULE.                                        * 33960002
*        (FOR BRANCH ENTRY THE WORK AREA IS PASSED TO BLDL)           * 33980002
*********************************************************************** 34000002
*                                                                       34020002
***            THE FIRST SECTION IS USED PRIMARILY TO READ              34040002
***            DIRECTORY BLOCKS BUT IS ALSO USED AS A SAVE AREA         34060002
*                                                                       34080002
RDAREA   DS    CL256              SPACE FOR ONE DIRECTORY BLOCK         34100002
         ORG   RDAREA             REDEFINE AS DIRECTORY BLOCK           34120002
PDBUSE   DS    H                  NUMBER OF BYTES USED IN BLOCK         34140002
PDBENT1  EQU   *                  START OF RIRST ENTRY                  34160002
         ORG                                                            34180002
*                                                                       34200002
***            THE NEXT SECTION CONTAINS THE CHANNEL PROGRAM            34220002
***            AND ASSOCIATED CONTROL FIELD                             34240002
*                                                                       34260002
CLRSEG   DS    0C                 BEGINNING OF SEGMENT TO CLEAR         34280002
NEWCNT   DS    C'CCHHRKDD'        COUNT FIELD READ                      34300002
*                                                                       34320002
CCW      DS    0D                 CHANNEL PROGRAM                       34340002
CCW1     DS    D                  SID=   CCHHR(5)                       34360002
CCW2     DS    D                  TIC    CCW1                           34380002
CCW3     DS    D                  RC(MT) NEWCNT(8)                      34400002
CCW4     DS    D                  SKH=   MEMBER(8)                      34420002
         ORG   CCW4                                                     34440002
         DS    C                  OP CODE                               34460002
CCWKEYPT DS    AL3                USER MEMBER NAME PTR                  34480002
         ORG                                                            34500002
CCW5     DS    D                  TIC    CCW3                           34520002
CCW6     DS    D                  RD     RDAREA(256)                    34540002
*                                                                       34560002
***            THE FOLLOWING WORD CONTAINS FLAGS AND STATUS             34580002
***            INFORMATION CONTROLLING THE PROCESSING OF BLDL           34600002
*                                                                       34620002
ERCODE   DS    XL1                RETURN CODE TO BE SET                 34640002
ERRNAME  EQU   4                  NAME NOT FOUND IN DIRECTORY           34660002
CONCAT#  DS    FL1                CONCAT NUMBER CURRENTLY SEARCHING     34680002
LIB      DS    FL1                TYPE OF LIBRARY NOW SEARCHING         34700002
USERLIB  EQU   0                  USER LIBRARY                          34720002
LINKSVC  EQU   1                  SYSTEM LINK LIBRARY                   34740002
JOBLIB   EQU   2                  USER JOB LIBRARY OR STEP LIBRARY      34760002
NOLIB    EQU   3                  LINK AND JOB/STEP ALREADY SEARCHED    34780002
TASKLIB  EQU   X'22'              TASKLIB FLAG                @ZA26444  34790037
*                                                                       34800002
***            THE NEXT SECTION CONTAINS THE IOB AND ECB FOR EXCP       34820002
*                                                                       34840002
ECB      DS    F                                                        34860002
COMPLETE EQU   X'40'              POSTED COMPLETE BY IOS                34880002
NORMAL   EQU   X'20'              ON IF NO ERRORS ON I/O                34900002
         SPACE                                                          34920002
         ORG   *-16               DO NOT USE IOB PREFIX                 34940002
*        IEZIOB DSECT=NO          MACRO GENERATED WITH PRINT NOGEN      34960002
         PRINT NOGEN                                                    34980002
         IEZIOB DSECT=NO                                                35000002
         PRINT GEN                                                      35020002
         ORG   IOBCC              REDEFINE PART OF SEEK FIELD           35040002
CCHHR    DS    C'CCHHR'                                                 35060002
*                                                                       35080002
***            THE FOLLOWING SECTION IS USED BY FIND TO BUILD           35100002
***            A PARAMETER LIST WHICH WILL BE INPUT TO BLDL             35120002
*                                                                       35140002
FNDLST1  DS    F                  COUNT AND LENGTH FIELDS               35160002
FNDLST2  DS    CL8                MEMBER NAME                           35180002
FNDLST3  DS    F                  SPACE FOR TTR                         35200002
FNDENTSZ EQU   *-FNDLST2          SIZE OF FIND'S BLDL LIST      YM01287 35220002
*                                                                       35240002
WORKSZ   EQU   *-WORKAREA                                               35380002
         EJECT                                                          35400002
SEEKA    DSECT                                                          35420002
*********************************************************************** 35440002
*        THIS DSECT DESCRIBES THE 8 BYTE IOS SEEK FIELD (MBBCCHHR)    * 35460002
*********************************************************************** 35480002
SEEKM    DS    XL1                EXTENT NUMBER                         35500002
SEEKBCH  DS    0XL6               BIN, CYL, AND HEAD NR.                35520002
SEEKBB   DS    XL2                BIN NUMBER                            35540002
SEEKCC   DS    XL2                CYLINDER NUMBER                       35560002
SEEKHH   DS    XL2                HEAD NUMBER                           35580002
SEEKR    DS    X                  RECORD NUMBER                         35600002
         SPACE 3                                                        35620002
BLDLIST  DSECT                                                          35640002
*********************************************************************** 35660002
*        THIS DSECT DESCRIBES THE HEADER PORTION OF A BLDL PARM LIST  * 35680002
*********************************************************************** 35700002
BLDENTS  DS    H                  NUMBER OF ENTRIES IN BLDL LIST        35720002
BLDELEN  DS    H                  LENGTH OF EACH ENTRY                  35740002
BLDHDSZ  EQU   *-BLDLIST          LENGTH OF HEADER                      35760002
BLDENT   DS    0C                 OFFSET TO FIRST ENTRY                 35780002
         SPACE 3                                                        35800002
FINDLIST DSECT                                                          35820002
*********************************************************************** 35840002
*        PARAMETER LIST FOR FIND                                      * 35860002
*********************************************************************** 35880002
FINDNAME DS    CL8                MEMBER NAME FOR FIND                  35900002
         SPACE 3                                                        35920002
TCBPTRS  DSECT                                                          35940002
*********************************************************************** 35960002
*        THIS DSECT DESCRIBES THE TCB POINTERS BLOCK                  * 35980002
*        THIS BLOCK IS FOUND THROUGH CVTTCBP                          * 36000002
*********************************************************************** 36020002
TCBPTRN  DS    A                  NEXT TCB TO DISPATCH                  36040002
TCBPTRC  DS    A                  CURRENT TCB                           36060002
         SPACE 3                                                        36080002
RESTAB   DSECT                                                          36100002
*********************************************************************** 36120002
*        THIS DSECT DESCRIBES THE HEADER PORTION OF A RESIDENT TABLE  * 36140002
*        THE SVC AND LINK RESIDENT TABLES ARE LOCATED THROUGH         * 36160002
*        ADDRESSES PLACED IN BLDL (IEARESBS AND IEARESBL) DURING NIP  * 36180002
*********************************************************************** 36200002
RESNUM   DS    H                  NUMBER OF ENTRIES IN TABLE            36220002
RESELEN  DS    H                  LENGTH OF EACH ENTRY                  36240002
RESENT1  DS    0C                 START OF FIRST ENTRY                  36260002
         SPACE 3                                                        36280002
RESENT   DSECT                                                          36300002
*********************************************************************** 36320002
*        THIS DSECT DESCRIBES AN ENTRY IN THE RESIDENT TABLE          * 36340002
*********************************************************************** 36360002
RESNAME  DS    CL8                MEMBER NAME                           36380002
RESDATA  DS    0C                 BEGINNING OF DATA AREA                36400002
RESTT    DS    H                  TRACK NUMBER OF FIRST BLOCK           36420002
RESREC   DS    C                  RECORD NUMBER ON TRACK OF FIRST BLOCK 36440002
         SPACE 3                                                        36460002
SECTOR   DSECT                                                          36480002
*********************************************************************** 36500002
*        DSECT OF PARAMETER PASSED TO SECTOR CONVERT ROUTINE          * 36520002
*********************************************************************** 36540002
SECTAREA DS    C                  ONE BYTE SECTOR NUMBER                36560002
         SPACE 3                                                        36580002
*********************************************************************** 36600002
DUMMY    DSECT ,                  USED ONLY TO FORCE REGISTER XREF      36620002
         TITLE ' IGC018 - DSECTS INVOKED FROM MACLIB'                   37400002
         CVT   DSECT=YES                                                37420002
         EJECT                                                          37440002
         DCBD  DSORG=PS,DEVD=DA                                         37660002
         EJECT                                                          37662002
         IEZDEB                                                         37680002
         EJECT                                                          37682002
         IHARB                                                          37700002
         EJECT                                                          37702002
         IKJTCB                                                         37720002
         EJECT                                                          37760002
*********************************************************************** 37780002
*        THE FOLLOWING DEFINITIONS ARE ADDED LOCALLY TO THE DSECT     * 37800002
*        THEY SHOULD BE REMOVED WHEN THE CORRESPONDING FUNCTIONS      * 37820002
*        HAVE BEEN INCLUDED IN THE MAPPING MACRO                      * 37840002
*********************************************************************** 37860002
DEBDASD  DSECT                    RESUME END OF DSECT IN MACRO          37880002
DEBDASIZ EQU   *-DEBDASD          LENGTH OF DASD EXTENSION              37900002
DEBPOCAT EQU   BIT7               IN DEBOFLGS--OPENED TYPORG=PO,        37920002
*                                 AND CONCATENATED                      37940002
*                                                                       37942002
*        THIS DSECT MAPS IGC018'S USE OF THE EXTENDED SAVE AREA         37944002
*                                                                       37946002
RBPRFX   DSECT                                                          37948002
         ORG   RBEXSAVE                                                 37948402
EXSKEY   DS    FL1                KEY OF CALLER                         37950002
EXSFLG   DS    X                  FLAG BYTE                             37952002
EXSSYDCB EQU   X'80'              USING SYSTEM DCB                      37954002
EXSGTM   EQU   X'40'              WORK AREA STILL HELD                  37956002
EXSBLDL  EQU   X'20'              BLDL BEING PROCESSED NOT FIND         37958002
EXSYNCH  EQU   X'10'              IN SYNCHED ROUTINE                    37958202
         DS    XL2                UNUSED                                37958402
EXSWKAD  DS    A                  WORKAREA ADDRESS                      37958802
EXSRET   DS    A                  RETURN ADDRESS                        37959202
EXSBASE  DS    A                  BASE SAVED IF SYNCH PERFORMED  Y02072 37959602
EXSRG2   DS    1F                 SAVE REG 2 DURING IECPCNVT     Y02072 37959702
EXSSAVE  DS    7F                 REG SAVE AREA DURING CCW RELOC Y02072 37959802
*                                 AND IECPCNVT                   Y02072 37961002
         ORG   EXSSAVE                                           Y02072 37962502
EXSESTAE ESTAE EXITRTN,RECORD=YES,MF=L ESTAEL LIST IN RB         Y02072 37963702
EXSELEN  EQU   *-EXSESTAE                                        Y02072 37964902
         EJECT                                                          37969902
         IHADVCT                                                        37980002
         EJECT                                                          38000002
         IHAPDS                                                         38020002
         SPACE 2                                                        38040002
*********************************************************************** 38060002
*        THE FOLLOWING DEFINITIONS ARE ADDED LOCALLY TO THE DSECT     * 38080002
*        THEY SHOULD BE REMOVED WHEN THE CORRESPONDING FUNCTIONS      * 38100002
*        HAVE BEEN INCLUDED IN THE MAPPING MACRO                      * 38120002
*********************************************************************** 38140002
PDS2MIN  EQU   PDS2LIBF-PDS2      MINIMUM ALLOWABLE USER LENGTH         38160002
         EJECT                                                          38180002
*********************************************************************** 38200002
*        THE FOLLOWING DSECT IS LOCAL TO THIS MODULE,                 * 38220002
*        BUT APPEARS HERE SINCE IT IS DEPENDENT ON IHAPDS.            * 38240002
*        IHAPDS CAN BE MADE TO EXPAND IN THE DIRECTORY ENTRY FORM     * 38260002
*        (WITHOUT BYTES ADDED BY BLDL), BUT LABELS IN THE TWO         * 38280002
*        EXPANSIONS CONFLICT, SO THAY CANNOT BOTH BE USED.            * 38300002
*********************************************************************** 38320002
*                                                                       38340002
PDS1     DSECT ,                  DIRECTORY ENTRY WITHOUT BLDL BYTES    38360002
PDS1NAME DS    CL(L'PDS2NAME)     MEMBER NAME                           38380002
PDS1TTRP DS    0CL(L'PDS2TTRP)    FIRST BLOCK TTR                       38400002
PDS1TT   DS    H                  TRACK NUMBER                          38420002
PDS1REC  DS    FL1                RECORD NUMBER                         38440002
PDS1INDC DS    B                  INDICATOR BYTE                        38460002
PDS1USRD DS    0C                 START OF USER DATA                    38480002
         EJECT                                                          38500002
         IHASDWA                                                        38502002
         EJECT                                                          38504002
UCB      DSECT                                                          38520002
         IEFUCBOB                                                       38540002
         END                                                            38560002
