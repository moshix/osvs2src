   TITLE 'IGC0209H SVC 98 (PROTECT) THIRD LOAD - DSCB UPDATE ROUTINE'   00100020
IGC0209H CSECT                                                          00300020
*        VS2 037 CHANGES                                                00300237
*A279000,A341000                                               @ZA18970 00300337
*C130900,423000,425000                                         @ZA26554 00300437
*A114000,114400,490000,490500,500500                           @ZA26554 00300537
*                                                                       00300637
*        VS2 030  SU                                                    00300737
*                                                                       00300837
*0000289300,489720                                             @ZA02651 00300937
*                                                                       00301037
*0000005500,304000-307000,309000,312000-316000                 @ZA11617 00301137
*                                                                       00301237
*                                                                       00301337
*        VS/2 RELEASE 3.0 CHANGES                                       00301437
*A166500,167000,369500-370000,131500-131900                     Z30AAWW 00301537
*C168000,369000                                                 Z30AAWW 00301637
*        VS/2 RELEASE 2.0 CHANGES                                       00301737
*A 027500-027600,039600,054500,107400,113500-113700            @YL026TA 00301837
*A 198500-198600,235100,240500,244500,271400-271588            @YL026TA 00302000
*A 275500-275600,276500-286744,287800-289992,358500,361100     @YL026TA 00303000
*A 383100-384925,489500-491441,542500-542800                   @YL026TA 00304000
*C 006000,039500,062000-064000,066000,069000-072000,171000     @YL026TA 00305000
*C 175000,235000,240000,244000,271300,286800,333500,358000     @YL026TA 00306000
*C 361000,371000                                               @YL026TA 00307000
*D 025000,110000,178000-180000,183500-191000,208000-228000     @YL026TA 00308000
*D 277000-286300,288100-289000,334000-339000,372500-373000     @YL026TA 00309000
*C 219500,226500                                                 YM2647 00310000
*A 123500-123700,161500-161700,228500-229900,347500-347600      SA53652 00318000
*A 379100-379200,381800                                         SA53652 00326000
*C 153000,162000                                                SA53652 00334000
*C 183500,190500,333500,338500                                   YM2088 00342000
*A 390300-390600                                               @ZA06424 00344037
*C 304000-307000,309000,312000-316000                          @ZA06424 00346037
*********************************************************************** 00350000
*                                                                     * 00450000
* STATUS --   VS 2  037   CHANGES                              @ZA26554 00550037
*                                                                     * 00650000
* FUNCTION -- THIRD LOAD OF THE PASSWORD DATA SET MAINTENANCE ROUTINE * 00750000
*    1. UPDATE PASSWORD DATA SET DSCB IF NECESSARY                    * 00900020
*    2. UPDATE THE DSCB OF THE DATA SET BEING PROTECTED WHENEVER THE  * 01000020
*    CONTROL PASSWORD PROTECTION STATUS IS CHANGED                    * 01100020
*    3. CLEANUP AND RETURN                                            * 01200020
*                                                                     * 01300020
* ENTRY POINTS --                                                     * 01400020
*         IGC0209H - ENTRY POINT OF THIRD LOAD, ENTERED BY XCTL FROM  * 01500020
*    SECOND LOAD (IGC0109H)                                           * 01600020
*                                                                     * 01700020
* INPUT --                                                            * 01800020
*    REGISTER R5 POINTS TO WORK AREA                                  * 01900020
*    REGISTER R11 CONTAINS RETURN CODE FROM PREVIOUS LOADS OF SVC 98  * 02100020
*                                                                     * 02200020
* OUTPUT --                                                           * 02300020
*    REGISTER R15 PASSES RETURN CODE                                  * 02400020
*    REGISTER R1 CONTAINS LOCATE RETURN CODE WHEN R15 = 32            * 02500000
*    REGISTER R1 CONTAINS OBTAIN RETURN CODE WHEN R15 = 36            * 02570000
*    REGISTER R1 CONTAINS DYNAMIC ALLOCATION ERROR CODE WHEN R15 = 52 * 02640000
*                                                              @YL026TA 02710000
*    WHEN REGISTER R15 = 24 THE FOLLOWING MESSAGE IS SENT TO THE      * 02800020
*    CONSOLE OPERATOR - 'IEC021I NO SPACE IN PASSWORD DATA SET'       * 02900020
*                                                                     * 03000020
* EXTERNAL REFERENCES -- N/A                                          * 03100020
*                                                                     * 03200020
* EXITS, NORMAL -- RETURN TO CALLER                                   * 03300020
*                                                                     * 03400020
* EXITS, ERROR -- RETURN TO CALLER WITH NON-ZERO RETURN CODE          * 03500020
*    32  LOCATE FAILED                                                * 03600020
*    36  OBTAIN FAILED                                                * 03700020
*    40  UNABLE TO UPDATE DSCB                                        * 03800020
*    48  TAPE DATA SET CAN NOT BE PROTECTED                           * 03900020
*    52  UNABLE TO ALLOCATE DATA SET                           @YL026TA 03950000
*    56  DATA SPACE IS VSAM                                    @YL026TA 03970000
*    RETURN CODES 4, 8, 12, 16, 20, 24, AND 44 MAY BE PASSED FROM     * 04000020
*    PREVIOUS LOADS OF SVC 98                                         * 04100020
*                                                                     * 04200020
* TABLES/WORK AREAS --                                                * 04300020
*    WORKD - A CONTIGUOUS AREA DEFINED BY IECDSECT FOR I/O CONTROL    * 04400020
*    BLOCKS FOLLOWED BY A LOCAL WORK AREA FOR COMMUNICATION AND       * 04500020
*    BUFFER SPACE                                                     * 04600020
*    WRKSPACE - A DSECT TO MAP THE LOCATE AND OBTAIN WORKAREAS        * 04800020
*                                                                     * 04900020
* ATTRIBUTES -- REENTRANT, READ ONLY, PRIVILEGED, ENABLED             * 05000000
*                                                                     * 05100020
* CHARACTER CODE DEPENDENCY -- CHARACTER CODE INDEPENDENT             * 05200020
*                                                                     * 05300020
* NOTES --                                                            * 05400000
*    DESCRIBED IN DADSM LOGIC MANUAL, SY26-3787.               @YL026TA 05450000
*                                                                     * 05500020
*********************************************************************** 05600020
         EJECT                                                          05700020
*  REGISTER EQUATES                                                     05800020
R0       EQU   0                   GENERAL REGISTER 0                   05900020
R1       EQU   1                   GENERAL REGISTER 1                   06000020
R2       EQU   2                   GENERAL REGISTER 2 (UNUSED)          06100020
R3       EQU   3                   SUBROUTINE BRANCH REGISTER  @YL026TA 06200000
R4       EQU   4                   PARAMETER LIST              @YL026TA 06300000
R5       EQU   5                   WORKAREA POINTER            @YL026TA 06400000
R6       EQU   6                   GENERAL REGISTER 6                   06500000
R7       EQU   7                   UCB POINTER                 @YL026TA 06600000
R8       EQU   8                   GENERAL REGISTER 8                   06700000
R9       EQU   9                   GENERAL REGISTER 9                   06800000
R10      EQU   10                  VOLUME COUNT                @YL026TA 06900000
R11      EQU   11                  RETURN CODE                 @YL026TA 07000000
R12      EQU   12                  BASE REGISTER FOR PROGRAM   @YL026TA 07100000
R13      EQU   13                  ADDRESS OF OBTAIN WORKAREA  @YL026TA 07200000
R14      EQU   14                  GENERAL REGISTER 14                  07300020
R15      EQU   15                  GENERAL REGISTER 15                  07400020
*  ABSOLUTE EQUATES (OFFSETS AND SHORT LENGTHS)                         07500020
ONE      EQU   1                   ONE                                  07600020
TWO      EQU   2                   TWO                                  07700020
F0       EQU   0                   ZERO                                 07800020
F1       EQU   1                   ONE                                  07900020
F2       EQU   2                   TWO                                  08000020
F3       EQU   3                   THREE                                08100020
F4       EQU   4                   FOUR                                 08200020
F5       EQU   5                   FIVE                                 08300020
F6       EQU   6                   SIX                                  08400020
F7       EQU   7                   SEVEN                                08500020
F8       EQU   8                   EIGHT                                08600020
F10      EQU   10                  TEN                                  08700020
F12      EQU   12                  TWELVE                               08800020
F16      EQU   16                  SIXTEEN                              08900020
F20      EQU   20                  TWENTY                               09000020
F43      EQU   43                  FORTY-THREE                          09100020
F77      EQU   77                  SEVENTY-SEVEN (USER DATA LENGTH)     09200020
F96      EQU   96                  NINETY-SIX                           09300020
L72      EQU   72                  LENGTH OF SAVEAREA                   09400020
*  RETURN CODE EQUATES                                                  09500020
RC4      EQU   4                   RETURN CODE = 4                      09600020
RC8      EQU   8                   RETURN CODE = 8                      09700020
RC12     EQU   12                  RETURN CODE = 12                     09800020
RC16     EQU   16                  RETURN CODE = 16                     09900020
RC20     EQU   20                  RETURN CODE = 20                     10000020
RC24     EQU   24                  RETURN CODE = 24                     10100020
RC28     EQU   28                  RETURN CODE = 28                     10200020
RC32     EQU   32                  RETURN CODE = 32                     10300020
RC36     EQU   36                  RETURN CODE = 36                     10400020
RC40     EQU   40                  RETURN CODE = 40                     10500020
RC44     EQU   44                  RETURN CODE = 44                     10600020
RC48     EQU   48                  RETURN CODE = 48                     10700020
RC52     EQU   52                  RETURN CODE = 52                     10730020
RC56     EQU   56                  RETURN CODE = 56            @YL026TA 10740000
*  OTHER EQUATES                                                        10760020
MPUPDAT  EQU   X'01'               MASK TO TEST FOR MPDS UPDATE         10800020
DSNUPDAT EQU   X'02'               MASK TO TEST FOR PROTECTION UPDATE   10900020
OPREAD   EQU   X'06'               READ DATA OP CODE                    11100020
OPWRITE  EQU   X'05'               WRITE DATA OP CODE                   11200020
OBTNCORE EQU   X'08'               OBTAIN CORE TO BE FREED              11300020
VSAMORG  EQU   X'08'               BIT IN SECOND BYTE OF DSCB FILE-TYPE*11330000
                                   INDICATES VSAM DATA SPACE   @YL026TA 11360000
AUTH     EQU   X'80'               IS USER AUTHORIZED SW       @ZA26554 11400037
CHAIN    EQU   X'40'               CHAIN DATA FLAG                      11420037
SECPASS  EQU   X'20'               SECOND PASS SW              @ZA26554 11440037
GOODIO   EQU   X'20'               MASK TO TEST FOR SUCCESSFUL I/O      11500020
SRCHID   EQU   X'31'               SEARCH ID EQUAL OP CODE              11600020
FLAGOFF  EQU   X'14'               MASK TO TURN OFF ALL BUT BITS 3,5    11700020
NOPROT   EQU   X'EB'               MASK TO TURN OFF BITS 3,5            11800020
NOSEEK   EQU   X'18'               FILE MASK-NOSEEK                     11900020
IOERR    EQU   X'40'               MASK TO SET I/O ERROR INDICATOR      12000020
DSCBP3   EQU   X'10'               MASK TO SET PROTECTION BYTE BIT 3    12100020
DSCBP5   EQU   X'04'               MASK TO SET PROTECTION BYTE BIT 5    12200020
BLANK    EQU   C' '                BLANK                                12300020
SWON     EQU   X'FF'               MASK SWITCH ON               SA53652 12350021
SWOFF    EQU   X'00'               MASK SWITCH OFF              SA53652 12360021
F252     EQU   252                 OFFSET TO TTR                SA53652 12370000
RNLENGTH EQU   8                   LENGTH OF RNAME FOR ENQUEUE ON DSCB  12400020
HLEN     EQU   44                  DSNAME LENGTH FOR ENQUEUE            12500020
DSCBDLL  EQU   96                  DSCB DATA FIELD LENGTH               12600020
         EJECT                                                          12700020
         BALR  R12,R0              GET ADDRESS WHERE LOADED             12800020
         USING *,R12               ESTABLISH ADDRESSABILITY FOR PROGRAM 12900020
         USING WORKD,R5            ESTABLISH ADDRESSABILITY FOR DSECT   13000037
         B     BEGIN               BRANCH AROUND ID             Z30AAWW 13030037
         DC    C'IGC0209H'         MODULE ID                    Z30AAWW 13060037
         DC    C'7339'             DATE 12/05/77               @ZA26554 13090037
BEGIN    EQU   *                                                Z30AAWW 13150000
         L     R13,OBTAIN4         ADDRESS OF OBTAIN WORKAREA           13200020
         USING WRKSPACE,R13        ESTABLISH ADDRESSABILITY WORKAREA    13300020
         LTR   R11,R11             IS RETURN CODE REGISTER = 0          13400020
         BNZ   CHECKRC             NO, GO CHECK RETURN CODE             13500020
         MVC   ENQLIST(ENQLEND-ENQL),ENQL INITIALIZE ENQ AND DEQ LISTS  13600020
         MVC   QNAME(F8),QNME      INITIALIZE QNAME                     13700020
         LA    R1,ENQLIST          POINT TO ENQUEUE PARAMETER LIST      13800020
         LA    R8,DEQLIST          POINT TO DEQUEUE PARAMETER LIST      13850020
         LA    R9,QNAME            ADDRESS OF QNAME                     13900020
         ST    R9,F4(R1)           SECOND WORD ENQUEUE LIST             14000020
         ST    R9,F4(R8)           SECOND WORD DEQUEUE LIST             14050020
         LA    R9,RNAME            ADDRESS OF RNAME                     14100020
         ST    R9,F8(R1)           THIRD WORD ENQUEUE LIST              14200020
         ST    R9,F8(R8)           THIRD WORD DEQUEUE LIST              14250020
         TM    DFLAG1,MPUPDAT      IS UPDATE OF PASSWORD DS REQUIRED    14300020
         BO    UPDATE              YES, GO UPDATE DSCB                  14400020
         B     DSFLAG              GO SEE IF DATA SET IS TO BE FLAGGED  14500020
*  NOW SET PROTECTION STATUS IN DSCB                                    14600020
SETFLAG  L     R8,VOLIST           LOAD ADDRESS OF USER'S VOLUME LIST   14700020
         LTR   R8,R8               DID USER SUPPLY VOLUME LIST          14800020
         BNZ   USERLIST            YES, GO USE USER'S VOLUME LIST       14900020
*  USER DID NOT SUPPLY VOLUME LIST.  USE LOCATE TO GET VOLUME LIST      15000020
         MVC   LOCNAME(ENDLLIST-LOCLIST),LOCLIST INITIALIZE CAMLST      15100020
         LA    R6,DKEY             POINTER TO DATA SET NAME-            15200020
INITLOC  ST    R6,LOCNAME2         -TO LOCATE CAMLST            SA53652 15300021
         LA    R6,LOCAREA          POINTER TO LOCATE WORKAREA-          15400020
         ST    R6,LOCNAME4         -TO LOCATE CAMLST                    15500020
         LOCATE LOCNAME            ISSUE LOCATE MACRO                   15600020
         LTR   R15,R15             TEST LOCATE RETURN CODE              15700020
         BNZ   LOCERROR            NON-ZERO IS ERROR                    15800020
         CLC   TAPECODE(F2),LOCAREA+F4 IS THIS A TAPE DATA SET          15900020
         BE    TAPE                YES, UNABLE TO FLAG TAPES            16000020
         LH    R10,LOCAREA         VOLUME COUNT                         16100020
         MVI   DMODE,SWOFF         INITIALIZE SWITCH OFF        SA53652 16150021
         CH    R10,TWENTY          TEST VOLUME COUNT            SA53652 16160021
         BH    DOTWENTY            GO PROCESS OVER 20 VOLUMES   SA53652 16170000
VOLPOINT LA    R8,LOCAREA+F6       POINT TO FIRST VOLSER        SA53652 16200021
*                                                                       16210000
*   USE UCB LOOKUP TABLE TO FIND SPECIFIED VOLUME.  TABLE CONSISTS OF   16220000
*   HALFWORD POINTERS TO UCB'S, OR ZEROS FOR MISSING UCB'S.  END OF     16230000
*   TABLE INDICATED BY VALUE OF X'FFFF'.  ALL SIXTEEN BITS OF THE       16240000
*   HALFWORD ARE SIGNIFICANT.                                           16250000
*                                                                       16260000
LOOKUP   L     R6,DUCBADDR         ADDRESS OF UCB LOOKUP TABLE          16300020
UCBSRCH  LH    R7,F0(R6)           LOAD UCB ADDRESS                     16400020
         LTR   R7,R7               CHECK UCB TABLE ENTRY                16500020
         BZ    NEXTUCB             IF ZERO, GET NEXT UCB TABLE ENTRY    16600020
         CH    R7,UCBEND           END OF UCB LOOKUP TABLE      Z30AAWW 16800000
         BE    VOLNTMTD            YES, VOL MUST NOT BE MOUNTED Z30AAWW 16830000
         N     R7,UCBMASK          CLEAR HI-ORDER BITS          Z30AAWW 16860000
         USING SRT,R7              ESTABLISH ADDRESSABILITY UCB         16900020
         CLI   UCBTBYT3,UCB3DACC   IS THIS A DIRECT ACCESS DEVICE       17000020
         BE    CHKVOLID            YES, GO CHECK VOLSER        @YL026TA 17100000
         CLI   UCBTBYT3,UCB3TAPE   IS THIS A TAPE DATA SET              17200020
         BNE   NEXTUCB             NO, NOT TAPE, NOT DA, GO CHECK NEXT  17300020
CHKVOLID CLC   SRTEVOLI(F6),F0(R8) DO VOLSER'S MATCH                    17400020
         BE    MATCHID             YES GO GET DSCB             @YL026TA 17500000
NEXTUCB  LA    R6,F2(R6)           POINT TO NEXT ENTRY LOOKUP TABLE     17700000
         B     UCBSRCH             GO CHECK NEXT UCB                    17900000
MATCHID  CLI   UCBTBYT3,UCB3TAPE   IS THIS A TAPE                       18100020
         BE    TAPE                YES, UNABLE TO FLAG, GO SET RC       18200020
         ST    R7,DXDEBUCB         UCB ADDRESS TO DEB                   18300020
*  NOW GET DSCB                                                         19200020
GETDSCB  LA    R9,DKEY             POINTER TO DATA SET NAME-            19300020
         ST    R9,OBTAIN2          -TO OBTAIN CAMLST                    19400020
         MVC   OBTVOL(F6),F0(R8)   VOLSER OF DATA SET                   19500020
         OBTAIN OBTPTR             GET DSCB                             19600020
         LTR   R15,R15             TEST OBTAIN RETURN CODE              19700020
         BNZ   OBTERROR            NON-ZERO IS OBTAIN ERROR             19800020
         DROP  R13                 DROP OLD BASE               @VS07508 19810000
         USING DXDSCB,R13          SET NEW BASE                @VS07508 19820000
         TM    DSCFILTY+F1,VSAMORG IS THIS SPACE VSAM?         @YL026TA 19830000
         BO    VSAMERR             ERROR--CANNOT PROTECT       @YL026TA 19840000
         DROP  R13                 DROP OLD BASE               @VS07508 19850000
         USING WRKSPACE,R13        SET NEW BASE                @VS07508 19860000
         B     FLAGDS              GO CHECK SECURITY FLAGS              19900020
USERLIST SR    R10,R10             ZERO REGISTER                        20000020
         IC    R10,VOLNUM          VOLUME COUNT                         20100020
         LTR   R10,R10             TEST VOLUME COUNT                    20200020
         BZ    IOERROR             ZERO COUNT IS ERROR                  20300020
         LA    R8,F0(R8)           BLANK VOLNUM FROM HIGH ORDER BYTE    20400020
         LTR   R8,R8               CHECK POINTER TO VOLUME LIST         20500020
         BZ    IOERROR             ZERO POINTER IS ERROR                20600020
         B     LOOKUP              GO LOOKUP UCB                        20700020
DOTWENTY LA    R10,F20             USE 20                       SA53652 20800000
         MVI   DMODE,SWON          TURN SWITCH ON               SA53652 21500000
         B     VOLPOINT            GO PROCESS 20 VOLUMES        SA63652 22200000
RELOC    MVC   LOCNAME(ENDBLLOC-LOCBLK),LOCBLK INIT CAMLST      SA53652 22960000
         MVC   DMBB(F3),LOCAREA+F252 SAVE TTR                   SA53652 22970000
         LA    R6,DMBB             POINT TO TTR                 SA53652 22980000
         B     INITLOC             GO INITIALIZE LOCATE         SA53652 22990000
UPDATE   MVC   RNAME(F8),PDSDSN    MOVE PASSWORD DSNAME TO RNAME        23000020
         MVC   DSCLSTAR(F3),DSAVT  MOVE NEW PASSWORD TTR TO DSCB        23200020
*  NOW ENQUEUE ON PASSWORD DATA SET                                     23300020
         LA    R1,ENQLIST          POINT TO ENQUEUE LIST                23400020
UPDT010  ENQ   MF=(E,(1)),RELATED=(SYSDSN-PASSWORD,IGC0209H(UPDT020))  *23500000
                                   ENQUEUE ON DSCB             @YL026TA 23520000
         STH   R15,DSAVT           SAVE ENQUEUE RETURN CODE             23550020
*  NOW GO UPDATE PASSWORD DATA SET DSCB FROM IN CORE IMAGE              23600020
         BAL   R3,WRITDSCB         GO WRITE BACK DSCB                   23700020
*  NOW DEQUEUE FROM PASSWORD DATA SET AND FROM DSCB                     23800020
         CLC   ZERO(F2),DSAVT      WAS ENQUEUE SUCCESSFUL               23830020
         BNE   SKIPDQ              NO, SKIP DEQUEUE                     23860020
         LA    R1,DEQLIST          POINT TO DEQUEUE LIST                23930020
UPDT020  DEQ   MF=(E,(1)),RELATED=(SYSDSN-PASSWORD,IGC0209H(UPDT010))  *24000000
                                   DEQUEUE FROM DSCB           @YL026TA 24050000
SKIPDQ   LA    R1,DENQLST          POINT TO DSNAME ENQUEUE LIST         24100020
         LA    R9,DMPDS            POINT TO PASSWORD DATA SET NAME      24200020
         ST    R9,F8(R1)           RESET DEQUEUE LIST                   24300020
         DEQ   MF=(E,(1)),RELATED=(SYSPSWRD-PASSWORD,IGC0009H(CHK030)) *24400000
                                   DEQUEUE FROM PASSWD DATA SET         24450000
         TM    DFLAG1,IOERR        WAS I/O SUCCESSFUL                   24500020
         BO    IOERROR             GO FREE CORE                         24600020
DSFLAG   TM    DFLAG1,DSNUPDAT     IS UPDATE OF DSCB REQUIRED           24700020
         BO    SETFLAG             YES, GO FLAG DSCB                    24800020
         B     ZERORC              GO CLEANUP AND RETURN                24900020
FLAGDS   MVC   DXDSCB(F96),OBTWRK  MOVE DSCB TO DSCB MAP                25000020
         MVC   OLDFLAG(F1),DSCDSIND SAVE PROTECTION FLAG STATUS         25100020
         NI    OLDFLAG,FLAGOFF     TURN OFF ALL BUT PROTECTION BITS     25300020
*  THE FOLLOWING IS POSSIBLE BECAUSE DFLAG1 PROTECTION REQUEST BITS     25350020
*  CORRESPOND ONE TO ONE WITH DSCB PROTECTION BITS                      25400020
         MVC   NEWFLAG(F1),DFLAG1  SET PROTECTION REQUEST BITS          25450020
         NI    NEWFLAG,FLAGOFF     TURN OFF ALL BUT PROTECTION BITS     25500020
CHCKBYTE CLC   OLDFLAG,NEWFLAG     COMPARE SECURITY FLAGS               25800020
         BE    STATUSOK            FLAGS AGREE, NO UPDATE REQUIRED      25900020
         NI    DSCDSIND,NOPROT     TURN OFF PROTECTION BITS (3,5)       26000020
         OC    DSCDSIND,NEWFLAG    PUT NEW STATUS IN DSCB               26100020
         B     NQ                  GO WRITE BACK DSCB                   26200020
LOCERROR LR    R1,R15              LOCATE RETURN CODE TO REGISTER 1     26700020
         LA    R11,RC32            SET RETURN CODE = 32                 26800020
         B     FREECORE            GO FREE CORE                         26900020
TAPE     LA    R11,RC48            SET RETURN CODE = 48                 27000020
         B     FREECORE            GO FREE CORE                         27100020
INUSE    LA    R11,RC52            ALLOCATION ERROR RETURN CODE         27130000
         SR    R1,R1               CLEAR REGISTER 1            @YL026TA 27133000
         B     ALLOCER(R15)        ACTION DEPENDENT ON RET. CODE        27136000
ALLOCER  B     INFOERR             RC=0 - INFO ONLY            @YL026TA 27139000
         B     ALCERR              RC=4 - ERROR CODE AVAILABLE @YL026TA 27142000
         B     FREECORE            RC=8 - NO ADDITIONAL CODE   @YL026TA 27145000
ALCERR   LH    R1,DAERRCD          RC=12 - PUT ERROR CODE IN R 1        27148000
         B     FREECORE            GO FREE CORE                @YL026TA 27151000
INFOERR  LH    R1,DAINFO           PUT INFORMATIONAL CODE IN R 1        27154000
         B     FREECORE            GO FREE CORE                         27160020
VOLNTMTD LA    R15,RC4             INDICATE VOLUME NOT MOUNTED          27200020
OBTERROR LR    R1,R15              OBTAIN RETURN CODE TO REGISTER 1     27300020
OBTAINRC LA    R11,RC36            SET RETURN CODE = 36                 27400020
         B     FREECORE            GO FREE CORE                         27500020
VSAMERR  LA    R11,RC56            SET RETURN CODE = 56        @YL026TA 27600000
         B     FREECORE            GO FREE CORE                @YL026TA 27620000
IOERROR  LA    R11,RC40            SET RETURN CODE = 40                 27640000
         B     FREECORE            GO FREE CORE                @YL026TA 27660000
*                                                              @YL026TA 27680000
*  ALLOCATE THE DATA SET TO GET EXCLUSIVE CONTROL.             @YL026TA 27700000
*  A NEW ALLOCATION IS REQUESTED SO THAT WHEN DEALLOCATION IS  @YL026TA 27720000
*  DONE, EXISTING ALLOCATIONS ARE NOT DISTURBED.               @YL026TA 27740000
*  THE DDNAME USED IS RETURNED FOR USE IN DEALLOCATING.        @YL026TA 27760000
*                                                              @YL026TA 27780000
NQ       EQU   *                                               @YL026TA 27800000
         USING S99TUNIT,R8                                     @YL026TA 27820000
         XC    DARQBLK(F20),DARQBLK CLEAR PARAMETER BLK        @YL026YB 27840000
         MVC   DARQBLK,REQALC      SET UP REQUEST BLOCK        @YL026TA 27860000
*  BUILD DSNAME TEXT UNIT                                      @YL026TA 27880000
         MVC   DADSNM(L'TXTDSNM),TXTDSNM SET UP DSNAME TEXT UNIT        27900000
         LR    R14,R8              SAVE VOL LIST PTR           @ZA18970 27910037
         LA    R8,DADSNM           ADDRESS OF DSNAME TEXT UNIT @YL026TA 27920000
         SR    R9,R9               CLEAR REGISTER              @YL026TA 27940000
         IC    R9,DSNLL            GET DSNAME LENGTH           @YL026TA 27960000
         STH   R9,S99TULNG         STORE LENGTH IN TEXT UNIT   @YL026TA 27980000
         BCTR  R9,R0               DECREMENT LENGTH FOR EXECUTE         28000000
         L     R6,DSN              ADDRESS OF DSNAME           @YL026TA 28020000
         EX    R9,MOVEPAR          MOVE DSNAME TO TEXT UNIT    @YL026TA 28040000
         ST    R8,DATP1            ADDR OF TEXT UNIT TO TEXT PTR        28060000
         LA    R8,DATP1                                                 28080000
         ST    R8,DATXTPT          ADDRESS OF FIRST TEXT POINTER        28100000
*  BUILD STATUS TEXT UNIT                                      @YL026TA 28120000
         MVC   DASTAT(L'TXTSTAT),TXTSTAT SET UP STATUS TEXT UNIT        28140000
         LA    R8,DASTAT           ADDRESS OF STATUS TEXT UNIT @YL026TA 28160000
         ST    R8,DATP2              TO TEXT POINTER           @YL026TA 28180000
*  BUILD VOLUME TEXT UNIT                                      @YL026TA 28200000
         MVC   DAVOL(L'TXTVOL),TXTVOL SET UP VOLUME TEXT UNIT  @YL026TA 28220000
         LA    R8,DAVOL            ADDRESS OF VOLUME TEXT UNIT @YL026TA 28240000
         MVC   S99TUPAR(L'OBTVOL),OBTVOL VOL SERIAL TO TEXT UNIT        28260000
         ST    R8,DATP3            ADDR OF TEXT UNIT TO TEXT PTR        28280000
*  BUILD UNIT NAME TEXT UNIT                                   @YL026TA 28300000
         MVC   DAUNIT(L'TXTUNIT),TXTUNIT SET UP UNIT NAME TEXT @YL026TA 28320000
         LA    R8,DAUNIT           ADDRESS OF UNIT NAME T. U.  @YL026TA 28340000
         MVC   S99TUPAR(L'UCBNAME),UCBNAME EBCDIC UNIT NAME FROM UCB   *28360000
                                                               @YL026TA 28380000
         ST    R8,DATP4            ADDR OF TEXT UNIT TO TEXT PTR        28400000
*  BUILD DDNAME TEXT UNIT                                      @YL026TA 28420000
         MVC   DADDNM(L'TXTDD),TXTDD  SET UP DDNAME TEXT UNIT  @YL026TA 28440000
         LA    R8,DADDNM           ADDRESS OF DDNAME TEXT UNIT @YL026TA 28460000
         ST    R8,DATP5              TO TEXT POINTER           @YL026TA 28480000
*  FINISH UP PARAMETER LIST FOR ALLOCATION                     @YL026TA 28500000
         OI    DATP5,S99TUPLN      HIGH ORDER BIT ON FOR END   @YL026TA 28520000
         LA    R9,DARQBLK          PUT ADDRESS OF REQUEST BLOCK         28540000
         ST    R9,DAPARM             IN PARAMETER POINTER      @YL026TA 28560000
         OI    DAPARM,S99RBPND     TURN HIGH-ORDER BIT ON      @YL026TA 28580000
         LA    R1,DAPARM           ADDRESS OF PARAMETER POINTER         28600000
         DYNALLOC                  ALLOCATE THE DATA SET       @YL026TA 28620000
         LTR   R15,R15             TEST ALLOCATION RETURN CODE @YL026TA 28640000
         BNZ   INUSE               UNABLE TO ALLOCATE          @YL026TA 28660000
*  NOW REISSUE OBTAIN TO ENSURE AN ACCURATE DSCB                 A42339 28690021
         OBTAIN OBTPTR             GET DSCB                      A42339 28700021
         BAL   R3,WRITDSCB         GO UPDATE DSCB                       28730020
*                                                              @YL026TA 28810000
*  NOW UNALLOCATE THE DATA SET USING THE DDNAME RETURNED BY    @YL026TA 28820000
*  ALLOCATION                                                  @YL026TA 28830000
*                                                              @YL026TA 28840000
DQ       EQU   *                                               @YL026TA 28850000
         MVI   DAVERB,S99VRBUN     VERB CODE TO UNALLOCATE     @YL026TA 28860000
         SR    R9,R9               CLEAR FLAGS                 @YL026TA 28870000
         STH   R9,DAFLGS1                                      @YL026TA 28880000
         STH   R9,DAERRCD          CLEAR FIELD IN PARM BLK              28890000
         STH   R9,DAINFO           CLEAR FIELD IN PARM BLK              28900000
         ST    R9,DRESVE           CLEAR FIELD IN PARM BLK              28910000
         ST    R9,DAFLGS2          CLEAR FIELD IN PARM BLK              28920000
         MVC   DADKEY,DDUNKEY      CHANGE DDNAME TEXT UNIT KEY @ZA02651 28930037
         LA    R8,DADDNM           PUT ADDRESS OF DDNAME T. U. @YL026TA 28940000
         ST    R8,DATP1              IN TEXT POINTER           @YL026TA 28950000
         OI    DATP1,S99TUPLN      MARK END OF LIST            @YL026TA 28960000
         LA    R1,DAPARM           ADDRESS OF PARAMETER POINTER         28970000
         DYNALLOC                  UNALLOCATE THE DATA SET     @YL026TA 28980000
         B     STATUSOK            FLAGS UPDATED                        29000020
*                                                                       29100020
*  CHANNEL PROGRAM FOR DSCB UPDATE                                      29200020
*                                                                       29300020
*        SEARCH-ID-EQUAL           (DXCCW7)                             29400037
*        TIC                       (DXCCW8)                             29500037
*        WRITE-DATA                (DXCCW9)                             29600037
*        SEARCH-ID-EQUAL           (DXCCW10)                            29700037
*        TIC                       (DXCCW11)                            29800037
*        READ-DATA (VERIFICATION)  (DXCCW12)                            29900037
*                                                                       30000020
*  DSCB UPDATE  THE DSCB DATA FIELD IS WRITTEN BACK TO THE VTOC AT      30100020
*  THE LOCATION SPECIFIED BY OBTAIN'S CCHHR                             30200020
WRITDSCB LA    R9,DXDAADDR+F3      ADDRESS OF COUNT FIELD (CCHHR)-      30300020
         ST    R9,DXCCW7           -TO SEARCH CCW              @ZA11617 30400037
         ST    R9,DXCCW10          -TO SEARCH CCW              @ZA11617 30500037
         MVI   DXCCW7,SRCHID       SET SEARCH ID EQUAL OP CODE @ZA11617 30600037
         MVI   DXCCW10,SRCHID      SET SEARCH ID EQUAL OP CODE @ZA11617 30700037
         MVI   DXDEBUCB,NOSEEK     RESET FILE MASK TO INHIBIT SEEKS     30800037
         LA    R9,DXCCW7           ADDRESS OF STARTING CCW     @ZA11617 30900037
         ST    R9,IOBSIOCC         POINT TO STARTING CCW                31000037
         LA    R9,DXDSCB           DSCB ADDRESS (WORK AREA)-            31100037
         ST    R9,DXCCW9           -TO WRITE CCW               @ZA11617 31200037
         MVI   DXCCW9,OPWRITE      SET WRITE OP CODE           @ZA11617 31300037
         MVI   DXCCW9+F7,DSCBDLL   DSCB DATA LENGTH TO CCW     @ZA11617 31400037
         MVI   DXCCW12,OPREAD      SET READ OP CODE            @ZA11617 31500037
         MVI   DXCCW12+F7,DSCBDLL  DSCB DATA LENGTH TO CCW     @ZA11617 31600037
         MVC   DXDAADDR+F3(F5),OBTCCH MOVE DSCB CCHHR TO COUNT FIELD    31700020
         MVC   DXDEBSCC(F4),OBTCCH SET EXTENTS-                         31800020
         MVC   DXDEBECC(F4),OBTCCH -IN DEB FOR SEARCH                   31900020
*  NOW ISSUE EXCP TO UPDATE DSCB                                        32000020
         EXCP  DXIOB               INITIATE I/O                         32100020
         WAIT  ECB=DXECB           WAIT FOR COMPLETION                  32200020
*  WAS I/O SUCCESSFUL                                                   32300020
         TM    DXECB,GOODIO        WAS THERE AN ERROR                   32400020
         BCR   ONE,R3              NO, RETURN                           32500020
         OI    DFLAG1,IOERR        INDICATE I/O ERROR                   32600020
         BR    R3                  RETURN                               32700020
CHECKRC  LA    R9,RC24             REGISTER 9 = 24                      32800020
         CR    R11,R9              IS PASSWORD DATA SET FULL            32900020
         BNE   FREECORE            GO FREE CORE                         33000020
         LA    R1,JFCBELNM         POINT TO WRITE TO OPERATOR MESSAGE   33100020
         WTO   MF=(E,(1))          ISSUE WTO                            33200020
         B     FREECORE            GO CLEANUP AND RETURN                33300020
STATUSOK EQU   *                                               @YL026TA 33400000
         TM    DFLAG1,IOERR        WAS I/O SUCCESSFUL                   34000020
         BO    IOERROR             NO, GO FREE CORE                     34100020
         LR    R8,R14              RESET VOL LIST PTR          @ZA18970 34150037
         CLC   ZERO(F4),VOLIST     DID USER SUPPLY VOLUME LIST          34200020
         BE    LOCLISTS            IF NOT, USE LOCATE LIST              34300020
         LA    R8,F6(R8)           POINT TO NEXT VOLUME                 34400020
         B     MOREVOLS            GO CHECK IF MORE VOLUMES             34500000
LOCLISTS LA    R8,F12(R8)          POINT TO NEXT VOLUME                 34600020
MOREVOLS BCT   R10,LOOKUP          IF MORE VOLUMES, GO PROCESS NEXT VOL 34700020
         CLI   DMODE,SWON          MORE VOLUMES                 SA53652 34750000
         BE    RELOC               YES, GO PROCESS THEM         SA53652 34770000
ZERORC   SR    R11,R11             SET RETURN CODE = 0                  34800020
FREECORE EQU   *                   FREE CORE BEFORE RETURNING           34900020
         LR    R6,R1               SAVE REGISTER 1 DURING FREEMAIN      35000020
         LR    R4,R0               SAVE REGISTER 0 DURING FREEMAIN      35100020
         L     R9,DSAVR            LOAD RETURN ADDRESS                  35200020
         TM    DFLAG1,OBTNCORE     OBTAIN CORE TO BE FREED              35300020
         BZ    NOOBTAIN            NO, SKIP AROUND FREEMAIN             35400020
         LA    R0,WRKSIZE          SIZE OF OBTAIN AND LOCATE WORKAREA   35500020
         O     R0,SPN              SUBPOOL NUMBER IN HIGH ORDER BYTE    35600020
         L     R1,OBTAIN4          ADDRESS OF CORE TO BE FREED          35700020
         FREEMAIN R,LV=(0),A=(1),RELATED=(SP251,IGC0009H(TABRC2))      *35800000
                                   FREE CORE                   @YL026TA 35860000
NOOBTAIN LA    R0,WKSIZE           SIZE OF PROGRAM WORKAREA             35920000
         LR    R1,R5               ADDRESS OF CORE TO BE FREED          35980000
         FREEMAIN R,LV=(0),A=(1),RELATED=(SP0,IGC0009H(INITCOR))       *36040000
                                   FREE CORE                   @YL026TA 36100000
         LR    R1,R6               RESTORE REGISTER 1                   36200020
         LR    R0,R4               RESTORE REGISTER 0                   36300020
         LR    R15,R11             RESTORE REGISTER 15                  36400020
         LR    R14,R9              RETURN ADDRESS TO RETURN REGISTER    36500020
         BR    R14                 RETURN                               36600020
         EJECT                                                          36700020
*  CONSTANTS                                                            36800020
         DS    0F                  ALIGN CONSTANTS                      36900000
UCBMASK  DC    X'0000'             FOR HI-ORDER OF UCB ADDR     Z30AAWW 36960000
UCBEND   DC    X'FFFF'             END OF UCB LOOKUP TABLE INDR Z30AAWW 37020000
MOVEPAR  MVC   S99TUPAR(F0),F0(R6) MOVE PARAMETER TO TEXT UNIT @YL026TA 37100000
TAPECODE DC    X'8001'             COMMON PART OF ALL TAPE DEVICE CODES 37300000
ZERO     DC    F'0'                ZERO WORD FOR COMPARES               37500020
SPN      DC    X'FB'               SUBPOOL NUMBER 251                   37600020
         DC    X'000000'           ZERO REST OF WORD                    37700020
LOCLIST  CAMLST NAME,0,,0          LOCATE CAMLST MACRO                  37800020
ENDLLIST EQU   *                   END OF LOCATE CAMLST MACRO           37900020
LOCBLK   CAMLST BLOCK,1,,3         LOCATE CAMLST (TTR)          SA53652 37910000
ENDBLLOC EQU   *                   END OF CAMLST MACRO          SA53652 37930000
*  KEEP ENQ AND DEQ LISTS TOGETHER.                                     37950020
ENQL     ENQ   (0,0,E,RNLENGTH,SYSTEM),RET=USE,MF=L LIST FORM ENQUEUE   38010020
DEQL     DEQ   (0,0,RNLENGTH,SYSTEM),RET=HAVE,MF=L DEQUEUE              38070020
ENQLEND  EQU   *                   END OF ENQ AND DEQ EXPANSIONS        38130020
TWENTY   DC    H'20'               TWENTY                       SA53652 38160000
QNME     DC    CL8'SYSDSN  '       QNAME FOR ENQUEUE ON DSCB            38200020
PDSDSN   DC    CL8'PASSWORD'       PASSWORD DATA SET DSNAME             38260020
*  CONSTANTS FOR DYNAMIC ALLOCATION                            @YL026TA 38264000
REQALC   DS    0CL20               CONSTANT PART OF REQUEST BLK         38268000
         DC    X'14'               LENGTH OF BLOCK = 20        @YL026TA 38272000
         DC    X'01'               VERB CODE 01 = ALLOCATE     @YL026TA 38276000
         DC    X'6000'             FLAGS1 = USE NEW ALLOCATION,        *38280000
                                   DON'T WAIT FOR VOLUME MOUNT @YL026TA 38284000
         DC    X'00000000'         CLEAR ERROR CODES           @YL026TA 38288000
         DS    CL4                 TEXT POINTER ADDRESS        @YL026TA 38292000
         DC    X'00000000'         RESERVED                    @YL026TA 38296000
         DC    X'00000000'         FLAGS2 = ZEROS              @YL026TA 38300000
* TEXT UNITS -- CONSTANT PARTS                                 @YL026TA 38304000
TXTDSNM  DS    0CL6                DSNAME TEXT UNIT            @YL026TA 38308000
         DC    X'0002'             KEY FOR DSNAME              @YL026TA 38312000
         DC    X'0001'             NUMBER OF DSNAMES           @YL026TA 38316000
         DC    X'0000'             INITIALIZE LENGTH           @YL026TA 38320000
TXTSTAT  DS    0CL7                STATUS TEXT UNIT            @YL026TA 38324000
         DC    X'0004'             KEY FOR STATUS              @YL026TA 38328000
         DC    X'0001'             NUMBER                      @YL026TA 38332000
         DC    X'0001'             LENGTH OF STATUS FIELD      @YL026TA 38336000
         DC    X'01'               STATUS = OLD                @YL026TA 38340000
TXTVOL   DS    0CL6                VOLUME TEXT UNIT            @YL026TA 38344000
         DC    X'0010'             KEY FOR VOLUMES             @YL026TA 38348000
         DC    X'0001'             NUMBER OF VOLUMES (ONE)     @YL026TA 38352000
         DC    X'0006'             LENGTH OF VOLUME FIELD      @YL026TA 38356000
TXTUNIT  DS    0CL6                UNIT NAME TEXT UNIT         @YL026TA 38360000
         DC    X'0015'             KEY FOR UNIT NAME           @YL026TA 38364000
         DC    X'0001'             NUMBER OF UNITS             @YL026TA 38368000
         DC    X'0003'             LENGTH OF UNIT NAME         @YL026TA 38372000
TXTDD    DS    0CL6                DDNAME TEXT UNIT            @YL026TA 38376000
         DC    X'0055'             KEY TO REQUEST DDNAME       @YL026TA 38380000
         DC    X'0001'             NUMBER OF DDNAMES           @YL026TA 38384000
         DC    X'0008'             LENGTH OF DDNAME FIELD      @YL026TA 38388000
*  OTHER CONSTANTS NEEDED FOR ALLOCATION                       @YL026TA 38392000
DDUNKEY  DC    X'0001'             KEY TO UNALLOCATE DDNAME    @YL026TA 38396000
         EJECT                                                          38400020
*        THIS WORK AREA IS USED BY ALL LOADS OF THE PROTECT SVC.        38500020
*        ANY CHANGES TO IT MUST BE MADE TO ALL LOADS.                   38600020
WORKD    DSECT                                                          38700020
*                                                                       38800020
         IECDSECT                                                       38900020
CLEARIO  EQU   *-DXECB             LENGTH FOR CLEARING I/O BLOCKS       39000020
*                                                                       39100020
COMMD    EQU   *                   CONTINUE DSECT                       39200020
*                                                                       39300020
*        WORK AREA FOR MPDS COMMUNICATION AND BUFFERING                 39400020
*        A CONTINUATION OF DSECT (WORKD)                                39500020
*                                                                       39600020
*                                                                       39700020
DSAVR    DS    F                   SAVE AREA FOR RETURN REGISTER        39800020
DSAVT    DS    F                   MPDS LAST BLOCK SAVE AREA            39900020
DUCBADDR DS    F                   ADDRESS OF UCB LOOKUP TABLE          40000020
DPMODE   DS    CL1                 PROTECTION MODE BYTE SAVE AREA       40100020
DRECAP   DS    CL1                 SYSRES DEVICE-RECORD/TRK CAPACITY    40200020
DCODTAB  DS    CL1                 ENTRY CODE SAVE AREA FOR NEXT LOAD   40300020
*                                                                       40400020
*        DFLAG - COMMUNICATES STATUS OF DSCB UPDATING REQUIREMENTS      40500020
*                                                                       40600020
DFLAG1   DS    BL1                 COMMUNICATION FLAG                   40700020
*        COMMUNICATION FLAG (DFLAG1) IN COMMD WORK AREA                 40800020
*              1 BYTE  (DFLAG1)                                         40900020
*                   BIT  0  =1 MPDS IS ENQ TO ADD OWN P/W PROTECTION    41000020
*                        1  =1 INDICATES I/O ERROR                      41100020
*                        2  =1 INDICATES ENQUEUED IN 1ST - 2ND LOADS    41200020
*                        3  =1 PROTECTED DATA SET-SET BIT 3 IN DSCB     41300020
*                        4  =1 OBTAIN WORK AREA TO BE FREED             41400020
*                        5  =1 NO PASSWORD TO READ-SET BIT 5 IN DSCB    41500020
*                        6  =1 UPDATE DSCB OF DATA SET WITH PROTECTION  41600020
*                              SPECIFIED IN BITS 3 AND 5                41700020
*                        7  =1 UPDATE MPDS DSCB FROM CORE IMAGE IN      41800020
*                              WORK AREA (WORKD) AND DEQ ON MPDS        41900020
*                                                                       42000020
DFLAG2   DS    BL1                 COMMUNICATION FLAG                   42100020
*              1 BYTE (DFLAG2)                                          42200020
*                   BIT 0  =1 INDICATES AUTHORIZED USER        @ZA26554 42300037
*                   BIT 1  =1 INDICATES NEW PASSWORD WITH REPLACE       42350037
*                   BIT 2  =1 SECOND PASS SWITCH FOR VALCKRTN  @ZA26554 42400037
*                   BIT 3     RESERVED                                  42600020
*                   BIT 4     RESERVED                                  42700020
*                   BIT 5     RESERVED                                  42800020
*                   BIT 6     RESERVED                                  42900020
*                   BIT 7     RESERVED                                  43000020
*                                                                       43100020
         DS    0CL11               COUNT FIELD FOR I/O                  43200020
DMPEND   DS    CL8                 MBBCCHHR OF LAST RECORD WRITTEN      43300020
DCKDLL   DS    CL3                 KEY LENGTH/DATA LENGTH               43400020
*                                                                       43500020
*        EXCP BUFFER  AREA FOR COUNT KEY DATA READ/WRITE                43600020
*                                                                       43700020
         DS    0F                  ALIGN WORD                           43800020
         DS    CL1                 ALIGN FOR MBBCCHHR                   43900020
DMBB     DS    CL3                 MBB FIELD FOR CONVERT ROUTINE        44000020
         DS    0CL8                COUNT FIELD FOR I/O                  44100020
DCNT     DS    CL4                 CCHH PORTION OF COUNT                44200020
DRECNO   DS    CL1                 RECORD NUMBER                        44300020
DKEYLEN  DS    CL1                 KEY LENGTH FOR FOR WRITE             44400020
DDATALEN DS    CL2                 DATA LENGTH FOR WRITE                44500020
DKEY     DS    CL44                EXCP- 44 BYTE KEY (DSN)              44600020
DKEY8    DS    CL8                 EXCP- 8 BYTE EXTENSION (PASSWORD)    44700020
DATA     DS    0CL80               DATA FIELD                           44800020
DUSE     DS    CL2                 USE COUNT                            44900020
DMODE    DS    BL1                 PROTECTION MODE BYTE FIELD           45000020
DAT77    DS    CL77                USER DATA (77 BYTES OPTIONAL DATA)   45100020
DSAVLL   EQU   *-DCNT              COUNT-KEY-DATA FIELD LENGTH          45200020
DCLEAR   EQU   *-COMMD             WORK AREA TO BE CLEARED TO ZERO      45300020
DFOXKEY  DS    52C                 52 BYTE KEY OF FF                    45400020
         DS    80C                 80 BYTE DATA FIELD                   45500020
*                                                                       45600020
*        OBTAIN LIST                                                    45700020
*                                                                       45800020
OBTPTR   CAMLST SEARCH,OBTDSN,OBTVOL,OBTWRK                             45900020
         ORG   OBTPTR              LABEL OBTAIN FIELDS                  46000020
OBTAIN1  DS    F                   OBTAIN CAMLST FIRST FULL WORD        46100020
OBTAIN2  DS    F                   OBTAIN CAMLST SECOND FULL WORD       46200020
OBTAIN3  DS    F                   OBTAIN CAMLST THIRD FULL WORD        46300020
OBTAIN4  DS    F                   OBTAIN CAMLST FOURTH FULL WORD       46400020
         ORG                                                            46500020
*                                                                       46600020
*        ENQUEUE PARAMETER LIST                                         46700020
*                                                                       46800020
DENQLST  ENQ   (DMPDSQN,DMPDS,E,HLEN,SYSTEM),MF=L                       46900020
*        NAME LIST FOR ENQUEUE/DEQUEUE AND OBTAIN                       47000020
DMPDSQN  DS    0CL52               ONE FIELD FOR SETTING UP IN WORKD    47100020
         DS    CL8                 QNAME                                47200020
DMPDS    DS    CL44                RNAME                                47300020
OBTDSN   EQU   DMPDS               DSNAME OF MASTER PASSWORD DATA SET   47400020
OBTVOL   DS    CL6                 VOLUME SERIAL OF MPDS DSCB VOLUME    47500020
DREPSAV  DS    CL140               SAVEAREA FOR PASSWORD ENTRY          47600020
LOCNAME  CAMLST NAME,DKEY,,LOCAREA LOCATE CAMLST MACRO                  47700020
         ORG   LOCNAME             LABEL LOCATE CAMLST FIELDS           47800020
LOCNAME1 DS    F                   1ST WORD LOCATE CAMLST               47900020
LOCNAME2 DS    F                   2ND WORD LOCATE CAMLST               48000020
LOCNAME3 DS    F                   3RD WORD LOCATE CAMLST               48100020
LOCNAME4 DS    F                   4TH WORD LOCATE CAMLST               48200020
         ORG                                                            48300020
USECOUNT DS    F                   SAVE POINTER TO USER COUNT HERE      48400020
*  KEEP ENQ AND DEQ LISTS TOGETHER.                                     48450020
ENQLIST  ENQ   (QNAME,RNAME,E,RNLENGTH,SYSTEM),RET=USE,MF=L ENQUEUE     48500020
DEQLIST  DEQ   (QNAME,RNAME,RNLENGTH,SYSTEM),RET=HAVE,MF=L DEQUEUE      48550020
*  NOTE - MFT ENQUEUE WITH QNAME EQUAL TO SYSDSN REQUIRES TCB           48560020
*         ADDRESS IMMEDIATELY FOLLOWING QNAME.                          48570020
QNAME    DS    CL8                 QNAME BUFFER                         48600020
TCBADDR  DS    F                   TCB ADDRESS FOR MFT ENQUEUE          48650020
RNAME    DS    CL44                RNAME BUFFER                         48700020
OLDFLAG  DS    CL1                 OLD PROTECTION STATUS                48800020
NEWFLAG  DS    CL1                 NEW PROTECTION STATUS                48900020
*  WORK AREA NEEDED FOR ALLOCATION                             @YL026TA 48902000
DAPARM   DS    F                   POINTER TO REQUEST BLOCK    @YL026TA 48904000
DARQBLK  DS    0CL20               DYNAMIC ALLOCATION REQUEST          *48906000
                                   BLOCK                       @YL026TA 48908000
DABLKLN  DS    CL1                 LENGTH OF BLOCK             @YL026TA 48910000
DAVERB   DS    CL1                 VERB CODE FOR REQUEST       @YL026TA 48912000
DAFLGS1  DS    CL2                 FLAGS                       @YL026TA 48914000
DAERRCD  DS    CL2                 ERROR RETURN CODE           @YL026TA 48916000
DAINFO   DS    CL2                 INFORMATIONAL RETURN CODE   @YL026TA 48918000
DATXTPT  DS    CL4                 ADDRESS OF TEXT POINTERS    @YL026TA 48920000
DRESVE   DS    CL4                 RESERVED                    @YL026TA 48922000
DAFLGS2  DS    CL4                 FLAGS                       @YL026TA 48924000
* TEXT POINTERS                                                @YL026TA 48926000
DATP1    DS    F                                               @YL026TA 48928000
DATP2    DS    F                                               @YL026TA 48930000
DATP3    DS    F                                               @YL026TA 48932000
DATP4    DS    F                                               @YL026TA 48934000
DATP5    DS    F                                               @YL026TA 48936000
*  TEXT UNITS FOR ALLOCATION AND UNALLOCATION                  @YL026TA 48938000
DADSNM   DS    0CL50               DSNAME TEXT UNIT            @YL026TA 48940000
         DS    CL2                 KEY                         @YL026TA 48942000
         DS    CL2                 NUMBER                      @YL026TA 48944000
DADSL    DS    CL2                 LENGTH                      @YL026TA 48946000
DADSN    DS    CL44                DATA SET NAME               @YL026TA 48948000
DASTAT   DS    0CL7                STATUS TEXT UNIT            @YL026TA 48950000
         DS    CL2                 KEY                         @YL026TA 48952000
         DS    CL2                 NUMBER                      @YL026TA 48954000
         DS    CL2                 LENGTH                      @YL026TA 48956000
         DS    CL1                 STATUS INDICATOR FIELD      @YL026TA 48958000
DAUNIT   DS    0CL9                UNIT NAME TEXT UNIT         @YL026TA 48960000
         DS    CL2                 KEY                         @YL026TA 48962000
         DS    CL2                 NUMBER                      @YL026TA 48964000
         DS    CL2                 LENGTH                      @YL026TA 48966000
DAUNAM   DS    CL3                 UNIT NAME FIELD             @YL026TA 48968000
DADDNM   DS    0CL14               DDNAME TEXT UNIT            @YL026TA 48970000
DADKEY   DS    CL2                 KEY                         @ZA02651 48972037
         DS    CL2                 NUMBER                      @YL026TA 48974000
         DS    CL2                 LENGTH                      @YL026TA 48976000
         DS    CL8                 DDNAME FIELD                @YL026TA 48978000
DAVOL    DS    0CL12               VOLUME TEXT UNIT            @YL026TA 48980000
         DS    CL2                 KEY                         @YL026TA 48982000
         DS    CL2                 NUMBER                      @YL026TA 48984000
         DS    CL2                 LENGTH                      @YL026TA 48986000
DAVOLSR  DS    CL6                 VOLUME SERIAL FIELD         @YL026TA 48988000
REGSAVE  DS    18F                 REG SAVE AREA               @ZA26554 49000037
RCVTSAVE EQU   REGSAVE+F12         CVT SAVEAREA                @ZA26554 49050037
*                                                                       49500020
*              PARAMETER LIST FOR ALL REQUESTS                          49600020
*                                                                       49700020
*                                                                       49800020
*              COMMON  SEGMENT FOR ALL REQUESTS                         49900020
*                                                                       50000020
PARMWDS  DS    0FL7                                            @ZA26554 50050037
ENCODE   DS    0BL1                ENTRY CODE                           50100020
DBUF     DS    CL4                 ADDRESS OF BUFFER FOR CODE 04/05     50200020
DSNLL    DS    0CL1                DSN LENGTH                           50300020
DSN      DS    CL4                 ADDRESS OF DATA SET NAME             50400020
CURRENT  DS    CL4                 ADDRESS OF CURRENT PASSWORD          50500020
*                                                                       50600020
*              ADD / REPLACE / DELETE COMMON SEGMENT                    50700020
*                                                                       50800020
CONTROL  DS    CL4                 ADDRESS OF CONTROL PASSWORD          50900020
VOLNUM   DS    0CL1                NUMBER OF VOLUMES SPECIFIED          51000020
VOLIST   DS    CL4                 ADDRESS OF VOLUME LIST               51100020
*                                                                       51200020
*              ADD / REPLACE  COMMON SEGMENT                            51300020
*                                                                       51400020
PCODE    DS    0BL1                PROTECTION CODE                      51500020
NEW      DS    CL4                 ADDRESS OF NEW PASSWORD              51600020
STRINGL  DS    0CL1                STRING LENGTH                        51700020
STRING   DS    CL4                 ADDRESS OF DATA STRING               51800020
*                                                                       51900020
WKSIZE   EQU   *-WORKD             SIZE OF PROGRAM WORKAREA             51920037
*                                                                       51940037
*        END OF MAPPING OF DSECT WORKAREA                               51960037
         EJECT                                                          52000020
*                                                                       52100020
WRKSPACE DSECT                                                          52200020
*                                                                       52300020
*  OBTAIN WORKAREA AND LOCATE WORKAREA                                  52400020
*                                                                       52500020
OBTWRK   DS    CL96                DSCB                                 52600020
OBTCCH   DS    CL5                 CCHHR                                52700020
         DS    CL249               OBTAIN WORK SPACE                    52800020
         DS    0D                  ALIGN LOCATE WORKAREA                52900020
LOCAREA  DS    CL265               LOCATE WORK SPACE (VOLUME LIST)      53000020
WRKSIZE  EQU   *-WRKSPACE          SIZE OF LOCATE AND OBTAIN WORKAREA   53100020
*                                                                       53200020
         EJECT                                                          53300020
*                                                                       53400020
         EJECT                                                          53700020
SRT      DSECT                                                          53800020
         IEFUCBOB                                                       53900020
         EJECT                                                          54000020
CVT      DSECT                                                          54100020
         CVT                                                            54200020
         EJECT                                                 @YL026TA 54300000
         IHAPSA                                                @YL026TA 57300000
         EJECT                                                 @YL026TA 60300000
         IEFZB4D0                                              @YL026TA 63300000
*                                                                       66300000
         END                                                            69300000
