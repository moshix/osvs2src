         TITLE 'IGC0710D - OUTPUT MESSAGE ROUTER FOR OP CONTROL'        00100022
IGC0710D CSECT                                                          00200022
         SPACE 3                                                        00201022
*CHANGE-ACTIVITY = AS FOLLOWS:                                          00202022
******************** MICROFICHE FLAGS *********************** SUPT CODE 00203022
*A000000-999999                                                  S99240 00250022
*D444000-445000                                                 SA59003 00250122
*A124000,150000,175000,553000                                   SA67103 00259154
*C296000-305000,443000-484000,523500-526000                     SA67103 00268154
*D195500                                                        SA67103 00277154
*               67103 RE-WROTE                                  SA67068 00286154
*C559000                                                        SA65449 00292105
*A215000                                                       @YA05128 00293156
*A442000                                                       @YA05139 00294156
*D479000-482000                                                @YA05139 00295156
*A278000,279000                                                @YA06888 00295258
*A473000                                                       @SA74873 00295358
*A171500,226000                                                @YA10424 00295458
*A015000,046000,048000,115000,121500,519000                    @Y17XARX 00296300
*C006000,008000,015000,026000,048000,065000,081000,461000      @Y17XARX 00297200
*C562800                                                       @Y17XARX 00298100
*D005000,005500,562600                                         @Y17XARX 00299000
*C278500                                                       @OY13278 00299300
*A560000                                                       @OY13278 00299600
         SPACE 3                                                        00300022
*********************************************************************** 00300122
*                                                                     * 00400022
* MODULE NAME = IGC0710D (TCAM, OPERATOR CONTROL)              @Y17XARX 00450000
*                                                                     * 00650000
*  DESCRIPTIVE NAME = OUTPUT MESSAGE WRITER                           * 00700000
*                                                                     * 00750000
* STATUS = VERSION 10.0                                        @Y17XARX 00770000
*                                                                     * 00850000
*  COPYRIGHT = 'NONE'                                                 * 00900000
*                                                                     * 01000022
*FUNCTION -                                                           * 01100022
*                                                                     * 01200022
*        THIS MODULE GAINS CONTROL VIA AN XCTL FROM VARIOUS OPERATOR  * 01300022
*        CONTROL ROUTINES WHICH WANT TO OUTPUT A MESSAGE TO A TERMINAL* 01400022
*        A CONSOLE OR SSCP MH OR PASS A RETURN CODE TO TOTE    @Y17XARX 01430000
*        OR AN MPP.                                            @Y17XARX 01460000
*                                                                     * 01600022
*        UPON ENTRY IT CHECKS THE CURRENT ELEMENT FIELD IN THE OPCAVT.* 01700022
*        IF THERE ISN'T AN ELEMENT IT CHECKS TO SEE IF THERE IS ANY   * 01800022
*        CONSOLE INPUT OR OUTPUT. IT PICKS UP THE LENGTH OF THE       * 01900022
*        MESSAGE FROM THE OPERATOR CONTROL RESIDENT WORK AREA AND     * 02000022
*        CHECKS IF FOR 0. IF 0 IT XCTLS TO THE MODULE INDICATED BY THE* 02100022
*        ID IN THE WTG FIELD OR IT FREES BUFFER UNITS BY TPOSTING THEM* 02200022
*        TO BUFFER RETURN IF THERE ISN'T AN ID IN THE WTG FIELD.      * 02300022
*                                                                     * 02400022
*        IF THERE IS AN ELEMENT PRESENT IT DETERMINES WHERE THE OUTPUT* 02500022
*        IS GOING; EITHER TOTE,MPP,CONSOLE OR TERMINAL.               * 02600022
*                                                                     * 02700022
*        IF TOTE; IT POSTS TOTE'S ECB COMPLETE THEN FREES ANY UNITS   * 02800022
*        ASSOCIATED WITH THE COMMAND.                                 * 02900022
*                                                                     * 03000022
*        IF MPP; IT POSTS THE MPP COMPLETE THEN FREES ANY BUFFER      * 03100022
*        UNITS ASSOCIATED WITH THE COMMAND.                           * 03200022
*                                                                     * 03300022
*        IF CONSOLE; IT USES A WTO TO OUTPUT THE MESSAGE TO THE CONSOLE 03400022
*        IF NO BUFFER UNITS ARE ASSOCIATED WITH THE COMMAND IT XCTLS  * 03500022
*        BACK TO IGC0010D. IF UNITS ARE ASSOCIATED IT XCTLS TO THE    * 03600022
*        MODULE INDICATED BY THE ID IN THE WTG FIELD. IF ONE IS       * 03700022
*        PRESENT. IF ONE ISN'T PRESENT IT FREES BUFFER UNITS BY       * 03800022
*        TPOSTING THEM TO BUFFER DISPOSITION.                         * 03900022
*                                                                     * 04000022
*        IF OUTPUT IS FOR A TERMINAL IT MOVES THE MESSAGE FROM THE    * 04100022
*        RESIDENT WORKAREA INTO BUFFER UNITS THEN IT INITIALIZES A    * 04200022
*        DUMMY LCBAND SCB IN ORDER TO GET THE OUTPUT MESSAGE ON THE   * 04300022
*        CORRECT OUTPUT QUEUE BY USING THE LCBSETUP SUBROUTINE IN     * 04400022
*        IEDQCA. THEN IT TPOSTS THE BUFFER TO BUFFER DISPOSITION.     * 04500022
*                                                                     * 04600022
*        IF OUTPUT IS FOR SSCP MH, IGC0710D MOVES THE MESSAGE  @Y17XARX 04604000
*        FROM THE RESIDENT WORKAREA INTO BUFFER UNITS, INITIAL-@Y17XARX 04608000
*        IZES THE BUFFER TO BE PROCESS THROUGH THE SSCP MH,AND @Y17XARX 04612000
*        SETS UP THE RH.  IGCO710D TPOST THE BUFFER TO SSCP    @Y17XARX 04616000
*        DESTINATION QUEUE.                                    @Y17XARX 04620000
*                                                              @Y17XARX 04624000
* NOTES = COMMUNICATION BETWEEN THE VARIOUS TRANSIENT MODULES  @Y17XARX 04628000
* IS PRIMARILY THORUGH THE OPERATOR CONTROL AVT.               @Y17XARX 04632000
*        DEPENDENCIES = NONE                                   @Y17XARX 04636000
*        RESTRICTIONS = NONE                                   @Y17XARX 04640000
*        REGISTER CONVENTIONS = OPERATOR CONTROL               @Y17XARX 04644000
*        PATCH LABEL = PATCH                                   @Y17XARX 04648000
*                                                              @Y17XARX 04652000
* MODULE TYPE = PROCEDURE                                      @Y17XARX 04656000
*        PROCESSOR = ASSEMBLER                                 @Y17XARX 04660000
*        MODULE SIZE = 1050 BYTES                              @Y17XARX 04664000
*        ATTRIBUTES = REFRESHABLE,DISABLED,SERIALLY REUSABLE,  @Y17XARX 04668000
*        TRANSIENT(TYPE 4),SUPERVISOR MODE                     @Y17XARX 04672000
*                                                              @Y17XARX 04676000
* ENTRY POINT = IGC0710D                                       @Y17XARX 04680000
*        PURPOSE = SEE FUNCTION                                @Y17XARX 04684000
*        LINKAGE = XCTL SF( E, OPCXCTL)                        @Y17XARX 04688000
*                                                                     * 04900022
*INPUT -                                                              * 05000022
*        POINTER TO THE OPERATOR CONTROL AVT IN REGISTER 1 AND        * 05100022
*        A PARAMETER IN REGISTER ZERO.                                * 05200022
*                                                                     * 05300022
*OUTPUT - TPOST ECB FOR TOTE OR MPP                                   * 05400022
*            PASSES CIB                                               * 05500022
*            IN CIB IS RETURN CODE                                    * 05600022
*               0 - FUNCTION REQUESTED WAS SUCCESSFUL                 * 05700022
*               4 - FUNCTION REQUESTED WAS UNSUCCESSFUL               * 05800022
*               8 - FUNCTION REQUESTED HAS ALREADY BEEN DONE          * 05900022
*                                                                     * 06000022
*         CONSOLE                                                     * 06100022
*            WRITES OUTPUT MESSAGE                                    * 06200022
*                                                                     * 06300022
*         TERMINAL                                                    * 06400022
*            TPOST BUFFER CONTAINING THE MESSAGE TO IEDQBD     @Y17XARX 06420000
*                                                              @Y17XARX 06440000
*         TERMINAL (SSCP)                                      @Y17XARX 06460000
*            TPOST BUFFER CONTAINING THE MESSAGE TO SSCP D.QUE @Y17XARX 06480000
*                                                                     * 06600022
*EXTERNAL ROUTINES -                                                  * 06700022
*        SVC 7 (XCTL)                                                 * 06800022
*        SVC 102 (AQCTL)                                              * 06900022
*        SVC 35 (WTO)                                                 * 07000022
*        OPCGETBF - ALLOCATE BUFFER SUBROUTINE IN IEDQCA              * 07100022
*        OPCLCB - LCBSETUP SUBROUTINE IN IEDQCA                       * 07200022
*                                                                     * 07300022
*EXITS -                                                              * 07400022
*        NORMAL - IGC0010D OR ANY MODULE WHOSE ID IS IN THE WTG FIELD * 07500022
*                                                                     * 07600022
*        ABNORMAL -                                                   * 07700022
*              NONE                                                   * 07800022
*                                                                     * 07900022
*TABLES/WORKAREAS -                                                   * 08000022
*        TCAM AVT,OP CONTROL AVT, OPCE,IEAQFX,PCB,PRF,PRF1,RH, @Y17XARX 08030000
*        SECONDARY AVT                                         @Y17XARX 08060000
*                                                                     * 08200022
*ATTRIBUTES -                                                         * 08300022
*        REFRESHABLE,DISABLED,SERIALLY REUSABLE,TRANSIENT (TYPE 4)    * 08400022
*        SUPERVISOR MODE                                              * 08500022
*                                                                     * 08600022
*NOTES -                                                              * 08700022
*        THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL        * 08800022
*        REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS        * 08900022
*        EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE CODING     * 09000022
*        HAS BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER          * 09100022
*        CONSTANTS, BY REASSEMBLY WILL RESULT IN A CORRECT MODULE     * 09200022
*        FOR THE NEW DEFINITION.                                      * 09300022
*                                                                     * 09400022
*        COMMUNICATIONS BETWEEN THE VARIOUS TRANSIENT MODULES IS      * 09500022
*        PRIMARILY THROUGH THE OPERATOR CONTROL AVT.                  * 09600022
*                                                                     * 09700022
*********************************************************************** 09800022
         EJECT                                                          09900022
         SPACE                                                          10000022
*                          E Q U A T E S                                10100022
         SPACE                                                          10200022
RZERO    EQU   0                        PARAMETER REGISTER              10300022
RPARM    EQU   1                        PARAMETER REGISTER              10400022
ROPCAVT  EQU   2                        POINTER TO OP CONTROL AVT       10500022
ROPCE    EQU   3                        POINTER TO CURRENT ELEMENT      10600022
RAVT     EQU   4                        POINTER TO TCAM AVT             10700022
RCIB     EQU   5                        CIB POINTER                     10800022
RKEY     EQU   5                        UNIT LENGTH                     10900022
RWORKA   EQU   6                        POINTER TO WORKAREA             11000022
RHOLD    EQU   7                        WORK REGISTER                   11100022
RWORK    EQU   8                        WORK REGISTER                   11200022
RPREFIX  EQU   9                        UNIT POINTER                    11300022
RDATA    EQU   9                        POINTER TO MSG IN WORKAREA      11400022
RBUFF    EQU   10                       DATA POINTER IN UNITS           11500022
RSAVTPTR EQU   10                       TO ACCESS SAVT FIELDS  @Y17XARR 11550000
RLEN     EQU   11                       LENGTH OF OUTPUT MESSAGE        11600022
RBASE    EQU   12                       BASE FOR MODULE                 11700022
R13      EQU   13                       BASE FOR REGSAVE AREA IN OPCAVT 11800022
RRET     EQU   14                       SUBROUTINE RETURN ADDRESS       11900022
RBRNCH   EQU   15                       SUBROUTINE ENTRY POINTER        12000022
         SPACE 2                                                        12100022
*        M I S C E L L A N E O U S       E Q U A T E S                  12150022
ADDRESS  EQU   7                        PICKUP 3 BYTE ADRESS   @Y17XARR 12170000
ADDRLEN  EQU   3                        LENGTH OF ADDRESS               12200022
ALL      EQU   120                      LENGTH OF 120                   12300022
BEGIN    EQU   0                        OFFSET TO BEGINNING OF DATA     12400022
BLANK    EQU   X'40'                    BLANK CHARACTER         SA67103 12450054
BUSY     EQU   4                        BIT ON FROM TS INSTRUCTION      12500022
BYTETWO  EQU   16                       SPECIAL SHIFT FOR ERROR 63      12600022
CODELEN  EQU   4                        LENGTH OF WTO CODE FIELDS       12700022
CODEOFF  EQU   5                        OFFSET TO WTO CODES             12800022
ECB      EQU   12                       OFFSET TO ECB ADDR IN CIB       13000022
END      EQU   0                        LAST OF MESSAGE                 13100022
ENDLIST  EQU   128                      END OF AQCTL LIST               13200022
EOT      EQU   X'37'                    END OF TRANSMISSION             13300022
EXTRA    EQU   1                        ONE BYTE LENGTH                 13400022
FREE     EQU   1                        210D CODE TO RELEASE UNITS      13500022
LAST     EQU   40                       LAST MOVE LENGTH                13600022
LASTDATA EQU   380                      LAST MOVE TO ADDRESS            13700022
LASTMOVE EQU   500                      LAST MOVE FROM ADDRESS          13800022
LEFT     EQU   6                        OFFSET TO REMAINING SPACE       13900022
LENCOUNT EQU   4                        FIRST FOUR  BYTES OF WTO        14000022
LENLEN   EQU   2                        LENGTH OF LENGTH FIELD          14100022
LENOFF   EQU   0                        OFFSET IN WORKAREA TO MSG LENGT 14200022
LENTWO   EQU   2                        LENGTH OF TWO                   14300022
LINK     EQU   4                        LENGTH OF LINK FIELD            14400022
MCSLEN   EQU   2                        LENGTH OF WTO FLAGS             14500022
MCSFLAG  EQU   2                        OFFSET TO WTO FLAGS             14600022
MSGOFF   EQU   4                        LOCATION OF MESSAGE IN WORKAREA 14700022
NAMELEN  EQU   2                        LENGTH OF XCTL NAME CHANGE      14800022
NOTBUSY  EQU   8                        EIGHT                    S22024 14900000
NOTCA    EQU   2                        ENTRY NOT FROM IEDQCA           15000022
NOTONES  EQU   14                       CONDITION CODE FOR BCR  SA67103 15050054
NOTTERM  EQU   128                      FREE UNITS ONLY                 15100022
ONE      EQU   1                        OFFSET OF ONE                   15200022
OUTTOTE  EQU   64                       SPECIAL FLAG FOR TOTE IN-OUT    15300022
PASTOLT  EQU   4                        OFFSET TO PASS OLT=             15400022
POST     EQU   12                       POST FLAGS FOR 102              15500022
REMDATA  EQU   244                      OFFSET TO LAST OF DATA          15600022
REST     EQU   256                      LENGTH OF LAST PART OF DATA     15700022
RETCODE  EQU   11                       OFFSET IN CIB FOR RETURN CODE   15800022
SECDATA  EQU   124                      OFFSET TO SECOND PART OF DATA   15900022
SIZELEN  EQU   2                        LENGTH OF PRFSIZE               16000022
START    EQU   4                        OFFSET TO NEXT BYTE IN UNIT     16100022
TCB      EQU   9                        OFFSET FOR TCB ADDR IN 102 LIST 16200022
THREE    EQU   3                        LENGTH OF THREE                 16300022
TIC      EQU   8                        TIC COMMAND                     16400022
TJID     EQU   4                        OFFSET TO TJID                  16500022
TOTECON  EQU   X'0C'                    TRM FROM CONSOLE                16600022
TOTETERM EQU   X'10'                    TRM FROM TERMINAL               16700022
VARINAME EQU   3                        OFFSET TO CHANGE LOAD NAME      16800022
CKPMOD   EQU   C'6'                     ID OF CHECKPOINT MODULE  S22024 16850000
WORD     EQU   4                        LENGTH OF ONE WORD              16900022
WTGLEN   EQU   2                        LENGTH OF NAME CHANGE           17000022
ZERO     EQU   0                        ZERO                     S22024 17100000
FOUR     EQU   4                        DISPLACEMENT           @ZM46693 17110000
USEASCB  EQU   X'80'                    HAVE ASCB PTR FLAG     @ZM46693 17120000
EIGHT    EQU   8                        EIGHT                    S22024 17150000
SWAP     EQU   X'02'                    FLAG TO MAKE SWAPPABLE @YA10424 17170058
         EJECT                                                          17200022
         USING IEDQAVTD,RAVT            TCAM AVT ADDRESSABILITY         17300022
         USING IEDQOPCD,ROPCAVT         OP CONTROL AVT ADDRESSABILITY   17400022
         USING IEDQOPCE,ROPCE           ELEMENT ADDRESSABILITY          17500022
         USING IEDQTRM,RPARM            TERMINAL ADDRESSABILITY SA67103 17550054
         SPACE                                                          17600022
         BALR  RBASE,0                  MODULE BASE                     17700022
         USING *,RBASE                  MODULE ADDRESSABILITY           17800022
IGC0710D IEDHJN SKIPID                                                  18100022
         LR    ROPCAVT,RPARM            SET AVT BASE                    18400022
         L     RAVT,OPCAVTPT            ADDRESS TCAM AVT                18500022
         MVI   OPCLDNME+VARINAME+ONE,CKPMOD SET CHECKPOINT AS    S22024 18520000
*                                        NEXT MODULE             S22024 18540000
         TM    OPCSPEC,OPCRSTRT         RESTART IN PROGRESS      S22024 18560000
         BO    XCTL                     YES, EXIT                S22024 18580000
         MVC   OPCLDNME+VARINAME(NAMELEN),FIRSTLD SET NEXT MOD          18600022
         L     RWORKA,OPCWORK           ADDRESS OF WORKAREA IN IEDQCA   18700022
         LA    R13,OPCSAVE              ADDRESS OF SAVEAREA IN OPCAVT   18800022
         L     ROPCE,OPCCOPCE           GET ELEMENT ADDRESS             18900022
         LTR   ROPCE,ROPCE              NO ELEMENT?                     19000022
         BZ    CONOUT                   CORRECT, CONSOLE INPUT, OUTPUT  19100022
         SPACE                                                          19200022
         CLC   OCOPTCDE(LENTWO),TOTEOUT REQUEST TO POST OLT TO TOTE?    19300022
         BNE   TESTMPP                  NO, TEST NORMAL OUTPUT          19400022
         SPACE                                                          19500022
         OI    OPCFLAG1,OUTTOTE+NOTTERM INDICATE SPECIAL TOTE PROCESS   19600022
         MVI   OCSWITCH,TOTETERM        DEFAULT TO TERM INPUT           19700022
         TM    OCFLAG,OCCONSOL          INPUT FORM CONSOLE?             19800022
         BNO   TESTMPP                  NO, FROM SECONDARY TERM         19900022
         SPACE                                                          20000022
         MVI   OCSWITCH,TOTECON         INDICATE CONSLE INPUT TO TOTE   20100022
         NI    OCFLAG,OCFOXES-OCCONSOL  TURN OFF CONSOLE FLAG           20200022
*        TEST MPP OR TOTE                                               20250022
TESTMPP  EQU   *                                                        20300022
         TM    OCFLAG,OCTOTE+OCMPP      TOTE OR MPP COMMAND             20400022
         BZ    TESTCON                  NO, TEST FOR CONSOLE INPUT      20500022
         TITLE 'IGC0710D - TOTE, MPP POST ROUTINE'                      20600022
         L     RCIB,OCCIB               GET CIB ADDRESS                 20700022
         LR    RWORK,RZERO              INSERT MSG NUM IN REG 8         20800022
         N     RWORK,AVTCLRHI           CLEAR HI ORDER 2 BYTES          20900022
         CH    RWORK,CLOSEMSG           MSG NUM EQUAL 63                21000022
         BNE   STORECDE                 NO                              21100022
         SR    RZERO,RZERO              YES ZERO OUT TO INDICATE GOOD   21200022
*                                       RETURN CODE                     21300022
STORECDE EQU   *                                                        21400022
         LA    RWORK,AVTHRESE           GET ADDR OF THRESHOLD  @YA05128 21510056
*                                        CLOSEDOWN ELEMENT     @YA05128 21520056
         LA    RCIB,0(RCIB)             CLEAR HIGH ORDER BYTE  @YA05128 21530056
         CR    RCIB,RWORK               IS THIS THE CIB        @YA05128 21540056
         BE    CONOUT                   YES, MESSAGE GOES TO   @YA05128 21550056
*                                        CONSOLE               @YA05128 21560056
         TM    OCFLAG,OCTOTE            TOTE INPUT FOR COMMAND?         21700022
         BO    POSTTOTE                 YES, ISSUE POST FOR TOTE        21800022
         SPACE 1                                                        21802000
         LA    RWORK,AIBKEY-IEDQAIB     BACK UP TO BEGINNING OF@ZM46693 21804000
         SR    RCIB,RWORK               THE AIB                @ZM46693 21806000
         USING IEDQAIB,RCIB             AIB ADDRESSABILITY     @ZM46693 21808000
         SR    RHOLD,RHOLD              CLEAR REGISTER         @ZM46693 21810000
         ICM   RHOLD,ONE,AIBOPRC        CHECK FOR RET CODE     @ZM46693 21812000
         BNZ   GOMPP                    BR IF RC ALREADY SET   @ZM46693 21814000
         LTR   RZERO,RZERO              RET CODE IN R0         @ZM46693 21816000
         BZ    GOMPP                    BR IF GOOD COMPLETION  @ZM46693 21818000
         STC   RZERO,AIBOPRC            SET ERROR CODE         @ZM46693 21820000
         SPACE 1                                                        21822000
GOMPP    EQU   *                                               @ZM46693 21824000
         L     RHOLD,AIBPCBAD           PTR TO PCB OR ASCB     @ZM46693 21826000
         TM    AIBPCBAD,USEASCB         DO WE HAVE THE ASCB PTR@ZM46693 21828000
         BO    SETPARMS                 BRANCH IF YES          @ZM46693 21830000
         L     RHOLD,PCBPEBAD-IEDQPCB(RHOLD)   GET PEB ADDRESS @ZM46693 21832000
         LTR   RHOLD,RHOLD              HAS APPL PROGRAM CLOSED@ZM46693 21834000
         BZ    FREEUNIT                 BRANCH IF YES          @ZM46693 21836000
         L     RHOLD,PEBASCB-IEDQPEB(RHOLD)  GET ASCB PTR      @ZM46693 21838000
         LTR   RHOLD,RHOLD              IS APPL PROG IN THE    @ZM46693 21840000
*                                       PROCESS OF CLOSING     @ZM46693 21842000
         BM    FREEUNIT                 BRANCH IF YES          @ZM46693 21844000
         SPACE 1                                                        21846000
SETPARMS EQU   *                                               @ZM46693 21848000
         LA    RHOLD,ZERO(RHOLD)        CLEAR HI ORDER BYTE    @ZM46693 21850000
         L     RPARM,AIBECBA            GET ECB TO BE POSTED   @ZM46693 21852000
         L     RWORK,CVTPTR             GET CVT PTR            @ZM46693 21854000
         LA    RWORK,CVTBRET-CVTMAP(RWORK) XMPOST ERR EXIT ADDR@ZM46693 21856000
         ICM   RWORK,EIGHT,HEX80        FLAG TELLING XMPOST NOT@ZM46693 21858000
*                                       TO RESTORE REGISTERS   @ZM46693 21860000
         ST    RPARM,AIBXMLST           SET POINTERS IN XMPOST @ZM46693 21862000
         STM   RHOLD,RWORK,AIBXMLST+FOUR     SET PARMS IN LIST @ZM46693 21864000
         LA    RPARM,AIBXMLST           SET PARM REGISTER      @ZM46693 21866000
         SR    RZERO,RZERO              CLEAR COMP CODE REG    @ZM46693 21868000
         POST  ,(0),MF=(E,(1))          XMPOST                 @ZM46693 21870000
         DROP  RCIB                     FREE REGISTER          @ZM46693 21872000
         SPACE 2                                                        23300022
         TM    AVTBIT1,AVTCLOSN         CLOSEDOWN IN EFFECT?            23400022
         BO    HAVEID                   YES - DON'T FREE UNITS          23500022
         B     FREEUNIT                 FREE ATTACHED UNITS             23600022
         SPACE                                                          23700022
POSTTOTE EQU   *                                                        23800022
         STC   RZERO,RETCODE(RCIB)      SET RETURN CODE        @ZM46693 23830000
         L     RWORK,ECB(RCIB)          GET ECB ADDR FOR POST  @ZM46693 23860000
         LR    RPARM,RWORK              POINT 1 TO ECB                  23900022
         SPACE                                                          24000022
         POST  (1)                      POST COMPLETION IN TOTE ECB     24100022
         SPACE 2                                                        24200022
         B     FREEUNIT                 FREE ATTACHED UNITS             24300022
         TITLE 'IGC0710D - CONSOLE OUTPUT WRITER'                       24400022
CONOUT   EQU   *                                                        24500022
         SRL   RZERO,BYTETWO            SHIFT FOR CONSOLE ID            24600022
         B     HAVEID                   CONSOLE ID SET                  24700022
         SPACE                                                          24800022
*        TEST CONSOLE                                                   24850022
TESTCON  EQU   *                                                        24900022
         TM    OCFLAG,OCCONSOL          CONSOLE INPUT FOR COMMAND?      25000022
         BO    AROUND                   YES                             25100022
         TM    AVTBIT1,AVTCLOSN         CLOSEDOWN IN EFFECT?            25200022
         BO    HAVEID                   YES                             25300022
         B     CHEKUNIT                 NO CHECK BUFFER UNITS           25400022
         SPACE                                                          25500022
AROUND   EQU   *                                                        25600022
         SR    RZERO,RZERO              CLEAR TO RECEIVE CONSOLE ID     25700022
         IC    RZERO,OCCONID            PICK UP CONSOLE ID FROM ELEM    25800022
HAVEID   EQU   *                                                        25900022
         SPACE                                                          26000022
         LH    RWORK,LENOFF(RWORKA)     PICK UP MESSAGE LENGTH          26100022
         LTR   RWORK,RWORK              ZERO LENGTH?                    26200022
         BZ    CHEKXCTL                 BRANCH IF YES            S22024 26300000
         LA    RLEN,WTOLEN              GET LENGTH OF WTO LINE   S22024 26400000
         SPACE                                                          26500022
WRTCONT  EQU   *                                                        26600022
         LA    RWORK,LENCOUNT(RWORK)    ADD MSG. FLAGS TO LENGTH        26700022
         STH   RWORK,LENOFF(RWORKA)     STORE IN WTO LIST               26800022
         SR    RWORK,RLEN               CK FOR MORE DATA THAN LINE LEN  26900022
         BNP   ENDWRT                   NO, DO WTO                      27000022
         STH   RLEN,LENOFF(RWORKA)      YES, SET LINE LEN TO MAX.       27100022
         SPACE                                                          27200022
ENDWRT   EQU   *                                                        27300022
         LR    RPARM,RWORKA             POINT TO MESSAGE                27400022
         MVC   MCSFLAG(MCSLEN,RWORKA),WTOOUT+MCSFLAG PLACE WTO FLAGS    27500022
         AH    RWORKA,LENOFF(RWORKA)    CODES IN MESSAGE                27600022
         MVC   OPCDOUBL(CODELEN),AVTEZERO(RWORKA) SAVE 4 BYTES OF DATA  27700022
         MVC   AVTEZERO(CODELEN,RWORKA),WTOOUT+CODEOFF SET WTO CODES    27800022
         LTR   RRET,RZERO               CONSOLE ID THERE       @OY13278 27850000
         BNZ   USEID                    YES, GO USE IT         @OY13278 27860000
         NI    MCSFLAG(RPARM),NOTREGO   INDICATE TO USE MCSFLAG@OY13278 27870000
         MVC   AVTEZERO(CODELEN,RWORKA),MSCON SET MASTER CONSOL@OY13278 27880000
USEID    EQU   *                                               @OY13278 27890000
         WTO   MF=(E,(1))               WRITE LINE OF MESSAGE           27900022
         LR    RZERO,RRET               RESTORE CONSOLE ID     @YA06888 27950058
         MVC   AVTEZERO(CODELEN,RWORKA),OPCDOUBL RESTORE SAVED DATA     28000022
         SH    RWORKA,AVTHA4            BACK UP FOR LENGTH & MCSFLAGS   28100022
         LTR   RWORK,RWORK              ANY DATA LEFT                   28200022
         BP    WRTCONT                  YES, RETURN FOR NEXT WTO        28300022
         TITLE 'IGC0710D - FREE UNIT CODE'                              28400022
CHEKXCTL EQU   *                                                        28500022
         LTR   ROPCE,ROPCE              NO BUFFERS?                     28600022
         BZ    SETPARM                  CALL 010D                       28700022
         TM    AVTBIT1,AVTCLOSN         CLOSEDOWN IN EFFECT?            28800022
         BO    SETPARM                  YES, CALL 010D                  28900022
         SPACE                                                          29000022
         OC    OCWTG(WTGLEN),OCWTG      WHERE TO GO SET?                29100022
         BNZ   ENDOUT                   YES, SET MOD NAME               29200022
         SPACE                                                          29300022
         USING IEDQPRF,ROPCE                                            29400022
FREEUNIT EQU   *                                                        29500022
         BAL   RRET,CHKATTCH            GO CHECK OCATTACH       SA67103 29600054
         LR    RPARM,ROPCE              GET BFR TO BE FREED     SA67103 29800054
         L     RBRNCH,OPCFREBF          ADDR OF FREE-BFR RTN    SA67103 30000054
         BALR  RRET,RBRNCH              GO FREE OPCE'S UNITS    SA67103 30200054
         B     SETPARM                  GO PREPARE TO EXIT      SA67103 30400054
         TITLE 'IGC0710D - TERMINAL OUTPUT ROUTINE'                     30600022
         USING IEDQOPCE,ROPCE                                           30700022
COUNTBUF EQU   *                                                        33300022
         LR    RPREFIX,ROPCE            GET START POINTER               33400022
CLEARCTR EQU   *                                                        33450022
         SR    RWORK,RWORK              CLEAR COUNTER                   33500022
         USING IEDQPRF,RPREFIX                                          33600022
UNITCNT  EQU   *                                                        33700022
         EX    RPREFIX,OPCHNEND    END OF CHAIN?                        33800022
         BNZ   COUNTEND                 YES, GET TOTAL COUNT            33900022
         SPACE                                                          34000022
         MVI   PRFTIC,TIC               SET TIC FIELD                   34100022
         LR    RBUFF,RPREFIX            SAVE LAST UNIT POINTER          34200022
         L     RPREFIX,PRFTIC           GET TIC FIELD                   34300022
         BCT   RWORK,UNITCNT            NEGATIVE COUNTER                34400022
         SPACE                                                          34500022
COUNTEND EQU   *                                                        34600022
         LPR   RWORK,RWORK              MAKE COUNT POSITIVE             34700022
         BR    RRET                     BACK TO PROCESSING              34800022
         EJECT                                                          34850000
         SPACE                                                          34900022
         USING IEDQOPCE,ROPCE                                           35000022
         DROP  RPREFIX                                           S22024 35050000
CHEKUNIT EQU   *                                                 S22024 35100000
         LH    RHOLD,LENOFF(RWORKA)     GET MESSAGE LENGTH       S22024 35150000
         TM    OCFLAG,OCOUTPUT          IS THIS MULTI-PART       S22024 35200000
*                                       OUTPUT REQUEST           S22024 35250000
         BO    MULTI                    BRANCH ON YES            S22024 35300000
         LA    RWORK,AVTHDRSZ+ONE       GET HEADER PREFIX SIZE   S22024 35350000
         DROP  ROPCE                                             S22024 35400000
         USING IEDQPRF,ROPCE                                     S22024 35450000
         STH   RWORK,PRFSIZE            SET INITIAL DATA SIZE    S22024 35500000
         BCTR  RWORK,ZERO               SET COUNT FOR SCAN       S22024 35550000
         SLL   RWORK,EIGHT              SHIFT SIZE TO HIGH       S22024 35600000
*                                       ORDER HALF OF HALFWORD   S22024 35650000
         STH   RWORK,PRFSCAN            SET INITIAL SCAN OFFSET  S22024 35700000
         MVI   PRFSTAT1,ZERO            SET BUFFER STATUS        S22024 35750000
         DROP  ROPCE                                             S22024 35800000
         USING IEDQOPCE,ROPCE                                    S22024 35850000
         ST    ROPCE,OCBACKUP           STORE ADDRESS OF FIRST   S22024 35900000
*                                       UNIT TO RECEIVE DATA     S22024 35950000
         LA    RWORK,PRFSHDR-IEDQPRF    GET OFFSET TO FIRST      S22024 36000000
*                                       BYTE OF DATA IN HEADER   S22024 36050000
         STH   RWORK,OCBACKUP+START     STORE START ADDRESS      S22024 36100000
         BAL   RRET,COUNTBUF            GET COUNT OF UNITS       S22024 36150000
         DROP  ROPCE                                             S22024 36200000
         USING IEDQPRF,ROPCE                                     S22024 36250000
         STC   RWORK,PRFNBUNT           SET UNIT COUNT IN BUFFER S22024 36300000
         LH    RLEN,AVTKEYLE            GET UNIT SIZE            S22024 36350000
         MR    RBUFF,RWORK              CALCULATE SPACE AVAILABLES22024 36400000
*                                       IN ALL UNITS             S22024 36450000
         SH    RLEN,PRFSIZE             SUBTRACT HEADER SIZE     S22024 36500000
         DROP  ROPCE                                             S22024 36550000
         USING IEDQOPCE,ROPCE                                    S22024 36600000
         STH   RLEN,OCBACKUP+LEFT       STORE AMOUNT OF SPACE    S22024 36650000
         LR    RBUFF,ROPCE              SET ADDRESS OF CURRENT   S22024 36700000
*                                       UNIT TO RECEIVE DATA     S22024 36750000
MULT2    EQU   *                                                 S22024 36800000
         LTR   RHOLD,RHOLD              IS MESSAGE LENGTH ZERO   S22024 36850000
         BZ    OUTPUT                   BRANCH ON YES            S22024 36900000
         CH    RHOLD,OCBACKUP+LEFT      IS ENOUGH SPACE          S22024 36950000
*                                       AVAILABLE FOR MESSAGE    S22024 37000000
         BH    NEEDUNIT                 BRANCH ON NO             S22024 37050000
MOVMSG   EQU   *                                                 S22024 37100000
         LA    RDATA,MSGOFF(RWORKA)     ADDRESS OF MESSAGE TEXT  S22024 37150000
         LR    RLEN,RHOLD               SAVE MESSAGE LENGTH      S22024 37200000
         DROP  ROPCE                                             S22024 37250000
         USING IEDQPRF,ROPCE                                     S22024 37300000
         AH    RHOLD,PRFSIZE            CALCULATE NEW DATA SIZE  S22024 37350000
         STH   RHOLD,PRFSIZE            STORE NEW SIZE           S22024 37400000
LOOP1    EQU   *                                                 S22024 37450000
         MVI   PRFTIC-IEDQPRF(RBUFF),TIC SET TIC COMMAND         S22024 37500000
         LH    RHOLD,AVTKEYLE           GET UNIT SIZE            S22024 37550000
         LA    RHOLD,AVTUMALN(RHOLD)    ADD OFFSET TO FIRST BYTE S22024 37600000
         DROP  ROPCE                                             S22024 37650000
         USING IEDQOPCE,ROPCE                                    S22024 37700000
         SH    RHOLD,OCBACKUP+START     CALCULATE SPACE AVAILABLES22024 37750000
*                                       IN THIS UNIT             S22024 37800000
         LR    RWORK,RLEN               SAVE MESSAGE LENGTH      S22024 37850000
         CR    RLEN,RHOLD               IS ENOUGH SPACE          S22024 37900000
*                                       AVAILABLE IN THIS UNIT   S22024 37950000
         BNH   MOVALL                   BRANCH ON YES            S22024 38000000
         LR    RWORK,RHOLD              AMOUNT OF DATA THAT      S22024 38050000
*                                       WILL FIT IN UNIT         S22024 38100000
MOVALL   EQU   *                                                 S22024 38150000
         BCTR  RWORK,ZERO               REDUCE FOR MOVE          S22024 38200000
         AH    RBUFF,OCBACKUP+START     ADD OFFSET TO AREA       S22024 38250000
         EX    RWORK,MOVEDATA           MOVE DATA INTO UNIT      S22024 38300000
         SH    RBUFF,OCBACKUP+START     RESTORE TO ORIGINAL      S22024 38350000
         LA    RWORK,ONE(RWORK)         RESTORE ORIGINAL COUNT   S22024 38400000
         AR    RDATA,RWORK              ADDRESS OF NEXT BYTE     S22024 38450000
*                                       TO MOVE                  S22024 38500000
         LH    RHOLD,OCBACKUP+START     GET START OFFSET         S22024 38550000
         AR    RHOLD,RWORK              CALCULATE NEW VALUE      S22024 38600000
         STH   RHOLD,OCBACKUP+START     STORE START ADDRESS      S22024 38650000
         LH    RHOLD,OCBACKUP+LEFT      GET AMOUNT OF SPACE LEFT S22024 38700000
         SR    RHOLD,RWORK              CALCULATE NEW VALUE      S22024 38750000
         STH   RHOLD,OCBACKUP+LEFT      STORE NEW VALUE          S22024 38800000
         SR    RLEN,RWORK               CALCULATE AMOUNT OF DATA S22024 38850000
*                                       REMAINING TO BE MOVED    S22024 38900000
*                                       HAS ALL BEEN MOVED       S22024 38950000
         BP    NOTALL                   BRANCH ON NO             S22024 39000000
         LH    RHOLD,AVTKEYLE           GET UNIT SIZE            S22024 39050000
         LA    RHOLD,AVTUMALN(RHOLD)    ADD OFFSET TO FIRST BYTE S22024 39100000
         CH    RHOLD,OCBACKUP+START     IS OFFSET AT END OF UNIT S22024 39150000
         BNE   OUTPUT                   BRANCH ON NO             S22024 39200000
NOTALL   EQU   *                                                 S22024 39250000
         L     RBUFF,PRFTIC-IEDQPRF(RBUFF) ADDRESS OF NEXT UNIT  S22024 39300000
         ST    RBUFF,OCBACKUP           SET NEXT UNIT ADDRESS    S22024 39350000
         LA    RHOLD,AVTUMALN           GET OFFSET TO DATA IN    S22024 39400000
*                                       NEXT UNIT                S22024 39450000
         STH   RHOLD,OCBACKUP+START     STORE START OFFSET       S22024 39500000
         LTR   RLEN,RLEN                HAS ALL DATA BEEN MOVED  S22024 39550000
         BP    LOOP1                    BRANCH ON NO             S22024 39600000
         B     OUTPUT                   ALL DATA MOVED           S22024 39650000
MULTI    EQU   *                                                 S22024 39700000
         L     RBUFF,OCBACKUP           GET CURRENT UNIT ADDRESS S22024 39750000
         B     MULT2                    GO PROCESS MULTI-PART    S22024 39800000
NEEDUNIT EQU   *                                                 S22024 39850000
         LR    RPARM,RHOLD              SAVE MESSAGE LENGTH      S22024 39900000
         SH    RPARM,OCBACKUP+LEFT      SUBTRACT AMOUNT OF       S22024 39950000
*                                       SPACE AVAILABLE          S22024 40000000
         SR    RZERO,RZERO              CLEAR REGISTER           S22024 40050000
         LH    RWORK,AVTKEYLE           GET UNIT SIZE            S22024 40100000
         DR    RZERO,RWORK              CALCULATE NUMBER OF      S22024 40150000
*                                       UNITS REQUIRED FOR MSG   S22024 40200000
         LTR   RZERO,RZERO              WAS THERE A REMAINDER    S22024 40250000
         BZ    NORMNDR                  BRANCH ON NO             S22024 40300000
         LA    RPARM,ONE(RPARM)         ADD ONE TO NUMBER OF     S22024 40350000
*                                       UNITS REQUIRED           S22024 40400000
NORMNDR  EQU   *                                                 S22024 40450000
         L     RBRNCH,OPCGETBF          ADDRESS OF UNIT REQUEST  S22024 40500000
*                                       ROUTINE FOR OP CNTRL     S22024 40550000
         BALR  RRET,RBRNCH              REQUEST UNITS            S22024 40600000
         DROP  ROPCE                                             S22024 40650000
         USING IEDQPRF,ROPCE                                     S22024 40700000
         IC    RWORK,PRFNBUNT           GET NUMBER OF UNITS      S22024 40750000
         AR    RWORK,RZERO              ADD NUMBER REQUESTED     S22024 40800000
         STC   RWORK,PRFNBUNT           STORE NEW UNIT COUNT     S22024 40850000
         ST    RPARM,PRFTIC-IEDQPRF(RBUFF) ADD NEW UNITS TO CHAINS22024 40900000
         MVI   PRFTIC-IEDQPRF(RBUFF),TIC SET TIC COMMAND         S22024 40950000
         LH    RPARM,AVTKEYLE           GET UNIT SIZE            S22024 41000000
         MR    RZERO,RZERO              CALCULATE BYTE AVAILABLE S22024 41050000
*                                       IN NEW UNITS             S22024 41100000
         DROP  ROPCE                                             S22024 41150000
         USING IEDQOPCE,ROPCE                                    S22024 41200000
         AH    RPARM,OCBACKUP+LEFT      ADD NUMBER AVAILABLE     S22024 41250000
         STH   RPARM,OCBACKUP+LEFT      STORE NEW COUNT          S22024 41300000
         B     MOVMSG                   GO PUT MESSAGE IN UNITS  S22024 41350000
         SPACE                                                          42000022
OUTPUT   EQU   *                                                        42100022
         AH    RBUFF,OCBACKUP+START     LAST BYTE POINTER        S22024 42200000
         OC    OCWTG(WTGLEN),OCWTG      WHERE TO GO SET?                42700022
         BZ    SKIPNAME                 NO, LEAVE NAME AS IS            42800022
         SPACE                                                          42900022
         OI    OCFLAG,OCOUTPUT          SET MULTI-PART OUTPUT FLAG      43600022
ENDOUT   EQU   *                                                 S22024 43700000
         MVC   OPCLDNME+VARINAME(NAMELEN),OCWTG SET NEW MODULE NAME     43800022
         LH    RZERO,OCPARM             PICK UP PARAMETER VALUE         43900022
         B     XCTL                     CALL NEXT MODULE                44000022
         SPACE                                                          44100022
SKIPNAME EQU   *                                                        44200022
         TM    OPCFLAG1,OUTTOTE         TOTE OLT TO POST       @YA05139 44230056
         BO    POSTOLT                  YES, BRANCH            @YA05139 44260056
         LH    RPARM,OCDEST             GET DEST TNT OFFSET     SA67103 44300054
         L     RBRNCH,AVTRNMPT          ADDR OF TNT CODE        SA67103 44600054
         BALR  RRET,RBRNCH              GO GET TERM ADDR        SA67103 44900054
         MVI   ZERO(RBUFF),EOT          SET EOT IN LAST BYTE    SA67103 45200054
         TM    TRMSTATE,TRMLINE+TRMLOG  SINGLE-TERMINAL ENTRY?  SA67103 45500054
         BNZ   BALATTCH                 BRANCH IF NO            SA67103 45800054
         TM    TRMSTATE,TRMPREF         3705 RESOURCE ?        @Y17XARR 46100000
         BZ    BALATTCH                 BRANCH IF NO            SA67103 46400054
         MVI   ZERO(RBUFF),BLANK        YES, ELIMINATE EOT      SA67103 46700054
         SPACE 1                                                SA67103 47000054
BALATTCH EQU   *                                                SA67103 47300054
         LA    RPARM,OCX02              NUMBER OF UNITS PASSED @SA74873 47370058
         L     RBRNCH,OPCFREBF          ADDR OF FREE BFR RTN   @SA74873 47440058
         BALR  RRET,RBRNCH              GO FREE UNITS          @SA74873 47510058
         BAL   RRET,CHKATTCH            GO CHECK OCATTACH       SA67103 47600054
         TM    OCFLAG,OCSSCP            IS IT SSCP FLOW        @ZM48772 47650011
         BO    POSTOUT                  YES BYPASS  QUEUING    @ZM48772 47700011
*                                       ON OPCWAITO            @ZM48772 48200011
         SR    RWORK,RWORK              ZERO FOR OUTPUT CHECK  @ZM47790 48250000
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,REGS=USE,               C48300000
               RELATED=OPCWAITO-IEDQCA(SETATSK1)               @ZM46693 48400000
         SPACE                                                          48500022
         TS    OPCSTCBS                 CHECK FOR OUTPUT BUSY           48600022
         BZ    RELEASE                  NO, POST OUTPUT        @ZM46693 48700000
         SPACE                                                          48800022
         LA    RWORK,OPCWAITO           GET ADDRESS OF QCW              50100022
QUELOOP  EQU   *                                                        50200022
         L     RLEN,ZERO(RWORK)         PICK UP QUEUE LINK POINTER      50300022
         LA    RLEN,ZERO(RLEN)          CLEAR HIGH BYTE OF ADDRESS      50400022
         LTR   RLEN,RLEN                END OF QUEUE CHAIN?             50500022
         BZ    ENDFOUND                 YES, PUT NEW ELEMENT ON QUEUE   50600022
         SPACE                                                          50700022
         LR    RWORK,RLEN               RESET POINTER TO CURRENT ELEM   50800022
         B     QUELOOP                  FIND END OF QUEUE CHAIN         50900022
         SPACE                                                          51000022
ENDFOUND EQU   *                                                        51100022
         IC    RLEN,ZERO(RWORK)         SAVE FIRST BYTE                 51200022
         ST    ROPCE,ZERO(RWORK)        PLACE NEW ELEMENT ON QUEUE      51300022
         STC   RLEN,ZERO(RWORK)         RESTORE HIGH ORDER BYTE         51400022
         XC    ONE(LINK-ONE,ROPCE),ONE(ROPCE) CLEAR LINK FIELD          51500022
RELEASE  EQU   *                                               @ZM46693 51530000
         SETLOCK RELEASE,TYPE=LOCAL,REGS=USE,                          C51560000
               RELATED=IGC0710D(SETATSK)                       @ZM46693 51590000
         LTR   RWORK,RWORK              ELEMENT PUT ON OUTPUT Q@ZM46693 51620000
         BNZ   SETPARM                  YES, BRANCH            @ZM46693 51650000
         B     TERMINPT                 NO GO SEND DATA        @ZM48772 51700011
         SPACE                                                          51800022
POSTOUT  EQU   *                        SET UP RH              @ZM48772 51810011
         LA    RWORK,PRF1LEN            GET LENGTH OF PREFIX   @Y17XARR 51906000
         SR    ROPCE,RWORK              BACKUP TO PREFIX       @Y17XARR 51908000
         USING IEDRH,ROPCE              ESTAB ADDR SETUP A     @Y17XARR 51910000
*                                       COMPLETE RH            @Y17XARR 51912000
         SPACE 2                                                        51914000
***************************************************************@Y17XARR 51916000
*                         SETUP RH                             @Y17XARR 51918000
***************************************************************@Y17XARR 51920000
*                         THIS IS A REQUEST,                   @Y17XARR 51922000
***************************************************************@Y17XARR 51924000
*                         FM DATA,  UNFORMATTED                @Y17XARR 51926000
***************************************************************@Y17XARR 51928000
*                         NO SENSE, AND ONLY CHAIN.            @Y17XARR 51930000
***************************************************************@Y17XARR 51932000
         SPACE 2                                               @Y17XARR 51934000
         MVI   TRHBYTE0,TRHBC+TRHEC     BEGIN OF CHAIN         @Y17XARR 51936000
*                                       END OF CHAIN           @Y17XARR 51938000
         MVI   TRHBYTE1,TRHDR1          DEFINITE RESPONSE,     @Y17XARR 51940000
*                                       NO PACING              @Y17XARR 51942000
         MVI   TRHBYTE2,AVTEZERO        NO BRACKETS, NO CHANGE @Y17XARR 51944000
*                                       DIRECTION, NO CODE     @Y17XARR 51946000
*                                       SELECT                 @Y17XARR 51948000
         USING IEDPF1,ROPCE             ESTAB ADDR FOR ENTIRE  @Y17XARR 51950000
*                                       PREFIX                 @Y17XARR 51952000
         MVI   PRF1FLG1,PRF1FIDI        FID1, NORMAL FLOW      @Y17XARR 51952500
*                                       SECOND WORD NOT USED   @Y17XARR 51956000
         LA    ROPCE,PRF1LEN(,ROPCE)    ADJUST BUFFER POINTER  @Y17XARR 51958000
*                                       PASSED PREFIX IN ORDER @Y17XARR 51960000
*                                       TO POST                @Y17XARR 51962000
         USING IEDQPRF,ROPCE            ESTAB ADDR FOR BUFFER  @Y17XARR 51964000
         MVC   PRFDEST,OCDEST-IEDQOPCE(ROPCE) SETUP DESTINATION@Y17XARR 51966000
         SR    RSAVTPTR,RSAVTPTR        CLEAR TO GET SAVT PTR  @Y17XARR 51968000
         L     RSAVTPTR,AVTSAVTP         GET SAVT POINTER      @YM05661 51970000
         MVC   PRFSRCE,SAVTSCPT-IEDNSVTD(RSAVTPTR) SETUP SOURCE@Y17XARR 51972000
         LA    RSAVTPTR,SAVTSCPQ-IEDNSVTD(RSAVTPTR)            @Y17XARR 51974000
*                                       GET ADDR OF DEST QCB   @Y17XARR 51976000
         STCM  RSAVTPTR,ADDRESS,PRFQCBA PUT SSCP DEST QCB ADDR @Y17XARR 51978000
*                                       IN BUFFER              @Y17XARR 51980000
         XC    PRFLCB,PRFLCB            INDICATOR TO GET DEST  @Y17XARR 51982000
*                                       FROM PRFDEST           @Y17XARR 51984000
         XC    PRFLINK,PRFLINK          CLEAR THE LINK FIELD   @Y17XARR 51986000
         MVI   PRFPRI,PRIDESTQ          SETUP PRIORITY FOR     @Y17XARR 51988000
*                                       POST                   @Y17XARR 51990000
         B     POSTIT                   POST BUFFER TO SSCP    @Y17XARR 51992000
TERMINPT EQU   *                                               @Y17XARR 51994000
         L     RBRNCH,OPCLCB            GET ADDRESS OF LCB SET UP CODE  52000022
         BALR  RRET,RBRNCH              SET UP DUMMY LCB                52100022
         SPACE                                                          52200022
         B     POSTIT                   GO ISSUE SVC 102        SA67103 52250054
         SPACE 1                                                SA67103 52350054
POSTOLT  EQU   *                                                SA67103 52450054
         USING IEDQPRF,ROPCE                                            52700022
         SR    RWORK,RWORK              CLEAR FOR INSERT                52800022
         IC    RWORK,PRFSCAN            GET SCAN POINTER                52900022
         STH   RWORK,PRFSCAN            REPLACE SCAN POINTER            53000022
         LH    RWORK,PRFSIZE            GET DATA SIZE                   53100022
         BCTR  RWORK,RZERO              CUT OFF EXTRA ADDED IN          53200022
         STH   RWORK,PRFSIZE            REPLACE NEW COUNT               53300022
         LA    RWORK,AVTOLTQB           GET TOTE QCB ADDRESS            53400022
         ST    RWORK,PRFQCBA-ONE        SET DESTINATION QCB ADDR        53500022
         MVI   PRFPRI,PRIONLT           SET PRIORITY                    53600022
         MVC   PRFKEY(ONE),PRFLCB       SET KEY FOR TOTE                53700022
POSTIT   EQU   *                                                        53800022
         ST    ROPCE,OPCAQCTL           PLACE BLOCK ADDRESS IN LIST     53900022
         ST    ROPCE,OPCAQCTL+WORD      PLACE ADDRESS IN LIST           54000022
         MVI   OPCAQCTL,POST            SET FLAG FOR POST               54100022
         MVI   OPCAQCTL+WORD,ENDLIST    SET END OF LIST                 54200022
         LA    RPARM,OPCAQCTL           POINT TO LIST FOR POSTING       54300022
         SPACE                                                          54400022
         AQCTL                          POST LCB FOR OUTPUT TO BD       54500022
         SPACE 2                                                        54600022
SETPARM  EQU   *                                                        54700022
         NI    OPCSPEC,AVTEFF-OPCFRMCA  TURN OFF FROM QCA FLAG @ZM46693 54750000
         LA    RZERO,NOTCA              INDICATE RETURN TO 010D         54800022
XCTL     EQU   *                                                        54900022
         NI    OPCFLAG1,AVTEZERO        CLEAR FLAGS SET                 55000022
         LR    RPARM,ROPCAVT            SET AVT POINTER                 55100022
         SPACE                                                          55200022
         XCTL  SF=(E,OPCXCTL)           CALL REQUIRED MODULE            55300022
         SPACE 2                                                SA67103 55310054
CHKATTCH EQU   *                                                SA67103 55320054
         DROP  ROPCE                                            SA67103 55330054
         USING IEDQOPCE,ROPCE                                   SA67103 55340054
         TM    OCFLAG,OCATTACH          ELMNT ATTACHED TO OPCE? SA67103 55350054
         BCR   NOTONES,RRET             BRANCH IF NO            SA67103 55360054
         L     RWORK,OCELEM             GET ATTACHED OPCE       SA67103 55370054
         ST    RWORK,OPCNEXT            MAKE IT NEXT TO GO      SA67103 55380054
         BR    RRET                     RETURN TO CALLER        SA67103 55390054
         SPACE 2                                                        55400022
MOVEDATA MVC   BEGIN(ZERO,RBUFF),BEGIN(RDATA) MOVE DATA TO BUFFER UNITS 55500022
         SPACE 2                                                        55600022
*          C O N S T A N T S                                            55650022
FIRSTLD  DC    C'00'                    INITIAL SVC LOAD                55700022
TOTEOUT  DC    X'4412'                  SPECIAL OLT VERB/SWITCH  S22024 55800000
WTOLEN   EQU   84                       LENGTH INCLUDING FLAGS  SA65449 55900005
CLOSEMSG DC    H'63'                    MSG NUM FOR CLOSEDOWN           56000022
MSCON    DC    X'04004020'              ROUTE AND DESCRIPTOR   @OY13278 56020000
*                                       CODES FOR MASTER       @OY13278 56040000
*                                       CONSOLE AND HARDCOPY   @OY13278 56060000
NOTREGO  EQU   X'80'                    MASK FOR MCSFLAGS      @OY13278 56080000
HEX80    DC    X'80'                    FLAG FOR XMPOST        @ZM46693 56090000
         SPACE 2                                                        56100022
WTOOUT   WTO   ' ',DESC=5,MCSFLAG=(REG0,RESP),MF=L WTO FLAGS            56200022
         SPACE 2                                                        56220000
END0710D EQU   *                                                 S22024 56240000
PATCH    DC    100X'FF'                 PATCH AREA             @Y17XARR 56250000
         SPACE 2                                                        56300022
         TITLE 'IGC0710D - DSECT REFERENCED BY THIS MODULE'             56400022
         TAIBD EXT=(NETWKCTL)                                  @ZM46693 56430000
         EJECT                                                          56460000
         TAVTD                                                          56500022
         EJECT                                                          56600022
CVTMAP   CVT   DSECT=YES                                       @ZM46693 56700000
         TOPCAVTD                                                       56900022
         EJECT                                                          57000022
         TOPCED                                                         57100022
         EJECT                                                          57200022
         TPCBD                                                          57300022
         EJECT                                                          57330000
         TPEBD                                                 @ZM46693 57360000
         EJECT                                                          57400022
         TPRFD                                                          57500022
         EJECT                                                          57600022
         IHAPSA                                                @ZM46693 57630000
         EJECT                                                          57660000
         TPRIOR                                                         57700022
         EJECT                                                          57730054
         TRHD                                                  @Y17XARR 57740000
         EJECT                                                 @Y17XARR 57750000
         TTRMD                                                          57760054
         END                                                            57800022
