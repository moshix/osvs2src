         TITLE 'CUTEST SVC IGC0905I'                                    00010000
         LCLA  &T,&SPN                                            0001  00020000
.@001    ANOP                                                     0001  00030000
IGC0905I CSECT ,                                                  0001  00040000
         BC    15,24(0,@F)                                              00050000
         DC    C'IGC0905I 26 APR 78'                             0001  00060000
         BALR  @B,0                                               0001  00070000
@PSTART  DS    0H                                                 0001  00080000
         USING @PSTART+00000,@B                                   0001  00090000
         LR    @C,@1                                              0001  00100000
         L     @0,@SIZ001                                         0001  00110000
         GETMAIN  R,LV=(0)                                        0001  00120000
         XR    @C,@1                                              0001  00130000
         XR    @1,@C                                              0001  00140000
         XR    @C,@1                                              0001  00150000
         USING @DATD+00000,@C                                     0001  00160000
         XC    @TEMPS(@L),@TEMPS                                  0001  00170000
         TITLE 'CUTEST SVC IGC0905I'                                    00180000
         USING CVTMAP,CVTREG           ADDRESSABILITY TO CVT   Y02008   00190000
         DS    0H                                                       00200000
*         SAVER14=R14;                 /* SAVE RETURN ADDRESS        */ 00210000
         ST    @E,SAVER14                                         0052  00220000
*         CVTREG=CVTADDR;                /* ADDR CVT FOR USE    Y02008* 00230000
         L     @2,CVTADPTR                                        0053  00240000
         L     @8,0(0,@2)                                         0053  00250000
*         IF R1=CODE0C THEN              /* VARY DSID REQ ?   @Y30LPAW* 00260000
         SR    @F,@F                                              0054  00270000
         IC    @F,CODE0C                                          0054  00280000
         CR    @F,@1                                              0054  00290000
*            GOTO VARYDSID;              /* YES-GO AROUND     @Y30LPAW* 00300000
         BC    08,VARYDSID                                        0055  00310000
*         IF R1=CODE10 THEN              /* STORE SSID?       @Y30LPAW* 00320000
         SR    @F,@F                                              0056  00330000
         IC    @F,CODE10                                          0056  00340000
         CR    @F,@1                                              0056  00350000
*            GOTO STORSSID;              /*  YES-GO AROUND    @Y30LPAW* 00360000
         BC    08,STORSSID                                        0057  00370000
*         R3=8;                          /* INITIALIZE MSG PTR          00380000
         LA    @3,8                                               0058  00390000
*         R6=EXTENT;                     /* GET EXTENT                  00400000
         LH    @6,4(0,@9)                                         0059  00410000
*         /* CHECK UCB                                                * 00420000
*   UCBCHK:                                                             00430000
*         FLAGS='00'X;                  /* CLEAR INTERNAL FLAGS Y02008* 00440000
UCBCHK   MVI   FLAGS,X'00'                                        0060  00450000
*         RESTRICT(R7,R13);                                             00460000
*         R7=R7&&R7;                      /* FREE ROR IOS USE    X03008 00470000
         XR    @7,@7                                              0062  00480000
*         R13=ADDR(IOSGENTBL);            /* ADDRESS IOS WK AREA X03008 00490000
         L     @2,CVTEXT2                                         0063  00500000
         L     @2,28(0,@2)         CVTOLTP                        0063  00510000
         LA    @D,40(0,@2)                                        0063  00520000
*         EXTENT=R6;                      /* NUM DEVS ON C-UNIT  X03008 00530000
         STH   @6,4(0,@9)                                         0064  00540000
*         R6=BASEADDR;                    /* DEVICE ADDRESS      X03008 00550000
         L     @6,0(0,@9)                                         0065  00560000
*         GEN;                                                          00570000
REG13    EQU   13                                                       00580000
IOSGEN09 IOSGEN  UCBLOOK,REG13                                  Y02008  00590000
         DS    0H                                                       00600000
*         R6=EXTENT;                      /* RESTORE EXTENT CNT  X03008 00610000
         LH    @6,4(0,@9)                                         0067  00620000
*         IF R15^=4                       /* IF UCB ADDR FOUND   X03008 00630000
*          THEN                           /* GO TO UCB FOR DEV   X03008 00640000
         CH    @F,@D1                                             0068  00650000
*           GO TO UCBCHK01;               /* AND CHK FLAGS       X03008 00660000
         BC    07,UCBCHK01                                        0069  00670000
* UCBCHK00:                                                             00680000
*         R6=R6-1;                        /* DECREMENT DEV CNTR  X03008 00690000
UCBCHK00 BCTR  @6,0                                               0070  00700000
*         BASEADDR=BASEADDR+1;            /* NEXT DEV ADDR ON CU X03008 00710000
         LA    @F,1                                               0071  00720000
         A     @F,0(0,@9)                                         0071  00730000
         ST    @F,0(0,@9)                                         0071  00740000
*         IF R6=0                         /* NO MORE DEVS TO CHK X03008 00750000
*          THEN                           /* ON CNTRL UNIT, SO,  X03008 00760000
         LTR   @6,@6                                              0072  00770000
*           GO TO CLEANUP;                /* RESTORE VALUES,EXIT X03008 00780000
         BC    08,CLEANUP                                         0073  00790000
*         GO TO UCBCHK;                   /* MORE DEVS, GET NEXT X03008 00800000
         BC    15,UCBCHK                                          0074  00810000
*                                                                       00820000
* UCBCHK01:                                                             00830000
*         RELEASE(R13);                                                 00840000
*         IF UNITDEV^=CNTUNDEV THEN       /* MATCH UCB AND DEV  X03008* 00850000
UCBCHK01 CLC   3(1,@9),5(@7)                                      0076  00860000
*           GO TO UCBCHK00;               /* ADDR. MATCH MEANS  X03008* 00870000
         BC    07,UCBCHK00                                        0077  00880000
*                                         /* VALID UCB FOR DEV  X03008* 00890000
*                                                                       00900000
*         IF SYSIN='1'B |                 /* IS THIS SYSIN DEV YA00884* 00910000
*            SYSOUT='1'B |                /* IS IT SYSOUT DEV?  Y02008* 00920000
*             UCBSYSR='1'B                /* IS IT SYS CONSOLE? Y02008* 00930000
*          THEN                           /* YES,              YA00884* 00940000
         TM    12(@7),B'10000000'                                 0078  00950000
         BC    01,@9FF                                            0078  00960000
         TM    12(@7),B'01000000'                                 0078  00970000
         BC    01,@9FE                                            0078  00980000
         TM    3(@7),B'00000010'                                  0078  00990000
         BC    12,@9FD                                            0078  01000000
*           GO TO NOTEST;                 /* DON'T TEST THIS DEV.     * 01010000
         BC    03,NOTEST                                          0079  01020000
*                                                                       01030000
*           IF UCBONLI='0'B &           /* IS DEVICE OFFLINE ANDY02008* 01040000
*              UCBALOC='0'B             /* NOT ALLOCATED?       Y02008* 01050000
*          THEN                           /* NO,               YA00884* 01060000
@9FD     TM    3(@7),B'10000000'                                  0080  01070000
         BC    05,@9FC                                            0080  01080000
         TM    3(@7),B'00001000'                                  0080  01090000
*           GO TO UCBCHK02;               /* DEV FREE FOR OLTEP.      * 01100000
         BC    10,UCBCHK02                                        0081  01110000
*          ELSE                           /* CHK BTAM DEV,REQST.YA00884 01120000
*           GO TO UCBCHK03;                                             01130000
         BC    15,UCBCHK03                                        0082  01140000
*                                                                       01150000
* UCBCHK02:                                                             01160000
*                                                                       01170000
*            EXTENT=R6;                  /* SAVE EXTENT VALUE   Y02008* 01180000
UCBCHK02 STH   @6,4(0,@9)                                         0083  01190000
*            RESTRICT(R4,R5);                                           01200000
*            GEN ( BAL R6,UCBCHK08);     /* SEARCH UCB/BITMASK  Y02008* 01210000
          BAL R6,UCBCHK08                                               01220000
         DS    0H                                                       01230000
*            R6=EXTENT;                  /* RESTORE EXTENT  REG Y02008* 01240000
         LH    @6,4(0,@9)                                         0086  01250000
*         RELEASE (R4,R5);                                              01260000
*                                                                       01270000
*         IF OKTEST='1'B                 /* IF DEV OK TO TEST   Y02008* 01280000
*          THEN                                                         01290000
         TM    FLAGS,B'01000000'                                  0088  01300000
*           GO TO DECREXT;               /* LOOK AT NEST DEV    Y02008* 01310000
         BC    01,DECREXT                                         0089  01320000
*          ELSE                          /* DEV NOT OK TO TEST  Y02008* 01330000
*           GO TO NOTEST;                /* PUT IN OUTPUT MSG   Y02008* 01340000
         BC    15,NOTEST                                          0090  01350000
*                                                                       01360000
* UCBCHK08:                                                             01370000
*                                                                       01380000
*         /* THE FOLLOWING CODE WILL ISOLATE AN OLTEP BITMASK BITY02008 01390000
*                                                                       01400000
*      RESTRICT(R10);                                                   01410000
UCBCHK08 EQU   *                                                  0091  01420000
*         GEN( USING CVTMAP,CVTREG);      /* ADDRESS CVT DATA    Y02008 01430000
          USING CVTMAP,CVTREG                                           01440000
         DS    0H                                                       01450000
*         R10=CVTILK2;                    /* ADDRESS UCB ADR TAB X03008 01460000
         L     @A,CVTILK2                                         0093  01470000
* UCBCHK2A: GEN;                                                        01480000
UCBCHK2A EQU   *                                                  0094  01490000
         CLM   R7,B'0011',0(R10)            LOOKING AT CUTEST   X03008  01500000
         BC    08,UCBCHK2B                  UCBIN LOOKUP TABLE? X03008  01510000
         DS    0H                                                       01520000
*                                         /* NO, NOT CUTEST UCB  X03008 01530000
*            IF UCBCHAR^='FF'X            /* IS THIS END OF TABLEX03008 01540000
*             THEN                        /* NO, THEN ADDR NEXT  X03008 01550000
         CLI   1(@A),X'FF'                                        0095  01560000
         BC    08,@9FA                                            0095  01570000
*              DO;                                                      01580000
*               R10=R10+2;                /* UCB TABLE ENTRY     X03008 01590000
         AH    @A,@D2                                             0097  01600000
*               GO TO UCBCHK2A;           /* CHECK NEXT UCB ADDR X03008 01610000
         BC    15,UCBCHK2A                                        0098  01620000
*              END;                                                     01630000
*             ELSE                        /* NOW AT END OF TABLE,X03008 01640000
*              DO;                                                      01650000
*               RELEASE (R4,R5);                                        01660000
*               DONOTEST='1'B;           /* DONOT TEST THIS DEV Y02008* 01670000
@9FA     OI    FLAGS,B'10000000'                                  0102  01680000
*               GEN ( BR R6 );           /* RETURN TO MAIN LINE Y02008* 01690000
          BR R6                                                         01700000
         DS    0H                                                       01710000
*              END;                                                     01720000
*                                                                       01730000
*  UCBCHK2B:                                                            01740000
*         RESTRICT(R4,R4);                                              01750000
@9F9     EQU   *                                                  0105  01760000
*         R4=((R10-CVTILK2)+2)/2;       /* NUM UCBS LOOKED AT   X03008* 01770000
UCBCHK2B LR    @F,@A                                              0106  01780000
         S     @F,CVTILK2                                         0106  01790000
         AH    @F,@D2                                             0106  01800000
         LR    @E,@F                                              0106  01810000
         SRDA  @E,32                                              0106  01820000
         LA    @0,2                                               0106  01830000
         DR    @E,@0                                              0106  01840000
         LR    @4,@F                                              0106  01850000
*         R5=(R4/8)+1;                  /* GET BYTE NUM IN TAB  X03008* 01860000
         LR    @E,@4                                              0107  01870000
         SRA   @E,3                                               0107  01880000
         AH    @E,@D3                                             0107  01890000
         LR    @5,@E                                              0107  01900000
*         R4=(R4//8);                   /* GET BIT IN BYTE      X03008* 01910000
         LR    @E,@4                                              0108  01920000
         SRDA  @E,32                                              0108  01930000
         LA    @0,8                                               0108  01940000
         DR    @E,@0                                              0108  01950000
         LR    @4,@E                                              0108  01960000
*         IF R4=0                       /* LAST BIT IN BYTE?    X03008* 01970000
*          THEN                         /* YES, RESET REGS      X03008* 01980000
         LTR   @4,@4                                              0109  01990000
         BC    07,@9F8                                            0109  02000000
*           DO;                         /* TO ADDR CORRECT BIT  X03008* 02010000
*            R5=R5-1;                   /* ADDR PROPER BYTE     X03008* 02020000
         BCTR  @5,0                                               0111  02030000
*            R4=8;                      /* ADDR PROPER BIT      X03008* 02040000
         LA    @4,8                                               0112  02050000
*           END;                                                        02060000
*         IF UCBNALOC='1'B                /* IS DEV OWNED BY ANOTHER    02070000
*          THEN                           /* USER?  YES, CAN   YA00884  02080000
@9F8     TM    1(@7),B'00000100'                                  0114  02090000
         BC    12,@9F7                                            0114  02100000
*           DO;                                                         02110000
*         IOSGENTBL(1)=UCBBITS(R5);     /* ISOLATE UCBBIT BYTE  X03008* 02120000
         LR    @2,@5                                              0116  02130000
         BCTR  @2,0                                               0116  02140000
         L     @5,CVTEXT2                                         0116  02150000
         L     @5,28(0,@5)         CVTOLTP                        0116  02160000
         MVC   @TEMP4(4),28(@5)                                   0116  02170000
         L     @5,@TEMP4           OLTEPTAB                       0116  02180000
         LA    @E,4(@2,@5)                                        0116  02190000
         L     @2,CVTEXT2                                         0116  02200000
         L     @2,28(0,@2)         CVTOLTP                        0116  02210000
         MVC   40(1,@2),0(@E)                                     0116  02220000
*         IOSGENTBL(1)=IOSGENTBL(1)&BITMASK(R4); /* GET UCB BIT Y02008* 02230000
         LR    @5,@4                                              0117  02240000
         LA    @E,BITMASK-1(@5)                                   0117  02250000
         NC    40(1,@2),0(@E)                                     0117  02260000
*                                                                       02270000
*         IF IOSGENTBL(1)='00'X         /* DO WE OWN DEVICE?    Y02008* 02280000
*          THEN                                                         02290000
         CLI   40(@2),X'00'                                       0118  02300000
         BC    07,@9F6                                            0118  02310000
*          DO;                          /* NOT  GOOD DEV        Y02008* 02320000
*           DONOTEST='1'B;              /* NOT TESTABLE DEVICE  Y02008* 02330000
         OI    FLAGS,B'10000000'                                  0120  02340000
*           GEN( BR R6);                /* RET TO MAIN FLOW     Y02008* 02350000
          BR R6                                                         02360000
         DS    0H                                                       02370000
*          END;                                                         02380000
*         OKTEST='1'B;                  /* DEV OK TO TEST       Y02008* 02390000
@9F6     OI    FLAGS,B'01000000'                                  0123  02400000
*         GEN ( BR R6 );                 /* RETURN TO MAIN FLOW Y02008* 02410000
          BR R6                                                         02420000
         DS    0H                                                       02430000
*         END;                                                          02440000
*                                                                       02450000
*         UCBBITS(R5)=UCBBITS(R5)|BITMASK(R4);   /* TURN ON BIT Y02008* 02460000
@9F7     LR    @2,@4                                              0126  02470000
         LA    @E,BITMASK-1(@2)                                   0126  02480000
         BCTR  @5,0                                               0126  02490000
         L     @2,CVTEXT2                                         0126  02500000
         L     @2,28(0,@2)         CVTOLTP                        0126  02510000
         MVC   @TEMP4(4),28(@2)                                   0126  02520000
         L     @2,@TEMP4           OLTEPTAB                       0126  02530000
         LA    @A,4(@5,@2)                                        0126  02540000
         OC    0(1,@A),0(@E)                                      0126  02550000
*                                                                       02560000
* UCBCHK8A:                                                             02570000
*                                                                       02580000
*         IF UCBNALOC='1'B               /* IF UCBNALOC IS ON   Y02008* 02590000
*          THEN                          /* DEV IS NOT TESTABLE Y02008* 02600000
UCBCHK8A TM    1(@7),B'00000100'                                  0127  02610000
         BC    12,@9F5                                            0127  02620000
*           DO;                          /* MUST SET ON FLAG    Y02008* 02630000
*            DONOTEST='1'B;              /* FOR NOT TESTABLE DEVY02008* 02640000
         OI    FLAGS,B'10000000'                                  0129  02650000
*            GEN ( BR R6 );              /* RET TO MAIN FLOW    Y02008* 02660000
          BR R6                                                         02670000
         DS    0H                                                       02680000
*           END;                                                        02690000
*                                                                       02700000
*         /* THE FOLLOWING CODE WILL COMPARE THE UCBNALOC BIT INY02008* 02710000
*         /* THE UCB, AND SET IT ON IF IT IS NOT ON.  IF IT IS  Y02008* 02720000
*         /* ALREADY ON (BY ANOTHER USER) WE WILL NOT TURN IT ONY02008* 02730000
*                                                                       02740000
*         R4=UNALMASK;                   /* MASK FOR UCBNALOC BIT IN    02750000
*                                                CURRENT UCB    Y02008* 02760000
@9F5     L     @4,UNALMASK                                        0132  02770000
*         R5=UCBOB;                      /* ADDRESS HEAD OF UCB Y02008* 02780000
         L     @5,0(0,@7)                                         0133  02790000
*         R4=R4|R5;                      /* PUT 1ST WORD OF UCB Y02008* 02800000
         OR    @4,@5                                              0134  02810000
*                                        /* IN REG, UCBNALOC ON Y02008* 02820000
*         GEN ( CS  R5,R4,UCBOB(R7));    /* TRY TO SET UCBNALOC Y02008* 02830000
          CS  R5,R4,UCBOB(R7)                                           02840000
         DS    0H                                                       02850000
*         GEN ( BNE UCBCHK8A);           /* NO GO, TRY AGAIN    Y02008* 02860000
          BNE UCBCHK8A                                                  02870000
         DS    0H                                                       02880000
*                                                                       02890000
*         OKTEST='1'B;                   /* UCBNALOC SET ON,DEV Y02008* 02900000
         OI    FLAGS,B'01000000'                                  0137  02910000
*         GEN( BR R6);                   /* TO TEST, RET TO MAINY02008* 02920000
          BR R6                                                         02930000
         DS    0H                                                       02940000
* UCBCHK03:                                                             02950000
*                                                                       02960000
*         /*          OLTEP VARY DEVICE OFFLINE ROUTINE               * 02970000
*                                                                       02980000
*         IF UCB3COMM='1'B |            /* IS DEVICE TELE-COMM  Y02008* 02990000
*            UCB3DISP='1'B |            /* OR GRAPHICS/DISPLAY  Y02008* 03000000
*                                                                       03010000
*            UCB3UREC='1'B              /* OR UNIT RECORD ?     Y02008* 03020000
*           THEN                        /* YES, ENQ ON UCB FOR  Y02008* 03030000
UCBCHK03 TM    18(@7),B'01000000'                                 0139  03040000
         BC    01,@9F4                                            0139  03050000
         TM    18(@7),B'00010000'                                 0139  03060000
         BC    01,@9F3                                            0139  03070000
         TM    18(@7),B'00001000'                                 0139  03080000
         BC    12,@9F2                                            0139  03090000
*             DO;                       /* ONLINE--OFFLINE VARY Y02008* 03100000
@9F3     EQU   *                                                  0140  03110000
*               RESTRICT(R4);           /*                      Y02008* 03120000
*               R4=10;                  /* INITIALIZE COUNTER   Y02008* 03130000
@9F4     LA    @4,10                                              0142  03140000
*             END;                                                      03150000
*           ELSE                                                        03160000
*            GO TO NOTEST;              /* DEV MUST BE OFFLINE  Y02008* 03170000
*                                                                       03180000
*         /* THE FOLLOWING BTAM CHECK IS MADE FOR ONLINE DEVS   Y02008* 03190000
*                                                                       03200000
*         IF UCBATI='1C'X &              /* IS DEV BTAM'S      YA00884* 03210000
*            CDE='01'X                   /* BTAM REQUEST?      YA00884* 03220000
*          THEN                          /* YES, THEN,USE IT.  YA00884* 03230000
@9F1     MVC   @TEMP3+1(3),21(@7)                                 0145  03240000
         L     @2,@TEMP3                                          0145  03250000
         CLI   3(@2),X'1C'                                        0145  03260000
         BC    07,@9F0                                            0145  03270000
         CLI   7(@9),X'01'                                        0145  03280000
         BC    07,@9EF                                            0145  03290000
*          DO;                                                          03300000
*           UCBOLTEX='1'B;               /* OLTEP-BTAM FLAG    YA00884* 03310000
         OI    27(@7),B'10000000'                                 0147  03320000
*           OKTEST='1'B;                 /* DEV OK TO TEST      Y02008* 03330000
         OI    FLAGS,B'01000000'                                  0148  03340000
*           GO TO UCBCHK07;              /* SET ON BITMASK BIT  Y02008* 03350000
         BC    15,UCBCHK07                                        0149  03360000
*         END;                                                          03370000
*                                                                       03380000
*                                                                       03390000
* UCBCHK04:                                                             03400000
*         /* THE FOLLOWING CODE WILL ENQ ON THE UCB FOR THE     Y02008* 03410000
*         /* CURRENT CU TEST DEVICE. TEN 5-SECOND STIMERS ARE   Y02008* 03420000
*         /* ISSUED UNTIL OLTEP GAINS CONTROL OF THE UCB. IF    Y02008* 03430000
*         /* OLTEP CANNOT GAIN CONTROL OF THE UCB, THE DEVICE   Y02008* 03440000
*         /* IS LISTED IN MSG IFD244I. THE OPERATOR/CE MUST     Y02008* 03450000
*         /* VARY THIS DEVICE OFFLINE AND RE ISSUE THE $CUTEST  Y02008* 03460000
*         /* REQUEST.                                           Y02008* 03470000
*                                                                       03480000
*          R5=ADDR(ENQAREA);                                /*@ZA12059* 03490000
@9EF     EQU   *                                                  0151  03500000
@9F0     EQU   *                                                  0151  03510000
UCBCHK04 LA    @5,ENQAREA                                         0151  03520000
* GENERATE;                                                     @ZA1205 03530000
          MVC   0(12,R5),ENQUCB           MOVE LIST TO EX      @ZA12059 03540000
         DS    0H                                                       03550000
* UCBCHK4A:                                                 /*@ZA12052* 03560000
* GEN;                                                      /*@ZA12052* 03570000
UCBCHK4A EQU   *                                                  0153  03580000
          ENQ   ,MF=(E,(R5))                               /*@ZA12052*/ 03590000
         DS    0H                                                       03600000
*         IF R15 = 0 THEN GO TO UCBCHK05; /* CHECK THE RETURN @ZA12055* 03610000
         LTR   @F,@F                                              0154  03620000
         BC    08,UCBCHK05                                        0155  03630000
*         IF ENQRC = '08'X THEN           /* CODES FROM THE   @ZA12055* 03640000
         CLI   3(@F),X'08'                                        0156  03650000
*                     GO TO UCBCHK05;     /* ENQ MACRO        @ZA12055* 03660000
         BC    08,UCBCHK05                                        0157  03670000
*         GEN;                                                          03680000
         STIMER WAIT,DINTVL=FIVE                               Y02008   03690000
         DS    0H                                                       03700000
*         R4=R4-1;                      /*DECREMENT COUNTER BY 1Y02008* 03710000
         BCTR  @4,0                                               0159  03720000
*         IF R4 > 0 THEN                  /* LOOP UNTIL ENQ   @ZA12055* 03730000
         LTR   @4,@4                                              0160  03740000
*            GO TO UCBCHK4A;              /* WORKS OR GIVE UP @ZA12055* 03750000
         BC    02,UCBCHK4A                                        0161  03760000
*         DONOTEST='1'B;                  /* BECAUSE DEVICE   @ZA12055* 03770000
         OI    FLAGS,B'10000000'                                  0162  03780000
*         GO TO NOTEST;                   /* UNTESTABLE       @ZA12055* 03790000
         BC    15,NOTEST                                          0163  03800000
* UCBCHK05:                                                             03810000
*         /* THE FOLLOWING CODE IS EXECUTED IF OLTEP HAS CONTROLY02008* 03820000
*         /* OF THE CURRENT DEVICE'S UCB.                       Y02008* 03830000
*         RELEASE (R4);                                                 03840000
*         IF UCBERLOG = '1'B        /* DOES DEV HAVE A        @Z40MIJR* 03850000
*           THEN                    /* BUFFERED ERROR LOG     @Z40MIJR* 03860000
UCBCHK05 MVC   @TEMP3+1(3),21(@7)                                 0165  03870000
         L     @2,@TEMP3                                          0165  03880000
         TM    5(@2),B'00000100'                                  0165  03890000
*             GO TO UCBCHK5A;       /* YES, WE CANT VARY      @Z40MIJR* 03900000
         BC    01,UCBCHK5A                                        0166  03910000
*                                   /* IT OFFLINE             @Z40MIJR* 03920000
*         IF UCBALOC='1'B               /* IF DEV IS NOW AL-    Y02008* 03930000
*           THEN                        /* LOCATED, MUST NOT    Y02008* 03940000
         TM    3(@7),B'00001000'                                  0167  03950000
*             GO TO UCBCHK5A;           /* VARY OFFLINE. DEQ UCB Y02008 03960000
         BC    01,UCBCHK5A                                        0168  03970000
*         IF UCBONLI='1'B &             /* DEV ONLINE AND IS    Y02008* 03980000
*            UCBDADI='1'B               /* CHANGING STATUS TO   Y02008* 03990000
*           THEN                        /* OFFLINE, CANNOT TEST Y02008* 04000000
         TM    3(@7),B'10000000'                                  0169  04010000
         BC    12,@9EE                                            0169  04020000
         TM    3(@7),B'00000001'                                  0169  04030000
*             GO TO UCBCHK5A;           /* MUST DEQ UCB.        Y02008* 04040000
         BC    03,UCBCHK5A                                        0170  04050000
*         IF UCBONLI='1'B               /* DEV MEETS REMTS TO   Y02008* 04060000
*           THEN                        /* BE VARIED OFFLINE.   Y02008* 04070000
@9ED     EQU   *                                                  0171  04080000
@9EE     TM    3(@7),B'10000000'                                  0171  04090000
         BC    12,@9EC                                            0171  04100000
*             UCBONLI='0'B;             /* ZERO UCB ONLINE FLAG Y02008* 04110000
         NI    3(@7),B'01111111'                                  0172  04120000
*         UCBCHGS='0'B;                 /* TURN OFF DEVICE PEND-Y02008* 04130000
@9EC     NI    3(@7),B'10111111'                                  0173  04140000
*                                       /* ING OFFLINE BIT.     Y02008* 04150000
*         UCBVORSN='1'B;                /* TURN ON FLAG INDICAT Y02008* 04160000
         OI    12(@7),B'00000100'                                 0174  04170000
*                                       /* ING DEV VARIED OFF   Y02008* 04180000
*                                       /* LINE FOR OPERATOR    Y02008* 04190000
*                                       /* REASON.              Y02008* 04200000
*         OKTEST='1'B;                   /* DEV IS OK TO TEST   Y02008* 04210000
         OI    FLAGS,B'01100000'                                  0175  04220000
*         VARYOFF='1'B;                  /* DEV VARIED OFFLINE  Y02008* 04230000
*         GO TO UCBCHK06;                /* DEQ, ISSUE SMF REC  Y02008* 04240000
         BC    15,UCBCHK06                                        0177  04250000
*                                                                       04260000
* UCBCHK5A:                                                             04270000
*                                                                       04280000
*         DONOTEST='1'B;                 /* DEV IS NOT TESTABLE Y02008* 04290000
UCBCHK5A OI    FLAGS,B'10000000'                                  0178  04300000
*                                                                       04310000
* UCBCHK06:                                                             04320000
*                                                                       04330000
*         /* THE FOLLOWING CODE WILL DEQ THE UCB RESOURCE       Y02008* 04340000
*                                                                       04350000
*         GEN;                          /* ISSUE DEQ FOR UCB    Y02008* 04360000
UCBCHK06 EQU   *                                                  0179  04370000
         MVC   0(12,R5),DEQUCB                                 @ZA12059 04380000
         DEQ   ,MF=(E,(R5))                                    @ZA12059 04390000
         DS    0H                                                       04400000
*                                                                       04410000
* UCBCHK07:                                                             04420000
*         IF DONOTEST='1'B              /* IF DONOTEST IS ON    Y02008* 04430000
*           THEN                        /* THE DEVICE IS NOT    Y02008* 04440000
UCBCHK07 TM    FLAGS,B'10000000'                                  0180  04450000
*             GO TO NOTEST;             /* TESTABLE BY OLTEP    Y02008* 04460000
         BC    01,NOTEST                                          0181  04470000
*                                                                       04480000
*         EXTENT=R6;                    /* SAVE EXTENT VALUE   Y02008*/ 04490000
         STH   @6,4(0,@9)                                         0182  04500000
*         RESTRICT(R4,R5);                                              04510000
*         GEN ( BAL R6,UCBCHK08);       /* SEARCH UCB/BITMASK  Y02008*/ 04520000
          BAL R6,UCBCHK08                                               04530000
         DS    0H                                                       04540000
*         R6=EXTENT;                    /* RESTORE EXTENT  REG Y02008*/ 04550000
         LH    @6,4(0,@9)                                         0185  04560000
*                                                                       04570000
*         IF DONOTEST='1'B              /* IF DEV NOK TO TEST  Y02008*/ 04580000
*          THEN                                                         04590000
         TM    FLAGS,B'10000000'                                  0186  04600000
*           GO TO NOTEST;                /* PUT IN OUTPUT MSG   Y02008* 04610000
         BC    01,NOTEST                                          0187  04620000
*         RELEASE (R4,R5);                                              04630000
*                                                                       04640000
*         /* THE FOLLOWING CODE IS ISSUED FOR OLTEP VARY CODE   Y02008* 04650000
*                                                                       04660000
*         IF VARYOFF^='1'B               /* IF DEV NOT VARIED OFFLINE   04670000
*                                           DO NOT PUT OUT SMF  Y02008* 04680000
*          THEN                                                         04690000
         TM    FLAGS,B'00100000'                                  0189  04700000
*           GO TO DECREXT;               /* LOOK AT NEXT UCB    Y02008* 04710000
         BC    12,DECREXT                                         0190  04720000
*                                                                       04730000
*           /* ISSUE SMF RECORD FOR DEVICES VARIED OFFLINE.     Y02008* 04740000
*                                                                       04750000
*         IF CVTSMCA^=0                  /* IF SMF REC SUPPORT  Y02008* 04760000
*          THEN                          /* EXISTS THEN TRY TO  Y02008* 04770000
         SR    @F,@F                                              0191  04780000
         C     @F,CVTSMCA                                         0191  04790000
         BC    08,@9EB                                            0191  04800000
*          DO;                           /* PRINT RECORD        Y02008* 04810000
*                                                                       04820000
*           IF SMCAOPT1='1'B             /* IS JOB ACCOUNTING   Y02008* 04830000
*            THEN                        /* SUPPORTED IN THIS   Y02008* 04840000
         L     @2,CVTSMCA                                         0193  04850000
         TM    0(@2),B'10000000'                                  0193  04860000
         BC    12,@9EA                                            0193  04870000
*             DO;                        /* SYSTEM? YES,        Y02008* 04880000
*                                                                       04890000
*             IF SMCAUSER='1'B |         /* IS SMF RECORDING REQY02008* 04900000
*              SMCAMAN='1'B              /* OR DOES SYS1.MAN D/SY02008* 04910000
*              THEN                      /* EXIST? YES,         Y02008* 04920000
         TM    1(@2),B'10000000'                                  0195  04930000
         BC    01,@9E9                                            0195  04940000
         TM    1(@2),B'01000000'                                  0195  04950000
         BC    12,@9E8                                            0195  04960000
*               DO;                                                     04970000
*                                                                       04980000
*                SMFRECRD=SMFRECRD&&SMFRECRD; /* CLEAR RECORD   Y02008* 04990000
@9E9     L     @2,CVTEXT2                                         0197  05000000
         L     @2,28(0,@2)         CVTOLTP                        0197  05010000
         XC    40(24,@2),40(@2)                                   0197  05020000
*                SMFDSCWD=RECSIZE;       /* INIT DESC WORD      Y02008* 05030000
         MVC   41(1,@2),RECSIZE                                   0198  05040000
*                SMFTYPE=TYPE11;         /* TYPE 11 SMF RECORD  Y02008* 05050000
         MVC   45(1,@2),TYPE11                                    0199  05060000
*                SMFVLNTH=VARLNGTH;      /* INIT VAR LNGTH REC  Y02008* 05070000
         MVC   59(1,@2),VARLNGTH                                  0200  05080000
*                                        /* FIELD FOR SMF REC   Y02008* 05090000
*                SMFCLTYP=UCBCLTYP;      /* DEV CLASS/TYPE DATA Y02008* 05100000
         MVC   60(2,@2),18(@7)                                    0201  05110000
*                SMFDEVAD=UNITADDR;      /* DEV ADDR INTO REC   Y02008* 05120000
         MVC   62(2,@2),4(@7)                                     0202  05130000
*                R1=(ADDR(SMFREC));     /* ADDRESS RECORD     @ZA06005* 05140000
         LA    @F,40(0,@2)                                        0203  05150000
         LR    @1,@F                                              0203  05160000
*                                                                       05170000
*                GEN (SVC 83 ) ;         /* ISSUE SMF REC SVC   Y02008* 05180000
         SVC 83                                                         05190000
         DS    0H                                                       05200000
*               END;                                                    05210000
*             END;                                                      05220000
@9E8     EQU   *                                                  0206  05230000
*          END;                                                         05240000
@9EA     EQU   *                                                  0207  05250000
*                                                                       05260000
*         /* TURN ON INDICATOR FOR IFDOLTAJ TO ISSUE MSG IFD401IY02008* 05270000
*         /* FOR DEV JUST VARIED OFFLINE BY OLTEP               Y02008* 05280000
*                                                                       05290000
*         RELEASE(R5,R13);                                              05300000
*         RESTRICT(R4);                                                 05310000
*         R4=ADVARYMSG;                   /* ADDR MSG IFD140I    Y02008 05320000
@9EB     L     @2,8(0,@9)                                         0210  05330000
         L     @4,24(0,@2)                                        0210  05340000
*         VARYDEV=UCBNAME(1:3);           /* PUT DEV ADDR IN MSG Y02008 05350000
         L     @5,24(0,@2)         A00047                         0211  05360000
         MVC   12(3,@5),13(@7)                                    0211  05370000
         MVI   15(@5),C' '                                        0211  05380000
         MVC   16(4,@5),15(@5)                                    0211  05390000
*         GEN( WTO MF=(E,(R4)));          /* ISSUE MSG IFD140I   Y02008 05400000
          WTO MF=(E,(R4))                                               05410000
         DS    0H                                                       05420000
*         GO TO DECREXT;                  /* DEV OK, LOOK AT NXT Y02008 05430000
         BC    15,DECREXT                                         0213  05440000
*                                                                       05450000
*         /* DEVICE DOES NOT MEET REQUIREMENTS MOVE NAME TO MESSAGE     05460000
*   NOTEST:                              /* CANNOT TEST                 05470000
*         RELEASE(R4,R5,R6,R13);                                        05480000
*         EXTENT=R6;                     /* SAVE EXTENT VALUE   Y02008* 05490000
NOTEST   STH   @6,4(0,@9)                                         0215  05500000
*         IF R3^=8 THEN                  /* ARE WE AT BEGINNING         05510000
         CH    @3,@D4                                             0216  05520000
         BC    08,@9E7                                            0216  05530000
*           DO;                          /* NO                          05540000
*             MSG244I(R3)=',';           /* MOVE IN COMMA               05550000
         LR    @2,@3                                              0218  05560000
         L     @6,8(0,@9)                                         0218  05570000
         L     @6,0(0,@6)          A00047                         0218  05580000
         LA    @A,3(@2,@6)                                        0218  05590000
         MVI   0(@A),C','                                         0218  05600000
*           END;                                                        05610000
*         MSG244I(R3+1:R3+3)=            /* MOVE IN UCB NAME            05620000
*           UCBNAME(1:3);                                               05630000
@9E7     LA    @E,13(0,@7)                                        0220  05640000
         LA    @2,3                                               0220  05650000
         AR    @2,@3                                              0220  05660000
         LA    @6,1                                               0220  05670000
         AR    @6,@3                                              0220  05680000
         SR    @2,@6                                              0220  05690000
         L     @4,8(0,@9)                                         0220  05700000
         L     @4,0(0,@4)          A00047                         0220  05710000
         LA    @A,3(@6,@4)                                        0220  05720000
         EX    @2,@MVC                                            0220  05730000
*         RESTRICT(R6);                                                 05740000
*         R6=EXTENT;                     /* RESTORE EXTENT VAL  Y02008* 05750000
         LH    @6,4(0,@9)                                         0222  05760000
*         R3=R3+4;                       /* INCREMENT MESSAGE POINTER   05770000
         AH    @3,@D1                                             0223  05780000
*  DECREXT:                                                             05790000
*         R6=R6-1;                       /* DECREMENT EXTENT            05800000
DECREXT  BCTR  @6,0                                               0224  05810000
*         /* CHECK EXTENT                                               05820000
*         IF R6=0 THEN                   /* MORE TO DO ?                05830000
         LTR   @6,@6                                              0225  05840000
*          GOTO CLEANUP;                 /* NO.                         05850000
         BC    08,CLEANUP                                         0226  05860000
*         BASEADDR=BASEADDR+1;                                          05870000
         LA    @F,1                                               0227  05880000
         A     @F,0(0,@9)                                         0227  05890000
         ST    @F,0(0,@9)                                         0227  05900000
*         /* SEE IF MESSAGE IS FULL                              Y02008 05910000
*         IF R3<48 THEN                  /* ROOM IN MESSAGE ?    Y02008 05920000
         CH    @3,@D5                                             0228  05930000
*           GOTO UCBCHK;                 /* YES,GO GET NEXT UCB  Y02008 05940000
         BC    04,UCBCHK                                          0229  05950000
*  CLEANUP:                                                             05960000
*         EXTENT=R6;                     /* UPDATE EXTENT               05970000
CLEANUP  STH   @6,4(0,@9)                                         0230  05980000
*         IF R3^=8                      /* IF  ERR DEVS FOUND   Y02008* 05990000
*          THEN                         /* IN UCB CHECKS THEN   Y02008* 06000000
         CH    @3,@D4                                             0231  06010000
         BC    08,@9E6                                            0231  06020000
*           DO;                                                         06030000
*           R14=SAVER14;                /* RESTORE RETURN ADDRESS     * 06040000
         L     @E,SAVER14                                         0233  06050000
*           RETURN CODE(16);            /* SET ERROR RET CODE   Y02008* 06060000
         LA    @F,16                                              0234  06070000
         ST    @F,16(0,@D)                                        0234  06080000
         LR    @1,@C                                              0234  06090000
         L     @0,@SIZ001                                         0234  06100000
         FREEMAIN R,LV=(0),A=(1)                                  0234  06110000
         L     @F,16(0,@D)                                        0234  06120000
         BCR   15,@E                                              0234  06130000
*           END;                                                        06140000
*          ELSE                         /* ELSE, EVERYTHING OK  Y02008* 06150000
*           DO;                                                         06160000
*           R14=SAVER14;                /* RESTORE RETURN ADDRESS     * 06170000
@9E6     L     @E,SAVER14                                         0237  06180000
*           RETURN CODE(00);            /* SET ZERO RET CODE    Y02008* 06190000
         SR    @F,@F                                              0238  06200000
         ST    @F,16(0,@D)                                        0238  06210000
         LR    @1,@C                                              0238  06220000
         L     @0,@SIZ001                                         0238  06230000
         FREEMAIN R,LV=(0),A=(1)                                  0238  06240000
         L     @F,16(0,@D)                                        0238  06250000
         BCR   15,@E                                              0238  06260000
*           END;                                                        06270000
*         /* WE ARE GATHERED HERE TO VARY OFF A DSID, BUT     @Y30LPAW* 06280000
*         /* FIRST MAKE SURE WE HAVE NOT ALREADY VARIED ONE   @Y30LPAW* 06290000
*         /* OFF BECAUSE WE ONLY ALLOW ONE VARIED OFF DSID    @Y30LPAW* 06300000
*         /* AT A TIME                                        @Y30LPAW* 06310000
* VARYDSID:                              /*                   @Y30LPAW* 06320000
*         R7=UCBCNT;           /* GET COUNT                   @Y30LPAW* 06330000
@9E5     EQU   *                                                  0240  06340000
VARYDSID L     @2,CVTEXT2                                         0240  06350000
         L     @2,28(0,@2)         CVTOLTP                        0240  06360000
         MVC   @TEMP4(4),28(@2)                                   0240  06370000
         L     @2,@TEMP4           OLTEPTAB                       0240  06380000
         L     @7,0(0,@2)                                         0240  06390000
*         R7=R7/8;             /* 1 BYTE PER 8 UCBS           @Y30LPAW* 06400000
         LR    @E,@7                                              0241  06410000
         SRA   @E,3                                               0241  06420000
         LR    @7,@E                                              0241  06430000
*         R7=R7+15;            /* ROUND TO                    @Y30LPAW* 06440000
         AH    @7,@D6                                             0242  06450000
*         R7=R7/8;             /* DOUBLE                      @Y30LPAW* 06460000
         LR    @E,@7                                              0243  06470000
         SRA   @E,3                                               0243  06480000
         LR    @7,@E                                              0243  06490000
*         R7=R7*8;             /* WORD                        @Y30LPAW* 06500000
         SLA   @7,3                                               0244  06510000
*         R7=R7+OLTEPUCB;      /* POINT TO                    @Y30LPAW* 06520000
         L     @4,CVTEXT2                                         0245  06530000
         L     @4,28(0,@4)         CVTOLTP                        0245  06540000
         MVC   @TEMP4(4),28(@4)                                   0245  06550000
         A     @7,@TEMP4                                          0245  06560000
*         R7=R7+4;             /* DSID                        @Y30LPAW* 06570000
         AH    @7,@D1                                             0246  06580000
*         IF DSIDEBC^=ZEROES THEN        /* ALREADY ONE?      @Y30LPAW* 06590000
         CLC   2(2,@7),ZEROES                                     0247  06600000
         BC    08,@9E4                                            0247  06610000
*            DO;                         /* YES CHECKIT       @Y30LPAW* 06620000
*               IF DSIDEBC=EBCDSID THEN  /* SAME ONE?         @Y30LPAW* 06630000
         CLC   2(2,@7),2(@9)                                      0249  06640000
         BC    07,@9E3                                            0249  06650000
*                  DO;                   /* YES- ITS OK       @Y30LPAW* 06660000
*                     R15=0;             /* SET RETCODE       @Y30LPAW* 06670000
         SR    @F,@F                                              0251  06680000
*                     GOTO RETURN0C;     /* AND GO BACK       @Y30LPAW* 06690000
         BC    15,RETURN0C                                        0252  06700000
*                  END;                  /*                   @Y30LPAW* 06710000
*               R15=4;                   /* NO-PACK IT        @Y30LPAW* 06720000
@9E3     LA    @F,4                                               0254  06730000
*               GOTO RETURN0C;           /* AND RETURN        @Y30LPAW* 06740000
         BC    15,RETURN0C                                        0255  06750000
*            END;                        /*                   @Y30LPAW* 06760000
*         R0=SP254;                      /* SPECIFY SBPOOL254 @Y30LPAW* 06770000
@9E4     L     @0,SP254                                           0257  06780000
*         GEN(GETMAIN R,LV=(0));         /* AND GET SPACE     @Y30LPAW* 06790000
         GETMAIN R,LV=(0)                                               06800000
         DS    0H                                                       06810000
*         R6=R1;                         /* USE THE ADDRESS   @Y30LPAW* 06820000
         LR    @6,@1                                              0259  06830000
*         VARYLIST=VARYLIST&&VARYLIST;   /* CLEAR IT          @Y30LPAW* 06840000
         XC    0(23,@6),0(@6)                                     0260  06850000
*         VONLEN='18'X;                  /* SET LIST LENGTH   @Y30LPAW* 06860000
         MVI   0(@6),X'18'                                        0261  06870000
         MVI   1(@6),C' '                                         0261  06880000
         MVC   2(2,@6),1(@6)                                      0261  06890000
*         VONOPCD='0C'X;                 /* SET CODE FOR OFF  @Y30LPAW* 06900000
         MVI   4(@6),X'0C'                                        0262  06910000
*         VFLG1='80'X;                   /* FLG FOR OFF VIRT  @Y30LPAW* 06920000
         MVI   6(@6),X'80'                                        0263  06930000
*         VONSSID=HEXDSID;               /* PUT IN DSID       @Y30LPAW* 06940000
         MVC   8(2,@6),0(@9)                                      0264  06950000
*         GEN;                                                          06960000
         ICBVARY MF=(E,(6)),TYPE=VOF    VARY IT OFF  /*      @Y30LPAW*/ 06970000
         DS    0H                                                       06980000
*                                        /* SET UP -VARY OFF  @Y30LPAW* 06990000
*        IF R15=0 |                                                     07000000
*           R15='78'X THEN          /* IF OK                  @X03LPMY* 07010000
         LTR   @F,@F                                              0266  07020000
         BC    08,@9E2                                            0266  07030000
         LA    @0,X'78'                                           0266  07040000
         CR    @0,@F                                              0266  07050000
         BC    07,@9E1                                            0266  07060000
*            DO;                         /* SAVE THE DSID     @Y30LPAW* 07070000
*               DSIDHEX=HEXDSID;         /*  IN THE LIST      @Y30LPAW* 07080000
@9E2     MVC   0(2,@7),0(@9)                                      0268  07090000
*               DSIDEBC=EBCDSID;         /* SET RETCODE       @Y30LPAW* 07100000
         MVC   2(2,@7),2(@9)                                      0269  07110000
*               R15=0;                   /* AND GO ON         @Y30LPAW* 07120000
         SR    @F,@F                                              0270  07130000
*               GOTO RETURN0C;           /*  BACK             @Y30LPAW* 07140000
         BC    15,RETURN0C                                        0271  07150000
*            END;                        /*                   @Y30LPAW* 07160000
*         R15=R0;                        /* NOT OK - USE      @Y30LPAW* 07170000
@9E1     LR    @F,@0                                              0273  07180000
*                                        /* ERROR CODE AND    @Y30LPAW* 07190000
* RETURN0C:                              /* GO BACK           @Y30LPAW* 07200000
*         R14=SAVER14;                   /* RESTORE R14       @Y30LPAW* 07210000
RETURN0C L     @E,SAVER14                                         0274  07220000
*         RETURN;                        /*                   @Y30LPAW* 07230000
         BC    15,@EL01                                           0275  07240000
*         /* THIS CODE WILL STORE AN SSID (BOTH HEX AND EBC)  @Y30LPAW* 07250000
*         /* IN THE SSIDLIST AND BUMP THE COUNT BY 1          @Y30LPAW* 07260000
* STORSSID:                              /*                   @Y30LPAW* 07270000
*         R7=UCBCNT;           /* GET COUNT                   @Y30LPAW* 07280000
STORSSID L     @2,CVTEXT2                                         0276  07290000
         L     @2,28(0,@2)         CVTOLTP                        0276  07300000
         MVC   @TEMP4(4),28(@2)                                   0276  07310000
         L     @2,@TEMP4           OLTEPTAB                       0276  07320000
         L     @7,0(0,@2)                                         0276  07330000
*         R7=R7/8;             /* 1 BYTE PER 8 UCBS           @Y30LPAW* 07340000
         LR    @E,@7                                              0277  07350000
         SRA   @E,3                                               0277  07360000
         LR    @7,@E                                              0277  07370000
*         R7=R7+15;            /* ROUND TO                    @Y30LPAW* 07380000
         AH    @7,@D6                                             0278  07390000
*         R7=R7/8;             /* DOUBLE                      @Y30LPAW* 07400000
         LR    @E,@7                                              0279  07410000
         SRA   @E,3                                               0279  07420000
         LR    @7,@E                                              0279  07430000
*         R7=R7*8;             /* WORD                        @Y30LPAW* 07440000
         SLA   @7,3                                               0280  07450000
*         R7=R7+OLTEPUCB;      /* POINT TO                    @Y30LPAW* 07460000
         L     @4,CVTEXT2                                         0281  07470000
         L     @4,28(0,@4)         CVTOLTP                        0281  07480000
         MVC   @TEMP4(4),28(@4)                                   0281  07490000
         A     @7,@TEMP4                                          0281  07500000
*         R7=R7+4;             /* DSID                        @Y30LPAW* 07510000
         AH    @7,@D1                                             0282  07520000
*         R3=ADDR(SSIDS);                /* HERES 1ST SSID    @Y30LPAW* 07530000
         LA    @3,6(0,@7)                                         0283  07540000
*         R3=R3+SSIDCNT*SIDFLDSZ;        /* HERES 1ST EMPTY   @Y30LPAW* 07550000
         SR    @F,@F                                              0284  07560000
         IC    @F,SIDFLDSZ                                        0284  07570000
         MVC   @TEMP2+2(2),4(@7)                                  0284  07580000
         M     @E,@TEMP2                                          0284  07590000
         AR    @3,@F                                              0284  07600000
*         SSIDHEX=HEXSSID;               /* MOVE IN THE SSID  @Y30LPAW* 07610000
         MVC   0(2,@3),0(@9)                                      0285  07620000
*         SSIDEBC=EBCSSID;               /* BOTH HEX AND EBC  @Y30LPAW* 07630000
         MVC   2(2,@3),2(@9)                                      0286  07640000
*         SSIDCNT=SSIDCNT+1;             /* BUMP BY ONE       @Y30LPAW* 07650000
         LA    @F,1                                               0287  07660000
         MVC   @TEMP2+2(2),4(@7)                                  0287  07670000
         A     @F,@TEMP2                                          0287  07680000
         ST    @F,@TEMP4                                          0287  07690000
         MVC   4(2,@7),@TEMP4+2                                   0287  07700000
*         R15=0;                         /* SET GOOD RET CODE @Y30LPAW* 07710000
         SR    @F,@F                                              0288  07720000
*         GOTO RETURN0C;                 /* AND GO BACK       @Y30LPAW* 07730000
         BC    15,RETURN0C                                        0289  07740000
*  GENERATE;                                                /*@ZA12052* 07750000
          DS     0F                                            @ZA12052 07760000
ENQUCB   ENQ   (MAJORNAM,MINORNAM,E,2,SYSTEM),RET=HAVE,MF=L    @ZA26394 07770000
DEQUCB    DEQ   (MAJORNAM,MINORNAM,2,SYSTEM),RET=HAVE,MF=L     @ZA12059 07780000
         DS    0H                                                       07790000
*         END;                                                          07800000
@EL01    LR    @1,@C                                              0291  07810000
         L     @0,@SIZ001                                         0291  07820000
         FREEMAIN R,LV=(0),A=(1)                                  0291  07830000
         BCR   15,@E                                              0291  07840000
@DATA1   EQU   *                                                        07850000
@0       EQU   00                  EQUATES FOR REGISTERS 0-15           07860000
@1       EQU   01                                                       07870000
@2       EQU   02                                                       07880000
@3       EQU   03                                                       07890000
@4       EQU   04                                                       07900000
@5       EQU   05                                                       07910000
@6       EQU   06                                                       07920000
@7       EQU   07                                                       07930000
@8       EQU   08                                                       07940000
@9       EQU   09                                                       07950000
@A       EQU   10                                                       07960000
@B       EQU   11                                                       07970000
@C       EQU   12                                                       07980000
@D       EQU   13                                                       07990000
@E       EQU   14                                                       08000000
@F       EQU   15                                                       08010000
@D1      DC    H'4'                                                     08020000
@D2      DC    H'2'                                                     08030000
@D3      DC    H'1'                                                     08040000
@D4      DC    H'8'                                                     08050000
@D5      DC    H'48'                                                    08060000
@D6      DC    H'15'                                                    08070000
@MVC     MVC   0(1,@A),0(@E)                                            08080000
         DS    0F                                                       08090000
@SIZ001  DC    AL1(&SPN)                                                08100000
         DC    AL3(@DATEND-@DATD)                                       08110000
         DS    0F                                                       08120000
         DS    0D                                                       08130000
@DATA    EQU   *                                                        08140000
P        EQU   00000000            FULLWORD INTEGER                     08150000
R0       EQU   00000000            FULLWORD INTEGER REGISTER            08160000
R1       EQU   00000001            FULLWORD INTEGER REGISTER            08170000
R2       EQU   00000002            FULLWORD INTEGER REGISTER            08180000
R3       EQU   00000003            FULLWORD POINTER REGISTER            08190000
R4       EQU   00000004            FULLWORD POINTER REGISTER            08200000
R5       EQU   00000005            FULLWORD POINTER REGISTER            08210000
R6       EQU   00000006            FULLWORD POINTER REGISTER            08220000
R7       EQU   00000007            FULLWORD POINTER REGISTER            08230000
R8       EQU   00000008            FULLWORD POINTER REGISTER            08240000
CVTREG   EQU   00000008            FULLWORD POINTER REGISTER            08250000
R9       EQU   00000009            FULLWORD POINTER REGISTER            08260000
R10      EQU   00000010            FULLWORD POINTER REGISTER            08270000
R12      EQU   00000012            FULLWORD INTEGER REGISTER            08280000
R13      EQU   00000013            FULLWORD INTEGER REGISTER            08290000
R14      EQU   00000014            FULLWORD INTEGER REGISTER            08300000
R15      EQU   00000015            FULLWORD POINTER REGISTER            08310000
PARMLIST EQU   00000000            12 BYTE(S) ON WORD                   08320000
BASEADDR EQU   PARMLIST+00000000   FULLWORD POINTER                     08330000
A00000   EQU   PARMLIST+00000000   2 BYTE(S)                            08340000
CHANNEL  EQU   PARMLIST+00000002   1 BYTE(S)                            08350000
UNITDEV  EQU   PARMLIST+00000003   1 BYTE(S)                            08360000
EXTENT   EQU   PARMLIST+00000004   HALFWORD POINTER                     08370000
CODE     EQU   PARMLIST+00000006   2 BYTE(S)                            08380000
A00001   EQU   PARMLIST+00000006   1 BYTE(S)                            08390000
CDE      EQU   PARMLIST+00000007   1 BYTE(S)                            08400000
MSGMDPTR EQU   PARMLIST+00000008   FULLWORD POINTER                     08410000
CVTADPTR EQU   *                   FULLWORD POINTER                     08420000
         DC    AL4(16)                                                  08430000
CVTADDR  EQU   00000000            FULLWORD POINTER                     08440000
CVTOLTP  EQU   00000028            FULLWORD POINTER                     08450000
OLTEPTAB EQU   00000000            24 BYTE(S)                           08460000
DEIHEAD  EQU   OLTEPTAB+00000000   4 BYTE(S)                            08470000
REIDEB   EQU   OLTEPTAB+00000004   4  BYTE  POINTER                     08480000
A00002   EQU   OLTEPTAB+00000008   20 BYTE(S)                           08490000
OLTEPUCB EQU   OLTEPTAB+00000028   4  BYTE  POINTER                     08500000
A00003   EQU   OLTEPTAB+00000032   8 BYTE(S)                            08510000
IOSGENTB EQU   OLTEPTAB+00000040   72*1 BYTE(S)                         08520000
SSIDLIST EQU   00000000            72 BYTE(S)                           08530000
DSID     EQU   SSIDLIST+00000000   4 BYTE(S)                            08540000
DSIDHEX  EQU   SSIDLIST+00000000   2 BYTE(S)                            08550000
DSIDEBC  EQU   SSIDLIST+00000002   2 BYTE(S)                            08560000
SSIDCNT  EQU   SSIDLIST+00000004   2 BYTE(S)                            08570000
SSIDS    EQU   SSIDLIST+00000006   64 BYTE(S)                           08580000
SSIDFMT  EQU   00000000            4 BYTE(S)                            08590000
SSIDHEX  EQU   SSIDFMT+00000000    2 BYTE(S)                            08600000
SSIDEBC  EQU   SSIDFMT+00000002    2 BYTE(S)                            08610000
DSIDPARM EQU   00000000            4 BYTE(S)                            08620000
HEXDSID  EQU   DSIDPARM+00000000   2 BYTE(S)                            08630000
EBCDSID  EQU   DSIDPARM+00000002   2 BYTE(S)                            08640000
SSIDPARM EQU   00000000            4 BYTE(S)                            08650000
HEXSSID  EQU   SSIDPARM+00000000   2 BYTE(S)                            08660000
EBCSSID  EQU   SSIDPARM+00000002   2 BYTE(S)                            08670000
SIDFLDSZ EQU   *                   1 BYTE(S)                            08680000
         DC    X'04'                                                    08690000
         ORG   @DATA+00000008                                           08700000
SP254    EQU   *                   FULLWORD INTEGER                     08710000
         DC    XL4'FE000018'                                            08720000
CODE0C   EQU   *                   1 BYTE(S)                            08730000
         DC    X'0C'                                                    08740000
CODE10   EQU   *                   1 BYTE(S)                            08750000
         DC    X'10'                                                    08760000
VARYLIST EQU   00000000            23 BYTE(S) ON WORD                   08770000
VONLEN   EQU   VARYLIST+00000000   4 BYTE(S)                            08780000
A00004   EQU   VARYLIST+00000000   3 BYTE(S)                            08790000
VONCNT   EQU   VARYLIST+00000003   1 BYTE(S)                            08800000
VONOPCD  EQU   VARYLIST+00000004   1 BYTE(S)                            08810000
A00005   EQU   VARYLIST+00000005   1 BYTE(S)                            08820000
VONFLG   EQU   VARYLIST+00000006   2 BYTE(S)                            08830000
VFLG1    EQU   VARYLIST+00000006   1 BYTE(S)                            08840000
A00006   EQU   VARYLIST+00000007   1 BYTE(S)                            08850000
VONSSID  EQU   VARYLIST+00000008   2 BYTE(S)                            08860000
VONRUA   EQU   VARYLIST+00000010   2 BYTE(S)                            08870000
A00007   EQU   VARYLIST+00000012   11 BYTE(S)                           08880000
SMFRECRD EQU   00000040            24 BYTE(S)                           08890000
A00008   EQU   SMFRECRD+00000000   1 BYTE(S)                            08900000
SMFDSCWD EQU   SMFRECRD+00000001   1 BYTE(S)                            08910000
A00009   EQU   SMFRECRD+00000002   3 BYTE(S)                            08920000
SMFTYPE  EQU   SMFRECRD+00000005   1 BYTE(S)                            08930000
A00010   EQU   SMFRECRD+00000006   13 BYTE(S)                           08940000
SMFVLNTH EQU   SMFRECRD+00000019   1 BYTE(S)                            08950000
SMFCLTYP EQU   SMFRECRD+00000020   2 BYTE(S)                            08960000
SMFDEVAD EQU   SMFRECRD+00000022   2 BYTE(S)                            08970000
SMFREC   EQU   00000040            FULLWORD POINTER                     08980000
SMFCB    EQU   00000000            2 BYTE(S)                            08990000
SMCAOPT  EQU   SMFCB+00000000      1 BYTE(S)                            09000000
SMCAOPT1 EQU   SMFCB+00000000      1 BIT(S)                             09010000
SMCAOPT2 EQU   SMFCB+00000000      1 BIT(S)                             09020000
SMCAMISC EQU   SMFCB+00000001      1 BYTE(S)                            09030000
SMCAUSER EQU   SMFCB+00000001      1 BIT(S)                             09040000
SMCAMAN  EQU   SMFCB+00000001      1 BIT(S)                             09050000
TYPE11   EQU   *                   1 BYTE(S)                            09060000
         DC    X'0B'                                                    09070000
RECSIZE  EQU   *                   1 BYTE(S)                            09080000
         DC    X'18'                                                    09090000
VARLNGTH EQU   *                   1 BYTE(S)                            09100000
         DC    X'06'                                                    09110000
ZEROES   EQU   *                   2 BYTE(S)                            09120000
         DC    X'0000'                                                  09130000
         ORG   @DATA+00000020                                           09140000
UNALMASK EQU   *                   FULLWORD INTEGER                     09150000
         DC    XL4'00040000'                                            09160000
UCBBITBL EQU   00000000            79 BYTE(S) ON WORD                   09170000
UCBCNT   EQU   UCBBITBL+00000000   4 BYTE(S)                            09180000
UCBBITS  EQU   UCBBITBL+00000004   75*1 BYTE(S)                         09190000
BITMASK  EQU   *                   8*1 BYTE(S)                          09200000
         DC    X'80'                                                    09210000
         DC    X'40'                                                    09220000
         DC    X'20'                                                    09230000
         DC    X'10'                                                    09240000
         DC    X'08'                                                    09250000
         DC    X'04'                                                    09260000
         DC    X'02'                                                    09270000
         DC    X'01'                                                    09280000
UCBLKUP  EQU   00000000            2 BYTE(S)                            09290000
A00011   EQU   UCBLKUP+00000000    1 BYTE(S)                            09300000
UCBCHAR  EQU   UCBLKUP+00000001    1 BYTE(S)                            09310000
UCB      EQU   00000000            40 BYTE(S) ON WORD                   09320000
UCBOB    EQU   UCB+00000000        4 BYTE(S)                            09330000
A00012   EQU   UCB+00000000        1 BYTE(S)                            09340000
A00013   EQU   UCB+00000001        1 BYTE(S)                            09350000
A00014   EQU   UCB+00000001        5 BIT(S)                             09360000
UCBNALOC EQU   UCB+00000001        1 BIT(S)                             09370000
A00015   EQU   UCB+00000001        2 BIT(S)                             09380000
A00016   EQU   UCB+00000002        1 BYTE(S)                            09390000
A00017   EQU   UCB+00000003        1 BYTE(S)                            09400000
UCBONLI  EQU   UCB+00000003        1 BIT(S)                             09410000
UCBCHGS  EQU   UCB+00000003        1 BIT(S)                             09420000
A00018   EQU   UCB+00000003        2 BIT(S)                             09430000
UCBALOC  EQU   UCB+00000003        1 BIT(S)                             09440000
A00019   EQU   UCB+00000003        1 BIT(S)                             09450000
UCBSYSR  EQU   UCB+00000003        1 BIT(S)                             09460000
UCBDADI  EQU   UCB+00000003        1 BIT(S)                             09470000
UNITADDR EQU   UCB+00000004        2 BYTE(S)                            09480000
CHANADDR EQU   UCB+00000004        1 BYTE(S)                            09490000
CNTUNDEV EQU   UCB+00000005        1 BYTE(S)                            09500000
A00020   EQU   UCB+00000006        5 BYTE(S)                            09510000
A00021   EQU   UCB+00000011        1 BYTE(S)                            09520000
A00022   EQU   UCB+00000012        1 BYTE(S)                            09530000
SYSIN    EQU   UCB+00000012        1 BIT(S)                             09540000
SYSOUT   EQU   UCB+00000012        1 BIT(S)                             09550000
A00023   EQU   UCB+00000012        3 BIT(S)                             09560000
UCBVORSN EQU   UCB+00000012        1 BIT(S)                             09570000
UCBNAME  EQU   UCB+00000013        3 BYTE(S)                            09580000
A00024   EQU   UCB+00000016        2 BYTE(S)                            09590000
UCBCLTYP EQU   UCB+00000018        2 BYTE(S)                            09600000
UCBTBYT3 EQU   UCB+00000018        1 BYTE(S)                            09610000
A00025   EQU   UCB+00000018        1 BIT(S)                             09620000
UCB3COMM EQU   UCB+00000018        1 BIT(S)                             09630000
A00026   EQU   UCB+00000018        1 BIT(S)                             09640000
UCB3DISP EQU   UCB+00000018        1 BIT(S)                             09650000
UCB3UREC EQU   UCB+00000018        1 BIT(S)                             09660000
A00027   EQU   UCB+00000018        3 BIT(S)                             09670000
A00028   EQU   UCB+00000019        1 BYTE(S)                            09680000
A00029   EQU   UCB+00000020        1 BYTE(S)                            09690000
UCBXTEND EQU   UCB+00000021        3  BYTE  POINTER                     09700000
A00030   EQU   UCB+00000024        3 BYTE(S)                            09710000
A00031   EQU   UCB+00000027        1 BYTE(S)                            09720000
UCBOLTEX EQU   UCB+00000027        1 BIT(S)                             09730000
A00032   EQU   UCB+00000027        7 BIT(S)                             09740000
UCBEXT   EQU   00000000            4 BYTE(S)                            09750000
A00033   EQU   UCBEXT+00000000     3 BYTE(S)                            09760000
UCBATI   EQU   UCBEXT+00000003     1 BYTE(S)                            09770000
UCBCMEXT EQU   00000000            16 BYTE(S) ON WORD                   09780000
A00034   EQU   UCBCMEXT+00000000   1 BYTE(S)                            09790000
A00035   EQU   UCBCMEXT+00000001   1 BYTE(S)                            09800000
A00036   EQU   UCBCMEXT+00000002   1 BYTE(S)                            09810000
A00037   EQU   UCBCMEXT+00000003   1 BYTE(S)                            09820000
A00038   EQU   UCBCMEXT+00000003   8 BIT(S)                             09830000
A00039   EQU   UCBCMEXT+00000004   1 BYTE(S)                            09840000
UCBFLP1  EQU   UCBCMEXT+00000005   1 BYTE(S)                            09850000
A00040   EQU   UCBCMEXT+00000005   5 BIT(S)                             09860000
UCBERLOG EQU   UCBCMEXT+00000005   1 BIT(S)                             09870000
A00041   EQU   UCBCMEXT+00000005   2 BIT(S)                             09880000
A00042   EQU   UCBCMEXT+00000006   2 BYTE(S)                            09890000
A00043   EQU   UCBCMEXT+00000008   2 BYTE(S)                            09900000
A00044   EQU   UCBCMEXT+00000010   2 BYTE(S)                            09910000
A00045   EQU   UCBCMEXT+00000012   2 BYTE(S)                            09920000
A00046   EQU   UCBCMEXT+00000014   2 BYTE(S)                            09930000
A00047   EQU   00000000            28 BYTE(S) ON WORD                   09940000
IFD244I  EQU   A00047+00000000     FULLWORD POINTER                     09950000
A00048   EQU   A00047+00000004     FULLWORD POINTER                     09960000
HEADER   EQU   A00047+00000008     FULLWORD POINTER                     09970000
A00049   EQU   A00047+00000012     12 BYTE(S)                           09980000
ADVARYMS EQU   A00047+00000024     FULLWORD POINTER                     09990000
A00050   EQU   00000000            52 BYTE(S) ON WORD                   10000000
A00051   EQU   A00050+00000000     4 BYTE(S)                            10010000
MSG244I  EQU   A00050+00000004     48 BYTE(S)                           10020000
A00052   EQU   A00050+00000004     8 BYTE(S)                            10030000
TEXT244I EQU   A00050+00000012     40 BYTE(S)                           10040000
MSG140   EQU   00000000            44 BYTE(S) ON WORD                   10050000
MSG140I  EQU   MSG140+00000000     40 BYTE(S)                           10060000
A00053   EQU   MSG140+00000000     12 BYTE(S)                           10070000
VARYDEV  EQU   MSG140+00000012     8 BYTE(S)                            10080000
A00054   EQU   MSG140+00000020     24 BYTE(S)                           10090000
MAJORNAM EQU   *                   8 BYTE(S)                            10100000
         DC    C'SYSIEFSD'                                              10110000
MINORNAM EQU   *                   8 BYTE(S)                            10120000
         DC    C'Q4'                                                    10130000
         DC    00006C' '                                                10140000
FIVE     EQU   *                   8 BYTE(S)                            10150000
         DC    X'F0F0F0F0F0F5F0C0'                                      10160000
PATCH09  EQU   *                   30*2 BYTE(S)                         10170000
         DC    00030X'0700'                                             10180000
RETCODES EQU   00000000            4 BYTE(S) ON WORD                    10190000
A00055   EQU   RETCODES+00000000   3 BYTE(S)                            10200000
ENQRC    EQU   RETCODES+00000003   1 BYTE(S)                            10210000
         ORG   @DATA                                                    10220000
         DS    00000116C                                                10230000
@L       EQU   6                                                        10240000
@DATD    DSECT                                                          10250000
FLAGS    EQU   @DATD+00000000      8 BIT(S) ON BYTE                     10260000
DONOTEST EQU   FLAGS+00000000      1 BIT(S)                             10270000
OKTEST   EQU   FLAGS+00000000      1 BIT(S)                             10280000
VARYOFF  EQU   FLAGS+00000000      1 BIT(S)                             10290000
SAVER14  EQU   @DATD+00000004      FULLWORD INTEGER                     10300000
ENQAREA  EQU   @DATD+00000008      12 BYTE(S)                           10310000
         DS    00000020C                                                10320000
@TEMPS   DS    0F                                                       10330000
@TEMP2   DC    F'0'                                                     10340000
@TEMP3   DC    F'0'                                                     10350000
@TEMP4   DC    F'0'                                                     10360000
         CVT    SYS=AOS2,DSECT=YES                                      10370000
         IECDIOCM                                                       10380000
         IECDIOCX                                                       10390000
@DATD    DSECT                                                          10400000
@DATEND  EQU   *                                                        10410000
IGC0905I CSECT ,                                                        10420000
@9FF     EQU   NOTEST                                                   10430000
@9FE     EQU   NOTEST                                                   10440000
@9FC     EQU   UCBCHK03                                                 10450000
@9FB     EQU   UCBCHK03                                                 10460000
@9F2     EQU   NOTEST                                                   10470000
         END    ,(C'PL/S',1400,78116)                                   10480000
