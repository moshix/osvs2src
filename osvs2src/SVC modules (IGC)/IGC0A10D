 TITLE ' IGC0A10D - TCAM APP NETWORK CONTROL INTERFACE'                 00070000
IGC0A10D CSECT                                                          00140000
*A-000000-999999                                               @X31X8R0 00210000
*C THIS MODULE HAS BEEN COMPLETELY REWRITTEN FOR TCAM LEVEL 6    Y02027 00280000
*D             QCOPY FUNCTION HAS BEEN DELETED FROM THIS MODULE  X02004 00350000
*D             AND PLACED INTO IGC0010D                          X02004 00420000
*C017000,234700,238200,253200,257400,272500-273200             @Z30X8RB 00490000
*C276000,305400,308200,348500,390100,559500                    @Z30X8RB 00560000
*C577000,595900,609900,696700                                  @Z30X8RB 00630000
*C134100                                                         X02004 00700000
*A626400-636300,638100-650700,774900-777600                     SA52502 00770000
*A637200                                                         X02004 00840000
*C360900-361800                                                 SA57674 00910000
*D             RETRIEVE (CQTAM) FUNCTION HAS BEEN DELETED FROM   Y05330 00980000
*D             THIS MODULE AND PLACED INTO IGCR010D              Y05330 01050000
*C020700,031500,201600,223200-229500,235800,255600-256500,260100,Y05330 01120000
*C263700-263710,283500,306000,307800,356400,376200,382500,407700,Y05330 01190000
*C427500,486900,512100,524700,529200,551700,787500,798300-799200,Y05330 01260000
*C875700,876600,                                                 Y05330 01330000
*A021000-021300,026200-026700,031800-032100,133500-133800,148900,Y05330 01400000
*A183100,189300-189600,191200,195600-195900,213400-213900,231350-Y05330 01470000
*A232050,243970-244670,372640-373320,306600-307200,344720-345460,Y05330 01540000
*A383500,407700,422160-422940,492600-492900,497200,500800,524900-Y05330 01610000
*A525300,591300-747300,787600-788000,798600-798900,799500,867100,Y05330 01680000
*A876000-876300,876900-877200,910300                             Y05330 01750000
*D045900-057600,138600-147600,153900-154800,171900-175500,187200-Y05330 01820000
*D188100,284400-285300,306900,383400-385200,408600-409500,479700,Y05330 01890000
*D487800,591300-774000,778500-782100,849600-851400,883800-905400 Y05330 01960000
*A165700-167700,479200,910200                                   SA61775 02030000
*C164700,478800                                                 SA61775 02100000
*D165600,168300-169200                                          SA61775 02170000
*A410800                                                        SA63026 02240000
*C136000                                                       @ZA00200 02310000
*A136050-136250,841566-841572                                  @ZA00200 02380000
*C286500,378900,389700                                         @YA05454 02450000
*D677100,677800                                                @SA71116 02520000
*A682000                                                       @SA71116 02590000
*A354400                                                       @YA10247 02660000
*A357200                                                       @YA11131 02730000
*C351600,358600-359300,362800,364200                           @YA11131 02800000
*D353700-354400                                                @YA11131 02870000
*C354700                                                       @OZ09302 02940000
*C548300,635800,639300                                         @OZ09941 03010000
*A192000,746400,841600                                         @OZ09941 03080000
*A755500                                                       @OZ11203 03150000
*C176600                                                       @OZ11203 03220000
*C039900,035700,039900,056000,088900                           @G36XRRU 03220100
*A096600,098700,100100,104300,109900,174300,224700,272300      @G36XRRU 03220200
*A303800,306600,358400,365400,392700,394800,406700,450800      @G36XRRU 03220300
*A642600,819700,861000,893200,903000,967400                    @G36XRRU 03220400
*C413000                                                       @OY16438 03240400
*A884800                                                       @OY16438 03260400
*C767900-768600                                                @OZ19771 03261410
*A100100,102200                                                @OZ19771 03262410
*A698600                                                       @OZ26929 03262582
*A202300,207500                                                @OZ29214 03262682
*D202760-202820                                                @OZ29214 03262782
*A705600                                                       @OZ30765 03262882
*********************************************************************** 03290000
*                                                                     * 03360000
*TITLE -- IGC0A10D - TCAM APP NETWORK CONTROL INTERFACE               * 03430000
*                                                                     * 03500000
*  MODULE NAME = IGC0A10D  (TCAM,OPERATOR CONTROL)             @G36XRRU 03570000
*                                                                     * 03640000
*  DESCRIPTIVE NAME = TCAM APP NETWORK CONTROL INTERFACE              * 03710000
*                                                                     * 03780000
*  COPYRIGHT = NONE                                                   * 03850000
*                                                                     * 03920000
*  STATUS = CHANGE LEVEL 10                                    @G36XRRU 03990000
*                                                                     * 04060000
*FUNCTION -- THIS MODULE CONTAINS ROUTINES THAT PROCESS TCAM OPERATOR * 04130000
*  CONTROL FUNCTIONS ISSUED FROM AN APPLICATION PROGRAM.  TPDATE AND  * 04200000
*  MCOUNT PROCESSING ARE ALSO HANDLED. IN ALL CASES, IGC0A10D GAINS   * 04270000
*  CONTROL AS A RESULT OF AN AIB BEING TPOSTED BY SVC 102 TO THE      * 04340000
*  OPERATOR CONTROL QCB.  FUNCTIONS HANDLED BY THIS MODULE ARE:       * 04410000
*             TCOPY      QCOPY                                        * 04480000
*             TCHNG      MRELEASE                                     * 04550000
*             ICOPY      MCOUNT                                       * 04620000
*             ICHNG      TPDATE                                       * 04690000
*             MCPCLOSE                                                * 04760000
*  FOR MRELEASE, MCPCLOSE, AND ICHNG, THIS ROUTINE XCTL'S TO THE      * 04830000
*  APPROPRIATE OP CONTROL MODULE FOR PROCESSING.                      * 04900000
*                                                                     * 04970000
*NOTES -- SEE BELOW                                                   * 05040000
*                                                                     * 05110000
*  DEPENDENCIES = AN INTERNAL REPRESENTATION OF THE EXTERNAL CHARAC-  * 05180000
*             TER SET WHICH IS EQUIVALENT TO THE ONE USED AT ASSEMBLY * 05250000
*             TIME.  THE CODING HAS BEEN ARRANGED SO THAT REDEFINI-   * 05320000
*             TION OF CHARACTER CONSTANTS, BY REASSEMBLY, WILL RESULT * 05390000
*             IN A CORRECT MODULE FOR THE NEW DEFINITIONS.            * 05460000
*                                                                     * 05530000
*  PATCH LABEL = PATCH                                         @G36XRRU 05600000
*                                                                     * 05670000
*  RESTRICTIONS = NONE                                                * 05740000
*                                                                     * 05810000
*  REGISTER CONVENTIONS --                                            * 05880000
*             ROPCAVT - OP CONTROL AVT BASE REG                       * 05950000
*             RAIB    - AIB BASE REG                                  * 06020000
*             RTERM   - TERMINAL ENTRY BASE REG                       * 06090000
*             RAVT    - TCAM AVT BASE REG                             * 06160000
*             RBASE   - MODULE BASE REG                               * 06230000
*             RSAVE   - OP CONTROL SAVE AREA PTR                      * 06300000
*                                                                     * 06370000
*ATTRIBUTES -- REENTRANT, SUPERVISOR MODE                             * 06440000
*                                                                     * 06510000
*ENTRY POINT -- IGC0A10D                                              * 06580000
*                                                                     * 06650000
*  PURPOSE = SEE FUNCTION                                             * 06720000
*                                                                     * 06790000
*  LINKAGE = XCTL FROM IGC0010D, IGCT010D & IGCT110D                  * 06860000
*                                                                     * 06930000
*INPUT -- AIB POINTED TO BY OPCCOPCE (CURRENT ELEMENT PTR) IN THE     * 07000000
*  OPERATOR CONTROL AVT.  REG 1 CONTAINS PTR TO THE OP CONTROL AVT.   * 07070000
*                                                                     * 07140000
*OUTPUT -- AIB CONTAINING FUNCTIONAL DEPENDENT DATA.                  * 07210000
*                                                                     * 07280000
*EXIT -- NORMAL = RETURN TO IGC0010D WITH THE FOLLOWING EXCEPTIONS:   * 07350000
*             MRELEASE - XCTL TO IGCR010D                             * 07420000
*             MCPCLOSE - XCTL TO IGCZ010D                             * 07490000
*             ICHNG    - XCTL TO IGCI010D                             * 07560000
*             TCHNG-IF STATION ATTACHED TO A 3705- XCTL TO IGCT010D   * 07630000
*                                                                     * 07700000
*EXIT -- ERROR = IGC0710D                                             * 07770000
*                                                                     * 07840000
*EXTERNAL REFERENCES -- SEE BELOW                                     * 07910000
*                                                                     * 07980000
*  ROUTINES = IEDQCA                                                  * 08050000
*             IGCT010D                                                * 08120000
*             XMPOST                                                  * 08190000
*                                                                     * 08260000
*  DATA AREAS = AIB                                                   * 08330000
*               PEWA                                                  * 08400000
*               TERM ENTRY                                            * 08470000
*                                                                     * 08540000
*  CONTROL BLOCKS = AVT       DCB                                     * 08610000
*                   CVT       DEB                                     * 08680000
*                   QCB       TIOT                                    * 08750000
*                   PCB       MSK                              @G36XRRU 08820000
*                                                                     * 08890000
*TABLES -- NONE                                                       * 08960000
*                                                                     * 09030000
*MACROS -- NONE                                                       * 09100000
*                                                                     * 09170000
*CHANGE ACTIVITY -- SEE ABOVE                                         * 09240000
*                                                                     * 09310000
*************************END OF SPECIFICATIONS************************* 09380000
         EJECT                                                          09450000
         SPACE 3                                                        09520000
RZERO    EQU   0                        REGISTER ZERO                   09590000
RPARM    EQU   1                        INPUT PARM REG           Y02027 09660000
RONE     EQU   1                        WORK REG               @G36XRRU 09730000
ROPCAVT  EQU   2                        OP CTL AVT BASE REG      Y02027 09800000
RAIB     EQU   3                        AIB BASE REG             Y02027 09870000
R3       EQU   3                        WORK REG               @G36XRRU 09940000
RTO      EQU   4                        'TO' AREA PTR FOR MOVES  Y02027 10010000
RDEB     EQU   4                        DEB POINTER            @OZ19771 10011010
RANDREG  EQU   4                        WORK REG FOR TCHNG     @G36XRRU 10080000
RTERM    EQU   5                        TERMINAL TABLE                  10150000
RILIST   EQU   5                        INVITE LIST POINTER    @Z30X8RB 10220000
RPRF     EQU   5                        BUFFER REGISTER        @OZ19771 10221010
RDCB     EQU   6                        DCB/LGB POINTER        @Z30X8RB 10290000
RWORK    EQU   6                        WORK REGISTER            Y02027 10360000
RWORK7   EQU   7                        WORK REG                 Y02027 10430000
RSRCHARG EQU   7                        SEARCH ARG REG - TCHNG @G36XRRU 10500000
RFROM    EQU   8                        'FROM' AREA PTR FOR MOVE Y02027 10570000
RAVT     EQU   9                        ADDRESS VECTOR TABLE            10640000
RTEMP    EQU   10                       WORK REG                        10710000
RCOUNT   EQU   11                       WORK REG                        10780000
RBASE    EQU   12                       BASE REG                        10850000
RSAVE    EQU   13                       SAVE AREA ADDRESS               10920000
RETURN   EQU   14                       RETURN ADDRESS                  10990000
RETWORK  EQU   14                       WORK REG               @G36XRRU 11060000
RETWRK   EQU   14                       WORK REG               @G36XRRU 11130000
RENTRY   EQU   15                       ENTRY POINT/ COMPLETION CODE    11200000
         SPACE 3                                                        11270000
         USING IEDQAVTD,RAVT            TCAM ADDRESS VECTOR TBL         11340000
         USING IEDQAIB,RAIB             AIB ADDRESSABILITY       Y02027 11410000
         USING IEDQOPCD,ROPCAVT                                         11480000
         USING IEDQTRM,RTERM            TERMINAL TABLE                  11550000
         SPACE 2                                                        11620000
         BALR  RBASE,RZERO              ESTABLISH                       11690000
         USING *,RBASE                  ADDRESSABILITY                  11760000
IGC0A10D IEDHJN ENTER                                                   11830000
         LR    ROPCAVT,RPARM            GET OP CONTROL AVT PTR   Y02027 11900000
         L     RAVT,OPCAVTPT            GET TCAM AVT PTR         Y02027 11970000
         LA    RSAVE,OPCSAVE            RESTORE SAVE AREA PTR    Y02027 12040000
         L     RAIB,OPCCOPCE            OP CTL ELEMENT PTR       Y02027 12110000
         LA    RWORK,VERBTBL            COMMAND VERB TABLE     @ZA00200 12180000
         SH    RAIB,HTWELVE             ADJUST TO PT TO VERB   @ZA00200 12250000
         TM    OPCSPEC,OPCRSTRT         CK FOR RESTART         @ZA00200 12320000
         BO    CHKVERB                  BR YES TO PROCESS ICHNG@ZA00200 12390000
*                                       OR MRELEASE INCIDENT RECOZ00200 12460000
         L     RAIB,OCCIB-IEDQOPCE+TWELVE(,RAIB)  PT TO AIB    @ZA00200 12530000
         LA    RWORK,AIBKEY-IEDQAIB     BACKUP TO THE BEGINNING  Y02027 12600000
         SR    RAIB,RWORK               OF THE AIB PROPER        Y02027 12670000
         L     RETURN,AIBRNRET          GET POSS RET ADDRESS     Y02027 12740000
         TM    AIBCOMCD,RNRETCD         IS THIS RETURN FROM 3705 Y02027 12810000
         BCR   ONE,RETURN               YES, BRANCH TO FUNCTION  Y02027 12880000
         SPACE 1                                                        12950000
         L     RTEMP,CVTPTR             CVT PTR                  Y02027 13020000
         L     RTEMP,CVTAQAVT-CVTMAP(RTEMP)  GET TCX PTR         Y02027 13090000
         LH    RTEMP,TCXSZAIB-IEDQTCX(RTEMP) GET AIB SIZE        Y02027 13160000
         LA    RCOUNT,AIBDATA-IEDQAIB   SUBTRACT PREFIX TO GET   Y02027 13230000
         SR    RTEMP,RCOUNT             MAX LEN FOR DATA AREA    Y02027 13300000
         ST    RTEMP,AIBXMLST           STORE FOR REFERENCE      Y02027 13370000
         SPACE 1                                                        13440000
         LA    RWORK,VERBTBL            GET PTR TO COMM CD TABLE Y02027 13510000
CHKVERB  EQU   *                                                 Y02027 13580000
         CLC   ZERO(ONE,RWORK),AIBCOMCD CHECK VERB FOR MATCH     Y02027 13650000
         BE    GOODVERB                 YES, CONTINUE PROCESSING Y02027 13720000
         LA    RWORK,TABLEN(,RWORK)     POINT TO NEXT VERB       Y02027 13790000
         CLI   ZERO(RWORK),TABEND       END OF TABLE             Y02027 13860000
         BNE   CHKVERB                  NO, GO CHECK NEXT        Y02027 13930000
         SPACE 1                                                        14000000
VERBERR  EQU   *                                                 Y02027 14070000
         LA    RZERO,CODEFF             SET CODE FOR ERR MSG     Y02027 14140000
         MVC   OPCLDNME+3(TWO),WRXCTL   MOD ID = MSG ROUTER      Y02027 14210000
         B     XCTL                     GO TO ERROR WRITER       Y02027 14280000
         SPACE 1                                                        14350000
GOODVERB EQU   *                                                 Y02027 14420000
         MVC   OPCLDNME+3(TWO),ONE(RWORK)    SET XCTL MOD ID     Y02027 14490000
MODTEST  EQU   *                                                 Y02027 14560000
         CLI   ONE(RWORK),ZERO          IS FUNCTION HANDLED      Y02027 14630000
*                                       BY A10D                  Y02027 14700000
         BNE   XCTL                     NO, BRANCH               Y02027 14770000
         SPACE 1                                                        14840000
*                                                              * Y02027 14910000
*  FOR TCOPY, QCOPY, AND FIRST PASS FOR TCHNG...               * Y02027 14980000
*        CHECK VALIDITY OF SPECIFIED TERMINAL NAME AND,        * Y02027 15050000
*        IF VALID, GET TERMINAL ENTRY ADDRESS.                 * Y02027 15120000
*                                                              * Y02027 15190000
         SPACE 1                                                        15260000
TRMOFST  EQU   *                                                 Y02027 15330000
         TM    AIBFLAG1,AIBTNT          ENTRY FROM FUNCTION REQ  Y02027 15400000
*                                       TERMNAME LOOKUP          Y02027 15470000
         BZ    TCHNGMVE                 BRANCH IF NO             Y02027 15540000
         CLI   AIBCOMCD,AIBQCOPY        QCOPY FUNCTION           Y02027 15610000
         BNE   TRMOFST2                 NO, BRANCH               Y02027 15680000
         CLC   AIBLIMIT(2),AVTFZERO     LIMIT FUNCTION           Y02027 15750000
         BNE   QLIMIT                   YES, BRANCH              Y02027 15820000
TRMOFST2 EQU   *                                                 Y02027 15890000
*                                                              * Y02027 15960000
*  GO TO SUBROUTINE IN IEDQCA TO GET NAME OFFSET AND TERM      * Y02027 16030000
*  ENTRY ADDRESS.                                              * Y02027 16100000
*                                                              * Y02027 16170000
         LR    RTO,RAVT                 SET TCAM AVT PTR         Y02027 16240000
         MVI   OPCDOUBL,BLANK           BLANK WORK             @OZ11203 16310000
         MVC   OPCDOUBL+1(SEVN),OPCDOUBL  FIELD IN OPC AVT     @OZ11203 16380000
         L     RILIST,AVTRNMPT          GET TERMNAME TBL ADDR  @OZ11203 16450000
         SR    RENTRY,RENTRY            CLEAR REGISTER         @OZ11203 16520000
         IC    RENTRY,TNTENLEN-IEDQTNTD(,RILIST) GET ENTRY LEN @OZ11203 16590000
         BCTR  RENTRY,ZERO              DECREMENT BY ONE FOR EX@OZ11203 16660000
         EX    RENTRY,TERMMOVE          MOVE TERM NAME         @OZ11203 16730000
*                                       SUBROUTINE               Y02027 16800000
         LR    RTERM,RAIB               SAVE AIB PTR             Y02027 16870000
         L     RAIB,OPCCOPCE            SET PTR TO OPCE          Y02027 16940000
         L     RENTRY,OPCTOFLK          GET SUBROUTINE ENTRY ADD Y02027 17010000
         BALR  RETURN,RENTRY            GO GET OFFSET            Y02027 17080000
         SPACE 2                                                        17150000
GOODNAME EQU   *                                                 Y02027 17220000
         B     GOTTRMAD                 BR IF TERM NAME VALID    Y02027 17290000
BADNAME  EQU   *                                                 Y02027 17360000
         LR    RAIB,RTERM               RESTORE AIB PTR          Y02027 17430000
BADNAME1 EQU   *                                               @G36XRRU 17480000
         LA    RENTRY,INVALTRM          SET ERROR CODE           Y02027 17500000
         B     POSTAPP                  PREPARE TO EXIT          Y02027 17570000
GOTTRMAD EQU   *                                                 Y02027 17640000
         LR    RAIB,RTERM               RESTORE AIB PTR          Y02027 17710000
         L     RTO,OPCCOPCE             CURRENT ELEMENT PTR      Y02027 17780000
         MVC   AIBTNDX(TWO),OCTRMTBL-IEDQOPCE(RTO)   GET TERMINALY02027 17850000
*                                       OFFSET                   Y02027 17920000
         LR    RTERM,RPARM              GET TERM ENTRY ADDRESS   Y02027 17990000
         CLI   AIBCOMCD,AIBQCOPY        FOR QCOPY                Y02027 18060000
         BE    QCOPY                    YES, BRANCH              Y02027 18130000
         CLI   AIBCOMCD,AIBICOPY        ICOPY FUNCTION           Y02027 18200000
         BE    ICOPYRN                  YES, BRANCH              Y02027 18270000
         CLI   AIBCOMCD,AIBICPYX        EXTENDED ICOPY         @OZ09941 18340000
         BE    ICOPYRN                  YES, BRANCH            @OZ09941 18410000
         ST    RTERM,AIBNAME            SAVE  TERM ENTRY ADD     Y02027 18480000
         SPACE 1                                                        18550000
*                                                              * Y02027 18620000
*                   COMPUTE TERMINAL ENTRY SIZE                * Y02027 18690000
*                                                              * Y02027 18760000
         SPACE 1                                                        18830000
         TM    TRMSTATE,TRMLIST         DIST OR CASCADE LIST     Y02027 18900000
         BNO   SINGLE                   BRANCH IF NO             Y02027 18970000
LISTENT  EQU   *                                                 Y02027 19040000
         TM    AIBCOMCD,AIBTCHNG        TCOPY OR TCHNG           Y02027 19110000
         BO    TCHNGMVE                 BRANCH IF TCHNG          Y02027 19180000
         LA    RCOUNT,TLISTEN-IEDQTRM   BASIC SEGMENT LENGTH     Y02027 19250000
         SR    RWORK,RWORK              CLEAR REGISTER           Y02027 19320000
         LH    RWORK,TLISTCNT           NUMBER OF ENTRIES        Y02027 19390000
         SLL   RWORK,ONE                MULTIPLY BY 2 FOR LENGTH Y02027 19460000
         AR    RCOUNT,RWORK             TOTAL LIST ENTRY LENGTH  Y02027 19530000
         STH   RCOUNT,AIBCOUNT          SAVE BYTE COUNT          Y02027 19600000
         C     RCOUNT,AIBXMLST          COMPARE FOR END OF AIB   Y02027 19670000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 19740000
         LA    RTO,AIBDATA              SET REGISTERS FOR MOVE   Y02027 19810000
         LR    RFROM,RTERM              SUBROUTINE               Y02027 19880000
         BAL   RETURN,TMLOOP            GO COPY TLIST ENTRY INTO Y02027 19950000
*                                       AIB                      Y02027 20020000
         B     GOODEXIT                 PREPARE TO RETURN        Y02027 20090000
         SPACE 2                                                 Y02027 20160000
SINGLE   EQU   *                                                 Y02027 20230000
         TM    TRMSTATE,TRMPREF         3705 RESOURCE          @OZ29214 20236082
         BZ    NOT3705                  NO, BRANCH             @OZ29214 20242082
         LA    RENTRY,TRMPRFSZ          TTE PREFIX SIZE        @ZM46776 20250000
         SLR   RTERM,RENTRY             POINT TO PREFIX        @ZM46776 20270000
         CLI   TRMTYPE-IEDNTRM(RTERM),TRMGRP LGB ENTRY         @ZM46776 20290000
         BNE   NOLGB                    NO                     @ZM46776 20310000
         LA    RENTRY,INVALTRM          SET POSS ERROR RETURN CD Y02027 20440000
         B     POSTAPP                  TERMINATE REQUEST      @ZM46776 20450000
         SPACE 1                                                        20650000
NOLGB    EQU   *                                                 Y02027 20720000
         AR    RTERM,RENTRY             RESTORE TTE POINTER    @ZM46776 20750000
NOT3705  EQU   *                                               @OZ29214 20770082
         TM    AIBCOMCD,AIBTCHNG        TCHNG FUNCTION           Y02027 20790000
         BO    TCHANGE                  YES, BRANCH              Y02027 20810000
         LA    RTO,AIBDATA              PTR TO RECIPIENT AREA    Y02027 20930000
         MVC   AIBDATA(TRMOPNO-IEDQTRM),TRMSTATE    COPY BASIC   Y02027 21000000
*                                       SEGMENT OF TERM ENTRY    Y02027 21070000
         LA    RCOUNT,TRMOPNO-IEDQTRM   SET COUNTER REG          Y02027 21140000
         AR    RTO,RCOUNT               BUMP RECIPIENT AREA PTR  Y02027 21210000
         TM    TRMSTATE,TRMOPTFN        ARE OPTION FIELDS USED   Y02027 21280000
         BNO   DEVDEP                   BRANCH IF NO             Y02027 21350000
         LA    RCOUNT,TRMOPT-TRMOPNO(,RCOUNT)    ADD OPTION      Y02027 21420000
*                                       CONTROL INFO BYTE COUNT  Y02027 21490000
         MVC   ZERO(TRMOPT-TRMOPNO,RTO),TRMOPNO  MOVE OPT INFO   Y02027 21560000
         LA    RTO,TRMOPT-TRMOPNO(,RTO) BUMP 'TO' AREA PTR       Y02027 21630000
         LA    RFROM,TRMOPT             START OF OPTION OFFSETS  Y02027 21700000
         SR    RPARM,RPARM              CLEAR REGISTER           Y02027 21770000
         IC    RPARM,TRMOPNO            NUMBER OF OPTION OFFSETS Y02027 21840000
         AR    RCOUNT,RPARM             BUMP BYTE COUNTER        Y02027 21910000
         C     RCOUNT,AIBXMLST          COMPARE FOR END OF AIB   Y02027 21980000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 22050000
         BCTR  RPARM,RZERO              DECREMENT FOR EXECUTE    Y02027 22120000
         EX    RPARM,MOVEM              MOVE OPTION OFFSETS      Y02027 22190000
         LA    RTO,ONE(RPARM,RTO)       BUMP 'TO' AREA PTR       Y02027 22260000
*                                       TO NEXT EMPTY BYTE       Y02027 22330000
DEVDEP   EQU   *                                                 Y02027 22400000
         STH   RCOUNT,AIBCOUNT          SAVE BYTE COUNT          Y02027 22470000
         BAL   RETURN,TESTTYPE          CHECK TO SEE IF TRIP   @G36XRRU 22540000
*                                       TO NCP IS REQUIRED     @G36XRRU 22610000
         B     DEVDEP0X                 RETURN HERE IF NOT     @G36XRRU 22680000
*        RETURN HERE IF TRIP TO NCP IS REQUIRED                @G36XRRU 22750000
*                                                              * Y02027 22820000
*SET UP TO GO TO 3705-TCOPY SERVICE ROUTINE TO GET DEVICE      @Z30X8RB 22890000
* DEPENDENT FIELDS COPIED INTO THE AIB                         * Y02027 22960000
*                                                              * Y02027 23030000
         LA    RTO,AIBDATA              GET 'TO' AREA PTR AND    Y02027 23100000
         STM   RTO,RTERM,AIBRNTO        SAVE TO & FROM AREA PTRS Y02027 23170000
         XC    AIBCOMCD(THREE),AIBCOMCD SET ZEROES IN COMMAND    Y02027 23240000
*                                       VERB & ENTRY CODE FIELDS Y02027 23310000
         BAL   RETURN,EXITT0            EXIT TO IGCT010D         Y02027 23380000
         SPACE 1                                                        23450000
RNTCOPY  EQU   *                                                 Y02027 23520000
         MVI   AIBCOMCD,AIBTCOPY        RESET COMMAND CODE       Y02027 23590000
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 23660000
         ICM   RENTRY,BY3,AIBOPRC       GET RETURN CODE          Y02027 23730000
         BNZ   POSTAPP                  BRANCH IF ERROR          Y02027 23800000
         L     RTERM,AIBRNFRO           RESTORE TERM ENTRY PTR   Y02027 23870000
         LA    RTO,AIBDATA              ADJUST AIB               Y02027 23940000
         SR    RZERO,RZERO              CLEAR REGISTER           Y02027 24010000
         ICM   RZERO,HALFWORD,TRMDEVFL-IEDQTRM(RTO)  GET DEV DEP Y02027 24080000
*                                       DEPENDENT FIELDS FROM    Y02027 24150000
*                                       AIB DATA AREA            Y02027 24220000
         LA    RTO,TRMOPNO-IEDQTRM(,RTO)     DATA AREA POINTER   Y02027 24290000
         TM    TRMSTATE,TRMOPTFN        TO POINT TO              Y02027 24360000
         BNO   RNDDCHK                  THE BEGINNING OF         Y02027 24430000
         SR    RPARM,RPARM              THE                      Y02027 24500000
         IC    RPARM,TRMOPNO            DEVICE DEPENDENT         Y02027 24570000
         LA    RTO,TRMOPT-TRMOPNO(RPARM,RTO) FIELDS              Y02027 24640000
         SPACE 1                                                        24710000
*****************************************************************Y02027 24780000
*ON RETURN FROM TCOPY ROUTINE, LOCATE NEXT EMPTY FIELD IN AIB  @Z30X8RB 24850000
* AND MOVE IN OPTION ENTRY FIELDS (IF ANY EXIST )                Y02027 24920000
*****************************************************************Y02027 24990000
         SPACE 1                                                        25060000
RNDDCHK  EQU   *                                                 Y02027 25130000
         LR    RWORK7,RTO               SET REG FOR DDCOUNT RTN  Y02027 25200000
         LTR   RZERO,RZERO              ARE THERE DEV DEP FLDS   Y02027 25270000
         BZ    OPTST                    NO, BRANCH               Y02027 25340000
         B     DDGORN                   PREPARE TO PROCESS DD'S  Y02027 25410000
         SPACE 1                                                        25480000
*****************************************************************Y02027 25550000
* MOVE IN DEVICE DEPENDENT FIELDS AND THEN                     @Z30X8RB 25620000
* PROCESS OPTION ENTRY FIELDS.                                   Y02027 25690000
*****************************************************************Y02027 25760000
         SPACE 1                                                        25830000
DEVDEP0X EQU   *                                                 Y02027 25900000
         LA    RWORK7,TRMOPNO-IEDQTRM(RTERM) GET POINTER TO      Y02027 25970000
         TM    TRMSTATE,TRMOPTFN        BEGINNING OF             Y02027 26040000
         BNO   DDGO                     DEVICE                   Y02027 26110000
         SR    RPARM,RPARM              DEPENDENT                Y02027 26180000
         IC    RPARM,TRMOPNO            FIELDS IN THE            Y02027 26250000
         LA    RWORK7,TRMOPT-TRMOPNO(RPARM,RWORK7)  TERM ENTRY   Y02027 26320000
DDGO     EQU   *                                                 Y02027 26390000
         LR    RFROM,RWORK7             SAVE PTR FOR MOVE        Y02027 26460000
         SR    RZERO,RZERO              CLEAR REGISTER           Y02027 26530000
         ICM   RZERO,HALFWORD,TRMDEVFL  ARE THERE DD FIELDS      Y02027 26600000
         BZ    OPTST                    NO, BRANCH               Y02027 26670000
         SPACE 1                                                        26740000
DDGORN   EQU   *                                                 Y02027 26810000
         BAL   RETURN,DDCOUNT           GO GET LEN OF DD FIELDS  Y02027 26880000
         LR    RWORK7,RCOUNT            SAVE COUNT               Y02027 26950000
         AH    RWORK7,AIBCOUNT          ADD LEN TO TOTAL BYTE    Y02027 27020000
         STH   RWORK7,AIBCOUNT          COUNT AND SAVE IN AIB    Y02027 27090000
         C     RWORK7,AIBXMLST          CHECK FOR END OF AIB     Y02027 27160000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 27230000
         BAL   RETURN,TESTTYPE          CHECK TO SEE IF DD FLD @G36XRRU 27300000
*                                       HAVE BEEN MOVED        @G36XRRU 27370000
         B     MVDD0X                   NO, BRANCH             @G36XRRU 27440000
         B     OPTST                    YES, CHECK OPTION FLD  @G36XRRU 27510000
MVDD0X   EQU   *                                                 Y02027 27580000
         BAL   RETURN,TMLOOP            GO MOVE DD FIELDS        Y02027 27650000
         SPACE 1                                                        27720000
OPTST    EQU   *                                                 Y02027 27790000
         LH    RWORK7,AIBCOUNT          PICK UP TOTAL BYTE COUNT Y02027 27860000
         LA    RTEMP,AIBDATA            SET UP PTR TO            Y02027 27930000
         LA    RTO,ZERO(RWORK7,RTEMP)   NEXT EMPTY BYTE IN AIB   Y02027 28000000
         TM    TRMSTATE,TRMOPTFN        ARE OPTION FIELDS USED   Y02027 28070000
         BNO   GOODEXIT                 NO, BRANCH               Y02027 28140000
         STH   RWORK7,TRMOPTBL-IEDQTRM(RTEMP)   SET PTR TO OPTIONY02027 28210000
*                                       ENTRIES IN AIB           Y02027 28280000
         BAL   RETURN,CHECKOFF          GO FIND TOTAL LEN OF     Y02027 28350000
*                                       OPTION ENTRIES - RETURN  Y02027 28420000
*                                       WITH LEN IN RCOUNT       Y02027 28490000
         LH    RFROM,TRMOPTBL           GET ENTRY OFFSET       @YA05454 28560000
         N     RFROM,AVTCLRHI           CLEAR HI HALF          @YA05454 28630000
         A     RFROM,AVTOPTPT           ADD OPT TBL ADDR       @YA05454 28700000
         LR    RTEMP,RCOUNT             SAVE COUNT               Y02027 28770000
         AH    RTEMP,AIBCOUNT           UPDATE TOTAL COUNT       Y02027 28840000
         STH   RTEMP,AIBCOUNT           SAVE BACK IN AIB         Y02027 28910000
         C     RTEMP,AIBXMLST           CHECK FOR END OF AIB     Y02027 28980000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 29050000
         BAL   RETURN,TMLOOP            GO MOVE OPTION ENTRIES   Y02027 29120000
         B     GOODEXIT                 EXIT                     Y02027 29190000
         SPACE 2                                                        29260000
***************************************************************  Y02027 29330000
* THIS CODE PROCESSES THE 1ST PASS FOR TCHNG (SINGLE ENTRIES)  * Y02027 29400000
* IT OBTAINS THE TOTAL LENGTH OF DATA TO BE MOVED FROM THE     * Y02027 29470000
* USER'S WORKAREA.                                               Y02027 29540000
***************************************************************  Y02027 29610000
TCHANGE  EQU   *                                                 Y02027 29680000
         LA    RCOUNT,TRMOPNO-IEDQTRM   GET LEN OF BASIC SEGMENT Y02027 29750000
         TM    TRMSTATE,TRMOPTFN        ARE OPTION FIELDS USED   Y02027 29820000
         BNO   TSIZE2                   NO, BRANCH               Y02027 29890000
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 29960000
         IC    RTEMP,TRMOPNO            GET NO. OF OPT OFFSETS   Y02027 30030000
         LA    RCOUNT,TRMOPT-TRMOPNO(RTEMP,RCOUNT)  UPDATE COUNT Y02027 30100000
TSIZE2   EQU   *                                                 Y02027 30170000
         STH   RCOUNT,AIBCOUNT          SAVE COUNT               Y02027 30240000
         C     RCOUNT,AIBXMLST          COMPARE FOR END OF AIB   Y02027 30310000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 30380000
         BAL   RETURN,TESTTYPE          CHECK TO SEE IF TRIP   @G36XRRU 30450000
*                                       TO 3705 RTN NEEDED     @G36XRRU 30520000
         B     DDSIZE0X                 RETURN HERE IF NO      @G36XRRU 30590000
*        RETURN HERE IF YES                                             30660000
         LA    RTO,AIBDATA              SET TO ADD FOR 3705    @G36XRRU 30730000
*                                       SERVICE ROUTINE          Y02027 30800000
         STM   RTO,RTERM,AIBRNTO        SET 'TO' AND 'FROM' ADDS Y02027 30870000
*                                       IN AIB                   Y02027 30940000
         XC    AIBCOMCD(THREE),AIBCOMCD SET FIELDS TO LOOK LIKE  Y02027 31010000
*                                       TCOPY REQUEST            Y02027 31080000
         BAL   RETURN,EXITT0            EXIT TO IGCT010D         Y02027 31150000
         SPACE 1                                                        31220000
*****************************************************************Y02027 31290000
* GO TO IGCT010D TO GET DEVICE DEPENDENT FIELDS MOVED TO AIB     Y02027 31360000
* SO THAT DD FIELD LENGTH CAN BE CALCULATED.                     Y02027 31430000
*****************************************************************Y02027 31500000
         SPACE 1                                                        31570000
RNTSIZE  EQU   *                                                 Y02027 31640000
         MVI   AIBCOMCD,AIBTCHNG        RESTORE TCHNG COMM CD    Y02027 31710000
         MVI   AIBFLAG1,AIBGETSZ        AND SIZE FUNCTION CODE   Y02027 31780000
         SR    RENTRY,RENTRY            CLEAR REGISTER         @Z30X8RG 31850000
         ICM   RENTRY,BY3,AIBOPRC       GET RETURN CODE        @Z30X8RG 31920000
         BNZ   POSTAPP                  BRANCH IF ERROR        @Z30X8RG 31990000
         L     RTERM,AIBRNFRO           RESTORE TERM ENTRY PTR   Y02027 32060000
         LA    RTO,AIBDATA              AND AIB DATA AREA PTR    Y02027 32130000
         SR    RZERO,RZERO             CLEAR REGISTER            Y02027 32200000
         ICM   RZERO,HALFWORD,TRMDEVFL-IEDQTRM(RTO)  GET DEV DEP Y02027 32270000
*                                       DEPENDENT FIELDS FROM    Y02027 32340000
*                                       AIB DATA AREA            Y02027 32410000
         LA    RTO,TRMOPNO-IEDQTRM(,RTO)     DATA AREA POINTER   Y02027 32480000
         TM    TRMSTATE,TRMOPTFN        TO POINT TO              Y02027 32550000
         BNO   RNDDCHK1                 THE BEGINNING OF         Y02027 32620000
         SR    RPARM,RPARM              THE                      Y02027 32690000
         IC    RPARM,TRMOPNO            DEVICE DEPENDENT         Y02027 32760000
         LA    RTO,TRMOPT-TRMOPNO(RPARM,RTO) FIELDS              Y02027 32830000
RNDDCHK1 EQU   *                                                 Y02027 32900000
         LR    RWORK7,RTO               SET REGISTER FOR DDCOUNT Y02027 32970000
         SR    RPARM,RPARM              CLEAR REGISTER           Y02027 33040000
         ICM   RPARM,HALFWORD,TRMDEVFL  GET DEV DEP FIELDS       Y02027 33110000
*                                       TERMINAL ENTRY           Y02027 33180000
         OR    RZERO,RPARM              COMBINE FLAGS SET BY RN  Y02027 33250000
*                                       FUNCTIONAL ROUTINE       Y02027 33320000
         LTR   RZERO,RZERO              DD FIELDS PRESENT        Y02027 33390000
         BZ    TCHNOPT1                 NO, BRANCH               Y02027 33460000
         B     DDRN                                              Y02027 33530000
DDSIZE0X EQU   *                                                 Y02027 33600000
         LA    RWORK7,TRMOPNO-IEDQTRM(RTERM) GET POINTER TO      Y02027 33670000
         TM    TRMSTATE,TRMOPTFN        BEGINNING OF             Y02027 33740000
         BNO   DD0X                     DEVICE                   Y02027 33810000
         SR    RPARM,RPARM              DEPENDENT                Y02027 33880000
         IC    RPARM,TRMOPNO            FIELDS IN THE            Y02027 33950000
         LA    RWORK7,TRMOPT-TRMOPNO(RPARM,RWORK7)  TERM ENTRY   Y02027 34020000
DD0X     EQU   *                                                 Y02027 34090000
         LR    RFROM,RWORK7             SAVE PTR FOR MOVE               34160000
         SR    RZERO,RZERO              CLEAR REGISTER           Y02027 34230000
         ICM   RZERO,HALFWORD,TRMDEVFL  ARE THERE DD FIELDS      Y02027 34300000
         BZ    TCHNOPT1                 NO, BRANCH               Y02027 34370000
DDRN     EQU   *                                                 Y02027 34440000
         BAL   RETURN,DDCOUNT           GO GET LEN OF DD FIELDS  Y02027 34510000
         AH    RCOUNT,AIBCOUNT          ADD LEN TO TOTAL BYTE    Y02027 34580000
         STH   RCOUNT,AIBCOUNT          COUNT AND SAVE IN AIB    Y02027 34650000
         C     RCOUNT,AIBXMLST          COMPARE FOR END OF AIB   Y02027 34720000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 34790000
         SPACE 1                                                        34860000
TCHNOPT1 EQU   *                                                 Y02027 34930000
         TM    TRMSTATE,TRMOPTFN        ARE OPTION FIELDS USED   Y02027 35000000
         BNO   GOODEXIT                 BRANCH IF NO OPTIONS     Y02027 35100000
*                                       ALL FIELDS HAVE BEEN     Y02027 35140000
*                                       CALCULATED               Y02027 35210000
         BAL   RETURN,CHECKOFF          GET LEN OF OPT ENTRIES   Y02027 35280000
         AH    RCOUNT,AIBCOUNT          UPDATE TOTAL             Y02027 35350000
         STH   RCOUNT,AIBCOUNT          BYTE COUNT               Y02027 35420000
         C     RCOUNT,AIBXMLST          COMPARE FOR END OF AIB   Y02027 35490000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 35560000
         B     GOODEXIT                 EXIT                     Y02027 35570000
*****************************************************************Y02027 35700000
* THIS CODE IS EXECUTED FOR LIST ENTRIES OR 2ND PASS FOR SINGLE  Y02027 35770000
* ONES.  THE CHANGED TERMINAL ENTRY & OPTION FIELD ENTRIES ARE   Y02027 35840000
* MOVED FROM THE AIB. IF THE STATION IS ASSOCIATED WITH A 3705 @G36XRRU 35910000
* EXIT (WITH NO RETURN) TO IGCT010D FOR REPLACEMENT OF DD FIELDS Y02027 35980000
*****************************************************************Y02027 36050000
         SPACE 2                                                        36120000
TCHNGMVE EQU   *                                                 Y02027 36190000
         CLI   AIBCOMCD,AIBTCHNG        TCHANGE FUNCTION         Y02027 36260000
         BNE   CHKICOPY                 NO, BRANCH               Y02027 36330000
         LA    RFROM,AIBDATA            USER DATA  =FROM                36360000
         L     RTERM,AIBNAME            GET ADDR OF TERM ENTRY   Y02027 36470000
         LA    RTERM,ZERO(,RTERM)       CLEAR HIGH ORDER BYTE    Y02027 36540000
         SR    RSRCHARG,RSRCHARG      CLEAR TO GET ARGUMENT    @G36XRRU 36610000
         IC   RSRCHARG,TRMSTATE  PUT TTE TYPE IN THE ARG       @G36XRRU 36680000
         LA   RANDREG,SRCHMSK      GET MASK TO GET RID         @G36XRRU 36750000
*                                       OF UNWANTED BITS       @G36XRRU 36820000
         NR    RSRCHARG,RANDREG       REMOVE UNWANTED BITS     @G36XRRU 36890000
         SLL   RSRCHARG,BY0             MAKE ROOM              @G36XRRU 36960000
         TM    TRMSTATE,TRMPREF       IS TTE AN NCP RESRCE     @G36XRRU 37030000
         BZ    NOPREFIX               NO                       @G36XRRU 37100000
         LR    RETWRK,RTERM           PRESERVE TTE REG         @G36XRRU 37170000
         S     RTERM,PREFIXL          BACK UP TO PREFIX        @G36XRRU 37240000
         USING IEDNTRM,RTERM          POINT DSECT AT PREFIX    @G36XRRU 37310000
         ICM   RSRCHARG,BY3,TRMTYPE     PUT QUALIFYING TYPE    @G36XRRU 37380000
*                                       IN THE ARGUMENT        @G36XRRU 37450000
         LR    RTERM,RETWRK           RESET TTE POINTER        @G36XRRU 37520000
         USING IEDQTRM,RTERM          RESET DSECT              @G36XRRU 37590000
NOPREFIX LA    RETWRK,SRCHLIM         SET UP LOOP COUNT        @G36XRRU 37660000
         LA    RWORK,SRCHTBLE         POINT AT SRCHTABLE       @G36XRRU 37730000
SRCHCLC  CLM   RSRCHARG,BY2+BY3,SRCHSTAT(RWORK) TTE TYPE=?     @G36XRRU 37800000
         BE    SRCHFND                 YES                     @G36XRRU 37870000
         LA    RWORK,SRCHTBEL(RWORK)   POINT AT NEXT ENTRY     @G36XRRU 37940000
         BCT   RETWRK,SRCHCLC          LOOP TILL END OF TABLE  @G36XRRU 38010000
         B     BADNAME1                INVALID ENTRY TYPE      @G36XRRU 38080000
SRCHFND  SR    RETWRK,RETWRK           CLEAR WORK REG          @G36XRRU 38150000
         IC    RETWRK,SRCHMASK(RWORK)  GET OFFSET TO MASK      @G36XRRU 38220000
         A     RETWORK,AVTOPMSK        POINT TO MASK TABLE     @G36XRRU 38290000
         LR    RWORK,RFROM             USER DATA               @G36XRRU 38360000
         CLM   RSRCHARG,BY2+BY3,SRLSTNTY        LIST ENTRY?    @G36XRRU 38430000
         BNE   TNOLGB              NO                          @G36XRRU 38500000
         SR    RTEMP,RTEMP              CLEAR FOR IC           @G36XRRU 38570000
         ICM   RTEMP,HALFWORD,FOUR(RWORK) NO OF 2- BYTE        @G36XRRU 38640000
*                                       ENTERIES IN U. LIST    @G36XRRU 38710000
         TM    MSK1-MSKMASK(RETWRK),MSKCNT  MODIFY COUNT?      @G36XRRU 38780000
         BZ    NOCOUNTM     NO                                 @G36XRRU 38850000
         STH   RTEMP,TLISTCNT  UPDATE COUNT                    @G36XRRU 38920000
NOCOUNTM TM    MSK1-MSKMASK(RETWRK),MSKLIST MODIFY TLIST?      @G36XRRU 38990000
         BZ    TCHNGOUT               NO GET OUT               @ZM46809 39100000
         SLL   RCOUNT,1           MULT BY SIZE OF ONE ENTRY             39107000
         LR    RWORK7,RCOUNT            SET RECEIVING AREA CT  @G36XRRU 39340000
         LR    RWORK,RTERM        COPY TO ADDRESS                       39360000
         LR    RTEMP,RFROM              FROM ADDRESS           @YA11131 39480000
         MVCL  RWORK,RTEMP              MOVE LIST ENTRY        @G36XRRU 39550000
         B     TCHNGOUT                 EXIT                   @ZM46809 39600000
TNOLGB   EQU   *                                               @G36XRRU 39690000
         SLR   RTEMP,RTEMP         CLEAR REGISTER              @G36XRRU 39760000
         STCM  RTEMP,THREE,AIBFLAG1 CLEAR FLAG1 & FLAG2        @G36XRRU 39830000
         TM    TRMDEVFL,DIALDIG    DIAL DIGITS IN TERM ENTRY   @G36XRRU 39900000
         BZ    TCKADDR             NO, BRANCH                  @G36XRRU 39970000
         OI    AIBFLAG2,DIGITS     INDICATE DIAL DIGITS        @G36XRRU 40040000
TCKADDR  EQU   *                                               @G36XRRU 40110000
         TM    TRMDEVFL,ADDCHAR   ADDR CHARS IN TERM ENTRY     @G36XRRU 40180000
         BZ    TNOADDR             NO, BRANCH                  @G36XRRU 40250000
         OI    AIBFLAG2,CHARS      INDICATE ADDR CHARACTERS    @G36XRRU 40320000
TNOADDR  EQU   *                                               @G36XRRU 40390000
         CLM   RSRCHARG,BY2+BY3,SPRCNTY IS IT A PROCESS ENTRY? @G36XRRU 40460000
         BNE   NOTPROC             BRANCH IF NOT               @G36XRRU 40530000
         MVC   TRMSTAT-IEDQTRM(FOUR,RWORK),TRMSTAT             @YA10247 40600000
*                                       SAVE PEWA ADDRESS      @YA10247 40670000
NOTPROC  EQU   *                                               @YA10247 40740000
         ST    R3,R3OFFSET(RSAVE)  SAVE REGISTER USED          @G36XRRU 40810000
         ST    RTERM,R5OFFSET(RSAVE) SAVE REG USED             @G36XRRU 40880000
         ST    RWORK,R8OFFSET(RSAVE) SAVE REG USED             @G36XRRU 40950000
         LA    RTEMP,LOOPCT        INIT LOOP COUNTER           @G36XRRU 41020000
         L     R3,ANDMASK          INITIALIZE TEST MASK        @G36XRRU 41090000
         LA    RTERM,TRMINSEQ      POINT TO RCVING AREA        @G36XRRU 41160000
         LA    RWORK,FOUR(RWORK)   POINT TO SENDING AREA       @G36XRRU 41230000
TSTMVE   EQU   *                                               @OY16438 41260000
         SR    RENTRY,RENTRY        CLEAR FOR IC               @OY16438 41300000
         ICM   RENTRY,HALFWORD,ZERO(RETWRK) GET MASK           @OY16438 41310000
         NR    RENTRY,R3            CAN 1 MODIFY THIS BYTE     @G36XRRU 41370000
         BZ    NOMOVE               NO                         @G36XRRU 41440000
         MVC   ZERO(ONE,RTERM),ZERO(RWORK) YES MOVE IT         @G36XRRU 41510000
NOMOVE   SRL   R3,ONE               SHIFT TO NEXT MASK BIT     @G36XRRU 41580000
         LA    RTERM,ONE(RTERM)     INCR RCVING FIELD          @G36XRRU 41650000
         LA    RWORK,ONE(RWORK)     INCR SENDING FIELD         @G36XRRU 41720000
         BCT   RTEMP,TSTMVE         REPEAT -LOOPCT- TIMES      @G36XRRU 41790000
         ICM   RWORK,FULLWORD,R8OFFSET(RSAVE) RESTORE USER     @G36XRRU 41860000
*                                       AREA POINTER           @G36XRRU 41930000
         LR    RONE,RWORK           RESTORE WORKAREA PTR       @G36XRRU 42000000
         ICM   RTERM,FULLWORD,R5OFFSET(RSAVE) RESTORE TTE PTR  @G36XRRU 42070000
         ST    RETWRK,R14INDEX(RSAVE) SAVE                     @G36XRRU 42140000
*                                       TCHNG MASK POINTER     @G36XRRU 42210000
         ICM   R3,FULLWORD,R3OFFSET(RSAVE) RESTORE REGISTER    @G36XRRU 42280000
*        MODIFY OPTION FIELDS                                  @G36XRRU 42350000
         TM    MSK2-MSKMASK(RETWRK),MSKOPT  MODIFY OPTION FLDS?@G36XRRU 42420000
         BZ    CHNGDD              NO                          @G36XRRU 42490000
         LA    RFROM,TRMOPNO-IEDQTRM(RFROM) ADJUST FROM ADDR   @ZM46777 42700000
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS PRESENT    Y02027 42770000
         BNO   CHNGDD                   CHECK DEV DEP FIELDS     Y02027 42840000
         SPACE 1                                                        42910000
**************************************************************** Y02027 42980000
*           MOVE  OPTION  ENTRIES  AND  OPTION  OFFSETS         *Y02027 43050000
**************************************************************** Y02027 43120000
         SPACE 1                                                        43190000
         SR    RCOUNT,RCOUNT            CLEAR REGISTER           Y02027 43260000
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 43330000
         IC    RTEMP,TRMOPNO            NUMBER OF OPTION ENTRIES Y02027 43400000
         LA    RTO,TRMOPT               POINT TO OPT OFFSETS IN  Y02027 43470000
*                                       TERM ENTRY               Y02027 43540000
         LA    RFROM,TRMOPT-TRMOPNO(,RFROM)  BUMP TO OPT OFFSETS Y02027 43610000
         LR    RZERO,RFROM              GET AND SAVE POINTER TO  Y02027 43680000
         AR    RZERO,RTEMP              BEGINNING OF DD FIELDS   Y02027 43750000
         BCTR  RTEMP,RZERO              DECREMENT COUNT FOR EXEC Y02027 43820000
         EX    RTEMP,MOVER              MOVE OPTION OFFSETS      Y02027 43890000
         SPACE 1                                                        43960000
         BAL   RETURN,CHECKOFF          GO GET LENGTH OF OPTION  Y02027 44030000
*                                       ENTRIES                  Y02027 44100000
         LH    RFROM,AIBDATA+(TRMOPTBL-IEDQTRM) OPT TAB OFSET  @YA05454 44170000
         N     RFROM,AVTCLRHI           CLEAR HI HALF          @YA05454 44240000
         LA    RFROM,AIBDATA(RFROM)     BUMP TO START OF       @YA05454 44310000
*                                       OPTION ENTRIES         @YA05454 44380000
         LH    RTO,TRMOPTBL             GET ENTRY OFFSET       @YA05454 44450000
         N     RTO,AVTCLRHI             CLEAR HI HALF          @YA05454 44520000
         A     RTO,AVTOPTPT             ADD OPT TAB ADDR       @YA05454 44590000
         BAL   RETURN,TMLOOP            GO MOVE OPTION ENTRIES   Y02027 44660000
         LR    RFROM,RZERO              RESTORE RFROM TO POINT   Y02027 44730000
*                                       TO BEGINNING OF DEVICE   Y02027 44800000
*                                       DEPENDENT FIELDS IN AIB  Y02027 44870000
*                                                              * Y02027 44940000
         SPACE 1                                                        45010000
CHNGDD   EQU   *                                                 Y02027 45080000
         ICM   RETWRK,FULLWORD,R14INDEX(RSAVE) RESTORE TCHNG   @G36XRRU 45150000
*                                       POINTER                @G36XRRU 45220000
         TM    MSK2-MSKMASK(RETWRK),MSKDVDP MODIFY DEVDEP FLD  @G36XRRU 45290000
         BZ    TCHNGOUT                 NO                     @ZM46809 45350000
         BAL   RETURN,TESTTYPE          CHECK TO SEE IF TRIP   @G36XRRU 45430000
*                                       TP 3705 RTN NEEDED     @G36XRRU 45500000
         B     TCHNG0X                  NO, BRANCH             @G36XRRU 45570000
*        RETURN HERE IF YES                                    @G36XRRU 45640000
         LR    RTO,RTERM                'TO' AREA = TERM ENTRY   Y02027 45710000
         LA    RTERM,AIBDATA            'FROM' AREA = USER DATA  Y02027 45780000
         STM   RTO,RTERM,AIBRNTO        SAVE IN LIST FOR SERVICE Y02027 45850000
*                                       ROUTINE                  Y02027 45920000
         OI    AIBFLAG1,AIBENT01        SET ENTRY AND RESPONSE   Y02027 45990000
         OI    AIBFLAG2,AIBRES08        CODES FOR SERVICE RTN    Y02027 46060000
         B     EXITT0                   GO TO IGCT010D           Y02027 46130000
         SPACE 1                                                        46200000
TCHNG0X  EQU   *                                                 Y02027 46270000
         SR    RZERO,RZERO              CLEAR REGISTER           Y02027 46340000
         ICM   RZERO,THREE,TRMDEVFL     ANY DEV DEPENDENT FIELDS Y02027 46410000
         BZ    TCHNGOUT                 BRANCH IF NO           @ZM46809 46500000
         SPACE 1                                                        46550000
CHNGDD2  EQU   *                                                 Y02027 46620000
         LR    RWORK7,RFROM             SET PTR TO USER DD FIELD Y02027 46690000
         BAL   RETURN,DDCOUNT           GO CHECK DEV DEP FIELDS  Y02027 46760000
*                                                              * Y02027 46830000
*            RETURN WITH SIZE OF DD FIELDS IN RCOUNT           * Y02027 46900000
*                                                              * Y02027 46970000
         LA    RWORK,TRMOPNO            NEXT BYTE IN TERM ENTRY  Y02027 47040000
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS USED       Y02027 47110000
         BNO   NOOPTS                   NO - BRANCH              Y02027 47180000
         SR    RWORK7,RWORK7            CLEAR REGISTER           Y02027 47250000
         IC    RWORK7,TRMOPNO           PICK UP NO.OF OPT OFFSET Y02027 47320000
         LA    RWORK,TRMOPT             FIND DD FIELDS FROM      Y02027 47390000
         AR    RWORK,RWORK7             TRMOPT + NO. OF OPTION   Y02027 47460000
*                                       OFFSETS                  Y02027 47530000
NOOPTS   EQU   *                                                 Y02027 47600000
         LR    RTEMP,RFROM              SET FROM REGISTER        Y02027 47670000
         LR    RWORK7,RCOUNT            SET RECEIVING AREA COUNT Y02027 47740000
         MVCL  RWORK,RTEMP              MOVE DATA                Y02027 47810000
         SPACE 1                                                        47950000
TCHNGOUT EQU   *                                               @ZM46777 47955000
         TM    AVTCKFLG,AVTCKTAC        TCAM CHECKPT ACTIVE    @ZM46777 47960000
         BZ    GOODEXIT                 NO BRANCH              @ZM46777 47965000
         L     RAIB,OPCCOPCE            OPCE ADDRESS           @ZM46777 47970000
         L     RAIB,OCCIB-IEDQOPCE(RAIB) GET CIB ADDRESS       @ZM46777 47975000
         LA    RWORK,AIBKEY-IEDQAIB     OFFSET TO AIB          @ZM46777 47980000
         SLR   RAIB,RWORK               POINT TO AIB           @ZM46777 47985000
         LH    RPARM,AIBTNDX-IEDQAIB(RAIB) PASS TTCIN AS PARM  @ZM46777 47990000
         LINK  EP=IEDQNB02              CHECKPT RESOURCE       @ZM46777 47995000
         B     GOODEXIT                 EXIT                   @ZM46777 48000000
*****************************************************************Y02027 48020000
*                  THIS CODE HANDLES DATA MOVES OF             * Y02027 48090000
*                  TERMINAL AND OPTION INFORMATION             * Y02027 48160000
*****************************************************************Y02027 48230000
TMLOOP   EQU   *                                                 Y02027 48300000
         C     RCOUNT,MAX               IS MOVE LOOP NEEDED      Y02027 48370000
         BNH   TLAST                    BRANCH IF NO             Y02027 48440000
         S     RCOUNT,MAX               SUBTRACT LENGTH          Y02027 48510000
         MVC   ZERO(MAXI,RTO),ZERO(RFROM)      MOVE 256 BYTES    Y02027 48580000
         LA    RFROM,MAXI(RFROM)        BUMP FOR NEXT MOVE       Y02027 48650000
         LA    RTO,MAXI(RTO)            BUMP FOR NEXT MOVE       Y02027 48720000
         B     TMLOOP                   GO MOVE MORE DATA        Y02027 48790000
         SPACE 1                                                        48860000
TLAST    EQU   *                                                 Y02027 48930000
         LTR   RCOUNT,RCOUNT            MORE DATA TO BE MOVED    Y02027 49000000
         BZR   RETURN                   BRANCH IF NO MORE DATA   Y02027 49070000
         BCTR  RCOUNT,RZERO             DECREMENT FOR EXECUTE    Y02027 49140000
         EX    RCOUNT,MOVER             MOVE LAST OF DATA        Y02027 49210000
         BR    RETURN                   RETURN                   Y02027 49280000
         SPACE 2                                                        49350000
CHECKOFF EQU   *                                                 Y02027 49420000
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 49490000
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 49560000
         SR    RCOUNT,RCOUNT            CLEAR REGISTER           Y02027 49630000
         SR    RWORK7,RWORK7            CLEAR REGISTER           Y02027 49700000
         IC    RWORK7,TRMOPNO           PICK UP NUMBER OF OFFSETSY02027 49770000
         L     RWORK,AVTOPTPT           ADDRESS OF OPTION TABLE  Y02027 49840000
         L     RWORK,FOUR(,RWORK)       OPT CHARACTERISTICS TBL  Y02027 49910000
         LA    RPARM,TRMOPT             START OF OPTION OFFSETS  Y02027 49980000
LOOPOFF  EQU   *                                                 Y02027 50050000
         CLI   ZERO(RPARM),AVTEFF       IS THIS OFFSET USED      Y02027 50120000
         BE    BUMPOFF                  BRANCH IF NO             Y02027 50190000
         IC    RTEMP,ZERO(RWORK)        PICK UP LENGTH-1 FOR     Y02027 50260000
*                                       THIS OFFSET              Y02027 50330000
         IC    RENTRY,ZERO(RPARM)       SAVE LAST USED OFFSET    Y02027 50400000
BUMPOFF  EQU   *                                                 Y02027 50470000
         LA    RPARM,ONE(RPARM)         BUMP OFFSET POINTER      Y02027 50540000
         LA    RWORK,CHARLNTH(,RWORK)   BUMP TO NEXT OPTION      Y02027 50610000
*                                       CHARACTERISTICS FIELD    Y02027 50680000
         BCT   RWORK7,LOOPOFF           CONTINUE CHECKING OR IF  Y02027 50750000
*                                       FINISHED FALL THROUGH    Y02027 50820000
         SPACE 1                                                        50890000
* TOTAL OPTION FIELD LENGTH CAN BE DERIVED FROM VALUE OF THE   * Y02027 50960000
* LAST USED OFFSET + ADJUSTED LENGTH OF THE ENTRY PTD'D TO BY  * Y02027 51030000
* THAT OFFSET.                                                 * Y02027 51100000
         SPACE 1                                                        51170000
         LA    RCOUNT,ONE(RTEMP,RENTRY) GET OPT FIELD LENGTH     Y02027 51240000
         BR    RETURN                   RETURN TO CALLER         Y02027 51310000
         SPACE 2                                                 Y02027 51380000
*****************************************************************Y02027 51450000
* THIS CODE GETS THE TOTAL NUMBER OF DEVICE DEPENDENT FIELDS    *Y02027 51520000
* USED INTO RWORK.  AT ENTRY, RWORK7 POINTS TO THE BEGINNING OF *Y02027 51590000
* THE DEVICE DEPENDENT FIELDS.  AT EXIT, RCOUNT = LENGTH OF DD  *Y02027 51660000
* FIELDS.                                                       *Y02027 51730000
*****************************************************************Y02027 51800000
         SPACE 1                                                        51870000
DDCOUNT  EQU   *                                                 Y02027 51940000
         SR    RWORK,RWORK              CLEAR WORK REGISTER      Y02027 52010000
         SR    RPARM,RPARM              CLEAR WORK REGISTER      Y02027 52080000
         SR    RCOUNT,RCOUNT            CLEAR WORK REGISTER      Y02027 52150000
SHIFT    EQU   *                                                 Y02027 52220000
         SRDL  RZERO,ONE                MOVE 1 BIT FOR CHECK     Y02027 52290000
         SRL   RPARM,BITS31             MAKE REG = ONE OR ZERO   Y02027 52360000
         AR    RWORK,RPARM              BUMP DD COUNTER          Y02027 52430000
         LTR   RZERO,RZERO              ALL BITS CHECKED         Y02027 52500000
         BNZ   SHIFT                    BRANCH IF NO             Y02027 52570000
         SR    RPARM,RPARM              CLEAR REGISTER           Y02027 52640000
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 52710000
DDLOOP   EQU   *                                                 Y02027 52780000
         IC    RPARM,ZERO(RWORK7)       PICK UP DD FIELD LENGTH  Y02027 52850000
         LA    RCOUNT,ONE(RPARM,RCOUNT) UPDATE DD FIELD LENGTH   Y02027 52920000
         LA    RWORK7,ONE(RPARM,RWORK7) BUMP TO NEXT DD FIELD    Y02027 52990000
         BCT   RWORK,DDLOOP             CHECK NEXT FIELD OR      Y02027 53060000
         BR    RETURN                   RETURN TO CALLER         Y02027 53130000
         SPACE 2                                                 Y02027 53200000
**************************************************************** Y02027 53270000
*            THIS CODE HANDLES THE QCOPY FUNCTION              * Y02027 53340000
**************************************************************** Y02027 53410000
RQCB     EQU   RWORK                    QCB BASE REGISTER        Y02027 53480000
         USING IEDQQCB,RQCB             QCB ADDRESSABILITY       Y02027 53550000
         USING IEDQTNTD,RFROM           TNT ADDRESSABILITY       Y02027 53620000
         SPACE 1                                                        53690000
QLIMIT   EQU   *                                                 Y02027 53760000
         L     RFROM,AVTRNMPT           GET TNT ADDRESS          Y02027 53830000
         CLI   AIBNAME,BLANK            WAS NAME FIELD BLANK     Y02027 53900000
         BNE   TRMOFST2                 NO, BRANCH TO GET TERM   Y02027 53970000
*                                       INDEX & ENTRY ADDRESS    Y02027 54040000
         SR    RPARM,RPARM              CLEAR REGISTER           Y02027 54110000
         B     NAMEOK3                  CONTINUE PROCESSING      Y02027 54180000
QCOPY    EQU   *                                                 Y02027 54250000
         CLC   AIBLIMIT(2),AVTFZERO     LIMIT FUNCTION           Y02027 54320000
         BE    REGQCOPY                 NO, BRANCH               Y02027 54390000
         LH    RPARM,AIBTNDX            PICK UP TERM OFFSET      Y02027 54460000
NAMEOK3  EQU   *                                                 Y02027 54530000
         LA    RPARM,ONE(,RPARM)        INCREMENT TERM INDEX     Y02027 54600000
         LA    RENTRY,LAST              SET POSS COMP CODE       Y02027 54670000
         CH    RPARM,TNTLEN             HAVE WE FINISHED ITERA-  Y02027 54740000
*                                       TIVE PROCESSING          Y02027 54810000
         BH    POSTAPP                  YES, BRANCH              Y02027 54880000
         SPACE 1                                                        54950000
         LR    RWORK7,RPARM             SAVE TERMINAL INDEX      Y02027 55020000
         L     RENTRY,AVTRNMPT          ADR OF CONVERSION LOGIC  Y02027 55090000
         BALR  RETURN,RENTRY            GO GET TERM ENTRY ADR    Y02027 55160000
         LR    RTERM,RPARM              SET TERM ENTRY BASE      Y02027 55230000
         LR    RPARM,RWORK7             RESTORE TERM INDEX       Y02027 55300000
         SPACE 1                                                        55370000
         TM    TRMSTATE,TRMLIST         LIST ENTRY               Y02027 55440000
         BO    NAMEOK3                  BRANCH IF YES TO CHECK   Y02027 55510000
*                                       NEXT ENTRY               Y02027 55580000
         TM    TRMDSORG,TRMLGB          LINE GRP ENTRY           Y02027 55650000
         BO    NAMEOK3                  YES - SKIP               Y02027 55720000
         CLC   TRMDESTQ(THREE),AVTFZERO DOES TERM HAVE DEST QCB  Y02027 55790000
         BE    NAMEOK3                  BRANCH IF NO             Y02027 55860000
         SR    RQCB,RQCB                CLEAR REGISTER           Y02027 55930000
         ICM   RQCB,AD,TRMDESTQ         GET QCB ADDRESS          Y02027 56000000
         TM    QCBDSFLG,QCBDRQQ         CONC DATA READY Q        Y02027 56070000
         BO    NAMEOK3                  BRANCH IF YES            Y02027 56140000
         CLC   AIBLIMIT,QCBMSGCT        DOES THIS QUEUE HAVE AT  Y02027 56210000
*                                       LEAST THE NUMBER OF      Y02027 56280000
*                                       MSGS SPECIFIED BY LIMIT  Y02027 56350000
         BH    NAMEOK3                  BRANCH IF NO             Y02027 56420000
         SPACE 1                                                        56490000
NAMEOK5  EQU   *                                                 Y02027 56560000
         SR    RCOUNT,RCOUNT            CLEAR COUNT REGISTER     Y02027 56630000
         IC    RCOUNT,TNTENLEN          GET MAX ENTRY LENGTH     Y02027 56700000
         LA    RCOUNT,THREE(,RCOUNT)    INCREMENT FOR ADDRESS    Y02027 56770000
         LR    RTEMP,RPARM              GET OFFSET               Y02027 56840000
         BCTR  RTEMP,RZERO              DECREMENT                Y02027 56910000
         MR    RTEMP,RTEMP              OFFSET TIMES LENGTH      Y02027 56980000
         LA    RTEMP,TNTFIRST           GET 1ST ENTRY ADDRESS    Y02027 57050000
         LA    RTEMP,ZERO(RCOUNT,RTEMP) BUMP TO THIS ENTRY       Y02027 57120000
         SR    RCOUNT,RCOUNT            CLEAR LENGTH REGISTER    Y02027 57190000
         IC    RCOUNT,TNTENLEN          GET MAXIMUM LENGTH       Y02027 57260000
         STC   RCOUNT,AIBQLMNA          SAVE LENGTH IN AIB       Y02027 57330000
         BCTR  RCOUNT,RZERO             DECREMENT FOR EXECUTE    Y02027 57400000
         LA    RTO,AIBNAME              RECEIVING AREA IN AIB    Y02027 57470000
         EX    RCOUNT,MOVE              MOVE TERM NAME TO AIB    Y02027 57540000
         B     COMP1                    PROCESS REST OF QCB      Y02027 57610000
         SPACE 2                                                 Y02027 57680000
REGQCOPY EQU   *                                                 Y02027 57750000
         TM    TRMSTATE,TRMLIST         LIST TERM ENTRY          Y02027 57820000
         LA    RENTRY,FOUR              SET POSS ERROR CODE      Y02027 57890000
         BO    POSTAPP                  BRANCH IF  YES           Y02027 57960000
         SPACE 1                                                        58030000
         CLC   TRMDESTQ(THREE),AVTFZERO DOES TERM HAVE DEST QCB  Y02027 58100000
         BZ    POSTAPP                  NO, BRANCH                      58170000
         SR    RQCB,RQCB                CLEAR REGISTER           Y02027 58240000
         ICM   RQCB,AD,TRMDESTQ         SET QCB POINTER          Y02027 58310000
COMP1    EQU   *                                                 Y02027 58380000
         LA    RWORK7,QCBMSIZE          INIT COUNT TO SIZE OF    Y02027 58450000
*                                       MASTER QCB               Y02027 58520000
         LA    RTEMP,QCBMEND            ADDR OF 1ST PRIORITY QCB Y02027 58590000
LOOPX    EQU   *                                                 Y02027 58660000
         LA    RWORK7,QCBPSIZE(,RWORK7) ADD 1 PRIORITY LEVEL QCB Y02027 58730000
         CLI   QCBPRIPQ-IEDQPQCB(RTEMP),ZERO  ANOTHER PRIORITY   Y02027 58800000
         BE    MVCL                     BRANCH IF NO             Y02027 58870000
         LA    RTEMP,QCBPSIZE(,RTEMP)   NEXT PRIORITY QCB        Y02027 58940000
         B     LOOPX                    GET NEXT QCB             Y02027 59010000
MVCL     EQU   *                                                 Y02027 59080000
         LA    RTO,AIBDATA              RECEIVING AREA PTR       Y02027 59150000
         LR    RTERM,RWORK7             SET OPERAND 1 COUNT      Y02027 59220000
         STH   RWORK7,AIBCOUNT          SAVE BYTE COUNT IN AIB   Y02027 59290000
         C     RWORK7,AIBXMLST          CHECK FOR END OF AIB     Y02027 59360000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 59430000
         MVCL  RTO,RQCB                 MOVE QCB TO AIB          Y02027 59500000
         B     GOODEXIT                 PREPARE TO EXIT          Y02027 59570000
         SPACE 1                                                        59640000
MOVE     MVC   ZERO(ONE,RTO),ZERO(RTEMP)    MOVE TERM NAME       Y02027 59710000
         DROP  RFROM                    FREE REGISTER            Y02027 59780000
         SPACE 2                                                        59850000
*****************************************************************Y02027 59920000
*                  THIS CODE HANDLES THE ICOPY FUNCTION          Y02027 59990000
*****************************************************************Y02027 60060000
         SPACE 1                                                        60130000
CHKICOPY EQU   *                                                 Y02027 60200000
         SPACE 1                                                        60270000
         USING IEDQTCB,RTEMP            TCB ADDRESSABILITY       Y02027 60340000
         USING IEDQTIOT,RENTRY          TIOT ADDRESSABILITY      Y02027 60410000
         USING IHADCB,RWORK7            DCB ADDRESSABILITY       Y02027 60480000
         USING DEBNMSUB,RFROM           DEB ADDRESSABILITY       Y02027 60550000
         SPACE 1                                                        60620000
         CLI   AIBCOMCD,AIBICOPY        ICOPY FUNCTION           Y02027 60690000
         BE    ICPYCONT                 YES, CONTINUE ICOPY    @OZ09941 60760000
         CLI   AIBCOMCD,AIBICPYX        EXTENDED ICOPY         @OZ09941 60830000
         BNE   TPDATE                   NO, BRANCH             @OZ09941 60900000
ICPYCONT EQU   *                                               @OZ09941 60970000
         L     RTEMP,AVTTCB             ADDRESS OF MCP'S TCB     Y02027 61040000
         L     RENTRY,TCBTIO            ADDRESS OF MCP'S TIOT    Y02027 61110000
         SR    RWORK7,RWORK7            CLEAR REGISTER           Y02027 61180000
         SR    RFROM,RFROM              CLEAR REGISTER           Y02027 61250000
         ICM   RFROM,AD,TCBDEB+ONE      ADDRESS OF FIRST DEB     Y02027 61320000
         BZ    TRMOFST2                 GO CHECK TERMINAL      @Z30X8RB 61390000
*                                       NAME TABLE FOR VTAM    @Z30X8RB 61460000
*                                       LINE GROUP BLOCK       @Z30X8RB 61530000
         SPACE 1                                                        61600000
ILOOP    EQU   *                                                 Y02027 61670000
         ICM   RWORK7,AD,DEBDCBAD+ONE   ADDR OF DATA CONTROL BLK Y02027 61740000
         CLI   DCBDSORG+ONE,TCAMLG      TCAM LINE GROUP DCB      Y02027 61810000
         BE    LGDCB                    BRANCH IF YES            Y02027 61880000
NEXTDEB  EQU   *                                                 Y02027 61950000
         ICM   RFROM,AD,DEBDEBAD+ONE    ADDRESS OF NEXT DEB      Y02027 62020000
         BNZ   ILOOP                    BRANCH TO CHECK NEXT OR  Y02027 62090000
         B     TRMOFST2                 CHECK FOR VTAM LGB     @Z30X8RB 62160000
         SPACE 1                                                        62230000
LGDCB    EQU   *                                                 Y02027 62300000
         LR    RCOUNT,RENTRY            SAVE TIOT PTR            Y02027 62370000
         AH    RCOUNT,DCBTIOT           DD ENTRY FOR THIS DCB    Y02027 62440000
         CLC   TIOEDDNM-IEDQTIOT(8,RCOUNT),AIBNAME  COMPARE FOR  Y02027 62510000
*                                       MATCHING DDNAMES         Y02027 62580000
         BNE   NEXTDEB                  GO CHECK NEXT DEB        Y02027 62650000
         SPACE 1                                                        62720000
         CLI   AIBFLAG2,ZERO            SPECIFIED RLN = 0        Y02027 62790000
         BE    INVALRLN                 BRANCH IF YES            Y02027 62860000
         CLC   AIBFLAG2(ONE),DEBNMEXT   SPECIFIED RLN EXCEED TOT Y02027 62930000
*                                       LINES IN THIS LINE GROUP Y02027 63000000
         BNH   ILIST                    BRANCH IF NO             Y02027 63070000
INVALRLN EQU   *                                                 Y02027 63140000
         LA    RENTRY,INVRLN            SET ERROR RETURN CODE    Y02027 63210000
         B     POSTAPP                  PREPARE TO EXIT          Y02027 63280000
         SPACE 1                                                        63350000
INVALDD  EQU   *                                                 Y02027 63420000
         LA    RENTRY,INVDDN            SET ERROR RETURN CODE    Y02027 63490000
         B     POSTAPP                  PREPARE TO EXIT          Y02027 63560000
         DROP  RTEMP                    FREE                     Y02027 63630000
         DROP  RENTRY                   REGISTERS                Y02027 63700000
*                                                              * Y02027 63770000
*        IF DDNAME NOT FOUND, TRMOFST SETS RETURN CODE         * Y02027 63840000
*        AND EXITS. ELSE, RETURN WITH ENTRY ADDR IN RTERM      * Y02027 63910000
*                                                              * Y02027 63980000
ICOPYRN  EQU   *                                                 Y02027 64050000
         LR    RTERM,RONE               SET TTE PTR            @G36XRRU 64330000
         S     RTERM,PREFIXL            BACK UP TO NEG PREFIX  @G36XRRU 64400000
         USING IEDNTRM,RTERM          BACK UP DSECT            @G36XRRU 64470000
         CLI   TRMTYPE,TRMGRP      IS TTE AN LGB               @G36XRRU 64540000
         BNE   INVALDD             BRANCH ERR IF NOT           @G36XRRU 64610000
         SR    RONE,RONE                CLEAR TO GET SUBST PTR @G36XRRU 64680000
         ICM   RONE,HALFWORD,TRMSUBST PICK UP SUBSTR POINTER   @G36XRRU 64750000
         LR    RCOUNT,RONE              GET TTCIN FOR CONVERT  @G36XRRU 64820000
         BNZ   ISUBSOK             BRANCH ON NONZERO           @G36XRRU 64890000
         LA    RENTRY,INVSUBST     INDICATE SUBSTR ERROR       @G36XRRU 64960000
         B     EXIT                AND GET OUT                 @G36XRRU 65030000
ISUBSOK  L     RENTRY,AVTRNMPT     GET CONVERT RTNE            @G36XRRU 65100000
         BALR  RETURN,RENTRY       GET TTE ADDRESS             @G36XRRU 65170000
         LR    RTERM,RONE          SET TTE DSECT REG           @G36XRRU 65240000
         S     RTERM,PREFIXL       BACK UP TO TTE DSECT        @G36XRRU 65310000
         CLI   TRMTYPE,TRMGRP      IS THIS AN LGB              @G36XRRU 65380000
         BNE   IOKTOGO             LGB AT THIS POINT IS AN     @G36XRRU 65450000
*                                  ERROR IN RLN                @G36XRRU 65520000
         LA    RENTRY,INVRLN       SET INV RLN                 @G36XRRU 65590000
         B     EXIT                     GET OUT                @G36XRRU 65660000
IOKTOGO  ICM   RONE,AD,TRMDESTQ    GET QCB ADDRESS             @G36XRRU 65730000
         CLC   QCBRELLN-IEDQQCB(ONE,RONE),AIBFLAG2  IS THIS THE@G36XRRU 65800000
*                                  RLN USER WANTED             @G36XRRU 65870000
         BE    IRLNFND        YES BRANCH                       @G36XRRU 65940000
         ICM   RONE,HALFWORD,TRMCOHTG  NO GET NEXT LINE        @G36XRRU 66010000
         LR    RCOUNT,RONE    SAVE TNT OFFSET                  @G36XRRU 66080000
         B     ISUBSOK        GO CHECK IT OUT                  @G36XRRU 66150000
IRLNFND  EQU   *              RLN  FOUND SET UP CIB            @G36XRRU 66220000
         CLI   TRMTYPE,TRMSDLC IS THIS A SNA LINE              @G36XRRU 66290000
         BNE   NOTSNA         NO, BRANCH                       @G36XRRU 66360000
         LA    RENTRY,SNAERR  SET ERROR FOR 'ICOPY INVALID     @G36XRRU 66430000
*                             FOR SNA'                         @G36XRRU 66500000
EXIT     EQU   *                                               @G36XRRU 66570000
         L     RAIB,OPCCOPCE            OPCE ADDRESS           @G36XRRU 66640000
         L     RAIB,OCCIB-IEDQOPCE(RAIB) GET CIB ADDRESS       @G36XRRU 66710000
         LA    RWORK,AIBKEY-IEDQAIB     OFFSET TO AIB          @G36XRRU 66780000
         SLR   RAIB,RWORK               POINT TO AIB           @G36XRRU 66850000
         B     POSTAPP                  EXIT                   @G36XRRU 66920000
NOTSNA   EQU   *                                               @G36XRRU 66990000
*                                                              @ZM46776 67000000
*  GO TO 3705 SERVICE RTN TO COPY ILIST INFORMATION INTO AIB   @ZM46776 67010000
*                                                              @ZM46776 67020000
         MVC   AIBLIMIT(ONE),AIBFLAG2   SAVE RLN               @ZM46776 67030000
         MVC   AIBLIMIT+ONE(ONE),AIBCOMCD   AND COMMAND CODE   @ZM46776 67040000
         LA    RTO,AIBDATA              GET RECIPIENT AREA PTR @ZM46776 67050000
         ST    RTO,AIBRNTO              SAVE FOR SERVICE RTN   @ZM46776 67060000
         STH   RCOUNT,AIBTNDX           SAVE LINE TTCIN        @ZM46776 67070000
         XC    AIBCOMCD,AIBCOMCD        CLEAR FIELD            @ZM46776 67080000
         MVI   AIBFLAG1,AIBENT02        SET SERVICE RTN ENTRY &@ZM46776 67090000
         MVI   AIBFLAG2,AIBRES04        RESPONSE CODES         @ZM46776 67100000
         BAL   RETURN,EXITT0            GO TO 3705 SERVICE RTN @ZM46776 67110000
         SPACE 1                                               @ZM46776 67120000
ICOPYRN2 EQU   *                                               @ZM46776 67130000
         MVC   AIBCOMCD(ONE),AIBLIMIT+ONE RESTORE COMMAND CODE @ZM46776 67140000
         MVC   AIBFLAG2(ONE),AIBLIMIT   AND RLN                @ZM46776 67150000
         SR    RENTRY,RENTRY            CLEAR REGISTER         @ZM46776 67160000
         ICM   RENTRY,BY3,AIBOPRC       GET RETURN CODE        @ZM46776 67170000
         BNZ   POSTAPP                  BRANCH IF ERROR        @ZM46776 67180000
         L     RCOUNT,AIBRNFRO          PICK UP LIST END ADDR  @ZM46776 67190000
*                                       DATA MOVED BY IGCT210D @ZM46776 67200000
         LA    RCOUNT,ONE(,RCOUNT)      BUMP BY ONE            @ZM46776 67210000
         LA    RTO,AIBDATA              BEGINNING OF ILIST     @ZM46776 67220000
         SR    RCOUNT,RTO               GET BYTE COUNT AND     @ZM46776 67230000
         STH   RCOUNT,AIBCOUNT          SAVE FOR MOVE TO USER  @ZM46776 67240000
*                                       WORKAREA               @ZM46776 67250000
         B     GOODEXIT                 PREPARE TO EXIT        @ZM46776 67260000
         SPACE                                                          67270000
ILIST    EQU   *                                                 Y02027 67970000
         SR    RPARM,RPARM              WORK                     Y02027 68040000
         IC    RPARM,AIBFLAG2           PICK UP RLN              Y02027 68110000
         BCTR  RPARM,RZERO              DECREMENT RLN            Y02027 68180000
         SLL   RPARM,TWO                MULTIPLY RLN BY 4        Y02027 68250000
         L     RTO,DCBINVLI(RPARM)      GET INVITATION LIST ADDR Y02027 68320000
ILIST2   EQU   *                                               @Z30X8RB 68390000
         SR    RTEMP,RTEMP              CLEAR WORK REG         @Z30X8RB 68460000
         SR    RCOUNT,RCOUNT            CLEAR WORK REG         @Z30X8RB 68530000
         LA    RENTRY,NOLIST            SET CODE FOR NO LIST     X03039 68600000
         LTR   RTO,RTO                  LIST ADDRESS ZERO        X03039 68670000
         BZ    POSTAPP                  YES, MUST BE VTAM        X03039 68740000
         IC    RTEMP,ZERO(,RTO)         NO. ENTRIES IN LIST      Y02027 68810000
         IC    RCOUNT,TWO(,RTO)         SIZE OF ONE ENTRY        Y02027 68880000
         MR    RTEMP,RTEMP              NO. OF ENTRIES TIMES     Y02027 68950000
*                                       SIZE = SIZE OF LIST      Y02027 69020000
         LA    RCOUNT,ILSTCTWD(,RCOUNT) ADD SIZE OF CONTROL WORD Y02027 69090000
         LA    RTEMP,AIBDATA            RECIPIENT AREA PTR       Y02027 69160000
         TM    ILISTFLG(RTO),BSC        IS IT BYSYNCH            Y02027 69230000
         BNO   ICOPYMV                  NO, BRANCH               Y02027 69300000
         LA    RCOUNT,ONE(,RCOUNT)      BUMP TO REAL END OF LIST Y02027 69370000
         SPACE 1                                                        69440000
ICOPYMV  EQU   *                                                 Y02027 69510000
         STH   RCOUNT,AIBCOUNT          SAVE BYTE COUNT          Y02027 69580000
         C     RCOUNT,AIBXMLST          COMPARE FOR END OF AIB   Y02027 69650000
         BH    SIZERR                   BR IF AIB EXCEEDED       Y02027 69720000
         LR    RZERO,RTO                SAVE INVITATION        @OZ09941 69790000
*                                       LIST ADDRESS           @OZ09941 69860000
         LH    RILIST,AIBCOUNT          KEEP MOVE COUNTS SAME  @OZ26929 69890082
         MVCL  RTEMP,RTO                MOVE INVITATION LIST     Y02027 69930000
*                                       INTO AIB                 Y02027 70000000
         CLI   AIBCOMCD,AIBICPYX        EXTENDED ICOPY         @OZ09941 70070000
         BNE   GOODEXIT                 NO, PREPARE TO EXIT    @OZ09941 70140000
         LR    RTO,RZERO                RESTORE INVITATION     @OZ09941 70210000
*                                       LIST ADDRESS           @OZ09941 70280000
         AR    RTEMP,RCOUNT             UPDATE AIB POINTER     @OZ09941 70350000
         SR    RCOUNT,RCOUNT            CLEAR REGISTER         @OZ09941 70420000
         IC    RCOUNT,ZERO(,RTO)        NO. ENTRIES IN LIST    @OZ09941 70490000
         LR    RTERM,RCOUNT             LOAD REG FOR LOOP COUNT@OZ09941 70560000
         LTR   RTERM,RTERM              ARE THERE ANY ENTRIES  @OZ30765 70580082
         BZ    GOODEXIT                 NO, BRANCH             @OZ30765 70600082
         SLL   RCOUNT,ONE               MULTIPLY BY TWO FOR TNT@OZ09941 70630000
*                                       OFFSET ENTRIES         @OZ09941 70700000
         AH    RCOUNT,AIBCOUNT          ADD NUMBER OF BYTES    @OZ09941 70770000
*                                       PREVIOUSLY MOVED       @OZ09941 70840000
         LA    RENTRY,AIBSZER2          SET POSS ERROR CODE    @OZ09941 70910000
         C     RCOUNT,AIBXMLST          COMPARE FOR END OF AIB @OZ09941 70980000
         BH    POSTAPP                  BRANCH IF AIB EXCEEDED @OZ09941 71050000
         STH   RCOUNT,AIBCOUNT          SAVE BYTE COUNT        @OZ09941 71120000
CLOOP    EQU   *                                               @OZ09941 71190000
         SH    RTO,AVTHA2               BACKUP INVITATION LIST @OZ09941 71260000
*                                       POINTER TO NEXT TNT    @OZ09941 71330000
*                                       INDEX                  @OZ09941 71400000
         MVC   ZERO(TWO,RTEMP),ZERO(RTO) STORE TNT INDEX       @OZ09941 71470000
         LA    RTEMP,TWO(,RTEMP)        UPDATE AIB POINTER     @OZ09941 71540000
         BCT   RTERM,CLOOP              LOOP UNTIL ALL TNT     @OZ09941 71610000
*                                       INDEX HAVE BEEN MOVED  @OZ09941 71680000
         B     GOODEXIT                 PREPARE TO EXIT        @OZ09941 71750000
         DROP  RWORK7                   FREE                     Y02027 71820000
         DROP  RFROM                    REGISTERS                Y02027 71890000
         SPACE 1                                                        71960000
TPDATE   EQU   *                                                 Y02027 72030000
**************************************************************** Y02027 72100000
*        THIS SUBROUTINE PROCESSES THE TPDATE MACRO FUNCTION   * Y02027 72170000
*****************************************************************Y02027 72240000
         SPACE 1                                                        72310000
         TM    AIBCOMCD,AIBTPDAT        TPDATE FUNCTION          Y02027 72380000
         BNO   MCOUNT                   NO, BRANCH               Y02027 72450000
         SPACE 1                                                        72520000
         USING IEDQPEWA,RFROM           PEWA ADDRESSABILITY      Y02027 72590000
         LM    RWORK7,RFROM,AIBNAME     GET DTS AREA ADDRESS AND Y02027 72660000
*                                       PEWA PTR                 Y02027 72730000
         TM    AIBFLAG2,AIBDTS          DTSAREA SPECFIED         Y02027 72800000
         BZ    CHKDELET                 NO, BRANCH               Y02027 72870000
         STCM  RWORK7,AD,PEWADTSA       STORE PTR IN THE PEWA    Y02027 72940000
         SPACE 1                                                        73010000
CHKDELET EQU   *                                                 Y02027 73080000
         NI    PEWAOPT2,AVTEFF-AIBDEL   RESET DELETE BIT         Y02027 73150000
         TM    AIBFLAG2,AIBDEL          DELETE = YES SPECIFIED   Y02027 73220000
         BZ    RECDELM                  NO BRANCH                Y02027 73290000
         OI    PEWAOPT2,AIBDEL          SET DELETE BIT           Y02027 73360000
         SPACE 1                                                        73430000
RECDELM  EQU   *                                                 Y02027 73500000
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 73570000
         TM    AIBFLAG2,AIBRECDL        RECORD DELIMITER         Y02027 73640000
*                                       SPECIFIED                Y02027 73710000
         BO    GETRCDLM                 YES, BRANCH              Y02027 73780000
         STC   RENTRY,AIBFLAG2          ZERO DELIMITER INDICATOR Y02027 73850000
         B     GOODEXIT                 FOR RETURN AND EXIT      Y02027 73920000
GETRCDLM EQU   *                                                 Y02027 73990000
         L     RWORK7,PEWAPROC          GET PTR TO PROCESS ENTRY Y02027 74060000
         IC    RENTRY,TRMCHCIN-IEDQTRM(,RWORK7)  GET REC DEL &   Y02027 74130000
         STC   RENTRY,AIBFLAG2          PUT IT IN AIB            Y02027 74200000
         B     GOODEXIT                 PREPARE TO EXIT          Y02027 74270000
         SPACE 2                                                        74340000
**************************************************************** Y02027 74410000
*        THIS CODE HANDLES THE MCOUNT FUNCTION                 * Y02027 74480000
**************************************************************** Y02027 74550000
         SPACE 1                                                        74620000
MCOUNT   EQU   *                                                 Y02027 74690000
         L     RFROM,AIBNAME            GET PTR TO PEWA          Y02027 74760000
         L     RWORK7,PEWAPROC          AND PTR TO PROCESS ENT   Y02027 74830000
         ICM   RWORK7,AD,TRMDESTQ-IEDQTRM(RWORK7)  AND DEST QCB  Y02027 74900000
         USING IEDQQCB,RWORK7           QCB ADDRESSABILITY       Y02027 74970000
         SPACE 1                                                        75040000
         SR    RCOUNT,RCOUNT            CLEAR REGISTER           Y02027 75110000
         CLC   EOMSAVE+ONE(THREE),AVTFZERO   MSG PROCESSED BUT   Y02027 75180000
*                                       SERVICED                 Y02027 75250000
         BE    NOEOM                    NO, BRANCH               Y02027 75320000
         LA    RCOUNT,ONE               ADD 1 TO COUNT           Y02027 75390000
NOEOM    EQU   *                                                 Y02027 75460000
         CLC   PERAQCB+ONE(3),AVTDELAD+ONE  IS READ AHEAD QUEUE  Y02027 75530000
*                                       EMPTY                    Y02027 75600000
         BE    NONREAD                  BR IF YES                Y02027 75670000
         SR    RWORK,RWORK              CLEAR REGISTER           Y02027 75740000
         ICM   RWORK,AD,PERAQCB+ONE     GET PTR TO BUFFER        Y02027 75810000
         USING IEDQPRF,RWORK            BUF PREFIX ADDRESSABLTY  Y02027 75880000
         TM    PRFSTAT1,PRFDUPLN        RETRIEVE BUFFER        @SA71116 75950000
         BO    NONREAD                  YES, IGNORE RETRIEVE   @SA71116 76020000
         TM    PRFSTAT1,PRFNHDRN        IS IT A HEADER           Y02027 76090000
         BNO   NONREAD                  YES, BRANCH              Y02027 76160000
         DROP  RWORK                    FREE REG                 Y02027 76230000
         SPACE 1                                                        76300000
NOTALL   EQU   *                                                 Y02027 76370000
         LA    RCOUNT,ONE(,RCOUNT)      BUMP COUNTER BY ONE      Y02027 76440000
NONREAD  EQU   *                                                 Y02027 76510000
         SR    RWORK,RWORK              CLEAR REGISTER           Y02027 76580000
         ICM   RWORK,HALFWORD,QCBMSGCT  PICK UP QCB MSG COUNT    Y02027 76650000
         SR    RWORK,RCOUNT             ADJUST TOTAL             Y02027 76720000
         DROP  RTERM                                                    76721010
         USING IEDQPRF,RPRF             BUF PREFIX ADDR        @OZ19771 76722010
         BZ    MEXIT                    IF MCOUNT ZERO, STORE  @OZ19771 76723010
*                                        AND RETURN            @OZ19771 76724010
         L     RTEMP,AVTDELAD           DUMMY ELEMENT ADDRESS  @OZ19771 76725010
         LA    RDEB,AVTDSIOB            DISK I/O QCB ADDRESS   @OZ19771 76726010
         LA    RPRF,AVTNCPBQ-FOUR       PREPARE TO SCAN        @OZ19771 76727010
*                                       NCPB QUEUE             @OZ19771 76728010
         TM    QCBDSFLG-IEDQQCB(RQCB),QCBDISK DISK QUEUING     @OZ19771 76729010
         BZ    TESTRQ                   EXIT NOW IF NO         @OZ19771 76730010
QLOOP    EQU   *                                               @OZ19771 76731010
         ICM   RPRF,AD,PRFLINK          GET ELEM ON NCPB QUEUE @OZ19771 76732010
         BZ    TESTRQ                   EXIT IF END OF QUEUE   @OZ19771 76733010
         CR    RPRF,RTEMP               END OF READY QUEUE     @OZ19771 76734010
         BE    MEXIT                    BRANCH IF YES          @OZ19771 76735010
         TM    PRFTIC,EIGHT             IS ELEMENT A BUFFER?   @OZ19771 76736010
         BNO   QLOOP                    BRANCH IF NO           @OZ19771 76737010
         CLM   RQCB,AD,PRFQCBA          BUF ON READY QUEUE     @OZ19771 76738010
*                                        GOING TO DEST QUEUE   @OZ19771 76739010
         BNE   CKLCB                    NO, GO CHECK LCB       @OZ19771 76740010
         TM    PRFSTAT1,PRFCNCLN        CANCEL BUFFER          @OZ19771 76741010
         BO    DECR                     BRANCH IF YES          @OZ19771 76742010
         B     QLOOP                    BRANCH IF NO           @OZ19771 76743010
CKLCB    EQU   *                                               @OZ19771 76744010
         CLC   PRFLCB,PEWALCBA+ONE      BUFFER WAITING FOR A   @OZ19771 76745010
*                                       CPB FOR THIS DEST QUEUE@OZ19771 76746010
         BNE   QLOOP                    BRANCH IF NO           @OZ19771 76747010
         CLM   RDEB,AD,PRFQCBA          BUFF POSTED TO DSK I/O @OZ19771 76748010
         BNE   QLOOP                    BRANCH IF NO           @OZ19771 76749010
DECR     EQU   *                                               @OZ19771 76750010
         BCTR  RWORK,RZERO              DECREMENT MCOUNT       @OZ19771 76751010
*                                       BY ONE TO TAKE         @OZ19771 76752010
*                                       UNSERVICED MESSAGE     @OZ19771 76753010
MEXIT    EQU   *                                               @OZ19771 76754010
         STH   RWORK,AIBCOUNT           SAVE MESSAGE COUNT     @OZ19771 76755010
         B     GOODEXIT                 PREPARE TO LEAVE       @OZ19771 76756010
TESTRQ   EQU   *                                               @OZ19771 76757010
         LA    RPRF,AVTREADY-FOUR       PREPARE TO SCAN READY  @OZ19771 76758010
*                                       QUEUE FOR CANCELLED    @OZ19771 76759010
*                                       BUFFER POSTED TO DISK  @OZ19771 76760010
         B     QLOOP                    START SCAN             @OZ19771 76761010
         DROP  RFROM                                                    76762010
         DROP  RPRF                                                     76763010
         USING IEDQTRM,RTERM            TERMINAL TABLE                  76764010
         EJECT                                                          76765010
SIZERR   EQU   *                                                 Y02027 77070000
         LA    RENTRY,AIBSZERR          SET ERROR CODE           Y02027 77140000
         B     POSTAPP                  PREPARE TO EXIT          Y02027 77210000
         SPACE 1                                                        77280000
EXITT0   EQU   *                                                 Y02027 77350000
         LA    RTEMP,AIBDATA            SET UP PTR TO END OF     Y02027 77420000
         A     RTEMP,AIBXMLST           AIB FOR COMPARISON IN    Y02027 77490000
         ST    RTEMP,AIBQLMNA           VTAM SERVICE ROUTINE   @Z30X8RB 77560000
         ST    RETURN,AIBRNRET          SAVE RETURN ADD IN AIB   Y02027 77630000
         MVC   OPCLDNME+THREE(TWO),XCTLT0    XCTL MOD ID         Y02027 77700000
         B     XCTL                     EXIT TO IGCT010D         Y02027 77770000
GOODEXIT EQU   *                                                 Y02027 77840000
         SR    RENTRY,RENTRY            CLEAR RETURN CD REG      Y02027 77910000
POSTAPP  EQU   *                                                 Y02027 77980000
         STC   RENTRY,AIBOPRC           SET RETURN CODE          Y02027 78050000
         SPACE 1                                                        78120000
*                                                              * Y02027 78190000
*        GO TO IEDQCA TO RETURN UNIT(S) GOTTEN FOR OPCE        * Y02027 78260000
*                                                              * Y02027 78330000
         L     RPARM,OPCCOPCE           PTR TO OP CONTROL ELEMNT Y02027 78400000
         LR    RTO,RAVT                 TCAM AVT PTR IN REG 4    Y02027 78470000
         L     RENTRY,OPCFREBF          ADDR OF FREE UNIT RTN    Y02027 78540000
         BALR  RETURN,RENTRY            GO TO ROUTINE            Y02027 78610000
         SPACE 1                                                        78680000
*****************************************************************Y02027 78750000
* CHECK THE PCB AND ASCB FOR THE WAITING APPLICATION PROGRAM TO *Y02027 78820000
* BE SURE THAT THE APPL PROGRAM IS STILL ACTIVE.  IF NOT ACTIVE,*Y02027 78890000
* BYPASS POSTING THE REQUESTOR'S ECB.                           *Y02027 78960000
*****************************************************************Y02027 79030000
         SPACE 1                                                        79100000
         L     RWORK7,AIBPCBAD          GET APPL PROG PCB        Y02027 79170000
         TM    AIBPCBAD,USEASCB         DO WE HAVE ASCB ADDR     Y02027 79240000
         BO    GOTASCB                  YES, BRANCH              Y02027 79310000
         L     RFROM,PCBPEBAD-IEDQPCB(RWORK7)  AND PEB ADDRESSES Y02027 79380000
         LTR   RFROM,RFROM              HAS APPL PROG CLOSED     Y02027 79450000
         BZ    FREEAIB                  BRANCH IF YES            Y02027 79520000
         USING IEDQPEB,RFROM            PEB ADDRESSABILITY       Y02027 79590000
         L     RWORK7,PEBASCB           GET ASCB PTR             Y02027 79660000
         DROP  RFROM                    HI ORDER BIT IS ON, ASCB Y02027 79730000
         LTR   RWORK7,RWORK7            HAS BEEN INVALIDATED     Y02027 79800000
         BP    GOTASCB                  BR IF REG IS POSITIVE -  Y02027 79870000
*                                       MPP IS STILL ACTIVE      Y02027 79940000
FREEAIB  EQU   *                        MPP HAS CLOSED OR IS IN  Y02027 80010000
*                                       PROCESS OF CLOSING       Y02027 80080000
         MVI   AIBSTATE,AIBFREE         MARK AIB AS FREE         Y02027 80150000
         B     XCTLBK                   EXIT                     Y02027 80220000
         SPACE 1                                                        80290000
GOTASCB  EQU   *                                                 Y02027 80360000
         LA    RWORK,ZERO(RWORK)        CLEAR HI ORDER BYTE      Y02027 80430000
         L     RWORK,AIBECBA            GET ECB TO BE POSTED     Y02027 80500000
         L     RFROM,CVTPTR             GET CVT PTR              Y02027 80570000
         LA    RFROM,CVTBRET-CVTMAP(RFROM)   GET CVT LOCATION    Y02027 80640000
*                                       OF BR 14 INSTRUCTION     Y02027 80710000
         ICM   RFROM,EIGHT,HEX80        FLAG TELLING XMPOST NOT  Y02027 80780000
*                                       TO RESTORE REGISTERS     Y02027 80850000
         STM   RWORK,RFROM,AIBXMLST     SET PARMS IN LIST        Y02027 80920000
         LA    RPARM,AIBXMLST           SET PARM REGISTER        Y02027 80990000
         SR    RZERO,RZERO              CLEAR COMP CODE REG      Y02027 81060000
         POST  ,(0),MF=(E,(1))          POST APPL PROGRAM ECB           81130000
         SPACE 2                                                        81200000
*****************************************************************Y02027 81270000
*                       RETURN TO IGC0010D                      *Y02027 81340000
*****************************************************************Y02027 81410000
         SPACE 1                                                        81480000
XCTLBK   EQU   *                                                        81550000
         NI    OPCSPEC,AVTEFF-OPCFRMCA  BE SURE THAT 'FROM CA'   Y02027 81620000
*                                       FLAG IS OFF              Y02027 81690000
         MVC   OPCLDNME+THREE(TWO),XCTL01    SET MODULE NAME     Y02027 81760000
XCTL     EQU   *                                                 Y02027 81830000
         LR    RPARM,ROPCAVT            PASS OP CONTROL AVT PTR  Y02027 81900000
         XCTL  SF=(E,OPCXCTL)           CALL IGC0010D                   81970000
         EJECT                                                          82040000
*THIS SUBROUTINE DIFFERENTIATES BETWEEN TTE TYPES THAT         @G36XRRU 82110000
*REQUIRE ACCESS THRU NCP TO DEV DEP FIELDS AND THOSE           @G36XRRU 82180000
*TTES THAT DO NOT                                              @G36XRRU 82250000
*THOSE THAT DO ARE  NCP ATTACHED BSC/SS TERMINALS              @G36XRRU 82320000
*                                CTERM                         @G36XRRU 82390000
*                                CLUSTER BSC/SS                @G36XRRU 82460000
*FOR THOSE THAT DO REQUIRE NCP ACCESS EXIT IS TO RETURN+4      @G36XRRU 82530000
*OTHERWISE EXIT IS TO ADDRESS IN RETURN REG.                   @G36XRRU 82600000
         SPACE 3                                                        82670000
TESTTYPE EQU   *                                               @G36XRRU 82740000
         USING IEDQTRM,RTERM       SET TTE ADDRESSABILITY      @G36XRRU 82810000
         TM    TRMSTATE,TRMPREF    NCP RESOURCE                @G36XRRU 82880000
         BZ    ZERO(RETURN)        NO EXIT TO RETURN+0         @G36XRRU 82950000
         TM    TRMSTATE,TRMLINE    IS IT A LINE TTE            @G36XRRU 83020000
         BO    ZERO(RETURN)        YES EXIT TO RETURN+0        @G36XRRU 83090000
*BACK UP TO TTE PREFIX                                         @G36XRRU 83160000
         S     RTERM,PREFIXL       BACK UP REG                 @G36XRRU 83230000
         USING IEDNTRM,RTERM       BACK UP DSECT               @G36XRRU 83300000
         CLI   TRMTYPE,TRMPSNA     BSC/SS TERM                 @G36XRRU 83370000
         BE    TESTTINC            YES                         @G36XRRU 83440000
         CLI   TRMTYPE,TRMCTERM    CTERM                       @G36XRRU 83510000
         BE    TESTTINC            YES                         @G36XRRU 83580000
         CLI   TRMTYPE,TRMCLUST    BSC/SS CLUSTER              @G36XRRU 83650000
         BNE   TSTBTOP             NO                          @G36XRRU 83720000
TESTTINC LA    RETURN,FOUR(RETURN) SET RETURN POINT AT +4      @G36XRRU 83790000
TSTBTOP  A     RTERM,PREFIXL       POINT TO TTE POS PORTION    @G36XRRU 83860000
         USING IEDQTRM,RTERM       RESET DSECT                 @G36XRRU 83930000
         BR    RETURN              EXIT                        @G36XRRU 84000000
         EJECT                                                          84070000
VERBTBL  EQU   *                                                 Y02027 84140000
         DC    X'06',XL2'0'             MCOUNT                   Y02027 84210000
         DC    X'07',XL2'0'             TPDATE                   Y02027 84280000
         DC    X'10',C'Z0'              MCPCLOSE                 Y02027 84350000
         DC    X'11',C'Z0'              MCPCLOSE                 Y02027 84420000
         DC    X'20',XL2'0'             TCHNG                    Y02027 84490000
         DC    X'40',XL2'0'             QCOPY                    Y02027 84560000
         DC    X'49',C'I0'              ICHNG                    Y02027 84630000
         DC    X'50',XL2'0'             ICOPY                    Y02027 84700000
         DC    X'D0',XL2'0'             ICOPY EXTENDED         @OZ09941 84770000
         DC    X'80',XL2'0'             TCOPY                    Y02027 84840000
         DC    X'87',C'R0'              MRELEASE                 Y02027 84910000
         DC    X'FF'                    END OF TABLE             Y02027 84980000
         SPACE 2                                                        85050000
**************************************************************** Y02027 85120000
*                    EXECUTED  INSTRUCTIONS                    * Y02027 85190000
**************************************************************** Y02027 85260000
         SPACE 1                                                        85330000
MOVER    DS    0H                                                Y02027 85400000
         MVC   ZERO(ONE,RTO),ZERO(RFROM)     MOVE DATA           Y02027 85470000
MOVEM    DS    0H                                                Y02027 85540000
         MVC   ZERO(ONE,RTO),TRMOPT     MOVE OPTION OFFSETS      Y02027 85610000
TERMMOVE DS    0H                                              @OZ11203 85680000
         MVC   OPCDOUBL(ZERO),AIBNAME   MOVE TERMNAME          @OZ11203 85750000
         EJECT                                                          85820000
*                                                                     * 85890000
*          CONSTANTS  AND  EQUATES                                    * 85960000
*                                                                     * 86030000
PATCH    DC    8D'0'                    PATCH AREA             @Z30X8RB 86100000
         SPACE 2                                                        86170000
PREFIXL  DC    A(TRMPRFSZ)              LENGTH OF PREFIX TTE   @G36XRRU 86240000
ANDMASK  DC    X'00008000'              BIT MASK FOR TCHNG     @G36XRRU 86310000
R3OFFSET EQU   12                       OFFSET INTO SAVEAREA   @G36XRRU 86380000
R5OFFSET EQU   16                       OFFSET INTO SAVEAREA   @G36XRRU 86450000
R8OFFSET EQU   20                       OFFSET INTO SAVEAREA   @G36XRRU 86520000
R14INDEX EQU   20                       OFFSET INTO SAVEAREA   @G36XRRU 86590000
FULLWORD EQU   15                       NUMBER OF BYTES WANTED @G36XRRU 86660000
LOOPCT   EQU   12                       PASS CTR FOR TCHNG     @G36XRRU 86730000
SRCHSTAT EQU   0              BYTE 0 OF SRCHTBLE IS TRMSTATE   @G36XRRU 86800000
*                             VALUE WITH LOW ORDER BITS OFF    @G36XRRU 86870000
SRCHTYPE EQU   1              BYTE 1 OF SRCHTBLE IS TRMTYPE    @G36XRRU 86940000
SRCHMASK EQU   2              BYTE 2 OF SRCHTBLE IS OFFSET     @G36XRRU 87010000
*                             FROM START OF TCHNG MASK TABLE   @G36XRRU 87080000
*                             ANCHORED AT AVTOPMSK TO MASK     @G36XRRU 87150000
*                             FOR THAT TTE TYPE                @G36XRRU 87220000
SRCHTBLE EQU   *              TABLE TO DETERMINE TCHNG MASK    @G36XRRU 87290000
SPRCNTY  EQU   *                        TPROCESS EQUATE        @G36XRRU 87360000
         DC    X'200012'      TPROCESS                         @G36XRRU 87430000
SRCHTBEL EQU   *-SRCHTBLE               EST. ENTRY LENGTH      @G36XRRU 87500000
SRLSTNTY EQU   *                        LIST ENTRY EQUATE      @G36XRRU 87570000
         DC    X'400010'      TLIST                            @G36XRRU 87640000
         DC    X'600002'      LOG                              @G36XRRU 87710000
         DC    X'800002'      270X/EP DIAL                     @G36XRRU 87780000
         DC    X'90000E'      NCP LINE                         @G36XRRU 87850000
         DC    X'90200E'      NCP BSC/SS LINE                  @G36XRRU 87920000
         DC    X'90210E'      NCP SNA LINE                     @G36XRRU 87990000
         DC    X'100F0C'      NCP                              @G36XRRU 88060000
         DC    X'101806'      PU                               @G36XRRU 88130000
         DC    X'103008'      LU                               @G36XRRU 88200000
         DC    X'104004'      BSC/SS CLUSTER                   @G36XRRU 88270000
         DC    X'104804'      CTERM                            @G36XRRU 88340000
         DC    X'104F04'      PRE SNA                          @G36XRRU 88410000
         DC    X'10FF0A'      SSCP                             @G36XRRU 88480000
         DC    X'000002'       270X DEVICE                     @OY16438 88510000
SRCHEND  EQU   *                                               @G36XRRU 88550000
SRCHMSK  EQU   X'F0'          RESETS LO BITS OF TRMSTATE       @G36XRRU 88620000
SRCHLIM  EQU   (SRCHEND-SRCHTBLE)/SRCHTBEL NO. OF ENTERIES IN  @G36XRRU 88690000
*                                       TABLE                  @G36XRRU 88760000
INVDDN   EQU   X'20'                    INVALID DDNAME                  88830000
BSC      EQU   X'80'                    BSC I-LIST                      88900000
INVRLN   EQU   4                        INVALID REL LINE NUMBER         88970000
NOLIST   EQU   X'24'                    CODE FOR NO LIST         X03039 89040000
MAXI     EQU   256                                                      89110000
FREE     EQU   X'20'                    SVC FREE CODE            Y05330 89180000
HALFWORD EQU   3                                                        89250000
AD       EQU   7                        ADDRESS MASK                    89320000
BY0      EQU   8                                               @G36XRRU 89390000
BY2      EQU   2                                               @G36XRRU 89460000
BY3      EQU   1                                      OFFSET            89530000
ZERO     EQU   0                                                        89600000
ONE      EQU   1                                            LENGTH      89670000
TWO      EQU   2                        FOR                             89740000
FOUR     EQU   4                            PASSWORD                    89810000
SIX      EQU   6                                    SCRAMBLER           89880000
SEVN     EQU   7                                                        89950000
EIGHT    EQU   8                                                        90020000
CHARLNTH EQU   10                       DEVICE CHAR ENTRY LENGTH        90090000
ILSTCTWD EQU   9                        SIZE OF ILIST CONTROL WORD      90160000
ILISTFLG EQU   3                        DISP IN ILIST TO FLAG           90230000
ADRLNGTH EQU   3                        LENGTH OF ADDRESS               90300000
INVSUBST EQU   X'28'                    INVALID SUBST ERROR    @G36XRRU 90370000
SNAERR   EQU   X'24'                    SNA ERROR - ICOPY      @G36XRRU 90440000
*                                       INVALID FOR SNA LINE   @G36XRRU 90510000
         DS    0F                       BOUNDARY ALLIGNMENT    @G36XRRU 90650000
MAX      DC    H'255'                   MASK FOR MOVE COMPARE    X03039 90720000
*                                       FOR MOVE LOOP                   90790000
*                                                                       90860000
XCTL01   DC    C'00'                    MOD ID FOR IGC0010D      Y02027 90930000
WRXCTL   DC    C'07'                    MSG WRITER MOD ID        Y02027 91000000
XCTLT0   DC    C'T0'                    ID FOR MOD IGCT010D      Y02027 91070000
HTWELVE  DC    H'12'                    HW CONSTANT            @ZA00200 91140000
TWELVE   EQU   12                       EQUATE OF 12           @ZA00200 91210000
AIBSZERR EQU   X'18'                    RC = AIB DATA AREA < DATAY02027 91280000
*                                       TO BE COPIED INTO IT     Y02027 91350000
AIBSZER2 EQU   X'28'                    RC = AIB DATA AREA <   @OZ09941 91420000
*                                       DATA TO BE COPIED INTO @OZ09941 91490000
*                                       IT FOR EXTENDED ICOPY  @OZ09941 91560000
BITS31   EQU   31                       MASK FOR SHIFTING        Y02027 91630000
BLANK    EQU   X'40'                                             Y02027 91700000
CCZERO   EQU   8                        MASK FOR BRANCH IF ZEROESY02027 91770000
CNTFLD   EQU   X'2C'                    OFFSET TO COUNT OF BYTES Y02027 91840000
*                                       TO BE MOVED FROM USER'S  Y02027 91910000
*                                       WORK AREA                Y02027 91980000
CODEFF   EQU   X'FF'                    CODE FOR ERROR MSG       Y02027 92050000
INVALTRM EQU   X'20'                    CODE FOR INVALID TERM NA Y02027 92120000
LAST     EQU   X'80'                    CODE INCDICATING END OF  Y02027 92190000
*                                       QCOPY ITERATIVE PROCESS  Y02027 92260000
NOTCA    EQU   2                        CODE USED BY IGC0010D    Y02027 92330000
RECDLM   EQU   X'80'                    FLAG = 'RECDELM=YES'     Y02027 92400000
TCAMLG   EQU   X'40'                    TCAM LINE GRP IDENTIFIER Y02027 92470000
TABEND   EQU   X'FF'                    END OF TABLE MARKER      Y02027 92540000
TABLEN   EQU   3                        SIZE OF ENTRY IN COMMAND Y02027 92610000
*                                       CODE LOOKUP TABLE        Y02027 92680000
THREE    EQU   3                        DISPLACEMENT VALUE       Y02027 92750000
HEX80    DC    X'80'                    FLAG FOR XMPOST          Y02027 92820000
TWENTY   EQU   20                       OFFSET VALUE             Y02027 92890000
RNRETCD  EQU   X'FF'                    FLAG = ENTRY FROM AN     Y02027 92960000
*                                       RN SERVICE ROUTINE       Y02027 93030000
DIALDIG  EQU   X'40'                    MASK FOR DIAL DIGITS     Y02027 93100000
DIGITS   EQU   X'01'                    FLAG = DIAL DIGITS       Y02027 93170000
ADDCHAR  EQU   X'20'                    MASK FOR ADDR CHARACTERS Y02027 93240000
CHARS    EQU   X'02'                    FLAG = ADDRESSING CHARS  Y02027 93310000
USEASCB  EQU   X'80'                    FLAG INDICATING ASCB ADR Y02027 93380000
*                                       IS AVAILABLE - SET BY    Y02027 93450000
*                                       IEDQEB                   Y02027 93520000
         SPACE 3                                                        93590000
         EJECT                                                          93660000
***                 DSECTS                             ***              93730000
         TAVTD                                                          93800000
         EJECT                                                          93870000
         TTRMD                                                          93940000
         EJECT                                                          94010000
         TTNTD                                                          94080000
         TAIBD EXT=(NETWKCTL)                                           94150000
         EJECT                                                          94220000
         SPACE 2                                                        94290000
         TOPCED                                                         94360000
         SPACE 1                                                        94430000
         TPEBD                                                   Y02027 94500000
         SPACE 1                                                        94570000
         TOPCAVTD                                                Y02027 94640000
         EJECT                                                          94710000
         TQCBD                                                          94780000
         EJECT                                                          94850000
         DCBD  DSORG=TX                                                 94920000
         EJECT                                                          94990000
         CVT                                                            95060000
         EJECT                                                          95130000
         TPRIOR                                                         95200000
         EJECT                                                          95270000
         TPCBD                                                          95340000
         TPRFD                                                          95410000
IEDQTIOT DSECT                          TIOT DD ENTRY                   95480000
TIOELNGH DS    XL1                      LENGTH OF DD ENTRY              95550000
TIOESTTA DS    XL1                      STATUS BYTE A                   95620000
TIOERLOC DS    XL2                      ERROR LOCATION                  95690000
TIOEDDNM DS    XL8                      DDNAME                          95760000
         EJECT                                                          95830000
DCT      DSECT                          DEVICE CHARACTERISTICS   X03039 95900000
*                                       TABLE DSECT              X03039 95970000
         DS    CL1                      RESERVED BYTE            X03039 96040000
DCTSTAT1 DS    XL1                      FIRST STATUS BYTE        X03039 96110000
C3270    EQU   X'04'                    3270 DEVICE FLAG         X03039 96180000
DCTSTAT2 DS    XL1                      SECOND STATUS BYTE       X03039 96250000
CLOCAL   EQU   X'02'                    LOCAL DEVICE FLAG        X03039 96320000
DCTSTAT3 DS    XL1                      THIRD STATUS BYTE        X03039 96390000
         EJECT                                                          96460000
         TTCBD                                                   Y02027 96530000
         TDEBD                                                   Y02027 96600000
         EJECT                                                          96670000
         TLGBD                                                          96740000
         EJECT                                                          96810000
         TMSKD                                                 @G36XRRU 96880000
         EJECT                                                          96950000
         TPEWAD                                                  Y02027 97020000
         SPACE 1                                                        97090000
         TTCXD                                                   Y02027 97160000
         END                                                            97230000
