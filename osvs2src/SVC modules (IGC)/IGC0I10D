 TITLE ' IGC0I10D - TCAM APP NETWORK CONTROL INTERFACE'                 00100010
IGC0I10D CSECT                                                          00200010
*********************************************************************** 00300010
*                                                                     * 00400010
*****     THIS IS THE SIXTH LOAD OF SVC 104 - (TOPCTL)   ************** 00500010
* MODULE NAME = IGC0I10D(TCAM,OPERATOR CONTROL)               @Y17XARZ* 00600010
*                                                             @Y17XARZ* 00700010
* DESCRIPTIVE NAME = TCAM APP NETWORK CONTROL INTERFACE       @Y17XARZ* 00800010
*                                                             @Y17XARZ* 00900010
* STATUS = VERSION 10.0                                       @Y17XARZ* 01000010
*                                                             @Y17XARZ* 01100010
* COPYRIGHT = NONE                                            @Y17XARZ* 01200010
*                                                             @Y17XARZ* 01300010
* FUNCTION  THIS MODULE CONTAINS ROUTINES THAT PROCESS A SUBSET OF    * 01400010
*        TCAM OPERATOR CONTROL FUNCTIONS FROM THE APPLICATION PROGRAM.* 01500010
*        THESE FUNCTION ARE AS FOLLOWS:                               * 01600010
*                                                                     * 01700010
*   TCOPY - WHEN TCOPY MACRO IS ISSUED IN THE APPLICATION PROGRAM THIS* 01800010
*        MODULE GETS CONTROL VIA SVC 104. IT COPIES A TERMINAL ENTRY  * 01900010
*        INTO USER WORK AREA. THE ADDRESS OF THE BINARY SEARCH ROUTINE* 02000010
*        IS OBTAINED FROM TCAM DISPATCH WORK AREA AND IS USED TO FIND * 02100010
*        DESIRED TERMNAME TABLE ENTRY. USING THIS ENTRY, IT FIND THE  * 02200010
*        TERMINAL TABLE AND DETERMINES TYPE AND SIZE AND MOVE IT ALONG* 02300010
*        WITH ANY OPTIONS INTO USER WORK AREA. IF NON-SNA TERMINAL    * 02400010
*        IS ATTACHED TO A 3705, A REQUEST IS POSTED TO OPERATOR  Y05330 02500010
*        CONTROL TO OBTAIN THE DEVICE DEPENDENT FIELDS FROM NCP. Y05330 02600010
*                                                                     * 02700010
*                                                                     * 02800010
*   TCHNG - A MASK IS USED TO UPDATE THE TTE FOR EACH OF THE NINE     * 02900010
*        (NCP,SSCP,PU,LU,PROCESS,LIST,3705 BISYNC S/S TERMINAL,270X   * 03000010
*        TERMINAL,3705 LINE), THE OPTION AND DEVICE DEPENDENT         * 03100010
*        INFORMATION.  THE DEFAULT OF THE MASK FOR LU, PROCESS, LIST  * 03200010
*        3705 BISYNC S/S TERMINAL, 270X TERMINAL, 3705 LINE ALLOWS    * 03300010
*        THE USER TO UPDATE ALL OF THE TTE EXCEPT THE FIRST 4 BYTES   * 03400010
*        OPTION AND DEVICE DEPENDENT INFORMATION.  THE MASK PRESERVES * 03500010
*        THE PEWA ADDRESS FOR THE PROCESS ENTRY ONLY.  THE DEFAULT    * 03600010
*        MASK FOR THE NCP, SSCP AND PU ALLOWS ONLY THE OPTION DATA    * 03700010
*        TO BE MODIFIED.  IF THE DEVICE DEPENDENT MASK IS ALLOWED     * 03800010
*        FOR 3705 BISYNC S/S TERMINAL, THEN A REQUEST IS POSTED TO    * 03900010
*        THE OPERATOR CONTROL TO UPDATE THE DEVICE DEPENDENT FIELDS   * 04000010
*        IN THE NCP DEVICE RECORD OF THAT RESOURCE.                   * 04100010
*        THE BINARY SEARCH ROUTINE IS USED TO LOCATE THE TERMNAME     * 04200010
*        TABLE ENTRY AND TERMINAL TABLE ENTRY.  IF PASSWORD IS        * 04300010
*        REQUIRED AND SPECIFIED, IT IS CHECKED FOR VALIDITY.          * 04400010
*                                                             @Y17XARZ* 04500010
*                                                                     * 04600010
*                                                             @Y17XARZ* 04700010
*                                                                     * 04800010
* INPUT   REGISTER  2 CONTAINS ADDRESS OF USER PARAMETER LIST         * 04900010
*         REGISTER  3 CONTAINS ADDRESS OF CVT                         * 05000010
*         REGISTER  6 CONTAINS ADDRESS OF TCB OF CALLING TASK         * 05100010
*         REGISTER  7 CONTAINS ADDRESS OF TCAM DISPATCH WORK AREA     * 05200010
*         REGISTER 13 CONTAINS ADDRESS OF USER REGISTER SAVE AREA     * 05300010
*         REGISTER 14 CONTAINS RETURN ADDRESS                         * 05400010
*         REGISTER 15 CONTAINS ENTRY ADDRESS                          * 05500010
*                                                                     * 05600010
* OUTPUT  REGISTER 15 CONTAINS RETURN CODE                            * 05700010
*                                                                     * 05800010
* EXTERNAL ROUTINES                                                   * 05900010
*         IGC102-AQCTL SVC                                            * 06000010
*         IGC001-WAIT  SVC                                            * 06100010
*         IGC006-LINK  SVC                                            * 06200010
*         IEDQNB02-CHECKPOINT                                         * 06300010
*         IEDQE8-BINARY SEARCH ROUTINE                                * 06400010
*         IEDQTNT-TERMINAL TABLE LOGIC                                * 06500010
*                                                                     * 06600010
* EXITS - CALLING ROUTINES                                            * 06700010
*         NORMAL - REGISTER 15 - ZERO                                 * 06800010
*         ERROR - REGISTER 15 RETURN CODE                     @Y17XARZ* 06900010
*                                                                     * 07000010
* TABLES/WORK AREAS                                                   * 07100010
*         AVT                                                         * 07200010
*         CVT                                                         * 07300010
*         TCB                                                         * 07400010
*         DEB                                                         * 07500010
*         CIB                                                         * 07600010
*         ACCESS METHOD WORK AREA                                     * 07700010
*         MSK                                                 @Y17XARZ* 07800010
*    PATCH LABEL= ZAPAREA                                     @Y17XARZ* 07900010
*    MODULE SIZE=                                                       08000010
*                                                                     * 08100010
* ATTRIBUTES SERIALLY REUSABLE,REFRESHABLE,ENABLED,ATTACHED,TRANSIENT * 08200010
*                                                                     * 08300010
* NOTES  THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL        * 08400010
*        REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS        * 08500010
*        EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME. THE CODING HAS  * 08600010
*        BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER CONSTANTS,   * 08700010
*        BY REASSEMBLY,WILL RESULT IN A CORRECT MODULE FOR THE NEW    * 08800010
*        DEFINITIONS.                                                 * 08900010
*                                                                     * 09000010
*CHANGE ACTIVITY                                               @Y17XARX 09020010
*A000000-999999                                                @Y17XARZ 09040010
*A090000                                                       @Y17XARX 09060010
*C543000,544000                                                @Y17XARX 09080010
*C465000                                                       @Y17XARW 09090010
*********************************************************************** 09100010
         EJECT                                                          09200010
         SPACE 3                                                        09300010
RZERO    EQU   0                        REGISTER ZERO                   09400010
RONE     EQU   1                        REGISTER ONE                    09500010
RPARM    EQU   2                        PARAMETER REGISTER              09600010
RCVT     EQU   3                        ADDRESS OF CVT                  09700010
R3       EQU   3                        REGISTER THREE                  09800010
RTNT     EQU   4                        TERMNAME TABLE                  09900010
RANDREG  EQU   4                        WORK REG FOR TCHNG     @Y17XARZ 10000010
RTE      EQU   4                        TIOT EXTENT ADDRESS             10100010
RTERM    EQU   5                        TERMINAL TABLE                  10200010
RECB     EQU   5                        EVENT CONTROL BLOCK             10300010
RTCB     EQU   6                        TASK CONTROL BLOCK              10400010
RSRCHARG EQU   7                        SEARCH ARG REG -TCHNG  @Y17XARZ 10500010
RDEB     EQU   7                        DATA EXTENT BLOCK               10600010
RAVT1    EQU   7                        DISPATCH WORK AREA              10700010
RWORK    EQU   8                        USER WORK AREA                  10800010
RAVT     EQU   9                        ADDRESS VECTOR TABLE            10900010
RTEMP    EQU   10                       WORK REG                        11000010
RPCB     EQU   10                       PROCESS CONTROL BLOCK           11100010
RCOUNT   EQU   11                       WORK REG                        11200010
RCIB     EQU   11                       COMMAND INPUT BUFFER            11300010
RBASE    EQU   12                       BASE REG                        11400010
RSAVE    EQU   13                       SAVE AREA ADDRESS               11500010
RETURN   EQU   14                       RETURN ADDRESS                  11600010
RETWORK  EQU   14                       WORK REG               @Y17XARZ 11700010
RETWRK   EQU   14                       WORK REGISTER          @Y17XARZ 11800010
RENTRY   EQU   15                       ENTRY POINT/ COMPLETION CODE    11900010
         SPACE 3                                                        12000010
         USING IEDQAVTD,RAVT            TCAM ADDRESS VECTOR TBL         12100010
         USING IEDQTCB,RTCB             TASK CONTROL BLOCK              12200010
         USING IEDQDEB,RDEB             DATA EXTENT BLOCK               12300010
         USING APLCOPYD,RPARM           USER PARAMETER                  12400010
         USING IEDQTRM,RTERM            TERMINAL TABLE                  12500010
         SPACE 2                                                        12600010
         BALR  RBASE,RZERO              ESTABLISH                       12700010
         USING *,RBASE                  ADDRESSABILITY                  12800010
IGC0I10D IEDHJN ENTER                                                   12900010
         ST     RETURN,TWELVE(,RSAVE)     SAVE RETURN          @YM07742 12901010
         L      RTEMP,APLSAVE2            GET SAVEAREA         @YM07742 12902010
         ST     RSAVE,FOUR(,RTEMP)        ESTABLISH SAVE       @YM07742 12903010
         ST     RTEMP,EIGHT(,RSAVE)       AREA LINKAGE         @YM07742 12904010
         LR     RSAVE,RTEMP                                             12905010
         L     RAVT,ZERO(,RAVT1)        ADDRESS OF AVT                  13000010
         L     RWORK,APLUSEWK           ADDRESS OF USER WORKAREA        13100010
TCAM2    EQU   *                                                 Y05330 13200010
         SR    RDEB,RDEB                CLEAR DEB REGISTER              13300010
         ICM   RDEB,AD,TCBDEB+1         ADDRESS OF FIRST DEB            13400010
LOOP     EQU   *                                                        13500010
         BNZ   OK                       DEB CHAIN EXHAUSTED             13600010
*                                       BEFORE TCAM DEB FOUND           13700010
         SPACE                                                          13800010
         LA    RENTRY,NOPEN             ERROR COMPLETION CODE           13900010
         B     EXIT2                    RETURN TO USER                  14000010
*                                                                       14100010
OK       EQU   *                                                        14200010
         TM    DEBTAMID,ID              TCAM DEB                        14300010
         BO    TCAMDEB                  YES BRANCH                      14400010
         ICM   RDEB,AD,DEBDEBAD         ADDRESS OF NEXT DEB             14500010
         B     LOOP                     CHECK NEXT DEB                  14600010
TCAMDEB  EQU   *                                                        14700010
         L     RTNT,AVTRNMPT            ADDRESS OF TERMNAME TABLE       15200010
         L     RZERO,0(RPARM)           ADDRESS OF USER TERMNAME        15300010
         L     RENTRY,AVTCVTPT(,RCVT)   GET ADDRESS OF DISPATCH         15400010
*                                       WORK AREA                       15500010
         L     RENTRY,QE8DISP(,RENTRY)  GET ADDRESS OF                  15600010
         BALR  RETURN,RENTRY            SEARCH ROUTINE                  15700010
*                                       GO TO SEARCH ROUTINE            15800010
BACK     EQU   *                                                        15900010
         LTR   RENTRY,RENTRY            TERMNAME VALID                  16000010
         BNZ   NAMEOK                   BRANCH IF YES                   16100010
I3705ERR EQU   *                                                 Y05330 16200010
         LA    RENTRY,TTERR             ERROR CODE                      16300010
         B     EXIT                     RETURN TO USER                  16400010
         EJECT                                                          16500010
NAMEOK   EQU   *                                                        16600010
         LR    RONE,RENTRY              TERMNAME TABLE OFFSET           16700010
         L     RENTRY,APLRNLST          GET 3705 PARM LIST       Y05330 16800010
         STH   RONE,CIBTNTX-IEDQCIB(,RENTRY) SAVE TNT OFFSET     Y05330 16900010
         TM    APLCODE,TCHNGCD          ENTRY FROM TCHNG                17000010
         BZ    NOTTCHNG                 NO BRANCH                       17100010
         ST    RWORK,CIBFROM-IEDQCIB(,RENTRY) SAVE USER WORK AREAY05330 17200010
NOTTCHNG EQU   *                                                        17300010
         L     RENTRY,AVTRNMPT          ADDR OF CONVERSION LOGIC        17400010
         BALR  RETURN,RENTRY            GO TO CONVERSION ROUTINE        17500010
         LR    RTERM,RONE               ADDRESS OF TERMINAL ENTRY       17600010
*                                                                       17700010
         TM    APLCODE,TCHNGCD          ENTRY FROM TCHNG                17800010
         BO    TCHNGGO                  YES BRANCH                      17900010
         SPACE 3                                                        18000010
TCOPYGO  EQU   *                                                        18100010
         TM    TRMSTATE,TRMLIST         DIST LIST OR CASCADE     Y05330 18200010
         BNO   SINGLE                   BRANCH IF NO TO COMPUTE         18300010
*                                       SIZE OF TERMINAL OR             18400010
*                                       PROCESS ENTRY                   18500010
         LA    RCOUNT,TLISTEN-IEDQTRM   MINIMUM SIZE OF LIST ENTRY      18600010
         SR    RTEMP,RTEMP              CLEAR WORK REG                  18700010
         LH    RTEMP,TLISTCNT           NUMBER OF 2 BYTE ENTRIES        18800010
         SLL   RTEMP,1                  MULTIPLY BY SIZE OF ONE         18900010
*                                       ENTRY                           19000010
         AR    RCOUNT,RTEMP             SIZE OF TLIST                   19100010
         LR    RTEMP,RTERM              ADDRESS OF TERMINAL ENTRY       19200010
         B     MLOOP                    COPY LIST ENTRY                 19300010
         SPACE 2                                                        19400010
SINGLE   EQU   *                                                        19500010
         TM    TRMSTATE,TRMLINE+TRMLIST+TRMPROC COULD IT BE LGB  Y05330 19600010
         BNZ   NOLGB                    NO, BRANCH               Y05330 19700010
         LA    RENTRY,TTERR             SET FOR TRMNME ERROR     Y05330 19800010
         TM    TRMDSORG,TRMLGB          IS IT AN LGB             Y05330 19900010
         BO    EXIT                     YES, ERROR               Y05330 20000010
NOLGB    EQU   *                                                 Y05330 20100010
*                                                                       20200010
         MVC   0(TRMOPNO-IEDQTRM,RWORK),TRMSTATE COPY BASIC             20300010
*                                       PART OF TERM ENTRY              20400010
         LA    RETURN,TRMOPNO           ADDR..OF DD FIELDS              20500010
         LA    RTEMP,TRMOPNO-IEDQTRM(,RWORK) ADDR OF NEXT               20600010
*                                       EMPTY BYTE                      20700010
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS USED              20800010
         BNO   DEVDEP                   BRANCH IF NO                    20900010
         MVC   0(TRMOPT-TRMOPNO,RTEMP),TRMOPNO MOVE OPT CONTROL         21000010
         LA    RTEMP,TRMOPT-TRMOPNO(,RTEMP)                             21100010
         SR    RONE,RONE                CLEAR REGISTER           Y05330 21200010
         IC    RONE,TRMOPNO             NUMBER OF OPTION OFFSETS Y05330 21300010
         BCTR  RONE,RZERO               DECREMENT FOR EXECUTE    Y05330 21400010
         EX    RONE,MOVEM               MOVE OPTION OFFSETS      Y05330 21500010
         LA    RONE,ONE(,RONE)          RESTORE LENGTH           Y05330 21600010
         LA    RTEMP,TRMOPT-IEDQTRM(RONE,RWORK) ADDRESS OF NEXT  Y05330 21700010
*                                       EMPTY BYTE               Y05330 21800010
         LA    RETURN,TRMOPT-IEDQTRM(RONE,RTERM) ADDR OF DD FIELDY05330 21900010
         SPACE 2                                                        22000010
DEVDEP   EQU   *                                                        22100010
         STM   RETURN,RBASE,TWELVE(RSAVE) SAVE REGS            @YM07776 22150010
         BAL   RETURN,TESTTYPE     CHECK TO SEE IF TRIP TO     @Y17XARZ 22200010
*                                  NCP IS REQURIED             @Y17XARZ 22300010
         B     DEVDEP0X            RETURN HERE IF NOT          @Y17XARZ 22400010
*        RETURN HERE IF YES                                    @Y17XARZ 22500010
         L     RPARM,APLRNLST           GET 3705 PARMLIST        Y05330 22700010
         ST    RTERM,CIBFROM-IEDQCIB(,RPARM) SAVE TERM ADDRESS   Y05330 22800010
         ST    RWORK,CIBTO-IEDQCIB(,RPARM)  SAVE WORK AREA ADDR  Y05330 22900010
         MVI   CIBSIZE+FOUR(RPARM),ZERO CLEAR ECB                Y05330 23000010
         BAL   RETURN,QETGO1            POST OPERATOR CONTROL    Y05330 23200010
         LTR   RENTRY,RENTRY            ERROR ON POST            Y05330 23300010
         BNZ   EXIT                     YES, RETURN TO USER      Y05330 23400010
DEVDEP0X EQU   *                                                        23450010
         LM    RETURN,RBASE,TWELVE(RSAVE) RESTORE TCOPY REGISTERSY05330 23500010
         SR    RCOUNT,RCOUNT            CLEAR REGISTER                  23700010
         SR    R3,R3                    CLEAR REGISTER                  23800010
         SR    RZERO,RZERO              CLEAR REG                       23900010
         SR    RONE,RONE                CLEAR REG                       24000010
         ICM   RZERO,HALFWORD,TRMDEVFL-IEDQTRM(RWORK) DEV DEP FLGY05330 24100010
*                                       DD FIELDS PRESENT               24200010
         BZ    OPTST                    BRANCH IF NO                    24300010
         SPACE 2                                                        24400010
SHIFT    EQU   *                                                        24500010
         SRDL  RZERO,1                  MOVE IN ONE BIT                 24600010
         SRL   RONE,31                  MAKE REG ONE OR ZERO            24700010
         AR    RCOUNT,RONE              BUMP DD COUNTER                 24800010
         LTR   RZERO,RZERO              ALL BITS TESTED                 24900010
         BNZ   SHIFT                    CONTINUE COUNTING               25000010
         ST    RETURN,TWELVE(RSAVE)     SAVE ADDR OF DD FIELDS @YM07812 25050010
         BAL   RETURN,TESTTYPE          CHECK TO SEE IF DD     @YM07812 25100010
*                                       FIELDS HAVE BEEN       @YM07812 25130010
*                                       MOVED                  @YM07812 25160010
         B     DDLOOP1                  NO, BRANCH             @YM08003 25200010
         L     RETURN,TWELVE(RSAVE)     RESTORE ADDR OF DD FLDS@YM07812 25250010
         LR    RTEMP,RETURN             ADDR OF DD FIELDS        Y05330 25300010
         LA    RTERM,ZERO(,RTERM)       CLEAR HIGH ORDER BYTE    Y05330 25400010
         SR    RTEMP,RTERM              OFFSET TO DD FIELD       Y05330 25500010
         AR    RTEMP,RWORK              IN USER WORK AREA        Y05330 25600010
DDLOOP2  EQU   *                                                 Y05330 25700010
         IC    R3,ZERO(,RTEMP)          DD FIELD LENGTH          Y05330 25800010
         LA    RTEMP,ONE(R3,RTEMP)      BUMP TO NEXT             Y05330 25900010
         BCT   RCOUNT,DDLOOP2           BRANCH IF MORE TO SKIP   Y05330 26000010
         B     OPTST                    GO TEST OPTION FIELDS    Y05330 26100010
DDLOOP1  EQU   *                                               @YM08003 26200010
         L     RETURN,TWELVE(RSAVE)     RESTORE ADDR OF DD FLDS@YM07812 26230010
DDLOOP   EQU   *                                               @YM08003 26260010
         IC    R3,0(RETURN)             LENGTH OF DD FIELD              26300010
         EX    R3,MOVEDD                MOVE DEV DEP FIELDS             26400010
         LA    RTEMP,ONE(R3,RTEMP)      NEXT EMPTY BYTE                 26500010
         LA    RETURN,ONE(R3,RETURN)    ADDR OF NEXT DD FIELD           26600010
         BCT   RCOUNT,DDLOOP            MOVE NEXT DD FIELD              26700010
OPTST    EQU   *                                                        26800010
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS TO BE MOVED       26900010
         BO    MOVOPT                   BRANCH IF YESS                  27000010
         SR    RENTRY,RENTRY            GOOD COMPLETION CODE            27100010
         B     EXIT                     RETURN TO USER                  27200010
MOVOPT   EQU   *                                                        27300010
         LR    RONE,RTEMP               SAVE EMPTY BYTE PTR      Y05330 27400010
         SR    RONE,RWORK               COMPUTE OFFSET FROM STARTY05330 27500010
*                                       OF DESTINATION AREA TO          27600010
*                                       BYTE TO CONTAIN OPTION          27700010
*                                       TBL                             27800010
         STH   RONE,TRMOPTBL-IEDQTRM(,RWORK) STORE OFFSET IN     Y05330 27900010
*                                       COPY OF TERM TABLE ENTRY        28000010
         LR    RWORK,RTEMP              EFFECTIVE DESTINATION           28100010
*                                       ADDRESS                         28200010
         LH    RONE,TRMOPTBL            GET ENTRY OFFSET       @YA05454 28300010
         N     RONE,AVTCLRHI            CLEAR HI HALF          @YA05454 28400010
         L     R3,AVTOPTPT              GET OPT TBL ADDR       @YA05454 28500010
         AR    RONE,R3                  ADD OPT TBL ADDR       @YA05454 28600010
         L     R3,FOUR(,R3)             GET OPT CSECT TBL ADDR @YA05454 28700010
*                                       ENTRY FOR THIS TERMINAL         28800010
         SR    RDEB,RDEB                CLEAR WORK REG                  28900010
         IC    RDEB,TRMOPNO             NUMBER OF OPTION ENTRIES        29000010
*                                       INTO BCT REG                    29100010
         LA    RTCB,TRMOPT              START OF OPTION OFFSETS         29200010
         LR    RTEMP,RTCB               ADDRESS OF FIRST OFFSET         29300010
         SR    RCOUNT,RCOUNT            CLEAR INSERT REG                29400010
OLOOP    EQU   *                                                        29500010
         CLI   0(RTCB),AVTEFF           IS THIS OFFSET UNUSED           29600010
         BNE   HIT                      NO,BRANCH                       29700010
BUMPER   EQU   *                                                        29800010
         LA    RTCB,ONE(,RTCB)          BUMP TO NEXT OFFSET             29900010
         LA    R3,CHARLNTH(,R3)         BUMP TO NEXT CHAR ENTRY         30000010
         BCT   RDEB,OLOOP               SUBTRACT ONE FROM OFFSET        30100010
*                                       INDICATOR TO LOOK AT ANOT       30200010
*                                       HER ENTRY IN LIST               30300010
         SR    RTCB,RTCB                CLEAR WORK REG                  30400010
         IC    RTCB,0(RTEMP)            LAST USED OFFSET                30500010
         LA    RCOUNT,ONE(RCOUNT,RTCB)  TOTAL OPTION FIELD LENGTH       30600010
         LR    RTEMP,RONE               OPTION FIELD ADDRESS     Y05330 30700010
         B     MLOOP                    GO COPY OPTION FIELDS           30800010
         SPACE 2                                                        30900010
HIT      EQU   *                                                        31000010
         LR    RTEMP,RTCB               ADDRESS OF LAST USED            31100010
*                                       OFFSET                          31200010
         IC    RCOUNT,0(R3)             LENGTH-1 OF OPTION              31300010
         B     BUMPER                   CHECK NEXT OFFSET               31400010
         SPACE 2                                                        31500010
TCHNGGO  EQU   *                                                        31600010
         SR    R3,R3                    CLEAR REGISTER                  31700010
         ICM   R3,AD,APLPASS+1          GET PASS WORD POINTER           31800010
         BAL   RETURN,PASSWORD          GO TO PASSWORD CHECKER          31900010
*                                       RETURN IS TO HERE ONLY IF       32000010
*                                       PASSWORD IS VALID, OTHERWISE    32100010
*                                       RETURN IS TO USER               32200010
         SPACE 2                                                        32300010
         LR    R3,RTEMP                 ESTABLISH ADDRESSABILITY        32400010
*                                       FOR ACCESS METHOD WORK AREA     32500010
         SR    RSRCHARG,RSRCHARG      CLEAR TO GET ARGUMENT    @Y17XARZ 32600010
         IC   RSRCHARG,TRMSTATE  PUT TTE TYPE IN THE ARG       @Y17XARZ 32700010
         SR    RANDREG,RANDREG          CLEAR TO GET RID OF    @Y17XARZ 32800010
*                                       UNWANTED BITS          @Y17XARZ 32900010
         LA   RANDREG,SRCHMSK      GET MASK TO GET RID         @Y17XARZ 33000010
*                                       OF UNWANTED BITS       @Y17XARZ 33100010
         NR    RSRCHARG,RANDREG       REMOVE UNWANTED BITS     @Y17XARZ 33200010
         SLL   RSRCHARG,BY0             MAKE ROOM              @Y17XARZ 33300010
         TM    TRMSTATE,TRMPREF       IS TTE AN NCP RESRCE     @Y17XARZ 33400010
         BZ    NOPREFIX               NO                       @Y17XARZ 33500010
         LR    RETWRK,RTERM           PRESERVE TTE REG         @Y17XARZ 33600010
         S     RTERM,PREFIXL          BACK UP TO PREFIX        @Y17XARZ 33700010
         USING IEDNTRM,RTERM          POINT DSECT AT PREFIX    @Y17XARZ 33800010
         ICM   RSRCHARG,BY3,TRMTYPE     PUT QUALIFYING TYPE    @Y17XARZ 33900010
*                                       IN THE ARGUMENT        @Y17XARZ 34000010
         LR    RTERM,RETWRK           RESET TTE POINTER        @Y17XARZ 34100010
         USING IEDQTRM,RTERM          RESET DSECT              @Y17XARZ 34200010
NOPREFIX LA    RETWRK,SRCHLIM         SET UP LOOP COUNT        @Y17XARZ 34300010
         LA    RWORK,SRCHTBLE         POINT AT SRCHTABLE       @Y17XARZ 34400010
SRCHCLC  CLM   RSRCHARG,BY2+BY3,SRCHSTAT(RWORK) TTE TYPE=?     @Y17XARZ 34500010
         BE    SRCHFND                 YES                     @Y17XARZ 34600010
         LA    RWORK,SRCHTBEL(RWORK)   POINT AT NEXT ENTRY     @Y17XARZ 34700010
         BCT   RETWRK,SRCHCLC          LOOP TILL END OF TABLE  @Y17XARZ 34800010
         B     I3705ERR                INVALID ENTRY TYPE      @Y17XARZ 34900010
SRCHFND  SR    RETWRK,RETWRK           CLEAR WORK REG          @Y17XARZ 35000010
         IC    RETWRK,SRCHMASK(RWORK)  GET OFFSET TO MASK      @Y17XARZ 35100010
         A     RETWORK,AVTOPMSK        POINT TO MASK TABLE     @Y17XARZ 35200010
         L     RWORK,APLUSEWK           ADDRESS OF USER WRKAREA@Y17XARZ 35300010
         CLM   RSRCHARG,BY2+BY3,SRLSTNTY        LIST ENTRY?    @Y17XARZ 35400010
         BNE   TNOLGB              NO                          @Y17XARZ 35500010
         SR    RTEMP,RTEMP              CLEAR FOR IC           @YM07822 35550010
         ICM   RTEMP,HALFWORD,FOUR(RWORK) NO OF 2- BYTE        @Y17XARZ 35600010
*                                       ENTERIES IN U. LIST    @Y17XARZ 35700010
         TM    MSK1-MSKMASK(RETWRK),MSKCNT  MODIFY COUNT?      @Y17XARZ 35800010
         BZ    NOCOUNTM     NO                                 @Y17XARZ 35900010
         STH   RTEMP,TLISTCNT  UPDATE COUNT                    @Y17XARZ 36000010
NOCOUNTM TM    MSK1-MSKMASK(RETWRK),MSKLIST MODIFY TLIST?      @Y17XARZ 36100010
         BZ    TCHNGOUT               NO GET OUT               @Y17XARZ 36200010
         SLL   RTEMP,1                  MULTIPLY BY SIZE OF ONE         36300010
*                                       ENTRY                           36400010
         LR    RCOUNT,RTEMP                                             36500010
*                                       TERMINAL TABLE ENTRY            36600010
         LA    RTEMP,TLISTEN       ADDR OF LIST ENTERIES       @Y17XARZ 36700010
         LA    RWORK,SIX(,RWORK)   ADDR OF USER DATA+6         @Y17XARZ 36800010
         LA    RETURN,TCHNGOUT          SET RETURN TO EXIT              36900010
         B     TMLOOP                   GO MOVE THE DATA                37000010
TNOLGB   EQU   *                                                 Y05330 37100010
         L     RENTRY,APLRNLST          GET 3705 PARM LIST       Y05330 37200010
         NI    CIBLRN-IEDQCIB(RENTRY),AVTEFF-DIGITS-CHARS        Y05330 37300010
*                                       ASSUME NO DIAL DIGITS    Y05330 37400010
*                                       NOR ADDRESSING CHARACTERSY05330 37500010
         TM    TRMDEVFL,DIALDIG         DIAL DIGITS PRESENT      Y05330 37600010
         BNO   TCKADDR                  NO, BRANCH               Y05330 37700010
         OI    CIBLRN-IEDQCIB(RENTRY),DIGITS INDICATE DIAL DIGITSY05330 37800010
TCKADDR  EQU   *                                                 Y05330 37900010
         TM    TRMDEVFL,ADDRCHR         ADDRESS CHARS PRESENT    Y05330 38000010
         BNO   TNOADDR                  NO, BRANCH               Y05330 38100010
         OI    CIBLRN-IEDQCIB(RENTRY),CHARS INDICATE ADDR CHARS  Y05330 38200010
TNOADDR  EQU   *                                                 Y05330 38300010
         CLM   RSRCHARG,BY2+BY3,SPRCNTY IS IT A PROCESS ENTRY? @Y17XARZ 38400010
         BNE   NOTPROC             BRANCH IF NOT               @Y17XARZ 38500010
         MVC   TRMSTAT-IEDQTRM(FOUR,RWORK),TRMSTAT             @YA10247 38600010
*                                       SAVE PEWA ADDRESS      @YA10247 38700010
NOTPROC  EQU   *                                               @YA10247 38800010
         ST    R3,R3OFFSET(RSAVE)  SAVE REGISTER USED          @Y17XARZ 38900010
         ST    RTERM,R5OFFSET(RSAVE) SAVE REG USED             @Y17XARZ 39000010
         ST    RWORK,R8OFFSET(RSAVE) SAVE REG USED             @Y17XARZ 39100010
         LA    RTEMP,LOOPCT        INIT LOOP COUNTER           @Y17XARZ 39200010
         L     R3,ANDMASK          INITIALIZE TEST MASK        @Y17XARZ 39300010
         LA    RTERM,TRMINSEQ      POINT TO RCVING AREA        @Y17XARZ 39400010
         LA    RWORK,FOUR(RWORK)   POINT TO SENDING AREA       @Y17XARZ 39500010
TSTMVE  ICM    RENTRY,HALFWORD,ZERO(RETWRK)  GET MASK          @Y17XARZ 39600010
         NR    RENTRY,R3            CAN 1 MODIFY THIS BYTE     @Y17XARZ 39700010
         BZ    NOMOVE               NO                         @Y17XARZ 39800010
         MVC   ZERO(ONE,RTERM),ZERO(RWORK) YES MOVE IT         @Y17XARZ 39900010
NOMOVE   SRL   R3,ONE               SHIFT TO NEXT MASK BIT     @Y17XARZ 40000010
         LA    RTERM,ONE(RTERM)     INCR RCVING FIELD          @Y17XARZ 40100010
         LA    RWORK,ONE(RWORK)     INCR SENDING FIELD         @Y17XARZ 40200010
         BCT   RTEMP,TSTMVE         REPEAT -LOOPCT- TIMES      @Y17XARZ 40300010
         ICM   RWORK,FULLWORD,R8OFFSET(RSAVE) RESTORE USER     @Y17XARZ 40400010
*                                       AREA POINTER           @Y17XARZ 40500010
         LR    RONE,RWORK           RESTORE WORKAREA PTR       @YM08025 40550010
         ICM   RTERM,FULLWORD,R5OFFSET(RSAVE) RESTORE TTE PTR  @Y17XARZ 40600010
         ST    RETWRK,R14INDEX(RSAVE) SAVE                     @Y17XARZ 40700010
*                                       TCHNG MASK POINTER     @Y17XARZ 40800010
         ICM   R3,FULLWORD,R3OFFSET(RSAVE) RESTORE REGISTER    @Y17XARZ 40900010
*        MODIFY OPTION FIELDS                                  @Y17XARZ 41000010
         TM    MSK2-MSKMASK(RETWRK),MSKOPT  MODIFY OPTION FLDS?@Y17XARZ 41100010
         BZ    TDEVDEP             NO                          @Y17XARZ 41200010
         LA    RWORK,TRMOPNO-IEDQTRM(,RWORK) NEXT BYTE IN USER          41300010
*                                       WORK AREA                       41400010
         LA    RENTRY,TRMOPNO           NEXT BYTE TO UPDATE             41500010
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS PRESENT           41600010
         BNO   TDEVDEP                  NO, BRANCH                      41700010
         SPACE 1                                                        41800010
         LH    RWORK,TRMOPTBL-IEDQTRM(,RONE)                   @YA05454 41900010
         N     RWORK,AVTCLRHI           CLEAR HI HALF          @YA05454 42000010
         AR    RONE,RWORK               ADD OPT TBL ADDR       @YA05454 42100010
         LR    RWORK,RONE               OFFSETS IN USER WORK AREAY05330 42200010
TMOVOPT  EQU   *                                                        42300010
         SR    RCOUNT,RCOUNT            CLEAR WORK REG                  42400010
         LH    RTNT,TRMOPTBL            GET ENTRY OFFSET       @YA05454 42500010
         N     RTNT,AVTCLRHI            CLEAR HI HALF          @YA05454 42600010
         L     RONE,AVTOPTPT            GET OPT TBL ADDR       @YA05454 42700010
         AR    RTNT,RONE                ADD OPT TBL ADDR       @YA05454 42800010
         L     RONE,FOUR(,RONE)         GET OPT CSECT TBL ADDR @YA05454 42900010
*                                       FOR THIS ENTRY                  43000010
         SR    RDEB,RDEB                *                               43100010
         IC    RDEB,TRMOPNO             NUMBER OF OPTION FIELDS         43200010
         LA    RTCB,TRMOPT              START OF OPTION OFFSETS         43300010
         LR    RTEMP,RTCB                                               43400010
         SPACE 3                                                        43500010
TOLOOP   CLI   0(RTCB),AVTEFF           IS THIS OFFSET UNUSED           43600010
         BNE   THIT                     NO, BRANCH                      43700010
TBUMPER  EQU   *                                                        43800010
         SPACE 1                                                        43900010
         LA    RTCB,ONE(,RTCB)          BUMP TO NEXT OFFSET             44000010
         LA    RONE,CHARLNTH(,RONE)     BUMP TO NEXT CHAR ENTRY         44100010
         BCT   RDEB,TOLOOP              LOOK AT NEXT OFFSET BYTE        44200010
         SPACE 3                                                        44300010
         SR    RETURN,RETURN            CLEAR WORK REGISTER             44400010
         IC    RETURN,0(RTEMP)          LAST USED OFFSET                44500010
         LA    RCOUNT,ONE(RCOUNT,RETURN) OPTION FIELD LENGTH            44600010
         LR    RTEMP,RTNT                                               44700010
         BAL   RETURN,TMLOOP            CHANGE OPTION FIELDS            44800010
         L     RWORK,APLUSEWK           RESTORE USER WORK AREA   Y05330 44900010
         LA    RWORK,TRMOPT-IEDQTRM(,RWORK) OPTION OFFSET ADDR          45000010
         SR    RCOUNT,RCOUNT            CLEAS REGISTER          SA63026 45100010
         IC    RCOUNT,TRMOPNO           NUMBER OF OPTION OFFSETS        45200010
         LA    RTEMP,TRMOPT             ADDR OF FIELDS TO CHANGE        45300010
         BAL   RETURN,TMLOOP            MOVE OFFSETS                    45400010
         IC    RCOUNT,TRMOPNO                                           45500010
         AR    RWORK,RCOUNT             ADDR OF DD FIELD IN WORKA       45600010
         LR    RENTRY,RTCB              ADDR OF DD FIELD IN TRMTBL      45700010
         B     TDEVDEP                  GO MOVE DD ENTRIES              45800010
THIT     EQU   *                                                        45900010
         LR    RTEMP,RTCB                                               46000010
         IC    RCOUNT,0(RONE)           LENGTH-1 OF OPTION FIELD        46100010
*                                       WORK AREA                       46200010
         B     TBUMPER                  GO CHECK NEXT OPTION BYTE       46300010
TDEVDEP  EQU   *                                                        46400010
         ICM   RETWRK,FULLWORD,R14INDEX(RSAVE) RESTORE TCHNG POINTER    46500010
*                                                              @Y17XARW 46550010
         TM    MSK2-MSKMASK(RETWRK),MSKDVDP MODIFY DEVDEP?     @Y17XARZ 46600010
         BZ    TCHNGOUT             NO                         @Y17XARZ 46700010
         BAL   RETURN,TESTTYPE     GO TEST TTE                 @Y17XARZ 46800010
         B     TDEVDEPX            RETURN HERE IF              @Y17XARZ 46900010
*                                  NON-NCP RESOURCE OR         @Y17XARZ 47000010
*                                  NCP LINE OR SNA RESOURCE    @Y17XARZ 47100010
         STM   RETURN,RBASE,TWELVE(RSAVE) SAVE TCHNG REGISTERS   Y05330 47200010
         L     RPARM,APLRNLST           GET 3705 PARMLIST        Y05330 47300010
         ST    RTERM,CIBTO-IEDQCIB(,RPARM) SAVE TERM ADDRESS     Y05330 47400010
         MVI   CIBSIZE+FOUR(RPARM),ZERO CLEAR ECB                Y05330 47500010
         BAL   RETURN,QETGO1            POST OPERATOR CONTROL    Y05330 47700010
         LTR   RENTRY,RENTRY            ERROR ON POST            Y05330 47800010
         BNZ   EXIT                     YES, RETURN TO USER      Y05330 47900010
         LM    RETURN,RBASE,TWELVE(RSAVE) RESTORE TCHNG REGISTERSY05330 48000010
         B     TCHNGOUT                 TAKE A CHECKPOINT        Y05330 48100010
TDEVDEPX EQU   *                                                 Y05330 48200010
         SR    RCOUNT,RCOUNT            CLEAR WORK REGS                 48300010
         SR    RTCB,RTCB                *                               48400010
         SR    RZERO,RZERO              *                               48500010
         SR    RONE,RONE                *                               48600010
         LR    RDEB,RWORK               ADDR OF DD IN WORK AREA         48700010
         ICM   RZERO,HALFWORD,TRMDEVFL  DEV DEP FIELDS           Y05330 48800010
         BZ    TCHNGOUT                 ANY PRESENT,NO BRANCH           48900010
         SPACE 1                                                        49000010
TSHIFT   SRDL  RZERO,1                  MOVE IN ONE BIT                 49100010
         SRL   RONE,31                  MAKE IT ONE OR ZERO             49200010
         AR    RCOUNT,RONE                                              49300010
         LTR   RZERO,RZERO              ALL BITS TESTED                 49400010
         BNZ   TSHIFT                   NO CONTINUE COUNTING            49500010
         SR    RONE,RONE                CLEAR WORK REG                  49600010
TDDLOOP  EQU   *                                                        49700010
         IC    RONE,0(RDEB)             SIZE OF ONE ENTRY               49800010
         LA    RTCB,ONE(RONE,RTCB)      BUMP DD FIELD LENGTH CTRS       49900010
         LA    RDEB,ONE(RONE,RDEB)      BUMP TO NEXT DD FIELD           50000010
         BCT   RCOUNT,TDDLOOP           DECREMENT NO OF DD FIELDS       50100010
*                                                                       50200010
         LR    RTEMP,RENTRY             ADDRESS OF DD FIELD             50300010
*                                       IN TERM TABLE                   50400010
         LR    RCOUNT,RTCB              TOTAL LENGTH OF DD FIELDS       50500010
         LA    RETURN,TCHNGOUT          SET RETURN TO EXIT              50600010
TMLOOP   EQU   *                                                        50700010
         C     RCOUNT,MAX               IS MOVE LOOP NEEDED             50800010
         BNH   TLAST                    NO BRANCH                       50900010
         SH    RCOUNT,MAXIM             SUBTRACT LENGTH                 51000010
         MVC   0(MAXI,RTEMP),0(RWORK)   MOVE 256 BYTES                  51100010
         LA    RWORK,MAXI(,RWORK)       BUMP TO NEXT BYTE TO MOVE       51200010
         LA    RTEMP,MAXI(,RTEMP)       *                               51300010
         B     TMLOOP                   GO MOVE MORE DATA               51400010
         SPACE 2                                                        51500010
TLAST    EQU   *                                                        51600010
         LTR   RCOUNT,RCOUNT            ALL DATA MOVED                  51700010
         BZ    RETRN                    RETURN                          51800010
         BCTR  RCOUNT,RZERO             DECREMENT COUNT FOR EXEC        51900010
         EX    RCOUNT,MOVEOPT           MOVE LAST OF DATA               52000010
RETRN    EQU   *                                                        52100010
         BR    RETURN                   RETURN                          52200010
MLOOP    EQU   *                                                        52300010
         SPACE 1                                                        52400010
         C     RCOUNT,MAX               IS MOVE LOOP NEEDED             52500010
         BNH   LASTMVE                  BRANCH IF NO                    52600010
         SH    RCOUNT,MAXIM             SUBTRACT MAXIMUM LENGTH         52700010
*                                       FOR ONE MVC INST                52800010
         MVC   0(MAXI,RWORK),0(RTEMP)   MOVE 256 BYTES                  52900010
         LA    RWORK,MAXI(,RWORK)       BUMP TO NEXT EMPTY BYTE         53000010
*                                       IN DESTINATION AREA             53100010
         LA    RTEMP,MAXI(,RTEMP)       BUMP TO NEXT BYTE TO BE         53200010
*                                       MOVED                           53300010
         B     MLOOP                    GO MOVE MORE DATA               53400010
*                                                                       53500010
LASTMVE  EQU   *                                                        53600010
         LTR   RCOUNT,RCOUNT            ALL DATA MOVED                  53700010
         BZ    GOODOUT                  BRANCH IF YES                   53800010
         BCTR  RCOUNT,RZERO             DECREMENT COUNT FOR EXEC        53900010
         EX    RCOUNT,MOVER             MOVE LAST OF DATA               54000010
         B     GOODOUT                  PREPARE TO RETURN               54100010
TCHNGOUT EQU   *                                                        54200010
         TM    AVTCKFLG,AVTCKTAC        CHECKPOINT OPTION      @Y17XARX 54300010
         BZ    NOCKPT                   NO BRANCH              @Y17XARX 54400010
         L     RONE,APLRNLST            GET TNT OFFSET SAVED IN SA61775 54500010
         LH    RONE,CIBTNTX-IEDQCIB(,RONE) USER PARAMETER LIST  SA61775 54600010
         L     RWORK,CVT                GET CVT ADDRESS                 54700010
         USING ETCVT,RWORK              CVT ADDRESS                     54800010
         L     RWORK,CVTLINK            ADDRESS OF LINKLIB DCB          54900010
         DROP  RWORK                                                    55000010
         LINK  EP=IEDQNB02,DCB=(RWORK)  TAKE A CHECKPOINT               55100010
NOCKPT   EQU   *                                                        55200010
         SR    RENTRY,RENTRY            NORMAL COMPLETION CODE          55300010
         B     EXIT                     RETURN TO USER           Y05330 55400010
         SPACE 3                                                        55500010
QETGO1   EQU   *                                                        55600010
         USING IEDQPCB,RPCB                                             55700010
         USING IEDQCIB,RCIB                                             55800010
         USING ETCVT,RCVT                                               55900010
*                                                                     * 56200010
*        FIND PCB ASSOCIATED WITH THIS APPLICATION PROG TCB           * 59300010
*                                                                     * 59350010
         LR    RCIB,RPARM               ADDRESS OF CIB                  59400010
         L     RPCB,AVTPCBPT            ADDRESS OF FIRST PCB IN         59500010
*                                       TCAM MCP PCB CHAIN              59600010
         L     RCVT,CVT                 SETUP CVT ADDRESS      @YM07826 59650010
         L     RTCB,ZERO(,RCVT)         GET NEW-OLD POINTER      Y05330 59700010
         L     RTCB,FOUR(,RTCB)         CURRENT TCB POINTER      Y05330 59800010
PCBLOOP  EQU   *                                                 Y05330 59900010
         CLM   RTCB,AD,PCBTCBAD+ONE     MATCHING PCB FOR TCB     Y05330 60000010
         BE    PCBGO                    YES, BRANCH                     60100010
         ICM   RPCB,AD,PCBLINK          NEXT PCB ON CHAIN               60200010
         BNZ   PCBLOOP                  CHECK NEXT PCB                  60300010
         LA    RENTRY,NOTCAM            ERROR COMPLETION CODE           60400010
         BR    RETURN                   RETURN TO CALLER OR USER Y05330 60500010
         SPACE 1                                                        60600010
PCBGO    EQU   *                                                        60700010
         LA    RWORK,AVTOPCOB           OPERATOR CONTROL QCB            60800010
         STCM  RWORK,AD,CIBQCBA+1      STORE IN CIB                     60900010
         MVI   CIBSIZE(RCIB),CODE       AQCTL ACTION CODE               61000010
         LA    RWORK,PCBWRKA            TARGET CIB IN PCB               61100010
         ST    RWORK,CIBSIZE+FOUR(,RCIB) STORE IN PARM LIST             61200010
         LA    RWORK,ELEMLEN            ADDR, OF CIB LENGTH             61300010
         ST    RWORK,CIBSIZE+EIGHT(,RCIB) STORE IN PARM LIST            61400010
         MVI   CIBSIZE+EIGHT(RCIB),EOL  SET END OF LIST INDICATOR       61500010
         LA    RONE,CIBSIZE(,RCIB)      ADDR OF AQCTL PARM LIST         61600010
         TM    CIBVERB,CLOSE            CLOSE REQUEST          @YA10424 61700010
         BO    CONT1                    YES CONTINUE           @YA10424 61800010
         TM    PCBOFLG,PCBTSON          TSO SWAPPABLE APPL     @YA10424 61900010
         BZ    CONT1                    NO CONTINUE            @YA10424 62000010
         OI    CIBEND,NOSWAP            MAKE NON-SWAPPABLE     @YA10424 62100010
CONT1    EQU   *                                               @YA10424 62200010
         LA    RECB,CIBSIZE+FOUR(,RCIB) ECB ADDRESS                     62300010
         MVI   CIBPRI,PRIOPCTL          SET OPCTL PRIORITY              62400010
         OI    CIBVERB,OPCFLAG          SET APPL PROG FLAG              62500010
         AQCTL                                                          62600010
         NI    CIBVERB,AVTEFF-OPCFLAG   TURN OF APPL PROG FLAG          62700010
         TM    CIBVERB,CLOSE            MCPCLOSE OR CLOSEMC             62800010
         BO    NOWAIT                   YES, BYPASS WAIT                62900010
         WAIT  ECB=(RECB)               WAIT                            63000010
NOWAIT   EQU   *                                                        63100010
         SR    RENTRY,RENTRY                                            63200010
         STCM  RENTRY,ALL,0(RECB)       CLEAR ECB                       63300010
         LA    RCIB,PCBWRKA             OP CONTROL CIB ADDRESS          63400010
         IC    RENTRY,CIBRC             COMPLETION CODE                 63500010
         BR    RETURN                   RETURN TO CALLER OR USER Y05330 63600010
         EJECT                                                          63700010
         SPACE 2                                                        63800010
GOODOUT  EQU   *                                                        63900010
         SR    RENTRY,RENTRY            GOOD COMPLETION CODE            64000010
EXIT     EQU   *                                                        64100010
EXIT2    EQU   *                                                        64120010
         L     RSAVE,SAVEREGD(,RSAVE)   RESTORE USER SAVE ADDRESS       64200010
         RETURN (14),RC=(15)                                            64400010
         EJECT                                                          64500010
*                                                                     * 64600010
*        PASS WORD  CHECK ROUTINE                                     * 64700010
*                                                                     * 64800010
PASSWORD EQU   *                                                        64900010
         CLC   AVTPASWD,BLANKS          PASS WORD REQUIRED              65000010
         BE    NOPASS                   NO, BRANCH                      65100010
         LTR   R3,R3                    PASSWORD SPECIFIED              65200010
         BZ    PASSERR                  NO BRANCH TO ERROR              65300010
         SPACE 1                                                        65400010
         ICM   RZERO,BY0+BY1,TWO(R3)    SCRAMBLE PASSWORD INTO          65500010
         ICM   RZERO,BY2,ONE(R3)        RZERO & RONE                    65600010
         ICM   RZERO,BY3,SIX(R3)        *                               65700010
         ICM   RONE,BY0,SEVN(R3)        *                               65800010
         ICM   RONE,BY1,ZERO(R3)        *                               65900010
         ICM   RONE,BY2+BY3,FOUR(R3)    *                               66000010
         N     RZERO,NR                 *                               66100010
         N     RONE,NR                  *                               66200010
         X     RZERO,XR                 *                               66300010
         X     RONE,XR                  *                               66400010
         SPACE 1                                                        66500010
         C     RZERO,AVTPASWD           FIRST HALF VALID                66600010
         BNE   PASSERR                  NO,BRANCH                       66700010
         C     RONE,AVTPASWD+4          SECOND HALF VALID               66800010
         BNE   PASSERR                  NO BRANCH                       66900010
NOPASS   EQU   *                                                        67000010
         BR    RETURN                   RETURN,PASSWORK OK              67100010
PASSERR  EQU   *                                                        67200010
         LA    RENTRY,INVPASS           ERROR COMPLETION CODE           67300010
         TM    APLCODE,TCHNGCD          ENTRY FROM TCHNG                67400010
         BO    EXIT                     YES, BRANCH                     67500010
         B     EXIT2                    RETURN TO USER                  67600010
         DROP  RPARM                                                    67700010
         EJECT                                                          67800010
*THIS SUBROUTINE DIFFERENTIATES BETWEEN TTE TYPES THAT         @Y17XARZ 67900010
*REQUIRE ACCESS THRU NCP TO DEV DEP FIELDS AND THOSE           @Y17XARZ 68000010
*TTES THAT DO NOT                                              @Y17XARZ 68100010
*THOSE THAT DO ARE  NCP ATTACHED BSC/SS TERMINALS              @Y17XARZ 68200010
*                                CTERM                         @Y17XARZ 68300010
*                                CLUSTER BSC/SS                @Y17XARZ 68400010
*FOR THOSE THAT DO REQUIRE NCP ACCESS EXIT IS TO RETURN+4      @Y17XARZ 68500010
*OTHERWISE EXIT IS TO ADDRESS IN RETURN REG.                   @Y17XARZ 68600010
         SPACE 3                                                        68700010
TESTTYPE EQU   *                                               @Y17XARZ 68800010
         TM    TRMSTATE,TRMPREF    NCP RESOURCE                @Y17XARZ 68900010
         BZ    ZERO(RETURN)        NO EXIT TO RETURN+0         @Y17XARZ 69000010
         TM    TRMSTATE,TRMLINE    IS IT A LINE TTE            @Y17XARZ 69100010
         BO    ZERO(RETURN)        YES EXIT TO RETURN+0        @Y17XARZ 69200010
*BACK UP TO TTE PREFIX                                         @Y17XARZ 69300010
         S     RTERM,PREFIXL       BACK UP REG                 @Y17XARZ 69400010
         USING IEDNTRM,RTERM       BACK UP DSECT               @Y17XARZ 69500010
         CLI   TRMTYPE,TRMPSNA     BSC/SS TERM                 @Y17XARZ 69600010
         BE    TESTTINC            YES                         @Y17XARZ 69700010
         CLI   TRMTYPE,TRMCTERM    CTERM                       @Y17XARZ 69800010
         BE    TESTTINC            YES                         @Y17XARZ 69900010
         CLI   TRMTYPE,TRMCLUST    BSC/SS CLUSTER              @Y17XARZ 70000010
         BNE   TSTBTOP             NO                          @Y17XARZ 70100010
TESTTINC LA    RETURN,FOUR(RETURN) SET RETURN POINT AT +4      @Y17XARZ 70200010
TSTBTOP  A     RTERM,PREFIXL       POINT TO TTE POS PORTION    @Y17XARZ 70300010
         USING IEDQTRM,RTERM       RESET DSECT                 @Y17XARZ 70400010
         BR    RETURN              EXIT                        @Y17XARZ 70500010
         EJECT                                                          70600010
*                                                                     * 70700010
*          CONSTANTS  AND  EQUATES                                    * 70800010
*                                                                     * 70900010
NOSWAP   EQU   X'10'                    FLAG TO REQUEST THAT   @YA10424 71000010
*                                       APPL BE NON-SWAPPABLE  @YA10424 71100010
CVT      EQU   16                       CVT ADDRESS                     71200010
TWELVE   EQU   12                                                Y05330 71300010
DIALDIG  EQU   X'40'                    DIAL DIGITS              Y05330 71400010
ADDRCHR  EQU   X'20'                    ADDRESS CHARACTERS       Y05330 71500010
DIGITS   EQU   X'01'                                             Y05330 71600010
CHARS    EQU   X'02'                                             Y05330 71700010
NOPEN    EQU   12                       DCB NOT OPEN                    71800010
ID       EQU   X'C0'                    TCAM DEB ID                     71900010
PROCFLG  EQU   X'20'                    PROCESS ENTRY ID                72000010
INVTN    EQU   X'20'                    INVALID TERMINAL                72100010
TTERR    EQU   X'20'                    INVALID TERMINAL TYPE           72200010
MAXI     EQU   256                                                      72300010
TCOPYCD  EQU   X'80'                    ENTRY FROM TCOPY                72400010
TCHNGCD  EQU   X'20'                    ENTRY FROM TCHNG                72500010
APLQETCD EQU   X'08'                    ENTRY FROM QET                  72600010
PRIRTBFR EQU   X'D4'                                                    72700010
HALFWORD EQU   3                                                        72800010
AD       EQU   7                        ADDRESS MASK                    72900010
BY0      EQU   8                        BYTE                            73000010
BY1      EQU   4                            MASKS                       73100010
BY2      EQU   2                                  FOR                   73200010
BY3      EQU   1                                      OFFSET            73300010
ZERO     EQU   0                                                        73400010
ONE      EQU   1                                            LENGTH      73500010
TWO      EQU   2                        FOR                             73600010
FOUR     EQU   4                            PASSWORD                    73700010
SIX      EQU   6                                    SCRAMBLER           73800010
SEVN     EQU   7                                                        73900010
EIGHT    EQU   8                                                        74000010
QE8DISP  EQU   48                       IEDQE8 DISPLACEMENT             74100010
CHARLNTH EQU   10                       DEVICE CHAR ENTRY LENGTH        74200010
SAVEREG2 EQU   28                       REG 2 DISPLACEMENT IN           74300010
*                                       SAVE AREA                       74400010
SAVEREGD EQU   4                        REG 13 DISP IN SAVE AREA        74500010
PCBLCADD EQU   12                       MCP PCB/LCB/SCB ADDRESS         74600010
INVPASS  EQU   X'14'                    INVALID PASSWORD                74700010
BLANKS   DC    CL8' '                   NO PASSWORD                     74800010
CLOSE    EQU   X'10'                                                    74900010
TSO      EQU   4                                                        75000010
NOTCAM   EQU   X'0C'                                                    75100010
CODE     EQU   X'0C'                    AQCTL CODE FOR MOVE             75200010
*                                       AND POST                        75300010
EOL      EQU   X'80'                    END OF LIST INDICATOR           75400010
OPCFLAG  EQU   X'20'                                                    75500010
ALL      EQU   15                                                       75600010
ELEMLEN  DC    H'28'                    CIB LENGTH                      75700010
         DS    0F                                                       75800010
NR       DC    4X'BF'                   NON BLANK MASK                  75900010
XR       DC    4X'0F'                   BIT FLIPPER                     76000010
MAX      DC    F'255'                   MASK FOR MOVE COMPARE           76100010
MAXIM    DC    H'256'                   MAX VALUE TO SUBTRACT           76200010
*                                       FOR MOVE LOOP                   76300010
PREFIXL  DC    A(TRMPRFSZ)              LENGTH OF PREFIX TTE   @Y17XARZ 76400010
ANDMASK  DC    X'00008000'              BIT MASK FOR TCHNG     @Y17XARZ 76500010
R3OFFSET EQU   12                       OFFSET INTO SAVEAREA   @Y17XARZ 76600010
R5OFFSET EQU   16                       OFFSET INTO SAVEAREA   @Y17XARZ 76700010
R8OFFSET EQU   20                       OFFSET INTO SAVEAREA   @Y17XARZ 76800010
R14INDEX EQU   20                       OFFSET INTO SAVEAREA   @Y17XARZ 76900010
FULLWORD EQU   15                       NUMBER OF BYTES WANTED @Y17XARZ 77000010
LOOPCT   EQU   12                       PASS CTR FOR TCHNG     @Y17XARZ 77100010
SRCHSTAT EQU   0              BYTE 0 OF SRCHTBLE IS TRMSTATE   @Y17XARZ 77200010
*                             VALUE WITH LOW ORDER BITS OFF    @Y17XARZ 77300010
SRCHTYPE EQU   1              BYTE 1 OF SRCHTBLE IS TRMTYPE    @Y17XARZ 77400010
SRCHMASK EQU   2              BYTE 2 OF SRCHTBLE IS OFFSET     @Y17XARZ 77500010
*                             FROM START OF TCHNG MASK TABLE   @Y17XARZ 77600010
*                             ANCHORED AT AVTOPMSK TO MASK     @Y17XARZ 77700010
*                             FOR THAT TTE TYPE                @Y17XARZ 77800010
SRCHTBLE EQU   *              TABLE TO DETERMINE TCHNG MASK    @Y17XARZ 77900010
SPRCNTY  EQU   *                        TPROCESS EQUATE        @Y17XARZ 78000010
         DC    X'200012'      TPROCESS                         @Y17XARZ 78100010
SRCHTBEL EQU   *-SRCHTBLE               EST. ENTRY LENGTH      @Y17XARZ 78200010
SRLSTNTY EQU   *                        LIST ENTRY EQUATE      @Y17XARZ 78300010
         DC    X'400010'      TLIST                            @Y17XARZ 78400010
         DC    X'600002'      LOG                              @Y17XARZ 78500010
         DC    X'800002'      270X/EP DIAL                     @Y17XARZ 78600010
         DC    X'90000E'      NCP LINE                         @Y17XARZ 78700010
         DC    X'90200E'      NCP BSC/SS LINE                  @Y17XARZ 78800010
         DC    X'90210E'      NCP SNA LINE                     @Y17XARZ 78900010
         DC    X'100F0C'      NCP                              @Y17XARZ 79000010
         DC    X'101806'      PU                               @Y17XARZ 79100010
         DC    X'103008'      LU                               @Y17XARZ 79200010
         DC    X'104004'      BSC/SS CLUSTER                   @Y17XARZ 79300010
         DC    X'104804'      CTERM                            @Y17XARZ 79400010
         DC    X'104F04'      PRE SNA                          @Y17XARZ 79500010
         DC    X'10FF0A'      SSCP                             @Y17XARZ 79600010
SRCHEND  EQU   *                                               @Y17XARZ 79700010
SRCHMSK  EQU   X'F0'          RESETS LO BITS OF TRMSTATE       @Y17XARZ 79800010
SRCHLIM  EQU   (SRCHEND-SRCHTBLE)/SRCHTBEL NO. OF ENTERIES IN  @Y17XARZ 79900010
*                                       TABLE                  @Y17XARZ 80000010
MOVER    DS    0H                                                       80100010
         MVC   ZERO(ONE,RWORK),ZERO(RTEMP) MOVE DATA                    80200010
MOVEDD   DS    0H                                                       80300010
         MVC   ZERO(ONE,RTEMP),ZERO(RETURN) MOVE DD FIELDS              80400010
MOVEM    DS    0H                                                       80500010
         MVC   ZERO(ONE,RTEMP),TRMOPT       MOVE OPTIONS                80600010
MOVEOPT  DS    0H                                                       80700010
         MVC   ZERO(ONE,RTEMP),ZERO(RWORK)  TCHNG MOVE OPTION           80800010
         EJECT                                                          80900010
***                 DSECTS                             ***              81000010
         TAVTD                                                          81100010
         TTRMD                                                          81200010
         TTNTD                                                          81300010
         TTCBD                                                          81400010
         TDEBAPD                                                        81500010
ETCVT    DSECT                                                          81600010
         CVT                                                            81700010
         TPCBD                                                          81800010
         TPRIOR                                                         81900010
         TPRFD                                                          82000010
         TACSMD                                                @YA10702 82100010
IEDQCIB  DSECT                          COMMAND INPUT BUFFER(CIB)       82200010
CIBQCBA  DS    F                        OPERATOR CONTROL QCB            82300010
CIBPRI   DS    FL1                      CIB PRIORITY                    82400010
CIBLINK  DS    XL3                      LINK FIELD                      82500010
CIBVERB  DS    FL1                      COMMAND VERB CODE               82600010
CIBLEN   DS    XL1                      LENGTH OF CIB                   82700010
CIBLRN   DS    XL1                      REL LINE NO                     82800010
CIBRC    DS    XL1                      COMPLETION CODE                 82900010
CIBECBA  DS    F                        ECB                             83000010
CIBTNAME DS    0XL8                     TERMINAL LENGTH          Y05330 83100010
CIBTO    DS    F                        TARGET ADDRESS           Y05330 83200010
CIBFROM  DS    F                        SOURCE ADDRESS           Y05330 83300010
CIBICHNG DS    0F                       ICHNG WORK AREA          Y05330 83400010
CIBTNTX  DS    H                        TERMNAME INDEX           Y05330 83500010
CIBRQTG  DS    H                        REQUEST SEQ NUMBER       Y05330 83600010
CIBEND   DS    0XL1                     END OF CIB                      83700010
CIBSIZE  EQU   CIBEND-IEDQCIB           LENGTH OF CIB                   83800010
IEDQTIOT DSECT                          TIOT DD ENTRY                   83900010
TIOELNGH DS    XL1                      LENGTH OF DD ENTRY              84000010
TIOESTTA DS    XL1                      STATUS BYTE A                   84100010
TIOERLOC DS    XL2                      ERROR LOCATION                  84200010
TIOEDDNM DS    XL8                      DDNAME                          84300010
APLCOPYD DSECT                          USER PARAMETER LIST             84400010
APLCODE  DS    FL1                      ENTRY CODE                      84500010
APLTERM  DS    3X                       ADDRESS OF TERMNAME             84600010
APLUSEWK DS    F                        ADDRESS OF USER WORK AREA       84700010
APLPASS  DS    F                        ADDRESS OF PASSWORD             84800010
APLRNLST DS    F                        3705 PARAMETER LIST PTR  Y05330 84900010
APLSAVE2 DS    F                        SECONDARY SAVE POINTER  SA61775 85000010
         SPACE 1                                                        85100010
APLDDNME EQU   APLTERM                  DDNAME ADDRESS                  85200010
APLRELNO EQU   APLUSEWK                 REL LINE NO                     85300010
APLQPASS EQU   APLTERM                                                  85400010
APLRCODE EQU   APLUSEWK                                                 85500010
APLTYPE  EQU   APLUSEWK                 RETRIEVAL TYPE                  85600010
         TMSKD                                                          85700010
APLRNUMB EQU   APLPASS                                                  85800010
         END                                                            85900010
