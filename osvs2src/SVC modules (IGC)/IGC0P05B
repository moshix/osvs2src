         GBLC  &LIB                                                     00030020
&LIB     SETC  'LIB1'                   SET VARIABLE TO LIB1            00060020
         TITLE 'IGC0P05B DATA SET PROCESSOR - NON-DA TABLE REFORMATTINGX00100019
                   REPOSITION I/O  RESTART - SVC 52  OS/360'            00200019
IGC0P05B CSECT                                                          00300019
*                                                                       00400019
*                                                                       00500019
*          RELEASE 21 DELETIONS/CHANGES                                 00600019
*0794334000-335000                                               S21040 00650021
*          RELEASE 20 DELETIONS/CHANGES                                 00700019
*          RELEASE 19 - COMPLETE REVISION                               00800019
* 365000,369000,372000                                           M4887  00900019
* 215000,415000                                                  M3525  01000019
*                                                                       01100019
*                                                                       01200019
*STATUS CHANGE LEVEL 004                                                01300021
*                                                                       01400019
*********************************************************************** 01500019
*                                                                       01600019
*TITLE - NON DA TABLE REFORMATTING                                      01700019
*                                                                       01800019
*FUNCTION/OPERATION - A.  REFORMAT BUFFER SEGMENTS (RSDSECT) INTO 200   01900002
*                         BYTE WORK AREAS.  DO A CONDITIONAL GETMAIN    02000019
*                         IF NECESSARY TO TRY TO ALLOT ONE 200 BYTE     02100002
*                         AREA TO EACH TAPE DATA SET OPEN AT CHKPT TIME 02200019
*                                                                       02300019
*                     B.  FORM A LOGICAL LINK BETWEEN TABL ELEMENTS     02400019
*                         AND THE NEW WORK AREAS, IE. A POINTER TO A    02500019
*                         WORK AREA IN EACH TABL ELEMENT THAT REPRESENT 02600019
*                         A TAPE DATA SET.                              02700019
*                                                                       02800019
*                     C.  TEST EACH TAPE ENTRY FOR DOS TAPE OPTIONS     02810021
*                         (BYPASS OPTIONAL LEADING TAPE MARK AND/OR     02820021
*                         BYPASS EMBEDDED CHKPT RCDS).  TABFLG1 BIT     02830021
*                         7 WILL BE SET FOR THESE ENTRIES TO INDICATE   02840021
*                         THAT THEY ARE TO BE POSITIONED BY IGC0U05B.   02850021
*                         ONLY THE FIRST 3 WORK AREA SEGMENTS WILL BE   02860021
*                         USED FOR THESE ENTRIES, WITH THE FOURTH       02870021
*                         USED AS A BUFFER IN IGC0U05B.                 02880021
*                                                                       02890021
*ENTRY POINTS - IGC0P05B - INITIAL ENTRY TO THIS MODULE BY MEANS OF AN  02900019
*                          XCTL FROM IGC0L05B OR IGC0Q05B.              03000019
*                                                                       03100019
*INPUT - REGISTER 8   BEGINNING OF DCB TABLE                            03200019
*        REGISTER 1   USER BUFFER AREA                                  03300019
*        REGISTER 10  USER BUFFER AREA                                  03350002
*        ALL OPENED DCB (S) WITH THEIR ASSOCIATED CONTROL BLOCKS        03400019
*        THE 48 BYTE TABLE ENTRY (IES) THAT IS (ARE) USED IN RESTART    03500019
*        RESTART WORKAREA                                               03600019
*                                                                       03700019
*OUTPUT - REGISTER 8   BEGINNING OF DCB TABLE                           03800019
*         REGISTER 1   USER BUFFER AREA                                 03900019
*         REGISTER 6   SECONDARY WORK AREA GOTTEN IN THIS MODULE        04000019
*         REGISTER 12  USER BUFFER AREA                                 04050002
*                                                                       04100019
*EXTERNAL ROUTINE - NONE                                                04200019
*                                                                       04300019
*EXITS - NORMAL - XCTL TO IGC0S05B, IGC0R05B, OR IGC0T05B               04400002
*                                                                       04500019
*      - ERROR - NONE                                                   04600019
*                                                                       04700019
*TABLES/WORKAREAS - THE WORKAREA USED IS DESCRIBED BY THE DSECTS AT THE 04800019
*                   END OF THE LISTING.                                 04900019
*                                                                       05000019
*********************************************************************** 05100019
*                                                                     * 05200019
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 05300019
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 05400019
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 05500019
*    IS 48 BYTES LONG.                                                * 05600019
*                                                                     * 05700019
*********************************************************************** 05800019
*                                                                       05900019
*        ------------------- 4 BYTES -----------------                  06000019
*                                                                       06100019
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  06200019
*        +DATA SET  +           DCB                  +                  06300019
*        + ORGN.    +         ADDRESS                +                  06400019
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                06500019
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  06600019
*        + NO. 1    +         ADDRESS                +                  06700019
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  06800019
*        +NUMBER    +         JFCB TTR               +                  06900019
*        + OF VOLS  +         ADDRESS                +                  07000019
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07100019
*                                                                       07200019
*     12 +++++++++++++++++++++++                                        07300019
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   07400019
*        +INFO BYTE + NUMBER   +                                        07500019
*        +++++++++++++++++++++++                                        07600019
*                                                                       07700019
*     12 +++++++++++++++++++++++                                        07800019
*        +    OLD   TIOT       +        DA AND UNIT RECORD              07900019
*        +      OFFSET         +                                        08000019
*        +++++++++++++++++++++++                                        08100019
*                                                                       08200019
*                              +++++++++++++++++++++++                  08300019
*                              +FLAG BYTE +FLAG BYTE +                  08400019
*                              +  NO. 2   +  NO. 3   +                  08500019
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  08600019
*        +FLAG BYTE +FLAG BYTE +                     +                  08700019
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  08800019
*        +++++++++++++++++++++++                     + 20               08900019
*        +                                           +                  09000019
*        +                                           +                  09100019
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  09200019
*        +                                           +                  09300019
*        +   VOLUME ID NO. 2                         +                  09400019
*        +                     +++++++++++++++++++++++ 28               09500019
*        +                     +                     +                  09600019
*        +                     +   VOLUME ID NO. 3   +                  09700019
*     32 +++++++++++++++++++++++                     +                  09800019
*        +                                           +                  09900019
*        +                                           +                  10000019
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               10100019
*        +                                           +                  10200019
*        +   VOLUME &D NO. 4                         +                  10300019
*     40 +                     +++++++++++++++++++++++                  10400019
*        +                     +                     +                  10500019
*        +                     +                     +                  10600019
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               10700019
*        +                                           +                  10800019
*        +                                           +                  10900019
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               11000019
*                                                                       11100019
*                                                                       11200019
*ATTRIBUTES - REENTRANT                                                 11300019
*             REUSABLE                                                  11400019
*             ENABLED                                                   11500019
*             PRIVILEGED                                                11600019
*                                                                       11700019
*********************************************************************** 11800019
*                                                                       11900019
*                                                                       12000019
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12100019
*                                                                       12200019
*********************************************************************** 12300019
*                                                                       12400019
WRKR1    EQU   0                        WORK/PARAMETER REGISTER         12500019
WRKR2    EQU   1                        WORK/PARAMETER REGISTER         12600019
DCBR     EQU   2                        CURRENT DCB REGISTER            12700019
WRKR3    EQU   12                       WORK REGISTER                   12800019
WRKR4    EQU   13                       WORK REGISTER                   12900019
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         13000019
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         13100019
*********************************************************************** 13200019
*                                                                       13300019
*    REGISTERS FOR IGC0P05B                                             13400019
*                                                                       13500019
*********************************************************************** 13600019
R1       EQU   1                                                        13700019
PRIMENO  EQU   2                       NUMBER OF PRIME WORK AREAS       13800019
BASER    EQU   3                       BASE REGISTER                    13900019
SECONDNO EQU   4                       NUMBER OF SECONDARY WORK AREAS   14000019
PPTABR1  EQU   5                       POINTER TO PRIME AREA            14100019
PPTABR2  EQU   6                       POINTER TO SECONDARY WORK AREA   14200019
WACNTR   EQU   7                       NUMBER OF WORK AREAS FORMATTED   14300019
TABLR    EQU   8                       POINTER TO FIRST TABL ELEMENT    14400019
CTABLR   EQU   9                       POINTER TO CURRENT TABL ELEMENT  14500019
BUFR     EQU   10                      POINTER TO RSTWA                 14600019
DSCNTR   EQU   11                      NUMBER OF DATA SETS              14700019
R13      EQU   13                                                       14800019
R15      EQU   15                                                       14900019
*                                                                       15000019
*********************************************************************** 15100019
*                                                                       15200019
*    OFFSETS TO BE USED IN REPI/O PHASE                                 15300019
*                                                                       15400019
*********************************************************************** 15500019
*                                                                       15600019
DAFLG    EQU   X'80'                    INDICATES DA DATA SET    M3525  15630019
*                                       PRESENT                  M3525  15660019
TABENT   EQU   48                       TABLE ENTRY LENGTH              15900019
UNRELCC  EQU   X'42'                                                    16100019
DEBID    EQU   X'0F'                                                    16200019
D0       EQU   0                                                        16300019
D1       EQU   1                                                        16400019
D4       EQU   4                                                        16500019
D8       EQU   8                                                        16600019
D40      EQU   40                      CONSTANT 40               Y02049 16650002
L2       EQU   2                                                        16700019
X02      EQU   X'02'                   CONSTANT OF 2             Y02049 16750002
L3       EQU   3                                                        16800019
L8       EQU   8                                                        16900019
L48      EQU   48                                                       17000019
L128     EQU   128                                                      17100019
ZERO     EQU   0                                                        17300019
*                                                                       17420021
LTM      EQU   X'21'                   BYPASS DOS LEADING TM     S21040 17440021
CHKPT    EQU   X'10'                   BYPASS EMBEDDED CHKPT RCD S21040 17460021
DOSTAPE  EQU   X'01'                   INDICATE DOS TAPE         S21040 17480021
*                                                                       17500019
*********************************************************************** 17600019
*                                                                       17700019
         BALR  BASER,ZERO               ESTABLISH ADDRESSABILITY        17800019
         USING *,BASER                 BASE REGISTER                    17900019
         B     BEGIN               BRANCH AROUND EYE CATCHER     Y01909 17950000
         CNOP  0,8                 ALIGN TO A DBL WORD BOUNDARY  Y01909 17960000
         DC    C'IGC0P05B'         CSECT NAME                    Y01909 17970000
BEGIN    EQU   *                                                 Y01909 17980000
         USING TABL,CTABLR             TABL BASE REGISTER               18000019
         USING RSTWA,BUFR              RESTART WORK AREA                18100019
         USING RSDSECT,PPTABR1         UNTIL REPDCB05                   18200019
*        USING RSDSECT,WRKR3           AFTER REPDCB05                   18300019
*                                                                       18400019
         LA    WRKR2,D0(WRKR2)         ZERO HIGH ORDER BYTE             18500019
         LR    CTABLR,TABLR            INITIALIZE TABL POINTER          18600019
         LR    BUFR,WRKR2              SAVE POINTER TO RSTWA            18700019
         L     PPTABR1,TABSEGAD-D1     ADDRESS OF PRIME WORK AREA       18800019
         LA    PPTABR1,D0(PPTABR1)     ZERO HIGH ORDER BYTE             18900019
         SR    PPTABR2,PPTABR2         INIT SECONDARY WORK AREA PTR     19000019
*                                                                       19100019
REPDCB00 EQU   *                                                        19200019
*                                                                       19300019
*        COUNT THE TABL ELEMENTS WHICH REPRESENT TAPE DEVICES AND       19400019
*        KEEP TOTAL IN REG DSCNTR                                       19500019
         SR    DSCNTR,DSCNTR                                            19600019
*                                                                       19700019
REPDCB01 TM    TABFLG1,TABTAPE         IS IT TAPE DEVICE                19800002
         BNO   REPDCB02                BRANCH NO TO GET NEXT ENTRY      19900019
         TM    TABFLG2,TABRSDS          IS THIS RESTART D/S      YM5359 19950002
         BO    REPDCB02                 IF YES,SKIP THIS NTRY    YM5359 19960002
         LA    DSCNTR,D1(DSCNTR)       ADD ONE TO COUNTER               20000019
*                                                                       20100019
*                                                                       20200019
REPDCB02 EQU   *                                                        20300019
*                                                                       20400019
         TM    TABFLG1,TABLAST         IS THIS THE LAST ENTRY           20500002
         BO    REPDCB03                BR YES TO CHECK SIZE OF W.A.     20600019
         LA    CTABLR,TABENT(CTABLR)   INCREMENT TABLR POINTER          20700019
         B     REPDCB01                GO TO COUNT THIS ENTRY           20800019
*                                                                       20900019
*        DSCNTR NOW CONTAINS NUMBER OF TAPES TO BE REPOSITIONED         21000019
*        NEXT, COMPUTE SIZE OF WORK AREA NEEDED TO PROCESS ALL          21100019
*        TAPES IN PARALLEL                                              21200019
*                                                                       21300019
REPDCB03 EQU   *                                                        21400019
         LTR   PRIMENO,DSCNTR           TEST/SET CNTR FOR NUMBER M3525  21440019
*                                       OF WORKAREAS             M3525  21480019
         BZ    REPDCB25                 IF COUNT IS 0, NO TAPE   M3525  21520019
*                                       PROCESSING NECESSARY     M3525  21560019
         SR    SECONDNO,SECONDNO       NO SECONDARY WORKAREA            21600019
*                                                                       21700019
         LR    WRKR1,BUFR              ADDRESS OF BEGINNING OF RSTWA    21800019
         A     WRKR1,RSWACL            LENGTH OF RSTWA                  21900019
         SH    WRKR1,QMWKALNG          SET ASIDE QMNGR WA SPACE  Y02049 21950002
         ST    WRKR1,RSSSCR            SAVE ADDR FOR IGC0S05B    Y02049 21970002
         SR    WRKR1,PPTABR1           LENGTH OF WORK AREA AVAILABLE    22000019
*                                                                       22100019
         LA    WRKR4,PPTABENT          SIZE OF WORK AREA FOR EACH ENTRY 22200019
         MR    WRKR3,DSCNTR            SIZE OF AREA NEEDED IN WRKR4     22300019
         SR    DSCNTR,DSCNTR           ZERO REGISTER TO INDICATE        22400019
*                                      LENGTH OF SECONDARY WORK AREA    22500002
         CR    WRKR1,WRKR4             WORK AREA LARGE ENOUGH           22600019
         BNL   REPDCB15                BRANCH YES TO FORMAT WORK AREA   22700019
*                                                                       24900019
*                                                                       25000019
*        TO ALLOW FOR SEGMENTED WORKAREAS THE SIZE MUST BE ROUNDED UP   25100019
*        TO A 200 BYTE MULTIPLE AND THE NUMBER OF AREAS IN EACH SECTION 25200002
*        MUST BE COMPUTED                                               25300019
*                                                                       25400019
REPDCB14 EQU   *                                                        25500019
         SR    WRKR4,WRKR1             CALC EXTRA SPACE NEEDED  ZA00608 25550002
         SR    WRKR3,WRKR3             ZERO EVEN REGISTER FOR DIVIDE    25600019
         LA    WRKR5,PPTABENT          SIZE OF EACH ENTRY               25700019
         DR    WRKR3,WRKR5             NUMBER OF ENTRIES IN WRKR4       25800019
*                                      REMAINDER IN WRKR3               25900019
*                                                                       26000019
         LTR   WRKR3,WRKR3             IS REMAINDER ZERO                26100019
         BZ    REPDCB04                BRANCH YES TO MULTIPLY BACK      26200019
         LA    WRKR4,D1(WRKR4)         ADD ONE TO ROUND UP              26300019
REPDCB04 EQU   *                                                        26400019
         SR    PRIMENO,WRKR4           NO OF AREAS IN PRIME WORK AREA   26500019
         LR    SECONDNO,WRKR4          AREAS NEEDED FOR SECOND W. A.    26600019
         MR    WRKR3,WRKR5             WRKR4 IS SIZE FOR GETMAIN AS 200 26700002
*                                         BYTE MULTIPLE                 26800019
*                                                                       26900019
*                                                                       27000019
*                                                                       27100019
*                                                                       27200019
         XC    GOTLOC(L8),GOTLOC       CLEAR GETMAIN RETURN AREA        27300019
         LA    WRKR1,PPTABENT          MINIMUM FOR GETMAIN              27400019
         ST    WRKR1,SIZELOC                IS ENOUGH FOR ONE WORK AREA 27500019
         ST    WRKR4,SIZELOC+D4        MAXIMUM SIZE FOR GETMAIN         27600019
         LA    R1,GETLIST              ADDR OF PARAM LIST FOR GETMAIN   27700019
         LA    R13,GETSAVE             SAVE AREA FOR GETMAIN            27800019
*                                                                       27900019
         GETMAIN VC,LA=SIZELOC,A=GOTLOC,SP=250,MF=(E,(1))               28000019
*                                                                       28100019
*                                                                       28200019
*        NOW DETERMINE HOW MUCH CORE, IF ANY, WAS GOTTEN                28300019
*        THEN GO TO REPDCB05 TO FORMAT THE AREAS                        28400019
*        GOTLOC CONTAINS THE ADDRESS OF THE GOTTEN CORE                 28500019
*        GOTLOC + 4 CONTAINS THE SIZE OF THE GOTTEN CORE                28600019
*                                                                       28700019
         LTR   R15,R15                 TEST RETURN CODE FROM GETMAIN    28800019
         BNZ   REPDCB13                NO GOTTEN CORE                   28900019
*                                                                       29000019
         LA    WRKR5,PPTABENT          SIZE OF EACH WORK AREA           29100019
         L     WRKR4,GOTLOC+D4         SIZE OF GOTTEN AREA              29200019
         LR    DSCNTR,WRKR4            SAVE LENGTH OF 2ND WORK AREA     29300019
         SR    WRKR3,WRKR3             ZERO EVEN REGISTER FOR DIVIDE    29400019
*                                                                       29500019
         DR    WRKR3,WRKR5             NUMBER OF ENTRIES IN WRKR4       29600019
*                                                                       29700019
         LR    SECONDNO,WRKR4          SAVE NUMBER OF ENTRIES           29800019
         L     PPTABR2,GOTLOC          ADDRESS OF SECOND WORK AREA      29900019
         B     REPDCB15                GO FORMAT WORK AREA              30000002
REPDCB13 EQU   *                                                        30100019
         SR    SECONDNO,SECONDNO       NO SECONDARY WORK AREAS          30200019
REPDCB15 EQU   *                                                        31300019
*                                                                       31400019
         USING RSDSECT,WRKR3                                            31500019
*                                                                       31600019
         SR    WRKR6,WRKR6             ZERO FORMATTING SWITCH           31700019
         SR    WRKR4,WRKR4             ZERO INDICATES PRIME WORK AREA   31800019
         LR    CTABLR,TABLR            REINITIALIZE BASE FOR TABL ELTS  31900019
*                                                                       32000019
REPDCB17 EQU   *                                                        32100019
*                                                                       32200019
         TM    TABFLG1,TABTAPE         IS IT TAPE                       32300002
         BNO   REPDCB18                BRNCH NO TO GET NEXT NTRY YM5359 32400002
         TM    TABFLG2,TABRSDS          IS IT RESTART TAPE       YM5359 32450002
         BNO   REPDCB06                 IF NOT CONTINUE          YM5359 32460002
*                                                                       32500019
REPDCB18 LA    CTABLR,TABENT(CTABLR)   INCREMENT TABL POINTER           32600002
         B     REPDCB17                GO TO CHECK FOR TAPE             32700019
*                                                                       32800019
REPDCB06 LR    WRKR3,PPTABR1           POINT TO PRIME AREA              32900019
         LR    WRKR5,PRIMENO           NO OF ELTS AVAILABLE             33000019
*                                                                       33100019
REPDCB07 SR    WACNTR,WACNTR                                            33200019
*                                                                       33300019
REPDCB08 EQU   *                                                 S21040 33400021
         C     WRKR6,MASK3             ARE ALL AREAS FORMATTED          33600019
         BE    REPDCB09                BRANCH YES TO SKIP FORMATTING    33700019
*                                                                       33800019
         XC    D0(PPTABENT,WRKR3),D0(WRKR3) ZERO WORK AREA       Y02049 33900002
*                                                                       34000019
         USING IHADCB,WRKR2                                             34500019
         L     WRKR2,DCBDEBAD          POINTER TO SYSTEM JOBQ DEB       34600019
         L     WRKR2,RSTCBAD           POINTER TO RESTART TCB           34800019
         ST    WRKR2,RSDEBTCB          STORE TCB IN DEB                 34900019
         LA    WRKR2,RSDCBREP          POINTER TO RESTART DEB           35000019
         ST    WRKR2,RSDEBDCB          STORE IN RESTART DEB             35100019
         ST    WRKR2,RSIOBDCB          STORE IN RESTART IOB             35200019
         MVI   RSDEBID,DEBID           STORE IDENTIFICATION FOR DEB     35300019
         L     WRKR2,CVTPTR            GET CVT ADDR              Y02049 35350002
         USING CVT,WRKR2               ADDR CVT                  Y02049 35400002
         L     WRKR2,CVTXAPG           GET ADDR OF IOS APP'S     Y02049 35450002
         ST    WRKR2,RSDEBAPP          STORE IN DEB              Y02049 35500002
         USING IHADCB,WRKR2            RESTORE DCB ADDRESSING    Y02049 35550002
         MVI   RSDEBAPP,X02            SET DEB EXT SCALE         Y02049 35570002
         LA    WRKR2,RSDEB             POINTER TO DEB                   35600019
         ST    WRKR2,RSDCBDEB          STORE IN RESTART DCB             35700019
         MVI   RSIOBFG1,UNRELCC        SET UNRELATED FLAG IN IOB        35800019
         LA    WRKR2,RSECBAD           POINTER TO ECB                   35900019
         ST    WRKR2,RSIOBECB          STORE IN RESTART IOB             36000019
         LA    WRKR2,RSCCWLST          CHANNEL PROGRAM ADDRESS          36100019
         ST    WRKR2,RSIOBCPA          STORE IN RESTART IOB             36200019
*                                                                       36300019
*                                                                       36400019
REPDCB09 EQU   *                                                 M4887  36420019
         LA    WACNTR,D1(WACNTR)        NUMBER OF WORK AREAS     M4887  36440019
*                                       USED                     M4887  36460019
*                                                                       36480019
REPDCB20 EQU   *                                                 M4887  36500019
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY   M4887  36520002
         BO    REPDCB11                BRANCH YES FORMATTING FINISHED   36600019
*                                                                       36700019
         LA    CTABLR,TABENT(CTABLR)                                    36800019
*                                                                       37000019
         TM    TABFLG1,TABTAPE          IS IT TAPE                      37100002
         BNO   REPDCB20                 BRACH NO TO SKIP ELEMENT M4887  37200019
         TM    TABFLG2,TABRSDS          IS IT RESTART TAPE       YM5359 37250002
         BO    REPDCB20                 YES-SKIP THIS NTRY       YM5359 37260002
*                                                                       37300019
         CR    WRKR5,WACNTR            IS THAT THE LAST WORK AREA       37400019
         BNH   REPDCB10                BRANCH YES TO ADJUST POINTERS    37500019
*                                                                       37600019
         LA    WRKR3,PPTABENT(WRKR3)   POINT TO NEXT WORK AREA SEGMENT  37700019
         B     REPDCB08                GO TO FORMAT NEXT ELT            37800019
*                                                                       37900019
*                                                                       38000019
REPDCB10 EQU   *                                                        38100019
         O     WRKR6,MASK1             SET FORMAT SW - 1ST AREA DONE    38200019
         X     WRKR4,MASK1             SWITCH WORK AREAS                38300019
         BZ    REPDCB12                SECONDARY AREA USED              38400019
*                                                                       38500019
*        WE HAVE JUST USED THE PRIME WORK AREA                          38600019
         LTR   SECONDNO,SECONDNO       IS THERE SECONDARY SPACE         38700019
         BZ    REPDCB12                BRANCH NO SECONDARY SPACE        38800019
*                                                                       38900019
         LR    WRKR3,PPTABR2           PTR TO SECONDARY SPACE           39000019
         LR    WRKR5,SECONDNO          NO OF ELTS IN SECOND W.A.        39100019
         B     REPDCB07                GO SET UP TABL                   39200019
*                                                                       39300019
*                                                                       39400019
REPDCB11 EQU   *                                                        39500019
         LR    WRKR3,PPTABR1           POINTER TO FIRST WORK AREA       39600019
         STH   DSCNTR,RSSTAT3          PASS LENGTH OF 2ND WORK AREA     39700019
*                                                                       39701021
*        PLACE WORKAREA SEGMENT ADDRESSES IN DCB TABLE ENTRIES.         39702021
*        USE ONLY FIRST THREE SEGMENTS FOR TAPES WITH DOS OPTIONS       39703021
*        SPECIFIED                                                      39704021
*                                                                       39705021
         USING IHADCB,WRKR2            DCB BASE REGISTER         S21040 39706021
         LR    CTABLR,TABLR            INIT BASE FOR TABLE ENTRY S21040 39707021
         LR    WRKR6,WRKR3             POINTER TO WORK AREA      S21040 39708021
         LR    WRKR5,PRIMENO           NO ELEMENTS IN PRIME W.A. S21040 39709021
*                                                                       39710021
         SR    WACNTR,WACNTR           DOS TAPE COUNTER          S21040 39711021
         SR    WRKR4,WRKR4             NON-DOS TAPE COUNTER      S21040 39712021
         SR    DSCNTR,DSCNTR            INDICATE PRIME W.A.      S21040 39713021
*                                                                       39714021
REPDCB30 EQU   *                                                 S21040 39715021
         TM    TABFLG1,TABTAPE         TAPE DEVICE               S21040 39716002
         BZ    REPDCB55                BRANCH NO                 S21040 39717021
         TM    TABFLG2,TABRSDS          IS IT RESTART TAPE       YM5359 39717402
         BO    REPDCB55                 BR IF YES                YM5359 39717802
*                                                                       39718021
         TM    TABTPLBL,LTM            BYPASS LEADING TAPE MARK  S21040 39719021
         BO    REPDCB45                BRANCH YES TO FLAG ENTRY  S21040 39720021
*                                                                       39721021
         L     WRKR2,TABDCBAD-D1       DCB ADDR FOR THIS ENTRY   S21040 39722021
         TM    DCBMACRF,X'80'           IS THIS EXCP            SA64062 39722402
         BO    REPDCB32                 YES-BYPASS CHKPT TST    SA64062 39722902
         TM    DCBOPTCD,CHKPT          BYPASS CHKPT RCDS         S21040 39724602
         BO    REPDCB45                BRANCH YES TO FLAG ENTRY  S21040 39725002
*                                                                       39725402
REPDCB32 EQU   *                                                SA64062 39725802
         LA    WRKR4,D1(WRKR4)         ADD ONE TO OS TAPE COUNT  S21040 39726021
         ST    WRKR6,TABVLID2          POINTER TO WORK AREA      S21040 39727021
         MVC   TABSEGAD(L3),TABVLID2+D1 MOVE POINTER INTO TABLE  S21040 39728021
*                                                                       39729021
         CR    WRKR4,WRKR5             LAST WORK AREA            S21040 39730021
         BE    REPDCB35                BR YES TO ADJUST POINTERS S21040 39731021
*                                                                       39732021
         LA    WRKR6,PPTABENT(WRKR6)   NEXT W.A. SEGMENT ADDRESS S21040 39733021
         B     REPDCB55                TEST FOR LAST TABLE ENTRY S21040 39734021
*                                                                       39735021
REPDCB35 EQU   *                                                 S21040 39736021
         LTR   DSCNTR,DSCNTR            DETERMINE WORK AREA USED S21040 39737021
         BZ    REPDCB38                 BR ZERO - USED PRIME W.A S21040 39738021
*                                                                       39739021
         SR    DSCNTR,DSCNTR            INDICATE PRIMARY W.A.    S21040 39740021
         B     REPDCB40                                          S21040 39741021
*                                                                       39742021
REPDCB38 EQU   *                                                 S21040 39743021
         LTR   WRKR5,SECONDNO          SECONDAY WORK AREA        S21040 39744021
         BZ    REPDCB40                BRANCH NO SECONDARY SPACE S21040 39745021
*                                                                       39746021
         LA    DSCNTR,D1(DSCNTR)        INDICATE SECONDARY W.A.  S21040 39747021
         LR    WRKR6,PPTABR2           PTR TO SECONDARY SPACE    S21040 39748021
         B     REPDCB55                TEST FOR LAST TABLE ENTRY S21040 39749021
*                                                                       39750021
REPDCB40 EQU   *                                                 S21040 39751021
         SR    WRKR4,WRKR4             INITIALIZE TAPE COUNTER   S21040 39752021
         LR    WRKR6,PPTABR1           PTR TO PRIMARY SPACE      S21040 39753021
         B     REPDCB55                TEST FOR LAST TABLE ENTRY S21040 39754021
*                                                                       39755021
REPDCB45 EQU   *                                                 S21040 39756021
*                                                                       39757021
*        THIS SECTION OF CODE PLACES ADDRESS OF FIRST THREE WORK        39758021
*        AREA SEGMENTS IN THE TAPE TABLE ENTRIES HAVING SPECIFIED       39759021
*        EITHER BYPASS LEADING TAPE MARK AND/OR BYPASS EMBEDDED         39760021
*        CHKPT RCDS (DOS TAPES).                                        39761021
*                                                                       39762021
         OI    TABFLG1,TABDOSTP        INDICATE DOS TAPE         S21040 39763002
         LA    WACNTR,D1(WACNTR)       ADD ONE TO DOS TAPE COUNT S21040 39764021
         ST    WRKR3,TABVLID2          POINTER TO WORK AREA      S21040 39765021
         MVC   TABSEGAD(L3),TABVLID2+D1 MOVE POINTER INTO TABLE  S21040 39766021
*                                                                       39767021
         C     WACNTR,MASK3            THREE AREAS USED          S21040 39768021
         BE    REPDCB50                BR YES TO REINITIALIZE    S21040 39769021
*                                                                       39770021
         LA    WRKR3,PPTABENT(WRKR3)   INCREMENT WORK AREA PTR   S21040 39771021
         B     REPDCB55                TEST FOR LAST TABLE ENTRY S21040 39772021
*                                                                       39773021
REPDCB50 EQU   *                                                 S21040 39774021
         SR    WACNTR,WACNTR           ZERO DOS TAPE COUNTER     S21040 39775021
         LR    WRKR3,PPTABR1           POINT TO PRIME AREA       S21040 39776021
*                                                                       39777021
REPDCB55 EQU   *                                                 S21040 39778021
         TM    TABFLG1,TABLAST         IS THIS THE LAST ENTRY    S21040 39779002
         BO    REPDCB60                BR YES FORMATTING DONE    S21040 39780021
*                                                                       39781021
         LA    CTABLR,TABENT(CTABLR)   INCREMENT DCB TABLE PTR   S21040 39782021
         B     REPDCB30                                          S21040 39783021
*                                                                       39784021
REPDCB60 EQU   *                                                 S21040 39785021
         LR    WRKR3,PPTABR1           PTR TO FIRST WORK AREA    S21040 39786021
         LA    WRKR3,RSCCW2                                             39800019
         MVC   D0(L8,WRKR3),MODNM0S     SET MODULE NAME FOR XCTL        39900019
REPDCB27 EQU   *                                                 M3525  39950019
         LA    WRKR6,D8(WRKR3)                                          40000019
         XC    RSERAS00(D40),RSERAS00  CLEAR SCRATCH AREA        Y02049 40050002
         LR    WRKR2,BUFR              PASS POINTER TO RSTWA            40100002
         LR    WRKR5,WRKR3              SET REG14 TO XCTL P.L.   YM5359 40110002
         LR    WRKR3,BUFR              IN REG 12 TOO             Y02049 40150002
*                                                                       40200019
         XCTL  EPLOC=(WRKR5),SF=(E,(15))                         YM5359 40300002
*                                                                       40400019
*                                                                       40500019
REPDCB12 O     WRKR6,MASK2             SET FORMAT SW - ALL AREA DONE    40600019
         B     REPDCB06                GO TO FORMAT NEXT ENTRY          40700019
REPDCB25 EQU   *                                                 M3525  40710019
         LA    WRKR3,RSCCW2             POINT TO PARM LIST       M3525  40720019
         MVC   D0(L8,WRKR3),MODNM0R     ANTICIPATE IGC0R05B AS   M3525  40730019
*                                       THE NEXT LOAD            M3525  40740019
         TM    RSDCBFLG,DAFLG           IS DA INDICATOR 'ON'     M3525  40750019
         BO    REPDCB27                 IF YES, BR               M3525  40760019
         MVI   D4(WRKR3),C'T'           SET NEXT LOAD TO         M3525  40770019
*                                       IGC0T05B                 M3525  40780019
         B     REPDCB27                 GO XCTL                  M3525  40790019
         EJECT                                                          40800019
*     CONSTANTS USED IN REPI/O                                          40900019
*                                                                       41000019
MASK1    DC    F'1'                     FORMATTING MASK - 1ST AREA      41100019
MASK2    DC    F'2'                     FORMATTING MASK - 2ND AREA      41200019
MASK3    DC    F'3'                     FORMATTING MASK - COMPLETE      41300019
QMWKALNG DC    H'456'                  LENGTH OF QMNGR WORKAREA  Y02049 41350002
*                                      (256) + QMNGR PARM LIST   Y02049 41360002
*                                      (24) + JFCB BUFFER (176)  Y02049 41370002
MAXTRKNO DC    X'7FFF'                  MAX NO OF TRKS - PUT IN DEB     41400019
MODNM0R  DC    C'IGC0R05B'                                       M3525  41460019
MODNM0S  DC    C'IGC0S05B'                                       M3525  41520019
*                                                                       41600019
*                                                                     * 41650000
*        MAINTENANCE SPACE                                       Y01909 41660000
*                                                                     * 41670000
PATCH    DC    XL((*-IGC0P05B)/20)'00'   FIVE PERCENT SPACE      Y01909 41680000
*                                                                     * 41690000
         EJECT                                                          41700019
*********************************************************************** 41800019
*                                                                       41900019
         IEEVRSWA  VER=3                AOS2 VERSION OF WA              42000000
         EJECT                                                          42100019
RSDSECT  DSECT                                                          42200019
*                                                                       42300019
*    DATA EXTENT BLOCK                                                  42400019
*                                                                       42500019
RSDEB    DS    0CL48                                                    42600019
GETSAVE  EQU   RSDEB                                                    42700019
SIZELOC  EQU   GETSAVE+72                                               42800019
GOTLOC   EQU   SIZELOC+8                                                42900019
GETLIST  EQU   GOTLOC+8                                                 43000019
         ORG   GETLIST                  ORG TO DEFINE GETLIST           43100019
         GETMAIN VC,LA=SIZELOC,A=GOTLOC,MF=L                            43200019
         ORG   RSDEB                    RESET I.C.                      43300019
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     43400019
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     43500019
*                                                                       43600019
*    DATA CONTROL BLOCK                                                 43700019
*                                                                       43800019
RSDEBOFL DS    0CL1                                                     43900019
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     44000019
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 44100019
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 44200019
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     44300019
RSDEBID  DS    0CL1                                                     44400019
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        44500019
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      44600019
RSDEBMOD DS    0CL1                                                     44700019
RSDEBUCB DS    F                        UCB ADDRESS                     44800019
RSDEBBIN DS    H                        BIN NUMBER                      44850002
RSDEBSCC DS    H                        CYLINDER START ADDRESS          44900002
RSDEBSHH DS    H                        TRACK START ADDRESS             44950002
RSDEBECC DS    H                        CYLINDER END ADDRESS            45000002
RSDEBEHH DS    H                        TRACK END ADDRESS               45050002
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    45100002
*                                                                       45500019
*    EVENT CONTROL BLOCK                                                45600019
*                                                                       45700019
RSECBAD  DS    CL4                      ECB ADDRESS                     45800019
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     45900019
*                                                                       46000019
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 46100019
*                                                                       46200019
*    INPUT OUTPUT BLOCK                                                 46300019
*                                                                       46400019
RSIOB    DS    0CL40                                                    46500019
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                46600019
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                46700019
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                46800019
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               46900019
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     47000019
RSIOBCSW DS    D                        LAST CSW                        47100019
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         47200019
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     47300019
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         47400019
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           47500019
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            47600019
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             47700019
*                                                                       47800019
*    CHANNEL PROGRAM                                                    47900019
*                                                                       48000019
RSCCWLST DS    0CL24                                                    48100019
RSCCW1   DS    D                        CCW1                            48200019
RSCCW2   DS    D                        CCW2                            48300019
RSCCW3   DS    D                        CCW3                            48400019
*                                                                       48500019
RSSTATUS DS    0CL8                                                     48600019
RSSTAT1  DS    CL1                      STATUS BYTE 1                   48700019
RSSTAT2  DS    CL1                      STATUS BYTE 2                   48800019
RSSTAT3  DS    CL1                      STATUS BYTE 3                   48900019
RSSTAT4  DS    CL1                      STATUS BYTE 4                   49000019
         DS    0F                                                YM7875 49150002
RSPASSFL DS    AL1                      PASSWORD CHK IND         YM7875 49160002
RSTABAD  DS    AL3                      ADR OF CURR USING ENT    YM7875 49170002
RSTLABEL DS    0CL80                    TAPE HDR RECORD          YM7875 49180002
RSHDR    DS    CL3                      LABEL IDENT              YM7875 49190002
RSHDRNUM DS    CL1                      LABEL NO.                YM7875 49192002
RSDATAID DS    CL17                     DATA SET IDENT           YM7875 49194002
         DS    CL32                                              YM7875 49196002
RSDSSECR DS    CL1                      SECURITY IND(DATA SET)   YM7875 49198002
         DS    CL26                     REST OF HDR1             YM7875 49198402
         ORG   RSTLABEL                 DECLARE HDR2             YM7875 49198802
         DS    CL47                     FRONT OF HDR2            YM7875 49199202
RSDSIND  DS    CL1                      CHKPT D.S. INDR          YM7875 49199602
         DS    CL32                     REST OF HDR2             YM7875 49199702
RSSEGEND EQU   *                        LN OF SEG W/A FOR TAPE   YM7875 49199902
PPTABENT EQU   RSSEGEND-RSDSECT         LENGTH OF TAPE WORK SEG  YM7875 49233202
         EJECT                                                          49266702
CVT      DSECT                                                          49300019
         CVT                                                            49400019
         EJECT                                                          49500019
         DCBD  DSORG=PS                                                 49600019
         EJECT                                                          49700019
         IHJDSTAB                                                Y02076 49750002
         END                                                            53900019
