         TITLE 'IGC0R05B  DATA SET PROCESSOR - DA DATA SET POSITIONING *00100018
                      REPOSITION I/O  RESTART-SVC 52  OS/360'           00200018
IGC0R05B CSECT                                                          00300018
*          RELEASE 18 DELETIONS                                         00400018
*0000239000-241000,263000-264000,340000,345000,348000,406000-     M3251 00430018
*0000407000,521000,544000-546000,565000                           M3251 00460018
*          RELEASE 19 DELETIONS                                         00500018
*2555050000,188000-189000,606000-607000,609000-612000,682000,    A25984 00530019
*2555686000-687000,746000                                        A25984 00560019
*          RELEASE 20 DELETIONS                                         00600018
*3523050000,187600                                               A30552 00620020
*3523218000,243000,250700-252000,877200-877400                   A29797 00650020
*          RELEASE 21 DELETIONS                                         00700018
*0790165000,187300-187900,447000,468000,487000-490000,508000-    M0187  00720021
*0790509000,515000,516000,520000,521000-521500,526000,557000-    M0187  00740021
*0790558000,568000-569000,680000-682000,686000,712000-713000,    M0187  00760021
*0790736000-737000,747000-749000,750000                          M0187  00780021
*          RELEASE 22 DELETIONS                                         00800018
*          RELEASE 23 DELETIONS                                         00900018
*          RELEASE 24 DELETIONS                                         01000018
*          RELEASE 25 DELETIONS                                         01100018
*          RELEASE 26 DELETIONS                                         01200018
*       VS2 030 ADDS/DELETES/CHANGES                                    01250037
*213100-213200,256500-256600,276600,287600-288944,679500-682500 ZA02895 01260037
*308425-308438,688500,711500-712999,738500-738988,833500-833800 ZA02895 01270037
*28843610                                                      @ZA08861 01280037
* APAR OZ31491 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01290037
*C151260,151280,507000,513000                                  @ZSUT222 01291037
*A515100-515300,747200                                         @ZSUT222 01294037
* STATUS CHANGE LEVEL 004                                               01300021
*                                                                       01400018
*TITLE-        DA DATA SET POSITIONING                                  01500018
*                                                                       01600018
*STATUS-       INITIAL CODE                                             01700018
*                                                                       01800018
*FUNCTION-     CONTROL IS PASSED FROM IGC0S05B,IGC0U05B,IGC0P05B        01900002
*              OR FROM THE PARTIAL RELEASE FUNCTION OF CLOSE.           01960002
*              THIS MODULE EXAMINES THE DEB'S AND DSCB'S OF DA          01970002
*              SEQUENTIAL OR PARTITIONED DATA SETS TO DETERMINE IF      01980002
*              THE DATA SET HAS BEEN ALTERED SINCE THE CHECKPOINT       01990002
*              OCCURRED.                                                01992002
*                                                                       02400018
*              IF AN ENTRY IN THE TABLE INDICATES THAT A PS OR PO DATA  02500018
*              SET IS RESIDENT ON A DA DEVICE A 464 BYTE WORKAREA JUST  02600018
*              LIKE CLOSE'S IS FORMATTED IN THE RESTART WORKAREA.  THIS 02700018
*              CONTAINS THE CONTROL BLOCKS REQUIRED TO READ THE FORMAT  02800018
*              1 AND, IF NECESSARY, THE FORMAT 3 DSCB'S.                02900018
*                                                                       03000018
*              AFTER THIS THE FORMAT 1 DSCB, AND IF MORE THAN 3 EXTENTS 03100018
*              THE FORMAT 3 DSCB, IS READ.  NEXT THE DEB AND DSCB SPACE 03200018
*              ALLOCATION PARAMETERS ARE COMPARED.  IF THE DEB IS       03300018
*              GREATER THAN THE DSCB  (INDICATING A CLOSE WITH PARTIAL  03400018
*              RLSE) THE DEB IS COMPRESSED.  IF THE DSCB IS GREATER     03500018
*              THAN THE DEB A PARTIAL RELEASE IS EFFECTED VIA THE       03600018
*              PARTIAL RELEASE MODULES OF CLOSE.  BOTH OF THE FOREGOING 03700018
*              APPLY ONLY TO OUTPUT DATA SETS, FOR INPUT DATA SETS AN   03800018
*              ERROR CODE IS SET IF A DISCREPANCY IS ENCOUNTERED AND    03900018
*              CONTROL IS PASSED TO IGC0V05B. AT END-OF-TABLE, IF NO    04000018
*              ERROR IS ENCOUNTERED CONTROL IS PASSED TO IGC0T05B OR    04100002
*              IGC0W05B.                                                04150002
*                                                                       04200018
*ENTRY POINTS - THIS MODULE IS ENTERED FROM:IGC0S05B,IGC0U05B,IGC0P05B  04250002
*                                           AND OPEN PARTIAL RELEASE    04260002
*                                                                       04270002
*INPUT-        REGISTER  1    ADDR OF REPI/O'S WORKAREA                 04300018
*              REGISTER  8    ADDR OF FIRST TABLE ENTRY                 04400018
*              REGISTER  1    PARTIAL RELEASE ERROR RETURN CODE         04500018
*                                                                       04600018
*OUTPUT-       SAME AS REGISTER 1 AND 8 ABOVE                           04700018
*                                                                       04800018
*EXTERNAL REFERENCES -                                                * 04810020
*   SVC 25  -  IGC0002E  -  BSAM TRACK BALANCE ROUTINE.               * 04820020
*      USED FOR D.A. CHECKPOINT DATA SET TO RESTORE DCBTRBAL,         * 04830020
*      AND TO ERASE THE REMAINDER OF THE TRACK.                       * 04840020
*                                                                     * 04850020
*EXITS-        TO PARTIAL RELEASE (IGG020P1)                            04900018
*              NORMAL TO IGC0T05B OR, IF ISAM OR BDAM, TO IGC0W05B      05000020
*              ERROR  TO IGC0V05B WITH ONE OF THE FOLLOWING ERROR       05100037
*              SET IN THE RESTART WORKAREA:                             05120037
*              72 - I/O ERROR READING DSCB                              05140037
*              76 - XTENTS OR LAST TTR'S UNEQUAL: DEB VS DSCB           05160037
*                                                                       05200018
*TABLES/WORKAREAS-                                                      05300018
*                                                                       05400018
*********************************************************************** 05500018
*                                                                     * 05600018
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 05700018
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 05800018
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 05900018
*    IS 48 BYTES LONG.                                                * 06000018
*                                                                     * 06100018
*********************************************************************** 06200018
*                                                                       06300018
*        ------------------- 4 BYTES -----------------                  06400018
*                                                                       06500018
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  06600018
*        +DATA SET  +           DCB                  +                  06700018
*        + O-GN.    +         ADDRESS                +                  06800018
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                06900018
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07000018
*        + NO. 1    +         ADDRESS                +                  07100018
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07200018
*        +NUMBER    +         JFCB TTR               +                  07300018
*        + OF VOLS  +         ADDRESS                +                  07400018
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07500018
*                                                                       07600018
*     12 +++++++++++++++++++++++                                        07700018
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   07800018
*        +INFO BYTE + NUMBER   +                                        07900018
*        +++++++++++++++++++++++                                        08000018
*                                                                       08100018
*     12 +++++++++++++++++++++++                                        08200018
*        +    OLD   TIOT       +        DA AND UNIT RECORD              08300018
*        +      OFFSET         +                                        08400018
*        +++++++++++++++++++++++                                        08500018
*                                                                       08600018
*                              +++++++++++++++++++++++                  08700018
*                              +FLAG BYTE +FLAG BYTE +                  08800018
*                              +  NO. 2   +  NO. 3   +                  08900018
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09000018
*        +FLAG BYTE +FLAG BYTE +                     +                  09100018
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  09200018
*        +++++++++++++++++++++++                     + 20               09300018
*        +                                           +                  09400018
*        +                                           +                  09500018
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  09600018
*        +                                           +                  09700018
*        +   VOLUME ID NO. 2                         +                  09800018
*        +                     +++++++++++++++++++++++ 28               09900018
*        +                     +                     +                  10000018
*        +                     +   VOLUME ID NO. 3   +                  10100018
*     32 +++++++++++++++++++++++                     +                  10200018
*        +                                           +                  10300018
*        +                                           +                  10400018
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               10500018
*        +                                           +                  10600018
*        +   VOLUME ID NO. 4                         +                  10700018
*     40 +                     +++++++++++++++++++++++                  10800018
*        +                     +                     +                  10900018
*        +                     +                     +                  11000018
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11100018
*        +                                           +                  11200018
*        +                                           +                  11300018
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               11400018
*                                                                       11500018
*                                                                       11600018
*ATTRIBUTES-   RE-ENTRANT                                               11700018
*              RE-USABLE                                                11800018
*              ENABLED                                                  11900018
*              PRIVILEGED                                               12000018
*                                                                       12100018
*********************************************************************** 12200018
*                                                                       12300018
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12400018
*                                                                       12500018
*********************************************************************** 12600018
*                                                                       12700018
WRKR1    EQU   0                        WDRK/PARAMETER REGISTER         12800018
WRKR2    EQU   1                        WDRK/PARAMETER REGISTER         12900018
DCBR     EQU   2                        CURRENT DCB REGISTER            13000018
BASER    EQU   3                        BASE REGISTER                   13100018
DEBR     EQU   4                        CURRENT DEB REGISTER            13200018
UCBR     EQU   5                        CURRENT UCB REGISTER            13300018
TIOTR    EQU   6                        NEW TIOT REGISTER               13400018
TCBR     EQU   7                        TCB REGISTER                    13500018
TABLR    EQU   8                        BEGINNING TO DCB TABLE REG      13600018
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      13700018
BUFR     EQU   10                       USER BUFFER AREA                13800018
DSCNTR   EQU   11                       WORK REGISTER                   13900018
WRKR3    EQU   12                       WORK REGISTER                   14000018
WRKR4    EQU   13                       WORK REGISTER                   14100018
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         14200018
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         14300018
*                                                                       14400018
*********************************************************************** 14500018
*                                                                       14600018
*    OFFSETS TO BE USED IN REPI/O PHASE                                 14700018
*                                                                       14800018
*********************************************************************** 14900018
*                                                                       15000018
IS       EQU   X'80'                    INDEXED SEQUENCIAL              15003018
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             15006018
DA       EQU   X'20'                    DIRECT ACCESS                   15009018
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        15012018
NULL     EQU   X'80'                    NULLFILE OR SYSCHECK            15015018
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        15018018
TPDEV    EQU   X'10'                    TAPE DEVICE                     15024018
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           15030018
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            15033018
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                15036018
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         15042018
NSL      EQU   X'04'                    NON-STANDARD LABEL              15045018
SL       EQU   X'02'                    STANDARD LABEL                  15048018
NL       EQU   X'01'                    NO LABEL                        15051018
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          15054018
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                15060018
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            15063018
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                15066018
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               15069018
TABENT   EQU   48                       TABLE ENTRY LENGTH              15072018
WRITE    EQU   X'01'                    WRITE ON TAPE                   15075018
READ     EQU   X'02'                    READ FOR TAPE                   15078018
NOPOP    EQU   X'03'                    NOP                             15081018
SENSE    EQU   X'04'                    SENSE                           15084018
REWIND   EQU   X'07'                    REWIND                          15087018
READBACK EQU   X'0C'                    READBACK                        15090018
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               15093018
WTM      EQU   X'1F'                    WRITE TAPE MARK                 15096018
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             15099018
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              15102018
SEARCH   EQU   X'31'                    SEARCH                          15105018
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             15108018
TIC      EQU   X'08'                    TIC                             15111018
READDA   EQU   X'06'                    READ FOR DA                     15114018
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  15117018
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 15120018
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 15123018
ERR072   EQU   72                       ERROR READING IN DSCB  @ZSUT222 15126037
ERR076   EQU   76                       XTENTS OR LAST TTR'S   @ZSUT222 15128037
*                                       UNEQUAL DEB VS DSCB             15130037
ISORDA   EQU   IS+DA                    IS OR DA                        15135018
IOERROR  EQU   X'20'                    PERMANENT I/O ERROR             15138018
FILETYPE EQU   X'00'                    FILE TYPE BYTE                  15141018
THREE    EQU   X'03'                    TEST IF DSCB EXTN IS TO BE READ 15144018
READKND  EQU   X'0E'                    READ KEY AND DATA               15147018
LENGTH   EQU   X'8C'                    LENGTH OF KEY AND DATA          15150018
OUTP     EQU   X'0F'                    OUTPUT (DEBOPATB)               15153018
EXCHPGM  EQU   X'80'                    EXCP                            15156018
DADEVDPT EQU   X'0C'                    DA DEVICE DEPENDENT SECTION     15159018
WRITEDA  EQU   X'05'                    WRITE FOR DA                    15162018
SEVEN    EQU   X'07'                    TEST FOR GETTING UPPER LIMIT    15165018
LENDSCB  EQU   X'60'                    LENGTH OF DSCB                  15168018
DEBID    EQU   X'0F'                    DEB IDENTIFICATION              15171018
MAXEXT   EQU   X'CA'                    MAXIMUM NO. OF EXTENT           15174018
UNREL    EQU   X'02'                    UNRELATED FLAG                  15177018
TKBAL    EQU   25                       TRACK BALANCE SVC ROUTINE       15180018
CIND2PCI EQU   X'04'                    DCBCIND2 PCI CHAIN SCHED A29797 15190020
DEBPRFLN EQU   16                       LENGTH OF DEB PREFIX     Y02049 15192002
FLG2VAM  EQU   X'20'               VAM INDICATOR IN TABFLG2      Y02049 15192102
DEBEXTLN EQU   16                  LENGTH OF DEB EXTENT          Y02049 15196402
ULEXTNT  EQU   X'40'               INDICATES USER LABEL EXTENT   Y02049 15198002
NOEXTNT  EQU   X'00'               INDICATES NO EXTENT INFO      Y02049 15198402
ONE      EQU   1                   CONSTANT OF ONE               Y02049 15208402
EXTNTYP  EQU   0                   OFFSET TO EXTENT TYPE IN DSCB Y02049 15218402
D0       EQU   0                        CONSTANT ZERO            Y02076 15228402
D1       EQU   1                        CONSTANT ONE             Y02076 15238402
D3       EQU   3                        CONSTANT THREE           Y02076 15238802
D4       EQU   4                        CONSTANT FOUR            Y02076 15239202
D5       EQU   5                        CONSTANT FIVE            Y02049 15239602
D7       EQU   7                        CONSTANT SEVEN           YM7312 15241602
D8       EQU   8                        CONSTANT EIGHT           Y02076 15243002
D16      EQU   16                       CONSTANT SIXTEEN         Y02076 15246402
D20      EQU   20                       CONSTANT TWENTY          Y02076 15249802
D64      EQU   64                       CONSTANT SIXTY FOUR      Y02076 15251802
DF       EQU   X'FF'                    CONSTANT FOX FOX         Y02076 15253202
*                                                                       15256602
*                                                                       15260018
*********************************************************************** 15320018
*                                                                       15400018
         BALR  BASER,0                  ESTABLISH ADDRESSIBILITY        15500018
         USING *,BASER                                           YM7874 15600002
         B     BEGIN                    BR AROUND EYECATCHER     YM7874 15650002
         CNOP  0,8                      ALIGN TO A DBLWD BNDRY   YM7874 15660002
         DC    CL8'IGC0R05B'            MODULE NAME            @ZSUT222 15670037
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZSUT222 15672037
         DC    CL8'@ZSUT222'            LAST CODE SHIPPED      @ZSUT222 15674037
BEGIN    EQU   *                                                 YM7874 15680002
*                                                                       15700018
         USING RSTWA,BUFR                                               15800018
         USING IHADCB,DCBR                                              15900018
         USING TABL,CTABLR                                              16000018
         USING FORECORE,UCBR                                            16100018
         USING TCB,TCBR                                                 16200018
         USING DEBBASIC,DEBR                                     Y02049 16300002
         USING CVT,WRKR2                                                16400018
*                                                                       16600018
*                                                                       16800018
         TM    TABFLG2-TABL(TABLR),TABSW   TEST FOR RETURN FROM PAR REL 16900002
         BO    REPDCB54                 YES - BRANCH                    17000018
*********************************************************************** 17050002
*   ESTABLISH ADDRESS OF FIRST BYTE BEYOND LAST 48 BYTE OPEN DATA     * 17060002
*   SET ENTRY.  THIS WILL BE THE BEGINNING OF THE FORECORE WORK AREA  * 17070002
*   FOR 'PARTIAL RELEASE'.                                            * 17080002
*********************************************************************** 17090002
         LR    CTABLR,TABLR             INITIALIZE TO BEGINNING  Y02076 17092002
REPDCB0A EQU   *                        INSTR MUST FOLLOW        Y02076 17094002
         TM    TABFLG1,TABLAST          IS THIS LAST ENTRY       Y02076 17096002
         BO    REPDCB0B                 BRANCH IF END            Y02076 17098002
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TO NEXT ENTRY  Y02076 17098402
         B     REPDCB0A                 BRANCH TO CONT COUNTING  Y02076 17098802
REPDCB0B EQU   *                        INSTR MUST FOLLOW        Y02076 17099602
         LA    CTABLR,TABENT(CTABLR)    1ST BYTE AFTER LAST      Y02076 17099702
*                                                                       17099802
*        LOAD ADDRESS OF FORECORE WORK AREA FOR PARTIAL RELEASE  YM7312 17108102
*        AND INSURE THAT IT IS ON A DOUBLE WORD BOUNDARY.        YM7312 17110102
*                                                                       17112102
         LA    UCBR,D7            LOAD 7 INTO REG                YM7312 17116602
         AR    UCBR,CTABLR        ADD PRELIM. FORECORE PTR       YM7312 17124902
         SRL   UCBR,D3            DROP EXTRA BITS IN ADDR.       YM7312 17133202
         SLL   UCBR,D3            FORECORE ADDR. NOW ON DOUBLE   YM7312 17143202
*                                 WORD BOUNDARY                  YM7312 17166702
         LR    CTABLR,TABLR             INITIALIZE CTABLR               17200018
         B     REPDCB02                 BRANCH TO TEST FOR TYPE OF D.S. 17400018
*                                                                       17500018
*********************************************************************   17600018
*                                                                       17700018
******** TEST FOR PS, PO, OR EXCP DATA SET                              17800018
*                                                                       17900018
*********************************************************************   18000018
*                                                                       18100018
REPDCB01 EQU   *                                                        18200018
*                                                                       18300018
         LA    CTABLR,TABENT(CTABLR)    POINT TO NEXT TABL ENTRY        18400018
*                                                                       18500018
REPDCB02 EQU   *                                                        18600018
*                                                                       18700018
         TM    TABDSORG,DA+IS           BDAM OR ISAM DATA SET    M0187  18760021
         BZ    REPDCB03                 BRANCH IF NOT            A25984 18820019
REPDCB05 EQU   *                                                 A30552 18830020
*                                                                       18840002
*        NOTE THAT THE ISAM/BDAM PROCESSING MODULE MUST BE       Y02049 18842002
*        CALLED, AND ALLOW CHECKING ON BDAM DATA SETS TO BE DONE Y02049 18844002
*                                                                       18846002
         MVI   RSRETCOD+1,X'FF'         SET ISAM FLAG            A25984 18850019
         TM    TABDSORG,IS              IS THIS AN ISAM D.S.     Y02049 18860002
         BO    REPDCB04                 GET NEXT DCB             Y02049 18880002
REPDCB03 EQU   *                                                 A25984 18910019
         TM    TABFLG2,TABPOCAT         TEST FOR PO CONCATENATION       19000002
         BO    REPDCB04                 YES - BRANCH                    19100018
         TM    TABFLG1,TABDA            TEST FOR A DA DEVICE            19200002
         BNO   REPDCB04                 BRANCH IF NOT            Y02049 19300002
         TM    TABFLG2,TABVIODS         IS THIS A VAM DATA SET?  YM7550 19350002
         BO    REPDCBA4                 BRANCH IF YES           ZA00128 19360002
         TM    TABFLG1,TABSYS           IS THIS SAM-SI           YM7550 19370002
         BNO   REPDCB10                 BRANCH IF NOT            Y02049 19380002
*                                                                       19400018
REPDCB04 EQU   *                                                        19500018
*                                                                       19600018
         TM    TABFLG1,TABLAST          TEST FOR LAST ENTRY             19700002
         BO    ENDUP                    YES - BRANCH                    19800018
*                                                                       19900018
         B     REPDCB01                 GO TEST TABL ENTRY              20000018
REPDCBA4 CLC   1(3,CTABLR),RSCKDCB+1    IS IT RESTART DATA SET  ZA00128 20050002
         BNE   REPDCB04                 BRANCH IF NOT           ZA00128 20060002
         L     DCBR,TABDCBAD-1          GET DCB ADDR            ZA00128 20070002
         MVC   DCBFDAD,RSBDCB+DCBFDAD-IHADCB  UPDATE DCBFDAD    ZA00128 20080002
         B     REPDCB04                 BR TO GET NEXT ENTRY    ZA00128 20090002
*                                                                       20100018
REPDCB10 EQU   *                                                        20200018
*                                                                       20300018
*********************************************************************   20400018
*                                                                     * 20500018
******** DEVICE = DA, ORGN = PS, PO, OR EXCP                          * 20600018
*                                                                     * 20700018
******** THIS SECTION OF CODE BUILDS THE WORKAREA FOR READING         * 20800002
*        IN THE DSCB FOR DATA SETS WHICH MIGHT REQUIRE A PARTIAL      * 20900018
*        RELEASE                                                      * 21000018
*                                                                     * 21100018
*********************************************************************   21200018
*                                                                       21300018
         XC    UCBAD,UCBAD              ZERO-UCB FILE-MULT VOL  ZA02895 21310037
         NI    TABFLG5,X'FD'            CLEAR MULTI-VOL BIT     ZA02895 21320037
         SR    WRKR2,WRKR2              CLEAR WRKR2              Y02076 21350002
         LA    WRKR1,DSECTSIZ           GET SIZE OF FORECORE     Y02076 21400002
         SRL   WRKR1,2                  DIVIDE BY 4              Y02076 21450002
         LR    WRKR3,UCBR               BEGIN ADR OF FORECORE    Y02076 21500002
REPDCB12 EQU   *                        INSTR MUST FOLLOW        Y02076 21550002
         ST    WRKR2,D0(WRKR3)          CLEAR 4 BYTES            Y02076 21560002
         LA    WRKR3,D4(WRKR3)          INCR TO NEXT 4 BYTES     Y02076 21570002
         BCT   WRKR1,REPDCB12           BR BACK UNTIL ALL CLEAR  Y02076 21580002
         BAL   WRKR5,BLDCCWS            BRANCH TO BUILD CCW LIST SBRTN  21600018
*                                                                       21700018
         LA    WRKR5,REPDCB22           SET UP FOR BYPASS        A29797 21800020
*                                                                       21900018
REPDCB20 EQU   *                                                        22000018
*                                                                       22100018
*********************************************************************   22200018
*                                                                       22300018
******** READ THE DSCB                                                  22400018
*                                                                       22500018
*********************************************************************   22600018
*                                                                       22700018
         EXCP  DXIOB                                                    22800018
*                                                                       22900018
*********************************************************************   23000018
*                                                                       23100018
******** WAIT FOR COMPLETION OF READ                                    23200018
*                                                                       23300018
*********************************************************************   23400018
*                                                                       23500018
         WAIT  ,ECB=DXECB                                               23600018
*                                                                       23700018
         TM    DXECB,IOERROR            TEST FOR PERM I/O ERROR         23800018
         BZ    REPDCB68                 BRANCH IF ERROR           M3251 24000018
*                                                                       24200018
         BR    WRKR5                    BRANCH BACK TO CALLER    A29797 24300020
*                                                                       24400018
*********************************************************************   24500018
*                                                                       24600018
******** THE DSCB HAS BEEN SUCCESSFULLY READ                            24700018
*                                                                       24800018
*********************************************************************   24900018
*                                                                       25000018
******** ******     ***** *****  ********  ************     *********** 25007018
*                   -UPDATE PP CHECKPOINT DCB-                        * 25014018
*                                                                     * 25021018
* AT RESTART THE FULL DISK ADDR AND TRK BALANCE IN THE PP DCB MUST BE * 25028018
* UPDATED.THE FULL DISK ADDR FROM THE CHKPT DCB IN THE RESTART WKAREA * 25035018
* AND THE TRK BALANCE FROM THE DSCB.                                  * 25042018
******** ******     ***** *****  ********  ************     *********** 25049018
*                                                                       25056018
REPDCB22 EQU   *                                                 A29797 25059020
         MVC   DXCCW4(44),DXDSCB        SAVE KEY OF F1          YA00279 25061802
         MVC   DXDSCB,DXDSCB+44         REPOS DATA PORTION      YA00279 25062202
         CLI   DSCFMTID,X'F1'           IS IT FORMAT1 DSCB       Y02049 25062602
         BNE   REPDCB68                 BR IF NOT,ERR072         Y02049 25062737
         CLC   1(3,CTABLR),RSCKDCB+1    IS THIS THE CHKPT DCB           25063018
         BNE   REPDCB24                 BRANCH IF NO             A29797 25072020
*                                                                       25081020
         MVC   DCBFDAD,RSBDCB+DCBFDAD-IHADCB UPDATE PP DISK ADDR A29797 25090020
*                                                                       25099020
*              SET UP ECB TO BE POSTED BY SVC 25'S EXCP.                25108020
*              THE IOB, LAST USED DURING CHECKPOINT, POINTS TO THE OLD  25117020
*              CHECKPOINT DECB, WHICH IS NOT THE DECB FOR RESTART.      25126020
*                                                                       25135020
         L     WRKR6,DCBIOBA            ADDR NORMAL IOB PREFIX   A29797 25144020
*                                                                       25153020
         TM    DCBCIND2,CIND2PCI        TEST IF CHAINED SCHEDULE A29797 25162020
         BZ    REPDCB23                 BRANCH IF NO             A29797 25171020
*                                                                       25180020
         L     WRKR6,DCBIOBAD           ADDR CH SCHD IOB PREFIX  A29797 25189020
         LA    WRKR6,8(WRKR6)           ADJUST TO NORMAL IOB PFX A29797 25198020
*                                                                       25207020
REPDCB23 EQU   *                                                 A29797 25216020
         LA    WRKR1,RSECB1             ADDR OF ECB TO BE POSTED A29797 25225020
         ST    WRKR1,IOBECBPT-IOBFLAG1+8(WRKR6)  PUT ADDR IN IOB A29797 25234020
*                                                                       25243020
         LA    WRKR2,0(DCBR)            LOAD PP DCB ADDR FOR SVC A29797 25252020
         SVC   TKBAL                    ISSUE TRACK BALANCE SVC  A29797 25261020
*                                                                       25270020
REPDCB24 EQU   *                                                        25300018
*                                                                       25400018
         CLI   DSCFILTY,FILETYPE        IS FILE TYPE BYTE EQ ZEROS      25500018
         BE    REPDCB2A                 YES - BRANCH                    25600018
         TM    TABDSORG,DA              IS IT BDAM              ZA02895 25650037
         BO    REPDCB2A                 YES-DON'T UPDATE DSORG  ZA02895 25660037
*                                                                       25700018
         MVC   TABDSORG(1),DSCFILTY     OVERLAY TABL DS ORGN BYTE       25800018
*                                                                       25900018
REPDCB2A EQU   *                                                        26000018
*                                                                       26100018
         L     DEBR,DCBDEBAD            POINT TO DEB                    26200018
         IC    DSCNTR,DSCNOEXT          GET NUMBER OF DSCB EXTS   M3251 26240018
         CLI   DSCEXTYP,X'40'           USER LABELS PRESENT       M3251 26280018
         BNE   REPDCB2B                 NO, BRANCH                M3251 26320018
         LA    DSCNTR,1(0,DSCNTR)       ALLOW FOR USER LABEL EXT  M3251 26360018
REPDCB2B CLI   DSCNEXT+4,X'00'          IS A DSCB EXTN PRESENT    M3251 26400018
         BE    REPDCB25                 NO, BRANCH                M3251 26440018
*                                                                       26500018
         LA    WRKR6,DXJBF              POINT TO THE JFCB READ AREA     26600018
         ST    WRKR6,DXCCW3             STORE IN CCW 3                  26700018
         MVI   DXCCW3,READKND           SET CCW TO READ KEY AND DATA    26800018
         MVI   DXCCW3+7,LENGTH          SET AMOUNT TO BE READ = 140     26900018
         MVC   DXDAADDR+3(5),DSCNEXT    MOVE CCHHR OF F3 DSCB TO IOB    27000018
*                                                                       27100018
         BAL   WRKR5,REPDCB20           BRANCH (WITH LINK) TO READ F3   27200018
*                                                                       27300018
         CLI   DS3FMTID,X'F3'      IS THIS A FORMAT 3 DSCB?      Y02049 27350002
         BNE   REPDCB68            BRANCH IF NOT, ERROR 72       Y02049 27360002
         EJECT                                                          27370002
REPDCB25 EQU   *                                                        27400018
*                                                                       27450002
*        THIS ROUTINE WILL COMPARE THE EXTENTS IN THE DEB TO     Y02049 27460002
*        THOSE IN THE DSCB(S) FOR THIS DATA SET.  IF THE         Y02049 27470002
*        EXTENTS ARE ALL EQUAL, THE NEXT DATA SET IS CHECKED.    Y02049 27480002
*                                                                       27482002
*        IF THE DEB EXTENTS ENCOMPASS A GREATER NUMBER OF        Y02049 27490002
*        TRACKS IN THE SAME DISK SPACE, THE DEB IS COMPRESSED.   Y02049 27492002
*                                                                       27494002
*        IF THE DSCB HAS A GREATER NUMBER OF TRACKS IN THE       Y02049 27496002
*        SAME DISK SPACE, PARTIAL RELEASE IS CALLED TO RELEASE   Y02049 27498002
*        THE SPACE ACQUIRED AFTER CHECKPOINT.                    Y02049 27498402
*                                                                       27498802
*        IF THE EXTENTS ARE NOT IN THE SAME DISK SPACE, AN       Y02049 27499202
*        ERROR CONDITION IS RAISED.                              Y02049 27499602
*                                                                       27500018
*****************                                                       27510002
*                                                                       27520002
*        ADJUST POINTERS FOR FIRST EXTENT COMPARISON             Y02049 27530002
*                                                                       27540002
         STC   DSCNTR,EXTNO             SAVE NO. OF DSCB EXTENTS  M3251 27550018
         LA    WRKR2,DEBBASND      GET FIRST DEB EXTENT          Y02049 27600002
         USING DEBDASD,WRKR2                                     Y02049 27650002
         MVC   UCBAD+1(3),DEBUCBAD+1  SAVE UCB ADDR             ZA02895 27660037
         LA    WRKR3,DSCEXTYP      GET FIRST DSCB EXTENT         Y02049 27700002
         USING DSCEXTYP,WRKR3                                    Y02049 27750002
         LA    WRKR6,DSCEXTLN(,WRKR3) GET NEXT DSCB EXTNT PTR    Y02049 27800002
         CLI   DSCEXTYP,ULEXTNT    IS THIS A USER LABEL EXTNT?   Y02049 27850002
         BNE   REPDCB30            NO, BYPASS INCRIMENTING       Y02049 27900002
         LR    WRKR3,WRKR6         INCREMENT TO FIRST USER EXTNT Y02049 27950002
         LA    WRKR6,DSCEXTLN(,WRKR6) GET NEXT DSCB EXTNT PTR    Y02049 28000002
*                                                                       28050002
REPDCB30 EQU   *                   INSTR MUST FOLLOW             Y02049 28100002
*                                                                       28110002
*        CHECK THE CASE WHERE THE DEB, DSCB, OR BOTH MIGHT       Y02049 28120002
*        HAVE ZERO EXTENTS.                                      Y02049 28130002
*                                                                       28150002
         SR    DSCNTR,DSCNTR       ZERO OUT REGISTER             Y02049 28200002
         IC    DSCNTR,DEBNMEXT     GET NO. OF EXTENTS IN DEB     Y02049 28250002
         CLI   DSCNOEXT,X'00'      ARE THERE ANY DSCB EXTNTS?    Y02049 28300002
         BNE   REPDCB31            YES, CHECK DEB                Y02049 28350002
         LTR   DSCNTR,DSCNTR       ARE THERE ANY DEB EXTENTS?    Y02049 28400002
         BZ    REPDCB04            NO, GET NEXT TABL ENTRY       Y02049 28450002
         B     REPDCB40            NO, COMPRESS DEB              Y02049 28500002
*                                                                       28550002
REPDCB31 EQU   *                   INSTR MUST FOLLOW             Y02049 28600002
*                                                                       28650002
         LTR   DSCNTR,DSCNTR       ARE THERE ANY DEB EXTENTS?    Y02049 28700002
         BZ    REPDCB50            NO, DO PARTIAL RELEASE        Y02049 28750002
         B     REPDCB32                 GO COMPARE EXTNTS       ZA02895 28760037
*                                                                       28770037
*                                                                       28780037
*  PREPARE TO READ IN THE F1 DSCB OF THE NEXT VOLUME            ZA02895 28790037
*  VIA THE VTOC TTR CONTAINED IN THE UCB                        ZA02895 28792037
*                                                                       28794037
         DROP  WRKR3                                            ZA02895 28796037
REPDC32A OI    TABFLG5,X'02'            SET MULTI VOL FLAG      ZA02895 28798037
         L     WRKR3,UCBAD              GET UCB ADDR            ZA02895 28798437
         USING UCBOB,WRKR3                                      ZA02895 28798837
         L     WRKR1,UCBVTOC            GET TTR OF VTOC         ZA02895 28799237
         SRL   WRKR1,8                  RIGHT JUSTIFY TTR0      ZA02895 28799637
         BCTR  WRKR1,0                  DECR BY 1 FOR SEEK      ZA02895 28799737
         SLL   WRKR1,8                  LEFT JUSTIFY TTR0       ZA02895 28799837
         XC    VTOCCHHR(8),VTOCCHHR     CLEAR FIELD FOR CCHHR   ZA02895 28799937
         STM   WRKR2,WRKR6,DXDSCB+DSECTSIZ    SAVE REGS         ZA02895 28816637
         LA    TIOTR,DXDSCB+DSECTSIZ    SAV REG ACROSS CALL     ZA02895 28826637
         ST    TIOTR,REG6SAV            SAVE REG 6              ZA02895 28828637
         LA    WRKR2,DXDEB              PT TO WORK AREA DEB     ZA02895 28830637
         L     WRKR6,CVTPTR             GET CVT ADDR            ZA02895 28832637
         LA    DCBR,VTOCCHHR            LOCATION OF RESULTS     ZA02895 28833037
         L     WRKR6,CVTPCNVT-CVTMAP(WRKR6) CNVRT RTN ADR       ZA02895 28833137
         BALR  WRKR5,WRKR6              CONVERT TO CCHHR        ZA02895 28833237
         LM    WRKR2,WRKR6,0(TIOTR)     RESTORE REGS            ZA02895 28838837
         BAL   WRKR5,BLDCCWS            SET CCWS FOR READ       ZA02895 28840837
         L     TIOTR,REG6SAV            RESTORE REG 6           ZA02895 28842837
         LM    WRKR2,WRKR6,0(TIOTR)     RESTORE REGS            ZA02895 28843237
         LR    TIOTR,WRKR2              SAVE R1 ACROSS CALL     ZA02895 28843637
         MVC   DXDAADDR+3(5),VTOCCHHR+3 SET VTOC CCHHR         @ZA08861 28843837
         BAL   WRKR5,REPDCB20           GO READ F1 DSCB         ZA02895 28844037
         LR    WRKR2,TIOTR              RESTORE R1              ZA02895 28844137
*                                                                       28844237
*   CHECK FOR F3 DSCB - IF ONE EXISTS, READ IT IN               ZA02895 28844337
*   THEN SET UP PTRS TO PT TO FIRST EXTENT IN F1 DSCB           ZA02895 28848237
*                                                                       28850237
         CLI   DSCFMTID,X'F1'           IS IT FORMAT 1          ZA02895 28850637
         BNE   REPDCB68                 BR IF NOT,ERR072        ZA02895 28851037
         SR    WRKR1,WRKR1              CLEAR REG0              ZA02895 28851437
         IC    WRKR1,DSCNOEXT           GET NO. DSCB EXTS       ZA02895 28851837
         CLI   DSCNEXT+4,X'00'          IS THER A DSCB EXTNTION ZA02895 28851937
         BE    REPDC32C                 NO-BRANCH               ZA02895 28852037
         XC    DXCCW1(24),DXCCW1        CLEAR CCWS              ZA02895 28852137
         LA    WRKR6,DXDAADDR+3         PT TO CCHHR             ZA02895 28855637
         ST    WRKR6,DXCCW1             STORE IN SRCH CCW       ZA02895 28857637
         LA    WRKR6,DXCCW1             PT TO SEARCH CCW        ZA02895 28858037
         ST    WRKR6,DXCCW2             STORE IN TIC CCW        ZA02895 28858437
         LA    WRKR6,DXJBF              PT TO JFCB READ IN AREA ZA02895 28858837
         ST    WRKR6,DXCCW3             ST IN READ DATA CCW     ZA02895 28859237
         OC    DXCCW1(24),CCWLIST       OR IN CCWS              ZA02895 28859337
         MVI   DXCCW3,READKND           SET CCW-(READ-KEY-DATA) ZA02895 28859437
         MVI   DXCCW3+7,LENGTH          SET LENGTH = 140        ZA02895 28859637
         MVC   DXDAADDR+3(5),DSCNEXT    MOVE IN CCHHR           ZA02895 28859737
         LR    TIOTR,WRKR2              SAVE REG 1              ZA02895 28859837
         BAL   WRKR5,REPDCB20           READ IN F3 DSCB         ZA02895 28859937
         LR    WRKR2,TIOTR              RESTORE REG 1           ZA02895 28866537
         CLI   DS3FMTID,X'F3'           IS IT FORMAT 3          ZA02895 28868537
         BNE   REPDCB68                 BR IF NOT,ERR072        ZA02895 28870537
REPDC32C LA    WRKR3,DSCEXTYP           POINT TO 1ST DSCB EXT   ZA02895 28872537
         LA    WRKR6,DSCEXTLN(,WRKR3)   GET NEXT DSCB EXT PTR   ZA02895 28872937
*                                                                       28873337
*     COMPARE THE LOW AND HIGH CCHH IN THE DSCB AND DEB         ZA02895 28873437
*                                                                       28873537
REPDCB32 EQU   *                        COMPARE DEB-DSCB EXTS   ZA02895 28884437
         USING DSCEXTYP,WRKR3                                   ZA02895 28894437
*        COMPARE THE LOW AND HIGH CCHH IN THE DSCB AND DEB       Y02049 28928237
*                                                                       28939137
         CLI   DSCEXTYP,NOEXTNT    IS THIS A VALID DSCB EXTENT?  Y02049 28950002
         BE    REPDCB40            NO, COMPRESS DEB              Y02049 29000002
         CLC   DEBSTRCC(D4),DSCLOWLM COMPARE LOW CCHH IN DEB     Y02049 29050002
*                                  TO DSCB                       Y02049 29100002
         BNE   REPDCB70            ERROR IF NOT EQUAL            Y02049 29150002
         CLC   DEBENDCC(D4),DSCUPPLM COMPARE HI CCHH IN DEB      Y02049 29200002
*                                  TO DSCB                       Y02049 29250002
         BE    REPDCB34            EQUAL, GO CHECK MORE EXTNTS   Y02049 29300002
         BH    REPDCB33            DEB IS HI, CHECK IF LAST      Y02049 29350002
*                                  DSCB EXTENT                   Y02049 29400002
*                                                                       29410002
*        THE DEB VALUE IS LOWER THAN THE DSCB                    Y02049 29420002
*                                                                       29430002
         LA    WRKR4,ONE           LOAD VALUE OF 1 IN WRK REG    Y02049 29450002
         CR    DSCNTR,WRKR4        IS THIS THE LAST DEB EXTNT?   Y02049 29500002
         BE    REPDCB50            YES, DO PARTIAL RELEASE       Y02049 29550002
         B     REPDCB70            NO, ERROR                     Y02049 29600002
*                                                                       29650002
REPDCB33 EQU   *                   INSTR MUST FOLLOW             Y02049 29700002
*                                                                       29710002
*        THE DEB VALUE IS HIGHER THAN THE DSCB                   Y02049 29720002
*                                                                       29750002
         LTR   WRKR6,WRKR6         NEXT DSCB EXTNT VALID?        Y02049 29800002
         BZ    REPDCB60            NO, COMPRESS DEB              Y02049 29850002
         CLI   EXTNTYP(WRKR6),NOEXTNT   IS THERE ANOTHER VALID   Y02049 29900002
*                                  DSCB EXTENT?                  Y02049 29950002
         BE    REPDCB60            NO, COMPRESS DEB              Y02049 30000002
         B     REPDCB70            YES, ERROR                    Y02049 30050002
*                                                                       30100002
REPDCB34 EQU   *                   INSTR MUST FOLLOW             Y02049 30150002
*                                                                       30160002
*        THE DEB AND DSCB VALUES ARE EQUAL                       Y02049 30170002
*                                                                       30200002
         BCT   DSCNTR,REPDCB35     BRANCH IF NOT LAST DEB EXTENT Y02049 30250002
         LTR   WRKR6,WRKR6         NEXT DSCB EXTNT PTR VALID?    Y02049 30300002
         BZ    REPDCB04            NO, GET NEXT TABL ENTRY       Y02049 30350002
         CLI   EXTNTYP(WRKR6),NOEXTNT   IS THERE ANOTHER VALID   Y02049 30400002
*                                  DSCB EXTENT?                  Y02049 30450002
         BNE   REPDCB50            YES, DO PARTIAL RELEASE       Y02049 30500002
         B     REPDCB04            NO, GET NEXT TABL ENTRY       Y02049 30550002
*                                                                       30600002
REPDCB35 EQU   *                   INSTR MUST FOLLOW             Y02049 30650002
*                                                                       30652002
*        THERE ARE MORE DEB EXTENTS, PREPARE TO COMPARE          Y02049 30654002
*        THE NEXT EXTENT                                         Y02049 30656002
*                                                                       30660002
         LA    WRKR2,DEBEXTLN(,WRKR2) POINT TO NEXT DEB EXTNT    Y02049 30670002
         LTR   WRKR6,WRKR6         MORE DSCB EXTENTS ?           Y02049 30680002
         BZ    REPDCB40            NO MORE DSCB EXTNTS, COMPRESS Y02049 30692002
         LR    WRKR3,WRKR6         GET NEXT DSCB EXTNT PTR       Y02049 30692402
         LA    WRKR6,DSCEXTLN(,WRKR6) INCREMENT 'NEXT EXTENT'    Y02049 30694002
*                                  POINTER                       Y02049 30696002
*                                                                       30696102
*        SEE IF THE 'NEXT EXTENT' IS IN THE FORMAT 1 DSCB        Y02049 30696402
*                                                                       30696802
         LA    WRKR4,DSCEXT2-DXDSCB(,UCBR)                       Y02049 30698002
*                                  GET ADDR OF LAST FMT 1 EXT.   Y02049 30698102
         CR    WRKR3,WRKR4         COMPARE FOR END OF FMT 1      Y02049 30698402
         BL    REPDCB32            LOW, CHECK NEXT EXTENT        Y02049 30698802
         OC    DSCEXTLN(D5,WRKR4),DSCEXTLN(WRKR4)                Y02049 30699202
*                                  IS THERE A FORMAT 3 DSCB?     Y02049 30699602
         BNZ   REPDCB36            YES, GO GET ADDRESS           Y02049 30699702
         SR    WRKR6,WRKR6         ZERO 'NEXT EXTENT' POINTER    Y02049 30699802
         B     REPDCB32            GO CHECK NEXT EXTENT          Y02049 30699902
*                                                                       30733202
REPDCB36 EQU   *                   INSTR MUST FOLLOW             Y02049 30743202
*                                                                       30745202
*        SEE IF THE 'NEXT EXTENT' IS IN THE FORMAT 3 DSCB        Y02049 30747202
*        KEY PORTION                                             Y02049 30749202
*                                                                       30753202
         CR    WRKR3,WRKR4         IS THIS LAST FMT 1 EXTENT?    Y02049 30763202
         BNE   REPDCB37            NO, CHECK IF LAST F3 KEY EXT  Y02049 30765202
         LA    WRKR6,F3KFIRST(,UCBR)  GET FIRST EXT IN F3 KEY    Y02049 30765602
         B     REPDCB32            GO CHECK NEXT EXTENT          Y02049 30766002
*                                                                       30766402
REPDCB37 EQU   *                  INSTR MUST FOLLOW              Y02049 30766502
*                                                                       30770202
*        SEE IF THE 'NEXT EXTENT' IS IN THE FORMAT 3 DSCB        Y02049 30772202
*        DATA PORTION                                            Y02049 30772602
*                                                                       30773002
*                                                                       30774002
         LA    WRKR4,F3KLAST(,UCBR)  GET LAST EXT IN F3 KEY      Y02049 30777702
         CR    WRKR3,WRKR4         COMPARE FOR END OF F3 KEY     Y02049 30787702
         BL    REPDCB32            LOW, CHECK NEXT EXTENT        Y02049 30788102
         BH    REPDCB38            HIGH, CHECK IF LAST F3 DATA   Y02049 30788502
*                                  EXTENT                        Y02049 30788602
         LA    WRKR6,F3DFIRST(,UCBR)  GET FIRST EXT IN F3 DATA   Y02049 30788702
         B     REPDCB32            GO CHECK NEXT EXTENT          Y02049 30788802
*                                                                       30792502
REPDCB38 EQU   *                   INSTR MUST FOLLOW             Y02049 30794502
*                                                                       30794902
         LA    WRKR4,F3DLAST(,UCBR)  GET LAST EXT IN F3 DATA     Y02049 30795302
         CR    WRKR3,WRKR4         COMPARE FOR END OF F3 DATA    Y02049 30795702
         BL    REPDCB32            LOW, CHECK NEXT EXTENT        Y02049 30796102
         SR    WRKR6,WRKR6         ZERO 'NEXT EXTENT' POINTER    Y02049 30796202
         B     REPDCB32            GO CHECK NEXT EXTENT          Y02049 30822102
REPDCB40 EQU   *                   INSTR MUST FOLLOW             Y02049 30842102
         CLC   UCBAD+1(3),DEBUCBAD+1  HAS UCB CHANGED           ZA02895 30842537
         BE    REPDCB41                 BR IF NO CHANGE         ZA02895 30842937
         MVC   UCBAD+1(3),DEBUCBAD+1    SAVE NEW UCB ADDR       ZA02895 30843337
         B     REPDC32A                 GO READ F1/F3 DSCB      ZA02895 30843737
         DROP  WRKR2,WRKR3                                      ZA02895 30843837
REPDCB41 TM    TABDSORG,DA         IS THIS A BDAM DATA SET ?     Y02049 30844137
         BO    REPDCB04            YES, DO NOT COMPRESS BDAM     Y02049 30846102
*                                  DEBS.                         Y02049 30848102
         BAL   WRKR5,REPDCB76      BRANCH TO UPDATE DEB SUBRTN   Y02049 30856702
*                                                                       30865502
*********************************************************************   30874102
*                                                                       30900018
******** NOW COMPRESS AND UPDATE THE DEB                                31000018
*                                                                       31100018
*********************************************************************   31200018
*                                                                       31300018
         SR    WRKR4,WRKR4              CLEAR WRKR4                     31400018
         SR    WRKR6,WRKR6              CLEAR WRKR6                     31500018
         IC    WRKR4,DSCNOEXT           INSERT DSCB NO. OF EXTENTS      31600018
         IC    WRKR6,DEBNMEXT           INSERT DEB NO. OF EXTENTS       31700018
         STC   WRKR4,DEBNMEXT           UPDATE NO. EXTS. IN DEB         34300018
*                                                                       34400018
         SLL   WRKR4,4                  GET DSCNOEXT IN BYTES           34600018
         SLL   WRKR6,4                  GET DEBNMEXT IN BYTES           34700018
*                                                                       34900018
*********************************************************************   35000018
*                                                                     * 35100018
******** GET LENGTH OF THE ACCESS METHOD PORTION OF THE DEB SO THAT IT* 35200018
*        CAN OVERLAY THE EXTENTS TO BE DELETED, THUS COMPRESSING THE  * 35300018
*        DEB                                                          * 35400018
*                                                                     * 35500018
******** WRKR3 NOW CONTAINS LENGTH TO BE MOVED                        * 35600018
*                                                                     * 35700018
*********************************************************************   35800018
*                                                                       35900018
         LA    WRKR2,DEBSUCBA           GET ADDR OF START OF     Y02049 36000002
*                                       DEVICE DEPENDANT SECTION Y02049 36050002
         LA    WRKR6,0(WRKR2,WRKR6)     POINT WRKR6 TO START OF AM SEC  36100018
         LA    WRKR2,0(WRKR4,WRKR2)     POINT TO NEW AM START ADDR      36200018
         SR    WRKR3,WRKR3              CLEAR WRKR3                     36300018
         IC    WRKR3,DEBAMLNG           INSERT ACC METHOD SEC LENGTH    36400018
         SR    WRKR4,WRKR4              CLEAR REGISTER          ZA00609 36450002
         IC    WRKR4,DEBNMSUB           GET NO. OF SUBR.        ZA00609 36470002
         SLL   WRKR4,1                  MULT. BY 2 FOR BYTES    ZA00609 36480002
         AR    WRKR3,WRKR4              SPACE FOR SUBR IDS      ZA00609 36492002
         EX    WRKR3,CLOSEUP            EXECUTE THE MOVE                36600018
*                                                                       36700018
*********************************************************************   36800018
*                                                                       36900018
******** END OF DEB COMPEESSION AND RE-FORMATTING                       37000018
*                                                                       37100018
*********************************************************************   37200018
*                                                                       37300018
         B     REPDCB04                 BRANCH TO PROCESS NEXT ENTRY    37400018
*                                                                       37500018
*********************************************************************   37600018
*                                                                     * 37700018
******** THE FOLLOWING ROUTINE IS ENTERED IF THE NO. OF EXTENTS IN    * 37800018
*        THE DSCB IS GREATER THAN THE NO. OF EXTENTS IN THE DEB.      * 37900018
*        THIS MEANS THAT ADDITIONAL DA SPACE WAS DYNAMICALLY ALLOCATED* 38000018
*        AFTER THE CHECKPOINT OCCURRED AND HENCE A PARTIAL RELEASE    * 38100018
*        OF THIS ADDITIONAL SPACE IS NECESSARY.                       * 38200018
*                                                                     * 38300018
*********************************************************************   38400018
*                                                                       38500018
REPDCB50 EQU   *                   INSTR MUST FOLLOW             Y02049 38600002
*                                                                       38650002
         TM    TABDSORG,DA         IS THIS A BDAM DATA SET ?     Y02049 38660002
         BO    REPDCB04            YES, DO NOT CALL PARTIAL      Y02049 38670002
*                                  RELEASE FOR BDAM DATA SETS    Y02049 38680002
*                                                                       38700018
         TM    DEBOPATB,OUTP       IS DATA SET OPEN FOR INPUT           38800002
         BZ    REPDCB70            YES - BR OUT                         38900002
*                                                                       39000018
         LR    WRKR3,DEBR          GET DEB ADDR FOR CALC         Y02049 39050002
         LA    WRKR6,DEBPRFLN      GET LENGTH OF DEB PREFIX      Y02049 39060002
         SR    WRKR3,WRKR6         POINT TO DEB PREFIX           Y02049 39070002
         USING DEBPREFX,WRKR3                                    Y02049 39080002
         L     WRKR3,DEBXTNP       POINT TO DEB EXTENSION        Y02049 39090002
         USING DEBXTN,WRKR3                                      Y02049 39092002
         TM    DEBXMCF1,DCBMRECP   IS THIS EXCP?                 Y02049 39100002
         BZ    REPDCB52                 NO - BRANCH                     39200018
*                                                                       39300018
         TM    DEBXMCF2,DCBMR5WD+DCBMR4WD                        Y02049 39400002
*                                  TEST FOR DA DEV DEPENDANT SEC Y02049 39450002
         BZ    REPDCB70                 BRANCH IF NOT PRESENT           39500018
         DROP  WRKR3                                             Y02049 39550002
*                                                                       39600018
REPDCB52 EQU   *                                                        39700018
*                                                                       39800018
*********************************************************************   39900018
*                                                                     * 40000018
******** CONVERT RTN INTERFACE (CCHHR TO TTR) FOLLOWS                 * 40100018
*                                                                     * 40200018
*********************************************************************   40300018
*                                                                       40400018
         STM   WRKR2,WRKR6,DXDSCB+DSECTSIZ     SAVE REGS         Y02076 40500002
         L     WRKR2,CVTPTR             INITIALIZE CVT REGISTER   M3251 40600018
         USING CVT,WRKR2                                         Y02049 40650002
         L     WRKR6,CVTPRLTV           POINT TO CONVERT RTN            40800018
         L     WRKR2,DCBDEBAD           POINT TO DEB                    40900018
         LA    DCBR,DCBFDAD             POINT TO FULL DISK ADDR         41000018
         BALR  WRKR5,WRKR6              BR AND LINK TO CONVERT RTN      41100018
*                                                                       41200018
         LM    WRKR2,WRKR6,DXDSCB+DSECTSIZ      RESTORE REGS     Y02076 41300002
         ST    WRKR1,DXDAADDR           STORE TTR IN WORKAREA           41400018
*                                                                       41500018
*********************************************************************   41600018
*                                                                     * 41700018
******** MODIFY LAST TRACK USED FIELD IN DSCB                         * 41800018
*                                                                     * 41900018
*********************************************************************   42000018
*                                                                       42100018
         MVC   DSCLSTAR(3),DXDAADDR     MOVE IN TTR                     42200018
         MVC   DSCLSTAR+3(2),DCBTRBAL   MOVE IN REMAINING BYTES-LASTTRK 42300018
         MVC   DXDSCB+DSECTSIZ(8),DCBFDAD    SAVE FULL DISK ADDR Y02076 42400002
*                                                                       42500018
         SR    WRKR3,WRKR3              CLEAR WRKR3                     42600018
         IC    WRKR3,DEBNMEXT           INSERT NO. OF EXTENTS           42700018
         BCTR  WRKR3,0                  DECREMENT COUNT BY 1            42800018
         STC   WRKR3,DCBFDAD            STORE NO. XTNTS-1 IN 'M'        42900018
         SLL   WRKR3,4                  MULT BY 16                      43000018
         LA    TCBR,DEBBASND            ADR DASD SEC             Y02049 43050002
         LA    TCBR,DEBBASND            GET ADDR OF DASD SECTION Y02049 43050102
         USING DEBDASD,TCBR                                      Y02049 43060002
         USING DEBDASD,TCBR                                      Y02049 43060102
         LA    WRKR6,DEBENDCC(WRKR3)    POINT TO ENDING CCHH IN LST EXT 43100018
         MVC   DCBFDAD+3(4),0(WRKR6)    MOVE IN CORRECT CCHH            43200018
         DROP  TCBR                                              Y02049 43250002
*                                                                       43300018
*********************************************************************   43400018
*                                                                     * 43500018
******** THE NEXT 2 INSTRUCTIONS SET ON THE HIGH ORDER BIT IN DEBR SO * 43600018
*        THAT THE PARTIAL RELEASE MODULES WILL RETURN CONTROL         * 43700018
*        BACK TO THIS MODULE AND NOT RETURN TO CLOSE.  DEBR IS THEN   * 43800018
*        POINTED AT THE CLOSE-TYPE WORKAREA EXPECTED BY PARTIAL REL.  * 43900018
*                                                                     * 44000018
*********************************************************************   44100018
*                                                                       44200018
         LA    DEBR,1                   TURN ON LOW ORDER BIT           44300018
         SLL   DEBR,31                  SHIFT TO HIGH ORDER POSITION    44400018
         OR    DEBR,UCBR                POINT DEBR AT CLOSE WORKAREA    44500018
         MVC   JFCBDSNM,DXCCW4          PART. REL. EXPECTS KEY  YA00279 44550002
*                                       PORTION OF F1 AT THIS   YA00279 44560002
*                                       POSIT. IN W.A.          YA00279 44570002
         OI    TABFLG2-TABL(TABLR),TABSW   SET ON PAR RLSE SWITCH       44600002
         L     TCBR,RSTCBAD             LOAD TCB ADDRESS                44710018
         USING TCB,TCBR                                          Y02049 44712002
         L     WRKR2,TCBTIO             LOAD TIOT ADDRESS               44720018
         LH    TIOTR,DCBTIOT            LOAD TIOT OFFSET                44730018
         LR    TCBR,BUFR                SAVE CONTENTS OF BUFR           44740018
         L     BUFR,16(WRKR2,TIOTR)     LOAD SUB UCB ADDRESS            44750018
         B     XCTL                     BRANCH TO XCTL RTN              44800018
*                                                                       44900018
REPDCB54 EQU   *                                                        45000018
*                                                                       45100018
*********************************************************************   45200018
*                                                                     * 45300018
******** UPON RE-ENTRY OF THIS MOD FROM THE PARTIAL RELEASE ROUTINE   * 45400018
*        CONTROL IS PASSED TO THIS ROUTINE FOR POST-PARTIAL RELEASE   * 45500018
*        PROCESSING.                                                  * 45600018
*                                                                     * 45700018
*********************************************************************   45800018
*                                                                       45900018
         LR    BUFR,TCBR                RESTORE BUFR                    45960018
         NI    TABFLG2-TABL(TABLR),X'FF'-TABSW RESET PAR REL SW         46010002
         MVC   DCBFDAD(D8),DXDSCB+DSECTSIZ  RESTORE FULL DSK ADR Y02076 46100002
         LTR   WRKR2,WRKR2              IS THERE AN ERROR RETURN CODE   46200018
         BNZ   REPDCB68                 BR IF ERR PRESENT       YA00279 46250002
         B     REPDCB04                 GO GET NEXT ENTRY       YA00279 46300002
REPDCB60 EQU   *                                                        49200018
*                                                                       49250002
         TM    TABDSORG,DA         IS THIS A BDAM DATA SET ?     Y02049 49260002
         BO    REPDCB04            YES, DO NOT UPDATE BDAM DEBS  Y02049 49270002
*                                                                       49300018
         BAL   WRKR5,REPDCB76           BRANCH TO DEB UPDATE SUBRTN     49400018
*                                                                       49500018
         B     REPDCB04                 GET NEXT TABL ENTRY             49600018
*                                                                       49700018
REPDCB68 EQU   *                                                        49800018
*                                                                       49900018
*********************************************************************** 50000018
*                                                                     * 50100018
******** THIS ROUTINE IS ENTERED FOR ANY I/O ERROR FOR DSCB (FORMAT   * 50200018
*        1 OR FORMAT 3 ).                                             * 50300018
*                                                                     * 50400018
*********************************************************************** 50500018
*                                                                       50600018
         MVI   RSRETCOD+1,ERR072        SET ERROR RETURN CODE  @ZSUT222 50700037
         B     SETV05B                  SET UP TO XCTL TO V05B   M0187  50800021
*                                                                       51000018
REPDCB70 EQU   *                                                        51100018
*                                                                       51200018
         MVI   RSRETCOD+1,ERR076        SET ERR CODE - XTENTS  @ZSUT222 51300037
*                                       OR LAST TTR'S UNEQUAL           51350037
*                                       DEB VS DSCB                     51400037
SETV05B  EQU   *                                                 M0187  51500021
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 51510037
*                                       THAT DETECTED ERROR    @ZSUT222 51520037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 51530037
         LA    WRKR3,C'V'               SET XCTL TO V05B         M0187  51550021
         B     PREXCTL                  GO SET FOR XCTL          M0187  51620021
*                                                                       51700018
ENDUP    EQU   *                                                        51800018
*                                                                       51900018
         LA    WRKR3,C'T'               SET UP TO XCTL TO T05B   M0187  51970021
         CLI   RSRETCOD+1,X'FF'         SHOULD ISAM BE ENTERED   A25984 52050019
         BNE   PREXCTL                  GO SET IGC XCTL          M0187  52060021
         LA    WRKR3,C'W'               SET XCTL TO W05B         M0187  52070021
*                                                                       52080021
PREXCTL  EQU   *                                                 M0187  52090021
         LA    TIOTR,DXDSCB+464         SET WORK AREA FOR XCTL   M0187  52100021
         MVC   0(8,TIOTR),IGC           MOVE IGC MODULE FOR XCTL M0187  52110021
FOUR     EQU   *+2                                               M0187  52120021
         STC   WRKR3,4(TIOTR)           ADJUST TO T, W, OR V05B  M0187  52130021
         B     NOWXCTL                  GO XCTL                  M0187  52140021
*                                                                       52200018
XCTL     EQU   *                                                        52300018
*                                                                       52400018
         LA    TIOTR,DXDSCB+DSECTSIZ+8  SETUP WORKAREA FOR XCTL  YM6533 52500002
         MVC   0(8,TIOTR),IGG           SET XCTL TO IGG MODULE   M0187  52540021
*                                                                       52580021
NOWXCTL  EQU   *                                                 M0187  52620021
EIGHT    EQU   *+2                                               M0187  52660021
         LA    WRKR6,8(TIOTR)           INITIALIZE WRKR6 (REG 15)       52700018
*                                                                       52800018
*********************************************************************   52900018
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  53000018
*********************************************************************   53100018
*                                                                       53150018
         XCTL  EPLOC=(TIOTR),SF=(E,(15))                                53200018
*                                                                       53300018
*********************************************************************   53400018
*                                                                       53500018
******** THIS IS THE START OF THE DEB COMPRESSION AND MODIFICATION      53600018
*        SUBROUTINE                                                     53700018
*                                                                       53800018
*********************************************************************   53900018
*                                                                       54000018
REPDCB76 EQU   *                                                        54100018
*                                                                       54200018
*********************************************************************   57700018
*                                                                     * 57800018
*        AT ENTRY TO THIS ROUTINE, REGISTER CONTENTS ARE:        Y02049 57850002
*          WRKR2 = POINTER TO THE LAST DEB EXTENT (DEBDASD)      Y02049 57900002
*          WRKR3 = POINTER TO THE LAST DSCB EXTENT (DSCEXTYP)    Y02049 57950002
*                                                                     * 58200018
*********************************************************************   58300018
*                                                                       58400018
         SR    WRKR4,WRKR4              CLEAR WRKR4                     58500018
         IC    WRKR4,DEBNMEXT           INSERT NO OF EXTENTS INTO WRKR4 58600018
         BCTR  WRKR4,0                  DECREMENT COUNT BY 1            58700018
         STC   WRKR4,DXDSCB+DSECTSIZ    STORE M IN WORKAREA      Y02076 58750002
         LA    WRKR4,DEBENDCC-DEBDASD(,WRKR2)                    Y02049 58800002
*                                  GET PTR TO DEB ENDING CCHH    Y02049 58850002
         LA    WRKR3,DSCUPPLM-DSCEXTYP(,WRKR3)                   Y02049 58900002
*                                  GET PTR TO DSCB ENDING CCHH   Y02049 58950002
*                                                                       59000018
*********************************************************************** 59100018
*                                                                     * 59200018
******** THE NEXT ROUTINE CONVERTS BOTH MBBCCHHR'S TO TTR'S AND       * 59300018
*        COMPARES TO SEE IF DEBENDCC IS GREATER THAN DSCB ENDING CCHH * 59400018
*        IF IT IS AND DS IS OPEN FOR INPUT AN ERROR CONDITION EXISTS  * 59500018
*                                                                     * 59600018
*********************************************************************** 59700018
*                                                                       59800018
         STM   WRKR1,WRKR6,DXDSCB+DSECTSIZ+D16 SAVE ALL REGS     Y02076 59900002
*                                                                       60000018
         L     WRKR2,CVTPTR             GET CVT ADDRESS                 60100018
         L     WRKR6,CVTPRLTV           GET CONVERT (MBB TO TTR) RTN AD 60200018
         LR    WRKR2,DEBR               POINT WRKR2 TO DEB              60300018
         LA    DCBR,DXDSCB+DSECTSIZ     POINT TO DEB MBBCCHHR    Y02076 60400002
*                                                                       60500018
         MVC   DXDSCB+DSECTSIZ+D3(D4),D0(WRKR4) MOVE CCHH TO WA  Y02076 60800002
         LR    DEBR,WRKR6               SAVE CONVERT RTN ADDR           61300018
         BALR  WRKR5,WRKR6              GO TO CONVERT RTN               61400018
*                                                                       61500018
         LR    TCBR,WRKR1               SAVE DEB XTN TTR                61600018
         L     WRKR3,DXDSCB+DSECTSIZ+D64     REINITIALIZE WRKR3  Y02076 61700002
         MVC   DXDSCB+DSECTSIZ+D3(D4),D0(WRKR3) DSCB 'CCHH' TO WAY02076 61800002
*                                                                       61900018
         LR    WRKR6,DEBR               RESTORE CONVERT RTN ADDR        62000018
         BALR  WRKR5,WRKR6              GO TO CONVERT RTN               62100018
*                                                                       62200018
         SRL   TCBR,16                  GET  NUMBER OF TRKS  DSCB       62300018
         SRL   WRKR1,16                 GET  NUMBER OF TRKS  DEB        62400018
         SR    TCBR,WRKR1               SUB DSCB TTR FROM DEB TTR       62500018
*                                                                       62600018
         LR    WRKR1,TCBR               PUT DIFF IN WRKR1 (REG 0)       62700018
         LM    WRKR2,WRKR6,DXDSCB+DSECTSIZ+D20   ALL BUT REG 0   Y02076 62800002
*                                                                       62900018
         BZ    CONTINUE                 BR IF EQ TO CONTINUE            63000018
*                                                                       63100018
         TM    DEBOPATB,OUTP            TEST FOR OPEN FOR INPUT         63200018
         BZ    REPDCB70                 YES - BR TO ERROR RTN           63300018
*                                                                       63400018
CONTINUE EQU   *                                                        63500018
*                                                                       63600018
*********************************************************************   63700018
*                                                                       63800018
******** DIFFERENCE IN TTRS BETWEEN DSCB AND DCB IN WRKR1 (R0)          63900018
******** DEB  ENDCCHH IS POINTED TO BY WRKR4 (RD)                       64000018
******** DSCB ENDCCHH IS POINTED TO BY WRKR3 (RC)                       64100018
*                                                                       64200018
*********************************************************************   64300018
*                                                                       64400018
         MVC   0(4,WRKR4),0(WRKR3)      UPDATE ENDING CCHH IN LAST DEB  64500018
*                                       EXTENT FIELD                    64600018
         LH    WRKR6,4(WRKR4)           OLD NO. TRKS IN EXT             64700018
         SR    WRKR6,WRKR1              COMPUTE NEW AMT OF TRKS IN EXT  64800018
         STH   WRKR6,4(WRKR4)           SAVE BACK IN DEB EXT FLD        64900018
*                                                                       65000018
         BR    WRKR5                    EXIT FROM SBRTN TO REPDCB60 OR  65100002
*                                       REPDCB40 BAL+4           Y02049 65200002
*                                                                       65300018
*********************************************************************   65400018
*                                                                       65500018
******** END OF UPDATE DEB SUBROUTINE                                   65600018
*                                                                       65700018
*********************************************************************** 65800018
*                                                                       65900018
BLDCCWS  EQU   *                                                        66000018
*                                                                       66100018
*********************************************************************** 66200018
*                                                                     * 66300018
***** THIS SUBRTN GETS THE DISK ADDR OF THE DSCB AND PUTS IT INTO THE * 66400018
*     WORKAREA AND THEN FINISHES CONSTRUCTING THE CCW LIST            * 66500018
*                                                                     * 66600018
******** WORKAREA IS CLEAR, SO BUILD CONTROL BLOCKS FOR READING DSCB'S* 66700018
*                                                                     * 66800018
*********************************************************************** 66900018
*                                                                       67000018
         MVI   DXDEBNTR,X'7F'           SET MAX NO. TRKS         M0187  67550002
         MVI   DXDEBNTR+D1,DF                                   Y02076  67560002
*                                                                       67600018
         LA    WRKR1,DXDCB              GET ADDR OF RESTART DCB         67700018
         ST    WRKR1,DXDEBDCB           STORE IT IN DEB                 67800018
         MVI   DXDEBID,DEBID            STORE ID FOR DEB                67900018
         TM    TABFLG5,X'02'            IS IT A MULTIVOL NTRY   ZA02895 67950037
         BZ    BLDCCWS1                 BRANCH IF NO            ZA02895 68000037
         ST    WRKR3,DXDEBUCB           UCB INTO WA DEB         ZA02895 68050037
         MVC   DXDEBBIN(2),DEBBINUM-DEBUCBAD(WRKR2) BIN# TO DEB ZA02895 68100037
         B     BLDCCWS2                 BRANCH TO CONTINUE      ZA02895 68150037
BLDCCWS1 L     DCBR,TABDCBAD-1          GET USER'S DCB ADDR     ZA02895 68250037
         L     DEBR,DCBDEBAD            POINT TO USER'S DEB             68500018
         USING DEBBASIC,DEBR                                     Y02049 68550002
         L     WRKR3,DEBSUCBA      LOAD USER'S UCB ADDRESS       Y02049 68580002
         ST    WRKR3,DXDEBUCB      STORE USER'S UCB ADDRESS      M0187  68660021
         LA    TCBR,DEBBASND       GET ADR OF DASD SECTION       Y02049 68710002
         USING DEBDASD,TCBR                                      Y02049 68720002
         MVC   DXDEBBIN(2),DEBBINUM     BIN NUMBER TO DEB               68750018
         DROP  TCBR                                              Y02049 68760002
*                                                                       68800018
BLDCCWS2 EQU   *                        CONTINUE                ZA02895 68850037
         LA    WRKR2,DXDEB              GET DEB ADDR                    68900018
         ST    WRKR2,DXDCBDEB           STORE IN DCB                    69000018
*                                                                       69005021
* TO READ VOLUME LABEL AND CONVERT VTOC ADDRESS TO TTR, DEB EXTENTS     69010021
* MUST BE SET TO COVER ENTIRE VOLUME.  LOW CCHH IS ZERO, AND HIGH       69015021
* CC+1 IS OBTAINED FROM SYSTEM DEVICE CHARACTERISTICS TABLE.            69020021
*                                                                       69025021
         USING SRT,WRKR3                                         M0187  69030021
         L     WRKR2,CVTPTR        LOAD CVT POINTER              M0187  69035021
         L     WRKR1,CVTXAPG            ADR- APP VECT TBLE       Y02076 69037002
         ST    WRKR1,DXDEBAPP           STORE IN DEB             Y02076 69039002
         L     WRKR2,CVTZDTAB      LOAD DEVTAB POINTER           M0187  69040021
         DROP  WRKR2                                             M0187  69045021
         IC    WRKR6,UCBTBYT4      GET DEVICE TYPE BYTE          M0187  69050021
         LA    WRKR1,X'0F'         GENERATE MASK                 M0187  69055021
         NR    WRKR6,WRKR1         USE LOW ORDER BITS FOR INDEX  M0187  69060021
         IC    WRKR6,0(WRKR6,WRKR2) PICK UP NEXT INDEX           M0187  69065021
         AR    WRKR2,WRKR6         POINT TO DEVTAB ENTRY         M0187  69070021
         XC    DXDEBSCC(8),DXDEBSCC CLEAR DEB EXTENTS            M0187  69075021
         MVC   DXDEBECC,0(WRKR2)   SET HIGH CYL ADDRESS          M0187  69080021
         MVI   DXDEBUSR,NMEXTS1         SET NO. OF EXTENTS       Y02076 69082002
         MVI   DXDEBAPP,EXSCLS1         SET DEB EXTENT SCALE     Y02076 69084002
         MVI   DXDEBMOD,DVMODS1         SET FILE MASK            Y02076 69084402
*                                                                       69085021
*                                                                       69100018
*********************************************************************   69200018
*                                                                     * 69300018
******** COMPLETE IOB                                                 * 69400018
*                                                                     * 69500018
*********************************************************************   69600018
*                                                                       69700018
         MVI   IOBFLAG1,UNREL           MAKE I/O UNRELATED              69800018
         LA    WRKR2,DXDCB              GET DCB ADDR                    69900018
         ST    WRKR2,IOBWGHT            STORE IN IOB                    70000018
         LA    WRKR2,DXECB              GET ECB ADDR                    70100018
         ST    WRKR2,IOBECBPT           STORE IN IOB                    70200018
         LA    WRKR2,DXCCW              GET CCW STRING ADDR             70300018
         ST    WRKR2,IOBSIOCC           STORE IN IOB                    70400018
*                                                                       70500018
*********************************************************************   70600018
*                                                                     * 70700018
******** GET THE DSCB ADDR AND PUT IT INTO THE CCW STRING             * 70800018
*                                                                     * 70900018
*********************************************************************   71000018
*                                                                       71100018
         TM    TABFLG5,X'02'            IS IT MULTI-VOL D/S     ZA02895 71150037
         BZ    BLDCCWS5                 BRANCH IF YES           ZA02895 71160037
         XC    DXCCW1(48),DXCCW1        CLEAR CCWS              ZA02895 71170037
         LA    WRKR6,VTOCCHHR+3         SEARCH ADDR             ZA02895 71180037
         ST    WRKR6,DXCCW1             SET IN SEARCH CCW       ZA02895 71190037
         LA    WRKR6,DXCCW1             GET TIC TO ADR          ZA02895 71192037
         ST    WRKR6,DXCCW2             STORE IN TIC CCW        ZA02895 71194037
         LA    WRKR6,DXCCW3             LOAD READ CNT CCW ADR   ZA02895 71196037
         ST    WRKR6,DXCCW5             ST IN TIC-AFTER SRCHKEY ZA02895 71198037
         L     WRKR6,TABJFCB-1          GET JFCB PTR            ZA02895 71198437
         LA    WRKR6,0(WRKR6)           CLEAR HI ORDER BYTE     ZA02895 71198837
         LA    WRKR6,16(WRKR6)          LOAD @ OF KEY(DSN)      ZA02895 71199237
         ST    WRKR6,DXCCW4             STO IN SRCHKEY CCW      ZA02895 71199637
         LA    WRKR6,DXDSCB             GET DSCB BUFFER ADR     ZA02895 71199737
         ST    WRKR6,DXCCW6             ST IN READ CNT CCW      ZA02895 71199837
         LA    WRKR6,RSRDCNT            BUF @ FOR READ COUNT    ZA02895 71199937
         ST    WRKR6,DXCCW3             ST IN CCW3              ZA02895 71249937
         OC    DXCCW1(48),DSCBCP        OR IN CHAN PROG         ZA02895 71259937
         BR    WRKR5                    BR BACK TO CALLER       ZA02895 71269937
BLDCCWS5 SH    DEBR,SIXTEEN   POINT TO BBCCHHR, FRONT OF DEB    ZA02895 71279937
         MVC   DXDAADDR+1(7),1(DEBR)    MOVE DA ADDR TO WORKAREA        71400018
*                                                                       71500018
         XC    DXCCW(24),DXCCW          CLEAR THE CHAN PROG AREA        71600018
         LA    WRKR6,DXDAADDR+3         POINT TO CCHHR                  71700018
         ST    WRKR6,DXCCW1             STORE IN SEARCH INSTRUCTION     71800018
         LA    WRKR6,DXCCW1             POINT TO SEARCH INSTRUCTION     71900018
         ST    WRKR6,DXCCW2             STORE IT IN TIC INSTRUCTION     72000018
         LA    WRKR6,DXDSCB             POINT TO TO-ADDR OF DSCB        72100018
         ST    WRKR6,DXCCW3             STORE IT IN READ DATA INSTR.    72200018
         OC    DXCCW(24),CCWLIST        OR IN CHANNEL PROGRAM           72300018
         BR    WRKR5                    BRANCH OUT OF SBRTN VIA WRKR5   72400018
*                                                                       72500018
CLOSEUP  MVC   0(0,WRKR2),0(WRKR6)      MOVE UP THE ACC METH SEC        72600018
*                                                                     * 72700018
*********************************************************************   72800018
*                                                                     * 72900018
*     CHANNEL PROGRAM USED BY REPI/O                                    73000018
*                                                                     * 73100018
*********************************************************************   73200018
*                                                                     * 73300018
         DS    0H                                                M0187  73350021
CCWLIST  DS    0CL24                                                    73400018
         DC    X'3100000040000005'      SEARCH.                         73500018
         DC    X'08000000'                                       M0187  73570021
SIXTEEN  DC    H'16'                                             M0187  73640021
TEN      DC    H'10'                                             M0187  73710021
         DC    X'0E0000000000008C'      READ                   YA00279  73800002
*   THE FOLLOWING CHANNEL PROGRAM IS USED TO SEARCH FOR         ZA02895 73850037
*   THE VOLUME VTOC, THEN SEARCH THE VTOC TO READ IN A F1 DSCB  ZA02895 73860037
*   GIVEN THE DATA SET NAME OF THE DATA SET AS A KEY            ZA02895 73870037
*                                                                     * 73880037
DSCBCP   DS    0CL48                    DSCB READ CHAN PROG     ZA02895 73890037
         DC    X'3100000040000005'      SEARCH ID =             ZA02895 73892037
         DC    X'0800000020000001'      TIC                     ZA02895 73894037
         DC    X'9200000060000008'      READ COUNT              ZA02895 73896037
         DC    X'A90000004000002C'      SEARCH = KEY            ZA02895 73898037
         DC    X'0800000020000001'      TIC                     ZA02895 73898437
         DC    X'8600000000000060'      READ DSCB               ZA02895 73898837
*                                                                     * 73900018
*********************************************************************   74000018
*                                                                     * 74100018
*     CONSTANTS USED IN REPI/O                                          74200018
*                                                                     * 74300018
*********************************************************************   74400018
*                                                                     * 74500018
IGC      DC    CL8'IGC0V05B'            RESTART XCTL MODULE      M0187  74600021
IGG      DC    CL8'IGG020P1'            PARTIAL RELEASE MODULE   M0187  74700021
MODID    DC    CL8'IGC0R05B'            MODULE ID              @ZSUT222 74720037
NMEXTS1  EQU   X'01'                    NO. OF EXTENTS           Y02076 74750002
EXSCLS1  EQU   X'04'                    DEB EXTENT SCALE         Y02076 74800002
DVMODS1  EQU   X'C0'                    FILE MASK                Y02076 74850002
PATCH    DC    XL((*-IGC0R05B)/20)'00'  20 PERCENT PATCH AREA   ZA00128 74900002
         EJECT                                                          75100018
FORECORE DSECT                                                          75200018
         IECDSECT                                                       75300018
         EJECT                                                          75400018
CVT      DSECT                                                          75500018
         CVT                                                            75600018
         EJECT                                                          75700018
*                                                                       75800018
*                                                                       75900018
*   TASK CONTROL BLOCK                                                  76000018
*                                                                       76100018
*                                                                       76200018
         CNOP  0,4                                                      76300018
TCB      DSECT                                                          76400018
TCBRBP   DS    F                       POINTER TO EXECUTING RB          76500018
TCBPIE   DS    F                       POINTER TO PROG. INTERRUPT EL.   76600018
TCBDEB   DS    F                       POINTER TO DEB QUEUE             76700018
TCBTIO   DS    F                       POINTER TO TIOT                  76800018
TCBCMP   DS    F                       TASK COMPLETION CODE             76900018
TCBTRN   DS    F                       TESTRAN FIELD                    77000018
TCBMSS   DS    F                       DATA BLOCK QUEUE ELEMENT POINTER 77100018
TCBPRTK  DS    CL1                     PROTECTION TAG                   77200018
TCBFLGS  DS    FL5                     FLAG BYTES                       77300018
TCBLMP   DS    CL1                     LIMIT PRIORITY                   77400018
TCBDSP   DS    CL1                     DISPATCHING PRIORITY             77500018
TCBLLS   DS    F                       POINTER TO LOAD LIST             77600018
TCBJLB   DS    F                       POINTER TO JOBLIB DCB            77700018
TCBJSE   DS    F                       LIST OF INACTIVE PROGRAMS ADDR.  77800018
TCBGRS   DS    CL64                    GENERAL REGISTER SAVE AREA       77900018
TCBIDF   DS    CL1                     TCB IDENTIFIER FIELD             78000018
TCBFSA   DS    CL3                     POINTER TO 1ST PROB.PROG.SAVEAR  78100018
TCBTCB   DS    F                       NEXT TCB ON READY QUEUE POINTER  78200018
TCBTME   DS    F                       POINTER TO TIMER ELEMENT         78300018
         EJECT                                                          78400018
         DCBD  DSORG=PS                                                 78500018
         EJECT                                                          78600018
*   DATA EXTENT BLOCK                                                   78900002
         IEZDEB                                                  Y02049 79150002
         EJECT                                                          82600018
TIOT     DSECT                                                          82700018
         IEFTIOT1                                                       82800018
         EJECT                                                          82900018
SRT      DSECT                                                          83000018
         IEFUCBOB                                                       83100018
         EJECT                                                          83200018
         IEEVRSWA  VER=3                OAS2 VERSION OF WA              83300000
UCBAD    EQU   RSERAS00                UCB FIELD FOR MULTI-VOLS ZA02895 83350037
VTOCCHHR EQU   RSERAS01                 01,02 -2 WDS FOR CCHHR  ZA02895 83360037
RSRDCNT  EQU   RSERAS03                 03,04 -2 WDS FOR COUNT  ZA02895 83370037
REG6SAV  EQU   RSERAS05                 SAVE AREA FOR REG6      ZA02895 83380037
         EJECT                                                          83400018
         IHJDSTAB                                               Y02076  83450002
EXTNO    EQU   TABFLG5                                            M3251 87770018
DS3FMTID EQU   DXJBF+44            FORMAT 3 ID BYTE              Y02049 87780002
DSCEXTLN EQU   DSCEXT2-DSCEXT1     LENGTH OF EXTENT IN DSCB      Y02049 87790002
F3KLAST  EQU   DXJBF-FORECORE+DSCBEX4-DXDSCB3K                   Y02049 87792002
*                                  FORMAT 3 KEY LAST EXTNT       Y02049 87794002
F3KFIRST EQU   DXJBF-FORECORE+DSCBEXTY-DXDSCB3K                  Y02049 87796002
*                                  FORMAT 3 KEY FIRST EXTNT      Y02049 87798002
F3DFIRST EQU   F3KLAST+DSCEXTLN+DSCBEX5-DSCBFMID                 Y02049 87798402
*                                  FORMAT 3 DATA FIRST EXTNT     Y02049 87798802
F3DLAST  EQU   F3KLAST+DSCEXTLN+DSCBEXD-DSCBFMID                 Y02049 87799202
*                                  FORMAT 3 DATA LAST EXTNT      Y02049 87799602
         END                                                            87800018
