         TITLE 'IGC0S05B  DATA SET PROCESSOR - NON-DA DATA SET POSITIONX00100019
               ING    REPOSITION I/O  RESTART-SVC 52  OS/360'           00200019
IGC0S05B CSECT                                                          00300019
*                                                                A50330 00350000
*                                                                A47745 00360000
*          RELEASE 20 DELETIONS                                         00400019
*0483                                                            A37817 00401020
*0483374000                                                      A33655 00402020
*0483                                                            A32901 00405020
*0483351000-353000,419000-420000,450000-451000                   A31340 00410020
*0483326000                                                      S20038 00420020
*0483337000,343000,345000                                        A33101 00450020
*0483324500                                                      A38125 00470020
*          RELEASE 21 DELETIONS                                         00500019
*0970                                                            A46650 00505021
*0970649000-651000                                               A41420 00510021
*0970046000,268000,273000-273200,429000,433000,473000,489000-    S21040 00520021
*0970490000,618000-619000,656000-660000,676000-677000,743000-    S21040 00540021
*0970774000,817000-818000                                        S21040 00560021
*                                                                       00600037
* VS2 RELEASE 3 CHANGES ADDITIONS DELETIONS                             01300037
*                                                                       01310037
*                                                              @ZA02527 01320037
*                                                              @ZA02883 01330037
*744500,797500,806500                                          @ZA02208 01350037
*A354010-354030                                                @ZA14566 01370032
* APAR OZ31492 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 01371032
*C172500-173500,532808,745000,796500,806500                    @ZSUT222 01372032
*A745100-745500,816002                                         @ZSUT222 01373032
*          VS2 RELEASE 3 SU32                                           01375032
*                                                              @G32DSMI 01380132
*D733500-733940                                                @ZA19615 01385037
*A742100-742700                                                @ZA19615 01390037
*A796510                                                       @ZA19617 01395037
*C405360                                                       @ZA20448 01397037
*A39750003-39750007                                            @ZA26571 01398037
*STATUS CHANGE LEVEL 003                                                01400021
*                                                                       01500019
*********************************************************************** 01600019
*                                                                       01700019
*TITLE - NON-DA DATA SET REPOSITIONING                                  01800019
*                                                                       01900019
*FUNCTION/OPERATION - A. FOR ALL IBM STANDARD LABELED TAPES BEING USED  01910002
*                        VERIFY THE DATA SET LABEL BY COMPARING THE     01950002
*                        LABEL IN THE JFCB AGAINST THE DATA SET LABEL   01960002
*                        IN THE TAPE LABEL. IF THE TAPE LABEL INDICATES 01970002
*                        PASSWORD PROTECTION A PASSWORD IS REQUIRED OF  01980002
*                        THE OPERATOR BEFORE PROCESSING CAN CONTINUE.   01990002
*                        IF THE TAPE LABEL INDICATES A CHECKPT   YM7337 01990402
*                        DATA SET, OR IF THE DSAB INDICATES THAT YM7337 01990802
*                        AT CHECKPOINT THE DATA SET WAS A CHECK- YM7337 01991202
*                        POINT DATA SET, THEN IGC0Q05B WILL BE   YM7337 01991602
*                        CALLED TO VERIFY THE SECURITY OF SAID   YM7337 01991702
*                        DATA SETS.                              YM7337 01991802
*                                                                       01992002
*                     B. POSITION TAPE TO CORRECT DATA SET USING FILE   02000002
*                        SEQUENCE NUMBER IN JFCB WHICH CAN BE OBTAINED  02100019
*                        FROM THE 48 BYTE TABLE ENTRY WHICH IS USED IN  02200019
*                        THE RESTART PORTION OF CHECKPOINT/RESTART.     02300019
*                                                                       02400019
*                     C. POSITION TAPE TO CORRECT RECORD WITHIN DATA    02500002
*                        SET USING DCB POSITIONING INFORMATION.         02600019
*                                                                       02700019
*                     D. INITIALIZES, BUT DOES POSITION, TABLE          02710002
*                        ENTRIES FOR TAPES WHICH HAVE THE BYPASS        02720021
*                        OPTIONAL LEADING TAPE MARK AND/OR BYPASS       02730021
*                        EMBEDDED CHKPT RECORDS OPTION(S)               02740021
*                        SPECIFIED (DOS TAPES).  THESE TAPES ARE        02750021
*                        POSITIONED BY IGC0U05B.                        02760021
*                                                                       02770021
*ENTRY POINTS - IGC0S05B - INITIAL ENTRY TO THIS MODULE BY MEANS OF AN  02800019
*                          XCTL FROM IGC0L05B OR IGC0P05B.              02900002
*                                                                       03000019
*INPUT - REGISTER 8   BEGINNING OF DCB TABLE                            03100019
*        REGISTER 1   USER BUFFER AREA                                  03200019
*        REGISTER 10  USER BUFFER AREA                                  03250002
*        REGISTER 12  USER BUFFER AREA                                  03260002
*        REGISTER 6   POINTER TO SECONDARY WORK AREA                    03300019
*                                                                       03400019
*        ALL OPENED DCB (S) WITH THEIR ASSOCIATED CONTROL BLOCKS        03500019
*        THE 48 BYTE TABLE ENTRY (IES) THAT IS (ARE) USED IN RESTART    03600019
*        RESTART WORKAREA                                               03700019
*                                                                       03800019
*OUTPUT - REGISTER 8   BEGINNING OF DCB TABLE                           03900019
*         REGISTER 1   USER BUFFER AREA                                 04000019
*         REGISTER 10  USER BUFFER AREA                                 04050002
*         TAPE POSITIONED AT CORRECT RECORD WITHIN DATA SET             04100019
*                                                                       04200019
*EXTERNAL ROUTINE - SECLOADA                                            04300002
*                   IGC0Q05B - FOR RE-VERIFYING CHKPT DATA SETS  YM7337 04350002
*                                                                       04400019
*EXITS - NORMAL - FINAL EXIT IS MADE VIA XCTL TO THE NEXT MODULE OF     04500019
*                 REPI/O. WILL XCTL TO IGC0U05B IF ANY TAPE ENTRIES     04550021
*                 HAVE BEEN FLAGGED AS DOS TAPES.  OTHERWISE WILL       04600021
*                 XCTL TO IGC0R05B OR IGC0T05B                          04650021
*                                                                       04700019
*      - ERROR - ERROR EXITS ARE MADE VIA XCTL TO RESTART EXIT IGC0V05B 04800019
*                WITH RETURN CODES IN 'RSRETCOD' FIELD -                04900019
*                                                                       05000019
*                60 - ERRORS IN TRYING TO POSITION TO CORRECT DATA SET  05050032
*                                                                       05100032
*                63 - ERRORS IN TRYING TO POSITION TO CORRECT RECORD    05150032
*                     WITHIN DATA SET                                   05200032
*                                                                       05250032
*                219 - ERROR IN THAT CORRECT PASSWORD WAS NOT GIVEN     05300032
*                                                                       05560002
*                222 - DATA SET LABEL IN JFCB NOT SAME AS THAT IN TAPE  05570002
*                      LABEL                                            05580002
*                                                                       05590002
*TABLES/WORKAREAS - THE WORKAREA USED IS DESCRIBED BY THE DSECTS AT THE 05600019
*                   END OF THE LISTING.                                 05700019
*                                                                       05800019
*********************************************************************** 05900019
*                                                                     * 06000019
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 06100019
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 06200019
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 06300019
*    IS 48 BYTES LONG.                                                * 06400019
*                                                                     * 06500019
*********************************************************************** 06600019
*                                                                       06700019
*        ------------------- 4 BYTES -----------------                  06800019
*                                                                       06900019
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  07000019
*        +DATA SET  +           DCB                  +                  07100019
*        + ORGN.    +         ADDRESS                +                  07200019
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                07300019
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  07400019
*        + NO. 1    +         ADDRESS                +                  07500019
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  07600019
*        +NUMBER    +         JFCB TTR               +                  07700019
*        + OF VOLS  +         ADDRESS                +                  07800019
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               07900019
*                                                                       08000019
*     12 +++++++++++++++++++++++                                        08100019
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   08200019
*        +INFO BYTE + NUMBER   +                                        08300019
*        +++++++++++++++++++++++                                        08400019
*                                                                       08500019
*     12 +++++++++++++++++++++++                                        08600019
*        +    OLD   TIOT       +        DA AND UNIT RECORD              08700019
*        +      OFFSET         +                                        08800019
*        +++++++++++++++++++++++                                        08900019
*                                                                       09000019
*                              +++++++++++++++++++++++                  09100019
*                              +FLAG BYTE +FLAG BYTE +                  09200019
*                              +  NO. 2   +  NO. 3   +                  09300019
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  09400019
*        +FLAG BYTE +FLAG BYTE +                     +                  09500019
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  09600019
*        +++++++++++++++++++++++                     + 20               09700019
*        +                                           +                  09800019
*        +                                           +                  09900019
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  10000019
*        +                                           +                  10100019
*        +   VOLUME ID NO. 2                         +                  10200019
*        +                     +++++++++++++++++++++++ 28               10300019
*        +                     +                     +                  10400019
*        +                     +   VOLUME ID NO. 3   +                  10500019
*     32 +++++++++++++++++++++++                     +                  10600019
*        +                                           +                  10700019
*        +                                           +                  10800019
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               10900019
*        +                                           +                  11000019
*        +   VOLUME ID NO. 4                         +                  11100019
*     40 +                     +++++++++++++++++++++++                  11200019
*        +                     +                     +                  11300019
*        +                     +                     +                  11400019
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               11500019
*        +                                           +                  11600019
*        +                                           +                  11700019
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               11800019
*                                                                       11900019
*                                                                       12000019
*ATTRIBUTES - REENTRANT                                                 12100019
*             REUSABLE                                                  12200019
*             ENABLED                                                   12300019
*             PRIVILEGED                                                12400019
*                                                                       12500019
*********************************************************************** 12600019
         EJECT ,                                                 A27694 12620019
*                                                                       12640019
*********************************************************************** 12660019
*                                                                       12700019
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               12800019
*                                                                       12900019
*********************************************************************** 13000019
*                                                                       13100019
WRKR1    EQU   0                        WORK/PARAMETER REGISTER         13200019
R0       EQU   0                        REG 0                    YM7337 13250002
WRKR2    EQU   1                        WORK/PARAMETER REGISTER         13300019
R1       EQU   1                        REG 1                    YM7337 13400002
DCBR     EQU   2                        CURRENT DCB REGISTER            13500019
R2       EQU   2                        REG 2                    YM7337 13550002
BASER    EQU   3                        BASE RIGISTER                   13600019
R3       EQU   3                        REG 3                    YM7337 13650002
DEBR     EQU   4                        CURRENT DEB REGISTER            13700019
R4       EQU   4                        REG 4                    YM7337 13750002
UCBR     EQU   5                        CURRENT UCB REGISTER            13800019
R5       EQU   5                        REG 5                    YM7337 13850002
TIOTR    EQU   6                        NEW TIOT RESISTER               13900019
R6       EQU   6                        REG 6                    YM7337 13950002
TCBR     EQU   7                        TCB REGISTER                    14000019
R7       EQU   7                        REG 7                    YM7337 14050002
TABLR    EQU   8                        BEGINNING TO DCB TABLE REGISTER 14100019
R8       EQU   8                        REG 8                    YM7337 14150002
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      14200019
R9       EQU   9                        REG 9                    YM7337 14250002
BUFR     EQU   10                       USER BUFFER AREA                14300019
RA       EQU   10                       REG 10                   YM7337 14350002
DSCNTR   EQU   11                       NUMBER OF DATA SETS             14400019
RB       EQU   11                       REG 11                   YM7337 14450002
WRKR3    EQU   12                       WORK REGISTER                   14500019
RC       EQU   12                       REG 12                   YM7337 14550002
WRKR4    EQU   13                       WORK REGISTER                   14600019
R13      EQU   13                                                       14700019
RD       EQU   13                       REG 13                   YM7337 14750002
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         14800019
RE       EQU   14                       REG 14                   YM7337 14850002
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         14900019
RF       EQU   15                       REG 15                   YM7337 14950002
*                                                                       15000019
*********************************************************************** 15100019
*                                                                       15200019
*    OFFSETS TO BE USED IN REPI/O PHASE                                 15300019
*                                                                       15400019
*********************************************************************** 15500019
*                                                                       15600019
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        15700019
TPDEV    EQU   X'10'                    TAPE DEVICE                     15800019
LASTENT  EQU   X'08'                    LAST ENTRY                      15900019
BLP      EQU   X'10'                    BYPASS LABEL PROCESSING  A31340 15920020
AL       EQU   X'08'                    ASCII LABEL              S20038 15950020
SL       EQU   X'02'                    STANDARD LABEL                  16000019
NL       EQU   X'01'                    NO LABEL                        16100019
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                16200019
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               16300019
TABENT   EQU   48                       TABLE ENTRY LENGTH              16400019
READ     EQU   X'02'                    READ FOR TAPE                   16500019
NOPOP    EQU   X'03'                    NOP                             16600019
REWIND   EQU   X'07'                    REWIND                          16700019
READBACK EQU   X'0C'                    READBACK                        16800019
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             16900019
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              17000019
TIC      EQU   X'08'                    TIC                             17100019
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 17200019
ERR060   EQU   60                       ERROR IN DATA SET POSIT@ZSUT222 17250032
ERR063   EQU   63                       ERROR IN RECORD POSIT. @ZSUT222 17300032
ERR219   EQU   219                      ERR ID WRONG PASSWORD  @ZSUT222 17350032
ERR222   EQU   222                      ERR ID NO DS LABEL VERIFYY02049 17460002
FLAGS    EQU   X'30'                                                    17500019
COUNT    EQU   X'0D'                                             A27280 17600019
ONE      EQU   X'01'                    CONSTANT ONE                    17700019
SLFLAG   EQU   X'01'                    FLAG FOR SL IN UCB              17800019
ALFLAG   EQU   X'04'                    FLAG FOR AL IN UCB       S20038 17850020
IN       EQU   X'80'                    SYSIN DATA SET (UCBWGT)         17900019
EXCHPGM  EQU   X'80'                    EXCP                            18000019
DADEVDPT EQU   X'0C'                    DA DEVICE DEPENDENT SECTION     18100019
RDBACK   EQU   X'03'                    READ BACKWARDS (DEBOPATB)       18200019
ERRORS   EQU   X'FF'                    ERROR CODE MASK          Y02049 18250002
ERRCHKPT EQU   X'C0'                    PERMANENT ERROR AT CHECKPOINT   18400019
NOOPS    EQU   X'FF'                                                    18500019
RESET    EQU   X'FE'                    RESET SL FLAG            A32901 18550020
REW      EQU   X'80'                    REWIND MASK FOR TABOPS          18600019
FSF      EQU   X'40'                    FORWARD SPACE FILE MASK         18700019
BSF      EQU   X'20'                    BACK SPACE FILE MASK            18800019
RDOP     EQU   X'10'                    READ FORWARD MASK               18900019
RDBK     EQU   X'08'                    READ BACKWARD MASK              19000019
BUSY     EQU   X'80'                                                    19100019
NOTBUSY  EQU   X'00'                                                    19200019
BLANK    EQU   X'40'                                                    19300019
IBITS    EQU   X'0C'                    UNIQUE DEB INPUT BITS    A33655 19330020
EOFRST   EQU   X'DF'                    DEB EOF RESET MASK       A33655 19360020
ZERO     EQU   0                                                        19400019
WAIT     EQU   7                                                        19500019
EQUAL    EQU   8                                                        19600019
NOTMIX   EQU   9                                                        19700019
D0       EQU   0                                                        19800019
D1       EQU   1                                                        19900019
D2       EQU   2                        TWO                      Y02049 19910002
D3       EQU   3                        OFFSET 3                 Y02049 19950002
D4       EQU   4                                                        20000019
D7       EQU   7                                                        20100019
D8       EQU   8                                                        20200019
D16      EQU   16                       DEB OFFSET BSAM-QSAM SEC Y02049 20202002
C17      EQU   17                       TAPE LABEL LENGTH        YM7509 20204002
D24      EQU   24                       24 BYTES                 Y02049 20210002
D40      EQU   40                       10 WORDS                 Y02049 20220002
D80      EQU   80                       HDR LENGTH               Y02049 20250002
D83      EQU   83                       OFFSET 83                Y02049 20260002
D160     EQU   160                      STORAGE CONSTANT         Y02049 20270002
D280     EQU   280                      OFFSET TO JFCB IN WRAREA Y02049 20280002
D323     EQU   323                      OFFSET TO LAST NAME CHAR Y02049 20290002
DX2      EQU   X'02'                    PASSWORD TEST ID         Y02049 20294002
L1       EQU   1                                                        20300019
L4       EQU   4                                                        20400019
L8       EQU   8                                                        20500019
L18      EQU   18                                                       20600019
L23      EQU   23                                                       20700019
L24      EQU   24                                                       20800019
L26      EQU   26                                                S21040 20810021
AMMOD    EQU   X'E3'      CHARACTER T - ACCESS METHOD DISP. MOD. S21040 20820021
DAMOD    EQU   X'D9'      CHARACTER R - DIRECT ACCESS MODULE     S21040 20830021
DOSMOD   EQU   X'E4'      CHARACTER U - DOS TAPE POSITION MODULE S21040 20840021
NOTMIXED EQU   11                       BRANCH ON NOT MIXED      S21040 20850021
DOSTAPE  EQU   X'01'                    DOS TAPE MASK            S21040 20860021
READOP   EQU   X'F1'                    OP CODE IS READ OR READ  S21040 20870021
*                                       BACK IF THESE BITS ARE 0        20870402
D44      EQU   44                       MAX NO. DATA SET NM CHARSY02049 20872002
D43      EQU   43                       DATA SET NAME OFFSET     Y02049 20874002
PASSIND  EQU   X'F7'                    RESET MASK PASSWORD CHK  Y02049 20878002
DF1      EQU   X'F1'                    CHAR ONE                 Y02049 20878402
DF2      EQU   X'F2'                    CHAR TWO                 Y02049 20878802
D128     EQU   128                      SECLOADA SPACE CONSTANT  Y02049 20879202
ECBBGADR EQU   32                       ECB ADR OFFSET           Y02049 20879602
IOBCCWOF EQU   96                       OFFSET FOR SECLOADA CCWS Y02049 20879702
GOTSTOR  EQU   X'FF'                    SECLOADA STOR GOTTEN IND Y02049 20879802
RTNSW    EQU   X'02'                    RTN FROM SECLOADA SW     Y02049 20879902
READTAPE EQU   X'02'                    READ TAPE OP CODE        Y02049 20886602
BYTECNT  EQU   80                       HDR1&HDR2 RECORD SIZE    Y02049 20888602
HIORDER  EQU   8                        ICM&STCM MASK            Y02049 20892602
ADRBYTES EQU   7                        ICM&STCM MASK            Y02049 20893002
JFCBLNTH EQU   176                      JFCB LENGTH              Y02049 20893102
INPUTMSK EQU   X'04'                    OPEN FOR INPUT MASK      Y02049 20893202
PASSWDID EQU   X'04'                    PASSWORD POS REQ IND     Y02049 20919902
RLOCKSW  EQU   X'00'                    RESET MASK WRK AREA LK SWY02049 20929902
WRITEFLG EQU   X'30'                    PASSWORD WRITE CHK IND   Y02049 20939902
RDWTRFLG EQU   X'10'                    PASSWORD RD/WTR CHK IND  Y02049 20941902
RESETFLG EQU   X'00'                    FLAGS RESET MASK         Y02049 20943902
LOCKSW   EQU   X'01'                    WORKAREA LOCK SW         Y02049 20953902
DEBPRFLN EQU   16                       LENGTH OF DEB PREFIX     Y02049 20963902
QMWAOFST EQU   24                       WA OFFSET                YM7077 20965902
MODECLR  EQU   X'C0'                    DENSITY SET              YM7551 20967902
SETMODE  EQU   X'2B'                    EVEN PAR TRANS MD CVT OFFYM7551 20969902
CHKPTFLG EQU   C'C'                     HDR2 CHKPT D.S. FLAG     YM7337 20971902
*                                                                       20973302
*********************************************************************** 21000019
*                                                                       21100019
         EJECT ,                                                 A27694 21150019
         BALR  BASER,ZERO               ESTABLISH ADDRESSIBILITY        21200019
         USING *,BASER                  ESTABLISH BASE REG              21300019
         B     BEGIN                    BR AROUND EYE CATCHER    Y01909 21350002
         CNOP  0,8                      ALIGN TO A DBL WRD BNDRY Y01909 21360002
         DC    CL8'IGC0S05B'            MODULE NAME            @ZSUT222 21370032
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZSUT222 21372032
         DC    CL8'@ZSUT222'            LAST CODE SHIPPED      @ZSUT222 21374032
         DC    CL8'@SU83200'            SELECTABLE UNIT ID     @ZSUT222 21376032
BEGIN    EQU   *                                                 Y01909 21380000
*                                                                       21400019
         USING IHADCB,DCBR                                              21500019
         USING DEBBASIC,DEBR                                     Y02049 21550002
         USING UCBOB,UCBR                                               21700019
         USING TABL,CTABLR                                              21800019
         USING RSTWA,BUFR                                               21900019
         USING RSDSECT,WRKR4                                            22000019
*********************************************************************** 22050002
*              TEST FOR RETURN FROM SECLOADA                          * 22060002
*********************************************************************** 22070002
         MODESET EXTKEY=ZERO            KEY 0                    Y02049 22072002
         TM    TABFLG2,TABSW            TEST SW IN CURRENT TAB   Y02049 22080002
         BO    PASSWORD                 PROCESS SECLOADA RTN COD YM7337 22090002
***                                                              YM7337 22092002
*        GET DADSM-LIKE WORK AREA FOR BOTH SECLOADA CALL         YM7337 22094002
*        AND CALL TO Q05B                                        YM7337 22096002
***                                                              YM7337 22098002
         LA    RF,RSREGSAV              GET ADDR SAVE AREA       YM7337 22098402
         STM   R0,RF,D0(RF)             SAVE REGS                YM7337 22098802
         XR    R1,R1                    PHONY PREV WORK AREA     YM7337 22099202
         IECRES GET,LV=256,A=(R1),ID=S05B,PREFIX=YES             YM7337*22099602
                                        GET SECLOADA WORK AREA   YM7337 22099702
         USING IECEXTPR,R1              W/A ADDR                 YM7337 22099802
         MODESET EXTKEY=ZERO            RET FROM GET IS KEY=5    YM7337 22099902
         LM    R2,RF,D2*4(RF)           RESTORE REGS             YM7337 22133202
         MVC   WTGWTOPR(D4),WTGCODE     SET WTO FLAGS            YM7337 22143202
         ST    R1,SECSWICH              SAVE CORE ADDR           YM7337 22153202
         DROP  R1                       R1 = BLAH                YM7337 22163202
         LM    R0,R1,RSREGSAV           RESTORE REGS 0 AND 1     YM7337 22165202
*                                                                       22166702
*                                                                       22200019
         LR    BUFR,WRKR2               SAVE POINTER TO RSWA            22300019
         LR    CTABLR,TABLR             INITIALIZE TABL PTR             22400019
         L     WRKR4,TABSEGAD-D1        WORKAREA SEGMENT ADDR           22500019
*                                                                       22600019
*                                                                       22700019
REPDCB00 EQU   *                                                        22800019
*                                                                       22900019
         TM    TABFLG1,TABTAPE          IS IT TAPE DEVICE               23000002
         BNO   REPDCB26                 BRANCH IF NOT TO GET NEXT ENTRY 23100019
*                                                                       23150002
         TM    TABFLG2,TABRSDS          IS THIS THE WORKING      YM7358 23160002
*                                       RESTART DATA SET?        YM7358 23170002
         BNO   REPDCB01                 NO, CONTINUE PROCESSING  YM7358 23180002
         MVI   TABOPS,ZERO              INDICATE REPOSITIONING   YM7358 23190002
*                                       NOT TO TAKE PLACE ON THE YM7358 23194002
*                                       WORKING RESTART DATA SET YM7358 23196002
         B     REPDCB26                 GO GET NEXT ENTRY        YM7358 23198002
*                                                                       23200019
*    ****************************************************************** 23300019
*                                                                       23400019
*    *** ALL TAPES OTHER THAN THOSE FOR SYSIN DATA SETS AND             23500019
*        THOSE THAT HAVE NON-STANDARD LABELS ARE ASSUMED TO BE          23600019
*        POSITIONED AT LOAD POINT UPON ENTRY TO THIS MODULE ***         23700019
*                                                                       23800019
*    ****************************************************************** 23900019
*                                                                       24000019
*    *** SYSIN DATA SETS ***                                            24100019
*                                                                       24200019
*        THE SCHEDULER WOULD HAVE POSITIONED THE TAPE AT THE INTER-     24300019
*        RECORD GAP IMMEDIATELY PRECEDING THE FIRST DATA RECORD IN THE  24400019
*        USER'S INPUT STREAM                                            24500019
*                                                                       24600019
*    *** NON-STANDARD LABELS ***                                        24700019
*                                                                       24800019
*        THE USER PROVIDED LABEL PROCESSING ROUTINE WOULD HAVE ALREADY  24900019
*        REPOSITIONED UP TO THE CORRECT DATA SET, LEAVING THE TAPE AT   25000019
*        THE INTERRECORD GAP THAT PRECEDES THE INITIAL RECORD OF THE    25100019
*        DATA SET ON THE CURRENT VOLUME                                 25200019
*                                                                       25300019
*    ****************************************************************** 25400019
*                                                                       25500019
*    *** PICK UP NECESSARY ADDRESSES ***                                25600019
*                                                                       25700019
REPDCB01 EQU   *                                                 YM7358 25750002
         TM    TABFLG2,TABG5V          GREATER THEN 5 VOLS ?   @ZA02883 25800037
         BZ    REPDCB02                BRANCH IF NOT           @ZA02883 25820037
         MVC   TABJFCB(D3),TABVLID5+D3 RESTORE JFCB TTR        @ZA02527 25840032
REPDCB02 XC    TABVLID2(L24),TABVLID2   ZERO WORK SPACE IN TAB @ZA02883 25860037
         L     WRKR4,TABSEGAD-D1        WORKAREA SEGMENT ADDR           25900019
         L     DCBR,TABDCBAD-D1         DCB ADDR IN THIS ENTRY          26000019
         L     DEBR,DCBDEBAD            DEB ADDR ASSOC WITH THIS DCB    26100019
         L     UCBR,DEBSUCBA            UCB ADDR ASSOC WITH THIS DEB    26200002
*                                                                       26300019
         ST    UCBR,TABUCB              POINTER TO UCB IN TABL          26400019
*                                                                       26500019
*    *** INITIALIZE CHANNEL PROGRAM ***                                 26600019
*                                                                       26700019
         XC    RSCCW1(L26),RSCCW1       CLEAR CCW THROUGH END    S21040 26760021
*                                       OF WORK SPACE                   26820021
*                                                                       26900019
         MVI   RSCCW1+D4,FLAGS          SET SLI, SKIP BITS ON           27000019
         MVI   RSCCW1+D7,COUNT          SET BYTE COUNT TO ONE           27100019
*                                                                       27200019
         CLI   TABFSQNO,ZERO            IS FILE SEQ NO. ZERO     A27694 27340019
         BNE   REPDCB90                 BR IF NOT               OX01653 27360002
         MVI   TABFSQNO,ONE             SET FILE SEQ NO. = 1    OX01653 27370002
REPDCB90 EQU   *                                                OX01653 27372002
*                                                                       28000019
         SR    DSCNTR,DSCNTR            CLEAR REG                       28100019
         IC    DSCNTR,TABFSQNO          GET FILE SEQ NO. IN JFCB        28200019
*                                                                       28300019
*********************************************************************** 31750002
*        SET UP TO DO POSSIBILE PASSWORD CHECKS FOR SL LABELED TAPES  * 31752002
*********************************************************************** 31754002
REPDCB06 EQU   *                                                        31760002
         TM    TABTPLBL,SL              STANDARD LABELED TAPE    Y02049 31770002
         BNO   REPDCX06                 NO  CONTINUE             Y02049 31780002
         LA    WRKR2,RSTLABEL           TAPE LABEL BUFFER ADR    Y02049 31790002
         STCM  WRKR2,ADRBYTES,RSCCW2+D1 PUT BUFFER ADR IN CCW    Y02049 31792002
         MVI   RSCCW2,READTAPE          OP CODE FOR TAPE READ    Y02049 31798402
         MVI   RSCCW2+D7,BYTECNT        READ 80 BYTES OF DATA    Y02049 31798802
         XC    RSCCW2+D4(D1),RSCCW2+D4  DATA TRANS/NO WRONG LNG  Y02049 31799202
         MVI   RSPASSFL,D0              CLEAR PASSWORD FLAG BYTE Y02049 31799602
*                                                                       31800019
*    ****************************************************************** 31900019
*                                                                       32000019
*    *** CHECK LABEL TO DETERMINE PROCESSING METHOD ***                 32100019
*                                                                       32200019
*    ****************************************************************** 32300019
*                                                                       32400019
REPDCX06 EQU   *                        INSTR MUST FOLLOW        Y02049 32400402
         LR    WRKR3,DSCNTR             SAVE FILE SEQ NUMBER     A38125 32402020
         NI    SRTESTAT,RESET           RESET SL FLAG IN UCB     A32901 32405020
         TM    TABTPLBL,SL+AL           IS IT SL OR AL           S20038 32410020
         BZ    REPDCB10                 BRANCH IF NOT TO CHECK   S20038 32420020
*                                       FOR NL                   S20038 32430020
*                                                                       32440020
         TM    TABTPLBL,SL              IS IT STANDARD LABEL            32500019
         BZ    REPDCB09                 BRANCH IF NOT - MUST BE  S20038 32560020
*                                       AL                       S20038 32620020
*                                                                       32700019
*    *** POSITION TO CORRECT DATA SET FOR STANDARD LABEL ***            32800019
*                                                                       32900019
         OI    SRTESTAT,SLFLAG          SET FLAG IN UCB FOR SL          33000019
*                                                                       33100019
REPDCB07 EQU   *                                                 S20038 33130020
*                                                                       33160020
         OI    TABOPS,FSF               SET TABOPS CODE FOR FSF         33200019
*                                                                       33300019
         CLI   TABFSQNO,ONE             IS FILE SEQ NO. ONE             33400019
         BNE   REPDCB08                 BRANCH NO TO SET NO. FOR FSF    33500019
         MVI   TABFSFN1,ONE             SET NUMBER OF FSF TO ONE        33600019
         B     REPDCB12                 GO TO UPDATE UCB FILE SEQ NO    33800019
*                                                                       33900019
REPDCB08 EQU   *                                                        34000019
*                                                                       34100019
         BCTR  DSCNTR,ZERO              SUBTRACT ONE FOR FIRST FILE     34200019
         LR    TCBR,DSCNTR              MULTIPLY FILE SEQ NUMBER A33101 34300020
         AR    DSCNTR,DSCNTR            BY THREE AND ADD ONE     YM7567 34400002
         LA    DSCNTR,D1(DSCNTR,TCBR)   FOR FIRST FILE LABEL     YM7567 34500002
         STC   DSCNTR,TABFSFN1          SET FSQNO FOR FSF               34600019
         B     REPDCB12                 BRANCH TO POSITION RECORD       34700019
*                                                                       34710020
REPDCB09 EQU   *                                                 S20038 34720020
*                                                                       34730020
         OI    SRTESTAB,ALFLAG          SET FLAG IN UCB FOR AL   S20038 34740020
         B     REPDCB07                 BRANCH TO POSITION AS    S20038 34750020
*                                       FOR SL                   S20038 34760020
*                                                                       34770020
*                                                                       34800019
REPDCB10 EQU   *                                                        34900019
*                                                                       35000019
         TM    TABTPLBL,BLP+NL          IS IT BLP OR UNLABELED   A31340 35100020
         BZ    REPDCB14                 BR IF NOT, MUST BE NSL   A31340 35200020
*                                                                       35400019
         TM    TABTPLBL,NL              IS IT NL ONLY ?        @ZA14566 35420037
         BNO   *+8                      NO BRANCH AHEAD        @ZA14566 35440037
         OI    UCBTFL1,UCBNLTP          SET NL IN UCB          @ZA14566 35460037
*    *** POSITION TO CORRECT DATA SET FOR UNLABELED TAPE ***            35500019
*                                                                       35600019
*                                                                       35700019
         CLI   TABFSQNO,ONE             IS FILE SEQ NO. ONE             35800019
         BE    REPDCB12                 BRANCH YES TO POSITION RECORD   35900019
*                                                                       36000019
*                                                                       36100019
         OI    TABOPS,FSF               SET TABOPS CODE FOR FSF         36200019
*                                                                       36300019
         BCTR  DSCNTR,ZERO              SUBTRACT ONE FOR FIRST FILE     36400019
         STC   DSCNTR,TABFSFN1          SAVE NUMBER OF FSF'S            36500019
*                                                                       36600019
*                                                                       36700019
REPDCB12 EQU   *                                                        36800019
*                                                                       36900019
         MVC   SRTEFSEQ+1(1),TABFLG5    LOG SEQ NO. TO UCB      OX01653 36950002
         MVI   SRTEFSEQ,0               CLEAR HI ORDER BYTE     OX01653 36960002
         STH   WRKR3,SRTEFSCT           PUT UPDATED FILE SEQ CNT IN UCB 37100019
*                                                                       37200019
REPDCB14 EQU   *                                                        37300019
*                                                                A33655 37310020
* THE DEBOFLGS-EOF-BIT IS RESET FOR ALL INPUT TAPE DATA SETS TO  A33655 37320020
* PREVENT A TAPE POSITIONING ERROR AT CLOSE TIME.  THIS PROBLEM  A33655 37330020
* OCCURS IF A TAPE DATA SET ENCOUNTERS EOF AND A CHECKPOINT IS   A33655 37340020
* TAKEN BEFORE IT IS CLOSED.                                     A33655 37350020
*                                                                A33655 37360020
         TM    DEBOPATB,IBITS           Q - INPUT D/S            A33655 37370020
         BNZ   REPDCB15                 IF NOT, BR               A33655 37380020
         NI    DEBOFLGS,EOFRST          RESET DEB-EOF-FLAG IF ON A33655 37390020
REPDCB15 EQU   *                                                 A33655 37400020
*    ****************************************************************** 37500019
*                                                                       37600019
*    *** RECORD POSITIONING IS PERFORMED ONLY IF THE PHYSICAL BLOCK     37700019
*        COUNT IS PRESENT IN THE DCB***                                 37800019
*                                                                       37900019
*    *** DATA SETS ARE POSITIONED IN A FORWARD DIRECTION TO THE CORRECT 38000019
*        RECORD ACCORDING TO THE POSITIVE PHYSICAL BLOCK COUNT ONLY,    38100019
*        WITH THE ONE EXCEPTION, WHERE THE TAPE IS NOT LABELED AND IS   38200019
*        BEING PROCESSED BACKWARDS ***                                  38300019
*                                                                       38400019
*    *** ALL OTHER TAPES ARE POSITIONED TO EITHER THE BEGINNING OR THE  38500019
*        END OF THE DATA SET, DEPENDING ON WHETHER THEY WERE OPENED FOR 38600019
*        FORWARD OR BACKWARD PROCESSING ***                             38700019
*                                                                       38800019
*    ****************************************************************** 38900019
*                                                                       39000019
         SR    TCBR,TCBR                CLEAR REGISTER                  39100019
*                                                                       39200019
         LR    DSCNTR,DEBR              GET ADDR OF DEB FOR CALC Y02049 39250002
         LA    UCBR,DEBPRFLN            GET LENGTH OF DEB PREFIX Y02049 39300002
         SR    DSCNTR,UCBR              POINT TO DEB PREFIX      Y02049 39350002
         USING DEBPREFX,DSCNTR                                   Y02049 39360002
         L     DSCNTR,DEBXTNP           POINT TO DEB EXTENSION   Y02049 39370002
         USING DEBXTN,DSCNTR                                     Y02049 39380002
         TM    DEBXMCF1,DCBMRECP        IS IT EXCP               Y02049 39390002
         BNO   REPDCB16                 BRANCH IF NOT TO CHECK BLKCT    39400019
*                                                                       39500019
         TM    DEBXMCF2,DCBMR5WD+DCBMR4WD                        Y02049 39550002
*                                       IS DEV DEPENDANT SEC PRESENT    39650002
         BZ    REPDCB24                 BRANCH IF NOT TO CHECK RDBACK   39700019
         DROP  DSCNTR                                            Y02049 39750002
         L     DSCNTR,DCBBLKCT          SET UP BLOCK COUNT     @ZA26571 39758037
         LTR   DSCNTR,DSCNTR            SET UP CONDITION CODE  @ZA26571 39766037
         BZ    REPDCB22                 BRANCH IF BLKCOUNT 0   @ZA26571 39774037
         BM    REPDCB18                 BRANCH IF NEGATIVE     @ZA26571 39782037
         B     TESTBLK                  BRANCH IF POSITIVE     @ZA26571 39790037
*                                                                       39800019
REPDCB16 EQU   *                                                        39900019
*                                                                       40000019
         L     DSCNTR,DCBBLKCT          SET CTR TO POSITION RECORD      40100019
         LTR   DSCNTR,DSCNTR            GET CONDITION CODE              40200019
         BZ    REPDCB22                 BRANCH IF BLKCT IS ZERO         40300019
         BM    REPDCB18                 BRANCH IF NEGATIVE TO CHECK NL  40400019
* IF THERE WAS A CHECKPOINT TAKEN AFTER THE EOF WAS DETECTED   @ZA10259 40500037
* BY THE SAM APPENDAGE BUT NOT CHECKED BY THE SYNCHRONIZING    @ZA10259 40510037
* OR CHECK MODULE THUS RESULTING IN AN SVC 55 (END OF VOLUME)  @ZA10259 40520037
* THEN WE ADD ONE TO THE BLOCKCOUNT FOR CHAIN SCHEDULING.      @ZA10259 40530037
         TM    DCBCIND2,DCBCNCHS USING CHAIN SCHEDULING ??     @ZA20448 40536037
         BNO   TESTBLK           NO BRANCH                     @ZA10259 40542037
         L     WRKR3,DCBIOBA     GET THE CURRENT IOB ADDRESS   @ZA10259 40550037
         LA    WRKR3,0(WRKR3)    CLEAR HIGH ORDER BYTE         @ZA10259 40560037
         TM    20(WRKR3),ONE     ARE WE POSTED UNIT EXCEPTION  @ZA10259 40570037
         BO    SETBLK            YES ADD ONE TO FSF COUNT      @ZA10259 40580037
         L     WRKR4,0(WRKR3)    GET NEXT IOB/ICB              @ZA10259 40590037
BACK     EQU   *                                               @ZA10259 40600037
         LA    WRKR4,0(WRKR4)    CLEAR HIGH ORDER BYTE         @ZA10259 40610037
         CR    WRKR3,WRKR4       ARE THEY EQUAL                @ZA10259 40620037
         BE    TESTBLK           YES ONLY 1 IOB OR LAST        @ZA10259 40630037
TESTUE   EQU   *                                               @ZA10259 40640037
         TM    20(WRKR4),ONE     IS UNIT EXCEPTION ON ?        @ZA10259 40650037
         BNO   GETNEXT           NO GET NEXT IOB/ICB           @ZA10259 40660037
SETBLK   EQU   *                                               @ZA10259 40670037
         OI    TABDSORG,X'08'    SET FLAG                      @ZA10259 40680037
         LA    WRKR4,1           SET REG TO 1                  @ZA10259 40690037
         AR    DSCNTR,WRKR4      INCREMENT REG                 @ZA10259 40695037
         B     TESTBLK           BRANCH                        @ZA10259 40700037
GETNEXT  EQU   *                                               @ZA12059 40720037
         L     WRKR4,0(WRKR4)    GET NEXT IOB/ICB              @ZA10259 40730037
         B     BACK              BRANCH BACK                   @ZA10259 40740037
*                                                                       40750037
TESTBLK  EQU   *                                               @ZA10259 40760037
*    *** POSITION TO CORRECT RECORD FOR ALL TAPES ***                   40770037
         OI    TABOPS,RDOP              SET TABOPS CODE FOR RD FWD      40900019
         ST    DSCNTR,TABBLK1           SAVE BLOCK COUNT FOR READ       41000019
*                                                                       41100019
*                                                                       41200019
         B     REPDCB26                 BRANCH TO GET NEXT ENTRY        41300019
*                                                                       41400019
REPDCB18 EQU   *                                                        41500019
*                                                                       41600019
*    *** POSITION TO CORRECT RECORD ONLY IF UNLABELED AND READ BACK *** 41700019
*                                                                       41800019
          STM   WRKR5,WRKR3,RSREGSAV+12    SAVE REG  FOR ERROR  ZA02208 41850037
         TM    TABTPLBL,BLP+NL          IS IT BLP OR UNLABELED   A31340 41900020
         BZ    REPDCB64                 BR IF NO TO SET ERR CODE A31340 42000020
*                                                                       42100019
         TM    DEBOPATB,RDBACK          IS IT RDBACK                    42200019
         BC    NOTMIX,REPDCB64          BRANCH IF NOT TO SET ERROR CODE 42300019
*                                                                       42400019
REPDCB20 EQU   *                                                        42500019
*                                                                       42600019
*    *** POSITION TO END OF DATA SET ***                                42700019
*                                                                       42800019
         OI    TABOPS,FSF+BSF           INDICATE BOTH FSF-BSF TO S21040 43260021
*                                       POSITION TO END OF DATA SET     43320021
         SR    WRKR5,WRKR5              ZERO OUT REGISTER        YM7567 43370002
         IC    WRKR5,TABFSFN1           GET REQUIRED NO OF FSF'S YM7567 43380002
         LA    WRKR5,D1(,WRKR5)         INCREMENT BY 1 FOR END   YM7567 43392002
*                                       OF DATA SET              YM7567 43396002
         STC   WRKR5,TABFSFN1           STORE FSF COUNT          YM7567 43398002
*                                                                       43400019
         LTR   TCBR,TCBR                IS BYPASS SWITCH ON             43500019
         BNZ   REPDCB26                 BRANCH IF YES TO GET NEXT ENTRY 43600019
*                                                                       43700019
*                                                                       43800019
*    *** POSITION TO CORRECT RECORD FOR READ BACKWARD ***               43900019
*                                                                       44000019
         OI    TABOPS,RDBK              SET TABOPS CODE FOR RD BACKWARD 44100019
         LPR   DSCNTR,DSCNTR            GET BLOCK COUNT POSITIVE        44200019
         ST    DSCNTR,TABBLK1           SAVE BLKCT IN TABL              44300019
         B     REPDCB26                 BRANCH TO GET NEXT ENTRY        44400019
*                                                                       44500019
REPDCB22 EQU   *                                                        44600019
*                                                                       44700019
*    *** RECORD POSITIONING IS NOT NECESSARY ***                        44800019
*                                                                       44900019
         TM    TABTPLBL,BLP+NL          IS IT BLP OR UNLABELED   A31340 45000020
         BZ    REPDCB26                 BR IF NOT                A31340 45100020
*                                                                       45200019
REPDCB24 EQU   *                                                        45300019
*                                                                       45400019
         TM    DEBOPATB,RDBACK          IS IT RDBACK                    45500019
         BC    NOTMIX,REPDCB26          BRANCH IF NOT TO GET NEXT ENTRY 45600019
*                                                                       45700019
         LA    TCBR,ONE                 SET SWITCH TO BYPASS RECORD     45800019
*                                            POSITIONING                45900019
         B     REPDCB20                 BRANCH TO POSITION TO END OF    46000019
*                                            DATA SET                   46100019
REPDCB26 EQU   *                                                        46200019
*                                                                       46300019
*    ****************************************************************** 46400019
*                                                                       46500019
*    *** DETERMINE IF MORE ENTRIES ARE TO BE PROCESSED ***              46600019
*                                                                       46700019
*    ****************************************************************** 46800019
*                                                                       46900019
         SR    TCBR,TCBR                TURN BYPASS SWITCH OFF          47000019
*                                                                       47100019
         TM    TABFLG1,TABLAST          IS THIS LAST ENTRY       Y02049 47150002
         BO    REPDCB27                 BR YES TO INIT I/O       S21040 47300021
*                                                                       47400019
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL PTR              47500019
         B     REPDCB00                 BRANCH TO PICK UP NEXT ENTRY    47600019
         EJECT                                                   YM7337 47650002
*    ****************************************************************** 47660002
*                                                                       47700019
*        THIS ROUTINE WILL PERFORM ALL THE NECESSARY I/O OPERATIONS     47800019
*        ACCORDING TO THE TABLE BUILT IN THE END OF EACH TABL ELEMENT.  47900019
*                                                                       48000019
*                                                                       48100019
*    ****************************************************************** 48200019
REPDCB27 EQU   *                                                 S21040 48230021
         SR    DSCNTR,DSCNTR            DOS TAPE INDICATOR              48260000
REPDCB28 EQU   *                                                        48300019
         LR    CTABLR,TABLR             INITIALIZE TABL POINTER         48400019
         SR    WRKR3,WRKR3              TURN OFF SPIN SWITCH            48500019
         SR    WAIT,WAIT                TURN ON DO NOT WAIT SWITCH      48600019
REPDCB30 EQU   *                                                        48700019
         L     WRKR4,TABSEGAD-D1        WORK AREA SEGMENT ADDRESS       48800019
         TM    TABFLG1,TABTAPE+TABDOSTP  NON DOS TAPE            Y02049 48850002
         BC    NOTMIXED,REPDCB52        BR NO TO GET NEXT ENTRY  S21040 49000021
*                                                                       49100019
         TM    TABOPS,NOOPS             ANY I/O NEEDED FOR THIS ELT     49200019
         BZ    REPDCB52                 BRANCH NO TO GET NEXT ELT       49300019
         LA    WRKR3,ONE                TURN ON SPIN SWITCH             49400019
         TM    RSSTAT2,LOCKSW           WORK AREA LOCK SW ON     Y02049 49450002
         BO    REPDCBC0                 YES  SEE WHO IS REQ USE  Y02049 49460002
REPDCX30 EQU   *                        INSTR MUST FOLLOW        Y02049 49470002
         TM    RSSTAT1,BUSY             IS WORK AREA BUSY               49500019
         BZ    REPDCB32                 BRANCH NO TO CONTINUE           49600019
         BAL   WRKR5,REPDCB56           GO TO WAIT ROUTINE              49700019
*                                                                       49800019
REPDCB32 EQU   *                                                        49900019
*                                                                       50000019
         TM    TABOPS,REW               IS REWIND NECESSARY             50100019
         BZ    REPDCB34                 BRANCH NO REWIND                50200019
*                                                                       50300019
*        REWIND ROUTINE                                                 50400019
*                                                                       50500019
         XI    TABOPS,REW               PEEL OFF REWIND MASK            50600019
*                                                                       50700019
         MVI   RSCCW1,REWIND            SET CCW OP CODE TO REWIND       50800019
         B     REPDCB48                 GO TO EXCP                      50900019
*                                                                       51000019
REPDCB34 EQU   *                                                        51100019
*                                                                       51200019
*        FORWARD SPACE FILE ROUTINE                                     51300019
*                                                                       51400019
         TM    TABOPS,PASSWDID          PASSWORD CHECK REQUIRED  Y02049 51450002
         BO    REPDCBA0                 YES READ HEADER LABELS   Y02049 51460002
         TM    TABOPS,FSF               IS FSF NECESSARY                51500019
         BZ    REPDCB38                 BRANCH NO TO CHECK BSF          51600019
*                                                                       51700019
*        FSF                                                            51800019
*                                                                       51900019
*        FOR STANDARD LABEL TAPES, THE FSF ROUTINE WILL DO N-1   YM7567 51950002
*        FSF'S, BASED ON THE NUMBER IN TABFSFN1.  IF GOING TO    YM7567 51960002
*        THE SECOND FILE HDR RECORDS, TABFSFN1 WILL BE SET TO    YM7567 51980002
*        FOUR, AND THREE FSF'S WILL BE DONE.                     YM7567 51990002
*        FOR NON-LABELED TABES, THE FSF ROUTINE WILL DO N        YM7567 51992002
*        FSF'S BASED ON THE NUMBER IN TABFSFN1.                  YM7567 51994002
*                                                                       51996002
         SR    WRKR6,WRKR6                                              52000019
         IC    WRKR6,TABFSFN2           GET NUMBER OF FSF ALREADY DONE  52100019
         LA    WRKR6,D1(WRKR6)          ADD ONE                         52200019
         STC   WRKR6,TABFSFN2           SAVE NUMBER OF FSF'S            52300019
         CLC   TABFSFN1(L1),TABFSFN2    WILL THIS BE ENOUGH             52400019
         BNE   REPDCB36                 BRANCH NO NOT ENOUGH            52500019
*                                                                       52600019
         XI    TABOPS,FSF               PEEL OFF FSF MASK               52700019
         TM    TABTPLBL,SL              TEST FOR STANDARD LABEL  Y02049 52750002
         BNO   REPDCB36                 NO STANDARD LABEL        Y02049 52760002
         OI    TABOPS,PASSWDID          IND POSSIBLE PASSWORD CK YM7055 52770002
*********************************************************************** 52780002
*              ROUTINE TO VERIFY DATA SET LABELS AND TO DO            * 52790002
*              PASSWORD PROTECTION IF REQUIRED.                       * 52792002
*********************************************************************** 52794002
REPDCBA0 EQU   *                        INSTR MUST FOLLOW        Y02049 52796002
         TM    RSPASSFL,DX2             PASSWORD TEST PASS ID ON Y02049 52798002
         BO    REPDCBA6                 YES SEE IF PASSWORD CK RQY02049 52798402
         TM    RSPASSFL,D1              DATA SET LBL TEST FL ON  Y02049 52798802
         BO    REPDCBA1                 YES VERIFY DS LABEL      Y02049 52799202
REPDCBAA EQU   *                                                 YM7055 52799302
         MVC   RSCCW1(D8),RSCCW2        GET TAPE READ CCW        Y02049 52799602
         MVI   RSPASSFL,D1              SET DS LABEL TEST FLAG   Y02049 52799702
         MVC   RSTABAD(D3),TABSEGAD     ST ADR OF USING ELEMENT  Y02049 52799802
         MVI   RSSTAT2,LOCKSW           SET WORK AREA LOCK SW    Y02049 52808102
         B     REPDCB48                 READ HDR1 FROM TAPE      Y02049 52816602
*********************************************************************** 52824902
*              VERIFY HDR1 RECORD READ  (1ST REC OF IBM TAPE LABEL)   * 52833202
*********************************************************************** 52843202
REPDCBA1 EQU   *                        INSTR MUST FOLLOW        Y02049 52853202
         CLI   RSHDRNUM,DF1             REC NUM MATCH            Y02049 52865202
         BNE   REPDCBB5                 NOT HDR1 ABORT           Y02049 52865602
         CLC   RSHDR,HDRMASK1           'HDR'                    Y02049 52866002
         BE    REPDCBA2                 GO CHECK HDR1 LABEL      YM7055 52876002
         CLC   RSHDR,VOLMASK            IS THIS THE VOL1 LABEL?  YM7055 52886002
         BNE   REPDCBB5                 NOT HDR1 OR VOL1, ERROR  YM7055 52888002
         B     REPDCBAA                 GO READ HDR1 LABEL       YM7055 52890402
*********************************************************************** 52940402
*             PERFORM LABEL VERIFICATION FOR DATA SET                 * 52950402
*********************************************************************** 52952402
REPDCBA2 EQU   *                        INSTR MUST FOLLOW        Y02049 52959102
         L     R1,TABJFCB-D1            GET TTR ADR OF JFCB      YM7337 52960702
         LA    RE,D16(R1)               GET ADDR OF DSN IN JFCB  YM7337 52988102
         USING INFMJFCB,RE                                       YM7337 52988202
         LA    RF,L'JFCBDSNM-D1         GET INDEX LAST CHAR DSN  YM7337 52988502
REPDCBA3 EQU   *                        CHECK LENGTH             YM7337 52991202
         LA    R1,JFCBDSNM-INFMJFCB(RE,RF) GET CHAR TO CHK       YM7337 52993202
         CLI   D0(R1),BLANK             CHK IF BLANK             YM7337 52993302
         BNE   REPDCBA4                 CONT TIL FIRST NON-BLNK  YM7337 52993602
         BCT   RF,REPDCBA3              DECR OFFSET TO NON-BLANK YM7337 52994002
REPDCBA4 EQU   *                        COMPARE DSN              YM7337 52994402
         LA    RF,D1(,RF)               GET NUMBER OF CHARS      YM7337 52994802
         SH    RF,MAXNAME               CHK IF GRTR 17 CHAR LBL  YM7337 52995302
         BP    REPDCBX4                 BR - GRTR 17 CHAR        YM7337 52995702
         XR    RF,RF                    COMPARE FROM START       YM7337 52995802
REPDCBX4 EQU   *                        CHK DSN                  YM7337 52999602
         AR    RE,RF                    GET FIRST CHAR TO CMPR   YM7337 52999702
         CLC   JFCBDSNM-INFMJFCB(C17,RE),RSDATAID SAME DSN?      YM7337 52999802
         BNE   REPDCBB5                 ERROR NOT SAME DSN       YM7337 53000202
         DROP  RE                                                YM7337 53033702
*********************************************************************** 53037502
*              SET UP TO READ HDR2 RECORD OF TAPE LABEL               * 53039502
*********************************************************************** 53041502
REPDCBA5 EQU   *                        INSTR MUST FOLLOW        Y02049 53043502
         SR    WRKR2,WRKR2                                       Y02049 53043902
         ICM   WRKR2,HIORDER,RSDSSECR   GET HDR1 SECURITY BYTE   Y02049 53044302
         SLL   WRKR2,D4                 STRIP OFF HIGH ORDER BITSY02049 53044702
         STCM  WRKR2,HIORDER,RSPASSFL   SAV SEC RESET OTHER FLGS Y02049 53044802
         OI    RSPASSFL,DX2             SET PASSWORD TEST ID     Y02049 53045102
         B     REPDCB48                 READ HDR2 REC FROM TAPE  Y02049 53045202
*********************************************************************** 53045302
*              VERIFY HDR2 RECORD READ (2ND REC OF IBM TAPE LABEL)    * 53053102
*********************************************************************** 53055102
REPDCBA6 EQU   *                        INSTR MUST FOLLOW        Y02049 53057102
         XI    TABOPS,PASSWDID          RESET PASSWORD CHK IND   YM7055 53059102
         CLI   RSHDRNUM,DF2             REC NUM MATCH            Y02049 53060302
         BNE   REPDCBB5                 ABORT NOT HDR2           Y02049 53060702
         CLC   RSHDR,HDRMASK1           'HDR'                    Y02049 53060802
         BNE   REPDCBB5                 ABORT NOT HDR2           Y02049 53074702
*********************************************************************** 53075102
*              DETERMINE IF PASSWORD CHECK IS TO BE MADE              * 53075502
*********************************************************************** 53075902
REPDCBA7 EQU   *                        INSTR MUST FOLLOW        Y02049 53076302
         MVI   RSSTAT2,RLOCKSW          RESET WRK AREA LOCK SW   Y02049 53086302
         TM    TABFLG4,TABBYPSW         IS THE USER RACF       @G32DSMI 53088332
*                                       AUTHORIZED TO THE VOL  @G32DSMI 53090332
         BO    REPDCBA9                 YES - BYPASS PASSWORD  @G32DSMI 53092332
*                                       CHECKING               @G32DSMI 53094332
         TM    RSPASSFL,WRITEFLG        TEST SECURITY FLAGS      Y02049 53096302
         BO    REPDCBA8                 WRITE PROTECTED          Y02049 53107002
         TM    RSPASSFL,RDWTRFLG        TEST SECURITY FLAGS      Y02049 53117002
         BO    REPDCBB0                 READ/WRITE PROTECTED     Y02049 53117402
         B     REPDCBA9                 NO PASSWORD CHK REQ      Y02049 53117802
*********************************************************************** 53122902
*              IF DATA SET IS OPEN FOR INPUT NO PASSWORD CHK REQ      * 53124902
*********************************************************************** 53126902
REPDCBA8 EQU   *                        INSTR MUST FOLLOW        Y02049 53128302
         L     WRKR2,TABDCBAD-D1        DCB ADR                  Y02049 53130302
         USING IHADCB,WRKR2                                      Y02049 53132302
         L     DEBR,DCBDEBA-D1          DEB ADR THIS DCB         Y02049 53132702
         TM    DEBACCS,INPUTMSK         TEST FOR OUTPUT          Y02049 53133102
         BNO   REPDCBA9                 NO PASSWORD CHK          YM7337 53133202
         EJECT                                                   YM7337 53143202
*********************************************************************** 53154702
*              SET UP FOR PASSWORD CHECK                              * 53156702
*                                                                     * 53157102
*        INTERFACE TO SECLOADA AS FOLLOWS:                            * 53157502
*              R1 = PTR DSAB                                          * 53157902
*              R5 = PTR DEB                                           * 53158402
*              RA = 5(TAPE) - HI-ORDER BYTE                           * 53158502
*              RB = PTR DATA SET NAME                                 * 53158602
*              RD = PTR DADSM TYPE W/A                                * 53158802
*              RE = 0                                                 * 53159202
*                                                                     * 53159302
*        RETURN AS FOLLOWS:                                           * 53159402
*              R1-RD RESTORED                                         * 53161102
*              RA = HI-ORDER BYTE (0) = O.K.                          * 53163102
*                   HI-ORDER BYTE (NOT = 0) = BAD                     * 53163502
*********************************************************************** 53163902
REPDCBB0 EQU   *                        INSTR MUST FOLLOW        Y02049 53164402
         STM   R0,RF,RSREGSAV           SAVE REGS BEFORE SETUP   YM7337 53164602
         LA    R6,RSREGSAV              GET REG SAVE AREA        YM7337 53165002
         OI    TABFLG2,TABSW            IND SECLOADA CALL        YM7337 53165402
         L     R1,TABDCBAD-D1           PTR DCB                  YM7337 53165802
         L     R5,DCBDEBAD-IHADCB(,R1)  R5 PTS TO DEB            YM7337 53165902
         LR    R1,R5                    GET DEB PTR              YM7337 53166002
         SH    R1,PFXCON                BACKUP TO PREFIX         YM7337 53166102
         L     R1,DEBXTNP-DEBPREFX(,R1) PTR DEB EXTENSION        YM7337 53166202
         L     R1,DEBXDSAB-DEBXTN(,R1)  R1 PTS TO DSAB           YM7337 53166302
         ICM   BUFR,HIORDER,RTNRETID    SET RETURN FOR S05B      YM7337 53167002
         L     RB,TABJFCB-D1            GET SVA OF JFCB          YM7337 53167102
         LA    RB,D16(RB)               ADDR DSN - SKIP SWA CTL  YM7337 53167202
         L     RD,SECSWICH              RD PTR DADSM-LIKE W/A    YM7337 53167302
         USING IECEXTPR,RD              SECLOADA W/A ADDR        YM7337 53167402
         IECRES LOAD,MODNM=SECMODNM,EXTPR=(RD),BRCODE=0,         YM7337*53167602
               BRANCH=DIRECT            EXIT TO SECLOADA         YM7337 53168002
         DROP  RD                                                YM7337 53176602
         USING RSDSECT,WRKR4            PT RESTART W/A           YM7337 53178602
*********************************************************************** 53186202
*              TEST SECLOADA RESPONSE; RIGHT PASSWORD GIVEN.          * 53194802
*********************************************************************** 53203402
PASSWORD EQU   *                        INSTR MUST FOLLOW        YM7337 53212002
         MODESET EXTKEY=ZERO            ENSURE KEY 0             YM7337 53220602
         STCM  RA,HIORDER,4*RA(R6)      SAVE RET CODE            YM7337 53229202
         LM    R0,RF,D0(R6)             RESTORE REGS             YM7337 53237802
         NI    TABFLG2,X'FF'-TABSW      RESET SECLOADA CALL      YM7337 53246402
         CLI   RSREGSAV+4*RA,D0         CHK FOR PASSWORD ERROR   YM7337 53255002
         BE    REPDCBA9                 BR IF NO PASSWORD ERROR  YM7337 53263602
         ST    RA,TABVLID2              SAV RET COD FOR PROB DET YM7337 53272202
         MVI   RSRETCOD+D1,ERR219       SET PASSWORD ERROR     @ZSUT222 53280832
         B     REPDCB58                 GO TO ERROR EXIT         YM7337 53289402
         SPACE 3                                                 YM7337 53289802
*********************************************************************** 53290202
*        CHECK IF HEADER2 INDICATES THAT THIS IS A CHECKPOINT         * 53290302
*        DATA SET.  IF IT DOES THEN SET UP TO CALL Q05B.              * 53290402
*                                                                     * 53290502
*        INPUT TO Q05B AS FOLLOWS:                                    * 53291302
*              R1 = 0(CHKPT D.S. CHECK)                               * 53291702
*                   4(OLD CHKPT D.S. AND THE D.S. IS NOT CHKPT)       * 53292102
*              R5 = PTR UCB                                           * 53292502
*              R9 = PTR TAB ENTRY                                     * 53292902
*              RA = PTR RESTART WORK AREA                             * 53293002
*              RE = RETURN ADDRESS                                    * 53293102
*                                                                     * 53293202
*        OUTPUT FROM Q05B AS FOLLOWS:                                 * 53293302
*              ALL REGS SAVED AND RESTORED                            * 53293702
*              DSABCKVL SET IF VOL SECURE.  Q05B XCTL TO V05B IF ERR. * 53294102
*********************************************************************** 53294602
REPDCBA9 EQU   *                        INSTR MUST FOLLOW        YM7337 53294902
         L     RF,SECSWICH              GET ADDR O/C/E/D W/A     YM7337 53296902
         STM   R0,RF,MYREGSAV-IECEXTPR(RF) SAVE REGS             YM7337 53300902
         LR    R6,RF                    TUCK REGSAV IN TIDY PLAC YM7337 53303002
         USING IECEXTPR,R6              ADDRESSABILITY FOR W/A   YM7337 53303302
         L     RE,TABDCBAD-D1           PTR DCB                  YM7337 53304902
         L     RE,DCBDEBAD-IHADCB(,RE)  PTR TO DEB               YM7337 53305302
         SH    RE,PFXCON                BACKUP TO PREFIX         YM7337 53305802
         L     R5,DEBSUCBA-DEBPREFX(,RE) GET UCB REG 5           YM7337 53306302
         L     RE,DEBXTNP-DEBPREFX(,RE) PTR DEB EXTENSION        YM7337 53307802
         L     RE,DEBXDSAB-DEBXTN(,RE)  PTR DSAB                 YM7337 53311002
         XR    R1,R1                    INDR OLD CHKPT D.S.      YM7337 53311402
         CLI   RSDSIND,CHKPTFLG         CHK IF OLD CHKPT D.S.    YM7337 53311502
         BE    REPDCA10                 BR IF OLD CHKPT D.S.     YM7337 53311702
         LA    R1,D4                    OLD CHKPT D.S. - NEW NOT YM7337 53311902
         TM    DSABFLG4-DSAB(RE),DSABCKDS CHK OLD CHKPT D.S.     YM7337 53312302
         BNO   REPDQ05B                 BR NOT OLD CHKPT D.S.    YM7337 53312902
REPDCA10 EQU   *                        GO TO Q05B               YM7337 53313202
         LA    RE,REPDQ05B              SET RETURN ADDRESS       YM7337 53313602
         IECRES LOAD,MODNM=COMMODNM,EXTPR=(R6),BRCODE=(14),      YM7337*53313702
               BRANCH=DIRECT            EXIT TO Q05B             YM7337 53313802
*********************************************************************** 53313902
*              RESUME NORMAL POSITIONING MODE                         * 53314202
*********************************************************************** 53314802
REPDQ05B EQU   *                        RETURN FROM Q05B         YM7337 53316302
         LM    R0,RF,MYREGSAV           RESTORE REGS             YM7337 53316702
         DROP  R6                                                YM7337 53317202
         MVI   RSCCW1+D4,FLAGS          RESTORE CCW1 FLAGS       Y02049 53318402
         XC    RSCCW1+D1(D3),RSCCW1+D1  CLEAR STORAGE ADR        Y02049 53318802
         MVI   RSCCW1+D7,COUNT          RESTORE CCW1 COUNT TO 1  Y02049 53320802
         MVI   RSPASSFL,RESETFLG        RESET FLAGS              Y02049 53322802
         B     REPDCB36                 SPACE OVER FILE MARK     YM7345 53324802
**********************************************************************  53326802
*              SET ERR CODE DATA SET LABEL DOESN'T VERIFY            *  53328802
**********************************************************************  53330802
REPDCBB5 EQU   *                        INSTR MUST FOLLOW        Y02049 53332802
         MVI   RSRETCOD+D1,ERR222       SET CODE 222             Y02049 53334802
         B     REPDCB58                 CLOSE DOWN PROCESSING    Y02049 53336802
*********************************************************************** 53338802
*               TEST IF WORK AREA LOCKED FOR CURRENT REQUESTOR        * 53342202
*********************************************************************** 53345602
REPDCBC0 EQU   *                        INSTR MUST FOLLOW        Y02049 53349002
         CLC   TABSEGAD(D3),RSTABAD     48 BYTE ENTRY ADRS MATCH Y02049 53352402
         BE    REPDCX30                 YES CONTINUE PROCESSING  Y02049 53355802
         B     REPDCB52                 NO FIND OWNER OR DIF WA  Y02049 53359202
**********************************************************************  53362602
*                                                                    *  53366002
*        END OF THE ROUTINE TO VERIFY DATA SET LABELS AND PASSWORDS  *  53369402
*                                                                    *  53372802
**********************************************************************  53376202
*                                                                       53379602
REPDCB36 EQU   *                                                        53383002
*                                                                       53386402
*                                                                       53389802
         MVI   RSCCW1,FSFOP             SET FSF OP CODE IN CCW          53393202
         B     REPDCB48                 GO TO EXCP                      53396602
*                                                                       53400019
*                                                                       53500019
*                                                                       53600019
REPDCB38 EQU   *                                                        53700019
*                                                                       53800019
*        BACK SPACE FILE ROUTINE                                        53900019
*                                                                       54000019
         TM    TABOPS,BSF               IS BACK SPACE FILE NECESSARY    54100019
         BZ    REPDCB40                 BRANCH NO TO CHECK READ FWD     54200019
*                                                                       54300019
*BSF                                                                    54400019
*                                                                       54500019
         XI    TABOPS,BSF               PEEL OFF BSF MASK               54600019
*                                                                       54700019
*                                                                       54800019
         MVI   RSCCW1,BSFOP             SET BSF OP CODE IN CCW          54900019
         B     REPDCB48                 GO TO EXCP                      55000019
*                                                                       55100019
*                                                                       55200019
*                                                                       55300019
REPDCB40 EQU   *                                                        55400019
*                                                                       55500019
*        READ FORWARD ROUTINE                                           55600019
*                                                                       55700019
         TM    TABOPS,RDOP              IS READ FWD NECESSARY           55800019
         BZ    REPDCB44                 BRANCH NO TO CHECK READ BACK    55900019
*                                                                       56000019
*                                                                       56100019
         L     WRKR6,TABBLK2            GET BLK CT                      56200019
         LA    WRKR6,D1(WRKR6)          INCREMENT BY ONE                56300019
         ST    WRKR6,TABBLK2            SAVE BLK CT                     56400019
         CLC   TABBLK1(L4),TABBLK2      COMPARE BLOCK COUNTS            56500019
         BNE   REPDCB42                 BRANCH NOT EQUAL TO CONTINUE    56600019
*                                                                       56700019
         XI    TABOPS,RDOP              PEEL OFF READ FWD MASK          56800019
*                                                                       56900019
REPDCB42 EQU   *                                                        57000019
*                                                                       57100019
         MVI   RSCCW1,READ              SET OP CODE TO READ FWD         57200019
         B     REPDCB48                 GO TO EXCP                      57300019
*                                                                       57400019
*                                                                       57500019
*                                                                       57600019
REPDCB44 EQU   *                                                        57700019
*                                                                       57800019
*        READ BACKWARD ROUTINE                                          57900019
*                                                                       58000019
         TM    TABOPS,RDBK              IS READ BACKWARD NECESSARY      58100019
         BZ    REPDCB52                 BRANCH NO MORE OPS FOR THIS ELT 58200019
*                                                                       58300019
*        RDBK                                                           58400019
*                                                                       58500019
         L     WRKR6,TABBLK2            GET BLOCK COUNT                 58600019
         LA    WRKR6,D1(WRKR6)          ADD ONE                         58700019
         ST    WRKR6,TABBLK2            SAVE NLOCK COUNT                58800019
         CLC   TABBLK1(L4),TABBLK2      COMPARE BLOCK COUNTS            58900019
         BNE   REPDCB46                 BRANCH NOT EQUAL TO CONTINUE    59000019
*                                                                       59100019
         XI    TABOPS,RDBK              PEEL OFF READ BACKWARD MASK     59200019
*                                                                       59300019
REPDCB46 EQU   *                                                        59400019
*                                                                       59500019
         MVI   RSCCW1,READBACK          SET OP CODE TO READ BACKWARD    59600019
*                                                                       59700019
*                                                                       59800019
REPDCB48 EQU   *                                                        59900019
*                                                                       60000019
         MVC   RSDEBUCB(L4),TABUCB      ADJUST UCB POINTER IN WORK AREA 60100019
         TM    TABOPS,PASSWDID          READING TAPE LABELS?     YM7551 60150002
         BNO   REPDCB49                 NO                       YM7551 60160002
         NI    RSDEBUCB,MODECLR         CLEAR ALL BUT DENSITY    YM7551 60170002
         OI    RSDEBUCB,SETMODE         EVEN PAR TRANS MD CVT MD YM7551 60180002
REPDCB49 EQU   *                                                        60200019
         MVI   RSSTAT1,BUSY             TURN ON WORK AREA BUSY SWITCH   60300019
*                                                                       60400019
REPDCB50 EQU   *                                                        60500019
*                                                                       60600019
*        EXCP  ROUTINE                                                  60700019
*                                                                       60800019
*                                                                       60900019
*                                                                       61000019
         XC    RSECBAD(L4),RSECBAD      INITIALIZE ECB                  61100019
*                                                                       61200019
*                                                                       61300019
         EXCP  RSIOB                                                    61400019
*                                                                       61500019
*                                                                       61600019
         LTR   WAIT,WAIT                SHOULD WE WAIT                  61700019
         BNZ   REPDCB56                 BR YES TO WAIT ROUTINE   S21040 61800021
*                                                                       62000019
REPDCB52 EQU   *                                                        62100019
*                                                                       62200019
         TM    TABFLG1,TABTAPE+TABDOSTP  DOS TAPE ENTRY          Y02049 62210002
         BNO   REPDCB53                 BRANCH ON NO             S21040 62220021
         LA    DSCNTR,D1(DSCNTR)        INCREMENT DOS TAPE COUNT        62230000
*                                                                       62240021
REPDCB53 EQU   *                                                 S21040 62250021
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY          62300002
         BO    REPDCB54                 BRANCH YES TO CHECK IF DONE     62400019
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL POINTER          62500019
         B     REPDCB30                 CONTINUE PROCESSING             62600019
*                                                                       62700019
REPDCB54 EQU   *                                                        62800019
*                                                                       62900019
*        LAST ENTRY HAS BEEN PROCESSED, ARE ALL ELTS COMPLETE           63000019
*                                                                       63100019
         LTR   WRKR3,WRKR3              TEST SPIN SWITCH                63200019
         BZ    REPDCB58                 SWITCH OFF - STOP SPINNING      63300019
         B     REPDCB28                 SPIN THRU TABL ELEMENTS AGAIN   63400019
*                                                                       63500019
*                                                                       63600019
*        WAIT ROUTINE                                                   63700019
*                                                                       63800019
REPDCB56 EQU   *                                                        63900019
*        WAIT FOR CE FOR CONTROL OPERATIONS, WAIT FOR CE AND DE FOR ALL 64000019
*        OTHERS,  NOP BRINGS IN CE AND DE SO CHECKING CAN BE DONE       64100019
*        FOR ERRORS BEFORE THE NEXT OPERATION IS STARTED.               64200019
*                                                                       64300019
*                                                                       64400019
         WAIT  ECB=RSECBAD                                              64500019
*                                                                       64600019
*                                                                       64700019
         TM    RSECBAD,PERMERR          CHECK FOR PERMANENT I/O ERRORS  64800019
         MVI   RSSTAT1,NOTBUSY         TURN OFF WORK AREA BUSY   A41420 64880021
*                                       SW                       A41420 64960021
         BM    REPDCB76                 BRANCH YES TO CHECK      A41420 65040002
*                                       ERRORS                   A41420 65120021
*                                                                       65200019
         CLI   RSCCW1,NOPOP             HAS NOP BEEN ISSUED             65300019
         BCR   EQUAL,WRKR5              BR YES TO CONTINUE PROCESSING   65400019
*                                                                       65500019
         TM    RSCCW1,READOP            OP CODE READ/READ BACK   S21040 65700021
         BZ    ZERO(WRKR5)              BR YES NOP NOT NEEDED    S21040 65900021
*                                                                       66100019
         MVI   RSCCW1,NOPOP             CHANGE OP CODE TO NOP           66200019
         B     REPDCB49                 GO TO EXCP                      66300019
*                                                                       66400019
*                                                                       66500019
*                                                                       66600019
*                                                                       66700019
REPDCB58 EQU   *                                                        66800019
*        WAIT ON ALL WORK AREAS TO BE SURE ALL HAVE BEEN CHECKED        66900019
*        FOR I/O ERRORS                                                 67000019
*                                                                       67100019
         LR    CTABLR,TABLR             INIT TABL POINTER               67200019
*                                                                       67300019
REPDCB60 EQU   *                                                        67400019
*                                                                       67500019
         TM    TABFLG1,TABTAPE+TABDOSTP  IS  IT  NON-DOS TAPE    Y02049 67550002
         BC    NOTMIXED,REPDCB62        BRANCH NO TO CONTINUE    S21040 67700021
*                                                                       67800019
         TM    TABFLG2,TABRSDS          IS THIS WORKING CHKPT DS YM7358 67850002
         BO    REPDCB62                 YES - DON'T PROCESS      YM7358 67860002
*                                                                YM7358 67870002
         L     WRKR4,TABSEGAD-D1        WORK AREA SEGMENT ADDRESS       67900019
         TM    RSSTAT1,BUSY             IS WORK AREA BUSY               68000019
         BZ    REPDCB62                 BRANCH NO TO CONTINUE           68100019
*                                                                       68200019
         LA    WAIT,ONE                 TURN ON WAIT SWITCH             68300019
         BAL WRKR5,REPDCB56             GO TO WAIT ROUTINE              68400019
*                                                                       68500019
         MVI   TABVLID2,BLANK           RESTORE BLANKS                  68600019
         MVC   TABVLID2+D1(L23),TABVLID2     TO TABL AREA               68700019
*                                                                       68800019
REPDCB62 EQU   *                                                        68900019
*                                                                       69000019
         TM    TABFLG1,TABLAST          IS THIS THE LAST ENTRY          69100002
         BO    REPDCB68                 BRANCH YES TO EXIT              69200019
*                                                                       69300019
         LA    CTABLR,TABENT(CTABLR)    INCREMENT TABL POINTER          69400019
         B     REPDCB60                 CONTINUE WAIT PROCESSING        69500019
*                                                                       69600019
*    ****************************************************************** 69700019
*                                                                       69800019
**********************************************************************  69850002
*              RELEASE STORAGE GOTTEN FOR TAPE OPS WORK AREAS        *  69900002
**********************************************************************  69950002
REPDCB68 EQU   *                                                        71500019
*                                                                       71676702
         LR    CTABLR,TABLR             REINITIALIZE TABL POINTER       71700019
         L     WRKR4,TABSEGAD-D1        POINTER TO FIRST WORK AREA      71800019
*                                                                       71900019
         LA    WRKR3,RSCCW2             SET UP WORK AREA FOR XCTL       72000019
*                                                                       72100019
         LH    WRKR2,RSSTAT3            GET SIZE OF SECONDARY W.A.      72200019
         LTR   WRKR2,WRKR2              IS THERE SECONDARY SPACE        72300019
         BZ    REPDCB69                 BRANCH NO TO XCTL               72400019
*                                                                       72500019
         ST    TIOTR,GOTLOC             LOCATION OF SECONDARY SPACE     72600019
         ST    WRKR2,GOTLOC+D4          SIZE OF SECONDARY SPACE         72700019
*                                                                       72800019
         LA    R1,FREELIST              POINTER TO LIST FOR FREEMAIN    72900019
         LA    R13,GETSAVE              POINTER TO SAVE AREA            73000019
*                                                                       73100019
         FREEMAIN V,A=GOTLOC,SP=250,MF=(E,(1))                          73200019
*                                                                       73300019
*                                                                       73400019
REPDCB69 EQU   *                                                        73500019
*                                                                       73600019
*    ****************************************************************** 73700019
*                                                                       73800019
*    *** DETERMINE WHICH EXIT MODULE TO TAKE ***                        73900019
*                                                                       74000019
*    ****************************************************************** 74100019
*                                                                       74200019
         NC    SECSWICH,SECSWICH        TEST FOR SECLOADA CORE @ZA19615 74210037
         BZ    PASSFREE                 NONE  NO RELEASE REQ   @ZA19615 74217037
         LA    RF,RSREGSAV              GET REG SAVE AREA      @ZA19615 74224037
         STM   R0,RF,D0(RF)             SAVE REGS              @ZA19615 74231037
         L     R1,SECSWICH              GET DADSM-LIKE W/A     @ZA19615 74238037
         IECRES FREE,A=(R1),PREFIX=YES  FREE DADSM-LIKE W/A    @ZA19615 74245037
         MODESET EXTKEY=ZERO            KEY 0                  @ZA19615 74252037
         LM    R0,RF,D0(RF)             RESTORE REGS           @ZA19615 74259037
PASSFREE EQU   *                                               @ZA19615 74270037
         MVC   D0(L8,WRKR3),RSTMODNM    ASSUME RESTART EXIT MOD. S21040 74300021
         TM    RSRETCOD+D1,ERRORS       IS ERROR CODE SET        S21040 74400021
         BZ    AROUND                   NO BRANCH AROUND       @ZSUT222 74500032
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 74510032
*                                       THAT DETECTED ERROR.   @ZSUT222 74520032
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 74530032
         B     REPDCB75                 BRANCH TO ERROR XCTL   @ZSUT222 74540032
AROUND   EQU   *                                               @ZSUT222 74550032
*                                                                       74600021
*    *** TEST FOR DOS TAPES ***                                         74700021
*                                                                       74800021
         LTR   DSCNTR,DSCNTR            ANY DOS TAPES            S21040 74900000
         BZ    REPDCB70                 BRANCH NO                S21040 75000021
*                                                                       75100021
         MVI   D4(WRKR3),DOSMOD         DOS TAPE POSITIONING     S21040 75200021
         B     REPDCB74                  MODULE IGC0U05B         S21040 75300021
*                                                                       75400021
REPDCB70 EQU   *                                                 S21040 75500021
         TM    RSDCBFLG,DAFLAG          DA DEVICE INDICATED      S21040 75600021
         BNO   REPDCB72                 BRANCH NO                S21040 75700021
*                                                                       75800021
         MVI   D4(WRKR3),DAMOD          DA MODULE IGC0R05B       S21040 75900021
         B     REPDCB74                 BRANCH TO XCTL           S21040 76000021
*                                                                       76100021
REPDCB72 EQU   *                                                 S21040 76200021
         MVI   D4(WRKR3),AMMOD          SET NEXT MODULE ID TO    S21040 76300021
*                                       ACCESS METHOD DISP. MOD.        76400021
         B     REPDCB74            BRANCH TO XCTL               ZA02208 76450037
REPDCB75 EQU   *                                                ZA02208 76460037
         L     UCBR,RSMWOFST       GET UCB ADDR IN ERROR        ZA02208 76470037
REPDCB74 EQU   *                          IGC0T05B               S21040 76500021
*                                                                       76600021
         LA    WRKR6,D8(WRKR3)          SET UP FOR XCTL          S21040 76700021
         XC    RSERAS00(D40),RSERAS00   CLEAR SCRATCH AREA       Y02049 76750002
         LR    WRKR2,BUFR               POINT REG 1 TO RESTART   S21040 76800021
*                                        WORK AREA                      76900021
         NI    TABFLG2,X'FF'-TABSW      RESET  RETURN  SW        Y02049 76950002
         XCTL  EPLOC=(WRKR3),SF=(E,(15))                         S21040 77000021
*                                                                       77500019
REPDCB76 EQU   *                                                        77600019
*                                                                       77700019
*    ****************************************************************** 77800019
*                                                                       77900019
*    *** ERROR FOUND ***                                                78000019
*                                                                       78100019
*        THIS PORTION OF CODE MAY BE TAKEN OUT WHEN I/O SUPERVISOR HAS  78200019
*        PUT THE FIXES IN                                               78300019
*                                                                       78400019
*        THIS IS THE CURRENT THOUGHT PERSISTING TO THE HANDLING OF I/O  78500019
*        ERRORS                                                         78600019
*                                                                       78700019
*        ERRORS THAT HAVE OCCURRED AT CHECKPOINT TIME IS ACCEPTED       78800019
*                                                                       78900019
*    ****************************************************************** 79000019
*                                                                       79150000
         STM   WRKR5,WRKR3,RSREGSAV+12   SAVE REG               ZA02208 79152037
         LR    CTABLR,TABLR        GET FIRST TABLE ENTRY        ZA02208 79154037
REPDCB61 EQU   *                                                ZA02208 79156037
         CLC   TABUCB+1(3),RSDEBUCB+1   UCB EQUAL RIGHT ENTRY   ZA02208 79158037
         BE    REPDCB63            BRANCH IF EQUAL              ZA02208 79158437
         TM    TABFLG1,LASTENT     LAST ENTRY                   ZA02208 79158837
         BO    REPDCB66            ERROR                        ZA02208 79159237
         LA    CTABLR,TABENT(CTABLR)    NEXT ENTRY              ZA02208 79159637
         B     REPDCB61            PROCESS NEXT ENTRY           ZA02208 79164037
REPDCB63 EQU   *                                                ZA02208 79166037
         L     UCBR,TABUCB              POINT TO UCB FOR V05B    A47745 79168037
*                                       IN CASE ERROR IS REAL    A47745 79170000
         ST    UCBR,RSMWOFST       SAVE UCB IN ERROR            ZA02208 79180037
         CLI   RSCCW1,READ              IS ERROR IN READ FORWARD        79200019
         BE    REPDCB78                 BRANCH YES                      79300019
*                                                                       79400019
         CLI   RSCCW1,READBACK          IS ERROR IN READ BACKWARD       79500019
         BE    REPDCB78                 BR YES TO CHECK FURTHER  A47745 79600000
REPDCB64 MVI   RSRETCOD+D1,ERR060       SET ERR CODE FOR D.S.  @ZSUT222 79650032
         ST    UCBR,RSMWOFST            SET UCB IN ERROR       @ZA19617 79670037
*                                       POSITIONING IN RSTWA     A47745 79700000
         B     REPDCB81            CLEAN UP OUTSTANDING         ZA02208 79750037
*                                       I/O                      A47745 79760000
*                                                                       79900019
REPDCB78 EQU   *                                                        80000019
*                                                                       80100019
         CLC   TABBLK1(L4),TABBLK2      HAS POSITIONING BEEN COMPLETED  80200019
         BNE   REPDCB66                 BRANCH NO TO SET ERROR CODE     80300019
*                                                                       80400019
         L     DCBR,ZERO(,CTABLR)       GET CURRENT DCB          A46650 80450021
         TM    DCBIFLGS,ERRCHKPT        IS THERE PERMANENT ERR AT CHKPT 80500019
         BO    REPDCB80                BR IF SO TO CONTINUE     ZA02208 80600037
         TM    TABDSORG,X'08'           IS FLAG ON ?           @ZA10259 80610037
         BNO   REPDCB66                 NO BRANCH              @ZA10259 80620037
         NI    TABDSORG,X'F7'           YES TURN IT OFF        @ZA10259 80630037
         B     REPDCB80                 BRANCH                 @ZA10259 80640037
REPDCB66 MVI   RSRETCOD+D1,ERR063       SET ERR CODE FOR RECORD@ZSUT222 80650032
*                                       POSITIONING IN RSTWA     A47745 80700000
REPDCB81 LM    WRKR5,WRKR3,RSREGSAV+12  RESTORE REG             ZA02208 80750037
         B     REPDCB58                 GO CLEAN UP OUTSTANDING  A47745 80800000
*                                       I/O                      A47745 80850000
REPDCB80 LM    WRKR5,WRKR3,RSREGSAV+12  RESTORE REG             ZA02208 80860037
         B     REPDCB52            GO CLEAN UP OUTSTANDING IO   ZA02208 80870037
*                                                                       80900019
*********************************************************************** 81000019
*                                                                       81100019
*     CONSTANTS USED IN REPI/O                                          81200019
*                                                                       81300019
*********************************************************************** 81400019
*                                                                       81500019
RSTMODNM DC    CL8'IGC0V05B'            RESTART EXIT MOD                81600019
MODID    DC    CL8'IGC0S05B'            MODULE ID              @ZSUT222 81600232
         DS    0F                       FULLWORD BOUNDARY        YM7337 81600402
SECMODNM DC    C'SECLOADA'              EP FOR XCTL              Y02049 81600802
         DC    VL4(SECLOADA)            VCON FOR SECLOADA        YM7337 81601202
COMMODNM DC    C'IGC0Q05B'              COMMON FCTN MOD          YM7337 81601602
         DC    VL4(IGC0Q05B)            VCON FOR IGC0Q05B        YM7337 81601702
VOLMASK  DC    C'VOL'                   VOLUME LABEL ID          YM7055 81602002
HDRMASK1 DC    C'HDR'                   LABEL ID                 Y02049 81610002
SP253    DC    AL1(253)                 SUBPOOL 253              Y02049 81640002
SPACERQ1 DC    AL3(160)                 160 BYTES OF STORAGE     Y02049 81642002
SPACERQ2 DC    AL3(280)                 256(WA)+24(P.L.)         Y02049 81644002
RTNRETID DC    X'05'                    SECLOADA RTN TO ROUT SW  Y02049 81646002
CHKMODNM DC    C'IGC0Q05B'              MOD FOR CHKPT D/S CHK    YM7337 81668402
         DC    F'0'                     UNRESOLVED VCON          YM7337 81678402
C44      DC    H'44'                    DATA SET NAME LNGTH CONSTY02049 81679202
MAXNAME  DC    H'17'                    TAPE LABEL LENGTH        YM7509 81681202
SP230    DC    AL1(230)                 SUBPOOL 230              Y02049 81689202
PFXCON   DC    H'16'                    DEB PREFIX OFFSET        Y02049 81689302
WTGCODE  DC    X'00C0'                  Y02049                   Y02049 81689402
*                                                                     * 81689602
*        MAINTENANCE SPACE                                       Y01909 81700000
*                                                                     * 81750000
PATCH    DC    XL((*-IGC0S05B)/20)'00'   FIVE PERCENT SPACE      Y01909 81800000
*                                                                     * 81850000
         EJECT                                                          81900019
         IECDSECS PREFX,EXPAND=YES                               YM7337 81950002
MYREGSAV DS    18F                      REGISTER SAVE AREA       YM7337 81950102
         IECDSECS MAIN,DSAB,EXPAND=YES                           YM7337 81950402
         EJECT                                                          81952002
         CVT   DSECT=YES,PREFIX=YES,LIST=NO                      Y02049 81954002
CVTFIX   DSECT                                                   Y02049 81954402
CVT      EQU   CVTMAP                                            Y02049 81956002
         EJECT                                                          81960002
         IEEVRSWA  VER=3                AOS2 VERSION OF WA              82000000
SECSWICH EQU   RSERAS02                 SPACE IND FOR SECLOADA   Y02049 82090002
SECIOBAD EQU   RSERAS02                 ADR OF IOB FOR SECLOADA  Y02049 82092002
SECCCWAD EQU   RSERAS03                 ADR OF CCW'S FOR SECLOADAY02049 82094002
         EJECT                                                          82100019
         IEZDEB                                                  Y02049 82150002
         EJECT                                                          82170002
         IEFQMIOP                                                Y02049 82180002
         EJECT                                                          82190002
         IEFJESCT                                                Y02049 82192002
         EJECT                                                          82194002
RSDSECT  DSECT                                                          82200019
*                                                                       82300019
*    DATA EXTENT BLOCK                                                  82400019
*                                                                       82500019
RSDEB    DS    0CL48                                                    82600019
GETSAVE  EQU   RSDEB                                                    82700019
GOTLOC   EQU   GETSAVE+96                                       SA65000 82800002
FREELIST EQU   GOTLOC+8                                                 82900019
         ORG   FREELIST                 ORG TO DEFINE FREEMAIN LIST     83000019
         FREEMAIN  V,A=GOTLOC,MF=L                                      83100019
         ORG   RSDEB                    RESET I.C.                      83200019
RSDEBTCB DC    X'00000000'              TCB ADDRESS                     83300019
RSDEBDEB DC    X'00000000'              DEB ADDRESS                     83400019
*                                                                       83500019
*    DATA CONTROL BLOCK                                                 83600019
*                                                                       83700019
RSDEBOFL DS    0CL1                                                     83800019
RSDEBIRB DC    X'00000000'              IRB ADDRESS                     83900019
RSDEBSYS DC    X'00000000'              1ST IOB ADDR IN SYS.PURGE CHAIN 84000019
RSDEBUSR DC    X'00000000'              1ST IOB ADDR IN USER PRGE CHAIN 84100019
RSDEBECB DC    X'00000000'              PARM.LIST ADDR TO PURGE ECB     84200019
RSDEBID  DS    0CL1                                                     84300019
RSDEBDCB DC    AL4(RSDCBREP)            DCB ADDR                        84400019
RSDEBAPP DS    CL4                      I/O APPENDAGE VECTOR TABLE      84500019
RSDEBMOD DS    0CL1                                                     84600019
RSDEBUCB DS    F                        UCB ADDRESS                     84700019
RSDEBBIN DS    H                        BIN NUMBER                      84750002
RSDEBSCC DS    H                        CYLINDER START ADDRESS          84800002
RSDEBSHH DS    H                        TRACK START ADDRESS             84850002
RSDEBECC DS    H                        CYLINDER END ADDRESS            84900002
RSDEBEHH DS    H                        TRACK END ADDRESS               84950002
RSDEBNTR DS    H                        NO. OF TRACKS IN THIS EXTENT    85000002
*                                                                       85400019
*    EVENT CONTROL BLOCK                                                85500019
*                                                                       85600019
RSECBAD  DS    CL4                      ECB ADDRESS                     85700019
RSDCBDEB DC    AL4(RSDEB)               DEB ADDRESS                     85800019
*                                                                       85900019
RSDCBREP EQU   RSDEB+8                  POINT TO RELATIVE BEGINNING DCB 86000019
*                                                                       86100019
*    INPUT OUTPUT BLOCK                                                 86200019
*                                                                       86300019
RSIOB    DS    0CL40                                                    86400019
RSIOBFG1 DC    X'00'                    I/O FLAGS BYTE 1                86500019
RSIOBFG2 DC    X'00'                    I/O FLAGS BYTE 2                86600019
RSIOBSN1 DS    CL1                      FIRST SENSE BYTE                86700019
RSIOBSN2 DS    CL1                      SECOND SENSE BYTE               86800019
RSIOBECB DC    AL4(RSECBAD)             ECB ADDRESS                     86900019
RSIOBCSW DS    D                        LAST CSW                        87000019
RSIOBCPA DS    AL4(RSCCW1)              CHANNEL PROGRAM ADDRESS         87100019
RSIOBDCB DS    AL4(RSDCBREP)            DCB ADDRESS                     87200019
RSIOBRCP DS    CL4                      RESTART ADDRESS FOR IOS         87300019
RSIOBINC DS    H                        INCREMENT BLOCK COUNT           87400019
RSIOBECT DS    H                        NO. OF ERROR ENTRIES            87500019
RSIOBDAD DS    D                        SEEK ADDRESS FOR DA             87600019
*                                                                       87700019
*    CHANNEL PROGRAM                                                    87800019
*                                                                       87900019
RSCCWLST DS    0CL24                                                    88000019
RSCCW1   DS    D                        CCW1                            88100019
RSCCW2   DS    D                        CCW2                            88200019
RSCCW3   DS    D                        CCW3                            88300019
*                                                                       88400019
*    BUFFER SEGMENT FOR EXTERNAL BLOCKS                                 88500019
*                                                                       88600019
RSSTATUS DS    0CL8                                                     88700019
RSSTAT1  DS    CL1                      STATUS BYTE 1                   88800019
RSSTAT2  DS    CL1                      STATUS BYTE 2                   88900019
RSSTAT3  DS    CL1                      STATUS BYTE 3                   89000019
RSSTAT4  DS    CL1                      STATUS BYTE 4                   89100019
         DS    0F                                                Y02049 89200002
RSPASSFL DS    AL1                      PASSWORD CHK IND         Y02049 89250002
RSTABAD  DS    AL3                      ADR OF CURR USING ENT    Y02049 89260002
RSTLABEL DS    0CL80                    TAPE HDR RECORD          Y02049 89270002
RSHDR    DS    CL3                      LABEL IDENT              Y02049 89280002
RSHDRNUM DS    CL1                      LABEL NO.                Y02049 89290002
RSDATAID DS    CL17                     DATA SET IDENT           Y02049 89292002
         DS    CL32                                              Y02049 89294002
RSDSSECR DS    CL1                      SECURITY IND(DATA SET)   Y02049 89296002
         DS    CL26                     REST OF HDR1             YM7337 89298002
         ORG   RSTLABEL                 DECLARE HDR2             YM7337 89298402
         DS    CL47                     FRONT OF HDR2            YM7337 89298802
RSDSIND  DS    CL1                      CHKPT D.S. INDR          YM7337 89299202
         DS    CL32                     REST OF HDR2             YM7337 89299602
RSSEGEND EQU   *                        LN OF SEG W/A FOR TAPE   YM7337 89299702
         EJECT                                                          89300019
         DCBD  DSORG=PS                                                 89400019
         EJECT                                                          93900019
         IHJDSTAB                                                Y02076 93950002
TABPOS   EQU   TABVLID2                                                 94000002
TABOPS   EQU   TABPOS                                                   94050002
TABFSFN1 EQU   TABPOS+1                                                 94100002
TABFSFN2 EQU   TABPOS+2                                                 94150002
TABBLK1  EQU   TABPOS+4                                                 94200002
TABBLK2  EQU   TABPOS+8                                                 94250002
TABUCB   EQU   TABPOS+12                                                94300002
         EJECT                                                          98800019
SRT      DSECT                                                          98900019
         IEFUCBOB                                                       99000019
         END                                                            99100019
