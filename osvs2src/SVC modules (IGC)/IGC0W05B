         TITLE 'IGC0W05B  ISAM && BDAM DATA SET PROCESSOR'       A30552 00100020
IGC0W05B CSECT                                                          00200019
*                                                                       00250037
*STATUS CHANGE LEVEL 003                                                01300021
*                                                                       01400019
*TITLE-        ISAM & BDAM DATA SET PROCESSING                          01500020
*                                                                       01600019
*STATUS-       INITIAL CODE                                             01700019
*                                                                       01800019
*FUNCTION-     FOR ISAM, IF THE DCBMACRF DOES NOT SPECIFY 'PUT',        01900019
*              THE FORMAT 2 DSCB IS READ AND AN XCTL IS MADE TO         02000019
*              ISAM OPEN TO VALIDATE ITS POINTERS.  IF AN I/O           02100019
*              ERROR OCCURS ISAM WILL SET A RETURN CODE.                02200019
*              FOR BDAM, LOAD THE ADDRESSES OF SOME OF THE BDAM         02220020
*              ACCESS METHOD MODULES INTO SOME OF THE OTHER BDAM        02240020
*              ACCESS METHOD MODULES.                                   02260020
*                                                                       02300019
*ENTRY POINTS- THIS MODULE IS ENTERED FROM IGC0R05B                     02350002
*                                                                       02360002
*INPUT-        REGISTER  1    ADDR OF REPI/O'S WORKAREA                 02400019
*              REGISTER  8    ADDR OF FIRST TABLE ENTRY                 02500019
*              REGISTER  1    ISAM RETURN CODE                          02600019
*              REGISTER  10   REP I/O WORKAREA                          02700019
*                                                                       02800019
*OUTPUT-       SAME AS REGISTER 1 AND 8 ABOVE                           02900019
*                                                                       03000019
*EXTERNAL REFERENCES-  THE FOLLOWING BDAM MODULES MAY BE LOADED,        03010020
*              ALTERED, AND DELETED, DEPENDING ON THE BDAM DEB SUB IDS  03020020
*              IGG019KA, IGG019KC, IGG019KE, IGG019KF,                  03030020
*              IGG019KI, IGG019KJ, IGG019KK, IGG019KL,                  03040020
*              IGG019KN, IGG019KO, IGG019KQ, IGG019KR,                  03050020
*              IGG019KW, IGG019KY, IGG019LA                             03060020
*                                                                       03070020
*EXITS-        TO ISAM OPEN EXECUTOR(IGG01920 OR IGG01950)              03100019
*              NORMAL TO IGC0T05B                                       03200019
*              ERROR  TO IGC0V05B                                       03300019
*                                                                       03400019
*              ERROR 74 - ERROR READING DSCB                            03430037
*              ERROR 77 - ERROR OPENING ISAM DATASET                    03450037
*CHANGE ACTIVITY                                                        03500037
*                                                                       03504037
*0000                                                            Y01021 03508037
*          RELEASE 20 DELETIONS                                         03512037
*3579001000,015000,410000-411000                                 A30552 03516037
*          RELEASE 21 DELETIONS                                         03520037
*0791346000-347000                                               M0187  03524037
*0791                                                            A43758 03528037
*0791409130-409140,468000                                        A35821 03532037
*0791409031-409036,409121-409138                                 A35339 03536037
*          RELEASE 22 DELETIONS                                         03540037
*          RELEASE 23 DELETIONS                                         03544037
*          RELEASE 24 DELETIONS                                         03548037
*          RELEASE 25 DELETIONS                                         03552037
*          RELEASE 26 DELETIONS                                         03556037
*          RELEASE 27 DELETIONS                                         03560037
*          RELEASE 28 DELETIONS                                         03564037
*                                                                       03568037
*     OS/VS2 RELEASE 030 ADDS/DELETIONS/CHANGES                         03572037
*242104-242265                                                  ZA00104 03576037
*241920                                                         ZA02542 03580037
*A241810-241840                                                @ZA08277 03584037
*                                                                       03588037
*     OS/VS2 RELEASE 037 ADDS/DELETIONS/CHANGES                         03592037
*D241810-241840                                                @ZA12948 03596037
* APAR OZ31495 HAS BEEN FLAGGED AS @ZSUT222                    @ZSUT222 03600037
*C174000,174500,293500,293600,305000                           @ZSUT222 03600637
*A293700,293800,305100-305400,433100                           @ZSUT222 03602037
*ATTRIBUTES-   RE-ENTRANT                                               03604037
*              RE-USABLE                                                03608037
*              ENABLED                                                  03612037
*              PRIVILEGED                                               03616037
*                                                                       03620037
*NOTES-                                                                 03624037
*  THE SPECIAL BDAM STORES ARE ONLY REQUIRED IN CASE THE MODULES        03628037
*  RESIDE IN THE RESIDENT ACCESS METHOD AREA, AND SO ARE NOT            03632037
*  RESTORED WHEN THE USER'S MAIN STORAGE IS RESTORED.                   03636037
*  BDAM IS NON-STANDARD IN THAT OPEN EXECUTOR MODULE IGG0193C DOES      03640037
*  THESE STORES INTO RE-ENTRANT MODULES.                                03644037
*                                                                       03648037
*TABLES/WORKAREAS-                                                      03652037
*                                                                       03656037
   EJECT                                                                03660037
*********************************************************************** 03700019
*                                                                     * 03800019
*    THE FOLLOWING IS A DESCRIPTION OF THE 48 BYTE TABLE ENTRY THAT   * 03900019
*    IS USED IN THE RESTART PORTION OF CHECKPOINT/RESTART.  EACH      * 04000019
*    ENTRY IN THE TABLE (ONE FOR EACH OPEN DATA SET AT CHECKPOINT)    * 04100019
*    IS 48 BYTES LONG.                                                * 04200019
*                                                                     * 04300019
*********************************************************************** 04400019
*                                                                       04500019
*        ------------------- 4 BYTES -----------------                  04600019
*                                                                       04700019
*      0 +++++++++++++++++++++++++++++++++++++++++++++                  04800019
*        +DATA SET  +           DCB                  +                  04900019
*        + O-GN.    +         ADDRESS                +                  05000019
*        +++++++++++++++++++++++++++++++++++++++++++++ 4                05100019
*        +FLAG BYTE +    WORKAREA SEGMENT            +                  05200019
*        + NO. 1    +         ADDRESS                +                  05300019
*      8 +++++++++++++++++++++++++++++++++++++++++++++                  05400019
*        +NUMBER    +         JFCB TTR               +                  05500019
*        + OF VOLS  +         ADDRESS                +                  05600019
*        +++++++++++++++++++++++++++++++++++++++++++++ 12               05700019
*                                                                       05800019
*     12 +++++++++++++++++++++++                                        05900019
*        +TAPE LABL + FILE SEQ +        DEVICE = TAPE                   06000019
*        +INFO BYTE + NUMBER   +                                        06100019
*        +++++++++++++++++++++++                                        06200019
*                                                                       06300019
*     12 +++++++++++++++++++++++                                        06400019
*        +    OLD   TIOT       +        DA AND UNIT RECORD              06500019
*        +      OFFSET         +                                        06600019
*        +++++++++++++++++++++++                                        06700019
*                                                                       06800019
*                              +++++++++++++++++++++++                  06900019
*                              +FLAG BYTE +FLAG BYTE +                  07000019
*                              +  NO. 2   +  NO. 3   +                  07100019
*     16 +++++++++++++++++++++++++++++++++++++++++++++                  07200019
*        +FLAG BYTE +FLAG BYTE +                     +                  07300019
*        + NO. 4    + NO. 5    +   VOLUME ID NO. 1   +                  07400019
*        +++++++++++++++++++++++                     + 20               07500019
*        +                                           +                  07600019
*        +                                           +                  07700019
*     24 +++++++++++++++++++++++++++++++++++++++++++++                  07800019
*        +                                           +                  07900019
*        +   VOLUME ID NO. 2                         +                  08000019
*        +                     +++++++++++++++++++++++ 28               08100019
*        +                     +                     +                  08200019
*        +                     +   VOLUME ID NO. 3   +                  08300019
*     32 +++++++++++++++++++++++                     +                  08400019
*        +                                           +                  08500019
*        +                                           +                  08600019
*        +++++++++++++++++++++++++++++++++++++++++++++ 36               08700019
*        +                                           +                  08800019
*        +   VOLUME ID NO. 4                         +                  08900019
*     40 +                     +++++++++++++++++++++++                  09000019
*        +                     +                     +                  09100019
*        +                     +                     +                  09200019
*        +++++++++++++++++++++++   VOLUME ID NO. 5   + 44               09300019
*        +                                           +                  09400019
*        +                                           +                  09500019
*        +++++++++++++++++++++++++++++++++++++++++++++ 48               09600019
*                                                                       09700019
    EJECT                                                               09800037
*********************************************************************** 10400019
*                                                                       10500019
*    REGISTER CONVENTION TO BE USED THRU-OUT REPI/O PHASE               10600019
*                                                                       10700019
*********************************************************************** 10800019
*                                                                       10900019
WRKR1    EQU   0                        WDRK/PARAMETER REGISTER         11000019
WRKR2    EQU   1                        WDRK/PARAMETER REGISTER         11100019
DCBR     EQU   2                        CURRENT DCB REGISTER            11200019
BASER    EQU   3                        BASE REGISTER                   11300019
DEBR     EQU   4                        CURRENT DEB REGISTER            11400019
UCBR     EQU   5                        CURRENT UCB REGISTER            11500019
TIOTR    EQU   6                        NEW TIOT REGISTER               11600019
TCBR     EQU   7                        TCB REGISTER                    11700019
TABLR    EQU   8                        BEGINNING TO DCB TABLE REG      11800019
CTABLR   EQU   9                        CURRENT ENTRY IN DCB TABLE      11900019
BUFR     EQU   10                       USER BUFFER AREA                12000019
DSCNTR   EQU   11                       WORK REGISTER                   12100019
WRKR3    EQU   12                       WORK REGISTER                   12200019
WRKR4    EQU   13                       WORK REGISTER                   12300019
WRKR5    EQU   14                       WORK/PARAMETER REGISTER         12400019
WRKR6    EQU   15                       WORK/PARAMETER REGISTER         12500019
*                                                                       12600019
*********************************************************************** 12700019
*                                                                       12800019
*    OFFSETS TO BE USED IN REPI/O PHASE                                 12900019
*                                                                       13000019
*********************************************************************** 13100019
*                                                                       13200019
READEX   EQU   X'02'                    BDAM READ EXCLUSIVE      A35821 13250021
IS       EQU   X'80'                    INDEXED SEQUENCIAL              13300019
PS       EQU   X'40'                    PHYSICAL SEQUENCIAL             13400019
DA       EQU   X'20'                    DIRECT ACCESS                   13500019
PO       EQU   X'02'                    PARTITIONED ORGANIZATION        13600019
NULL     EQU   X'80'                    NULLFILE OR SYSCHECK            13700019
INOROUT  EQU   X'40'                    SYSIN OR SYSOUT DATA SET        13800019
DADEV    EQU   X'20'                    DA DEVICE                       13900019
TPDEV    EQU   X'10'                    TAPE DEVICE                     14000019
LASTENT  EQU   X'08'                    LAST ENTRY                      14100019
UNITREC  EQU   X'04'                    UNIT RECORD EQUIPMENT           14200019
ERRINNSL EQU   X'80'                    ERROR IN NSL ROUTINE            14300019
NSLMTSW  EQU   X'40'                    NSL MOUNT SWITCH                14400019
NSLCOMU  EQU   X'20'                    NSL COMMUNICATION BIT           14500019
BYPASS   EQU   X'10'                    BYPASS LABEL PROCESSING         14600019
NSL      EQU   X'04'                    NON-STANDARD LABEL              14700019
SL       EQU   X'02'                    STANDARD LABEL                  14800019
NL       EQU   X'01'                    NO LABEL                        14900019
GTR5VOL  EQU   X'80'                    GREATER THAN 5 VOLUMES          15000019
POCONCAT EQU   X'40'                    P.O. CONCATENATED               15100019
DAFLAG   EQU   X'80'                    DA DATA SET FLAG                15200019
NONDAFLG EQU   X'40'                    NON-DA DATA SET FLAG            15300019
NSLFLAG  EQU   X'10'                    NSL ROUTINE FLAG                15400019
TYPERST  EQU   X'80'                    IMMEDIATE RESTART               15500019
TABENT   EQU   48                       TABLE ENTRY LENGTH              15600019
WRITE    EQU   X'01'                    WRITE ON TAPE                   15700019
READ     EQU   X'02'                    READ FOR TAPE                   15800019
NOPOP    EQU   X'03'                    NOP                             15900019
SENSE    EQU   X'04'                    SENSE                           16000019
REWIND   EQU   X'07'                    REWIND                          16100019
READBACK EQU   X'0C'                    READBACK                        16200019
UNLOAD   EQU   X'0F'                    REWIND AND UNLOAD               16300019
WTM      EQU   X'1F'                    WRITE TAPE MARK                 16400019
BSFOP    EQU   X'2F'                    BACKWARD SPACE FILE             16500019
FSFOP    EQU   X'3F'                    FORWARD SPACE FILE              16600019
SEARCH   EQU   X'31'                    SEARCH                          16700019
SRCHCNT  EQU   X'05'                    COUNT FOR SEARCH ID             16800019
TIC      EQU   X'08'                    TIC                             16900019
READDA   EQU   X'06'                    READ FOR DA                     17000019
LENJFCB  EQU   X'B0'                    LENGTH OF JFCB                  17100019
LBLLEN   EQU   X'50'                    LENGTH OF LABEL                 17200019
PERMERR  EQU   X'7F'                    PERMANENT ERROR                 17300019
ERR074   EQU   74                       I/O ERROR READING DSCB @ZSUT222 17400037
ERR077   EQU   77                       ISAM OPEN ERROR        @ZSUT222 17450037
ISORDA   EQU   IS+DA                    IS OR DA                        17700019
IOERROR  EQU   X'20'                    PERMANENT I/O ERROR             17800019
FILETYPE EQU   X'00'                    FILE TYPE BYTE                  17900019
THREE    EQU   X'03'                    TEST IF DSCB EXTN IS TO BE READ 18000019
READKND  EQU   X'0E'                    READ KEY AND DATA               18100019
LENGTH   EQU   X'8C'                    LENGTH OF KEY AND DATA          18200019
OUTP     EQU   X'0F'                    OUTPUT (DEBOPATB)               18300019
EXCHPGM  EQU   X'80'                    EXCP                            18400019
DADEVDPT EQU   X'0C'                    DA DEVICE DEPENDENT SECTION     18500019
WRITEDA  EQU   X'05'                    WRITE FOR DA                    18600019
SEVEN    EQU   X'07'                    TEST FOR GETTING UPPER LIMIT    18700019
LENDSCB  EQU   X'60'                    LENGTH OF DSCB                  18800019
DEBID    EQU   X'0F'                    DEB IDENTIFICATION              18900019
MAXEXT   EQU   X'CA'                    MAXIMUM NO. OF EXTENT           19000019
UNREL    EQU   X'02'                    UNRELATED FLAG                  19100019
TKBAL    EQU   25                       TRACK BALANCE SVC ROUTINE       19200019
D0       EQU   0                        CONSTANT ZERO            Y02076 19250002
D1       EQU   1                        CONSTANT ONE             Y02076 19260002
D2       EQU   2                        CONSTANT TWO             Y02076 19270002
D4       EQU   4                        CONSTANT FOUR            Y02076 19290002
D152     EQU   152                      CONSTANT ONE FIFTY TWO   Y02076 19294002
DFF      EQU   X'FF'                    CONSTANT FOX FOX         Y02076 19296002
*                                                                       19300019
*                                                                       19400019
*********************************************************************** 19500019
*                                                                       19600019
   EJECT                                                                19650037
         BALR  BASER,0                  ESTABLISH ADDRESSIBILITY        19700019
         USING *,BASER                                           Y01909 19800000
*                                                                       19900019
         USING RSTWA,BUFR                                               20000019
         USING IHADCB,DCBR                                              20100019
         USING TABL,CTABLR                                              20200019
         USING FORECORE,UCBR                                            20300019
         USING TCB,TCBR                                                 20400019
         USING DEBBASIC,DEBR                                     Y02076 20500002
         USING CVT,WRKR2                                                20600019
         USING TIOENTRY,WRKR5                                           20700019
*                                                                       20800019
REPDCB00 EQU   *                                                        20900019
         B     BEGIN                    BRANCH TO EYE CATCHER    Y01909 20950000
         CNOP  0,8                      ALIGN TO DOUBLE WD BOUND Y01909 20960000
         DC    CL8'IGC0W05B'            MODULE NAME            @ZSUT222 20970037
         DC    CL8'&SYSDATE'            LAST DATE SHIPPED      @ZSUT222 20972037
         DC    CL8'@ZSUT222'            LAST CODE SHIPPED      @ZSUT222 20974037
BEGIN    EQU   *                                                 Y01909 20980000
*                                                                       21000019
         MODESET EXTKEY=ZERO                                     Y02076 21050002
         TM    TABFLG2-TABL(TABLR),TABSW  RETURN  FROM  ISAM     Y02076 21100002
         BO    REPDCB54                 YES - BRANCH                    21200019
*                                                                       21300019
         MVI   RSRETCOD+1,X'00'         RESET RETURN CODE               21400019
         LR    CTABLR,TABLR             INITIALIZE CTABLR               21500019
         B     REPDCB02                 BRANCH TO TEST FOR TYPE OF D.S. 21700019
*                                                                       21800019
*********************************************************************   21900019
*                                                                       22000019
******** TEST FOR ISAM DATA SET                                         22100019
*                                                                       22200019
*********************************************************************   22300019
*                                                                       22400019
REPDCB01 EQU   *                                                        22500019
*                                                                       22600019
         LA    CTABLR,TABENT(CTABLR)    POINT TO NEXT TABL ENTRY        22700019
*                                                                       22800019
REPDCB02 EQU   *                                                        22900019
*                                                                       23000019
         L     DCBR,TABDCBAD-1          LOAD DCB ADDR            YM5512 23050002
         TM    DCBMACRF,EXCHPGM         TEST ACCESS METH.        YM5512 23060002
         BO    REPDCB04                 BR IF NO ACC. METH.      YM5512 23070002
         TM    TABDSORG,IS              IS IT ISAM                      23100019
         BO    REPDCB10                 IF SO, PROCESS IT               23200019
*                                                                       23300019
         TM    TABDSORG,DA              IS IT BDAM               A30552 23320020
         BO    BDAMSTRT                 IF SO, PROCESS IT        A30552 23340020
*                                                                       23360020
REPDCB04 EQU   *                                                        23400019
*                                                                       23500019
         TM    TABFLG1,TABLAST          TEST FOR LAST ENTRY             23600002
         BO    ENDUP                    YES - BRANCH                    23700019
*                                                                       23800019
         B     REPDCB01                 GO TEST TABL ENTRY              23900019
*                                                                       24000019
REPDCB10 EQU   *                                                        24100019
*********************************************************************** 24150002
*   GET SPACE FOR ISAM OPEN EXECUTORS WORK AREA IN SUBPOOL 230(KEY 5) * 24160002
*   THEN CLEAR IT AND PREPARE FOR READING IN THE DSCB                 * 24170002
*********************************************************************** 24180002
         LA    WRKR1,DSECTSIZ+ISDCBLNG  GET LNGTH-FORECORE WA   ZA02542 24192002
         S     WRKR1,DCBFRS16           SUBTRCT 1ST 16 BYTES     Y02076 24196002
         ST    WRKR1,SAVSPLNG           SAVE LENGTH OF SPACE     Y02076 24198002
         LR    WRKR3,WRKR1              SAVE IN WRKR3 FOR CLEAR  Y02076 24198402
         ICM   WRKR1,HIORDER,SP230      INSERT SUBPOOL 230       Y02076 24198802
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02076 24198902
         GETMAIN  R,LV=(WRKR1)          GET SPACE FOR ISAM       Y02076 24199202
         MODESET EXTKEY=ZERO            BACK TO KEY 0            Y02076 24199302
         LR    UCBR,WRKR2               ADR OF SPACE TO UCBR     Y02076 24199602
         SR    WRKR2,WRKR2              CLEAR WRKR2 FOR CLEAR    Y02076 24199702
         LA    WRKR3,0(WRKR3)           GET LNGTH OF ISAM SPACE  Y02076 24206402
         SRL   WRKR3,2                  DIVIDE BY 4 FOR COUNT    Y02076 24208402
         LR    WRKR5,UCBR               GET BEGIN ADDR OF SPACE ZA00104 24210402
REPDCB12 EQU   *                        INSTR MUST FOLLOW        Y02076 24213102
         ST    WRKR2,D0(WRKR5)          GET LNGTH OF ISAM SPACE ZA00104 24219802
         LA    WRKR5,D4(WRKR5)          INDEX TO NXT 4 BYTES    ZA00104 24226502
         BCT   WRKR3,REPDCB12           BR BACK UNTIL ALL CLEAR  Y02076 24233202
         MVC   DXUDCBAD(D4),TABDCBAD-D1 MOVE USER'S DCB ADR      Y02076 24243202
         L     TCBR,RSTCBAD             GET ADR OF TCB           Y02076 24253202
         MVC   DXUKEY(D1),TCBPKF        SAVE PROTECT KEY IN WA   Y02076 24263202
*                                                                       24266702
*********************************************************************   24300019
*                                                                     * 24400019
******** READ FORMAT TWO DSCB                                           24500019
*                                                                     * 24600019
*********************************************************************   24700019
*                                                                       24800019
         BAL   WRKR5,BLDCCWS            BRANCH TO BUILD CCW LIST SBRTN  25100019
*                                                                       25200019
*                                                                       25300019
         EXCP  DXIOB                                                    25400019
*                                                                       25500019
*********************************************************************   25600019
*                                                                       25700019
******** WAIT FOR COMPLETION OF READ                                    25800019
*                                                                       25900019
*********************************************************************   26000019
*                                                                       26100019
         WAIT  ,ECB=DXECB                                               26200019
*                                                                       26300019
         TM    DXECB,IOERROR            TEST FOR PERM I/O ERROR         26400019
         BZ    REPDCB68                 BRANCH IF ERROR           M3251 26500019
*                                                                       26600019
REPDCB22 EQU   *                                                        26700019
*                                                                       26800019
*********************************************************************   26900019
*                                                                       27000019
******** THE DSCB HAS BEEN SUCCESSFULLY READ                            27100019
*        COPY DCB INTO ISAM WORK AREA THEN XCTL TO OPEN EXECUTORS       27150002
*                                                                       27200019
*********************************************************************   27300019
*                                                                       27400019
         L     WRKR3,TABDCBAD-D1        GET ADR OF USER'S TCB    Y02076 27450002
         LA    WRKR3,0(WRKR3)           CLEAR HI ORDER BYTE      Y02076 27460002
         A     WRKR3,DCBFRS16           ADD 16                   Y02076 27470002
         LA    WRKR2,ISDCBLNG           GET LNGTH OF ISAM DCB    Y02076 27480002
         S     WRKR2,DCBFRS16           SUBT 16 FOR MOVE COUNT   Y02076 27490002
         BCTR  WRKR2,0                  DECREASE MOVE CNT BY 1   Y02076 27492002
         EX    WRKR2,ISDCBMOV           MOVE DCB TO SP230 SPACE  Y02076 27494002
         LA    WRKR1,X254(,UCBR)        GET ADR WHERE DCB COPIED YM7370 27496002
         STCM  WRKR1,ADDRBYTS,TABDCBAD  ADR OF COPIED DCB TO TAB Y02076 27498402
         LR    DEBR,UCBR                POINT REG4 AT OPEN WKAREA       27500019
         OI    TABFLG2-TABL(TABLR),TABSW SET ON RESTART SW              27600002
         SR    TCBR,TCBR                ZERO REG7 FOR OPEN SW           27700019
         LA    WRKR3,IGG01920           ISAM OPEN EXECUTOR              27800019
         TM    DCBRECFM,X'80'           FIXED FORMAT RECORDS            27900019
         BO    REPDCB25                 YES, BRANCH                     28000002
         LA    WRKR3,IGG01950           GO TO VLR OPEN EXECUTOR         28100019
REPDCB25 EQU   *                                                 YM7370 28110002
         LA    TIOTR,DXCCW1             SETUP WORKAREA FOR XCTL  Y01021 28120002
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           YM7370 28150002
         B     XCTL                     IF NOT                          28200019
*                                                                       28300019
REPDCB54 EQU   *                                                        28400019
*                                                                       28500019
*********************************************************************   28600019
*                                                                     * 28700019
******** CONTROL RETURNS HERE FROM ISAM OPEN.                           28800019
*                                                                     * 28900019
*********************************************************************   29000019
*                                                                       29100019
         NI    TABFLG2-TABL(TABLR),X'FF'-TABSW RESET RS SW       Y02076 29150002
         LTR   WRKR2,WRKR2              IS THERE AN ERROR RETURN CODE   29300019
         BZ    AROUND                   BRANCH IF NO ERROR     @ZSUT222 29350037
         MVI   RSRETCOD+1,ERR077        SET ISAM OPEN ERROR    @ZSUT222 29360037
         B     REPDCB69                 BRANCH TO XCTL         @ZSUT222 29370037
AROUND   EQU   *                                               @ZSUT222 29380037
         MVC   TABDCBAD-D1(D4),DXUDCBAD RESTORE USER'S DCB ADR   Y02076 29400002
         ICM   WRKR1,ADDRBYTS,SAVSPLNG+D1                        Y02076 29450002
         ICM   WRKR1,HIORDER,SP230      SUBPOOL NUMBER           Y02076 29460002
         LR    WRKR2,UCBR               ADR OF SP230 SPACE       Y02076 29470002
         MODESET EXTKEY=DATAMGT         GET INTO KEY 5           Y02076 29472002
         FREEMAIN  R,LV=(WRKR1),A=(WRKR2)  FREE THE SPACE        Y02076 29480002
         MODESET  EXTKEY=ZERO           BACK TO KEY 0            Y02076 29490002
         XC    RSERAS00,RSERAS00        CLEAR SCRATCH WORD       Y02076 29490402
         B     REPDCB04                 BR TO GET NEXT ENTRY     Y02076 29492002
*                                                                       29500019
REPDCB68 EQU   *                                                        29600019
*                                                                       29700019
*********************************************************************** 29800019
*                                                                     * 29900019
******** THIS ROUTINE IS ENTERED IF AN I/O ERROR OCCURRED READING A   * 30000019
* FILE MARK.                                                          * 30100019
*                                                                     * 30200019
*********************************************************************** 30300019
*                                                                       30400019
         MVI   RSRETCOD+1,ERR074        SET DSCB ERROR CODE    @ZSUT222 30500037
REPDCB69 EQU   *                                               @ZSUT222 30510037
         MVC   RSREGSAV(8),MODID        SAVE NAME OF MODULE    @ZSUT222 30520037
*                                       DETECTING ERROR        @ZSUT222 30530037
         STM   0,15,RSREGSAV+8          SAVE CURRENT REGISTERS @ZSUT222 30540037
         LA    WRKR3,RSTMODNM           POINT WRKR3 TO 'IGC0V05B'       30600019
         LA    TIOTR,RSERAS06           SETUP WORKAREA FOR XCTL  YM7370 30650002
         B     XCTL                     BRANCH TO XCTL RTN              30700002
*                                                                       30800019
ENDUP    EQU   *                                                        30900019
*                                                                       31000019
         LA    WRKR3,IGC0T05B           POINT TO NEXT REPI/O MODULE     31100019
         LA    TIOTR,RSERAS06           SETUP WORKAREA FOR XCTL  YM7370 31150002
*                                                                       31200019
XCTL     EQU   *                                                        31300019
*                                                                       31400019
         MVC   0(8,TIOTR),0(WRKR3)      MOVE NEXT MODULE NAME TO WKAREA 31600019
         LA    WRKR6,8(TIOTR)           INITIALIZE WRKR6 (REG 15)       31700019
*                                                                       31800019
*********************************************************************   31900019
         LR    WRKR2,BUFR               POINT REG 1 TO THE RESTART W/A  32000019
*********************************************************************   32100019
*                                                                       32200019
         XCTL  EPLOC=(TIOTR),SF=(E,(15))                                32300019
*                                                                       32400019
*                                                                       32500019
BLDCCWS  EQU   *                                                        32600019
*                                                                       32700019
*********************************************************************** 32800019
*                                                                     * 32900019
******** THIS ROUTINE GETS THE UCB AND DISK ADDRESS OF THE F2 DSCB    * 33000019
* AND PUTS IT IN THE WORKAREA.  IT ALSO CONSTRUCTS THE CCWS AND       * 33100019
* CONTROL BLOCKS NECESSARY FOR READING THE DSCB.                      * 33200019
*                                                                     * 33300019
*********************************************************************** 33400019
*                                                                       33500019
         L     WRKR2,CVTPTR             GET COMM VECTOR TABLE           33600019
         L     WRKR1,CVTXAPG            ADR OF APP. VECT. TBL.   Y02076 33650002
         ST    WRKR1,DXDEBAPP           STORE IN DEB FOR EXCP    Y02076 33700002
         MVI   DXDEBNTR,X'7F'           SET MAX NO. TRACKS       M0187  34050002
         MVI   DXDEBNTR+D1,DFF                                   Y02076 34060002
*                                                                       34100019
         LA    WRKR1,DXDCB              GET ADDR OF RESTART DCB         34200019
         ST    WRKR1,DXDEBDCB           STORE IT IN DEB                 34300019
         MVI   DXDEBID,DEBID            STORE ID FOR DEB                34400019
         XC    DXDEBSCC(8),DXDEBSCC     CLEAR DEB END AND START CCHH'S  34500019
*                                                                       34800019
         L     DCBR,TABDCBAD-1          GET USER'S DCB ADDR             34900019
         L     DEBR,DCBDEBAD            POINT TO USER'S DEB             35000019
         L     WRKR2,32(DEBR)           GET DEBFIEAD                    35100019
         LA    WRKR2,0(WRKR2)           CLEAR HIGH BYTE                 35200019
         LTR   WRKR2,WRKR2              TEST FOR INDEX EXTENT           35300019
         BNZ   TSTMODE                  IF PRESENT, BR--F2 DSCB IS HERE 35400019
         L     WRKR2,36(DEBR)           GET FIRST PRIME VOL INSTEAD     35500019
TSTMODE  EQU   *                                                        35600019
         MVC   DXDEBUCB+1(3),1(WRKR2)   UPDATE UCB ADDRESS              35700019
         LR    WRKR2,DEBR               GET DEB ADDR FOR CALC    Y02049 35750002
         LA    WRKR6,DEBPRFLN           GET LENGTH OF DEB PREFIX Y02049 35800002
         SR    WRKR2,WRKR6              POINT TO DEB PREFIX      Y02049 35850002
         USING DEBPREFX,WRKR2                                    Y02049 35860002
         L     WRKR2,DEBXTNP            POINT TO DEB EXTENSION   Y02049 35870002
         USING DEBXTN,WRKR2                                      Y02049 35880002
         TM    DEBXMCF2,DCBMRMVP+DCBMRLCP IS IT LOAD MODE        Y02049 35890002
         BZ    TSTSCAN                  NO, BRANCH                      35900019
         MVC   DCBWKPT4+1(3),DXDEBUCB+1 UPDATE F2 UCB ADDR IN DCB       36000019
         B     REPDCB04                 GET NEXT DCB                    36100019
TSTSCAN  EQU   *                        INSTR MUST FOLLOW        Y02049 36150002
         TM    DEBXMCF1,DCBMRGET        IS IT SCAN MODE ?        Y02049 36200002
         BZ    BISAM                    NO, BRANCH--IT MUST BE BISAM    36300019
         DROP  WRKR2                                             Y02049 36350002
         MVC   DXDAADDR+3(5),DCBWKPT3   CCHHR OF F2 DSCB                36400019
         MVC   DCBWKPT4+1(3),DXDEBUCB+1 GET UCB OF F2 DSCB INTO DCB     36500019
         B     BOTH                                                     36600019
BISAM    L     WRKR2,DCBWKPT2           GET BISAM WORKAREA BASE         36700019
         USING IHADCW,WRKR2                                             36800019
         MVC   DXDAADDR+3(5),DCWOPCLS   CCHHR OF F2 DSCB                36900019
         MVC   DCWOPCLS+5(3),DXDEBUCB+1 GET UCB ADDR INTO BISAM WKAREA  37000019
BOTH     EQU   *                                                        37100019
*                                                                       37200019
         LA    WRKR2,DXDEB              GET DEB ADDR                    37300019
         ST    WRKR2,DXDCBDEB           STORE IN DCB                    37400019
* SET DEB EXTENTS TO COVER ENTIRE VOLUME.  START CCHH IS ZERO, END      37405021
* CC IS OBTAINED FROM DEVICE CHARACTERISTICS TABLE.                     37410021
*                                                                       37415021
         L     WRKR2,CVTPTR             FOLLOW POINTERS          M0187  37420021
         USING CVT,WRKR2                                         M0187  37425021
         L     WRKR2,CVTZDTAB           POINT AT DEVTAB          M0187  37430021
         DROP  WRKR2                                             M0187  37435021
         L     WRKR6,DXDEBUCB           POINT AT UCB FOR DEVICE  M0187  37440021
         USING SRT,WRKR6                                         M0187  37445021
         IC    WRKR6,UCBTBYT4           PICK UP INDEX TO DEVTAB  M0187S 37450021
*                                       INDICE                   M0187  37455021
         DROP  WRKR6                                             M0187  37460021
         N     WRKR6,MASK1              USE ONLY LO-ORDER 4 BITS M0187  37465021
         IC    WRKR6,0(WRKR2,WRKR6)     DEVTAB INDEX, THIS       M0187  37470021
*                                       DEVTYPE                  M0187  37475021
         AR    WRKR2,WRKR6              POINT TO DEVTAB ENTRY    M0187  37480021
         MVC   DXDEBECC,0(WRKR2)        EXTRACT HIGHEST CC FOR   M0187  37485021
*                                       VOLUME                   M0187  37490021
         MVC   DXDEBBIN(D2),BINUMSI     SET BIN NO.=0000         Y02076 37492002
         MVI   DXDEBUSR,NMEXTS1         SET NO. OF EXTS.=1       Y02076 37494002
         MVI   DXDEBAPP,EXSCLS1         SET EXT SCALE=4          Y02076 37496002
         MVI   DXDEBMOD,DVMODS1         SET FILE MASK=C0         Y02076 37498002
*                                                                       37500019
*********************************************************************   37600019
*                                                                     * 37700019
******** COMPLETE IOB                                                 * 37800019
*                                                                     * 37900019
*********************************************************************   38000019
*                                                                       38100019
         MVI   IOBFLAG1,UNREL           MAKE I/O UNRELATED              38200019
         LA    WRKR2,DXDCB              GET DCB ADDR                    38300019
         ST    WRKR2,IOBWGHT            STORE IN IOB                    38400019
         LA    WRKR2,DXECB              GET ECB ADDR                    38500019
         ST    WRKR2,IOBECBPT           STORE IN IOB                    38600019
         LA    WRKR2,DXCCW              GET CCW STRING ADDR             38700019
         ST    WRKR2,IOBSIOCC           STORE IN IOB                    38800019
*                                                                       38900019
*********************************************************************   39000019
*                                                                     * 39100019
******** GET THE BIN NUMBER AND PUT IT INTO THE DEB.                  * 39200019
*                                                                     * 39300019
*********************************************************************   39400019
*                                                                       39500019
         LA    WRKR6,16                 LOAD 16 INTO WRKR6              39600019
         SR    DEBR,WRKR6               POINT TO BBCCHHR, FRONT OF DEB  39700019
         MVC   DXDAADDR+1(2),1(DEBR)    MOVE BB TO WORKAREA             39800019
         MVC   DXDEBBIN(2),1(DEBR)      MOVE BB TO DEB                  39900019
*                                                                       40000019
         XC    DXCCW(24),DXCCW          CLEAR THE CHAN PROG AREA        40100019
         LA    WRKR6,DXDAADDR+3         POINT TO CCHHR                  40200019
         ST    WRKR6,DXCCW1             STORE IN SEARCH INSTRUCTION     40300019
         LA    WRKR6,DXCCW1             POINT TO SEARCH INSTRUCTION     40400019
         ST    WRKR6,DXCCW2             STORE IT IN TIC INSTRUCTION     40500019
         LA    WRKR6,DXJBF              POINT TO JFCB                   40600019
         ST    WRKR6,DXCCW3             STORE IT IN READ DATA INSTR.    40700019
         OC    DXCCW(24),CCWLIST        OR IN CHANNEL PROGRAM           40800019
         BR    WRKR5                    BRANCH OUT OF SBRTN VIA WRKR5   40900019
*                                                                       40901020
*********************************************************************** 40902020
*                                                                     * 40903020
*  DETERMINE IF A READ EXCLUSIVE LIST EXISTS FOR BDAM DATA SETS       * 40905002
*  IF SO, PROVIDE SPACE IN SUBPOOL 230(KEY 5) FOR THE LIST TO BE      * 40907002
*  MOVED INTO.  CLEAR THE SPACE AND STORE ITS ADDR IN DEB EXTENTION   * 40909002
*                                                                     * 40910020
*********************************************************************** 40911020
*                                                                       40912020
BDAMSTRT EQU   *                                                 A35339 40912121
         L     DCBR,TABDCBAD-1          LOAD DCB ADDRESS         A35339 40913121
         L     DEBR,DCBDEBAD            LOAD DEB ADDR FROM DCB   A30552 40915020
         TM    DCBOPTCD,RDEXLST         DOES READ EXCL LIST XST  Y02076 40915102
         BZ    REPDCB04                 BRANCH IF NO             Y02076 40916802
         MODESET  EXTKEY=DATAMGT        GET INTO KEY 5           Y02076 40918802
         ICM   WRKR1,ADDRBYTS,RDEXLNGH  GET 152 BYTES FOR BDAM   Y02076 40920802
         ICM   WRKR1,HIORDER,SP230      SUBPOOL 230              Y02076 40920902
         GETMAIN  R,LV=(WRKR1)          ISSUE GETMAIN            Y02076 40921002
         XC    D0(D152,WRKR2),D0(WRKR2) CLEAR BDAM SP230 SPACE   Y02076 40921102
         LR    WRKR3,DEBR               GET DEB ADDR             YM7342 40921402
         LA    WRKR1,DEBPRFLN           GET PREFIX LENGTH        Y02076 40921802
         SR    WRKR3,WRKR1              BEGIN ADDR OF PREFIX     Y02076 40921902
         USING DEBPREFX,WRKR3                                    Y02076 40922102
         L     WRKR3,DEBXTNP            GET ADR OF DEB EXTENTION Y02076 40922502
         DROP  WRKR3                                             Y02076 40922602
         USING DEBXTN,WRKR3                                      Y02076 40922702
         ST    WRKR2,DEBXXARG           SAVE AREA ADR IN DEB XT  Y02076 40922802
         DROP  WRKR3                                             Y02076 40923102
         MODESET  EXTKEY=ZERO           GET BACK INTO KEY 0      Y02076 40923502
         B     REPDCB04                 GO GET NEXT ENTRY        Y02076 40923602
*                                                                       41198302
*********************************************************************   41200019
*                                                                     * 41300019
*     CHANNEL PROGRAM USED BY REPI/O                                    41400019
*                                                                     * 41500019
*********************************************************************   41600019
*                                                                     * 41700019
CCWLIST  DS    0CL24                                                    41800019
         DC    X'3100000040000005'      SEARCH.                         41900019
         DC    X'08'                    TIC                             42000019
ZERO     DC    X'00000000000000'        ZERO                            42100019
         DC    X'0E0000000000008C'      READ KEY-DATA                   42200019
*                                                                     * 42300019
*********************************************************************   42400019
*                                                                     * 42500019
*     CONSTANTS USED IN REPI/O                                          42600019
*                                                                     * 42700019
*********************************************************************   42800019
*                                                                     * 42900019
IGG01920 DC    CL8'IGG01920'            ISAM OPEN EXECUTOR              43000019
IGG01950 DC    CL8'IGG01950'            ISAM VLR EXECUTOR               43100019
IGC0T05B DC    CL8'IGC0T05B'            NEXT MOD OF REPI/O              43200019
RSTMODNM DC    CL8'IGC0V05B'            RESTART EXIT MOD                43300019
MODID    DC    CL8'IGC0W05B'            MODULE ID              @ZSUT222 43310037
MASK1    DC    F'15'                    MASK OF LO-ORDER 4 BITS  M0187  43320021
DCBFRS16 DC    F'16'                    LNGTH OF DCB ISAM IGNORE Y02076 43330002
RXLSTSIZ DC    0F'0',X'FE000050'        80 BYTES, SUBPOOL 254    A35821 43350021
ISDCBMOV MVC   X264(1,UCBR),D0(WRKR3)   DCB MOVE INSTR FOR EX    YM7370 43352002
RDEXLNGH DC    AL3(152)                 152 BYTES FOR BDAM       Y02076 43356002
SP230    DC    AL1(230)                 SUBPOOL 230              Y02076 43358002
ADDRBYTS EQU   7                        GETMAIN/FREMAIN PARAMS   Y02076 43358402
HIORDER  EQU   8                        HIORDER BYTE             Y02076 43358802
RDEXLST  EQU   X'02'                    CODE FOR BDAM READ EXCL  Y02076 43359202
DEBPRFLN EQU   16                       DEB PREFIX LENGTH        Y02076 43359602
BINUMSI  DC    XL2'0000'                BIN NUMBER = 0000        Y02076 43359702
NMEXTS1  EQU   X'01'                    NO. OF EXTENTS           Y02076 43359802
EXSCLS1  EQU   X'04'                    DEB EXT SCALE            Y02076 43359902
DVMODS1  EQU   X'C0'                    FILE MASK                Y02076 43366602
X264     EQU   X'264'             CONSTANT                       YM7370 43368602
X254     EQU   X'254'             CONSTANT                       YM7370 43370602
PATCH    EQU   (*-IGC0W05B)/20          MAINTENANCE SPACE        Y01909 43373302
         DC    XL(PATCH)'00'                                     Y01909 43380000
         EJECT                                                          43400019
FORECORE DSECT                                                          43500019
         IECDSECT                                                       43600019
*                                                                       43630020
RSBUFSEG EQU FORECORE                   START OF WORK AREA       A30552 43660020
         EJECT                                                          43700019
CVT      DSECT                                                          43800019
         CVT                                                            43900019
         EJECT                                                          44000019
*                                                                       44100019
*                                                                       44200019
*   TASK CONTROL BLOCK                                                  44300019
*                                                                       44400019
*                                                                       44500019
         IKJTCB                                                  Y02076 44550002
         EJECT                                                          46700019
         DCBD  DSORG=(IS,DA)                                     A35821 46800021
ISDCBLNG EQU   DCBWKPT6+4-IHADCB        LENGTH OF ISAM DCB       Y02076 46850002
ISDCBCPY EQU   DCBWKPT6+4               ADR FOR DCB COPY         Y02076 46860002
IHADCW   DSECT                          BISAM DCB WORKAREA              46900019
         DS    0D                                                       47000019
DCWFCP4  DS    A                                                        47100019
DCWFCP7  DS    A                                                        47200019
DCWNUCPS DS    CL1                                                      47300019
DCWNUCP4 DS    CL1                                                      47400019
DCWNUCP7 DS    CL1                                                      47500019
DCWNLSD  DS    CL1                                                      47600019
DCWFIOBU DS    A                                                        47700019
DCWLIOBU DS    A                                                        47800019
DCWFUPDI DS    A                                                        47900019
DCWLUPDI DS    A                                                        48000019
DCWHIAV  DS    CL1                                                      48100019
DCWWKNI  DS    BL1                                                      48200019
DCWNLEVC DS    CL1                                                      48300019
DCWNUWKN DS    CL1                                                      48400019
DCWMSHIL DS    A                                                        48500019
DCWHIRPS DS    CL1                                                      48600019
DCWNACT  DS    CL1                                                      48700019
DCWSIZE  DS    H                                                        48800019
DCWOPCLS DS    D                        CCHHR AND UCB ADDR OF F2 DSCB   48900019
DCWFIOBE DS    A                                                        49000019
DCWLIOBE DS    A                                                        49100019
         EJECT                                                          49200019
*                                                                       49300019
*                                                                       49400019
*   DATA EXTENT BLOCK                                                   49500002
*                                                                       49600019
         IEZDEB                                                  Y02076 49650002
         EJECT                                                          53600019
TIOT     DSECT                                                          53700019
         IEFTIOT1                                                       53800019
         EJECT                                                          53900019
SRT      DSECT                                                          54000019
         IEFUCBOB                                                       54100019
         EJECT                                                          54200019
         IEEVRSWA  VER=3                                                54300000
SAVSPLNG EQU   RSERAS00                 SAVE ADR OF SP230 LNGTH  Y02076 54350002
         EJECT                                                          54400019
         IHJDSTAB                                                Y02076 54450002
         END                                                            58900019
