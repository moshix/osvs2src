         TITLE 'IGCD310D - DISPLAY LIST OF ACTIVE OR INACTIVE ENTERIES' 00100000
IGCD310D CSECT                                                          00400022
*A000000-999999                                                @Y16X5RR 00450000
*A000000-999999                                                  S99240 00500022
*C014000,806000-807000,822000-824000,408000                      S22024 00550000
*A266000,329000,340600,346600,410000,414200,483000,486500 674600 S22024 00560022
*A688200,710400,832000,835000,780000                             S22024 00570000
*A670000,                                                       SA68709 00573000
*C768000                                                       @0Z14169 00576000
*C010000,014000,267200,269000,214000,221000,230000,232000      @Y17XARR 00584000
*C340600,368000,380000,414000,415600,674600,711600,756000      @Y17XARR 00588000
*C790000,798900,110000                                         @Y17XARR 00592000
*A835000                                                       @Y17XARR 00596000
*A674640,674960                                                @YM06476 00596600
*C674760-674840                                                @YM06476 00597200
*D675080                                                       @YM06476 00597800
*A808000                                                       @YM06500 00598400
*C267600,380006,415660                                         @YM06500 00599000
*D554000-590000                                                @G36XAYF 00599300
*C594000,598000,606000,646000,650000,610000-642000             @G36XAYF 00599600
*A340750,674840,798800                                         @OX20443 00599782
*A415670                                                       @OX20443 00599882
*A504000,808000                                                @OZ29946 00599982
*A632000                                                       @OZ31728 00600082
*A414016,411050,411300,414180,416700,417100,675040             @OY20584 00600182
*********************************************************************** 00800082
*                                                                     * 00830082
* MODULE NAME = IGCD310D(TCAM,OPERATOR CONTROL)               @Y17XARR* 00900000
*                                                                     * 01200022
* DESCRIPTIVE NAME= DISPLAY A LIST OF ACTIVE OR INACTIVE      @Y17XARR* 01220000
*                      ENTERIES                               @Y17XARR* 01240000
*                                                                     * 01260000
* COPYRIGHT = 'NONE'                                          @Y17XARR* 01280000
*                                                                     * 01300000
* STATUS = VERSION 10                                         @Y17XARR* 01320000
*                                                                     * 01600022
*FUNCTION -- THIS ROUTINE PROCESSES OPERATOR CONTROL COMMANDS WHICH   * 01800022
*   REQUEST DISPLAY OF A LIST OF EITHER ACTIVE OR INACTIVE            * 02000022
*   TERMINALS FOR A GIVEN LINE.                                       * 02200022
*                                                                     * 02400022
*   WHEN THIS ROUTINE GAINS CONTROL THE OPERANDS IN THE COMMAND HAVE  * 02600022
*   BEEN VALIDITY CHECKED BY IGCD010D ROUTINE AND ANY ERROR MESSAGES  * 02800022
*   WRITTEN OUT BY THE ERROR WRITER IGC0310D  ROUTINE                 * 03000022
*                                                                     * 03200022
*   IT OBTAINS FROM THE OPERATOR CONTROL ELEMENT (OPCE) THE ADDRESS OF* 03400022
*   THE ASSOCIATED DCB. FROM IT THE INVITATION LIST ADDRESS IS        * 03600022
*   OBTAINED FROM DCBINVLI AND IS SERIALLY SEARCHED FOR EACH ACTIVE OR* 03800022
*   INACTIVE ENTRY IN THE LIST. THE TERMNAME FOR EACH APPROPRIATE     * 04000022
*   ENTRY IS OBTAINED FROM THE TERMNAME TABLE AND PLACED IN A RESPONSE* 04200022
*   MESSAGE. WHEN THE END OF THE LIST IS REACHED, THE LINE NAME IS    * 04400022
*   PLACED IN THE RESPONSE AND THE ROUTINE EXITS TO THE MESSAGE       * 04600022
*   WRITER ROUTINE IGC0710D WITH THE MESSAGE IN THE OPERATOR CONTROL  * 04800022
*   RESIDENT WORK AREA IN IEDQCA.                                     * 05000022
*                                                                     * 05200022
*   WHEN THE PROPER DCB HAS BEEN OBTAINED FOR EITHER FORMAT, IT IS    * 05400022
*   TESTED FOR AN OPEN CONDITION.  IF IT IS NOT OPEN, AN ERROR        * 05600022
*   MESSAGE IS BUILT AND THE ROUTINE EXITS TO THE CONTROL MODULE.     * 05800022
*   OTHERWISE THE INVITATION LIST ADDRESS IS OBTAINED FROM DCBINVLI   * 06000022
*   AND IS SERIALLY SEARCHED FOR EACH ACTIVE OR INACTIVE ENTRY IN     * 06200022
*   THE LIST.  THE TERMNAME FOR EACH APPROPRIATE ENTRY IS OBTAINED    * 06400022
*   FROM THE TERMNAME TABLE AND PLACED IN A RESPONSE MESSAGE.  WHEN   * 06600022
*   THE END OF THE LIST IS REACHED, THE LINE NAME IS PLACED IN THE    * 06800022
*   RESPONSE AND THE ROUTINE EXITS TO THE CONTROL MODULE.             * 07000022
*                                                                     * 07200022
*    FOR THE 3705 COMMAND, NCP,LINE,GROUPNAME,RLN,PU ARE VALID@Y17XARR* 07210000
*    TYPES.   IF THE REQUEST IS TO DISPLAY ACTIVE ENTERIES,   @Y17XARR* 07220000
*    THEN FOR THE NCP ALL THE ACTIVE LINES(GROUPNAME,RLN)ARE  @Y17XARR* 07230000
*    DISPLAYED; FOR LINE ALL THE ACTIVE PU ARE DISPLAYED; FOR @Y17XARR* 07240000
*    FOR PU ALL THE ACTIVE LUS ARE DISPLAYED.   IF NONE OF THE@Y17XARR* 07250000
*    ARE ACTIVE, THEN THE NONE MESSAGE IS PRINTED.            @Y17XARR* 07260000
*   IF THE REQUEST IS TO DISPLAY INACTIVE ENTERIES, THEN      @Y17XARR* 07270000
*   FOR EACH VALID INPUT THE SAME TYPE OF ENTERIES ARE        @Y17XARR* 07280000
*   DISPLAYED AS IN THE CASE OF THE ACT REQUEST.   IF NO      @Y17XARR* 07290000
*   ENTERIES ARE INACTIVE, THEN THE ALL INACTIVE  MESSAGE     @Y17XARR* 07300000
*   IS PRINTED .                                              @Y17XARR* 07310000
*                                                             @Y17XARR* 07320000
*ENTRY POINTS --                                                      * 07400022
*        'IGCD310D' TO PROCESS DISPLAY ACT-INACT COMMANDS.            * 07600022
*   GAINS CONTROL VIA AN XCTL FROM IGCD010D                           * 07800022
*                                                                     * 08000022
*INPUT-- REGISTER 1 - ADDRESS OF OPERATOR CONTROL AVT. THE OPCE IS AT * 08200022
*   THE LABEL OPCCOPCE. THE FIELDS USED BY THIS ROUTINE IN OPCE ARE:  * 08400022
*        OPCE                                                         * 08600022
*      (+4)OCELEM - ADDRESS OF THE DCB                                * 08800022
*      (+D)OCSWITCH - X'80' DISPLAY INACTIVE                          * 09000022
*                     X'00' DISPLAY ACTIVE                            * 09200022
*      (+F)OCRLN - RELATIVE LINE NUMBER                               * 09400022
*      (+20)OCBACKUP - CONTAINS EITHER GROUPNAME OR LINE ADDRESS      * 09600022
*   THE FIELDS IN OPCAVT RELEVANT TO THIS ROUTINE ARE:                * 09800022
*        OPCAVT                                                       * 10000022
*      (+0)OPCDOUBL - RLN IF GROUPNAME,RLN SPECIFIED                  * 10200022
*                                                                     * 10400022
*OUTPUT-- REGISTER 1 - ADDRESS OF OPCAVT                              * 10600022
*                                                                     * 10800022
*EXTERNAL ROUTINES-- OPCHORTG,OPCTNTEA                        @Y17XARR* 10900000
*                                                                     * 11200022
*EXITS,NORMAL-- COMMAND IS PROCESSED. A RESPONSE MESSAGE IS BUILT IN  * 11400022
*   THE OPERATOR CONTROL RESIDENT WORK AREA  AND CONTROL PASSES TO    * 11600022
*   THE MESSAGE MODULE IGC0710D.                                      * 11800022
*                                                                     * 12000022
*   NORMAL EXIT MESSAGES ARE-                                         * 12200022
*   IED036I 'GRPNAME,RLN/ADDRESS' ACTIVE='STATNAME,.../NONE'          * 12400022
*           'LINENAME/PUNAME/NCPNAME'                         @Y17XARR* 12500000
*   IED037I 'GRPNAME,RLN/ADDRESS' INACTIVE='STATNAME,.../NONE'        * 12600022
*           'LINENAME/PUNAME/NCPNAME'                         @Y17XARR* 12700000
*                                                                       12800022
*EXITS,ERROR--  N/A. IGCD010D GENERATES ERROR MESSAGES                * 13000022
*   ERROR MESSAGES ARE-                                               * 13200022
*   IED037I LINE 'GRPNAME,RLN/ADDRESS' NOT OPEN --GENERATED BY        * 13400022
*   IGCD010D                                                          * 13600022
*                                                                     * 13800022
*TABLES/WORK AREAS--OPCAVT,TCAM AVT,DEB,DCB,OPCE,TERMNAME TABLE       * 14000022
*               TRM                                           @Y17XARR* 14030000
*MODULE TYPE=PROCEDURE                                        @Y17XARR* 14060000
*PROCESSOR=ASSEMBLER                                          @Y17XARR* 14090000
*MODULE SIZE=                                                 @Y17XARR* 14120000
*PATCH LABEL=ZAPS                                             @Y17XARR* 14150000
*                                                                     * 14200022
*ATTRIBUTES-- SERIALLY REUSABLE,TRANSIENT(TYPE 4),SUPERVISOR MODE,    * 14400022
*   DISABLED,NON-REENTRANT,REFRESHABLE                                * 14600022
*                                                                     * 14800022
*CHARACTER CODE DEPENDENCY                                            * 15000022
*        THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL        * 15200022
*        REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS        * 15400022
*        EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE CODING     * 15600022
*        HAS BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER          * 15800022
*        CONSTANTS, BY REASSEMBLY WILL RESULT IN A CORRECT MODULE     * 16000022
*        FOR THE NEW DEFINITION.                                      * 16200022
*                                                                     * 16400022
*NOTES - COMMUNICATIONS BETWEEN THE VARIOUS TRANSIENT MODULES IS      * 16600022
*        PRIMARILY THROUGH THE OPERATOR CONTROL AVT.                  * 16800022
*                                                                     * 17000022
*        THIS IS A MODULE RE-WRITE OF IEDQCL AS OF OS/TCAM LEVEL II   * 17100022
*********************************************************************** 17200022
         EJECT                                                          17400022
*        REGISTER EQUATES                                               17600022
RZERO    EQU   0                        REG 0                    S22024 17800000
RPARM    EQU   1                   PARAMETER REGISTER                   18000022
ROPCAVT  EQU   2                   BASE REG FOR OPC AVT                 18200022
ROPCE    EQU   3                   BASE REG FOR OPC ELEMENT             18400022
RWKAREA  EQU   6                   ADDRESS OF OPC WORKAREA              18600022
R0       EQU   0                        WORK                            18800022
R1       EQU   1                        PARAMETER                       19000022
RMSG     EQU   1                        MESSAGE BASE                    19200022
ROPC     EQU   2                        OPERATOR CONTROL AVT BASE       19400022
RWORK2   EQU   7                        WORK                            19600022
RRETURN  EQU   4                   BRANCHING REGISTER                   19800022
RAVT     EQU   4                        AVT BASE                        20000022
RTNT     EQU   4                        TERMNAME TABLE BASE             20200022
RTCB     EQU   5                        TCB BASE                        20400022
RDEB     EQU   5                        DEB BASE                        20600022
RWORK6   EQU   5                        WORK                            20800022
RTERM    EQU   5                        TERMINAL ENTRY           S22024 20900022
ROFF     EQU   6                        DDNAME OFFSET                   21000022
RRLN     EQU   6                        RLN WORK                        21200022
RDCB     EQU   7                        DCB BASE                        21400022
RLEN     EQU   7                        WORK REGISTER          @Y17XARR 21500000
RDD      EQU   8                        DDNAME                          21600022
RUCB     EQU   8                        UCB BASE                        21800022
RACT     EQU   8                        ACTIVE LIST ENTRIES             22000022
RLCB     EQU   8                        3705 LCB                 S22024 22100022
RSAVER14 EQU   9                        SAVE RETURN ADDRESS    @Y17XARR 22150000
RLIST    EQU   9                        INVITATION LIST WORK START      22200022
RINV     EQU   10                       INVITATION LIST START           22400022
RTERMNAL EQU   10                       TERMINAL ENTRY BASE    @Y17XARR 22500000
RWORK    EQU   11                       WORK                            22600022
RBASE    EQU   12                       ROUTINE BASE                    22800022
R13      EQU   13                       SAVE AREA                       23000022
RSAVE    EQU   13                       SAVE AREA ADDRESS      @Y17XARR 23100000
RWORK5   EQU   14                       WORK                            23200022
RRET     EQU   14                       RETURN ADDRESS         @Y17XARR 23260000
RLINK    EQU   15                       ENTRY POINT            @Y17XARR 23320000
R15      EQU   15                       ENTRY POINT                     23400022
RWORK3   EQU   15                       WORK                            23600022
         EJECT                                                          23800022
         USING IEDQOPCD,ROPCAVT    ADDRESSABILITY FOR OP CTL            24000022
         USING DEBNMSUB,RDEB            ADDRESSABILITY FOR DEB          24200022
         USING IHADCB,RDCB              ADDRESSABILITY FOR DCB          24400022
         USING IEDQAVTD,RAVT            ADDRESSABILITY FOR AVT          24600022
         USING IEDQOPCE,ROPCE      ADDRESSABILITY FOR OPC ELEMENT       24800022
         BALR  RBASE,0             ESTABLISH ADDRESSABILITY             25000022
         USING *,RBASE                                                  25200022
IGCD310D IEDHJN SKIPID                                                  25700022
         LR    ROPC,R1                  GET OP CTL AVT                  26200022
         L     RAVT,OPCAVTPT       GET AVT ADDRESS                      26400022
         L     ROPCE,OPCCOPCE           GET ADDR OF OPC ELEMENT  S22024 26600022
         L     RDCB,OCELEM              GET ADDR OF DCB/LGB/TTE@Y17XARR 26630000
         L     RWKAREA,OPCWORK          OPC WORK AREA            S22024 26720022
         CLC   OCLINK,FULLZERO          IS ORIGINAL INP A TTE? @YM06500 26760000
         BE    ACT3                     YES, BRNCH TO PROCESS  @Y17XARR 26800000
*                                       3705 DISPLAY COMMAND   @Y17XARR 26840000
         TM    DCBDSORG,TXLGB           3705 CMD ?               S22024 26900022
         BO    DSPLYLGB                 LGB,BRANCH TO PROCESS  @Y17XARR 26920000
*                                       DISPLAY OF A LINE      @Y17XARR 26940000
         TM    DCBDSORG+ONE,LINEGRP     LINE GROUP DCB           S22024 27020022
         BZ    GET3705                  NO, BRANCH             @YM07289 27080000
         MVI   OPCFOUR(RWKAREA),BLANK   BLANK WORK AREA          S22024 27120022
         MVC   OPCFOUR+ONE(L256,RWKAREA),OPCFOUR(RWKAREA)        S22024 27160022
         SR    RRLN,RRLN           CLEAR REGISTER                       27200022
         IC    RRLN,OCRLN          GET RLN FORM OPC ELEMENT             27400022
         SLL   RRLN,OPCTWO              MULTIPLY RLN BY FOUR            27600022
         L     RINV,DCBINVLI-4(RRLN)    GET LIST ADDR                   27800022
         LA    RLIST,OPCSEVEN(,RINV)     GET LIST Q CONTROL FIELDS      28000022
         L     RWKAREA,OPCWORK     GET ADDR OF OPC WORKAREA             28200022
         SR    RACT,RACT                CLEAR                           28400022
         IC    RACT,OPCONE(RINV)        GET ACTIVE                      28600022
         TM    OCSWITCH,ACTIND     DISPLAY ACT OR INACT                 28800022
         BO    ACT                 ACTIVE COMMAND                       29000022
*                                                                       29200022
         SR    R1,R1                    CLEAR                           29400022
         LR    R0,RACT                  GET NUMBER ACTIVE               29600022
         IC    R1,OPCTWO(RINV)          GET ENTRY WIDTH                 29800022
         MR    R0,R0                    DETRMINE END OF ACT             30000022
         AR    RLIST,R1                 GET INACT INDICATOR             30200022
         LA    RLIST,OPCONE(,RLIST)     GET TO FIRST INACT              30400022
         TM    OPCTHREE(RINV),EOTENTRY    BSC LIST                      30600022
         BZ    CKINACT                  NO - PROCEED                    30800022
*                                                                       31000022
         LA    RLIST,OPCONE(RLIST)       GET PAST EOT                   31200022
CKINACT  EQU   *                                                        31400022
         LA    R1,FULLAMSG              GET ADDR OF MSG          S22024 31600022
         BAL   RRETURN,MOVEAMSG         MOVE MSG TO WORK AREA    S22024 31800022
         SR    RWORK,RWORK              CLEAR                           32000022
         IC    RWORK,OPCZERO(,RINV)     GET TOTAL ENTRIES               32200022
         SR    RWORK,RACT               SUBTRACT ACTIVE                 32400022
         BNZ   GETENTRY                 INACTIVE ENTREIS - GO PROC      32600022
*                                                                       32800022
NOINAMSG EQU   *                                                 S22024 32900022
         LA    R1,NOINA            GET ADDR OF MSG                      33000022
         BAL   RRETURN,MOVEAMSG    PREPARE TO MOVE MSG TO WKAREA        33200022
         TM    OCSWITCH,NORLN      RLN SPECIFIED                        33400022
         BNO   EXIT                LINE ADDR ONLY                       33600022
         BAL   RRETURN,GETRLN      GRPNAME/RLN SPECIFIED                33800022
         B     EXIT                     GET OUT                         34000022
         SPACE 2                                                        34005000
GET3705  EQU   *                                               @YM07289 34010000
         SR    RPARM,RPARM              CLEAR FOR IC           @YM07289 34015000
         IC    RPARM,DCBEIOBX           GET OFFSET TO LCB      @YM07289 34020000
         AL    RPARM,DCBIOBAD           GET IOB ADDRESS        @YM07289 34025000
         LH    RPARM,LCBTTCIN-LCBFLAG1(RPARM) GET 3705 TTCIN   @YM07289 34030000
         L     RLINK,AVTRNMPT           TERM ENTRY LOOKUP CODE @YM07289 34035000
         BALR  RRET,RLINK               GET TERM ENTRY ADDRESS @YM07289 34040000
         LR    RDCB,RPARM               SET TERM ENTRY BASE    @YM07289 34045000
         XC    OCLINK,OCLINK            INDICATE TERM INPUT    @YM07437 34046000
         SPACE 2                                                        34050000
ACT3     EQU   *                                                 S22024 34060022
         USING IEDNTRM,RTERMNAL         EST. ADDRESSABILITY    @Y17XARR 34061000
         LR    RTERMNAL,RDCB            SETUP INPUT            @Y17XARR 34062000
         LA    RWORK,TRMPRFSZ           GET PREFIX LENGTH      @Y17XARR 34063000
         SR    RTERMNAL,RWORK           BACKUP TO PREFIX       @Y17XARR 34064000
         TM    TRMSTATE,TRMPREF         IS THIS  3705 RESOURCE @Y17XARR 34065000
         BZ    INVALID                  BRANCH TO PUT OUT      @Y17XARR 34066000
*                                       INVALID MESSAGE        @Y17XARR 34067000
         ST    RTERMNAL,OCELEM          SAVE PTR TO TTE PRFIX  @Y17XARR 34068000
         CLI   TRMTYPE,TRMLNCP          NCP?                   @Y17XARR 34069000
         BE    DSPLYLGB                 YES, DISPLAY LINES     @Y17XARR 34070000
         TM    TRMSTATE,TRMLINE         LINE?                  @Y17XARR 34071000
         BO    DSPLYLGB                 DISPLAY TERMINALS      @Y17XARR 34072000
         CLI   TRMTYPE,TRMPUNT          PU?                    @Y17XARR 34073000
         BNE   INVALID                  INVALID INPUT          @Y17XARR 34074000
DSPLYLGB EQU   *                                               @Y17XARR 34075000
         XC    OPCFLAG2,OPCFLAG2        CLEAR FLAG FOR LINE    @OY20584 34076082
         XC    OPCFLAG1,OPCFLAG1        CLEAR FLAG FOR CLSTR   @OX20443 34077082
         MVI   OPCFOUR(RWKAREA),BLANK   BLANK WORK AREA          S22024 34080022
         MVC   OPCFOUR+ONE(L256,RWKAREA),OPCFOUR(RWKAREA)        S22024 34100022
         OI    OCSWITCH,OCX01           3705 CMD FLAG            S22024 34120022
         LA    R1,NOINA                 SET INACTIVE MSG         S22024 34140022
         TM    OCSWITCH,ACTIND          ACTIVE ENTRIES CMD ?     S22024 34160022
         BZ    MOVEMSG1                 NO, SET UP FOR MSG       S22024 34180022
ACT      EQU   *                                                        34200022
         LA    R1,FULLAMSG              ADDR OF MSG              S22024 34600022
MOVEMSG1 EQU   *                                                 S22024 34660022
         LA    RRETURN,ACTCMD           PREPARE FOR BRANCH       S22024 34720022
MOVEAMSG SR    RWORK5,RWORK5       CLEAR REGISTER                       34800022
         IC    RWORK5,LENOFF(R1)     GET LENGTH OF SMG                  35000022
         STH   RWORK5,LENOFF(RWKAREA) STORE LENGTH IN WORKAREA          35200022
         BCTR  RWORK5,ZERO              DECREMENT FOR EXECUTE           35400022
         EX    RWORK5,MOVEMSG      MOVE MSG INTO WORKAREA               35600022
         MVC   AMSG1(OPCEIGHT,RWKAREA),OCBACKUP INSERT NAME INTO MSG    35800022
         BR    RRETURN             RETURN TO CALLING CODE               36000022
ACTCMD   TM    OCSWITCH,NORLN      JRLN SPECIFIED                       36200022
         BNO   ACT1                LINE ADDRESS ONLY                    36400022
         BAL   RRETURN,GETRLN      GET RLN PUT IN MSG                   36600022
ACT1     EQU   *                                                        36800022
         MVC   OPCSAVE,OCELEM           SAVE ORIGINAL INPUT    @Y17XARR 36850000
         MVC   OPCSAVE+FRSTWORD,OCLINK  SAVE INDICATOR TO      @Y17XARR 36900000
*                                       DISTINGUISH            @Y17XARR 36950000
         LA    RMSG,AMSG2(RWKAREA) GET MSG ADDRRESS                     37000022
         ST    RMSG,OCLINK         SAVE IT                              37400022
         LA    RMSG,AMSG3(RWKAREA) GET ADDR OF END OF MSG               37800022
         ST    RMSG,OCELEM         SAVE IT                              38000022
         CLC   OPCSAVE+FRSTWORD,FULLZERO WAS ORIG INPUT A TTE? @YM06500 38000600
         BE    TTEDSPLY                 YES, BRANCH TO PROCESS @Y17XARR 38001200
*                                       TTE DISPLAY            @Y17XARR 38001800
         TM    DCBDSORG,TXLGB           LGB?                     S22024 38002400
         BO    DSPLYGRP                 PROCESS GROUP            S22024 38003000
NORMAL   EQU   *                                                 S22024 38160022
         LTR   RACT,RACT                ANY ACTIVE                      38200022
         BNZ   TESTACT             YES                                  38400022
*                                                                       38600022
         B     ACT2                NO ACTIVE ENTRIES                    38800022
GETRLN   SR    RWORK,RWORK         CLEAR REGISTER                       39000022
         IC    RWORK,OCRLN         GET RLN                              39200022
         CVD   RWORK,OPCDOUBL      COVERT TO DECIMAL                    39400022
         UNPK  OPCDOUBL(OPCTHREE),OPCDOUBL+SIX(OPCTWO)                  39600022
         OI    OPCDOUBL+OPCTWO,FOXZERO INVERT FOR PRINTING              39800022
         MVC   NOACTRLN(OPCTHREE,RWKAREA),OPCDOUBL   INSERT RLN INTO    40000022
*                                  MSG IN WORKAREA                      40200022
         BR    RRETURN             RETURN TO CALLING CODE               40400022
ACT2     EQU   *                                                        40600022
         MVC   MSGOFF(OPCFIVE,RWKAREA),NONE MOVE 'NONE' INTO     S22024 40800000
*                                       THE MESSAGE              S22024 40900000
         MVC   LENOFF(TWO,RWKAREA),NOACTLEN PUT LNGTH IN WRKAREA S22024 41000082
         B     EXIT                PREPARE TO XCTL OUT                  41010082
TTEDSPLY EQU   *                                               @Y17XARR 41020082
         SR    RPARM,RPARM              CLEAR TO PICKUP TNT    @Y17XARR 41030082
*                                       INDEX                  @Y17XARR 41040082
         ICM   RPARM,HALFWORD,TRMSUBST  SUBSTRUCTURE EXIST?    @Y17XARR 41050082
         BZ    NOTACT                   PRINT APPROPRIATE MSG  @Y17XARR 41060082
         LR    RWORK2,RPARM             SAVE TNT INDEX FOR     @Y17XARR 41070082
*                                       GETNAME                @Y17XARR 41080082
         BAL   RRET,GETTRM              GET TTE ADDRESS        @Y17XARR 41090082
         CLI   TRMTYPE,TRMCLUST         CLUSTER?               @OY20584 41100082
         BE    SAVECUPU                 SAVE CLUSTER ADDRESS   @OY20584 41110082
         CLI   TRMTYPE,TRMPULO          PU?                    @OY20584 41120082
         BL    GETTTE                   BYPASS THE CU/PU SAVE  @OY20584 41130082
         CLI   TRMTYPE,TRMPUHI          PU?                    @OY20584 41140082
         BH    GETTTE                   BYPASS THE CU/PU SAVE  @OY20584 41150082
SAVECUPU EQU   *                                               @OY20584 41160082
         ST    RTERMNAL,OPCSAVE+8       SAVE THE PU/CLUSTER    @OY20584 41170082
GETTTE   EQU   *                                               @Y17XARR 41180082
         ICM   RPARM,ADDRESS,OPCSAVE+ADDRDISP GET ORIG INPUT   @Y17XARR 41190082
         CLC   TRMTYPE-IEDNTRM(BYTE,RPARM),TRMTYPE SAME TYPE?  @Y17XARR 41200082
         BE    NXT                      YES, CHECK COMMAND     @Y17XARR 41210082
         ICM   RPARM,ADDRESS,OPCSAVE+5        GET ORIG INPUT   @OY20584 41220082
         CLC   TRMTYPE-IEDNTRM(BYTE,RPARM),TRMTYPE SAME TYPE?  @OY20584 41230082
         BE    NXT                      DO CHECKS              @OY20584 41240082
         CLI   TRMTYPE-IEDNTRM(RPARM),TRMLNCP  NCP ORIG?       @Y17XARR 41250082
         BE    GETGROUP                 YES, CHECK COMMAND     @Y17XARR 41260082
         LA    RRET,GETNEXT             RETURN ADDR IF STATE^=          41270082
*                                       DISPLAY REQUEST        @OY20584 41280082
         CLI   TRMTYPE,TRMPULO          PU?                    @OY20584 41290082
         BL    CHKSTATE                 NO                     @OY20584 41300082
         LA    RRET,NEXTOK              RETURN ADDR IF STATE^=          41310082
*                                       DISPLAY REQUEST        @OY20584 41320082
CHKSTATE EQU   *                                               @OY20584 41330082
         TM    OCSWITCH,ACTIND          ACTIVE COMMAND         @Y17XARR 41403000
         BZ    INACTCMD                 NO,INACTIVE COMMAND    @Y17XARR 41403200
         TM    TRMBYTE2,TRMRSACT        ENTRY ACTIVE?          @Y17XARR 41403400
*                                       TTE FROM LGB           @Y17XARR 41403600
         BNO   GETNEXT                  GET NEXT SUBSTRUCTURE  @Y17XARR 41403800
         OI    OCSWITCH,ONEINMSG        INDICATE ONE MATCH     @Y17XARR 41404000
*                                       FOUND                  @Y17XARR 41404200
         B     GETNAME                  PRINT NAME OF ENTRY    @Y17XARR 41404400
INACTCMD EQU   *                        INACTIVE COMMAND       @Y17XARR 41404600
         TM    TRMBYTE2,TRMRSACT        ENTRY ACTIVE?          @Y17XARR 41404800
         BO    GETNEXT                  GET NEXT SUBSTRUCURE   @Y17XARR 41405000
         OI    OCSWITCH,ONEINMSG        INDICATE ONE MATCH     @Y17XARR 41405200
*                                       FOUND                  @Y17XARR 41405400
         B     GETNAME                  PRINT NAME             @Y17XARR 41405600
GETGROUP EQU   *                                               @Y17XARR 41405800
         TM    OCSWITCH,ACTIND          ACT COMMAND?           @Y17XARR 41406000
         BZ    INACTCOM                 NO,                    @Y17XARR 41406200
         TM    TRMBYTE2,TRMRSACT        ENTRY ACTIVE?          @Y17XARR 41406400
         BO    PRINTGRP                 YES,PRINT GROUP NAME   @Y17XARR 41406600
         B     GETNEXT                  NO, TRY FOR A MATCH FOR@Y17XARR 41406800
*                                       NEXT ENTRY             @Y17XARR 41407000
INACTCOM EQU   *                        INACTIVE COMMAND       @Y17XARR 41407200
         TM    TRMBYTE2,TRMRSACT        ENTRY ACTIVE?          @Y17XARR 41407400
         BZ    PRINTGRP                 NO, PRINT GROUP NAME   @Y17XARR 41407600
GETNEXT  EQU   *                                               @Y17XARR 41407800
         SR    RPARM,RPARM              CLEAR TO GET TNT INDEX @Y17XARR 41408000
         ICM   RPARM,HALFWORD,TRMCOHRT  PICKUP TNT INDEX       @Y17XARR 41408200
         BZ    NXT                      ZERO, CHECK COMMAND    @Y17XARR 41408300
         LR    RWORK2,RPARM             SAVE FOR GETNAME       @Y17XARR 41408400
*                                       ROUTINE                @Y17XARR 41408600
         LA    RRET,GETTTE              SETUP RETURN ADDRESS   @Y17XARR 41408800
         B     GETTRM                   GET TTE ADDRESS        @Y17XARR 41409000
PRINTGRP EQU   *                        PRINT GROUP            @Y17XARR 41409200
         OI    OCSWITCH,ONEINMSG        INDICATE MATCH FOUND   @YM07993 41409300
         MVC   OCMODNME,OPCSAVE         SAVE INPUT(LGB)/TTE    @Y17XARR 41409400
         MVC   OCMODNME+FRSTWORD,OPCSAVE+FRSTWORD  SAVE INPUT  @Y17XARR 41409600
*                                       (ZEROS/LINE TTE)       @Y17XARR 41409800
         LR    RPARM,RTERMNAL           SETUP INTERFACE        @Y17XARR 41410000
*                                       (R1  TTE)              @Y17XARR 41410200
         LA    RPARM,TRMPRFSZ(,RPARM)   POINT TERM ENTRY       @Y17XARR 41410400
         LA    RSAVE,OPCSAVE            SETUP SAVEAREA PTR     @Y17XARR 41410600
         L     RLINK,OPCHORTG           GET ADDRESS OF ROUTINE @Y17XARR 41410800
         BALR  RRET,RLINK               GET GROUP TTE          @Y17XARR 41411000
         LR    RPARM,RZERO              GROUP TNT INDEX        @Y17XARR 41411200
         L     RLINK,OPCTNTEA           GET TERMNAME RTN PTR   @Y17XARR 41411400
         BALR  RRET,RLINK               CALL TNTEA             @Y17XARR 41411600
         MVC   OCBACKUP-IEDQOPCE(8,ROPCE),0(RPARM)             @Y17XARR 41411800
         ICM   RWORK,ADDRESS,TRMDESTQ   GET QCB ADDRESS        @Y17XARR 41412000
         MVC   OCRLN,QCBRELLN-IEDQQCB(RWORK)   MOVE IN OPCE    @Y17XARR 41412200
         MVC   OPCSAVE,OCMODNME         RESTORE THE            @Y17XARR 41412400
         MVC   OPCSAVE+FRSTWORD,OCMODNME+FRSTWORD ORIG INPUT   @Y17XARR 41412600
         SR    RWORK,RWORK              CLEAR FOR CURRENT      @Y17XARR 41412800
*                                       MESSAGE PTR            @Y17XARR 41413000
         ICM   RWORK,ADDRESS,OCLINK+ADDRDISP GET CURRENT MSG   @Y17XARR 41413200
*                                       PTR                    @Y17XARR 41413400
         MVC   ZERO(NAMELEN,RWORK),OCBACKUP MOVE NAME IN MSG   @Y17XARR 41413600
         LA    RWORK,NAMELEN(RWORK)     BUMP PASSED THE NAME   @Y17XARR 41413800
         ST    RWORK,OCLINK             UPDATE MESSAGE PTR     @Y17XARR 41414000
         MVI   ZERO(RWORK),COMMA        PUT A COMMA IN MSG     @Y17XARR 41414200
         LA    RWORK,BYTE(,RWORK)       MSG PTR PASSED ,       @Y17XARR 41414400
         ST    RWORK,OCLINK             UPDATE MSG PTR         @Y17XARR 41414600
         SR    RWORK,RWORK              CLEAR TO PICKUP RLN    @Y17XARR 41414800
         ICM   RWORK,LOWBYTE,OCRLN      GET RLN                @Y17XARR 41415000
         CVD   RWORK,OPCDOUBL           CONVERT TO PRINTABLE   @Y17XARR 41415200
*                                       FORM                   @Y17XARR 41415400
         UNPK  OPCDOUBL(LEN),OPCDOUBL+OFFSET(LENGTH) UNPACK    @Y17XARR 41415600
         OI    OPCDOUBL+LENGTH,SIGN     INVERT LAST CHAR       @Y17XARR 41415800
*                                       TO PRINT               @Y17XARR 41416000
         L     RWORK,OCLINK             GET MSG POINTER        @Y17XARR 41416100
         MVC   ZERO(LEN,RWORK),OPCDOUBL MOVE RLN IN MSG        @Y17XARR 41416200
         LA    RWORK,MSGRLN(,RWORK)     BUMP PASSED RLN        @Y17XARR 41416300
         ST    RWORK,OCLINK             UPDATE MSG POINTERS    @Y17XARR 41416400
         L     RWORK5,OCELEM            END OF MSG AREA        @XM05730 41416500
         CR    RWORK,RWORK5             AT END    ??           @XM05730 41416600
         BNL   NXT                      YES                    @XM05730 41416700
         B     GETNEXT                  GET NEXT ENTRY         @Y17XARR 41416800
DSPLYGRP EQU   *                        GROUP DISPLAY REQUEST  @Y17XARR 41417200
         L     RTERMNAL,OPCSAVE+FRSTWORD  GET LINE TTE         @Y17XARR 41417400
         LA    RPARM,TRMPRFSZ           GET PREFIX LENGTH      @Y17XARR 41417600
         SR    RTERMNAL,RPARM           BACKUP TO PREFIX       @Y17XARR 41417800
         ST    RTERMNAL,OPCSAVE+FRSTWORD   SAVE TTE            @Y17XARR 41418000
         SR    RPARM,RPARM              CLEAR TO PICKUP TNT    @Y17XARR 41418200
*                                       INDEX                  @Y17XARR 41418400
         ICM   RPARM,HALFWORD,TRMSUBST  DOES SUBSTRUCTURE      @Y17XARR 41418600
*                                       EXIST?                 @Y17XARR 41418800
         BZ    NOTACT                   NO SUB                 @OY20584 41419082
         BAL   RRET,GETTRM              GET TTE ADDRESS        @OY20584 41420082
         CLI   TRMTYPE,TRMCLUST         CLUSTER?               @OY20584 41421082
         BE    SAVETTE                  SAVE CLUSTER ADDRESS   @OY20584 41422082
         CLI   TRMTYPE,TRMPULO          PU?                    @OY20584 41423082
         BL    SETTTE                   RESET THE LINE INDEX   @OY20584 41424082
         CLI   TRMTYPE,TRMPUHI          PU?                    @OY20584 41425082
         BH    SETTTE                   RESET THE LINE INDEX   @OY20584 41426082
SAVETTE  EQU   *                                               @OY20584 41427082
         ST    RTERMNAL,OPCSAVE+8       SAVE THE PU/CLUSTER    @OY20584 41428082
SETTTE   EQU   *                                               @OY20584 41429082
         SR    RTERMNAL,RTERMNAL        CLEAR FOR ICM          @OY20584 41430082
         ICM   RTERMNAL,ADDRESS,OPCSAVE+5 RESTORE LINE TTE     @OY20584 41431082
         SR    RPARM,RPARM              CLEAR TO PICKUP TNT    @OY20584 41432082
*                                       INDEX                  @OY20584 41433082
         ICM   RPARM,HALFWORD,TRMSUBST  DOES SUBSTRUCTURE      @OY20584 41434082
*                                       EXIST?                 @OY20584 41435082
         XI    OPCFLAG2,PRTFLG          LINE IS USED ONCE      @OY20584 41436082
         B     SUBENTRY                 GET ALL THE SUBS       @OY20584 41437082
NOTACT   EQU   *                                               @OY20584 41438082
         TM    OCSWITCH,ACTIND          ACTIVE COMMAND?          S22024 41440022
         BO    ACT2                     BRANCH ON YES            S22024 41460022
         MVI   AMSGL6(RWKAREA),CSEVEN   CHANGE MESSAGE NUMBER    S22024 41480022
         MVC   AMSG1A(NINE,RWKAREA),INACTIVE CHANGE TO INACTIVE  S22024 41500022
         MVC   AMSG23(THREE,RWKAREA),ALL ALL ENTRIES INACTIVE    S22024 41520022
         MVC   LENOFF(TWO,RWKAREA),ALLINACT PUT LNGTH IN WRKAREA S22024 41540022
         B     EXIT                     PREPARE TO XCTL          S22024 41560022
SUBENTRY EQU   *                                               @Y17XARR 41561000
         LR    RWORK2,RPARM             SAVE TNT INDEX FOR     @Y17XARR 41562000
*                                       GETNAME                @Y17XARR 41563000
         BAL   RRET,GETTRM              GET TTE ADDRESS        @Y17XARR 41564000
CHKMATCH EQU   *                                               @Y17XARR 41565000
         CLM   RTERMNAL,ADDRESS,OPCSAVE+OPCFIVE  ORIG INPUT?   @YM06500 41565500
         BE    NXT                      YES,                   @Y17XARR 41567000
         CLI   TRMTYPE,TRMPULO          PU?                    @OY20584 41567182
         BL    CMMDTYPE                 SKIP TST FOR  CLUSTER  @OY20584 41567282
         CLI   TRMTYPE,TRMPUHI          PU?                    @OY20584 41567382
         BNH   TSTPRTFG                 CHECK FOR PRINTED ALRDY@OY20584 41567482
         TM    TRMSTATE,TRMLINE         LINE ENTRY?            @OY20584 41567582
         BO    TSTLNPRT                 CHECK FOR PRT ALREADY  @OY20584 41567682
         CLI   TRMTYPE,TRMCLUST         PRE-SNA CLUSTER        @OX20443 41567782
         BNE   CMMDTYPE                 CONTINUE, NORMAL PATH  @OX20443 41567882
TSTPRTFG EQU   *                                               @OY20584 41567982
         XI    OPCFLAG1,PRTFLG          RESET PRINTED FLAG     @OX20443 41568082
         TM    OPCFLAG1,PRTFLG          TEST SETTING OF FLAG   @OX20443 41568182
         BZ    NEXTOK                   ALREADY PRINTED CLUSTER@OX20443 41568282
CMMDTYPE EQU   *                                                        41568382
         LA    RRET,NEXTOK              RETURN ADDR IF FALSE   @OY20584 41568482
         TM    OCSWITCH,ACTIND          ACTIVE COMMAND?        @Y17XARR 41569000
         BZ    TESTACT1                 NO, TEST STATUS OF TERM@Y17XARR 41570000
         TM    TRMBYTE2,TRMRSACT        ENTRY ACTIVE?          @Y17XARR 41571000
         BZ    GETNXTTE                 NO,GET NEXT ADJACENT   @Y17XARR 41572000
*                                       ENTRY                  @Y17XARR 41573000
         OI    OCSWITCH,ONEINMSG        INDICATE MATCH FOUND   @Y17XARR 41574000
         B     GETNAME                  GET NAME TO PRINT      @Y17XARR 41575000
TSTLNPRT EQU   *                                               @OY20584 41575182
         CLC  OPCSAVE+FRSTWORD,FULLZERO WAS TTE THE ORIG INPUT @OY20584 41575282
         BE    CMMDTYPE                 NO NEED TO RESET/SET FG@OY20584 41575382
         XI    OPCFLAG2,PRTFLG          RESET PRINT FLAG       @OY20584 41575482
         TM    OPCFLAG2,PRTFLG          IS IT SET?             @OY20584 41575582
         BZ    NEXTOK                   CONTINUE IF NOT DONE   @OY20584 41575682
         B     CMMDTYPE                 CAN BE PUT IN THE MSG           41575782
*                                       IF STATE = DSPLY TYPE  @OY20584 41575882
TESTACT1 EQU   *                                               @Y17XARR 41576000
         TM    TRMBYTE2,TRMRSACT        ENTRY ACTIVE?          @Y17XARR 41577000
         BO    GETNXTTE                 YES,GET NEXT ADJACENT  @Y17XARR 41578000
*                                       ENTRY                  @Y17XARR 41579000
         OI    OCSWITCH,ONEINMSG        INDICATE MATCH FOUND   @Y17XARR 41580000
         B     GETNAME                  GET NAME TO PRINT      @Y17XARR 41581000
*                                                                       41600022
GETENTRY EQU   *                                                        41800022
         IC    RACT,OPCZERO(,RINV)      GET TOTAL ENTRIES               42000022
         SR    R0,R0                    CLEAR                           42200022
         IC    R0,OPCONE(,RINV)         GET NUMBER ACTIVE               42400022
         SR    RACT,R0                  SUBTRACT ACTIVE                 42600022
         MVI   AMSGL6(RWKAREA),CSEVEN  CHANGE MSG ID                    42800022
         MVC   AMSG1A(NINE,RWKAREA),INACTIVE  CHANGE TO 'INACTIVE'      43000022
         MVC   AMSG1(OPCEIGHT,RWKAREA),OCBACKUP INSERT NAME INTO MSG    43200022
         TM    OCSWITCH,NORLN      RLN SPECIFIED                        43400022
         BNO   GTENTRY1            LINE ADDRESS SPECIFIED               43600022
         BAL   RRETURN,GETRLN      GRPNAME/RLN SPECIFIED                43800022
GTENTRY1 EQU   *                                                        44000022
         LA    RMSG,AMSG2(RWKAREA) GET MSG ADDR OF 1ST GOOD FIELD       44200022
         ST    RMSG,OCLINK         SAVE IT                              44600022
         LA    RMSG,AMSG3(RWKAREA)     GET ADDR OF END OF MSG           45000022
         ST    RMSG,OCELEM         SAVE IT                              45200022
TESTACT  EQU   *                                                        45400022
PROCLOOP EQU   *                                                        46000022
         SR    R0,R0                     CLEAR                          46200022
         IC    R0,OPCTWO(RINV)           GET ENTRY WIDTH                46400022
COMCD    EQU   *                                                        46800022
         AR    RLIST,R0                 ADD WIDTH TO START              47000022
         SR    RWORK3,RWORK3            CLEAR                           47200022
         IC    RWORK3,OPCZERO(RLIST)    PICK UP K                       47400022
         SLL   RWORK3,OPCONE            MULTIPLY BY 2                   47600022
         LR    RWORK2,RINV              PUT LIST START IN WORK          47800022
         SR    RWORK2,RWORK3            DECREMENT TO TNT OFFSET         48000022
         LH    RWORK2,OPCZERO(,RWORK2)  PICK UP TNT OFFSET              48200022
GETNAME  EQU   *                                                 S22024 48300022
         LR    RWORK3,RWORK2            SAVE                            48400022
         SR    RWORK5,RWORK5            CLEAR                           48600022
         L     RAVT,OPCAVTPT            GET AVT ADDRESS          S22024 48650022
         L     RTNT,AVTRNMPT            GET TERMNAME TABLE       S22024 48700022
         USING IEDQTNTD,RTNT            TNT ADDRESSABILITY       S22024 48750022
         IC    RWORK5,TNTENLEN          PICK UP TNT ENTRY LENGTH        48800022
         LA    RWORK5,OPCTHREE(RWORK5)  PAST ADDR                       49000022
         LA    RWORK6,TNTFIRST          TO FIRST ENTRY ADDR             49200022
         SR    RWORK6,RWORK5            DECREMENT TO ENTRY-1            49400022
         MR    RWORK5,RWORK5            MULT TNT BY OFFSET              49600022
         AR    RWORK6,RWORK3            GET TERM NAME                   49800022
         L     RWORK,OCLINK        GET MSG ENTRY                        50000022
         SR    RWORK5,RWORK5            CLEAR                           50200022
         IC    RWORK5,TNTENLEN          LENGTH OF ENTRY                 50400022
         MVC   ZERO(FOUR,RWORK),BLANKS  CLEAR FIELD            @OZ29946 50450082
         BCTR  RWORK5,R0                DECREMENT FOR EXECUTE           50600022
         EX    RWORK5,MVC               MOVE ENTRY TO MSG               50800022
         LA    RWORK,OPCNINE(RWORK)     BUMP MSG ADDR                   51000022
         ST    RWORK,OCLINK        SAVE IT                              51400022
         SPACE                                                          51800022
* THE CODE FROM THIS POINT TO THE LABEL TESTEND IS USED TO              52000022
* DETERMINE WHETHER OR NOT A TSO SESSION IS IN PROGRESS , AND           52200022
* IF SO TO DISPLAY THE USERID.                                          52400022
         SPACE                                                          52600022
* BECAUSE OF THEIR USE IN THE NEXT FOUR INSTRUCTIONS, R1, RWORK5,       52800022
* AND RWORK3 MUST ALWAYS REMAIN EQUATED TO REGISTERS 1, 14, AND         53000022
* 15 RESPECTIVELY.                                                      53200022
         SPACE                                                          53400022
         LR    R1,RWORK2                PASS TNT OFFSET AS PARAM        53600022
         LR    RWORK3,RTNT              GET TERMNAME TABLE ADDR         53800022
         BALR  RWORK5,RWORK3            GO GET TERMINAL TABLE ADDR      54000022
         SPACE                                                          54200022
         USING IEDQTRM,R1               ADDRESSABILITY FOR TERM TAB     54400022
         L     RWORK3,TRMDESTQ-ONE      GET DESINATION QCBADDR          54600022
         USING IEDQQCB,RWORK3           ADDRESSABILITY FOR QCB          54800022
         TM    QCBFLAG,QCBTSSES         IS TSO SESSION IN PROGRESS?     55000000
         BZ    TESTEND                  NO, GO TEST FOR END OF MSG      55200000
         SPACE                                                          55400022
         TM    QCBTSOF1,QCBDELAY        IS QCB ON TIME DELAY QUEUE?     55700000
         BO    ONDELAYQ                 YES GET ASID           @G36XAYF 56000000
         SPACE                                                          56300000
         LH    RWORK3,QCBTJID           GET ASID               @G36XAYF 56600000
         B     HAVETJID                 BRANCH AROUND DELAY Q CODE      56900000
         SPACE                                                          57200000
ONDELAYQ EQU   *                                                        57500000
         LH    RWORK3,QCBLINK+ONE       GET ASID               @G36XAYF 57800000
HAVETJID EQU   *                                                        58100000
         L     RWORK5,CVTPTR            GET CVT ADDR           @G36XAYF 58400000
         USING CVT,RWORK5                                      @G36XAYF 58700000
         L     RWORK5,CVTASVT           GET ASVT ADDR          @G36XAYF 59000000
         DROP  RWORK5                                          @G36XAYF 59300000
         USING ASVT,RWORK5                                     @G36XAYF 59600000
         LA    RWORK5,ASVTENTY          GET ADDR ASCB LIST     @G36XAYF 59900000
         BCTR  RWORK3,ZERO              DECR FOR ZERO          @G36XAYF 60200000
         SLL   RWORK3,2                 MULTIPLY BY FOUR       @G36XAYF 60500000
         L     RWORK5,AVTEZERO(RWORK3,RWORK5) GET ASCB ADDR    @G36XAYF 60800000
         DROP  RWORK5                                          @G36XAYF 61100000
         USING ASCB,RWORK5                                     @G36XAYF 61400000
         L     RWORK5,ASCBCSCB          GET CSCB ADDR          @G36XAYF 61700000
         DROP  RWORK5                                          @G36XAYF 62000000
         USING CSCB,RWORK5                                     @G36XAYF 62300000
         MVI   TSZERO(RWORK),LPAREN     PAREN TO INDICATE TSO USER      62600000
         MVC   TSONE(TSEIGHT,RWORK),CHKEY MOVE USERID TO MSG   @G36XAYF 62900000
         MVI   TSNINE(RWORK),RPAREN     INDICATE END OF USERID          63200000
         B     INUSE                                           @OZ31728 63250082
         DROP  RWORK5                                          @G36XAYF 63500000
         SPACE 3                                                        63800000
CMDINACT EQU   *                                                 S22024 66440022
         TM    OCSWITCH,ACTIND          CMD INACTIVE ?           S22024 66460022
         BO    GETNEXT                  NO-GET NEXT ENTRY IN TBL S22024 66480022
         OI    OCSWITCH,OCX02           GOT TERMINAL             S22024 66500022
         B     GETNAME                  PUT NAME IN MSG          S22024 66520022
         SPACE                                                          66600022
INUSE    EQU   *                                                        66800022
         LA    RWORK,TSELEVEN(RWORK)    YES, BUMP MSG ADDR              67000022
         ST    RWORK,OCLINK             SAVE MSG POINTER        SA68709 67200005
TESTEND  EQU   *                                                        67400022
         L     RWORK5,OCELEM            GET END OF MSG AREA    @XM05730 67410000
         CR    RWORK,RWORK5             AT END ?               @XM05730 67420000
         BNL   NXT                      YES                    @XM05730 67430000
         TM    OCSWITCH,OCX01           3705 COMMAND             S22024 67460022
         BZ    CMD270X                  NO, 270X DISPLY COMMAND@Y17XARR 67464000
GETNXTTE EQU   *                                               @YM06476 67466000
         LA    RRET,CHKMATCH            GETNEXT FOR DSPLYGRP   @Y17XARR 67468000
         OC    OPCSAVE+FRSTWORD,OPCSAVE+FRSTWORD LGB INPUT?    @YM07661 67472000
         BNZ   NEXTOK                   YES, CHKMATCH IS OK    @YM06476 67474000
         LA    RRET,GETTTE              GETNEXT FOR TTE        @OY20584 67480082
NEXTOK   EQU   *                                               @OY20584 67480282
         TM    TRMSTATE,TRMLINE        LINE?                   @OY20584 67480482
         BNO   TESTTYPE                TEST FOR OTHERS         @OY20584 67480682
         CLC   OPCSAVE+FRSTWORD,FULLZERO ORIGINAL INPUT A TTE? @OY20584 67480882
         BE    NXTCONT                 YES                     @OY20584 67481082
         XI    OPCFLAG2,ONELINE         RESET IF ON            @OY20584 67481282
         TM    OPCFLAG2,ONELINE         FLAG=ONE ?             @OY20584 67481482
         BZ    TESTORIG                 NO, CHECK FOR ORIGINAL @OY20584 67481682
         B     GETSUB                   GET SUB                @OY20584 67481882
TESTTYPE EQU   *                                               @OY20584 67482082
         CLI   TRMTYPE,TRMPULO          PU?                    @OY20584 67482282
         BL    NXTCONT                  NO, CONTINUE           @OY20584 67482482
         CLI   TRMTYPE,TRMPUHI          PU?                    @OY20584 67482682
         BNH   SETPRT                   YES                    @OY20584 67482882
         CLI   TRMTYPE,TRMCLUST         SUBSTR PRE-SNA CLSTR   @OX20443 67484482
         BNE   NXTCONT                  NO,CONTINUE            @OX20443 67484682
SETPRT   EQU   *                                               @OY20584 67484982
         XI    OPCFLAG1,ONEFLG          RESET FLAG             @OX20443 67485282
         TM    OPCFLAG1,ONEFLG          FLAG=ONE ?             @OX20443 67485682
         BZ    NXTCONT                  NO, NEED TO GET COHORT @OX20443 67486082
GETSUB   EQU   *                                               @OY20584 67486182
         SR    RPARM,RPARM              CLEAR REGISTER         @OX20443 67486282
         ICM   RPARM,HALFWORD,TRMSUBST  GET TERMINAL UNDER     @OX20443 67486482
*                                       PRE-SNA CLUSTER        @OX20443 67486882
         BNZ   SUBENTRY                 CONT AS OTHER SUBENTRY @OX20443 67487282
NXTCONT  EQU   *                                                        67487682
         SR    RPARM,RPARM              CLEAR TO PICKUP TNT    @Y17XARR 67488000
*                                       INDEX                  @Y17XARR 67492000
         ICM   RPARM,HALFWORD,TRMCOHRT  GET INDEX              @Y17XARR 67496000
         BZ    NXT                      ZERO COHORT MEANS END  @YM06476 67498000
         LR    RWORK2,RPARM             SAVE FOR GETNAME       @Y17XARR 67500000
*                                       ROUTINE                @Y17XARR 67504000
         BAL   RRET,GETTRM              GET TTE ADDRESS        @OY20584 67512082
TESTORIG EQU   *                                               @OY20584 67512182
         CLM   RTERMNAL,ADDRESS,OPCSAVE+1 ORIGINAL TTE?        @OY20584 67512282
         BE    NXT                      YES,GET OUT            @OY20584 67512382
         CLM   RTERMNAL,ADDRESS,OPCSAVE+5 ORIGINAL TTE A GRP,RLN?       67512482
*                                                              @OY20584 67512582
         BE    NXT                      YES, GET OUT           @OY20584 67512682
         CLI   TRMTYPE,TRMCLUST         CLUSTER?               @OY20584 67512782
         BE    NXTENTRY                 YES                    @OY20584 67512882
         LA    RRET,CHKMATCH            SETUP TO BRANCH TO RIGHT        67512982
*                                       ROUTINE FOR GROUP ENTRY@OY20584 67513082
         CLI   TRMTYPE,TRMPULO          PU?                    @OY20584 67513182
         BLR   RRET                     NO,                    @OY20584 67513282
         LA    RRET,GETTTE              BRANCH TO RIGHT ROUTINE         67513382
*                                       TERMINAL INPUT         @OY20584 67513482
         CLI   TRMTYPE,TRMPUHI          PU?                    @OY20584 67513582
         BHR   RRET                     NO                     @OY20584 67513682
NXTENTRY EQU   *                                               @OY20584 67513782
         SR    RPARM,RPARM              CLEAR                  @OY20584 67513882
         ICM   RPARM,HALFWORD,TRMCOHRT  GET NEXT ADJACENT      @OY20584 67513982
         BZ    NXT                      NO COHORT              @OY20584 67514082
         LR    RWORK2,RPARM             SAVE FOR TSO SCAN      @OY20584 67514182
         BAL   RRET,GETTRM              GET THE TTE            @OY20584 67514282
         CLM   RTERMNAL,ADDRESS,OPCSAVE+1 ORIGINAL TTE?        @OY20584 67514382
         BE    NXT                        YES,GET OUT          @OY20584 67514482
         CLM   RTERMNAL,ADDRESS,OPCSAVE+5 ORIGINAL TTE A GRP,RLN?       67514582
*                                                              @OY20584 67514682
         BE    NXT                        YES, GET OUT         @OY20584 67514782
         CLM   RTERMNAL,ADDRESS,OPCSAVE+9 BACK TO PU/CLUSTER   @OY20584 67514882
         BE    NXTENTRY                   BUMP TO THE NEXT     @OY20584 67514982
         ST    RTERMNAL,OPCSAVE+8         SAVE THE NEXT PU/CU  @OY20584 67515082
         XC    OPCFLAG1,OPCFLAG1         CLEAR FOR THIS PU/CU  @OY20584 67515182
         B     CHKMATCH                  NO GET THE NEXT       @OY20584 67515282
CMD270X  EQU   *                                               @Y17XARR 67516000
         L     RWORK5,OCELEM       GET END OF MSG                       67600022
         CR    RWORK,RWORK5             AT END                          67800022
         BNL   NXT                      YES, BRANCH                     68000022
*                                                                       68200022
         BCT   RACT,PROCLOOP            CONTINUE BCT LOOP               68400022
*                                                                       68600022
NXT      EQU   *                                                        68800022
         TM    OCSWITCH,OCX01           3705 CMD ?               S22024 68820022
         BNO   CONTINUE                 NO                       S22024 68840022
         TM    OCSWITCH,OCX02           ANY TERM IN MSG ?        S22024 68860022
         BO    CONTINUE                 YES- PREPARE TO EXIT     S22024 68880022
         TM    OCSWITCH,ACTIND          ACTIVE CMD ?             S22024 68900022
         BO    ACT2                     ACTIVE                   S22024 68920022
         B     NOINAMSG                 NO- INSERT INACTIVE      S22024 68940022
CONTINUE EQU   *                                                 S22024 68960022
         LR    RAVT,RWKAREA        SAVE ADDR OF OPC WORKAREA            69000022
         LA    RWKAREA,OPCFOUR(RWKAREA) UP PTR BY FOUR TO GET TO        69200022
*                                  THE START OF THE MSG                 69400022
         SR    RWORK,RWKAREA       CALCULATE LENGTH OF MSG              69600022
         STH   RWORK,LENOFF(RAVT)  INSERT INTO WORAAREA LENGTH          69800022
EXIT     EQU   *                                                        70000022
         MVC   OPCLDNME+OPCTHREE(OPCTWO),MSGWRIT MOVE ID OF IGC0710D    70200022
XCTL     EQU   *                                                 S22024 70250022
         XC    OCPARM(FOUR),OCPARM      ZERO OUT WTG AND PARAMETER      70300022
*                                       FIELDS                          70400022
         LR    RPARM,ROPCAVT       SETUP PARAMETER REGISTER             70600022
         L     RAVT,OPCAVTPT       REESTABLISH ADDR OF AVT              70800022
         XCTL  SF=(E,OPCXCTL)      XCTL TO IGC0710D                     71000022
INVALID  EQU   *                                                 S22024 71040022
         MVC   OPCLDNME+OPCTHREE(OPCTWO),ERRMSG MODULE ID        S22024 71080022
         LA    RZERO,MSG018             ERROR MSG NUMBER       @YM07289 71120000
         B     XCTL                     GO TO ERROR MSG MODULE   S22024 71160022
GETTRM   EQU   *                                               @Y17XARR 71163000
         LR    RSAVER14,RRET            SAVE REGISTER 14       @Y17XARR 71166000
         L     RAVT,OPCAVTPT            GET AVT POINTER        @Y17XARR 71169000
         L     RLINK,AVTRNMPT-IEDQAVTD(RAVT) GET TNT BASE      @Y17XARR 71172000
         BALR  RRET,RLINK               GET TTE ADDRESS        @Y17XARR 71175000
         LR    RTERMNAL,RPARM           GET TTE ADDRESS        @Y17XARR 71178000
         LA    RPARM,TRMPRFSZ           GET PREFIX LENGTH      @Y17XARR 71181000
         SR    RTERMNAL,RPARM           BACKUP TO PREFIX       @Y17XARR 71184000
         LR    RRET,RSAVER14            GET RETURN ADDRESS     @Y17XARR 71187000
         BR    RRET                     RETURN TO CALLER       @Y17XARR 71190000
         EJECT                                                          71200022
*                                                                       71400022
*        M I S C E L L A N E O U S   E Q U A T E S                      71600022
*                                                                       71800022
TSZERO   EQU   0                        DISPL TO MOVE LPAREN INTO       72000022
*                                       MSG AND TO CLEAR HI ORDER       72200022
*                                       BYTE IN LOAD ADDR INST          72400022
TSONE    EQU   1                        DISPL TO MOVE USERID AND TO     72600022
*                                       RESET MSG PTR IN ERASE CODE     72800022
TSTHREE  EQU   3                        LENGTH USED IN ADDR COMPARE     73000022
TSEIGHT  EQU   8                        LENGTH TO MOVE USERID           73200022
TSNINE   EQU   9                        DISPL TO MOVE RPAREN            73400022
TSTEN    EQU   10                       LENGTH USED TO ERASE USERID     73600022
TSELEVEN EQU   11                       DISPL TO BUMP MSG ADDR          73800022
TS16     EQU   16                       DISPL INTO SAVE AREA FOR        74000022
*                                       WORD CONTAINING REGISTER 15     74200022
*                                       WHICH IS NOT RESTORED UPON      74400022
*                                       RETURN.                         74600022
ZERO     EQU   0                        VALUE ZERO                      74640022
ONE      EQU   1                        VALUE ONE                       74680022
SIX      EQU   6                        VALUE SIX                       74720022
THREE    EQU   3                        VALUE THREE                     74760022
TSHEX3   EQU   X'03'                    TO TEST FOR FULLWORD BDY        74800022
LPAREN   EQU   C'('                     INDICATES TSO USERID            75000022
RPAREN   EQU   C')'                     INDICATES END OF TSO USERID     75200022
*                                                                       75400022
ACTIND   EQU   X'80'                    FLAG                     S22024 75600000
ONEINMSG EQU   X'02'                    FOUND AT LEAST ONE     @Y17XARR 75660000
*                                       STATION TO PRINT       @Y17XARR 75720000
EOTENTRY EQU   X'80'                    FLAG                     S22024 75800000
NOACT1   EQU   12                  OFFSET FOR NAME IN MSG               76000022
AMSG1    EQU   12                  OFFSET IN NOACT MSG FOR NAME         76200022
NORLN    EQU   X'40'               IF SET NO RLN IN CMD                 76400022
AMSG2    EQU   35                  START OF ACTIVE ENTRIES IN MSG       76600022
AMSG3    EQU   544                 END OF ACTVE ENTRIES IN MSG @OZ14169 76800000
OPCEIGHT EQU   8                   OFFSET                               77000022
OPCTHREE EQU   3                   OFFSET                               77200022
OPCZERO  EQU   0                   OFFSET                               77400022
OPCONE   EQU   1                   OFFSET                               77600022
OPCTWO   EQU   2                   OFFSET                               77800022
OPCNINE  EQU   9                   OFFSET                               78000022
OPCFIVE  EQU   5                        OFFSET                   S22024 78050000
MSGOFF   EQU   34                       OFFSET TO POSITION OF    S22024 78100000
*                                       'NONE' IN THE MSG        S22024 78150000
OFFSET   EQU   6                        INDEX IN UNPACK WRKAREA@Y17XARR 78170000
OPCFOUR  EQU   4                   OFFSET                               78200022
AMSGL6   EQU   9                   OFFSET IN MSG FOR NEW MSG ID         78400022
OPCSEVEN EQU   7                   OFFSET                               78600022
AMSG1A   EQU   25                  OFFSET TO 'INACTIVE' IN MSG @YM08430 78700000
FOXZERO  EQU   X'F0'                    FLAG                     S22024 79000000
SIGN     EQU   X'F0'                    TO INVERT A CHARACTER  @Y17XARR 79010000
LEN      EQU   3                        LENGTH OF PRINTABLE RLN@Y17XARR 79020000
LENGTH   EQU   2                        LENGTH OF A PACKED RLN @Y17XARR 79030000
HALFWORD EQU   3                        TO ALTER LOWERHALF OF  @Y17XARR 79040000
*                                       REG                    @Y17XARR 79050000
ADDRESS  EQU   7                        TO ALTER THREE BYTES IN@Y17XARR 79060000
*                                       REG                    @Y17XARR 79070000
ADDRDISP EQU   1                        POINT TO ADDR DISPLACE-@Y17XARR 79080000
*                                       MENT                   @Y17XARR 79090000
LOWBYTE  EQU   1                        LOWEST BYTE IN REGISTER@Y17XARR 79100000
NAMELEN  EQU   8                        LENGTH OF VALID NAME   @Y17XARR 79110000
MSGRLN   EQU   4                        RLN + BLANK            @Y17XARR 79120000
BYTE     EQU   1                        LENGTH OF MOVE         @Y17XARR 79130000
FRSTWORD EQU   4                        POINT TO 2ND WORD OF DW@Y17XARR 79140000
COMMA    EQU   X'6B'                    DELIMITER              @Y17XARR 79150000
NOACTRLN EQU   21                  OFFSET FOR RLN IN MSG                79200022
FOUR     EQU   4                        OFFSET                   S22024 79400000
NINE     EQU   9                        OFFSET                   S22024 79500000
CSEVEN   EQU   C'7'                     CHARACTER 7              S22024 79600000
MSG018   EQU   18                       MSG NUMBER             @YM07289 79810000
LINEGRP  EQU   X'40'                    LINE GROUP DCB           S22024 79820022
TERM3705 EQU   X'08'                    3705 FLAG IN 2ND WORD    S22024 79830022
BLANK    EQU   X'40'                    BLANK                    S22024 79840022
L256     EQU   256                      LIMIT                    S22024 79850000
TXLGB    EQU   X'80'                    AN LGB                   S22024 79860022
TWO      EQU   2                        OFFSET                   S22024 79870022
AMSG23   EQU   X'23'                    MSG NUMBER               S22024 79880000
ONELINE  EQU   X'01'              LINE INPUT ON - GET SUB      @OY20584 79881082
*                           OFF-  CHECK FOR ORIGINAL INPUT     @OY20584 79882082
ONEFLG   EQU   X'01'                                           @OX20443 79885082
PRTFLG   EQU   X'10'                                           @OX20443 79887082
         DS    0H                                                S22024 79890022
LENOFF   EQU   0                   OFFSET INTO WORKAREA FOR LENGTH      80400022
ALL      DC    C'ALL'                   ALL FOR MESSAGE          S22024 80600022
ALLINACT DC    H'34'                    LENGTH                   S22024 80700022
NOACTLEN DC    H'35'               LENGTH OF NOACT MSG                  80800022
BLANKS   DC    C'    '                  FOR CLEARING FIELD     @OZ29946 80850082
FULLZERO DC    F'0'                     ZEROES TO COMPARE TO   @YM06500 80900000
MSGWRIT  DC    C'07'               ID OF IGC0710D MSG WRITER RTN        81000022
MOVEMSG  MVC   OPCFOUR(OPCZERO,RWKAREA),OPCONE(R1) MOVE MSG             81200022
MVC      MVC   OPCZERO(OPCONE,RWORK),OPCZERO(RWORK6) MOVE        S22024 81400000
PACK     PACK  OPCDOUBL+SIX(OPCTWO),OPCDOUBL(OPCONE) PACK        S22024 81600000
NOINA    DS    0H                                                       81800022
         DC    AL1(ENDNOINA-*-1)        LENGTH                          82000022
         DC    CL21'IED037I'            MESSAGE NUMBER           S22024 82200022
INACTIVE DC    C'INACTIVE='             INACTIVE                 S22024 82300022
NONE     DC    C' NONE'                 NO ACTIVE ENTERIES       S22024 82400022
ENDNOINA EQU   *                                                        82600022
FULLAMSG DS    0H                                                       82800022
         DC    AL1(ENDFULL-*-1)         LENGTH                          83000022
         DC    CL23'IED036I',CL8'ACTIVE=' MSG TEXT               S22024 83200022
ENDFULL  EQU   *                                                        83400022
ERRMSG   DC    C'03'                    ERROR MSG MODULE ID      S22024 83500022
         SPACE 3                                                        83530000
ZAPS     DC    100X'FF'                 ZAPAREA                @Y17XARR 83560000
         EJECT                                                          83600022
         TOPCAVTD                                                       83800022
         TLGBD                                                          83860022
         TLCBD                                                          83920022
         TOPCED                                                         84000022
         TDEBD                                                          84200022
         DCBD  DSORG=TX                                                 84400022
         TTNTD                                                          84600022
         TAVTD                                                          84800022
CVT      DSECT                                                          85000022
         CVT                                                            85200022
         TQCBD                                                          85400022
         IHAASCB                                                        85500000
         IHAASVT                                                        85600000
         TTRMD                                                          85800022
CSCB     DSECT                                                          85900000
         IEECHAIN                                                       86000000
         END                                                            86200022
