         TITLE 'IGCD910D - DISPLAY LINE COMMANDS'                       00200022
IGCD910D CSECT                                                          00400022
*********************************************************************** 00600022
*                                                                     * 00800022
*TITLE--'IGCD910D PROCESSOR OF DISPLAY LINE COMMANDS                  * 01000022
*                                                                     * 01200022
*STATUS--CHANGE LEVEL 10                                       @Y17XARX 01400010
*                                                                     * 01600022
*FUNCTION -- THIS ROUTINE PROCESSES OPERATOR CONTROL COMMANDS WHICH   * 01800022
*   REQUEST DISPLAY OF THE LCB FIELDS FOR A SPECIFIED LINE.           * 02000022
*                                                                     * 02200022
*   WHEN ENTERED IGCD010D THE 'DISPLAY' SCAN/MAP/DISPATCH ROUTINE WILL* 02400022
*   HAVE VALIDITY CHECKED THE OPERANDS IN THE COMMAND AND IF VALID    * 02600022
*   XCTLS TO THIS ROUTINE TO PROCESS THE COMMAND. IF ANY ERRORS WERE  * 02800022
*   FOUND ONE OF THE FOLLOWING ERROR MESSAGES WOULD HAVE BEEN WRITTEN * 03000022
*   OUT BY THE ERROR WRITER IGC0310D.                                 * 03200022
*                                                                     * 03400022
*   IT OBTAINS FROM THE OPERATOR CONTROL ELEMENT (OPCE) IN THE OCELEM * 03600022
*   FIELD THE ASSOCIATED DCB ADDRESS. LCB ADDRESS IS DETERMINED FROM  * 03800022
*   DCBIOBAD+(DCBEIOBX*RELATIVE LINE)-LENGTH OF AN IOB.  THE LCB      * 04000022
*   STATUS BYTE IS OBTAINED AND IF ANY BITS ARE ON THE STATUS         * 04200022
*   CONVERSION TABLE IS USED TO CONVERT THEIR VALUES TO PRINTABLE     * 04400022
*   DATA AND PLACE THESE EQUIVALENTS IN THE RESPONSE.  OTHERWISE      * 04600022
*   'NO BITS ON' IS PLACED IN THE RESPONSE.                           * 04800022
*                                                                     * 05000022
*   THE SCB IS THEN OBTAINED FROM THE LCB AND THE ERROR WORD IS       * 05200022
*   CONVERTED BY USE OF AN ERROR CONVERSION TABLE AND PRINTABLE       * 05400022
*   EQUIVALENTS ARE PLACED IN THE RESPONSE.  IF NO BITS ARE ON,       * 05600022
*   THIS INDICATOR IS PLACED IN THE MESSAGE.  THE ROUTINE RETURNS     * 05800022
*   TO THE MESSAGE WRITER ROUTINE IGC0710D.                           * 06000022
*                                                                     * 06200022
*ENTRY POINTS --                                                      * 06400022
*        'IGCD910D' TO PROCESS DISPLAY LINE STATUS COMMANDS           * 06600022
*                                                                     * 06800022
*INPUT-- REGISTER 1 - ADDRESS OF OPCAVT                               * 07000022
*        OPCAVT                                                       * 07200022
*           OPCCOPCE - ADDRESS OF CURRENT ELEMENT (OPCE)              * 07400010
*           OPCWORK - ADDRESS OF OPERATOR CONTROL RESIDENT WORK AREA  * 07600010
*                                                                     * 07800022
*        OPCE                                                         * 08000022
*          OCELEM - ADDRESS OF DCB                             @Y17XARX 08200010
*          OCLINK - ADDRESS OF LINE TTE                        @Y17XARX 08300010
*           OCSWITCH - X'40' LINE ADDRESS                      @Y17XARX 08400010
*                      X'00' GROUPNAME,RLN                            * 08600022
*           OCRLN - RLN                                        @Y17XARX 08800010
*           OCBACKUP - DDNAME OR LINE ADDRESS                  @Y17XARX 09000010
*                                                                     * 09200022
*OUTPUT-- REGISTER 1 - ADDRESS OF OPCAVT                              * 09400022
*                                                                     * 09600022
*        OPCAVT                                                       * 09800022
*           OPCWORK - ADDRESS OF RESIDENT WORK AREA                   * 10000010
*        RESIDENT WORK AREA CONTAIN RESPONSE MESSAGE                  * 10200022
*                                                                     * 10400022
*EXTERNAL ROUTINES -- N/A                                             * 10600022
*                                                                     * 10800022
*EXITS,NORMAL -- COMMAND IS PROCESSED.  A RESPONSE MESSAGE SO         * 11000022
*   INDICATING IS CONSTRUCTED AND ITS ADDRESS RETURNED TO THE         * 11200022
*   MESSAGE WRITER ROUTINE IGC0710D                                   * 11400022
*                                                                     * 11600022
*   NORMAL EXIT MESSAGES ARE-                                         * 11800022
*   IED032I 'GRPNAME,RLN/ADDRESS' LNSTAT='STATUS,...' ERR='ERROR,...' * 12000022
*                                                                     * 12200022
*EXITS,ERROR-- GENERATED BY IGCD010D                                  * 12400022
*                                                                     * 12600022
*   ERROR MESSAGES ARE-                                               * 12800022
*   IED017I LINE 'GRPNAME,RLN/ADDRESS' NOT OPEN --GENERATED BY        * 13000022
*   IGCD010D                                                          * 13200022
*                                                                     * 13400022
*TABLES/WORK AREAS--STATUS CONVERSION TABLE,OPCAVT,TCAM AVT,LCB,OPCE, * 13600022
*   DCB,DEB,SCB,QCB                                                   * 13800022
*                                                                     * 14000022
*ATTRIBUTES-- SERIALLY REUSABLE,DISABLED,TRANSIENT(TYPE 4),SUPERVISOR * 14200022
*   MODE,NON-REENTRANT,REFRESHABLE                                    * 14400022
*                                                                     * 14600022
*CHARACTER CODE DEPENDENCY                                            * 14800022
*        THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL        * 15000022
*        REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS        * 15200022
*        EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE CODING     * 15400022
*        HAS BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER          * 15600022
*        CONSTANTS, BY REASSEMBLY WILL RESULT IN A CORRECT MODULE     * 15800022
*        FOR THE NEW DEFINITION.                                      * 16000022
*                                                                     * 16200022
*NOTES   COMMUNICATIONS BETWEEN THE VARIOUS TRANSIENT MODULES IS      * 16400022
*        PRIMARILY THROUGH THE OPERATOR CONTROL AVT.                  * 16600022
*                                                                     * 16800022
*        THIS IS A MODULE RE-WRITE OF IEDQCI AS OF OS/TCAM LEVEL II   * 16900022
*                                                                     * 16906010
*CHANGE ACTIVITY                                               @Y17XARX 16912010
*A000000-999999                                                  S99240 16918010
*A200000,204000,262000,286000,290000,300000,572000,636000        S22024 16924010
*A216000,390000,450000                                           S22024 16930010
*D268000,270000,360000,368000                                    S22024 16936010
*C014000,197000                                                  S22024 16942010
*A631940                                                         Y06328 16948010
*C462000,524000,532000,540000,650000,656000,662000,672000        Y06328 16954010
*D217200                                                         Y06328 16960010
*A082000,169000,573840,688000,669600                           @Y17XARX 16966010
*C014000,082000,084000,088000,090000,573520,572420-572620      @Y17XARX 16972010
*C573220-573350                                                @Y17XARX 16978010
*D005000-005803,572420-572860,573220-573360,688400,688800      @Y17XARX 16984010
*D698200,706000                                                @Y17XARX 16990010
*********************************************************************** 17000022
*                                                                       17200022
         EJECT                                                          17400022
*        REGISTER EQUATES                                               17600022
RZERO    EQU   0                        REGISTER                 S22024 17800000
RPARM    EQU   1                        PARAMETER REGISTER       S22024 18000000
ROPCAVT  EQU   2                        BASE FOR OPC AVT         S22024 18200000
ROPCE    EQU   3                        BASE FOR OPC ELEMENT     S22024 18400000
RWKAREA  EQU   13                       BASE FOR OPC WORKAREA    S22024 18600000
R0       EQU   0                        WORK                            18800022
R1       EQU   1                        PARAMETER                       19000022
ROPC     EQU   2                        OPERATOR CONTROL AVT BASE       19200022
RAVT     EQU   4                        AVT BASE                        19400022
RWORK    EQU   5                        WORK                            19600022
RPRF     EQU   5                        BASE FOR BUFFER UNIT     S22024 19700022
RTCB     EQU   6                        TCB BASE                        19800022
RDEB     EQU   6                        DEB BASE                        20000022
RBTU     EQU   6                        BTU BASE REGISTER        S22024 20100022
RDCB     EQU   7                        DCB BASE                        20200022
RWORK3   EQU   8                        WORK                            20400022
RTERM    EQU   8                        TERMINAL ENTRY BASE REG  S22024 20500022
RLCB     EQU   9                        LCB BASE                        20600022
ROFF     EQU   10                       OFFSET TO DDNAME                20800022
RCTR     EQU   10                       COUNTER                         21000022
RTBL     EQU   10                       WORK TABLE                      21200022
RRLN     EQU   11                       BASE FOR RLN                    21400022
RUCB     EQU   11                       UCB BASE                        21600022
RIDLEN   EQU   11                       BTU ID TXT LENGTH        S22024 21660022
RBASE    EQU   12                       ROUTINE BASE                    21800022
R13      EQU   13                       SAVE AREA                       22000022
RRETURN  EQU   14                       RETURN REGISTER                 22200022
R14      EQU   14                       RETURN                          22400022
R15      EQU   15                       ENTRY POINT                     22600022
RWORK2   EQU   15                       WORK                            22800022
         USING IEDQAVTD,RAVT            ADDRESSABILITY FOR AVT          23000022
         USING IEDQLCB,RLCB             ADDRESSABILITY FOR LCB          23200022
         USING IHADCB,RDCB              ADDRESSABILITY FOR DCB          23400022
         USING DEBNMSUB,RDEB            ADDRESSABILITY FOR DEB          23600022
         USING IEDQOPCD,ROPCAVT         ADDR FOR OP CTL AVT      S22024 23800000
         USING IEDQOPCE,ROPCE           ADDR FOR OP CTL ELEMENT  S22024 24000000
         USING IEDPRUND,RPARM           SET UP PRU ADDRESS     @Y17XARX 24060010
         USING IEDNTRM,RTERM            TERM ADDRESSABILITY    @Y17XARX 24120010
         BALR  RBASE,ZERO               ESTABLISH ADDRESSABILITY        24200022
         USING   *,RBASE                                                24400022
IGCD910D IEDHJN SKIPID                                                  24900022
         LR    ROPC,R1                                                  25400022
         L     RAVT,OPCAVTPT            GET AVT ADDRESS                 25600022
         L     RDCB,OCELEM               GET ADDR OF DCB         S22024 25800000
         L     ROPCE,OPCCOPCE           GET ADDR OF OPC ELEMENT         26000022
         L     RWKAREA,OPCWORK          GET ADDR OF OPC WORKAREA        26200022
         TM    OCFLAG,OCRESP            RESPONSE BTU COMING BACK S22024 26240022
         BO    RSPBTU                   YES  CHECK DATA          S22024 26280022
         TM    DCBDSORG+ONE,A3705       IS DCB FOR A 3705 ?      S22024 26290022
         BO    ERR3705                  YES, INVALID FOR 3705    S22024 26300022
         TM    DCBDSORG,TXLGB           3705 CMD ?               S22024 26320022
         BO    CMD3705                  YES                      S22024 26360022
         SR    RZERO,RZERO              CLEAR REGISTER FOR INSERT CHAR  26400022
         IC    RZERO,OCRLN              INSERT RLN                      26600022
         L     RLCB,DCBIOBAD            GET IOB                         27200022
         LA    RLCB,OPCZERO(RLCB)       CLEAR HIGH BYTE                 27400022
         SR    R1,R1                    CLEAR                           27600022
         IC    R1,DCBEIOBX              GET IOB LENGTH                  27800022
         MR    R0,R0                    MULTIPLY IOB BY RLN             28000022
         AR    RLCB,R1                  ADD RESULT TO IOB ADDR          28200022
         LA    RWORK3,LCBFLAG1-IEDQLCB  GET LENGTH OF IOB               28400022
         SR    RLCB,RWORK3              GET TO LCB START                28600022
         LA    RRETURN,NOT3705          BRANCH POINT             S22024 28700022
PROCESS1 EQU   *                                                        28800022
         LA    R1,MSG                   GET ADDR OF MSG                 29000022
MSGMOVE  EQU   *                                                        29100022
         SR    RDEB,RDEB                CLEAR REGISTER                  29200022
         IC    RDEB,LENOFF(R1)          GET LENGTH OF MSG               29400022
         STH   RDEB,LENOFF(RWKAREA)     STORE LENGTH IN WKAREA          29600022
         BCTR  RDEB,ZERO                DECREMENT FOR EXECUTE           29800022
         EX    RDEB,MOVEMSG             MOVE MSG INTO WORKAREA          30000022
         MVC   STATOFF(OPCSEVEN,RWKAREA),LNSTATID INSERT IN MSG  S22024 30040022
         MVI   STRSTAT(RWKAREA),BLANK   CLEAR OUTPUT AREA FOR    S22024 30050022
*                                       LINE STATUS TO BLANKS    S22024 30060022
         MVC   STRSTAT+ONE(CLEARLEN,RWKAREA),STRSTAT(RWKAREA)    S22024 30070022
         MVC   ERROFF(OPCFOUR,RWKAREA),ERRID INSERT IN MSG       S22024 30080022
         BR    RRETURN                   BRANCH TO PROPER CODE   S22024 30120022
NOT3705  EQU   *                                                 S22024 30160022
         SR    R0,R0                    CLEAR REGISTER                  30200022
         IC    R0,OCRLN                 GET RLN                         30400022
         SR    RWORK,RWORK              CLEAR FOR LOAD                  30600022
         LH    RWORK,LCBSTATE           GET STATUS BYTES                30800022
         STH   RWORK,OCLINK+TWO         SAVE FOR ACCESS LATER           31000022
         LTR   RWORK,RWORK              ANY BITS ON                     31200022
         BNZ   GETBYTE                  YES - PROCESS THEM              31400022
*                                                                       31600022
SETNO    EQU   *                                                        31800022
         MVC   GOOD(OPCTEN,RWKAREA),NOBITS SET NOBITSON IN MSG          32000022
         B     PROC                     PROCESS SCB ERROR WORD          32200022
*                                                                       32400022
GETBYTE  EQU   *                                                        32600022
         LA    RWORK,OCLINK+TWO         GET ADDR OF STATUS              32800022
         LA    RWORK2,OPCTWO                                            33000022
         LA    RWORK3,BYTE1             GET BIT TBL ADDR                33200022
         LA    RTBL,GOOD(RWKAREA)       GET MSG ADDR                    33400022
         LA    RRETURN,PROC             PROCESS SCB ERROR WORD   S22024 33450022
*                                       AFTER STATUS CHECK       S22024 33500022
CHKSTAT  EQU   *                                                 S22024 33550022
         SR    R1,R1                    CLEAR                           33600022
STATCLI  EQU   *                                                        33800022
         CLI   OPCZERO(RWORK3),AVTEFF   END OF TABLE                    34000022
         BE    NEXTST                   GO GET TABLE                    34200022
*                                                                       34400022
         IC    R1,OPCZERO(RWORK3)       GET BIT VALUE                   34600022
         EX    R1,TM                    IS THIS BIT ON                  34800022
         BO    PUTST                    YES - PUT ITS TAG IN MSG        35000022
*                                                                       35200022
         LA    RWORK3,OPCTHREE(RWORK3)  BUMP TO NEXT BIT VALUE          35400022
         B     STATCLI                  CONTINUE SEARCH                 35600022
*                                                                       35800022
*                                                                       37000022
NEXT     EQU   *                                                        37200022
         LA    RWORK3,ONE(RWORK3)       GET NEXT TABLE ADDR      S22024 37400022
         B     STATCLI                  CONTINUE SEARCH                 37600022
*                                                                       37800022
PUTST    EQU   *                                                        38000022
         MVC   OPCZERO(OPCTWO,RTBL),OPCONE(RWORK3) PUT VALUEIN MSG      38200022
         LA    RTBL,OPCTHREE(,RTBL)     BUMP TO NEXT BIT                38400022
         LA    RWORK3,OPCTHREE(,RWORK3) BUMP MSG ADDR                   38600022
         B     STATCLI                  CONTINUE SEARCH                 38800022
*                                                                       39000022
NEXTST   EQU   *                        SET COUNTER              S22024 39050022
         LA    RWORK,OPCONE(RWORK)      SET COUNTER              S22024 39100022
         BCT   RWORK2,NEXT              DO NEXT STATUS TABLE     S22024 39150022
PROCESS2 EQU   *                                                        39200022
         LA    RWORK,GOOD(RWKAREA)      RESET MSG ADDR                  39400022
         CR    RTBL,RWORK               ANY BITS FOUND                  39600022
         BCR   FOUND,RRETURN            YES, CONTINUE            S22024 39800022
         MVC   GOOD(OPCTEN,RWKAREA),NOBITS SET NO BITS ON IN MSG S22024 39860022
         BR    RRETURN                  CONTINUE                 S22024 39920022
*                                                                       40000022
PROC     EQU   *                                                        40200022
         L     RLCB,LCBSCBA-ONE         GET SCB ADDR                    40400022
         LA    RLCB,SCBERRST-IEDQSCB(RLCB) GET SCB ERROR WORD ADDR      40600022
         SR    RWORK,RWORK              CLEAR FOR LOAD                  40800022
         L     RWORK,OPCZERO(RLCB)      GET STATUS WORD                 41000022
         ST    RWORK,OCELEM             SAVE FOR COMPARES               41200022
         LTR   RWORK,RWORK              ANY BITS ON                     41400022
         BNZ   ERLOOP                   YES - PROCESS THEM              41600022
*                                                                       41800022
SETNOE   EQU   *                                                        42000022
         MVC   ERRLEN(OPCTEN,RWKAREA),NOBITS  SET NO BITS ON MSG        42200022
         LA    RTBL,LEN(RWKAREA)        BUMP ADDR TO END OF MSG         42400022
SETGOOD  EQU   *                                                        42600022
         MVC   MSGN(OPCEIGHT,RWKAREA),OCBACKUP PUT NAME IN MSG          42800022
         TM    OCSWITCH,NORLN           LINE ADDR ONLY                  43000022
         BNO   EXIT                     YES LEAVE RTN                   43200022
         BAL   RRETURN,GETRLN           NO--- GRPNAME/RLN IN CMD        43400022
EXIT     EQU   *                                                        43600022
         LR    RAVT,RWKAREA             SAVE ADDR OF WORKAREA           43800022
         LA    RWKAREA,OPCFOUR(RWKAREA) BUMP ADDR BY FOUR               44000022
         SR    RTBL,RWKAREA             CALCULATE LEN OF MSG            44200022
         STH   RTBL,LENOFF(RAVT)        STORE LEN IN WORKAREA           44400022
         MVC   OPCLDNME+OPCTHREE(OPCTWO),MSGWRIT INSERT ID OF IGC0710D  44600022
         XC    OCPARM(FOUR),OCPARM      ZERO OUT PARM AND WTG FIELDS    44800022
         L     RAVT,OPCAVTPT            GET AVT ADDR                    45000022
OUT      EQU   *                        3705 SUPPORT EXIT        S22024 45100022
         LR    RPARM,ROPCAVT            SET UP PARAMETER REG            45200022
         XCTL  SF=(E,OPCXCTL)           XCTL TO NEXT MODULE             45400022
ERLOOP   EQU   *                                                        45600022
         LA    RWORK,OCELEM             GET ADDR OS STATUS              45800022
         LA    RWORK2,OPCFOUR           SET LOOP CONTROL                46000022
         LA    RWORK3,BITONE            GET FIRST TBL ADDR       Y06328 46200010
         LA    RTBL,ERRLEN(RWKAREA)     GRT MSG ADDR                    46400022
         SR    R1,R1                    CLEAR FOR IC                    46600022
CLI      EQU   *                                                        46800022
         CLI   OPCZERO(RWORK3),AVTEFF   END OF TABLE                    47000022
         BE    NEXTBYTE                 YES                             47200022
*                                                                       47400022
         IC    R1,OPCZERO(RWORK3)        GET BIT                        47600022
         EX    R1,TM                     BIT ON                         47800022
         BO    PUTFLD                   YES - PUT DESCRIPTION    S22024 48000000
*                                                                       48200022
         LA    RWORK3,OPCFOUR(RWORK3)   BUMP TO NEXT BIT SETTING        48400022
         B     CLI                      TEST IT                         48600022
*                                                                       48800022
NEXTBYTE EQU   *                                                        49000022
         LA    RWORK,OPCONE(RWORK)                                      49200022
         BCT   RWORK2,END               END OF PROCESSING               49400022
*                                                                       49600022
         LA    RWORK,ERRLEN(RWKAREA)       RESET MSG ADDR               49800022
         CR    RTBL,RWORK               ANY BITS ON                     50000022
         BE    SETNOE                   NO, GO SET INDICATOR            50200022
         B     SETGOOD                  GO BUILD MESSAGE                50400022
*                                                                       50600022
END      EQU   *                                                        50800022
         STC   RWORK2,OCOPTCDE          SAVE 1 BYTE                     51000022
         CLI   OCOPTCDE,OPCTHREE        THREE TABLES TO GO              51200022
         BE    SBIT                     YES - GET SECOND TBL            51400022
*                                                                       51600022
         CLI   OCOPTCDE,OPCTWO          TWO TABLES TO GO                51800022
         BE    TBIT                     YES - GET THIRD TBL             52000022
*                                                                       52200022
         LA    RWORK3,BITFOUR           GET FOURTH TBL ADDR      Y06328 52400010
         B     CLI                      GO CHECK TABLE                  52600022
*                                                                       52800022
SBIT     EQU   *                                                        53000022
         LA    RWORK3,BITTWO            GET SECOND TBL ADDR      Y06328 53200010
         B     CLI                      GO CHECK TABLE                  53400022
*                                                                       53600022
TBIT     EQU   *                                                        53800022
         LA    RWORK3,BITTHREE          GET THIRD TBL ADDR       Y06328 54000010
         B     CLI                      GO CHECK TABLE                  54200022
*                                                                       54400022
PUTFLD   EQU   *                                                        54600022
         MVC   OPCZERO(OPCTHREE,RTBL),OPCONE(RWORK3)                    54800022
         LA    RTBL,OPCFOUR(,RTBL)      INCREMENT MSG ADDR              55000022
         LA    RWORK3,OPCFOUR(,RWORK3)  BUMP TO NEXT BIT                55200022
         B     CLI                      GO PROCESS IT                   55400022
*                                                                       55600022
GETRLN   EQU   *                                                        55800022
         SR    RRLN,RRLN                CLEAR REGISTER                  56000022
         IC    RRLN,OCRLN               GET RLN                         56200022
         CVD   RRLN,OPCDOUBL            CONVERT TO DECIMAL              56400022
         UNPK  OPCDOUBL(OPCTHREE),OPCDOUBL+SIX(OPCTWO) MAKE PRINTABLE   56600022
         OI    OPCDOUBL+OPCTWO,FOXZERO  MAKE PRINTABLE                  56800022
         MVC   NOACTRLN(OPCTHREE,RWKAREA),OPCDOUBL INSERT INTO MSG      57000022
         BR    RRETURN                  RETURN TO CALLING RTN           57200022
         SPACE 2                                                        57200222
ERR3705  EQU   *                                                 S22024 57200422
         LA    R0,MSG201                SET MSG 201              S22024 57200622
         MVC   OPCEIGHT(OPCEIGHT,RWKAREA),INSRT201 PUT INSERT FORS22024 57200822
*                                       MSG 201 IN WORK AREA     S22024 57201022
         B     ERRMSG                   SET ID OF MSG MODULE     S22024 57201222
         EJECT                                                          57202022
*********************************************************************** 57204022
*                                                                     * 57206022
*  THE COMMAND IS FOR A LINE OFF A 3705 CONTROL UNIT. THIS SECTION OF * 57208022
*  CODE OBTAINS A UNIT FROM IEDQCA BUFFER ALLOCATION SUBROUTINE AND   * 57210022
*  BUILDS AND FORMATS A DISPLAY LINE STATUS BTU IN THIS UNIT AND THEN * 57212022
*  PASSES THE OPCE TO IGC0210D THE BTU DISPATCHER. THE 3RD WORD OF    * 57214022
*  THIS OPCE CONTAINS THE ADDRESS OF THE REQUEST BTU. IGC0210D WILL   * 57216022
*  ASSIGN A SEQUENCE NUMBER TO THE REQUEST CHAIN THE OPCE ONTO THE    * 57218022
*  OPCWAITN CHAIN AND TPOST THE REQUEST BTU TO THE 3705 CORE QCB      * 57220022
*  WHOSE ADDRESS IS PASSED IN THE 1ST WORD OF THE REQUEST BTU UNIT    * 57222022
*  BY THE FUNCTIONAL ROUTINE.                                         * 57224022
*                                                                     * 57226022
*********************************************************************** 57228022
CMD3705  EQU   *                                                        57230022
         L     RTERM,OCLINK             GET LINE TTE ADDR      @Y17XARX 57230310
         LA    RWORK,TRMPRFSZ           GET NEG PREFIXSIZE     @Y17XARX 57230610
         SR    RTERM,RWORK              ADJUST TTE PTR         @Y17XARX 57230910
         CLI   TRMTYPE,TRMSDLC          SDLC LINE              @Y17XARX 57231210
         BE    SDLCDISP                 YES                    @Y17XARX 57231510
         LA    R13,OPCSAVE              REG SAVE AREA            S22024 57232022
         L     R15,OPCGETBF             ADDR OF BUFFER REQ. RTN  S22024 57234022
         LA    R1,OPCONE                GET 1 UNIT               S22024 57236022
         BALR  R14,R15                  BRANCH TO GET A UNIT     S22024 57238022
         ST    R1,OCUNIT                INSERT IT IN OPCE        S22024 57240022
         LA    RWORK,PRUNLEN            NEG PREFIX LEN         @Y17XARX 57240110
         SR    RPARM,RWORK              BACKUP TO NEG PREFIX   @Y17XARX 57240210
         MVC   PRURHFG0(FOUR),FID0PRUH  SET UP PREFIX          @Y17XARX 57240310
         XC    PRURHFG0+FOUR(PRUNLEN-FOUR),PRURHFG0+FOUR       @Y17XARX 57240410
*                                       CLEAR REST OF PREFIX   @Y17XARX 57240510
         MVC   PRUTIC,INVALTIC          INDICATE ONE UNIT      @Y17XARX 57240610
         MVC   PRUTTCIN,OCTRMTBL        SET UP LINE AS TARGET  @YM07403 57240710
         LA    RWORK,SIX                SET UP RU LENGTH       @Y17XARX 57240810
         STH   RWORK,PRUDATCT                                  @Y17XARX 57240910
         MVC   PRUDATA(TWO),DISPSESS    BUILD DISPLAY SESSION  @Y17XARX 57241010
*                                       RU                     @Y17XARX 57241110
         MVI   OCALSTAT,OPCZERO         CLEAR ALL FLAGS        @Y17XARX 57241210
         MVC   OCWTG,MODID              SET ID FOR IGCD910D      S22024 57288022
         MVC   OPCLDNME+OPCTHREE(TWO),XCTL02 ID OF BTU DISPATCHR S22024 57290022
         B     OUT                      PREPARE TO EXIT          S22024 57292022
         EJECT                                                          57294022
*********************************************************************** 57296022
*                                                                     * 57298022
*  THIS SECTION OF CODE IS ENTERED WHEN OCSWITCH IN THE OPCE IS SET TO* 57300022
*  X'10' WHICH IDENTIFIES THIS AS BEING A RESPONSE BTU PASSED FROM    * 57302022
*  IGC0210D, THE BTU DISPATCHER. THE 3RD WORD OF THE OPCE CONTAINS    * 57304022
*  THE ADDRESS OF THE RESPONSE BTU. THE RESPONSE BTU IS CHECKED TO SEE* 57306022
*  IF THE COMMAND WAS SUCCESSFUL. IF NOT AN ERROR MSG IS WRITTEN OUT  * 57308022
*  OTHERWISE THE 4 BYTES OF STATUS POSITIONED BEHIND THE BTU ARE      * 57310022
*  CHECKED AND STATUS CONDITIONS ARE MAPPED INTO THE RESPONSE MESSAGE.* 57312022
*                                                                     * 57314022
*********************************************************************** 57316022
RSPBTU   EQU   *                        RESPONSE BTU FROM 3705   S22024 57318022
         BAL   RRETURN,PROCESS1         MOVE MSG INTO WORKAREA   S22024 57320022
         L     RPARM,OCUNIT             GET RU ADDRESS         @Y17XARX 57320210
         LA    RWORK,PRUNLEN            NEG PREFIX LEN         @Y17XARX 57320410
         SR    RPARM,RWORK              BACKUP TO NEG PREFIX   @Y17XARX 57320610
         TM    PRURHFG0,PRURHSDI        ERROR ON RESPONSE      @Y17XARX 57320810
         BO    ERRRTRN                                         @Y17XARX 57321010
         CLI   PRUDATA+FOUR,RSPGOOD     CHECK SYSTEM RESPONSE  @Y17XARX 57321210
         BE    GOODRSP                  YES, PROCESS IT        @Y17XARX 57321410
ERRRTRN  EQU   *                                               @Y17XARX 57321610
         LA    R0,MSG199                LOAD ERROR MSG NUMBER    S22024 57338022
ERRMSG   EQU   *                                                 S22024 57340022
         MVC   OPCLDNME+OPCTHREE(TWO),XCTL03 ID OF ERROR WRITER  S22024 57342022
*                                       FOR 3705 SUPPORT         S22024 57344022
         B     OUT                      EXIT TO ERROR RTN        S22024 57346022
*                                                                       57348022
GOODRSP  EQU   *                                                        57350022
         LA    RWORK,PRUDATA+SIX        POINT TO STATUS BYTES  @Y17XARX 57350610
*                                       IN THE BTU TEXT        @Y17XARX 57351210
         LA    RTBL,GOOD(RWKAREA)       SET MSG ADDR             S22024 57356022
         LA    RWORK2,RNNUM             GET NUMBER OF BYTES      S22024 57358022
*                                       TO CHECK                 S22024 57360022
         LA    RWORK3,RNBYTES           ADDR OF BIT TABLE        S22024 57362022
         TM    OPCZERO(RWORK),ACTIVE    IS LINE ACTIVE ?         S22024 57364022
         BZ    NOTACT                   NO, SET NOT ACTIVE       S22024 57366022
         MVC   OPCZERO(OPCTWO,RTBL),AC  YES, SET ACT IN MSG      S22024 57368022
         B     SETUPR                   SET UP FOR MSG ROUTINE   S22024 57370022
NOTACT   EQU   *                                                 S22024 57372022
         MVC   OPCZERO(OPCTWO,RTBL),LI  SET LINE INACTIVE        S22024 57374000
SETUPR   EQU   *                                                 S22024 57376022
         LA    RTBL,OPCTHREE(,RTBL)     BUMP IN MSG              S22024 57378022
         BAL   RRETURN,CHKSTAT          GO TO CHECK STATUS AND   S22024 57380022
*                                       BUILD A MESSAGE          S22024 57382022
         B     SETGOOD                  GO WRITE THE STATUS MSG  S22024 57384022
SDLCDISP EQU   *                                               @Y17XARX 57384310
         BAL   RRETURN,PROCESS1         MOVE MSG INTO WORK     @Y17XARX 57384610
*                                       AREA                   @Y17XARX 57384910
         LA    RTBL,GOOD(RWKAREA)       SET MSG ADDR           @Y17XARX 57385210
         MVC   OPCZERO(OPCFIVE,RTBL),SNALIAC                   @Y17XARX 57385510
*                                       SET SNA LINE ACTIVE    @Y17XARX 57385810
         TM    TRMBYTE2,TRMRSACT        IS LINE ACTIVE         @Y17XARX 57386110
         BO    SDLCCONT                 YES                    @Y17XARX 57386410
         MVC   OPCTHREE(TWO,RTBL),LI    SET LINE INACTIVE      @Y17XARX 57386710
SDLCCONT EQU   *                                               @Y17XARX 57387010
         LA    RTBL,OPCFIVE(RTBL)       BUMP TABLE PTR         @Y17XARX 57387310
         B     SETGOOD                  GO WRITE STATUS MSG    @Y17XARX 57387610
ENDIDTBL EQU   *                                                 S22024 57388022
MOVEMSG  MVC   OPCFOUR(OPCZERO,RWKAREA),OPCONE(R1) MOVE MSG INTO WKAREA 57400022
OPCZERO  EQU   0                        OFFSET                          57600022
OPCONE   EQU   1                        OFFSET                          57800022
OPCTWO   EQU   2                        OFFSET                          58000022
OPCTHREE EQU   3                        OFFSET                          58200022
OPCFOUR  EQU   4                        OFFSET                          58400022
OPCFIVE  EQU   5                        OFFSET                          58600022
OPCSIX   EQU   6                        OFFSET                          58800022
OPCSEVEN EQU   7                        OFFSET                          59000022
OPCEIGHT EQU   8                        OFFSET                          59200022
OPCNINE  EQU   9                        OFFSET                          59400022
OPCTEN   EQU   10                       OFFSET                          59600022
FOXZERO  EQU   X'F0'                    FLAG BIT                 S22024 59800000
LENOFF   EQU   0                        OFFSET INTO WORKAREA FOR LEN    60000022
NOACTRLN EQU   21                       OFFSET IN MSG FOR NAME          60200022
MSGWRIT  DC    C'07'                    ID OF IGC0710D RTN              60400022
GOOD     EQU   32                       OFFSET INTO MSG          S22024 60600000
GOODE    EQU   67                       OFFSET INTO MSG          S22024 60800000
ERRLEN   EQU   69                       OFFSET INTO MSG FOR ERR         61000022
LEN      EQU   79                       LEN OF MSG IF NO BITS ON        61200022
MSGN     EQU   12                       OFFSET INTO MSG                 61400022
NORLN    EQU   X'40'                    MASK FOR LINE OR GRPNAME        61600022
DEB      EQU   8                        OFFSET INTO TCB OF DEB          61800022
TIOT     EQU   12                       OFFSET INTO TCB OF TIOT         62000022
ADDR     EQU   13                       ADDRESS OFFSET                  62200022
STARTOFF EQU   24                       START OFFSET                    62400022
TX       EQU   X'40'                    TX                              62600022
ADCODE   EQU   X'80'                    ADCODE                          62800022
A        EQU   C'A'                     CHARACTER A                     62850022
ZERO     EQU   0                        OFFSET                          62900022
ONE      EQU   1                        OFFSET                          62950022
TWO      EQU   2                        OFFSET                          63000022
FOUR     EQU   4                        OFFSET                          63050022
SIX      EQU   6                        OFFSET                          63100022
RSPGOOD  EQU   X'60'                    GOOD RESPONSE            S22024 63103022
OPCTLID  EQU   X'08'                     IDENTIFIES THIS AS AN          63106022
*                                        OPCTL REQ BTU                  63109022
TXLGB    EQU   X'80'                     LGB                            63112022
A3705    EQU   X'04'                    DCB FOR 3705             S22024 63112622
ACTIVE   EQU   X'80'                    LINE ACTIVE              S22024 63113222
RNNUM    EQU   4                        CHECK 4 RN STATUS BYTES  S22024 63113822
FOUND    EQU   7                        BITS WERE SET            S22024 63114422
BTUOFF   EQU   X'14'                    WHERE TO BUILD BTU       S22024 63115022
CONTROL  EQU   X'08'                    CONTROL CMD              S22024 63118022
DISPLAY  EQU   X'01'                    TYPE CMD                 S22024 63121022
DATAOFF  EQU   34                       OFFSET IN UNIT TO DATA   S22024 63124022
STATOFF  EQU   25                       OFFSET IN MSG TO LNSTAT  S22024 63127022
ERROFF   EQU   65                       OFFSET IN MSG TO ERR=    S22024 63130022
LENSTAT  EQU   7                        LENGTH OF LNSTAT= KEYWORDS22024 63130522
STRSTAT  EQU   STATOFF+LENSTAT          START OF LNSTAT DATA     S22024 63131022
ENDSTAT  EQU   ERROFF-ONE               END OF LNSTAT DATA       S22024 63131522
CLEARLEN EQU   ENDSTAT-STRSTAT          LENGTH TO CLEAR          S22024 63132022
BLANK    EQU   C' '                     BLANK                    S22024 63132522
MSG199   EQU   199                      ERROR MSG NUM FOR 3705   S22024 63133022
MSG400   EQU   400                      MESSAGE NUMBER 400       S22024 63136000
MSG201   EQU   201                      'INVALID FOR 3705' MSG   S22024 63137022
LNSTATID DC    C'LNSTAT='               LNSTAT KEY WORD          S22024 63139022
ERRID    DC    C'ERR='                  ERR= KEYWORD             S22024 63142022
XCTL03   DC    C'03'                    ERROR WRITER ID          S22024 63145022
XCTLM3   DC    C'M3'                    ID OF IGCM310D ERROR RTN S22024 63148022
*                                       ERROR WRITER             S22024 63151022
MODID    DC    C'D9'                    MODIFIER FOR CMD         S22024 63154022
XCTL02   DC    C'02'                    BTU DISPATCHER           S22024 63157022
IOBOFF   DC    H'32'                     OFFSET IN LCB TO IOB           63160022
AC       DC    C'AC'                    LINE ACTIVE              S22024 63163022
LI       DC    C'LI'                         LINE INACTIVE       S22024 63165000
RNBYTES  DC    X'20',C'SN'              SESSION CURRENTLY ACTIVE S22024 63167022
         DC    X'08',C'SS'              SERVIVE SEEKING IN PROG  S22024 63169022
         DC    X'02',C'TC'              TEST COMMAND             S22024 63171022
         DC    X'FF'                    END OF FIRST BYTE TEST   S22024 63173022
         DC    X'80',C'DH'              DEACTIVATE LINE HALT     S22024 63175022
         DC    X'40',C'DO'              DEACTIVATE LINE ORDERLY  S22024 63177022
         DC    X'20',C'AP'              ACTIVATE LINE IN PROGRESSS22024 63179022
         DC    X'10',C'AU'              AUTO DIAL MODE           Y06328 63179610
         DC    X'04',C'BU'              LINE IN BACKUP MODE      Y06328 63180210
         DC    X'FF'                    END OF SECOND TEST BYTE  S22024 63181022
         DC    X'04',C'BS'              BSC LINE                 S22024 63183022
         DC    X'02',C'MP'              MULTIPOINT LINE          S22024 63185022
         DC    X'01',C'DL'              SWITCHED LINE            S22024 63187022
         DC    X'FF'                    END OF THIRD TEST BYTE   S22024 63189022
         DC    X'80',C'MT'              MULTIPOINT TRIBUTARY     S22024 63191022
         DC    X'40',C'PS'              POINT-POINT SECONDARY    S22024 63193022
         DC    X'01',C'EP'              LINE IN EP MODE          Y06328 63194010
         DC    X'FF'                    END OF FOURTH TEST BYTE  S22024 63195022
COMP     DC    X'00'                    COMPARAND                       63200022
NOBITS   DC    C'NO BITS ON'            MESSAGE TEXT                    63400022
*                                                                       63600022
TMBTUBYT TM    OPCZERO(RWORK3),OPCZERO  ANY BITS SET             S22024 63660022
MOVE     MVC   OPCZERO(OPCZERO,RTBL),OPCTWO(RWORK3)  MOVE IN MSG S22024 63720022
TM       TM    OPCZERO(RWORK),OPCZERO   TEST                     S22024 63800000
MSG      DS    0H                                                       64000022
         DC    AL1(ENDMSG-*-1)          LENGTH                   S22024 64200022
         DC    C'IED032I '              TEXT                     S22024 64400022
ENDMSG   EQU   *                        END OF MSG               S22024 64600022
INSRT201 DC    CL8'TP,LINE,'            1ST 8 CHARACTERS OF      S22024 64660022
*                                       INVALID DISPLAY LINE CMD S22024 64720022
PACK     PACK  OPCDOUBL+SIX(OPCTWO),OPCDOUBL(OPCONE) PACK        S22024 64800000
BITONE   DC    X'80',C'HDR',X'40',C'ORG',X'20',C'NTS',X'10',C'SQH' 6328 65000010
         DC    X'08',C'SQL',X'04',C'MNS',X'02',C'ISB',X'01',C'CUT' TBL  65200022
         DC    X'FF'                    END OF TABLE                    65400022
BITTWO   DC    X'80',C'MIN',X'40',C'MAX' TABLE                   Y06328 65600010
         DC    X'08',C'OLT',X'04',C'ABR',X'02',C'FWD'    TABLE          65800022
         DC    X'FF'                    END OF TABLE                    66000022
BITTHREE DC    X'80',C'LST'             TABLE                    Y06328 66200010
         DC    X'40',C'INV'             TABLE                           66400022
         DC    X'20',C'NOP'             TABLE                           66600022
         DC    X'08',C'USE',X'04',C'FMT',X'02',C'HDW',X'01',C'UNX' TBL  66800022
         DC    X'FF'                    END OF TABLE                    67000022
BITFOUR  DC    X'80',C'SEL',X'40',C'TXT',X'20',C'CDC',X'10',C'TER' 6328 67200010
         DC    X'08',C'LER',X'04',C'CUR',X'02',C'CHR',X'01',C'UNR' TBL  67400022
         DC    X'FF'                    END OF TABLE                    67600022
BYTE1    DC    X'80',C'RC',X'40',C'CM',X'20',C'OC',X'10',C'IM' TABLE    67800022
         DC    X'08',C'CR',X'04',C'LF',X'02',C'RV',X'01',C'SD' TABLE    68000022
         DC    X'FF'                    END OF TABLE                    68200022
BYTE2    DC    X'80',C'TR',X'40',C'MS',X'20',C'TB'   TABLE              68400022
         DC    X'08',C'NR',X'04',C'BS',X'02',C'DL'    TABLE             68600022
         DC    X'FF'                    END OF TABLE                    68800022
FID0PRUH DC    X'0B80000C'              PRU PREFIX FLAGS FOR:  @Y17XARX 68802010
*                                       FM DATA, FMTD, BC, EC, @Y17XARX 68804010
*                                       DR1, FID0, BS, ES      @Y17XARX 68806010
INVALTIC DC    X'08000002'              INVALID TIC            @Y17XARX 68808010
DISPSESS DC    X'0801'                  DISPLAY SESSION RU     @Y17XARX 68810010
*                                       TEXT                   @Y17XARX 68812010
SNALIAC  DC    C'SL AC'                 SNA LINE IS ACTIVE     @Y17XARX 68814010
ZAPAREA  DC    50X'00'                  ZAPAREA                @Y17XARX 68816010
         EJECT                                                          68820022
         EJECT                                                          68860022
         EJECT                                                          68900022
         EJECT                                                          68940022
         DCBD  DSORG=(TX,TR)                                            68960022
         EJECT                                                          69000022
*                                                                       69200022
         TOPCED                                                         69400022
         TOPCAVTD                                                       69600022
         TPRUD                                                 @Y17XARX 69660010
         TTRMD                                                 @Y17XARS 69720010
         TDEBD                                                          69800022
         TLCBD                                                          70200022
         TSCBD                                                          70400022
         TAVTD                                                          70800022
         END                                                            71000022
