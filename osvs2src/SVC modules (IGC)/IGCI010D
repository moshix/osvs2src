         TITLE 'IGCI010D - ICHNG ROUTINE'                      @Y17XAR5 00200000
IGCI010D CSECT                                                          00400022
         SPACE 3                                                        00420022
* CHANGE ACTIVITY AS FOLLOWS                                            00440022
******************** MICROFICHE FLAGS *********************** SUPT CODE 00460022
*A000000-999999                                                  S99240 00500022
*A458000                                                        SA61043 00500122
*D324000-326000                                                 SA61043 00500222
*D702000-716000,726000,698000                                   SA60006 00500305
*A256000                                                         Y05330 00500405
*C298000-308000,354000,610000,732000-748000                      Y05330 00500505
*D178000,182000,250000-252000,356000-358000,566000,688000,698000,Y05330 00500605
*D702000-716000,722000,726000,750000-752000,794000-800000,808000 Y05330 00500705
*A224000,272000,348000,426000,426720,428000,459000,754000      @SA71947 00500856
*A774000,792000,806000                                         @SA71947 00500956
*D194000,288000,370000-398000,434000,438000-440000,466000      @SA71947 00501056
*D472000-474000,686000                                         @SA71947 00501156
*C294000,344000,349200,364000,426960,462000,696000,828000      @SA71947 00501256
*A222000,732000,828000                                         @Y17XARP 00502200
*D732000-750000                                                @Y17XARP 00521200
*C038000                                                       @Y17XART 00521700
*A038000                                                       @Y17XART 00522200
*D700000,754000                                                @Y17XART 00522700
*C002000,010400,010800,011450,014000,292000,322000,346000,     @Y17XAR5 00531700
*C349200,426660,426726,426732,427200,                          @Y17XAR5 00535700
*C484000,526000,674000,794100-798500                           @Y17XAR5 00540700
*A005227,012000,058000,170000,184000,204000,272070,320000,     @Y17XAR5 00549700
*A428400,428600,429100,516000,774000,792000,792700,793300,     @Y17XAR5 00558700
*A794000,821000,                                               @Y17XAR5 00562700
*D010000,010200,349260-349860,426738-427020,428700-429000,     @Y17XAR5 00567700
*D429200-459600,484000,764000,792800-793200,793900,            @Y17XAR5 00573700
*D829600-830000                                                @Y17XAR5 00579700
*C470000                                                       @OY14092 00582700
*C320900                                                       @OX20404 00583700
*C470000                                                       @OZ30514 00583886
*A266000,459200                                                @OZ29091 00583986
         EJECT                                                 @Y17XAR5 00585700
*********************************************************************** 00600022
*                                                                     * 00800022
*  MODULE NAME = IGCI010D (TCAM, OPERATOR CONTROL)             @Y17XAR5 01040000
*                                                                     * 01060022
*  DESCRIPTIVE NAME = ICHNG ROUTINE                            @Y17XAR5 01080000
*                                                                     * 01100022
*  COPYRIGHT = 'NONE'                                                 * 01120022
*                                                                     * 01140022
*  STATUS:  VERSION 10.0                                       @Y17XAR5 01145000
*                                                                     * 01180022
*                                                                     * 01200022
* FUNCTION:  IF THE LINE IS ATTACHED TO A 270X OR IS A 3705    @Y17XAR5 01300000
*    LINE, THEN THE PURPOSE OF THIS MODULE IS TO DEACTIVATE AN @Y17XAR5 01400000
*    INVITATION LIST ENTRY AS REQUESTED BY A PROCESSING PROGRAM.  THE * 01600022
*    ROUTINE CHECKS TO SEE IF THE LINE IS STOPPED.  IF SO, THE LINE   * 01800022
*    MUST BE STOPPED BEFORE THE FUNCTION CAN BE PERFORMED.  TO STOP   * 02000022
*    THE LINE, CONTROL IS TRANSFERRED TO STOPLINE.  THE X'40' BIT IS  * 02200022
*    SET IN OCSWITCH TO INDICATE THAT THE LINE IS TO BE RESTARTED.    * 02400022
*    UPON ENTERING THIS MODULE AGAIN, THE FUNCTION SHOULD BE PERFORMED* 02600022
*    SINCE THE LINE HAS BEEN STOPPED.  THE FIRST WORD OF OCMODNME IS  * 02800022
*    USED TO DETERMINE THE TYPE OF ICHANGE TO BE DONE.  THIS MODULE   * 03000022
*    WILL ONLY DEACTIVATE AN ENTRY IN THE INVITATION LIST.  IF ALL    * 03200022
*    ENTRIES ARE ALREADY ACTIVE, OCSWITCH IS CHECKED TO SEE IF THE    * 03400022
*    LINE WILL NEED RESTARTING.  IF SO, THE LCB IS DEQUEUED AND THE   * 03600022
*    LINE IS POSTED TO ITSELF AND POSTED TO THE ASYNCRONOUS    @Y17XART 03606000
*    READY Q                                                   @Y17XART 03612000
*    TO START THE LINE.  OTHERWISE, A COUNT OF THE NUMBER OF ACTIVE   * 04000022
*    ENTRIES IS SET UP.  EACH ACTIVE ENTRY IS SWAPPED FROM THE ACTIVE * 04200022
*    TO THE INACTIVE SIDE OF THE LIST AND THE ACTIVE COUNT IS         * 04400022
*    DECREMENTED.  WHEN ALL ENTRIES ARE INACTIVE, THE NUMBER OF ACTIVE* 04600022
*    ENTRIES IS SET TO ZERO, AND OCSWITCH IS CHECKED TO SEE IF THE    * 04800022
*    LINE NEEDS TO BE RESTARTED.  IF SO, THE LCB IS DEQUEUED AND THE  * 05000022
*    LINE IS STARTED AS ABOVE.  THEN A RETURN CODE IS SET UP FOR THE  * 05200022
*    OUTPUT WRITER TO POST THE APPLICATION PROGRAM.  IF THE ICHANGE   * 05400022
*    FUNCTION IS EITHER AN ACTIVATE OR MOVE LIST, THEN CONTROL IS     * 05600022
*    TRANSFERRED TO THE OTHER ICHANGE MODULE, IGCI110D.               * 05800022
*    FOR LINES ATTACHED TO A 3705, THIS MODULE PROCESSES       @Y17XAR5 05850000
*    BOTH ACTIVATE AND DEACTIVATE REQUESTS. 3705 ICHNG MOVE    @Y17XAR5 05900000
*    COMMANDS ARE SENT TO IGCI210D.                            @Y17XAR5 05950000
*                                                                     * 06000022
* ENTRY POINTS --                                                     * 06200022
*    IGCI010D TO PERFORM THE ICHNG DEACTIVATE FUNCTION FROM AN MPP.   * 06400022
*                                                                     * 06600022
* INPUT --                                                            * 06800022
*    REGISTER 1 - ADDRESS OF OPERATOR CONTROL AVT.  RELEVANT FIELDS   * 07000022
*    ARE OPCDOUBL.  THIS FIELD CONTAINS THE DDNAME OR THE UCB ADDRESS.* 07200022
*    ANOTHER FIELD IS OPCCOPCE WHICH IS THE ADDRESS OF THE CURRENT    * 07400022
*    OPERATOR CONTROL ELEMENT.  RELEVANT FIELDS ARE OCBACKUP.  THIS   * 07600022
*    FIELD CONTAINS EITHER A DDNAME OR A UCB ADDRESS.  ANOTHER        * 07800022
*    RELEVANT FIELD IS OCSWITCH.  IF THE X'40' BIT IS ON, THE LINE    * 08000022
*    SHOULD BE RESTARTED AFTER DEACTIVATING THE TERMINAL.  THE FIRST  * 08200022
*    WORD OF OCMODNME IS USED TO DETERMINE THE TYPE OF ICHANGE.       * 08400022
*                                                                     * 08600022
* OUTPUT --                                                           * 08800022
*    REGISTER 0 - RETURN CODE VALUES.                                 * 09000022
*                                                                     * 09200022
* EXTERNAL REFERENCES --                                              * 09400022
*         NONE.                                                       * 09600022
*                                                                     * 09800022
* EXITS,NORMAL --                                                     * 10000022
*         ENTRIES WERE DEACTIVATED AS REQUESTED, X'00' RETURN CODE    * 10200022
*         SET.                                                        * 10400022
*         ENTRIES HAVE ALREADY BEEN DEACTIVATED, X'00' RETURN CODE    * 10600022
*         SET.                                                        * 10800022
*                                                                     * 11000022
* EXITS,ERROR --                                                      * 11200022
*         ENTRIES COULD NOT BE DEACTIVATED, X'04' RETURN CODE SET.    * 11400022
*                                                                     * 11600022
* TABLES/WORK AREAS --                                                * 11800022
*    OPERATOR CONTROL AVT, OPERATOR CONTROL ELEMENT, TERMNAME TABLE,  * 12000022
*    DCB, TERMINAL ENTRY, QCB, LCB, DEB.                              * 12200022
*                                                                     * 12400022
* ATTRIBUTES --                                                       * 12600022
*    SERIALLY REUSABLE, REFRESHABLE, ENABLED, TRANSIENT,              * 12800022
*    SUPERVISOR MODE.                                                 * 13000022
*                                                                     * 13200022
* CHARACTER CODE DEPENDENCY --                                        * 13400022
*    THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL            * 13600022
*    REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS            * 13800022
*    EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE CODING         * 14000022
*    HAS BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER              * 14200022
*    CONSTANTS, BY REASSEMBLY WILL RESULT IN A CORRECT MODULE         * 14400022
*    FOR THE NEW DEFINITION.                                          * 14600022
*                                                                     * 14800022
* NOTES --                                                            * 15000022
*    COMMUNICATIONS BETWEEN THE VARIOUS TRANSIENT MODULES IS          * 15200022
*    PRIMARILY THROUGH THE OPERATOR CONTROL AVT.                      * 15400022
*                                                                     * 15600022
*    THIS IS A MODULE RE-WRITE OF IEDQC1 AS OF OS/TCAM LEVEL II       * 15700022
*********************************************************************** 15800022
         EJECT                                                          16000022
         SPACE                                                          16200022
*                                 E Q U A T E S                         16400022
         SPACE                                                          16600022
RZERO    EQU   0                        PARAMETER REGISTER              16800022
RPARM    EQU   1                        PARAMETER REGISTER              17000022
ROPCNEW  EQU   1                        PTR TO START/STOP OPCE @Y17XAR5 17100000
ROPCAVT  EQU   2                        POINTER TO OP CONTROL AVT       17200022
ROPCE    EQU   3                        POINTER TO CURRENT OPCE         17400022
RAVT     EQU   4                        TCAM AVT ADDRESS                17600022
RRLN     EQU   5                        RELATIVE LINE NUMBER            18000022
RLCB     EQU   5                        LCB ADDRESS                     18400022
RLEVEL   EQU   5                        PTR TO RESOURCE TTE    @Y17XAR5 18500000
RENTRY   EQU   6                        CURRENT ENTRY POINTER           18600022
RSCB     EQU   6                        SCB BASE                        18800022
RLCB1    EQU   6                        LCB ADDRESS                     19000022
RTERM    EQU   6                        TERM ENTRY BASE                 19200022
         SPACE 1                                                        19400056
RUCB     EQU   6                        UCB BASE                        19600022
RDCB     EQU   7                        DCB BASE                        19800022
ROFF     EQU   7                        OFFSET TO DDNAME, ADDR, RLN     20000022
RWORK    EQU   8                        WORK REGISTER                   20200022
RSWAP    EQU   8                        TO SWAP LIST ENTRIES            20400022
RNEXT    EQU   8                        PTR TO RESOURCE TTE    @Y17XAR5 20500000
RWORK1   EQU   9                        WORK REGISTER                   20600022
RPREFIX  EQU   9                        BUFFER ADDRESS                  20800022
RLENGTH  EQU   10                       LENGTH OF ENTRY                 21000022
RDEB     EQU   10                       DEB BASE                        21200022
RQCB     EQU   11                       QCB ADDRESS                     21400022
RLIST    EQU   11                       LIST ADDRESS                    21600022
RBASE    EQU   12                       BASE FOR MODULE                 21800022
RSAVE    EQU   13                       SAVE AREA ADDRESS               22000022
RRET     EQU   14                       SUBROUTINE RETURN ADDRESS       22200022
CURR     EQU   14                       REGISTER 14            @Y17XARP 22220000
RBRNCH   EQU   15                       SUBROUTINE BRANCH ENTRY POINT   22400022
RTNT     EQU   15                                              @SA71947 22500056
         SPACE 2                                                        22600022
EIGHT    EQU   8                        LENGTH OF EIGHT                 22800022
NAMELEN  EQU   2                        NO. OF NAME CHANGE CHARACTERS   23000022
VARINAME EQU   3                        OFFSET TO CHANGE LOAD NAME      23200022
FOUR     EQU   4                        OFFSET                   S22024 23400000
ONE      EQU   1                        OFFSET                   S22024 23600000
THREE    EQU   3                        OFFSET                   S22024 23800000
TWO      EQU   2                        OFFSET                   S22024 24000000
ANYMOVED EQU   X'01'                    INDICATES ENTRIES MOVED         24200022
EOT      EQU   X'80'                    EOT FLAG                        24400022
ENDACT   EQU   X'FE'                    END OF ACTIVE ENTRIES           24600022
SEVEN    EQU   7                        OFFSET                   S22024 24800000
ZERO     EQU   0                        OFFSET                   S22024 25400000
NINE     EQU   9                        OFFSET                   S22024 25600000
AD       EQU   7                        MASK FOR ICM OF ADDRESS  Y05330 25660005
RECBLINK EQU   5                        LINK FIELD OFFSET        Y05330 25720005
X40      EQU   X'40'                    INDICATES LINE NEEDS RESTARTED  25800022
TR       EQU   3                        DISPLACEMENT                    26000022
ON       EQU   1                        DISPLACEMENT                    26200022
UCBNM    EQU   13                       DISPLACEMENT             S22024 26400000
LCBPRIOR EQU   X'E0'                    PRIORITY FOR LCB                26600022
PRISTOP  EQU   X'E8'                    LINE STOPPED PRTY      @OZ29091 26650086
NOTCA    EQU   2                        ENTRY NOT FROM CA               26800022
SIX      EQU   6                        DISPLACEMENT                    27000022
SAVEOFF  EQU   0                        DISPLACEMENT OF SAVE AREA       27200022
RNDSORG  EQU   X'04'                   DSORG FOR 3705 DCB      @SA71947 27201056
BADCMND  EQU   18                       BAD COMMAND RETURN CODE@SA71947 27202056
NOTOPEN  EQU   1                        NOT OPEN RETURN CODE   @SA71947 27203056
GRPNAME  EQU   45                       OFFSET TO DCB ADDR     @SA71947 27204056
OFF18    EQU   X'18'                    OFFSET TO ICHNG ACT COD@SA71947 27205056
TRMSNGL  EQU   X'E0'                    MASK TO CHECK TERM ENTR@SA71947 27206056
POST     EQU   X'0C'                    POST REQUEST           @SA71947 27207056
DONESW   EQU   X'80'                    SWITCH FOR TTE SEARCH  @Y17XAR5 27227000
LOOPSW   EQU   X'40'                    SWITCH FOR TTE SEARCH  @Y17XAR5 27247000
NOSNA    EQU   36                       ICHNG MOVE INVALID FOR @Y17XAR5 27267000
NCPERRCD EQU   28                       NCP ERROR              @Y17XARL 27287000
HEXFF    EQU   X'FF'                    TO TURN OFF BITS       @Y17XAR5 27307000
*                                       SNA LINES              @Y17XAR5 27327000
CVTPTR   EQU    16                      CVT POINTER            @Y17XART 27347000
         EJECT                                                          27400022
         USING IEDQAVTD,RAVT            TCAM AVT ADDRESSABILITY         27600022
         USING IEDQOPCD,ROPCAVT         OP CONTROL AVT ADDRESSABILITY   27800022
         USING IEDQOPCE,ROPCE           ELEMENT ADDRESSABILITY          28000022
         USING DEBNMSUB,RDEB            DEB ADDRESSABILITY              28200022
         USING IHADCB,RDCB              DCB ADDRESSABILITY              28400022
         USING IEDQQCB,RQCB             QCB ADDRESSABILITY              28600022
         SPACE 1                                                        28800056
         USING IEDQPRF,RPREFIX          BUFFER ADDRESSABILITY           29000022
         USING IEDNTRM,RTERM            TERM ENTRY ADDRESSABILITY       29200000
         SPACE 1                                                        29400056
         SPACE                                                          29600022
         USING *,RBRNCH                                          Y05330 29800005
         BAL   RBASE,SKIPID             BYPASS ID / SET BASE     Y05330 30000005
         DROP  RBRNCH                   TEMPORARY USING          Y05330 30200005
         USING *,RBASE                                           Y05330 30400005
         USING IEDQTNTD,RTNT            TNT ADDRESSABILITY     @SA71947 30500056
IGCI010D IEDHJN ,                                                Y05330 30600005
SKIPID   DS    0H                                                Y05330 30800005
*              INITIAL SETUP                                          * 31400022
         LR    ROPCAVT,RPARM            SET UP AVT ADDRESSING           31600022
         L     RAVT,OPCAVTPT            TCAM AVT ADDRESSING             31800022
         L     ROPCE,OPCCOPCE           GET CURRENT ELEMENT POINTER     32000022
         LA    RSAVE,OPCSAVE                                   @Y17XAR5 32010000
         CLI   OCSWITCH,OCSTPLNC        RET FROM 3705 STOPLINE?@Y17XAR5 32020000
         BE    SETMODNM                 YES                    @Y17XAR5 32030000
         CLI   OCSWITCH,OCVARON         RET FROM 3705 STARTLINE@Y17XAR5 32040000
         BE    RETSTART                 YES                    @Y17XAR5 32050000
         CLI   OCSWITCH,AVTEZERO        INITIAL ENTRY?         @Y17XAR5 32060000
         BE    INITENT                  YES                    @Y17XAR5 32070000
* THIS IS A RETURN FROM 270X STOPLINE                          @Y17XAR5 32080000
         L     RDCB,OCPTRSAV            GET DCB ADDRESS        @OX20404 32090000
         B     GETLCB                                          @Y17XAR5 32100000
INITENT  MVC   OPCDOUBL(EIGHT),OCBACKUP SET DDNAME                      32200000
         SPACE                                                          32800022
         SR    RPARM,RPARM                                              33000022
         IC    RPARM,OCRLN                                              33200022
         L     RBRNCH,OPCDCBLK          GET DCB LOOKUP ADDRESS          33400022
         BALR  RRET,RBRNCH              LOOK UP DCB AND UCB ADDRESS     33600022
         SPACE                                                          33800022
         B     PROCESS                  GOOD RETURN                     34000022
         SPACE                                                          34200022
         B     CKRSTRT                  CHECK FOR RESTART      @SA71947 34400056
         EJECT                                                 @Y17XAR5 34600000
PROCESS  EQU   *                                                        34800022
         TM    DCBDSORG+ONE-IHADCB(RPARM),RNDSORG 3705 DCB     @SA71947 34820056
         BO    ERROR18                  YES, ICHNG INVALID     @SA71947 34840056
         TM    DCBDSORG-IHADCB(RPARM),AVTE80 IS THIS AN LGB-3705 S22024 34860022
         BO    FREE                     YES,BRANCH             @Y17XAR5 34920000
         ST    RPARM,OCMODNME+FOUR      SET UP DCB ADDRESS     @SA71947 34992056
         LA    RWORK,OPCWAITL           GET FIRST ELEMENT OFF WAIT QUE  35000022
GETEND   EQU   *                                                        35200022
         ICM   RWORK,AD,ONE(RWORK)      FIRST / NEXT ELEMENT     Y05330 35400005
         BZ    FREE                     NONE WAITING                    36000022
         SPACE                                                          36200022
         CLC   GRPNAME(THREE,ROPCE),GRPNAME(RWORK) SAME DCB    @SA71947 36400056
         BNE   GETEND                   NO                              36600022
         SPACE                                                          36800022
         SPACE                                                          40000022
ENQUEUE  EQU   *                                                        40200022
         TM    OCFLAG-IEDQOPCE(RWORK),OCATTACH IS THIS ATTACHED ELEM?   40400022
         BNO   ATTACH                   NO                              40600022
         SPACE                                                          40800022
         L     RWORK,FOUR(RWORK)        NO PICK UP NEXT ELEMENT         41000022
         B     ENQUEUE                  CHECK TO SEE IF ATTACHED        41200022
         SPACE                                                          41400022
ATTACH   EQU   *                                                        41600022
         ST    ROPCE,FOUR(RWORK)        QUEUE UP NEW ELEMENT            41800022
         OI    OCFLAG-IEDQOPCE(RWORK),OCATTACH UNIT IS ATTACHED         42000022
         MVC   OCWTG(NAMELEN),ICHNGMOD  SET UP FUNCTION MODULE NAME     42200022
         LA    RZERO,NOTCA              SET FOR 00                      42400022
         MVC   OPCLDNME+VARINAME(NAMELEN),FIRSTLD                       42600022
         XC    OCLINK+ONE(THREE),OCLINK+ONE CLEAR LINK FIELD   @SA71947 42630056
         B     XCTL                     GO TO SEE IF A CMND TO PROCESS  42660022
         EJECT                                                   S22024 42666000
GO3705   EQU   *                                                 S22024 42672022
         CLI   TRMTYPE,TRMSDLC          IS IT A SNA LINE?      @Y17XAR5 42672600
         BE    SNAERR                   YES                    @Y17XAR5 42673200
         LA    RZERO,NOTCA              SET FOR INITIAL ENTRY  @SA71947 42676856
         MVC   OPCLDNME+VARINAME(NAMELEN),ICHNG2 SET NAME - XCTL S22024 42678022
         B     XCTL1                    XCTL TO IGCI210D         S22024 42708022
         EJECT                                                 @Y17XAR5 42720000
FREE     EQU   *                                                        42800022
         LR    RDCB,RPARM               DCB ADDRESS            @SA71947 42810056
         TM    DCBDSORG,AVTE80          IS THIS AN LGB         @SA71947 42820056
         BZ    GETLCB                   NO, BRANCH             @SA71947 42830056
         LR    RTERM,RZERO              GET TERM ENTRY ADDRESS @SA71947 42840056
         LA    RBRNCH,TRMPRFSZ          NEG PREFIX SIZE        @Y17XAR5 42843000
         SR    RTERM,RBRNCH             BACK UP TO NEG PREFIX  @Y17XAR5 42846000
         TM    OPCSPEC,OPCRSTRT         RESTART IN PROGRESS    @SA71947 42850056
         BO    IC3705                   YES, CHANGE ILIST      @SA71947 42860056
         CLI   TRMTYPE,TRMSDLC          IS IT A SNA LINE?      @Y17XAR5 42865000
         BE    IC3705                   YES                    @Y17XAR5 42870000
         ST    RTERM,OCMODNME           SAVE TERM ENTRY ADDRESS@SA71947 42910056
         LA    RPARM,ONE                RPARM = # UNITS NEEDED @Y17XAR5 42910500
         L     RBRNCH,OPCGETBF          ADDR OF BUFF REQ RTNE  @Y17XAR5 42911000
         BALR  RRET,RBRNCH              CALL ALLOCBUF          @Y17XAR5 42911500
* SET UP NEW OPCE FROM OLD - ROPCNEW ADDRESSES STOPLINE OPCE   @Y17XAR5 42912000
         MVC   OCTRMTBL-IEDQOPCE(2,ROPCNEW),OCTRMTBL           @Y17XAR5 42912500
         MVC   OCBACKUP-IEDQOPCE(8,ROPCNEW),OCBACKUP           @Y17XAR5 42913000
         ST    RDCB,OCPTRSAV-IEDQOPCE(,ROPCNEW) SAVE LGB ADDR  @Y17XARL 42913500
         MVC   OCOPTCDE-IEDQOPCE(1,ROPCNEW),OCOPTCDE           @Y17XAR5 42914000
         MVI   OCSWITCH-IEDQOPCE(ROPCNEW),OCSTPLNC INDICATE    @Y17XAR5 42914500
*                                       STOPLINE TYPE          @Y17XAR5 42915000
         MVC   OCWTG-IEDQOPCE(2,ROPCNEW),ICHNGMOD INDICATE     @Y17XAR5 42915500
*                                       RETURN TO I0           @Y17XAR5 42916000
         LA    ROPCE,AVTEZERO(,ROPCE)   CLEAR HIGH ORDER       @Y17XARR 42916200
         ST    ROPCE,OCCIB-IEDQOPCE(,ROPCNEW) SAVE OLD OPCE    @Y17XARL 42916500
*                                       ADDRESS                @Y17XAR5 42917000
         LR    ROPCE,ROPCNEW            STOPLINE OPCE IS       @Y17XAR5 42917500
         ST    ROPCE,OPCCOPCE           TEMPORARILY CURR OPCE  @Y17XAR5 42918000
         MVC   OPCMODID,STOP05          INDICATE EXIT TO V8    @Y17XAR5 42918500
         B     XCTL                                            @Y17XAR5 42919000
         EJECT                                                 @Y17XAR5 42919500
GETLCB   EQU   *                                               @SA71947 42940056
         SR    RRLN,RRLN                                                43000022
         IC    RRLN,OCRLN               SET UP RELATIVE LINE NUMBER     43200022
         L     RDEB,DCBDEBAD            DEB ADDRESS                     43600022
         SPACE                                                          44200022
         L     RLCB1,DCBIOBAD           IOB ADDRESS                     44400022
         SR    RWORK1,RWORK1            CLEAR REG                       44600022
         IC    RWORK1,DCBEIOBX          GET IOB LENGTH                  44800022
         LR    RWORK,RRLN               GET RELATIVE LINE NUMBER        45000022
         MR    RWORK,RWORK              GET IOB INDEX                   45200022
         LA    RLCB1,AVTEZERO(RLCB1,RWORK1)  GET CORRECT IOB ADDRESS    45400022
         LA    RWORK,LCBFLAG1-IEDQLCB   GET LENGTH OF IOB               45600022
         SR    RLCB1,RWORK              START OF LCB                    45800022
         TM    OPCSPEC,OPCRSTRT         RESTART IN PROGRESS     SA61043 45860022
         BO    INVLIST                  YES, BRANCH             SA61043 45920022
         CLI   LCBPRI-IEDQLCB(RLCB1),PRISTOP    LINE STOPPED   @OZ29091 45940086
         BE    STOPLINE                 YES                    @OZ29091 45960086
         CLI   LCBSTAT1-IEDQLCB(RLCB1),AVTEZERO ALREADY STOPPED         46000022
         BNE   STOPLINE                 NO, STOP THE LINE      @SA71947 46200056
         TM    LCBSTAT2-IEDQLCB(RLCB1),LCBMSGNN MSGEN IN PROGRE@SA71947 46250056
         BZ    INVLIST                  NO, PROCESS ILIST      @SA71947 46300056
STOPLINE EQU   *                                               @SA71947 46350056
         SPACE                                                          46400022
         SPACE 1                                                        46600056
         MVC   OPCLDNME+VARINAME(NAMELEN),STOPLN                        46800022
         OI    OCSWITCH,X40+OCX10       SET INTERNAL STOPLINE  @OZ30514 47000086
         MVC   OCWTG(TWO),ICHNGMOD      SET RETURN MODULE NAME          47600022
         LA    RZERO,ONE                SET FOR INIT ENTRY TO STOPLINE  47800022
         B     XCTL                     GO TO STOPLINE                  48000022
         EJECT                                                 @Y17XAR5 48200000
*              DETERMINE WHETHER TO DEACTIVATE,ACTIVATE,OR MOVE       * 48600022
INVLIST  EQU   *                                                        48800022
         CLC   OCMODNME(THREE),AVTFZERO                                 49000022
         BNE   GOTOICHI                 MOVE LIST RESTART               49200022
         SPACE                                                          49400022
         CLI   OCMODNME+THREE,ZERO      ACTIVATE OR DEACTIVATE          49600022
         BE    GOTOICHI                 ACTIVATE LIST RESTART           49800022
         SPACE                                                          50000022
         LA    RLIST,DCBINVLI-IHADCB(RDCB) GET INV LIST                 50200022
         SR    RWORK,RWORK              CLEAR REGISTER                  50400022
         IC    RWORK,LCBUCBX-IEDQLCB(RLCB1)  GET IOB INDEX              50600022
         SLL   RWORK,TWO                MULTIPLY BY FOUR                50800022
         AR    RLIST,RWORK              GET TO PROPER LIST ADDRESS      51000022
         L     RLIST,AVTEZERO(RLIST)    GET LIST                        51200022
         LR    RLCB,RLCB1               SAVE ADDRESS OF LCB FOR LATER   51400022
         B     DEACTIV                  DEACTIVATE THE TERMINAL         51600022
         SPACE 3                                               @Y17XAR5 51700000
GOTOICHI EQU   *                                                        51800022
         MVC   OPCLDNME+VARINAME(NAMELEN),ICHNG1   SET TO GO TO ICHANGE 52000022
         STM   RLCB1,RDCB,SAVEOFF(RSAVE) SAVE REGS FOR I1               52200022
         B     XCTL                     LINK TO NEXT MODULE             52400022
         EJECT                                                 @Y17XAR5 52600000
DEACTIV  EQU   *                                                        52800022
         SR    ROFF,ROFF                                                53000022
         STH   ROFF,OCMODNME+SIX        SET UP FIRST ENTRY              53200022
         SR    RLENGTH,RLENGTH          INIT REG                        53400022
         SR    RWORK1,RWORK1            INIT REG                        53600022
         IC    RLENGTH,TWO(RLIST)       LENGTH OF ENTRY                 53800022
         LR    RWORK1,RLENGTH                                           54000022
         BCTR  RWORK1,AVTEZERO          DECREMENT FOR EXECUTE           54200022
         SPACE                                                          54400022
GTENTRY  EQU   *                                                        54600022
         LH    ROFF,OCMODNME+SIX        GET COUNT                       54800022
         CLI   ONE(RLIST),AVTEZERO      ALL ENTRIES INACTIVE            55000022
         BE    EXIT                     YES                             55200022
         SPACE                                                          55400022
         LA    ROFF,ONE(ROFF)           INCREMENT BY ONE                55600022
         STH   ROFF,OCMODNME+SIX        STORE COUNT                     55800022
         CLC   OCMODNME+SEVEN(ONE),AVTEZERO(RLIST) OUT OF ENTRIES       56000022
         BH    EXIT                     YES                             56200022
         SPACE                                                          56400022
         LA    RENTRY,SEVEN(RLIST)      POINTER TO FIRST ENTRY INDEX    56800022
         SR    RRET,RRET                CLEAR                           57000022
         IC    RRET,ONE(RLIST)          NUMBER OF ACTIVE ENTRIES        57200022
         OI    OPCFLAG1,ANYMOVED        SET 'MOVED' INDICATOR           57400022
CKNEXT   EQU   *                                                        57600022
         AR    RENTRY,RLENGTH           GO TO NEXT ENTRY'S INDEX        57800022
         CLC   AVTEZERO(ONE,RENTRY),OCMODNME+SEVEN IS THIS ACTIVE ENTRY 58000022
         BE    DACTIV                   YES VALID ENTRY                 58200022
         SPACE                                                          58400022
         BCT   RRET,CKNEXT              IF NOT END OF ACTIVE,GO BACK    58600022
         B     GTENTRY                  FINISHED WITH THIS GET NEXT     58800022
         SPACE                                                          59000022
DACTIV   EQU   *                                                        59200022
         LR    RSWAP,RENTRY                                             59400022
         SR    RENTRY,RLENGTH           ENTRY LENGTH-1                  59600022
         BCT   RRET,SWAPLOOP            SWAP ENTRIES                    59800022
         B     LOOPOUT                  CHECK FOR EOT                   60000022
         SPACE                                                          60200022
SWAPLOOP EQU   *                                                        60400022
         EX    RWORK1,SWAP1             SWAP TWO                        60600022
         EX    RWORK1,SWAP2             SUCCESSIVE                      60800022
         EX    RWORK1,SWAP1             ENTRIES                         61000005
         AR    RENTRY,RLENGTH           GO TO NEXT ENTRY                61200022
         AR    RSWAP,RLENGTH            GET TO THIS ENTRY               61400022
         BCT   RRET,SWAPLOOP            NOT DONE RETURN                 61600022
         SPACE                                                          61800022
LOOPOUT  EQU   *                                                        62000022
         IC    RRET,TWO(RLIST)          GET ENTRY LENGTH                62200022
         LA    RBRNCH,ONE                                               62400022
         TM    THREE(RLIST),EOT         IS THIS EOT-FE (BSC)            62600022
         BO    SFTEOT                   YES SPECIAL TREATMENT           62800022
         SPACE                                                          63000022
SFTLOOP  EQU   *                                                        63200022
         MVC   ONE(ONE,RSWAP),AVTEZERO(RSWAP) MOVE ONE CHARACTER        63400022
         SR    RSWAP,RBRNCH             AT A TIME,STARTING              63600022
         BCT   RRET,SFTLOOP             WITH THE LAST CHARACTER         63800022
         SPACE                                                          64000022
         MVI   ONE(RSWAP),ENDACT                                        64200022
RSETACT  EQU   *                                                        64400022
         IC    RRET,ONE(RLIST)          COUNT OF ACTIVE ENTRIES         64600022
         SR    RRET,RBRNCH                   ONE LESS                   64800022
         STC   RRET,ONE(RLIST)          RESET                           65000022
         B     GTENTRY                  TRY NEXT                        65200022
         SPACE                                                          65400022
SFTEOT   EQU   *                                                        65600022
         MVC   OCPARM(TWO),ONE(RSWAP)   SAVE EOT-FE                     65800022
SFTEOT1  EQU   *                                                        66000022
         MVC   TWO(ONE,RSWAP),AVTEZERO(RSWAP) MOVE ONE CHARACTER        66200022
         SR    RSWAP,RBRNCH             AT A TIME                       66400022
         BCT   RRET,SFTEOT1             STARTING WITH LAST CHARACTER    66600022
         SPACE                                                          66800022
         MVC   ONE(TWO,RSWAP),OCPARM    RESET EOT-FE                    67000022
         B     RSETACT                  SET ACTIVE COUNT                67200022
         EJECT                                                 @Y17XAR5 67400000
*              DETERMINE ALL EXIT SITUATIONS                          * 67600022
EXIT     EQU   *                                                        67800022
         TM    OPCSPEC,OPCRSTRT         RESTART IN PROGRESS             68000022
         BO    CKPOINT1                 YES GO TO CHECKPOINT            68200022
         SPACE                                                          68400022
         LA    RRET,EIGHT(RLIST)        POINTER TO BEGINNING OF LIST    69000022
         ST    RRET,LCBINVPT-IEDQLCB-ONE(RLCB) FOR RECEIVE SCHEDULER    69200022
         TM    OCSWITCH,X40             SHOULD LINE BE RESTARTED        69400022
         BZ    CKSTAIN                  NO, GO CHECKPOINT      @SA71947 69600056
         SPACE                                                          71800022
*              START LINE BACK                                        * 72000022
         MVI   LCBPRI-IEDQLCB(RLCB),LCBPRIOR SET PRIORITY FOR LCB       72400022
         OI    LCBSTAT1-IEDQLCB(RLCB),LCBRECVN   SET STATUS FOR START   72800022
         ST    RLCB,AVTEZERO(RLCB)      MAKE LCB POINT TO ITSELF        73000022
         L     RWORK,CVTPTR             GET CVT ADDR           @Y17XARP 73010000
         L     RWORK,AVTCVTPT(RWORK)    GET ADDR OF TCX        @Y17XARP 73020000
         USING IEDQTCX,RWORK            ESTABLISH ADDR         @Y17XARP 73030000
         L     CURR,TCXREADY            GET ADDR OF CURRENT    @Y17XARP 73040000
*                                       ENTRY ON ASYN READY Q  @Y17XARP 73050000
NEWCURR  STCM  CURR,SEVEN,LCBLINK-IEDQLCB(RLCB)                @Y17XARP 73060000
*                                       LINK NEW ELEM TO CURR  @Y17XARP 73070000
         CS    CURR,RLCB,TCXREADY       WAS CURR ELEM UPDATED  @Y17XARP 73080000
*                                       ASYNCHRONOUSLY         @Y17XARP 73090000
         BNE   NEWCURR                  YES,LINK NEW ELEM TO   @Y17XARP 73100000
*                                       CURR ELEM. NO, ASYN    @Y17XARP 73110000
*                                       READY QUEUE NOW HAS    @Y17XARP 73140000
*                                       NEW ELEM               @Y17XARP 73170000
CKSTAIN  EQU   *                                               @SA71947 75460056
         SR    RZERO,RZERO              GOOD RETURN CODE       @SA71947 75520056
         TM    AVTBIT3,AVTSTAIN         CHECKPOINT THIS                 75600022
         BZ    OUT                      DONT CHECKPOINT                 75800022
         SPACE                                                          76000022
*              CHECKPOINT THE ELEMENT                                 * 76200022
CKPOINT1 EQU   *                                                        76600022
         MVC   OPCLDNME+VARINAME(NAMELEN),CHECKPT                       76800022
         STH   RZERO,OCPARM             SET FOR CHECKPOINT              77000022
         MVC   OCWTG(NAMELEN),WRITE     WRITE MODULE SET                77200022
         B     XCTL                         GO TO SPECIFIED MODULE      77400022
         EJECT                                                 @Y17XARL 77400200
NCPERR   EQU   *                                               @Y17XARL 77400400
         LR    ROPCNEW,ROPCE            SAVE START/STOP OPCE   @Y17XARL 77400600
*                                       ADDRESS                @Y17XARL 77400800
         L     ROPCE,OCCIB              RESTORE ORIGINAL OPCE  @Y17XARL 77401000
*                                       ADDRESS                @Y17XARL 77401200
         ST    ROPCE,OPCCOPCE           RESET CURRENT OPCE PTR @Y17XARL 77401400
         ST    ROPCNEW,OCUNIT           CHAIN START/STOP OPCE  @Y17XARL 77401600
         LA    RZERO,NCPERRCD           SET NCP ERROR CODE     @Y17XARL 77401800
         B     OUT                      EXIT TO IGC0710D       @Y17XARL 77402000
         SPACE 1                                               @Y17XARL 77402200
SNAERR   EQU   *                                               @Y17XAR5 77402400
         LA    RZERO,NOSNA                                     @Y17XAR5 77402600
         B     OUT                                             @Y17XAR5 77402800
ERROR18  EQU   *                                               @SA71947 77403056
         LA    RZERO,BADCMND            SET BAD RETURN         @SA71947 77406056
         B     OUT                      AND RETURN             @SA71947 77409056
ERROPEN  LA    RZERO,NOTOPEN            SET NOT OPEN           @SA71947 77412056
         B     OUT                      AND RETURN             @SA71947 77415056
         SPACE                                                          77600022
OUT1     EQU   *                                                        77800022
         SR    RZERO,RZERO              ZERO RETURN CODE                78000022
OUT      EQU   *                                                        78200022
         MVC   OPCLDNME+VARINAME(NAMELEN),WRITE  SET MODULE NAME        78400022
XCTL     EQU   *                                                        78600022
         NI    OPCFLAG1,AVTEZERO        CLEAR FLAGS                     78800022
XCTL1    EQU   *                                                 S22024 78900000
         LR    RPARM,ROPCAVT            PASS AVT ADDRESS                79000022
         XCTL  SF=(E,OPCXCTL)           CALL NEXT MODULE                79200022
         EJECT                                                 @Y17XAR5 79205000
CKRSTRT  EQU   *                                               @SA71947 79210056
         LTR   RDCB,RPARM               GET DCB ADDRESS        @SA71947 79220056
         BZ    OUT                      BRANCH IF DCB NOT OPEN @SA71947 79230056
         TM    DCBDSORG,AVTE80          IS THIS AN LGB         @SA71947 79240056
         BZ    OUT                      NO, RETURN             @SA71947 79250056
         TM    OPCSPEC,OPCRSTRT         RESTART IN PROGRESS    @SA71947 79260056
         BZ    OUT                      NO, DCB NOT OPEN       @SA71947 79270056
         LH    RPARM,OCTRMTBL           OFFSET IN TNT TO LINE  @Y17XAR5 79270700
*                                       NAME                   @Y17XAR5 79271400
         L     RBRNCH,AVTRNMPT                                 @Y17XAR5 79272100
         BALR  RRET,RBRNCH              CALL IEDQTNT           @Y17XAR5 79272800
         LR    RTERM,RPARM              TERMINAL ADDRESS       @Y17XAR5 79273500
         LA    RBRNCH,TRMPRFSZ          BACK UP TO NEG PREFIX  @Y17XAR5 79274200
         SR    RTERM,RBRNCH                                    @Y17XAR5 79274900
         CLC   OCMODNME(THREE),AVTFZERO ICHNG MOVE             @Y17XARL 79275600
         BE    GOTQCB                   NO, BRANCH             @Y17XARL 79276300
         MVC   OPCMODID,MODI3           SET ID FOR ICHNG MOVE  @Y17XARL 79277000
*                                       RESTART MODULE         @Y17XARL 79277700
         B     XCTL                     EXIT TO RESTART MOD    @Y17XARL 79278400
         EJECT                                                 @Y17XAR5 79279100
SETMODNM EQU   *                                               @SA71947 79330056
* ROPCE HAS ADDRESS OF STOPLINE OPCE                           @Y17XAR5 79330500
         CLC   OCPARM,CON25             LINE ALREADY STOPPED?  @Y17XAR5 79331000
         BE    STOPPED                  YES                    @Y17XAR5 79331500
         CLC   OCPARM,CON26             WAS LINE STOPPED       @Y17XARL 79332000
         BNE   NCPERR                   NO, BRANCH             @Y17XARL 79332500
         MVI   OCSWITCH,OCVARON         STARTLINE NEEDED       @Y17XAR5 79333000
*                                       AFTER ICHNG            @Y17XAR5 79333500
         B     ORIGOPCE                                        @Y17XAR5 79334000
STOPPED  MVI   OCSWITCH,AVTEZERO        STARTLINE NOT NEEDED   @Y17XAR5 79334500
*                                       AFTER ICHNG            @Y17XAR5 79335000
ORIGOPCE EQU   *                                               @Y17XAR5 79335500
* PUT STOPLINE OPCE BACK AT THE TOP OF THE WAIT CHAIN          @Y17XAR5 79336000
         MVC   OCLINK,OPCWAITV          LINK STOPLINE OPCE TO  @Y17XAR5 79336500
*                                       NEXT OPCE              @Y17XAR5 79337000
         ST    ROPCE,OPCWAITV           STOPLINE OPCE IS FIRST @Y17XAR5 79337500
* NOW SET ROPCE AND OPCCOPCE TO ORIGINAL OPCE                  @Y17XAR5 79338000
         L     ROPCE,OCCIB              RESTORE ADDR OF ORIG   @Y17XARL 79338500
         ST    ROPCE,OPCCOPCE           CURR OPCE IS NOW ORIG  @Y17XARL 79339000
         L     RTERM,OCMODNME           RESTORE LINE TTE ADDR  @Y17XAR5 79339500
         L     RPARM,OCCIB              GET CIB ADDRESS        @SA71947 79340056
         MVC   OCMODNME(FOUR),OFF18(RPARM) RESET ICHNG ACT CODE@SA71947 79350056
IC3705   EQU   *                                               @SA71947 79360056
         CLC   OCMODNME(THREE),AVTFZERO MOVE LIST ICHNG        @SA71947 79370056
         BNE   GO3705                   YES,  GO TO NEXT MODULE@SA71947 79380056
GOTQCB   EQU   *                                               @SA71947 79400056
* RTERM HAS LINES TTE ADDRESS                                  @Y17XAR5 79401000
         SR    RBRNCH,RBRNCH            ZERO A WORK REG        @Y17XAR5 79402000
         CH    RBRNCH,TRMSUBST          LINES SUBST 0?         @Y17XAR5 79403000
         BE    CKSTART                  YES                    @Y17XAR5 79404000
* THE 2ND AND 3RD WORDS OF OPCWRKSP ARE USED AS TEMPORARY      @Y17XAR5 79405000
* SAVE AREAS FOR REGS RRLN AND RWORK                           @Y17XAR5 79410000
         ST    RRLN,OPCWRKSP+4          STORE REGS FOR REUSE   @Y17XAR5 79412000
         ST    RWORK,OPCWRKSP+8         AS RLEVEL AND RNEXT    @Y17XAR5 79414000
* THE FIRST BYTE OF OPCWRKSP IS USED FOR SWITCHES              @Y17XAR5 79416000
         NI    OPCWRKSP,HEXFF-DONESW    TURN DONESW OFF        @Y17XAR5 79418000
         LR    RNEXT,RTERM              LINE TTE ADDR          @Y17XARL 79420000
NXTTTE   NI    OPCWRKSP,HEXFF-LOOPSW    TURN LOOPSW OFF        @Y17XAR5 79422000
         DROP  RTERM                                           @Y17XAR5 79424000
         USING IEDNTRM,RNEXT                                   @Y17XAR5 79426000
         SR    RBRNCH,RBRNCH            ZERO A WORK REG        @Y17XAR5 79428000
         CH    RBRNCH,TRMSUBST          IS NEXT'S SUBST 0?     @Y17XAR5 79430000
         BE    HIER                     YES                    @Y17XAR5 79432000
         LR    RLEVEL,RNEXT             NO- LEVEL = NEXT       @Y17XAR5 79434000
         LH    RPARM,TRMSUBST           GET TNT OFFSET OF NEXT @Y17XARL 79436000
*                                       LOWER RESOURCE         @Y17XARL 79438000
         OI    OPCWRKSP,LOOPSW          TURN ON LOOPSW         @Y17XAR5 79440000
         B     GETNEXT                  GET NEXT RESOURCE      @Y17XARL 79442000
         EJECT                                                 @Y17XARL 79444000
HIER     CLI   TRMTYPE,TRMLUNT          IS NEXT AN LU?         @Y17XAR5 79446000
         BE    PROCLU                   YES                    @Y17XAR5 79448000
         CLI   TRMTYPE,TRMPSNA          IS NEXT PRE-SNA?       @Y17XAR5 79450000
         BNE   GETCOHRT                 NO                     @Y17XAR5 79452000
         TM    OPCSPEC,OPCRSTRT         RESTART?               @YM08178 79452600
         BO    SKIPTEST                 DON'T TEST INPUT CAP.  @YM08178 79453200
         TM    TRMBYTE0,TRMINPUT        CAPABLE OF INPUT?      @Y17XAR5 79454000
         BZ    GETCOHRT                 NO                     @Y17XAR5 79456000
SKIPTEST EQU   *                                               @YM08178 79457000
         NI    TRMBYTE2,HEXFF-TRMRSACT  TURN OFF ACTIVE FLAG   @Y17XAR5 79458000
         CLI   OCMODNME+3,ZERO          ACTIVE ICHNG?          @Y17XAR5 79460000
         BNE   GETCOHRT                 NO                     @Y17XAR5 79462000
         OI    TRMBYTE2,TRMRSACT        TURN ON ACTIVE FLAG    @Y17XAR5 79464000
         B     GETCOHRT                                        @Y17XAR5 79466000
PROCLU   NI    TRMLU,HEXFF-TRMLULOG     PREVENT LOGON TO TCAM  @Y17XAR5 79468000
         CLI   OCMODNME+3,ZERO          ACTIVE ICHNG?          @Y17XAR5 79470000
         BNE   GETCOHRT                 NO                     @Y17XAR5 79472000
         OI    TRMLU,TRMLULOG           CAN LOGON TO TCAM      @Y17XAR5 79474000
GETCOHRT LH    RPARM,TRMCOHRT           TRMCOHRT OF NEXT       @Y17XAR5 79476000
         SPACE 2                                               @Y17XARL 79478000
GETNEXT  EQU   *                                               @Y17XARL 79480000
         L     RBRNCH,AVTRNMPT                                 @Y17XAR5 79482000
         BALR  RRET,RBRNCH              CALL IEDQTNT           @Y17XAR5 79484000
         LR    RNEXT,RPARM              SET NEXT TO TTE ADDR   @Y17XAR5 79486000
         LA    RBRNCH,TRMPRFSZ          NEG PREFIX SIZE        @Y17XAR5 79488000
         SR    RNEXT,RBRNCH             BACK UP TO NEG PREFIX  @Y17XAR5 79490000
         SPACE 2                                               @Y17XARL 79491000
LOOPTEST EQU   *                                               @Y17XARL 79492000
         TM    OPCWRKSP,LOOPSW          NEXT RESOURCE OK       @Y17XARL 79493000
         BO    DONETEST                 YES, BRANCH            @Y17XARL 79494000
         SPACE 1                                               @Y17XARL 79495000
         CR    RNEXT,RLEVEL             DOES NEXT = LEVEL?     @Y17XAR5 79496000
         BNE   SETLOOP                  NO, BRANCH             @Y17XARL 79497000
         CR    RLEVEL,RTERM             DOES LEVEL = LINE?     @Y17XAR5 79500000
         BE    PATHSWON                 YES                    @Y17XAR5 79510000
         LA    RPARM,TRMPRFSZ           NEG PREFIX SIZE        @Y17XAR5 79520000
         AR    RPARM,RNEXT              PARAM = TTE ADDR       @Y17XAR5 79530000
*                                       (OMITTING NEG PREFIX)  @Y17XAR5 79540000
         L     RBRNCH,OPCHORT                                  @Y17XAR5 79542000
         BALR  RRET,RBRNCH              CALL COHORTLK          @Y17XAR5 79544000
         LR    RLEVEL,RPARM             TTE ADDR ON NEXT       @Y17XAR5 79546000
*                                       HIGHER RESOURCE        @Y17XAR5 79548000
         LA    RBRNCH,TRMPRFSZ          NEG PREF SIZE          @Y17XAR5 79550000
         SR    RLEVEL,RBRNCH            BACK UP TO NEG PREFIX  @Y17XAR5 79552000
         LH    RPARM,TRMCOHRT                                  @Y17XAR5 79554000
         L     RBRNCH,AVTRNMPT          CALL IEDQTNT WITH      @Y17XAR5 79556000
         BALR  RRET,RBRNCH              COHORT OF NEXT         @Y17XAR5 79558000
         LR    RNEXT,RPARM              TTE ADDR ON NEXT       @Y17XAR5 79560000
*                                       HIGHER RESOURCE        @Y17XAR5 79562000
         LA    RBRNCH,TRMPRFSZ          NEG PREFIX SIZE        @Y17XAR5 79564000
         SR    RNEXT,RBRNCH             BACK UP TO NEG PREFIX  @Y17XAR5 79566000
         B     LOOPTEST                                        @Y17XARL 79568000
         SPACE 1                                               @Y17XARL 79570000
PATHSWON OI    OPCWRKSP,LOOPSW+DONESW   TURN ON PATH SWITCHES  @Y17XAR5 79572000
         B     LOOPTEST                 TEST FOR END           @Y17XARL 79574000
         SPACE 1                                               @Y17XARL 79576000
SETLOOP  OI    OPCWRKSP,LOOPSW          SET LOOPSW             @Y17XARL 79578000
         B     LOOPTEST                 TEST FOR END           @Y17XARL 79580000
         SPACE 1                                               @Y17XARL 79582000
DONETEST EQU   *                                               @Y17XARL 79584000
         TM    OPCWRKSP,DONESW          IS DONESW ON?          @Y17XAR5 79586000
         BZ    NXTTTE                   NO                     @Y17XAR5 79588000
         DROP  RNEXT                                           @Y17XAR5 79590000
         USING IEDNTRM,RTERM                                   @Y17XAR5 79591000
RESTORE  L     RRLN,OPCWRKSP+4          RESTORE REGS           @Y17XAR5 79592000
         L     RWORK,OPCWRKSP+8         SAVED IN OPC WORK AREA @Y17XAR5 79593000
CKSTART  CLI   TRMTYPE,TRMSDLC          IS IT A SNA LINE?      @Y17XAR5 79594000
         BE    CKSTAIN                  YES                    @Y17XAR5 79595000
         TM    OPCSPEC,OPCRSTRT         RESTART IN PROGRESS?   @Y17XAR5 79596000
         BO    CKSTAIN                  YES                    @Y17XAR5 79597000
* FIND STOPLINE OPCE ON OPCWAITV                               @Y17XAR5 79598000
* ROPCNEW WILL REFER TO STOPLINE OPCE                          @Y17XAR5 79599000
         SR    RBRNCH,RBRNCH            ZERO WORK REG          @Y17XAR5 79600000
         L     ROPCNEW,OPCWAITV         FIRST OPCE ON CHAIN    @Y17XAR5 79610000
* OCCIB OF STOPLINE OPCE POINTS TO ORIGINAL OPCE (ADDRESS      @Y17XAR5 79612000
*                                       IN ROPCE)              @Y17XAR5 79614000
FINDSS   CLM   ROPCE,AD,OCCIB-IEDQOPCE+ONE(ROPCNEW) STOPLINE? @Y17XARR  79616000
         BE    GOTIT                    YES                    @Y17XAR5 79618000
         LR    RBRNCH,ROPCNEW           SAVE PTR TO PREV OPCE  @Y17XAR5 79620000
         LA    RBRNCH,AVTEZERO(,RBRNCH) CLEAR HIORDER BYTE     @Y17XARR 79620500
         L     ROPCNEW,OCLINK-IEDQOPCE(,ROPCNEW) NEXT IN CHAIN @Y17XAR5 79621000
         B     FINDSS                   CHECK IT               @Y17XAR5 79622000
GOTIT    LTR   RBRNCH,RBRNCH            WAS IT FIRST ON CHAIN? @Y17XAR5 79623000
         BNZ   UNLINK                   NO                     @Y17XAR5 79624000
         MVC   OPCWAITV,OCLINK-IEDQOPCE(ROPCNEW) YES- MAKE     @Y17XAR5 79625000
         B     UNCHAIND                 ANCHOR PT TO NEXT OPCE @Y17XAR5 79630000
* UNCHAIN STOPLINE OPCE BY MAKING PREV OPCE PT TO NEXT OPCE    @Y17XAR5 79632000
UNLINK   MVC   OCLINK-IEDQOPCE(4,RBRNCH),OCLINK-IEDQOPCE(ROPCNEW)       79634000
*                                                              @Y17XAR5 79636000
UNCHAIND CLI   OCSWITCH-IEDQOPCE(ROPCNEW),OCVARON STARTLINE?   @Y17XAR5 79638000
         BNE   NOSTART                  NO- NOT NEEDED         @Y17XAR5 79640000
         LR    ROPCE,ROPCNEW            MAKE START/STOP ...    @Y17XARL 79642000
         ST    ROPCE,OPCCOPCE           ... THE CURRENT OPCE   @Y17XARL 79644000
         MVC   OCPARM,AVTFZERO          YES- SET UP            @Y17XARL 79646000
*                                       START/STOP OPCE FOR    @Y17XAR5 79648000
*                                       STARTLINE              @Y17XAR5 79650000
         NI    OCFLAG,HEXFF-OCRESP      RESET RESPONSE FLAG    @Y17XARL 79652000
         MVI   OCALSTAT,ZERO            RESET FLAG BYTE        @Y17XARL 79654000
         MVC   OCWTG,ICHNGMOD           SET WHERE TO GO        @Y17XARL 79656000
         MVC   OPCMODID,MODVI           EXIT TO STARTLINE      @Y17XAR5 79660000
         B     XCTL                                            @Y17XAR5 79662000
RETSTART LR    ROPCNEW,ROPCE            ADDR OF START/STOP OPCE@Y17XAR5 79664000
         L     ROPCE,OCCIB              GET ADDR OF ORIGINAL   @Y17XARL 79666000
*                                       OPCE                   @Y17XAR5 79668000
         ST    ROPCE,OPCCOPCE           CURR OPCE              @Y17XAR5 79670000
NOSTART  TM    OCFLAG-IEDQOPCE(ROPCNEW),OCATTACH ARE OPCE'S    @Y17XAR5 79672000
*                                       ATTACHED?              @Y17XAR5 79674000
         BZ    NOTATTCH                 NO                     @Y17XAR5 79676000
         MVC   OCELMPTR,OCELMPTR-IEDQOPCE(ROPCNEW) MOVE OPCE'S @Y17XAR5 79678000
*                                       TO ICHNG OPCE          @Y17XAR5 79680000
         NI    OCFLAG-IEDQOPCE(ROPCNEW),HEXFF-OCATTACH UNATTACH@Y17XAR5 79682000
         OI    OCFLAG,OCATTACH          ATTACH- ORIG OPCE      @Y17XAR5 79684000
NOTATTCH ST    ROPCNEW,OCUNIT           ADDR (START/STOP OPCE) @Y17XAR5 79686000
         B     CKSTAIN                  GO CHECKPOINT ICHNG    @SA71947 79860056
         SPACE                                                          80200022
SWAP1    XC    ONE(AVTEZERO,RSWAP),ONE(RENTRY) SWAP TWO                 80400022
SWAP2    XC    ONE(AVTEZERO,RENTRY),ONE(RSWAP) SUCCESSIVE               80600022
RNPRFSZ  DC    AL2(IEDQTRM-IEDNTRM)     3705 PREFIX SIZE       @SA71947 80650056
ACTLINE  DC    X'089880'                ACTIVATE LINE CODE     @SA71947 80700056
CHECKPT  DC    C'06'                    CHECKPOINT MODULE NAME          81000022
WRITE    DC    C'07'                    OUTPUT WRITER NAME              81200022
ICHNG1   DC    C'I1'                    MOVE OR ACTIVATE LIST           81400022
STOPLN   DC    C'V1'                    STOPLINE MODULE                 81600022
ICHNGMOD DC    C'I0'                    DEACTIVATE LIST                 81800022
FIRSTLD  DC    C'00'                    FIRST LOAD OF OP CTL            82000022
DISABLE  DC    X'00'                    SYSTEM MASK FOR DISABLE  S22024 82020022
ICHNG2   DC    C'I2'                    ICHNG FOR 3705           S22024 82100022
STOP05   DC    C'V8'                    3705 STOPLINE          @Y17XAR5 82110000
CON25    DC    H'25'                    MSG # FOR LINE ALREADY @Y17XAR5 82120000
*                                       STOPPED                @Y17XARL 82130000
CON26    DC    H'26'                    MSG # FOR LINE STOPPED @Y17XARL 82140000
MODVI    DC    C'VI'                    MODULE INDICATOR       @Y17XAR5 82150000
MODI3    DC    C'I3'                    MODULE INDICATOR       @Y17XARL 82160000
         TITLE 'IGCI010D - DSECTS REFERENCED BY THIS MODULE'            82200022
         TAVTD                                                          82400022
         EJECT                                                          82600022
         DCBD  DSORG=(TX,TR)                                   @SA71947 82800056
         EJECT                                                          82810000
         TTCXD SVS                                                      82820000
         EJECT                                                 @SA71947 82840056
         TLGBD                                                 @SA71947 82880056
         EJECT                                                 @SA71947 82920056
         EJECT                                                          83000022
         TDEBD                                                          83200022
         EJECT                                                          83400022
         TDISPD                                                         83600022
         EJECT                                                          83800022
          SPACE 1                                                       84000056
         EJECT                                                          84200022
         TLCBD                                                          84400022
         EJECT                                                          84600022
         TOPCED                                                         84800022
         EJECT                                                          85000022
         TOPCAVTD                                                       85200022
         EJECT                                                          85400022
         TPRFD                                                          85600022
         EJECT                                                          85800022
         TPRIOR                                                         86000022
         EJECT                                                          86200022
         TQCBD                                                          86400022
         EJECT                                                          86600022
         TSCBD                                                          86800022
         EJECT                                                          87000022
         TTNTD                                                          87200022
         EJECT                                                          87400022
         TTRMD                                                          87600022
         END                                                            87800022
