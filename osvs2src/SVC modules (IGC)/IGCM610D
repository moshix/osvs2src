         TITLE 'IGCM610D - MODIFY TRACE'                                00300022
IGCM610D CSECT                                                          00600022
*A000000-999999                                                @Y16X5R0 00650000
*A373600-374200,511000,525410-525750,526230-526530,819600-821400,Y06328 00700105
*A829600-830200                                                  Y06328 00700205
*C846000                                                         Y06328 00700305
*A373000,606000                                                @XA11945 00700458
*A006000,012000,015000,129000,138000,146000,189000,373480,     @Y17XARW 00730400
*A426000,829000                                                @Y17XARW 00760400
*C018000,384000,204000,066000,147000-162000,384000,            @Y17XARW 00790400
*C526230-526530                                                @Y17XARW 00820400
*D373600-374600,525410-525750,819600-821400                    @Y17XARW 00850400
*A028000,112000-112090                                         @Y17XARA 00860400
*A267010,390010,427005-428830,580000,602000,606050-606080      @Y17XARA 00870400
*A651000-653400,829300-829360,829410-829540                    @Y17XARA 00880400
*A279500,524500,607900,865000-865002                           @OY15041 00884400
*C373480,608000                                                @OY15041 00888400
*D606400,608200                                                @OY15041 00892400
*A374200,602000,821400                                                  00893200
*C579000,580500,594000-597000,820200                                    00894000
*A564000,821800                                                         00894800
*C579000-581500,595600-596400,588800,602008,602040,820200               00895600
*C821800                                                                00896400
*D819200-819400                                                         00897200
*C602480                                                                00898000
*A602840                                                                00898800
*C576300,577800,819600                                         @OZ26897 00899111
*********************************************************************** 00900022
*                                                                     * 01200022
* MODULE NAME - IGCM610D(TCAM, OP CONTROL)                     @Y17XARW 01300000
*                                                                     * 01500022
* DESCRIPTIVE NAME - TRACE COMMAND PARSE ROUTINE               @Y17XARW 01600000
*                                                                     * 01700000
* STATUS - VERSION 10.0                                        @Y17XARW 01800000
*                                                                     * 02400022
* FUNCTION -                                                          * 02700022
* THIS ROUTINE PROCESSES THE FOLLOWING OPERATOR CONTROL COMMANDS      * 02800000
* 1.UPON ENTRY THIS ROUTINE TESTS THE OPERATOR CONTROL ELEMENT SET UP * 03000000
*   BY IGCMM10D TO DETERMINE IF THE DDNAME/RLN OR THE HARDWARE ADDRESS* 03300022
*   FORMAT WAS USED. IF IT IS DDNAME THE NAME IS INSERTED IN OPCDOUBL * 03600022
*   OF THE OPCAVT AND THE RLN IS INSERTED INTO REGISTER 1 AND A BALR  * 03900022
*   IS DONE TO THE DCBLOOKUP SUBROUTINE IN THE OPERATOR CONTROL       * 04200022
*   RESIDENT ROUTINE IEDQCA. IF THE HARDWARE ADDRESS WAS SPECIFIED    * 04500022
*   THE ADDRESS IS CONVERTED TO EBCDIC AND INSERTED IN OPCDOUBL       * 04800022
*   REGISTER 1 IS ZEROED OUT AND A BALR IS DONE TO THE DCBLOOKUP      * 05100022
*   SUBROUTINE. THE SUBROUTINE WILL VALIDITY CHECK THE DDNAME/RLN OR  * 05400022
*   HARDWARE ADDRESS AND IF INVALID WILL RETURN ON REGISTER 14 PLUS 4 * 05700022
*   IF VALID ON REGISTER 14. IF INVALID ERROR MSG IED017I WILL BE     * 06000022
*   WRITTEN OUT BY XCTLING TO THE ERROR WRITER IGC0310D.              * 06300022
*                                                                     * 06330000
*   IF VALID, A CHECK IS MADE FOR AN LGB BEING RETURNED BY     @Y17XARW 06360000
*   DCBLOCATE.  IF IT IS AN LGB, THE LINE TTE WILL BE SAVED IN @Y17XARW 06390000
*   THE OPCE, THE SCAN FLAG WILL BE SETUP TO INDICATE SCAN NOT @Y17XARW 06420000
*   YET DONE, AND AN XCTL WILL BE MADE TO IGCMB10D.            @Y17XARW 06450000
*                                                                     * 06480000
*   IF IT IS NOT AN LGB, IT IS A 270X OR A 3705 DCB.  THE LCB  @Y17XARW 06510000
*   ADDRESS IS THEN COMPUTED FROM DCBIOBAD+(DCBEIOBX*RLN)-     @Y17XARW 06540000
*   SIZE OF AN IOB. THE AVT IS TESTED FOR THE PRESENCE OF A TRACE     * 06900022
*   TABLE (AVTRACE NOT ZERO) AND IF NOT, AN ERROR MESSAGE NUMBER  55  * 07200022
*   IS LOADED INTO REGISTER 0 AND XCTL TO THE ERROR WRITER IGC0310D   * 07500022
*   TO WRITE OUT MESSAGE IED055I.                                     * 07800022
*                                                                     * 08100022
*   IF TRACE IS TO BE STARTED, THE TRACE BIT IS TESTED . IF ALREADY   * 08400022
*   ON, MESSAGE NUMBER 24 IS LOADED INTO REGISTER 0 AND XCTL TO       * 08700022
*   IGC0310D TO WRITE OUT MESSAGE IED024I. OTHERWISE THE TRACE BIT IS * 09000022
*   TURNED ON (LCBTRACE IN LCBSTAT2).                                 * 09300022
*                                                                     * 09600022
*   IF TRACE IS TO BE STOPPED BUT THE LCB TRACE BIT IS NOT ON, AN     * 09900022
*   ALREADY STOPPED MESSAGE NUMBER ,MSG 30 IS LOADED INTO REGISTER 0  * 10200022
*   AND XCTL TO IGC0310D TO WRITE OUT MESSAGE IED030I. OTHERWISE      * 10500022
*   THE BIT IS TURNED OFF.                                            * 10800022
*                                                                     * 11100022
* 2. DTRACE= THIS COMMAND MODIFIES THE SUBTASK TRACE OPTION  @Y17XARA * 11110000
*    (AVTSUBT) AND OBTAINS A BUFFER UNIT AND POSTS IT TO     @Y17XARA * 11112000
*    THE ADDRESS AT LABEL DSPTRACE IN IGG019RO . WHEN THE    @Y17XARA   11114000
*    ELEMENT IS DISPATCHED THE ROUTINE TRACE IN IGG019RO WILL@Y17XARA   11116000
*    GET CONTROL AND MODIFY INSTRUCTIONS WITHIN ITSELF TO    @Y17XARA   11118000
*    ACTUALLY START OR STOP THE TRACE(S)                     @Y17XARA   11120000
*    THE FOLLOWING OPTIONS ARE ;                             @Y17XARA   11122000
*        1. ON   = X'80' SUBTASK TRACE                       @Y17XARA * 11130000
*        2. POST = X'40' POST TRACE                          @Y17XARA * 11140000
*        3. ALL  = X'FF' ALL TRACES                          @Y17XARA * 11150000
*        4. OFF  = X'00' NO TRACES                           @Y17XARA * 11160000
*    RESPONSE :                                              @Y17XARA * 11170000
*        1. IED018I DTRACE COMMAND INVALID                   @Y17XARA   11172000
*        2. IED024I TRACE ALREADY STARTED FOR DTRACE =       @Y17XARA   11174000
*        3. IED030I TRACE ALREADY STOPPED FOR DTRACE =       @Y17XARA   11176000
*        4. IED055I SUBTASK TRACE CANNOT BE ALTERED          @Y17XARA   11178000
*        5. IED537I SUBTASK TRACE STARTED OPT= (ON,POST,ALL) @Y17XARA * 11180000
*        6. IED538I SUBTASK TRACE STOPPED                    @Y17XARA * 11190000
*                                                            @Y17XARA * 11200000
* 3. TRACE=ERROR, THIS COMMAND MODIFIES THE I/O TRACE OPTION @Y17XARA * 11210000
*    (AVTIOTR) THE FOLLOWING OPTIONS ARE                     @Y17XARA * 11220000
*        1. ON   = X'80' START TRACE ON ERRORS               @Y17XARA * 11230000
*        2. HOLD = X'40' CONTINUE TRACE AFTER ERRORS         @Y17XARA * 11240000
*        3. ALL  = X'FF' ALL TRACES                          @Y17XARA * 11250000
*        4. OFF  = X'00' NO TRACES                           @Y17XARA * 11260000
*    RESPONSE :                                              @Y17XARA * 11270000
*        1. IED018I TRACE COMMAND INVALID                    @Y17XARA   11272000
*        2. IED024I TRACE ALREADY STARTED FOR ERROR ,        @Y17XARA   11274000
*        3. IED030I TRACE ALREADY STOPPED FOR ERROR ,        @Y17XARA   11276000
*        4. IED055I I/O TRACE CANNOT BE ALTERED              @Y17XARA   11278000
*        5. IED546I I/O ERROR TRACE STARTED OPT=(ON,POST,ALL)@Y17XARA * 11280000
*        6. IED547I I/O ERROR TRACE STOPPED                  @Y17XARA * 11290000
*                                                            @Y17XARA * 11300000
*   IF REQUEST IS SUCCESSFUL EITHER MESSAGE NUMBER 23 OR 29 IS LOADED * 11400022
*   INTO REGISTER 0, THE WTG FIELD IN THE OPCE IS SET UP SO THAT      * 11700022
*   IGCM110D GAINS CONTROL AFTER XCTLING TO IGC0610D THE CHECKPOINT   * 12000022
*    ROUTINE PASSING IN OPCCOPCE IN OPCAVT THE ADDRESS OF RECORD TO   * 12300022
*   CHECKPOINT.                                                       * 12600022
*                                                                     * 12900022
*   NOTES -                                                           * 12920000
*           REGISTER CONVENTIONS = SEE REGISTER DECLARES       @Y17XARW 12940000
*                                                                     * 12960000
*           PATCH LABEL = ZAPAREA                              @Y17XARW 12980000
*                                                                     * 13000000
*   MODULE TYPE - PROCEDURE                                    @Y17XARW 13020000
*           PROCESSOR = ASSEMBLER XF                           @Y17XARW 13040000
*                                                                     * 13060000
*           MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY       @Y17XARW 13080000
*                                                                     * 13100000
* ENTRY POINTS -                                                      * 13200022
*         IGCM610D IS THE ONLY ENTRY POINT FOR THIS MODULE            * 13500022
*                                                                     * 13800022
*         LINKAGE - IGCMM10D XCTL'S TO IGCM610D                @Y17XARW 13850000
*                   IGCM610D XCTL'S TO IGCMB10D FOR LGBS       @Y17XARW 13900000
*                   IGCM610D XCTL'S TO IGC0610D FOR DCBS AND   @Y17XARW 13950000
*                   THEN TO IGCM110D FOR MSG PROCESSING        @Y17XARW 14000000
*                                                                     * 14050000
* INPUT -                                                             * 14100022
*    REGISTER 1 CONTAINS A POINTER TO THE OPERATOR CONTROL AVT        * 14400022
*    OCMODNME - FIRST WORD CONTAINS LENGTH OF REMAINING         S22024* 14500022
*               OPERANDS IN TRACE COMMAND                       S22024* 14600022
*    OCBACKUP - GRPNAME OR ADDRESS                             @Y17XARW 14606000
*    OCRLN    - RELATIVE LINE NUMBER                           @Y17XARW 14612000
*    OPCCOPCE - ADDRESS OF CURRENT ELEMENT                     @Y17XARW 14618000
*                                                                     * 14624000
* OUTPUT -                                                            * 14630000
*    EXIT TO IGCMB10D -                                               * 14636000
*                 R10= BYTES LEFT TO SCAN                      @Y17XARW 14642000
*                 R11= PTR TO NEXT BYTE SCAN                   @Y17XARW 14648000
*                 OCLINTTE= LINE TTE ADDRESS                   @Y17XARW 14654000
*                 OCBACKUP= GRPNME                             @Y17XARW 14660000
*   EXIT TO IGC0610D -                                                * 14666000
*                 R0 = MESSAGE TO BE WRITTEN                   @Y17XARW 14672000
*                 R1 = OP CONTROL AVT ADDRESS                  @Y17XARW 14678000
*                 OPCCOPCE= ADDRESS OF RECORD TO BE WRITTEN    @Y17XARW 14684000
*                 OCWTG= ID OF NEXT MODULE TO GAIN CONTROL     @Y17XARW 14690000
*                 OCBACKUP = GRPNAME                           @Y17XART 15590000
*                                                                     * 16500022
* EXTERNAL REFERENCES --                                              * 16800022
*         SVC 7(XCTL)                                                 * 17100022
*         OPCDCBLK - DCB LOOKUP ROUTINE IN IEDQCA                     * 17400022
*                                                                     * 17700022
* EXITS,NORMAL --                                                     * 18000022
*              STATUS MODIFIED AS REQUESTED. RESPONSE BUILT           * 18300022
*         IGC0610D - CHECKPOINT - TO CHECKPOINT RECORD WHOSE ADDRESS  * 18600022
*                    IS AT OPCCOPCE IN OPCAVT                         * 18900022
*         IGCMB10D - HANDLES ALL LGB PROCESSING                @Y17XARW 19000000
*                                                                     * 19100000
* EXITS,ERROR --                                                      * 19200022
*              INVALID COMMAND. XCTL TO IGC0310D                      * 19500022
*                                                                     * 19800022
* TABLES/WORKAREAS -                                                  * 20100022
*    TCAM AVT, OP CONTROL AVT,DCB,LCB,LGB,OPCE TNT             @Y17XARW 20400000
*                                                                     * 20700022
* ATTRIBUTES -                                                        * 21000022
*   REFRESHABLE,DISABLED,REUSABLE,TRANSIENT(TYPE 4),SUPERVISOR MODE   * 21300022
*                                                                     * 21900022
* CHARACTER CODE DEPENDENCY --                                        * 22200022
*    THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL            * 22500022
*    REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT * 22800022
*    TO THAT USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED SO  * 23100022
*    THAT REDEFINITION OF CHARACTER CONSTANTS, BY REASSEMBLY, WILL    * 23400022
*    RESULT IN A CORRECT MODULE FOR THE NEW DEFINITION.               * 23700022
*                                                                     * 24000022
* NOTES -                                                             * 24300022
*    COMMUNICATIONS BETWEEN THE VARIOUS MODULES/TRANSIENTS IS         * 24600022
*    PRIMARILY THROUGH THE OPERATOR CONTROL ADDRESS VECTOR TABLE (AVT)* 24900022
*                                                                     * 25200022
*        THIS IS A MODULE RE-WRITE OF IEDQCP AS OF OS/TCAM LEVEL II   * 25300022
*********************************************************************** 25500022
         EJECT                                                          25800022
         SPACE                                                          26100022
RZERO    EQU   0                        PARM REG 0                      26400022
RPARM    EQU   1                        PARM REG 1                      26700022
ROPT     EQU   1                        OPTION REG 1           @Y17XARA 26800000
ROPCAVT  EQU   2                        OP CONTROL AVT POINTER          27000022
ROPCE    EQU   3                        CURRENT ELEMENT ADDRESS         27300022
RAVT     EQU   4                        TCAM AVT ADDRESS                27600022
RUCB     EQU   5                        UCB BASE               @OY15041 27700000
RWORK5   EQU   RUCB                     WORK REGISTER          @OY15041 27900000
RWORK6   EQU   6                        WORK REGISTER                   28200022
RDCB     EQU   7                        DCB BASE                        28500022
RWORK8   EQU   8                        WORK REGISTER                   28800022
RLCB     EQU   9                        LCB BASE                        29100022
RWORK10  EQU   10                       WORK REGISTER                   29400022
RWORK11  EQU   11                       WORK REGISTER                   29700022
RBASE    EQU   12                       MODULE BASE                     30000022
RSAVE    EQU   13                       SAVE AREA POINTER               30300022
RRET     EQU   14                       SUBROUTINE RETURN ADDRESS       30600022
RBRNCH   EQU   15                       SUBROUTINE BRANCH ENTRY POINT   30900022
         SPACE                                                          31500022
****    MISCELLANEOUS EQUATES    ****                                   31800022
ZERO     EQU   0                        ZERO VALUE                      32100022
ONE      EQU   1                        VALUE ONE                       32400022
TWO      EQU   2                        VALUE TWO                       32700022
THREE    EQU   3                        VALUE THREE                     33000022
VARINAME EQU   3                        OFFSET TO CHANGE XCTL NAME      33300022
FOUR     EQU   4                        VALUE FOUR                      33600022
SEVEN    EQU   7                        VALUE SEVEN                     33900022
EIGHT    EQU   8                        VALUE EIGHT                     34200022
TEN      EQU   10                       VALUE TEN                       34500022
TWELVE   EQU   12                       VALUE TWELVE                    34800022
TWENTY4  EQU   24                       VALUE TWENTY FOUR               35700022
BLANK    EQU   C' '                     CHARACTER BLANK                 37200022
X80      EQU   X'80'                    HEX 80                   S22024 37300022
LTPCI    EQU   4                        FLAG BYTE IN I/O TIME  @XA11945 37308058
LTINUSE  EQU   X'01'                    ENTRY IN USE FLAG      @XA11945 37316058
LTCUU    EQU   0                        CUU OF TRACE ENTRY     @XA11945 37324058
ENDTAB   EQU   X'FF'                    END OF TABLE INDICATOR @XA11945 37332058
LTLCBAD  EQU   8                        LCB ADDRESS            @XA11945 37340058
LTSIZE   EQU   8                        SIZE OF ENTRY          @OY15041 37348000
MASK8    EQU   B'1000'                  HI-ORDER BYTE MASK     @Y17XARW 37354000
         SPACE 3                                               @Y17XARA 37364000
IED017I  EQU   17                       MSG IED017I EQU        @Y17XARA 37374000
IED018I  EQU   18                       MSG IED018I EQU        @Y17XARA 37384000
IED023I  EQU   23                       MSG IED023I EQU        @Y17XARA 37394000
IED024I  EQU   24                       MSG IED024I EQU        @Y17XARA 37404000
IED029I  EQU   29                       MSG IED029I EQU        @Y17XARA 37414000
IED030I  EQU   30                       MSG IED030I EQU        @Y17XARA 37424000
IED055I  EQU   55                       MSG IED055I EQU        @Y17XARA 37434000
IED537I  EQU   537                      MSG IED537I EQU        @Y17XARA 37444000
IED538I  EQU   538                      MSG IED538I EQU        @Y17XARA 37500000
IED546I  EQU   546                      MSG IED546I EQU        @Y17XARA 37570000
IED547I  EQU   547                      MSG IED547I EQU        @Y17XARA 37640000
         EJECT                                                 @Y17XARA 37710000
         USING IEDQAVTD,RAVT            TCAM AVT ADDRESSABILITY         37800022
         USING IEDQOPCD,ROPCAVT         OP CONTROL AVT ADDRESSABILITY   38100022
         USING IEDQOPCN,ROPCE           OPCE NEGATIVE PREFIX   @Y17XARW 38400000
         USING IEDQLCB,RLCB             ADDRESSABILITY FOR LCB          38700022
         USING IHADCB,RDCB              ADDRESSABILITY FOR DCB          39000022
         USING OPTFLAG,ROPT             AVTSUBT OR AVTIOTR     @Y17XARA 39100000
         USING IGCM610D,RBASE                                  @Y17XARA 39300000
         SPACE 1                                               @Y17XARA 40300000
         LR    RBASE,RBRNCH             LOAD BASE REGISTER     @Y17XARA 40800000
IGCM610D IEDHJN SKIPID                                         @Y17XARA 41300000
         LR    ROPCAVT,RPARM            SET BASE FOR OP CTL AVT         42000022
         L     RAVT,OPCAVTPT            SET BASE FOR TCAM AVT           42300022
         L     ROPCE,OPCCOPCE           GET ELEMENT POINTER             42600022
         LA    RWORK8,OCPREFSZ          SETUP NEG PREF SIZE    @Y17XARW 42700000
         SR    ROPCE,RWORK8             BACKUP TO NEG PREF     @Y17XARW 42800000
         LA    RSAVE,OPCSAVE            ADDRESS OF OP/CTL SAVE @Y17XARA 42800500
         CLI   OCSWITCH,OCSUBT          DTRACE= COMMAND        @Y17XARA 42801000
         BNE   TESTIOTR                 NO , TEST FOR ERROR    @Y17XARA 42802000
         CLC   AVTDISTR,AVTFZERO        SUBTASK TRACE TABLE    @Y17XARA 42803000
         BE    NOWAY                    NO CANNOT MODIFY TRACE @Y17XARA 42804000
         LA    ROPT,AVTSUBT             LOAD ADDRESS AVTSUBT   @Y17XARA 42805000
         CLC   POST,OCBACKUP            POST SPECIFIED         @Y17XARA 42806000
         BNE   TESTALL                  NO , TEST FOR ALL      @Y17XARA 42807000
         B     TESTOPT                  BRANCH TO TEST OPTION  @Y17XARA 42808000
TESTIOTR EQU   *                                               @Y17XARA 42809000
         CLI   OCSWITCH,OCIOTR          TRACE=ERROR, COMMAND   @Y17XARA 42810000
         BNE   NOTIOTR                  NO , PROCESS NORMALLY  @Y17XARA 42811000
         CLC   AVTRACE,AVTFZERO         I/O TRACE TABLE        @Y17XARA 42812000
         BE    NOWAY                    NO CANNOT MODIFY TRACE @Y17XARA 42813000
         LA    ROPT,AVTIOTR             LOAD ADDRESS AVTIOTR   @Y17XARA 42814000
         CLC   HOLD,OCBACKUP            HOLD SPECIFIED         @Y17XARA 42815000
         BNE   TESTALL                  NO , TEST FOR ALL      @Y17XARA 42816000
TESTOPT  EQU   *                                               @Y17XARA 42817000
         TM    OPTFLAG,OPTALL-(OPT1+OPT2) POST + OR HOLD +     @Y17XARA 42818000
         BNZ   STOPALL2                 YES                    @Y17XARA 42819000
         TM    OPTFLAG,OPT1+OPT2        ALREADY SPECIFIED      @Y17XARA 42820000
         BO    ALON                     YES , SET RESPONSE     @Y17XARA 42821000
         OI    OPTFLAG,OPT1+OPT2        SET OPTION ON          @Y17XARA 42822000
         B     TRACESTR                 GO ISSUE SUCESSFUL MSG @Y17XARA 42823000
STOPALL2 EQU   *                                               @Y17XARA 42824000
         NI    OPTFLAG,OPT1+OPT2        RESET TO HOLD OR POST  @Y17XARA 42825000
         B     TRACESTR                 GO ISSUE SUCESSFUL MSG @Y17XARA 42826000
TESTALL  EQU   *                                               @Y17XARA 42827000
         CLC   ALL,OCBACKUP             ALL SPECIFIED          @Y17XARA 42828000
         BNE   TESTON                   NO , TEST FOR ON       @Y17XARA 42829000
         TM    OPTFLAG,OPTALL           ALL ALREADY SPECIFIED  @Y17XARA 42830000
         BO    ALON                     YES , SET RESPONSE     @Y17XARA 42831000
         MVI   OPTFLAG,OPTALL           SET OPTION TO ALL      @Y17XARA 42832000
         B     TRACESTR                 GO ISSUE SUCESSFUL MSG @Y17XARA 42833000
TESTON   EQU   *                                               @Y17XARA 42834000
         CLC   ON,OCBACKUP              ON SPECIFIED           @Y17XARA 42835000
         BNE   NOTON                    NO , TEST FOR OFF      @Y17XARA 42836000
         TM    OPTFLAG,(OPTALL-OPT1)    ON + SPECIFIED         @Y17XARA 42837000
         BNZ   STOPALL1                 YES , STOP OTHER TRACE @Y17XARA 42838000
         TM    OPTFLAG,OPT1             ON ALREADY SPECIFIED   @Y17XARA 42839000
         BO    ALON                     YES , SET RESPONSE     @Y17XARA 42840000
         OI    OPTFLAG,OPT1             SET OPTION TO ON       @Y17XARA 42841000
         B     TRACESTR                 GO ISSUE SUCESSFUL MSG @Y17XARA 42842000
STOPALL1 EQU   *                                               @Y17XARA 42843000
         NI    OPTFLAG,OPT1             SET TRACE OPTION TO ON @Y17XARA 42844000
TRACESTR EQU   *                                               @Y17XARA 42845000
         LA    RZERO,IED546I            SET TO TRACE=ERROR CMD @Y17XARA 42846000
         CLI   OCSWITCH,OCIOTR          ERROR , COMMAND        @Y17XARA 42847000
         BE    XCTLMOD                  YES,ISSUE SUCESSFUL MSG@Y17XARA 42848000
         LA    RWORK5,IED537I           SET TO DTRACE = MSG    @Y17XARA 42849000
         B     TRACEALT                 POST UNIT TO IGG019RO  @Y17XARA 42850000
NOTON    EQU   *                                               @Y17XARA 42851000
         CLC   OFF,OCBACKUP             OFF SPECIFIED          @Y17XARA 42852000
         BNE   CMDINV                   NO , COMMAND INVALID   @Y17XARA 42853000
         TM    OPTFLAG,OPTALL           OPTION OFF SPECIFIED   @Y17XARA 42854000
         BZ    ALOF                     YES , SET RESPONSE     @Y17XARA 42855000
         MVI   OPTFLAG,OPTOFF           SET TRACE OPTION TO OFF@Y17XARA 42856000
         LA    RZERO,IED547I            SET TO TRACE=ERROR CMD @Y17XARA 42857000
         CLI   OCSWITCH,OCIOTR          ERROR , COMMAND        @Y17XARA 42858000
         BE    XCTLMOD                  YES,ISSUE SUCESSFUL MSG@Y17XARA 42859000
         LA    RWORK5,IED538I           SET TO DTRACE = MSG    @Y17XARA 42860000
TRACEALT EQU   *                                               @Y17XARA 42861000
         LA    RPARM,ONE                SET COUNT TO ONE       @Y17XARA 42862000
         L     RBRNCH,OPCGETBF          ADDRESS OF ALLOCBUF    @Y17XARA 42863000
         BALR  RRET,RBRNCH              GET AVAILABLE UNIT     @Y17XARA 42864000
         LR    RZERO,RWORK5             RESTORE MESSAGE NUMBER @Y17XARA 42865000
         USING IEDQPRF,RPARM            USING AVAILABLE UNIT   @Y17XARA 42866000
         L     RWORK5,AVTEA             ADDRESS OF DISPATCHER  @Y17XARA 42867000
         USING IEDQDISP,RWORK5          USING DISPATCHER DSECT @Y17XARA 42868000
         MVC   PRFQCBA,DSPTRACE+1       DSPTRACE QCB ADDRESS   @Y17XARA 42869000
         MVI   PRFPRI,PRITRACE          SET PRIORITY           @Y17XARA 42870000
         XC    PRFLCB,PRFLCB            ZERO LCB ADDRESS       @Y17XARA 42871000
         DROP  RWORK5                   DROP DISPATCHER DSECT  @Y17XARA 42872000
         L     RWORK5,CVTPTR            ADDRESS OF CVT         @Y17XARA 42873000
         USING IEDQCVT,RWORK5           USING CVT DSECT        @Y17XARA 42874000
         L     RWORK5,CVTAQAVT          ADDRESS OF TCX         @Y17XARA 42875000
         USING IEDQTCX,RWORK5           USING TCX              @Y17XARA 42876000
         L     RWORK6,TCXREADY          ADDRESS OF CURRENT     @Y17XARA 42877000
NEWCURRT STCM  RWORK6,SEVEN,PRFLINK     LINK NEW TO CURRENT    @Y17XARA 42878000
         CS    RWORK6,RPARM,TCXREADY    UPDATE ASSYNC ?        @Y17XARA 42879000
         BNE   NEWCURRT                 NO , NEW CURRENT       @Y17XARA 42880000
         DROP  RPARM                    DROP BUFFER DSECT      @Y17XARA 42881000
         B     XCTLMOD                  CONTINUE               @Y17XARA 42882000
NOTIOTR  EQU   *                                               @Y17XARA 42883000
         MVI   OPCDOUBL,BLANK          BLANK OUT OPC FIELD              42900022
         MVC   OPCDOUBL+ONE(SEVEN),OPCDOUBL FOR SUBROUTINE USE          43200022
         TM    OCFLAG,OCLINE            CHECK FOR LINE NUMBER           43500022
         BNO   DDTIOT                   NOT LINE NUMBER - BYPASS CONVER 43800022
         LA    RDCB,OPCDOUBL           SET UP                           44100022
         LA    RWORK8,OCLINENO          TO CONVERT HEX                  44400022
         LA    RLCB,TWO                  LINE ADDRESS                   44700022
         BAL   RWORK10,HEXTOBCD            TO EBCDIC                    45000022
         MVC   OPCDOUBL(FOUR),OPCDOUBL+ONE MAKE LINE NUMBER THREE BYTES 45300022
         SR    RPARM,RPARM             SET UP FOR                       45600022
         B     LINENO                   GO GET DCB ADDR FROM LINE NO    45900022
DDTIOT   EQU   *                                                        46200022
         MVC   OPCDOUBL,OCBACKUP        DDNAME FOR DCB LOOKUP RTNS22024 46500022
         SR    RPARM,RPARM              CLEAR REG                       49200022
         IC    RPARM,OCRLN              GET RLN NO FOR DCB LOOKUP RTN   49500022
LINENO   EQU   *                                                        49800022
         L     RBRNCH,OPCDCBLK         GET DCB RTN ADDRESS              50400022
         LA    ROPCE,OCPREFSZ(ROPCE)   POINT TO OPCE          @YM06880  50500000
         BALR  RRET,RBRNCH             BR TO DCB LOOKUP RTN             50700022
         B     GOODRTN                  GOOD RETURN                     51000022
INVALID  EQU   *                                                 S05331 51100005
         LA    RZERO,IED017I            SET ERROR MESSAGE      @Y17XARA 51300000
         B     XCTLERR                  BR TO OUTPUT ERROR MSG          51600022
****    GOOD RETURN FROM DCB LOOKUP     ****                            51900000
GOODRTN  EQU   *                                                        52200022
         LA    RWORK8,OCPREFSZ          OPCE NEG PREFIX SIZE   &YM06880 52300000
         SR    ROPCE,RWORK8             BACK UP TO PREFIX      &YM06880 52400000
         LR    RUCB,RZERO               SET UCB BASE           @OY15041 52450000
         LR    RDCB,RPARM               SET DCB BASE                    52500022
         TM    DCBDSORG,X80             TEST FOR 3705 LGB        S22024 52580022
         BNO   NOTLGB                   NO, DCB CONTINUE         S22024 52620022
         ICM   RZERO,MASK8,CLEARB       CLEAR HI-ORDER BYTE    @Y17XARW 52620700
         ST    RZERO,OCLINTTE           SAVE LINE TTE IN OPCE  @Y17XARW 52621400
         NI    OCSWITCH,ENDTAB-OCSCANON TURN SCAN OFF          @Y17XARW 52622100
         MVC   OPCLDNME+THREE(TWO),LTRC3705  3705 TRACE MOD NAME S22024 52660022
         B     EXIT                     GO DO XCTL               S22024 52700022
NOTLGB   EQU   *                                                 S22024 52740022
         CLC   OCMODNME(FOUR),AVTFZERO  ANY OPERANDS REMAINING ? S22024 52760022
         BNE   CMDINV                   YES, COMMAND INVALID     S22024 52780022
         L     RLCB,DCBIOBAD            GET IOB                         52800022
         LA    RLCB,ZERO(RLCB)          CLEAR HI-ORDER BYTE             53100022
         SR    RZERO,RZERO              CLEAR REG                       53400022
         IC    RZERO,OCRLN              INSERT RLN                      53700022
         SR    RPARM,RPARM              ZERO REG                        54000022
         IC    RPARM,DCBEIOBX           GET IOB LENGTH                  54300022
         MR    RZERO,RZERO              MULTIPLY IOB BY RLN             54600022
         AR    RLCB,RPARM               ADD RESULTS TO IOB ADDRESS      54900022
         LA    RWORK8,LCBFLAG1-IEDQLCB  GET LENGTH OF IOB               55200022
         SR    RLCB,RWORK8              GET TO LCB START                55500022
         CLC   AVTRACE,AVTFZERO         TRACE TABLE SPECIFIED  @Y17XARA 55800000
         BZ    NOWAY                    NO, CANNOT MODIFY TRACE         56400022
         SR    RPARM,RPARM              CLEAR WORK REGISTER    @SA77825 56450000
         IC    RPARM,DCBEIOBX           INSERT IOB LENGTH      @SA77825 56500000
         SH    RPARM,HA8                LOCATE LCB EXTENSION   @SA77825 56550000
         AR    RPARM,RLCB               SET EXTENSION BASE     @SA77825 56600000
         USING IEDQLCBX,RPARM                                  @SA77825 56650000
         CLI   OCSWITCH,OCX19           TRACE ON OR OFF        @Y17XARA 56700000
         BE    OFFT                     OFF - GO PROCESS                57000022
         TM    LCBSTAT2,LCBTRACE        TRACE ALREADY ON                57300022
         BO    ALON                     YES - RESPOND ALREADY ON        57600022
         L     RWORK10,LCBSTAT2-THREE   LOAD FLAG WORD VALUE   @OZ26897 57630011
COPYOFF  EQU   *                                               @Z30X8RR 57660000
         LR    RWORK11,RWORK10          MAKE COPY FOR SETTING  @Z30X8RR 57690000
*                                       LCBTRACE BIT           @Z30X8RR 57720000
         O     RWORK11,TRACEON          SET LCBTRANE ON IN COPY@Z30X8RR 57750000
         CS    RWORK10,RWORK11,LCBSTAT2-THREE  IF LCB FIELD    @OZ26897 57780011
*                                       UNCHANGED,STORE FROM   @Z30X8RR 57810000
*                                       REG WITH LCBTRACE ON   @Z30X8RR 57840000
         BNE   COPYOFF                  ELSE,LOOP TO PRESERVE  @Z30X8RR 57870000
         LA    RZERO,IED023I            SET TRACE STARTED      @Y17XARA 58200000
         B     XCTLMOD                  EXIT                            58800022
OFFT     EQU   *                                                        59100022
         TM    LCBSTAT2,LCBTRACE        TRACE ALREADY OFF      @Y17XARA 59400000
         BNO   ALOF                     YES - SET RESPONSE     @Y17XARA 59700000
SETOFF   EQU   *                                               @YA12276 59710000
         L     RWORK10,LCBSTAT2-THREE   SAVE VALUE OF LCBSTAT2 @Z30X8RR 59720000
COPYON   EQU   *                                               @Z30X8RR 59730000
         LR    RWORK11,RWORK10          MAKE COPY FOR SETTING  @Z30X8RR 59740000
*                                       LCBTRACE BIT           @Z30X8RR 59750000
         N     RWORK11,TRACEOFF         SET LCBTRACE OFF IN    @Z30X8RR 59760000
*                                       COPY                   @Z30X8RR 59770000
         CS    RWORK10,RWORK11,LCBSTAT2-THREE IF LCB FIELD     @Z30X8RR 59780000
*                                       UNCHANGED,STORE FROM   @Z30X8RR 59790000
*                                       REG WITH LCBTRACE ON   @Z30X8RR 59800000
         BNE   COPYON                   ELSE,LOOP TO PRESERVE  @Z30X8RR 59810000
*                                       UPDATED LCB FIELD      @Z30X8RR 59820000
         L     RWORK10,LCBXCON          SAVE FLAG WORD VALUE   @SA77825 59830000
REQON    EQU   *                                               @YA12276 59840000
         LR    RWORK11,RWORK10          MAKE COPY FOR SETTING  @YA12276 59850000
         N     RWORK11,REQOFF           SET REQUEST OFF@YA12276         59860000
         CS    RWORK10,RWORK11,LCBXCON  RESET TRACE REQUESTED  @SA77825 59870000
         DROP  RPARM                                           @SA77825 59880000
         BNE   REQON                    LOOP TO PRESERVE LCB   @YA12276 59890000
         LA    RZERO,IED029I            SET TRACE STOPPED      @Y17XARA 60300000
         L     RPARM,AVTIOT                                    @XA11945 60620058
         L     RPARM,FOUR(,RPARM)       ADDR OF TRACE TBL SIZE @XA11945 60660058
GETNEXT  EQU   *                                               @XA11945 60680058
         LA    RPARM,LTSIZE(,RPARM)     LOOK AT FIRST/NEXT ENTR@XA11945 60700058
         CLI   LTCUU(RPARM),ENDTAB      END OF TABLE           @XA11945 60720058
         BE    XCTLMOD                  BRANCH YES             @XA11945 60740058
         TM    LTPCI(RPARM),LTINUSE     IS ENTRY BEING USED    @XA11945 60760058
         BZ    GETNEXT                  BRANCH NO-NEXT         @XA11945 60780058
         USING IEDQUCB,RUCB             ADDRESSABILITY FOR UCB @OY15041 60790000
         CLC   UCBCHA(TWO),LTCUU(RPARM) IS ENTRY FOR THIS UCB  @OY15041 60800000
         BNE   GETNEXT                  BRANCH NO              @XA11945 60840058
         MVI   LTPCI(RPARM),ZERO        FREE ENTRY             @XA11945 60860058
****    EXIT TO CHECKPOINT INCIDENT    ****                             60900022
XCTLMOD  EQU   *                                                        61200022
         STH   RZERO,OCPARM             SAVE MESSAGE NUMBER    @Y17XARA 61300000
         MVC   OCWTG(TWO),WRTMOD        SET RETURN TO WRT MSG MOD       61500022
         MVC   OPCLDNME+VARINAME(TWO),CKPTMOD SET XCTL TO CKPOINT MOD   61800022
EXIT     EQU   *                                                        62100022
         LR    RPARM,ROPCAVT            PASS OP CTL AVT PTR             62400022
         XCTL  SF=(E,OPCXCTL)           CALL NXT MODULE                 62700022
CMDINV   EQU   *                                                 S22024 62770022
         LA    RZERO,IED018I            SET COMMAND INVALID    @Y17XARA 62840000
         B     XCTLERR                  EXIT ERROR               S22024 62910022
ALON     EQU   *                                                        63000022
         LA    RZERO,IED024I            SET ALREADY ON RESPONSE@Y17XARA 63300000
         B     XCTLERRX                 EXIT ERROR             @Y17XARA 63600000
ALOF     EQU   *                                                        63900022
         LA    RZERO,IED030I            SET ALREADY OFF RESPONS@Y17XARA 64200000
         B     XCTLERRX                 EXIT ERROR             @Y17XARA 64500000
NOWAY    EQU   *                                                        64800022
         LA    RZERO,IED055I            SET CANT BE STARTED    @Y17XARA 65100000
         B     XCTLERR                  EXIT ERROR             @Y17XARA 65120000
XCTLERRX EQU   *                                               @Y17XARA 65140000
         CLI   OCSWITCH,OCSUBT          DTRACE = COMMAND       @Y17XARA 65160000
         BNE   XCTLIOTR                 NO , CHECK FOR ERROR , @Y17XARA 65180000
         MVC   OCBACKUP,DTRACE          MOVE DTRACE = TO MSG   @Y17XARA 65220000
         B     XCTLERR                  EXIT ERROR             @Y17XARA 65240000
XCTLIOTR EQU   *                                               @Y17XARA 65260000
         CLI   OCSWITCH,OCIOTR          TRACE=ERROR, COMMAND   @Y17XARA 65280000
         BNE   XCTLERR                  NO , CONTINUE          @Y17XARA 65300000
         MVC   OCBACKUP,ERROR           MOVE ERROR , TO MSG    @Y17XARA 65340000
XCTLERR  EQU   *                        EXIT ERROR             @Y17XARA 65400000
         MVC   OPCLDNME+THREE(TWO),ERRWRT SET UP FOR XCTL TO ERR WRT    65700022
         B     EXIT                     EXIT                            66000022
         EJECT                                                          66300022
**********************************************************************  66600022
* HEXTOBCD -   PARAMETERS PASSED IN REGS 7-10                        *  66900022
* HEX TO EBCDIC - SINK-R7 SOURCE-R8 COUNT-R9 RETURN-RA               *  67200022
*        SINK   - LOCATION FOR CONVERTED DATA - MUST BE AT LEAST     *  67500022
*                 TWICE THE SIZE OF COUNT.                           *  67800022
*        SOURCE - LOCATION WHERE HEX DATA IS STORED                  *  68100022
*        COUNT  - SIZE OF SOURCE AREA - IN BYTES                     *  68400022
*        RETURN - RETURN IS MADE TO THIS LOCATION                    *  68700022
**********************************************************************  69000022
         SPACE                                                          69300022
R1       EQU   13                       REGISTER 13                     69600022
R2       EQU   14                       REGISTER 14                     69900022
R3       EQU   15                       REGISTER 15                     70200022
R4       EQU   4                        REGISTER 4                      70500022
R5       EQU   5                        REGISTER 5                      70800022
R6       EQU   6                        REGISTER 6                      71100022
R7       EQU   7                        REGISTER 7                      71400022
R8       EQU   8                        REGISTER 8                      71700022
R9       EQU   9                        REGISTER 9                      72000022
RA       EQU   10                       REGISTER 10                     72300022
ONE99    EQU   199                      ONE HUNDRED NINTY NINE          72600022
TWO50    EQU   250                      TWO HUNDRED FIFTY               72900022
         SPACE                                                          73200022
         SPACE                                                          73500022
HEXTOBCD EQU   *                                                        73800022
         STM   R1,R3,OPCSAVE            SAVE CALLERS                    74100022
         STM   R4,R6,OPCSAVE+TWELVE        REGISTERS                    74400022
         LA    R1,TEN                  SET UP REGISTERS                 74700022
         LA    R4,TWO50                  FOR CONVERSION                 75000022
         LA    R5,ONE99                     CALCULATION                 75300022
         SPACE                                                          75600022
XX       IC    R3,ZERO(R8)             PICK UP HEX CHARS                75900022
         SLL   R3,TWENTY4              SET UP TO PICK                   76200022
         LA    R6,TWO                  SET TWO PASSES TO CONVERT BYTE   76500022
         SPACE                                                          76800022
YY       SR    R2,R2                     FIRST FOUR                     77100022
         SLDL  R2,FOUR                     BITS TO BE CONVERTED         77400022
         SR    R2,R1                   IS HEX CHAR 0-9                  77700022
         BM    ZZ                      YES, CONVERT TO FX               78000022
         AR    R2,R5                   NO, SET UP TO CONVERT TO CX      78300022
         SPACE                                                          78600022
ZZ       AR    R2,R4                   CONVERT                          78900022
         STC   R2,ZERO(R7)             STORE CONVERTED CHAR IN SINK     79200022
         LA    R7,ONE(R7)              BUMP SINK POINTER                79500022
         BCT   R6,YY                   BR TO PROCESS NEXT 4 BITS        79800022
         LA    R8,ONE(R8)              BUMP SOURCE POINTER              80100022
         BCT   R9,XX                   BR IF MORE DATA TO CONVERT       80400022
         LM    R1,R3,OPCSAVE            RESTORE CALLERS                 80700022
         LM    R4,R6,OPCSAVE+TWELVE        REGISTERS                    81000022
         BR    RA                      RETURN TO CALLER                 81300022
         SPACE                                                          81600022
**********************************************************************  81900022
TRACEON  DS    0F                                              @Z30X8RR 81930000
         DC    X'00000080'              TRACE REQUESTED        @OZ26897 81960011
TRACEOFF DS    0F                                              @Z30X8RR 81990000
         DC    X'FFFFFF7F'              TRACE NOT ACTIVE       @Z30X8RR 82020000
REQOFF   DS    0F                                              @YA12276 82050000
         DC    X'FEFFFFFF'              REQUEST NOT ACTIVE     @SA77825 82080000
HA8      DC    H'0008'                  HALFWORD 8             @SA77825 82110000
WRTMOD   DC    C'M1'                    MODIFY WRIGHT MODULE            82200022
ERRWRT   DC    C'03'                    ERROR WRIGHT MODULE             82500022
CKPTMOD  DC    C'06'                    INCIDENT CHECKPOINT INTERFACE   82800022
LTRC3705 DC    C'MB'                    3705 GOTRACE/NOTRACE MOD S22024 82900022
CLEARB   DC    X'00'                    CLEARS HI-ORDER BYTE   @Y17XARW 82920000
ALL      DC    C'ALL'                   ALL  OPTION            @Y17XARA 82922000
HOLD     DC    C'HOLD'                  HOLD OPTION            @Y17XARA 82924000
POST     DC    C'POST'                  POST OPTION            @Y17XARA 82926000
OFF      DC    C'OFF'                   OFF  OPTION            @Y17XARA 82928000
ON       DC    C'ON'                    ON   OPTION            @Y17XARA 82930000
DTRACE   DC    CL8'DTRACE ='            DTRACE =               @Y17XARA 82932000
ERROR    DC    CL8'ERROR ,'             TRACE=ERROR,           @Y17XARA 82934000
         SPACE 3                                               @Y17XARA 82936000
ZAPAREA  DC    50X'00'                  ZAPAREA                @Y17XARW 82940000
         SPACE 3                                               @Y17XARA 82941000
OPTFIELD DSECT                                                 @Y17XARA 82942000
OPTFLAG  DS    CL1                      DTRACE= OR ERROR FLAG  @Y17XARA 82943000
OPTALL   EQU   255                      ALL TRACES             @Y17XARA 82944000
OPT1     EQU   128                      OPTION 1               @Y17XARA 82945000
OPT2     EQU   64                       OPTION 2               @Y17XARA 82946000
OPT3     EQU   32                       OPTION 3               @Y17XARA 82947000
OPT4     EQU   16                       OPTION 4               @Y17XARA 82948000
OPT5     EQU   8                        OPTION 5               @Y17XARA 82949000
OPT6     EQU   4                        OPTION 6               @Y17XARA 82950000
OPT7     EQU   2                        OPTION 7               @Y17XARA 82951000
OPT8     EQU   1                        OPTION 8               @Y17XARA 82952000
OPTOFF   EQU   0                        NO TRACES              @Y17XARA 82953000
         EJECT                                                          82960005
         TAVTD                                                          83020005
         EJECT                                                 @Y17XARA 83040000
IEDQCVT  CVT                           DSECT CVT               @Y17XARA 83060000
         EJECT                                                          83100022
         DCBD  DSORG=TX                                                 83400022
         EJECT                                                          83700022
         TDISPD                        DSECT DISPATCHER        @Y17XARA 83760000
         EJECT                                                 @Y17XARA 83820000
         TPRIOR                        DSECT PRIORITY          @Y17XADA 83880000
         EJECT                                                 @Y17XADA 83940000
         TLCBD                                                          84000022
         EJECT                                                          84300022
         TLGBD                                                          84600005
         EJECT                                                          84900022
         TPRFD                         DSECT BUFFER PREFIX     @Y17XARA 85000000
         EJECT                                                 @Y17XARA 85100000
         TOPCED                                                         85200000
         EJECT                                                          85500022
         TOPCAVTD                                                       85800000
         EJECT                                                          86100022
         TTCXD SVS                     DSECT TCX               @Y17XARA 86200000
         EJECT                                                 @Y17XARA 86300000
         TTNTD                                                          86400022
         EJECT                                                 @OY15041 86470000
IEDQUCB  DSECT                                                 @OY15041 86540000
         IEFUCBOB                                              @OY15041 86610000
         END                                                            86700022
