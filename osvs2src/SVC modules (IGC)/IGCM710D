         TITLE 'IGCM710D - MODIFY PRIMARY/3705 SET TIMEDATE'            00000710
*A000000-999999                                                  S99240 00001410
*D616000                                                        SA59165 00002110
*A622000                                                        SA59165 00002810
*C601000                                                       @Y17XARZ 00003510
*C724800-727000                                                @0Y12425 00004210
*D505900                                                       @0Y12425 00004910
*A016000,505600,531200,600000,784000,804280,884180             @Y17XARY 00005610
*C724400,725800-726600,804300,805980-806120,806460-806520      @Y17XARY 00006310
*D531200                                                       @Y17XARY 00007010
*********************************************************************** 00007710
*                                                                     * 00008410
*                                                                     * 00009110
* MODULE NAME = IGCM710D (TCAM,OPERATOR CONTOL)                @Y17XARY 00009810
*                                                                     * 00010510
* DESCRIPTIVE NAME = MODIFY PRIMARY/3705 SET TIME DATE         @Y17XARY 00011210
*                                                                     * 00011910
* COPYRIGHT = NONE                                             @Y17XARY 00012610
*                                                                     * 00013310
* STATUS = VERSION 10.0                                        @Y17XARY 00014010
*                                                                     * 00014710
*                                                                     * 00015410
* FUNCTION - THIS ROUTINE PROCESSES OPERATOR CONTROL COMMANDS WHICH   * 00016110
*   REQUEST THAT THE TIME AND DATE BE SET IN THE 3705 AND WHICH  S22024 00016810
*   REQUEST THE PRIMARY OPERATOR CONTROL TERMINAL BE CHANGED FROM ITS * 00017510
*   CURRENT MEMBER TO THE ONE SPECIFIED IN THE COMMAND. IGCM710D      * 00018210
*   RECEIVES CONTROL FROM THE MODIFY SCAN/MAP MODULE (IGCMA10D).      * 00018910
*                                                                     * 00019610
*   THIS ROUTINE CHECKS THE ELEMENT (OPCE) TO DETERMINE IF THE        * 00020310
*   REQUEST IS FOR PRIMARY CHANGE AND IF SO DETERMINES IF THE    S22024 00021010
*   REQUESTED PRIMARY TERMINAL IS THE SYSTEM CONSOLE. IF IT IS, THE   * 00021710
*   PRIMARY OFFSET IN THE AVT (AVTOPCON) IS CHECKED FOR ZERO. IF ZERO,* 00022410
*   THE CONSOLE IS ALREADY PRIMARY. A MESSAGE NUMBER IS SET IN REG 0  * 00023110
*   AND XCTL IS TO IGC0310D.                                          * 00023810
*                                                                     * 00024510
*   IF THE SYSTEM CONSOLE IS NOT ALREADY PRIMARY, AVTOPCON IS SET TO  * 00025210
*   ZERO. IF THE OPERATOR AWARENESS WRITER MODULE IS IN THE SYSTEM    * 00025910
*   (AVTNX IS NOT ZERO) THE IEDQNX ROUTINE IS DELETED AND AVTNX IS SET* 00026610
*   TO ZERO. A MESSAGE NUMBER IS SET IN OCPARM, OCWTG IS SET TO M1 AND* 00027310
*   XCTL IS TO THE OP CTL INCIDENT CHECKPOINT INTERFACE ROUTINE.      * 00028010
*                                                                     * 00028710
*   IF THE PRIMARY REQUESTED IS NOT SYSCON, THE TERMINAL IS LOCATED   * 00029410
*   AND TESTED FOR VALID SECONDARY TERMINAL.(TRMSCNYN SET IN TRMSTATE)* 00030110
*   IF NOT, AN ERROR MSG IS SET IN REG 0 AND XCTL IS TO IGC0310D.     * 00030810
*                                                                     * 00031510
*   THE ENTRY OFFSET FROM THE START OF THE TERMNAME TABLE IS COMPARED * 00032210
*   TO AVTOPCON. IF THEY ARE THE SAME, THE TERMINAL IS ALREADY PRIMARY* 00032910
*   AND A MESSAGE NUMBER INDICATING THIS IS SET IN REGISTER 0 AND XCTL* 00033610
*   IS TO IGC0310D. OTHERWISE, THE NEW OFFSET IS PLACED IN AVTOPCON,  * 00034310
*   AND AVTNX IS TESTED FOR THE PRESENCE OF THE IEDQNX ROUTINE. IF IT * 00035010
*   IS NOT IN THE SYSTEM, THE IEDQNX ROUTINE IS LOADED AND ITS ADDRESS* 00035710
*   STORED IN AVTNX. A MESSAGE NUMBER IS SET IN OCPARM,OCWTG IS SET TO* 00036410
*   M1, AND XCTL IS TO MODULE IGC0610D (THE OP CTL CKPT INTERFACE RTN)* 00037110
*                                                                S22024 00037810
*   IF THE REQUEST IS FOR 3705 TIME/DATE SET, THIS ROUTINE       S22024 00038510
*   ISSUES A TIME MACRO TO OBTAIN THE SYSTEM TIME AND DATE,      S22024 00039210
*   FORMATS THE DATE/TIME ALONG WITH A REQUEST BTU AND DISPATCHESS22024 00039910
*   THIS REQUEST TO THE  3705 BY XCTLING TO IGC0210D. WHEN THE   S22024 00040610
*   RESPONSE BTU IS RECEIVED FROM THE 3705, VIA IGC0210D, IT IS  S22024 00041310
*   EXAMINED FOR ERRORS. IF NO ERROR OCCURED, A TIME/DATE SET    S22024 00042010
*   RESPONSE IS SET IN REG ZERO AND XCTL IS TO IGCM310D. IF THE  S22024 00042710
*   RESPONSE BTU INDICATES AN ERROR CONDITION, THE ERROR RESPONSES22024 00043410
*   IS SET AND XCTL IS TO IGC0310D.                              S22024 00044110
*                                                                     * 00044810
*   MESSAGES INITIATED BY THIS MODULE ARE:                            * 00045510
*     ERROR INDICATIONS                                               * 00046210
*        IED016I STATION XXXXXXXX NOT FOUND                           * 00046910
*        IED044I XXXXXXXX NOT ELIGIBLE FOR PRIMARY                    * 00047610
*        IED042I XXXXXXXX ALREADY PRIMARY                             * 00048310
*        IED173I XXXXXXXX NOT VALID 3705 - COMMAND REJECTED      S22024 00049010
*        IED199I CONTROL CMD XX MOD XX FOR XXXXXXXX ERROR        S22024 00049710
*                RESPONSE XXXX                                   S22024 00050410
*     SUCCESS INDICATIONS                                        S22024 00051110
*        IED041I PRIMARY=XXXXXXXX                                     * 00051810
*        IED200I XXXXXXXX TIME AND DATE SET                      S22024 00052510
*                                                                     * 00053210
* ENTRY POINTS -                                                      * 00053910
*   IGCM710D IS THE ONLY ENTRY POINT FOR THIS MODULE                  * 00054610
*                                                                     * 00055310
* INPUT - REG 1 CONTAINES A POINTER TO THE OPERATOR CONTROL AVT.      * 00056010
*                                                                     * 00056710
* OUTPUT - PASSES OP CTL AVT ADDRESS IN REG 1.                        * 00057410
*                                                                     * 00058110
* EXTERNAL REFERENCES -- XCTL(SVC 7),LOAD(SVC 8),DELETE(SVC 9)        * 00058810
*   AND TIME(SVC 11)                                             S22024 00059510
*   IEDQCA'S SUBROUTINES                                              * 00060210
*        TRMOFLOC--VALIDITY CHECKS TERMINAL NAME PASSED TO IT. RETURNS* 00060910
*                  ADDRESS OF TERMINAL ENTRY IF VALID. IF NOT VALID   * 00061610
*                  RETURNS PLUS 4 OF RETURN ADDRESS IN REGISTER 14.   * 00062310
*                                                                     * 00063010
*        DCBLOCAT--VALIDITY CHECKS HARDWARE LINE ADDRESSES, GROUPNAMES* 00063710
*                  AND RELATIVE LINE NUMBERS. ALSO INSURES LINE DCBS  * 00064410
*                  ARE OPEN, RLN IS NOT MORE THAN NUMBER OF EXTENTS,  * 00065110
*                  AND LINE WAS NOT OPENED DUMMY. FOR ANY OF THESE    * 00065810
*                  ERRORS RETURNS PLUS 4 OF RETURN ADDRESS IN R14.    * 00066510
*                             GOOD RETURN- R0= UCB ADDRESS            * 00067210
*                                          R1= DCB ADDRESS            * 00067910
*                                                                     * 00068610
*                                                                     * 00069310
* EXITS,NORMAL - FOR THE TIME/DATE OPERATION, EXIT IS TO THE BTU S22024 00070010
*   DISPATCHER (IGC0210D) TO XMIT THE REQUEST BTU TO THE 3705.   S22024 00070710
*   UPON COMPLETION OF THE TIME/DATE FUNCTION, THE TIME AND DATE S22024 00071410
*   SET MESSAGE NUMBER IS PLACED IN REG ZERO, AND XCTL IS TO     S22024 00072110
*   IGCM310D. FOR MODIFY PRIMARY, THE MESSAGE NUMBER IS PLACED INS22024 00072810
*   THE ELEMENTS OCPARM FIELD, THE ELEMENTS OCWTG FIELD IS SET TO M1  * 00073510
*   AND AN XCTL (SVC 7) IS MADE TO THE OP CTL INCIDENT CHECKPOINT     * 00074210
*   ROUTINE (IGC0610D), REG 1 = @ OP CTL AVT.                         * 00074910
*                                                                     * 00075610
* EXITS,ERROR - THE ERROR MESSAGE NUMBER IS PLACED IN REGISTER 0,     * 00076310
*   THE OP CTL AVT ADDRESS IN REG 1 AND XCTL IS TO THE OP CTL ERROR   * 00077010
*   MESSAGE MODULE (IGC0310D).                                        * 00077710
*                                                                     * 00078410
* TABLES/WORK AREAS - OPERATOR CONTROL AVT, TCAM AVT, OPCE, OPERATOR  * 00079110
*   CONTROL RESIDENT WORK AREA, DCB, LCB, LGB, AND BTU.          S22024 00079810
*                                                                     * 00080510
* ATTRIBUTES - SUPERVISOR MODE, DISABLED, TRANSIENT(TYPE 4 SVC), NON- * 00081210
*             REENTRANT, SERIALLY REUSABLE, REFRESHABLE.              * 00081910
*                                                                     * 00082610
* CHARACTER CODE DEPENDENCY --                                        * 00083310
*    THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL            * 00084010
*    REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT * 00084710
*    TO THAT USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED SO  * 00085410
*    THAT REDEFINITION OF CHARACTER CONSTANTS, BY REASSEMBLY, WILL    * 00086110
*    RESULT IN A CORRECT MODULE FOR THE NEW DEFINITION.               * 00086810
*                                                                     * 00087510
* NOTES -                                                             * 00088210
*    COMMUNICATIONS BETWEEN THE VARIOUS MODULES/TRANSIENTS IS         * 00088910
*    PRIMARILY THROUGH THE OPERATOR CONTROL ADDRESS VECTOR TABLE (AVT)* 00089610
*                                                                     * 00090310
*        THIS IS A MODULE REWRITE OF IEDQCN AS OF OS/TCAM LEVEL II    * 00091010
*********************************************************************** 00091710
         EJECT                                                          00092410
IGCM710D CSECT                                                          00093110
         SPACE                                                          00093810
RZERO    EQU   0                        PARM REG 0                      00094510
RPARM    EQU   1                        PARM REG 1                      00095210
ROPCAVT  EQU   2                        OP CONTROL AVT POINTER          00095910
ROPCE    EQU   3                        CURRENT ELEMENT ADDRESS         00096610
RAVT     EQU   4                        TCAM AVT ADDRESS                00097310
RTNT     EQU   5                        TERN NAME TABLE BASE            00098010
RTERM    EQU   6                        TERMENTRY BASE                  00098710
RWORK7   EQU   7                        WORK REGISTER                   00099410
RDCB     EQU   7                        LGB BASE                 S22024 00100110
RWORK8   EQU   8                        WORK REGISTER                   00100810
RWORK9   EQU   9                        WORK REGISTER                   00101510
RWORK10  EQU   10                       WORK REGISTER                   00102210
RWORK11  EQU   11                       WORK REGISTER                   00102910
RSAVE    EQU   13                       SAVE AREA POINTER        S22024 00103610
RBASE    EQU   12                       MODULE BASE                     00104310
RRET     EQU   14                       SUBROUTINE RETURN ADDRESS       00105010
RBRNCH   EQU   15                       SUBROUTINE BRANCH ENTRY POINT   00105710
         SPACE                                                          00106410
****    MISCELLANEOUS EQUATES    ****                                   00107110
         SPACE                                                          00107810
ZERO     EQU   0                        ZERO VALUE                      00108510
ONE      EQU   1                        VALUE ONE                       00109210
TWO      EQU   2                        VALUE TWO                       00109910
THREE    EQU   3                        VALUE THREE                     00110610
VARINAME EQU   3                        OFFSET TO CHANGE XCTL NAME      00111310
FOUR     EQU   4                        VALUE FOUR                      00112010
X14      EQU   X'14'                    HEX '14'                        00112710
SIXTEEN  EQU   16                       VALUE SISTEEN                   00113410
FORTY1   EQU   41                       VALUE FORTY ONE                 00114110
FORTY2   EQU   42                       VALUE FORTY TWO                 00114810
FORTY4   EQU   44                       VALUE FORTY FOUR                00115510
FIVE     EQU   5                        VALUE 5                  S22024 00116210
SIX      EQU   6                        VALUE 6                  S22024 00116910
SEVEN    EQU   7                        VALUE 7                  S22024 00117610
EIGHT    EQU   8                        VALUE 8                  S22024 00118310
NINE     EQU   9                        VALUE 9                  S22024 00119010
ELEVEN   EQU   11                       VALUE 11                 S22024 00119710
TWELVE   EQU   12                       VALUE TWELVE             S22024 00120410
THIRTEEN EQU   13                       VALUE 13                 S22024 00121110
FORTEEN  EQU   14                       VALUE 14                 S22024 00121810
FIFTEEN  EQU   15                       VALUE 15                 S22024 00122510
SEVNTEEN EQU   17                       VALUE SEVENTEEN          S22024 00123210
EIGHTEEN EQU   18                       VALUE 18                 S22024 00123910
NINETEEN EQU   19                       VALUE NINETEEN           S22024 00124610
TWENTY   EQU   20                       VALUE 20                 S22024 00125310
TWENTY1  EQU   21                       VALUE 21                 S22024 00126010
TWENTY4  EQU   24                       OFFSET TWENTY FOUR       S22024 00126710
TWENTY6  EQU   26                       VALUE 26               @Y17XARY 00127410
THIRTY1  EQU   31                       VALUE 31                 S22024 00128110
THIRTY4  EQU   34                       VALUE 34                 S22024 00128810
TWO40    EQU   X'F0'                    TWO HUNDRED FORTY        S22024 00129510
X01      EQU   X'01'                    HEX 01                   S22024 00130210
X04      EQU   X'04'                    HEX 04                   S22024 00130910
X09      EQU   X'09'                    HEX 09                   S22024 00131610
X18      EQU   X'18'                    HEX 18                   S22024 00132310
X60      EQU   X'60'                    HEX 60                   S22024 00133010
X80      EQU   X'80'                    HEX 80                   S22024 00133710
PERIOD   EQU   C'.'                     PERIOD                   S22024 00134410
SLASH    EQU   C'/'                     SLASH                    S22024 00135110
ZONE     EQU   X'F0'                    DECIMAL ZONE             S22024 00135810
PLUS     EQU   X'0F'                    DECIMAL PLUS SIGN        S22024 00136510
PRIBTU   EQU   X'E0'                    POST PRIORITY FOR BTU    S22024 00137210
ONE73    EQU   173                      VALUE 173                S22024 00137910
ONE99    EQU   199                      ONE HUNDRED NINTY NINE   S22024 00138610
TWOM     EQU   200                      TWO HUNDRED              S22024 00139310
         EJECT                                                          00140010
         USING IEDQAVTD,RAVT            TCAM AVT ADDRESSABILITY         00140710
         USING IEDQOPCD,ROPCAVT         OP CONTROL AVT ADDRESSABILITY   00141410
         USING IEDQOPCE,ROPCE           ELEMENT ADDRESSABILITY          00142110
         USING IEDQTNTD,RTNT            TERM NAME ADDRESSABILITY        00142810
         USING IEDNTRM,RTERM                                            00143510
         USING IEDNLGB,RDCB             LGB ADDRESSABILITY       S22024 00144210
         USING IHADCB,RWORK7            DCB ADDRESSABILITY       S22024 00144910
         USING IEDQLCB,RWORK8           LCB ADDRESSABILITY       S22024 00145610
         USING IEDPRUND,RPARM           RU ADDRESSABILITY      @Y17XARY 00146310
         USING IEDNSVTD,RWORK10         SAVT ADDRESSABILITY    @Y17XARY 00147010
         SPACE                                                          00147710
         BALR  RBASE,0                  SET BASE REGISTER               00148410
         USING *,RBASE                  MODULE ADDRESSABILITY           00149110
A        EQU   *                                                        00149810
IGCM710D IEDHJN SKIPID                                                  00150510
         LR    ROPCAVT,RPARM            SET BASE FOR OP CTL AVT         00151210
         L     RAVT,OPCAVTPT            SET BASE FOR TCAM AVT           00151910
         L     ROPCE,OPCCOPCE           PICK UP ELEMENT POINTER         00152610
         CLI   OCSWITCH,X18             TEST FOR TIMDAT COMMAND  S22024 00153310
         BE    TD3705                   YES, GO GET TIME & DATE  S22024 00154010
         CLI   OCSWITCH,X14             CHANGE TO CONSOLE ?             00154710
         BNE   GETTRM                   NO - FIND TERM ENTRY            00155410
         SR    RWORK7,RWORK7            CLEAR REG                       00156110
         CH    RWORK7,AVTOPCON          ALREADY CONSOLE                 00156810
         BE    ALR                      YES - PUT PROPER MSG            00157510
         STH   RWORK7,AVTOPCON          CLEAR AVT FIELD - DEFAULT       00158210
         STH   RWORK7,AVTOPCIN          CLEAR AVT FIELD        @YM06091 00158910
         OC    AVTSEND,AVTSEND   IS 3705 IN THE SYSTEM         @Y17XARZ 00159610
         BNZ   MESSAGE                  YES, DON'T DELETE IEDQNX S22024 00160310
         CLC   AVTNX(FOUR),AVTFZERO     IEDQNX IN SYSTEM                00161010
         BE    MESSAGE                  NO - EXIT                       00161710
         LA    RWORK7,EPNX              GET ENTRY POINT                 00162410
         MVC   AVTNX(FOUR),AVTFZERO     CLEAR AVTNX FIELD               00163110
         DELETE EPLOC=(RWORK7)          DELETE IEDQNX           SA59165 00163810
         B     MESSAGE                  EXIT                            00164510
         SPACE                                                          00165210
****    GET TERMINAL ENTRY    ****                                      00165910
GETTRM   EQU   *                                                        00166610
         L     RTNT,AVTRNMPT            SET TNT BASE                    00167310
         LH    RWORK8,OCTRMTBL          GET TNT OFFSET FROM ELEMENT     00168010
         SLL   RWORK8,SIXTEEN           CLEAR OUT HI-ORDER              00168710
         SRL   RWORK8,SIXTEEN              SIXTEEN BITS                 00169410
         SR    RWORK7,RWORK7            CLEAR REG                       00170110
         IC    RWORK7,TNTENLEN          PICK UP ENTRY LENGTH            00170810
         LA    RWORK9,THREE(RWORK7)     ALLOW FOR ADDRESS               00171510
         BCTR  RWORK8,RZERO             REDUCE TNT OFFSET BY ONE        00172210
         MR    RWORK8,RWORK8            CALCULATE OFFSET                00172910
         LA    RWORK8,TNTFIRST          GET ADDRESS OF FIRST ENTRY      00173610
         AR    RWORK8,RWORK9            ADD OFFSET TO FIRST ENTRY       00174310
         LR    RWORK9,RWORK8            SAVE NAME POINTER               00175010
         AR    RWORK8,RWORK7            POINT TO ADDRESS OF TERM ENTRY  00175710
         MVC   OCBACKUP+ONE(THREE),ZERO(RWORK8) MOVE ADDRESS TO BNDRY   00176410
         L     RTERM,OCBACKUP           LOAD TERM ENTRY BASE            00177110
         LA    RTERM,ZERO(RTERM)        CLEAR HI-ORDER BYTE             00177810
         LA    RBRNCH,TRMPRFSZ          GET NEG PREFIX SIZE    @YM06469 00178510
         SR    RTERM,RBRNCH             BACK UP TO NEG PREFIX  @YM06469 00179210
         TM    TRMSTATE,TRMSCNYN        VALID SECONDARY                 00179910
         BZ    ERROR                    NO, ERROR                S22024 00180610
         TM    TRMDSORG,TRMLGB          ENTRY AN LGB ?           S22024 00181310
         BZ    SET                      NO, STORE OFFSET IN AVT  S22024 00182010
         SPACE                                                          00182710
ERROR    EQU   *                                                        00183410
         LA    RZERO,FORTY4             SET NOT ELIGIBLE FOR PRIMARY    00184110
         B     XCTLERR                  BR TO INDICATE ERROR            00184810
TD3705   EQU   *                                                 S22024 00185510
         TM    OCFLAG,OCRESP            TEST FOR RETURN PIU    @Y17XARY 00186210
         BO    RETRNBTU                 YES,PROCESS RTRND ELEM.  S22024 00186910
         TM    OCSCAN,OCNONAME          NOT DDNAME OR ADDRESS? @OY12425 00187610
         BO    NOTFOUND                 TRY NCP NAME           @OY12425 00188310
         L     RPARM,OCELEM             SETUP DCB ADDRESS      @OY12425 00189010
         B     GOODRTN                  GOOD RETURN,CONTINUE   @OY12425 00189710
NOTFOUND EQU   *                                               @OY12425 00190410
         LA    RSAVE,OPCSAVE            OP CTL SAVE AREA       @Y17XARY 00191110
         L     RBRNCH,OPCTOFLK          ADDR TO TNT OFFSET     @Y17XARY 00191810
         BALR  RRET,RBRNCH              TRMOFLOC SUBROUTINE    @Y17XARY 00192510
         B     RTNX                     YES,GET RESOURCE TYPE  @Y17XARY 00193210
         LA    RZERO,SEVNTEEN           SET NOT OPEN MESSAGE     S22024 00193910
         B     XCTLERR                  BR TO OUTPUT ERROR MSG   S22024 00194610
         SPACE                                                          00195310
         SPACE                                                          00196010
****    SET TERMINAL FOR PRIMARY    ****                                00196710
SET      EQU   *                                                        00197410
         SR    RWORK9,RTNT              CALC OFFSET FROM TABLE START    00198110
         LR    RTNT,RWORK9              SAVE OFFSET                     00198810
         CH    RTNT,AVTOPCON            ALREADY THIS TERMINAL           00199510
         BE    ALR                      YES - PUT ALREADY MESSAGE       00200210
         CLC   AVTNX(FOUR),AVTFZERO     CHECK IEDQNX LOADED             00200910
         BNE   MESSAGE1                 YES - BYPASS LOAD               00201610
         LA    RWORK9,EPNX              GET ENTRY POINT                 00202310
         LOAD  EPLOC=(RWORK9)           LOAD IEDQNX                     00203010
         ST    RZERO,AVTNX              PUT ITS ADDRESS IN AVT          00203710
         SPACE                                                          00204410
MESSAGE1 EQU   *                                                        00205110
         STH   RTNT,AVTOPCON            PUT NEW OFFSET IN AVT           00205810
         LH    RWORK9,OCTRMTBL          TNT OFFSET TO TERMNAME @YM06156 00206510
         STH   RWORK9,AVTOPCIN          SAVE TNT INDEX         @YM06156 00207210
         SPACE                                                          00207910
MESSAGE  EQU   *                                                        00208610
         LA    RZERO,FORTY1             SET PRIMARY =                   00209310
         STH   RZERO,OCPARM               FOR MESSAGE MODULE            00210010
         MVC   OCBACKUP(EIGHT),OPCDOUBL  SAVE TERMINAL NAME    @YM06497 00210710
         B     XCTLOK                   BR TO EXIT                      00211410
         SPACE                                                          00212110
GOODRTN  EQU   *                                                 S22024 00212810
         LR    RWORK7,RPARM             SET DCB BASE             S22024 00213510
         TM    DCBDSORG,X80             CK FOR DCB               S22024 00214210
         BO    NO3705                   NOT DCB - ERROR          S22024 00214910
         TM    DCBDSORG+ONE,X04         IS IT 3705               S22024 00215610
         BNO   NO3705                   NO - ERROR               S22024 00216310
         SR    RPARM,RPARM              ZERO REG FOR IC          S22024 00217010
         IC    RPARM,DCBEIOBX           GET IOB LENGTH           S22024 00217710
         L     RWORK8,DCBIOBAD          GET IOB                  S22024 00218410
         LA    RWORK8,ZERO(RWORK8)      CLEAR HI-ORDER BYTE      S22024 00219110
         AR    RWORK8,RPARM             ADD LENGTH TO IOB ADDR   S22024 00219810
         LA    RWORK7,LCBFLAG1-IEDQLCB  IOB/LCB OFFSET           S22024 00220510
         SR    RWORK8,RWORK7            BACK UP TO START OF LCB  S22024 00221210
         LH    RPARM,LCBTTCIN         TERM CURR CONNECTED INDEX@Y17XARY 00221910
         STH   RPARM,OCTRMTBL           OFFSET IN TNT TO TNAME @Y17XARY 00222610
         L     RBRNCH,AVTRNMPT          TERM NAME TABLE ROUTINE@Y17XARY 00223310
         BALR  RRET,RBRNCH              GET TERMINAL ADDRESS   @Y17XARY 00224010
         SPACE                                                          00224710
RTNX     EQU   *                                               @Y17XARY 00225410
         LA    RWORK9,TRMPRFSZ          NEG PREFIX OF IEDQTRM  @Y17XARY 00226110
         SR    RPARM,RWORK9             GET NEGATIVE PREFIX    @Y17XARY 00226810
         LR    RTERM,RPARM                                     @Y17XARY 00227510
         CLI   TRMTYPE,TRMLNCP          NCP RESOURCE?          @YM06954 00228210
         BNE   NO3705                   NOT NCP                @YM06954 00228910
         SR    RPARM,RPARM              CLEAR REGISTER         @Y17XARY 00229610
         LH    RPARM,OCTRMTBL           OFFSET IN TNT TO TNAME @Y17XARY 00230310
         L     RWORK10,AVTSAVTP         SECONDARY AVT POINTER  @Y17XARY 00231010
         L     RBRNCH,SAVTTNTX          TTCIN TO NA CONVERSION @Y17XARY 00231710
         BALR  RRET,RBRNCH              GO TO CONVERSION RTINE @Y17XARY 00232410
         STH   RBRNCH,OCRSID            STORE NETWORK ADDRESS  @Y17XARY 00233110
**************************************************************** S22024 00233810
*  THE FOLLOWING ROUTINE GETS THE TIME AND DATE AND MAPS         S22024 00234510
*  SAME INTO REQUIRED FORMAT FOR TEXT OF THE SET TIME/DATE       S22024 00235210
*  OP CTL COMMAND FOR THE 3705.                                  S22024 00235910
**************************************************************** S22024 00236610
         SPACE                                                          00237310
         TIME  DEC                      ISSUE TIME MACRO         S22024 00238010
         L     RWORK11,OPCWORK          GET WORK AREA ADDRESS    S22024 00238710
         LA    RWORK11,TWENTY4(RWORK11) BUMP BY TWENTY FOUR      S22024 00239410
         USING TIMEDATE,RWORK11                                  S22024 00240110
         ST    RZERO,TDTIME             SAVE TIME FOR LATER USE  S22024 00240810
         SR    RZERO,RZERO              CLEAR REGISTER           S22024 00241510
         ST    RZERO,TDDOUBL            ZERO FIRST WORD OF AREA  S22024 00242210
         SLDL  RZERO,SIXTEEN            SHIFT YEAR INTO RZERO    S22024 00242910
         SLL   RZERO,FOUR               MAKE ROOM FOR SIGN       S22024 00243610
         SRL   RPARM,SIXTEEN            RIGHT-JUSTIFY DAY IN REG S22024 00244310
         SPACE 1                                                        00245010
*              WE NOW HAVE THE YEAR IN RZERO AND THE JULIAN DAY  S22024 00245710
*              IN RPARM, BOTH IN PACKED FORMAT (EXCEPT THAT THE  S22024 00246410
*              SIGN ON THE YEAR IS INVALID).                     S22024 00247110
         SPACE 1                                                        00247810
         STM   RZERO,RPARM,TDSAVEY      SAVE YEAR & JULIAN DATE  S22024 00248510
         OI    TDSAVEY+THREE,PLUS       PUT VALID SIGN ON YEAR   S22024 00249210
         MVC   TDDOUBL+FOUR(FOUR),TDSAVEJ  MOVE DAYS TO AREA     S22024 00249910
         CVB   RTERM,TDDOUBL            CONVERT DAYS TO BINARY   S22024 00250610
         MVC   TDDOUBL+FOUR(FOUR),TDSAVEY  MOVE YEAR TO AREA     S22024 00251310
         CVB   RZERO,TDDOUBL            CONVERT YEAR TO BINARY   S22024 00252010
         SR    RPARM,RPARM              CLEAR REG                S22024 00252710
         SRDL  RZERO,TWO                DIVIDE BY FOUR           S22024 00253410
         LTR   RPARM,RPARM              ANY REMAINDER            S22024 00254110
         BNZ   NOLEAP                   YES - ITS NOT LEAP YEAR  S22024 00254810
         LA    RPARM,ONE(RPARM)         SET UP FOR LEAP YEAR     S22024 00255510
         SPACE                                                          00256210
NOLEAP   EQU   *                                                 S22024 00256910
         LA    RWORK7,ONE               LOAD  MONTH REG          S22024 00257610
         LA    RWORK10,MONTHS           GET ADDRESS OF D/MO TBL  S22024 00258310
         LA    RWORK9,TWELVE            LOAD NUM OF MONTHS       S22024 00259010
         SR    RWORK8,RWORK8            CLEAR REGISTER           S22024 00259710
         SPACE                                                          00260410
MODAY    EQU   *                                                 S22024 00261110
         AH    RWORK8,ZERO(RWORK10)     ADD NUM DAYS IN MONTH    S22024 00261810
         CR    RTERM,RWORK8             IS THIS CORRECT MONTH    S22024 00262510
         BNH   FOUND                    YES, BR TO FIG DAY OF MO S22024 00263210
         BCT   RPARM,LEAPNOT            BR NOT LEAP YEAR         S22024 00263910
         LA    RWORK8,ONE(RWORK8)       ADD ONE DAY FOR LEAP YR  S22024 00264610
         SPACE                                                          00265310
LEAPNOT  EQU   *                                                 S22024 00266010
         LA    RWORK7,ONE(RWORK7)       ADD ONE TO MONTH         S22024 00266710
         LA    RWORK10,TWO(RWORK10)     BUMP MONTH TBL POINTER   S22024 00267410
         BCT   RWORK9,MODAY             LOOP THRU MONTHS         S22024 00268110
         SPACE                                                          00268810
FOUND    EQU   *                                                 S22024 00269510
         AH    RTERM,ZERO(RWORK10)      ADJUST FOR DAY CALC      S22024 00270210
         SR    RTERM,RWORK8             CALC DAY OF MONTH        S22024 00270910
         CVD   RWORK7,TDDOUBL           CONVERT MONTH TO PACKED  S22024 00271610
         UNPK  TDMONTH,TDDOUBL+SIX(TWO) UNPACK MONTH             S22024 00272310
         OI    TDMONTH+ONE,ZONE         CHANGE TO PRINTABLE      S22024 00273010
         MVI   TDSLASH1,SLASH           INSERT SLASH             S22024 00273710
         CVD   RTERM,TDDOUBL            CONVERT DAY-OF-MONTH     S22024 00274410
         UNPK  TDDAY,TDDOUBL+SIX(TWO)   UNPACK DAY-OF-MONTH      S22024 00275110
         OI    TDDAY+ONE,ZONE           CHANGE TO PRINTABLE      S22024 00275810
         MVI   TDSLASH2,SLASH           INSERT SLASH             S22024 00276510
         UNPK  TDYEAR,TDSAVEY+TWO(TWO)  UNPACK YEAR              S22024 00277210
         MVI   TDDOT1,PERIOD            INSERT PERIOD            S22024 00277910
         UNPK  TDJULIAN,TDSAVEJ+TWO(TWO)  UNPACK JULIAN DAY      S22024 00278610
         UNPK  TDHOUR(THREE),TDTIME(TWO)  UNPACK HOUR            S22024 00279310
         MVI   TDDOT2,PERIOD            INSERT PERIOD            S22024 00280010
         UNPK  TDMINUTE(THREE),TDTIME+ONE(TWO)  UNPACK MINUTE    S22024 00280710
         MVI   TDDOT3,PERIOD            INSERT PERIOD            S22024 00281410
         UNPK  TDSECOND(THREE),TDTIME+TWO(TWO)  UNPACK SECOND    S22024 00282110
         SPACE                                                          00282810
**************************************************************** S22024 00283510
*  THIS ROUTINE OBTAINS A UNIT AND SETS UP A SET TIME/DATE       S22024 00284210
*  BTU.  STORES THE ADDRESS OF THIS BTU IN THE TIMEDAT ELEMENT,  S22024 00284910
*  AND SETS UP XCTL TO IGC0210D.                                 S22024 00285610
**************************************************************** S22024 00286310
         SPACE                                                          00287010
         LA    RPARM,ONE                SET NUM UNITS REQUESTED  S22024 00287710
         L     RBRNCH,OPCGETBF          LOAD GET BUFF RTN ADDR   S22024 00288410
         BALR  RRET,RBRNCH              LINK TO GET BUFFER       S22024 00289110
         ST    RPARM,OCUNIT             SET BFR ADDR TO ELEMENT  S22024 00289810
         LA    RWORK9,PRUNLEN           NEGATIVE PREFIX LENGTH @Y17XARY 00290510
         SR    RPARM,RWORK9             GET NEG PREFIX OF BUFF @Y17XARY 00291210
         XC    IEDPRUND(PRUNLEN),IEDPRUND  ZERO OUT NEG PREFIX @Y17XARY 00291910
         MVC   PRURHTH,PRUVALUE         SET RH AND TH FIELDS   @Y17XARY 00292610
         MVC   PRUTTCIN,OCTRMTBL        SET RETURN RESPONSE    @Y17XARY 00293310
         MVI   PRUDATCT,ZERO            SET DATA COUNT, BYTE 1 @YM06519 00294010
         MVI   PRUDATCT+ONE,TWENTY6     SET DATA COUNT         @Y17XARY 00294710
         MVC   PRUTIC(FOUR),INVALTIC    INDICATES ONE UNIT     @Y17XARY 00295410
         MVC   PRUDATA(THREE),RUCMDCDE  RU COMMAND CODE        @Y17XARY 00296110
         MVC   PRUDATA+THREE(TWO),OCRSID   NETWORK ADDRESS     @Y17XARY 00296810
         MVI   PRUDATA+FIVE,X01         RU COMMAND CODE        @Y17XARY 00297510
         MVC   PRUDATA+SIX(TWENTY),ZERO(RWORK11)  DATE AND TIME@Y17XARY 00298210
         MVC   OCWTG(TWO),THISMOD       SET RETURN TO THIS MOD   S22024 00298910
         OI    OCFLAG,X01               FLAG ELEMENT FOR RETURN  S22024 00299610
         MVC   OPCLDNME+VARINAME(TWO),BTUDISP SET BTU DISPATCHER S22024 00300310
         SR    RZERO,RZERO              CLEAR REGISTER           S22024 00301010
         B     EXIT                     EXIT TO BTU DISPATCHER   S22024 00301710
         SPACE                                                          00302410
**************************************************************** S22024 00303110
*  THIS ROUTINE GETS CONTROL WHEN IT IS DETERMINED THAT THE      S22024 00303810
*  BTU BEING PROCESSED IS A RETURN BTU AND SETS UP TO INDICATE   S22024 00304510
*  RESULTS OF THE SET TIME/DATE REQUEST                          S22024 00305210
**************************************************************** S22024 00305910
         SPACE                                                          00306610
RETRNBTU EQU   *                                                 S22024 00307310
         L     RPARM,OCUNIT             GET BTU ADDRESS          S22024 00308010
         LA    RPARM,ZERO(RPARM)        CLEAR HI-ORDER BYTE      S22024 00308710
         LA    RWORK9,PRUNLEN           GET PACKED RU LENGTH   @Y17XARY 00309410
         SR    RPARM,RWORK9             GET NEGATIVE PREFIX    @Y17XARY 00310110
         TM    PRURHFG0,PRURHSDI        RH ERROR               @Y17XARY 00310810
         BO    NOTSET                   BAD RETURN - INDICATE  @Y17XARY 00311510
         LA    RZERO,TWOM               INDICATOR FOR T&D SET    S22024 00312210
         MVC   OPCLDNME+VARINAME(TWO),GOODM SET XCTL TO MSG MOD  S22024 00312910
         B     EXIT                     EXIT TO IND T&D SET      S22024 00313610
         SPACE                                                          00314310
NOTSET   EQU   *                                                 S22024 00315010
         LA    RZERO,ONE99              SET ERROR MSG NUMBER     S22024 00315710
         B     XCTLERR                  EXIT TO INDICATE ERROR   S22024 00316410
         SPACE                                                          00317110
NO3705   EQU   *                                                        00317810
         LA    RZERO,ONE73              SET NOT 3705             S22024 00318510
         B     XCTLERR                  EXIT TO INDICATE SAME    S22024 00319210
         SPACE                                                          00319910
COMINV   EQU   *                                                 S22024 00320610
         LA    RZERO,EIGHTEEN           SET CMD INVALID          S22024 00321310
         B     XCTLERR                  EXIT TO INDICATE SAME    S22024 00322010
         SPACE                                                          00322710
ALR      EQU   *                                                        00323410
         LA    RZERO,FORTY2             SET ALREADY PRIMARY             00324110
         SPACE                                                          00324810
XCTLERR  EQU   *                                                        00325510
         MVC   OPCLDNME+VARINAME(TWO),ERRWRT SET ERROR RESP MODULE      00326210
         B     EXIT                     EXIT                            00326910
         SPACE                                                          00327610
XCTLOK   EQU   *                                                        00328310
         MVC   OCWTG(TWO),OKWRT         SET RETURN TO WRT MSG MOD       00329010
         MVC   OPCLDNME+VARINAME(TWO),CKPTMOD SET XCTL TO CKPOINT MOD   00329710
         SPACE                                                          00330410
EXIT     EQU   *                                                        00331110
         LR    RPARM,ROPCAVT            PASS OP CTL AVT PTR             00331810
         XCTL  SF=(E,OPCXCTL)           CALL WRT MODULE                 00332510
         SPACE                                                          00333210
ERRWRT   DC    C'03'                    ERROR MESSAGE MODULE            00333910
OKWRT    DC    C'M1'                    MODIFY WRIGHT MODULE            00334610
CKPTMOD  DC    C'06'                    INCIDENT CHECKPOINT INTERFACE   00335310
EPNX     DC    C'IEDQNX  '              MODULE LOAD NAME                00336010
THISMOD  DC    C'M7'                    THIS MODULE NAME         S22024 00336710
BTUDISP  DC    C'02'                    BTU DISPATCHER MODULE    S22024 00337410
GOODM    DC    C'M3'                    MSG MODULE               S22024 00338110
PRUVALUE DC    X'0B80001C'              RH AND TH VALUES       @Y17XARY 00338810
RUCMDCDE DC    X'010211'                RU COMMAND CODE        @Y17XARY 00339510
INVALTIC DC    X'08000002'              INVALID TIC            @Y17XARY 00340210
         SPACE                                                          00340910
MONTHS   DS    0H                                              @YM06953 00341610
         DC    H'31'                    DAYS IN JAN              S22024 00342310
         DC    H'28'                    DAYS IN FEB              S22024 00343010
         DC    H'31'                    DAYS IN MAR              S22024 00343710
         DC    H'30'                    DAYS IN APR              S22024 00344410
         DC    H'31'                    DAYS IN MAY              S22024 00345110
         DC    H'30'                    DAYS IN JUN              S22024 00345810
         DC    H'31'                    DAYS IN JUL              S22024 00346510
         DC    H'31'                    DAYS IN AUG              S22024 00347210
         DC    H'30'                    DAYS IN SEP              S22024 00347910
         DC    H'31'                    DAYS IN OCT              S22024 00348610
         DC    H'30'                    DAYS IN NOV              S22024 00349310
         DC    H'31'                    DAYS IN DEC              S22024 00350010
         ORG   IGCM710D+X'3FF'          PATCH AREA               S22024 00350710
         DC    X'FF'                    PATCH AREA               S22024 00351410
         ORG                                                            00352110
         EJECT                                                          00352810
         DCBD  DSORG=TX                                          S22024 00353510
         EJECT                                                          00354210
         TLCBD                                                   S22024 00354910
         EJECT                                                          00355610
         TLGBD                                                   S22024 00356310
         EJECT                                                          00357010
         TPRUD                                                 @Y17XARY 00357710
         EJECT                                                          00358410
TIMEDATE DSECT                                                   S22024 00359110
TDMONTH  DS    CL2                      MONTH                    S22024 00359810
TDSLASH1 DS    CL1                      /                        S22024 00360510
TDDAY    DS    CL2                      DAY                      S22024 00361210
TDSLASH2 DS    CL1                      /                        S22024 00361910
TDYEAR   DS    CL2                      YEAR                     S22024 00362610
TDDOT1   DS    CL1                      .                        S22024 00363310
TDJULIAN DS    CL3                      JULIAN DAY               S22024 00364010
TDHOUR   DS    CL2                      HOUR                     S22024 00364710
TDDOT2   DS    CL1                      .                        S22024 00365410
TDMINUTE DS    CL2                      MINUTE                   S22024 00366110
TDDOT3   DS    CL1                      .                        S22024 00366810
TDSECOND DS    CL2                      SECOND                   S22024 00367510
*                                                                S22024 00368210
TDTIME   DS    F                        SAVE AREA FOR TIME       S22024 00368910
TDDOUBL  DS    D                        DOUBLE WORD FOR CVB,CVD  S22024 00369610
TDSAVEY  DS    F                        SAVE AREA FOR YEAR       S22024 00370310
TDSAVEJ  DS    F                        SAVE AREA FOR JULIAN DAY S22024 00371010
         DS    0D                                                S22024 00371710
UCACOREQ DS    CL12                     QCB ADDRESS              S22024 00372410
BTUOFF   DS    CL8                      BTU OFFSET               S22024 00373110
BTUSRC   DS    H                        BTU SOURCE               S22024 00373810
BTUDID   DS    H                        RSID                     S22024 00374510
BTURIDTG DS    H                        SEQUENCE NUMBER          S22024 00375210
BTUSLRSP DS    CL2                      SYS/LINE RESPONSE        S22024 00375910
BTUCMD   DS    C                        BTU COMMAND              S22024 00376610
BTUMODIF DS    C                        BTU COMMAND MODIFIER     S22024 00377310
BTUFNFLG DS    X                        FUNCTION FLAGS           S22024 00378010
BTUBDUFG DS    X                        BDU FLAGS                S22024 00378710
BTUCOUNT DS    H                        TEXT COUNT               S22024 00379410
BTUTXT   DS    X                        TEXT FIELD               S22024 00380110
         EJECT                                                          00380810
         TAVTD                                                          00381510
         EJECT                                                          00382210
         TOPCAVTD                                                       00382910
         EJECT                                                          00383610
         TOPCED                                                         00384310
         EJECT                                                          00385010
         TTNTD                                                          00385710
         EJECT                                                          00386410
         TTRMD                                                          00387110
         END                                                            00387810
