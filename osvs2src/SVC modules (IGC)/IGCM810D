         TITLE 'IGCM810D - MODIFY OPTIONS'                              00100022
IGCM810D CSECT                                                          00200022
*********************************************************************** 00300022
*                                                                     * 00400022
* MODULE NAME = IGCM810D (TCAM, OPERATOR CONTROL)              @Y17XART 00420000
*                                                              @Y17XART 00440000
* DESCRIPTIVE NAME = MODIFY OPTIONS                            @Y17XART 00460000
*                                                              @Y17XART 00480000
* COPYRIGHT = NONE                                             @Y17XART 00500000
*                                                              @Y17XART 00550000
* STATUS = VERSION 10.0                                        @Y17XART 00600000
*                                                                     * 00800022
* FUNCTION = THIS ROUTINE PROCESSES OPERATOR CONTROL COMMANDS WHICH   * 00900000
*   REQUEST MODIFICATION OF TERMINAL OPTION FIELDS. THIS MODULE IS    * 01000022
*   ENTERED FROM THE MODIFY SCAN/MAP ROUTINE (IGCMA10D)               * 01100022
*                                                                     * 01200022
*   THE MODIFY OPTIONS RECEIVES THE DATA PORTION OF COMMAND,IN EBCDIC * 01300022
*   FORM, IN THE OP CTL RESIDENT WORK AREA. THE COMMAND IS CHECKED FOR* 01400022
*   DATA TYPE, AND CONVERTED TO DESIRED FORMAT. IF THE DATA LENGTH    * 01500022
*   AFTER CONVERSION EXCEEDS EIGHT BYTES IN LENGTH, NECESSARY BUFFERS * 01600022
*   ARE OBTAINED AND CHAINED TO THE ELEMENT. THE DATA IS PLACED IN THE* 01700022
*   BUFFERS.                                                          * 01800022
*                                                                     * 01900022
*   THE TERMINAL ENTRY IS LOCATED AND CHECKED FOR OPTION FIELDS       * 02000022
*   PRESENT (TRMOPTFN ON IN TRMSTATE). A CHECK IS THEN MADE TO        * 02100022
*   DEDERMINE IF THE SPECIFIED OPTION FIELD HAS BEEN DEFINED FOR THE  * 02200022
*   TERMINAL.                                                         * 02300022
*   A CHECK IS MADE TO DETERMINE IF THE FIELD TYPE DEFINITION MATCHES * 02400022
*   THE DATA (FIELD IS DECIMAL BUT DATA IS CHARACTER - ERROR).        * 02500022
*   THE NEW OPTION DATA IS IS PLACED INTO THE OPTION FIELD,PROVIDED   * 02600022
*   THE OPTION FIELD IS LARGE ENOUGH. A MSG NUMBER IS SET IN OCPARM,  * 02700022
*   OCWTG IS SET TO M1 AND XCTL IS TO IGC0610D.                       * 02800022
*                                                                     * 02900022
*   IF THE REPLACEMENT DATA IS SHORTER IN LENGTH THAN THE SIZE DEFINED* 03000022
*   FOR THE OPTION FIELD, STANDARD PADDING IS USED ACCORDING TO       * 03100022
*   ASSEMBLER LANGUAGE STANDARDS.                                     * 03200022
*                                                                     * 03300022
*   CONDITION WHERE THE OPTION FIELD CANNOT BE MODIFIED ARE           * 03400022
*     1)-NO MATCHING ENTRY IN THE TERMNAME TABLE                      * 03500022
*        IED016I STATION XXXXXXXX NOT FOUND                           * 03600022
*     2)-NO OPTION FIELD WITH THE NAME SPECIFIED EXISTS FOR THIS TERM.* 03700022
*        IED034I XXXXXXXX HAS NO XXXXXXXX OPTION                      * 03800022
*     3)-THE DATA FORMAT SPECIFIED IN THE COMMAND DIFFERS FROM THE    * 03900022
*        OPTION FIELD FORMAT.                                         * 04000022
*        IED056I XXXXXXXX OPTION XXXXXXXX DATA FORMAT INVALID         * 04100022
*     4)-DATA TO REPLACE CURRENT SETTING IS GREATER IN LENGTH THAN    * 04200022
*        THE FIELD                                                    * 04300022
*        IED062I XXXXXXXX OPTION XXXXXXXX CANNOT ACCEPT SPECIFIED DATA* 04400022
*     5)-CONTENTS OF DATA DOES NOT AGREE WITH FRAMING CHARACTERS.     * 04500022
*        IED077I XXXXXXXX OPTION XXXXXXXX DATA CHARACTER INVALID      * 04600022
*                                                                     * 04700022
*     6) CONFIRMATION THAT THE REQUESTET ACTION WAS TAKEN.     @Y17XART 04800000
*        IED050I XXXXXXXX OPTION XXXXXXXX MODIFIED                    * 04900022
*                                                                     * 05000022
*                                                                     * 05100022
* ENTRY POINTS -                                                      * 05200022
*         IGCM810D IS THE ONLY ENTRY POINT FOR THIS MODULE            * 05300022
*                                                              @Y17XART 05310000
*         PURPOSE = SEE FUNCTION                               @Y17XART 05320000
*                                                              @Y17XART 05330000
*         LINKAGE = AT ENTRY GENERAL REGISTER FIFTEEN (15)     @Y17XART 05340000
*         CONTAINS THE ADDRESS OF THE ENTRY POINT OF THIS      @Y17XART 05350000
*         MODULE AND GENERAL REGISTER ONE (1) CONTAINS THE     @Y17XART 05360000
*         ADDRESS OF THE OPERATOR CONTROL ADDRESS VECTOR TABLE @Y17XART 05370000
*                                                                     * 05400022
* INPUT - REG 1 CONTAINS A POINTER TO THE OPERATOR CONTROL AVT.       * 05500000
*                                                                     * 05600022
* OUTPUT - PASSES OP CTL AVT ADDRESS IN REG 1.                        * 05700022
*                                                                     * 05800022
* EXTERNAL ROUTINES -                                                 * 05900022
*         SVC 7(XCTL)                                                 * 06000022
*   IEDQCA'S SUBROUTINES                                              * 06100022
*        TRMOFLOC--VALIDITY CHECKS TERMINAL NAME PASSED TO IT. RETURNS* 06200022
*                  ADDRESS OF TERMINAL ENTRY IF VALID. IF NOT VALID   * 06300022
*                  RETURNS PLUS 4 OF RETURN ADDRESS IN REGISTER 14.   * 06400022
*                                                                     * 06500022
*        DCBLOCAT--VALIDITY CHECKS HARDWARE LINE ADDRESSES, GROUPNAMES* 06600022
*                  AND RELATIVE LINE NUMBERS. ALSO INSURES LINE DCBS  * 06700022
*                  ARE OPEN, RLN IS NOT MORE THAN NUMBER OF EXTENTS,  * 06800022
*                  AND LINE WAS NOT OPENED DUMMY. FOR ANY OF THESE    * 06900022
*                  ERRORS RETURNS PLUS 4 OF RETURN ADDRESS IN R14.    * 07000022
*                             GOOD RETURN- R0= UCB ADDRESS            * 07100022
*                                          R1= DCB ADDRESS            * 07200022
*                                                                     * 07300022
* EXITS,NORMAL - THE OPERATION SUCCESSFUL MESSAGE NUMBER IS PLACED IN * 07400022
*   THE ELEMENTS OCPARM FIELD, THE ELEMENTS OCWTG FIELD IS SET TO M1  * 07500022
*   AND AN XCTL (SVC 7) IS MADE TO THE OP CTL INCIDENT CHECKPOINT     * 07600022
*   ROUTINE (IGC0610D), REG 1 = @ OP CTL AVT.                         * 07700022
*                                                                     * 07800022
* EXITS,ERROR - THE ERROR MESSAGE NUMBER IS PLACED IN REGISTER 0,     * 07900022
*   THE OP CTL AVT ADDRESS IN REG 1 AND XCTL IS TO THE OP CTL ERROR   * 08000022
*   MESSAGE MODULE (IGC0310D).                                        * 08100022
*                                                                     * 08200022
* TABLES/WORK AREAS - LCB,TNT,TERM ENTRY,DCB,OP CTL AVT,AVT,OPCE      * 08300022
*                    OPTION TABLE,OPTION CHARACTERISTICS TABLE        * 08400022
*                    TERMNAME TABLE, TERMINAL TABLE                   * 08500022
*                                                                     * 08600022
* ATTRIBUTES - SUPERVISOR MODE, DISABLED, TRANSIENT(TYPE 4 SVC), NON- * 08700022
*             REENTRANT, SERIALLY REUSABLE, REFRESHABLE.              * 08800022
*                                                                     * 09600022
* NOTES -                                                             * 09700022
*    COMMUNICATIONS BETWEEN THE VARIOUS MODULES/TRANSIENTS IS         * 09800022
*    PRIMARILY THROUGH THE OPERATOR CONTROL ADDRESS VECTOR TABLE (AVT)* 09900022
*                                                                     * 10000022
*    DEPENENCIES = THE OPERATION OF THIS MODULE DEPENDS ON     @Y17XART 10002000
*    UPON AN INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER @Y17XART 10004000
*    SET WHICH IS EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME  @Y17XART 10006000
*    THIS MODULE HAS BEEN CODED SO THAT REDEFINATION OF        @Y17XART 10008000
*    CHARACTER CONSTANTS, BY REASSEMBLY, WILL RESULT IN A      @Y17XART 10010000
*    CORRECT MODULE FOR THE NEW DEFINITION.                    @Y17XART 10012000
*                                                              @Y17XART 10014000
*    RESTRICTIONS = NONE                                       @Y17XART 10016000
*                                                              @Y17XART 10018000
*    REGISTER CONVENTIONS = ALL OF THE REGISTER SYMBOLS USED   @Y17XART 10020000
*    BY THIS MODULE ARE DEFINED IN NUMERICAL ORDER BY REGISTER @Y17XART 10022000
*    NUMBER.                                                   @Y17XART 10024000
*                                                              @Y17XART 10026000
*    PATCH LABEL = ZAPAREA                                     @Y17XART 10028000
*                                                              @Y17XART 10030000
* MODULE TYPE = PROCEDURE                                      @Y17XART 10032000
*   PROCESSOR = ASSEMBLER                                      @Y17XART 10034000
*                                                              @Y17XART 10036000
*   MODULE SIZE = THE MAXIMUM SIZE ALLOWED FOR THIS MODULE IS  @Y17XART 10038000
*                                                              @Y17XART 10040000
* CHANGE ACTIVITY =                                            @Y17XART 10042000
* A000000-999999                                               @Y16X5R0 10042500
* A499000                                                      @Y17XACT 10043000
* D363000-368000                                               @Y17XACT 10043500
*A155000,288000                                                @OZ27255 10043682
*C284000                                                       @OZ27255 10043782
*                                                                     * 10050000
*********************************************************************** 10100022
         EJECT                                                          10200022
         SPACE                                                          10300022
****    REGISTER EQUATES    ****                                        10400022
RZERO    EQU   0                        PARM REG 0                      10500022
RPARM    EQU   1                        PARM REG 1                      10600022
ROPCAVT  EQU   2                        OP CONTROL AVT POINTER          10700022
ROPCE    EQU   3                        CURRENT ELEMENT ADDRESS         10800022
RAVT     EQU   4                        TCAM AVT ADDRESS                10900022
RWORK5   EQU   5                        WORK REGISTER                   11000022
RTNT     EQU   6                        TNT BASE REG                    11100022
RTERM    EQU   6                        TERM ENTRY BASE                 11200022
RWORK6   EQU   6                        WORK REGISTER                   11300022
RWORK7   EQU   7                        WORK REGISTER                   11400022
RWORK8   EQU   8                        WORK REGISTER                   11500022
RWORK9   EQU   9                        WORK REGISTER                   11600022
RWORK10  EQU   10                       WORK REGISTER                   11700022
RSCNRTN  EQU   10                       SCAN RETURN REGISTER            11800022
RWORK11  EQU   11                       WORK REGISTER                   11900022
RBASE    EQU   12                       MODULE BASE                     12000022
RSAVE    EQU   13                       SAVE AREA POINTER               12100022
RRET     EQU   14                       SUBROUTINE RETURN ADDRESS       12200022
RBRNCH   EQU   15                       SUBROUTINE BRANCH ENTRY POINT   12300022
RLINK    EQU   15                       SUBROUTINE RETURN REG           12400022
         SPACE                                                          12500022
         SPACE                                                          12600022
****    MISCELLANEOUS EQUATES    ****                                   12700022
ZERO     EQU   0                        ZERO VALUE                      12800022
ONE      EQU   1                        VALUE ONE                       12900022
TWO      EQU   2                        VALUE TWO                       13000022
THREE    EQU   3                        VALUE THREE                     13100022
FOUR     EQU   4                        VALUE FOUR                      13200022
FIVE     EQU   5                        VALUE FIVE                      13300022
SIX      EQU   6                        VALUE SIX                       13400022
SEVEN    EQU   7                        VALUE SEVEN                     13500022
EIGHT    EQU   8                        VALUE EIGHT                     13600022
NINE     EQU   9                        VALUE NINE                      13700022
TEN      EQU   10                       VALUE TEN                       13800022
TWELVE   EQU   12                       VALUE TWELVE                    13900022
FOURTEEN EQU   14                       VALUE FOURTEEN                  14000022
FIFTEEN  EQU   15                       VALUE FIFTEEN                   14100022
SIXTEEN  EQU   16                       VALUE SIXTEEN                   14200022
THIRTY2  EQU   32                       VALUE THIRTY TWO                14300022
THIRTY4  EQU   34                       VALUE THIRTY FOUR               14400022
FIFTY    EQU   50                       VALUE FIFTY                     14500022
FIFTY6   EQU   56                       VALUE FIFTY SIX                 14600022
SIXTY2   EQU   62                       VALUE SIXTY TWO                 14700022
SEVNTY7  EQU   77                       VALUE SEVENTY SEVEN             14800022
ONE93    EQU   193                      VALUE ONE93                     14830022
TWO40    EQU   240                      VALUE TWO40                     14860022
CHAR     EQU   C'C'                     CHARACTER C                     14900022
HEX      EQU   C'X'                     CHARACTER X                     15000022
QUOTE    EQU   C''''                    CHARACTER QUOTE                 15100022
DEC      EQU   C'D'                     CHARACTER D                     15200022
CZERO    EQU   C'0'                     CHARACTER ZERO                  15300022
CNINE    EQU   C'9'                     CHARACTER NINE                  15400022
CHARCD   EQU   X'40'                    CODE SWITCH FOR CHARACTER       15500022
LA       EQU   X'81'                    LOWER CASE A           @OZ27255 15520082
LF       EQU   X'86'                    LOWER CASE F           @OZ27255 15540082
ONE29    EQU   129                      OFFSET TO TRANSLATE TBL@OZ27255 15560082
HEXCD    EQU   X'01'                    CODE SWITCH FOR HEX             15600022
DECCD    EQU   X'00'                    CODE SWITCH FOR DECIMAL         15700022
X0F      EQU   X'0F'                    HEX '0F'                        15800022
CA       EQU   C'A'                     CHARACTER A                     15900022
CF       EQU   C'F'                     CHARACTER F                     16000022
TWO55    EQU   255                      TWO HUNDRED FIFTY FIVE          16100022
VARINAME EQU   3                        OFFSET TO CHANGE XCTL NAME      16200022
BLANK    EQU   C' '                     BLANK CHARACTER                 16300022
X10      EQU   X'10'                    HEX 10                   S22024 16350022
         EJECT                                                          16400022
         USING IEDQAVTD,RAVT            TCAM AVT ADDRESSABILITY         16500022
         USING IEDQOPCD,ROPCAVT         OP CONTROL AVT ADDRESSABILITY   16600022
         USING IEDQOPCE,ROPCE           ELEMENT ADDRESSABILITY          16700022
         USING IEDQTNTD,RTNT            TERM NAME ADDRESSABILITY        16800022
         USING IEDQTRM,RTERM                                            16900022
         SPACE                                                          17000022
         BALR  RBASE,0                  SET BASE REGISTER               17100022
         USING *,RBASE                  MODULE ADDRESSABILITY           17200022
IGCM810D IEDHJN SKIPID                                                  17400022
         SPACE                                                          17700022
****    ROUTINE TO DETERMINE DATA TYPE    ****                          17800022
         LR    ROPCAVT,RPARM            SET OP CTL AVT BASE             18000022
         L     RAVT,OPCAVTPT            SET BASE FOR TCAM AVT           18100022
         L     ROPCE,OPCCOPCE           GET ELEMENT POINTER             18200022
         L     RWORK5,OPCWORK           GET WORK AREA ADDRESS           18300022
         TM    OPCSPEC,OPCRSTRT         RESTART IN PROCESS              18400022
         BO    GETTRM                   BR TO PROCESS OPT REQUEST       18500022
         LM    ROPCE,RWORK9,OPCSAVE     LOAD REGS                       18600022
         MVC   OCBACKUP(EIGHT),OPCDOUBL SET OPFLDNME TO ELEMENT         18700022
         LA    RWORK8,EIGHT(RWORK5)     SET SINK DATA POINTER           18800022
         LA    RWORK9,THREE             SET UP TO                       18900022
         CR    RWORK6,RWORK9              CHECK DATA LENGTH             19000022
         BNH   PROCDEC                      LESS THAN 4-YES-DECIMAL     19100022
         CLI   ONE(RWORK7),QUOTE        SECOND DATA CHAR QUOTE          19200022
         BNE   PROCDEC                  NO-DECIMAL                      19300022
         SR    RWORK6,RWORK9            ADJUST RAW DATA LENGTH          19400022
         SR    RWORK9,RWORK9            CLEAR NUM DATA CHAR REG         19500022
         CLI   ZERO(RWORK7),HEX         CHECK FOR HEX                   19600022
         BE    SCNHEX                   YES-GO PROCESS HEX              19700022
         CLI   ZERO(RWORK7),CHAR        CHECK FOR CHARACTER DATA        19800022
         BE    SCNCHAR                  YES-GO PROCESS CHAR DATA        19900022
         CLI   ZERO(RWORK7),DEC         CHECK FOR DECIMAL               20000022
         BNE   GENM77                   NOT HEX,CHAR OR DEC-ERROR       20100022
         LA    RWORK7,TWO(RWORK7)       BUMP SOURCE DATA POINTER        20200022
         SPACE                                                          20300022
PROCDEC  EQU   *                                                        20400022
         LA    RWORK9,TEN               SET MAX DEC DATA LENGTH         20500022
         CR    RWORK6,RWORK9            GREATER THAN TEN CHAR           20600022
         BH    GENM62                   YES-REJECT COMMAND              20700022
         SR    RWORK9,RWORK9            CLEAR REG                       20800022
         SPACE                                                          20900022
****    DECIMAL MOVE    ****                                            21000022
MVELOOP  EQU   *                                                        21100022
         CLI   ZERO(RWORK7),CZERO       LESS THAN ZERO                  21200022
         BL    GENM77                   YES-NOT NUMERIC-REJECT          21300022
         CLI   ZERO(RWORK7),CNINE       GREATER THAN NINE               21400022
         BH    GENM77                   YES-NOT NUMERIC-REJECT          21500022
         MVC   ZERO(ONE,RWORK8),ZERO(RWORK7) MOVE CHARACTER             21600022
         LA    RWORK8,ONE(RWORK8)       INCREMENT SINK                  21700022
         LA    RWORK7,ONE(RWORK7)       INCREMENT SOURCE                21800022
         LA    RWORK9,ONE(RWORK9)       INCREMENT # CHAR MOVED          21900022
         BCT   RWORK6,MVELOOP           ALL CHAR MOVED - NO-LOOP        22000022
         MVI   OCRSID+TWO,DECCD         YES-SET DECIMAL DATA TYPE       22100022
         BCTR  RWORK9,RZERO             DECREMENT FOR EXECUTE INST      22200022
         BCTR  RWORK8,RZERO             DECREMENT BACK TO LAST CHAR     22300022
         MVZ   ZERO(ONE,RWORK8),ZONECO  MOVE IN PLUS ZONE               22400022
         EX    RWORK9,PACKDF            PACK THE NUMBER                 22500022
         CLC   OPCDOUBL(EIGHT),DOUBLMAX GREATER THAN ALLOWABLE VALUE    22600022
         BH    GENM62                   YES-REJECT                      22700022
         CVB   RPARM,OPCDOUBL           CHANGE IT TO BINARY             22800022
         ST    RPARM,OPCDOUBL           SAVE IT FOR MOVE TO ELEMENT     22900022
         LA    RWORK9,FOUR              SET MAXIMUM ALLOWABLE BYTES     23000022
         SR    RWORK7,RWORK7            CLEAR REG FOR CHAR INSERT       23100022
         LA    RWORK10,OCMODNME         SET SINK ADDRESS                23200022
         LA    RWORK6,OPCDOUBL          SET SOURCE ADDRESS              23300022
         SPACE                                                          23400022
DECMVE   EQU   *                                                        23500022
         IC    RWORK7,ZERO(RWORK6)      PICK UP CHARACTER               23600022
         LTR   RWORK7,RWORK7            TEST IT FOR ZERO                23700022
         BZ    NOTVAL                   YES-DONT MOVE DATA              23800022
         STC   RWORK9,OCRSID+THREE      SET LENGTH IN ELEMENT           23900022
         BCTR  RWORK9,RZERO             DECREMENT LENGTH FOR EX INST    24000022
         EX    RWORK9,MVCDEC            MOVE DATA TO ELEMENT            24100022
         B     GETTRM                   BR TO PROCESS OPT REQUEST       24200022
         SPACE                                                          24300022
NOTVAL   EQU   *                                                        24400022
         LA    RWORK6,ONE(RWORK6)       BUMP SOURCE ADDRESS             24500022
         BCT   RWORK9,DECMVE            DECREMENT FOR SMALLER FLD MOVE  24600022
         B     GENM62                   ALL BYTES ZERO-DATA INVALID     24700022
         SPACE                                                          24800022
****    ROUTINE TO CONVERT HEX    ****                                  24900022
SCNHEX   EQU   *                                                        25000022
         MVI   ONE(RWORK7),ZERO         INSERT DUMMY ZERO               25100022
         STH   RWORK6,OPCDOUBL          STORE DATA LENGTH               25200022
         TM    OPCDOUBL+ONE,ONE         DATA LENGTH ODD OR EVEN         25300022
         BO    ODD                      BR ODD                          25400022
         LA    RWORK7,ONE(RWORK7)       EVEN-DONT USE DUMMY ZERO        25500022
         SPACE                                                          25600022
ODD      EQU   *                                                        25700022
         LA    RWORK6,ONE(RWORK6)       ADD ONE                         25800022
         SRL   RWORK6,ONE               DIVIDE BY TWO                   25900022
         SPACE                                                          26000022
LOOPHEX  EQU   *                                                        26100022
         BAL   RWORK10,HEXCK            CHECK & TRANSLATE 1ST BYTE      26200022
         LA    RWORK7,ONE(RWORK7)       INCREMENT SOURCE POINTER        26300022
         BAL   RWORK10,HEXCK            CHECK & TRANSLATE 2ND BYTE      26400022
         BAL   RWORK10,MERGE            MERGE TO INE BYTE 2 HEX CHAR    26500022
         LA    RWORK8,ONE(RWORK8)       INCREMENT SINK                  26600022
         LA    RWORK7,ONE(RWORK7)       INCREMENT SOURCE                26700022
         LA    RWORK9,ONE(RWORK9)       INCREMENT COUNT                 26800022
         BCT   RWORK6,LOOPHEX           ALL DATA PROCESSED-NO LOOP      26900022
         STC   RWORK9,OCRSID+THREE      SET LENGTH IN ELEMENT           27000022
         MVI   OCRSID+TWO,HEXCD         SET HEX DATA TYPE               27100022
         B     BFRDATA                  BR TO BFR DATA                  27200022
         SPACE                                                          27300022
HEXCK    EQU   *                                                        27400022
         CLI   ONE(RWORK7),CZERO        CHECK FOR ZERO                  27500022
         BL    TRYALPHA                 NOT NUM. TRY FOR ALPHA          27600022
         CLI   ONE(RWORK7),CNINE        CHECK FOR NINE                  27700022
         BH    GENM77                   INVALID IF GRATER THAN NINE     27800022
         TR    ONE(ONE,RWORK7),TRANNUM-TWO40 TRANSLATE THE BYTE         27900022
         BR    RWORK10                  RETURN TO CALLER                28000022
         SPACE                                                          28100022
TRYALPHA EQU   *                                                        28200022
         CLI   ONE(RWORK7),CA           TRY CHARACTER A                 28300022
         BL    NOTCAPS                  CHECK FOR LOWER CASE   @OZ27255 28400082
         CLI   ONE(RWORK7),CF           TRY CHARACTER F                 28500022
         BH    GENM77                   GREATER THAN F -INVALIN         28600022
         TR    ONE(ONE,RWORK7),TRANCHAR-ONE93 TRANSLATE THE BYTE        28700022
         BR    RWORK10                  RETURN TO CALLER                28800022
NOTCAPS  EQU   *                                               @OZ27255 28810082
         CLI   ONE(RWORK7),LA           LOWER CASE A           @OZ27255 28820082
         BL    GENM77                   LESS, THEN ITS INVALID @OZ27255 28830082
         CLI   ONE(RWORK7),LF           LOWER CASE F           @OZ27255 28840082
         BH    GENM77                   GREATER THAN F, INVALID@OZ27255 28850082
         TR    ONE(ONE,RWORK7),TRANCHAR-ONE29  TRANSLATE BYTE  @OZ27255 28860082
         BR    RWORK10                  RETURN TO CALLER       @OZ27255 28870082
         SPACE                                                          28900022
MERGE    EQU   *                                                        29000022
         IC    RZERO,ZERO(RWORK7)       PICK UP 1ST CHARACTER           29100022
         NI    ONE(RWORK7),X0F          CLEAR HI-ORDER HALF OF 2NF      29200022
         IC    RPARM,ONE(RWORK7)        PICK UP 2ND CHAR                29300022
         SLL   RZERO,FOUR               SHIFT 1ST BYTE LEFT FOUR        29400022
         OR    RZERO,RPARM              MERGE THE TWO BYTES             29500022
         STC   RZERO,ZERO(RWORK8)       STORE THE MERGED BYTE           29600022
         BR    RWORK10                  RETURN TO CALLER                29700022
         SPACE                                                          29800022
SCNCHAR  EQU   *                                                        29900022
         LA    RWORK7,TWO(RWORK7)       BUMP SOURCE DATA POINTER        30000022
         SPACE                                                          30100022
CHARLP   EQU   *                                                        30200022
         CLI   ZERO(RWORK7),QUOTE       CHECK CHAR QUOTE                30300022
         BNE   NOQUOTE                  NO-NORMAL CHARACTER             30400022
         CLI   ONE(RWORK7),QUOTE        YES-THEN NEXT NUST BE QUOTE     30500022
         BNE   GENM77                   NO-ERROR                        30600022
         LA    RWORK7,ONE(RWORK7)       YES-USE SECOND QUOTE AS DATA    30700022
         SPACE                                                          30800022
         BCT   RWORK6,NOQUOTE           ADJUST DATA COUNT               30900022
         B     GENM77                   NO DATA - ERROR                 31000022
         SPACE                                                          31100022
NOQUOTE  EQU   *                                                        31200022
         MVC   ZERO(ONE,RWORK8),ZERO(RWORK7)  MOVE CHAR TO WRK AREA     31300022
         LA    RWORK8,ONE(RWORK8)       INCREMENT SINK ADDR             31400022
         LA    RWORK7,ONE(RWORK7)       INCRENENT SOURCE ADDR           31500022
         LA    RWORK9,ONE(RWORK9)       ADD ONE TO BYTES PROCESSED      31600022
         BCT   RWORK6,CHARLP            MORE DATA TO PROCESS            31700022
         STC   RWORK9,OCRSID+THREE      SET LENGTH IN ELEMENT           31800022
         MVI   OCRSID+TWO,CHARCD        SET DATA TYPE=CHARACTER         31900022
         SPACE                                                          32000022
****    ROUTINE TO BUFFER DATA    ****                                  32100022
BFRDATA  EQU   *                                                        32200022
         LA    RWORK8,EIGHT(RWORK5)     SET START OF DATA AREA          32300022
         MVC   OCMODNME(EIGHT),ZERO(RWORK8) MOVE 1ST 8 BYTES TO ELEMEN\ 32400022
         LA    RWORK7,EIGHT             SET UP FOR                      32500022
         CR    RWORK9,RWORK7              COMPARE LENGTH GT EIGHT       32600022
         BNH   GETTRM                   BR TO PROCESS OPT REQUEST       32700022
         AR    RWORK8,RWORK7            POSITION DATA PTR               32800022
         SR    RWORK9,RWORK7            ADJUST DATA LENGTH              32900022
         LR    RSCNRTN,RWORK9           SET DATA LENGHT FOR BFRNG       33000022
         LA    RSAVE,OPCSAVE            POINT R13 TO OP CTL SAVE        33100022
         SRL   RSCNRTN,FIVE             DIVIDE BY 32 FOR UNITS NEEDED   33200022
         LA    RSCNRTN,ONE(RSCNRTN)     ADD ANOTHER UNIT                33300022
         LR    RPARM,RSCNRTN            NUM OF REQUESTED UNITS TO PARM  33400022
         L     RLINK,OPCGETBF           PICK UP ADDR OF BUFF ALLOC RTN  33500022
         BALR  RRET,RLINK               GO GET BUFFERS                  33600022
         SPACE                                                          33700022
         ST    RPARM,OCUNIT             STORE LINK TO UNITS             33800022
         LA    RSCNRTN,THIRTY2          LOAD THIRTY TWO VALUE           33900022
         SPACE                                                          34000022
FILLBUF  EQU   *                                                        34100022
         MVC   TWELVE(TWO,RPARM),OCOPTCDE MVE OPRND & SUBOPRND TO UNIT  34200022
         STC   RSCNRTN,FIFTEEN(RPARM)   SET DATA LENGTH IN UNIT         34300022
         MVI   FOURTEEN(RPARM),ZERO     CLEAR RESERVE BYTE              34400022
         MVC   SIXTEEN(THIRTY2,RPARM),ZERO(RWORK8) MVE DATA INTO UNIT   34500022
         L     RPARM,EIGHT(RPARM)       PICK UP NXT UNIT ADDR           34600022
         LA    RWORK8,THIRTY2(RWORK8)   BUMP DATA BUFF POINTER          34700022
         BCT   RZERO,FILLBUF            LAST BUFFER - NO,FILL NXT UNIT  34800022
         SPACE                                                          34900022
****    GET TERM ENTRY    ****                                          35000022
GETTRM   EQU   *                                                        35100022
         L     RTNT,AVTRNMPT            SET TNT BASE                    35200022
         LH    RWORK8,OCTRMTBL          GET TNT OFFSET FROM ELEMENT     35300022
         SLL   RWORK8,SIXTEEN           CLEAR OUT HI-ORDER              35400022
         SRL   RWORK8,SIXTEEN              SIXTEEN BITS                 35500022
         SR    RWORK7,RWORK7            CLEAR REG                       35600022
         IC    RWORK7,TNTENLEN-IEDQTNTD(RTNT) GET ENTRY LENGTH          35700022
         LA    RWORK9,THREE(RWORK7)     ALLOW FOR ADDRESS               35800022
         BCTR  RWORK8,RZERO             REDUCE TNT OFFSET BY ONE        35900022
         MR    RWORK8,RWORK8            CALCULATE OFFSET                36000022
         LA    RWORK8,TNTFIRST-IEDQTNTD(RTNT) GET ADDRESS OF 1ST ENTRY  36100022
         AR    RWORK8,RWORK9            ADD OFFSET TO FIRST ENTRY       36200022
         AR    RWORK8,RWORK7            POINT TO ADDRESS OF TERM ENTRY  36900022
         MVC   OPCSAVE+ONE(THREE),ZERO(RWORK8) MVE ADDR TO BNDRY        37000022
         L     RTERM,OPCSAVE            LOAD TERM ENTRY ADDRESS         37100022
         TM    TRMDSORG,TRMLGB          LGB                      S22024 37130022
         BO    GENM34                   BRANCH, YES              S22024 37150022
*                                       NO OPTIONS FIELDS        S22024 37170022
         LA    RTERM,ZERO(RTERM)        CLEAR HI-ORDER BYTE             37200022
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS PRESENT           37300022
         BNO   GENM34                   NO-BR TO SET NO OPTION NSG      37400022
         L     RWORK7,AVTOPTPT          GET ADDRESS OF OPTION TABLES    37500022
         L     RWORK8,FOUR(RWORK7)      GET OPT NAMES ADDRESS           37600022
         SR    RWORK9,RWORK9            CLEAR OFFSET REGISTER           37700022
         SPACE                                                          37800022
****    LOCATE OPTION FIELD    ****                                     37900022
OPTLOOP  EQU   *                                                        38000022
         LA    RWORK9,ONE(RWORK9)       INCREMENT OFFSET COUNTER        38100022
         CLI   ZERO(RWORK8),AVTEFF      END OF OPTIONS                  38200022
         BE    GENM34                   YES-SET NO OPTIONS MSG          38300022
         CLC   TWO(EIGHT,RWORK8),OCBACKUP COMPARE OPTFLDMANE            38400022
         BE    GOODNAME                 EQUAL-FND NME,GO LOCATE OPTFLD  38500022
         LA    RWORK8,TEN(RWORK8)       POINT TO NXT ENTRY IN TBL       38600022
         B     OPTLOOP                  BR TO CHECK NXT ENTRY           38700022
         SPACE                                                          38800022
GOODNAME EQU   *                                                        38900022
         SR    RWORK11,RWORK11          CLEAR FOR NUMBER OF OPTIONS     39000022
         IC    RWORK11,TRMOPNO          PICK UP NUM OF OPTIONS          39100022
         CR    RWORK9,RWORK11           OFFSET GT SPECIFIED             39200022
         BH    GENM34                   YES - ERROR                     39300022
         AR    RWORK9,RTERM             ADD TERM ENTRY BASE             39400022
         CLI   TRMOPT-ONE-IEDQTRM(RWORK9),AVTEFF OPTION SPECIFIED       39500022
         BE    GENM34                   NO - ERROR                      39600022
         SR    RWORK10,RWORK10          CLEAR FOR TABLE OFFSET          39700022
         IC    RWORK10,TRMOPT-ONE-IEDQTRM(RWORK9) PICK UP OPTION        39760022
*                                       OFFSET                          39820022
         LH    RWORK7,TRMOPTBL          GET ENTRY OFFSET       @YA05454 39900056
         N     RWORK7,AVTCLRHI          CLEAR HI HALF          @YA05454 39930056
         A     RWORK7,AVTOPTPT          ADD OPT TBL OFFSET     @YA05454 39960056
         AR    RWORK10,RWORK7           GET ENTRY BY ADDING OFFSETS     40000022
         LA    RWORK5,EIGHT(RWORK5)     SET SINK FOR MOVE RTN           40100022
         MVI   ZERO(RWORK5),BLANK       SET BLANK FOR PROPAGATE         40130022
         CLI   ONE(RWORK8),ZERO         CHAR OPT FIELD SPECIFIED        40160022
         BE    PROP                     YES, GO PROPAGATE BLANKS        40190022
         MVI   ZERO(RWORK5),ZERO        MOVE ZERO FOR PROPAGATE         40220022
PROP     EQU   *                                                        40250022
         MVC   ONE(TWO55,RWORK5),ZERO(RWORK5) PROAGATE THROUGH FIELD    40300022
         SR    RWORK6,RWORK6            CLEAR                           40400022
         IC    RWORK6,ZERO(RWORK8)      GET OPT FLD LENGTH              40500022
         LA    RWORK6,ONE(RWORK6)       INCREMENT BY ONE                40600022
         SR    RWORK7,RWORK7            CLEAR REG                       40700022
         IC    RWORK7,OCRSID+THREE      GET DATA LENGTH                 40800022
         SR    RWORK9,RWORK9            CLEAR REG                       40900022
         CR    RWORK6,RWORK7            COMP OPT LEN VS DATA LEN        41000022
         BL    GENM62                   DATA LEN TOO BIG                41100022
         BE    PROCD                    SAME DONT ADJUST DIFF           41200022
         LR    RWORK9,RWORK6            GET OPT LENGTH                  41300022
         SR    RWORK9,RWORK7            ESTABLISH DIFFERENCE            41400022
         SPACE                                                          41500022
****    VALIDATE OPTION FIELD TYPE AND MODIFY OPTION    ****            41600022
PROCD    EQU   *                                                        41700022
         CLI   ONE(RWORK8),ZERO         CK CHAR DATA OPT FLD            41800022
         BE    CHARMV                   IT IS- GO CK DATA CHAR ALSO     41900022
         CLI   OCRSID+TWO,CHARCD        CHECK DATA FOR CHAR             42000022
         BE    GENM56                   YES-ERROR                       42100022
         AR    RWORK5,RWORK9            ADJUST FOR DEC DATA             42200022
         B     DECMV                    BR TO MOVE DEC TYPE             42300022
         SPACE                                                          42400022
CHARMV   EQU   *                                                        42500022
         TM    OCRSID+TWO,AVTEFF        CHECK CHAR OR HEX DATA          42600022
         BZ    GENM56                   NO - ERROR CONDITION            42700022
         SPACE                                                          42800022
DECMV    EQU   *                                                        42900022
         LA    RWORK9,EIGHT             SET COUNT FOR MVE LOOP          43000022
         LA    RWORK11,OCMODNME         SET SOURCE ADDR                 43100022
         SPACE                                                          43200022
LONGMV   EQU   *                                                        43300022
         BAL   RRET,MVERTN              GO TO MOVE LOOP                 43400022
         L     RWORK11,OCUNIT           GET ADDR OF ATTACHED UNITS      43500022
         LR    ROPCE,RWORK11            SET AS ELEMENT BASE             43600022
         LA    RWORK11,SIXTEEN(RWORK11) SET SOURCE ADDRESS              43700022
         LA    RWORK9,THIRTY2           SET COUNT                       43800022
         B     LONGMV                   GO TO MOVE DATA                 43900022
         SPACE                                                          44000022
MVERTN   EQU   *                                                        44100022
         MVC   ZERO(ONE,RWORK5),ZERO(RWORK11) MOVE ONE BYTE OF DATA     44200022
         LA    RWORK5,ONE(RWORK5)       INCREMENT SINK                  44300022
         LA    RWORK11,ONE(RWORK11)     INCREMENT SOURCE                44400022
         BCT   RWORK7,COUNT             DECREMENT COUNT                 44500022
         B     MOVEOPT                  ALL DATA BUFFERED               44600022
         SPACE                                                          44700022
COUNT    EQU   *                                                        44800022
         BCT   RWORK9,MVERTN            LOOP TO MOVE ALL DATA           44900022
         BR    RRET                     RETURN                          45000022
         SPACE                                                          45100022
MOVEOPT  EQU   *                                                        45200022
         L     RWORK5,OPCWORK           GET ADDR OF WORK AREA           45300022
         BCTR  RWORK6,RZERO             DECREMENT FOR EXECUTE           45400022
         EX    RWORK6,OPTIONMV          MOVE IN OPTION FIEDD            45500022
         L     ROPCE,OPCCOPCE           GET ELEMENT ADDRESS             45600022
         SPACE                                                          45700022
XCTLMOD  EQU   *                                                        45800022
         LA    RZERO,FIFTY              SET MSG NUM                     45900022
         STH   RZERO,OCPARM             SET FOR WTG MOD                 46000022
         MVC   OCWTG(TWO),OKWRT         SET WTG MOD NAME                46100022
         MVC   OPCLDNME+VARINAME(TWO),CKPTMOD MOD NAME FOR XCTL         46200022
         B     EXIT                     BR TO XCTL                      46300022
         SPACE                                                          46400022
****    MESSAGE GENERATION ROUTINE    ****                              46500022
GENM34   EQU   *                                                        46600022
         LA    RZERO,THIRTY4            SET ERROR MSG NUM               46700022
         B     XCTLERR                  INDICACT ERROR COND             46800022
         SPACE                                                          46900022
GENM56   EQU   *                                                        47000022
         LA    RZERO,FIFTY6             SET ERROR MSG NUM               47100022
         B     XCTLERR                  BR TO EXIT ERROR                47200022
         SPACE                                                          47300022
GENM62   EQU   *                                                        47400022
         LA    RZERO,SIXTY2             SET ERR MSG CODE                47500022
         B     XCTLERR                  GO OUTPUT ERROR MESSAGE         47600022
         SPACE                                                          47700022
GENM77   EQU   *                                                        47800022
         LA    RZERO,SEVNTY7            SET ERROR CODE                  47900022
         SPACE                                                          48000022
XCTLERR  EQU   *                                                        48100022
         MVC   OPCLDNME+VARINAME(TWO),WRTERR SET UP FOR XCTL            48200022
         SPACE                                                          48300022
EXIT     EQU   *                                                        48400022
         LR    RPARM,ROPCAVT            PASS OP CTL AVT PTR             48500022
         XCTL  SF=(E,OPCXCTL)           CALL NXT LOAD                   48600022
         SPACE                                                          48700022
         SPACE                                                          48800022
WRTERR   DC    C'03'                    ERROR MESSAGE MODULE NAME       48900022
OKWRT    DC    C'M1'                    MODIFY O.K. MESSAGE MODULE      49000022
CKPTMOD  DC    C'06'                    INCIDENT CHECKPOINT MOD NAME    49100022
MVSTATNM MVC   OPCDOUBL(ZERO),ZERO(RWORK9) MOVE STATION NAME            49200022
OPTIONMV MVC   ZERO(ZERO,RWORK10),EIGHT(RWORK5) MOVE OPTION FIELD       49300022
PACKDF   PACK  OPCDOUBL(EIGHT),EIGHT(ZERO,RWORK5) PACK DECIMAL          49400022
MVCDEC   MVC   ZERO(ZERO,RWORK10),ZERO(RWORK6) MOVE DECIMAL             49500022
DOUBLMAX DC    X'000002147483647C'      A DOUBLE WORD W/MAXIMUM VALUE   49600022
ZONECO   DC    X'C0'                    PLUS ZONE FOR CONVERT           49700022
TRANNUM  DC    X'00112233445566778899'  TRANSLATE NUMERIC               49800022
TRANCHAR DC    X'AABBCCDDEEFF'          TRANSLATE CHARACTER             49900022
ZAPAREA  DC    100X'00'                                        @Y17XACT 49950000
         EJECT                                                          50000022
         TAVTD                                                          50100022
         EJECT                                                          50200022
         TOPCAVTD                                                       50300022
         EJECT                                                          50400022
         TOPCED                                                         50500022
         EJECT                                                          50600022
         TTNTD                                                          50700022
         EJECT                                                          50800022
         TTRMD                                                          50900022
         END                                                            51000022
