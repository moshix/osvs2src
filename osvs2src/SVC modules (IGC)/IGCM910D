         TITLE 'IGCM910D - FEROUTER'                                    00200022
IGCM910D CSECT                                                          00400022
         SPACE 3                                                        00720052
*********************************************************************** 00800052
*                                                                     * 01200022
* MODULE NAME = IGCM910D (TCAM, OPERATOR CONTROL)                     * 01400000
*                                                                     * 01420052
* DESCRIPTIVE NAME = FEROUTER                                         * 01440000
*                                                                     * 01460052
* COPYRIGHT = NONE                                                    * 01480000
*                                                                     * 01500052
* STATUS:  CHANGE LEVEL 10.0                                          * 01520000
*                                                                     * 01600022
* FUNCTION--  THIS MODULE PROCESSES OPERATOR CONTROL COMMANDS WHICH   * 01800000
*   REQUEST LOADING OR DELETING OF A SERVICE AID ROUTINE. IF THE      * 01900000
*   COMMAND IS VALID THE SERVICE AID ROUTINE IS LOADED AND GIVEN      * 02000000
*   CONTROL. A RESPONSE MESSAGE IS PREPARED AND RETURNED.             * 02100000
*                                                                     * 02200000
*   THE SPECIFIED SERVICE AID ROUTINE NAME IS LOCATED IN THE          * 02300000
*   OCMODNME FIELD IN THE OPERATOR CONTROL ELEMENT (OPCE). THE LOAD   * 02400000
*   OR DELETE FUNCTION IS CHECKED FOR IN THE OCSWITCH FIELD.          * 03000000
*   IF NEITHER FUNCTION IS FOUND AN ERROR MESSAGE IS PREPARED AND     * 03200022
*   CONTROL RETURNED TO IGC0310D (THE ERROR WRITER) TO WRITE OUT THE  * 03400000
*   IED102I ERROR MESSAGE.                                            * 03500000
*                                                                     * 03600000
*   A BLDL IS PERFORMED AGAINST THE SPECIFIED SERVICE AID ROUTINE     * 03700000
*   TO DETERMINE WHETHER THE MODULE EXISTS ON SYS1.LINKLIB OR         * 03800000
*   JOBLIB/STEPLIB DATA SETS. IF THE MODULE IS NOT LOCATED, CONTROL   * 04200000
*   IS GIVEN TO IGC0310D TO DISPLAY THE IED102I ERROR MESSAGE.        * 04400000
*                                                                     * 04800000
*   IF COMMAND REQUESTS LOADING OF A SERVICE AID, THE NAME IS         * 04860000
*   CHECKED FOR IEDQFE10, IEDQFE20, IEDQFE30, OR IEDQFE40. IF NOT     * 04950000
*   AVTDTRAP IS TESTED FOR ZERO TO DETERMINE IF ANOTHER SERVICE       * 05040000
*   SERVICE AID IS ALREADY LOADED. IF SO, MSG IED548I IS ISSUED.      * 05130000
*   OTHERWISE THE LOAD LIST IS CHECKED FOR THE SERVICE AID BEING      * 05220000
*   ACTIVE. IF THE ROUTINE IS ALREADY ACTIVE, THE IED103I ERROR       * 05310000
*   MESSAGE IS DISPLAYED.                                             * 05400000
*                                                                     * 05490000
*   IF THE SERVICE AID IS NOT ACTIVE A GETMAIN IS ISSUED TO DETERMINE * 05800000
*   IF THERE IS ENOUGH CORE AVAILABLE TO LOAD IT. IF AVAILABLE CORE,  * 06000000
*   THE SERVICE AID IS LOADED AND GIVEN CONTROL VIA A SYNCH MACRO.    * 06200022
*   UPON RETURN FROM THE SERVICE AID THE RETURN CODE IS CHECKED.      * 06400000
*   FOR GOOD INITIALIZATION THE IED105I MESSAGE IS DISPLAYED. RETURN  * 06600000
*   FROM THE SERVICE AID WITH A BAD RETURN CODE RESULTS IN IED105I    * 07000000
*   ERROR MESSAGE BEING DISPLAYED AND THE DELETION OF THE SERVICE AID * 07200000
*   ROUTINE.                                                          * 07400000
*                                                                     * 07500000
*   IF CORE IS NOT AVAILABLE A TEST IS MADE TO SEE HOW MUCH MORE CORE * 07600000
*   IS NEEDED IN ORDER TO LOAD THE SERVICE AID . THE IED125I ERROR    * 07800000
*   MESSAGE IS PREPARED TO INFORM THE REQUESTOR.                      * 08000000
*                                                                     * 08200000
*   IF THE COMMAND REQUESTS A DELETING OF A SERVICE AID THE LOAD      * 08400000
*   LIST IS CHECKED FOR THE SERVICE AID BEING ACTIVE. FINDING THE     * 08600000
*   SERVICE AID NOT ACTIVE RESULTS IN DISPLAYING THE IED109I ERROR    * 08800000
*   MESSAGE. OTHERWISE THE SERVICE AID ROUTINE IS GIVEN CONTROL       * 09000000
*   VIA A SYNCH MACRO. IF THE RETURN CODE IS GOOD, THE IED100I        * 09200000
*   MESSAGE IS DISPLAYED AND THE ROUTINE IS DELETED. IF THE RETURN    * 09400000
*   CODE IS BAD, THE IED109I ERROR MESSAGE IS DISPLAYED.              * 09600000
*                                                                     * 10400000
* ENTRY POINTS                                                        * 10600000
*   'IGCM910D' TO PROCESS DEBUG OPERATOR CONTROL COMMANDS             * 10800022
*                                                                     * 11000000
* INPUT-- REGISTER 1- ADDRESS OF OPERATOR CONTROL AVT. IN THE OPCAVT  * 11200000
*   IS THE ADDRESS OF THE OPCE WHICH CONTAINS THE FOLLOWING INFO.     * 11400022
*   OCSWITCH                                                          * 11600000
*        X'08' DELETE FUNCTION                                        * 11800022
*        X'09' LOAD   FUNCTION                                        * 12000022
*   OCMODNME                                                          * 12200000
*        NAME OF SERVICE AID TO LOAD OR DELETE                        * 12400022
*                                                                     * 12600000
* OUTPUT--REGISTER 1 - ADDRESS OF OPERATOR CONTROL AVT                * 12800000
*        EXIT TO SERVICE AID VIA SYNCH MACRO                          * 13000022
*                                                                     * 13200000
* EXTERNAL ROUTINES--                                                 * 13400000
*   SERVICE AID ROUTINE.                                              * 13600000
*        EXIT TO SERVICE AID-                                         * 14000022
*             REGISTER 0 INDICATES LOAD OR DELETE FUNCTION            * 14200000
*             REGISTER 15 ENTRY POINT                                 * 14400000
*             REGISTER 14 RETURN REGISTER                             * 14600000
*        RETURN FROM SERVICE AID-                                     * 14800022
*             REGISTER 15 RETURN CODE:                                * 15000000
*                  0 = GOOD RETURN                                    * 15200000
*                  4 = MULTIPLE REQUEST                               * 15400022
*                  8 OR HIGHER NOT DEFINED                            * 15600000
*                  NEGITIVE = COMPLIMENT OF ADDRESS WHICH POINTS TO   * 15800000
*                             A MESSAGE.                              * 16000000
*                                                                     * 16200000
* EXITS,NORMAL--COMMAND IS PROCESSED. A RESPONSE MESSAGE IS GENERATED * 16400000
*   AND CONTROL IS PASSED TO THE MESSAGE WRITER IGC0710D TO WRITE OUT * 16600022
*   THE MESSAGE.                                                      * 16800022
*   THE NORMAL EXIT MESSAGES ARE-                                     * 17000000
*   IED099I  ROUTINE LOADED                                           * 17200022
*   IED100I  ROUTINE DEACTIVATED                                      * 17400022
*                                                                     * 17600000
* EXITS ERROR--                                                       * 17800000
*   ERROR MESSAGES ARE-                                               * 18000022
*   IED101I  RESTART IN PROGRESS                                      * 18200000
*   IED102I  INVALID OPERAND                                          * 18300000
*   IED103I  RTN ALREADY ACTIVE                                       * 18400000
*   IED104I  ROUTINE NOT ACTIVE                                       * 18500000
*   IED105I  RETURN CODE=0000                                         * 18600000
*   IED106I  MULTIPLE REQUEST                                         * 18700000
*   IED107I  COMWRITE NOT ACTIVE                                      * 18800000
*   IED109I  ROUTINE NOT DELETED                                      * 18900000
*   IED125I  0000 BYTES NEEDED                                        * 19000000
*   IED548I  SERVICE AID ALREADY LOADED                               * 19100000
*                                                                     * 20000000
* TABLES/WORK AREAS-- TCAM AVT,OPERATOR CONTROL AVT,OPCE,CVT,TCB,     * 20200000
*   OPERATOR CONTROL WORKAREA                                         * 20400000
*                                                                     * 20600000
* ATTRIBUTES-- SUPERVISOR MODE,DISABLED,TRANSIENT(TYPE 4)             * 20800000
*   REENTRANT,REFRESHABLE                                             * 21000000
*                                                                     * 21200022
* CHARACTER CODE DEPENDENCY                                           * 21400000
*        THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL        * 21600022
*        REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS        * 21800022
*        EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE CODING     * 22000022
*        HAS BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER          * 22200022
*        CONSTANTS, BY REASSEMBLY WILL RESULT IN A CORRECT MODULE     * 22400022
*        FOR THE NEW DEFINITION.                                      * 22600022
*                                                                     * 22800022
* NOTES - COMMUNICATIONS BETWEEN THE VARIOUS TRANSIENT MODULES IS     * 23000000
*        PRIMARILY THROUGH THE OPERATOR CONTROL AVT.                  * 23200022
*                                                                     * 23400022
*        THIS IS A MODULE RE-WRITE OF IEDQC6 AS OF OS/TCAM LEVEL II   * 23500022
* CONTROL CHARACTERS       COMMAND             OPERAND                * 23600000
*   ************************************************************      * 23800000
*   CONTROL CHARS *************************************************   * 24000000
*                 *    * MODIFY *  IDENT,* DEBUG   = * L *  ,NAME *   * 24200000
*                 *    *        *        *           *   *        *   * 24400000
*                 *    *   F    *        *           * D *        *   * 24600000
*                 *************************************************   * 24800000
*                                                                     * 25000000
*                                                                     * 25200000
*      SERVICE AID JOB NAME                                           * 25400000
*       ************                                                  * 25600000
*       * IEDQFE10 *                                                  * 25800000
*       * IEDQFE20 *                                                  * 26000000
* NAME= * IEDQFE30 *                                                  * 26200000
*       * IEDQFE40 *                                                  * 26400000
*       * IEDQFEXX *                                                  * 26600000
*       ************                                                  * 26800000
*   ******************************************************************* 27000000
*                                                                     * 27100000
* CHANGE ACTIVITY AS FOLLOWS                                          * 27200000
*A000000-999999                                                  S99240 27207000
*A474060-475860,524400-525600,530100-531300,793000,812100-813100 X02004 27214000
*D476000                                                         X02004 27221000
*A004000                                                        SA61063 27228000
*C006000,008000,572000,584000-590000,628000,752000,796000       SA61063 27235000
*D568000                                                        SA61063 27242000
*C421000-422000                                                 SA62353 27249000
*C614000-616000,630000-638000,710000                            SA68216 27256000
*D620000,622000,640000,642000,700000                            SA68216 27263000
*A616400-617200,710600,711200,712500-713500,755000              SA68216 27270000
*C624000,626000                                                @SA73354 27277000
*A199000,338500-338600,343000,362100-363700,752300             @Y17XAXA 27284000
*A792100-792600                                                @Y17XAXA 27291000
*C050000-050400,340000,342000,358000,360000,368000,370000      @Y17XAXA 27298000
*C376000,380000,384000-390000,394000,398000,402000,408000      @Y17XAXA 27305000
*C414000,418000,421000-424000,430000,434000,436000,440000      @Y17XAXA 27312000
*C456000,458000,464000,474120,474300,474420,475320,475380      @Y17XAXA 27319000
*C475740,492000,498000,508000-512000,522000,524400,530100      @Y17XAXA 27326000
*C534000,542000,544000,558000,560000,573000,584000,588000      @Y17XAXA 27333000
*C598000,604000,608000,614000,616400,628000,630000,634000      @Y17XAXA 27340000
*C646000,648000,652000,654000,658000,660000,664000,666000      @Y17XAXA 27347000
*C670000,672000,676000,678000,684000,690000,730000             @Y17XAXA 27354000
*C734000-752300,756000-774800,792100-792600                    @Y17XAXA 27361000
*D772000-774700,790000,793000                                  @Y17XAXA 27368000
*                                                                     * 27375000
*********************************************************************** 27400022
         EJECT                                                          27600022
*        REGISTER EQUATES                                               27800022
R0       EQU   0                                                        28000022
R1       EQU   1                   PARAMETER                            28200022
ROPC     EQU   2                   OPER CTRL AVT BASE                   28400022
ROPCE    EQU   3                   BASE REG FOR OPC ELEMENT             28600000
RAVT     EQU   4                   AVT BASE                             29000022
R4       EQU   4                   BRANCHING REGISTER                   29200000
RWRK5    EQU   5                   WORK REGISTER                        29400000
RETREG   EQU   6                   LOCAL RETURN REG                     29600022
RWRK7    EQU   7                   WORK REGISTER                        29800000
R8       EQU   8                   WORK REGISTER                        30200000
RBASE    EQU   12                  ROUTINE BASE                         30400022
R13      EQU   13                  SAVE AREA                            30600022
R14      EQU   14                  RETURN                               30800022
R15      EQU   15                  ENTRY POINT                          31000022
         EJECT                                                          31200000
         USING IEDQAVTD,RAVT       AVT BASE REG                         31400022
         USING IEDQOPCD,ROPC       OPC CTRL AVT BASE                    31600000
         USING IEDQOPCE,ROPCE      OPC ELEMENT BASE                     31800000
         USING IGCM910D,RBASE                                  @Y17XAXA 32000000
         LR    RBASE,R15           LOAD BASE REGISTER          @Y17XAXA 32300000
         SPACE 1                                               @Y17XAXA 32600000
IGCM910D IEDHJN SKIPID                                         @Y17XAXA 32900000
         LR    ROPC,R1             LOAD OP CTL AVT BASE                 33400022
         L     ROPCE,OPCCOPCE      GET ADDR OF PASSED ELEMENT           33600000
         L     RAVT,OPCAVTPT       GET AVT ADDRESS                      33700000
         CLC   IEDQFE,OCMODNME     NAME BEGIN WITH 'IEDQFE'    @YM06932 33800000
         BNE   ERR102              NO, INVALID OPERAND         @YM06932 33900000
         CLC   FE00,OCMODNME+6     NAME LT IEDQFE0X            @YM08398 34000000
         BH    SKIPCOMW            YES , SKIP COMWRITE TEST    @YM08398 34080000
         TM    AVTCWFL2,AVTCWACT   IS COMWRITE ACTIVE          @Y17XAXA 34160000
         BZ    ERR107              NO BRANCH                   @Y17XAXA 34240000
SKIPCOMW EQU   *                                               @YM08398 34320000
         TM    OPCSPEC,OPCRSTRT    RESTART IN PROGRESS                  34400000
         BO    ERR101              YES-RETURN                  @Y17XAXA 34600000
         CLI   OCSWITCH,OCX08      CHECK FOR DELETE FUNCTION   @Y17XAXA 34800000
         BNE   CHKLD               NO                                   35000000
         LA    RETREG,DELETE       YES                                  35200022
         CLC   FE40,OCMODNME+6     IS MODULE IEDQFE40          @YM08398 35300000
         BE    CHKFE40             YES , RESET IEDQFE40        @YM08398 35400000
         B     SEARCH              NO , SEARCH FOR MODULE      @YM08398 35420000
CHKLD    EQU   *                                                        35440000
         CLI   OCSWITCH,OCX09      CHECK FOR LOAD FUNCTION     @Y17XAXA 35460000
         BNE   ERR102              NO                          @Y17XAXA 35480000
         LA    RETREG,LOAD         RETURN POINT FOR LOAD FUNCTION       35500000
         CLC   FE40,OCMODNME+6     IS MODULE IEDQFE40          @YM06932 35520000
         BNE   NORMAL              BR NO, NORMAL INPUT         @YM06932 35540000
CHKFE40  EQU   *                                               @YM08398 35560000
         TM    AVTSAVTF,AVTVTMCP                               @ZM47955 35566010
         BZ    ERR102                                          @ZM47955 35572010
         L     RWRK7,AVTSAVTP      GET SECONDARY AVT ADDRESS   @YM06932 35580000
         USING IEDNSVTD,RWRK7                                  @YM06932 35600000
         L     RWRK7,SAVTPIUT      PIU TRACE TABLE ADDRESS     @YM06932 35620000
         DROP  RWRK7                                           @YM06932 35640000
         LA    RWRK7,0(RWRK7)      CLEAR FOR TEST              @YM06932 35660000
         LTR   RWRK7,RWRK7         TRACE TABLE EXIST           @YM06932 35680000
         BZ    ERR102              BR NO, RETURN MSG IED102I   @YM06932 35700000
         CLI   OCSWITCH,OCX09      LOAD FUNCTION               @YM06932 35720000
         BNE   DELFE40             BR NO, HANDLE DELETE        @YM06932 35740000
         TM    TRACFLGS(RWRK7),TRCOMWRT FE40 ALREADY ACTIVE    @YM06932 35760000
         BCR   ONE,RETREG          BR YES, RETURN MSG IED103I  @YM06932 35780000
         OI    TRACFLGS(RWRK7),TRCOMWRT SET IEDQFE40 INTERFACE @YM06932 35800000
         B     RET099I             RETURN IED099I MESSAGE      @YM06932 35820000
DELFE40  EQU   *                                               @YM06932 35840000
         TM    TRACFLGS(RWRK7),TRCOMWRT IEDQFE40 INTERFACE IN  @YM06932 35860000
         BNO   FOUR(RETREG)        BR NO, RETURN MSG IED104I   @YM06932 35880000
         NI    TRACFLGS(RWRK7),AVTEFF-TRCOMWRT RESET IEDQFE40  @YM06932 35900000
         B     RET100I             RETURN MESSAGE IED100I      @YM06932 35920000
NORMAL   EQU   *                                               @YM06932 35940000
         LA    R1,FEXX             SET FOR SCAN                @Y17XAXA 35960000
         LA    R4,THREE            SET SCAN FOR THREE MODULES  @YM06932 35980000
         USING FEXX,R1             REG 1 INITILIZED TO FEXX    @Y17XAXA 36000000
COMPFEXX EQU   *                                               @Y17XAXA 36020000
         CLC   FEXX,OCMODNME+6     MODULE IEDQFE10,20, OR 30   @YM06932 36040000
         BE    SEARCH              YES , BYPASS TEST           @Y17XAXA 36060000
         LA    R1,TWO(,R1)         UPDATE TO NEXT MODULE NAME  @Y17XAXA 36080000
         BCT   R4,COMPFEXX         TEST FOR IEDQFE10,20, OR 30 @YM06932 36100000
         DROP  R1                                              @YM06151 36120000
         L     RAVT,OPCAVTPT       RESTORE AVT PTR             @YM06491 36140000
         CLC   AVTDTRAP,AVTFZERO   SERVICE AID ALREADY LOADED  @Y17XAXA 36160000
         BE    SEARCH              NO , CONTINUE               @Y17XAXA 36180000
         LA    R0,IED548I          SET MSG TO IED548I          @Y17XAXA 36200000
         B     ERREXIT             GO WRITE ERROR MSG          @Y17XAXA 36220000
SEARCH   EQU   *                                                        36240000
         L     RAVT,OPCAVTPT       RESTORE AVT ADDR            @YM06461 36260000
         L     R8,OPCOPTLK         GET GETMAIN AND BLDL LIST ADDR       36590000
         LA    R14,TEN(,R8)        GET ADDR OF BLDL LIST       @Y17XAXA 36790000
         MVC   FOUR(EIGHT,R14),OCMODNME MOVE NAME TO BLDL LIST @Y17XAXA 36990000
         SR    R1,R1               LOAD PARAMETER REG1                  37190000
         LR    R0,R14              LOAD ADDR BLDL LIST IN REG0          37390000
         SVC   BLDL                ISSUE SVC                   @Y17XAXA 37590000
         LTR   R15,R15             CHECK RETURN CODE FROM BLDL          37800022
         BNZ   ERR102              IF CANT FIND OR I/O ERR     @Y17XAXA 38000000
         L     R15,CVTPTR          GET CVT ADDRESS                      38200000
         L     RWRK7,CVTTCBP(,R15) GET ADDR OF                 @Y17XAXA 38400000
         L     RWRK7,TCBOLD(RWRK7) ACTIVE TCB                  @Y17XAXA 38600000
         L     RWRK7,TCBLLS(RWRK7) AND LOAD LIST               @Y17XAXA 38800000
CDELOOP  LTR   RWRK5,RWRK7         END OF LIST                 @Y17XAXA 39000000
         BZ    INACTIVE            YES                                  39200022
         TM    VS1SYS(R15),X20     IS THIS A VS1 SYSTEM        @Y17XAXA 39400000
         BO    LLSLOOP             IF YES,CHECK LOAD LIST               39600022
         L     RWRK5,LLECDEAD(RWRK7) GET CDE ADDR              @Y17XAXA 39800000
LLSLOOP  EQU   *                                                        40000022
         CLC   MODNAME(EIGHT,RWRK5),FOUR(R14) COMPARE NAME FOR @Y17XAXA 40200000
*                                  ROUTINE                              40400000
         BE    ACTIVE              YES                                  40600022
         L     RWRK7,LLENXT(RWRK7) NO                          @Y17XAXA 40800000
         B     CDELOOP             CONTINUE SEARCH                      41000022
INACTIVE SR    R15,R15             ZERO REG 15                          41200022
         B     FOUR(RETREG)        RETURN INACTIVE             @Y17XAXA 41400000
ACTIVE   EQU   *                                                        41600022
         TM    VS1SYS(R15),X20     IS THIS A VS1 SYSTEM        @Y17XAXA 41800000
         BZ    ACTIVE1             IF NO,GO GET EPA FROM CDE            42000022
         LA    RWRK5,FOUR(,RWRK5)  ELSE INCREMENT TO EPA       @Y17XAXA 42100000
*                                  IN VS1 LLE                  @Y17XAXA 42200000
ACTIVE1  L     R15,CDEEPAD(,RWRK5) GET EPA                     @Y17XAXA 42300000
         BR    RETREG              RETURN ACTIVE                        42600022
LOAD     EQU   *                                                        42800022
         B     ERR103              GO WRITE ERROR MESSAGE      @Y17XAXA 43000000
         L     R8,OPCOPTLK         GET ADDR OF BLDL LIST                43200000
         LA    R13,TEN(,R8)        GET ADDR OF BLDL AREA       @Y17XAXA 43400000
         MVC   ONE(THREE,R8),SIZE(R13) PUT SIZE IN LIST        @Y17XAXA 43600000
         LA    R1,OPCDOUBL         GET ADDR OF WHERE TO SAVE ADDR       43800000
         ST    R1,FOUR(R8)         PUT IN PARAMETER LIST       @Y17XAXA 44000000
         L     R1,OPCOPTLK         LOAD ADDR OF PARAMETER LIST          44200000
         GETMAIN ,MF=(E,(1))       GETMAIN MACRO                        44400000
         LTR   R15,R15             TEST FOR ENOUGH CORE                 44600000
         BNZ   TESTCORE            BRANCH IF NOT ENOUGH                 44800022
         L     R1,OPCOPTLK         LOAD SERVICE NAME                    45000000
         FREEMAIN ,MF=(E,(1))      FREEMAIN GETMAINED CORE              45200000
         L     R8,OPCOPTLK         GET ADDR OF BLDL LIST                45400000
         MVC   ONE(THREE,R8),REGSAVE NUM OF BYTES NEEDED       @Y17XAXA 45600000
         MVI   NINE(R8),XFA        SUBPOOL VALUE               @Y17XAXA 45800000
         LR    R1,R8               PUT ADDR OF LIST IN REG1             46000000
         GETMAIN   ,MF=(E,(1))                                          46200022
         LA    R0,FOUR(,R13)       ADDR SERVICE NAME           @Y17XAXA 46400000
         L     R13,OPCDOUBL        GET ADDR OF SAVEAREA OBTAINED        46500000
         LOAD  DE=(0)              LOAD IEDQFE20               @ZM46621 46550010
         LR    R15,R0              GET EPA                       X02004 47000000
         CLC   FE20,OCMODNME+6     IS IT FE20                  @Y17XAXA 47100000
         BNE   SYNCH1              NO BRANCH                     X02004 47200000
         USING PGFXPARM,R13                                      X02004 47424005
         LR    RWRK5,R0            SAVE EPA                    @Y17XAXA 47430000
         LR    R1,R0               SET START ADDRESS           @ZM46621 47430110
         LR    R15,R0              GET START ADDRESS           @ZM46621 47430210
         A     R15,ZERO(,R1)       CALCULATE END ADDRESS+1     @ZM46621 47430310
         XC    PGFXECB,PGFXECB     CLEAR ECB                   @ZM46621 47430410
         LA    R0,PGFXECB          ECB ADDRESS                 @ZM46621 47430510
         PGFIX R,A=(1),EA=(15),ECB=(0) FIX IEDQFE20            @ZM46621 47430610
         LA    R1,PGFXECB          ECB ADDRESS                   X02004 47496000
         WAIT  ECB=(R1)                                          X02004 47502005
         TM    PGFXECB+THREE,PGFXEROR PAGE FIX ERROR             X02004 47508000
         BZ    SYNCH               B IF NO ERROR                 X02004 47514000
         L     R8,OPCOPTLK         GET ADDR OF GETMAIN BLDL      X02004 47520000
*                                  LIST                          X02004 47526000
         LA    R13,TEN(,R8)        GET ADDR OF BLDL LIST       @Y17XAXA 47532000
         LA    R0,FOUR(,R13)       INSERT NAME TO DELETE       @Y17XAXA 47538000
*                                  REG 0                         X02004 47544000
         DELETE DE=(0)             DELETE IEDQFE20             @ZM46621 47547010
*                                  NO REAL CORE AVAIL            X02004 47556000
         B     TESTCORE            WRITE ERROR MESSAGE           X02004 47562000
SYNCH    EQU   *                                                 X02004 47568005
         LA    R15,FOUR(,RWRK5)    INC PAST LEN TO GET RTN@Y17XAXA      47574000
*                                  EPA                           X02004 47580000
SYNCH1   EQU   *                                                 X02004 47586005
         SR    R0,R0               INDICATE LOAD FUNCTION               47800000
         SYNCH  (15)                                                    48000022
         LTR   R15,R15             INITIALIZED OK ?                     48200022
         BNZ   ERRCODE             NO                                   48400022
RET099I  EQU   *                                               @YM06932 48500000
         LA    R0,IED099I          GET MSG NUMBER              @Y17XAXA 48600000
DELMSG   EQU   *                                                        48800022
         LR    R1,ROPC             ESTABLISH OPCAVT BASE                49000000
         MVC   OPCLDNME+THREE(TWO),M1MOD MOVE MODULE ID        @Y17XAXA 49200000
         B     OUT                 GO TO NEXT MODULE                    49400000
DELETE   B     DELACT              ACTIVE-DELETE                        49600022
         B     ERR104              NOT ACTIVE                  @Y17XAXA 49800000
DELACT   EQU   *                                                        50000022
         ST    R15,OPCTRMWA        SAVE EPA OF ROUTINE                  50200000
         LA    R1,OPCDOUBL         GET ADDRESS OF WHERE TO SAVE         50400000
*                                  GETMAINED CORE                       50600000
         ST    R1,FOUR(R8)         PUT IN GETMAIN LIST         @Y17XAXA 50800000
         MVC   ONE(THREE,R8),REGSAVE GET NUM OF BYTES NEEDED   @Y17XAXA 51000000
         MVI   NINE(R8),XFA        SUBPOOL NUMBER              @Y17XAXA 51200000
         LR    R1,R8               PUT ADDR OF LIST IN R1               51400000
         GETMAIN  ,MF=(E,(1))                                           51600022
         L     R13,OPCDOUBL        GET ADDR OF GETMAINED CORE           51800000
         L     R15,OPCTRMWA        GET SAVED EPA                        51900000
         LA    R15,ZERO(,R15)      CLEAR HI ORDER BYTE         @Y17XAXA 52000000
         LA    R0,TWO55            INDICATE DELETE FUNCTION             52100000
         CLC   FE20,OCMODNME+6     IS IT FE20                  @Y17XAXA 52200000
         BNE   SYNCH3                                            X02004 52480005
         LA    R15,FOUR(,R15)      INCR PAST LENGTH            @Y17XAXA 52520000
SYNCH3   EQU   *                                                 X02004 52560005
         SYNCH (15)                                                     52600022
         LTR   R15,R15             DEACTIVATED OK                       52800022
         BNZ   ERRCODE             NO                                   53000022
         CLC   FE20,OCMODNME+6     IS IT FE20                  @Y17XAXA 53010000
         BNE   BYPASS              NO BYPASS PAGE FREE           X02004 53020000
         L     R1,OPCTRMWA         GET EPA                     @ZM46621 53020410
         LR    R15,R1              GET START ADDRESS           @ZM46621 53020810
         A     R15,ZERO(,R1)       CALCULATE END ADDRESS +1    @ZM46621 53021210
         PGFREE R,A=(1),EA=(15)    FREE FIXED CORE             @ZM46621 53021610
BYPASS   EQU   *                                                 X02004 53130005
         BAL   RETREG,SCRATCH      DELETE MODULE NOT NEEDED             53200000
RET100I  EQU   *                                               @YM06932 53300000
         LA    R0,IED100I          SET DELETE MESSAGE          @Y17XAXA 53400000
         B     DELMSG              SET UP TO WRITE MESSAGE              53600000
SCRATCH  EQU   *                                                        53800022
         L     R8,OPCOPTLK         GET ADDR OF GETMAIN BLDL LIST        54000000
         LA    R13,TEN(,R8)        GET ADDR OF BLDL LIST       @Y17XAXA 54200000
         LA    R0,FOUR(,R13)       INSERT MOD NAME TO DEL      @Y17XAXA 54400000
*                                  REGISTER 0                           54600000
         SVC   NINE                ISSUE SVC                            54800000
         LTR   R15,R15             CHECK RETURN CODE                    55000022
         BNZ   MODIFY              IF BAD,WRITE ERROR MESSAGE           55200022
         BR    RETREG              ELSE GO INITIALIZE                   55400022
ERRCODE  BNP   USER                USER MESSAGE SUPPLIED                55600022
         CH    R15,AVTHA4          RTN CODE EQUAL TO FOUR      @Y17XAXA 55800000
         BE    ERR106              YES MULTIPLE REQUEST        @Y17XAXA 56000000
         STH   R15,OCLINK+TWO      GENERATE USER                        56200000
         UNPK  OCELEM+ONE(FIVE),OCLINK+TWO(THREE) COMPLETION            56400022
         TR    OCELEM+ONE(FOUR),TRTABLE-TWO40 CODE AND         @Y17XAXA 56600000
         L     R13,OPCWORK         GET ADDR OF MSG AREA                 57000000
         MVC   ZERO(TWO,R13),MSGLEN2                           @Y17XAXA 57200000
         MVC   FOUR(FERCMSG,R13),ERRMSGR+ONE  MOVE ERROR TXT   @Y17XAXA 57300000
         MVC   MSG25(FOUR,R13),OCELEM+ONE MOVE INTO MESSAGE    @Y17XAXA 57400000
         B     EXIT                LEAVE ROUTINE                        57600000
USER     LCR   R15,R15             RECOMPLIMENT                         57800022
         LR    R1,R15              GET MSG ADDR IN REG 1                58000000
         L     R13,OPCWORK         GET ADDR OF MSG AREA                 58200000
         MVC   ZERO(TWO,R13),MSGLEN1 MOVE MSG LEN TO OP CTL    @Y17XAXA 58400000
         MVC   FOUR(FEMSGLNG,R13),ZERO(R1) MOVE MSG TEXT       @Y17XAXA 58800000
         BAL   RETREG,VERDEL       VERIFY DELETION                      59200000
         B     EXIT                LEAVE ROUTINE                        59400000
MODIFY   EQU   *                                                        59600022
         LA    R0,IED109I          GET MSG NUMBER              @Y17XAXA 59800000
         B     ERREXIT             GO WRITE ERROR MESSAGE               60000000
VERDEL   EQU   *                                                        60200022
         CLI   OCSWITCH,OCX08      DELETE FUNCTION             @Y17XAXA 60400000
         BNE   SCRATCH             NO                                   60600000
         B     FOUR(RETREG)        RETURN TO CALLER            @Y17XAXA 60800000
TESTCORE EQU   *                                                        61000022
         L     R13,OPCOPTLK        GET GETMAIN BLDL LIST ADDRESS        61200000
         UNPK  OCELEM(FIVE),SIZE+TEN(FOUR,R13) UNPACK GETMAIN  @Y17XAXA 61400000
*                                  SIZE (OBTAINED FROM BLDL     SA68216 61480000
*                                  LIST)                        SA68216 61560000
         TR    OCELEM(FOUR),TRTABLE-TWO40 TRANSLATE NUMBER OF  @Y17XAXA 61640000
*                                  BYTES TO HEX VALUE           SA68216 61720000
         L     R4,OPCWORK          GET ADDR OF MSG AREA                 62020000
         LA    R14,LEN125          GET MESSAGE LENGTH          @SA73354 62320000
         STH   R14,ZERO(R4)        PUT LENGTH IN WORKAREA      @Y17XAXA 62620000
         MVC   FOUR(LEN125,R4),COREMSG+ONE MOVE MESSAGE        @Y17XAXA 63100000
         MVC   OFFSET1+FOUR(FOUR,R4),OCELEM INSERT NUMBER OF   @Y17XAXA 63400000
*                                  BYTES INTO MSG               SA68216 63800000
         B     EXIT                GO TO NEXT MODULE                    64200000
ERR101   EQU   *                                               @Y17XAXA 64600000
         LA    R0,IED101I          GET MSG NUMBER              @Y17XAXA 64800000
         B     ERREXIT             GO WRITE ERROR MESSAGE               65000000
ERR102   EQU   *                                               @Y17XAXA 65200000
         LA    R0,IED102I          GET MSG NUMBER              @Y17XAXA 65400000
         B     ERREXIT             GO WRITE ERROR MESSAGE               65600000
ERR103   EQU   *                                               @Y17XAXA 65800000
         LA    R0,IED103I          GET MSG NUMBER              @Y17XAXA 66000000
         B     ERREXIT             GO WRITE ERROR MESSAGE               66200000
ERR104   EQU   *                                               @Y17XAXA 66400000
         LA    R0,IED104I          GET MSG NUMBER              @Y17XAXA 66600000
         B     ERREXIT             GO WRITE ERROR MESSAGE               66800000
ERR106   EQU   *                                               @Y17XAXA 67000000
         LA    R0,IED106I          GET MSG NUMBER              @Y17XAXA 67200000
         B     ERREXIT             GO WRITE ERROR MESSAGE               67400000
ERR107   EQU   *                                               @Y17XAXA 67600000
         LA    R0,IED107I          GET MSG NUMBER              @Y17XAXA 67800000
ERREXIT  EQU   *                                                        68000022
         LR    R1,ROPC             SET UP PARAMETER                     68200000
         MVC   OPCLDNME+THREE(TWO),ERRORID XCTL TO ERROR WTR   @Y17XAXA 68400000
         B     OUT                 LEAVE                                68600000
EXIT     EQU   *                                                        68800022
         MVC   OPCLDNME+THREE(TWO),MSGWRITR XCTL TO IGC0710D   @Y17XAXA 69000000
OUT      EQU   *                                                        69200022
         LR    R1,ROPC             SET UP PARAMETER REG                 69400000
         XCTL  SF=(E,OPCXCTL)                                           69600022
         SPACE 3                                                        69800022
         SPACE 3                                                        70200022
*        MESSAGES                                                       70400022
COREMSG  DS    0H                                                       70600022
         DC    AL1(ENDMSG-*-1)     LENGTH                               70800000
         DC    C'IED125I '         MSG NUMBER                   SA68216 70900000
NUMBYTES DC    CL4' '              NO. OF BYTES                 SA68216 71000000
         DC    C' BYTES NEEDED'    TEXT                         SA68216 71100000
ENDMSG   EQU   *                                                        71200022
OFFSET1  EQU   NUMBYTES-COREMSG-1  OFFSET TO NUMBYTES IN        SA68216 71250000
*                                  ERROR MSG                    SA68216 71300000
         SPACE 2                                                        71350005
ERRMSGR  DS    0H                                                       71400022
         DC    AL1(ENDMSGRR-*-1)   LENGTH                               71600000
         DC    C'IED105I RETURN CODE=0000' MESSAGE TEXT                 71800000
ENDMSGRR EQU   *                                                        72000022
         SPACE 3                                                        72200022
*        EQUATES                                                        72400022
TRACFLGS EQU   12                  FLAG BYTE OFFSET            @YM06932 72460000
TRCOMWRT EQU   X'08'               COMWRITE INTERFACE ACTIVE   @YM06932 72520000
CVTPTR   EQU   X'10'               ADDRESS OF CVT                       72600000
REGSAVE  DC    X'000048'           NUMBER BYTES NEEDED FOR SAVAREA      72700000
VS1SYS   EQU   116                 VS1 INDICATOR               @Y17XAXA 72800000
SIZE     EQU   28                  OFFSET IN BLDL LIST TO SIZE          72900000
IED099I  EQU   99                  MSG IED099I EQU             @Y17XAXA 73000000
IED100I  EQU   100                 MSG IED100I EQU             @Y17XAXA 73100000
IED101I  EQU   101                 MSG IED101I EQU             @Y17XAXA 73200000
IED102I  EQU   102                 MSG IED102I EQU             @Y17XAXA 73300000
IED103I  EQU   103                 MSG IED103I EQU             @Y17XAXA 73400000
IED104I  EQU   104                 MSG IED104I EQU             @Y17XAXA 73500000
IED106I  EQU   106                 MSG IED106I EQU             @Y17XAXA 74100000
IED107I  EQU   107                 MSG IED107I EQU             @Y17XAXA 74200000
IED109I  EQU   109                 MSG IED109I EQU             @Y17XAXA 74300000
IED548I  EQU   548                 MSG IED548I EQU             @Y17XARA 74400000
FEMSGLNG EQU   29                  MESSAGE LENGTH               SA61063 74500000
FERCMSG  EQU   24                  MESSAGE LENGTH               SA61063 74600000
MSG25    EQU   25                  OFFSET IN MSG FOR RETURN CODE        74700000
LEN125   EQU   ENDMSG-COREMSG-1    LENGTH OF MSG 125            SA68216 74800000
ZERO     EQU   0                   ZERO  - 0                   @Y17XAXA 74900000
ONE      EQU   1                   ONE   - 1                   @Y17XAXA 75000000
TWO      EQU   2                   TWO   - 2                   @Y17XAXA 75100000
THREE    EQU   3                   THREE - 3                   @Y17XAXA 75200000
FOUR     EQU   4                   FOUR  - 4                   @Y17XAXA 75300000
FIVE     EQU   5                   FIVE  - 5                   @Y17XAXA 75400000
EIGHT    EQU   8                   EIGHT - 8                   @Y17XAXA 75500000
NINE     EQU   9                   NINE  - 9                   @Y17XAXA 75600000
TEN      EQU   10                  TEN   - 10                  @Y17XAXA 75700000
FOURTEEN EQU   14                  FOURTEE- 14                 @YM06932 75800000
BLDL     EQU   18                  BLDL SVC 18                 @Y17XAXA 77480000
TWO40    EQU   240                 VALUE TWO40                          77580000
TWO55    EQU   255                 VALUE TWO55                          77680000
X20      EQU   X'20'               HEX 20                               77780000
XFA      EQU   X'FA'               HEX FA                               77880000
CDEEPAD  EQU   X'10'               CDE DISPL TO EP                      77980000
CVTTCBP  EQU   0                   CVT DISPL-ADDR NEW/OLD POINTERS      78080000
TCBOLD   EQU   4                   DISPL  IN NEW/OLD TO OLD TCB         78180000
TCBLLS   EQU   X'24'               TCB DISPL TO LOAD LIST POINTER       78280000
LLECDEAD EQU   X'04'               LOAD LIST ELEM DISP TO CDE ADDR      78380000
MODNAME  EQU   X'08'               CDE DISPL TO MODULE NAME             78480000
LLENXT   EQU   X'00'               LOAD LIST ELEM DISP TO NEXT LLE      78580000
IEDQFE   DC    CL6'IEDQFE'         CHECK FOR PROPER PREFIX     @YM06932 78680000
FE00     DC    C'0'                IEDQFE0X                    @Y17XAXA 79000000
FEXX     DS    0CL2                IEDQFEXX                    @Y17XAXA 79060000
FE10     DC    C'10'               IEDQFE10                    @Y17XAXA 79120000
FE20     DC    C'20'               IEDQFE20                    @Y17XAXA 79180000
FE30     DC    C'30'               IEDQFE30                    @Y17XAXA 79240000
FE40     DC    C'40'               IEDQFE40                    @Y17XAXA 79300000
MSGLEN1  DC    H'29'               LENGTH OF MESSAGE            SA61063 79660000
MSGLEN2  DC    H'24'               LENGTH OF MESSAGE            SA61063 79760000
MSGWRITR DC    C'07'               ID OF IGC0710D MSG WRITER            79860000
ERRORID  DC    C'03'               ID OF IGC0310D ERROR WRITER          79960000
M1MOD    DC    C'M1'               MODULE IGCM110D                      80060000
TRTABLE  EQU   *                   THIS IS THE TRANSLATE TABLE          80600022
         DC    C'0123456789ABCDEF' HEX TRANSLATOR                       80800000
         EJECT                                                          81000022
*        MACROS                                                         81200022
PGFXPARM DSECT                                                   X02004 81210005
PGFXSTRT DS    F                                                 X02004 81220005
PGFXEND  DS    F                                                 X02004 81230005
PGFXECB  DS    F                                                 X02004 81240005
PGFXCODE EQU   X'52'                                             X02004 81250005
PGFRCODE EQU   X'20'                                             X02004 81260005
PGFXEOL  EQU   X'80'                                             X02004 81270005
BYTE0    EQU   8                                                 X02004 81280005
PAGEFIX  EQU   113                                               X02004 81290005
PAGEFREE EQU   113                                               X02004 81300005
PGFXEROR EQU   4                                                 X02004 81310005
         EJECT                                                          81320000
         TAVTD                                                          81330000
         EJECT                                                          81340000
         TOPCED                                                         81350000
         EJECT                                                          81360000
         TOPCAVTD                                                       81370000
         END                                                            82400022
