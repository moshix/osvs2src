         TITLE 'IGCV110D - OPERATOR CONTROL STOPLINE MODULE'            00100022
IGCV110D CSECT                                                          00200022
         SPACE 3                                                 S21903 00210005
*  CHANGE ACTIVITY AS FOLLOWS                                           00220005
*A000000-999999                                                @Y16X5R0 00220100
*A300000                                                        SA63024 00220205
*A143000,302000                                                @SA71514 00220356
*A186000                                                       @SA71947 00220456
*C300500                                                       @YA08784 00220558
*A255000                                                       @OY14483 00224500
******************** MICROFICHE FLAGS *********************** SUPT CODE 00230005
         SPACE 3                                                 S21903 00250005
*C005000                                                         S22024 00260022
*A027300-027360,051500,216100-216600,481300,8484000-485000       S22024 00270022
*D389500,414500                                                 SA67131 00270154
*A295000                                                       @SA69627 00270256
*A304000,381000,150800                                         @OX14763 00272200
*C332300                                MOVED AFTER 331000     @OS77381 00274200
*A005300,005700,005900,028000,031000,208400,208500,488000      @Y17XARW 00279200
*A150960,297000,326000,428000                                  @OY16355 00283200
*D027000                                                       @Y17XARW 00288200
*A1509600216600,216960,336000,371000,385000,329000,470000      @OY14092 00288900
*A317000,342000                                                @OY14092 00289600
*C119000,302100-302700,384000                                  @OY14092 00290300
*C336140-336170,336260-336290                                  @OY16079 00294300
*C216615                                                       @OZ29091 00294486
*C461000                                                       @OZ28375 00294586
*********************************************************************** 00300022
*                                                                     * 00400022
*  TITLE:  IGCV110D - OPERATOR CONTROL STOPLINE MODULE                * 00500005
*                                                                     * 00510005
*                                                                     * 00520005
*  MODULE NAME = IGCV110D( TCAM, OP CONTROL )                  @Y17XARW 00530000
*                                                                     * 00540005
*  DESCRIPTIVE NAME = OPERATOR CONTROL STOPLINE MODULE                * 00550005
*                                                                     * 00560005
*  COPYRIGHT = NONE                                            @Y17XARW 00570000
*                                                                     * 00580005
*  STATUS = VERSION 10.0                                       @Y17XARW 00590000
*                                                                     * 00600022
* FUNCTION -- THIS ROUTINE PROCESSES OPERATOR CONTROL COMMANDS WHICH  * 00700022
*    REQUEST THE STOPPING OF ACTIVITY ON A LINE EITHER IMMEDIATELY    * 00800022
*    OR AT COMPLETION OF THE CURRENT OPERATION.  THE MODULE STOPS     * 00900022
*    EITHER A SINGLE LINE OR ALL LINES ASSOCIATED WITH ONE DCB DEPEND-* 01000022
*    ING ON WHAT KIND OF REQUEST.  THE OPERATOR CONTROL ELEMENT IS    * 01100022
*    LINKED INTO A WAIT LIST TO WAIT FOR COMPLETION OF THE STOPLINE   * 01200022
*    REQUEST.  THIS MODULE REQUESTS A UNIT WHICH IS SENT OVER TO TCAM * 01300022
*    STOPLINE (HK).  THIS UNIT CONTAINS THE ADDRESS OF HK, CERTAIN    * 01400022
*    FLAGS, THE ADDRESS OF THE LCB, AND THE ADDRESS OF THE DEB FOR THE* 01500022
*    LINE TO BE STOPPED.  WHEN A STOPPED LCB COMES BACK TO STOPLINE,  * 01600022
*    THE MODULE RECEIVES IT JUST LIKE A REGULAR ELEMENT.  IF IT IS THE* 01700022
*    SAME ELEMENT AS WAS SENT OVER, AN ERRORMESSAGE IS PRINTED SINCE  * 01800022
*    THIS INDICATES THAT TSO IS ON THE LINE.  OTHERWISE, IT COMPARES  * 01900022
*    THE RETURNED LCB WITH THE LCB ADDRESS IN THE UNITS LINKED TO     * 02000022
*    OPERATOR CONTROL ELEMENTS ON THE WAIT LIST.  WHEN A MATCH IS     * 02100022
*    FOUND, THE UNIT IS DEALLOCATED.  IN THE CASE OF STOPPING ALL     * 02200022
*    LINES ON A DCB, THE RELATIVE LINE NUMBER IS INCREMENTED AND THE  * 02300022
*    REQUEST IS MADE TO HK TO STOP THE NEXT LINE ON THE LINE GROUP.   * 02400022
*    FOR A SINGLE LINE STOP, THE RLN IS COMPARED TO THE NUMBER OF     * 02500022
*    LINES IN THE GROUP.  IF THE RLN IS HIGHER THAN THE NUMBER OF     * 02600022
*    LINES, AN ERROR EXIT IS TAKEN.  FOR COMMANDS FOR DEVICES OFFS22024 02730022
*    OF AN RN, A NEW MODULE IGCV810D IS XCTLED TO FROM IGCV110D. S22024 02760022
*                                                                     * 02800022
*    NOTES = SEE BELOW                                         @Y17XARW 02806000
*                                                              @Y17XARW 02812000
*            RESTRICTIONS = NONE                               @Y17XARW 02818000
*                                                              @Y17XARW 02824000
*            REGISTER CONVENTIONS = SEE REGISTER DECLARES      @Y17XARW 02830000
*                                                              @Y17XARW 02836000
*            PATCH LABEL = ZAPAREA                             @Y17XARW 02842000
*                                                              @Y17XARW 02848000
*    MODULE TYPE = PROCEDURE                                   @Y17XARW 02854000
*                                                              @Y17XARW 02860000
*            PROCESSOR = ASSEMBLER XF                          @Y17XARW 02866000
*                                                              @Y17XARW 02872000
*            MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY      @Y17XARW 02878000
*                                                              @Y17XARW 02884000
* ENTRY POINTS --                                                     * 02900022
*    IGCV110D FOR ALL STOPLINE REQUESTS.                              * 03000022
*                                                                     * 03100022
*            PURPOSE = SAME AS FUNCTION                        @Y17XARW 03110000
*                                                              @Y17XARW 03120000
*            LINKAGE = IGCV010D, IGCV210D, IGCV410D, IGCI010D, @Y17XARW 03130000
*                      XCTL TO IGCV110D                        @Y17XARW 03140000
*                                                              @Y17XARW 03150000
*                      IGCV110D XCTL'S TO IGC0010D, IGC0310D,  @Y17XARW 03160000
*                      IGC0610D, IGC0710D, IGC0910D, IGCVG10D, @Y17XARW 03170000
*                      IGCV210D, IGCV410D                      @Y17XARW 03180000
*                                                              @Y17XARW 03190000
* INPUT --                                                            * 03200022
*    ON RETURNING STOPPED LCBS.  OPCCOPCE IS THE ADDRESS OF THE       * 03300022
*    CURRENT ELEMENT.  RELEVANT FIELDS ARE OCSWITCH.  THIS INDICATES  * 03400022
*    WHETHER IT IS AN 'I' TYPE OR 'C' TYPE STOPLINE.                  * 03500022
*                                                                     * 03600022
*    BESIDES AN EXPLICIT STOPLINE REQUEST, A REQUEST TO STOP A LINE   * 03700022
*    CAN COME FROM THE FOLLOWING MODULES.                             * 03800022
*         IGCV210D STOP TERMINAL                                      * 03900022
*         IGCV410D START TERMINAL                                     * 04000022
*         IGCI010D ICHNG DEACTIVATE                                   * 04100022
*         IGCI110D ICHNG MOVE OR ACTIVATE                             * 04200022
*                                                                     * 04300022
* OUTPUT --                                                           * 04400022
*    REGISTER 0 - NUMBER OF AN ERROR MESSAGE.                         * 04500022
*    REGISTER 1 - RETURN CODE SET UP.                                 * 04600022
*                                                                     * 04700022
* EXTERNAL REFERENCES --                                              * 04800022
*         NONE.                                                       * 04900022
*                                                                     * 05000022
* EXITS,NORMAL --                                                     * 05100022
*        FOR STOPLINE REQUESTS, MODULE IGCV810D IS XCTLED TO.    S22024 05150022
*         LINE OR LINE GROUP STOPPED.  APPROPRIATE MESSAGE NUMBER     * 05200022
*         SET UP TO GO TO MESSAGE MODULE, X'00' RETURN CODE SET.      * 05300022
*                                                                     * 05400022
*         LINE OR LINE GROUP ALREADY STOPPED.  APPROPRIATE MESSAGE    * 05500022
*         NUMBER SET UP TO GO TO MESSAGE MODULE, X'08' RETURN CODE SET* 05600022
*                                                                     * 05700022
* EXITS,ERROR --                                                      * 05800022
*         TERMINAL NOT FOUND, LINE OR LINE GROUP NOT OPEN, OR OPEN    * 05900022
*         DD DUMMY, OR RLN INVALIDLY SPECIFIED.  ERROR REGISTER SET   * 06000022
*         UP, X'04' RETURN CODE SET.                                  * 06100022
*                                                                     * 06200022
* TABLES/WORK AREAS --                                                * 06300022
*    OPERATOR CONTROL AVT, OPERATOR CONTROL ELEMENT, STOPLINE REQUEST * 06400022
*    ELEMENT, DEB, DCB, LCB, QCB, TERMNAME TABLE, TERMINAL ENTRY AND  * 06500022
*    AVT.                                                             * 06600022
*                                                                     * 06700022
* ATTRIBUTES --                                                       * 06800022
*    SERIALLY REUSABLE, REFRESHABLE, ENABLED, TRANSIENT,              * 06900022
*    SUPERVISOR MODE.                                                 * 07000022
*                                                                     * 07100022
* CHARACTER CODE DEPENDENCY --                                        * 07200022
*    THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL            * 07300022
*    REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS            * 07400022
*    EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE CODING         * 07500022
*    HAS BEEN ARRANGED SO THAT REDEFINITION OF CHARACTER              * 07600022
*    CONSTANTS, BY REASSEMBLY WILL RESULT IN A CORRECT MODULE         * 07700022
*    FOR THE NEW DEFINITION.                                          * 07800022
*                                                                     * 07900022
* NOTES --                                                            * 08000022
*    COMMUNICATIONS BETWEEN THE VARIOUS TRANSIENT MODULES IS          * 08100022
*    PRIMARILY THROUGH THE OPERATOR CONTROL AVT.                      * 08200022
*                                                                     * 08300022
*    THIS IS A MODULE RE-WRITE OF IEDQCV AS OF OS/TCAM LEVEL II       * 08350022
*********************************************************************** 08400022
         EJECT                                                          08500022
         SPACE                                                          08600022
*                                 E Q U A T E S                         08700022
         SPACE                                                          08800022
RZERO    EQU   0                        PARAMETER REGISTER              08900022
RPARM    EQU   1                        PARAMETER REGISTER              09000022
ROPCAVT  EQU   2                        POINTER TO OP CONTROL AVT       09100022
ROPCE    EQU   3                        POINTER TO CURRENT OPCE         09200022
RAVT     EQU   4                        TCAM AVT ADDRESS                09300022
RWORKA   EQU   5                        POINTER TO RESIDENT WORKAREA    09400022
RRLN     EQU   5                        RELATIVE LINE NUMBER            09500022
RSCB     EQU   6                        SCB BASE                        09600022
RLCB     EQU   6                        LCB ADDRESS                     09700022
RTERM    EQU   6                        TERM ENTRY BASE                 09800022
RTNT     EQU   6                        TERM NAME TABLE ADDR            09900022
RUCB     EQU   6                        UCB ADDRESS                     10000022
RDCB     EQU   7                        DCB BASE                        10100022
RWORK    EQU   8                        WORK REGISTER                   10200022
RWORK1   EQU   9                        WORK REGISTER                   10300022
RPREFIX  EQU   9                        BUFFER ADDRESS                  10400022
RDEB     EQU   10                       DEB BASE                        10500022
RQCB     EQU   11                       QCB ADDRESS                     10600022
RUNIT    EQU   11                       UNIT ADDRESS                    10700022
RBASE    EQU   12                       BASE FOR MODULE                 10800022
RRET     EQU   14                       SUBROUTINE RETURN ADDRESS       10900022
RBRNCH   EQU   15                       SUBROUTINE BRANCH ENTRY POINT   11000022
         SPACE 2                                                        11100022
EIGHT    EQU   8                        LENGTH OF EIGHT                 11200022
NAMELEN  EQU   2                        NO. OF NAME CHANGE CHARACTERS   11300022
RLNOFF   EQU   9                        OFFSET TO RELATIVE LINE NO.     11400022
VARINAME EQU   3                        OFFSET TO CHANGE LOAD NAME      11500022
ZONE     EQU   X'F0'                    CHARACTER TO COVER CONVERT SIGN 11600022
DEBOFF   EQU   12                       OFFSET OF DEB IN UNIT TO HK     11700022
LCBOFF   EQU   16                       OFFSET OF LCB IN UNIT TO HK     11800022
RLN      EQU   22                                              @OY14092 11900000
ALLRLN   EQU   X'20'                    TO CHECK FOR RLN = ALL          12000022
FOUR     EQU   4                        TO CHECK STOP TERM COMMANDS     12100022
ICHNG    EQU   X'49'                    ICHNG OPT CODE                  12200022
HALT     EQU   X'12'                    CHECK HALT IMMEDIATE IN SWITCH  12300022
IMMEDIAT EQU   X'80'                    INDICATE HALT IMMEDIATE TO HK   12400022
INDIC    EQU   8                        FLAG OFFSET                     12500022
ONE      EQU   1                        DISPLACEMENT                    12600022
THREE    EQU   3                        DISPLACEMENT                    12700022
HKOFF    EQU   0                        OFFSET OF HK ADDRESS IN UNIT    12800022
LINK     EQU   0                        OFFSET TO LINK FIELD            12900022
PRIROFF  EQU   4                        OFFSET OF PRIORITY IN HK UNIT   13000022
ONESTOP  EQU   X'20'                    TO INDICATE THAT ONE LINE STOP  13100022
STOPONE  EQU   9                        OFFSET IN HK UNIT OF FLAG       13200022
NEXTRLN  EQU   1                        TO BUMP RLN BY ONE              13300022
TWO      EQU   2                        DISPLACEMENT                    13400022
WORD     EQU   4                        FULL WORD                       13500022
BADCMND  EQU   18                       INVALID COMMAND ERROR           13600022
FIRSTRLN EQU   1                        TO START INCREMENTING RLN       13700022
NOTCA    EQU   X'02'                    ENTRY IS NOT FROM CA            13800022
POST     EQU   X'0C'                    TO POST SVC 102                 13900022
END      EQU   X'80'                    PARAMETER LIST                  14000022
ERROR47  EQU   47                       ERROR -IN SYSTEM DELAY          14100022
ERROR25  EQU   25                       ERROR-LINE ALREADY STOPPED      14200022
ERROR13  EQU   13                       STOP REQUEST FOR SELF           14300022
XEF      EQU   X'EF'               RESET MASK FOR STOP TERM TSO@SA71514 14330056
X50      EQU   X'50'               STOPPING TSO TERM           @SA71514 14360056
X40      EQU   X'40'                    STOPLINE REQUEST FROM A MODULE  14400022
ERROR17  EQU   17                       ERROR-DCB NOT OPEN              14500022
GOODSTOP EQU   26                       SUCCESSFUL STOP MESSAGE NUMBER  14600022
TOTE     EQU   X'F1'                    TOTE HAS LCB FOR LINE           14700022
ERROR49  EQU   49                       ERROR-TOTE CONTROLS LINE        14800022
FFBYTE   EQU   X'FF'                    TO DESIGNATE END OF TABLE       14900022
ZERO     EQU   0                        DISPLACEMENT                    15000022
STOPALL  EQU   X'01'                    ALL LINES TO BE STOPPED         15020022
MPPERR   EQU   X'40'                    ONE LINE IN ERROR               15040022
ERROR12  EQU   12                       TSO SESSION ON LINE             15060022
BITSOFF  EQU   X'FC'                    TO TURN OFF BITS                15080022
LCBBFRED EQU   X'1A'                    BFRD SCHEDULER VTO     @OX14763 15084000
UNITOFF  EQU   24                       OFFSET OF EXTRA UNIT   @OX14763 15088000
ERROR16  EQU   16                       STATION NOT FOUND      @OX14763 15092000
AD       EQU   7                        MASK                   @OX14763 15096000
TTCIN    EQU   X'14'                    OFFSET INTO HK ELEMENT @OY14092 15096100
TSCHK    EQU   X'20'                    CHECK FOR TSO          @OY14092 15096200
LOGOFF   EQU   X'10'                    ISSUE QTIP IF NEEDED   @OY14092 15096300
LINEOPCE EQU   X'10'                    TEST FOR STOPLINE               15096400
PRISTOP  EQU   X'E8'                    PRIORITY USED TO       @OY16355 15097400
*                                       POST LCB TO OPCOB      @OY16355 15098400
         EJECT                                                          15100022
         USING IEDQAVTD,RAVT            TCAM AVT ADDRESSABILITY         15200022
         USING IEDQOPCD,ROPCAVT         OP CONTROL AVT ADDRESSABILITY   15300022
         USING IEDQOPCE,ROPCE           ELEMENT ADDRESSABILITY          15400022
         USING DEBNMSUB,RDEB            DEB ADDRESSABILITY              15500022
         USING IHADCB,RDCB              DCB ADDRESSABILITY              15600022
         USING IEDQQCB,RQCB             QCB ADDRESSABILITY              15700022
         USING IEDQTNTD,RTNT            TNT ADDRESSABILITY              15800022
         USING IEDQPRF,RPREFIX          BUFFER ADDRESSABILITY           15900022
         USING IEDQTRM,RTERM            TERM ENTRY ADDRESSABILITY       16000022
         USING IEDQSCB,RSCB             SCB ADDRESSABILITY              16100022
         SPACE                                                          16200022
         BALR  RBASE,ZERO               SET BASE REGISTER               16300022
         USING *,RBASE                  MODULE ADDRESSABILITY           16400022
BASE     EQU   *                                                        16500022
IGCV110D IEDHJN  SKIPID                                                 16800022
*  DETERMINE IF RETURNED LCB, REGULAR COMMAND, OR QUEUED COMMAND      * 17100022
         LR    ROPCAVT,RPARM            SET UP AVT ADDRESSING           17200022
         L     RAVT,OPCAVTPT            TCAM AVT ADDRESSING             17300022
         L     ROPCE,OPCCOPCE           GET CURRENT ELEMENT POINTER     17400022
         L     RWORKA,OPCWORK           GET WORKAREA ADDRESS            17500022
         BCT   RZERO,LCBRETUN           GO PROCESS RETURNED LCB         17600022
*              THE ELEMENT IS PROCESSED FROM HERE                     * 17700022
         LA    RPARM,FOUR               SET ERROR                       18300022
         LA    RZERO,ERROR47            SET DELAY ERROR MESSAGE         18400022
         TM    AVTBIT1,AVTDLAYN         IN A SYSTEM DELAY               18500022
         BO    ERROR                    YES COMMAND INVALID             18600022
         CLI   OCOPTCDE,ICHNG          IS IT FOR ICHNG         @SA71947 18630056
         BE    UCBADD                  BRANCH YES              @SA71947 18660056
         SPACE                                                          18700022
         SR    RPARM,RPARM              CLEAR FOR RLN                   18800022
         TM    OCSWITCH,X40             STOPLINE REQUEST FROM A MODULE  18900022
         BO    VERIFY                   YES UCB ADDRESS                 19000022
         SPACE                                                          19100022
         MVC   OPCDOUBL(EIGHT),OCBACKUP PLACE INPUT FOR LOCATING DCB    19200022
UCBADD   EQU   *                                                        19300022
         TM    OCFLAG,OCLINE            LINE NUMBER FOR STOP            19400022
         BO    VERIFY                   YES GET DCB,UCB ADDRESSES       19500022
         SPACE                                                          19600022
         IC    RPARM,OCRLN              GET RELATIVE LINE NUMBER        19700022
         LTR   RPARM,RPARM              'ALL' SPECIFIED                 19800022
         BNZ   VERIFY                   NO GET DCB ADDRESS              19900022
         SPACE                                                          20000022
         LA    RPARM,FIRSTRLN           SET DUMMY RLN                   20100022
         OI    OPCFLAG1,ALLRLN          INDICATE DUMMY RLN SET          20200022
VERIFY   EQU   *                                                        20300022
         L     RBRNCH,OPCDCBLK          GET DCB LOOK-UP ADDRESS         20400022
         BALR  RRET,RBRNCH              LOOK UP DCB AND UCB ADDRESS     20500022
         SPACE                                                          20600022
         B     PROCSTOP                 GOOD RETURN                     20700022
         SPACE                                                          20800022
         LTR   RDCB,RPARM               SET DCB BASE REG                20810022
         BZ    SET17                    BRANCH IF DDNAME NOT FOUND      20820022
         TM    DCBOFLGS,OPEN            WAS DCB OPEN                    20830022
         BZ    SET17                    BRANCH IF NOT OPEN              20840022
         TM    DCBDSORG,LGB3705         IS THIS AN LGB?        @Y17XARW 20843000
         BO    ALLPROC                  YES, CHK RLN OF 'ALL'  @Y17XARW 20846000
         BCT   RZERO,SET17              BRANCH IF RLN TOO HIGH          20850022
ALLPROC  EQU   *                        CHECK RLN OF 'ALL'     @Y17XARW 20855000
         TM    OPCFLAG1,ALLRLN          RLN OF 'ALL'                    20860022
         BO    PROCSTOP                 YES, ENTER LOOP                 20870022
OPEN     EQU   X'10'                    OPEN BIT                 S22024 20880000
SET17    EQU   *                                                        20890022
         LA    RPARM,FOUR               ERROR RETURN CODE               20900022
         LA    RZERO,ERROR17            DCB NOT OPEN                    21000022
         B     ERROR                    NO DD,INVALID RLN,DCB NOT OPEN  21100022
         SPACE                                                          21200022
PROCSTOP EQU   *                                                        21300022
         STH   RZERO,OCX1A(ROPCE)       SET UP UCB ADDRESS TO COMPARE   21350022
         SR    RRLN,RRLN                INIT REG                        21400022
         IC    RRLN,OCRLN               SET UP RELATIVE LINE NUMBER     21500022
         LR    RDCB,RPARM               DCB ADDRESS                     21600022
LGB3705  EQU   X'80'                    DATA SET ORG FOR AN LGB  S22024 21610022
         TM    DCBDSORG,LGB3705         IS IT AN LGB             S22024 21620022
         BZ    NOTANLGB                 BRANCH NO                S22024 21630022
         TM    OPCFLAG1,ALLRLN          RLN EQUAL ALL            S22024 21632022
         BZ    NOCLEAR                  BRANCH NO                S22024 21634022
         MVI   OCRLN,AVTEZERO           CLEAR RLN                S22024 21636022
NOCLEAR  EQU   *                                                 S22024 21638022
         MVI   OCALSTAT,AVTEZERO        CLEAR FLAG BYTE        @YM08548 21639000
         MVC   OPCLDNME+VARINAME(NAMELEN),RNSTPLNE  SET UP RN ID S22024 21640022
         B     XCTL                     GO TO RN STOPLINE        S22024 21650022
NOTANLGB EQU   *                                                 S22024 21660022
         L     RUNIT,OCUNIT             GET SAVED UNIT ADDRESS @OY14092 21660500
         TM    OCUNIT+THREE,TWO         IS UNIT THERE          @OY14092 21661000
         BNZ   GETUNT                   UNIT NOT THERE         @OZ29091 21661586
         TM    OCSWITCH,X40             STRTTRM,STOPTRM,ICHNG? @OZ29091 21662486
         BZ    GOTUNIT                  NO                     @OZ29091 21663386
         MVC   OCLINK+ONE(THREE),OPCWAITL+ONE                  @OZ29091 21664286
*                                   QUEUE OPCE ON TOP OF WAITL @OZ29091 21665186
         STCM  ROPCE,AD,OPCWAITL+ONE                           @OZ29091 21666086
         B     CALL00                                          @OZ29091 21666986
GETUNT   EQU   *                                               @OZ29091 21667886
         LA    RPARM,ONE                NUMBER OF UNITS TO OBTAIN       21670022
         L     RBRNCH,OPCGETBF          BUFFER REQUEST                  21676022
         BALR  RRET,RBRNCH              OBTAIN NEW UNIT                 21682022
         ST    RPARM,OCUNIT             SAVE UNIT ADDRESS               21688022
         LR    RUNIT,RPARM              SET UP UNIT REGISTER            21694022
PLCBFLG  EQU   X'20'                    OFFSET TO PLCB INDICATOR S22024 21696000
GOTUNIT  EQU   *                                               @OY14092 21696500
         MVI   PLCBFLG(RUNIT),OCFOXES   INDICATE NOT PLCB        S22024 21698000
         L     RDEB,DCBDEBAD            DEB ADDRESS                     21700022
         TM    OPCFLAG1,ALLRLN          RLN OF 'ALL'                    21800022
         BNO   CHEKLAST                 NO CONTINUE                     21900022
         SPACE                                                          22000022
         MVI   OCRLN,AVTEZERO           RESET RLN TO ALL INDICATION     22100022
         LA    RRLN,NEXTRLN             INCREMENT RLN                   22200022
CHEKLAST EQU   *                                                        22300022
         STC   RRLN,RLN(RUNIT)          SAVE LAST RLN                   22400022
         LR    RWORK,RRLN               SET UP ALTERNATE REGISTER       22500022
         SLL   RWORK,TWO                MULTIPLY BY FOUR                22600022
         L     RUCB,DEBUCBAD-FOUR-DEBNMSUB(RWORK,RDEB) UCB ADDRESS      22700022
         LA    RUCB,AVTEZERO(RUCB)      CLEAR HIGH BYTE                 22800022
         LTR   RUCB,RUCB                OPENED DD DUMMY                 22900022
         BZ    CHEKALL                  YES REJECT                      23000022
         SPACE                                                          23100022
*              GET CORRECT LCB ADDRESS                                * 23200022
         LR    RWORK,RRLN               RESET RLN                       23300022
         L     RLCB,DCBIOBAD            IOB ADDRESS                     23400022
         SR    RWORK1,RWORK1            CLEAR REG                       23500022
         IC    RWORK1,DCBEIOBX          GET IOB LENGTH                  23600022
         MR    RWORK,RWORK              GET IOB INDEX                   23700022
         AR    RLCB,RWORK1              ADD RESULT TO IOB ADDRESS       23800022
         LA    RWORK,LCBFLAG1-IEDQLCB   GET LENGTH OF IOB               23900022
         SR    RLCB,RWORK               START OF LCB                    24000022
         ST    RDEB,DEBOFF(RUNIT)       SAVE DEB ADDRESS                24100022
         LA    RLCB,AVTEZERO(RLCB)      CLEAR HIGH BYTE                 24200022
         ST    RLCB,LCBOFF(RUNIT)       SAVE LCB ADDR                   24300022
PROCMND  EQU   *                                                        24400022
         CLI   LCBCPA-IEDQLCB(RLCB),TOTE LCB UNDER TOTE CONTROL         24500022
         BNE   NOTOTE                   NO                              24600022
         SPACE                                                          24700022
         LA    RPARM,FOUR               SET ERROR RETURN CODE           24800022
         LA    RZERO,ERROR49            SET ERROR CODE FOR TOTE CONTROL 24900022
         CLI   AVTOLTST,AVTEZERO        TOTE ACTIVE?                    25000022
         BE    ERROR                    NO, ERROR                       25100022
         SPACE                                                          25200022
NOTOTE   EQU   *                                                        25300022
         TM    OCFLAG,OCCONSOL+OCTOTE+OCMPP CONSOLE,TOTE,MPP INPUT      25400022
         BNZ   NOTTERM                  NOT REQUEST FROM TERMINAL       25500022
         TM    OCSWITCH,FOUR+EIGHT      START/STOPTERM REQUEST @OY14483 25530000
         BNZ   NOTTERM                  YES,BRANCH             @OY14483 25560000
         SPACE                                                          25600022
         L     RWORK,OCMODNME           PICK UP LCB ADDRESS             25700022
         LA    RWORK,AVTEZERO(RWORK)    CLEAR HI BYTE                   25800022
         LA    RLCB,0(RLCB)             CLEAR HIGH BYTE                 25900022
         CR    RLCB,RWORK               IS REQUESTED REQUESTOR          26000022
         LA    RPARM,FOUR               SET ERROR RETURN CODE           26100022
         LA    RZERO,ERROR13            STOP REQUEST FOR SELF           26200022
         BE    ERROR                    YES REJECT REQUEST              26300022
         SPACE                                                          26400022
NOTTERM  EQU   *                                                        26500022
         MVI   INDIC(RUNIT),AVTEZERO    SET SINGLE INDICATOR            26600022
         CLI   OCOPTCDE,ICHNG           IS THIS FOR ICHNG               26700022
         BNE   AQCTL                    NO CONTINUE                     26800022
         SPACE                                                          26900022
         TM    OPCSPEC,OPCRSTRT         RESTART SITUATION               27000022
         BO    RESTART                  YES                             27100022
         SPACE                                                          27200022
AQCTL    EQU   *                                                        27300022
         CLI   OCSWITCH,HALT            HALT LINE                       27400022
         BNE   ENQUEUE                  NO                              27500022
         SPACE                                                          27600022
         OI    INDIC(RUNIT),IMMEDIAT    TURN ON HALT LINE INDICATOR     27700022
ENQUEUE  EQU   *                                                        27800022
         LA    RWORK,OPCWAITL           WAIT LIST                       27900022
LOCATEND EQU   *                                                        28000022
         L     RWORK1,AVTEZERO(RWORK)   GET NEXT ELEMENT                28100022
         LA    RWORK1,AVTEZERO(RWORK1)  CLEAR HIGH BYTE                 28200022
         LTR   RWORK1,RWORK1            IS THIS AN ELEMENT              28300022
         BZ    ENDQUEUE                 GO PUT ELEMENT ON WAIT LIST     28400022
         SPACE                                                          28500022
         CLC   OCX1A(TWO,ROPCE),OCX1A(RWORK1)  HAS REQUEST BEEN MADE    28600022
         BE    ATTACH                   YES                             28700022
         SPACE                                                          28800022
         LR    RWORK,RWORK1             NEW ELEMENT BECOMES OLD ELEMENT 28900022
         B     LOCATEND                 FIND END OF LIST                29000022
         SPACE                                                          29100022
*              SET UP ELEMENT TO GO TO HK TO PERFORM STOPLINE         * 29200022
ENDQUEUE EQU   *                                                        29300022
         CLI   LCBSTAT1-IEDQLCB(RLCB),AVTEZERO LINE ALREADY STOPPED     29400022
         BNE   PERFOSTP                 NO PERFORM STOPLINE             29500022
         TM    LCBSTAT2-IEDQLCB(RLCB),LCBMSGNN  CHECK MSGEN    @SA69627 29530056
         BO    PERFOSTP                 STOP THE LINE          @SA69627 29560056
         SPACE                                                          29600022
         NI    OCSWITCH,OCFOXES-X40     TURN OFF START LINE BIT         29700022
         CLI   LCBPRI-IEDQLCB(RLCB),PRISTOP  LCB ON AVTOPCOB   @OY16355 29710000
         BNE   CHEKALL                  NO, KEEP PROCESSING    @OY16355 29720000
         STCM  ROPCE,AD,OCLINK-IEDQOPCE+1(RWORK)               @OY16355 29730000
         XC    OCLINK+ONE(THREE),OCLINK+ONE  ZERO LINK FIELD   @OY16355 29740000
*        PUT THIS REQUEST ON WAITL BECAUSE STOPLINE HAS        @OY16355 29750000
*        ALREADY BEEN REQUESTED AND LCB IS MARKED STOPPED      @OY16355 29760000
*        AND SHOULD BE ON AVTOPCOB.                            @OY16355 29770000
         B     LCBPOSTD                                        @OY16355 29800000
         SPACE                                                          29900022
PERFOSTP EQU   *                                                        30000022
         TM    LCBSTAT1-IEDQLCB(RLCB),LCBSENDN+LCBRECVN         SA63024 30010005
*                                       NO ENDING STATUS        SA63024 30020005
*                                       RECEIVED BY LINE OPEN   SA63024 30030005
         BNO   NOTBOTH                  BRANCH IF NO            SA63024 30040005
         OI    INDIC(RUNIT),IMMEDIAT    TURN ON HALT INDICATOR @YA08784 30050058
NOTBOTH  EQU   *                                                SA63024 30070005
         ST    ROPCE,OCLINK-IEDQOPCE(RWORK)  ADD ELEMENT TO WAIT LIST   30200022
         TM    OCSWITCH,FOUR+EIGHT      STOP OR START TERM     @OY14092 30210000
         BZ    NOTNT                    NO, BRANCH             @OY14092 30220000
         MVC   TTCIN(TWO,RUNIT),OCTRMTBL SET TNT OFFSET        @OY14092 30230000
NOTNT    EQU   *                                               @OY14092 30240000
         NC    OCWTG(TWO),OCWTG         CALLER ID SPECIFIED    @OY14092 30250000
         BNZ   OKWTG                    YES, BRANCH            @XM05684 30260000
         MVC   OCWTG(TWO),STOPLINE      RETURN TO THIS MODULE  @OY14092 30270000
         LA    RZERO,ONE                SET UP RETURN PARM     @OY14092 30271000
         STH   RZERO,OCPARM             SAVE                   @OY14092 30272000
OKWTG    EQU   *                                               @OY14092 30273000
         OI    INDIC(RUNIT),TSCHK       SET FOR TSO CHECK      @OY14092 30274000
         TM    OCSWITCH,HALT            STOPLINE,I             @OY14092 30275000
         BNO   NOTQUCK                  NO, BRANCH             @OY14092 30276000
         XI    INDIC(RUNIT),LOGOFF+TSCHK FORCE LOGOFF          @OY14092 30277000
NOTQUCK  EQU   *                                               @OY14092 30278000
         XC    OCLINK+ONE(THREE),OCLINK+ONE  ZEROES LINK FIELD          30400022
         CLI   LCBRSKEY-IEDQLCB(RLCB),LCBBFRED  LCB FOR        @OX14763 30403000
*                                        BUFFERED TERMS        @OX14763 30406000
         BNE   GOSTOP                   NO, DO STOPLINE        @OX14763 30409000
         TM    OCSWITCH,X40             STOP TERM OR ICHNG     @OX14763 30412000
         BZ    GOSTOP                   NO, DO STOPLINE        @OX14763 30415000
         CLI   OCOPTCDE,OCICHNG         ICHNG FUNCTION         @OX14763 30418000
         BNE   GETUNIT                  NO, GET EXTRA UNIT     @OX14763 30421000
         NC    OCMODNME(FOUR),OCMODNME  ICHNG ACTIVATE         @OX14763 30424000
         BNZ   GOSTOP                   NO, DO STOPLINE        @OX14763 30427000
GETUNIT  EQU   *                                               @OX14763 30430000
         LA    RPARM,ONE                NUMBER OF UNITS        @OX14763 30433000
         L     RBRNCH,OPCGETBF          BUFFER REQUEST ROUTINE @OX14763 30436000
         BALR  RRET,RBRNCH              GET NEW UNIT           @OX14763 30439000
         ST    RPARM,UNITOFF(RUNIT)     SAVE EXTRA UNIT ADDR   @OX14763 30442000
         MVC   OCOPTCDE-IEDQOPCE(TWO,RPARM),OCOPTCDE SAVE      @OX14763 30445000
*                                         ACTION CODES         @OX14763 30448000
         CLI   OCOPTCDE,OCICHNG         ICHNG ACTIVATE         @OX14763 30451000
         BE    GOSTOP                   YES, DO STOPLINE       @OX14763 30454000
         LR    RWORK,RPARM              SAVE UNIT ADDR         @OX14763 30457000
         MVC   OPCDOUBL(EIGHT),OCBACKUP SET FOR TERMNAME LKUP  @OX14763 30460000
         L     RBRNCH,OPCTOFLK          TERM LOOKUP CODE       @OX14763 30463000
         BALR  RRET,RBRNCH              LINK TO ROUTINE        @OX14763 30466000
         B     SETTRM                   GOOD RETURN            @OX14763 30469000
         LA    RZERO,ERROR16                                   @OX14763 30472000
         STCM  RWORK,AD,OCUNIT+ONE-IEDQOPCE(RWORK)             @OX14763 30475000
*                                       LINK UNITS TO FREE     @OX14763 30478000
         B     ERROR                                           @OX14763 30481000
SETTRM   EQU   *                                               @OX14763 30484000
         ST    RPARM,OCDEST-IEDQOPCE(RWORK) SAVE TRM ENTRY     @OX14763 30487000
*                                          ADDR FOR IEDQHK     @OX14763 30490000
GOSTOP   EQU   *                                               @OX14763 30493000
         L     RWORK,AVTHK              GET STOPLINE SUBTASK ADDRES     30500022
         ST    RWORK,HKOFF(RUNIT)       PUT IN ELEMENT                  30600022
         SR    RWORK,RWORK              CLEAR LINK FIELD IF NECCESSARY  30700022
         MVI   PRIROFF(RUNIT),PRIOPCTL  SET PRIORITY                    30800022
         LR    RWORK,RUNIT              TO SET UP SVC 102 PARM LIST     30900022
         ST    RWORK,OPCAQCTL           PUT IN SVC 102 PARM LIST        31000022
         ST    RWORK,OPCAQCTL+WORD      PUT IN SVC 102 PARM LIST        31100022
         MVI   OPCAQCTL,POST            STOP LINE REQUEST TO MPC        31200022
         MVI   OPCAQCTL+FOUR,END        END OF PARM LIST                31300022
         LA    RPARM,OPCAQCTL           GET ADDRESS OF LIST             31400022
         SPACE                                                          31500022
         AQCTL                          POST STOP REQUEST               31600022
         SPACE 2                                                        31700022
CALL00   EQU   *                                               @OY14092 31750000
         MVC   OPCLDNME+VARINAME(NAMELEN),FIRSTLD                       31800022
         LA    RZERO,NOTCA              SET UP NOT FROM CA INDICATOR    31900022
         B     XCTL                     XCTL TO 00                      32000022
         SPACE                                                          32100022
*              THIS CODE PROCESSES A RETURNED LCB                     * 32200022
LCBRETUN EQU   *                                                        32300022
         BCT   RZERO,NOTVARY            CHECK MULTIPLE USE OF RESOURCE  32400022
         SPACE                                                          32500022
         LR    RLCB,ROPCE               STOPPED LCB RETURN              32600022
         MVI   LCBPRI-IEDQLCB(RLCB),PRILNFRE  MARK FREE        @OY16355 32650000
         LA    RWORK,OPCWAITL           WAIT LIST                       32700022
LOCATREQ EQU   *                                                        32800022
         L     ROPCE,AVTEZERO(RWORK)    NEXT ELEMENT ON WAIT LIST       32900022
         LA    ROPCE,0(,ROPCE)          CLEAR HI ORDER BYTE    @OY14092 32902000
         LTR   ROPCE,ROPCE              QUEUE ELEMENT          @OY14092 32904000
         BZ    CALL00                   BRANCH IF NO           @OY14092 32906000
         NI    OCUNIT-IEDQOPCE+THREE(ROPCE),BITSOFF  TURN OFF LOW BITS  32950022
         L     RUNIT,OCUNIT-IEDQOPCE(ROPCE)  OBTAIN LCB                 33000022
         LA    RUNIT,AVTEZERO(RUNIT)    CLEAR HIGH BYTE                 33100022
         ST    ROPCE,OPCCOPCE           SET UP ELEMENT         @OS77381 33120000
         LA    RZERO,ERROR12            SET POSSIBLE TSO ERROR          33150022
         CR    RUNIT,RLCB               CHECK FOR ELEMENT PASSED        33200022
         BNE   LCBCHECK                 NO                              33210022
         SPACE                                                          33220022
         MVC   ONE(THREE,RWORK),ONE(ROPCE) DEQUEUE THE ELEMENT          33260022
         B     ERROR                    GO TO ERROR                     33290022
         SPACE                                                          33320022
LCBCHECK EQU   *                                                        33350022
         SPACE                                                          33400022
         C     RLCB,LCBOFF(RUNIT)       CHECK FOR LCB IN WAIT LIST      33500022
         BE    DEQUEUE                  LINE STOPPED                    33600022
         LR    RWORK1,ROPCE            SET UP FOR LOOP THROUGH @OY14092 33601000
*                                       ATTACHED UNITS         @OY14092 33602000
CKATCH   LR    RWORKA,RWORK1            SAVE LAST ATTACHED     @OY14092 33603000
         TM    OCFLAG-IEDQOPCE(RWORK1),OCATTACH ANY ATTACHED?  @OY14092 33604000
         BZ    NXTLINK                  NO, GET NEXT LINKED    @OY14092 33605000
         L     RWORK1,OCELEM-IEDQOPCE(RWORKA) GET ATTACHED UNIT@OY14092 33606000
         L     RUNIT,OCUNIT-IEDQOPCE(RWORK1)  GET UNIT ADDRESS @OY14092 33607000
         N     RUNIT,CLEAR              CLEAR EXTRANEOUS INFO  @OY14092 33608000
         BZ    CKATCH                   NO UNIT,CHECK NEXT     @OY14092 33609000
         CR    RUNIT,RLCB               UNIT RETURNED          @OY14092 33610000
         BNE   CKLCB                    NO CHECK FOR LCB       @OY14092 33611000
         LR    ROPCE,RWORK1             SET AS CURRENT         @OY14092 33612000
         MVC   OCELEM-IEDQOPCE(4,RWORKA),OCELEM  DELINK        @OY16079 33614000
         TM    OCFLAG,OCATTACH          ATTACH FLAG ON         @OY16079 33614300
         BO    RESET                    YES, BRANCH            @OY16079 33615000
         NI    OCFLAG-IEDQOPCE(RWORKA),AVTEFF-OCATTACH         @OY16079 33615300
*                                       CLEAR ATTACH BIT       @OY16079 33616000
RESET    EQU   *                                                        33616300
         NI    OCFLAG,AVTEFF-OCATTACH   CLEAR ATTACH BIT       @OY16079 33617000
         ST    ROPCE,OPCCOPCE           SET AS CURRENT         @OY14092 33618000
         TM    OCSWITCH,LINEOPCE        STOPLINE REQUEST       @OY14092 33619000
         BZ    ERROR                    YES BRANCH             @OY14092 33620000
         OI    OCSWITCH,X40             SET TO START LINE      @OY14092 33621000
         B     ERROR                    SEND ERROR MSG         @OY14092 33622000
CKLCB    C     RLCB,LCBOFF(RUNIT)       CHECK LCB IN WAITLIST  @OY14092 33623000
         BNE   CKATCH                   NO, GET NEXT ATTACHED  @OY14092 33624000
         LR    ROPCE,RWORK1             SET AS CURRENT         @OY14092 33625000
         MVC   OCELEM-IEDQOPCE(4,RWORKA),OCELEM  DELINK        @OY16079 33626000
         TM    OCFLAG,OCATTACH          ATTACH FLAG ON         @OY16079 33626300
         BO    RESET1                   YES, BRANCH            @OY16079 33627000
         NI    OCFLAG-IEDQOPCE(RWORKA),AVTEFF-OCATTACH         @OY16079 33627300
*                                       CLEAR ATTACH BIT       @OY16079 33628000
RESET1   EQU   *                                               @OY16079 33628300
         NI    OCFLAG,AVTEFF-OCATTACH   CLEAR ATTACH BIT       @OY16079 33629000
         ST    ROPCE,OPCCOPCE           SET AS CURRENT         @OY16079 33629300
         TM    OCSWITCH,LINEOPCE        STOPLINE CMD           @OY14092 33630000
         BZ    STOP1                    YES, BRANCH            @OY14092 33631000
         OI    OCSWITCH,X40             SET TO STARTLINE       @OY14092 33632000
         B     STOP1                    RETURN WITH STOP CMD   @OY14092 33633000
NXTLINK  EQU   *                                               @OY14092 33634000
         SPACE                                                          33700022
         LR    RWORK,ROPCE              NEW ELEMENT BECOMES OLD ELEMENT 33800022
         B     LOCATREQ                 CHECK NEXT LCB IN WAIT LIST     33900022
* IS ONE LINE OR ALL LINES STOPPED?                                     33950022
         SPACE                                                          34000022
DEQUEUE  EQU   *                                                        34100022
         MVC   ONE(THREE,RWORK),ONE(ROPCE)   DEQUEUE THE ELEMENT        34200022
STOP1    EQU   *                                               @OY14092 34250000
         OI    STOPONE(RUNIT),ONESTOP   INDICATE ONE LINE STOPPED       34300022
CHEKALL  EQU   *                                                        34400022
         CLI   OCRLN,AVTEZERO           ARE ALL LINES TO BE STOPPED     34500022
         BNE   CHEKSTOP                 NO                              34600022
         SPACE                                                          34700022
         SR    RRLN,RRLN                CLEAR REG                       34800022
         IC    RRLN,RLN(RUNIT)          GET LAST RLN                    34900022
         LA    RRLN,NEXTRLN(RRLN)                                       35000022
         LR    RPARM,RRLN               RELATIVE LINE NUMBER            35100022
         MVC   OPCDOUBL(EIGHT),OCBACKUP PLACE INPUT FOR LOCATING DCB    35150022
         L     RBRNCH,OPCDCBLK          DCB LOOKUP ADDRESS              35200022
         BALR  RRET,RBRNCH              LOOK UP DCB AND UCB ADDRESS     35300022
         SPACE                                                          35400022
         B     STOPNEXT                 GOOD RETURN CONTINUE            35500022
         MVI   OCRLN,AVTEZERO           RESET 'ALL' INDICATION          35600022
         BCT   RZERO,CHEKSTOP           OPEN DD DUMMY?                  35700022
         STC   RRLN,RLN(RUNIT)          SAVE LAST RLN                   35720022
         B     CHEKALL                  YES,GO CHECK NEXT RLN           35750022
STOPNEXT EQU   *                                                        35800022
         STH   RZERO,OCX1A(ROPCE)       SET UP UCB ADDRESS FOR COMPARE  35850022
         MVI   OCRLN,AVTEZERO           RESET 'ALL' INDICATION          35900022
         LR    RDCB,RPARM               DCB ADDRESS                     36000022
         L     RDEB,DCBDEBAD            DEB ADDRESS                     36100022
         B     CHEKLAST                 SEE IF LAST LINE                36200022
         SPACE                                                          36300022
CHEKSTOP EQU   *                                                        36400022
         ST    ROPCE,OPCCOPCE           SET UP CURRENT ELEMENT POINTER  36500022
         SR    RPARM,RPARM              SET ZERO RET CODE               36600022
         TM    OCFLAG,OCTOTE            INPUT FROM TOTE?                36700022
         BNO   NOTTOTE                  NO, BYPASS SET FOR TOTE         36800022
         MVI   LCBCPA-IEDQLCB(RLCB),TOTE SET LCB FOR TOTE CONTROL       36900022
         LA    RPARM,EIGHT              SET ERROR RETURN CODE           37000022
NOTTOTE  EQU   *                                                        37100022
         MVI   OCUNIT+THREE-IEDQOPCE(RUNIT),THREE              @OY14092 37110000
*                                       SET INVALID TIC        @OY14092 37120000
         LA    RZERO,ERROR25            LINES ALREADY STOPPED           37200022
         CLI   OCPARM+ONE,THREE         WAS ENTRY BECAUSE OF ATTACHED   37300022
         BE    SETFORHK                 YES                             37400022
         SPACE                                                          37500022
         TM    STOPONE(RUNIT),ONESTOP   HAS ONE LINE BEEN STOPPED       37600022
         BNO   ERROR                    ALL STOPPED                     37700022
         SPACE                                                          37800022
SETFORHK EQU   *                                                        37900022
         SR    RPARM,RPARM              SET GOOD RETURN                 38000022
         LH    RZERO,OCPARM             SET RETURN PARAMETER            38100022
         TM    OCUNIT+THREE,TWO         UNIT USED FOR STOPLN   @OX14763 38110000
         BO    NOUNIT                   NO, NONE TO RETURN     @OX14763 38120000
         L     RWORK,OCUNIT             YES, GET UNIT ADDR              38130000
         OC    UNITOFF(FOUR,RWORK),UNITOFF(RWORK) UNIT FOR BFRD@OX14763 38140000
         BZ    NOUNIT                   NO, NONE TO RETURN     @OX14763 38150000
         MVC   OCUNIT+ONE-IEDQOPCE(THREE,RWORK),UNITOFF+ONE(RWORK)      38160000
*                                       SET TO RETURN UNIT     @OX14763 38170000
NOUNIT   EQU   *                                                        38180000
         MVC   OPCLDNME+VARINAME(NAMELEN),OCWTG  SET RETURN NAME        38200022
         OC    OCWTG(TWO),OCWTG         RETURN ASKED?                   38300022
         BZ    COMPLETE                 NO,CONTINUE            @OY14092 38400000
         CLC   OCWTG(TWO),STOPLINE      THIS MODULE            @OY14092 38410000
         BNE   XCTL                     NO, CONTINUE           @OY14092 38420000
         SPACE                                                          38500022
COMPLETE EQU   *                                               @OY14092 38520000
         MVC   OPCLDNME+VARINAME(NAMELEN),CHECKPT  SET CHECKPOINT NAME  38600022
         MVC   OCWTG(NAMELEN),WRTMSG    WTG TO MESSAGE MODULE           38700022
         MVI   OCPARM,AVTEZERO          CLEAR FIRST BYTE                38800022
         MVI   OCPARM+ONE,GOODSTOP      MSG NO FOR SUCCESSFUL STOP      38900022
         TM    OCFLAG,OCTOTE+OCMPP      TOTE OR MPP                     39000022
         BZ    XCTL                     NO                              39100022
         TM    OCFLAG,OCTOTE            IS REQUEST FROM TOTE            39200022
         BZ    MPPRETUN                 NO                              39300022
         SPACE                                                          39400022
         MVI   LCBCPA-IEDQLCB(RLCB),TOTE  LCB IS UNDER TOTE CONTROL     39500022
MPPRETUN EQU   *                                                        39600022
         SR    RZERO,RZERO              CLEAR REGISTER                  39700022
         SPACE                                                          39800022
RESTART  EQU   *                                                        39900022
         MVC   OPCLDNME+VARINAME(NAMELEN),WRITE   SET MODULE NAME       40000022
XCTL     EQU   *                                                        40100022
         NI    OPCFLAG1,AVTEZERO        CLEAR FLAGS                     40200022
         LR    RPARM,ROPCAVT            PASS AVT ADDRESS                40300022
         XCTL  SF=(E,OPCXCTL)           CALL NEXT MODULE                40400022
         SPACE                                                          40500022
ERROR    EQU   *                                                        40600022
         TM    OCFLAG,OCTOTE+OCMPP      TOTE OR MPP                     40700022
         BZ    ERXCTL                   NO                              40800022
         SPACE                                                          40900022
         LR    RZERO,RPARM              SET UP FOR ERROR RETURN CODE    41000022
         B     RESTART                  TOTE OR MPP RETURN              41100022
         SPACE                                                          41200022
ERXCTL   EQU   *                                                        41300022
         MVC   OPCLDNME+VARINAME(NAMELEN),XCTL03 SET MODULE NAME        41400022
         B     XCTL                     GO TO MODULE                    41500022
         SPACE                                                          41600022
*              THIS CODE ATTACHES NEW REQUEST ELEMENT TO OLD REQUEST  * 41700022
*              AFTER DETERMINING MULTIPLE REQUEST ON RESOURCE         * 41800022
ATTACH   EQU   *                                                        41900022
         TM    OCFLAG-IEDQOPCE(RWORK1),OCATTACH ATTACHED ELEMENT?       42000022
         BNO   ATTACHIT                 NO, QUEUE IT UP                 42100022
         SPACE                                                          42200022
         L     RWORK1,FOUR(RWORK1)      GET NEXT ELEMENT IN CHAIN       42300022
         B     ATTACH                   SEE IF IT CAN BE ATTACHED       42400022
         SPACE                                                          42500022
ATTACHIT EQU   *                                                        42600022
         ST    ROPCE,FOUR(RWORK1)       QUEUE UP NEW ELEMENT            42700022
         OI    OCFLAG-IEDQOPCE(RWORK1),OCATTACH  UNIT IS ATTACHED       42800022
LCBPOSTD EQU   *                                               @OY16355 42850000
         MVC   OCWTG(TWO),STOPLINE      SET RETURN MODULE FOR 00        42900022
         LA    RZERO,THREE              SET UP PARAMETERS               43000022
         STH   RZERO,OCPARM             TO RETURN TO THIS MODULE        43100022
         LA    RZERO,TWO                INDICATES ENTRY TO 00 NOT CA    43200022
         MVC   OPCLDNME+VARINAME(NAMELEN),FIRSTLD    SET UP FOR 00      43300022
         B     XCTL                     GO TO CORRECT MODULE            43400022
         SPACE                                                          43500022
*              THIS SETS UP ELEMENT FROM OTHER SOURCE TO STOP LINE    * 43600022
NOTVARY  EQU   *                                                        43700022
         L     RUNIT,OCUNIT             RELOAD SAVED UNIT FOR HK        43800022
         L     RLCB,LCBOFF(RUNIT)       RELOAD LCB ADDRESS              43900022
         LA    RBRNCH,MULTIRES          PICK UP SCAN TABLE              44000022
TBLLOOP  EQU   *                                                        44100022
         CLI   ZERO(RBRNCH),FFBYTE      END OF TABLE                    44200022
         BE    EROPT                    YES                             44300022
         SPACE                                                          44400022
         CLI   OCOPTCDE,OCVARY          IS THIS A VARY COMMAND          44500022
         BE    CHEKVARY                 YES                             44600022
         SPACE                                                          44700022
         CLC   OCOPTCDE,ZERO(RBRNCH)    GOOD COMMAND?                   44800022
         MVC   OCWTG(TWO),ONE(RBRNCH)   SET FOR NEXT MODULE TO GET CAL  44900022
         BE    PROCMND                  YES                             45000022
         SPACE                                                          45100022
         LA    RBRNCH,THREE(RBRNCH)     INCREMENT TO NEXT ENTRY         45200022
         B     TBLLOOP                  GET NEXT COMMAND                45300022
         SPACE                                                          45400022
CHEKVARY EQU   *                                                        45500022
         TM    OCSWITCH,FOUR            STOP TERMINAL                   45600022
         MVC   OCWTG(TWO),STOPMOD       GET STOP TERM MOD NAME          45700022
         BO    PROCMND                  YES IT IS STOP TERM             45800022
         SPACE                                                          45900022
         TM    OCSWITCH,EIGHT           IS IT START TERM                46000022
         MVC   OCWTG(TWO),STOPMOD       GET STOP TERM MOD NAME @OZ28375 46100086
         BO    PROCMND                  YES IT IS START TERMINAL        46200022
         SPACE                                                          46300022
EROPT    EQU   *                                                        46400022
         LA    RZERO,BADCMND            SET ERROR CODE                  46500022
         B     ERROR                    GO PUT OUT ERROR MESSAGE        46600022
         EJECT                                                   S21903 46700005
ERRORTAB DS    0F                                                       47000022
CLEAR    DC    X'00FFFFFC'              TO CLEAR EXTRA BITS    @OY14092 47020000
         SPACE 2                                                        47100022
XCTL03   DC    C'03'                    ERROR MODULE NAME               47200022
CHECKPT  DC    C'06'                    CHECKPOINT MODULE NAME          47300022
WRITE    DC    C'07'                    OUTPUT WRITER NAME              47400022
WRTMSG   DC    C'09'                    HOLD, RELEASE, AND VARY MESSAGE 47500022
STOPMOD  DC    C'V2'                    STOP TERMINAL MODULE            47600022
STRTMOD  DC    C'V4'                    START TERMINAL MODULE           47700022
ALL      DC    C'ALL'                   RLN WAS ALL                     47800022
ICHANGE  DC    C'I0'                    ICHNG                           47900022
FIRSTLD  DC    C'00'                    FIRST LOAD OF OP CTL            48000022
STOPLINE DC    C'V1'                    OP CTL STOPLINE                 48100022
RNSTPLNE DC    C'VG'                    3705 STOPLINE MOD ID     S22024 48130022
         SPACE 2                                                        48200022
MULTIRES DC    X'49',C'I0'              ICHNG                           48300022
         DC    X'45',C'V4'              STRT TERM (B)            S22024 48400022
         DC    X'46',C'V4'              STRT TERM (E)            S22024 48500022
         DC    X'48',C'V2'              STOP TERM (B)                   48600022
         DC    X'47',C'V2'              STOP TERM (B)                   48700022
         DC    X'FF'                    END OF TABLE                    48800022
ZAPAREA  DC    50X'00'                  PATCH AREA             @Y17XARW 48850000
         SPACE 2                                                        48900022
         TITLE 'IGCV110D - DSECTS REFERENCED BY THIS MODULE'            49000022
         EJECT                                                          49100022
         TAVTD                                                          49200022
         EJECT                                                          49300022
         DCBD DSORG=TX                                                  49400022
         EJECT                                                          49500022
         TDEBD                                                          49600022
         EJECT                                                          49700022
         TDISPD                                                         49800022
         EJECT                                                          49900022
*    DELETE IEAQFX CALL - NOT REQUIRED IN VS                            50000056
         EJECT                                                          50100022
         TLCBD                                                          50200022
         EJECT                                                          50300022
         TOPCED                                                         50400022
         TOPCAVTD                                                       50500022
         EJECT                                                          50600022
         TPRFD                                                          50700022
         EJECT                                                          50800022
         TPRIOR                                                         50900022
         EJECT                                                          51000022
         TQCBD                                                          51100022
         EJECT                                                          51200022
         TSCBD                                                          51300022
         EJECT                                                          51400022
         TTNTD                                                          51500022
         EJECT                                                          51600022
         TTRMD                                                          51700022
         END                                                            51800022
