         TITLE 'AMDSATER TAPE ERROR RECOVERY ROUTINE                   *00001000
                        '                                               00002000
AMDSATER CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL2(@EP00001-@MAINENT)                                   00007000
         DC    AL1(16)                                             0001 00008000
         DC    C'AMDSATER  75.153'                                 0001 00009000
AMDSAERM DS    0H                                                  0001 00010000
         USING *,@15                                               0001 00011000
         B     @PROLOG                                             0001 00012000
         DC    AL2(@EP00652-AMDSAERM)                                   00013000
         ENTRY AMDSAERM                                                 00014000
AMDSAERI DS    0H                                                  0001 00015000
         USING *,@15                                               0001 00016000
         B     @PROLOG                                             0001 00017000
         DC    AL2(@EP00656-AMDSAERI)                                   00018000
         ENTRY AMDSAERI                                                 00019000
AMDSAERP DS    0H                                                  0001 00020000
         USING *,@15                                               0001 00021000
         B     @PROLOG                                             0001 00022000
         DC    AL2(@EP00660-AMDSAERP)                                   00023000
         ENTRY AMDSAERP                                                 00024000
AMDSAINR DS    0H                                                  0001 00025000
         USING *,@15                                               0001 00026000
         B     @PROLOG                                             0001 00027000
         DC    AL2(@EP00664-AMDSAINR)                                   00028000
         ENTRY AMDSAINR                                                 00029000
AMDSAERB DS    0H                                                  0001 00030000
         USING *,@15                                               0001 00031000
         B     @PROLOG                                             0001 00032000
         DC    AL2(@EP00668-AMDSAERB)                                   00033000
         ENTRY AMDSAERB                                                 00034000
         DROP  @15                                                      00035000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00036000
         BALR  @09,0                                               0001 00037000
@PSTART  DS    0H                                                  0001 00038000
         USING @PSTART,@09                                         0001 00039000
         ST    @13,@SA00001+4                                      0001 00040000
         LA    @14,@SA00001                                        0001 00041000
         ST    @14,8(,@13)                                         0001 00042000
         LR    @13,@14                                             0001 00043000
         AH    @15,4(,@15)                                         0001 00044000
         BR    @15                                                 0001 00045000
@EP00001 DS    0H                                                  0002 00046000
*   SAVEFORM(1:4) = 'LTER';         /* SET UP SAVE AREA IDENTIFIER   */ 00047000
         MVC   SAVEFORM(4,R13),@CC01114                            0245 00048000
*   CCTREG = CCTADDR;               /* INITIALIZE THE CCT ADDRESS    */ 00049000
         L     CCTREG,@CF00727                                     0246 00050000
*   ERBADDR = ADDR(CTERBTPE);       /* INITIALIZE ADDR OF ERB        */ 00051000
         LA    @10,CTERBTPE(,CCTREG)                               0247 00052000
         ST    @10,ERBADDR                                         0247 00053000
*   CTERBTPE = ZERO;                /* CLEAR ERB                     */ 00054000
*                                                                  0248 00055000
         SLR   @10,@10                                             0248 00056000
         ST    @10,CTERBTPE(,CCTREG)                               0248 00057000
*   /*****************************************************************/ 00058000
*   /*                                                               */ 00059000
*   /* FROM THIS POINT ON AMDSATER MAY RE-ENTER ITSELF IN ORDER TO   */ 00060000
*   /* CORRECT AND RETRY MULTIPLE I/O ERRORS ON TAPE. WHAT FOLLOWS IS*/ 00061000
*   /* ERROR RECOVERY ACCORDING TO DEFINED STANDARDS FOR TAPE        */ 00062000
*   /* DEVICES.                                                      */ 00063000
*   /*                                                               */ 00064000
*   /*****************************************************************/ 00065000
*                                                                  0249 00066000
*                                                                  0249 00067000
*RETEST:                                                           0249 00068000
*   IF CSWCADDR = ZERO | (CSWCADDR=IODBCAW & VCTCPOUT ^= IODBCAW) THEN  00069000
RETEST   L     @10,CSWCADDR+23(,IODBREG)                           0249 00070000
         LA    @10,0(,@10)                                         0249 00071000
         LTR   @10,@10                                             0249 00072000
         BZ    @RT00249                                            0249 00073000
         L     @04,IODBCAW(,IODBREG)                               0249 00074000
         CR    @10,@04                                             0249 00075000
         BNE   @RF00249                                            0249 00076000
         C     @04,VCTCPOUT(,VCCTREG)                              0249 00077000
         BE    @RF00249                                            0249 00078000
@RT00249 DS    0H                                                  0250 00079000
*     CCWREG = IODBCAW;             /* IF NO CCW RESTART FROM TOP OF    00080000
*                                      CHAN                          */ 00081000
         L     CCWREG,IODBCAW(,IODBREG)                            0250 00082000
*   ELSE                                                           0251 00083000
*     CCWREG = CSWCADDR - LENGTH(CCW); /* BACK UP TO START OF FAILING   00084000
*                                      CCW                           */ 00085000
         B     @RC00249                                            0251 00086000
@RF00249 L     CCWREG,CSWCADDR+23(,IODBREG)                        0251 00087000
         LA    CCWREG,0(,CCWREG)                                   0251 00088000
         SL    CCWREG,@CF00036                                     0251 00089000
*   IF CCWCMD = DATCHAIN THEN                                      0252 00090000
@RC00249 CLI   CCWCMD(CCWREG),255                                  0252 00091000
         BNE   @RF00252                                            0252 00092000
*     CCWREG = CCWREG - LENGTH(CCW); /* BACK UP ANOTHER CCW TO THE 0253 00093000
*                                      STARTING CCW THAT FAILED      */ 00094000
         SL    CCWREG,@CF00036                                     0253 00095000
*   IODBSENS = IODBSENS && IODBSENS; /* ZERO SENSE AREA              */ 00096000
@RF00252 XC    IODBSENS(24,IODBREG),IODBSENS(IODBREG)              0254 00097000
*                                                                  0255 00098000
*   /*****************************************************************/ 00099000
*   /*                                                               */ 00100000
*   /* FIRST WE HANDLE CHANNEL CONTROL CHECKS. THIS IS KNOWN BY CSW  */ 00101000
*   /* STATUS 0004                                                   */ 00102000
*   /*                                                               */ 00103000
*   /*****************************************************************/ 00104000
*                                                                  0255 00105000
*/* D (YES,,NO,ICC) CHANNEL CONTROL CHECK ?                          */ 00106000
*/* P (,TERMEXIT) MESSAGE ID = 26                                    */ 00107000
*   IF CSWCCC = ON THEN                                            0255 00108000
         TM    CSWCCC+24(IODBREG),B'00000100'                      0255 00109000
         BNO   @RF00255                                            0255 00110000
*     DO;                                                          0256 00111000
*       ERBID = MSGCCC;             /* SET UP MESSAGE ID             */ 00112000
         MVI   ERBID(CCTREG),X'1A'                                 0257 00113000
*       GO TO TERMEXIT;             /* NO RECOVERY FROM CHANNEL ERROR*/ 00114000
         B     TERMEXIT                                            0258 00115000
*     END;                                                         0259 00116000
*                                                                  0259 00117000
*   /*****************************************************************/ 00118000
*   /*                                                               */ 00119000
*   /* INTERFACE CONTROL CHECKS ARE NEXT. THIS IS KNOWN BY CSW STATUS*/ 00120000
*   /* 0002. NO RECOVERY IS POSSSIBLE                                */ 00121000
*   /*                                                               */ 00122000
*   /*****************************************************************/ 00123000
*                                                                  0260 00124000
*/*ICC: D (YES,,NO,TUCK) INTERFACE CONTROL CK ?                      */ 00125000
*/* P (,TERMEXIT) MESSAGE ID = 27                                    */ 00126000
*   IF CSWICC = ON THEN                                            0260 00127000
@RF00255 TM    CSWICC+24(IODBREG),B'00000010'                      0260 00128000
         BNO   @RF00260                                            0260 00129000
*     DO;                                                          0261 00130000
*       ERBID = MSGICC;             /* SET UP MESSAGE ID             */ 00131000
         MVI   ERBID(CCTREG),X'1B'                                 0262 00132000
*       GO TO TERMEXIT;             /* NO RECOVERY IS POSSIBLE       */ 00133000
         B     TERMEXIT                                            0263 00134000
*     END;                                                         0264 00135000
*                                                                  0265 00136000
*   /*****************************************************************/ 00137000
*   /*                                                               */ 00138000
*   /* THE NEXT TEST IS FOR UNIT CHECK CONDITIONS. THIS IS THE MOST  */ 00139000
*   /* COMMON OF ALL TAPE ERRORS. STATUS IS 0200                     */ 00140000
*   /*                                                               */ 00141000
*   /*****************************************************************/ 00142000
*                                                                  0265 00143000
*/*TUCK: D (YES,TAPESENS,NO,CDC) UNIT CHECK ?                        */ 00144000
*   IF CSWUC = ON THEN                                             0265 00145000
@RF00260 TM    CSWUC+24(IODBREG),B'00000010'                       0265 00146000
         BNO   @RF00265                                            0265 00147000
*     DO;                           /* IF UNIT CHECK WE MAY ATTEMPT     00148000
*                                      RECOVERY                      */ 00149000
*                                                                  0266 00150000
*   /*****************************************************************/ 00151000
*   /*                                                               */ 00152000
*   /* FIRST FOR UNIT CHECK CONDITIONS WE MUST ISSUE A SENSE COMMAND */ 00153000
*   /* TO FURTHER ISOLATE THE CONDITION                              */ 00154000
*   /*                                                               */ 00155000
*   /*****************************************************************/ 00156000
*                                                                  0267 00157000
*/*TAPESENS: P R11 = ADDRESS OF SENSE COMMAND READING INTO IODBSENS  */ 00158000
*/* S TERERI: ISSUE SENSE COMMAND                                    */ 00159000
*/* D (YES,,NO,TECK) ERROR ON SENSE ?                                */ 00160000
*/* P (,TERMEXIT) MESSAGE ID = 30                                    */ 00161000
*       RESPECIFY R11 RESTRICTED;                                  0267 00162000
*       R11 = ADDR(SENSECCW);       /* PICK UP SENSE COMMAND         */ 00163000
         LA    R11,SENSECCW                                        0268 00164000
*       SENSEADR = ADDR(IODBSENS);  /* SET UP SENSE INPUT AREA       */ 00165000
         LA    @10,IODBSENS(,IODBREG)                              0269 00166000
         STCM  @10,7,SENSEADR                                      0269 00167000
*       CALL TERERI;                /* ISSUE SENSE COMMAND           */ 00168000
         BAL   @14,TERERI                                          0270 00169000
*       RESPECIFY RETCODE RESTRICTED;                              0271 00170000
*       IF RETCODE ^= ZERO THEN                                    0272 00171000
         LTR   RETCODE,RETCODE                                     0272 00172000
         BZ    @RF00272                                            0272 00173000
*         DO;                       /* IF ERROR ON SENSE COMMAND     */ 00174000
*           ERBID = MSGERS;         /* SET UP SENSE ERROR MESSAGE    */ 00175000
         MVI   ERBID(CCTREG),X'1E'                                 0274 00176000
*           GO TO TERMEXIT;         /* CAN NOT DIAGNOSE= OR CORRECT     00177000
*                                      ERROR                         */ 00178000
         B     TERMEXIT                                            0275 00179000
*           RESPECIFY (RETCODE,R11) UNRESTRICTED;                  0276 00180000
*         END;                                                     0277 00181000
*                                                                  0277 00182000
*   /*****************************************************************/ 00183000
*   /*                                                               */ 00184000
*   /* AFTER A SUCCESSFUL SENSE COMMAND, UNIT CHECK CONDITIONS CAN BE*/ 00185000
*   /* TESTED. EQUIPMENT CHECK - SENSE 1000 IS FIRST                 */ 00186000
*   /*                                                               */ 00187000
*   /*****************************************************************/ 00188000
*                                                                  0278 00189000
*/*TECK: D (YES,,NO,TBOCK) EQUIPMENT CK ?                            */ 00190000
*/* P (,TERMEXIT) MESSAGE ID = 03                                    */ 00191000
*       IF SENEC = ON THEN                                         0278 00192000
@RF00272 TM    SENEC(IODBREG),B'00010000'                          0278 00193000
         BNO   @RF00278                                            0278 00194000
*         DO;                       /* IF EQUITPMENT CHECK - NO    0279 00195000
*                                      RETRIES                       */ 00196000
*           ERBID = MSGEC;          /* SET UP MESSAGE ID             */ 00197000
         MVI   ERBID(CCTREG),X'03'                                 0280 00198000
*           GO TO TERMEXIT;         /* OBTAIN NEW TAPE AND RETRY I/O    00199000
*                                      OPERATION                     */ 00200000
         B     TERMEXIT                                            0281 00201000
*         END;                                                     0282 00202000
*                                                                  0283 00203000
*   /*****************************************************************/ 00204000
*   /*                                                               */ 00205000
*   /* BUS OUT CHECK IS NEXT TO BE PROCESSED. THIS IS KNOWN BY SENSE */ 00206000
*   /* 2000                                                          */ 00207000
*   /*                                                               */ 00208000
*   /*****************************************************************/ 00209000
*                                                                  0283 00210000
*/*TBOCK: D (YES,,NO,TINR) BUS OUT CK ?                              */ 00211000
*/* S TERERB:ERBTPE, CC=02, PCT=5 SCT=0                              */ 00212000
*/* D (YES,,NO,REPEATOP) DEVICE END ?                                */ 00213000
*/* D (YES,REPRO,NO,REPEATOP) WRITE CMD ?                            */ 00214000
*       IF SENBO = ON THEN                                         0283 00215000
@RF00278 TM    SENBO(IODBREG),B'00100000'                          0283 00216000
         BNO   @RF00283                                            0283 00217000
*         DO;                       /* IF BUS OUT CHECK ATTEMPT RETRY*/ 00218000
*           RESPECIFY R1 RESTRICTED;                               0285 00219000
*           IODBCAW = CCWREG;       /* SET UP RETRY CCW              */ 00220000
         ST    CCWREG,IODBCAW(,IODBREG)                            0286 00221000
*           R1 = ADDR(ERBPARM);     /* SET UP TO PARAMETER LIST    0287 00222000
*                                      ADDRESS                       */ 00223000
         LA    R1,ERBPARM                                          0287 00224000
*           ERBPID = MSGBOC;        /* SET UP BUS OUT CHECK MESSAGE     00225000
*                                      ID                            */ 00226000
         MVI   ERBPID,X'02'                                        0288 00227000
*           ERBSCT = ZERO;          /* ZERO SECONDARY RETRY COUNTER  */ 00228000
         MVI   ERBSCT,X'00'                                        0289 00229000
*           ERBPCT = FIVE;          /* FIVE PRIMARY RETRIES          */ 00230000
         MVI   ERBPCT,X'05'                                        0290 00231000
*           CALL TERERBX;           /* SET UP ERB FOR RETRY          */ 00232000
         BAL   @14,TERERBX                                         0291 00233000
*           RESPECIFY R1 UNRESTRICTED;                             0292 00234000
*           IF CSWDE = ON &         /* IF DEVICE END CONDITION       */ 00235000
*                 CCWCMD = WRITECMD THEN /* ON A WRITE COMMAND       */ 00236000
         TM    CSWDE+24(IODBREG),B'00000100'                       0293 00237000
         BNO   @RF00293                                            0293 00238000
         CLI   CCWCMD(CCWREG),1                                    0293 00239000
         BE    @RT00293                                            0293 00240000
*             GO TO REPRO;          /* REPOSITION THE TAPE PRIOR TO     00241000
*                                      RETRY                         */ 00242000
*           GO TO REPEATOP;         /* OTHERWISE RETRY I/O OPERATION */ 00243000
         B     REPEATOP                                            0295 00244000
*         END;                      /* ENDS BUS OUT CHECK PROCESSING */ 00245000
*                                                                  0297 00246000
*   /*****************************************************************/ 00247000
*   /*                                                               */ 00248000
*   /* INTERVENTION REQUIRED CONDITION. THIS IS NOTED BY CONDITION   */ 00249000
*   /* 4000 IN THE SENSE                                             */ 00250000
*   /*                                                               */ 00251000
*   /*****************************************************************/ 00252000
*                                                                  0297 00253000
*/*TINR: D (YES,,NO,TCRJT) INTV REQUIRED ?                           */ 00254000
*/* D (YES,IRRU,NO,STATB) DEVICE END ?                               */ 00255000
*/*IRRU: P OBTAIN CSW CCW - 8                                        */ 00256000
*/* D (YES,RC0,NO,) REWIND / UNLOAD COMMAND ?                        */ 00257000
*/*STATB: D (YES,TIRMSG,NO,) STATUS B BIT = 1 ?                      */ 00258000
*/* P (,TERMEXIT) MESSAGE ID = 01                                    */ 00259000
*/*TIRMSG: S AMDSABIN:SVC 28 CONVERT IODBDEV TO EBCDIC DEV ADDR      */ 00260000
*/* P PLACE DEVICE ADDRESS IN DEV14A                                 */ 00261000
*/* S TERINR:WAIT FOR READY DEVICE                                   */ 00262000
*/* D (NO,IRWAIT,YES,%IR1) DEVICE READY ?                            */ 00263000
*/*IRWAIT: P (,TERMEXIT) MESSAGE ID = 01                             */ 00264000
*/*%IR1: S TERERB:ERBTPE, CC=01, PCT=2, SCT=0                        */ 00265000
*/* N (,REPEATOP) RETRY THE I/O OPERATION                            */ 00266000
*       IF SENIR = ON THEN                                         0297 00267000
@RF00283 TM    SENIR(IODBREG),B'01000000'                          0297 00268000
         BNO   @RF00297                                            0297 00269000
*         DO;                       /* IF INTERVENTION REQUIRED,   0298 00270000
*                                      PROCESS THIS CONDITION        */ 00271000
*           IF CSWDE = ON THEN                                     0299 00272000
         TM    CSWDE+24(IODBREG),B'00000100'                       0299 00273000
         BNO   @RF00299                                            0299 00274000
*             DO;                   /* IF DEVICE END THE COMMAND WENT*/ 00275000
*               IF CCWCMD = RWUNLOAD THEN                          0301 00276000
         CLI   CCWCMD(CCWREG),15                                   0301 00277000
         BE    @RT00301                                            0301 00278000
*                 GO TO RC0;        /* IF REWIND - UNLOAD IGNORE   0302 00279000
*                                      CONDITION SINCE THIS IS A   0302 00280000
*                                      NORMAL CONDITION              */ 00281000
*             END;                  /* IF NOT REWIND-UNLOAD THERE IS    00282000
*                                      ANOTHER ERROR SO WE MUST    0303 00283000
*                                      CONTINUE CHECKING             */ 00284000
*           IF SENTB = OFF THEN                                    0304 00285000
@RF00299 TM    SENTB(IODBREG),B'00100000'                          0304 00286000
         BNZ   @RF00304                                            0304 00287000
*             DO;                   /* IF NO TU STATUS THEN PERMANENT   00288000
*                                      ERROR EXISTS                  */ 00289000
*               ERBID = MSGIR;      /* SET UP INTERVENTION REQUIRED     00290000
*                                      ERROR MSG                     */ 00291000
         MVI   ERBID(CCTREG),X'01'                                 0306 00292000
*               GO TO TERMEXIT;     /* EXIT TO TRY FOR NEW TAPE      */ 00293000
         B     TERMEXIT                                            0307 00294000
*             END;                                                 0308 00295000
*           RESPECIFY R1 RESTRICTED;                               0309 00296000
@RF00304 DS    0H                                                  0310 00297000
*           R1 = ADDR(CVTBLK);      /* SET UP TO PARAMETER LIST FOR     00298000
*                                      CONVERT                       */ 00299000
         LA    R1,CVTBLK                                           0310 00300000
*           CVTBINA = ADDR(IODBDEV); /* PICK UP DEVICE ADDRESS       */ 00301000
         LA    @10,IODBDEV(,IODBREG)                               0311 00302000
         ST    @10,CVTBINA                                         0311 00303000
*           CVTEBCA = ADDR(CONVAREA); /* CONVERT AREA ADDRESS        */ 00304000
         LA    @10,CONVAREA                                        0312 00305000
         ST    @10,CVTEBCA                                         0312 00306000
*           CVTINL = TWO;           /* TWO BYTE CONVERTED DEVICE   0313 00307000
*                                      ADDRESS                       */ 00308000
         MVC   CVTINL(2),@CH00108                                  0313 00309000
*           SVC (BINSVC);           /* CONVERT DDD OF DEVICE         */ 00310000
         SVC   28                                                  0314 00311000
*           DEV14A = CONVAREA(2:4); /* MOVE IN DEVICE ADDRESS        */ 00312000
         L     @10,@CA01076                                        0315 00313000
         MVC   DEV14A-DEV14A(3,@10),CONVAREA+1                     0315 00314000
*           R1 = AMD014A;           /* PICK UP MESSAGE ID FOR INTV 0316 00315000
*                                      REQUIRED MSG                  */ 00316000
         LA    R1,14                                               0316 00317000
*           CALL TERINR;            /* ISSUE MSG AND WAIT FOR TAPE TO   00318000
*                                      BE READY                      */ 00319000
         BAL   @14,TERINR                                          0317 00320000
*           RESPECIFY RETCODE RESTRICTED;                          0318 00321000
*           IF RETCODE ^= ZERO THEN                                0319 00322000
         LTR   RETCODE,RETCODE                                     0319 00323000
         BZ    @RF00319                                            0319 00324000
*             DO;                   /* ERROR IN OBTAINING TAPE       */ 00325000
*               RESPECIFY RETCODE UNRESTRICTED;                    0321 00326000
*               ERBID = MSGIR;      /* FINAL MESSAGE ID-CAUSE OF   0322 00327000
*                                      FAILURE                       */ 00328000
         MVI   ERBID(CCTREG),X'01'                                 0322 00329000
*               GO TO TERMEXIT;     /* TERMINATE VIRTUAL DUMP        */ 00330000
         B     TERMEXIT                                            0323 00331000
*             END;                                                 0324 00332000
*           ERBPID = MSGIR;         /* SET UP IR CONDITION           */ 00333000
@RF00319 MVI   ERBPID,X'01'                                        0325 00334000
*           ERBSCT = ZERO;          /* NO SECONDARY RETRIES          */ 00335000
         MVI   ERBSCT,X'00'                                        0326 00336000
*           ERBPCT = TWO;           /* ALLOW 2 RETRIES ON IR         */ 00337000
         MVI   ERBPCT,X'02'                                        0327 00338000
*           RESPECIFY R1 RESTRICTED;                               0328 00339000
*           R1 = ADDR(ERBPARM);                                    0329 00340000
         LA    R1,ERBPARM                                          0329 00341000
*           CALL TERERBX;           /* UPDATE THE ERB                */ 00342000
         BAL   @14,TERERBX                                         0330 00343000
*           RESPECIFY R1 UNRESTRICTED;                             0331 00344000
*           IODBCAW = CCWREG;       /* RETRY ORIGINAL OPERATION      */ 00345000
         ST    CCWREG,IODBCAW(,IODBREG)                            0332 00346000
*           GO TO REPEATOP;                                        0333 00347000
         B     REPEATOP                                            0333 00348000
*         END;                      /* END OF INTERVENTION REQUIRED     00349000
*                                      PROCESSING                    */ 00350000
*                                                                  0335 00351000
*   /*****************************************************************/ 00352000
*   /*                                                               */ 00353000
*   /* NEXT WE CHECK FOR COMMAND REJECT. THIS IS IDENTIFIED BY SENSE */ 00354000
*   /* 8000 ONE NORMAL CONDITION WHICH MAY CAUSE A COMMAND REJECT IS */ 00355000
*   /* MOUNTING A FILE PROTECTED TAPE. THIS IS KNOWN BY SENSE 8002.  */ 00356000
*   /*                                                               */ 00357000
*   /*****************************************************************/ 00358000
*                                                                  0335 00359000
*/*TCRJT: D (YES,,NO,TOVER) CMD REJECT ?                             */ 00360000
*/* D (YES,FPMSG,NO,) FILE PROTECT ?                                 */ 00361000
*/* P (,TERMEXIT) MESSAGE ID = 00                                    */ 00362000
*/*FPMSG: P R11 = REWIND/UNLOAD COMMAND                              */ 00363000
*/* S TERERI:ISSUE REWIND / UNLOAD OF FP TAPE                        */ 00364000
*/* P SET UP TO ISSUE MESSAGE FP                                     */ 00365000
*/* S TERINR:WAIT FOR THE DEVICE TO BE READY                         */ 00366000
*/* D (YES,,NO,FPWAIT) DEVICE READY ?                                */ 00367000
*/* N (,NEWTAPEM) CHECK NEW TAPE DEVICE                              */ 00368000
*/*FPWAIT: P (,TERMEXIT) MESSAGE ID = 13                             */ 00369000
*       IF SENCR = ON THEN                                         0335 00370000
@RF00297 TM    SENCR(IODBREG),B'10000000'                          0335 00371000
         BNO   @RF00335                                            0335 00372000
*         DO;                       /* IF COMMAND REJECT-ISOLATE   0336 00373000
*                                      CAUSE                         */ 00374000
*           IF SENFP = OFF THEN                                    0337 00375000
         TM    SENFP(IODBREG),B'00000010'                          0337 00376000
         BNZ   @RF00337                                            0337 00377000
*             DO;                   /* IF NOT FP - ERROR SO TERMINATE*/ 00378000
*               ERBID = MSGCR;      /* SET UP CMD REJECT MSG ID      */ 00379000
         MVI   ERBID(CCTREG),X'00'                                 0339 00380000
*               GO TO TERMEXIT;     /* TERMINATE WITH NO RETRIES     */ 00381000
         B     TERMEXIT                                            0340 00382000
*             END;                                                 0341 00383000
*           RESPECIFY R11 RESTRICTED;                              0342 00384000
@RF00337 DS    0H                                                  0343 00385000
*           R11 = ADDR(REWUNLD);    /* REJECT FP TAPE - UNLOAD IT    */ 00386000
         LA    R11,REWUNLD                                         0343 00387000
*           CALL TERERI;            /* REWIND-UNLOAD THE TAPE VOLUME */ 00388000
         BAL   @14,TERERI                                          0344 00389000
*           R11 = ADDR(SENSCCW);   /* RE-ARM DRIVE FOR INTR AT READY */ 00390000
         LA    R11,SENSCCW                                         0345 00391000
*           CALL TERERI;           /* ARM DRIVE                      */ 00392000
         BAL   @14,TERERI                                          0346 00393000
*           RESPECIFY R11 UNRESTRICTED;                            0347 00394000
*           RESPECIFY R1 RESTRICTED;                               0348 00395000
*           R1 = AMD019A;           /* OBTAIN FP MESSAGE ADDRESS     */ 00396000
         LA    R1,19                                               0349 00397000
*           CALL TERINR;            /* ISSUE MESSAGE AND OBTAIN A NEW   00398000
*                                      TAPE                          */ 00399000
         BAL   @14,TERINR                                          0350 00400000
*           RESPECIFY RETCODE RESTRICTED;                          0351 00401000
*           IF RETCODE ^= ZERO THEN                                0352 00402000
         LTR   RETCODE,RETCODE                                     0352 00403000
         BZ    @RF00352                                            0352 00404000
*             DO;                   /* IF TAPE IS NOT MOUNTED        */ 00405000
*               RESPECIFY RETCODE UNRESTRICTED;                    0354 00406000
*               ERBID = MSGFP;      /* SET UP FILE PROTECTED MSG ID  */ 00407000
         MVI   ERBID(CCTREG),X'0D'                                 0355 00408000
*               GO TO TERMEXIT;     /* TERMINATE FUNCTION            */ 00409000
         B     TERMEXIT                                            0356 00410000
*             END;                                                 0357 00411000
*           GO TO NEWTAPEM;         /* NEW TAPE MOUNTED-CHECK IT OUT */ 00412000
         B     NEWTAPEM                                            0358 00413000
*         END;                      /* END OF COMMAND REJECT       0359 00414000
*                                      PROCESSING                    */ 00415000
*                                                                  0359 00416000
*   /*****************************************************************/ 00417000
*   /*                                                               */ 00418000
*   /* OVERRUN IS THE NEXT ERROR CONDITION TO BE TESTED. OVERRUN IS  */ 00419000
*   /* INDICATED BY SENSE 0400                                       */ 00420000
*   /*                                                               */ 00421000
*   /*****************************************************************/ 00422000
*                                                                  0360 00423000
*/*TOVER: D (YES,,NO,TLPT) OVERRUN ?                                 */ 00424000
*/* P (,ACTION7) CC=05 FOR ERBID                                     */ 00425000
*       IF SENOR = ON THEN                                         0360 00426000
@RF00335 TM    SENOR(IODBREG),B'00000100'                          0360 00427000
         BNO   @RF00360                                            0360 00428000
*         DO;                       /* IF OVERRUN HANDLE IN THIS   0361 00429000
*                                      SECTION                       */ 00430000
*           ERBPID = MSGOR;         /* SET UP OVERRUN MESSAGE      0362 00431000
*                                      IDENTIFIER                    */ 00432000
         MVI   ERBPID,X'05'                                        0362 00433000
*           GO TO ACTION7;          /* PERFORM COMMON ACTION 7 RETRY    00434000
*                                      OPERATION                     */ 00435000
         B     ACTION7                                             0363 00436000
*         END;                      /* END OF OVERRUN PROCESSING   0364 00437000
*                                      SECTION                       */ 00438000
*                                                                  0364 00439000
*   /*****************************************************************/ 00440000
*   /*                                                               */ 00441000
*   /* THE NEXT CHECK IS FOR LOAD POINT. SENSE 0008.                 */ 00442000
*   /*                                                               */ 00443000
*   /*****************************************************************/ 00444000
*                                                                  0365 00445000
*/*TLPT: D (YES,,NO,TDC) LOAD POINT ?                                */ 00446000
*/* P (,TERMEXIT) MESSAGE ID = 34                                    */ 00447000
*       IF SENLP = ON THEN                                         0365 00448000
@RF00360 TM    SENLP(IODBREG),B'00001000'                          0365 00449000
         BNO   @RF00365                                            0365 00450000
*         DO;                       /* IF LOAD POINT                 */ 00451000
*           IF IODBREG = ADDR(IODBWORK) THEN /* LP ON WORKFILE       */ 00452000
         L     @10,@CA01085                                        0367 00453000
         CR    IODBREG,@10                                         0367 00454000
         BNE   @RF00367                                            0367 00455000
*             IODBTERM = ON;        /* TERMINATE ALL I/O TO WORK FILE*/ 00456000
         OI    IODBTERM(IODBREG),B'10000000'                       0368 00457000
*           ERBID = MSGLP;          /* SET UP TERMINAL MSG IDENTIFIER*/ 00458000
@RF00367 MVI   ERBID(CCTREG),X'22'                                 0369 00459000
*           GO TO TERMEXIT;         /* TERMINATE REQUEST             */ 00460000
         B     TERMEXIT                                            0370 00461000
*         END;                                                     0371 00462000
*                                                                  0372 00463000
*   /*****************************************************************/ 00464000
*   /*                                                               */ 00465000
*   /* DATA CHECK IS HANDLED NEXT. THIS IS INDICATED BY SENSE 0800   */ 00466000
*   /*                                                               */ 00467000
*   /*****************************************************************/ 00468000
*                                                                  0372 00469000
*/*TDC: D (YES,,NO,CDC) DATA CK ?                                    */ 00470000
*/* P BACK UP TO FAILING CCW                                         */ 00471000
*/* D (YES,,NO,NXTCMD) READ CMD ?                                    */ 00472000
*/* S TERERB:ERBTPE, CC=04, PCT=05, SCT=0                            */ 00473000
*/* N (,REPRO) REPOSITION TAPE AND RETRY I/O OPERATION               */ 00474000
*/*NXTCMD: D (YES,,NO,WTM) WRITE CMD ?                               */ 00475000
*/*RETRY15: S TERERB:ERBTPE, CC=04, PCT=15, SCT=0                    */ 00476000
*/* P (,REPEATOP) SET UP BSR, ERG, MODESET, TIC TO IODBCSW - 8       */ 00477000
*/*WTM: D (YES,RETRY15,NO,) WTM CMD ?                                */ 00478000
*/* D (NO,UNKCMD,YES,) ERG CMD ?                                     */ 00479000
*/* S TERERB:CTERBTPE, CC=04, PCT=03, SCT=00                         */ 00480000
*/* N (,REPEATOP) RETRY THE I/O OPERATION                            */ 00481000
*/*UNKCMD: P (,TERMEXIT) NO RETRIES POSSIBLE                         */ 00482000
*       IF SENDC = ON THEN                                         0372 00483000
@RF00365 TM    SENDC(IODBREG),B'00001000'                          0372 00484000
         BNO   @RF00372                                            0372 00485000
*         DO;                       /* IF DATA CHECK MUST HANDLE     */ 00486000
*           IODBCAW = CCWREG;       /* CCW TO RESTART                */ 00487000
         ST    CCWREG,IODBCAW(,IODBREG)                            0374 00488000
*           RESPECIFY R1 RESTRICTED;                               0375 00489000
*           R1 = ADDR(ERBPARM);     /* SET UP COMMON FIELDS OF DATA     00490000
*                                      CHECK ERB PROCESSING          */ 00491000
         LA    R1,ERBPARM                                          0376 00492000
*           ERBPID = MSGDC;         /* SET UP DATA CHECK ID          */ 00493000
         MVI   ERBPID,X'04'                                        0377 00494000
*           ERBSCT = ZERO;          /* NO SECONDARY RETRY COUNTERS   */ 00495000
         MVI   ERBSCT,X'00'                                        0378 00496000
*           IF CCWCMD = READCMD THEN                               0379 00497000
         CLC   CCWCMD(1,CCWREG),READCMD                            0379 00498000
         BNE   @RF00379                                            0379 00499000
*             DO;                   /* IF FAILURE ON A READ          */ 00500000
*               ERBPCT = FOUR;      /* 4 RETRIES                     */ 00501000
         MVI   ERBPCT,X'04'                                        0381 00502000
*               CALL TERERBX;       /* SET UP ERB FOR RETRY        0382 00503000
*                                      OPERATIONS                    */ 00504000
         BAL   @14,TERERBX                                         0382 00505000
*               GO TO REPRO;        /* REPOSITION TAPE AND RETRY   0383 00506000
*                                      OPERATION                     */ 00507000
         B     REPRO                                               0383 00508000
*             END;                  /* END OF READ CMD PROCESSING    */ 00509000
*           IF CCWCMD = WRITECMD | CCWCMD = WTMCMD THEN            0385 00510000
@RF00379 CLI   CCWCMD(CCWREG),1                                    0385 00511000
         BE    @RT00385                                            0385 00512000
         CLI   CCWCMD(CCWREG),31                                   0385 00513000
         BNE   @RF00385                                            0385 00514000
@RT00385 DS    0H                                                  0386 00515000
*             DO;                   /* FOR WRITE CMDS                */ 00516000
*               ERBPCT = FIFTEEN;   /* SET UP RETRY COUNTER          */ 00517000
         MVI   ERBPCT,X'0F'                                        0387 00518000
*               CALL TERERBX;       /* UPDATE ERB STATUS             */ 00519000
         BAL   @14,TERERBX                                         0388 00520000
*               TICTLADR = IODBCAW; /* SET UP TIC ADDRESS            */ 00521000
         MVC   TICTLADR(3),IODBCAW+1(IODBREG)                      0389 00522000
*               IODBCAW = ADDR(REPOSTAP); /* REPOSITION AND RETRY I/O   00523000
*                                      OPERATION                     */ 00524000
         LA    @10,REPOSTAP                                        0390 00525000
         ST    @10,IODBCAW(,IODBREG)                               0390 00526000
*               GO TO REPEATOP;     /* RETRY I/O OPERATION           */ 00527000
         B     REPEATOP                                            0391 00528000
*             END;                                                 0392 00529000
*           IF CCWCMD = ERGCMD THEN                                0393 00530000
@RF00385 CLI   CCWCMD(CCWREG),23                                   0393 00531000
         BNE   @RF00393                                            0393 00532000
*             DO;                   /* IF ERG SET UP TO REPEATOP     */ 00533000
*               ERBPCT = THREE;     /* 3 RETRIES                     */ 00534000
         MVI   ERBPCT,X'03'                                        0395 00535000
*               CALL TERERBX;       /* UPDATE ERB                    */ 00536000
         BAL   @14,TERERBX                                         0396 00537000
*               GO TO REPEATOP;     /* RETRY I/O OPERATION           */ 00538000
         B     REPEATOP                                            0397 00539000
*             END;                                                 0398 00540000
*           ERBID = MSGDC;          /* UNKNOWN COMMAND - RECOVERY  0399 00541000
*                                      IMPOSSIBLE                    */ 00542000
@RF00393 MVI   ERBID(CCTREG),X'04'                                 0399 00543000
*           GO TO TERMEXIT;         /* TERMINATE RECOVERY OPERATIONS */ 00544000
         B     TERMEXIT                                            0400 00545000
*           RESPECIFY R1 UNRESTRICTED;                             0401 00546000
*         END;                      /* END OF DATA CHECK RECOVERY  0402 00547000
*                                      OPERATIONS                    */ 00548000
*     END;                          /* END OF FIRST PASS UNIT CHECK     00549000
*                                      PROCESSING                    */ 00550000
*                                                                  0403 00551000
@RF00372 DS    0H                                                  0404 00552000
*   /*****************************************************************/ 00553000
*   /*                                                               */ 00554000
*   /* NEXT WE PROCESS CHANNEL DATA CHECKS. STATUS IS 0008           */ 00555000
*   /*                                                               */ 00556000
*   /*****************************************************************/ 00557000
*                                                                  0404 00558000
*/*CDC: D (YES,,NO,TUCK2) CHANNEL DATA CK ?                          */ 00559000
*/* P (,ACTION7) SET UP CC=25 FOR CHAN DATA CK                       */ 00560000
*   IF CSWCDC = ON THEN                                            0404 00561000
@RF00265 TM    CSWCDC+24(IODBREG),B'00001000'                      0404 00562000
         BNO   @RF00404                                            0404 00563000
*     DO;                           /* FOR CHANNEL DATA CHECK        */ 00564000
*       ERBPID = MSGCDC;            /* SET UP CHANNEL DATA CHECK   0406 00565000
*                                      CONDITION                     */ 00566000
         MVI   ERBPID,X'19'                                        0406 00567000
*       GO TO ACTION7;              /* PERFORM COMMON ACTION         */ 00568000
         B     ACTION7                                             0407 00569000
*     END;                          /* ENDS CHANNEL DATA CHECK     0408 00570000
*                                      PROCESSING                    */ 00571000
*                                                                  0408 00572000
*   /*****************************************************************/ 00573000
*   /*                                                               */ 00574000
*   /* AGAIN, UNIT CHECK CONDITIONS ARE TO BE CHECKED. THE SENSE WAS */ 00575000
*   /* PREVIOUSLY ISSUED. CHECKING CONTINUES USING IODBSENS          */ 00576000
*   /*                                                               */ 00577000
*   /*****************************************************************/ 00578000
*                                                                  0409 00579000
*/*TUCK2: D (YES,TUCKCONT,NO,TCC) UNIT CK ?                          */ 00580000
*   IF CSWUC = ON THEN                                             0409 00581000
@RF00404 TM    CSWUC+24(IODBREG),B'00000010'                       0409 00582000
         BNO   @RF00409                                            0409 00583000
*     DO;                           /* CONTINUE CHECKS IF UC         */ 00584000
*                                                                  0410 00585000
*   /*****************************************************************/ 00586000
*   /*                                                               */ 00587000
*   /* DATA CONVERTER CHECK. THIS IS DETERMINED BY SENSE 0100        */ 00588000
*   /*                                                               */ 00589000
*   /*****************************************************************/ 00590000
*                                                                  0411 00591000
*/*TUCKCONT: D (YES,,NO,NOTCP) DATA CONVERTER CK ?                   */ 00592000
*/* P (,TERMEXIT) MESSAGE ID = 35                                    */ 00593000
*       IF SENCC = ON THEN                                         0411 00594000
         TM    SENCC(IODBREG),B'00000001'                          0411 00595000
         BNO   @RF00411                                            0411 00596000
*         DO;                       /* IF DATA CONVERTER CHECK       */ 00597000
*           ERBID = MSGDCC;         /* SET UP TERMINAL MESSAGE ID    */ 00598000
         MVI   ERBID(CCTREG),X'23'                                 0413 00599000
*           GO TO TERMEXIT;         /* TERMINATE RECOVERY FUNCTION   */ 00600000
         B     TERMEXIT                                            0414 00601000
*         END;                                                     0415 00602000
*                                                                  0415 00603000
*   /*****************************************************************/ 00604000
*   /*                                                               */ 00605000
*   /* NEXT WE CHECK FOR NOT CAPABLE WHICH IS INDICATED BY SENSE 0001*/ 00606000
*   /*                                                               */ 00607000
*   /*****************************************************************/ 00608000
*                                                                  0416 00609000
*/*NOTCP: D (YES,,NO,PEID) NOT CAPABLE ?                             */ 00610000
*/* P (,TERMEXIT) MESSAGE ID = 36                                    */ 00611000
*       IF SENNC = ON THEN                                         0416 00612000
@RF00411 TM    SENNC(IODBREG),B'00000001'                          0416 00613000
         BNO   @RF00416                                            0416 00614000
*         DO;                       /* TAPE UNIT NOT CAPABLE OF    0417 00615000
*                                      COMMAND                       */ 00616000
*           ERBID = MSGNC;          /* MESSAGE ID SET UP             */ 00617000
         MVI   ERBID(CCTREG),X'24'                                 0418 00618000
*           GO TO TERMEXIT;         /* COMMAND CAN NOT BE EXECUTED -    00619000
*                                      TERMINATE RECOVERY            */ 00620000
         B     TERMEXIT                                            0419 00621000
*         END;                                                     0420 00622000
*                                                                  0421 00623000
*   /*****************************************************************/ 00624000
*   /*                                                               */ 00625000
*   /* PE ID BURST CHECK IS NEXT. THIS IS FOR 3400 SERIES TAPES ONLY */ 00626000
*   /* SENSE DATA IS 000000000010                                    */ 00627000
*   /*                                                               */ 00628000
*   /*****************************************************************/ 00629000
*                                                                  0421 00630000
*/*PEID: D (YES,,NO,TCC) PE ID BURST CK ?                            */ 00631000
*/* P OBTAIN LAST FAILING CCW                                        */ 00632000
*/* S TERERB:ERBTPE, CC=37, PCT=15, SCT=0                            */ 00633000
*/* D (YES,,NO,PEIDWTM) WRITE CMD ?                                  */ 00634000
*/* N (,REPRO) REPOSITION AND RETRY I/O OPERATION                    */ 00635000
*/*PEIDWTM: D (YES,,NO,PEIDUKN) WTM CMD ?                            */ 00636000
*/* N (,REPEATOP) RETRY I/O OPERATION                                */ 00637000
*/*PEIDUKN: P (,TERMEXIT) MESSAGE ID = 37                            */ 00638000
*       IF SENPEID = ON THEN                                       0421 00639000
@RF00416 TM    SENPEID(IODBREG),B'00010000'                        0421 00640000
         BNO   @RF00421                                            0421 00641000
*         DO;                       /* IF PEID BURST CHECK           */ 00642000
*           IODBCAW = CCWREG;       /* SET UP RETRY CCW              */ 00643000
         ST    CCWREG,IODBCAW(,IODBREG)                            0423 00644000
*           RESPECIFY R1 RESTRICTED;                               0424 00645000
*           R1 = ADDR(ERBPARM);     /* SET UP TO ERB BLOCK FOR RETRY */ 00646000
         LA    R1,ERBPARM                                          0425 00647000
*           ERBPID = MSGPEID;       /* SET UP COMMON SECTIONS OF ERB    00648000
*                                      - ID                          */ 00649000
         MVI   ERBPID,X'25'                                        0426 00650000
*           ERBSCT = ZERO;          /* SECONDARY RETRY COUNTER       */ 00651000
         MVI   ERBSCT,X'00'                                        0427 00652000
*           ERBPCT = FIFTEEN;       /* 15 RETRIES                    */ 00653000
         MVI   ERBPCT,X'0F'                                        0428 00654000
*           CALL TERERBX;           /* SET UP ERB PROPERLY           */ 00655000
         BAL   @14,TERERBX                                         0429 00656000
*           IF CCWCMD = WRITECMD THEN                              0430 00657000
         CLI   CCWCMD(CCWREG),1                                    0430 00658000
         BE    @RT00430                                            0430 00659000
*             GO TO REPRO;          /* REPOSITION AND RETRY I/O      */ 00660000
*           RESPECIFY R1 UNRESTRICTED;                             0432 00661000
*           IF CCWCMD = WTMCMD THEN                                0433 00662000
         CLI   CCWCMD(CCWREG),31                                   0433 00663000
         BE    @RT00433                                            0433 00664000
*             GO TO REPEATOP;       /* REPEAT OPERATION              */ 00665000
*           ERBID = MSGPEID;        /* SET MESSAGE ID                */ 00666000
         MVI   ERBID(CCTREG),X'25'                                 0435 00667000
*           GO TO TERMEXIT;         /* UNKNOWN COMMAND - RETRY NOT 0436 00668000
*                                      POSSIBLE                      */ 00669000
         B     TERMEXIT                                            0436 00670000
*         END;                      /* END OF PEID BURST CHECK CODE  */ 00671000
*                                                                  0438 00672000
*   /*****************************************************************/ 00673000
*   /*                                                               */ 00674000
*   /* IF UNIT CHECK IS STILL ON THIS IS AN UNKNOWN ERROR CONDITION. */ 00675000
*   /*                                                               */ 00676000
*   /*****************************************************************/ 00677000
*                                                                  0438 00678000
*/* P (,TERMEXIT) ERBID = MSGUNK UNKNOWN ERROR CONDITION             */ 00679000
*       ERBID = MSGUNK;             /* SET UP UNKNOWN ERROR        0438 00680000
*                                      IDENTIFIER                    */ 00681000
@RF00421 MVI   ERBID(CCTREG),X'1D'                                 0438 00682000
*       GO TO TERMEXIT;             /* EXIT WITHOUT RECOVERY         */ 00683000
         B     TERMEXIT                                            0439 00684000
*     END;                                                         0440 00685000
*                                                                  0440 00686000
*   /*****************************************************************/ 00687000
*   /*                                                               */ 00688000
*   /* THIS SECTION CHECKS FOR A CHAINING CHECK CONDITION. STATUS IS */ 00689000
*   /* 0001                                                          */ 00690000
*   /*                                                               */ 00691000
*   /*****************************************************************/ 00692000
*                                                                  0441 00693000
*/*TCC: D (YES,,NO,TIL) CHAINING CK ?                                */ 00694000
*/* P SET UP CC=28 FOR CHAINING CK                                   */ 00695000
*   IF CSWCHC = ON THEN                                            0441 00696000
@RF00409 TM    CSWCHC+24(IODBREG),B'00000001'                      0441 00697000
         BNO   @RF00441                                            0441 00698000
*     DO;                           /* IF CHAINING CHECK CONDITION   */ 00699000
*       ERBPID = MSGCC;             /* SET UP CHAINING CHECK       0443 00700000
*                                      IDENTIFIER                    */ 00701000
         MVI   ERBPID,X'1C'                                        0443 00702000
*       RESPECIFY R1 RESTRICTED;                                   0444 00703000
*                                                                  0444 00704000
*   /*****************************************************************/ 00705000
*   /*                                                               */ 00706000
*   /* THIS IS COMMON ACTION 7 RETRY/REPEAT OPERATION PROCESSING     */ 00707000
*   /*                                                               */ 00708000
*   /*****************************************************************/ 00709000
*                                                                  0445 00710000
*/*ACTION7: S TERERB:ERBTAPE, PCT=5, SCT=0                           */ 00711000
*/* D (YES,REPRO,NO,REPEATOP) READ OR WRITE CMD ?                    */ 00712000
*                                                                  0445 00713000
*ACTION7:                                                          0445 00714000
*       R1 = ADDR(ERBPARM);         /* SET UP ERB PARAMETER LIST     */ 00715000
ACTION7  LA    R1,ERBPARM                                          0445 00716000
*       ERBSCT = ZERO;              /* NO SECONDARY RETRIES          */ 00717000
         MVI   ERBSCT,X'00'                                        0446 00718000
*       ERBPCT = FIVE;              /* 5 PRIMARY RETRIES             */ 00719000
         MVI   ERBPCT,X'05'                                        0447 00720000
*       CALL TERERBX;               /* UPDATE ERB                    */ 00721000
         BAL   @14,TERERBX                                         0448 00722000
*       RESPECIFY R1 UNRESTRICTED;                                 0449 00723000
*       IODBCAW = CCWREG;           /* SET UP FOR REPOSITION RETRY 0450 00724000
*                                      OPERAT                        */ 00725000
         ST    CCWREG,IODBCAW(,IODBREG)                            0450 00726000
*       IF CCWCMD = WRITECMD | CCWCMD = READCMD THEN               0451 00727000
         CLI   CCWCMD(CCWREG),1                                    0451 00728000
         BE    @RT00451                                            0451 00729000
         CLC   CCWCMD(1,CCWREG),READCMD                            0451 00730000
         BE    @RT00451                                            0451 00731000
*         GO TO REPRO;              /* IF READ OR WRITE COMMAND THEN    00732000
*                                      REPOSITION TAPE BEFORE      0452 00733000
*                                      PERFORMING RETRIES            */ 00734000
*       GO TO REPEATOP;             /* RETRY I/O OPERATION           */ 00735000
         B     REPEATOP                                            0453 00736000
*     END;                          /* END CHAINING CHECK AND COMMON    00737000
*                                      ACTION 7 PROCESSING           */ 00738000
*                                                                  0454 00739000
*   /*****************************************************************/ 00740000
*   /*                                                               */ 00741000
*   /* CHECK FOR PROGRAM CHECK ERROR. STATUS IS 0020                 */ 00742000
*   /*                                                               */ 00743000
*   /*****************************************************************/ 00744000
*                                                                  0455 00745000
*/*TPCK: D (YES,,NO,TPROTCK) PROGRAM CK ?                            */ 00746000
*/* P (,TERMEXIT) MESSAGE ID = 23                                    */ 00747000
*   IF CSWPGC = ON THEN                                            0455 00748000
@RF00441 TM    CSWPGC+24(IODBREG),B'00100000'                      0455 00749000
         BNO   @RF00455                                            0455 00750000
*     DO;                           /* PROGRAM CHECK                 */ 00751000
*       ERBID = MSGPCK;             /* CHANNEL PROGRAM CHECK MESSAGE    00752000
*                                      ID                            */ 00753000
         MVI   ERBID(CCTREG),X'17'                                 0457 00754000
*       GO TO TERMEXIT;             /* NO RECOVERY FOR PGM CHECK     */ 00755000
         B     TERMEXIT                                            0458 00756000
*     END;                                                         0459 00757000
*                                                                  0459 00758000
*   /*****************************************************************/ 00759000
*   /*                                                               */ 00760000
*   /* CHECK FOR PROTECTION CHECK ERROR. STATUS IS 0010              */ 00761000
*   /*                                                               */ 00762000
*   /*****************************************************************/ 00763000
*                                                                  0460 00764000
*/*TPROTCK: D (YES,,NO,TUE) PROTECTION CK ?                          */ 00765000
*/* P (,TERMEXIT) MESSAGE ID = 24                                    */ 00766000
*   IF CSWPTC = ON THEN                                            0460 00767000
@RF00455 TM    CSWPTC+24(IODBREG),B'00010000'                      0460 00768000
         BNO   @RF00460                                            0460 00769000
*     DO;                           /* CHANNEL PROTECTION CHECK      */ 00770000
*       ERBID = MSGPTK;             /* SET UP MESSAGE ID             */ 00771000
         MVI   ERBID(CCTREG),X'18'                                 0462 00772000
*       GO TO TERMEXIT;             /* NO RETRIES                    */ 00773000
         B     TERMEXIT                                            0463 00774000
*     END;                                                         0464 00775000
*                                                                  0465 00776000
*   /*****************************************************************/ 00777000
*   /*                                                               */ 00778000
*   /* CHECK FOR INCORRECT LENGTH ERROR. STATUS IS 0040              */ 00779000
*   /*                                                               */ 00780000
*   /*****************************************************************/ 00781000
*                                                                  0465 00782000
*/*TIL: D (YES,,NO,TPCK) INCORRECT LENGTH ?                          */ 00783000
*/* P (,TERMEXIT) MESSAGE ID = 22                                    */ 00784000
*   IF CSWIL = ON THEN                                             0465 00785000
@RF00460 TM    CSWIL+24(IODBREG),B'01000000'                       0465 00786000
         BNO   @RF00465                                            0465 00787000
*     DO;                           /* INCORRECT LENGTH CONDITION    */ 00788000
*       ERBID = MSGIL;              /* SET UP MSG ID FOR INCORRECT 0467 00789000
*                                      LENGTH                        */ 00790000
         MVI   ERBID(CCTREG),X'16'                                 0467 00791000
*       GO TO TERMEXIT;             /* NO RETIRES                    */ 00792000
         B     TERMEXIT                                            0468 00793000
*     END;                                                         0469 00794000
*                                                                  0470 00795000
*   /*****************************************************************/ 00796000
*   /*                                                               */ 00797000
*   /* NEXT WE HANDLE UNIT EXECPTION. THIS CONDITION IS CAUSED BY END*/ 00798000
*   /* OF REEL ON THE TAPE VOLUME(REACHING THE REFLECTOR ON THE BACK */ 00799000
*   /* SIDE OF THE TAPE). STATUS IS 0100.                            */ 00800000
*   /*                                                               */ 00801000
*   /*****************************************************************/ 00802000
*                                                                  0470 00803000
*/* TUE: D (YES,UNITEX,NO,)UNIT EXCEPTION ?                          */ 00804000
*/*UNITEX: D (YES,RC0,NO,) ON BSR ?                                  */ 00805000
*/* D (YES,RC0,NO,) ON WORK FILE                                     */ 00806000
*/* L TERWTM: ISSUE WTM, WTM, RUN CCW CHAIN                          */ 00807000
*/* P SET UP TO ISSUE EOR MSG                                        */ 00808000
*/* L AMDSACON:SVC 2 ISSUE EOR MSG                                   */ 00809000
*/* S TERINR:OBTAIN A NEW TAPE                                       */ 00810000
*/* D (YES,,NO,EORWAIT) NEW TAPE MOUNTED ?                           */ 00811000
*/* D (YES,,NO,EORCHAIN) CCW CHAIN TO CONTINUE ?                     */ 00812000
*/* P (,NEWTAPEM) UPDATE IODBCAW TO CONTINUE CCW CHAIN               */ 00813000
*/*EORCHAIN: P (,NEWTAPEM) EORCHAIN = 1                              */ 00814000
*/*EORWAIT: P (,TERMEXIT) MESSAGE ID = 20                            */ 00815000
*   IF CSWUE = ON THEN                                             0470 00816000
@RF00465 TM    CSWUE+24(IODBREG),B'00000001'                       0470 00817000
         BNO   @RF00470                                            0470 00818000
*     DO;                           /* HANDLE UNIT EXCEPTION AS EOR  */ 00819000
*       IF IODBREG = ADDR(IODBWORK) /* IGNORE UE ON TAPE WORKFILE    */ 00820000
*             | CCWCMD = BSRCMD THEN                               0472 00821000
         L     @10,@CA01085                                        0472 00822000
         CR    IODBREG,@10                                         0472 00823000
         BE    @RT00472                                            0472 00824000
         CLI   CCWCMD(CCWREG),39                                   0472 00825000
         BE    @RT00472                                            0472 00826000
*         GO TO RC0;                /* IF ON BSR-IGNORE AS IN ERROR     00827000
*                                      RECOVERY.THIS OCCURS WHEN A 0473 00828000
*                                      BSR IS ISSUED AND A TAPE MARK    00829000
*                                      IS DETECTED DURING EXECUTION     00830000
*                                      OF THE BSR COMMAND.           */ 00831000
*       RUNSW = OFF;                /* FULL FUNCTION WANTED          */ 00832000
         NI    RUNSW,B'01111111'                                   0474 00833000
*       CALL TERWTM;                /* WRITE TAPE MARK AND UNLOAD  0475 00834000
*                                      TAPE                          */ 00835000
         BAL   @14,TERWTM                                          0475 00836000
*       RESPECIFY R1 RESTRICTED;                                   0476 00837000
*       R1 = AMD004A;               /* SET ERBID                     */ 00838000
         LA    R1,4                                                0477 00839000
*       CALL TERINR;                /* ISSUE EOR                     */ 00840000
         BAL   @14,TERINR                                          0478 00841000
*       RESPECIFY RETCODE RESTRICTED;                              0479 00842000
*       IF RETCODE ^= ZERO THEN                                    0480 00843000
         LTR   RETCODE,RETCODE                                     0480 00844000
         BZ    @RF00480                                            0480 00845000
*         DO;                       /* IF NEW TAPE NOT OBTAINED      */ 00846000
*           RESPECIFY RETCODE UNRESTRICTED;                        0482 00847000
*           ERBID = MSGUE;          /* SET UP MSG ID                 */ 00848000
         MVI   ERBID(CCTREG),X'14'                                 0483 00849000
*           GO TO TERMEXIT;         /* TERMINATE RECOVERY            */ 00850000
         B     TERMEXIT                                            0484 00851000
*         END;                                                     0485 00852000
*       DO WHILE (CCWCMD ^= TICMD) & (CCWCMD ^= NOPCMD); /* POINT TO    00853000
*                                      TIC OR NOP                    */ 00854000
@RF00480 B     @DE00486                                            0486 00855000
@DL00486 DS    0H                                                  0487 00856000
*         CCWREG = CCWREG + LENGTH(CCW); /* ADVANCE POINTER          */ 00857000
         AL    CCWREG,@CF00036                                     0487 00858000
*       END;                                                       0488 00859000
@DE00486 CLI   CCWCMD(CCWREG),8                                    0488 00860000
         BE    @DC00486                                            0488 00861000
         CLI   CCWCMD(CCWREG),3                                    0488 00862000
         BNE   @DL00486                                            0488 00863000
@DC00486 DS    0H                                                  0489 00864000
*       IF CCWCMD = NOPCMD THEN                                    0489 00865000
         CLI   CCWCMD(CCWREG),3                                    0489 00866000
         BNE   @RF00489                                            0489 00867000
*         EORCHAIN = ON;            /* INDICATE NO DATA TO WRITE     */ 00868000
         OI    EORCHAIN,B'10000000'                                0490 00869000
*       ELSE                                                       0491 00870000
*         IODBCAW = CCWDADDR;       /* SET UP TO NEXT WRITE          */ 00871000
         B     @RC00489                                            0491 00872000
@RF00489 L     @10,CCWDADDR-1(,CCWREG)                             0491 00873000
         LA    @10,0(,@10)                                         0491 00874000
         ST    @10,IODBCAW(,IODBREG)                               0491 00875000
*       GO TO NEWTAPEM;             /* MOUNT A NEW TAPE              */ 00876000
         B     NEWTAPEM                                            0492 00877000
*       RESPECIFY R1 UNRESTRICTED;                                 0493 00878000
*     END;                                                         0494 00879000
*                                                                  0495 00880000
*   /*****************************************************************/ 00881000
*   /*                                                               */ 00882000
*   /* NEXT WE HANDLE ATTENTION. THIS CONDITION IS NOTED BY STATUS   */ 00883000
*   /* 8000.                                                         */ 00884000
*   /*                                                               */ 00885000
*   /*****************************************************************/ 00886000
*                                                                  0495 00887000
*/* D (YES,,NO,STATM) ATTN ?                                         */ 00888000
*/* P (,TERMEXIT) MESSAGE ID = 16                                    */ 00889000
*   IF CSWATTN = ON THEN                                           0495 00890000
@RF00470 TM    CSWATTN+24(IODBREG),B'10000000'                     0495 00891000
         BNO   @RF00495                                            0495 00892000
*     DO;                           /* ATTENTION INTERRUPT           */ 00893000
*       ERBID = MSGATTN;            /* MSG ID                        */ 00894000
         MVI   ERBID(CCTREG),X'10'                                 0497 00895000
*       GO TO TERMEXIT;             /* NO RETRIES                    */ 00896000
         B     TERMEXIT                                            0498 00897000
*     END;                                                         0499 00898000
*                                                                  0499 00899000
*   /*****************************************************************/ 00900000
*   /*                                                               */ 00901000
*   /* IF DEVICE END IS ON. THIS IS NORMAL. THE CHAIN WAS BROKEN AND */ 00902000
*   /* CAN NOW BE RESTARTED                                          */ 00903000
*   /*                                                               */ 00904000
*   /*****************************************************************/ 00905000
*                                                                  0500 00906000
*/*STATM: D (YES,,NO,STATSHR) DEVICE END ?                           */ 00907000
*/* D (YES,STATSHR,NO,) IODBBCT = 0 ?                                */ 00908000
*/* D (YES,,NO,STATSHR) BCTCOMP = 0 FOR FIRST BCT                    */ 00909000
*/*BCTLOOP: D (YES,STRTFND,NO,) BCTNEXT = 0 ?                        */ 00910000
*/* P (,BCTLOOP) BUMP TO NEXT BCT ENTRY                              */ 00911000
*/*STRTFND: P OBTAIN STARTING CCW FOR THE LAST BCT                   */ 00912000
*/* P (,REPEATOP) PLACE CCW IN IODBCAW FOR OUTPUT IODB               */ 00913000
*   RESPECIFY BCT BASED (IODBBCT);                                 0500 00914000
@RF00495 DS    0H                                                  0501 00915000
*   IF CSWDE = ON & IODBREG = ADDR(IODBOUT) & IODBBCT ^= ZERO &    0501 00916000
*         BCTCOMP = OFF THEN                                       0501 00917000
         TM    CSWDE+24(IODBREG),B'00000100'                       0501 00918000
         BNO   @RF00501                                            0501 00919000
         L     @10,@CA01046                                        0501 00920000
         CR    IODBREG,@10                                         0501 00921000
         BNE   @RF00501                                            0501 00922000
         L     @10,IODBBCT(,IODBREG)                               0501 00923000
         LTR   @10,@10                                             0501 00924000
         BZ    @RF00501                                            0501 00925000
         TM    BCTCOMP(@10),B'10000000'                            0501 00926000
         BNZ   @RF00501                                            0501 00927000
*     DO;                           /* DETERMINE IF EMPTY BUFFER     */ 00928000
*       IF CCWCMD = TICMD | CCWCMD = NOPCMD THEN                   0503 00929000
         CLI   CCWCMD(CCWREG),8                                    0503 00930000
         BE    @RT00503                                            0503 00931000
         CLI   CCWCMD(CCWREG),3                                    0503 00932000
         BNE   @RF00503                                            0503 00933000
@RT00503 DS    0H                                                  0504 00934000
*         DO;                       /* IF TIC CMD OR NOP CMD CONTINUE*/ 00935000
*           IODBCAW = CCWDADDR;     /* SET TO NEXT WRITE CMD         */ 00936000
         L     @10,CCWDADDR-1(,CCWREG)                             0505 00937000
         LA    @10,0(,@10)                                         0505 00938000
         ST    @10,IODBCAW(,IODBREG)                               0505 00939000
*           GO TO REPEATOP;         /* SIO ON THE CCW CHAIN          */ 00940000
         B     REPEATOP                                            0506 00941000
*         END;                                                     0507 00942000
*     END;                                                         0508 00943000
@RF00503 DS    0H                                                  0509 00944000
*                                                                  0509 00945000
*   /*****************************************************************/ 00946000
*   /*                                                               */ 00947000
*   /* THIS IS A NORMAL CONDITION CAUSED BY SHARED TAPE SUPPORT. THE */ 00948000
*   /* STATUS MAY BE STATUS MODIFIER AND BUSY WHICH IMPLIES CONTROL  */ 00949000
*   /* UNIT BUSY - STATUS DATA 5000 OR CONTROL UNIT END WHICH MEANS  */ 00950000
*   /* THE DEVICE IS NOW FREE AND READY FOR I/O - STATUS DATA 2000   */ 00951000
*   /*                                                               */ 00952000
*   /*****************************************************************/ 00953000
*                                                                  0509 00954000
*/*STATSHR: N THIS PATH HANDLES SHARED TAPES                         */ 00955000
*/* N STATUS MODIFIER, CONTROL UNIT END, AND BUSY                    */ 00956000
*/*RC0: P (,RESTREGS) RETURN CODE = 0                                */ 00957000
*                                                                  0509 00958000
*RC0:                                                              0509 00959000
*   SAVEBACK -> SAVER15 = ZERO;     /* SET UP ZERO RETURN CODE -   0509 00960000
*                                      ERROR CONDITION SUCCESSFULLY     00961000
*                                      CORRECTED                     */ 00962000
@RF00501 DS    0H                                                  0509 00963000
RC0      L     @10,SAVEBACK(,R13)                                  0509 00964000
         SLR   @04,@04                                             0509 00965000
         ST    @04,SAVER15(,@10)                                   0509 00966000
*   IODBIOC = OFF;                  /* RESET I/O ERROR INDICATOR     */ 00967000
         NI    IODBIOC(IODBREG),B'11101111'                        0510 00968000
*   GO TO RESTREGS;                 /* RETURN TO CALLER              */ 00969000
         B     RESTREGS                                            0511 00970000
*                                                                  0512 00971000
*   /*****************************************************************/ 00972000
*   /*                                                               */ 00973000
*   /* TERMINATION ROUTINE                                           */ 00974000
*   /*                                                               */ 00975000
*   /*****************************************************************/ 00976000
*                                                                  0512 00977000
*/*TERMEXIT: S TERERM:ISSUE MESSAGE                                  */ 00978000
*/* P IODBTERM = 1  IF TERMINAL ERROR                                */ 00979000
*/* P IODBIOC = 1                                                    */ 00980000
*/* D (YES,,NO,TRC4) OUTPUT IODB ?                                   */ 00981000
*/* D (YES,NEWTAPE,NO,) CAN NEW TAPE BE OBTAINED ?                   */ 00982000
*/* D (YES,,NO,TRC4) TERMINAL ERROR?                                 */ 00983000
*/* S AMDSACON: ISSUE MESSAGE AMD031I                                */ 00984000
*/*PTERM: P IODBPTRM = 1                                             */ 00985000
*/* R AMDSAAUD: SVC 13                                               */ 00986000
*/*TRC4: P RETURN CODE = 4                                           */ 00987000
*/*RESTREGS: P CTERBTPE = 0                                          */ 00988000
*/* P RESTORE CALLER'S REGISTERS                                     */ 00989000
*/* R RETURN TO CALLER                                               */ 00990000
*                                                                  0512 00991000
*TERMEXIT:                                                         0512 00992000
*   RESPECIFY R1 RESTRICTED;                                       0512 00993000
TERMEXIT DS    0H                                                  0513 00994000
*   R1 = ERBID;                     /* SET UP INPUT MESSAGE        0513 00995000
*                                      IDENTIFIER                    */ 00996000
         SLR   R1,R1                                               0513 00997000
         IC    R1,ERBID(,CCTREG)                                   0513 00998000
*   CALL TERERM;                    /* ISSUE I/O ERROR MESSAGES      */ 00999000
         BAL   @14,TERERM                                          0514 01000000
*   RESPECIFY R1 UNRESTRICTED;                                     0515 01001000
*   IF CSWCDC = ON | CSWCCC = ON | CSWICC = ON | CSWCHC = ON THEN /*    01002000
*                                      TERMINAL ERROR                */ 01003000
         TM    CSWCDC+24(IODBREG),B'00001111'                      0516 01004000
         BZ    @RF00516                                            0516 01005000
*     IODBTERM = ON;                /* YES--SO INDICATE              */ 01006000
         OI    IODBTERM(IODBREG),B'10000000'                       0517 01007000
*   IODBIOC = ON;                   /* INDICATE AN I/O ERROR OCCURRED*/ 01008000
@RF00516 OI    IODBIOC(IODBREG),B'00010000'                        0518 01009000
*   IF IODBREG = ADDR(IODBOUT) THEN                                0519 01010000
         L     @10,@CA01046                                        0519 01011000
         CR    IODBREG,@10                                         0519 01012000
         BNE   @RF00519                                            0519 01013000
*     DO;                                                          0520 01014000
*       MSGADDR =MSGTAB(ERBID + 1); /* OBTAIN MSG BLOCK              */ 01015000
         SLR   @10,@10                                             0521 01016000
         IC    @10,ERBID(,CCTREG)                                  0521 01017000
         SLA   @10,2                                               0521 01018000
         L     @04,@CA00981                                        0521 01019000
         L     MSGADDR,MSGTAB-MSGTAB(@10,@04)                      0521 01020000
*       IF MSGTAPE = ON THEN                                       0522 01021000
         TM    MSGTAPE(MSGADDR),B'00100000'                        0522 01022000
         BO    @RT00522                                            0522 01023000
*         GO TO NEWTAPE;            /* IF NEW TAPE POSSIBLE - OBTAIN */ 01024000
*       RESPECIFY R1 RESTRICTED;    /* RESTRICT REG                  */ 01025000
*       R1 = AMD031I;               /* SET MESSAGE ID                */ 01026000
         LA    R1,31                                               0525 01027000
*       SVC(CONSVC);                /* ISSUE MESSAGE                 */ 01028000
         SVC   3                                                   0526 01029000
*       RESPECIFY R1 UNRESTRICTED;  /* RELEASE REG                   */ 01030000
*       CTWAIT = TERWAIT;           /* SET PERMANENT ERROR WAIT CODE */ 01031000
*                                                                  0528 01032000
         MVI   CTWAIT(CCTREG),X'30'                                0528 01033000
*PTERM:                                                            0529 01034000
*       IODBPTRM = ON;              /* PERMANENT ERROR - KILL VIRTUAL   01035000
*                                      DUMP                          */ 01036000
PTERM    DS    0H                                                  0530 01037000
*       IODBTERM = ON;              /* CATASTROPHIC DEVICE ERRORS    */ 01038000
         OI    IODBPTRM(IODBREG),B'11000000'                       0530 01039000
*       SVC (AUDSVC);               /* TERMINATE                     */ 01040000
         SVC   13                                                  0531 01041000
*     END;                                                         0532 01042000
*   SAVEBACK -> SAVER15 = 4;        /* SET 4 RETURN CODE             */ 01043000
@RF00519 L     @10,SAVEBACK(,R13)                                  0533 01044000
         MVC   SAVER15(4,@10),@CF00044                             0533 01045000
*   IF IODBBCT ^= ZERO THEN         /* IS THERE A BCT                */ 01046000
         L     @10,IODBBCT(,IODBREG)                               0534 01047000
         LTR   @10,@10                                             0534 01048000
         BZ    @RF00534                                            0534 01049000
*     DO;                                                          0535 01050000
*       BCTCOMP = ON;               /* THEN TURN ON BCT COMPLETION 0536 01051000
*                                      FLAG                          */ 01052000
*       BCTIOERR = ON;              /* COMPLETED WITH ERROR          */ 01053000
         OI    BCTCOMP(@10),B'10100000'                            0537 01054000
*     END;                                                         0538 01055000
*                                                                  0538 01056000
*RESTREGS:                                                         0539 01057000
*   CTERBTPE = ZERO;                /* ZERO ERB FOR LATER USE        */ 01058000
@RF00534 DS    0H                                                  0539 01059000
RESTREGS SLR   @10,@10                                             0539 01060000
         ST    @10,CTERBTPE(,CCTREG)                               0539 01061000
*   RETURN;                         /* RETURN TO CALLER              */ 01062000
@EL00001 L     @13,4(,@13)                                         0540 01063000
@EF00001 DS    0H                                                  0540 01064000
@ER00001 LM    @14,@12,12(@13)                                     0540 01065000
         BR    @14                                                 0540 01066000
*                                                                  0541 01067000
*   /*****************************************************************/ 01068000
*   /*                                                               */ 01069000
*   /* SET UP TO BACKSPACE RECORD BEFORE RETRY OPERATION             */ 01070000
*   /*                                                               */ 01071000
*   /*****************************************************************/ 01072000
*                                                                  0541 01073000
*/*REPRO: D (YES,REPEATOP,NO,) IODBCSW CCW POINT TO BSR CMD ?        */ 01074000
*/* P CHAIN BSR TIC TO FAILING CMD WHICH HAS DATA CHAIN ON           */ 01075000
*/* P UPDATE IODBCAW WITH BSR TIC CMD                                */ 01076000
*                                                                  0541 01077000
*REPRO:                                                            0541 01078000
*   RESPECIFY CCW BASED (IODBCAW);                                 0541 01079000
REPRO    DS    0H                                                  0542 01080000
*   CCWPCI = OFF;                   /* INSURE PCI OFF                */ 01081000
         L     @10,IODBCAW(,IODBREG)                               0542 01082000
         NI    CCWPCI(@10),B'11110111'                             0542 01083000
*   IF CCWCMD ^= BSRCMD THEN                                       0543 01084000
         CLI   CCWCMD(@10),39                                      0543 01085000
         BE    @RF00543                                            0543 01086000
*     DO;                           /* IF AT BSR DO NOT LOOP         */ 01087000
*       REPOTADR = IODBCAW;         /* SET UP TIC CTL ADDRESS        */ 01088000
         STCM  @10,7,REPOTADR                                      0545 01089000
*       IODBCAW = ADDR(REPOSPRM);   /* SET UP BSR, TIC,CCW CHAIN     */ 01090000
         LA    @10,REPOSPRM                                        0546 01091000
         ST    @10,IODBCAW(,IODBREG)                               0546 01092000
*     END;                                                         0547 01093000
*/*  REPEATOP WILL REPEAT THE I/O OPERATION STARTING WITH IODBCAW    */ 01094000
*/*REPEATOP: S TERERP:ISSUE RETRY I/O OPERATION                      */ 01095000
*/* D (YES,%BSRCHK,NO,) I/O ERROR ON RETRY ?                         */ 01096000
*/* P (,RESTREGS) SET UP RETURN CODE OF ZERO                         */ 01097000
*/*%BSRCHK: D (YES,BSRCK,NO,RETEST) IODBCAW = BSR CMD ?              */ 01098000
*/*BSRCK: P (,RETEST) SET CCWREG = BSR TIC CMD                       */ 01099000
*                                                                  0548 01100000
*REPEATOP:                                                         0548 01101000
*   CCWPCI = OFF;                   /* INSURE PCI OFF                */ 01102000
@RF00543 DS    0H                                                  0548 01103000
REPEATOP L     @10,IODBCAW(,IODBREG)                               0548 01104000
         NI    CCWPCI(@10),B'11110111'                             0548 01105000
*   RESPECIFY CCW BASED (CCWREG);                                  0549 01106000
*   CALL TERERP;                    /* RETRY I/O OPERATION           */ 01107000
         BAL   @14,TERERP                                          0550 01108000
*   RESPECIFY RETCODE RESTRICTED;                                  0551 01109000
*   IF RETCODE = ZERO THEN                                         0552 01110000
         SLR   @14,@14                                             0552 01111000
         CR    RETCODE,@14                                         0552 01112000
         BNE   @RF00552                                            0552 01113000
*     DO;                                                          0553 01114000
*       SAVEBACK -> SAVER15 = 0;    /* SET UP RETURN CODE OF ZERO    */ 01115000
         L     @10,SAVEBACK(,R13)                                  0554 01116000
         ST    @14,SAVER15(,@10)                                   0554 01117000
*       GO TO RESTREGS;             /* RETURN TO CALLER              */ 01118000
         B     RESTREGS                                            0555 01119000
*     END;                                                         0556 01120000
*   RESPECIFY RETCODE UNRESTRICTED;                                0557 01121000
@RF00552 DS    0H                                                  0558 01122000
*   IF IODBREG = ADDR(IODBOUT) & IODBCAW = ADDR(REPOSTAP) THEN /* WAS   01123000
*                                      CAW CHANGED FOR REPOSITIONING?*/ 01124000
         L     @10,@CA01046                                        0558 01125000
         CR    IODBREG,@10                                         0558 01126000
         BNE   @RF00558                                            0558 01127000
         LA    @10,REPOSTAP                                        0558 01128000
         C     @10,IODBCAW(,IODBREG)                               0558 01129000
         BNE   @RF00558                                            0558 01130000
*     IODBCAW = TICTLADR;           /* UPDATE CAW TO ORIGINAL CCW    */ 01131000
         L     @10,TICTLADR-1                                      0559 01132000
         LA    @10,0(,@10)                                         0559 01133000
         ST    @10,IODBCAW(,IODBREG)                               0559 01134000
*   GO TO RETEST;                   /* DETERMINE CAUSE OF ERROR      */ 01135000
         B     RETEST                                              0560 01136000
*                                                                  0561 01137000
*   /*****************************************************************/ 01138000
*   /*                                                               */ 01139000
*   /* OBTAIN A NEW TAPE FROM THE OPERATOR                           */ 01140000
*   /*                                                               */ 01141000
*   /*****************************************************************/ 01142000
*                                                                  0561 01143000
*/*NEWTAPE: P SET UP TO ISSUE WTM                                    */ 01144000
*/* S TERERI:ISSUE WTM CMD                                           */ 01145000
*/*NLTPE: P SET UP TO ISSUE REWIND UNLOAD                            */ 01146000
*/* S TERERI:ISSUE REWIND UNLOAD CMD                                 */ 01147000
*/* S AMDSABIN:SVC 28 CONVERT DDD FOR TAPE MOUNT MSG                 */ 01148000
*/* S TERINR:GO GET NEW TAPE                                         */ 01149000
*/* D (YES,,NO,PTERM) NEW TAPE OBTAINED ?                            */ 01150000
*                                                                  0561 01151000
*NEWTAPE:                                                          0561 01152000
*   RESPECIFY R1 RESTRICTED;                                       0561 01153000
*                                                                  0561 01154000
NEWTAPE  DS    0H                                                  0562 01155000
*   /*****************************************************************/ 01156000
*   /*                                                               */ 01157000
*   /* NOW TELL THE OPERATOR WE WANT A NL TAPE MOUNTED, AND WAIT FOR */ 01158000
*   /* THE TAPE TO BE MOUNTED. ONCE MOUNTED DETERMINE THAT THE TAPE  */ 01159000
*   /* IS A NL TAPE, THAT IS THE TAPE IS NOT A STANDARD LABEL TAPE,  */ 01160000
*   /* ASCII LABEL TAPE, OR WE CAN NOT ASCERTAIN EITHER              */ 01161000
*   /*                                                               */ 01162000
*   /*****************************************************************/ 01163000
*                                                                  0562 01164000
*   IF IODBREG ^= ADDR(IODBOUT) THEN                               0562 01165000
         L     @10,@CA01046                                        0562 01166000
         CR    IODBREG,@10                                         0562 01167000
         BNE   @RT00562                                            0562 01168000
*     GO TO TERMEXIT;               /* ONLY EOR FOR OUTPUT IODB      */ 01169000
*   RUNSW = OFF;                    /* FULL FUNCTION WANTED          */ 01170000
         NI    RUNSW,B'01111111'                                   0564 01171000
*   RESPECIFY RETCODE RESTRICTED;                                  0565 01172000
*   CALL TERWTM;                    /* WRITE TAPE MARK AND UNLOAD  0566 01173000
*                                      TAPE                          */ 01174000
         BAL   @14,TERWTM                                          0566 01175000
*   IF RETCODE ^= 0 THEN            /* TAPE MARK WRITTEN             */ 01176000
         LTR   RETCODE,RETCODE                                     0567 01177000
         BNZ   @RT00567                                            0567 01178000
*     GO TO PTERM;                  /* NO THEN TERMINATE             */ 01179000
*   RESPECIFY RETCODE UNRESTRICTED;                                0569 01180000
*   RESPECIFY R1 RESTRICTED;                                       0570 01181000
*                                                                  0570 01182000
*NLTAPE:                                                           0571 01183000
*   R1 = ADDR(CVTBLK);              /* SET UP CONVERT PARAMETER LIST    01184000
*                                      ADDRESS                       */ 01185000
NLTAPE   LA    R1,CVTBLK                                           0571 01186000
*   CVTBINA = ADDR(IODBDEV);        /* DEVICE ADDRESS TO CONVERT     */ 01187000
         LA    @10,IODBDEV(,IODBREG)                               0572 01188000
         ST    @10,CVTBINA                                         0572 01189000
*   CVTEBCA = ADDR(CONVAREA);       /* AREA FOR ANSWER               */ 01190000
         LA    @10,CONVAREA                                        0573 01191000
         ST    @10,CVTEBCA                                         0573 01192000
*   CVTINL = TWO;                   /* DEVICE LENGTH IN BYTES        */ 01193000
         MVC   CVTINL(2),@CH00108                                  0574 01194000
*   SVC (BINSVC);                   /* CONVERT DEVICE TO EBCDIC      */ 01195000
         SVC   28                                                  0575 01196000
*   DEV20A = CONVAREA(2:4);         /* MOVE INTO MSG                 */ 01197000
         L     @10,@CA01077                                        0576 01198000
         MVC   DEV20A-DEV20A(3,@10),CONVAREA+1                     0576 01199000
*   R1 = AMD020A;                   /* SET UP MSG ID                 */ 01200000
         LA    R1,20                                               0577 01201000
*   CALL TERINR;                    /* GET NEW TAPE                  */ 01202000
         BAL   @14,TERINR                                          0578 01203000
*   RESPECIFY RETCODE RESTRICTED;                                  0579 01204000
*   IF RETCODE ^= ZERO THEN         /* NO NEW TAPE MOUNTED           */ 01205000
         LTR   RETCODE,RETCODE                                     0580 01206000
         BNZ   @RT00580                                            0580 01207000
*     GO TO PTERM;                  /* TERMINATE VIRTUAL DUMP        */ 01208000
*   RESPECIFY RETCODE UNRESTRICTED;                                0582 01209000
*   RESPECIFY R1 UNRESTRICTED;                                     0583 01210000
*                                                                  0584 01211000
*   /*****************************************************************/ 01212000
*   /*                                                               */ 01213000
*   /* THIS SECTION OF TER OBTAINS A NEW TAPE AND VERIFIES THAT THE  */ 01214000
*   /* TAPE IS INDEED A NON-LABELLED TAPE                            */ 01215000
*   /*                                                               */ 01216000
*   /*****************************************************************/ 01217000
*                                                                  0584 01218000
*/*NEWTAPEM: P REWIND TAPE AND READ VOLUME LABEL                     */ 01219000
*/* S TERERI:READ THE TAPE LABEL                                     */ 01220000
*/* D (YES,LBLERR,NO,) I/O ERROR READING TAPE LABEL ?                */ 01221000
*/* D (YES,LBLERR,NO,) STANDARD LABEL TAPE ?                         */ 01222000
*/* D (YES,LBLERR,NO,) ASCII LABEL ?                                 */ 01223000
*/* D (YES,,NO,REPEATOP) EORCHAIN = 1 ?                              */ 01224000
*/* P (,RC0) EORCHAIN = 0                                            */ 01225000
*/*LBLERR: L AMDSACON:SVC 2 ISSUE LBL ERR MSG                        */ 01226000
*/* D (YES,,NO,PTERM) MSG ISSUED ?                                   */ 01227000
*/* L (,NLTPE) TERWTM: WRITE TAPE MARK AND REWIND TAPE               */ 01228000
*/*AMDSATER: END                                                     */ 01229000
*                                                                  0584 01230000
*NEWTAPEM:                                                         0584 01231000
*   RESPECIFY (R11,RETCODE) RESTRICTED;                            0584 01232000
NEWTAPEM DS    0H                                                  0585 01233000
*   R11 = ADDR(REREAD);             /* SET UP TO READ THE VOLUME   0585 01234000
*                                      LABEL                         */ 01235000
         LA    R11,REREAD                                          0585 01236000
*   CALL TERERI;                    /* READ VOLUME LABEL             */ 01237000
         BAL   @14,TERERI                                          0586 01238000
*     RESPECIFY CSW BASED(ADDR(FLCCSW));                    /*@ZA04263* 01239000
*  IF RETCODE = ZERO | (RETCODE ^= ZERO & CSWUE = ON) THEN  /*@ZA02779* 01240000
         SLR   @14,@14                                             0588 01241000
         CR    RETCODE,@14                                         0588 01242000
         BE    @RT00588                                            0588 01243000
         CR    RETCODE,@14                                         0588 01244000
         BE    @RF00588                                            0588 01245000
         LA    @14,FLCCSW                                          0588 01246000
         TM    CSWUE(@14),B'00000001'                              0588 01247000
         BNO   @RF00588                                            0588 01248000
@RT00588 DS    0H                                                  0589 01249000
*     DO;                           /* IF READ IS OKAY, CHECK THE  0589 01250000
*                                      LABEL                         */ 01251000
*     RESPECIFY CSW BASED(ADDR(IODBCSW));                   /*@ZA04263* 01252000
*       RESPECIFY RETCODE UNRESTRICTED;                            0591 01253000
*       IF VOLABEL ^= VOL1 & VOLABEL ^= ASCII THEN                 0592 01254000
         CLC   VOLABEL(4),VOL1                                     0592 01255000
         BE    @RF00592                                            0592 01256000
         CLC   VOLABEL(4),ASCII                                    0592 01257000
         BE    @RF00592                                            0592 01258000
*         DO;                       /* NOT STANDARD OR ASCII LABELLED   01259000
*                                      TAPE                          */ 01260000
*           IF EORCHAIN = OFF THEN                                 0594 01261000
         TM    EORCHAIN,B'10000000'                                0594 01262000
         BZ    @RT00594                                            0594 01263000
*             GO TO REPEATOP;       /* IF I/O TO DO START IT         */ 01264000
*           EORCHAIN = OFF;         /* RESET NO I/O SWITCH           */ 01265000
         NI    EORCHAIN,B'01111111'                                0596 01266000
*       CSWUE = OFF;                                        /*@ZA04263* 01267000
         NI    CSWUE+24(IODBREG),B'11111110'                       0597 01268000
*           GO TO RC0;              /* RETURN TO CALLER              */ 01269000
         B     RC0                                                 0598 01270000
*         END;                                                     0599 01271000
*     END;                                                         0600 01272000
@RF00592 DS    0H                                                  0601 01273000
*   RESPECIFY R11 UNRESTRICTED;                                    0601 01274000
@RF00588 DS    0H                                                  0602 01275000
*   RESPECIFY R1 RESTRICTED;                                       0602 01276000
*   VOLABEL = VOLABEL && VOLABEL;   /* ZERO LABEL AREA               */ 01277000
         XC    VOLABEL(4),VOLABEL                                  0603 01278000
*   R1 = AMD002I;                   /* SET UP LBL ERR MSG ID         */ 01279000
         LA    R1,2                                                0604 01280000
*   SVC (CONSVC);                   /* ISSUE LBL ERR MSG             */ 01281000
         SVC   3                                                   0605 01282000
*   RESPECIFY RETCODE RESTRICTED;                                  0606 01283000
*   IF RETCODE = ZERO THEN                                         0607 01284000
         LTR   RETCODE,RETCODE                                     0607 01285000
         BNZ   @RF00607                                            0607 01286000
*     DO;                                                          0608 01287000
*       RUNSW = ON;                 /* REWIND/UNLOAD ONLY            */ 01288000
         OI    RUNSW,B'10000000'                                   0609 01289000
*       CALL TERWTM;                /* UNLOAD TAPE                   */ 01290000
         BAL   @14,TERWTM                                          0610 01291000
*       GO TO NLTAPE;               /* GO GET NL TAPE                */ 01292000
         B     NLTAPE                                              0611 01293000
*     END;                                                         0612 01294000
*   RESPECIFY RETCODE UNRESTRICTED;                                0613 01295000
*   GO TO PTERM;                    /* TERMINATE VIRTUAL DUMP        */ 01296000
         B     PTERM                                               0614 01297000
*                                                                  0615 01298000
*   /*****************************************************************/ 01299000
*   /*                                                               */ 01300000
*   /* THIS ROUTINE WRITES TWO TAPE MARKS (IF RUNSW=OFF) AND         */ 01301000
*   /* REWIND-UNLOADS THE TAPE FOR THE GIVEN IODB                    */ 01302000
*   /*                                                               */ 01303000
*   /*****************************************************************/ 01304000
*                                                                  0615 01305000
*/* D (YES,RUNONLY,NO,) IS TAPE ONLY TO BE UNLOADED?                 */ 01306000
*/*%AGAIN: L TERERI: ISSUE WTM, WTM, RUN CCW CHAIN                   */ 01307000
*/* D (NO,,YES,%OUT) I/O OKAY?                                       */ 01308000
*/* D (YES,,NO,%AGAIN) RETRIED 2 TIMES?                              */ 01309000
*/* L AMDSACON: ISSUE MESSAGE AMD032I                                */ 01310000
*/* R RETURN CODE 4                                                  */ 01311000
*/*%OUT: D (YES,%SKIP,NO,) DID TAPE UNLOAD?                          */ 01312000
*/* L TERERI: ISSUE REWIND UNLOAD CCW                                */ 01313000
*/*%SKIP: D (YES,,NO,%OUT2) IS UNIT CHECK ON FROM UNLOAD?            */ 01314000
*/* L TERERI: ISSUE SENSE TO CLEAR UNIT CHECK                        */ 01315000
*/*%OUT2: R RETURN CODE 0                                            */ 01316000
*                                                                  0615 01317000
*TERWTM:                                                           0615 01318000
*   PROC;                                                          0615 01319000
TERWTM   STM   @14,@12,@SA00002                                    0615 01320000
*   RESPECIFY CSW BASED(ADDR(FLCCSW));                             0616 01321000
*   RESPECIFY R11 RESTRICTED;                                      0617 01322000
*   IF RUNSW = ON THEN              /* IS CALL ONLY TO REWIND UNLOAD    01323000
*                                      TAPE                          */ 01324000
         TM    RUNSW,B'10000000'                                   0618 01325000
         BO    @RT00618                                            0618 01326000
*     GO TO RUNONLY;                                               0619 01327000
*   R11 = ADDR(EORCCW);             /* SET UP TO WTM,REWIND UNLOAD   */ 01328000
         LA    R11,EORCCW                                          0620 01329000
*   CALL TERERI;                    /* TAKE CARE OF OLD TAPE         */ 01330000
         BAL   @14,TERERI                                          0621 01331000
*   DO I = 2 TO 1 BY -1 WHILE CSWPGC = ON | CSWPTC = ON | CSWCDC = ON   01332000
*           | CSWCCC = ON | CSWICC = ON | CSWCHC = ON;             0622 01333000
         LA    I,2                                                 0622 01334000
@DL00622 LA    @10,FLCCSW                                          0622 01335000
         TM    CSWPGC(@10),B'00111111'                             0622 01336000
         BZ    @DC00622                                            0622 01337000
*     R11 = ADDR(WTMERR);           /* SET UP TO ISSUE WTM, RECOVERY */ 01338000
         LA    R11,WTMERR                                          0623 01339000
*     CALL TERERI;                  /* RETRY TO ISSUE WTM            */ 01340000
         BAL   @14,TERERI                                          0624 01341000
*   END;                                                           0625 01342000
         BCTR  I,0                                                 0625 01343000
         LTR   I,I                                                 0625 01344000
         BP    @DL00622                                            0625 01345000
@DC00622 DS    0H                                                  0626 01346000
*   CCWTEMP = CSWCADDR - LENGTH(CCW); /* SET POINTER FOR CCW ADDR    */ 01347000
         LA    @10,FLCCSW                                          0626 01348000
         L     CCWTEMP,CSWCADDR-1(,@10)                            0626 01349000
         LA    CCWTEMP,0(,CCWTEMP)                                 0626 01350000
         SL    CCWTEMP,@CF00036                                    0626 01351000
*   IF I = ZERO THEN                                               0627 01352000
         LTR   I,I                                                 0627 01353000
         BNZ   @RF00627                                            0627 01354000
*     DO;                           /* IF RECOVERY IS NOT SUCCESSFUL    01355000
*                                      - ISSUE MSG                   */ 01356000
*       RESPECIFY R1 RESTRICTED;                                   0629 01357000
*       R1 = AMD032I;               /* SET UP MESSAGE IDENTIFIER     */ 01358000
         LA    R1,32                                               0630 01359000
*       SVC (CONSVC);               /* ISSUE CONSOLE MESSAGE         */ 01360000
         SVC   3                                                   0631 01361000
*       RESPECIFY R1 UNRESTRICTED;                                 0632 01362000
*       RETURN CODE(4);             /* RETURN ERROR                  */ 01363000
         LA    @15,4                                               0633 01364000
         L     @14,@SA00002                                        0633 01365000
         LM    @00,@12,@SA00002+8                                  0633 01366000
         BR    @14                                                 0633 01367000
*     END;                                                         0634 01368000
*   IF CCWTEMP -> CCWCMD ^= RWUNLOAD THEN                          0635 01369000
@RF00627 CLI   CCWCMD(CCWTEMP),15                                  0635 01370000
         BE    @RF00635                                            0635 01371000
*     DO;                           /* IF CHAIN BREAKS DUE TO UNIT 0636 01372000
*                                      EXCEPTION                     */ 01373000
*                                                                  0636 01374000
*RUNONLY:                                                          0637 01375000
*       R11 = ADDR(REWUNLD);        /* RESTART ON REWIND-UNLOAD      */ 01376000
RUNONLY  LA    R11,REWUNLD                                         0637 01377000
*       CALL TERERI;                /* ISSUE I/O                     */ 01378000
         BAL   @14,TERERI                                          0638 01379000
*     END;                                                         0639 01380000
*   RESPECIFY R11 UNRESTRICTED;                                    0640 01381000
@RF00635 DS    0H                                                  0641 01382000
*   IF CSWUC = ON THEN              /* MUST A SENSE BE ISSUED TO   0641 01383000
*                                      CLEAR THE CHANNEL             */ 01384000
         LA    @10,FLCCSW                                          0641 01385000
         TM    CSWUC(@10),B'00000010'                              0641 01386000
         BNO   @RF00641                                            0641 01387000
*     DO;                                                          0642 01388000
*       RESPECIFY R11 RESTRICTED;                                  0643 01389000
*       R11 = ADDR(SENSCCW);        /* SET ADDR OF SENSE COMMAND     */ 01390000
         LA    R11,SENSCCW                                         0644 01391000
*       CALL TERERI;                /* ISSUE SENSE                   */ 01392000
         BAL   @14,TERERI                                          0645 01393000
*       RESPECIFY R11 UNRESTRICTED;                                0646 01394000
*     END;                                                         0647 01395000
*   RETURN CODE(0);                 /* RETURN WITH TM WRITTEN AND  0648 01396000
*                                      UNLOADED                      */ 01397000
@RF00641 SLR   @15,@15                                             0648 01398000
         L     @14,@SA00002                                        0648 01399000
         LM    @00,@12,@SA00002+8                                  0648 01400000
         BR    @14                                                 0648 01401000
*   RESPECIFY CSW BASED(ADDR(IODBCSW));                            0649 01402000
*   END TERWTM;                                                    0650 01403000
*                                                                  0651 01404000
*   /*****************************************************************/ 01405000
*   /*                                                               */ 01406000
*   /* THIS SECTION CONTAINS THE SVC INTERFACE ENTRY POINTS TO THE   */ 01407000
*   /* SUBROUTINE FUNCTIONS LOCATED IN AMDSATER                      */ 01408000
*   /*                                                               */ 01409000
*   /*****************************************************************/ 01410000
*                                                                  0651 01411000
*                                                                  0651 01412000
*   /*****************************************************************/ 01413000
*   /*                                                               */ 01414000
*   /* THE FIRST ENTRY POINT IS FOR SVC ENTRY TO AMDSAERM - THE ERROR*/ 01415000
*   /* MESSAGE MODULE                                                */ 01416000
*   /*                                                               */ 01417000
*   /*****************************************************************/ 01418000
*                                                                  0651 01419000
*/*AMDSAERM: E SVC 27 ENTRY                                          */ 01420000
*/* L CALL TERERM                                                    */ 01421000
*/* R RETURN TO CALLER                                               */ 01422000
*   RESPECIFY RETCODE RESTRICTED;                                  0651 01423000
*                                                                  0651 01424000
*AMDSAERM:                                                         0652 01425000
*   ENTRY;                                                         0652 01426000
@EP00652 DS    0H                                                  0653 01427000
*   CCTREG = CCTADDR;               /* SET UP ADDRESSABILITY TO CCT  */ 01428000
         L     CCTREG,@CF00727                                     0653 01429000
*   CALL TERERM;                    /* USE THE ERM MESSAGE ROUTINE 0654 01430000
*                                      FOR PROCESSING                */ 01431000
         BAL   @14,TERERM                                          0654 01432000
*   GO TO COMRET;                   /* USE COMMON RETURN             */ 01433000
*                                                                  0655 01434000
         B     COMRET                                              0655 01435000
*   /*****************************************************************/ 01436000
*   /*                                                               */ 01437000
*   /* THE NEXT ENTRY IS FOR THE ERROR RECOVERY INTERFACE FUNCTION   */ 01438000
*   /* WHICH USED DUMPSIO AS A SUBROUTINE TO PERFORM I/O ERROR       */ 01439000
*   /* RECOVERY FUNCTIONS                                            */ 01440000
*   /*                                                               */ 01441000
*   /*****************************************************************/ 01442000
*                                                                  0656 01443000
*/*AMDSAERI: ENTRY VIA SVC 23                                        */ 01444000
*/* L CALL TERERI                                                    */ 01445000
*/* R RETURN TO CALLER                                               */ 01446000
*                                                                  0656 01447000
*AMDSAERI:                                                         0656 01448000
*   ENTRY;                                                         0656 01449000
@EP00656 DS    0H                                                  0657 01450000
*   CCTREG = CCTADDR;               /* SET UP ADDRESSABILITY TO CCT  */ 01451000
         L     CCTREG,@CF00727                                     0657 01452000
*   CALL TERERI;                    /* USE THE ERI SUBROUTINE IN TER */ 01453000
         BAL   @14,TERERI                                          0658 01454000
*   GO TO COMRET;                   /* USE COMMON RETURN             */ 01455000
         B     COMRET                                              0659 01456000
*                                                                  0660 01457000
*   /*****************************************************************/ 01458000
*   /*                                                               */ 01459000
*   /* THE NEXT ROUTINE IS THE ERROR RECOVERY PROCESSOR WHICH SAVES  */ 01460000
*   /* THE STATUS OF I/O AND IS USED TO RETRY ERROR RECOVERY         */ 01461000
*   /*                                                               */ 01462000
*   /*****************************************************************/ 01463000
*                                                                  0660 01464000
*/*AMDSAERP: E SVC 21 ENTRY                                          */ 01465000
*/* L CALL TERERP                                                    */ 01466000
*/* R RETURN TO CALLER                                               */ 01467000
*                                                                  0660 01468000
*AMDSAERP:                                                         0660 01469000
*   ENTRY;                                                         0660 01470000
@EP00660 DS    0H                                                  0661 01471000
*   CCTREG = CCTADDR;               /* SET UP ADDRESSABILITY TO CCT  */ 01472000
         L     CCTREG,@CF00727                                     0661 01473000
*   CALL TERERP;                    /* USE THE ERP SUBROUTINE IN TER */ 01474000
         BAL   @14,TERERP                                          0662 01475000
*   GO TO COMRET;                   /* USE COMMON RETURN             */ 01476000
*                                                                  0663 01477000
         B     COMRET                                              0663 01478000
*   /*****************************************************************/ 01479000
*   /*                                                               */ 01480000
*   /* NEXT IS THE INTERVENTION REQUIRED INTERFACE ROUTINE - INR     */ 01481000
*   /*                                                               */ 01482000
*   /*****************************************************************/ 01483000
*                                                                  0664 01484000
*/*AMDSAINR: E SVC 29 ENTRY                                          */ 01485000
*/* L CALL TERINR                                                    */ 01486000
*/* R RETURN TO CALLER                                               */ 01487000
*                                                                  0664 01488000
*AMDSAINR:                                                         0664 01489000
*   ENTRY;                                                         0664 01490000
@EP00664 DS    0H                                                  0665 01491000
*   CCTREG = CCTADDR;               /* SET UP ADDRESSABILITY TO CCT  */ 01492000
         L     CCTREG,@CF00727                                     0665 01493000
*   CALL TERINR;                    /* USE THE INTERVENTION REQUIRED    01494000
*                                      SUBROUTINE IN TER             */ 01495000
         BAL   @14,TERINR                                          0666 01496000
*   GO TO COMRET;                   /* USE COMMON RETURN             */ 01497000
*                                                                  0667 01498000
         B     COMRET                                              0667 01499000
*   /*****************************************************************/ 01500000
*   /*                                                               */ 01501000
*   /* FINALLY IS THE ERROR RECOVERY BLOCK PROCESSOR ROUTINE WHICH   */ 01502000
*   /* USES THE ERB ROUTINE IN TER                                   */ 01503000
*   /*                                                               */ 01504000
*   /*****************************************************************/ 01505000
*                                                                  0668 01506000
*/*AMDSAERB: E SVC 20 ENTRY                                          */ 01507000
*/* L CALL TERERB                                                    */ 01508000
*/* R RETURN TO CALLER                                               */ 01509000
*                                                                  0668 01510000
*AMDSAERB:                                                         0668 01511000
*   ENTRY;                                                         0668 01512000
@EP00668 DS    0H                                                  0669 01513000
*   CCTREG = CCTADDR;               /* SET UP ADDRESSABILITY TO CCT  */ 01514000
         L     CCTREG,@CF00727                                     0669 01515000
*   CALL TERERB;                    /* USE THE ERB ROUTINE           */ 01516000
*                                                                  0670 01517000
         BAL   @14,TERERB                                          0670 01518000
*COMRET:                                                           0671 01519000
*   RETURN CODE(RETCODE);                                          0671 01520000
COMRET   L     @13,4(,@13)                                         0671 01521000
         L     @14,12(,@13)                                        0671 01522000
         LM    @00,@12,20(@13)                                     0671 01523000
         BR    @14                                                 0671 01524000
*   RESPECIFY RETCODE UNRESTRICTED;                                0672 01525000
*                                                                  0673 01526000
*   /*****************************************************************/ 01527000
*   /*                                                               */ 01528000
*   /* THIS IS THE ERROR MESSAGE ROUTINE WHICH IS ENTERED BY BOTH    */ 01529000
*   /* AMDSATER AND AMDSADER. IT IS A SELF SUFFICIENT ROUTINE WHICH  */ 01530000
*   /* OUTPUTS AN ERROR MESSAGE ON THE CONSOLE                       */ 01531000
*   /*                                                               */ 01532000
*   /*****************************************************************/ 01533000
*                                                                  0673 01534000
*/*TERERM: E ENTRY                                                   */ 01535000
*/* P SAVE CALLER'S REGISTERS                                        */ 01536000
*/*GETMSG: P OBTAIN MESSAGE FROM MSGTAB                              */ 01537000
*/* D (YES,MOVETXT,NO,) MSG IN TABLE ?                               */ 01538000
*/* P (,GETMSG) MSG ID = 29                                          */ 01539000
*/*MOVETXT: P MOVE MSG TEXT INTO COND33I                             */ 01540000
*                                                                  0673 01541000
*TERERM:                                                           0673 01542000
*   PROC;                                                          0673 01543000
TERERM   STM   @14,@12,@SA00003                                    0673 01544000
*   RESPECIFY R1 RESTRICTED;                                       0674 01545000
*   GEN;                                                           0675 01546000
*   ERBSAVE = ERBS;                 /* SAVE ERB-S WHICH ARE CLEARED     01547000
*                                      BY THE CALL TO CON            */ 01548000
         MVC   ERBSAVE(8),ERBS(CCTREG)                             0676 01549000
*   IF R1 > MAXID THEN                                             0677 01550000
         C     R1,@CF00867                                         0677 01551000
         BNH   @RF00677                                            0677 01552000
*     R1 = MSGUNK;                                                 0678 01553000
         LA    R1,29                                               0678 01554000
*   MSGADDR = MSGTAB(R1 + 1);       /* OBTAIN MSG TEXT               */ 01555000
@RF00677 LR    @10,R1                                              0679 01556000
         SLA   @10,2                                               0679 01557000
         L     @04,@CA00981                                        0679 01558000
         L     MSGADDR,MSGTAB-MSGTAB(@10,@04)                      0679 01559000
*   R1 =ADDR(CVTBLK);               /* SET UP CONVERT PARAMETER LIST */ 01560000
         LA    R1,CVTBLK                                           0680 01561000
*   COND33I = MSGTXT(1:MSGLNGTH);   /* MOVE IN VARIABLE MSG LENGTH   */ 01562000
         L     @10,@CA01087                                        0681 01563000
         MVI   COND33I-COND33I+1(@10),C' '                         0681 01564000
         MVC   COND33I-COND33I+2(22,@10),COND33I-COND33I+1(@10)    0681 01565000
         SLR   @07,@07                                             0681 01566000
         IC    @07,MSGLNGTH(,MSGADDR)                              0681 01567000
         BCTR  @07,0                                               0681 01568000
         EX    @07,@SM01247                                        0681 01569000
*   LNG33I = MSGLNGTH;              /* SET SECONDARY MESSAGE LENGTH  */ 01570000
*                                                                  0682 01571000
         L     @10,@CA01091                                        0682 01572000
         MVC   LNG33I-LNG33I(1,@10),MSGLNGTH(MSGADDR)              0682 01573000
*   /*****************************************************************/ 01574000
*   /*                                                               */ 01575000
*   /* FILL IN THE REMAINDER OF MSG 33I WITH CSW DATA, CMD CODE , AND*/ 01576000
*   /* DEVICE ADDRESS                                                */ 01577000
*   /*                                                               */ 01578000
*   /*****************************************************************/ 01579000
*                                                                  0683 01580000
*/* D (YES,CSWOUT,NO,CSWBLNKS) CSW DATA ?                            */ 01581000
*/*CSWBLNKS: P (,CMDCONV) STATCSW = NONE                             */ 01582000
*/*CSWOUT: S AMDSABIN:SVC 28 CONVERT CSW TO EBCDIC                   */ 01583000
*/* P STAT33I = CONVERTED CSW                                        */ 01584000
*/*CMDCONV: S AMDSABIN:SVC 28 CONVERT COMMAND CODE                   */ 01585000
*/* P CMD33I = COMMAND CCW AT TIME OF ERROR                          */ 01586000
*/* S AMDSABIN:SVC 28 CONVERT DEVICE ADDRESS FROM IODBDEV            */ 01587000
*/* P DEV33I = CONVERTED DEVICE ADDRESS                              */ 01588000
*/* L AMDSACON: ISSUE SVC 3 TO ISSUE MESSAGE AMD033I                 */ 01589000
*/* D (YES,,NO,RETURN) MESSAGE ISSUED ?                              */ 01590000
*   IF MSGSTAT=ON THEN                                             0683 01591000
         TM    MSGSTAT(MSGADDR),B'10000000'                        0683 01592000
         BNO   @RF00683                                            0683 01593000
*     DO;                           /* IF CSW DATA CONVERT CSW TO  0684 01594000
*                                      EBCDIC                        */ 01595000
*       RESPECIFY CSW BASED (ADDR(IODBCSW));                       0685 01596000
*       CVTBINA = ADDR(CSWUSTAT);   /* CSW ADDRESS                   */ 01597000
         LA    @10,CSWUSTAT+24(,IODBREG)                           0686 01598000
         ST    @10,CVTBINA                                         0686 01599000
*       CVTEBCA = (ADDR(STAT33I));  /* MSG SLOT                      */ 01600000
         L     @10,@CA01088                                        0687 01601000
         ST    @10,CVTEBCA                                         0687 01602000
*       CVTINL = TWO;               /* LENGTH OF CSW                 */ 01603000
         MVC   CVTINL(2),@CH00108                                  0688 01604000
*       SVC (BINSVC);               /* CONVERT CSW TO EBCDIC         */ 01605000
         SVC   28                                                  0689 01606000
*     END;                                                         0690 01607000
*   ELSE                                                           0691 01608000
*     STAT33I = NONE;               /* NO CSW DATA                   */ 01609000
         B     @RC00683                                            0691 01610000
@RF00683 L     @10,@CA01088                                        0691 01611000
         MVC   STAT33I-STAT33I(4,@10),NONE                         0691 01612000
*   IF CSWCADDR = 0 | CSWCADDR = IODBCAW THEN                      0692 01613000
@RC00683 L     @10,CSWCADDR+23(,IODBREG)                           0692 01614000
         LA    @10,0(,@10)                                         0692 01615000
         LTR   @10,@10                                             0692 01616000
         BZ    @RT00692                                            0692 01617000
         C     @10,IODBCAW(,IODBREG)                               0692 01618000
         BNE   @RF00692                                            0692 01619000
@RT00692 DS    0H                                                  0693 01620000
*     CVTBINA = IODBCAW;            /* IF CSW CCW IS ZERO OR NOT   0693 01621000
*                                      UPDATED ON EXECUTION OF THE 0693 01622000
*                                      COMMAND, USE IODBCAW          */ 01623000
         L     @10,IODBCAW(,IODBREG)                               0693 01624000
         ST    @10,CVTBINA                                         0693 01625000
*   ELSE                                                           0694 01626000
*     CVTBINA = CSWCADDR - LENGTH(CCW); /* USE CSW CCW MINUS 8 FOR 0694 01627000
*                                      FAILING CCW ADDRESS           */ 01628000
         B     @RC00692                                            0694 01629000
@RF00692 L     @10,CSWCADDR+23(,IODBREG)                           0694 01630000
         LA    @10,0(,@10)                                         0694 01631000
         SL    @10,@CF00036                                        0694 01632000
         ST    @10,CVTBINA                                         0694 01633000
*   IF CVTBINA -> CCWCMD = DATCHAIN THEN /* IS THIS CMD DATA CHIANED */ 01634000
@RC00692 L     @10,CVTBINA                                         0695 01635000
         CLI   CCWCMD(@10),255                                     0695 01636000
         BNE   @RF00695                                            0695 01637000
*      CVTBINA = CVTBINA - LENGTH(CCW); /* BACK TO BEGINNING CCW     */ 01638000
         SL    @10,@CF00036                                        0696 01639000
         ST    @10,CVTBINA                                         0696 01640000
*   CVTEBCA = (ADDR(CMD33I));       /* OUTPUT AREA ADDRESS IN MSG  0697 01641000
*                                      TEXT                          */ 01642000
@RF00695 L     @10,@CA01089                                        0697 01643000
         ST    @10,CVTEBCA                                         0697 01644000
*   CVTINL = 1;                     /* 1 BYTE CMD CODE               */ 01645000
         MVC   CVTINL(2),@CH00067                                  0698 01646000
*   SVC (BINSVC);                   /* CONVERT CMD CODE              */ 01647000
         SVC   28                                                  0699 01648000
*   CVTBINA = ADDR(IODBDEV);        /* DEVICE ADDRESS TO CONVERT     */ 01649000
         LA    @10,IODBDEV(,IODBREG)                               0700 01650000
         ST    @10,CVTBINA                                         0700 01651000
*   CVTEBCA = ADDR(CONVAREA);       /* CONVERT AREA LOCATION         */ 01652000
         LA    @10,CONVAREA                                        0701 01653000
         ST    @10,CVTEBCA                                         0701 01654000
*   CVTINL = TWO;                   /* BYTES TO BE CONVERTED         */ 01655000
         MVC   CVTINL(2),@CH00108                                  0702 01656000
*   SVC (BINSVC);                   /* CONVERT DDD                   */ 01657000
         SVC   28                                                  0703 01658000
*   DEV33I = CONVAREA(2:4);         /* MOVE DDD INTO MSG TEXT        */ 01659000
         L     @10,@CA01090                                        0704 01660000
         MVC   DEV33I-DEV33I(3,@10),CONVAREA+1                     0704 01661000
*   R1 = AMD033I;                   /* I/O ERROR MESSAGE ID          */ 01662000
         LA    R1,33                                               0705 01663000
*   SVC (CONSVC);                   /* ISSUE MSG AMD033I             */ 01664000
         SVC   3                                                   0706 01665000
*   RESPECIFY RETCODE RESTRICTED;                                  0707 01666000
*   IF RETCODE = ZERO THEN                                         0708 01667000
         LTR   RETCODE,RETCODE                                     0708 01668000
         BNZ   @RF00708                                            0708 01669000
*     DO;                           /* MSG OUTPUTTED - CONTINUE      */ 01670000
*       RESPECIFY RETCODE UNRESTRICTED;                            0710 01671000
*                                                                  0710 01672000
*   /*****************************************************************/ 01673000
*   /*                                                               */ 01674000
*   /* THIS SECTION OUTPUTS THE SENSE DATA FOR MESSAGE AMD034I       */ 01675000
*   /*                                                               */ 01676000
*   /*****************************************************************/ 01677000
*                                                                  0711 01678000
*/* D (YES,,NO,RETURN) ANY SENSE DATA ?                              */ 01679000
*/* P CTMSGOUT = 1                                                   */ 01680000
*/* S AMDSABIN:SVC 28 TO CONVERT SENSE DATA TO EBCDIC                */ 01681000
*/* P MOVE SENSE DATA INTO SENS34I                                   */ 01682000
*/* L AMDSACON: SVC 3 TO ISSUE AMD034I                               */ 01683000
*/*RETURN: P RESTORE CALLER'S REGISTERS                              */ 01684000
*/* R RETURN TO CALLER                                               */ 01685000
*/*TERERM: END                                                       */ 01686000
*       IF MSGSENS = ON & IODBSENS ^= NULL THEN                    0711 01687000
         TM    MSGSENS(MSGADDR),B'01000000'                        0711 01688000
         BNO   @RF00711                                            0711 01689000
         CLC   IODBSENS(24,IODBREG),NULL                           0711 01690000
         BE    @RF00711                                            0711 01691000
*         DO;                       /* SENSE DATA RO OUTPUT          */ 01692000
*           CTMSGOUT = ON;          /* DEPENDENT MSG                 */ 01693000
         OI    CTMSGOUT(CCTREG),B'10000000'                        0713 01694000
*           CVTBINA = ADDR(IODBSENS); /* LOCATION OF SENSE DATA      */ 01695000
         LA    @10,IODBSENS(,IODBREG)                              0714 01696000
         ST    @10,CVTBINA                                         0714 01697000
*           CVTEBCA = ADDR(SENS34I); /* OUTPUT AREA IN MESSAGE       */ 01698000
         L     @10,@CA01092                                        0715 01699000
         ST    @10,CVTEBCA                                         0715 01700000
*           CVTINL = 24;            /* LENGTH OF SENSE DATA          */ 01701000
         MVC   CVTINL(2),@CH00089                                  0716 01702000
*           R1 = ADDR(CVTBLK);      /* CVT PARAMETTER LIST ADDRESS   */ 01703000
         LA    R1,CVTBLK                                           0717 01704000
*           SVC (BINSVC);           /* CONVERT SENSE TO EBCDIC       */ 01705000
         SVC   28                                                  0718 01706000
*           R1 = AMD034I;           /* MSG ID                        */ 01707000
         LA    R1,34                                               0719 01708000
*           SVC (CONSVC);           /* ISSUE SENSE MSG               */ 01709000
         SVC   3                                                   0720 01710000
*         END;                                                     0721 01711000
*     END;                                                         0722 01712000
@RF00711 DS    0H                                                  0723 01713000
*   ERBS = ERBSAVE;                 /* RESTORE ERB-S                 */ 01714000
@RF00708 MVC   ERBS(8,CCTREG),ERBSAVE                              0723 01715000
*   END TERERM;                     /* RETURN                        */ 01716000
@EL00003 DS    0H                                                  0724 01717000
@EF00003 DS    0H                                                  0724 01718000
@ER00003 LM    @14,@12,@SA00003                                    0724 01719000
         BR    @14                                                 0724 01720000
*                                                                  0725 01721000
*   /*****************************************************************/ 01722000
*   /*                                                               */ 01723000
*   /* THIS SUBROUTINE RETRIES I/O ERRORS AND RESTARTS I/O TO THE    */ 01724000
*   /* OUTPUT DEVICE. THIS ROUTINE ISSUES ITS OWN TIO AND SIO THEN   */ 01725000
*   /* WAITS FOR DEVICE END OR PCI                                   */ 01726000
*   /*                                                               */ 01727000
*   /*****************************************************************/ 01728000
*                                                                  0725 01729000
*/*TERERI: E ERROR RECOVERY MODULE                                   */ 01730000
*/* P SAVE REGISTERS IN CALLER'S SAVE AREA                           */ 01731000
*/* L AMDSATAP: SVC 2 ENTER PROPER CPU                               */ 01732000
*/* D (YES,,NO,ERROR8) ON PROPER CPU ?                               */ 01733000
*/*TIO1: I TIO FOR IODBDEV                                           */ 01734000
*/* D (YES,TIO1,NO,) BUSY                                            */ 01735000
*/* D (YES,SIO,NO,) AVAILABLE                                        */ 01736000
*/* D (YES,ERROR,NO,) NOT OPERATIONAL                                */ 01737000
*/* D (YES,TIO1,NO,) CSW STORED - UNIT CHECK ON                      */ 01738000
*/* D (NO,ERROR,YES,) SENSE BEING ISSUED                             */ 01739000
*/* SIO: P SET CAW                                                   */ 01740000
*/* I SIO FOR IODBDEV                                                */ 01741000
*/* D (YES,TIO1,NO,) BUSY OR NOT OPERATIONAL                         */ 01742000
*/* D (YES,TIO2,NO,) SIO BEGIN?                                      */ 01743000
*/* D (YES,TIO1,NO,CHECK) CSW STORED - CSW BUSY                      */ 01744000
*/* TIO2: I TIO FOR IODBDEV                                          */ 01745000
*/* D (YES,TIO2,NO,) BUSY                                            */ 01746000
*/*CHECK: D (YES,,NO,%ERIA) ERROR IN CSW                             */ 01747000
*/*ERROR: R RETURN CODE 4                                            */ 01748000
*/*%ERIA: D (YES,,NO,TIO2) DEVICE END OR PCI                         */ 01749000
*/* R RETURN TO CALLER                                               */ 01750000
*/*TERERI: END                                                       */ 01751000
*                                                                  0725 01752000
*TERERI:                                                           0725 01753000
*   PROC OPTIONS(SAVEAREA);                                        0725 01754000
TERERI   STM   @14,@12,12(@13)                                     0725 01755000
         ST    @13,@SA00004+4                                      0725 01756000
         LA    @14,@SA00004                                        0725 01757000
         ST    @14,8(,@13)                                         0725 01758000
         LR    @13,@14                                             0725 01759000
*   RESPECIFY R11 RESTRICTED;                                      0726 01760000
*   SAVECTIO = CTIOTYPE;            /* SAVE FIELD                    */ 01761000
         MVC   SAVECTIO(1),CTIOTYPE(CCTREG)                        0727 01762000
*   CTIOTYPE = ZERO;                /* RESET CTIOTYPE                */ 01763000
         MVI   CTIOTYPE(CCTREG),X'00'                              0728 01764000
*   IF IODBREG = ADDR(IODBDA) THEN                                 0729 01765000
         L     @10,@CA01084                                        0729 01766000
         CR    IODBREG,@10                                         0729 01767000
         BNE   @RF00729                                            0729 01768000
*     CTIODA = ON;                  /* IF DA SET DA SWITCH FOR TAP   */ 01769000
         OI    CTIODA(CCTREG),B'00100000'                          0730 01770000
*   ELSE                                                           0731 01771000
*     IF IODBREG = ADDR(IODBWORK) THEN                             0731 01772000
         B     @RC00729                                            0731 01773000
@RF00729 L     @10,@CA01085                                        0731 01774000
         CR    IODBREG,@10                                         0731 01775000
         BNE   @RF00731                                            0731 01776000
*       CTIOWK = ON;                /* IF WORKFILE SET TAP INDICATOR */ 01777000
         OI    CTIOWK(CCTREG),B'00010000'                          0732 01778000
*     ELSE                                                         0733 01779000
*       CTIOOUT = ON;               /* IF OUTPUT SET TAP INDICATOR   */ 01780000
         B     @RC00731                                            0733 01781000
@RF00731 OI    CTIOOUT(CCTREG),B'01000000'                         0733 01782000
*   SVC (TAPSVC);                   /* GET ON PROPER CPU             */ 01783000
@RC00731 DS    0H                                                  0734 01784000
@RC00729 SVC   2                                                   0734 01785000
*   CTIOTYPE = SAVECTIO;            /* RESTORE FIELD                 */ 01786000
         MVC   CTIOTYPE(1,CCTREG),SAVECTIO                         0735 01787000
*   RESPECIFY RETCODE RESTRICTED;                                  0736 01788000
*   IF RETCODE ^= ZERO THEN                                        0737 01789000
         LTR   RETCODE,RETCODE                                     0737 01790000
         BZ    @RF00737                                            0737 01791000
*     RETURN CODE(4);               /* NOT ON PROPER CPU - SEND ERROR   01792000
*                                      RETURN CODE                   */ 01793000
         LA    @15,4                                               0738 01794000
         L     @13,4(,@13)                                         0738 01795000
         L     @14,12(,@13)                                        0738 01796000
         LM    @00,@12,20(@13)                                     0738 01797000
         BR    @14                                                 0738 01798000
*   RESPECIFY RETCODE UNRESTRICTED;                                0739 01799000
@RF00737 DS    0H                                                  0740 01800000
*   RESPECIFY CSW BASED(ADDR(FLCCSW));                             0740 01801000
*   CSW = CSW && CSW;               /* CLEAR CSW                     */ 01802000
*                                                                  0741 01803000
         LA    @10,FLCCSW                                          0741 01804000
         XC    CSW(8,@10),CSW(@10)                                 0741 01805000
*TIO1:                                                             0742 01806000
*   TIO(IODBDEV);                   /* WAIT FOR AVAILABLE            */ 01807000
TIO1     LH    @10,IODBDEV(,IODBREG)                               0742 01808000
         TIO   0(@10)                                              0742 01809000
*   BC(2,TIO1);                     /* LOOP IF BUSY                  */ 01810000
         BC    2,TIO1                                              0743 01811000
*   BC(8,SIO1);                     /* OKAY--SIO                     */ 01812000
         BC    8,SIO1                                              0744 01813000
*   BC(1,ERROR);                    /* RETURN ERROR IF NOT         0745 01814000
*                                      OPERATIONAL                   */ 01815000
         BC    1,ERROR                                             0745 01816000
*   IF CSWUC = OFF THEN             /* CSW STORED                    */ 01817000
         LA    @10,FLCCSW                                          0746 01818000
         TM    CSWUC(@10),B'00000010'                              0746 01819000
         BZ    @RT00746                                            0746 01820000
*     GO TO TIO1;                   /* UNLESS UNIT CHECK IS ON, WAIT    01821000
*                                      FOR AVAILABLE                 */ 01822000
*   IF R11 -> CCWCMD ^= SENSCMD THEN /* IS A SENSE BEING ISSUED      */ 01823000
         CLI   CCWCMD(R11),4                                       0748 01824000
         BNE   @RT00748                                            0748 01825000
*     GO TO ERROR;                  /* NO--TREAT AS ERROR            */ 01826000
*                                                                  0749 01827000
*SIO1:                                                             0750 01828000
*   FLCCAW = R11;                   /* SET CAW                       */ 01829000
SIO1     ST    R11,FLCCAW                                          0750 01830000
*   SIO(IODBDEV);                   /* ISSUE SIO                     */ 01831000
         LH    @10,IODBDEV(,IODBREG)                               0751 01832000
         SIO   0(@10)                                              0751 01833000
*   BC(2,TIO1);                     /* BUSY--GO BACK AND WAIT        */ 01834000
         BC    2,TIO1                                              0752 01835000
*   BC(9,TIO2);                     /* SIO WENT--WAIT FOR CSW        */ 01836000
         BC    9,TIO2                                              0753 01837000
*   IF CSWBUSY = ON THEN            /* CSW STORED--BUSY              */ 01838000
         LA    @10,FLCCSW                                          0754 01839000
         TM    CSWBUSY(@10),B'00010000'                            0754 01840000
         BO    @RT00754                                            0754 01841000
*     GO TO TIO1;                   /* LOOP BACK TO WAIT             */ 01842000
*   GO TO CHECK;                    /* NOW CHECK STORED CSW          */ 01843000
*                                                                  0756 01844000
         B     CHECK                                               0756 01845000
*TIO2:                                                             0757 01846000
*   TIO(IODBDEV);                   /* WAIT FOR OPERATION TO COMPLETE*/ 01847000
TIO2     LH    @10,IODBDEV(,IODBREG)                               0757 01848000
         TIO   0(@10)                                              0757 01849000
*   BC(2,TIO2);                     /* LOOP IF BUSY                  */ 01850000
*                                                                  0758 01851000
         BC    2,TIO2                                              0758 01852000
*CHECK:                                                            0759 01853000
*   IF CSWPGC = ON | CSWPTC = ON | CSWCDC = ON | CSWCCC = ON | CSWICC   01854000
*         = ON | CSWCHC = ON | CSWUC = ON | CSWUE = ON | CSWATTN = ON   01855000
*           THEN                    /* ERROR ON SIO                  */ 01856000
*                                                                  0759 01857000
CHECK    LA    @10,FLCCSW                                          0759 01858000
         TM    CSWPGC(@10),B'00111111'                             0759 01859000
         BNZ   @RT00759                                            0759 01860000
         TM    CSWUC(@10),B'10000011'                              0759 01861000
         BZ    @RF00759                                            0759 01862000
@RT00759 DS    0H                                                  0760 01863000
*ERROR:                                                            0760 01864000
*     RETURN CODE(4);                                              0760 01865000
ERROR    LA    @15,4                                               0760 01866000
         L     @13,4(,@13)                                         0760 01867000
         L     @14,12(,@13)                                        0760 01868000
         LM    @00,@12,20(@13)                                     0760 01869000
         BR    @14                                                 0760 01870000
*   IF CSWDE = OFF & CSWPCI = OFF THEN /* INTERMEDIATE CSW STORED    */ 01871000
@RF00759 LA    @10,FLCCSW                                          0761 01872000
         TM    CSWDE(@10),B'00000100'                              0761 01873000
         BNZ   @RF00761                                            0761 01874000
         TM    CSWPCI(@10),B'10000000'                             0761 01875000
         BZ    @RT00761                                            0761 01876000
*     GO TO TIO2;                   /* GO BACK AND WAIT FOR DEVICE 0762 01877000
*                                      END OR PCI                    */ 01878000
*   IF CSWDE = OFF THEN             /* IS AN INTERRUPT STILL       0763 01879000
*                                      OUTSTANDING                   */ 01880000
@RF00761 LA    @10,FLCCSW                                          0763 01881000
         TM    CSWDE(@10),B'00000100'                              0763 01882000
         BNZ   @RF00763                                            0763 01883000
*     IODBACTV = ON;                /* I/O ACTIVE                    */ 01884000
         OI    IODBACTV(IODBREG),B'00000100'                       0764 01885000
*   IODBSTRT = ON;                 /* INDICATE I/O RESTARTED         */ 01886000
@RF00763 OI    IODBSTRT(IODBREG),B'00000001'                       0765 01887000
*   RETURN CODE(0);                 /* DEVICE END OR PCI--RETURN OKAY*/ 01888000
         SLR   @15,@15                                             0766 01889000
         L     @13,4(,@13)                                         0766 01890000
         L     @14,12(,@13)                                        0766 01891000
         LM    @00,@12,20(@13)                                     0766 01892000
         BR    @14                                                 0766 01893000
*     RESPECIFY CSW BASED(ADDR(IODBCSW));                   /*@ZA04263* 01894000
*   END TERERI;                                                    0768 01895000
*                                                                  0769 01896000
*   /*****************************************************************/ 01897000
*   /*                                                               */ 01898000
*   /* THIS ROUTINE IS THE ERROR RECOVERY PROCESSOR ROUTINE WHICH    */ 01899000
*   /* HANDLES ERROR RETRIES                                         */ 01900000
*   /*                                                               */ 01901000
*   /*****************************************************************/ 01902000
*                                                                  0769 01903000
*/*TERERP: E ERROR RETRY ROUTINE                                     */ 01904000
*/* P SAVE CALLER'S REGISTERS                                        */ 01905000
*/* P R11 = ADDRESS IN IODBCAW                                       */ 01906000
*/* S TERERI:RETRY OPERATION                                         */ 01907000
*/* P IODBCSW = FLCCSW                                               */ 01908000
*/* D (YES,,NO,ERPRC0) ERROR ON RETRY ?                              */ 01909000
*/* P (,ERPRET) RETURN CODE = 4                                      */ 01910000
*/*ERPRC0: P RETURN CODE = 0                                         */ 01911000
*/*ERPRET: P RESTORE CALLER'S REGISTERS                              */ 01912000
*/* R RETURN TO CALLER                                               */ 01913000
*/*TERERP: END                                                       */ 01914000
*                                                                  0769 01915000
*TERERP:                                                           0769 01916000
*   PROC;                                                          0769 01917000
TERERP   STM   @14,@12,@SA00005                                    0769 01918000
*   RESPECIFY BCT BASED (BCTADDR);                                 0770 01919000
*   RESPECIFY R11 RESTRICTED;                                      0771 01920000
*   R11 = IODBCAW;                  /* RETRY CCW ADDRESS             */ 01921000
         L     R11,IODBCAW(,IODBREG)                               0772 01922000
*   CALL TERERI;                    /* RETRY OPERATION               */ 01923000
         BAL   @14,TERERI                                          0773 01924000
*   RESPECIFY RETCODE RESTRICTED;                                  0774 01925000
*   RESPECIFY R11 UNRESTRICTED;                                    0775 01926000
*   IODBCSW = FLCCSW;               /* SAVE CSW                      */ 01927000
         MVC   IODBCSW(8,IODBREG),FLCCSW                           0776 01928000
*   RETURN CODE(RETCODE);           /* RETURN TO CALLER              */ 01929000
         L     @14,@SA00005                                        0777 01930000
         LM    @00,@12,@SA00005+8                                  0777 01931000
         BR    @14                                                 0777 01932000
*   RESPECIFY RETCODE UNRESTRICTED;                                0778 01933000
*   END TERERP;                                                    0779 01934000
*                                                                  0780 01935000
*   /*****************************************************************/ 01936000
*   /*                                                               */ 01937000
*   /* THIS ROUTINE OUTPUTS AN INPUT MESSAGE AND WAITS FOR A NEW TAPE*/ 01938000
*   /* TO BE MOUNTED                                                 */ 01939000
*   /*                                                               */ 01940000
*   /*****************************************************************/ 01941000
*                                                                  0780 01942000
*/*TERINR: E DEVICE READY RTN                                        */ 01943000
*/*INR2: L AMDSACON: SVC 3 ISSUE MESSAGE                             */ 01944000
*/* D (YES,,NO,INWAIT) MESSAGE ISSUED ?                              */ 01945000
*/* D (YES,,NO,INRTAP) IS DEVICE FOR PAGE DS                         */ 01946000
*/* L AMDSACON: ISSUE MSG AMD012D                                    */ 01947000
*/*  D (YES,,NO,%INR1) WAS REPLY I                                   */ 01948000
*/* P IODBTERM = 1                                                   */ 01949000
*/* R RETURN CODE 4                                                  */ 01950000
*/*%INR1: D (YES,,NO,%INR2) WAS REPLY G                              */ 01951000
*/* L AMDSATAP: SVC 2 GET ON PROPER CPU FOR WAIT                     */ 01952000
*/* D (YES,,NO,INWAIT) ON PROPER CPU ?                               */ 01953000
*/* P SAVE FLCINPSW AND FLCIOPSW                                     */ 01954000
*/* P SET UP FLCINPSW TO FIELD I/O INTERRUPT                         */ 01955000
*/*ENABWAIT: W ENTER ENABLED WAIT FOR I/O                            */ 01956000
*/* D (YES,,NO,ENABWAIT) FLCIOAA = IODBDEV ?                         */ 01957000
*/* P RESTORE FLCINPSW AND FLCIOPSW                                  */ 01958000
*/* P RETURN CODE = 0                                                */ 01959000
*/*INRET: R RETURN TO CALLER                                         */ 01960000
*/*INWAIT: P (,INRET) RETURN CODE = 4                                */ 01961000
*/*TERINR: END                                                       */ 01962000
*                                                                  0780 01963000
*TERINR:                                                           0780 01964000
*   PROC;                                                          0780 01965000
TERINR   STM   @14,@12,@SA00006                                    0780 01966000
*   RESPECIFY R1 RESTRICTED;                                       0781 01967000
*   GEN;                                                           0782 01968000
*   INRMSG = R1;                    /* SAVE MSG ID IN CASE OF INVALID   01969000
*                                      REPLY                         */ 01970000
*                                                                  0783 01971000
         LR    INRMSG,R1                                           0783 01972000
*INRREP:                                                           0784 01973000
*   R1 = INRMSG;                    /* RESET ORIGINAL MSG ID         */ 01974000
INRREP   LR    R1,INRMSG                                           0784 01975000
*   SVC (CONSVC);                   /* ISSUE MSG LOCATED IN R1       */ 01976000
         SVC   3                                                   0785 01977000
*   RESPECIFY RETCODE RESTRICTED;                                  0786 01978000
*   IF RETCODE ^= ZERO THEN         /* IF MSG ISSUED CONTINUE        */ 01979000
*                                                                  0787 01980000
         LTR   RETCODE,RETCODE                                     0787 01981000
         BZ    @RF00787                                            0787 01982000
*INRERR:                                                           0788 01983000
*     RETURN CODE(4);               /* RETURN ERROR TO CALLER        */ 01984000
INRERR   LA    @15,4                                               0788 01985000
         L     @14,@SA00006                                        0788 01986000
         LM    @00,@12,@SA00006+8                                  0788 01987000
         BR    @14                                                 0788 01988000
*   IF IODBREG = ADDR(IODBDA) THEN  /* IS THIS FOR THE PAGE DATA SET    01989000
*                                      DEVICE                        */ 01990000
@RF00787 L     @14,@CA01084                                        0789 01991000
         CR    IODBREG,@14                                         0789 01992000
         BNE   @RF00789                                            0789 01993000
*     DO;                                                          0790 01994000
*       REPLY12D = BLANK;           /* RESET REPLY FIELD             */ 01995000
         L     @14,@CA01069                                        0791 01996000
         MVI   REPLY12D-REPLY12D(@14),C' '                         0791 01997000
*       R1 = AMD012D;               /* SET MSG ID                    */ 01998000
         LA    R1,12                                               0792 01999000
*       SVC(CONSVC);                /* ISSUE MSG                     */ 02000000
         SVC   3                                                   0793 02001000
*       IF RETCODE ^= ZERO THEN     /* MSG ISSUED OKAY               */ 02002000
         LTR   RETCODE,RETCODE                                     0794 02003000
         BNZ   @RT00794                                            0794 02004000
*         GO TO INRERR;             /* NO--RETURN ERROR              */ 02005000
*       REPLY12D = REPLY12D | BLANK; /* MAKE REPLY UPPER CASE        */ 02006000
         L     @14,@CA01069                                        0796 02007000
         OI    REPLY12D-REPLY12D(@14),C' '                         0796 02008000
*       IF REPLY12D = IGNORE THEN   /* WAS REPLY I                   */ 02009000
         CLI   REPLY12D-REPLY12D(@14),C'I'                         0797 02010000
         BNE   @RF00797                                            0797 02011000
*         DO;                                                      0798 02012000
*           IODBTERM = ON;          /* DO NOT REUSE THIS DEVICE      */ 02013000
         OI    IODBTERM(IODBREG),B'10000000'                       0799 02014000
*           GO TO INRERR;           /* YES--THEN IGNORE DEVICE       */ 02015000
         B     INRERR                                              0800 02016000
*         END;                                                     0801 02017000
*       IF REPLY12D ^= GO THEN      /* WAS REPLY G                   */ 02018000
@RF00797 L     @14,@CA01069                                        0802 02019000
         CLI   REPLY12D-REPLY12D(@14),C'G'                         0802 02020000
         BNE   @RT00802                                            0802 02021000
*         GO TO INRREP;             /* NO--ITS INVALID--REPEAT       */ 02022000
*     END;                                                         0804 02023000
*   RESPECIFY (R1,RETCODE) UNRESTRICTED;                           0805 02024000
@RF00789 DS    0H                                                  0806 02025000
*   SAVECTIO = CTIOTYPE;            /* SAVE FIELD                    */ 02026000
         MVC   SAVECTIO(1),CTIOTYPE(CCTREG)                        0806 02027000
*   CTIOTYPE = OFF;                 /* SET UP TAP INPUT PARAMETER    */ 02028000
         MVI   CTIOTYPE(CCTREG),B'00000000'                        0807 02029000
*   IF IODBREG = ADDR(IODBDA) THEN                                 0808 02030000
         L     @10,@CA01084                                        0808 02031000
         CR    IODBREG,@10                                         0808 02032000
         BNE   @RF00808                                            0808 02033000
*     CTIODA = ON;                  /* DA TYPE                       */ 02034000
         OI    CTIODA(CCTREG),B'00100000'                          0809 02035000
*   ELSE                                                           0810 02036000
*     IF IODBREG = ADDR(IODBWORK) THEN                             0810 02037000
         B     @RC00808                                            0810 02038000
@RF00808 L     @10,@CA01085                                        0810 02039000
         CR    IODBREG,@10                                         0810 02040000
         BNE   @RF00810                                            0810 02041000
*       CTIOWK = ON;                /* WORKFILE TYPE                 */ 02042000
         OI    CTIOWK(CCTREG),B'00010000'                          0811 02043000
*     ELSE                                                         0812 02044000
*       CTIOOUT = ON;               /* OUTPUT ONLY ONE LEFT          */ 02045000
         B     @RC00810                                            0812 02046000
@RF00810 OI    CTIOOUT(CCTREG),B'01000000'                         0812 02047000
*   SVC (TAPSVC);                   /* GET ON POROER CPU             */ 02048000
@RC00810 DS    0H                                                  0813 02049000
@RC00808 SVC   2                                                   0813 02050000
*   CTIOTYPE = SAVECTIO;            /* RESTORE FIELD                 */ 02051000
         MVC   CTIOTYPE(1,CCTREG),SAVECTIO                         0814 02052000
*   RESPECIFY RETCODE RESTRICTED;                                  0815 02053000
*   IF RETCODE ^= ZERO THEN         /* IF ON CPU CONTINUE            */ 02054000
         LTR   RETCODE,RETCODE                                     0816 02055000
         BZ    @RF00816                                            0816 02056000
*     RETURN CODE(4);               /* RETURN ERROR TO CALLER        */ 02057000
         LA    @15,4                                               0817 02058000
         L     @14,@SA00006                                        0817 02059000
         LM    @00,@12,@SA00006+8                                  0817 02060000
         BR    @14                                                 0817 02061000
*   RESPECIFY RETCODE UNRESTRICTED;                                0818 02062000
@RF00816 DS    0H                                                  0819 02063000
*   IONEW = FLCINPSW;               /* SAVE I/O NEW                  */ 02064000
         MVC   IONEW(8),FLCINPSW                                   0819 02065000
*   IOOLD = FLCIOPSW;               /* SAVE I/O OLD                  */ 02066000
         MVC   IOOLD(8),FLCIOPSW                                   0820 02067000
*   FLCINPSW = INRHANDR;            /* SET UP THE INTERVENTION     0821 02068000
*                                      REQUIRED SPECIAL INTERRUPT  0821 02069000
*                                      HANDLER                       */ 02070000
         MVC   FLCINPSW(8),INRHANDR                                0821 02071000
*   DEVIRW = IODBDEV;               /* SET CUU INTO WAIT CODE        */ 02072000
*                                                                  0822 02073000
         LH    @10,IODBDEV(,IODBREG)                               0822 02074000
         STH   @10,DEVIRW                                          0822 02075000
*ENABWAIT:                                                         0823 02076000
*   LPSW (WAITPSW);                 /* WAIT FOR INTERRUPT            */ 02077000
*                                                                  0823 02078000
ENABWAIT LPSW  WAITPSW                                             0823 02079000
*INTERRPT:                                                         0824 02080000
*   IF FLCIOAA ^= IODBDEV THEN                                     0824 02081000
INTERRPT L     @10,FLCIOAA-1                                       0824 02082000
         LA    @10,0(,@10)                                         0824 02083000
         CH    @10,IODBDEV(,IODBREG)                               0824 02084000
         BNE   @RT00824                                            0824 02085000
*     GO TO ENABWAIT;               /* WAIT FOR SPECIFIC INTERRUPT   */ 02086000
*   FLCINPSW = IONEW;               /* RESTORE I/O NEW               */ 02087000
         MVC   FLCINPSW(8),IONEW                                   0826 02088000
*   FLCIOPSW = IOOLD;               /* RESTORE I/O OLD               */ 02089000
         MVC   FLCIOPSW(8),IOOLD                                   0827 02090000
*   RETURN CODE(0);                 /* RETURN TO CALLER              */ 02091000
         SLR   @15,@15                                             0828 02092000
         L     @14,@SA00006                                        0828 02093000
         LM    @00,@12,@SA00006+8                                  0828 02094000
         BR    @14                                                 0828 02095000
*   END TERINR;                                                    0829 02096000
*                                                                  0830 02097000
*   /*****************************************************************/ 02098000
*   /*                                                               */ 02099000
*   /* THIS IS THE ERROR RECOVERY BLOCK INITALIZATION AND UPDATE     */ 02100000
*   /* ROUTINE.                                                      */ 02101000
*   /*                                                               */ 02102000
*   /*****************************************************************/ 02103000
*                                                                  0830 02104000
*/*TERERB: E ENTRY                                                   */ 02105000
*/* P SAVE CALLER'S REGISTERS                                        */ 02106000
*/* D (YES,,NO,ERBCTR) ERB = 0 ?                                     */ 02107000
*/* P ERBMAX CTR = X'FF'                                             */ 02108000
*/*ERBID: P ERBID = INPUT ERBID                                      */ 02109000
*/* P ERBPCTR = INPUT PCT                                            */ 02110000
*/* P (,ERBRET) ERBSCT = INPUT SCT                                   */ 02111000
*/*ERBCTR: P ERBMAX CTR = ERBMAX CTR - 1                             */ 02112000
*/* D (YES,%TERM,NO,) ERBMAX CTR = 0 ?                               */ 02113000
*/* D (YES,,NO,ERBID) ERBID = INPUT ERBID ?                          */ 02114000
*/* P ERBPCTR = ERBPCTR - 1                                          */ 02115000
*/* D (YES,,NO,ERBRET) ERBPCTR = 0 ?                                 */ 02116000
*/* D (YES,TERMEXIT,NO,) ERBSCTR = 0 ?                               */ 02117000
*/* P ERBSCTR = ERBSCTR - 1                                          */ 02118000
*/* P ERBPCTR = INPUT PCT                                            */ 02119000
*/*ERBRET: P RESTORE CALLER'S REGISTERS                              */ 02120000
*/* R RETURN TO CALLER                                               */ 02121000
*/*%TERM: P SET UP INPUT ERBID                                       */ 02122000
*/*TERMEXIT: N GIVE CONTROL TO TERMEXIT IN AMDSATER                  */ 02123000
*/* R EXIT TO AMDSATER                                               */ 02124000
*/*TERERB: END                                                       */ 02125000
*                                                                  0830 02126000
*   /*****************************************************************/ 02127000
*   /*                                                               */ 02128000
*   /* THIS ROUTINE (TERERBX) IS TO CAUSE THE REAL TERERB ROUTINE TO */ 02129000
*   /* ALWAYS BE CALLED TWO LEVELS DEEP IN A SAVEAREA. THIS IS       */ 02130000
*   /* NECESSARY BECAUSE IF THERE ARE TO BE NO MORE RETRIES OF THE   */ 02131000
*   /* ERROR THEN TERERB RETURNS TO THE ADDRESS PASSED IN THE INPUT  */ 02132000
*   /* TO TERERB AND MUST ALWAYS RESTORE THS SAME NUMBER OF LEVELS OF*/ 02133000
*   /* SAVEAREAS.                                                    */ 02134000
*   /*                                                               */ 02135000
*   /*****************************************************************/ 02136000
*                                                                  0830 02137000
*                                                                  0830 02138000
*TERERBX:                                                          0830 02139000
*   PROC OPTIONS(SAVEAREA);                                        0830 02140000
TERERBX  STM   @14,@12,12(@13)                                     0830 02141000
         ST    @13,@SA00007+4                                      0830 02142000
         LA    @14,@SA00007                                        0830 02143000
         ST    @14,8(,@13)                                         0830 02144000
         LR    @13,@14                                             0830 02145000
*   CALL TERERB;                    /* CALL REAL ERB ROUTINE         */ 02146000
         BAL   @14,TERERB                                          0831 02147000
*   END TERERBX;                                                   0832 02148000
*                                                                  0832 02149000
@EL00007 L     @13,4(,@13)                                         0832 02150000
@EF00007 DS    0H                                                  0832 02151000
@ER00007 LM    @14,@12,12(@13)                                     0832 02152000
         BR    @14                                                 0832 02153000
*TERERB:                                                           0833 02154000
*   PROC;                                                          0833 02155000
TERERB   STM   @14,@12,12(@13)                                     0833 02156000
*   RESPECIFY R1 RESTRICTED;                                       0834 02157000
*   IF ERBLOCK = 0 THEN                                            0835 02158000
         L     @10,ERBADDRI(,R1)                                   0835 02159000
         ICM   @00,15,ERBLOCK(@10)                                 0835 02160000
         BNZ   @RF00835                                            0835 02161000
*     ERBMAX = 255;                 /* INITIALIZE THE MAXIMUM ERB  0836 02162000
*                                      COUNT IF FIRST ENTRY          */ 02163000
         MVI   ERBMAX(@10),X'FF'                                   0836 02164000
*   ELSE                                                           0837 02165000
*     DO;                                                          0837 02166000
         B     @RC00835                                            0837 02167000
@RF00835 DS    0H                                                  0838 02168000
*       ERBMAX = ERBMAX - 1;        /* DECREMENT MAXIMUM CTR         */ 02169000
         L     @10,ERBADDRI(,R1)                                   0838 02170000
         SLR   @00,@00                                             0838 02171000
         IC    @00,ERBMAX(,@10)                                    0838 02172000
         BCTR  @00,0                                               0838 02173000
         STC   @00,ERBMAX(,@10)                                    0838 02174000
*       IF ERBMAX = ZERO THEN                                      0839 02175000
         CLI   ERBMAX(@10),0                                       0839 02176000
         BNE   @RF00839                                            0839 02177000
*         DO;                       /* IF OVER 255 RETRIES-DONE      */ 02178000
*           ERBID1 = ERBPIDI;       /* SET UP LAST ERB IDENTIFIER OF    02179000
*                                      ERROR CONDITION               */ 02180000
         MVC   ERBID1(1,@10),ERBPIDI(R1)                           0841 02181000
*           SAVEBACK -> SAVER14 = ERBERRI; /* SET TO TERMINATE ERROR    02182000
*                                      RECOVERY ROUTINE              */ 02183000
         L     @10,SAVEBACK(,R13)                                  0842 02184000
         L     @00,ERBERRI(,R1)                                    0842 02185000
         ST    @00,SAVER14(,@10)                                   0842 02186000
*           GO TO ERBRET;           /* RETURN                        */ 02187000
         B     ERBRET                                              0843 02188000
*         END;                                                     0844 02189000
*       IF ERBID1 ^= ERBPIDI THEN                                  0845 02190000
@RF00839 L     @10,ERBADDRI(,R1)                                   0845 02191000
         CLC   ERBID1(1,@10),ERBPIDI(R1)                           0845 02192000
         BNE   @RT00845                                            0845 02193000
*         GO TO ERBIDSET;           /* IF DIFFERENT ERROR SET UP   0846 02194000
*                                      RETRY                         */ 02195000
*       ERBPCTR = ERBPCTR - 1;      /* DECREMENT PRIMARY CTR         */ 02196000
         SLR   @00,@00                                             0847 02197000
         IC    @00,ERBPCTR(,@10)                                   0847 02198000
         BCTR  @00,0                                               0847 02199000
         STC   @00,ERBPCTR(,@10)                                   0847 02200000
*       IF ERBPCTR = ZERO THEN                                     0848 02201000
         CLI   ERBPCTR(@10),0                                      0848 02202000
         BNE   @RF00848                                            0848 02203000
*         DO;                       /* IF ZERO CHECK SECONDARY     0849 02204000
*                                      POINTER                       */ 02205000
*           IF ERBSCTR = ZERO THEN                                 0850 02206000
         CLI   ERBSCTR(@10),0                                      0850 02207000
         BNE   @RF00850                                            0850 02208000
*             DO;                   /* IF NO SECONDARY POINTER, WE 0851 02209000
*                                      ARE DONE                      */ 02210000
*               SAVEBACK -> SAVER14 = ERBERRI; /* ERROR EXIT         */ 02211000
         L     @10,SAVEBACK(,R13)                                  0852 02212000
         L     @00,ERBERRI(,R1)                                    0852 02213000
         ST    @00,SAVER14(,@10)                                   0852 02214000
*               GO TO ERBRET;       /* GO TO THE ERROR EXIT          */ 02215000
         B     ERBRET                                              0853 02216000
*             END;                                                 0854 02217000
*           ERBSCTR = ERBSCTR - 1;  /* DECREMENT SECONDARY CTR       */ 02218000
@RF00850 L     @10,ERBADDRI(,R1)                                   0855 02219000
         SLR   @00,@00                                             0855 02220000
         IC    @00,ERBSCTR(,@10)                                   0855 02221000
         BCTR  @00,0                                               0855 02222000
         STC   @00,ERBSCTR(,@10)                                   0855 02223000
*           ERBPCTR = ERBPCTI;      /* RESET PRIMARY CTR             */ 02224000
         MVC   ERBPCTR(1,@10),ERBPCTI(R1)                          0856 02225000
*         END;                                                     0857 02226000
*       GO TO ERBRET;               /* RETURN TO RETRY I/O ERROR     */ 02227000
         B     ERBRET                                              0858 02228000
*     END;                          /* ERB EXISTED PATH              */ 02229000
*   ERBIDSET:ERBID1 = ERBPIDI;      /* ERROR ID                      */ 02230000
@RC00835 DS    0H                                                  0860 02231000
ERBIDSET L     @10,ERBADDRI(,R1)                                   0860 02232000
         MVC   ERBID1(1,@10),ERBPIDI(R1)                           0860 02233000
*   ERBPCTR = ERBPCTI;              /* SET UP PRIMARY # RETRIES      */ 02234000
         MVC   ERBPCTR(1,@10),ERBPCTI(R1)                          0861 02235000
*   ERBSCTR = ERBSCTI;              /* SET UP SECONDARY # RETRIES    */ 02236000
*                                                                  0862 02237000
         MVC   ERBSCTR(1,@10),ERBSCTI(R1)                          0862 02238000
*ERBRET:                                                           0863 02239000
*   RETURN;                                                        0863 02240000
@EL00008 DS    0H                                                  0863 02241000
@EF00008 DS    0H                                                  0863 02242000
@ER00008 LM    @14,@12,12(@13)                                     0863 02243000
         BR    @14                                                 0863 02244000
*   END TERERB;                                                    0864 02245000
         B     @EL00008                                            0864 02246000
*   END AMDSATER                                                   0865 02247000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.      * 02248000
*/*%INCLUDE SYSLIB  (IHAPSA  )                                        * 02249000
*/*%INCLUDE SYSLIB  (AMDSARMK)                                        * 02250000
*;                                                                 0865 02251000
@DATA    DS    0H                                                       02252000
@CH00067 DC    H'1'                                                     02253000
@CH00108 DC    H'2'                                                     02254000
@CH00089 DC    H'24'                                                    02255000
@SM01247 MVC   COND33I-COND33I(0,@10),MSGTXT(MSGADDR)                   02256000
         DS    0F                                                       02257000
@SA00001 DS    18F                                                      02258000
@SA00004 DS    18F                                                      02259000
@SA00007 DS    18F                                                      02260000
@SA00006 DS    15F                                                      02261000
@SA00002 DS    15F                                                      02262000
@SA00003 DS    15F                                                      02263000
@SA00005 DS    15F                                                      02264000
         DS    0F                                                       02265000
@CF00044 DC    F'4'                                                     02266000
@CF00036 DC    F'8'                                                     02267000
@CF00867 DC    F'37'                                                    02268000
@CF00727 DC    F'28672'                                                 02269000
@CA00981 DC    A(MSGTAB)                                                02270000
@CA01046 DC    A(IODBOUT)                                               02271000
@CA01069 DC    A(REPLY12D)                                              02272000
@CA01076 DC    A(DEV14A)                                                02273000
@CA01077 DC    A(DEV20A)                                                02274000
@CA01084 DC    A(IODBDA)                                                02275000
@CA01085 DC    A(IODBWORK)                                              02276000
@CA01087 DC    A(COND33I)                                               02277000
@CA01088 DC    A(STAT33I)                                               02278000
@CA01089 DC    A(CMD33I)                                                02279000
@CA01090 DC    A(DEV33I)                                                02280000
@CA01091 DC    A(LNG33I)                                                02281000
@CA01092 DC    A(SENS34I)                                               02282000
         DS    0D                                                       02283000
BCTADDR  DS    A                                                        02284000
CCK      DS    A                                                        02285000
@CC01114 DC    C'LTER'                                                  02286000
         DS    CL4                                                      02287000
SENSECCW DS    CL8                                                      02288000
         ORG   SENSECCW                                                 02289000
@NM00064 DC    X'04'                                                    02290000
SENSEADR DC    XL3'00'                                                  02291000
@NM00065 DC    X'20000018'                                              02292000
         ORG   SENSECCW+8                                               02293000
SENSCCW  DS    CL8                                                      02294000
         ORG   SENSCCW                                                  02295000
@NM00066 DC    X'0400000030000018'                                      02296000
         ORG   SENSCCW+8                                                02297000
WTMERR   DS    CL40                                                     02298000
         ORG   WTMERR                                                   02299000
@NM00067 DC    X'2700000060000001'                                      02300000
@NM00068 DC    X'1700000060000001'                                      02301000
EORCCW   DS    CL24                                                     02302000
         ORG   EORCCW                                                   02303000
@NM00069 DC    X'1F00000060000001'                                      02304000
REWUNLD  DC    X'0F00000060000001'                                      02305000
@NM00070 DC    X'0300000020000001'                                      02306000
         ORG   WTMERR+40                                                02307000
REPOSTAP DS    CL24                                                     02308000
         ORG   REPOSTAP                                                 02309000
@NM00071 DC    X'2700000060000001'                                      02310000
@NM00072 DC    X'1700000060000001'                                      02311000
TICTL    DS    CL8                                                      02312000
         ORG   TICTL                                                    02313000
@NM00073 DC    X'08'                                                    02314000
TICTLADR DC    XL3'00'                                                  02315000
@NM00074 DC    X'60000001'                                              02316000
         ORG   REPOSTAP+24                                              02317000
REREAD   DS    CL32                                                     02318000
         ORG   REREAD                                                   02319000
@NM00075 DC    X'0400000070000018'                                      02320000
@NM00076 DC    X'0700000060000001'                                      02321000
READ     DS    CL8                                                      02322000
         ORG   READ                                                     02323000
READCMD  DC    X'02'                                                    02324000
@NM00077 DC    AL3(VOLABEL)                                             02325000
@NM00078 DC    X'60000004'                                              02326000
         ORG   REREAD+24                                                02327000
@NM00079 DC    X'0700000020000001'                                      02328000
         ORG   REREAD+32                                                02329000
VOLABEL  DS    CL4                                                      02330000
         DS    CL4                                                      02331000
REPOSPRM DS    CL16                                                     02332000
         ORG   REPOSPRM                                                 02333000
@NM00080 DC    X'2700000060000001'                                      02334000
REPOTIC  DS    CL8                                                      02335000
         ORG   REPOTIC                                                  02336000
@NM00081 DC    X'08'                                                    02337000
REPOTADR DS    AL3                                                      02338000
@NM00082 DC    X'60000001'                                              02339000
         ORG   REPOSPRM+16                                              02340000
CVTBLK   DS    CL10                                                     02341000
         ORG   CVTBLK                                                   02342000
CVTBINA  DS    AL4                                                      02343000
CVTEBCA  DS    AL4                                                      02344000
CVTINL   DS    AL2                                                      02345000
         ORG   CVTBLK+10                                                02346000
         DS    CL2                                                      02347000
CONVAREA DS    CL4                                                      02348000
TAPESW   DC    AL1(0)                                                   02349000
         ORG   TAPESW                                                   02350000
EORCHAIN DS    BL1                                                      02351000
@NM00084 EQU   TAPESW+0                                                 02352000
         ORG   TAPESW+1                                                 02353000
VOL1     DC    CL4'VOL1'                                                02354000
ASCII    DC    X'564F4C31'                                              02355000
@NM00085 DS    BL1                                                      02356000
         ORG   @NM00085                                                 02357000
RUNSW    DS    BL1                                                      02358000
@NM00086 EQU   @NM00085+0                                               02359000
         ORG   @NM00085+1                                               02360000
NULL     DC    X'000000000000000000000000000000000000000000000000'      02361000
ERBSAVE  DS    CL8                                                      02362000
         DS    CL2                                                      02363000
ERBPARM  DS    CL12                                                     02364000
         ORG   ERBPARM                                                  02365000
ERBADDR  DS    AL4                                                      02366000
ERBPID   DS    CL1                                                      02367000
ERBSCT   DS    CL1                                                      02368000
ERBPCT   DS    CL1                                                      02369000
@NM00091 DS    CL1                                                      02370000
@NM00092 DC    AL4(TERMEXIT)                                            02371000
         ORG   ERBPARM+12                                               02372000
SAVECTIO DS    BL1                                                      02373000
NONE     DC    CL4'NONE'                                                02374000
         DS    CL3                                                      02375000
INRHANDR DS    CL8                                                      02376000
         ORG   INRHANDR                                                 02377000
@NM00094 DC    X'01'                                                    02378000
@NM00095 DC    X'0C000000'                                              02379000
@NM00096 DC    AL3(INTERRPT)                                            02380000
         ORG   INRHANDR+8                                               02381000
WAITPSW  DS    CL8                                                      02382000
         ORG   WAITPSW                                                  02383000
@NM00097 DC    X'030E000000E0'                                          02384000
DEVIRW   DS    FL2                                                      02385000
         ORG   WAITPSW+8                                                02386000
IOOLD    DS    CL8                                                      02387000
IONEW    DS    CL8                                                      02388000
TERPATCH DC    20F'0'                                                   02389000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       02390000
@01      EQU   01                                                       02391000
@02      EQU   02                                                       02392000
@03      EQU   03                                                       02393000
@04      EQU   04                                                       02394000
@05      EQU   05                                                       02395000
@06      EQU   06                                                       02396000
@07      EQU   07                                                       02397000
@08      EQU   08                                                       02398000
@09      EQU   09                                                       02399000
@10      EQU   10                                                       02400000
@11      EQU   11                                                       02401000
@12      EQU   12                                                       02402000
@13      EQU   13                                                       02403000
@14      EQU   14                                                       02404000
@15      EQU   15                                                       02405000
CCTREG   EQU   @05                                                      02406000
INRMSG   EQU   @06                                                      02407000
I        EQU   @02                                                      02408000
CCWTEMP  EQU   @03                                                      02409000
CCWREG   EQU   @06                                                      02410000
MSGADDR  EQU   @06                                                      02411000
VCCTREG  EQU   @12                                                      02412000
RETCODE  EQU   @15                                                      02413000
BASEREG  EQU   @11                                                      02414000
R1       EQU   @01                                                      02415000
R11      EQU   @11                                                      02416000
R13      EQU   @13                                                      02417000
IODBREG  EQU   @08                                                      02418000
RETREG   EQU   @14                                                      02419000
R0       EQU   @00                                                      02420000
R10      EQU   @10                                                      02421000
R12      EQU   @12                                                      02422000
R14      EQU   @14                                                      02423000
R15      EQU   @15                                                      02424000
R2       EQU   @02                                                      02425000
R3       EQU   @03                                                      02426000
R4       EQU   @04                                                      02427000
R5       EQU   @05                                                      02428000
R6       EQU   @06                                                      02429000
R7       EQU   @07                                                      02430000
R8       EQU   @08                                                      02431000
R9       EQU   @09                                                      02432000
         EXTRN MSGTAB                                                   02433000
         EXTRN IODBOUT                                                  02434000
         EXTRN REPLY12D                                                 02435000
         EXTRN DEV14A                                                   02436000
         EXTRN DEV20A                                                   02437000
         EXTRN IODBDA                                                   02438000
         EXTRN IODBWORK                                                 02439000
         EXTRN COND33I                                                  02440000
         EXTRN STAT33I                                                  02441000
         EXTRN CMD33I                                                   02442000
         EXTRN DEV33I                                                   02443000
         EXTRN LNG33I                                                   02444000
         EXTRN SENS34I                                                  02445000
PSA      EQU   0                                                        02446000
FLCRNPSW EQU   PSA                                                      02447000
FLCROPSW EQU   PSA+8                                                    02448000
FLCICCW2 EQU   PSA+16                                                   02449000
FLCIOPSW EQU   PSA+56                                                   02450000
FLCCSW   EQU   PSA+64                                                   02451000
FLCCAW   EQU   PSA+72                                                   02452000
FLCINPSW EQU   PSA+120                                                  02453000
PSAEEPSW EQU   PSA+132                                                  02454000
PSAESPSW EQU   PSA+136                                                  02455000
FLCSVILC EQU   PSAESPSW+1                                               02456000
PSAEPPSW EQU   PSA+140                                                  02457000
FLCPIILC EQU   PSAEPPSW+1                                               02458000
FLCPICOD EQU   PSAEPPSW+2                                               02459000
PSAPICOD EQU   FLCPICOD+1                                               02460000
FLCTEA   EQU   PSAEPPSW+4                                               02461000
FLCPER   EQU   PSA+152                                                  02462000
FLCMCLA  EQU   PSA+168                                                  02463000
FLCIOEL  EQU   FLCMCLA+4                                                02464000
FLCIOA   EQU   FLCMCLA+16                                               02465000
FLCIOAA  EQU   FLCIOA+1                                                 02466000
FLCFSA   EQU   FLCMCLA+80                                               02467000
PSASUPER EQU   PSA+552                                                  02468000
PSASUP1  EQU   PSASUPER                                                 02469000
PSASUP2  EQU   PSASUPER+1                                               02470000
PSASUP3  EQU   PSASUPER+2                                               02471000
PSASUP4  EQU   PSASUPER+3                                               02472000
PSACLHT  EQU   PSA+640                                                  02473000
PSALKSA  EQU   PSA+696                                                  02474000
PSAHLHI  EQU   PSA+760                                                  02475000
PSADSSFL EQU   PSA+836                                                  02476000
PSADSSF1 EQU   PSADSSFL                                                 02477000
PSADSSF3 EQU   PSADSSFL+2                                               02478000
PSADSSF4 EQU   PSADSSFL+3                                               02479000
PSARSVT  EQU   PSA+896                                                  02480000
SADMPLSD EQU   3312                                                     02481000
ARB      EQU   0                                                        02482000
BCTH     EQU   0                                                        02483000
BCT      EQU   0                                                        02484000
BCTLPID  EQU   BCT+28                                                   02485000
BCTFLGT  EQU   BCT+44                                                   02486000
BCTFLGI  EQU   BCT+45                                                   02487000
BCTCOMP  EQU   BCTFLGI                                                  02488000
BCTIOERR EQU   BCTFLGI                                                  02489000
CCT      EQU   0                                                        02490000
CTWAIT   EQU   CCT                                                      02491000
CTFLG1   EQU   CCT+1                                                    02492000
CTFLG2   EQU   CCT+2                                                    02493000
CTERBDA  EQU   CCT+28                                                   02494000
CTERBTPE EQU   CCT+32                                                   02495000
CTLOWFLG EQU   CCT+48                                                   02496000
CTDMPTYP EQU   CCT+52                                                   02497000
CTIOTYPE EQU   CTDMPTYP                                                 02498000
CTIOOUT  EQU   CTIOTYPE                                                 02499000
CTIODA   EQU   CTIOTYPE                                                 02500000
CTIOWK   EQU   CTIOTYPE                                                 02501000
CTCONFLG EQU   CTDMPTYP+2                                               02502000
CTMSGOUT EQU   CTCONFLG                                                 02503000
CTBUFTYP EQU   CTDMPTYP+3                                               02504000
CTPRMT1  EQU   CTDMPTYP+24                                              02505000
CTPRMT2  EQU   CTDMPTYP+26                                              02506000
CCW      EQU   0                                                        02507000
CCWCMD   EQU   CCW                                                      02508000
CCWDADDR EQU   CCW+1                                                    02509000
CCWFLAGS EQU   CCW+4                                                    02510000
CCWPCI   EQU   CCWFLAGS                                                 02511000
CSW      EQU   0                                                        02512000
CSWKEY00 EQU   CSW                                                      02513000
CSWCADDR EQU   CSW+1                                                    02514000
CSWUSTAT EQU   CSW+4                                                    02515000
CSWATTN  EQU   CSWUSTAT                                                 02516000
CSWBUSY  EQU   CSWUSTAT                                                 02517000
CSWDE    EQU   CSWUSTAT                                                 02518000
CSWUC    EQU   CSWUSTAT                                                 02519000
CSWUE    EQU   CSWUSTAT                                                 02520000
CSWCSTAT EQU   CSW+5                                                    02521000
CSWPCI   EQU   CSWCSTAT                                                 02522000
CSWIL    EQU   CSWCSTAT                                                 02523000
CSWPGC   EQU   CSWCSTAT                                                 02524000
CSWPTC   EQU   CSWCSTAT                                                 02525000
CSWCDC   EQU   CSWCSTAT                                                 02526000
CSWCCC   EQU   CSWCSTAT                                                 02527000
CSWICC   EQU   CSWCSTAT                                                 02528000
CSWCHC   EQU   CSWCSTAT                                                 02529000
DSCE     EQU   0                                                        02530000
IODB     EQU   0                                                        02531000
IODBFLAG EQU   IODB+8                                                   02532000
IODBTERM EQU   IODBFLAG                                                 02533000
IODBPTRM EQU   IODBFLAG                                                 02534000
IODBIOC  EQU   IODBFLAG                                                 02535000
IODBACTV EQU   IODBFLAG                                                 02536000
IODBSTRT EQU   IODBFLAG                                                 02537000
IODBDEV  EQU   IODB+10                                                  02538000
IODBBCT  EQU   IODB+16                                                  02539000
IODBCAW  EQU   IODB+20                                                  02540000
IODBCSW  EQU   IODB+24                                                  02541000
IODBCCHH EQU   IODB+32                                                  02542000
IODBSRCH EQU   IODBCCHH+3                                               02543000
IODBSENS EQU   IODB+40                                                  02544000
MDCE     EQU   0                                                        02545000
MDCB     EQU   0                                                        02546000
MDCBGRS  EQU   MDCB+16                                                  02547000
MDCBFLGS EQU   MDCB+86                                                  02548000
PSW      EQU   0                                                        02549000
PSWSM    EQU   PSW                                                      02550000
@NM00047 EQU   PSW+1                                                    02551000
PSWCCPM  EQU   PSW+2                                                    02552000
@NM00050 EQU   PSW+3                                                    02553000
PTRT     EQU   0                                                        02554000
PTRTRSA  EQU   0                                                        02555000
RCB      EQU   0                                                        02556000
VCCT     EQU   0                                                        02557000
VCTRECSN EQU   VCCT+8                                                   02558000
VCTFLGS  EQU   VCCT+9                                                   02559000
VCTMDCE  EQU   VCCT+12                                                  02560000
VCTDSCE  EQU   VCCT+20                                                  02561000
VCTBCTH  EQU   VCCT+24                                                  02562000
VCTCBID  EQU   VCCT+64                                                  02563000
VCTCPOUT EQU   VCCT+96                                                  02564000
SDL      EQU   0                                                        02565000
REGLOCAL EQU   0                                                        02566000
SAVEFORM EQU   0                                                        02567000
SAVEBACK EQU   SAVEFORM+4                                               02568000
SAVER14  EQU   SAVEFORM+12                                              02569000
SAVER15  EQU   SAVEFORM+16                                              02570000
MSGTYPE  EQU   0                                                        02571000
MSGFLAGS EQU   MSGTYPE                                                  02572000
MSGSTAT  EQU   MSGFLAGS                                                 02573000
MSGSENS  EQU   MSGFLAGS                                                 02574000
MSGTAPE  EQU   MSGFLAGS                                                 02575000
MSGLNGTH EQU   MSGTYPE+1                                                02576000
MSGTXT   EQU   MSGTYPE+2                                                02577000
ERBPARMI EQU   0                                                        02578000
ERBADDRI EQU   ERBPARMI                                                 02579000
ERBPIDI  EQU   ERBPARMI+4                                               02580000
ERBSCTI  EQU   ERBPARMI+5                                               02581000
ERBPCTI  EQU   ERBPARMI+6                                               02582000
ERBERRI  EQU   ERBPARMI+8                                               02583000
ERBLOCK  EQU   0                                                        02584000
ERBID1   EQU   ERBLOCK                                                  02585000
ERBSCTR  EQU   ERBLOCK+1                                                02586000
ERBPCTR  EQU   ERBLOCK+2                                                02587000
ERBMAX   EQU   ERBLOCK+3                                                02588000
PTRTVSA  EQU   0                                                        02589000
PSARSVTE EQU   PSARSVT                                                  02590000
CTLOWDMP EQU   CTDMPTYP                                                 02591000
SENSE    EQU   IODBSENS                                                 02592000
SENSE00  EQU   SENSE                                                    02593000
SENCR    EQU   SENSE00                                                  02594000
SENIR    EQU   SENSE00                                                  02595000
SENBO    EQU   SENSE00                                                  02596000
SENEC    EQU   SENSE00                                                  02597000
SENDC    EQU   SENSE00                                                  02598000
SENOR    EQU   SENSE00                                                  02599000
SENCC    EQU   SENSE00                                                  02600000
SENSE01  EQU   SENSE+1                                                  02601000
SENTB    EQU   SENSE01                                                  02602000
SENLP    EQU   SENSE01                                                  02603000
SENFP    EQU   SENSE01                                                  02604000
SENNC    EQU   SENSE01                                                  02605000
SENSE05  EQU   SENSE+5                                                  02606000
SENPEID  EQU   SENSE05                                                  02607000
@NM00087 EQU   CTERBTPE                                                 02608000
ERBID    EQU   @NM00087                                                 02609000
ERBS     EQU   CTERBDA                                                  02610000
FLC      EQU   PSA                                                      02611000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    02612000
@NM00090 EQU   @NM00087+3                                               02613000
@NM00089 EQU   @NM00087+2                                               02614000
@NM00088 EQU   @NM00087+1                                               02615000
@NM00063 EQU   SENSE+6                                                  02616000
@NM00062 EQU   SENSE05                                                  02617000
@NM00061 EQU   SENSE05                                                  02618000
@NM00060 EQU   SENSE+2                                                  02619000
@NM00059 EQU   SENSE01                                                  02620000
@NM00058 EQU   SENSE01                                                  02621000
@NM00057 EQU   SENSE01                                                  02622000
@NM00056 EQU   SENSE01                                                  02623000
@NM00055 EQU   SENSE00                                                  02624000
CTADDRE  EQU   CTLOWDMP+4                                               02625000
CTADDRS  EQU   CTLOWDMP                                                 02626000
PSARSAV  EQU   PSARSVTE+60                                              02627000
PSARSTK  EQU   PSARSVTE+56                                              02628000
PSAESAV3 EQU   PSARSVTE+52                                              02629000
PSAESTK3 EQU   PSARSVTE+48                                              02630000
PSAESAV2 EQU   PSARSVTE+44                                              02631000
PSAESTK2 EQU   PSARSVTE+40                                              02632000
PSAESAV1 EQU   PSARSVTE+36                                              02633000
PSAESTK1 EQU   PSARSVTE+32                                              02634000
PSAPSAV  EQU   PSARSVTE+28                                              02635000
PSAPSTK  EQU   PSARSVTE+24                                              02636000
PSAMSAV  EQU   PSARSVTE+20                                              02637000
PSAMSTK  EQU   PSARSVTE+16                                              02638000
PSASSAV  EQU   PSARSVTE+12                                              02639000
PSASSTK  EQU   PSARSVTE+8                                               02640000
PSANSTK  EQU   PSARSVTE+4                                               02641000
PSACSTK  EQU   PSARSVTE                                                 02642000
@NM00093 EQU   ERBPARMI+7                                               02643000
@NM00083 EQU   MSGFLAGS                                                 02644000
SAVER12  EQU   SAVEFORM+68                                              02645000
SAVER11  EQU   SAVEFORM+64                                              02646000
SAVER10  EQU   SAVEFORM+60                                              02647000
SAVER9   EQU   SAVEFORM+56                                              02648000
SAVER8   EQU   SAVEFORM+52                                              02649000
SAVER7   EQU   SAVEFORM+48                                              02650000
SAVER6   EQU   SAVEFORM+44                                              02651000
SAVER5   EQU   SAVEFORM+40                                              02652000
SAVER4   EQU   SAVEFORM+36                                              02653000
SAVER3   EQU   SAVEFORM+32                                              02654000
SAVER2   EQU   SAVEFORM+28                                              02655000
SAVER1   EQU   SAVEFORM+24                                              02656000
SAVER0   EQU   SAVEFORM+20                                              02657000
SAVENEXT EQU   SAVEFORM+8                                               02658000
SAVENAME EQU   SAVEFORM+1                                               02659000
SAVEID   EQU   SAVEFORM                                                 02660000
REGL15   EQU   REGLOCAL+60                                              02661000
REGL14   EQU   REGLOCAL+56                                              02662000
REGL13   EQU   REGLOCAL+52                                              02663000
REGL12   EQU   REGLOCAL+48                                              02664000
REGL11   EQU   REGLOCAL+44                                              02665000
REGL10   EQU   REGLOCAL+40                                              02666000
REGL9    EQU   REGLOCAL+36                                              02667000
REGL8    EQU   REGLOCAL+32                                              02668000
REGL7    EQU   REGLOCAL+28                                              02669000
REGL6    EQU   REGLOCAL+24                                              02670000
REGL5    EQU   REGLOCAL+20                                              02671000
REGL4    EQU   REGLOCAL+16                                              02672000
REGL3    EQU   REGLOCAL+12                                              02673000
REGL2    EQU   REGLOCAL+8                                               02674000
REGL1    EQU   REGLOCAL+4                                               02675000
REGL0    EQU   REGLOCAL                                                 02676000
SDLSPN   EQU   SDL+1                                                    02677000
SDLNUM   EQU   SDL                                                      02678000
VCTVCCTV EQU   VCCT+108                                                 02679000
VCTCCTV  EQU   VCCT+104                                                 02680000
@NM00054 EQU   VCCT+102                                                 02681000
VCTEXTRA EQU   VCCT+100                                                 02682000
VCTSVCTB EQU   VCCT+92                                                  02683000
VCTPGT   EQU   VCCT+88                                                  02684000
VCTLPA   EQU   VCCT+84                                                  02685000
VCTCBADR EQU   VCCT+80                                                  02686000
VCTJBNME EQU   VCCT+72                                                  02687000
VCTCBIDN EQU   VCTCBID+7                                                02688000
@NM00053 EQU   VCTCBID                                                  02689000
VCTAUDIT EQU   VCCT+62                                                  02690000
VCTASID  EQU   VCCT+60                                                  02691000
VCTPTRT  EQU   VCCT+56                                                  02692000
VCTMASCB EQU   VCCT+52                                                  02693000
VCTASCB  EQU   VCCT+48                                                  02694000
VCTCPUC  EQU   VCCT+46                                                  02695000
VCTWKC   EQU   VCCT+45                                                  02696000
VCTWKHI  EQU   VCCT+44                                                  02697000
VCTSUBPL EQU   VCCT+40                                                  02698000
VCTARB   EQU   VCCT+36                                                  02699000
VCTIODB  EQU   VCCT+32                                                  02700000
VCTBCTC  EQU   VCCT+28                                                  02701000
VCTSTOR  EQU   VCCT+16                                                  02702000
VCTRECVA EQU   VCCT+10                                                  02703000
@NM00052 EQU   VCTFLGS                                                  02704000
VCTNOI22 EQU   VCTFLGS                                                  02705000
VCTLRCLM EQU   VCTFLGS                                                  02706000
VCTARCLM EQU   VCTFLGS                                                  02707000
VCTASMIC EQU   VCTFLGS                                                  02708000
VCTMEMIN EQU   VCTFLGS                                                  02709000
VCTSADMP EQU   VCTFLGS                                                  02710000
@NM00051 EQU   VCTRECSN                                                 02711000
VCTRSMR  EQU   VCTRECSN                                                 02712000
VCTEXIR  EQU   VCTRECSN                                                 02713000
VCTUPDR  EQU   VCTRECSN                                                 02714000
VCTPGIR  EQU   VCTRECSN                                                 02715000
VCTRCB   EQU   VCCT+4                                                   02716000
VCTVCT   EQU   VCCT                                                     02717000
RCBBASE  EQU   RCB+16                                                   02718000
RCBEXIT  EQU   RCB+12                                                   02719000
RCBSAVE  EQU   RCB+8                                                    02720000
RCBSTOR  EQU   RCB+4                                                    02721000
RCBNEXT  EQU   RCB                                                      02722000
PTRTVS   EQU   PTRT+1032                                                02723000
PTRTRS   EQU   PTRT+8                                                   02724000
PTRTLGID EQU   PTRT+4                                                   02725000
PTRTPTRT EQU   PTRT                                                     02726000
PSWEND   EQU   PSW+8                                                    02727000
PSWIA    EQU   PSW+4                                                    02728000
PSWSP    EQU   @NM00050                                                 02729000
PSWSIG   EQU   PSWCCPM                                                  02730000
PSWEU    EQU   PSWCCPM                                                  02731000
PSWDO    EQU   PSWCCPM                                                  02732000
PSWFPO   EQU   PSWCCPM                                                  02733000
@NM00049 EQU   PSWCCPM                                                  02734000
@NM00048 EQU   PSWCCPM                                                  02735000
PSWPRBLM EQU   @NM00047                                                 02736000
PSWAIT   EQU   @NM00047                                                 02737000
PSWMCH   EQU   @NM00047                                                 02738000
PSWMODE  EQU   @NM00047                                                 02739000
PSWKEY   EQU   @NM00047                                                 02740000
PSWXTRNL EQU   PSWSM                                                    02741000
PSWIO    EQU   PSWSM                                                    02742000
PSWDAT   EQU   PSWSM                                                    02743000
@NM00046 EQU   PSWSM                                                    02744000
@NM00045 EQU   PSWSM                                                    02745000
@NM00044 EQU   PSWSM                                                    02746000
PSWPER   EQU   PSWSM                                                    02747000
@NM00043 EQU   PSWSM                                                    02748000
@NM00042 EQU   MDCB+87                                                  02749000
@NM00041 EQU   MDCBFLGS                                                 02750000
MDCBDUMP EQU   MDCBFLGS                                                 02751000
MDCBASMI EQU   MDCBFLGS                                                 02752000
MDCBPI   EQU   MDCB+84                                                  02753000
MDCBSTOR EQU   MDCB+80                                                  02754000
MDCBGR15 EQU   MDCBGRS+60                                               02755000
MDCBGR14 EQU   MDCBGRS+56                                               02756000
MDCBGR13 EQU   MDCBGRS+52                                               02757000
MDCBGR12 EQU   MDCBGRS+48                                               02758000
MDCBGR11 EQU   MDCBGRS+44                                               02759000
MDCBGR10 EQU   MDCBGRS+40                                               02760000
MDCBGR9  EQU   MDCBGRS+36                                               02761000
MDCBGR8  EQU   MDCBGRS+32                                               02762000
MDCBGR7  EQU   MDCBGRS+28                                               02763000
MDCBGR6  EQU   MDCBGRS+24                                               02764000
MDCBGR5  EQU   MDCBGRS+20                                               02765000
MDCBGR4  EQU   MDCBGRS+16                                               02766000
MDCBGR3  EQU   MDCBGRS+12                                               02767000
MDCBGR2  EQU   MDCBGRS+8                                                02768000
MDCBGR1  EQU   MDCBGRS+4                                                02769000
MDCBGR0  EQU   MDCBGRS                                                  02770000
MDCBPSW  EQU   MDCB+8                                                   02771000
MDCBNEXT EQU   MDCB+4                                                   02772000
MDCBMDCB EQU   MDCB                                                     02773000
MDCEAVIL EQU   MDCE+8                                                   02774000
MDCEACTV EQU   MDCE+4                                                   02775000
MDCEMDCE EQU   MDCE                                                     02776000
IODBR    EQU   IODBCCHH+7                                               02777000
IODBHH   EQU   IODBSRCH+2                                               02778000
IODBCC   EQU   IODBSRCH                                                 02779000
IODBSEEK EQU   IODBCCHH+1                                               02780000
IODBM    EQU   IODBCCHH                                                 02781000
IODBCPU  EQU   IODB+14                                                  02782000
IODBTYPE EQU   IODB+13                                                  02783000
IODBCLAS EQU   IODB+12                                                  02784000
@NM00040 EQU   IODBFLAG+1                                               02785000
IODBCONW EQU   IODBFLAG                                                 02786000
IODBHALT EQU   IODBFLAG                                                 02787000
IODBINT  EQU   IODBFLAG                                                 02788000
IODBIDEN EQU   IODB+4                                                   02789000
IODBIODB EQU   IODB                                                     02790000
DSCETEND EQU   DSCE+20                                                  02791000
DSCETCUR EQU   DSCE+16                                                  02792000
DSCETBEG EQU   DSCE+12                                                  02793000
DSCENEXT EQU   DSCE+8                                                   02794000
DSCEBEGN EQU   DSCE+4                                                   02795000
DSCEDSCE EQU   DSCE                                                     02796000
CSWCNT   EQU   CSW+6                                                    02797000
CSWCE    EQU   CSWUSTAT                                                 02798000
CSWCUE   EQU   CSWUSTAT                                                 02799000
CSWSTMOD EQU   CSWUSTAT                                                 02800000
@NM00039 EQU   CSWKEY00                                                 02801000
CSWKEY   EQU   CSWKEY00                                                 02802000
CCWCNT   EQU   CCW+6                                                    02803000
@NM00038 EQU   CCW+5                                                    02804000
@NM00037 EQU   CCWFLAGS                                                 02805000
CCWIDA   EQU   CCWFLAGS                                                 02806000
CCWSKIP  EQU   CCWFLAGS                                                 02807000
CCWSLI   EQU   CCWFLAGS                                                 02808000
CCWCC    EQU   CCWFLAGS                                                 02809000
CCWDC    EQU   CCWFLAGS                                                 02810000
CTHWMAX  EQU   CTDMPTYP+29                                              02811000
CTHWM    EQU   CTDMPTYP+28                                              02812000
CTPRMT2X EQU   CTPRMT2+1                                                02813000
CTPRMT2Y EQU   CTPRMT2                                                  02814000
CTPRMT1X EQU   CTPRMT1+1                                                02815000
CTPRMT1Y EQU   CTPRMT1                                                  02816000
CTVCCT   EQU   CTDMPTYP+20                                              02817000
CTEOR    EQU   CTDMPTYP+16                                              02818000
CTCOMMIO EQU   CTDMPTYP+12                                              02819000
CTLWKAD  EQU   CTDMPTYP+8                                               02820000
CTCONSOL EQU   CTDMPTYP+4                                               02821000
@NM00036 EQU   CTBUFTYP                                                 02822000
CTDUMP   EQU   CTBUFTYP                                                 02823000
CTLSQA   EQU   CTBUFTYP                                                 02824000
CTASM    EQU   CTBUFTYP                                                 02825000
CTPGT    EQU   CTBUFTYP                                                 02826000
CTWKFLE  EQU   CTBUFTYP                                                 02827000
@NM00035 EQU   CTBUFTYP                                                 02828000
@NM00034 EQU   CTCONFLG                                                 02829000
CTREAD   EQU   CTCONFLG                                                 02830000
@NM00033 EQU   CTDMPTYP+1                                               02831000
@NM00032 EQU   CTIOTYPE                                                 02832000
CTIORSET EQU   CTIOTYPE                                                 02833000
CTIOINT  EQU   CTIOTYPE                                                 02834000
CTIOCON  EQU   CTIOTYPE                                                 02835000
CTIOTERM EQU   CTIOTYPE                                                 02836000
CTEBCOPR EQU   CCT+49                                                   02837000
@NM00031 EQU   CTLOWFLG                                                 02838000
CTWKSTUS EQU   CTLOWFLG                                                 02839000
CTINIT   EQU   CTLOWFLG                                                 02840000
CTFP     EQU   CTLOWFLG                                                 02841000
CTVIRTD  EQU   CTLOWFLG                                                 02842000
CTEBCOPD EQU   CCT+45                                                   02843000
CTCONTYP EQU   CCT+44                                                   02844000
CTOUTAD  EQU   CCT+42                                                   02845000
CTCPUI   EQU   CCT+40                                                   02846000
CTERBCON EQU   CCT+36                                                   02847000
CTCCHHW  EQU   CCT+24                                                   02848000
CTCCHHE  EQU   CCT+20                                                   02849000
CTCCHHS  EQU   CCT+16                                                   02850000
CTPGECNT EQU   CCT+15                                                   02851000
CTCCHHR  EQU   CCT+8                                                    02852000
CTINADDR EQU   CCT+6                                                    02853000
CTSENSE  EQU   CCT+4                                                    02854000
CTDEVTYP EQU   CCT+3                                                    02855000
@NM00030 EQU   CTFLG2                                                   02856000
CTALTCON EQU   CTFLG2                                                   02857000
CTWKDONE EQU   CTFLG2                                                   02858000
CTVIRTR  EQU   CTFLG2                                                   02859000
CTNOSTAT EQU   CTFLG2                                                   02860000
CTPGEFLT EQU   CTFLG2                                                   02861000
CTSTOR   EQU   CTFLG2                                                   02862000
CTDUPSW  EQU   CTFLG2                                                   02863000
CTERREC  EQU   CTFLG1                                                   02864000
CTMP     EQU   CTFLG1                                                   02865000
@NM00029 EQU   CTFLG1                                                   02866000
CTDEFO   EQU   CTFLG1                                                   02867000
CTWORK   EQU   CTFLG1                                                   02868000
CTMORTPE EQU   CTFLG1                                                   02869000
CTDEVICE EQU   CTFLG1                                                   02870000
CTERROR  EQU   CTFLG1                                                   02871000
@NM00028 EQU   BCT+46                                                   02872000
BCTRECLM EQU   BCTFLGI                                                  02873000
BCTALLOC EQU   BCTFLGI                                                  02874000
@NM00027 EQU   BCTFLGT                                                  02875000
BCTPGTF  EQU   BCTFLGT                                                  02876000
BCTDUMP  EQU   BCTFLGT                                                  02877000
BCTLSQA  EQU   BCTFLGT                                                  02878000
BCTASM   EQU   BCTFLGT                                                  02879000
BCTPGT   EQU   BCTFLGT                                                  02880000
BCTWKFLE EQU   BCTFLGT                                                  02881000
@NM00026 EQU   BCTFLGT                                                  02882000
BCTRBA   EQU   BCT+40                                                   02883000
BCTAMB   EQU   BCT+36                                                   02884000
@NM00025 EQU   BCTLPID+4                                                02885000
BCTLGN   EQU   BCTLPID                                                  02886000
BCTMDCB  EQU   BCT+24                                                   02887000
BCTPGTE  EQU   BCT+20                                                   02888000
BCTRADDR EQU   BCT+16                                                   02889000
BCTVADDR EQU   BCT+12                                                   02890000
BCTASID  EQU   BCT+10                                                   02891000
BCTKEY2  EQU   BCT+9                                                    02892000
BCTKEY1  EQU   BCT+8                                                    02893000
BCTNEXT  EQU   BCT+4                                                    02894000
BCTBCT   EQU   BCT                                                      02895000
BCTHLAST EQU   BCTH+8                                                   02896000
BCTHFRST EQU   BCTH+4                                                   02897000
BCTHBCTH EQU   BCTH                                                     02898000
ARBADDRE EQU   ARB+4                                                    02899000
ARBADDRB EQU   ARB                                                      02900000
GTMSAVE  EQU   SADMPLSD+684                                             02901000
GTMNAME  EQU   SADMPLSD+680                                             02902000
FRMSAVE  EQU   SADMPLSD+580                                             02903000
FRMNAME  EQU   SADMPLSD+576                                             02904000
AUDSAVE  EQU   SADMPLSD+476                                             02905000
AUDNAME  EQU   SADMPLSD+472                                             02906000
IOISAVE  EQU   SADMPLSD+372                                             02907000
IOINAME  EQU   SADMPLSD+368                                             02908000
PGISAVE  EQU   SADMPLSD+268                                             02909000
PGINAME  EQU   SADMPLSD+264                                             02910000
SVISAVE  EQU   SADMPLSD+164                                             02911000
SVINAME  EQU   SADMPLSD+160                                             02912000
LOWCRS   EQU   SADMPLSD+96                                              02913000
LOWGRS   EQU   SADMPLSD+32                                              02914000
SAVEDUMP EQU   SADMPLSD+24                                              02915000
AUDPSW   EQU   SADMPLSD+16                                              02916000
SVIRPSW  EQU   SADMPLSD+8                                               02917000
PSWSADMP EQU   SADMPLSD                                                 02918000
@NM00024 EQU   PSA+3668                                                 02919000
PSASTAK  EQU   PSA+3072                                                 02920000
@NM00023 EQU   PSA+1040                                                 02921000
PSAUSEND EQU   PSA+1040                                                 02922000
PSARV062 EQU   PSA+1036                                                 02923000
PSAATCVT EQU   PSA+1032                                                 02924000
PSAPCPSW EQU   PSA+1024                                                 02925000
PSAPIR2  EQU   PSA+1020                                                 02926000
PSARV059 EQU   PSA+1018                                                 02927000
PSASVC13 EQU   PSA+1016                                                 02928000
PSALSFCC EQU   PSA+1012                                                 02929000
PSASFACC EQU   PSA+1008                                                 02930000
PSASTOP  EQU   PSA+992                                                  02931000
PSASTART EQU   PSA+976                                                  02932000
PSARSPSW EQU   PSA+968                                                  02933000
PSASRPSW EQU   PSA+960                                                  02934000
PSARV045 EQU   PSA+892                                                  02935000
PSARV044 EQU   PSA+888                                                  02936000
PSARV043 EQU   PSA+884                                                  02937000
PSARV042 EQU   PSA+880                                                  02938000
PSARV041 EQU   PSA+876                                                  02939000
PSARV040 EQU   PSA+872                                                  02940000
PSARV025 EQU   PSA+868                                                  02941000
PSADSSED EQU   PSA+868                                                  02942000
PSADSSPR EQU   PSA+864                                                  02943000
PSADSSFW EQU   PSA+860                                                  02944000
PSADSS14 EQU   PSA+856                                                  02945000
PSADSSPP EQU   PSA+848                                                  02946000
PSADSSRP EQU   PSA+840                                                  02947000
PSADSS05 EQU   PSADSSF4                                                 02948000
PSADSS10 EQU   PSADSSF4                                                 02949000
PSADSSVE EQU   PSADSSF4                                                 02950000
PSADSSDE EQU   PSADSSF4                                                 02951000
PSADSSC0 EQU   PSADSSF4                                                 02952000
PSADSSIE EQU   PSADSSF4                                                 02953000
PSADSS12 EQU   PSADSSF4                                                 02954000
PSADSSRC EQU   PSADSSF4                                                 02955000
PSARV057 EQU   PSADSSF3                                                 02956000
PSARV056 EQU   PSADSSF3                                                 02957000
PSARV055 EQU   PSADSSF3                                                 02958000
PSADSSMC EQU   PSADSSF3                                                 02959000
PSADSSRW EQU   PSADSSF3                                                 02960000
PSADSSNM EQU   PSADSSF3                                                 02961000
PSADSSES EQU   PSADSSF3                                                 02962000
PSADSSGP EQU   PSADSSF3                                                 02963000
PSADSSF2 EQU   PSADSSFL+1                                               02964000
PSADSSPI EQU   PSADSSF1                                                 02965000
PSADSSOI EQU   PSADSSF1                                                 02966000
PSADSSSP EQU   PSADSSF1                                                 02967000
PSADSSTP EQU   PSADSSF1                                                 02968000
PSADSSDW EQU   PSADSSF1                                                 02969000
PSADSSDD EQU   PSADSSF1                                                 02970000
PSADSSDM EQU   PSADSSF1                                                 02971000
PSADSSMV EQU   PSADSSF1                                                 02972000
PSADSSTS EQU   PSA+816                                                  02973000
PSADSSWK EQU   PSA+812                                                  02974000
PSADSSR3 EQU   PSA+808                                                  02975000
PSADSSR2 EQU   PSA+804                                                  02976000
PSADSSRS EQU   PSA+800                                                  02977000
PSASTOR  EQU   PSA+796                                                  02978000
PSACPUSA EQU   PSA+794                                                  02979000
PSAVSTAP EQU   PSA+792                                                  02980000
PSAWKVAP EQU   PSA+788                                                  02981000
PSAWKRAP EQU   PSA+784                                                  02982000
PSAMCHIC EQU   PSA+783                                                  02983000
PSARV061 EQU   PSA+782                                                  02984000
PSASYMSK EQU   PSA+781                                                  02985000
PSAMCHFL EQU   PSA+780                                                  02986000
PSACR0   EQU   PSA+776                                                  02987000
PSAPSWSV EQU   PSA+768                                                  02988000
PSALITA  EQU   PSA+764                                                  02989000
PSACLHS  EQU   PSAHLHI                                                  02990000
PSALKR15 EQU   PSALKSA+60                                               02991000
PSALKR14 EQU   PSALKSA+56                                               02992000
PSALKR13 EQU   PSALKSA+52                                               02993000
PSALKR12 EQU   PSALKSA+48                                               02994000
PSALKR11 EQU   PSALKSA+44                                               02995000
PSALKR10 EQU   PSALKSA+40                                               02996000
PSALKR9  EQU   PSALKSA+36                                               02997000
PSALKR8  EQU   PSALKSA+32                                               02998000
PSALKR7  EQU   PSALKSA+28                                               02999000
PSALKR6  EQU   PSALKSA+24                                               03000000
PSALKR5  EQU   PSALKSA+20                                               03001000
PSALKR4  EQU   PSALKSA+16                                               03002000
PSALKR3  EQU   PSALKSA+12                                               03003000
PSALKR2  EQU   PSALKSA+8                                                03004000
PSALKR1  EQU   PSALKSA+4                                                03005000
PSALKR0  EQU   PSALKSA                                                  03006000
PSARV023 EQU   PSACLHT+52                                               03007000
PSALOCAL EQU   PSACLHT+48                                               03008000
PSACMSL  EQU   PSACLHT+44                                               03009000
PSAOPTL  EQU   PSACLHT+40                                               03010000
PSATPACL EQU   PSACLHT+36                                               03011000
PSATPDNL EQU   PSACLHT+32                                               03012000
PSATPNCL EQU   PSACLHT+28                                               03013000
PSAIOSLL EQU   PSACLHT+24                                               03014000
PSAIOSUL EQU   PSACLHT+20                                               03015000
PSAIOSCL EQU   PSACLHT+16                                               03016000
PSAIOSSL EQU   PSACLHT+12                                               03017000
PSASALCL EQU   PSACLHT+8                                                03018000
PSAASML  EQU   PSACLHT+4                                                03019000
PSADISPL EQU   PSACLHT                                                  03020000
PSASRSA  EQU   PSA+636                                                  03021000
PSARV050 EQU   PSA+634                                                  03022000
PSADSSGO EQU   PSA+633                                                  03023000
PSARECUR EQU   PSA+632                                                  03024000
PSAHLHIS EQU   PSA+628                                                  03025000
PSAIPCSA EQU   PSA+624                                                  03026000
@NM00022 EQU   PSA+621                                                  03027000
PSAIPCDM EQU   PSA+620                                                  03028000
PSAIPCD  EQU   PSA+616                                                  03029000
@NM00021 EQU   PSA+613                                                  03030000
PSAIPCRM EQU   PSA+612                                                  03031000
PSAIPCR  EQU   PSA+608                                                  03032000
PSAMCHEX EQU   PSA+600                                                  03033000
PSAMPSW  EQU   PSA+592                                                  03034000
PSAEXPS2 EQU   PSA+584                                                  03035000
PSAEXPS1 EQU   PSA+576                                                  03036000
PSAPIREG EQU   PSA+572                                                  03037000
PSARSREG EQU   PSA+568                                                  03038000
PSAGPREG EQU   PSA+556                                                  03039000
PSARV022 EQU   PSASUP4                                                  03040000
PSARV021 EQU   PSASUP4                                                  03041000
PSARV020 EQU   PSASUP4                                                  03042000
PSARV019 EQU   PSASUP4                                                  03043000
PSARV018 EQU   PSASUP4                                                  03044000
PSARV017 EQU   PSASUP4                                                  03045000
PSARV016 EQU   PSASUP4                                                  03046000
PSARV015 EQU   PSASUP4                                                  03047000
PSARV014 EQU   PSASUP3                                                  03048000
PSARV013 EQU   PSASUP3                                                  03049000
PSARV012 EQU   PSASUP3                                                  03050000
PSARV011 EQU   PSASUP3                                                  03051000
PSARV010 EQU   PSASUP3                                                  03052000
PSAPSREG EQU   PSASUP3                                                  03053000
PSAPI2   EQU   PSASUP3                                                  03054000
PSAIOSUP EQU   PSASUP3                                                  03055000
PSALCR   EQU   PSASUP2                                                  03056000
PSARTM   EQU   PSASUP2                                                  03057000
PSAACR   EQU   PSASUP2                                                  03058000
PSAIPCE2 EQU   PSASUP2                                                  03059000
PSAIPCES EQU   PSASUP2                                                  03060000
PSAIPCEC EQU   PSASUP2                                                  03061000
PSAGTF   EQU   PSASUP2                                                  03062000
PSAIPCRI EQU   PSASUP2                                                  03063000
PSAIPCRP EQU   PSASUP1                                                  03064000
PSAIPCDR EQU   PSASUP1                                                  03065000
PSADISP  EQU   PSASUP1                                                  03066000
PSALOCK  EQU   PSASUP1                                                  03067000
PSAPI    EQU   PSASUP1                                                  03068000
PSAEXT   EQU   PSASUP1                                                  03069000
PSASVC   EQU   PSASUP1                                                  03070000
PSAIO    EQU   PSASUP1                                                  03071000
PSAAOLD  EQU   PSA+548                                                  03072000
PSAANEW  EQU   PSA+544                                                  03073000
PSATOLD  EQU   PSA+540                                                  03074000
PSATNEW  EQU   PSA+536                                                  03075000
PSALCCAR EQU   PSA+532                                                  03076000
PSALCCAV EQU   PSA+528                                                  03077000
PSAPCCAR EQU   PSA+524                                                  03078000
PSAPCCAV EQU   PSA+520                                                  03079000
PSACPULA EQU   PSA+518                                                  03080000
PSACPUPA EQU   PSA+516                                                  03081000
PSAPSA   EQU   PSA+512                                                  03082000
FLCHDEND EQU   PSA+512                                                  03083000
FLCCRSAV EQU   FLCMCLA+280                                              03084000
FLCGRSAV EQU   FLCMCLA+216                                              03085000
FLCFPSAV EQU   FLCMCLA+184                                              03086000
FLCFLA   EQU   FLCMCLA+88                                               03087000
FLCRGNCD EQU   FLCMCLA+84                                               03088000
FLCFSAA  EQU   FLCFSA+1                                                 03089000
@NM00020 EQU   FLCFSA                                                   03090000
@NM00019 EQU   FLCMCLA+72                                               03091000
FLCMCIC  EQU   FLCMCLA+64                                               03092000
@NM00018 EQU   FLCMCLA+20                                               03093000
@NM00017 EQU   FLCIOA                                                   03094000
@NM00016 EQU   FLCMCLA+15                                               03095000
@NM00015 EQU   FLCMCLA+14                                               03096000
@NM00014 EQU   FLCMCLA+12                                               03097000
FLCLCL   EQU   FLCMCLA+8                                                03098000
FLCIOELA EQU   FLCIOEL+1                                                03099000
@NM00013 EQU   FLCIOEL                                                  03100000
FLCCHNID EQU   FLCMCLA                                                  03101000
@NM00012 EQU   PSA+160                                                  03102000
FLCMTRCD EQU   PSA+157                                                  03103000
@NM00011 EQU   PSA+156                                                  03104000
FLCPERA  EQU   FLCPER+1                                                 03105000
@NM00010 EQU   FLCPER                                                   03106000
@NM00009 EQU   PSA+151                                                  03107000
FLCPERCD EQU   PSA+150                                                  03108000
FLCMCNUM EQU   PSA+149                                                  03109000
@NM00008 EQU   PSA+148                                                  03110000
FLCTEAA  EQU   FLCTEA+1                                                 03111000
@NM00007 EQU   FLCTEA                                                   03112000
PSAPIPC  EQU   PSAPICOD                                                 03113000
PSAPIMC  EQU   PSAPICOD                                                 03114000
PSAPIPER EQU   PSAPICOD                                                 03115000
PSARV049 EQU   FLCPICOD                                                 03116000
FLCPILCB EQU   FLCPIILC                                                 03117000
@NM00006 EQU   FLCPIILC                                                 03118000
@NM00005 EQU   PSAEPPSW                                                 03119000
FLCSVCN  EQU   PSAESPSW+2                                               03120000
FLCSILCB EQU   FLCSVILC                                                 03121000
@NM00004 EQU   FLCSVILC                                                 03122000
@NM00003 EQU   PSAESPSW                                                 03123000
FLCEICOD EQU   PSAEEPSW+2                                               03124000
PSASPAD  EQU   PSAEEPSW                                                 03125000
@NM00002 EQU   PSA+128                                                  03126000
FLCMNPSW EQU   PSA+112                                                  03127000
FLCPNPSW EQU   PSA+104                                                  03128000
FLCSNPSW EQU   PSA+96                                                   03129000
FLCENPSW EQU   PSA+88                                                   03130000
FLCTRACE EQU   PSA+84                                                   03131000
FLCTIMER EQU   PSA+80                                                   03132000
FLCCVT2  EQU   PSA+76                                                   03133000
FLCMOPSW EQU   PSA+48                                                   03134000
FLCPOPSW EQU   PSA+40                                                   03135000
FLCSOPSW EQU   PSA+32                                                   03136000
FLCEOPSW EQU   PSA+24                                                   03137000
@NM00001 EQU   FLCICCW2+4                                               03138000
FLCCVT   EQU   FLCICCW2                                                 03139000
FLCICCW1 EQU   FLCROPSW                                                 03140000
FLCIPPSW EQU   FLCRNPSW                                                 03141000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      03142000
@RT00293 EQU   REPRO                                                    03143000
@RF00293 EQU   REPEATOP                                                 03144000
@RT00301 EQU   RC0                                                      03145000
@RF00352 EQU   NEWTAPEM                                                 03146000
@RT00430 EQU   REPRO                                                    03147000
@RT00433 EQU   REPEATOP                                                 03148000
@RT00451 EQU   REPRO                                                    03149000
@RT00472 EQU   RC0                                                      03150000
@RC00489 EQU   NEWTAPEM                                                 03151000
@RT00522 EQU   NEWTAPE                                                  03152000
@RF00558 EQU   RETEST                                                   03153000
@RT00562 EQU   TERMEXIT                                                 03154000
@RT00567 EQU   PTERM                                                    03155000
@RT00580 EQU   PTERM                                                    03156000
@RT00594 EQU   REPEATOP                                                 03157000
@RF00607 EQU   PTERM                                                    03158000
@RT00618 EQU   RUNONLY                                                  03159000
@RT00746 EQU   TIO1                                                     03160000
@RT00748 EQU   ERROR                                                    03161000
@RT00754 EQU   TIO1                                                     03162000
@RT00761 EQU   TIO2                                                     03163000
@RT00794 EQU   INRERR                                                   03164000
@RT00802 EQU   INRREP                                                   03165000
@RT00824 EQU   ENABWAIT                                                 03166000
@RT00845 EQU   ERBIDSET                                                 03167000
ERBRET   EQU   @EL00008                                                 03168000
@RF00848 EQU   ERBRET                                                   03169000
@ENDDATA EQU   *                                                        03170000
         END   AMDSATER,(C'PLS1917',0603,75153)                         03171000
