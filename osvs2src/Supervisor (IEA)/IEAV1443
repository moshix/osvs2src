         TITLE 'IEAV1443 - AOS/2 COMM TASK DEVICE SUPPORT PROCESSOR'    00050001
* PMBFA(A),PMBFAB(A),PJCLNSTA(C),PJCLNCON(A),EXCPDOZ(A)        @ZA05367 00093003
* EXCPDOWY(C),PJCLOSE(D),PJCLNSTA(D),CCWNOP(A),EQUATES(A)      @ZA05367 00095003
IEAV1443 CSECT                                                          00100001
* A 190024-190105                                              @ZA00873 00120003
* C 187766                                                     @ZM33331 00130003
* PMBF (C),PMBFA(A),PJOPNSTA(C),EXCPDOW(A)                     @ZA03882 00140003
* IOBCOR (C) - APPROX 303820                                   @ZA10145 00145003
* PMBFAB (C) APPROX 082577, 083650, PJECBINT (A) APPROX 194200 @ZA11907 00147003
* PJCLNCON (C) APPROX. 220500, PJCONTIN (C) APPROX. 235500     @ZA11907 00148003
* PMBF (C,A,D) APPROX. 082500-INVALID CLOSE PROC.              @ZA18112 00149003
*********************************************************************** 00150001
* STATUS                                                       @ZA18112 00200003
*   OS/VS2 REL3.7                                                       00230003
*                                                                       00300001
* FUNCTION                                                              00350001
*   THIS ROUTINE IS THE DEVICE SUPPORT PROCESSOR (DSP) FOR PRINTERS     00400001
*   (EXCLUDING ANR DEVICES) USED AS THE OUTPUT PORTION OF A COMPOSITE   00450001
*   CONSOLE OR AS AN OUTPUT-ONLY CONSOLE.  WHEN A PRINTER IS TO         00500001
*   BECOME AN OPERATOR CONSOLE THIS ROUTINE WILL RECEIVE CONTROL.       00550001
*   FOR THE FIRST ENTRY, THE OPEN/CLOSE SUBROUTINE WILL GETMAIN,        00600001
*   FORMAT, AND OPEN (TYPE=J) A DCB FOR OUTPUT.  SUCCESSIVE             00650001
*   ENTRIES OF THIS ROUTINE FOR OUTPUT WILL USE THIS DCB.               00700001
*   FOR OPEN/CLOSE PROCESSING, THIS MODULE ISSUES A NOP EXCP TO@ZA05367 00706003
*   TEST THE STATUS OF THE CONSOLE DEVICE BEFORE THE OPEN OR   @ZA05367 00712003
*   CLOSE MACROS ARE ISSUED. THIS IS DONE TO PREVENT THE OPEN  @ZA05367 00718003
*   OR CLOSE PROCESSORS FROM PUTTING THE COMMUNICATIONS TASK   @ZA05367 00724003
*   IN A WAIT STATE. IF THE CONSOLE DEVICE IS NOT READY AT     @ZA05367 00730003
*   OPEN OR CLOSE TIME, AN INTERVENTION REQUIRED MESSAGE AND   @ZA05367 00736003
*   A WAIT IS ISSUED UNTIL THE REQUIRED OPERATION IS STISFIED. @ZA05367 00742003
*                                                                       00750001
*   OUTPUT FOR THIS DEVICE IS QUEUED FROM THE UCM ENTRY CREATED         00800001
*   AT SYSGEN FOR THIS DEVICE.  USING BSAM WRITE AND CHECK              00850001
*   FACILITIES THE TEXT AREAS IN WQES QUEUED IN THE CONSOLE QUEUE       00900001
*   WILL BE OUTPUTTED.  THE ROUTINE SELECTS WQE'S FROM ITS              00950001
*   CONSOLE QUEUE AND ISSUES A WRITE OF THE TEXT AREA.  THEN THE        01000001
*   ROUTINE EXITS.  WHEN THE I/O OPERATION IS COMPLETE, THIS            01050001
*   ROUTINE REGAINS CONTROL AND ISSUES A CHECK MACRO INSTRUCTION        01100001
*   TO TEST THE STATUS OF THE I/O OPERATION.  IF THE I/O ECB            01150001
*   INDICATES THE OPERATION HAS FAILED, AN AUTOMATIC CONSOLE SWITCH IS  01200003
*   STARTED TO CAUSE THE CONSOLE FUNCTION OF THIS DEVICE TO BE          01250001
*   TRANSFERRED TO ITS ALTERNATE.                                       01300001
*                                                                       01350001
*   WHEN THE DEVICE IS TO BE REMOVED FROM CONSOLE STATUS, THIS          01400001
*   ROUTINE IS AGAIN ENTERED.  ANY OUTSTANDING OUTPUT IS ALLOWED        01450001
*   TO COMPLETE.  THEN THE DCB IS CLOSED AND FREEMAINED.  THE UCB       01500001
*   IS MARKED TO INDICATE THIS DEVICE IS NO LONGER A CONSOLE AND        01550001
*   THE ROUTINE EXITS.                                                  01600001
*                                                                       01650001
* ENTRY POINTS                                                          01700001
*         IEAV1443 - FROM THE MINI-ROUTER WHEN A 1443 OR SIMILAR TYPE   01750001
*                    PRINTER USED AS A CONSOLE NEEDS TO BE SERVICED.    01800001
*                                                                       01950001
* INPUT                                                                 02000001
*    PSW - KEY ZERO, SUPERVISOR MODE                                    02050002
*    REGS 0, 2-13, 15 IRRELEVANT                                        02150001
*    REG 1 - ADDRESS OF CXSA                                            02200001
*    REG 14 - RETURN ADDRESS                                            02250001
*    REG 15 - ENTRY POINT ADDRESS OF THIS MODULE                        02260002
*    IN THE CXSA:                                                       02300001
*                  CSANPTR - ADDRESS OF CSANAME                         02350001
*                  CSADCBP - ZERO                                       02400001
*                  CSANAME - IGC0107B                                   02450001
*                  CSAUCMA - ADDRESS OF THE UCM ENTRY                   02500001
*                  CSACTLM - ADDRESS OF THE UCM                         02550001
*                                                                       02600001
* OUTPUT                                                                02650001
*    SEE BELOW UNDER EXITS,NORMAL                                       02700001
*                                                                       02750001
* EXTERNAL REFERENCES                                                   02800001
*         GETMAIN - FOR A DCB, 18 WORD SAVE AREA, TIOT, JFCB, AND DECB  02850001
*         FREEMAIN - DCB, SAVE AREA, TIOT, JFCB, AND DECB               02900001
*         CHECK    - TO TEST THE STATUS OF A WRITE OPERATION            03100001
*         WRITE    - TO OUTPUT AN OPERATOR MESSAGE                      03150001
*         OPEN     - TO CONNECT TO THE CONSOLE DCB                      03200001
*         CLOSE    - TO DISCONNECT FROM THE CONSOLE DCB                 03250001
*         EXCP     - TO TEST STATUS OF DEVICE BEFORE OPEN      @ZA03882 03270003
*                                                                       03300001
* EXITS,NORMAL                                                          03350001
*    (1)  TO ISSUER OF SVC 72 VIA 'BR  14' WHEN WORK IS COMPLETE.       03400001
*         OUTPUT - PSW - ENABLED, KEY ZERO, SUPERVISOR MODE             03450001
*                - REGS 0-13, 15 - UNPREDICTABLE                        03500001
*                - REG 14        - RETURN ADDRESS                       03550001
*                - CXSA          - UNPREDICTABLE                        03600001
*                                                                       04000001
* EXITS,ERROR                                                           04050001
*         TO IEAVSWCH VIA BR 14 TO DO AN AUTOMATIC CONSOLE SWITCH       04060002
*         FROM THIS CONSOLE TO ITS ALTERNATE WHEN THIS CONSOLE          04070002
*         HAS A PERMANENT I/O ERROR OR IS UNABLE TO OPEN.               04080002
*         OUTPUT - PSW - ENABLED, KEY ZERO, SUPERVISOR MODE             04090002
*                - REGS 0, 2-13  - UNPREDICTABLE                        04092002
*                - REGS 1        - ADDRESS OF CXSA                      04094002
*                - REG 14        - RETURN ADDRESS                       04096002
*                - REG 15        - ADDRESS OF CONSOLE SWITCH     Y02752 04146002
*                                                                       04150001
* TABLES/WORK AREAS                                                     04200001
*    CVT, TCB, UCM, UCME, UCB, DCB, EIL, CXSA, TIOT, JFCB, DMX, CQE,    04250003
*    IOB, DEB                                                  @ZA03882 04260003
*                                                                       04300001
* ATTRIBUTES                                                            04350001
*    RE-ENTRANT, KEY ZERO, SUPERVISOR MODE, ENABLED/DISABLED            04400001
*    FOR AOS/2; TO RESIDE IN THE SYSTEM LPA, IN SYS1.LPALIB             04450001
*    THIS MODULE IS TO HAVE THE NAME IGC0107B.                          04500001
*    THE CONSOLE SWITCH ROUTINE IEAVSWCH IS TO HAVE THE NAME IGC0407B.  04550001
*                                                                       04600001
* CHARACTER CODE DEPENDENCY                                             04650001
*    THE LOCAL AND CMS LOCKS ARE OBTAINED TO SERIALIZE           Y02751 04700002
*                                                                       04750001
* NOTES                                                                 04800001
*    INCORPORATED SRBS: 438, 488                                        04850001
*                                                                       04860003
* CHANGE-ACTIVITY = ZA00873,ZA03882,ZA05367,ZA10145,ZA11907,ZA18112     04870003
*                                                                       04880003
*********************************************************************** 04900001
         EJECT                                                          04950001
*********************************************************************** 04960002
*   PREPARATORY ACTIVITY - SET UP ADDRESSABILITY FOR THIS MODULE,       05000001
*   THE CXSA, UCM ENTRY, DCB, GETMAIN SAVE AREA, OBTAIN LOCKS           05050002
*********************************************************************** 05060002
         SPACE 1                                                 Y02752 05070002
IGC0107B EQU   *                   MODULE ENTRY POINT            Y02752 05080002
         ENTRY IGC0107B            ENTRY NAME FOR LINK EDITOR    Y02752 05090002
         SPACE                                                          05100001
         LR    XC,XF               ESTABLISH ADDRESSABILITY      Y02752 05150002
         USING IEAV1443,XC         ESTABLISH ADDRESSABILITY      Y02752 05200002
         SPACE 1                                                 Y02893 05210002
         MODID                                                   Y02893 05220002
         SPACE 1                                                 Y02893 05230002
         LR    XB,X1               SAVE BASE SVRB XSA                   05250001
         USING CXSA,XB             CXSA ADDRESSABILITY                  05300001
         ST    XE,CSAXA            SAVE RETURN ADDR IN CSA       Y02893 05350002
         L     XA,CSAUCM           GET POINTER TO UCM ENTRY             05500001
         USING UCMLIST,XA          UCM ENTRY ADDRESSABILITY             05550001
         L     X9,UCMDCB           GET POINTER TO DCB                   05600001
         USING IHADCB,X9           DCB ADDRESSABILITY                   05650001
         SPACE 1                                                 Y02893 05700002
         GETMAIN R,SP=SVSP,LV=SVLN GET 18 WORD REG SAVE AREA     Y02893 05750002
         SPACE 1                                                 Y02893 05760002
         LR    XD,X1               POINT REG 13 TO SAVE AREA            05800001
         ST    XD,CSAXF            SAVE PTR TO REGSAVE AREA      Y02751 05802002
         L     X7,CSANPTR          GET PTR TO RECOVERY AREA      Y02753 05803002
         USING PARMLIST,X7         BASE THE RECOVERY PARMLIST    Y02753 05804002
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 05805002
         BZ    PMNESTAE            IF NOT, SKIP SETUP            Y02753 05806002
         MVC   CSAXB(EIGHT),PARMRTAD   SAVE ORIGINAL RETRY ADDR  Y02753 05807002
         LA    XF,P1443RTY         GET ADDR OF 1443S RETRY       Y02753 05808002
         ST    XF,PARMRTAD         MAKE ESTAE RETRY 1443S        Y02753 05809002
         SPACE 1                                                 Y02751 05810002
PMNESTAE DS    0H                                                Y02753 05815002
         BAL   XE,PGETLOCK         GO OBTAIN LOCAL AND CMS LOCKS Y02751 05820002
         EJECT                                                          05850001
*   DETERMINE WHY THIS MODULE WAS ENTERED.                              05900001
         SPACE                                                          05950001
PMCF     TM    UCMSTS,UCMCF        IS THIS A CLOSE REQUEST?             06000001
         BZ    PMBF                NO, CHECK STATUS OF DEVICE           06050001
         TM    UCMSTS,UCMPF+UCMBF  IS ANY OUTPUT PENDING?               06250001
*                                  OR IS THE DEVICE BUSY?               06300001
         BNZ   PMBF                YES, GO QUIESCE THE OUTPUT           06350001
         TM    UCMSDS5,UCMSDS5A    IS AN MLWTO BEING WAITED ON   Y02752 06400002
         BNZ   PMRETURN            IF YES, RETURN, DO NOT CLOSE  Y02752 06450002
         SPACE 1                                                 Y02752 06500002
*  A CLOSE IS PENDING AND ALL WORK IS CLEANED UP, GO CLOSE.      Y02752 06550002
         SPACE 1                                                 Y02752 06600002
         MVI   CSACODE,CSACLOSE    INDICATE CLOSE TO DO          Y02752 06650002
         B     PJSTART             GO TO OPEN/CLOSE ROUTINE.     Y02752 06700002
PMRETURN DS    0H                                                Y02752 06750002
         BAL   XE,PFRELOCK         GO FREE LOCAL AND CMS LOCKS   Y02751 06800002
         SPACE 1                                                 Y02751 06850002
PMRETRN1 DS    0H                  RETURN POINT WHEN UNLOCKED.   Y02751 06900002
         LR    X1,XD               REG 1 POINTS TO SAVE AREA     Y02751 07000002
         SPACE 1                                                 Y02751 07050002
         FREEMAIN R,SP=SVSP,LV=SVLN,A=(1)  FREE REG SAVE AREA    Y02893 07100002
         SPACE 1                                                 Y02752 07160002
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 07162002
         BNZ   PMRETRN2            IF NOT, SKIP RESTORATION      Y02753 07164002
         MVC   PARMRTAD(EIGHT),CSAXB   RESTORE ORIGINAL RETRY    Y02753 07166002
PMRETRN2 DS    0H                                                Y02753 07168002
         L     XE,CSAXA            RESTORE RETURN REGISTER       Y02752 07170002
         BR    XE                  RETURN TO CALLER              Y02752 07200002
         EJECT                                                          07650001
*    REGISTER USAGE FOR FOLLOWING CODE.....                             07700001
*                                                                       07710001
*   X2 - PTR TO TEXT AREA FOR THE WRITE.                                07720001
*   X3 - PTR TO MAJOR WQE FROM CQE ENTRY FIELD CQEWQEA.                 07730001
*   X5 - PTR TO LAST CQE ENTRY SERVICED, FIELD UCMWLAST                 07740001
*   X8 - PTR TO NEXT MINOR TEXT LINE TO BE WRITTEN, UCMMLAST.           07742001
*                                                                       07744001
         USING CQE,X5                                                   07746001
         SPACE                                                          07750001
PMBF     TM    UCMSTS,UCMBF        IS THE DEVICE BUSY?                  08050001
         BZ    PMAPF               NO, CHECK STATUS OF OPEN             08100001
         TM    UCMDEVC,UCMDEVE     IS I/O COMPLETE?                     08150001
         BZ    PMRETURN            NO, FREEMAIN & EXIT                  08200001
         NI    UCMDEVC,K255-UCMDEVE  TURN OFF I/O COMPLETE FLAG  Y02893 08250002
         TM    UCMSTS,UCMTA        OPEN PENDING SET ?          @ZA18112 08250103
         BO    PMBTSIO             YES, TEST STATUS OF I/O     @ZA18112 08250203
         TM    UCMSTS,UCMCF        CLOSE PENDING SET ?         @ZA18112 08250303
         BNO   PMBFF               NO, CONTINUE NORMAL I/O TEST@ZA18112 08250403
         L     X1,DCBSAVE          GET STORED ORIGINAL DCB ADDR@ZA18112 08250503
         LTR   X1,X1               DCB ADDR ZERO               @ZA18112 08250603
         BZ    PMBFF               YES, CHECK NORMAL I/O STATUS@ZA18112 08250703
* IF THE DCBSAVE FIELD IS NON-ZERO, THEN WE ARE PROCESSING     @ZA18112 08250803
* A NOP-EXCP CONDITION. THE SAVED DCB ADDRESS IN THIS CASE     @ZA18112 08250903
* IS THE ADDRESS OF THE ORIGINAL DCB UPON ENTRY TO THIS MODULE.@ZA18112 08251003
PMBTSIO  TM    DMDECB,IOBCD        WAS I/O SUCCESSFUL?         @ZA18112 08252503
         BO    PMBFAB              YES, CONTINUE NORMALLY      @ZA05367 08254003
         NI    UCMSTS,K255-UCMTA-UCMCF TURN OFF OPEN/CLOSE PEND@ZA03882 08254103
         NI    UCMSTS,K255-UCMBF   TURN OFF CONSOLE BUSY FLAG  @ZA05367 08254203
         XC    DMDECB,DMDECB       CLEAR I/O ECB               @ZA03882 08254303
         NI    UCMATR,K255-UCMAT04 TURN OFF DEVICE STATUS BITS @ZA03882 08254403
         OI    UCMATR,UCMUF        MARK UCME AS ACTIVE         @ZA03882 08254503
         BAL   XE,PFRELOCK         FREE LOCKS BEFORE CHECK     @ZA03882 08254603
         B     PMERRCK             CONSOLE SWITCH              @ZA03882 08254703
PMBFAB   BAL   XE,PFRELOCK         FREE LOCKS BEFORE CHECK     @ZA03882 08255603
         L     X1,DCBIOBAD         GET ADDR OF IOB             @ZA03882 08256103
         LA    X0,TEN              POINT TO                    @ZA03882 08256203
         SR    X1,X0               IOB PREFIX                  @ZA03882 08256303
         FREEMAIN R,SP=DMSP,LV=IOBCOR,A=(1) FREE IOB           @ZA03882 08256403
         L     X1,DCBDEBAD         GET ADDR OF DEB             @ZA03882 08256503
         LA    X0,TWN4             POINT TO                    @ZA03882 08256603
         SR    X1,X0               DEB PREFIX                  @ZA03882 08256703
         FREEMAIN R,SP=DMSP,LV=DEBCOR,A=(1) FREE DEB CORE      @ZA03882 08256803
         NI    UCMSTS,K255-UCMBF   TURN OFF DEVICE BUSY        @ZA03882 08256903
         TM    UCMSTS,UCMCF        CLOSE PENDING               @ZA05367 08257003
         BZ    PMBFABC             NO, CONTINUE OPEN           @ZA05367 08257103
         LR    X1,X9               SAVE EXCP DCB PTR           @ZA05367 08257203
         L     X9,DCBSAVE          GET ORIGINAL DCB PTR        @ZA05367 08257303
         ST    X9,UCMDCB           RESET ORIGINAL DCB PTR      @ZA05367 08257503
         FREEMAIN R,SP=DMSP,LV=DMCORE,A=(1) FREE EXCP DCB      @ZA05367 08257603
         B     PJECBINT            INIT ECB PTR,CONTINUE CLOSE @ZA11907 08257703
PMBFABC  SR    WORKR,WORKR         CLEAR WORK REGISTER         @ZA05367 08324003
         ST    WORKR,DCBIOBAD      ZERO IOB PTR IN DCB         @ZA03882 08344003
         ST    WORKR,DCBDEBAD      ZERO DEB PTR IN DCB         @ZA03882 08351003
         B     PJECBINT            INIT ECB PTR,CONT OPEN      @ZA11907 08365003
PMBFF    BAL   XE,PFRELOCK         FREE LOCKS BEFORE CHECK     @ZA03882 08372003
         LA    X1,DMDECB           GET POINTER TO I/O ECB               08400001
         LTR   X7,X7               IF THERE A RECOVERY AREA      Y02753 08402002
         BZ    PMBF1               IF NOT, SKIP FOOTPRINTING     Y02753 08404002
         OI    PARMFTPT,PCHECK     INDICATE CKECK FOR RECOVERY   Y02753 08406002
PMBF1    DS    0H                                                Y02753 08408002
         SPACE 1                                                 Y02893 08410002
         CHECK (1)                 CHECK PREVIOUS I/O OPERATION         08450001
         SPACE 1                                                 Y02893 08460002
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 08462002
         BZ    PMBF2               IF NOT, SKIP CLEARING FLAG    Y02753 08464002
         NI    PARMFTPT,K255-PCHECK    CLEAR CHECK FOOTPRINT     Y02753 08466002
PMBF2    DS    0H                                                Y02753 08468002
         BAL   XE,PGETLOCK         OBTAIN LOCKS BEFORE GOING ON  Y02751 08470002
         XC    DMDECB,DMDECB       CLEAR I/O ECB                        08500001
         NI    UCMSTS,K255-UCMBF   TURN OFF CONSOLE BUSY FLAG           08550001
         EJECT                                                          08570002
PMFWQE   L     X5,UCMWLAST         GET PTR TO LAST CQE ENTRY SERVICED   08600001
         LTR   X5,X5               HAS A K, C, D, ID COMMAND            08650001
*                                  CANCELLED THE STATUS DISPLAY?        08700001
         BZ    PMFWQEND            YES, RESTORE FOR WTO                 08750001
         TM    CQEFLAG,CQEMAJOR    IS THIS A MAJOR WQE FOR MLWTO?       08850001
         BZ    PMFWQEN1            NO, CQE ENTRY NO LONGER NEEDED       08900001
         TM    UCMSTS,UCMTC        IS CONSOLE STILL WORKING ON          08950001
*                                  AN INLINE MLWTO?                     09000001
         BZ    PMF1                NO, REDUCE USE COUNT                 09050001
         SR    X3,X3               CLEAR TOP BYTE FOR ICM               09100001
         ICM   X3,MASK7,CQEWQEA    BUFFER POINTED TO BY X3 IS MAJOR     09150001
         USING WQE,X3              WHICH MAY/NOT HAVE BEEN WRITTEN      09200001
         SPACE                                                          09250001
*  UCMMLAST POINTS TO THE MINOR HALF CONTAINING THE LINE JUST           09300001
*  WRITTEN, IF THE ADDRESS EXISTS.                                      09350001
         SPACE                                                          09400001
         NC    UCMMLAST(FOUR),UCMMLAST   WAS MINOR JUST WRITTEN?        09450001
         BNZ   PMF1                YES, GET NEXT TEXT LINE              09500001
         SPACE 1                                                 Y02893 09550002
*   THE MAJOR WQE HAS BEEN OUTPUTTED AND THE FIRST MINOR LINE           09600001
*   WILL BE SET FOR OUTPUT.                                             09650001
         SPACE                                                          09700001
PMF0     TM    WMJMLTYP,WMJMLTYD   IS THERE AN END LINE IN MAJOR?       09750001
         BO    PMFWQEND            YES, PURGE - DONT USE MINOR          09800001
         TM    WMJMMLW,WMJMMLWH    ANY TEXT LINES IN MINOR?             09850001
         BO    PMRET               NO, RETURN                           09900001
         SPACE 1                                                 Y02756 09910002
*    IF THE FIRST LINE OUT OF THE MAJOR IS CURRENTLY THE ONLY    Y02756 09920002
*    MINOR ON THE CHAIN AT THIS TIME, A TEST MUST BE MADE TO     Y02756 09930002
*    SEE IF PROCESSING IS SUSPENDED (FLAG WMJMDSPG), FOR IN      Y02756 09940002
*    CASE IT WOULD APPLY TO THIS MINOR.                          Y02756 09942002
         SPACE 1                                                 Y02756 09944002
         L     X8,WMJMMIN          GET PTR TO FIRST MINOR        Y02756 09946002
         NC    WMNMNX1-WMNM(L3,X8),WMNMNX1-WMNM(X8) IS THERE A   Y02756 09948002
*                                          NEXT MINOR AFTER THIS Y02756 09948402
         BNZ   PMF05               IF YES, BRANCH, THIS MINOR IS Y02756 09948802
*                                  NOT SUSPENDED.                Y02756 09949202
         TM    WMJMDSP,WMJMDSPG    IS PROCESSING SUSPENDED       Y02756 09949602
         BO    PMRET               IF SUSPENDED, RETURN          Y02756 09949702
         SPACE 1                                                 Y02756 09949802
PMF05    DS    0H                                                Y02756 09949902
         NI    CQEFLAG,K255-CQEATTOP     TURN OFF FLAG THAT MEANS:      09950001
*                                        'START AT TOP OF CHAIN'        10000001
         MVC   UCMMLAST(FOUR),WMJMMIN    NEXT MINOR TO BE WRITTEN       10050001
         B     PMLW3               GO WRITE THE LINE                    10100001
         DROP X3                                                        10110001
         EJECT                                                          10112002
         USING WQE,X8                                                   10120001
PMF1     L     X8,UCMMLAST         POINT TO NEXT TEXT LINE              10150001
         SR    X4,X4               SET UP REG FOR DECREMENT AND LTR     10250001
         IC    X4,WMNMUC1          GET USE COUNT IN THE MINOR           10300001
         BCTR  X4,ZERO             DECREMENT THE USE COUNT BY ONE       10350001
         STC   X4,WMNMUC1          STORE NEW USE COUNT                  10400001
         DROP  X8                  TEMPORARILY DROP LINE BASE           10450001
         USING WQE,X3                                                   10460001
         TM    UCMSTS,UCMTC        IS THE CONSOLE STILL WORKING         10500001
*                                  ON AN IN-LINE MLWTO?                 10550001
         BZ    PMFWQEND            NO, SO PURGE THE MLWTO               10600001
         LTR   X4,X4               IS THE MINOR'S USE COUNT ZERO?       10650001
         BNZ   PMF2                NO, ENABLE FOR INTERRUPTS            10700001
         SR    X3,X3               CLEAR TOP BYTE FOR ICM               10750001
         ICM   X3,MASK7,CQEWQEA    POINT TO MAJOR WQE                   10800001
         OI    WMJMMLW,WMJMMLWG    THIS CHAIN NEEDS DEQUEUE CLEAN UP    10900001
         OI    UCMSTS,UCMTB        TELL DEQUEUE TO CHECK MY QUEUE       11000001
         DROP  X3                  FINISHED WITH MAJOR WQE              11010001
         USING WQE,X8              RE-ESTABLISH MINOR LINE BASE         11100001
PMF2     DS    0H                                                Y02751 11110002
         TM    WMNMLT1,WMNMLT1D    IS THIS AN 'END' LINE?               11150001
         BO    PMFWQEND            YES, PURGE THE MLWTO                 11200001
PMF3     NC    WMNMNX1(THREE),WMNMNX1    DOES NEXT MINOR LINE EXIST?    11250001
         BZ    PMRET               NO, RETURN                           11300001
         SPACE 1                                                 Y02756 11350002
*    IF THIS IS THE CURRENTLY THE LAST MINOR ON THE CHAIN, A     Y02756 11360002
*    TEST MUST BE MADE TO SEE IF PROCESSING IS SUSPENDED (FLAG   Y02756 11370002
*    WMJMDSPG), FOR IN THIS CASE IT WOULD APPLY TO THIS MINOR.   Y02756 11380002
         SPACE 1                                                 Y02756 11390002
         ICM   X8,MASK7,WMNMNX1    PICK UP PTR TO NEW MINOR      Y02756 11392002
         NC    WMNMNX1,WMNMNX1     IS THERE A MINOR AFTER THIS   Y02756 11394002
         BNZ   PMLW3               IF YES, BRANCH, THIS MINOR IS Y02756 11396002
*                                  NOT SUSPENDED.                Y02756 11398002
         L     X3,CQEWQE           PICK UP PTR TO MAJOR          Y02756 11398402
         TM    WMJMDSP-WMJM(X3),WMJMDSPG IS PROCESSING SUSPENDED Y02756 11398802
         BO    PMRET               IF IT IS, RETURN              Y02756 11399202
         B     PMLW3               GO WRITE THAT NEXT MINOR LINE        11400001
PMF4     NC    UCMMLAST(FOUR),UCMMLAST   IS THERE A MINOR LINE?         11500001
         BZ    PMF5                NO, LAST LINE DONE WAS MAJOR         11550001
         L     X8,UCMMLAST         SET BASE FOR MINOR                   11600001
         B     PMF3                GET NEXT LINE POINTER                11650001
PMF5     L     X5,UCMWLAST         LOAD TEXT LINE POINTER               11700001
PMF6     ICM   X3,MASK7,CQEWQEA    GET MAJOR WQE POINTER                11800001
         B     PMF0                WORK WITH MAJOR WQE                  11850001
         EJECT                                                          11900001
PMRET    OI    UCMSDS5,UCMSDS5A    CONSOLE IS WAITING FOR MORE LINES    11950001
         NI    UCMSTS,K255-UCMPF   TURN OFF 'OUTPUT PENDING' FLAG       12000001
         B     PMRETURN            THIS MODULE HAS FINISHED ITS WORK    12050001
PMCOMEBK NI    UCMSDS5,K255-UCMSDS5A     NO LONGER WAITING              12100001
         L     X5,UCMWLAST         POINT TO CQE ENTRY                   12150001
         TM    CQEFLAG,CQEATTOP    IS CHAIN SEARCH TO START AT TOP?     12200001
         BZ    PMF4                NO, PROCEED NORMALLY                 12250001
         NI    CQEFLAG,K255-CQEATTOP    TURN OFF 'START AT TOP' FLAG    12300001
         B     PMF6                START CHAIN SEARCH AT TOP            12450001
         SPACE 2                                                 Y02756 12460002
*    THE WQE HAS BEEN MARKED FOR PURGING, DETERMINE IF IT IS     Y02756 12470002
*    A NORMAL OR A MLWTO MAJOR.                                  Y02756 12480002
         SPACE 1                                                 Y02756 12490002
PMWQEPRG DS    0H                                                Y02756 12492002
         TM    CQEFLAG,CQEMAJOR    IS WQE A MAJOR                Y02756 12494002
         BNO   PMFWQE              IF NOT A MAJOR, BRANCH        Y20756 12496002
         SPACE 1                                                 Y02756 12498002
PMFWQEND MVC   DCBBLKSI(TWO),H128  RESET DCB BLOCK SIZE TO 128          12500001
         NI    UCMSTS,K255-UCMTC   NO LONGER 'WORKING ON MLWTO'         12550001
         LTR   X5,X5               HAS K C,D,ID ALLOWED PURGE           12600001
*                                  TO TAKE PLACE?                       12650001
         BZ    PMAPF               YES, SEE WHAT ELSE TO DO             12700001
PMFWQEN1 OI    CQEFLAG,CQEAVAIL    THIS CQE ENTRY NO LONGER NEEDED      12800001
         OI    UCMSTS,UCMTB        CONSOLE Q NEEDS TO BE CONSOLIDATED   12850001
         NI    CQEFLAG,K255-CQEENTR    WQE ADDR IS NO LONGER AVAILABLE  12900001
         EJECT                                                          13000001
PMAPF    TM    UCMSTS,UCMPF+UCMTA  IS THERE OUTPUT OR AN OPEN PENDING?  13050001
         BZ    PMRETURN            NO, EXIT FROM THE MODULE             13100001
         TM    UCMSTS,UCMTA        YES, IS IT AN OPEN PENDING?          13150001
         BZ    PMAFA               NO, GO SEE IF OPEN WAS SUCCESSFUL    13200001
         MVI   CSACODE,CSAOPEN     YES, SET OPEN PENDING CODE           13250001
         B     PJSTART             GO TO OPEN/CLOSE RETURN       Y02711 13300002
         SPACE 1                                                 Y02711 13310002
PMAFA    DS    0H                                                Y02893 13350002
         TM    UCMSTS,UCMTC        IS MLWTO IN PROCESS                  13450001
         BO    PMCOMEBK            YES, GET NEXT OUTPUT LINE            13500001
         L     X5,UCMWLAST         POINT TO CQE ENTRY                   13600001
         LTR   X5,X5               IS THERE ANY?                        13650001
         BNZ   PMTESTLT            YES, GO TEST IT                      13700001
         L     X5,UCMOUTQ          NO, TRY THE OUTPUT QUEUE POINTER     13750001
         LTR   X5,X5               ANY OUTPUT TO DO?                    13800001
         BZ    PMENDOFQ            NO, REACHED END OF QUEUE             13850001
PMTESTLT TM    CQEFLAG,CQEENTR     IS THIS A VALID ENTRY?               13950001
         BO    PMFOUND             YES, PERHAPS WE WILL PRINT IT        14000001
         TM    CQEFLAG,CQEEOB      IS THIS THE END OF BLOCK?            14050001
         BO    PMLINK              YES, GO GET NEXT CQE                 14100001
         TM    CQEFLAG,CQEEOQ      IS THIS END OF CONSOLE QUEUE?        14150001
         BO    PMENDOFQ            YES, TURN OFF OUTPUT PENDING FLAG    14200001
         LA    X5,FOUR(X5)         UPDATE PTR TO LOOK AT NEXT ENTRY     14250001
         B     PMTESTLT            GO SEE IF IT IS LAST ONE             14300001
PMENDOFQ NI    UCMSTS,K255-UCMPF   TURN OFF OUTPUT PENDING FLAG         14350001
         B     PMAPF               RETURN AND CHECK FOR MORE            14400001
PMLINK   ICM   X5,MASK7,CQEWQEA    GET POINTER TO NEXT CQE BLOCK        14450001
         B     PMTESTLT            TEST NEXT WQE POINTER                14500001
         EJECT                                                          14550001
PMFOUND  DS    0H                                                Y02752 14560002
         LA    X5,ZERO(X5)         CLEAR HIGH ORDER BYTE         Y02752 14570002
         ST    X5,UCMWLAST         UPDATE LAST CQE ENTRY POINTER        14600002
         ICM   X3,MASK7,CQEWQEA    NO, GET WQE POINTER                  14750001
         DROP  X8                                                       14760001
         USING WQE,X3              SET UP WQE BASE                      14800001
         TM    WQEXA,WQEPURGE      IS THIS WQE PURGED?                  14850001
         BNO   PMNOPURG            IF NOT, SKIP FOLLOWING TESTS  Y02756 14900002
         SPACE 2                                                 Y02756 14910002
**************************************************************** Y02756 14912002
*    IF THE WQE PURGE FLAG IS ON, THE FOLLOWING ADDITIONAL TESTS Y02756 14920002
*    MUST BE MADE TO DETERMINE HOW TO HANDLE THIS WQE.           Y02756 14930002
*        1.    IF CQEMLQHC IS ON, THEN THE WQE WAS QUEUED TO BE  Y02756 14940002
*              OUTPUT IN HARDCOPY FORMAT AND TESTS 2 AND 3 MUST  Y02756 14942002
*              ALSO BE APPLIED, OTHERWISE GO AHEAD AND PURGE IT. Y02756 14944002
*        2.    THIS MESSAGE MAY NEVER HAVE BEEN A CANDIDATE FOR  Y02752 14946002
*              HARDCOPY (WQEQFHC IS ZERO (0)) IN WHICH CASE,     Y02756 14948002
*              IT CAN BE PURGED. IF IT WAS A CANDIDATE FOR H.C., Y02756 14948402
*              THEN TEST 3 MUST BE APPLIED.                      Y02756 14948802
*        3.    ONLY 'HARDCOPY ONLY' MESSAGES OR MESSAGES THAT    Y02756 14949202
*              HAVE BEEN WRITTEN TO AT LEAST ONE CONSOLE SHOULD  Y02756 14949602
*              BE HARDCOPIED, THEREFORE WQEBUFC IS TESTED TO SEE Y02756 14949702
*              IF THE MESSAGE IS READY FOR HARDCOPY.             Y02756 14949802
**************************************************************** Y02756 14949902
         SPACE 1                                                 Y02756 14950002
         TM    CQEFLAG,CQEMLQHC    IS H.C. FORMAT REQUESTED      Y02756 14966602
         BNO   PMWQEPRG            IF NOT, GO SKIP THIS WQE      Y02756 14976602
         TM    WQEXA,WQEQFHC       IS WQE A H.C. CANDIDATE       Y02756 14978602
         BNO   PMWQEPRG            IF NOT, GO SKIP THIS WQE      Y02756 14980602
         TM    WQEAVAIL,WQEBUFC    IS WQE READY FOR H.C.         Y02756 14982602
         BNO   PMWQEPRG            IF NOT, GO SKIP THIS WQE      Y02756 14983002
         SPACE 1                                                 Y02756 14983102
PMNOPURG DS    0H                                                Y02756 14983202
         TM    CQEFLAG,CQEMAJOR    IS THIS AN MLWTO ENTRY?              14988802
         BO    PMLW                YES, PREPARE TO PRINT IT             14990802
         OI    WQEAVAIL,WQEBUFC    INDICATE WQE READY FOR H.C.   Y02756 14992802
         SPACE 1                                                 Y02756 14993202
*    IF THIS CONSOLE IS THE HARDCOPY DEVICE, ALL MESSAGES PUT    Y02756 14993602
*    OUT ON IT MUST BE IN HARDCOPY FORMAT (I.E. MESSAGES BEGIN   Y02756 14994002
*    AT WQETS INSTEAD OF AT WQETXT).                             Y02756 14994102
         SPACE 1                                                 Y02756 14994202
         LA    X2,WQETXT           POINT TO TEXT AREA IN THE WQE Y02893 14994302
         TM    CQEFLAG,CQEMLQHC    IS MESSAGE QUEUED FOR H.C.    Y02756 15008202
         BNO   PMHDRI              IF NOT H.C., CHECK FOR HDR    Y02756 15018202
         LA    X2,WQERR            SET UP PTR TO H.C. HEADER     Y02756 15022202
         B     PMFOUND1            GO OUTPUT HARDCOPY FORMAT     Y02756 15023202
         SPACE 1                                                 Y02756 15024202
*  TEST WHETHER THE TIME STAMP AND JOBID ARE TO BE INCLUDED      Y02756 15025202
*  WITH THE MESSAGE TEXT.                                        Y02756 15026202
         SPACE 1                                                 Y02756 15027202
PMHDRI   DS    0H                                                Y02756 15028202
         TM    UCMDISP2,UCMDISPI   TEST FOR TIME STAMP AND JOBID Y02756 15029202
         BNO   PMHDRJ              IF NOT, GO CHECK JOBID ONLY   Y02756 15030202
         LA    X2,WQETS            START MSG AT TIME STAMP       Y02756 15036002
         B     PMFOUND1            GO ISSUE MESSAGE              Y02756 15037002
         SPACE 1                                                 Y02756 15038002
*  TEST WHETHER THE JOBID HEADER IS TO BE INCLUDED WITH THE TEXT Y02756 15039002
         SPACE 1                                                 Y02756 15040602
PMHDRJ   DS    0H                                                Y02756 15041002
         TM    UCMDISP2,UCMDISPJ   TEST FOR JOBID HEADER NEEDED  Y02756 15041402
         BNO   PMFOUND1            IF NOT JOBID, USE JUST TEXT   Y02756 15041802
         LA    X2,WQEJOBNM         START MSG WITH JOBID HEADER   Y02756 15042202
         EJECT                                                          15042602
**************************************************************** Y02893 15045402
*                                                                Y02893 15047402
*    COMMON OUTPUT ROUTINE, ISSUES WRITE MACRO FOR BOTH NORMAL   Y02893 15050002
*    AND MLWTO'S.  AT ENTRY THE REGS ARE SET AS FOLLOWS;         Y02893 15054002
*        X2    CONTAINS A POINTER TO THE TEXT TO BE WRITTEN      Y02893 15058002
*        X3    CONTAINS THE ADDRESS OF THE WQE OR MINOR          Y02893 15062002
*        X9    CONTAINS A POINTER TO THE DCB.                    Y02893 15066002
*                                                                Y02893 15070002
*    FIELD DCBBLKSZ CONTAINS THE LENGTH TO BE WRITTEN            Y02893 15074002
*                                                                Y02893 15078002
**************************************************************** Y02893 15082002
         SPACE 1                                                 Y02893 15086002
PMFOUND1 ST    X3,DMX              SAVE THIS POINTER                    15090002
         MVI   DMX,DMXW            INSERT CODE OF 4                     15094002
         OI    UCMSTS,UCMBF        FLAG THE CONSOLE UCM ENTRY BUSY      15100001
         BAL   XE,PFRELOCK         GO FREE LOCAL AND CMS LOCKS   Y02752 15110002
         SPACE 1                                                 Y02752 15120002
         LA    X1,DMDECB           POINT TO THE ECB                     15150001
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 15160002
         BZ    PMEXCP              IF NOT, SKIP FOOTPRINTING     Y02753 15170002
         OI    PARMFTPT,PWRITE     INDICATE WRITE FOR RECOVERY   Y02753 15180002
PMEXCP   DS    0H                                                Y02753 15190002
         WRITE (1),SF,(9),(2),'S',MF=E                                  15200001
         SPACE 1                                                 Y02752 15210002
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 15220002
         BZ    PMRETRN1            IF NOT, SKIP CLEANUP          Y02753 15230002
         NI    PARMFTPT,K255-PWRITE    CLEAR WRITE FLAG          Y02753 15240002
         B     PMRETRN1            GO RETURN TO SVC 72 ISSUER    Y02752 15250002
         EJECT                                                          15300001
*    ENTER HERE FOR MAJOR WRITE - THE MAJOR WQE TEXT AREA WILL BE       15350001
*    USED FOR OUTPUT. REG X3 CONTAINS ADDR OF WQE AT ENTRY       Y02893 15400002
         SPACE                                                          15450001
PMLW     DS    0H                                                Y02756 15650002
         OI    UCMSTS,UCMTC        INDICATE WORKING ON MLWTO NOW Y02893 15700002
         OI    WMJMBUF,WMJMBUFC    SHOW MAJOR READY FOR H.C.     Y02756 15750002
         XC    UCMMLAST(FOUR),UCMMLAST     ZERO MINOR PTR               15850001
         SR    X6,X6               CLEAR LENGTH REG                     15900001
         LH    X6,WMJMTXTL         GET TEXT LENGTH                      15950001
         LTR   X6,X6               IS THE LENGTH ZERO (NULL LINE)?      16000001
         BZ    PMFWQE              YES, HANDLE THE WQE AS I/O COMPLETE  16050001
*                                  FOR THE TEXT LINE HAS BEEN RECEIVED  16100001
         LA    X2,WMJMTXT          POINT TO MAJOR WQE TEXT AREA         16120002
         TM    CQEFLAG,CQEMLQHC    IS THE WQE FOR HARDCOPY?             16150001
         BNO   PMLW2               NO, TEST FOR TIME STAMP       Y02756 16200002
         LA    X6,WMJMTXT-WMJMRR(X6)   ADD LENGTH OF H.C. HEADER Y02756 16206002
         LA    X2,WMJMRR           POINT TO MAJOR WQE H.C. HDR   Y02756 16212002
         B     PMLW1               GO PRINT LINE                        16218002
         SPACE 1                                                 Y02756 16224002
*  TEST WHETHER TIME STAMP AND JOBID HEADER ARE TO BE USED       Y02756 16230002
         SPACE 1                                                 Y02756 16236002
PMLW2    DS    0H                                                Y02756 16242002
         TM    UCMDISP2,UCMDISPI   TEST FOR TIME STAMP AND JOBID Y02756 16248002
         BNO   PMLW2A              IF NOT, CHECK FOR JOBID ONLY  Y02756 16254002
         LA    X6,WMJMTXT-WMJMTS(X6) ADD LENGTH OF HEADER        Y02756 16260002
         LA    X2,WMJMTS           START MSG WITH TIME STAMP HDR Y02756 16266002
         B     PMLW1               GO STORE BLKSIZE              Y02756 16272002
         SPACE 1                                                 Y02756 16278002
*  TEST WHETHER THE JOBID HEADER IS TO BE USED.                  Y02756 16284002
         SPACE 1                                                 Y02756 16290002
PMLW2A   DS    0H                                                Y02756 16300002
         TM    UCMDISP2,UCMDISPJ   TEST FOR JOBID HEADER ONLY    Y20756 16308002
         BNO   PMLW1               IF NOT, USE MSG TEXT          Y02756 16316002
         LA    X6,WMJMTXT-WMJMJBNM(X6) ADD LENGTH OF HEADER      Y02756 16324002
         LA    X2,WMJMJBNM         START MSG WITH JOBID HEADER   Y02756 16332002
PMLW1    STH   X6,DCBBLKSI         STORE TEXT LENGTH IN DCB             16340002
         B     PMFOUND1            GO PRINT LINE                        16350001
         SPACE 1                                                 Y02756 16600002
*  IF THE NEXT LINE TO BE OUTPUTTED IS A MINOR THIS ROUTINE      Y02756 16650002
*     WILL SET IT UP.                                            Y02756 16652002
         SPACE 1                                                 Y02756 16654002
PMLW3    DS    0H                                                Y02756 16654402
         ST    X8,UCMMLAST         UPDATE THE PTR TO THE MINOR   Y02756 16656002
*                                  BEING PROCESSED.              Y02756 16658002
         DROP  X3                                                       16660001
         USING WQE,X8                                                   16670001
         SR    X6,X6               CLEAR LENGTH REG                     16700001
         IC    X6,WMNMTL1          GET MESSAGE TEXT LENGTH              16750001
         LTR   X6,X6               IS THE LENGTH ZERO (NULL LINE)?      16800001
         BZ    PMFWQE              YES, CAUSE TEXT LINE TO BE IGNORED   16850001
         TM    CQEFLAG,CQEMLQHC    IS MLWTO QUEUED FOR HARDCOPY?        16900001
         BO    PMLW4               YES, INCREASE TEXT LENGTH            16950001
         LA    X2,WMNMTXT1         POINT TO MINOR WQE TEXT AREA         17000001
         B     PMLW1               GO PRINT LINE                        17050001
PMLW4    LA    X6,FOUR(X6)         BUMP TO INCLUDE HARDCOPY TEXT ID     17100001
         LA    X2,WMNMHCT1         POINT MINOR WQE HARDCOPY TEXT AREA   17150001
         B     PMLW1               GO PRINT LINE                        17200001
         EJECT                                                          17250001
**************************************************************** Y02753 17260002
*                                                                Y02753 17270002
*    COMMON ERROR ROUTINE, ENTERED IF 'CHECK' FINDS AN I/O ERROR Y02753 17280002
*    OR THE 'OPEN' SUBROUTINE IS UNABLE TO OPEN THE CONSOLE.     Y02753 17290002
*    AT ENTRY, NO LOCKS ARE HELD.  THIS ROUTINE WILL SET UP THE  Y02753 17292002
*    REGISTERS, FREE THE REG SAVE AREA, AND CALL THE CONSOLE     Y02753 17294002
*    SWITCH ROUTINE.                                             Y02753 17294402
*                                                                Y02753 17296002
**************************************************************** Y02753 17298002
PMERRCK  MVI   CSACODE,CSASWTCH    INDICATE CONSOLE SWITCH - ZERO CODE  17300001
         LR    X1,XD               PRT TO SAVE AREA TO BE FREED  Y02753 17350002
         SPACE 1                                                 Y02753 17400002
         FREEMAIN R,SP=SVSP,LV=SVLN,A=(1)  FREE THE SAVE AREA    Y02753 17402002
         SPACE 1                                                 Y02753 17404002
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 17404402
         BZ    PMERRNS             IF NOT, SKIP RESTORE OF RETRY Y02753 17404802
         MVC   PARMRTAD(EIGHT),CSAXB   RESTORE ORIGINAL RETRY    Y02753 17405202
PMERRNS  DS    0H                                                Y02753 17405602
         LR    X1,XB               REG 1 PTS TO CSA FOR SWITCH   Y02753 17406002
         L     XE,CSAXA            RESTORE RETURN ADDRESS        Y02893 17410002
         SPACE 1                                                 Y02752 17460002
         L     XF,CSACTLM          GET PTR TO UCM BASE           Y02752 17510002
         USING UCM,XF              TEMPORARY BASE FOR UCM        Y02752 17560002
         L     XF,UCMSWCH          GET PTR TO SWITCH MODULE      Y02752 17570002
         DROP  XF                  DROP TEMPORARY UCM BASE       Y02752 17580002
         MVC   CSANAME(EIGHT),IGC0407B      NAME OF SWITCH ROUTINE      17600001
         BR    XF                  BRANCH TO CONSOLE SWITCH      Y02752 17650002
         SPACE 2                                                        17700001
         DROP  X5                                                       17810001
         DROP  X8                                                       17820001
         EJECT                                                          17850001
**************************************************************** Y02751 17900002
*                                                                Y02751 17950002
*                       COMMON SETLOCK OBTAIN ROUTINE            Y02751 18000002
*                                                                Y02751 18050002
*  THIS ROUTINE WILL OBTAIN THE LOCAL AND CMS LOCKS, AND THEN    Y02751 18100002
*  ISSUE THE SETFRR.THE ADDRESS OF THE FRR WORK AREA WILL BE     Y02751 18150002
*  SAVED IN THE SVRB EXTENDED SAVE AREA.                         Y02751 18200002
*                                                                Y02751 18250002
*  ENTRY POINT:    PGETLOCK, VIA 'BAL   14,PGETLOCK'             Y02751 18300002
*                                                                Y02751 18350002
*  CALLED FROM:    1.  INITIAL MODULE ENTRY ROUTINE (PROLOGUE).  Y02751 18400002
*                  2.  AFTER RETURN FROM CHECK                   Y02751 18450002
*                  3.  DEVICE CLOSE ROUTINE                      Y02751 18500002
*                  4.  DEVICE OPEN ROUTINE                       Y02751 18550002
*                                                                Y02751 18600002
**************************************************************** Y02751 18650002
         SPACE 1                                                 Y02751 18700002
PGETLOCK DS    0H                                                Y02751 18750002
         ST    XE,CSAXE            SAVE RETURN REG               Y02751 18752002
         LR    XA,XB               USE THIS AS A TEMP CXSA BASE  Y02751 18754002
         LR    XF,XC               USE THIS AS A TEMP MOD BASE   Y02751 18756002
         DROP  XA,XB,XC                                          Y02751 18758002
         USING CXSA,XA             TEMPORARY CXSA BASE           Y02751 18758402
         USING IEAV1443,XF         TEMPORARY MODULE BASE         Y02751 18758802
         SPACE 3                                                 Y02751 18759202
*  GET THE LOCAL LOCK.                                           Y02751 18759602
         SPACE 1                                                 Y02751 18759702
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                  Y02751*18759802
               RELATED=(UCM,IEAV1443(PFRELOCK))                  Y02751 18759902
         SPACE 3                                                 Y02751 18763202
*  GET THE CMS GLOBAL LOCK.  (UNCONDITIONAL REQUEST)             Y02751 18765202
         SPACE 1                                                 Y02751 18765602
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                    Y02751*18766002
               RELATED=(UCM,IEAV1443(PFRELOCK))                  Y02751 18766402
         SPACE 2                                                 Y02751 18766502
*  SET FUNCTIONAL RECOVERY ROUTINE IN PLACE.                     Y02753 18766602
         SPACE 1                                                 Y02753 18767602
         L     XB,CSACTLM          GET PTR TO UCM BASE           Y02753 18768102
         L     XB,UCMFRRAD-UCM(XB) GET PTR TO COMMON FRR RTN     Y02753 18768602
         USING PSA,X0              BASE THE PSA (ADDR IS 0)      Y02753 18769602
         SETFRR A,FRRAD=(11),PARMAD=(13),WRKREGS=(12,13),        Y02753C18770602
               RELATED=(CMS-LOCK,IEAV1052(PFRELOCK))             Y02753 18771602
         DROP  X0                                                Y02753 18772602
         SPACE 2                                                 Y02753 18773602
         ST    XD,CSADCBP          SAVE FRR WORKAREA ADDR        Y02753 18774602
         MVC   PARMID-PARMLIST(FOUR,XD),SVC72ID  MOVE IN                18776603
*                                  RECOVERY ID                 @ZM33331 18777603
         DROP  XA,XF               RELEASE TEMP BASE REGS        Y02751 18778603
         LR    XB,XA               RESTORE CXSA BASE             Y02751 18780603
         LR    XC,XF               RESTORE MODULES BASE          Y02751 18782603
         USING CXSA,XB                                           Y20751 18785803
         USING IEAV1443,XC                                       Y02751 18786203
         L     XA,CSAUCM           RESTORE UCME BASE REG         Y02751 18787803
         USING UCMLIST,XA                                        Y02751 18788803
         L     XD,CSAXF            REFRESH PTR TO REG SAVE AREA  Y02751 18789803
         L     XE,CSAXE            RESTORE RETURN REG            Y02751 18791803
         BR    XE                  RETURN TO SUBROUTINE CALLER   Y02751 18792603
         EJECT                                                          18793803
**************************************************************** Y02751 18795003
*                                                                Y02751 18797503
*                       COMMON SETLOCK RELEASE ROUTINE           Y02751 18798803
*                                                                Y02751 18799003
*  THIS ROUTINE WILL REMOVE THE CURRENT FRR FROM THE STACK AND   Y02751 18800003
*  THEN FREE THE CMS AND LOCAL LOCKS (IN THE ORDER NAMED).       Y02751 18801003
*                                                                Y02751 18802003
*  ENTRY POINT:    PFRELOCK, VIA 'BAL  14,PFRELOCK'              Y02751 18803003
*                                                                Y02751 18804003
*  CALLED FROM:                                                  Y02751 18807203
*              1.  PMRETURN BEFORE RETURNING TO CALLER           Y02751 18809203
*              2.  PMBF BEFORE ISSUING CHECK                     Y02751 18810203
*              3.  PMFOUND1 BEFORE ISSUING WRITE MACRO           Y02751 18811203
*              4.  PJCLOSE TO ISSUE CLOSE MACRO                  Y02751 18812203
*              5.  PJOPEN TO ISSUE OPEN MACRO                    Y02751 18813203
*              6.  PJOPEN ON OPEN FAIL, BEFORE GOING TO PMERRCK  Y02751 18815203
*                                                                Y02751 18816203
**************************************************************** Y02751 18817203
         SPACE 1                                                 Y02751 18818203
PFRELOCK DS    0H                                                Y02751 18820903
         ST    XE,CSAXE            SAVE RETURN REG               Y02751 18821603
         LR    XA,XB               USE THIS AS A TEMP CXSA BASE  Y02751 18822303
         LR    XF,XC               USE THIS AS A TEMP MOD BASE   Y02751 18824303
         DROP  XA,XB,XC                                          Y02751 18825103
         USING CXSA,XA             TEMPORARY CXSA BASE           Y02751 18826703
         USING IEAV1443,XF         TEMPORARY MODULE BASE         Y02751 18828703
         SPACE 3                                                 Y02751 18830003
*  REMOVE THIS MODULES FRR FROM THE STACK.                       Y02751 18830403
         SPACE 1                                                 Y02751 18831403
         USING PSA,X0              BASE THE PSA (ADDR IS 0)      Y02753 18832403
         SETFRR D,WRKREGS=(12,13),                               Y20753C18835003
               RELATED=(CMS-LOCK,IEAV1443(PGETLOCK))             Y02753 18836003
         DROP  X0                                                Y02753 18837003
         SR    XC,XC               CLEAR A REGISTER              Y02753 18838003
         ST    XC,CSADCBP          ZERO PTR TO FRR PARM ADDR     Y02753 18839003
         SPACE 2                                                 Y02751 18840003
*  ISSUE SETLOCK RELEASE TO RELEASE THE CMS LOCK                 Y02751 18842003
         SPACE 1                                                 Y02751 18843003
         SETLOCK RELEASE,TYPE=CMS,                               Y02751*18844003
               RELATED=(UCM,IEAV1443(PGETLOCK))                  Y02751 18846503
         SPACE 2                                                 Y02751 18847503
*  ISSUE SETLOCK RELEASE TO RELEASE THE LOCAL LOCK               Y02751 18848503
         SPACE 1                                                 Y02751 18849503
         SETLOCK RELEASE,TYPE=LOCAL,                             Y02751*18851003
               RELATED=(UCM,IEAV1443(PGETLOCK))                  Y02751 18852003
         SPACE 2                                                 Y02751 18853003
*  LOCKS HAVE NOW BEEN FREED, RESTORE REGS AND                   Y02751 18855503
*  RETURN TO THE SUBROUTINE CALLER.                              Y02751 18856503
         SPACE 1                                                 Y02751 18857503
         LR    XB,XA               RESTORE CXSA BASE             Y02751 18859503
         LR    XC,XF               RESTORE MODULES BASE          Y02751 18860503
         DROP  XA,XF               RELEASE TEMP BASE REGS        Y02751 18861503
         USING CXSA,XB                                           Y02751 18863503
         USING IEAV1443,XC                                       Y02751 18864503
         L     XA,CSAUCM           RESTORE UCME BASE REG         Y02751 18865503
         USING UCMLIST,XA                                        Y02751 18867503
         L     XD,CSAXF            REFRESH PTR TO REG SAVE AREA  Y02751 18868503
         L     XE,CSAXE            RESTORE RETURN REG            Y02751 18869503
         BR    XE                  RETURN TO SUBROUTINE CALLER   Y02751 18871503
         EJECT                                                          18872503
**************************************************************** Y02753 18873503
*                                                                Y02753 18875503
*  IEAV1443 ESTAE RETRY ROUTINE, SOFTWARE RECOVERY               Y02753 18876503
*                                                                Y02753 18877503
**************************************************************** Y02753 18878503
         SPACE 1                                                 Y02753 18879503
P1443RTY DS    0H                                                Y02753 18881103
         BALR  XF,0                MAKE A TEMPORARY BASE REG     Y02753 18882703
         USING *,XF                                              Y02753 18883503
         L     XC,ADCON            GET PERMANENT MODULE BASE     Y02753 18885903
         DROP  XF                  TEMPORARY MODULE BASE         Y02753 18887003
         USING PSA,X0              BASE PSA                      Y02753 18887903
         L     XF,PSATOLD          GET PTR TO CURRENT TCB        Y02753 18888803
         DROP  X0                                                Y02753 18890603
         L     X5,TCBRBP-TCB(XF)   GET PTR TO MY SVRB            Y02753 18891503
         LA    XB,RBEXSAVE-RBSECT(X5)  RESTORE BASE FOR CXSA     Y02753 18892503
         L     XD,CSAXF            RESTORE PTR TO REGSAVE AREA   Y02753 18893503
         L     XA,CSAUCM           RESTORE BASE FOR UCME         Y02753 18894503
         L     X9,UCMDCB           RESTORE BASE FOR DCB          Y02753 18895503
         L     X7,CSANPTR          GET PTR TO RECOVERY PARMLIST  Y02753 18896503
         TM    PARMFTPT,PWRITE     WAS WRITE IN PROCESS          Y02753 18897503
         LA    XF,PMERRCK          GET PTR TO SWITCH SETUP       Y02753 18901502
         BO    RETRYFND            IF WRITE IN PROCESS, BRANCH   Y02753 18911502
         TM    PARMFTPT,PCHECK     WAS CHECK BEING PROCESSED     Y02753 18921502
         LA    XF,PMERRCK          USE CONSOLE SWITCH AS RECOVRY Y02753 18931502
         BO    RETRYFND            IF CHECK IN PROGRESS, BRANCH  Y02753 18941502
         TM    PARMFTPT,POPEN      WAS OPEN IN PROGRESS          Y02753 18951502
         LA    XF,PJOPRCVR         GET PTR TO OPEN RECOVERY      Y02753 18961502
         BO    RETRYOPN            IF OPEN IN PROGRESS BRANCH    Y02753 18971502
         TM    PARMFTPT,PCLOSE     WAS CLOSE IN PROGRESS         Y02753 18981502
         LA    XF,PJCLRCVR         GET PTR TO CLOSE RECOVERY     Y02753 18991502
         BO    RETRYPJS            IF CLOSE IN PROGRESS, BRANCH  Y02753 19001502
************************************************************** @ZA00873 19002403
*                                                              @ZA00873 19003303
*  AFTER ALL KNOWN RECOVERY FOOTPRINTS HAVE BEEN CHECKED, THE  @ZA00873 19004203
*  FOLLOWING BRANCH WILL BE TAKEN TO GIVE CONTROL TO THE       @ZA00873 19005103
*  CONSOLE SWITCH ROUTINE (IEAVSWCH). A CONSOLE SWITCH IS      @ZA00873 19006003
*  GENERATED TO PREVENT THE POSSIBILITY OF THE PROBLEM         @ZA00873 19006903
*  RECURRING OR CAUSE OTHER PROBLEMS TO OCCUR.                 @ZA00873 19007803
*                                                              @ZA00873 19008703
************************************************************** @ZA00873 19009603
         B     PMERRCK             PREPARE TO CONSOLE SWITCH   @ZA00873 19010503
         SPACE 1                                                 Y02753 19011502
*  NONE OF THE SPECIAL RECOVERY PROCESSES APPLY, RETURN TO VCTR  Y02753 19021502
         SPACE 1                                                 Y02753 19031502
RETRYPJS DS    0H                                                Y02753 19082502
         L     X2,CSACTLM          GET PTR TO UCM BASE           Y02753 19083502
         USING UCM,X2                                            Y02753 19084002
         SR    X4,X4               CLEAR REG FOR DIVIDE          Y02753 19084502
         LA    X5,UCMLIST          PTR TO UCME (CLEAR HIGH BYTE) Y02753 19085502
         S     X5,UCMVEA           GET OFFSET FROM 1ST UCME      Y02753 19086502
         D     X4,UCMVEZ           DIVIDE BY UCME SIZE           Y02753 19087502
         SLL   X5,TWO              MULTIPLY BY 4 FOR EIL INDEX   Y02753 19088502
         L     X4,UCMLSTP          GET PTR TO EIL BASE           Y02753 19089502
         USING UCMEIL,X4                                         Y02753 19090502
         LA    X5,UCMIECBA(X5)     GET EIL ENTRY FOR THIS UCME   Y02753 19091502
         DROP  X2,X4                                             Y02753 19094502
         SPACE 1                                                 Y02753 19097502
RETRYFND DS    0H                                                Y02753 19101502
         MVI   PARMFTPT,ZEROBYTE   CLEAR FOOTPRINT AREA          Y02753 19106502
         BR    XF                  GO TO RETRY ROUTINE           Y02753 19111502
         SPACE 2                                                 Y02753 19121502
RETRYOPN DS    0H                                                Y02753 19200002
         L     X9,CSAXD            GET PTR TO DCB AREA (OR ZERO) Y02753 19250002
         LTR   X9,X9               WAS A DCB AREA GOTTEN YET     Y02753 19300002
         BNZ   RETRYPJS            IF YES, GO TO STANDARD RETRY  Y02753 19350002
         LA    XF,PMERRCK          OTHERWISE, GO TO SWITCH SETUP Y02753 19400002
         B     RETRYFND            TO CONSOLE SWITCH SETUP       Y02753 19420002
*********************************************************************** 19421003
*                                                                     * 19422003
*  PJECBINT - SUBROUTINE TO REINITIALIZE THE ECB POINTER TO    @ZA11907 19423003
*             THE EIL FOR OPEN AND CLOSE PROCESSING AFTER      @ZA11907 19424003
*             REENTRY FROM NOP EXCP PROCESSING IN SUBROUTINE   @ZA11907 19425003
*             PJCOMMON. REG5 IS SET TO POINT TO THE EIL ECB.   @ZA11907 19426003
*                                                                     * 19427003
*********************************************************************** 19428003
PJECBINT EQU   *                                               @ZA11907 19429003
         L     XF,CSACTLM          GET UCM POINTER             @ZA11907 19430003
         USING UCM,XF              REG15 IS UCM BASE           @ZA11907 19431003
*                                                              @ZA11907 19432003
*  COMPUTE INDEX TO THE CORRECT I/O ECB WITHIN THE EIL         @ZA11907 19433003
*                                                              @ZA11907 19434003
         SR    X4,X4               ZERO OUT EVEN REG           @ZA11907 19435003
         LA    X5,UCMLIST          GET PTR TO UCME             @ZA11907 19436003
         S     X5,UCMVEA           SUBT. 1ST ENTRY FOR OFFSET  @ZA11907 19437003
         D     X4,UCMVEZ           DIVIDE BY ENTRY SIZE TO GET @ZA11907 19438003
*                                  INDEX                       @ZA11907 19439003
         SLL   X5,TWO              MULTIPLY BY 4               @ZA11907 19440003
         L     X4,UCMLSTP          POINT TO THE EIL            @ZA11907 19441003
         USING UCMEIL,X4           ESTABLISH BASE OF EIL       @ZA11907 19442003
         LA    X5,UCMRECBA+FOUR(X5) PT DIRECTLY TO THE ECB     @ZA11907 19443003
         DROP  X4                  FINISHED WITH EIL           @ZA11907 19444003
         TM    UCMSTS,UCMCF        CLOSE PROCESSING            @ZA11907 19445003
         BO    PJCLNCON            YES, CONTINUE CLOSE         @ZA11907 19446003
         B     PJOPNCT             NO, CONTINUE OPEN           @ZA11907 19447003
         EJECT                                                          19450002
**************************************************************** Y02893 19480002
*                                                                Y02893 19510002
*   PJSTART -- IEAV1443 OPEN/CLOSE SUBROUTINE                    Y02893 19540002
*                                                                       19570002
*    THIS SUBROUTINE WILL GETMAIN, FORMAT AND OPEN TYPE=J A BSAM        19600002
*    DCB FOR A PRINTER BEING ALLOCATED AS A CONSOLE, OR CLOSE AND       19630002
*    FREEMAIN THE DCB WHEN THE PRINTER IS BEING REMOVED FROM            19660002
*    CONSOLE STATUS.                                                    19690002
*                                                                       19720002
* OPERATION    INITIALLY FIELD CSACODE IN THE SVRB EXTENSION     Y02752 19750002
*              PARAMETER LIST MAPPED BY CXSA CONTAINS A CODE     Y02752 19780002
*              INDICATING WHETHER OPEN OR CLOSE IS REQUESTED.    Y02752 19810002
*              IF OPEN REQUEST, DYNAMIC CORE IS OBTAINED FOR A   Y02752 19840002
*              DCB/WORKAREA. TEMPORARY STORAGE IS GOTTEN FOR A   Y02752 19870002
*              JFCB. THE DDNAME IS BUILT. OPEN,TYPE=J, IS        Y02752 19900002
*              ISSUED. THE JFCB CORE IS THEN FREED. A SCAN OF    Y02752 19930002
*              THE EIL IS PERFORMED FOR THE ECB PTR FOR THIS     Y02752 19960002
*              CONSOLE, AND THE EIL PTR UPDATED TO POINT TO THE  Y02752 19990002
*              CURRENT ECB ADDRESS, IN THE WRITE MACRO L-FORM.   Y02752 20050002
*              IF CLOSE REQUEST, THE DCB IS CLOSED AND THE DCB   Y02752 20055002
*              STORAGE IS FREED AND THE ECB PTR IN THE EIL IS    Y02752 20060002
*              RESET TO POINT AT THE ECB IN THE UCME.            Y02752 20065002
*                                                                Y02893 20070002
**************************************************************** Y02893 20075002
         SPACE 3                                                 Y02893 20080002
PJSTART  EQU   *                   OPEN/CLOSE SUBROUTINE                20085002
         L     XF,CSACTLM          GET UCM POINTER                      20090002
         USING UCM,XF              REG 15 IS BASE OF UCM                20100003
*                                                                       20150001
*   COMPUTE INDEX TO THE CORRECT I/O ECB WITHIN THE EIL                 20200001
*                                                                       20250001
         SR    X4,X4               ZERO OUT EVEN REGISTER               20300001
         LA    X5,UCMLIST          GET PTR TO UCME               Y02752 20350002
         S     X5,UCMVEA           SUBTRACT FIRST ENTRY TO GET OFFSET   20400001
         D     X4,UCMVEZ           DIVIDE BY ENTRY SIZE TO GET INDEX    20450001
         SLL   X5,TWO              MULTIPLY BY 4                        20500001
         L     X4,UCMLSTP          POINT TO THE EIL                     20550001
         USING UCMEIL,X4           ESTABLISH BASE OF EIL                20600001
         LA    X5,UCMRECBA+FOUR(X5)  POINT DIRECTLY TO THE ECB          20650001
         DROP  X4,XF               FINISHED WITH EILAND UCM      Y02753 20700002
         SR    X4,X4               CLEAR FOR FOLLOWING IC AND LTR       20750001
         IC    X4,CSACODE          OBTAIN ENTRY CODE                    20800001
         LTR   X4,X4               IS IT ZERO FOR OPEN?                 20850001
         BZ    PJOPEN              YES, GO OPEN DCB                     20900001
         MVI   CSACODE,ZERO        ZERO OUT CODE AND CLOSE              20950001
         EJECT                                                          21000001
*    REMOVE THE PRINTER FROM CONSOLE STATUS                             21050001
         SPACE                                                          21100001
PJCLOSE  DS    0H                                                Y02893 21150002
         LTR   X9,X9               DOES THE DCB EXIST?                  21200001
         BZ    PJSTATUS            NO, SO IGNORE MOST CLOSE PROCESSING  21250001
         SPACE 1                                                 Y02751 21300002
         SPACE 1                                                 Y02751 21400002
         BAL   XE,PFRELOCK         FREE LOCKS                  @ZA05367 21450003
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 21500002
         BZ    PJCLNSTA            IF NOT, SKIP FOOTPRINTING     Y02753 21600002
         OI    PARMFTPT,PCLOSE     INDICATE CLOSE PROCESS        Y02753 21700002
PJCLNSTA DS    0H                                                Y02753 21800002
         B     PJCOMMON            DO NOP EXCP                 @ZA05367 21805003
PJCLNCON EQU   *                   NOW CHECK FOR OPEN CONSOLE  @ZA11907 21855003
         LTR   X9,X9               DOES DCB EXIST FOR CONSOLE  @ZA11907 21905003
         BZ    PJSTATUS            NO, SKIP MOST CLOSE PROCESS @ZA11907 21955003
         MVI   DMXA,DMXCLOSE       CLOSE TERMINAL FLAG BYTE    @ZA11907 22050003
         LA    X1,DMXA                                                  22100001
         CLOSE ((X9)),MF=(E,(1))   X9 POINTS TO DCB                     22150001
         SPACE 1                                                 Y02711 22200002
         LR    X1,X9               GET ADDR OF DCB STORAGE       Y02711 22250002
         SPACE 1                                                 Y02711 22260002
         FREEMAIN R,SP=DMSP,LV=DMCORE,A=(1) FREE THE DCB STORAGE Y02711 22270002
         SPACE 1                                                 Y02711 22280002
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 22281002
         BZ    PJCLRCVR            IF NOT, SKIP RESETTING FLAG   Y02753 22282002
         NI    PARMFTPT,K255-PCLOSE    CLOSE PROCESS DONE        Y02753 22283002
PJCLRCVR DS    0H                                                Y02753 22284002
         SPACE 1                                                 Y02753 22285002
         BAL   XE,PGETLOCK         GO OBTAIN LOCAL AND CMS LOCKS Y02751 22290002
         EJECT                                                          22300002
PJSTATUS DS    0H                                                Y02753 22350002
         L     X4,UCMUCB           GET PTR TO THIS CONSOLES UCB  Y02753 22380002
         USING UCB,X4              BASE THE UCB                  Y02753 22410002
         TM    UCBSTAT,UCBCHGS     IS DEVICE CHANGING TO OFFLINE?       22450001
         BZ    PJDEVSTA            NO, LEAVE ONLINE BIT ALONE           22500001
         SPACE 1                                                 Y02751 22550002
**************************************************************** Y02751 22555002
*  IF THE DEVICE IS GOING OFFLINE, TURN OFF THE FOLLOWING UCB    Y02751 22560002
*  FLAGS--- ONLINE, CHANGING, ALLOCATED, SYSTEM CONSOLE, AND     Y02751 22570002
*  'CONSOLE STATUS SWITCH'.                                      Y02751 22580002
**************************************************************** Y02751 22585002
         SPACE 1                                                 Y02751 22590002
         NIL   UCBSTAT,K255-UCBONLI-UCBCHGS-UCBALOC-UCBSYSR-UCBDADI,   *22592002
               REF=UCBOB                                         Y02751 22594002
         SPACE 1                                                 Y02751 22596002
         B     PJCONTIN            CONTINUE PROCESSING                  22650001
*                                  SHOW DEVICE IS ONLINE, NOT A CONSOLE 22700001
         EJECT                                                          22750001
**************************************************************** Y02751 22770002
*  IF A DEVICE IS GOING OUT OF CONSOLE STATUS, BUT TO REMAIN     Y02751 22800002
*  ONLINE, TURN OFF THE FOLLOWING UCB FLAGS---                   Y02751 22810002
*  ALLOCATED, SYSTEM CONSOLE, AND 'CONSOLE STATUS SWITCH'.       Y02751 22820002
**************************************************************** Y02751 22825002
         SPACE 1                                                 Y02751 22830002
PJDEVSTA DS    0H                                                Y02751 22832002
         NIL   UCBSTAT,K255-UCBALOC-UCBSYSR-UCBDADI,             Y02751C22840002
               REF=UCBOB                                         Y02751 22842002
         DROP  X4                  FINISHED WITH UCB                    22850001
PJCONTIN NI    UCMATR,K255-UCMAT04-UCMUF  INDICATE THAT DEVICE STATUS   22900001
*                                  IS NOT TO CHANGE AND CONSOLE IS      22950001
*                                  NOT ACTIVE                           23000001
         LA    X4,UCMECB           GET ADDR OF ECB                      23350001
         STCM  X4,MASK7,ONE(X5)    PUT THIS ADDRESS INTO I/O ECB        23400001
         XC    UCMECB,UCMECB       CLEAR ECB                            23450001
         XC    UCMDCB,UCMDCB       CLEAR DCB PTR                        23500001
         NI    UCMSTS,K255-UCMBF-UCMCF-UCMTA NOT BUSY, CLOSED, @ZA11907 23550003
*                                           AND TURN OFF OPEN  @ZA11907 23560003
         B     PMRETURN            GO RETURN TO SVC 72 ISSUER    Y02893 23600002
         EJECT                                                          23750001
PJOPEN   L     X4,UCMUCB           GET PRINTER'S UCB ADDRESS            23800001
         USING UCB,X4              UCB ADDRESSABILITY                   23850001
         TM    UCBSTAT,UCBSYSR     IS DEVICE A CONSOLE           Y02752 23900002
         BNO   PMRETURN            NO, IT CAN'T BECOME A CONSOLE Y02893 23950002
         BAL   XE,PFRELOCK         GO FREE LOCAL AND CMS LOCKS   Y02751 23960002
         SPACE 1                                                 Y02753 23965002
         LTR   X7,X7                                             Y02753 23970002
         BZ    PJOPNSTA            IF NOT, SKIP RECOVERY SETUP   Y02753 23975002
         OI    PARMFTPT,POPEN      INDICATE OPEN PROCESS         Y02753 23980002
         ST    X9,CSAXD            INDICATE NO DCB STORAGE YET   Y02753 23985002
PJOPNSTA DS    0H                                                Y02753 23990002
*                                                                       24000001
*   GETMAIN CORE FOR A DCB, IOB AND DEB                        @ZA03882 24050003
*                                                                       24100001
PJCOMMON GETMAIN R,SP=DMSP,LV=DMCORE  ACQUIRE A DCB            @ZA05367 24250003
         SPACE 1                                                 Y02893 24300002
         LR    X0,X9               SAVE CONTENTS OF REG9       @ZA05367 24300103
         LR    X9,X1               MOVE DCB ADDR TO ITS BASE REG Y02711 24300203
         XC    IHADCB(DMCORE),IHADCB        CLEAR DCB          @ZA05367 24300303
         ST    X0,DCBSAVE(X0)      SAVE ORIGINAL DCB PTR       @ZA05367 24300503
         GETMAIN R,SP=DMSP,LV=IOBCOR  GET IOB AND DEB          @ZA03882 24302703
         LR    IOBREG,X1           GET ADDR OF IOB CORE        @ZA03882 24303603
         USING IOB,IOBREG          ADDRESSABILITY FOR IOB      @ZA03882 24304503
         XC    IOB(IOBCOR),IOB     CLEAR IOB                   @ZA03882 24305403
         LA    IOBREG,IOBSTDRD     POINT TO STANDARD SECTION   @ZA03882 24306303
         DROP  IOBREG              DROP OTHER USING            @ZA03882 24307203
         USING IOBSTDRD,IOBREG     ADDRESSABILITY FOR IOB      @ZA03882 24308103
         GETMAIN R,SP=DMSP,LV=DEBCOR  GET DEB                  @ZA03882 24309003
         DROP  X4                  FINISH WITH UCB             @ZA03882 24309903
         LR    DEBREG,X1           SAVE ADDRESS OF DEB         @ZA03882 24310803
         USING DEB,DEBREG          ADDRESSABILITY FOR DEB      @ZA03882 24311703
         XC    DEB(DEBCOR),DEB     CLEAR DEB                   @ZA03882 24312603
         LA    WORKR,DEBAVT        ADDR. OF APPENDAGE VECT. TB @ZA03882 24313503
         ST    WORKR,DEBAPPAD      POINT DEB TO APP. TABLE     @ZA03882 24314403
         LA    WORKR,APPENDGE      SET TABLE TO NOP            @ZA03882 24315303
         ST    WORKR,DEBEOEA       END-OF-EXTENT APP. ROUTINE  @ZA03882 24316203
         ST    WORKR,DEBSIOA       START I/O APP. ROUTINE      @ZA03882 24317103
         ST    WORKR,DEBPCIA       PCI APP. ROUTINE            @ZA03882 24318003
         ST    WORKR,DEBCEA        CHANNEL-END APP. ROUTINE    @ZA03882 24318903
         ST    WORKR,DEBXCEA       ABNORMAL-END APP.           @ZA03882 24319803
         LA    DEBREG,DEBBASIC     POINT TO BASIC SECTION      @ZA03882 24320703
         DROP  DEBREG              DROP OTHER USING            @ZA03882 24321603
         USING DEBBASIC,DEBREG     ADDRESSABILITY FOR DEB      @ZA03882 24322503
         ST    DEBREG,DCBDEBAD     STORE DEB ADDR IN DCB       @ZA03882 24323403
         ST    IOBREG,DCBIOBAD     STORE IOB ADDR IN DCB       @ZA03882 24324303
         STCM  X9,MASK7,DEBDCBB    STORE DCB ADDR IN DEB       @ZA03882 24325203
         L     WORKR,UCMUCB        GET ADDR OF UCB             @ZA03882 24326103
         STCM  WORKR,MASK7,DEBSUCBB STORE UCB ADDR IN DEB      @ZA03882 24327003
         STCM  X9,MASK7,IOBDCBPB   STORE DCB ADDR IN IOB       @ZA03882 24327903
         LA    WORKR,CCWNOP        GET ADDR OF NOP CCW         @ZA03882 24328803
         ST    WORKR,IOBSTART      STORE CCW ADDR IN IOB       @ZA03882 24329703
         MVI   IOBECBCC,IOBCD      SET COMPLETION CODE IN IOB  @ZA03882 24330603
         OI    IOBFLAG1,IOBUNREL   SET UNRELATED FLAG IN IOB   @ZA03882 24331503
         BAL   XE,PGETLOCK         GET THE LOCAL AND CMS LOCKS @ZA03882 24332403
         LA    XF,DMDECB           GET ECB ADDRESS             @ZA03882 24333303
         STCM  XF,MASK7,ONE(X5)    STORE ECB ADDR IN EIL       @ZA03882 24334203
         STCM  XF,MASK7,IOBECBPB   STORE ECB IN IOB            @ZA03882 24335103
         OI    UCMSTS,UCMBF        INDICATE DEVICE BUSY        @ZA03882 24336003
         ST    X9,UCMDCB           DCB ADDR IN UCME            @ZA03882 24336903
         XC    DMDECB,DMDECB       CLEAR I/O ECB               @ZA03882 24337803
         BAL   XE,PFRELOCK         FREE LOCKS                  @ZA03882 24338703
         LTR   X7,X7               IS THERE A RECOVERY AREA ?  @ZA03882 24339603
         BZ    EXCPDOW             IF NOT,SKIP FOOTPRINT INIT. @ZA03882 24340503
         OI    PARMFTPT,NOPEXCP    IND. NOP EXCP ISSUED        @ZA03882 24341403
EXCPDOW  LR    X1,IOBREG           ADDRESS OF IOB IN REG 1     @ZA03882 24342303
         EXCP  (1)                 ISSUE EXCP                  @ZA03882 24343203
         LTR   X7,X7               IS THERE A RECOVERY AREA ?  @ZA03882 24344103
         BZ    EXCPDOWA            IF NOT,SKIP FOOTPRINT INIT. @ZA03882 24345003
         OI    PARMFTPT,NOPEXCPD   IND. NOP EXCP DONE          @ZA03882 24345903
EXCPDOWA B     PMRETRN1            RETURN TO CALLER            @ZA03882 24346803
PJOPNCT  ST    X9,CSAXD            INDICATE DCB STORAGE GOTTEN @ZA03882 24355003
         L     X4,UCMUCB           ADDR OF UCB                 @ZA03882 24356003
         USING UCB,X4              UCB ADDRESSABLLITY          @ZA03882 24357003
         MVC   ZERO(DMCORE,X9),DMDCB   MOVE IN DCB MODEL         Y02711 24360002
         SPACE 1                                                 Y02893 24400002
         GETMAIN R,SP=OPNSP,LV=PNCORE  ACQUIRE JFCB, WORKAREA    Y02893 24500002
         SPACE 1                                                 Y02893 24510002
         LR    X8,X1               SET UP BASE OF GOTTEN BLOCKS         24550001
         USING PNOPEN,X8           CAN USE AS DSECT                     24650001
         XC    PNOPEN(PNCORE),PNOPEN   CLEAR STORAGE             Y02711 24700002
         EJECT                                                          24750002
**************************************************************** Y02711 24760002
*                                                                Y02711 24770002
*  FORM THE DDNAME FOR THIS CONSOLE BY CONVERTING THE CONSOLE    Y02711 24800002
*  ID TO EBCDIC (TO 3 DIGITS) AND CONCATENATING IT TO 'IEAVM'.   Y02711 24850002
*                                                                Y02711 24860002
**************************************************************** Y02711 24870002
         SPACE 1                                                 Y02711 24900002
         SR    X1,X1               CLEAR FOR INSERT CHAR INSTR   Y02711 24950002
         IC    X1,UCMID            PICK UP BINARY CONSOLE ID     Y02711 25000002
         CVD   X1,PNWORKD          CONVERT ID TO PACKED DECIMAL  Y02711 25050002
         UNPK  PNWORKD(L5),PNWORKH4(L3)  UNPACK ID TO EBCDIC     Y02711 25100002
         MVC   DCBDDNAM,BASENAM    MOVE 'IEAVM' TO DDNAME IN DCB Y02711 25150002
         MVC   DCBDDNAM+D5(L3),PNWORKD   CONCATENATE CONSOLE ID  Y02711 25200002
         SPACE 2                                                 Y02711 25250002
*  SET UP THE JFCB, AND DCB AND OPEN EXIT LIST.                  Y02711 25300002
         SPACE 1                                                 Y02711 25350002
         MVC   JFCBDSNM,PNDSN      MOVE IN DSNAME + 1 BLANK      Y02711 25400002
         MVC   JFCBDSNM+D8(L36),JFCBDSNM+D7  SET REMAINDER OF    Y02711 25450002
*                                            DSNAME FIELD IN     Y02711 25460002
*                                            JFCB TO BLANKS.     Y02711 25470002
         SPACE 1                                                 Y02711 25480002
*  SET FIELDS IN THE JFCB TO PREVENT WRITE BACK OF THE JFCB.     Y02711 25490002
         OI    JFCBTSDM,JFCTTR+JFCNWRIT+JFCNDSCB+JFCNDCB+JFCPAT  Y02711 25494002
         SPACE 1                                                 Y02711 25496002
         OI    PNXLST,LASTNTRY+EXITJFCB  SHOW LAST JFCB ENTRY    Y02711 25498002
         LA    X1,JFCB             GET JFCB PTR.                 Y02711 25500002
         STCM  X1,MASK7,PNXLST+ONE PUT INTO OPENJ EXLST                 25550001
         LA    X1,PNXLST           GET EXIT LIST POINTER                25600001
         STCM  X1,MASK7,DCBEXLST+ONE  PUT INTO DCBEXLST                 25650001
         OI    PNJEF,LASTNTRY         SET LAST IND.IN PARM      YM06163 25670002
         EJECT                                                          25700001
**************************************************************** Y02711 25707002
*                                                                Y02711 25714002
*  NOW ISSUE OPEN, THEN FREEMAIN THE JFCB AND WORKAREA STORAGE.  Y02711 25721002
*                                                                Y02711 25728002
**************************************************************** Y02711 25735002
         SPACE 2                                                 Y02711 25742002
         OPEN  ((X9),OUTPUT),TYPE=J,MF=(E,PNJEF)    OPEN THE DCB Y02711 25750002
         SPACE 1                                                 Y02711 25800002
         XC    DCBEXLST+ONE(THREE),DCBEXLST+ONE    ZERO EXLST PTR       25950001
         LR    X1,X8               SET UP TO FREEMAIN JFCB, WORK Y02893 26000002
         DROP  X8                  FINISHED WITH JFCB, WORKAREA  Y02893 26050002
         SPACE 2                                                 Y02893 26070002
         FREEMAIN R,SP=OPNSP,LV=PNCORE,A=(1)  FREE JFCB, WORKA   Y02893 26100002
         SPACE 1                                                 Y02893 26150002
         LTR   X7,X7               IS THERE A RECOVERY AREA      Y02753 26152002
         BZ    PJOPRCVR            IF NOT, SKIP RESETTING FLAGS  Y02753 26154002
         NI    PARMFTPT,K255-POPEN TURN OFF OPEN PROCESS         Y02753 26156002
         EJECT                                                          26157002
PJOPRCVR DS    0H                                                Y02753 26158002
         BAL   XE,PGETLOCK         GO OBTAIN LOCAL AND CMS LOCKS Y02751 26160002
         ST    X9,UCMDCB           PTR TO THIS CONSOLES DCB INTO Y02711 26180002
*                                  UCME FOR THIS CONSOLE.        Y02711 26190002
         NI    UCMATR,K255-UCMAT04 TURN OFF DEVICE STATUS BIT.   Y02711 26192002
         OI    UCMATR,UCMUF        MARK THIS CONSOLE ACTIVE      Y02711 26194002
         NI    UCMSTS,K255-UCMTA   TURN OFF OPEN PENDING         Y02711 26196002
         SPACE 1                                                 Y02711 26198002
**************************************************************** Y02893 26199002
*  UPDATE EVENT INDICATION LIST (EIL) SO THAT THE I/O COMPLETE          26200001
*  ECB PTR IN IT WILL POINT TO THE ECB IN THE DECB.                     26250001
**************************************************************** Y02893 26270002
         SPACE                                                          26300001
         LA    XF,DMDECB           GET ECB PTR.                  Y02753 26350002
         STCM  XF,MASK7,ONE(X5)    UPDATE EIL                    Y20753 26370002
         SPACE 2                                                 Y02893 26402002
**************************************************************** Y02753 26442002
*    OPEN SUBROUTINE IS NOW COMPLETE, TEST WHETHER OPEN WAS      Y02753 26500002
*    SUCCESSFUL.                                                 Y02753 26550002
**************************************************************** Y02753 26570002
         SPACE 1                                                 Y02753 26600002
         TM    DCBOFLGS,DCBOFOPN   WAS OPEN SUCCESSFUL           Y02753 26610002
         BO    PMCF                IF YES, START PROCESSING      Y02753 26620002
         BAL   XE,PFRELOCK         IF OPEN FAILED, FREE LOCKS    Y02753 26630002
         B     PMERRCK             THEN GO TO CONSOLE SWITCH     Y02753 26640002
         EJECT                                                          26650002
         DS    0D                                                       26700001
ADCON    DC    A(IEAV1443)         START ADDR TO RESTORE BASE    Y02753 26720002
IGC0407B DC    CL8'IGC0407B'       NAME OF CONSOLE SWITCH ROUTINE       26750001
APPENDGE DC    X'07FE'             NOP APPENDAGE ROUTINE       @ZA03882 26800003
H128     DC    H'128'              RESTORE BLOCKSIZE                    26850001
         SPACE 1                                                 Y02893 26860002
BASENAM  DC    C'IEAVM'            BASE FOR CONSOLE DDNAME       Y02711 26870002
PNDSN    DC    C'CONSOLE '         DSNAME USED TO OPEN CONSOLES  Y02711 26880002
SVC72ID  DC    C'VCTR'             IDENTIFIER FOR RECOVERY RTN   Y02753 26885002
CCW      DS    0D                  BOUNDARY INITIALIZATION     @ZA03882 26886003
CCWNOP   CCW   NOPCODE,DATAD,SLIB,COUNT  NOP CCW               @ZA05367 26886403
         SPACE 1                                                 Y02752 26890002
*  MODULE PATCH AREA.                                            Y02752 26892002
         DS    0D                                                Y02752 26894002
PATCH    DC    XL50'00'            50 BYTE PATCH AREA            Y02752 26896002
         EJECT                                                          26946002
**************************************************************** Y02711 26996002
*                                                                Y02711 27046002
*  THE FOLLOWING SEGMENT CONTAINS THE FORM FOR THE DCB, AND THE  Y02711 27096002
*  EXECUTABLE MACRO LIST FORMS.  THE SEGMENT IS MOVED INTO       Y02711 27146002
*  DYNAMIC STORAGE AT CONSOLE OPEN TIME TO MAKE THE MODULE       Y02711 27196002
*  REENTRANT.                                                    Y02711 27246002
*                                                                Y02711 27296002
**************************************************************** Y02711 27346002
         SPACE 1                                                 Y02711 27396002
DMDCB    DCB   DDNAME=IEAVMXXX,                                  Y02711C27446002
               MACRF=(W),                                        Y02711C27496002
               SYNAD=PMERRCK,                                    Y02711C27516002
               DSORG=PS,                                         Y02711C27546002
               DEVD=PR,PRTSP=1,NCP=1,                            Y02711C27596002
               RECFM=FS,                                         Y02711C27646002
               BUFNO=0,                                          Y02711C27696002
               BLKSIZE=128                                       Y02711 27746002
         SPACE 1                                                 Y02711 27796002
DMXX     DC    D'0'                FORM FOR MODULE I/O WORKAREA  Y02711 27846002
DMWRITEX WRITE DMDECBX,SF,0,0,'S',MF=L   LIST FORM OF WRITE      Y02711 27896002
         SPACE 1                                                 Y02711 27946002
DCBSAVEX DC    A(0)                SPACE TO SAVE ORIGINAL DCB  @ZA05367 27966003
DMCORE   EQU   *-DMDCB             LENGTH FOR GETMAIN            Y02711 27996002
         EJECT                                                          28900001
X0       EQU   0                   REG 0 EQUATE                  Y02752 28910002
X1       EQU   1                   *                                    28950001
X2       EQU   2                   *                                    29000001
X3       EQU   3                   *                                    29050001
X4       EQU   4                   *                                    29100001
X5       EQU   5                   *                                    29150001
X6       EQU   6                   *                                    29200001
X7       EQU   7                   ESTAE PARMLIST BASE           Y02753 29250002
X8       EQU   8                   *                                    29300001
X9       EQU   9                   PTR TO DCB                    Y02893 29350002
XA       EQU   10                  UCME BASE, THIS CONSOLE       Y02893 29400002
XB       EQU   11                  CXSA BASE (RBEXSAVE)          Y02893 29450002
XC       EQU   12                  PROGRAM BASE REG              Y02893 29500002
XD       EQU   13                  STANDARD REG SAVE AREA        Y02893 29550002
XE       EQU   14                  *                                    29600001
XF       EQU   15                  *                                    29650001
D5       EQU   5                   DISPLACEMENT OF 5             Y02752 29660002
D7       EQU   7                   DISPLACEMENT OF 7             Y02752 29670002
D8       EQU   8                   DISPLACEMENT OF 8             Y02752 29680002
K255     EQU   255                 MASK FOR TURNING OFF FLAGS    Y02893 29700002
L3       EQU   3                   LENGTH OF 3 BYTES             Y02752 29960002
L5       EQU   5                   LENGTH OF 5 BYTES             Y02752 29970002
L36      EQU   36                  LENGTH OF 36 BYTES            Y02752 29980002
ZERO     EQU   0                   ZERO                          Y02893 30000002
ONE      EQU   1                   ONE                           Y02893 30050002
TWO      EQU   2                   TWO                           Y02893 30100002
THREE    EQU   3                   THREE                         Y02893 30150002
FOUR     EQU   4                   FOUR                          Y02893 30200002
EIGHT    EQU   8                   EIGHT                         Y02893 30250002
TEN      EQU   X'10'               IOB PREFIX                  @ZA03882 30260003
TWN4     EQU   X'24'               DEB PREFIX                  @ZA03882 30270003
MASK7    EQU   7                   MASK FOR THE ICM INSTRUCTION  Y02893 30300002
WORKR    EQU   1                   WORK REGISTER               @ZA03882 30310003
IOBREG   EQU   8                   IOB REGISTER                @ZA03882 30320003
DEBREG   EQU   4                   DEBREG REGISTER             @ZA03882 30330003
ZEROBYTE EQU   X'00'               FOR CLEARING FLAG BYTES       Y02753 30355002
LASTNTRY EQU   X'80'               SYMBOLIC FOR END OF LIST FLAG Y02752 30360002
EXITJFCB EQU   X'07'               JFCB EXIT LIST FLAG           Y02752 30370002
SVSP     EQU   255                 SUBPOOL NO. FOR REG SAVE AREA Y02893 30372002
SVLN     EQU   72                  LENGTH OF REG SAVE AREA       Y02893 30374002
DMSP     EQU   255                 SUBPOOL NO. FOR DCB STORAGE   Y02893 30376002
OPNSP    EQU   255                 SUBPOOL NO. FOR OPEN WORKAREA Y02893 30378002
POPEN    EQU   X'08'               FOOTPRINT FOR OPEN PROCESS    Y02753 30378402
PWRITE   EQU   X'20'               FOOTPRINT FOR WRITE MACRO     Y02753 30378802
PCHECK   EQU   X'02'               FOOTPRINT FOR CHECK MACRO     Y02753 30379202
PCLOSE   EQU   X'10'               FOOTPRINT FOR CLOSE MACRO     Y02753 30379602
NOPEXCP  EQU   X'01'               NOP EXCP ISSUED             @ZA03882 30379803
NOPEXCPD EQU   X'03'               NOP EXCP COMPLETED          @ZA03882 30380003
IOBCD    EQU   X'7F'               SUCCESSFUL I/O TEST         @ZA03882 30381003
IOBCOR   EQU   48                  LENGTH OF IOB               @ZA10145 30382003
DEBCOR   EQU   96                  LENGTH OF DEB               @ZA03882 30383003
*******  THE FOLLOWING TWO EQUATES ARE FOR THE IOB AND DEB.    @ZA05367 30383903
         EJECT                                                          30384003
*******  IF EITHER OF THESE CONTROL BLOCKS CHANGE IN SIZE, THE @ZA05367 30384103
*******  EQUATES MUST BE CHANGED.                              @ZA05367 30384303
NOPCODE  EQU   3                   NOP COMMAND CODE            @ZA05367 30386103
DATAD    EQU   0                   NO DATA ADDR                @ZA05367 30386503
SLIB     EQU   X'20'               SLI BIT                     @ZA05367 30386903
COUNT    EQU   1                    COUNT FIELD                @ZA05367 30387303
*  NOTE:  THE DSECT MAPPED BY IHADCB INCLUDES THE LIST FORM OF   Y02711 30390002
*         THE WRITE MACRO, AND A DOUBLE WORD OF WORK AREA USED   Y02711 30392002
*         IN CONNECTION WITH THE I/O OPERATIONS OF THIS MODULE.  Y02711 30394002
         SPACE 3                                                 Y02711 30396002
DMDCB    IHADCB DSORG=BS,DEVD=PR   DCB MAPPING MACRO             Y02711 30398002
         SPACE 2                                                 Y02711 30398402
DMX      DC    D'0'                I/O WORK AREA                 Y02711 30398802
DMXA     EQU   DMX+4               SECOND WORD OF WORK AREA      Y02711 30399202
DMXCLOSE EQU   128                 CLOSE TERMINAL FLAG          YM05450 30399602
DMXW     EQU   4                                                 Y02711 30399702
         SPACE 1                                                 Y02711 30404003
DMWRITE  WRITE DMDECB,SF,DMX,DMX,'S',MF=L  WRITE MACRO           Y02711 30406003
DCBSAVE  DC    A(0)                SPACE TO SAVE ORIGINAL DCB  @ZA05367 30407003
         EJECT                                                          30408003
PNOPEN   DSECT                                                   Y02711 30410002
JFCB     DS    0D                                                Y02711 30420002
         IEFJFCBN ,                                              Y02711 30430002
         SPACE 2                                                 Y02711 30440002
*  OPEN EXIT LIST FOR TYPE=J (SET UP BY THE OPEN MACRO)          Y02711 30442002
         SPACE 1                                                 Y02711 30444002
PNJEF    DC    X'80'               INDICATE END OF LIST          Y02711 30446002
         DC    AL3(0)              SPACE FOR ADDRESS             Y02711 30448002
         SPACE 2                                                 Y02711 30448402
PNXLST   DC    X'87'               END OF LIST AND JFCB EXIT     Y02711 30448802
         DC    AL3(0)              ADDRESS OF JFCB               Y02711 30449202
         SPACE 2                                                 Y02711 30449602
*  TEMPORARY WORK AREA USED DURING PREPARATION FOR OPEN          Y02711 30449702
         SPACE 1                                                 Y02711 30449802
PNWORKD  DC    D'0'                DOUBLE WORD FOR CVD INSTR     Y02711 30449902
         ORG   PNWORKD+6           BACK UP TO LAST HALF WORD     Y02711 30466602
PNWORKH4 DC    H'0'                LAST HALF WORD OF PNWORKD     Y02711 30476602
PNWORKX  DC    X'00'               EXTRA BYTE USED DURING UNPK   Y02711 30478602
         SPACE 1                                                 Y02711 30480602
PNCORE   EQU   *-PNOPEN            SYMBOLIC FOR LENGTH OF DSCET  Y02711 30482602
         EJECT                                                          30483002
         CVT DSECT=YES                                                  30483302
         EJECT                                                          30500001
         EJECT                                                          30502103
         IEZIOB DSECT=YES                                      @ZA03882 30504003
DEBC     DSECT                                                 @ZA03882 30506003
         EJECT                                                          30507003
         IEZDEB LIST=YES                                       @ZA03882 30508003
         IHAFRRS                   USED BY SETFRR MACRO          Y02751 30510002
         EJECT                                                          30520002
         IHAPSA                    USED BY THE SETFRR MACRO      Y02751 30530002
         EJECT                                                          30540002
         IHARB DSECT=YES           RB MAPPING USED IN RECOVERY   Y02753 30543002
         EJECT                                                          30546002
         IKJTCB                                                         30550001
         EJECT                                                          30600001
UCB      DSECT                                                          30650001
         IEFUCBOB                                                       30700001
         EJECT                                                          30750001
         IEECUCM FORMAT=NEW                                             30800001
         EJECT                                                          30850001
         IHACTM CXSA                                                    30900001
         EJECT                                                          31100001
         IHACTM FTPT               RECOVERY WORKAREA MAPPING     Y02753 31110002
         EJECT                                                          31120002
         IHAWQE                                                         31150001
         EJECT                                                          31250001
         IHACTM CQE                                                     31300001
         END                                                            31350001
