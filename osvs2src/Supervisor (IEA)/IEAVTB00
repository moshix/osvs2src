         TITLE 'IEAVTB00...IGC0001D...SPIE PROCESSING'                  00100002
*/* START OF SPECIFICATIONS ****                                        00104002
*                                                                       00106002
*01*  MODULE-NAME = IEAVTB00                                            00112002
*                   NOTE - AT SYSGEN TIME THE MODULE                    00114002
*                   NAME IS CHANGED TO IGC0004X                         00116002
*                   WHERE X IS A 12-0 PUNCH.                            00118002
*                   THE ENTRY POINT IS IGC00040.                        00120002
*                                                                       00124002
*02*     CSECT-NAME = IGC0001D                                          00128002
*                                                                       00136002
*01*  DESCRIPTIVE-NAME = SPIE/EXTRACT SERVICE ROUTINES                  00140002
*                                                                       00148002
*01*  COPYRIGHT = NONE                                                  00152002
*                                                                       00156002
*01*  STATUS = OSVS2 RELEASE 2                                          00172002
*                                                                       00180002
*01*  FUNCTION = SPIE - SPIE PROVIDES A PROBLEM PROGRAM WITH A MEANS OF 00184002
*     SPECIFYING AN ERROR EXIT ROUTINE IN RESPONSE TO ONE OR MORE       00186002
*     PROGRAM ERROR INTERRUPTS.                                         00188002
*                EXTRACT - PROVIDES A MEANS OF OBTAINING                00188502
*     THE ADDRESS OR THE VALUES OF A PREDEFINED SET OF FIELDS WITHOUT   00189002
*     CHASING THROUGH VARIOUS SYSTEM QUEUES.                            00190002
*                                                                       00192002
*02*     OPERATION = SPIE - INITIALLY DOES GETMAIN FOR SCA AND PIE AND  00196002
*        CHAINS THEM ALONG WITH THE USER INPUT (PICA) TO THE TCBPIE     00200002
*        FIELD IN THE TCB. WHEN THE INPUT FROM THE CALLER REFLECTS A    00208002
*        CANCEL REQUEST THE SCA & PIE ARE FREED AND TCBPIE RESET TO     00209002
*        ZERO. SPIE WILL ALSO GETMAIN A RECOVERY PIE PICA WHICH WILL BE 00210003
*        USED TO MAINTAIN A SPIE ENVIRONMENT WHEN AN RB TERMINATES      00210103
*        ABNORMALLY. THE RPP WILL CONTAIN THE PIE,PICA,AND RB POINTERS  00210203
*        FOR THE RB ISSUING THE SPIE.                                   00210303
*                                                                       00210803
*                EXTRACT - OBTAINS SYSTEM DATA AND RETURNS IT OR THE    00210903
*        ADDRESS OF IT IN A USER SUPPLIED ANSWER AREA.                  00211002
*                                                                       00212002
*01*   NOTES = BOTH PROGRAMS RUN PARTICALLY IN USER KEY AND KEY ZERO.   00216002
*      BE CAREFUL WHEN MAKING CODE CHANGES.                             00218002
*                                                                       00220002
*02*     DEPENDENCIES = BOTH SPIE AND EXTRACT MUST BE ENTERED WITH THE  00224002
*        LOCAL LOCK HELD, KEY 0 AND IN SUPERVISOR STATE.                00228002
*                                                                       00244002
*03*        CHARACTER-CODE-DEPENDENCIES = NONE                          00248002
*                                                                       00252002
*02*     RESTRICTIONS = SPIE-CALLER MUST BE AUTHORIZED FOR SPIE PROGRAM 00264002
*        CHECK 17.  CALLER MUST BE IN PROBLEM MODE AND KEY MUST EQUAL   00266002
*        TO THE TCBPKF KEY.                                             00268002
*                                                                       00272002
*02*     REGISTER-CONVENTIONS = R12 IS USED TO COMMUNICATE BETWEEN THE  00276002
*        MAINLINE AND THE FRR.                                          00280002
*                                                                       00292002
*02*     PATCH-LABEL = IEAVTBP                                          00296002
*                                                                       00298002
*01*  MODULE-TYPE = TYPE 3 SVC ROUTINE                                  00306002
*                                                                       00310002
*02*     PROCESSOR = ASSEMBLER                                          00312002
*                                                                       00314002
*02*     MODULE-SIZE = 1400 BYTES                                       00316002
*                                                                       00322002
*02*     ATTRIBUTES = PAGED-LPA, ZERO PROTECT KEY, ENABLED,             00324002
*        REENTERABLE, REFRESHABLE, LOCALLY LOCKED                       00330002
*        SUPERVISOR MODE;                                               00332002
*                                                                       00334002
*01*  ENTRY-POINT = IGC0001D - SPIE;                                    00336002
*                                                                       00336102
*02*     INPUT =                                                        00336202
*        REGISTERS - 0, 15 IRRELEVANT                                   00336302
*                  - 1 ADDRESS OF PICA OR ZERO(FOR CANCEL)              00336402
*                  - 2-14 NORMAL SVC REG SET UP                         00336802
*                                                                       00346002
*01*  ENTRY-POINT = IEAVSPIE - SPIE RESOURCE MANAGER                    00348002
*                                                                       00350002
*02*     INPUT =                                                        00352002
*        REGISTERS - 1 ADDRESS OF WORD WHICH CONTAINS THE ADDRESS       00354002
*                      OF THE RMPL.                                     00356002
*                  - 13 ADDRESS OF 72 BYTE SAVE AREA                    00358002
*                  - 14 RETURN ADDRESS                                  00360002
*                  - 15 ENTRY ADDRESS                                   00362002
*                  - 0, 2-12 IRRELEVANT                                 00364002
*01*  ENTRY-POINT = IGC00040 - EXTRACT SVC ENTRY                        00366002
*                                                                       00368002
*02*     INPUT =                                                        00370002
*        REGISTERS - 0, 15 IRRELEVANT                                   00372002
*                  - 1 ADDRESS OF EXTRACT PARAMETER LIST                00374002
*                 - 2-14 NORMAL SVC REGISTERS                           00376002
*01*  ENTRY-POINT = IGC00040+8 - BRANCH ENTRY TO EXTRACT                00378002
*                                                                       00380002
*02*     INPUT =                                                        00382002
*        REGISTERS - 1 ADDRESS OF EXTRACT PARM LIST                     00384002
*                  - 4 ADDRESS OF TCB                                   00386002
*                  - 14 RETURN ADDRESS                                  00388002
*                  - 15 ENTRY ADDRESS                                   00390002
*                  - 3 CVT ADDRESS                                      00392002
*                  - 0,2,5-13 IRRELEVANT                                00394002
*01*  ENTRY-POINT = IEAVSPI - CHECKPOINT/RESTART SUBROUTINE             00396002
*                                                                       00400002
*02*     INPUT =                                                        00402002
*        REGISTERS - 1 SSCA ADDRESS                                     00404002
*                  - 13 ADDRESS OF 72 BYTE SAVE AREA                    00406002
*                  - 14 RETURN ADDRESS                                  00408002
*                  - 15 ENTRY ADDRESS                                   00410002
*                  - 0 2-12 IRRELEVANT                                  00412002
*                                                                       00414002
*                                                                       00416002
*01*  EXIT-NORMAL = RETURN TO CALLER ON REGISTER 14.                    00426002
*                   SPIE - R1 CONTAINS  THE ADDRESS OF THE PREVIOUS     00426602
*                          PICA OR 0. NO RETURN CODES.                  00427202
*                   EXTRACT - NO RETURN CODES.                          00428002
*                   IEAVSPIE - RETURN CODE 0.                           00430002
*                   IEAVSPI - RETURN CODE 0                             00432002
*                                                                       00434002
*                                                                       00462002
*01*  EXIT-ERROR = SPIE - ABEND CODES:                                  00464002
*                       - '10E' INVALID PICA;                           00464202
*                       - '20E' INVALID PIE                             00464402
*                       - '30E' NOT AUTHORIZED FOR INTERRUPT            00464602
*                            CODE 17 OR CALLED  SPIE IN SUPERVISOR      00465002
*                            STATE OR HAD A PSW KEY OTHER THAN          00465602
*                            THAT CONTAINED IN THE TCBPICF.             00466202
*                  EXTRACT - ABEND CODES:                               00466802
*                       - '128' INVALID ANSWER LIST                     00467402
*                       - '228' INVALID PARM LIST                       00468002
*                       - '338' INVALID TCB ADDRESS                     00468302
*                  IEAVSPIE - NONE                                      00468602
*                  IEAVSPI - NONE                                       00469002
*                                                                       00472002
*01*  EXTERNAL-REFERENCES = ROUTINES                                    00512002
*                           SPIE - ABEND, GETMAIN, FREEMAIN, TESTAUTH   00513002
*                                  PURGEDQ                              00513502
*                           EXTRACT - ABEND                             00514002
*                                                                       00519002
*02*     DATA-AREAS = SPIE - NONE                                       00520002
*                     EXTRACT - ANSWER LIST SUPPLIED BY CALLER          00521002
*                     IEAVSPI - SSCRDATA MAPPED BY THE DATA DSECT.      00522002
*                                                                       00525002
*02*     CONTROL-BLOCKS = SPIE - TCB, RB, PIE, PICA, SCA                00526002
*                         EXTRACT - TCB,  ASCB, JSCB, CSCB, IQE, RB;    00527002
*                         IEAVSPIE - RMPL, TCB, RB, PIE, PICA,          00528002
*                         IEAVSPI - SSCR, TCB, PIE, PICA                00529002
*                                                                       00530002
*                                                                       00531002
*01*  TABLES = NONE                                                     00532002
*                                                                       00534002
*01*  MACROS = SPIE - ABEND, FREEMAIN, GETMAIN, MODESET, SETFRR,        00536002
*                     SETLOCK, SETRP, TESTAUTH, PURGEDQ.                00538002
*              EXTRACT - ABEND, MODESET, SETFRR, SETRP.                 00538502
*                                                                       00539002
*02*    SERIALIZATION = THE LOCAL LOCK IS USED FOR SERIALIZATION        00540002
*                                                                       00543002
*01*  CHANGE-ACTIVITY = Y02752 FOR OS/VS2 FOR RELEASE 2                 00544002
*                       OZ06785 - HANDLE PROBLEM PROGRAM SPIE COVERAGE  00547003
*                                 AND MULTIPLE LOGREC ENTRIES BY        00547103
*                                 PROGRAM MANAGER.             @ZA28693 00548203
*                       OZ11839 - SPIE CONTROL BLOCKS WILL BE FREED ON  00548303
*                                 TERMINATION.                 @ZA28693 00548403
*                       OZ12729 - CHECKPOINT/RESTART SUPPORT. THE       00548603
*                                 RPIEPICA IS REBUILT AFTER RESTART IF  00548703
*                                 THERE WAS AN OUTSTANDING SPIE AT THE  00548803
*                                 CHECKPOINT.                  @ZA28693 00548903
*                       OZ20162 - ISSUE MODESET TO USER KEY BEFORE      00549103
*                                 REFERENCING THE USERS PICA. IF A PAGE 00549203
*                                 FAULT OCCURS AND IS INVALID FOR ANY   00549303
*                                 REASON THE USER WILL BE ABENDED WITH  00549403
*                                 A 10E COMPLETION CODE.       @ZA28693 00549503
*                       OZ28693 - IF THE NEXT RPIEPICA IS ZERO THEN THE 00549603
*                                 PIE WILL BE FREED AND THE SCAPIE SET  00549703
*                                 TO ZERO DURING RB TERMINATION WITH A  00549803
*                                 RETRY TO AN ESTAE ROUTINE.   @ZA28693 00550603
*                       OZ29414 - CHANGE THE PURGEDQ MACRO FROM STAND-  00550703
*                                 ARD FORM TO LIST AND EXECUTE FORMS SO 00550803
*                                 THAT IEAVTB00 WILL NOT STORE INTO     00550903
*                                 ITSELF.                      @ZA29414 00551003
*                       OZ31066 - FIX PE FOR OZ28693 BY ISSUING         00551103
*                                 FREEMAIN SVC INSTEAD OF THE BRANCH    00551203
*                                 ENTRY USED IN THE ORIGINAL.  @ZA31066 00551303
*01*  MESSAGES = NONE                                                   00551403
*                                                                       00552203
*01*  ABEND-CODES = (SEE EXITS ERROR)                                   00554002
*                                                                       00557002
**** END OF SPECIFICATIONS ***/                                         00558002
IGC0001D CSECT                                                          00560002
         EJECT                                                          00560502
         ENTRY IEAVSPIE       E.P. FOR THE RESOURCE MANAGER             00561002
         ENTRY IEAVSPI        E.P. SPECIFICALLY FOR CHECKPT/RESTART     00562002
         ENTRY IGC00040       E.P. FOR EXTRACT SVC ENTRY                00563002
         USING PSA,0          PSA AT LOC 0                              00564002
*        R0 THRU R3 ARE WORK REGISTERS                                  00600002
         USING TCB,R4         CURRENT TCB REGISTER                      00700002
         USING RBSECT,R5      SPIE'S SVRB ADDRESS                       00800002
         USING IGC0001D,R6    SPIE'S BASE REGISTER                      00900002
         USING ASCB,R7        CURRENT ASCB ADDRESS                      01000002
         USING PIE,R8         PIE ADDRESS                               01100002
         USING PICA,R9        NEW PICA REGISTER                         01200002
*        R10 IS THE OLD PICA REGISTER                                   01300002
         USING SCA,R11        SCA ADDRESS                               01400002
*        R12 CONTAINS INPUT TO THE FRR SHOULD AN ABEND OCCUR            01500002
*        R13=CODE17INDICATOR/NEWRBOPSWMASK/NEWTCBPMASK/CALLERPROTECTKEY 01600002
*        R14 AND R15 ARE WORK REGISTERS                                 01700002
         LA    R9,0(R1)       SAVE THE NEW PICA ADDRESS                 01800002
         B     SPID           GO AROUND ID                              01900002
         DC    CL8'IGC0001D'  SPIE'S I.D.                               02000002
SPID     EQU   *              BEGIN HERE                                02100002
         LA    R15,SPFRR      FRR E.P. ADDRESS                          02200002
         SETFRR A,FRRAD=(R15),WRKREGS=(R1,R2) SETUP FRR                 02300002
TEST1    EQU   *                                                        02400002
         EJECT                                                          02430002
*        SPIE MAIN PROCESSING STARTS HERE                               02460002
         NI    TCBFLGS6,XFF-TCBPIE17 RESET TCBPIE17 BIT                 02500002
         SR    R10,R10        INIT OLD PICA ADDRESS TO ZERO             02600002
         L     R5,RBLINK-RBSECT(R5)  GET SPIES CALLERS' RB              02700002
         SR    R13,R13        INITIALIZE TO ZERO (VERY IMPORTANT)       02800002
         IC    R13,RBOPSWKY-RBSECT(R5) OBTAIN USERS PROTECT KEY         02900002
         N     R13,FFFFFFF0   ZERO NON KEY BITS.                        03000002
*        CALLER MUST BE PROBLEM STATE AND HAVE A KEY MATCHING           03100002
*        THE TCBPKF (PROTECTION KEY) FIELD                              03200002
         CLM   R13,M0001,TCBPKF Q. IS CALLER'S KEY VALID                03300002
         BNE   SPABEND        INVALID CALLER                            03400002
         TM    RBOPSW+AMWP-RBSECT(R5),PBIT Q. IS CALLER PROBLEM STATE   03500002
         BNO   SPABEND        A. NO. ABEND INVALID CALLER.              03600002
         LTR   R9,R9          Q. CANCEL (NEW PICA = 0)                  03700002
         BZ    SPCANCEL       A. YES                                    03800002
         LR    R2,R13         GET USERS KEY FOR KEY SWITCH.             03900002
         MODESET  KEYADDR=(2)  SWITCH TO KEY OF CALLER                  04000002
TEST1A   EQU   *              *                                         04100002
         EJECT                                                          04120002
*        CHECK CANCEL                                                   04140002
*           IF YES, GO TO SPCANCEL                                      04160002
*           IF NO, GO TO SPNOCNCL                                       04180002
         L     R12,SP10E      Q. BAD PICA.                              04200002
         TM    PICITMK1-PICA(R9),PICAEXT  Q. EXTENDED PICA              04300002
*        A PROGRAM CHECK HERE RESULTS IN A 10E ABEND                    04400002
         BZ    SPNOEXTN       A. NO                                     04500002
         CLC   PICITMK1-PICA(FOUR,R9),HIGHBIT Q. CANCEL                 04600002
*        A PROGRAM CHECK HERE RESULTS IN A 10E ABEND                    04700002
         BE    SPCANCEL       A. YES.                                   04800002
SPNOEXTN EQU   *              *                                         04900002
         CLC   PICITMK1-PICA(TWO,R9),HZERO Q. CANCEL                    05000002
*        A PROGRAM CHECK HERE RESULTS IN A 10E ABEND.                   05100002
         BNE   SPNOCNCL       A. NO.                                    05200002
         EJECT                                                          05300002
*        THIS IS A REQUEST TO CANCEL                                    05400002
SPCANCEL EQU   *              *                                         05500002
         EJECT                                                          05510002
*        CHECK IF SPIE ENVIRONMENT EXISTS                               05520002
*           IF NO, GO TO SPFINISH                                       05530002
*           IF YES, FREE THE SCA & PIE                                  05540002
*                   RESTORE THE ORIGINAL                                05550002
*                   PSW PROGRAM MASK                                    05560002
*                   ZERO THE TCBPIE                                     05570002
*                   AND THEN GO TO                                      05580002
*                   SPFINISH                                            05590002
         MODESET EXTKEY=SUPR  SWITCH INTO KEY 0.                        05600002
TEST1B   EQU   *              *                                         05700002
         SR    R12,R12        RESET ABEND CODE REG.                     05800002
         ICM   R13,M0100,TCBPMASK  USER'S ORIG MASK RESTORED.           05900002
         L     R11,TCBPIE     Q. SCA ADDRESS                            06000002
         LA    R11,ZERO(R11)  DITTO                                     06100002
         LTR   R11,R11        DITTO                                     06200002
         BZ    SPFINISH       A. NO.                                    06300002
         SR    R0,R0          CLEAR FOR STORE                           06400002
         ST    R0,TCBPIE      ZERO TCBPIE FIELD.                        06500002
         L     R8,SCARPPTR    GET TOP ACTIVE RPIEPICA         @ZA11839  06510003
         LTR   R8,R8              DOES RPIEPICA EXIST?         @ZA28693 06520003
         BZ    NOFREERP           NO DONT TRY TO FREE IT       @ZA28693 06522003
         BAL   R12,FREERPPS   GO FREE ALL ACTIVE RPIEPICAS    @ZA11839  06524003
NOFREERP DS    0H                 CONTINUE TO FREE SPIE BLOCKS @ZA28693 06526003
         L     R8,SCAFRPPQ      GET TOP FREE RPIEPICA         @ZA11839  06530003
         LTR   R8,R8            Q. ANY FREE RPIEPICAS         @ZA11839  06540003
         BZ    FREESCA          A. NO - GO FREE THE SCA       @ZA11839  06550003
         BAL   R12,FREERPPS     A. YES - GO FREE ACTIVE RPP   @ZA11839  06560003
FREESCA  L     R8,SCAPIE      GET PIE ADDRESS.                          06600003
         SR    R12,R12          RESET ABEND REG               @ZA11839  06620003
         FREEMAIN RU,LV=SCALEN1,A=(R11),SP=245,BRANCH=YES  FREE SCA     06650003
*                                                                       06800003
*        AT THIS TIME REGISTER 10 IS ZERO AS IT SHOULD BE FOR RETURN    06820003
*        TO THE USER. IF A PIE EXISTS THE PIEPICA WILL BE LOADED.       06840003
*                                                                       06860003
         LTR   R8,R8              DOES THE PIE EXIST?          @ZA28693 06880003
         BZ    SPFINISH           CLEANUP AND RETURN           @ZA28693 06900003
TEST1C   EQU   *              *                                         06920003
         LR    R2,R13         GET USER'S KEY                            06940003
         MODESET KEYADDR=(2)   SWITCH TO THAT KEY                       07000002
TEST1X   EQU   *              *                                         07100002
         L     R12,SP20E      CODE FOR BAD PIE                          07200002
         L     R10,PIEPICA    SAVE OLD PICA ADDRESS                     07300002
*        A PROGRAM CHECK HERE RESULTS IN A 20E ABEND                    07400002
         SR    R12,R12        RESET THE ABEND CODE REGISTER             07500002
         MODESET EXTKEY=SUPR   SWITCH TO KEY 0                          07600002
TEST1Y   EQU   *              *                                         07700002
         FREEMAIN RU,LV=PIELEN,A=(R8),SP=250,BRANCH=YES FREE THE PIE    07800002
TEST1D   EQU   *              *                                         07900002
         B     SPFINISH       CLEANUP AND RETURN.                       08000002
         SPACE 3                                                        08001003
FREERPPS EQU   *              ROUTINE TO FREE RPIEPICAS     @ZA11839    08002003
         L     R2,RPIEPICA-RPPNPTR(,R8) GET NEXT RPIEPICA   @ZA11839    08003003
         FREEMAIN RU,LV=RPPLEN,A=(R8),SP=253,BRANCH=YES     @ZA11839    08004003
         LTR   R2,R2          Q. ANY MORE RPIEPICAS         @ZA11839    08005003
         BNZ   LOOP           A. YES - GO GET NEXT          @ZA11839    08006003
         BR    R12            A. NO - RETURN                @ZA11839    08007003
LOOP     LR    R8,R2          GET NEW TOP RPP               @ZA11839    08008003
         B     FREERPPS         GO FREE IT                  @ZA11839    08009003
               EJECT                                                    08010002
*              CHECK FOR INTERRUPT CODE 17                              08020002
*                     IF NO, GO TO SPNO17                               08030002
*                     IF YES, CHECK IF AUTHORIZED                       08040002
*                     IF NOT AUTHORIZED ABEND                           08050002
*                          IF AUTHORIZED DEFER                          08060002
*                          SETTING OF TCBPIE17                          08070002
*                          GO TO SPNO17                                 08080002
SPNOCNCL EQU   *              *                                         08100002
         ICM   R13,M0100,PICAPRMK-PICA(R9)  GET THE NEW PGM MASK        08200002
*        A PROGRAM CHECK HERE RESULTS IN A 10E ABEND.                   08300002
         TM    PICITMK1-PICA(R9),PICAEXT  Q. EXTENDED PICA.             08400002
*        A PROGRAM CHECK HERE RESULTS IN A 10E ABEND.                   08500002
         BZ    SPNO17         A. NO. CAN'T BE CODE 17                   08600002
         TM    PICITMK3,PICACD17   Q. CODE 17 REQUESTED                 08700002
*        A PROGRAM CHECK HERE RESULTS IN A 10E ABEND.                   08800002
         BZ    SPNO17         A. NO.                                    08900002
         SR    R12,R12        RESET ABEND CODE REG.                     09000002
         MODESET EXTKEY=SUPR     SWITCH TO KEY 0.                       09100002
TEST1E   EQU   *              *                                         09200002
         TESTAUTH FCTN=1,KEY=YES,BRANCH=YES  Q.AUTHORIZED FOR CODE 17   09300002
TEST1F   EQU   *                                                        09400002
         LTR   R15,R15        DITTO                                     09500002
         BNZ   SPABEND        A. NO. BOMB INVALID CALLER                09600002
         LR    R2,R13         GET USER'S KEY                            09700002
         MODESET KEYADDR=(2)   SWITCH KEY                               09800002
TEST1G   EQU   *              *                                         09900002
         ICM   R13,M1000,HIGHBIT   SET HIGH BIT ON TO INDICATE CODE 17  10000002
        EJECT                                                           10005002
*       CHECK IF SPIE ENVIRONMENT EXISTS                                10010002
*          IF NO, GETMAIN SCA AND PIE,                                  10015002
*                 SAVE CALLERS MASK                                     10020002
*                 IN TCBPMASK, SET                                      10025002
*                 HIS MASK FROM PICA                                    10030002
*                 MASK AND CHAIN                                        10035002
*                 THE PICA TO PIE,                                      10040002
*                 PIE TO SCA, AND                                       10045002
*                 SCA TO TCB THEN RETURN                                10050002
*                 TO CALLER WITH REG1=0                                 10055002
*          IF YES, SET THE CALLERS                                      10060002
*                 PSW MASK WITH                                         10065002
*                 PICA MASK, SAVE                                       10070002
*                 OLD PICA, CHAIN NEW                                   10075002
*                 PICA TO PIE THEN                                      10080002
*                 RETURN TO CALLER                                      10100002
*                 WITH REG1=PREVIOUS PICA                               10130002
SPNO17   EQU   *              CHECK OUT THE OLD PICA                    10160002
         EJECT                                                          10200002
*        THIS IS A NEW OR NESTED REQUEST                                10300002
         SR    R12,R12        RESET ABEND CODE REG.                     10400002
         L     R11,TCBPIE     OBTAIN SCA ADDRESS                        10500002
         LA    R11,ZERO(R11)  CLEAR THE HIGH BYTE                       10600002
         LTR   R11,R11        Q. DOES A SPIE ENVIRONMENT EXIST          10700002
         BNZ   SCANOGET       A. YES, SCA  ALREADY EXISTS      @ZA06785 10750003
*        THIS IS A NEW REQUEST                                          10900002
         MODESET EXTKEY=SUPR  SWITCH TO KEY 0.                          11000002
TEST1H   EQU   *              *                                         11100002
         GETMAIN RU,LV=PIELEN,SP=250,BRANCH=YES GET A PIE               11200002
TEST2    EQU   *                                                        11300002
         LA    R8,ZERO(R1)    SAVE PIE ADDRESS                          11400002
         GETMAIN RU,LV=SCALEN1,SP=245,BRANCH=YES  GET THE SCA           11500003
TEST3    EQU   *                                                        11600002
         LA    R11,ZERO(R1)   SAVE THE SCA ADDRESS                      11700002
         XC     SCA(SCALEN1),SCA      ZERO THE SCA         @ZA06785     11750003
         SR    R10,R10        INDICATE NO OLD PICA.                     11800002
         LR    R2,R13         GET USER'S KEY                            11900002
         MODESET  KEYADDR=(2)  SWITCH TO THAT KEY                       12000002
TEST3A   EQU   *              *                                         12100002
         B     SPNPICA        CHECK THE NEW PICA.                       12200002
SCANOGET EQU  *               CHECK IF PIE ALREADY EXISTS     @ZA06785  12206003
         L     R8,SCAPIE      OBTAIN PIE ADDRESS              @ZA06785  12212003
         LTR   R8,R8          Q. DOES PIE EXIST               @ZA06785  12218003
         BNZ   SPNOGET        A. YES                          @ZA06785  12224003
TEST23   EQU    *                                             @ZA06785  12230003
       MODESET  EXTKEY=SUPR  GET IN SUPERVISOR STATE         @ZA06785   12236003
         GETMAIN  RU,LV=PIELEN,SP=250,BRANCH=YES  GET A PIE   @ZA06785  12242003
         ST     R1,SCAPIE      SAVE PIE ADDRESS               @ZA06785  12248003
         LR     R8,R1         GET PIE ADDRESSABILITY          @ZA06785  12254003
         L      R12,SP20E     SET ABEND CODE                  @ZA06785  12260003
         XC     PIEPICA(FOUR),PIEPICA  INDICATE NO OLD PICA   @ZA06785  12266003
*      PROGRAM CHECK HERE RESULTS IN 20E ABEND                          12272003
         SR     R12,R12       RESET ABEND REGISTER            @ZA06785  12278003
         LR    R2,R13       GET USER KEY                     @ZA06785   12284003
         MODESET KEYADDR=(2)    RETURN TO USER KEY           @ZA06785   12290003
SPNOGET  EQU   *              NO GETMAIN ON THIS PATH.                  12300002
*        THIS IS A NESTED REQUEST                                       12400002
         L     R8,SCAPIE      SAVE PIE ADDRESS                          12500002
         L     R12,SP20E      Q. BAD PIE                                12600002
         L     R10,PIEPICA    SAVE OLD PICA ADDRESS                     12700002
*        A PROGRAM CHECK HERE RESULTS IN A 20E ABEND.                   12800002
         SR    R12,R12        RESET ABEND CODE REG                      12900002
SPNPICA  EQU   *              CHECK OUT THE NEW PICA.                   13000002
         SR    R12,R12        RESET THE ABEND CODE REGISTER.            13100002
         ICM   R13,M0010,RBOPSWMK-RBSECT(R5)  GET CALLERS CURRENT MASK  13200002
         LTR   R10,R10        Q. IS THERE AN OLD PICA                   13300002
         BZ    SPNOOLD        A. NO. TH RB MASK WILL GO TO TCBPMASK     13400002
         ICM   R13,M0010,TCBPMASK   TCBPMASK WILL REMAIN THE SAME.      13500002
SPNOOLD  EQU   *              UPDATE THE PIE                            13600002
         L     R12,SP20E      PREPARE FOR BAD PIE.                      13700002
         XC    PIE(PIELEN),PIE   ZERO THE PIE                           13800002
         ST    R9,PIEPICA     NEW PICA ADDRESS TO PIE(MAY BE 0)         13900002
         SR    R12,R12        RESET ABEND REGISTER.                     14000002
         MODESET  EXTKEY=SUPR   SWITCH BACK TO KEY 0.                   14100002
TEST6    EQU   *                                                        14200002
         ST    R8,SCAPIE      CHAIN THE PIE                             14400002
         LA    R1,SPIERMTR    GET ADDRESS OF RMTR              @YM03222 14420002
         LA    R2,SCASRB      GET ADDRESS OF SRB               @YM03222 14440002
         USING SRBSECT,R2     SRB ADDRESSABILITY                        14460002
         ST    R1,SRBRMTR     SET RMTR ADDRESS IN SRB          @YM03222 14480002
         ST    R11,TCBPIE     CHAIN THE SCA TO THE TCB                  14500002
         BAL   R14,PROCRPP       GO PROCESS RPIEPICA           @ZA06785 14550003
         LTR   R13,R13        Q. CODE 17 REQUESTED.                     14600002
         BNM   SPFINISH       A. NO CONTINUE.                           14700002
         OI    TCBFLGS6,TCBPIE17  TELL PROG CHECK FLIH ABOUT 17         14800002
SPFINISH EQU   *              CLEAN UP AND RETURN                       14900002
         N     R13,FF0F0FFF   CLEANSE MASKS IN REG 13                   15000002
         STCM  R13,M0010,TCBPMASK  TCBPMASK=TCBPMASK OR RBOPSWMK OR 0   15100002
         ICM   R1,M0100,RBOPSWMK-RBSECT(R5)  GET THE MASK BYTE          15200002
         N     R1,FFF0FFFF    ZERO THE MASK, SAVE THE REST              15300002
         OR    R1,R13         MERGE REST WITH NEW MASK                  15400002
         STCM  R1,M0100,RBOPSWMK-RBSECT(R5)  UPDATE WITH NEW MASK       15500002
         SETFRR  D,WRKREGS=(R1,R2)  DELETE FRR ENVIRONMENT              15600002
TEST7    EQU   *                                                        15700002
         LR    R1,R10         SETUP REGISTER ONE                        15800002
         L     R14,CVTPTR     GET CVT ADDRESS                           15900002
TEST8    EQU   *                                                        16000002
         L     R14,CVTEXPRO-CVT(R14)  GET EXIT ADDRESS                  16100002
         BR    R14            RETURN                                    16200002
         SPACE 3                                                        16230002
*        ABEND WITH '30E' CODE                                          16260002
SPABEND  EQU   *              DITTO                                     16300002
         MODESET  EXTKEY=SUPR   SWITCH BACK TO KEY 0.          @YM03566 16320002
         SETFRR D,WRKREGS=(R1,R2)  DELETE FRR                  @YM03566 16350002
         L     R1,SP30E       CANNOT USE SPIE OR SPIE W/CODE 17         16400002
         ABEND (1),DUMP,,SYSTEM  ABEND THE CALLER.                      16500002
TEST9    EQU   *                                                        16600002
         EJECT                                                          16630002
*        SPIE FRR                                                       16660002
         SPACE 3                                                        16700002
SPFRR    EQU   *              DITTO                                     16800002
         USING SDWA,R1        R1 INPUT FROM RTM                         16900002
         BALR  R6,ZERO        TEMPORARY BASE                            17000002
         USING *,R6           DITTO                                     17100002
         L     R6,BASE        GET THE BASE FOR THIS MODULE              17200002
         USING IGC0001D,R6    DITTO                                     17300002
         L     R0,SDWAABCC    GET CURRENT ABEND CODE.                   17400002
         TM    SDWAFLGS,SDWAPCHK  WAS IT A PROGRAM CHECK                17500002
         BZ    SPSETRP        NO. CONTINUE WITH TERMINATION             17600002
         LA    R2,SPTABLE-FOUR   SEARCH THROUGH TABLE FOR ABEND CODE.   17700002
         LA    R3,SPSTOP      GET THE STOPPER ADDRESS.                  17800002
SPLOOP   EQU   *              LOOP THRU ABEND CODE LIST.                17900002
         LA    R2,FOUR(R2)    POINT TO CURRENT WORD IN LIST             18000002
         CR    R2,R3          Q. IS THIS THE END.                       18100002
         BE    SPSETRP        A. YES. CONTINUE WITH THE SAME ABEND CODE 18200002
         CLC   SDWAGR12(FOUR),ZERO(R2)  Q. DID MAINLINE PASS A CODE.    18300002
         BNE   SPLOOP         LOOP UNTIL MATCH OR END OF LIST.          18400002
         L     R0,ZERO(R2)    MATCH. ABEND WITH THIS CODE.              18500002
         ST    R0,SDWAABCC    SET CODE                                  18700002
         SETRP RC=0,RECORD=NO                                  @YM03566 18720002
         SR    R15,R15        CLEAR                            @YM03566 18740002
         BR    R14            RETURN                           @YM03566 18760002
SPSETRP  EQU   *              SET CODE AND RETURN TO RTM                18780002
         SETRP  RC=0          RETURN TO CONTINUE W/TERMINATION          18800002
         SR     R15,R15       RETURN CODE OF 0                          18900002
         BR     R14           RETURN                                    19000002
TEST10   EQU    *                                                       19100002
         EJECT                                                          19130002
*                  CHECK IF RB ALREADY HAS RPIEPICA           @ZA06785  19130303
*              IF SO CHECH IF IT IS A SPIE RESTORE            @ZA06785  19130603
*                  IF SO DEQUEUE RPP AND PUT ON FREE QUEUE    @ZA06785  19130903
*                  IF NOT COPY CONTROL BLOCK PTRS AND RETURN  @ZA06785  19131203
*              IF NOT CHECK IF FREE RPIEPICA IS AVAILABLE     @ZA06785  19131503
*                  IF SO DEQUEUE FIRST FREE RPIEPICA, QUEUE   @ZA06785  19131803
*                     TO ACTIVE CHAIN, COPY CONTROL BLOCK     @ZA06785  19132103
*                     POINTERS AND RETURN TO CALLER           @ZA06785  19132403
*              IF NOT GETMAIN NEW RPIEPICA, QUEUE TO ACTIVE   @ZA06785  19132703
*                    QUEUE, COPY CONTROL BLOCK POINTERS AND   @ZA06785  19133003
*                     AND RETURN                              @ZA06785  19133303
*                                                                       19133603
*       INPUT: R5= ISSUING RB ADDRESS                         @ZA06785  19133903
*              R9= PICA ADDRESS OR ZERO IF CANCEL REQUEST     @ZA06785  19134203
*              R11= SCA ADDRESS                               @ZA06785  19134503
*                                                                       19134803
PROCRPP EQU  *                    RECOVERY PIC/PICA PROCESSING @ZA06785 19135103
        USING  RPIEPICA,R3                                   @ZA06785   19135403
        LR    R12,R14             SAVE RETURN ADDRESS         @ZA06785  19135703
        SR    R0,R0               ZERO WORK REGISTER          @ZA06785  19136003
        L    R3,SCARPPTR          GET TOP RPIEPICA ADDRESS    @ZA06785  19136303
        LTR  R3,R3                Q. ANY RPIEPICA             @ZA06785  19136603
        BZ   CHKFREE              A. NO                       @ZA06785  19136903
        L    R8,SCAPIE            GET PIE ADDRESS             @ZA06785  19137203
        L    R2,RPPNPTR           GET ADDRESS OF LAST RPP     @ZA06785  19137503
        C    R5,RPPPRB            Q. ISSUING RB HAVE RPP      @ZA06785  19137803
        BE    RSETSPIE            A. YES                      @ZA06785  19140003
CHKFREE C     R0,SCAFRPPQ         Q.IS A FREE RPP AVAILABLE   @ZA06785  19140403
        BNE   GETFREE             A. YES                      @ZA06785  19140803
        LR    R2,R3             SAVE R3 ACROSS GETMAIN      @ZA06785    19141203
        GETMAIN RU,LV=RPPLEN,SP=253,BRANCH=YES    GET RPP     @ZA06785  19141603
        LA    R15,ZERO(R1)        SAVE NEW RPIEPICA ADDRESS   @ZA06785  19142003
        LR    R3,R2              RESTORE REGISTER 3           @ZA06785  19142403
QUENEW  EQU   *                   CHAIN NEW RPP TO SCA        @ZA06785  19142803
        ST    R3,RPPNPTR-RPIEPICA(R15) UPDATE RPP NEXT FIELD   @ZA06785 19143203
        ST    R15,SCARPPTR        UPDATE RPP PTR IN SCA       @ZA06785  19143603
COPYBLK EQU   *                   COPY SPIE CONTROL BLOCKS    @ZA06785  19144003
        L     R3,SCARPPTR            GET RPIEPICA             @ZA06785  19144403
        ST    R5,RPPPRB              SAVE ISSUING RB ADDRESS   @ZA06785 19144803
        MVC   RPPPIE(L4),SCAPIE      SAVE PIE ADDRESS         @ZA06785  19145203
        MVC   RPPPICA(L4),PIEPICA    SAVE PICA ADDRESS        @ZA06785  19145603
XIT     LR    R14,R12               RESET RETURN REGISTER     @ZA06785  19146003
        BR    R14                    RETURN TO CALLER         @ZA06785  19146403
        SPACE 2                                                         19146803
RSETSPIE EQU   *                   CHECK FOR SPIE RESTORE     @ZA06785  19147203
        CR     R2,R0                PREVIOUS RPP EXIST?       @ZA06785  19147603
        BE     COPYBLK              NO PREVIOUS RPP           @ZA06785  19148003
        LR     R1,R12               SAVE RET ADDR             @ZA20162  19148103
        L      R12,SP10E            GET ABEND CODE FOR FRR    @ZA20162  19148203
        LR     R3,R2                SAVE REG2 ACROSS MODESET  @ZA20162  19148303
        LR     R2,R13               GET USER KEY              @ZA20162  19148403
        MODESET KEYADDR=(2)         SWITCH TO USER KEY        @ZA20162  19148703
        LR     R2,R3                RESTORE REG2              @ZA20162  19148803
* A PROGRAM CHECK WHILE REFERENCING THE PICA WILL RESULT IN   @ZA20162  19148903
* A 10E ABEND ISSUED FROM THE FRR                             @ZA20162  19149003
        L      R3,PIEPICA          GET  CURRENT PICA ADDRESS  @ZA06785  19149403
        L      R3,PICAEXIT-PICA(,R3) GET CURRENT EXIT ADDR    @ZA06785  19149503
        LA     R3,ZERO(,R3)        CLEAR HIGH ORDER BYTE      @ZA06785  19149603
        L      R2,RPPPICA-RPIEPICA(,R2)  GET PREVIOUS PICA    @ZA06785  19149803
        L      R2,PICAEXIT-PICA(,R2) GET PREVIOUS EXIT RTN    @ZA06785  19150303
        LA     R2,ZERO(,R2)         CLEAR HIGH ORDER BYTE     @ZA06785  19150403
        LR     R12,R1              RESTORE RETURN ADDRESS     @ZA20162  19150703
        MODESET EXTKEY=SUPR        RETURN TO SUPERVISOR KEY   @ZA20162  19150803
        CR     R3,R2               Q. PICA EXIT SAME AS LAST  @ZA06785  19150903
        BNE    COPYBLK             A. NO                      @ZA06785  19151203
        L      R3,SCARPPTR         GET RPIEPICA POINTER       @ZA06785  19151403
        MVC    SCARPPTR(L4),RPPNPTR     REMOVE RPP FROM QUE   @ZA06785  19152003
        MVC    RPPNPTR(L4),SCAFRPPQ     CHAIN TO FREE QUEUE   @ZA06785  19152403
        ST     R3,SCAFRPPQ         UPDATE FREE QUEUE HEADER   @ZA06785  19152803
        B      XIT               RETURN TO CALLER             @ZA06785  19153203
        SPACE  2                                                        19153603
GETFREE EQU    *                 GET A FREE RPIEPICA          @ZA06785  19154003
        L      R15,SCAFRPPQ      GET RPP FROM FREE QUEUE      @ZA06785  19154403
        L      R2,RPPNPTR-RPIEPICA(R15)  GET NEXT RPP POINTER @ZA06785  19154803
        ST     R2,SCAFRPPQ           UPDATE FREE QUE PTR      @ZA06785  19154903
        B      QUENEW            QUEUE THIS RPP TO ACTIVE QUE @ZA06785  19155603
       EJECT                                                            19156003
*                                                                       19156403
*        SPIE RESOURCE MANAGER                                          19160002
*                                                                       19166002
*        THE SPIE RESOURCE MANAGER IS ENTERED ON TERMINATION.           19172002
*        IF MEMORY TERMINATION, CONTROL IS RETURNED. IF TASK            19178002
*        TERMINATEION, THE SCA IS FREEMAINED IF THERE IS ONE.           19184002
*                                                                       19190002
         SPACE 3                                                        19200002
IEAVSPIE EQU   *              SPIE RESOURCE MANAGER                     19300002
         STM   R14,R12,TWELVE(R13)  SAVE RTM'S REGISTERS.               19400002
         BALR  R6,R0          TEMPORARY BASE REGISTER                   19500002
         USING *,R6           DITTO                                     19600002
         L     R6,BASE        PERMANENT BASE REG                        19700002
         USING IGC0001D,R6    DITTO                                     19800002
         USING RMPL,R9        PARM LIST REGISTER                        19900002
*        R7                   ASCB REGISTER                             20000002
*        R4                   TCB REGISTER                              20100002
*        R11                  SCA REGISTER                              20200002
*        R0 THRU R3           WORK REGISTERS                            20300002
*        R13                  RTM 72 BYTE SAVE AREA (DO NOT DISTURB)    20400002
*        R5,R8,R10,R12        NOT USED                                  20500002
*        R14                  RETURN REG                                20600002
*        R15                  RETURN CODE REG                           20700002
         L     R9,ZERO(R1)    GET THE USELESS WORD                      20800002
         TM    RMPLFLG1,RMPLTERM  Q. MEMORY TERMINATION                 20900002
         BO    SPRETURN       A. YES. DO NOTHING.                       21000002
         TM    RMPLFLG1,RMPLRBPP     Q. RB TERMINATING        @ZA06785  21020003
         BO    RBTERM      A.YES GO UPDATE SPIE ENVIRONMENT   @ZA06785  21040003
TASKTERM L     R7,RMPLASCB    NEED ASCB FOR FREEMAIN                    21060003
         L     R4,RMPLTCBA    NEED TCB FOR SCA ADDRESS                  21200002
         L     R11,TCBPIE-TCB(R4)  GET THE SCA ADDRESS.                 21300002
         LA    R11,ZERO(R11)  CLEAR HIGH BYTE                           21400002
         LTR   R11,R11        Q. IS THERE AN SCA                        21500002
         BZ    SPRETURN       A. NO. NOTHING TO FREE                    21600002
         NI    TCBFLGS6-TCB(R4),XFF-TCBPIE17  RESET THE SPIE 17 BIT     21700002
*        PURGEDQ DEFAULTS TO CURRENT ADDRESS SPACE,                     21720002
*        CURRENT TCB AND THE RMTR IS SPIE'S                             21740002
         LA    R1,PURGLIST    GET ADDRESS OF PURGE PARAMETERS  @ZA29414 21760003
         PURGEDQ MF=(E,(1))   EXECUTE PURGEDQ SVC              @ZA29414 21770003
         SR    R0,R0          CLEANSE THE TCBPIE FIELD.                 21800002
         ST    R0,TCBPIE-TCB(R4)  DITTO                                 21900002
         FREEMAIN  RU,LV=SCALEN1,A=(R11),SP=245  FREE THE SCA           21950003
TEST11   EQU   *                                                        22100002
SPRETURN EQU   *              RETURN                                    22200002
         LM    R14,R12,TWELVE(R13)  LOAD REGS                           22300002
         SR    R15,R15        RETURN CODE OF 0                          22400002
*        THE FOLLOWING BR 14 IS USED AS THE ADDRESS                     22420002
*        OF THE SPIE SRB RMTR.  NO ACTION IS NECESSARY FOR THE          22440002
*        RMTR TO PERFORM.                                               22460002
SPIERMTR BR    R14            EXIT                                      22500002
        SPACE   3                                                       22505003
RBTERM   EQU   *              PROCESS RPP FOR TERMINATING RB  @ZA06785  22510003
         L     R5,RMPLRBPA    GET TERMINATING RB ADDRESS      @ZA06785  22515003
         L     R4,RMPLTCBA    GET ASSOCIATED TCB ADDRESS      @ZA06785  22520003
         L     R11,TCBPIE-TCB(R4)  GET SCA ADDRESS            @ZA06785  22525003
         LA    R11,ZERO(R11)       CLEAR HIGH BYTE            @ZA06785  22526003
         LTR   R11,R11             Q. SCA EXIST               @ZA06785  22527003
         BZ    SPRETURN            A. NO                      @ZA06785  22528003
         L     R3,SCARPPTR    GET RPIEPICA ADDRESS            @ZA06785  22530003
         C     R5,RPPPRB       Q. IS THERE AN RPP FOR RB      @ZA06785  22535003
         BNE   SPRETURN        A. NO - RETURN TO CALLER       @ZA06785  22540003
         MVC   SCARPPTR(L4),RPPNPTR     REMOVE RPP FROM QUE   @ZA06785  22545003
         MVC   RPPNPTR(L4),SCAFRPPQ     PUT RPP ON FREE QUE   @ZA06785  22550003
         ST    R3,SCAFRPPQ           UPDATE FREE RPP HEADER   @ZA06785  22555003
         L     R3,SCARPPTR           GET NEW TOP RPIEPICA     @ZA06785  22560003
         LTR   R3,R3                 IS NEXT RPIEPICA ZERO    @ZA28693  22565003
         BNZ   CURSPENV              NO PROCESS CURRENT SPIE  @ZA28693  22565603
         L     R1,SCAPIE             GET PIE ADDRESS TO FREE  @ZA28693  22566203
         ST    R3,SCAPIE             ZERO THE PIE ADDRESS     @ZA28693  22566803
         FREEMAIN RU,LV=PIELEN,A=(R1),SP=250 SVC FREEMAIN      @ZA31066 22567403
         B     SPRETURN              PROCESSING COMPLETE      @ZA28693  22568003
CURSPENV MVC   SCAPIE(L4),RPPPIE      GET CURRENT SPIE ENVIRN @ZA28693  22568603
         L     R8,SCAPIE              GET PIE ADDRESS         @ZA06785  22570003
         MODESET  EXTKEY=TCB,WORKREG=2      SET TO USER KEY @ZA12729    22572003
         MVC   PIEPICA(L4),RPPPICA    COPY PICA ADDRESS       @ZA06785  22575003
         MODESET  EXTKEY=SUPR         BACK TO KEY ZERO        @ZA12729  22577003
         B     SPRETURN          RETURN TO CALLER             @ZA06785  22580003
           SPACE 3                                                      22585003
           EJECT                                                        22600003
*        CHECKPOINT/RESTART  SUBROUTINE                                 22630003
*        FOR A CHECKPOINT, THE SCA WILL BE SAVED IN THE SSCR   @ZA12729 22703003
*        (SUBSYSTEM CHECKPOINT RECORD) ALONG WITH THE TCBPMASK @ZA12729 22704003
*        AND TCBPIE17. THE ACTIVE QUEUE OF RPIEPICAS WILL BE   @ZA12729 22705003
*        SAVED IN THE SSCR AFTER DETERMINING ITS ASSOCIATED    @ZA12729 22706003
*        RB'S POSITION ON THE RB QUEUE. THE RELATIVE POSITION  @ZA12729 22707003
*        ON THE RB QUEUE WILL BE SAVED IN THE RPPPRB FIELD OF  @ZA12729 22708003
*        THE RPIEPICA FOR LATER USE BY RESTART. IF A RPIEPICA  @ZA12729 22709003
*        EXISTS WITH NO CORRESPONDING RB ON THE RB QUEUE, THE  @ZA12729 22710003
*        RPIEPICA CHAIN THAT IS IN THE SSCR WILL END WITH THAT @ZA12729 22711003
*        RPIEPICA. THE RPPNPTR AND RPPPRB FIELDS OF THAT       @ZA12729 22712003
*        RPIEPICA WILL BE ZEROED IN THE SSCR SO THAT RESTART   @ZA12729 22713003
*        WILL NOT TRY TO RESTORE RPIEPICAS BEYOND THAT POINT.  @ZA12729 22714003
*        THE TOTAL SSCR AREA USED TO SAVE THE RPIEPICA QUEUE   @ZA12729 22715003
*        WILL BE RECORDED IN THE SSCR (DATARPPL) ALONG WITH    @ZA12729 22716003
*        THE TOTAL AREA USED TO SAVE BOTH SCA & THE RPIEPICA   @ZA12729 22717003
*        QUEUE(SSCRDATL).                                      @ZA12729 22718003
*                                                              @ZA12729 22719003
*        ON A RESTART, A NEW SCA WILL BE GETMAINED AN RE-      @ZA12729 22720003
*        ESTABLISHED USING THE DATA IN THE SSCR. THE SCAFRPPQ  @ZA12729 22721003
*        FIELD WILL BE ZEROED. STORAGE WILL BE GETMAINED TO    @ZA12729 22730003
*        RE-ESTABLISH THE RPIEPICA QUEUE. THE RB POINTERS IN   @ZA12729 22740003
*        THE RPIEPICAS WILL BE SET BASED ON THE INDEX VALUES   @ZA12729 22750003
*        SAVED AT CHECKPOINT.                                  @ZA12729 22760003
*********************************************************************** 22763003
         SPACE 2                                                        22766003
IEAVSPI  EQU   *              SPECIAL ENTRY FORM CHECKPT/RESTART        22770003
         STM   R14,R12,TWELVE(R13)  SAVE REGS                           22800003
         BALR  R6,ZERO        TEMPORARY ADDRESSABILITY                  22830003
         USING *,R6           DITTO                                     22900003
         L     R6,BASE        TRUE BASE                                 22930003
*        R0-R2                ARE WORK REGISTERS                        22960003
         USING TCB,R4         TCB ADDRESSABILITY                        23030003
*        R5                   WORK REG                                  23060003
         USING   IGC0001D,R6  BASE FOR THIS MODULE                      23130003
*        R7                   RB ADDRESSABILITY                         23160003
*        R8                   WORK REG                                  23230003
         USING SSCR,R9        CHECKPT/RESTART 4K TABLE/BUFFER           23300003
         USING DATA,R10       SSCRDATA MAP                              23330003
         USING SCA,R11        SPIE CONTROL AREA ADDRESSABILITY          23400003
         USING RPIEPICA,R3    RECOVERY PIE PICA ADDRESSABILITY @ZA12729 23407003
         USING RBSECT,R7      RB ADDRESSABILITY              @ZA12729   23414003
*        R12                  WORK REG                                  23421003
*        R13                  CHECKPOINT/RESTART 72 BYTE SAVE AREA      23500003
*        R14                  RETURN ADDRESS REG                        23530003
*        R15                  RETURN CODE REGISTER                      23600003
         LR    R9,R1          SAVE THE SSCR ADDRESS                     23630003
         LH    R10,SSCRHDRL   GET OFFSET TO THE DATA AREA               23700003
         ALR   R10,R9         OBTAIN ADDRESS OF THE DATA AREA           23730003
         L     R4,PSATOLD     GET THE CURRENT TCB ADDRESS               23800003
TEST12   EQU   *                                                        23830003
         TM    SSCRFLG1,SSCRCKRS   1=CHECKPT 0=RESTART                  23900003
         BZ    SPRSTRT        GO TO RESTART                             23930003
*                             IT'S A CHECKPOINT                         24000003
         SR    R0,R0          CLEAR FOR STORE                           24030003
         STH   R0,SSCRDATL    SET DATA LENGTH TO ZERO                   24100003
         L     R11,TCBPIE     GET THE SCA POINTER                       24130003
         LA    R11,ZERO(R11)  CLEAR THE TCBPMASK                        24200003
         LTR   R11,R11        Q. IS THERE AN SCA                        24230003
         BZ    SPDONE         A. NO. RETURN                             24300003
         MVC   DATAFLG6(ONE),TCBFLGS6   SAVE THE TCBPIE17 BIT           24330003
         NI    DATAFLG6,TCBPIE17   TURN OFF ALL BUT PIE17 BIT           24400003
         MVC   DATAPMSK(ONE),TCBPMASK  SAVE THE PROG MASK               24430003
         MVC   DATASCA(SCALEN1),SCA  PUT SCA INTO DATA AREA             24500003
         LA    R12,RPPLEN     INITIALIZE LENGTH ACCUM.      @ZA12729    24501003
         LA    R2,ONE         INITIALIZE INDEX VALUE        @ZA12729    24502003
         L     R3,SCARPPTR    GET TOP RPIEPICA              @ZA12729    24503003
         L     R5,RPPPRB      GET RB POINTER FROM RPP       @ZA12729    24504003
         L     R7,TCBRBP      GET TOP RB POINTER            @ZA12729    24505003
LOOPRB   CR    R5,R7          Q. RB POINTERS MATCH          @ZA12729    24506003
         BE    EQUAL          A. YES                        @ZA12729    24507003
         TM    RBSTAB2,RBTCBNXT   Q.RB POINT TO TCB         @ZA12729    24507303
         BO    RBQEND             A. YES                    @ZA12729    24507603
         LA    R2,ONE(,R2)    INCREMENT INDEX VALUE         @ZA12729    24508003
         L     R7,RBLINK-RBSECT(,R7)   GET NEXT RB POINTER  @ZA12729    24509003
         LA    R7,ZERO(,R7)   CLEAR HIGH BYTE               @ZA12729    24509303
         B     LOOPRB         GO CHECK FOR MATCH            @ZA12729    24510003
EQUAL    MVC   DATARPP(RPPLEN),RPIEPICA SAVE RPIEPICA       @ZA12729    24512003
         LA    R8,DATARPP-DATA(,R10)    GET DATARPP ADDRESS   @ZA12729  24512203
         ST    R2,RPPPRB-RPIEPICA(,R8)   SAVE INDEX IN RPPPRB  @ZA12729 24512403
         L     R3,RPPNPTR     GET NEXT RPIEPICA             @ZA12729    24513003
         LTR   R3,R3          Q. ANY MORE RPIEPICAS         @ZA12729    24514003
         BZ    SAVELEN        A. NO                         @ZA12729    24515003
         LA    R12,RPPLEN(,R12) INCREMENT LENGTH            @ZA12729    24516003
         LA    R10,RPPLEN(,R10) INDEX TO NEXT DATARRP       @ZA12729    24517003
         L     R5,RPPPRB      GET RB POINTER FROM RPP       @ZA12729    24518003
         L     R7,RBLINK-RBSECT(,R7)   GET NEXT RB POINTER  @ZA12729    24519003
         LA    R7,ZERO(,R7)   CLEAR HIGH BYTE               @ZA12729    24519303
         LA    R2,ONE(,R2)    INCREMENT INDEX VALUE         @ZA12729    24520003
         B     LOOPRB         GO CHECK FOR A MATCH          @ZA12729    24521003
RBQEND   EQU   *                                           @ZA12729     24521103
         MVC   DATARPP(RPPLEN),RPIEPICA  SAVE RPP IN DATA AREA @ZA12729 24521203
         LA    R8,DATARPP-DATA(,R10)   GET LAST DATA RPP ADDR @ZA12729  24521303
         ST    R0,RPPNPTR-RPIEPICA(,R8)    ZERO CHAIN FIELD   @ZA12729  24521403
         ST    R0,RPPPRB-RPIEPICA(,R8)     ZERO RB POINTER    @ZA12729  24521503
SAVELEN  LA    R0,ONE+ONE+SCALEN1 GET SCA LENGTH USED       @ZA12729    24522003
         AR    R0,R12         GET TOTAL LENGTH SCA + RPP    @ZA12729    24523003
         STH   R0,SSCRDATL        DITTO                                 24600003
         LA    R10,SSCRDATA-SSCR(,R9) DATA AREA ADDRESS     @ZA12729    24605003
         ST    R12,DATARPPL       SAVE LENGTH RPP DATA AREA @ZA12729    24610003
         B     SPDONE         CHECKPT ACCOMPLISHED                      24630003
         EJECT                                                          24640003
*                             IT'S A RESTART                            24700003
SPRSTRT  EQU   *              DITTO                                     24730003
         GETMAIN  RU,LV=SCALEN1,SP=245  GET A NEW SCA                   24760003
TEST13   EQU   *                                                        24830003
         LR    R11,R1         SAVE THE SCA                              24900003
         MVC   SCA(SCALEN1),DATASCA  RESTORE THE OLD SCA                24930003
         STCM  R11,M0111,TCBPIE+ONE  RECHAIN                            25000003
         MVC   TCBPMASK(ONE),DATAPMSK  RESTORE THE PROGRAM MASK         25030003
         NI    DATAFLG6,TCBPIE17  ZERO ALL BUT PIE 17                   25100003
         OC    TCBFLGS6(ONE),DATAFLG6  RESTORE TCBPIE17 BIT             25130003
         SLR   R0,R0                ZERO REG FOR STORE      @ZA12729    25130603
         ST    R0,SCAFRPPQ          CLEAR FREE QUEUE PTR    @ZA12729    25131203
         L     R2,DATARPPL    GET RPP DATA AREA LENGTH      @ZA12729    25132003
GETNEW   GETMAIN RU,LV=(R2),SP=253  GET NEW RPIEPICA       @ZA12729     25134003
         LR    R3,R1          SAVE ADDRESS                 @ZA12729     25136003
         ST    R3,SCARPPTR        SAVE NEW RPIEPICA HEADER  @ZA12729    25138003
         LA    R12,ONE            INITIALIZE INDEX VALUE    @ZA12729    25140003
         L     R7,TCBRBP          GET TOP RB ON QUEUE       @ZA12729    25142003
MOVERPP  MVC   RPIEPICA(RPPLEN),DATARPP RESTORE RPP FROM DATA  @ZA12729 25144003
         L     R5,RPPPRB          GET INDEX VALUE FROM RPP  @ZA12729    25146003
         C     R5,ZEROS           Q. INDEX VALUE ZERO       @ZA12729    25146603
         BE    SPDONE             A. YES                    @ZA12729    25147203
LOOPI    CR    R5,R12             Q. INDEX VALUES MATCH     @ZA12729    25148003
         BE    EQUALI             A. YES                    @ZA12729    25150003
         L     R7,RBLINK-RBSECT(,R7)     GET NEXT RB       @ZA12729     25152003
         LA    R7,ZERO(,R7)       CLEAR HIGH BYTE           @ZA12729    25152603
         LA    R12,ONE(,R12)      INCREMENT INDEX VALUE     @ZA12729    25154003
         B     LOOPI              GO CHECK FOR INDEX MATCH  @ZA12729    25156003
EQUALI   ST    R7,RPPPRB          SAVE NEW RBPTR            @ZA12729    25158003
         L     R2,RPPNPTR         GET NEXT RPP              @ZA12729    25160003
         LTR   R2,R2              Q. ANY MORE RPIEPICAS     @ZA12729    25162003
         BZ    SPDONE             A. NO - FINISHED          @ZA12729    25164003
         LA    R10,RPPLEN(,R10)   GET NEXT DATA AREA RPP    @ZA12729    25166003
         LA    R2,RPPLEN(,R3)     GET LENGTH OF RPIEPICA    @ZA12729    25170003
         ST    R2,RPPNPTR         CHAIN RPIEPICA            @ZA12729    25174003
         LR    R3,R2              GET NEXT NEW AREA RPP ADDR @ZA12729   25176003
         L     R7,RBLINK-RBSECT(,R7) GET NEXT RB ON QUEUE   @ZA12729    25178003
         LA    R7,ZERO(,R7)       CLEAR HIGH BYTE           @ZA12729    25178603
         LA    R12,ONE(,R12)      INCREMENT INDEX VALUE     @ZA12729    25180003
         B     MOVERPP            GO RESTORE RPIEPICA       @ZA12729    25182003
*                             RESTART ACCOMPLISHED                      25200003
SPDONE   EQU   *              RETURN                                    25230003
         LM    R14,R12,TWELVE(R13)  RESTORE REGISTERS.                  25300003
         SR    R15,R15        RETURN CODE OF 0.                         25330003
         BR    R14            RETURN                                    25400003
         TITLE 'IEAVTB00...IGC00040...EXTRACT  PROCESSING'              25430003
*                                                                       25500003
*        EXTRACT SERVICE ROUTINE                                        25530003
*        PROVIDES A MEANS TO GET TO ADDRESSES ETC.                      25600003
*        WITHOUT CHASING VARIOUS SYTEM QUEUES.                          28080002
*                                                                       28090002
IGC00040 DS    0D             SVC ENTRY TO EXTRACT                      28100002
         USING *,R6           TEMPORARY BASE REG                        28200002
         L     R6,BASE        SETUP EXTRACT'S PERMANENT BASE REG        28300002
         USING IGC0001D,R6    OBTAIN ADDRESSABILITY                     28400002
         B     EXSVC          GO TO SVC CODE                            28500002
*        R0 THRU R3           ARE WORK REGISTERS                        28600002
         USING TCB,R4         TCB REGISTER                              28700002
         USING RBSECT,R5      RB REGISTER                               28800002
*        R6                   IS THE BASE REGISTER ADDTESS              28900002
         USING ASCB,R7        ASCB REGISTER                             29000002
         USING ANSLIST,R8     ANSWER LIST REGISTER                      29100002
*        R9                   IS THE EXTRACT LIST'S TCB ADDR            29200002
*        R10                  IS THE EXTRACT LIST'S BIT MAP             29300002
*        R11                  IS NOT USED BY EXTRACT                    29400002
*        R12 CONTAINS INPUT TO THE FRR SHOULD AN ABEND OCCUR5           29500002
*        R13                  CONTAINS THE USER PROTECT KEY             29600002
*        R14                  IS THE RETURN ADDRESS (DON'T CLOBBER)     29700002
*        R15                  IS A WORK REGISTER                        29800002
*                                                                       29850002
         ORG   IGC00040+8     BRANCH E.P. IS SVC E.P. PLUS 8            29900002
*                                                                       29920002
*        BRANCH ENTRY POINT FOR EXTRACT                                 29940002
         SPACE 3                                                        29960002
IEAVEXTR EQU   *              EXTRACT BRANCH E.P.                       30000002
         SPACE 3                                                        30050002
         BALR  R6,R0          TEMPORARY BASE REGISTER                   30100002
         USING *,R6           DITTO                                     30200002
         L     R6,BASE        SETUP EXTRACT'S BASE REGISTER             30300002
         USING IGC0001D,R6    PERMANENT BASE FOR EXTRACT.               30400002
         SR    R13,R13        SET CALLER'S KEY TO KEY 0.                30500002
         B     EXCOMMON       GO TO COMMON CODE FOR BRANCH AND SVC      30600002
         DC    CL8'IGC00040'  EXTRACT'S I.D.                            30700002
EXSVC    EQU   *              SVC ENTRY SETUP                           30800002
         L     R13,RBLINK-RBSECT(R5)  GET CALLER'S RB                   30900002
         IC    R13,RBOPSWKY-RBSECT(R13)  GET CALLER'S KEY               31000002
         N     R13,FFFFFFF0   CLEANSE KEY                               31100002
EXCOMMON EQU   *              COMMON CODE FOR BOTH SVC AND BRANCH ENTRY 31200002
         L     R7,PSAAOLD     SET THE ASCB ADDRESS(BRANCH ENTRY NEEDS)  31300002
TEST14   EQU   *                                                        31400002
         SR    R12,R12        RESET FRR INPUT REGISTER.                 31500002
         LR    R10,R1         SAVE EXTRACT INPUT PARM LIST              31600002
         LA    R15,EXFRR      GET FRR ADDRESS                           31700002
         SETFRR A,FRRAD=(R15),WRKREGS=(R1,R2)  SET UP FRR ENVIRONMENT   31800002
TEST15   EQU   *                                                        31900002
         LR    R2,R13         SETUP USER KEY                            32000002
         MODESET KEYADDR=(2)  SWITCH INTO CALLER KEY                    32100002
TEST16   EQU   *                                                        32200002
         L     R12,EX228      PCK WILL CONVERT TO '228' IN FRR          32300002
         LM    R8,R10,EXTLANSP-EXTL(R10) GET THE CONTENTS OF THE LIST   32400002
         SR    R12,R12        RESET MAINLINE TO FRR COMMUNICATION       32500002
         N     R10,FFF00000   ZERO GARBAGE 'MAP' BITS.                  32600002
         LA    R9,ZERO(R9)    CLEAR THE TCB HIGH BYTE                   32700002
         LTR   R9,R9          Q. IS THERE A TCB                         32800002
         LR    R1,R4          PASS CORRECT TCB AD TO 'EXTCB'            32900002
         BZ    EXTCB          A. NO. USE CURRENT                        33000002
         L     R12,EX228      PCK WILL CONVERT TO '228'ABEND   @YM02740 33020002
         L     R9,ZERO(,R9)   GET ADDRESS OF TCB               @YM02740 33040002
         SR    R12,R12        RESET FRR COMMUNICATION          @YM02740 33060002
         LA    R9,ZERO(,R9)   CLEAR                            @YM02740 33080002
         LR    R1,R4          SET FIRST                        @YM02740 33100002
EXLOOP1  EQU   *              TCB  SEARCH                               33130002
         LR    R3,R1          INIT REG                         @YM02740 33160002
         L     R1,TCBLTC-TCB(,R3)      GET DAUGHTER            @YM02740 33190002
EXSCI1   LTR   R1,R1          IS THER ONE                      @YM02740 33220002
         BZ    EXNEXTQ        NO, FIND NEXT                             33250002
         CLR   R1,R9          Q. MATCH                                  33300002
         BE    EXTCB          A. YES. A.O.K.                   @YM02740 33400002
         B     EXLOOP1        GET NEXT                         @YM02740 33450002
EXNEXTQ  L     R1,TCBNTC-TCB(,R3)   NEXT SISTER                @YM02740 33500002
         CLR   R4,R3          CHECK FOR END                    @YM02740 33550002
         BE    EXABEND        A. YES. INVALID TCB ADDRESS PASSED.       33600002
         L     R3,TCBOTC-TCB(R3) GET MOTHER                    @YM02740 33700002
         B     EXSCI1         LOOP                             @YM02740 33800002
EXTCB    EQU   *              R1 CONTAINS THE PROPER TCB.               33900002
         LR    R9,R1          SAVE THE PROPER TCB.                      34000002
*GRS                                                                    34100002
         LA    R2,TCBGRS-TCB(R9)  GET ADDRESS OF GEN PURPOSE REGS       34200002
         BAL   R3,EXSTORE     STORE IF REQUESTED.                       34300002
*FRS                                                                    34400002
         LA    R2,TCB-TCBFRS  NEGATIVE DISPLACEMENT FOR FRS             34500002
         LNR   R2,R2          MAKE IT NEGATIVE                          34600002
         AR    R2,R9          RESULT IS ADDRESS OF FLOATING PT REGS     34700002
         BAL   R3,EXSTORE     STORE IF REQUESTED                        34800002
*RES                                                                    34900002
         SR    R2,R2          RESULT ALWAYS ZERO(FIELD OBSOLETE)        35000002
         BAL   R3,EXSTORE     STORE IF REQUESTED.                       35100002
*AETX                                                                   35200002
         L     R2,TCBIQE-TCB(R9)  OBTAIN INTERRUPT QUEUE ELEMENT        35300002
         LTR   R2,R2          Q. IS THERE ONE                           35400002
         BZ    EXAETX         A. NO. STORE ZERO , IF REQUESTED.         35500002
         L     R2,IQEIRB-IQESECT(R2)  OBTAIN THE I.R.B.                 35600002
         L     R2,RBEP-RBSECT(R2)  GET THE ASYNC EXIT E.P.              35700002
EXAETX   BAL   R3,EXSTORE     STORE THE RESULT ,IF REQUESTED.           35800002
*PRI                                                                    35900002
         SR    R2,R2          CLEAR FOR INSERT                          36000002
         ICM   R2,M0011,TCBLMP-TCB(R9)  LIMIT AND DISPATCHING PRIORITY  36100002
         BAL   R3,EXSTORE     STORE RESULT, IF REQUESTED                36200002
*CMC                                                                    36300002
         L     R2,TCBCMP-TCB(R9)  OBTAIN THE COMPLETION CODE.           36400002
         BAL   R3,EXSTORE     STORE THE RESULT, IF REQUESTED.           36500002
*TIOT                                                                   36600002
         L     R2,TCBTIO-TCB(R9)  LOAD TIOT ADDRESS                     36700002
         BAL   R3,EXSTORE     STORE IF REQUESTED.                       36800002
*COMM                                                                   36900002
         L     R1,TCBJSCB-TCB(R9) OBTAIN THE JOB STEP TCB ADDR.         37000002
         LTR   R2,R1          Q. IS THERE A JSCB                        37100002
         BZ    EXCOMM         A. NO. STORE ZERO, IF COMM REQUESTED.     37200002
         L     R2,JSCBCSCB-IEZJSCB(R1)  GET THE COMMAND SCHED CNTRL BLK 37300002
         LA    R2,CHECBP-CSCB(R2)   LOAD ECB/CIB PTR LIST ADDRESS       37400002
EXCOMM   BAL   R3,EXSTORE     STORE RESULT, IF REQUESTED.               37500002
*TSO                                                                    37600002
         L     R1,ASCBTSB-ASCB(R7)   GET THE TIME SHARING BLOCK.        37700002
         LA    R2,EXNOTTSO    ADDR OF BYTE IN WHICH THE HIGH BIT IS 0   37800002
         LTR   R1,R1          Q. IS THIS A TIME SHARING ADDR SPACE      37900002
         BZ    EXTSO          A. NO. STORE THE ADDR OF DC X'00'         38000002
         LA    R2,EXISTSO     ADDR OF BYTE IN WHICH THE HIGH BIT IS 1   38100002
EXTSO    BAL   R3,EXSTORE     STORE THE RESULT, IF REQUESTED.           38200002
*PSB                                                                    38300002
         L     R1,TCBJSCB-TCB(R9)   OBTAIN THE JSCB                     38400002
         LTR   R2,R1          Q. IS THERE A JSCB                        38500002
         BZ    EXPSCB         A. NO STORE ZERO IF REQUESTED.            38600002
         L     R2,JSCBPSCB-IEZJSCB(R1)   GET THE PROTECTED STEP C.B.    38700002
EXPSCB   BAL   R3,EXSTORE     STORE RESULT, IF REQUESTED.               38800002
*TJID                                                                   38900002
         L     R1,ASCBTSB-ASCB(R7)  GET THE TIME SHARING BLOCK.         39000002
         LTR   R2,R1          Q. IS THIS A TIME SHARING ADDR SPACE      39100002
         BZ    EXTJID         A. NO STORE ZERO, IF REQUESTED.           39200002
         SR    R2,R2          ZERO FOR INSERT                           39300002
         ICM   R2,M0011,ASCBASID  GET THE ASID.                         39400002
EXTJID   BAL   R3,EXSTORE     STORE THE RESULT, IF REQUESTED.           39500002
*ASID                                                                   39600002
         ICM   R2,M0011,ASCBASID  GET THE ASID AGAIN                    39700002
         BAL   R3,EXSTORE     STORE ASID , IF REQUESTED.                39800002
         MODESET  EXTKEY=SUPR   BACK TO KEY 0.                          39900002
TEST17   EQU   *                                                        40000002
         SETFRR  D,WRKREGS=(R1,R2)  DELETE FRR.                         40100002
TEST18   EQU   *                                                        40200002
         L     R3,CVTPTR      MUST RETURN W/CVT ADDRESS IN R3           40300002
TEST19   EQU   *                                                        40400002
*        R4 MUST REMAIN THE SAME                                        40500002
*        R14 MUST REMAIN THE SAME                                       40600002
         BR    R14            RETURN                                    40700002
EXABEND  MODESET  EXTKEY=SUPR   BACK TO KEY 0.                 @YM03566 40710002
         SETFRR D,WRKREGS=(R1,R2)                              @YM03566 40730002
*                             DELETE FRR PRIOR TO ABEND                 40760002
         L     R1,EX328       ABEND CALLER FOR BAD TCB ADDRESS          40800002
         ABEND (1),DUMP,,SYSTEM  ABEND THE CALLER                       40900002
TEST20   EQU   *                                                        41000002
EXSTORE  EQU   *              STORE THE RESULT, IF MASK BIT SAYS SO.    41100002
         ALR   R10,R10        SHIFT LEFT AND TEST CARRY                 41200002
         BCR   NOCARRY,R3     NOT REQUESTED,RETURN.                     41300002
         L     R12,EX128      ABEND CODE FOR BAD ANS LIST               41400002
         ST    R2,ZERO(R8)    STORE ANS. INTO SLOT IN LIST              41500002
         SR    R12,R12        RESET ABEND CODE                          41600002
         LA    R8,FOUR(R8)    BUMP ANS. LOCATION                        41700002
         BR    R3             RETURN                                    41800002
TEST21   EQU   *                                                        41900002
         EJECT                                                          41930002
*        EXTRACT'S FRR                                                  41960002
EXFRR    EQU   *              EXTRACT'S FRR                             42000002
         USING SDWA,R1        R1 INPUT FROM RTM                         42100002
         BALR  R6,ZERO        TEMPORARY BASE                            42200002
         USING *,R6           DITTO                                     42300002
         L     R6,BASE        GET THE BASE FOR THIS MODULE              42400002
         USING IGC0001D,R6    DITTO                                     42500002
         L     R0,SDWAABCC    GET CURRENT ABEND CODE.                   42600002
         TM    SDWAFLGS,SDWAPCHK  WAS IT A PROGRAM CHECK                42700002
         BZ    EXSETRP        NO. CONTINUE WITH TERMINATION.            42800002
         LA    R2,EXTABLE-FOUR  SEARCH THRU TABLE FOR ABEND CODE        42900002
         LA    R3,EXSTOP      GET THE STOPPER ADDRESS                   43000002
EXLOOP   EQU   *              LOOP THRU ABEND CODE LIST                 43100002
         LA    R2,FOUR(R2)    POINT TO CURRENT WORD IN LIST             43200002
         CR    R2,R3          Q. IS THIS THE END.                       43300002
         BE    EXSETRP        A. YES. CONTINUE WITH THE SAME ABEND CODE 43400002
         CLC   SDWAGR12(FOUR),ZERO(R2)  Q. DID MAINLINE PASS A CODE     43500002
         BNE   EXLOOP         LOOP UNTIL MATCH OR END OF LIST.          43600002
         L     R0,ZERO(R2)    MATCH.  ABEND USING THIS CODE.            43700002
         ST    R0,SDWAABCC    SET CODE                                  43900002
         SETRP RC=0,RECORD=NO      SET RTM PARMS               @YM03566 43920002
         SR    R15,R15             CLEAR                       @YM03566 43940002
         BR    R14                 RETRUN                      @YM03566 43960002
EXSETRP  EQU   *              SET CODE AND RETURN TO RTM.               43980002
         SETRP RC=0           RETURN TO RTM. CONTINUE W/TERMINATION     44000002
         SR    R15,R15        RETURN CODE OF 0                          44100002
         TITLE 'IEAVTB00...CONSTANTS AND EQUS'                          44150002
         BR    R14            RETURN                                    44200002
TEST22   EQU   *                                                        44300002
         EJECT                                                          44330002
*        EQUALS                                                         44360002
R0       EQU   0              REGISTER 0                                44400002
R1       EQU   1              REGISTER 1                                44500002
R2       EQU   2              REGISTER 2                                44600002
R3       EQU   3              REGISTER 3                                44700002
R4       EQU   4              REGISTER 4                                44800002
R5       EQU   5              REGISTER 5                                44900002
R6       EQU   6              REGISTER 6                                45000002
R7       EQU   7              REGISTER 7                                45100002
R8       EQU   8              REGISTER 8                                45200002
R9       EQU   9              REGISTER 9                                45300002
R10      EQU   10             REGISTER 10                               45400002
R11      EQU   11             REGISTER 11                               45500002
R12      EQU   12             REGISTER 12                               45600002
R13      EQU   13             REGISTER 13                               45700002
R14      EQU   14             REGISTER 14                               45800002
R15      EQU   15             REGISTER 15                               45900002
         SPACE 3                                                        46000002
M1000    EQU   B'1000'        MASK FOR ICM - HI BYTE                    46100002
M0100    EQU   B'0100'        MASK FOR ICM - 2ND BYTE                   46200002
M0010    EQU   B'0010'        MASK FOR ICM - 3RD BYTE                   46300002
M0001    EQU   B'0001'        MASK FOR ICM - LO BYTE                    46400002
M0011    EQU   B'0011'        MASK FOR ICM - LO 2 BYTES                 46500002
M0111    EQU   B'0111'        MASK FOR ICM - LO 3 BYTES                 46600002
CARRY    EQU   3              BRANCH CODE                               46700002
NOCARRY  EQU   12             BRANCH CODE                               46800002
         SPACE 3                                                        46900002
ZERO     EQU   0              ZERO                                      47000002
ONE      EQU   1              ONE                                       47100002
TWO      EQU   2              TWO                                       47200002
FOUR     EQU   4              4                                         47300002
L4       EQU   4              LENGTH OF FOUR               @ZA06785     47350003
TWELVE   EQU   12             TWELVE                                    47400002
XFF      EQU   X'FF'          ALL BITS ON MASK                          47460002
         EJECT                                                          47530002
*        CONSTANTS                                                      47560002
ZEROS    DC    F'0'           FULL WORD OF ZEROS               @ZA12729 47580003
PURGLIST PURGEDQ RMTR=SPIERMTR,MF=L     PARAMETERS FOR PURGEDQ @ZA29414 47590003
BASE     DC    A(IGC0001D)    BASE FOR THIS MODULE.                     47600002
EXTABLE  EQU   *              ABEND CODE TABLE FOR FRR SEARCH           47700002
EX128    DC    X'80128000'    ABEND CODE 128                            47800002
EX228    DC    X'80228000'    ABEND CODE 228                            47900002
EXSTOP   EQU   *              TABLE END                                 48000002
EX328    DC    X'00000328'    ABEND CODE 328                            48100002
SPTABLE  EQU   *              ABEND CODE TABLE FOR FRR SEARCH           48200002
SP10E    DC    X'8010E000'    ABEND CODE 10E                            48300002
SP20E    DC    X'8020E000'    ABEND CODE 20E                            48400002
SPSTOP   EQU   *              END OF TABLE ADDRESS                      48500002
SP30E    DC    X'0000030E'    ABEND CODE 30E                            48600002
FF0F0FFF DC    X'FF0F0FFF'    MASK FF0F0FFF                             48690002
FFFFFFF0 DC    X'FFFFFFF0'    MASK FFFFFFF0                             48780002
FFF00000 DC    X'FFF00000'    MASK FFF00000                             48870002
FF0FFFFF DC    X'FF0FFFFF'    MASK FF0FFFFF                             48960002
FFF0FFFF DC    X'FFF0FFFF'    MASK FFF0FFFF                             49050002
FFFFFF0F DC    X'FFFFFF0F'    MASK FFFFFF0F                             49140002
HIGHBIT  DC    X'80000000'    MULTI USE WORD.                           49230002
HZERO    EQU   HIGHBIT+TWO    HALFWORD CONTAINING ZERO                  49320002
EXNOTTSO DC    X'00'          BYTE WITH HI BIT OFF TO SAY NOT TSO       49410002
EXISTSO  DC    X'80'          BYTE WITH HI BIT ON TO SAY TSO            49500002
*                            RECOVERY RPIEPICA DSECT          @ZA06785  49510003
RPIEPICA DSECT                                                @ZA06785  49520003
RPPNPTR  DS   A              ADDRESS OF NEXT RPIEPICA         @ZA06785  49530003
RPPPRB   DS    A             ADDRESS OF ISSUING RB            @ZA06785  49540003
RPPPIE   DS    A             ADDRESS OF ASSOCIATED PIE        @ZA06785  49550003
RPPPICA  DS    A             ADDRESS OF ASSOCIATED PICA       @ZA06785  49560003
RPPLEN   EQU *-RPIEPICA      LENGTH OF RPIEPICA               @ZA06785  49570003
      TITLE  'IEAVTB00...IHASCA - SPIE CONTROL AREA'                    49572003
      IHASCA                                                            49574003
      TITLE 'IEAVTB00...IHASRB - SERVICE REQUEST BLOCK'                 49576003
      IHASRB                                                            49578003
SRBLEN   EQU   *-SRB          LENGTH OF SRB                             49580003
SCALEN1  EQU   SCALEN+SRBLEN  LENGTH OF THE SCA INCLUDING SRB           49582003
*                             CHECK POINT DATA DSECT                    49590002
SSCR     DSECT                                                          49700002
SSCRID   DS    X              CHECKPOINT RECORD ID                      49800002
SSCRSSID DS    X              SPIE I.D.                                 49900002
SSCRHDRL DS    H              OFFSET TO DATA FIELD                      50000002
SSCRFCHN DS    A              CHAIN TO NEXT SSCR                        50100002
SSCRFLG1 DS    X              FLAGS                                     50200002
SSCRCKRS EQU   X'80'          1=CHECKPOINT,0=RESTART                    50300002
         DS    X              RESERVED                                  50400002
SSCRDATL DS    H              DATA LENGTH                               50500002
SSCRDCBA DS    A              ADDRESS OF ASSOCIATED DCB                 50600002
SSCRDATA DS    0C             DATA STARTS HERE                          50700002
DATA     DSECT                                                          50800002
DATAFLG6 DS    X              SAVE AREA FOR TCBFLGS6                    50900002
DATAPMSK DS    X              SAVE AREA FOR TCBPMASK                    51000002
DATASCA  DS    XL(SCALEN1)    SAVE AREA FOR SCA      @ZA12729           51050003
DATARPPL DS    F              LENGTH OF RPP DATA AREA     @ZA12729      51100003
DATARPP  DS    0F             SAVE AREA FOR RPIEPICAS @ZA12729          51130003
EXTL     DSECT                                                          51200002
EXTLANSP DS    A              ADDRESS OF ANSWER LIST                    51300002
EXTLTCBP DS    A              ADDRESS OF WORD WITH TCB ADDRESS          51400002
EXTLMAP  DS    4X             MASK BITS FOR EXTRACT INFORMATION         51500002
ANSLIST  DSECT                                                          51600002
         DS    1F             VARIABLE LENGTH ANS LIST.                 51700002
         TITLE 'IEAVTB00...IHAPIE - PROGRAM ITERRUPT ELEMENT'           52150002
         IHAPIE                                                         52200002
PIELEN   EQU   *-PIE                                                    52300002
         TITLE 'IEAVTB00...IHAIQE - INTER. QUEUE ELEMENT'               52350002
         IHAIQE                                                         52400002
CSCB     DSECT                                                          52500002
         TITLE 'IEAVTB00...IEECHAIN - CON. SCHED. CONTROL BLOCK'        52550002
         IEECHAIN                                                       52600002
         TITLE 'IEAVTB00...IEZJSCB - JOB/STEP CONTROL BLOCK'            52650002
         IEZJSCB                                                        52700002
         TITLE 'IEAVTB00...IHAPICA - PROG. INTER. CONTROL AREA'         52750002
         IHAPICA                                                        52800002
         TITLE 'IEAVTB00...IKJTCB - TASK CONTROL BLOCK'                 52850002
         IKJTCB                                                         52900002
         TITLE 'IEAVTB00...IKJRB - REQUEST BLOCK'                       52950002
         IKJRB                                                          53000002
RBOPSWKY EQU   RBOPSW+1       PSW KEY                                   53100002
AMWP     EQU   1              AMWP OFFSET INTO PSW                      53200002
PBIT     EQU   1              PROBLEM BIT IN AMWP                       53300002
RBOPSWMK EQU   RBOPSW+2       RB SWMK                                   53400002
         TITLE 'IEAVTB00...IHAASCB - ADDR. SPACE CONTROL BLOCK'         53450002
         IHAASCB                                                        53500002
         TITLE 'IEAVTB00...IHAPSA - PREFIXED SAVE AREA'                 53550002
         IHAPSA                                                         53600002
         TITLE 'IEAVTB00...CVT - COMMUNICATIONS VECTOR TABLE'           53650002
         CVT   DSECT=YES                                                53700002
         TITLE 'IEAVTB00...IHASDWA - STAE DIAG. WORK AREA'              53750002
         IHASDWA                                                        53800002
         TITLE 'IEAVTB00...IHAFRRS - FUNC. RECOV. TRN. STACK'           53850002
         IHAFRRS                                                        53900002
         TITLE 'IEAVTB00...IHARMPL - RES. MANAG. PARM LIST'             53950002
         IHARMPL                                                        54000002
         CSECT                                                          54030002
IEAVTBP  DC    XL50'00'                PATCH AREA                       54060002
         END   IGC00040                                                 54100002
