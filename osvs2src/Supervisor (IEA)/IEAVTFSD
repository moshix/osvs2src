TFSD     TITLE 'IEAVTFSD SUMDUMP FORMATTER                             *00001000
                        '                                               00002000
IEAVTFSD CSECT ,                                                   0001 00003000
@MAINENT DS    0H                                                  0001 00004000
         USING *,@15                                               0001 00005000
         B     @PROLOG                                             0001 00006000
         DC    AL1(22)                                             0001 00007000
         DC    C'IEAVTFSD UZ14566 77280'                           0001 00008000
         DROP  @15                                                      00009000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00010000
         BALR  @12,0                                               0001 00011000
@PSTART  DS    0H                                                  0001 00012000
         USING @PSTART,@12                                         0001 00013000
         L     @00,@SIZDATD                                        0001 00014000
         GETMAIN  R,LV=(0)                                              00015000
         LR    @11,@01                                             0001 00016000
         USING @DATD,@11                                           0001 00017000
         ST    @13,@SA00001+4                                      0001 00018000
         LM    @00,@01,20(@13)                                     0001 00019000
         ST    @11,8(,@13)                                         0001 00020000
         LR    @13,@11                                             0001 00021000
         MVC   @PC00001(4),0(@01)                                  0001 00022000
*                                      EACH RECORD BASED ON THE ID 0024 00023000
*                                      FOR THAT RECORD               */ 00024000
*   ABDPLPTR=R1;                    /* SAVE AMDPRDMP PARMLIST BASE   */ 00025000
         LR    ABDPLPTR,R1                                         0025 00026000
*   RFY                                                            0026 00027000
*     R1 UNRSTD;                                                   0026 00028000
*   CONDCODE=GOODCODE;              /* INIT RETURN CODE ASSUMING ALL    00029000
*                                      WILL WORK                     */ 00030000
         SLR   CONDCODE,CONDCODE                                   0027 00031000
*   PARMSAVE=0;                     /* INIT AMDPRDMP PARMLIST EIGHTH    00032000
*                                      SAVE AREA                     */ 00033000
*                                                                  0028 00034000
         SLR   PARMSAVE,PARMSAVE                                   0028 00035000
*   /*****************************************************************/ 00036000
*   /*                                                               */ 00037000
*   /* PRINT OUT THE MAIN SUMMARY DUMP TITLE                         */ 00038000
*   /*                                                               */ 00039000
*   /*****************************************************************/ 00040000
*                                                                  0029 00041000
*   RFY                                                            0029 00042000
*     R1 RSTD;                                                     0029 00043000
*   R1=ADDR(ABDPL);                 /* RESTORE AMDPRDMP PARMLIST PTR */ 00044000
         LR    R1,ABDPLPTR                                         0030 00045000
*   DO I=1 TO 60;                   /* LOOP TO PUT OUT 60 BLANK    0031 00046000
*                                      LINES. THIS WILL INSURE THAT     00047000
*                                      THE SUMDUMP OUTPUT WILL BEGINN   00048000
*                                      AT THE TOP OF THE NEXT NEW  0031 00049000
*                                      PAGE. HOW YOU ASK? AMDPRDMP 0031 00050000
*                                      WILL DISCARD ALL BLANK LINES     00051000
*                                      PASSED TO IT TO BE WRITTEN IF    00052000
*                                      THEY WOULD BE AT THE TOP OF A    00053000
*                                      NEW PAGE BEFORE ANY NONBLANK     00054000
*                                      LINES.                        */ 00055000
         LA    I,1                                                 0031 00056000
@DL00031 DS    0H                                                  0032 00057000
*     CALL LINEPRNT;                /* PRINT OUTPUT BUFFER WHICH   0032 00058000
*                                      AMDPRDMP INITS TO BLANKS      */ 00059000
         L     @15,ADPLPRNT(,ABDPLPTR)                             0032 00060000
         BALR  @14,@15                                             0032 00061000
*   END;                                                           0033 00062000
         AH    I,@CH00053                                          0033 00063000
         CH    I,@CH00167                                          0033 00064000
         BNH   @DL00031                                            0033 00065000
*   TXTPTR=ADDR(MAINTITL);                                         0034 00066000
         L     TXTPTR,@CA00216                                     0034 00067000
*   OUTBUF(1:TXTLEN)=TXT(1:TXTLEN);                                0035 00068000
         L     @10,ADPLBUF(,ABDPLPTR)                              0035 00069000
         SLR   @07,@07                                             0035 00070000
         IC    @07,TXTLEN(,TXTPTR)                                 0035 00071000
         BCTR  @07,0                                               0035 00072000
         EX    @07,@SM00264                                        0035 00073000
*   CALL LINEPRNT;                  /* PRINT THE OUTPUT BUFFER       */ 00074000
         L     @15,ADPLPRNT(,ABDPLPTR)                             0036 00075000
         BALR  @14,@15                                             0036 00076000
*   RFY                                                            0037 00077000
*     R1 UNRSTD;                                                   0037 00078000
*                                                                  0038 00079000
*   /*****************************************************************/ 00080000
*   /*                                                               */ 00081000
*   /* THE REMAINING FUNCTION OF THIS MODULE IS CONTAINED IN THE LOOP*/ 00082000
*   /* WHICH BEGINS HERE. THIS LOOP WILL PROCESS ONE SUMDUMP RECORD  */ 00083000
*   /* PER INTERATION, AND WILL TERMINATE IF ANY ERROR OCCURRS       */ 00084000
*   /*                                                               */ 00085000
*   /*****************************************************************/ 00086000
*                                                                  0038 00087000
*   DO WHILE CONDCODE=GOODCODE;     /* LOOP READING SUM DUMP LOGICAL    00088000
*                                      RECORDS AND CALLING THE     0038 00089000
*                                      SPECIFIC FORMAT RTN FOR EACH     00090000
*                                      RECORD                        */ 00091000
         B     @DE00038                                            0038 00092000
@DL00038 DS    0H                                                  0039 00093000
*     RFY                                                          0039 00094000
*       R1 RSTD;                                                   0039 00095000
*     R1=ADDR(ABDPL);               /* RESTORE AMDPRDMP PARMLIST PTR */ 00096000
         LR    R1,ABDPLPTR                                         0040 00097000
*     DO I=1 TO 5;                  /* LOOP TO PUT OUT 5 BLANK LINES */ 00098000
         LA    I,1                                                 0041 00099000
@DL00041 DS    0H                                                  0042 00100000
*       CALL LINEPRNT;              /* PRINT OUTPUT BUFFER WHICH   0042 00101000
*                                      AMDPRDMP INITS TO BLANKS      */ 00102000
         L     @15,ADPLPRNT(,ABDPLPTR)                             0042 00103000
         BALR  @14,@15                                             0042 00104000
*     END;                                                         0043 00105000
         AH    I,@CH00053                                          0043 00106000
         CH    I,@CH00065                                          0043 00107000
         BNH   @DL00041                                            0043 00108000
*     RFY                                                          0044 00109000
*      (R0,                                                        0044 00110000
*       RETCODE) RSTD;                                             0044 00111000
*GETNEXT:                           /* IF THE RECORD READ IS NOT TO     00112000
*                                      BE FORMATTED IEAVTFSD BRANCHES   00113000
*                                      BACK TO HERE TO READ ANOTHER  */ 00114000
*     R1=ADDR(ABDPL);               /* RESTORE THE AMPRDMP PARMLIST     00115000
*                                      PTR                           */ 00116000
GETNEXT  LR    R1,ABDPLPTR                                         0045 00117000
*     ADPLCOM1=PARMSAVE;            /* RESTORE THE VALUE OF THE    0046 00118000
*                                      EIGHTH WORD OF THE PARM LIST     00119000
*                                      IN CASE IT GOT CHANGED        */ 00120000
         ST    PARMSAVE,ADPLCOM1(,ABDPLPTR)                        0046 00121000
*     CALL IEAVTFRD;                /* READ THE NEXT LOGICAL SD REC  */ 00122000
         L     @15,@CV00205                                        0047 00123000
         BALR  @14,@15                                             0047 00124000
*     PARMSAVE=ADPLCOM1;            /* SAVE THE EIGHTH WORD OF THE 0048 00125000
*                                      PARMLIST IN CASE IT GETS    0048 00126000
*                                      CHANGED BY A SPECIFIC FORMAT     00127000
*                                      SUBROUTINE                    */ 00128000
         L     PARMSAVE,ADPLCOM1(,ABDPLPTR)                        0048 00129000
*     IF RETCODE>DATARET            /* CHECK THE RETURN CODE FOR DATA   00130000
*                                      RETURNED                      */ 00131000
*       THEN                        /* IF NO DATA IS RETURNED        */ 00132000
         CH    RETCODE,@CH00061                                    0049 00133000
         BNH   @RF00049                                            0049 00134000
*       CONDCODE=NODATA;            /* FORWARD THE RETURN CODE       */ 00135000
         LA    CONDCODE,8                                          0050 00136000
*     ELSE                                                         0051 00137000
*       DO;                         /* IF DATA WAS RETURNED          */ 00138000
         B     @RC00049                                            0051 00139000
@RF00049 DS    0H                                                  0052 00140000
*         SMDLRPTR=R0;                                             0052 00141000
         ST    R0,SMDLRPTR                                         0052 00142000
*         RFY                                                      0053 00143000
*          (R0,                                                    0053 00144000
*           R1,                                                    0053 00145000
*           RETCODE) UNRSTD;                                       0053 00146000
*         IF SMDLRID=SMDNULL        /* IS THIS RECORD ONE WITH NO  0054 00147000
*                                      MEANINGFUL DATA IT?           */ 00148000
*           THEN                    /* YES                           */ 00149000
         L     @10,SMDLRPTR                                        0054 00150000
         CLC   SMDLRID(2,@10),@CH00165                             0054 00151000
         BE    @RT00054                                            0054 00152000
*           GO TO GETNEXT;          /* GO BACK AND GET THE NEXT    0055 00153000
*                                      RECORD                        */ 00154000
*         IF 0<SMDLRID&SMDLRID<FTLSTENT/* DOES THIS RECORD ID HAVE AN   00155000
*                                      ENTRY IN THE TABLE    @ZM44938*/ 00156000
*           THEN                    /* YES                           */ 00157000
         SLR   @07,@07                                             0056 00158000
         ICM   @07,3,SMDLRID(@10)                                  0056 00159000
         LTR   @07,@07                                             0056 00160000
         BNP   @RF00056                                            0056 00161000
         L     @10,@CA00230                                        0056 00162000
         C     @07,FTLSTENT-FMTTABLE(,@10)                         0056 00163000
         BNL   @RF00056                                            0056 00164000
*           INDEX=SMDLRID;          /* USE THE RECORD AS THE INDEX 0057 00165000
*                                      INTO THE TABLE                */ 00166000
         L     @10,SMDLRPTR                                        0057 00167000
         SLR   @15,@15                                             0057 00168000
         ICM   @15,3,SMDLRID(@10)                                  0057 00169000
         LR    INDEX,@15                                           0057 00170000
*         ELSE                      /* IF THIS RECORD ID IS NOT IN 0058 00171000
*                                      THE TABLE                     */ 00172000
*           INDEX=FTLSTENT;         /* USE THE LAST ENTRY IN THE   0058 00173000
*                                      TABLE, WHICH IS FOR UNKNOWN 0058 00174000
*                                      RECORD IDS                    */ 00175000
         B     @RC00056                                            0058 00176000
@RF00056 L     @10,@CA00230                                        0058 00177000
         L     INDEX,FTLSTENT-FMTTABLE(,@10)                       0058 00178000
*                                                                  0059 00179000
*         /***********************************************************/ 00180000
*         /*                                                         */ 00181000
*         /* PUT OUT THE RECORD TITLE LINE                           */ 00182000
*         /*                                                         */ 00183000
*         /***********************************************************/ 00184000
*                                                                  0059 00185000
*         IF FTINSERT(INDEX)='                '/* IS THE TITLE INSERT   00186000
*                                      ALL BLANKS?                   */ 00187000
*           THEN                    /* YES                           */ 00188000
@RC00056 LR    @10,INDEX                                           0059 00189000
         MH    @10,@CH00120                                        0059 00190000
         L     @15,@CA00230                                        0059 00191000
         ST    @10,@TF00001                                        0059 00192000
         ALR   @10,@15                                             0059 00193000
         AL    @10,@CF00266                                        0059 00194000
         CLC   FTINSERT-FMTTABLE-24(16,@10),@CC00244               0059 00195000
         BE    @RT00059                                            0059 00196000
*           GO TO SKIPTITL;         /* SO SKIP PRINTING THE TITLE FOR   00197000
*                                      THIS RECORD                   */ 00198000
*         TXTPTR=ADDR(RECTITLE);    /* LINE UP THE BASIC TEXT FOR THE   00199000
*                                      RECORD TITLE                  */ 00200000
         L     TXTPTR,@CA00217                                     0061 00201000
*         OUTBUF(1:TXTLEN)=TXT(1:TXTLEN);/* MOVE IN THE BULK OF THE     00202000
*                                      TEXT                          */ 00203000
         L     @10,ADPLBUF(,ABDPLPTR)                              0062 00204000
         SLR   @08,@08                                             0062 00205000
         IC    @08,TXTLEN(,TXTPTR)                                 0062 00206000
         BCTR  @08,0                                               0062 00207000
         EX    @08,@SM00264                                        0062 00208000
*         ADPLFMT1=ADDR(FTINSERT(INDEX));/* ADD THE PROSE VERSION OF    00209000
*                                      THE ID                        */ 00210000
         L     @10,@TF00001                                        0063 00211000
         AL    @15,@CF00266                                        0063 00212000
         LA    @10,FTINSERT-FMTTABLE-24(@10,@15)                   0063 00213000
         ST    @10,ADPLFMT1(,ABDPLPTR)                             0063 00214000
*         ADPLFMT2=ADDR(SMDLRHDR);  /* POINT TO THE HEADER TO GET  0064 00215000
*                                      AMDPRDMP TO CONVERT IT INTO 0064 00216000
*                                      THE TITLE LINE IN THE OUTPUT     00217000
*                                      BUFFER                        */ 00218000
         MVC   ADPLFMT2(4,ABDPLPTR),SMDLRPTR                       0064 00219000
*         RFY                                                      0065 00220000
*          (R0,                                                    0065 00221000
*           R1,                                                    0065 00222000
*           RETCODE) RSTD;                                         0065 00223000
*         R1=ADDR(ABDPL);                                          0066 00224000
         LR    R1,ABDPLPTR                                         0066 00225000
*         R0=ADDR(RECTITFP);        /* USE THE FORMAT PATTERN IN   0067 00226000
*                                      IEAVTFTM TO FILL IN THE BLANKS   00227000
*                                      IN RECTITLE                   */ 00228000
         L     R0,@CA00218                                         0067 00229000
         LR    @14,R0                                              0067 00230000
         LR    R0,@14                                              0067 00231000
*         CALL FMTSERV;                                            0068 00232000
         L     @15,ADPLFRMT(,ABDPLPTR)                             0068 00233000
         BALR  @14,@15                                             0068 00234000
*         CONDCODE=RETCODE;                                        0069 00235000
         LR    CONDCODE,RETCODE                                    0069 00236000
*         RFY                                                      0070 00237000
*          (R0,                                                    0070 00238000
*           R1,                                                    0070 00239000
*           RETCODE) UNRSTD;                                       0070 00240000
*         IF CONDCODE=GOODCODE THEN                                0071 00241000
         LTR   CONDCODE,CONDCODE                                   0071 00242000
         BNZ   @RF00071                                            0071 00243000
*           DO;                                                    0072 00244000
*             RFY                                                  0073 00245000
*               R1 RSTD;                                           0073 00246000
*             R1=ADDR(ABDPL);       /* RESTORE AMDPRDMP PARMLIST PTR */ 00247000
         LR    R1,ABDPLPTR                                         0074 00248000
*             DO I=1 TO 3;          /* LOOP TO PRINT THE TITLE LINE     00249000
*                                      AND 2 BLANK LINES             */ 00250000
         LA    I,1                                                 0075 00251000
@DL00075 DS    0H                                                  0076 00252000
*               CALL LINEPRNT;      /* PRINT OUTPUT BUFFER WHICH   0076 00253000
*                                      AMDPRDMP INITS TO BLANKS      */ 00254000
         L     @15,ADPLPRNT(,ABDPLPTR)                             0076 00255000
         BALR  @14,@15                                             0076 00256000
*             END;                                                 0077 00257000
         AH    I,@CH00053                                          0077 00258000
         CH    I,@CH00059                                          0077 00259000
         BNH   @DL00075                                            0077 00260000
*             RFY                                                  0078 00261000
*               R1 UNRSTD;                                         0078 00262000
*SKIPTITL:                                                         0079 00263000
*             ;                     /* IF THE TITLE INSERT WAS BLANK    00264000
*                                      PRINTING OF THE TITLE WAS   0079 00265000
*                                      SKIPPED BY BRANCHING HERE     */ 00266000
SKIPTITL DS    0H                                                  0080 00267000
*                                                                  0080 00268000
*             /*******************************************************/ 00269000
*             /*                                                     */ 00270000
*             /* LOAD CALL AND DELETE THE SPECIFIC FORMAT SUBROUTINE.*/ 00271000
*             /* CSECT IEAVTFTM CONTAINS AN EXPLANATION OF HOW TO    */ 00272000
*             /* WRITE AND INSTALL A SPECIFIC FORMAT SUBROUTINE      */ 00273000
*             /*                                                     */ 00274000
*             /*******************************************************/ 00275000
*                                                                  0080 00276000
*             SAVEPL=ABDPL;         /* MAKE A COPY OF THE AMDPRDMP 0080 00277000
*                                      PARM LIST FOR USE BY THE    0080 00278000
*                                      SPECIFIC FMT SUBRTN TO PREVENT   00279000
*                                      ALTERATION OF THE ORIGINAL    */ 00280000
         MVC   SAVEPL(60),ABDPL(ABDPLPTR)                          0080 00281000
*             IF FTRTNAME(INDEX)^=BLNKNAME/* CHECK FOR AN EXTERNAL 0081 00282000
*                                      FORMAT RTN TO BE LOADED       */ 00283000
*               THEN                /* IF THERE IS ONE               */ 00284000
         LR    @10,INDEX                                           0081 00285000
         MH    @10,@CH00120                                        0081 00286000
         L     @15,@CA00230                                        0081 00287000
         ST    @10,@TF00001                                        0081 00288000
         ALR   @10,@15                                             0081 00289000
         AL    @10,@CF00267                                        0081 00290000
         CLC   FTRTNAME-FMTTABLE-12(8,@10),@CC00239                0081 00291000
         BE    @RF00081                                            0081 00292000
*               DO;                                                0082 00293000
*                 RFY                                              0083 00294000
*                  (R0,                                            0083 00295000
*                   R1) RSTD;                                      0083 00296000
*                 DO;               /* LOAD EP(FTRTNAME(INDEX))    0084 00297000
*                                      ERRET(NOLOAD)                 */ 00298000
*                   RESPECIFY                                      0085 00299000
*                    (GPR00P,                                      0085 00300000
*                     GPR01P,                                      0085 00301000
*                     GPR15F) RESTRICTED;                          0085 00302000
*                   GPR00P=ADDR(FTRTNAME(INDEX));/* LOAD ENTRY POINT    00303000
*                                      NAME ADDRESS                  */ 00304000
         L     GPR00P,@CA00230                                     0086 00305000
         LR    @14,GPR00P                                          0086 00306000
         L     @10,@TF00001                                        0086 00307000
         AL    @14,@CF00267                                        0086 00308000
         LA    GPR00P,FTRTNAME-FMTTABLE-12(@10,@14)                0086 00309000
*                   GPR01P=0;       /* JOBLIB OR LINKLIB DCB         */ 00310000
         SLR   GPR01P,GPR01P                                       0087 00311000
*                   GPR01P=GPR01P|'80000000'X;/* ERROR RETURN LABEL     00312000
*                                      SPECIFIED                     */ 00313000
         O     GPR01P,@CF00251                                     0088 00314000
*                   SVC(8);         /* ISSUE LOAD SVC                */ 00315000
         SVC   8                                                   0089 00316000
*                   IF GPR15F^=0 THEN/* LOAD WAS UNSUCCESSFUL        */ 00317000
         LTR   GPR15F,GPR15F                                       0090 00318000
         BNZ   @RT00090                                            0090 00319000
*                     GOTO NOLOAD;  /* BRANCH TO ERROR LOCATION      */ 00320000
*                   RESPECIFY                                      0092 00321000
*                    (GPR00P,                                      0092 00322000
*                     GPR01P,                                      0092 00323000
*                     GPR15F) UNRESTRICTED;                        0092 00324000
*                 END;              /* LOAD EP(FTRTNAME(INDEX))    0093 00325000
*                                      ERRET(NOLOAD) LOADING THE   0093 00326000
*                                      INDICATED EXTERNAL FORMAT RTN */ 00327000
*                 RFY                                              0094 00328000
*                   R1 UNRSTD;                                     0094 00329000
*                 RFY                                              0095 00330000
*                   RETCODE RSTD;                                  0095 00331000
*                 CALL SPECFMT(ADDR(SAVEPL),SMDLRPTR,SMDLRADR);/*  0096 00332000
*                                      CALL TO HAVE THIS RECORD    0096 00333000
*                                      FORMATTED AND PRINTED         */ 00334000
         LA    @14,SAVEPL                                          0096 00335000
         ST    @14,@AFTEMPS                                        0096 00336000
         LA    @14,@AFTEMPS                                        0096 00337000
         ST    @14,@AL00001                                        0096 00338000
         LA    @14,SMDLRPTR                                        0096 00339000
         ST    @14,@AL00001+4                                      0096 00340000
         L     @14,SMDLRPTR                                        0096 00341000
         LA    @14,SMDLRADR(,@14)                                  0096 00342000
         ST    @14,@AL00001+8                                      0096 00343000
         LR    @15,R0                                              0096 00344000
         LA    @01,@AL00001                                        0096 00345000
         BALR  @14,@15                                             0096 00346000
*                 IF RETCODE^=0     /* CHECK THE RETURN CODE         */ 00347000
*                   THEN            /* IF IT IS NOT 0                */ 00348000
         LTR   RETCODE,RETCODE                                     0097 00349000
         BZ    @RF00097                                            0097 00350000
*                   CALL FTDEFRTN(INDEX)->SPECFMT(ADDR(SAVEPL),SMDLRPTR 00351000
*                       ,SMDLRADR); /* USE THE DEFAULT FORMAT RTN TO    00352000
*                                      DO THIS RECORD                */ 00353000
         LA    @14,SAVEPL                                          0098 00354000
         ST    @14,@AFTEMPS                                        0098 00355000
         LA    @14,@AFTEMPS                                        0098 00356000
         ST    @14,@AL00001                                        0098 00357000
         LA    @14,SMDLRPTR                                        0098 00358000
         ST    @14,@AL00001+4                                      0098 00359000
         L     @14,SMDLRPTR                                        0098 00360000
         LA    @14,SMDLRADR(,@14)                                  0098 00361000
         ST    @14,@AL00001+8                                      0098 00362000
         LR    @10,INDEX                                           0098 00363000
         MH    @10,@CH00120                                        0098 00364000
         L     @01,@CA00230                                        0098 00365000
         AL    @01,@CF00268                                        0098 00366000
         L     @15,FTDEFRTN-FMTTABLE-20(@10,@01)                   0098 00367000
         LA    @01,@AL00001                                        0098 00368000
         BALR  @14,@15                                             0098 00369000
*                 RFY                                              0099 00370000
*                  (R0,                                            0099 00371000
*                   RETCODE) UNRSTD;                               0099 00372000
@RF00097 DS    0H                                                  0100 00373000
*                 DO;               /* DELETE EP(FTRTNAME(INDEX))    */ 00374000
*                   RESPECIFY                                      0101 00375000
*                    (GPR00P) RESTRICTED;                          0101 00376000
*                   GPR00P=ADDR(FTRTNAME(INDEX));/* ->ENTRY NAME     */ 00377000
         LR    @10,INDEX                                           0102 00378000
         MH    @10,@CH00120                                        0102 00379000
         L     GPR00P,@CA00230                                     0102 00380000
         LR    @01,GPR00P                                          0102 00381000
         AL    @01,@CF00267                                        0102 00382000
         LA    GPR00P,FTRTNAME-FMTTABLE-12(@10,@01)                0102 00383000
*                   SVC(9);         /* DELETE SVC                    */ 00384000
         SVC   9                                                   0103 00385000
*                   RESPECIFY                                      0104 00386000
*                    (GPR00P) UNRESTRICTED;                        0104 00387000
*                 END;              /* DELETE EP(FTRTNAME(INDEX))    */ 00388000
*               END;                                               0106 00389000
*                                                                  0107 00390000
*             /*******************************************************/ 00391000
*             /*                                                     */ 00392000
*             /* IF THERE WAS NO NAME OF A SPECIFIC FORMAT SUBROUTINE*/ 00393000
*             /* TO BE LOADED OR THE LOAD FAILED THE CODE BRANCHES   */ 00394000
*             /* HERE                                                */ 00395000
*             /*                                                     */ 00396000
*             /*******************************************************/ 00397000
*                                                                  0107 00398000
*             ELSE                  /* IF THERE WAS NO EXTERNAL FMT     00399000
*                                      RTN NAME                      */ 00400000
*               DO;                                                0107 00401000
         B     @RC00081                                            0107 00402000
@RF00081 DS    0H                                                  0108 00403000
*                 GO TO PASTMSG;    /* IF CONTROL CAME HERE BECAUSE     00404000
*                                      WAS NO NAME TO BE LOADED SKIP    00405000
*                                      PAST THE LOAD ERROR MSG       */ 00406000
         B     PASTMSG                                             0108 00407000
*NOLOAD:                            /* IF LOAD FAILS IT BRANCHES HERE*/ 00408000
*                 TXTPTR=ADDR(NLDMSG);/* LOCATE THE PROPER ERROR MSG */ 00409000
NOLOAD   L     TXTPTR,@CA00215                                     0109 00410000
*                 OUTBUF(1:TXTLEN)=TXT(1:TXTLEN);/* MOVE IN THE BULK    00411000
*                                      OF THE MSG                    */ 00412000
         L     @10,ADPLBUF(,ABDPLPTR)                              0110 00413000
         SLR   @03,@03                                             0110 00414000
         IC    @03,TXTLEN(,TXTPTR)                                 0110 00415000
         BCTR  @03,0                                               0110 00416000
         EX    @03,@SM00264                                        0110 00417000
*                 OUTBUF(10:17)=FTRTNAME(INDEX);/* PERSONALIZE THE 0111 00418000
*                                      MSG                           */ 00419000
         LR    @15,INDEX                                           0111 00420000
         MH    @15,@CH00120                                        0111 00421000
         L     @14,@CA00230                                        0111 00422000
         ALR   @14,@15                                             0111 00423000
         AL    @14,@CF00267                                        0111 00424000
         MVC   OUTBUF+9(8,@10),FTRTNAME-FMTTABLE-12(@14)           0111 00425000
*                 RFY                                              0112 00426000
*                   R1 RSTD;                                       0112 00427000
*                 R1=ADDR(ABDPL);   /* RESTORE AMDPRDMP PARMLIST PTR */ 00428000
         LR    R1,ABDPLPTR                                         0113 00429000
*                 DO I=1 TO 2;      /* LOOP TO PRINT THE MSG LINE AND   00430000
*                                      A BLANK LINE                  */ 00431000
         LA    I,1                                                 0114 00432000
@DL00114 DS    0H                                                  0115 00433000
*                   CALL LINEPRNT;  /* PRINT OUTPUT BUFFER WHICH   0115 00434000
*                                      AMDPRDMP INITS TO BLANKS      */ 00435000
         L     @15,ADPLPRNT(,ABDPLPTR)                             0115 00436000
         BALR  @14,@15                                             0115 00437000
*                 END;                                             0116 00438000
         AH    I,@CH00053                                          0116 00439000
         CH    I,@CH00055                                          0116 00440000
         BNH   @DL00114                                            0116 00441000
*                 RFY                                              0117 00442000
*                   R1 UNRSTD;                                     0117 00443000
*PASTMSG:                                                          0118 00444000
*                 ;                 /* NORMAL ENTRY TO THIS DO GROUP    00445000
*                                      DID NOT TRY THE LOAD HENCE  0118 00446000
*                                      DOES NOT NEED THE MSG         */ 00447000
PASTMSG  DS    0H                                                  0119 00448000
*                 RFY                                              0119 00449000
*                  (RETCODE) RSTD;                                 0119 00450000
*                 CALL FTDEFRTN(INDEX)->SPECFMT(ADDR(SAVEPL),SMDLRPTR,  00451000
*                     SMDLRADR);    /* USE THE DEFAULT FORMAT RTN TO    00452000
*                                      DO THIS RECORD                */ 00453000
         LA    @14,SAVEPL                                          0120 00454000
         ST    @14,@AFTEMPS                                        0120 00455000
         LA    @14,@AFTEMPS                                        0120 00456000
         ST    @14,@AL00001                                        0120 00457000
         LA    @14,SMDLRPTR                                        0120 00458000
         ST    @14,@AL00001+4                                      0120 00459000
         L     @14,SMDLRPTR                                        0120 00460000
         LA    @14,SMDLRADR(,@14)                                  0120 00461000
         ST    @14,@AL00001+8                                      0120 00462000
         LR    @10,INDEX                                           0120 00463000
         MH    @10,@CH00120                                        0120 00464000
         L     @14,@CA00230                                        0120 00465000
         AL    @14,@CF00268                                        0120 00466000
         L     @15,FTDEFRTN-FMTTABLE-20(@10,@14)                   0120 00467000
         LA    @01,@AL00001                                        0120 00468000
         BALR  @14,@15                                             0120 00469000
*                 RFY                                              0121 00470000
*                  (RETCODE) UNRSTD;/* RETURN CODES FROM DEFAULT   0121 00471000
*                                      FORMAT SUBRTNS ARE IGNORED    */ 00472000
*               END;                /* OF NO EXT FMT RTN             */ 00473000
*           END;                    /* OF TITLE FORMATTED OK         */ 00474000
@RC00081 DS    0H                                                  0124 00475000
*       END;                                                       0124 00476000
@RF00071 DS    0H                                                  0125 00477000
*   END;                                                           0125 00478000
@RC00049 DS    0H                                                  0125 00479000
@DE00038 LTR   CONDCODE,CONDCODE                                   0125 00480000
         BZ    @DL00038                                            0125 00481000
*   RETURN CODE(0);                 /* ALWAYS GIVE AMDPRDMP A GOOD 0126 00482000
*                                      RETURN CODE                   */ 00483000
         L     @13,4(,@13)                                         0126 00484000
         L     @00,@SIZDATD                                        0126 00485000
         LR    @01,@11                                             0126 00486000
         FREEMAIN R,LV=(0),A=(1)                                        00487000
         SLR   @15,@15                                             0126 00488000
         L     @14,12(,@13)                                        0126 00489000
         LM    @00,@12,20(@13)                                     0126 00490000
         BR    @14                                                 0126 00491000
*   DECLARE                         /* GENERAL PURPOSE REGISTERS     */ 00492000
*     GPR15F FIXED(31) REG(15),                                    0127 00493000
*     GPR00P PTR(31) REG(0),                                       0127 00494000
*     GPR01P PTR(31) REG(1);                                       0127 00495000
*   DECLARE                         /* COMMON VARIABLES              */ 00496000
*     I256C CHAR(256) BASED,                                       0128 00497000
*     I031F FIXED(31) BASED,                                       0128 00498000
*     I031P PTR(31) BASED,                                         0128 00499000
*     I015F FIXED(15) BASED,                                       0128 00500000
*     I015P PTR(15) BASED,                                         0128 00501000
*     I008P PTR(8) BASED,                                          0128 00502000
*     I001C CHAR(1) BASED;                                         0128 00503000
*   END IEAVTFSD                                                   0129 00504000
*                                                                  0129 00505000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00506000
*/*%INCLUDE SYSLIB  (IHASMDLR)                                       */ 00507000
*/*%INCLUDE SYSLIB  (IHAABDPL)                                       */ 00508000
*                                                                  0129 00509000
*       ;                                                          0129 00510000
@DATA    DS    0H                                                       00511000
@CH00053 DC    H'1'                                                     00512000
@CH00055 DC    H'2'                                                     00513000
@CH00059 DC    H'3'                                                     00514000
@CH00061 DC    H'4'                                                     00515000
@CH00065 DC    H'5'                                                     00516000
@CH00120 DC    H'28'                                                    00517000
@CH00165 DC    H'59'                                                    00518000
@CH00167 DC    H'60'                                                    00519000
@SM00264 MVC   OUTBUF(0,@10),TXT(TXTPTR)                                00520000
@DATD    DSECT                                                          00521000
         DS    0F                                                       00522000
@SA00001 DS    18F                                                      00523000
@PC00001 DS    1F                                                       00524000
@AL00001 DS    3A                                                       00525000
@TF00001 DS    F                                                        00526000
@AFTEMPS DS    1F                                                       00527000
IEAVTFSD CSECT                                                          00528000
         DS    0F                                                       00529000
@CF00267 DC    F'-16'                                                   00530000
@CF00268 DC    F'-8'                                                    00531000
@CF00266 DC    F'-4'                                                    00532000
@CF00251 DC    XL4'80000000'                                            00533000
@DATD    DSECT                                                          00534000
         DS    0D                                                       00535000
SMDLRPTR DS    A                                                        00536000
SAVEPL   DS    CL60                                                     00537000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00538000
@ENDDATD EQU   *                                                        00539000
IEAVTFSD CSECT                                                          00540000
         DS    0F                                                       00541000
@SIZDATD DC    AL1(0)                                                   00542000
         DC    AL3(@ENDDATD-@DATD)                                      00543000
@CV00205 DC    V(IEAVTFRD)                                              00544000
@CA00215 DC    A(NLDMSG)                                                00545000
@CA00216 DC    A(MAINTITL)                                              00546000
@CA00217 DC    A(RECTITLE)                                              00547000
@CA00218 DC    A(RECTITFP)                                              00548000
@CA00230 DC    A(FMTTABLE)                                              00549000
         DS    0D                                                       00550000
@CC00244 DC    C'                '                                      00551000
@CC00239 EQU   @CC00244                                                 00552000
PATCHLOC DC    CL256'PATCH AREA FOR IEAVTFSD. LENGTH 256 BYTES'         00553000
SMDWSAG  DC    AL2(6)                                                   00554000
         DC    AL2(7)                                                   00555000
         DC    AL2(8)                                                   00556000
         DC    AL2(9)                                                   00557000
         DC    AL2(10)                                                  00558000
         DC    AL2(11)                                                  00559000
         DC    AL2(12)                                                  00560000
         DC    AL2(13)                                                  00561000
         DC    AL2(14)                                                  00562000
         DC    AL2(15)                                                  00563000
         DC    AL2(16)                                                  00564000
SMDWSAC  DC    AL2(17)                                                  00565000
         DC    AL2(18)                                                  00566000
         DC    AL2(19)                                                  00567000
         DC    AL2(20)                                                  00568000
         DC    AL2(21)                                                  00569000
         DC    AL2(22)                                                  00570000
         DC    AL2(23)                                                  00571000
         DC    AL2(24)                                                  00572000
         DC    AL2(25)                                                  00573000
         DC    AL2(26)                                                  00574000
         DC    AL2(27)                                                  00575000
         DC    AL2(28)                                                  00576000
         DC    AL2(29)                                                  00577000
         DC    AL2(30)                                                  00578000
         DC    AL2(54)                                                  00579000
         DC    AL2(55)                                                  00580000
SMDWSAL  DC    AL2(31)                                                  00581000
         DC    AL2(32)                                                  00582000
         DC    AL2(33)                                                  00583000
         DC    AL2(34)                                                  00584000
         DC    AL2(35)                                                  00585000
         DC    AL2(36)                                                  00586000
         DC    AL2(37)                                                  00587000
         DC    AL2(38)                                                  00588000
         DC    AL2(39)                                                  00589000
         DC    AL2(40)                                                  00590000
         DC    AL2(41)                                                  00591000
         DC    AL2(42)                                                  00592000
         DC    AL2(43)                                                  00593000
         DC    AL2(44)                                                  00594000
         DC    AL2(45)                                                  00595000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00596000
@01      EQU   01                                                       00597000
@02      EQU   02                                                       00598000
@03      EQU   03                                                       00599000
@04      EQU   04                                                       00600000
@05      EQU   05                                                       00601000
@06      EQU   06                                                       00602000
@07      EQU   07                                                       00603000
@08      EQU   08                                                       00604000
@09      EQU   09                                                       00605000
@10      EQU   10                                                       00606000
@11      EQU   11                                                       00607000
@12      EQU   12                                                       00608000
@13      EQU   13                                                       00609000
@14      EQU   14                                                       00610000
@15      EQU   15                                                       00611000
INDEX    EQU   @07                                                      00612000
TXTPTR   EQU   @02                                                      00613000
I        EQU   @02                                                      00614000
CONDCODE EQU   @08                                                      00615000
PARMSAVE EQU   @09                                                      00616000
ABDPLPTR EQU   @06                                                      00617000
R1       EQU   @01                                                      00618000
R0       EQU   @00                                                      00619000
RETCODE  EQU   @15                                                      00620000
GPR00P   EQU   @00                                                      00621000
GPR01P   EQU   @01                                                      00622000
GPR15F   EQU   @15                                                      00623000
         EXTRN NLDMSG                                                   00624000
         EXTRN MAINTITL                                                 00625000
         EXTRN RECTITLE                                                 00626000
         EXTRN RECTITFP                                                 00627000
         EXTRN FMTTABLE                                                 00628000
SMDLR    EQU   0                                                        00629000
SMDLRHDR EQU   SMDLR                                                    00630000
SMDLRID  EQU   SMDLRHDR                                                 00631000
SMDLRADR EQU   SMDLRHDR+8                                               00632000
ABDPL    EQU   0                                                        00633000
ADPLFLAG EQU   ABDPL+7                                                  00634000
ADPLBUF  EQU   ABDPL+8                                                  00635000
ADPLPRNT EQU   ABDPL+12                                                 00636000
ADPLFRMT EQU   ABDPL+24                                                 00637000
ADPLCOM1 EQU   ABDPL+28                                                 00638000
ADPLFMT1 EQU   ABDPL+44                                                 00639000
ADPLFMT2 EQU   ABDPL+48                                                 00640000
OUTBUF   EQU   0                                                        00641000
LINEPRNT EQU   0                                                        00642000
FMTSERV  EQU   0                                                        00643000
MSGTXT   EQU   0                                                        00644000
TXTLEN   EQU   MSGTXT                                                   00645000
TXT      EQU   MSGTXT+1                                                 00646000
SPECFMT  EQU   0                                                        00647000
I001C    EQU   0                                                        00648000
I008P    EQU   0                                                        00649000
I015F    EQU   0                                                        00650000
I015P    EQU   0                                                        00651000
I031F    EQU   0                                                        00652000
I031P    EQU   0                                                        00653000
I256C    EQU   0                                                        00654000
FTLSTENT EQU   FMTTABLE                                                 00655000
FTTABLE  EQU   FMTTABLE+12                                              00656000
FTRTNAME EQU   FTTABLE                                                  00657000
FTDEFRTN EQU   FTTABLE+8                                                00658000
FTINSERT EQU   FTTABLE+12                                               00659000
X        EQU   0                                                        00660000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00661000
FTTBLID  EQU   FMTTABLE+4                                               00662000
ADPLABDA EQU   ABDPL+56                                                 00663000
ADPLEXT  EQU   ABDPL+52                                                 00664000
ADPLCOM4 EQU   ABDPL+40                                                 00665000
ADPLCOM3 EQU   ABDPL+36                                                 00666000
ADPLCOM2 EQU   ABDPL+32                                                 00667000
ADPLMEMA EQU   ABDPL+20                                                 00668000
ADPLCVT  EQU   ABDPL+16                                                 00669000
@NM00003 EQU   ADPLFLAG                                                 00670000
ADPLDMGT EQU   ADPLFLAG                                                 00671000
ADPLSYTM EQU   ADPLFLAG                                                 00672000
ADPLSNPR EQU   ADPLFLAG                                                 00673000
ADPLSBPL EQU   ABDPL+6                                                  00674000
ADPLASID EQU   ABDPL+4                                                  00675000
ADPLTCB  EQU   ABDPL                                                    00676000
SMDLRDAT EQU   SMDLR+20                                                 00677000
@NM00002 EQU   SMDLRHDR+17                                              00678000
SMDLRMSG EQU   SMDLRHDR+16                                              00679000
SMDLRPL  EQU   SMDLRHDR+12                                              00680000
SMDLRLEN EQU   SMDLRHDR+4                                               00681000
@NM00001 EQU   SMDLRHDR+2                                               00682000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00683000
@RT00054 EQU   GETNEXT                                                  00684000
@RT00059 EQU   SKIPTITL                                                 00685000
@RT00090 EQU   NOLOAD                                                   00686000
@ENDDATA EQU   *                                                        00687000
         END   IEAVTFSD,(C'PLS1951',0701,77280)                         00688000
