         TITLE 'HMASMGTA GENERAL TABLE ACCESSOR ROUTINE'                00001000
HMASMGTA CSECT ,                                                   0001 00002000
@MAINENT DS    0H                                                  0001 00003000
         USING *,@15                                               0001 00004000
         B     @PROLOG                                             0001 00005000
         DC    AL1(16)                                             0001 00006000
         DC    C'HMASMGTA  78.334'                                 0001 00007000
         DROP  @15                                                      00008000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00009000
         BALR  @12,0                                               0001 00010000
@PSTART  LA    @10,4095(,@12)                                      0001 00011000
         USING @PSTART,@12                                         0001 00012000
         USING @PSTART+4095,@10                                    0001 00013000
         ST    @13,@SA00001+4                                      0001 00014000
         LA    @14,@SA00001                                        0001 00015000
         ST    @14,8(,@13)                                         0001 00016000
         LR    @13,@14                                             0001 00017000
         MVC   @PC00001(4),0(@01)                                  0001 00018000
*                                      GETP OPERATIONS               */ 00019000
*                                                                  0041 00020000
*   /*****************************************************************/ 00021000
*   /*                                                               */ 00022000
*   /* INITIALIZE RETURN CODE,CHECK PARMS AND CALCULATE MAXIMUM      */ 00023000
*   /* NUMBER OF RECORDS PER PAGE IN FILE                            */ 00024000
*   /*                                                               */ 00025000
*   /*****************************************************************/ 00026000
*                                                                  0041 00027000
*   GTARTNCD=GTPGOOD;               /* INIT RETURN CODE              */ 00028000
         SLR   GTARTNCD,GTARTNCD                                   0041 00029000
*   GTPRCDNF=OFF;                   /* SET FOUND/NOT FOUND BIT       */ 00030000
         L     @09,@PC00001                                        0042 00031000
         NI    GTPRCDNF(@09),B'10111111'                           0042 00032000
*   CALL GTAVER;                    /* CHECK PARM                    */ 00033000
         BAL   @14,GTAVER                                          0043 00034000
*   RFY                                                            0044 00035000
*     RTNCODE RSTD;                 /*                               */ 00036000
*   GTARTNCD=RTNCODE;               /* UPDATE RETURN CODE            */ 00037000
         LR    GTARTNCD,RTNCODE                                    0045 00038000
*   RFY                                                            0046 00039000
*     RTNCODE UNRSTD;               /*                               */ 00040000
*   IF GTARTNCD=GTPGOOD             /* IF PARMS VERIFIED             */ 00041000
*       &GTPRCDLN^=ZERO             /* AND RCD LENGTH SUPPLIED       */ 00042000
*     THEN                          /* THEN CALC                     */ 00043000
         SLR   @09,@09                                             0047 00044000
         CR    GTARTNCD,@09                                        0047 00045000
         BNE   @RF00047                                            0047 00046000
         L     @02,@PC00001                                        0047 00047000
         LH    @02,GTPRCDLN(,@02)                                  0047 00048000
         CR    @02,@09                                             0047 00049000
         BE    @RF00047                                            0047 00050000
*     MAXENTCT=(PAGESIZE-LENGTH(PAGEPFX))/GTPRCDLN;/* MAX RCD PER  0048 00051000
*                                      PAGE IS MAX SPACE/RCD LN    0048 00052000
*                                                            @Z67SP00*/ 00053000
         L     @09,PAGESIZE                                        0048 00054000
         SH    @09,@CH00034                                        0048 00055000
         LR    @00,@09                                             0048 00056000
         SRDA  @00,32                                              0048 00057000
         DR    @00,@02                                             0048 00058000
         STH   @01,MAXENTCT                                        0048 00059000
*                                                                  0049 00060000
*   /*****************************************************************/ 00061000
*   /*                                                               */ 00062000
*   /* IF PREVIOUS PROCESSING OK AND THIS IS FIRST TIME FOR THIS TYPE*/ 00063000
*   /* RCD THEN INITIALIZE POINTERS AND GET FIRST PAGE               */ 00064000
*   /*                                                               */ 00065000
*   /*****************************************************************/ 00066000
*                                                                  0049 00067000
*   IF GTARTNCD=GTPGOOD             /* PREV FUNCTIONS OK             */ 00068000
*       &GTPWKAD=ZERO               /* AND FIRST TIME THRU           */ 00069000
*       &GTPFUNCT=GTPADD            /* AND ADD FUNCTION      @ZA24812*/ 00070000
*     THEN                          /*                               */ 00071000
@RF00047 SLR   @09,@09                                             0049 00072000
         CR    GTARTNCD,@09                                        0049 00073000
         BNE   @RF00049                                            0049 00074000
         L     @02,@PC00001                                        0049 00075000
         C     @09,GTPWKAD(,@02)                                   0049 00076000
         BNE   @RF00049                                            0049 00077000
         CLI   GTPFUNCT(@02),4                                     0049 00078000
         BNE   @RF00049                                            0049 00079000
*     DO;                           /*                               */ 00080000
*       CALL GTAINIT;               /* DO ALL INITIALIZATION         */ 00081000
         BAL   @14,GTAINIT                                         0051 00082000
*       RFY                                                        0052 00083000
*         RTNCODE RSTD;             /*                               */ 00084000
*       GTARTNCD=MAX(GTARTNCD,RTNCODE);/* SAVE RETURN CODE           */ 00085000
         CR    GTARTNCD,RTNCODE                                    0053 00086000
         BNL   *+6                                                      00087000
         LR    GTARTNCD,RTNCODE                                    0053 00088000
*       RFY                                                        0054 00089000
*         RTNCODE UNRSTD;           /*                               */ 00090000
*     END;                          /*                               */ 00091000
*   RENTPTR=GTPWKAD;                /* SET POINTER TO REENTRANT WORK    00092000
*                                      AREA                          */ 00093000
*                                                                  0056 00094000
@RF00049 L     @02,@PC00001                                        0056 00095000
         L     @15,GTPWKAD(,@02)                                   0056 00096000
         LR    RENTPTR,@15                                         0056 00097000
*   /*****************************************************************/ 00098000
*   /*                                                               */ 00099000
*   /* IF ALL PREVIOUS FUNCTIONS WERE OK AND NO FILE EXISTS RETURN   */ 00100000
*   /* WITH APPROPRIATE RETURN CODES                         @ZA24812*/ 00101000
*   /*                                                               */ 00102000
*   /*****************************************************************/ 00103000
*                                                                  0057 00104000
*   IF GTARTNCD=GTPGOOD             /* PREV FUNCTIONS OK     @ZA24812*/ 00105000
*       &GTPWKAD=ZERO               /* BUT FILE IS EMPTY     @ZA24812*/ 00106000
*     THEN                          /*                               */ 00107000
         SLR   @09,@09                                             0057 00108000
         CR    GTARTNCD,@09                                        0057 00109000
         BNE   @RF00057                                            0057 00110000
         CR    @15,@09                                             0057 00111000
         BNE   @RF00057                                            0057 00112000
*     DO;                           /*                               */ 00113000
*       IF GTPFUNCT=GTPLOC          /* IF LOCATE             @ZA24812*/ 00114000
*           |GTPFUNCT=GTPGETN       /* OR GET NEXT           @ZA24812*/ 00115000
*           |GTPFUNCT=GTPGETP       /* OR GET PREVIOUS       @ZA24812*/ 00116000
*         THEN                                                     0059 00117000
         CLI   GTPFUNCT(@02),3                                     0059 00118000
         BE    @RT00059                                            0059 00119000
         CLI   GTPFUNCT(@02),8                                     0059 00120000
         BE    @RT00059                                            0059 00121000
         CLI   GTPFUNCT(@02),9                                     0059 00122000
         BNE   @RF00059                                            0059 00123000
@RT00059 DS    0H                                                  0060 00124000
*         GTARTNCD=GTPEOF;          /* THEN SET EOF RETURN   @ZA24812*/ 00125000
         LA    GTARTNCD,4                                          0060 00126000
*       ELSE                                                       0061 00127000
*         GTARTNCD=GTPGOOD;         /* ELSE SET GOOD RETURN  @ZA24812*/ 00128000
         B     @RC00059                                            0061 00129000
@RF00059 SLR   GTARTNCD,GTARTNCD                                   0061 00130000
*     END;                          /* END OF EMPTY FILE CODE@ZA24812*/ 00131000
@RC00059 DS    0H                                                  0063 00132000
         EJECT                                                          00133000
*                                                                  0063 00134000
*   /*****************************************************************/ 00135000
*   /*                                                               */ 00136000
*   /* IF ALL PREVIOUS FUNCTIONS WERE OK AND THIS IS OPEN/CLOSE      */ 00137000
*   /* REQUEST THEN DO FUNCTION                                      */ 00138000
*   /*                                                               */ 00139000
*   /*****************************************************************/ 00140000
*                                                                  0063 00141000
*   IF GTARTNCD=GTPGOOD             /* PREV FUNCTIONS OK             */ 00142000
*       &GTPWKAD^=ZERO              /* AND NON-EMPTY FILE    @ZA24812*/ 00143000
*       &(GTPFUNCT=GTPOPENN         /* AND OPEN FOR GETN             */ 00144000
*       |GTPFUNCT=GTPOPENP)         /* OR OPEN FOR GETP              */ 00145000
*     THEN                          /*                               */ 00146000
@RF00057 SLR   @09,@09                                             0063 00147000
         CR    GTARTNCD,@09                                        0063 00148000
         BNE   @RF00063                                            0063 00149000
         L     @02,@PC00001                                        0063 00150000
         C     @09,GTPWKAD(,@02)                                   0063 00151000
         BE    @RF00063                                            0063 00152000
         CLI   GTPFUNCT(@02),1                                     0063 00153000
         BE    @RT00063                                            0063 00154000
         CLI   GTPFUNCT(@02),2                                     0063 00155000
         BNE   @RF00063                                            0063 00156000
@RT00063 DS    0H                                                  0064 00157000
*     DO;                           /*                               */ 00158000
*       CALL GTAOPEN;               /* RESET POINTERS TO START       */ 00159000
         BAL   @14,GTAOPEN                                         0065 00160000
*       RFY                                                        0066 00161000
*         RTNCODE RSTD;             /*                               */ 00162000
*       GTARTNCD=MAX(GTARTNCD,RTNCODE);/* SAVE RETURN CODE           */ 00163000
         CR    GTARTNCD,RTNCODE                                    0067 00164000
         BNL   *+6                                                      00165000
         LR    GTARTNCD,RTNCODE                                    0067 00166000
*       RFY                                                        0068 00167000
*         RTNCODE UNRSTD;           /*                               */ 00168000
*     END;                          /*                               */ 00169000
*                                                                  0069 00170000
*   /*****************************************************************/ 00171000
*   /*                                                               */ 00172000
*   /* IF ALL PREVIOUS FUNCTIONS WERE OK AND THIS IS LOCATE/ADD/DEL  */ 00173000
*   /* REQUEST THEN LOCATE RCD NOW                                   */ 00174000
*   /*                                                               */ 00175000
*   /*****************************************************************/ 00176000
*                                                                  0070 00177000
*   IF GTARTNCD=GTPGOOD             /* PREV FUNCTIONS OK             */ 00178000
*       &GTPWKAD^=ZERO              /* AND NON-EMPTY FILE    @ZA24812*/ 00179000
*       &(GTPFUNCT=GTPLOC           /* AND LOCATE                    */ 00180000
*       |GTPFUNCT=GTPADD            /* OR ADD                        */ 00181000
*       |GTPFUNCT=GTPDEL)           /* OR DELETE                     */ 00182000
*     THEN                          /*                               */ 00183000
@RF00063 SLR   @09,@09                                             0070 00184000
         CR    GTARTNCD,@09                                        0070 00185000
         BNE   @RF00070                                            0070 00186000
         L     @02,@PC00001                                        0070 00187000
         C     @09,GTPWKAD(,@02)                                   0070 00188000
         BE    @RF00070                                            0070 00189000
         CLI   GTPFUNCT(@02),3                                     0070 00190000
         BE    @RT00070                                            0070 00191000
         CLI   GTPFUNCT(@02),4                                     0070 00192000
         BE    @RT00070                                            0070 00193000
         CLI   GTPFUNCT(@02),5                                     0070 00194000
         BNE   @RF00070                                            0070 00195000
@RT00070 DS    0H                                                  0071 00196000
*     DO;                           /*                               */ 00197000
*       CALL GTALOC;                /* LOCATE RCD                    */ 00198000
         BAL   @14,GTALOC                                          0072 00199000
*       RFY                                                        0073 00200000
*         RTNCODE RSTD;             /*                               */ 00201000
*       GTARTNCD=MAX(GTARTNCD,RTNCODE);/* SAVE RETURN CODE           */ 00202000
         CR    GTARTNCD,RTNCODE                                    0074 00203000
         BNL   *+6                                                      00204000
         LR    GTARTNCD,RTNCODE                                    0074 00205000
*       IF RTNCODE=GTPNTFND         /* IF ENTRY NOT IN FILE  @Z67SP00*/ 00206000
*         THEN                      /* THEN SET RETURN       @Z67SP00*/ 00207000
         CH    RTNCODE,@CH00071                                    0075 00208000
         BNE   @RF00075                                            0075 00209000
*         GTPRCDNF=ON;              /* INDICATOR             @Z67SP00*/ 00210000
         L     @14,@PC00001                                        0076 00211000
         OI    GTPRCDNF(@14),B'01000000'                           0076 00212000
*       RFY                                                        0077 00213000
*         RTNCODE UNRSTD;           /*                               */ 00214000
@RF00075 DS    0H                                                  0078 00215000
*     END;                          /*                               */ 00216000
         EJECT                                                          00217000
*                                                                  0079 00218000
*   /*****************************************************************/ 00219000
*   /*                                                               */ 00220000
*   /* IF REQUEST FOR LOCATE AND RECORD FOUND MOVE IT TO CALLER AREA */ 00221000
*   /*                                                               */ 00222000
*   /*****************************************************************/ 00223000
*                                                                  0079 00224000
*   IF GTPFUNCT=GTPLOC              /* IF LOCATE                     */ 00225000
*       &GTARTNCD=GTPGOOD           /* AND LOCATE FOUND ENTRY        */ 00226000
*       &GTPWKAD^=ZERO              /* AND NON-EMPTY FILE    @ZA24812*/ 00227000
*     THEN                          /*                               */ 00228000
@RF00070 L     @09,@PC00001                                        0079 00229000
         CLI   GTPFUNCT(@09),3                                     0079 00230000
         BNE   @RF00079                                            0079 00231000
         SLR   @02,@02                                             0079 00232000
         CR    GTARTNCD,@02                                        0079 00233000
         BNE   @RF00079                                            0079 00234000
         C     @02,GTPWKAD(,@09)                                   0079 00235000
         BE    @RF00079                                            0079 00236000
*     DO;                           /*                               */ 00237000
*       USRRCD(1:GTPRCDLN)=RECORD(1:GTPRCDLN);/* MOVE RCD TO CALLER  */ 00238000
         L     @02,GTPBUFAD(,@09)                                  0081 00239000
         LH    @09,GTPRCDLN(,@09)                                  0081 00240000
         BCTR  @09,0                                               0081 00241000
         L     @01,CURRCD                                          0081 00242000
         EX    @09,@SM00296                                        0081 00243000
*     END;                          /* END LOCATE                    */ 00244000
*                                                                  0082 00245000
*   /*****************************************************************/ 00246000
*   /*                                                               */ 00247000
*   /* IF NO SERIOUS PREVIOUS ERRORS AND ADD REQUEST                 */ 00248000
*   /*                                                               */ 00249000
*   /*****************************************************************/ 00250000
*                                                                  0083 00251000
*   IF GTARTNCD<=GTPNTFND           /* NO SEVERE ERR IN LOCATE       */ 00252000
*       &GTPFUNCT=GTPADD            /* AND ADD REQUEST               */ 00253000
*       &GTPWKAD^=ZERO              /* AND NON-EMPTY FILE    @ZA24812*/ 00254000
*     THEN                          /*                               */ 00255000
@RF00079 CH    GTARTNCD,@CH00071                                   0083 00256000
         BH    @RF00083                                            0083 00257000
         L     @09,@PC00001                                        0083 00258000
         CLI   GTPFUNCT(@09),4                                     0083 00259000
         BNE   @RF00083                                            0083 00260000
         ICM   @02,15,GTPWKAD(@09)                                 0083 00261000
         BZ    @RF00083                                            0083 00262000
*     DO;                           /*                               */ 00263000
*       CALL GTAADD;                /* ADD RCD TO FILE               */ 00264000
         BAL   @14,GTAADD                                          0085 00265000
*       RFY                                                        0086 00266000
*         RTNCODE RSTD;             /*                               */ 00267000
*       GTARTNCD=RTNCODE;           /* SAVE RETURN CODE              */ 00268000
         LR    GTARTNCD,RTNCODE                                    0087 00269000
*       RFY                                                        0088 00270000
*         RTNCODE UNRSTD;           /*                               */ 00271000
*     END;                          /* END ADD                       */ 00272000
         EJECT                                                          00273000
*                                                                  0090 00274000
*   /*****************************************************************/ 00275000
*   /*                                                               */ 00276000
*   /* IF NO SERIOUS PREVIOUS ERRORS AND DEL REQUEST                 */ 00277000
*   /*                                                               */ 00278000
*   /*****************************************************************/ 00279000
*                                                                  0090 00280000
*   IF GTARTNCD<=GTPNTFND           /* NO SEVERE ERR IN LOC          */ 00281000
*       &GTPFUNCT=GTPDEL            /* AND DEL REQUEST               */ 00282000
*       &GTPWKAD^=ZERO              /* AND NON-EMPTY FILE    @ZA24812*/ 00283000
*     THEN                          /*                               */ 00284000
@RF00083 CH    GTARTNCD,@CH00071                                   0090 00285000
         BH    @RF00090                                            0090 00286000
         L     @09,@PC00001                                        0090 00287000
         CLI   GTPFUNCT(@09),5                                     0090 00288000
         BNE   @RF00090                                            0090 00289000
         ICM   @02,15,GTPWKAD(@09)                                 0090 00290000
         BZ    @RF00090                                            0090 00291000
*     DO;                           /*                               */ 00292000
*       CALL GTADEL;                /* DEL RCD TO FILE               */ 00293000
         BAL   @14,GTADEL                                          0092 00294000
*       RFY                                                        0093 00295000
*         RTNCODE RSTD;             /*                               */ 00296000
*       GTARTNCD=RTNCODE;           /* SAVE RETURN CODE              */ 00297000
         LR    GTARTNCD,RTNCODE                                    0094 00298000
*       RFY                                                        0095 00299000
*         RTNCODE UNRSTD;           /*                               */ 00300000
*     END;                          /* END DEL                       */ 00301000
*                                                                  0096 00302000
*   /*****************************************************************/ 00303000
*   /*                                                               */ 00304000
*   /* IF NO SERIOUS PREVIOUS ERRORS AND RESTART REQUEST             */ 00305000
*   /*                                                               */ 00306000
*   /*****************************************************************/ 00307000
*                                                                  0097 00308000
*   IF GTARTNCD=GTPGOOD             /* NO PREVIOUS ERR               */ 00309000
*       &GTPWKAD^=ZERO              /* AND NON-EMPTY FILE    @ZA24812*/ 00310000
*       &(GTPFUNCT=GTPSTRTN         /* AND RESTART GETN              */ 00311000
*       |GTPFUNCT=GTPSTRTP)         /* OR RESTART GETP               */ 00312000
*     THEN                          /*                               */ 00313000
@RF00090 SLR   @09,@09                                             0097 00314000
         CR    GTARTNCD,@09                                        0097 00315000
         BNE   @RF00097                                            0097 00316000
         L     @02,@PC00001                                        0097 00317000
         C     @09,GTPWKAD(,@02)                                   0097 00318000
         BE    @RF00097                                            0097 00319000
         CLI   GTPFUNCT(@02),6                                     0097 00320000
         BE    @RT00097                                            0097 00321000
         CLI   GTPFUNCT(@02),7                                     0097 00322000
         BNE   @RF00097                                            0097 00323000
@RT00097 DS    0H                                                  0098 00324000
*     DO;                           /*                               */ 00325000
*       CALL GTASTRT;               /* RESTART GETN OR GETP          */ 00326000
         BAL   @14,GTASTRT                                         0099 00327000
*       RFY                                                        0100 00328000
*         RTNCODE RSTD;             /*                               */ 00329000
*       GTARTNCD=MAX(GTARTNCD,RTNCODE);/* SAVE RETURN CODE           */ 00330000
         CR    GTARTNCD,RTNCODE                                    0101 00331000
         BNL   *+6                                                      00332000
         LR    GTARTNCD,RTNCODE                                    0101 00333000
*       RFY                                                        0102 00334000
*         RTNCODE UNRSTD;           /*                               */ 00335000
*     END;                          /* END RESTART                   */ 00336000
         EJECT                                                          00337000
*                                                                  0104 00338000
*   /*****************************************************************/ 00339000
*   /*                                                               */ 00340000
*   /* IF NO SERIOUS PREVIOUS ERRORS AND GET NEXT REQUEST            */ 00341000
*   /*                                                               */ 00342000
*   /*****************************************************************/ 00343000
*                                                                  0104 00344000
*   IF GTARTNCD=GTPGOOD             /* NO PREVIOUS ERR               */ 00345000
*       &GTPWKAD^=ZERO              /* AND NON-EMPTY FILE    @ZA24812*/ 00346000
*       &GTPFUNCT=GTPGETN           /* AND REQUEST FOR NEXT RCD      */ 00347000
*     THEN                          /*                               */ 00348000
@RF00097 SLR   @09,@09                                             0104 00349000
         CR    GTARTNCD,@09                                        0104 00350000
         BNE   @RF00104                                            0104 00351000
         L     @02,@PC00001                                        0104 00352000
         C     @09,GTPWKAD(,@02)                                   0104 00353000
         BE    @RF00104                                            0104 00354000
         CLI   GTPFUNCT(@02),8                                     0104 00355000
         BNE   @RF00104                                            0104 00356000
*     DO;                           /*                               */ 00357000
*       CALL GTAGETN;               /* GET NEXT RCD IN FILE          */ 00358000
         BAL   @14,GTAGETN                                         0106 00359000
*       RFY                                                        0107 00360000
*         RTNCODE RSTD;             /*                               */ 00361000
*       GTARTNCD=MAX(GTARTNCD,RTNCODE);/* SAVE RETURN CODE           */ 00362000
         CR    GTARTNCD,RTNCODE                                    0108 00363000
         BNL   *+6                                                      00364000
         LR    GTARTNCD,RTNCODE                                    0108 00365000
*       RFY                                                        0109 00366000
*         RTNCODE UNRSTD;           /*                               */ 00367000
*     END;                          /* END GET NEXT                  */ 00368000
*                                                                  0110 00369000
*   /*****************************************************************/ 00370000
*   /*                                                               */ 00371000
*   /* IF NO SERIOUS PREVIOUS ERRORS AND GET PREVIOUS REQUEST        */ 00372000
*   /*                                                               */ 00373000
*   /*****************************************************************/ 00374000
*                                                                  0111 00375000
*   IF GTARTNCD=GTPGOOD             /* NO PREVIOUS ERR               */ 00376000
*       &GTPWKAD^=ZERO              /* AND NON-EMPTY FILE    @ZA24812*/ 00377000
*       &GTPFUNCT=GTPGETP           /* AND REQUEST FOR PREVIOUS RCD  */ 00378000
*     THEN                          /*                               */ 00379000
@RF00104 SLR   @09,@09                                             0111 00380000
         CR    GTARTNCD,@09                                        0111 00381000
         BNE   @RF00111                                            0111 00382000
         L     @02,@PC00001                                        0111 00383000
         C     @09,GTPWKAD(,@02)                                   0111 00384000
         BE    @RF00111                                            0111 00385000
         CLI   GTPFUNCT(@02),9                                     0111 00386000
         BNE   @RF00111                                            0111 00387000
*     DO;                           /*                               */ 00388000
*       CALL GTAGETP;               /* GET PREVIOUS RCD IN FILE      */ 00389000
         BAL   @14,GTAGETP                                         0113 00390000
*       RFY                                                        0114 00391000
*         RTNCODE RSTD;             /*                               */ 00392000
*       GTARTNCD=MAX(GTARTNCD,RTNCODE);/* SAVE RETURN CODE           */ 00393000
         CR    GTARTNCD,RTNCODE                                    0115 00394000
         BNL   *+6                                                      00395000
         LR    GTARTNCD,RTNCODE                                    0115 00396000
*       RFY                                                        0116 00397000
*         RTNCODE UNRSTD;           /*                               */ 00398000
*     END;                          /* END GET PREVIOUS              */ 00399000
         EJECT                                                          00400000
*                                                                  0118 00401000
*   /*****************************************************************/ 00402000
*   /*                                                               */ 00403000
*   /* IF NO SERIOUS PREVIOUS ERRORS AND FREE FILE REQUEST           */ 00404000
*   /*                                                               */ 00405000
*   /*****************************************************************/ 00406000
*                                                                  0118 00407000
*   IF GTARTNCD=GTPGOOD             /* NO PREVIOUS ERR               */ 00408000
*       &GTPFUNCT=GTPFREE           /* AND FREE FILE REQUEST         */ 00409000
*     THEN                          /*                               */ 00410000
@RF00111 CH    GTARTNCD,@CH00083                                   0118 00411000
         BNE   @RF00118                                            0118 00412000
         L     @09,@PC00001                                        0118 00413000
         CLI   GTPFUNCT(@09),10                                    0118 00414000
         BNE   @RF00118                                            0118 00415000
*     DO;                           /*                               */ 00416000
*       CALL GTAFREE;               /* FREE FILE                     */ 00417000
         BAL   @14,GTAFREE                                         0120 00418000
*       RFY                                                        0121 00419000
*         RTNCODE RSTD;             /*                               */ 00420000
*       GTARTNCD=MAX(GTARTNCD,RTNCODE);/* SAVE RETURN CODE           */ 00421000
         CR    GTARTNCD,RTNCODE                                    0122 00422000
         BNL   *+6                                                      00423000
         LR    GTARTNCD,RTNCODE                                    0122 00424000
*       RFY                                                        0123 00425000
*         RTNCODE UNRSTD;           /*                               */ 00426000
*     END;                          /* END FREE FILE                 */ 00427000
*                                                                  0124 00428000
*   /*****************************************************************/ 00429000
*   /*                                                               */ 00430000
*   /* RETURN TO CALLER                                              */ 00431000
*   /*                                                               */ 00432000
*   /*****************************************************************/ 00433000
*                                                                  0125 00434000
*   GTPRETRN=GTARTNCD;              /* RTNCODE IN PARM               */ 00435000
@RF00118 L     @09,@PC00001                                        0125 00436000
         STC   GTARTNCD,GTPRETRN(,@09)                             0125 00437000
*   RETURN CODE(GTARTNCD);          /* RTNCODE IN REG 15             */ 00438000
         LR    @15,GTARTNCD                                        0126 00439000
         L     @13,4(,@13)                                         0126 00440000
         L     @14,12(,@13)                                        0126 00441000
         LM    @00,@12,20(@13)                                     0126 00442000
         BR    @14                                                 0126 00443000
         EJECT                                                          00444000
*                                                                  0127 00445000
*   /*****************************************************************/ 00446000
*   /*                                                               */ 00447000
*   /* PROCEDURE CALLED TO VERIFY PARAMETER PASSED                   */ 00448000
*   /*                                                               */ 00449000
*   /*****************************************************************/ 00450000
*                                                                  0127 00451000
*GTAVER:                            /*                               */ 00452000
*   PROCEDURE;                      /*                               */ 00453000
GTAVER   STM   @14,@12,12(@13)                                     0127 00454000
*   DECLARE                         /*                               */ 00455000
*     VERRTNCD FIXED(8);            /*                               */ 00456000
*   VERRTNCD=GTPGOOD;               /* INIT RETURN CODE              */ 00457000
         SLR   VERRTNCD,VERRTNCD                                   0129 00458000
*   IF GTPFUNCT^=GTPOPENN           /* CHECK FOR VALID FUNCTIONS     */ 00459000
*       &GTPFUNCT^=GTPOPENP         /*                               */ 00460000
*       &GTPFUNCT^=GTPLOC           /*                               */ 00461000
*       &GTPFUNCT^=GTPADD           /*                               */ 00462000
*       &GTPFUNCT^=GTPDEL           /*                               */ 00463000
*       &GTPFUNCT^=GTPSTRTN         /*                               */ 00464000
*       &GTPFUNCT^=GTPSTRTP         /*                               */ 00465000
*       &GTPFUNCT^=GTPGETN          /*                               */ 00466000
*       &GTPFUNCT^=GTPGETP          /*                               */ 00467000
*       &GTPFUNCT^=GTPFREE          /*                               */ 00468000
*     THEN                          /*                               */ 00469000
         L     @09,@PC00001                                        0130 00470000
         CLI   GTPFUNCT(@09),1                                     0130 00471000
         BE    @RF00130                                            0130 00472000
         CLI   GTPFUNCT(@09),2                                     0130 00473000
         BE    @RF00130                                            0130 00474000
         CLI   GTPFUNCT(@09),3                                     0130 00475000
         BE    @RF00130                                            0130 00476000
         CLI   GTPFUNCT(@09),4                                     0130 00477000
         BE    @RF00130                                            0130 00478000
         CLI   GTPFUNCT(@09),5                                     0130 00479000
         BE    @RF00130                                            0130 00480000
         CLI   GTPFUNCT(@09),6                                     0130 00481000
         BE    @RF00130                                            0130 00482000
         CLI   GTPFUNCT(@09),7                                     0130 00483000
         BE    @RF00130                                            0130 00484000
         CLI   GTPFUNCT(@09),8                                     0130 00485000
         BE    @RF00130                                            0130 00486000
         CLI   GTPFUNCT(@09),9                                     0130 00487000
         BE    @RF00130                                            0130 00488000
         CLI   GTPFUNCT(@09),10                                    0130 00489000
         BE    @RF00130                                            0130 00490000
*     VERRTNCD=GTPIOERR;            /* SET BAD RTN CODE              */ 00491000
         LA    VERRTNCD,16                                         0131 00492000
*   IF(GTPFUNCT=GTPLOC              /* IF LOCATE                     */ 00493000
*       |GTPFUNCT=GTPADD            /* OR ADD                        */ 00494000
*       |GTPFUNCT=GTPDEL)           /* OR DELETE                     */ 00495000
*       &GTPKEYLN=ZERO              /* AND NO KEYLEN                 */ 00496000
*     THEN                          /* THEN                          */ 00497000
@RF00130 L     @09,@PC00001                                        0132 00498000
         CLI   GTPFUNCT(@09),3                                     0132 00499000
         BE    @GL00037                                            0132 00500000
         CLI   GTPFUNCT(@09),4                                     0132 00501000
         BE    @GL00037                                            0132 00502000
         CLI   GTPFUNCT(@09),5                                     0132 00503000
         BNE   @RF00132                                            0132 00504000
@GL00037 L     @09,@PC00001                                        0132 00505000
         ICM   @02,3,GTPKEYLN(@09)                                 0132 00506000
         BNZ   @RF00132                                            0132 00507000
*     VERRTNCD=GTPIOERR;            /* SET BAD RTN CODE              */ 00508000
         LA    VERRTNCD,16                                         0133 00509000
*   IF(GTPFUNCT^=GTPFREE            /* RECORD LENGTH REQUIRED UNLESS */ 00510000
*       &GTPRCDLN=ZERO)             /* FUNCTION IS GTPFREE           */ 00511000
*     THEN                          /* THEN                          */ 00512000
@RF00132 L     @09,@PC00001                                        0134 00513000
         CLI   GTPFUNCT(@09),10                                    0134 00514000
         BE    @RF00134                                            0134 00515000
         ICM   @02,3,GTPRCDLN(@09)                                 0134 00516000
         BNZ   @RF00134                                            0134 00517000
*     VERRTNCD=GTPIOERR;            /* SET BAD RTN CODE              */ 00518000
         LA    VERRTNCD,16                                         0135 00519000
*   IF(GTPFUNCT=GTPLOC              /* IF LOCATE                     */ 00520000
*       |GTPFUNCT=GTPADD            /* OR ADD                        */ 00521000
*       |GTPFUNCT=GTPDEL            /* OR DELETE                     */ 00522000
*       |GTPFUNCT=GTPGETN           /* OR GET                        */ 00523000
*       |GTPFUNCT=GTPGETP)          /*                               */ 00524000
*       &GTPBUFAD=ZERO              /* AND NO BUFFER ADDRESS         */ 00525000
*     THEN                          /* THEN                          */ 00526000
@RF00134 L     @09,@PC00001                                        0136 00527000
         CLI   GTPFUNCT(@09),3                                     0136 00528000
         BE    @GL00041                                            0136 00529000
         CLI   GTPFUNCT(@09),4                                     0136 00530000
         BE    @GL00041                                            0136 00531000
         CLI   GTPFUNCT(@09),5                                     0136 00532000
         BE    @GL00041                                            0136 00533000
         CLI   GTPFUNCT(@09),8                                     0136 00534000
         BE    @GL00041                                            0136 00535000
         CLI   GTPFUNCT(@09),9                                     0136 00536000
         BNE   @RF00136                                            0136 00537000
@GL00041 L     @09,@PC00001                                        0136 00538000
         ICM   @02,15,GTPBUFAD(@09)                                0136 00539000
         BNZ   @RF00136                                            0136 00540000
*     VERRTNCD=GTPIOERR;            /* SET BAD RTN CODE              */ 00541000
         LA    VERRTNCD,16                                         0137 00542000
*   IF VERRTNCD=ZERO                /* IF PARM OK            @Z67SP00*/ 00543000
*     THEN                          /*                       @Z67SP00*/ 00544000
@RF00136 CH    VERRTNCD,@CH00083                                   0138 00545000
         BNE   @RF00138                                            0138 00546000
*     DO;                           /*                       @Z67SP00*/ 00547000
*       IF GTPPSIZE=GTP4K           /* SET PAGE SIZE         @Z67SP00*/ 00548000
*         THEN                      /*                       @Z67SP00*/ 00549000
         L     @09,@PC00001                                        0140 00550000
         TM    GTPPSIZE(@09),B'00000111'                           0140 00551000
         BNZ   @RF00140                                            0140 00552000
*         PAGESIZE=P4K;             /*                       @Z67SP00*/ 00553000
         MVC   PAGESIZE(4),@CF00150                                0141 00554000
*       ELSE                        /*                       @Z67SP00*/ 00555000
*         IF GTPPSIZE=GTP2K         /*                       @Z67SP00*/ 00556000
*           THEN                    /*                       @Z67SP00*/ 00557000
         B     @RC00140                                            0142 00558000
@RF00140 L     @09,@PC00001                                        0142 00559000
         TM    GTPPSIZE(@09),B'00000011'                           0142 00560000
         BNO   @RF00142                                            0142 00561000
         TM    GTPPSIZE(@09),B'00000100'                           0142 00562000
         BNZ   @RF00142                                            0142 00563000
*           PAGESIZE=P2K;           /*                       @Z67SP00*/ 00564000
         MVC   PAGESIZE(4),@CF00152                                0143 00565000
*         ELSE                      /*                       @Z67SP00*/ 00566000
*           IF GTPPSIZE=GTP1K       /*                       @Z67SP00*/ 00567000
*             THEN                  /*                       @Z67SP00*/ 00568000
         B     @RC00142                                            0144 00569000
@RF00142 L     @09,@PC00001                                        0144 00570000
         TM    GTPPSIZE(@09),B'00000010'                           0144 00571000
         BNO   @RF00144                                            0144 00572000
         TM    GTPPSIZE(@09),B'00000101'                           0144 00573000
         BNZ   @RF00144                                            0144 00574000
*             PAGESIZE=P1K;         /*                       @Z67SP00*/ 00575000
         MVC   PAGESIZE(4),@CF00154                                0145 00576000
*           ELSE                    /*                       @Z67SP00*/ 00577000
*             IF GTPPSIZE=GTP512B   /*                       @Z67SP00*/ 00578000
*               THEN                /*                       @Z67SP00*/ 00579000
         B     @RC00144                                            0146 00580000
@RF00144 L     @09,@PC00001                                        0146 00581000
         TM    GTPPSIZE(@09),B'00000001'                           0146 00582000
         BNO   @RF00146                                            0146 00583000
         TM    GTPPSIZE(@09),B'00000110'                           0146 00584000
         BNZ   @RF00146                                            0146 00585000
*               PAGESIZE=P512B;     /*                       @Z67SP00*/ 00586000
         MVC   PAGESIZE(4),@CF00156                                0147 00587000
*             ELSE                  /*                       @Z67SP00*/ 00588000
*               VERRTNCD=GTPIOERR;  /*                       @Z67SP00*/ 00589000
         B     @RC00146                                            0148 00590000
@RF00146 LA    VERRTNCD,16                                         0148 00591000
*       IF GTPRCDLN>PAGESIZE-LENGTH(PAGEPFX)/*               @Z67SP00*/ 00592000
*         THEN                      /*                       @Z67SP00*/ 00593000
@RC00146 DS    0H                                                  0149 00594000
@RC00144 DS    0H                                                  0149 00595000
@RC00142 DS    0H                                                  0149 00596000
@RC00140 L     @09,@PC00001                                        0149 00597000
         L     @02,PAGESIZE                                        0149 00598000
         SH    @02,@CH00034                                        0149 00599000
         CH    @02,GTPRCDLN(,@09)                                  0149 00600000
         BNL   @RF00149                                            0149 00601000
*         VERRTNCD=GTPIOERR;        /*                       @Z67SP00*/ 00602000
         LA    VERRTNCD,16                                         0150 00603000
*     END;                          /*                       @Z67SP00*/ 00604000
@RF00149 DS    0H                                                  0152 00605000
*   RETURN CODE(VERRTNCD);          /*                               */ 00606000
@RF00138 LR    @15,VERRTNCD                                        0152 00607000
         L     @14,12(,@13)                                        0152 00608000
         LM    @00,@12,20(@13)                                     0152 00609000
         BR    @14                                                 0152 00610000
*   END GTAVER;                     /*                               */ 00611000
         EJECT                                                          00612000
*                                                                  0154 00613000
*   /*****************************************************************/ 00614000
*   /*                                                               */ 00615000
*   /* PROCEDURE CALLED TO OBTAIN REENTRANT WORK AREA AND GET FIRST  */ 00616000
*   /* PAGE FOR FILE                                                 */ 00617000
*   /*                                                               */ 00618000
*   /*****************************************************************/ 00619000
*                                                                  0154 00620000
*GTAINIT:                           /*                               */ 00621000
*   PROCEDURE;                      /*                               */ 00622000
GTAINIT  STM   @14,@12,@SA00003                                    0154 00623000
*   DECLARE                         /*                               */ 00624000
*     INITRC FIXED(31);             /* SUBROUTINE RETURN CODE        */ 00625000
*   RFY                                                            0156 00626000
*     ONEPAGE BASED(RNTFIRST);                                     0156 00627000
*   INITRC=GTPGOOD;                 /* INIT TO GOOD RETURN CODE      */ 00628000
         SLR   INITRC,INITRC                                       0157 00629000
*   RFY                                                            0158 00630000
*     R2 RSTD;                      /* REG 2 WILL CONTAIN SIZE OF  0158 00631000
*                                      REENTRANT WORK AREA           */ 00632000
*   R2=LENGTH(RENTAREA);            /* SET REQUIRED LENGTH           */ 00633000
         LA    R2,42                                               0159 00634000
*   RENTPTR=ADDR(GTPWKAD);          /* PTR FOR RETURN ADDRESS        */ 00635000
         L     RENTPTR,@PC00001                                    0160 00636000
         LA    RENTPTR,GTPWKAD(,RENTPTR)                           0160 00637000
*   GEN(GETMAIN EC,LV=(R2),A=(RENTPTR))                            0161 00638000
*   REFS(R2,RENTPTR);               /* GETMAIN REENTRANT WORK AREA   */ 00639000
         GETMAIN EC,LV=(R2),A=(RENTPTR)                                 00640000
*   RFY                                                            0162 00641000
*     R2 UNRSTD;                    /* FREE REG 2                    */ 00642000
*   RFY                                                            0163 00643000
*     RTNCODE RSTD;                 /*                               */ 00644000
*   IF RTNCODE^=GTPGOOD             /* IF GETMAIN NOT SUCCESSFULL    */ 00645000
*     THEN                          /* THEN SIGNAL UNABLE TO GET   0164 00646000
*                                      SPACE CONDITION               */ 00647000
         LTR   RTNCODE,RTNCODE                                     0164 00648000
         BZ    @RF00164                                            0164 00649000
*     DO;                           /*                       @Z67SP00*/ 00650000
*       INITRC=GTPSPACE;            /* SET RC                @Z67SP00*/ 00651000
         LA    INITRC,12                                           0166 00652000
*       RFY                                                        0167 00653000
*         RTNCODE UNRSTD;           /*                               */ 00654000
*       IF GTPNOSPM=OFF             /* IF MESSAGE REQUESTED  @Z67SP00*/ 00655000
*         THEN                      /*                       @Z67SP00*/ 00656000
         L     @09,@PC00001                                        0168 00657000
         TM    GTPNOSPM(@09),B'10000000'                           0168 00658000
         BNZ   @RF00168                                            0168 00659000
*         DO;                       /*                       @Z67SP00*/ 00660000
*           HMASMMGP=''B;           /* INIT PARM             @Z67SP00*/ 00661000
         XC    HMASMMGP(16),HMASMMGP                               0170 00662000
*           MGPHLDS=ON;             /* MSG TO LOG AND        @Z67SP00*/ 00663000
*           MGPPRINT=ON;            /* PRINTER               @Z67SP00*/ 00664000
         OI    MGPHLDS,B'10010000'                                 0172 00665000
*           MGPMGNO1=HMA202I;       /* UNABLE TO OBTAIN STORAGE FOR     00666000
*                                      WORK AREAS            @Z67SP00*/ 00667000
         MVC   MGPMGNO1(2),@CH00056                                0173 00668000
*           MGPTYPE=MGPSEV;         /*                       @Z67SP00*/ 00669000
         MVI   MGPTYPE,X'04'                                       0174 00670000
*           CALL HMASMMSG(HMASMMGP);/* WRITE MSG             @Z67SP00*/ 00671000
         L     @15,@CV00123                                        0175 00672000
         LA    @01,@AL00175                                        0175 00673000
         BALR  @14,@15                                             0175 00674000
*         END;                      /*                       @Z67SP00*/ 00675000
*     END;                          /*                       @Z67SP00*/ 00676000
@RF00168 DS    0H                                                  0178 00677000
*   IF INITRC=GTPGOOD               /* IF GETMAIN OK                 */ 00678000
*     THEN                          /*                               */ 00679000
@RF00164 LTR   INITRC,INITRC                                       0178 00680000
         BNZ   @RF00178                                            0178 00681000
*     DO;                           /*                               */ 00682000
*       RENTPTR=GTPWKAD;            /* SAVE PTR TO WORK AREA         */ 00683000
         L     @15,@PC00001                                        0180 00684000
         L     RENTPTR,GTPWKAD(,@15)                               0180 00685000
*       RENTAREA=''B;               /* ZERO RENTAREA         @ZA24812*/ 00686000
         XC    RENTAREA(42,RENTPTR),RENTAREA(RENTPTR)              0181 00687000
*       CALL GTAGTPAG(RNTFIRST);    /* GET FIRST PAGE                */ 00688000
         ST    RENTPTR,@AL00001                                    0182 00689000
         LA    @01,@AL00001                                        0182 00690000
         BAL   @14,GTAGTPAG                                        0182 00691000
*       RFY                                                        0183 00692000
*         RTNCODE RSTD;             /*                               */ 00693000
*       INITRC=RTNCODE;             /* SAVE RETURN CODE              */ 00694000
         LR    INITRC,RTNCODE                                      0184 00695000
*       RFY                                                        0185 00696000
*         RTNCODE UNRSTD;           /*                               */ 00697000
*     END;                          /*                               */ 00698000
*   IF INITRC=GTPGOOD               /* IF GETMAINS SUCCESSFULL THEN  */ 00699000
*     THEN                          /* INIT WORK AREA AND FILE       */ 00700000
@RF00178 SLR   @09,@09                                             0187 00701000
         CR    INITRC,@09                                          0187 00702000
         BNE   @RF00187                                            0187 00703000
*     DO;                           /* CHAINING                      */ 00704000
*       RNTLAST=RNTFIRST;           /* INIT LAST PAGE TO FIRST       */ 00705000
         L     @02,RNTFIRST(,RENTPTR)                              0189 00706000
         ST    @02,RNTLAST(,RENTPTR)                               0189 00707000
*       RNTCPAG=RNTFIRST;           /* INIT CURRENT PAGE STATUS      */ 00708000
         ST    @02,RNTCPAG(,RENTPTR)                               0190 00709000
*       RNTCRCD=ADDR(PAGDATA);      /* INIT CURRENT RECORD STATUS    */ 00710000
         LA    @15,PAGDATA(,@02)                                   0191 00711000
         ST    @15,RNTCRCD(,RENTPTR)                               0191 00712000
*       RNTCPOS=ONE;                /* INIT CURRENT POSITION STATUS  */ 00713000
         LA    @14,1                                               0192 00714000
         STH   @14,RNTCPOS(,RENTPTR)                               0192 00715000
*       RNTCPAGN=RNTFIRST;          /* INIT CURRENT PAGE             */ 00716000
         ST    @02,RNTCPAGN(,RENTPTR)                              0193 00717000
*       RNTCRCDN=ADDR(PAGDATA);     /* RECORD AND            @Z67SP00*/ 00718000
         ST    @15,RNTCRCDN(,RENTPTR)                              0194 00719000
*       RNTCPOSN=ONE;               /* POSITION FOR GETN     @Z67SP00*/ 00720000
         STH   @14,RNTCPOSN(,RENTPTR)                              0195 00721000
*       RNTCPAGP=RNTFIRST;          /* INIT GETP CURRENT PAG @Z67SP00*/ 00722000
         ST    @02,RNTCPAGP(,RENTPTR)                              0196 00723000
*       RNTCRCDP=ADDR(PAGDATA);     /* INIT GETP CURRENT RECORD      */ 00724000
         ST    @15,RNTCRCDP(,RENTPTR)                              0197 00725000
*       RNTCPOSP=ONE;               /* INIT GTP CUR POS              */ 00726000
         STH   @14,RNTCPOSP(,RENTPTR)                              0198 00727000
*       PREVPAG=ZERO;               /* ZERO PREV PAGE IN FILE PTR    */ 00728000
         ST    @09,PREVPAG(,@02)                                   0199 00729000
*     END;                          /*                               */ 00730000
*   ELSE                            /* IF NULL FILE          @ZA24812*/ 00731000
*     IF GTPWKAD^=ZERO              /*                       @ZA24812*/ 00732000
*       THEN                        /* THEN FREE REEWNTRANT  @ZA24812*/ 00733000
         B     @RC00187                                            0201 00734000
@RF00187 L     @09,@PC00001                                        0201 00735000
         ICM   @02,15,GTPWKAD(@09)                                 0201 00736000
         BZ    @RF00201                                            0201 00737000
*       DO;                         /*                       @ZA24812*/ 00738000
*         RFY                                                      0203 00739000
*           R2 RSTD;                /* RESTRICT REGISTER     @ZA24812*/ 00740000
*         R2=LENGTH(RENTAREA);      /* LENGTH TO FREE SET    @ZA24812*/ 00741000
         LA    R2,42                                               0204 00742000
*         RENTPTR=ADDR(GTPWKAD);    /* ADDRESS TO FREE SET   @ZA24812*/ 00743000
         LA    RENTPTR,GTPWKAD(,@09)                               0205 00744000
*         GEN(FREEMAIN E,LV=(R2),A=(RENTPTR))                      0206 00745000
*         REFS(R2,RENTPTR);         /* FILE FREED            @ZA24812*/ 00746000
         FREEMAIN E,LV=(R2),A=(RENTPTR)                                 00747000
*         RFY                                                      0207 00748000
*           R2 UNRSTD;              /* UNRESTRICT REGISTER   @ZA24812*/ 00749000
*         GTPWKAD=ZERO;             /* REINIT GTPWKAD        @ZA24812*/ 00750000
         L     @09,@PC00001                                        0208 00751000
         SLR   @02,@02                                             0208 00752000
         ST    @02,GTPWKAD(,@09)                                   0208 00753000
*       END;                                                       0209 00754000
*   RETURN CODE(INITRC);            /* RETURN TO CALLER W/RETURN     */ 00755000
@RF00201 DS    0H                                                  0210 00756000
@RC00187 LR    @15,INITRC                                          0210 00757000
         L     @14,@SA00003                                        0210 00758000
         LM    @00,@12,@SA00003+8                                  0210 00759000
         BR    @14                                                 0210 00760000
*   END GTAINIT;                    /* CODE-END OF INITIALIZATION    */ 00761000
         EJECT                                                          00762000
*                                                                  0212 00763000
*   /*****************************************************************/ 00764000
*   /*                                                               */ 00765000
*   /* THIS PROCEDURE IS CALLED TO LOCATE THE SPECIFIED RECORD IN    */ 00766000
*   /* FILE                                                          */ 00767000
*   /*                                                               */ 00768000
*   /*****************************************************************/ 00769000
*                                                                  0212 00770000
*GTALOC:                            /*                               */ 00771000
*   PROCEDURE;                      /*                               */ 00772000
GTALOC   STM   @14,@12,12(@13)                                     0212 00773000
*   DECLARE                         /*                               */ 00774000
*     LOCRTNCD FIXED(8);            /* PROC RETURN CODE              */ 00775000
*   RFY                                                            0214 00776000
*     ONEPAGE BASED(CURPAG);                                       0214 00777000
*   LOCRTNCD=GTPGOOD;               /* INIT RETURN CODE              */ 00778000
         SLR   LOCRTNCD,LOCRTNCD                                   0215 00779000
*   CURPAG=RNTCPAG;                 /* PTR TO BLK REFERENCED LAST    */ 00780000
*                                                                  0216 00781000
         MVC   CURPAG(4),RNTCPAG(RENTPTR)                          0216 00782000
*   /*****************************************************************/ 00783000
*   /*                                                               */ 00784000
*   /* FIND NEXT PAGE WITH AT LEAST ONE RECORD IN IT         @XA21330*/ 00785000
*   /*                                                               */ 00786000
*   /*****************************************************************/ 00787000
*                                                                  0217 00788000
*   DO WHILE(                       /* LOOP THRU PAGES       @XA21330*/ 00789000
*         CNTINPAG=ZERO);           /* TILL PAGE WITH DATA   @XA21330*/ 00790000
         B     @DE00217                                            0217 00791000
@DL00217 DS    0H                                                  0218 00792000
*     CURPAG=NEXTPAG;               /* POINT TO NEXT PAGE    @XA21330*/ 00793000
         L     @09,CURPAG                                          0218 00794000
         L     @09,NEXTPAG(,@09)                                   0218 00795000
         ST    @09,CURPAG                                          0218 00796000
*   END;                            /*                       @XA21330*/ 00797000
@DE00217 L     @09,CURPAG                                          0219 00798000
         ICM   @02,3,CNTINPAG(@09)                                 0219 00799000
         BZ    @DL00217                                            0219 00800000
*   CURRCD=ADDR(PAGDATA);           /* CHECK FIRST RECORD IN PAGE  0220 00801000
*                                                            @ZA24812*/ 00802000
         LA    @09,PAGDATA(,@09)                                   0220 00803000
         ST    @09,CURRCD                                          0220 00804000
*   IF RCDKEY(1:GTPKEYLN)>USRKEY(1:GTPKEYLN)/* IF REQUESTED RECORD   */ 00805000
*     THEN                          /* BEFORE THIS ONE THEN START    */ 00806000
         L     @02,@PC00001                                        0221 00807000
         L     @01,GTPBUFAD(,@02)                                  0221 00808000
         LH    @02,GTPKEYLN(,@02)                                  0221 00809000
         BCTR  @02,0                                               0221 00810000
         EX    @02,@SC00298                                        0221 00811000
         BNH   @RF00221                                            0221 00812000
*     CURPAG=RNTFIRST;              /* AT FIRST PAGE                 */ 00813000
*                                                                  0222 00814000
         MVC   CURPAG(4),RNTFIRST(RENTPTR)                         0222 00815000
*   /*****************************************************************/ 00816000
*   /*                                                               */ 00817000
*   /* FIND THE PAGE THAT THE SPECIFIED RECORD IS IN                 */ 00818000
*   /*                                                               */ 00819000
*   /*****************************************************************/ 00820000
*                                                                  0223 00821000
*   STOP=OFF;                       /* LOOP CONTROL SW               */ 00822000
@RF00221 NI    STOP,B'01111111'                                    0223 00823000
*   DO WHILE(STOP=OFF);             /* LOOP TILL RCD FND     @XA21330*/ 00824000
         B     @DE00224                                            0224 00825000
@DL00224 DS    0H                                                  0225 00826000
*     IF CNTINPAG>ZERO              /* IF PAGE HAS RECORDS   @XA21330*/ 00827000
*       THEN                        /* THEN SEE IF RCD       @XA21330*/ 00828000
         L     @09,CURPAG                                          0225 00829000
         LH    @02,CNTINPAG(,@09)                                  0225 00830000
         LTR   @02,@02                                             0225 00831000
         BNP   @RF00225                                            0225 00832000
*       DO;                         /* IS IN THIS PAGE       @XA21330*/ 00833000
*         CURRCD=ADDR(PAGDATA)+((CNTINPAG-1)*GTPRCDLN);/* ADDR OF  0227 00834000
*                                      LAST RECORD IN PAGE           */ 00835000
         LA    @09,PAGDATA(,@09)                                   0227 00836000
         LR    @01,@02                                             0227 00837000
         BCTR  @01,0                                               0227 00838000
         L     @02,@PC00001                                        0227 00839000
         MH    @01,GTPRCDLN(,@02)                                  0227 00840000
         ALR   @09,@01                                             0227 00841000
         ST    @09,CURRCD                                          0227 00842000
*         IF RCDEOF=EOFRCD          /* END OF FILE?                  */ 00843000
*             |RCDKEY(1:GTPKEYLN)>=USRKEY(1:GTPKEYLN)/* OR RCD FOUND */ 00844000
*           THEN                    /* PASSED THEN                   */ 00845000
         CLC   RCDEOF(1,@09),EOFRCD                                0228 00846000
         BE    @RT00228                                            0228 00847000
         L     @01,GTPBUFAD(,@02)                                  0228 00848000
         LH    @02,GTPKEYLN(,@02)                                  0228 00849000
         BCTR  @02,0                                               0228 00850000
         EX    @02,@SC00298                                        0228 00851000
         BL    @RF00228                                            0228 00852000
@RT00228 DS    0H                                                  0229 00853000
*           STOP=ON;                /* STOP SEARCH                   */ 00854000
         OI    STOP,B'10000000'                                    0229 00855000
*         ELSE                      /* IF NOT IN PAGE                */ 00856000
*           CURPAG=NEXTPAG;         /* SET PTR TO NEXT PAGE IN FILE  */ 00857000
         B     @RC00228                                            0230 00858000
@RF00228 L     @09,CURPAG                                          0230 00859000
         L     @09,NEXTPAG(,@09)                                   0230 00860000
         ST    @09,CURPAG                                          0230 00861000
*       END;                        /* END PAGE HAS RECORDS  @XA21330*/ 00862000
*     ELSE                          /* IF PAGE HAS NO RECORD @XA21330*/ 00863000
*       CURPAG=NEXTPAG;             /* POINT TO NEXT PAGE    @XA21330*/ 00864000
         B     @RC00225                                            0232 00865000
@RF00225 L     @09,CURPAG                                          0232 00866000
         L     @09,NEXTPAG(,@09)                                   0232 00867000
         ST    @09,CURPAG                                          0232 00868000
*   END;                            /* END LOOP TO FIND PAGE         */ 00869000
*                                                                  0233 00870000
@RC00225 DS    0H                                                  0233 00871000
@DE00224 TM    STOP,B'10000000'                                    0233 00872000
         BZ    @DL00224                                            0233 00873000
*   /*****************************************************************/ 00874000
*   /*                                                               */ 00875000
*   /* PAGE WITH RECORD HAS BEEN FOUND NOW FIND RECORD IN THAT PAGE  */ 00876000
*   /*                                                               */ 00877000
*   /*****************************************************************/ 00878000
*                                                                  0234 00879000
*   CURRCD=ADDR(PAGDATA);           /* FIRST RCD IN PAGE             */ 00880000
         L     @09,CURPAG                                          0234 00881000
         LA    @09,PAGDATA(,@09)                                   0234 00882000
         ST    @09,CURRCD                                          0234 00883000
*   CURPOS=ONE;                     /* RCD POSITION IN PAGE          */ 00884000
         MVC   CURPOS(2),@CH00053                                  0235 00885000
*   STOP=OFF;                       /*                               */ 00886000
         NI    STOP,B'01111111'                                    0236 00887000
*   DO WHILE STOP=OFF;              /* LOOP TILL RCD FOUND           */ 00888000
         B     @DE00237                                            0237 00889000
@DL00237 DS    0H                                                  0238 00890000
*     IF RCDEOF=EOFRCD              /* IF END OF FILE                */ 00891000
*         |RCDKEY(1:GTPKEYLN)>USRKEY(1:GTPKEYLN)/* OR PAST RCD       */ 00892000
*       THEN                        /*                               */ 00893000
         L     @09,CURRCD                                          0238 00894000
         CLC   RCDEOF(1,@09),EOFRCD                                0238 00895000
         BE    @RT00238                                            0238 00896000
         L     @02,@PC00001                                        0238 00897000
         L     @01,GTPBUFAD(,@02)                                  0238 00898000
         LH    @02,GTPKEYLN(,@02)                                  0238 00899000
         BCTR  @02,0                                               0238 00900000
         EX    @02,@SC00298                                        0238 00901000
         BNH   @RF00238                                            0238 00902000
@RT00238 DS    0H                                                  0239 00903000
*       DO;                         /*                               */ 00904000
*         STOP=ON;                  /* STOP LOOP                     */ 00905000
         OI    STOP,B'10000000'                                    0240 00906000
*         LOCRTNCD=GTPNTFND;        /* RCD NOT FOUND RC              */ 00907000
         LA    LOCRTNCD,4                                          0241 00908000
*       END;                        /*                               */ 00909000
*     ELSE                          /*                               */ 00910000
*       IF RCDKEY(1:GTPKEYLN)=USRKEY(1:GTPKEYLN)/* IF RCD FOUND      */ 00911000
*         THEN                      /*                               */ 00912000
         B     @RC00238                                            0243 00913000
@RF00238 L     @09,@PC00001                                        0243 00914000
         L     @02,GTPBUFAD(,@09)                                  0243 00915000
         LH    @09,GTPKEYLN(,@09)                                  0243 00916000
         BCTR  @09,0                                               0243 00917000
         L     @01,CURRCD                                          0243 00918000
         EX    @09,@SC00302                                        0243 00919000
         BNE   @RF00243                                            0243 00920000
*         DO;                       /*                               */ 00921000
*           STOP=ON;                /* STOP LOOP                     */ 00922000
         OI    STOP,B'10000000'                                    0245 00923000
*           LOCRTNCD=GTPGOOD;       /* RCD FOUND RC                  */ 00924000
         SLR   LOCRTNCD,LOCRTNCD                                   0246 00925000
*         END;                      /*                               */ 00926000
*       ELSE                        /*                               */ 00927000
*         DO;                       /*                               */ 00928000
         B     @RC00243                                            0248 00929000
@RF00243 DS    0H                                                  0249 00930000
*           CURRCD=CURRCD+GTPRCDLN; /* INCR PTR TO NEXT RCD          */ 00931000
         L     @09,@PC00001                                        0249 00932000
         LH    @09,GTPRCDLN(,@09)                                  0249 00933000
         AL    @09,CURRCD                                          0249 00934000
         ST    @09,CURRCD                                          0249 00935000
*           CURPOS=CURPOS+ONE;      /* INCR RCD POSITION             */ 00936000
         LH    @09,CURPOS                                          0250 00937000
         LA    @09,1(,@09)                                         0250 00938000
         STH   @09,CURPOS                                          0250 00939000
*         END;                      /*                               */ 00940000
*   END;                            /* END FIND IN PAGE LOOP         */ 00941000
@RC00243 DS    0H                                                  0252 00942000
@RC00238 DS    0H                                                  0252 00943000
@DE00237 TM    STOP,B'10000000'                                    0252 00944000
         BZ    @DL00237                                            0252 00945000
*   RNTSTAT=CURSTAT;                /* SAVE CURRENT RECORD POSITION     00946000
*                                      IN REENTRANT WORK AREA        */ 00947000
         MVC   RNTSTAT(10,RENTPTR),CURSTAT                         0253 00948000
*   GTPRESTR=CURSTAT;               /* PASS CURRENT RECORD POSITION     00949000
*                                      TO CALLER                     */ 00950000
         L     @09,@PC00001                                        0254 00951000
         MVC   GTPRESTR(10,@09),CURSTAT                            0254 00952000
*   RETURN CODE(LOCRTNCD);          /* RETURN WITH CODE SET UP       */ 00953000
         LR    @15,LOCRTNCD                                        0255 00954000
         L     @14,12(,@13)                                        0255 00955000
         LM    @00,@12,20(@13)                                     0255 00956000
         BR    @14                                                 0255 00957000
*   END GTALOC;                     /*                               */ 00958000
         EJECT                                                          00959000
*                                                                  0257 00960000
*   /*****************************************************************/ 00961000
*   /*                                                               */ 00962000
*   /* THIS PROCEDURE IS CALLED TO DELETE RECORD FROM FILE IF LOCATE */ 00963000
*   /* FOUND USER SPECIFIED RECORD IN FILE. ALL FOLLOWING RECORDS IN */ 00964000
*   /* CURRENT PAGE OF FILE WILL BE SHIFTED UPWARD ONE POSITION,     */ 00965000
*   /* THEREBY DELETING APPROPRIATE RECORD                           */ 00966000
*   /*                                                               */ 00967000
*   /*****************************************************************/ 00968000
*                                                                  0257 00969000
*GTADEL:                                                           0257 00970000
*   PROC;                           /*                               */ 00971000
GTADEL   STM   @14,@12,12(@13)                                     0257 00972000
*   DECLARE                                                        0258 00973000
*     DELRC FIXED(31);              /* RETURN CODE                   */ 00974000
*   RFY                                                            0259 00975000
*     ONEPAGE BASED(CURPAG);        /*                               */ 00976000
*   DELRC=GTPGOOD;                  /* INIT TO DELETE SUCCESSFUL     */ 00977000
         SLR   DELRC,DELRC                                         0260 00978000
*   IF RCDKEY(1:GTPKEYLN)=USRKEY(1:GTPKEYLN)/* ONLY DO SHIFT IF    0261 00979000
*                                      RECORD TO DELETE WAS FOUND    */ 00980000
*     THEN                          /*                       @Z67SP00*/ 00981000
         L     @09,CURRCD                                          0261 00982000
         L     @02,@PC00001                                        0261 00983000
         L     @01,GTPBUFAD(,@02)                                  0261 00984000
         LH    @15,GTPKEYLN(,@02)                                  0261 00985000
         BCTR  @15,0                                               0261 00986000
         EX    @15,@SC00298                                        0261 00987000
         BNE   @RF00261                                            0261 00988000
*     DO;                           /*                       @Z67SP00*/ 00989000
*       RFY                                                        0263 00990000
*        (MVCLTOAD,                                                0263 00991000
*         MVCLTOLN,                                                0263 00992000
*         MVCLFMAD,                                                0263 00993000
*         MVCLFMLN) RSTD;           /* RESTRICT MVCL REGS    @YA20679*/ 00994000
*       MVCLTOAD=CURRCD;            /* SHIFT RCDS TO CURRENT @YA20679*/ 00995000
         LR    MVCLTOAD,@09                                        0264 00996000
*       MVCLFMAD=MVCLTOAD+GTPRCDLN; /* FROM FOLLOWING RCDS   @YA20679*/ 00997000
         LH    @09,GTPRCDLN(,@02)                                  0265 00998000
         LR    MVCLFMAD,MVCLTOAD                                   0265 00999000
         ALR   MVCLFMAD,@09                                        0265 01000000
*       MVCLTOLN=(CNTINPAG-CURPOS)*GTPRCDLN;/*               @YA20679*/ 01001000
         L     @02,CURPAG                                          0266 01002000
         LH    @01,CNTINPAG(,@02)                                  0266 01003000
         SH    @01,CURPOS                                          0266 01004000
         MR    @00,@09                                             0266 01005000
         LR    MVCLTOLN,@01                                        0266 01006000
*       MVCLFMLN=MVCLTOLN;          /*                       @YA20679*/ 01007000
         LR    MVCLFMLN,MVCLTOLN                                   0267 01008000
*       MVCL(MVCLTOAD,MVCLFMAD);    /* MOVE DATA             @YA20679*/ 01009000
         MVCL  MVCLTOAD,MVCLFMAD                                   0268 01010000
*       RFY                                                        0269 01011000
*        (MVCLTOAD,                                                0269 01012000
*         MVCLTOLN,                                                0269 01013000
*         MVCLFMAD,                                                0269 01014000
*         MVCLFMLN) UNRSTD;         /* FREE MVCL REGS        @YA20679*/ 01015000
*       CNTINPAG=CNTINPAG-1;        /* DECREMENT COUNT OF RECORDS IN    01016000
*                                      PAGE BY ONE                   */ 01017000
         L     @09,CURPAG                                          0270 01018000
         LH    @02,CNTINPAG(,@09)                                  0270 01019000
         BCTR  @02,0                                               0270 01020000
         STH   @02,CNTINPAG(,@09)                                  0270 01021000
*     END;                          /*                               */ 01022000
*   RETURN CODE(DELRC);             /*                               */ 01023000
@RF00261 LR    @15,DELRC                                           0272 01024000
         L     @14,12(,@13)                                        0272 01025000
         LM    @00,@12,20(@13)                                     0272 01026000
         BR    @14                                                 0272 01027000
*   END GTADEL;                     /*                               */ 01028000
         EJECT                                                          01029000
*                                                                  0274 01030000
*/********************************************************************/ 01031000
*/*                                                                  */ 01032000
*/* THIS PROCEDURE WILL ADD AN ENTRY TO AN IN STORAGE FILE. THE FILE */ 01033000
*/* IS MAINTAINED BY A KEY. PREVIOUS TO CALLING THIS PROCEDURE, A    */ 01034000
*/* CALL IS MADE TO GTALOC SO THAT CURSTAT WILL CONTAIN THE FOLLOWING*/ 01035000
*/*             1. A POINTER TO THE PAGE WHERE RECORD SHOULD BE      */ 01036000
*/*                ADDED.                                            */ 01037000
*/*             2. A POINTER TO THE RECORD WITHIN THE PAGE WHERE THE */ 01038000
*/*                RECORD SHOULD BE ADDED.                           */ 01039000
*/*             3. THE RECORD POSITION WITHIN THE PAGE WHERE THE     */ 01040000
*/*                TO BE ADDED.                                      */ 01041000
*/*                                                                  */ 01042000
*/********************************************************************/ 01043000
*                                                                  0274 01044000
*GTAADD:                                                           0274 01045000
*   PROC;                                                          0274 01046000
GTAADD   STM   @14,@12,@SA00006                                    0274 01047000
*   DECLARE                                                        0275 01048000
*     ADDRC FIXED(8);               /* INTERNAL RETURN CODE          */ 01049000
*   DECLARE                                                        0276 01050000
*     SAVKEY CHAR(255);             /* SAVE KEY OF ADDED RECORD      */ 01051000
*   DECLARE                         /*                       @YA20679*/ 01052000
*     SAVBUFFR CHAR(255);           /* FOR SAVE IN MVCL      @YA20679*/ 01053000
*   GEN DATA DEFS(SAVPAGE);                                        0278 01054000
*   DECLARE                         /*                       @YA20679*/ 01055000
*     SAVPAGE CHAR(4096) GEND;      /* FOR MVCL              @YA20679*/ 01056000
*   DECLARE                         /*                       @YA20679*/ 01057000
*     ADSAVPAG PTR(31) INIT(ADDR(SAVPAGE));/*                @YA20679*/ 01058000
*   DECLARE                         /*                       @YA20679*/ 01059000
*     INADDR PTR(31),               /*                       @YA20679*/ 01060000
*     OUTADDR PTR(31),              /*                       @YA20679*/ 01061000
*     SAVADDR PTR(31),              /*                       @YA20679*/ 01062000
*     SAVRCDAD PTR(31);             /*                               */ 01063000
*   DECLARE                         /*                       @YA20679*/ 01064000
*     MVCLLEN FIXED(31);            /* FOR MVCL LENGTH       @YA20679*/ 01065000
*   RFY                                                            0283 01066000
*     ONEPAGE BASED(CURPAG);        /* ADDRESS CURRENT RECORD PAGE   */ 01067000
*   CURSTAT=RNTSTAT;                /* RETRIEVE POSITION WHERE RECORD   01068000
*                                      IS TO BE ADDED                */ 01069000
         MVC   CURSTAT(10),RNTSTAT(RENTPTR)                        0284 01070000
*   ADDSTOP=OFF;                    /* SIGNAL ALL RECORDS IN FILE NOT   01071000
*                                      YET SHIFTED                   */ 01072000
         NI    ADDSTOP,B'10111111'                                 0285 01073000
*   ADDRC=GTPGOOD;                  /* INIT RETURN CODE TO SUCCESSFUL*/ 01074000
         MVI   ADDRC,X'00'                                         0286 01075000
*   INADDR=GTPBUFAD;                /* INPUT BUFFER ADDR     @YA20679*/ 01076000
         L     @09,@PC00001                                        0287 01077000
         L     @15,GTPBUFAD(,@09)                                  0287 01078000
         ST    @15,INADDR                                          0287 01079000
*   OUTADDR=ADDR(SAVBUFFR);         /* OUTPUT BUFFER ADDR    @YA20679*/ 01080000
*                                                                  0288 01081000
         LA    @14,SAVBUFFR                                        0288 01082000
         ST    @14,OUTADDR                                         0288 01083000
*   /*****************************************************************/ 01084000
*   /*                                                               */ 01085000
*   /* THE FOLLOWING CODE WILL ADD THE USER RECORD TO THE FILE. IF   */ 01086000
*   /* THE RECORD IN THE FILE AND THE RECORD TO BE ADDED HAVE THE    */ 01087000
*   /* SAME KEY THEN THE RECORD IN THE FILE WILL BE REPLACED BY THE  */ 01088000
*   /* RECORD TO BE ADDED. IF THE KEYS ARE NOT THE SAME THEN A SERIES*/ 01089000
*   /* OF MVCL INSTRUCTIONS IS USED TO SHIFT ALL REMAINING RECORDS IN*/ 01090000
*   /* FILE DOWN ONE POSITION.                               @YA20679*/ 01091000
*   /*                                                               */ 01092000
*   /*****************************************************************/ 01093000
*                                                                  0289 01094000
*   IF RCDKEY(1:GTPKEYLN)=          /* IF RECORD IN DILE HAS THE     */ 01095000
*       USRRCD(1:GTPKEYLN)          /* SMAE KEY AS RECORD TO BE ADDED*/ 01096000
*     THEN                          /* THEN REPLACE RECORD IN FILE   */ 01097000
         L     @14,CURRCD                                          0289 01098000
         LH    @07,GTPKEYLN(,@09)                                  0289 01099000
         BCTR  @07,0                                               0289 01100000
         EX    @07,@SC00304                                        0289 01101000
         BNE   @RF00289                                            0289 01102000
*     DO;                           /*                       @Z67SP00*/ 01103000
*       RECORD(1:GTPRCDLN)=         /* WITH RECORD TO BE ADDED       */ 01104000
*           USRRCD(1:GTPRCDLN);                                    0291 01105000
         LH    @09,GTPRCDLN(,@09)                                  0291 01106000
         BCTR  @09,0                                               0291 01107000
         EX    @09,@SM00306                                        0291 01108000
*     END;                                                         0292 01109000
*   ELSE                            /*                       @Z67SP00*/ 01110000
*     DO WHILE(ADDSTOP=OFF);        /* IF KEYS ARE UNEQUAL THEN    0293 01111000
*                                      INSERT RECORD TO BE ADDED AND    01112000
*                                      SHIFT ALL FOLLOWING RECORDS I    01113000
*                                      IN THE FILE DOWN ONE POSITION */ 01114000
         B     @RC00289                                            0293 01115000
@RF00289 B     @DE00293                                            0293 01116000
@DL00293 DS    0H                                                  0294 01117000
*       IF CNTINPAG=MAXENTCT        /* IF PAGE IS FULL       @YA20679*/ 01118000
*         THEN                      /* THEN SET UP TO SHIFT  @YA20679*/ 01119000
         LH    @09,MAXENTCT                                        0294 01120000
         L     @15,CURPAG                                          0294 01121000
         LH    @14,CNTINPAG(,@15)                                  0294 01122000
         CR    @14,@09                                             0294 01123000
         BNE   @RF00294                                            0294 01124000
*         DO;                       /* WHOLE PAGE            @YA20679*/ 01125000
*           SAVRCDAD=ADDR(PAGDATA)+((MAXENTCT-1)*GTPRCDLN);/*      0296 01126000
*                                                            @YA20679*/ 01127000
         LA    SAVRCDAD,PAGDATA(,@15)                              0296 01128000
         LR    @01,@09                                             0296 01129000
         BCTR  @01,0                                               0296 01130000
         L     @09,@PC00001                                        0296 01131000
         LH    @09,GTPRCDLN(,@09)                                  0296 01132000
         MR    @00,@09                                             0296 01133000
         ALR   SAVRCDAD,@01                                        0296 01134000
*           OUTADDR->RECORD(1:GTPRCDLN)=SAVRCDAD->RECORD(1:GTPRCDLN);   01135000
         L     @02,OUTADDR                                         0297 01136000
         LR    @15,@09                                             0297 01137000
         BCTR  @15,0                                               0297 01138000
         EX    @15,@SM00308                                        0297 01139000
*                                   /* SAVE LAST RECORD IN PAGE    0298 01140000
*                                                            @YA20679*/ 01141000
*           MVCLLEN=(CNTINPAG-CURPOS)*GTPRCDLN;/* DATA TO    @YA20679*/ 01142000
         LR    @01,@14                                             0298 01143000
         SH    @01,CURPOS                                          0298 01144000
         MR    @00,@09                                             0298 01145000
         LR    MVCLLEN,@01                                         0298 01146000
*         END;                      /* MOVE                  @YA20679*/ 01147000
*       ELSE                        /*                       @YA20679*/ 01148000
*         MVCLLEN=(CNTINPAG-CURPOS+1)*GTPRCDLN;/* SHIFT RCDS IN PAGE    01149000
*                                      DOWN ONE              @YA20679*/ 01150000
         B     @RC00294                                            0300 01151000
@RF00294 L     @09,CURPAG                                          0300 01152000
         LH    @01,CNTINPAG(,@09)                                  0300 01153000
         SH    @01,CURPOS                                          0300 01154000
         AH    @01,@CH00053                                        0300 01155000
         L     @09,@PC00001                                        0300 01156000
         MH    @01,GTPRCDLN(,@09)                                  0300 01157000
         LR    MVCLLEN,@01                                         0300 01158000
*       RFY                                                        0301 01159000
*        (MVCLTOAD,                                                0301 01160000
*         MVCLTOLN,                                                0301 01161000
*         MVCLFMAD,                                                0301 01162000
*         MVCLFMLN) RSTD;           /* RESTRICT MVCL REGS    @YA20679*/ 01163000
@RC00294 DS    0H                                                  0302 01164000
*       MVCLTOAD=ADSAVPAG;          /* MOVE TO SAVE PAGE     @YA20679*/ 01165000
         L     MVCLTOAD,ADSAVPAG                                   0302 01166000
*       MVCLTOLN=MVCLLEN;           /* FOR LEN CALC          @YA20679*/ 01167000
         LR    MVCLTOLN,MVCLLEN                                    0303 01168000
*       MVCLFMAD=CURRCD;            /* FROM CURRENT POSITION @YA20679*/ 01169000
         L     MVCLFMAD,CURRCD                                     0304 01170000
*       MVCLFMLN=MVCLTOLN;          /*                       @YA20679*/ 01171000
         LR    MVCLFMLN,MVCLTOLN                                   0305 01172000
*       MVCL(MVCLTOAD,MVCLFMAD);    /* MOVE TOTAL RCD        @YA20679*/ 01173000
         MVCL  MVCLTOAD,MVCLFMAD                                   0306 01174000
*       MVCLTOAD=CURRCD+GTPRCDLN;   /* MOVE TO NEXT POSITION @YA20679*/ 01175000
         L     @09,@PC00001                                        0307 01176000
         LH    MVCLTOAD,GTPRCDLN(,@09)                             0307 01177000
         AL    MVCLTOAD,CURRCD                                     0307 01178000
*       MVCLTOLN=MVCLLEN;           /*                       @YA20679*/ 01179000
         LR    MVCLTOLN,MVCLLEN                                    0308 01180000
*       MVCLFMAD=ADSAVPAG;          /* FROM SAVED PAGE       @YA20679*/ 01181000
         L     MVCLFMAD,ADSAVPAG                                   0309 01182000
*       MVCLFMLN=MVCLLEN;           /*                       @YA20679*/ 01183000
         LR    MVCLFMLN,MVCLLEN                                    0310 01184000
*       MVCL(MVCLTOAD,MVCLFMAD);    /* MOVE DATA BACK        @YA20679*/ 01185000
         MVCL  MVCLTOAD,MVCLFMAD                                   0311 01186000
*       RFY                                                        0312 01187000
*        (MVCLTOAD,                                                0312 01188000
*         MVCLTOLN,                                                0312 01189000
*         MVCLFMAD,                                                0312 01190000
*         MVCLFMLN) UNRSTD;         /* FREE MVCL REGS        @YA20679*/ 01191000
*       RECORD(1:GTPRCDLN)=INADDR->RECORD(1:GTPRCDLN);/* MOVE RCD TO    01192000
*                                      BE INSERTED INTO SLOT @YA20679*/ 01193000
         L     @09,CURRCD                                          0313 01194000
         L     @15,@PC00001                                        0313 01195000
         LH    @15,GTPRCDLN(,@15)                                  0313 01196000
         BCTR  @15,0                                               0313 01197000
         L     @14,INADDR                                          0313 01198000
         EX    @15,@SM00310                                        0313 01199000
*       IF CNTINPAG=MAXENTCT        /* IF PAGE WAS FULL      @YA20679*/ 01200000
*         THEN                      /*                       @YA20679*/ 01201000
         L     @09,CURPAG                                          0314 01202000
         CLC   CNTINPAG(2,@09),MAXENTCT                            0314 01203000
         BNE   @RF00314                                            0314 01204000
*         DO;                       /*                       @YA20679*/ 01205000
*           SAVADDR=INADDR;         /* SWAP INPUT/OUTPUT     @YA20679*/ 01206000
         LR    SAVADDR,@14                                         0316 01207000
*           INADDR=OUTADDR;         /* BUFFERS               @YA20679*/ 01208000
         MVC   INADDR(4),OUTADDR                                   0317 01209000
*           OUTADDR=SAVADDR;        /*                       @YA20679*/ 01210000
         ST    SAVADDR,OUTADDR                                     0318 01211000
*         END;                      /*                       @YA20679*/ 01212000
*       ELSE                        /* IF PAGE NOT FULL      @YA20679*/ 01213000
*         DO;                       /* THEN STOPP LOOP       @YA20679*/ 01214000
         B     @RC00314                                            0320 01215000
@RF00314 DS    0H                                                  0321 01216000
*           ADDSTOP=ON;             /*                       @YA20679*/ 01217000
         OI    ADDSTOP,B'01000000'                                 0321 01218000
*           CNTINPAG=CNTINPAG+1;    /* INCR PAGGE CNT        @YA20679*/ 01219000
         L     @09,CURPAG                                          0322 01220000
         LA    @15,1                                               0322 01221000
         AH    @15,CNTINPAG(,@09)                                  0322 01222000
         STH   @15,CNTINPAG(,@09)                                  0322 01223000
*         END;                      /*                       @YA20679*/ 01224000
*       IF(CNTINPAG=MAXENTCT)&      /* IF SHIFTING IS TO CONTINUE AND*/ 01225000
*           (ADDSTOP=OFF)&          /* ONTO ANOTHER PAGE AND THERE   */ 01226000
*           (NEXTPAG=ZERO)          /* ARE NO MORE PAGES IN FILE THEN*/ 01227000
*         THEN                      /* GET A NEW PAGE                */ 01228000
@RC00314 L     @09,CURPAG                                          0324 01229000
         CLC   CNTINPAG(2,@09),MAXENTCT                            0324 01230000
         BNE   @RF00324                                            0324 01231000
         TM    ADDSTOP,B'01000000'                                 0324 01232000
         BNZ   @RF00324                                            0324 01233000
         ICM   @15,15,NEXTPAG(@09)                                 0324 01234000
         BNZ   @RF00324                                            0324 01235000
*         DO;                       /*                       @Z67SP00*/ 01236000
*           SAVKEY(1:GTPKEYLN)=     /* SAVE KEY OF ADDED RECORD      */ 01237000
*               RNTCRCD->USRKEY(1:GTPKEYLN);                       0326 01238000
         L     @15,@PC00001                                        0326 01239000
         LH    @15,GTPKEYLN(,@15)                                  0326 01240000
         BCTR  @15,0                                               0326 01241000
         L     @01,RNTCRCD(,RENTPTR)                               0326 01242000
         EX    @15,@SM00312                                        0326 01243000
*           CALL GTAGTPAG(ONEPAGE); /* VIA A CALL TO GET PAGE        */ 01244000
         ST    @09,@AL00001                                        0327 01245000
         LA    @01,@AL00001                                        0327 01246000
         BAL   @14,GTAGTPAG                                        0327 01247000
*           RFY                                                    0328 01248000
*             RTNCODE RSTD;                                        0328 01249000
*           ADDRC=RTNCODE;          /* SAVE RETURN CODE              */ 01250000
         STC   RTNCODE,ADDRC                                       0329 01251000
*           RFY                                                    0330 01252000
*             RTNCODE UNRSTD;                                      0330 01253000
*           IF ADDRC=ZERO           /* IF GOOD RETURN CODE           */ 01254000
*               &CMPRSW=ON          /* AND COMPRESS WAS DONE         */ 01255000
*             THEN                  /* THEN DO                       */ 01256000
         CLI   ADDRC,0                                             0331 01257000
         BNE   @RF00331                                            0331 01258000
         TM    CMPRSW,B'00100000'                                  0331 01259000
         BNO   @RF00331                                            0331 01260000
*             DO;                   /*                       @Z67SP00*/ 01261000
*               USRKEY(1:GTPKEYLN)= /* RESTORE USER                  */ 01262000
*                   SAVKEY(1:GTPKEYLN);/* BUFFER AND CALL            */ 01263000
         L     @09,@PC00001                                        0333 01264000
         L     @01,GTPBUFAD(,@09)                                  0333 01265000
         LH    @09,GTPKEYLN(,@09)                                  0333 01266000
         BCTR  @09,0                                               0333 01267000
         EX    @09,@SM00314                                        0333 01268000
*               CALL GTALOC;        /* CURRENT ENTRY STATUS IN     0334 01269000
*                                      REENTRANT WORK AREA           */ 01270000
         BAL   @14,GTALOC                                          0334 01271000
*             END;                                                 0335 01272000
*           ADDSTOP=ON;             /* SIGNAL ADD COMPLETE WHEN    0336 01273000
*                                      COMPRESS ATTEMPTED            */ 01274000
@RF00331 OI    ADDSTOP,B'01000000'                                 0336 01275000
*         END;                                                     0337 01276000
*       IF ADDSTOP=OFF              /* CONTINUE SHIFT ON NEXT PAGE 0338 01277000
*                                      SIGNALED THEN                 */ 01278000
*         THEN                                                     0338 01279000
@RF00324 TM    ADDSTOP,B'01000000'                                 0338 01280000
         BNZ   @RF00338                                            0338 01281000
*         DO;                       /*                       @Z67SP00*/ 01282000
*           CURPAG=NEXTPAG;         /* RESET PAGE POINTER            */ 01283000
         L     @09,CURPAG                                          0340 01284000
         L     @09,NEXTPAG(,@09)                                   0340 01285000
         ST    @09,CURPAG                                          0340 01286000
*           CURRCD=ADDR(PAGDATA);   /* RESET PTR TO FIRST RECORD     */ 01287000
         LA    @09,PAGDATA(,@09)                                   0341 01288000
         ST    @09,CURRCD                                          0341 01289000
*           CURPOS=ONE;             /* RESET TO FIRST POSITION       */ 01290000
         MVC   CURPOS(2),@CH00053                                  0342 01291000
*         END;                                                     0343 01292000
*       ELSE                        /*                       @Z67SP00*/ 01293000
*         DO;                       /* RESTORE USER BUFFER           */ 01294000
         B     @RC00338                                            0344 01295000
@RF00338 DS    0H                                                  0345 01296000
*           CURSTAT=RNTSTAT;        /* RETRIEVE IT THROUGH STATUS IN */ 01297000
         MVC   CURSTAT(10),RNTSTAT(RENTPTR)                        0345 01298000
*           USRRCD(1:GTPRCDLN)=     /* REENTRANT WORK AREA           */ 01299000
*               RECORD(1:GTPRCDLN);                                0346 01300000
         L     @09,@PC00001                                        0346 01301000
         L     @01,GTPBUFAD(,@09)                                  0346 01302000
         LH    @09,GTPRCDLN(,@09)                                  0346 01303000
         BCTR  @09,0                                               0346 01304000
         L     @15,CURRCD                                          0346 01305000
         EX    @09,@SM00316                                        0346 01306000
*         END;                                                     0347 01307000
*     END;                          /* SHIFTING COMPLETE             */ 01308000
@RC00338 DS    0H                                                  0348 01309000
@DE00293 TM    ADDSTOP,B'01000000'                                 0348 01310000
         BZ    @DL00293                                            0348 01311000
*   RETURN CODE(ADDRC);                                            0349 01312000
@RC00289 SLR   @15,@15                                             0349 01313000
         IC    @15,ADDRC                                           0349 01314000
         L     @14,@SA00006                                        0349 01315000
         LM    @00,@12,@SA00006+8                                  0349 01316000
         BR    @14                                                 0349 01317000
*   END GTAADD;                                                    0350 01318000
         EJECT                                                          01319000
*                                                                  0351 01320000
*/********************************************************************/ 01321000
*/*   THIS PROCEDURE IS CALLED BY GTAINIT AND GTAADD IN BOTH CASES   */ 01322000
*/*   GETMAIN IS ISSUED FOR A ONE PAGE BLOCK                         */ 01323000
*/*              IF CALLED BY GTAINIT THEN                           */ 01324000
*/*                 - ADDRESS OF GETMAINED AREA                      */ 01325000
*/*                  IS SET IN THE PARM PASSED                       */ 01326000
*/*                 - NEXT PAGE POINTER IS SET TO ZERO               */ 01327000
*/*              IF CALLED BY GTAADD                                 */ 01328000
*/*                 - GTACMPRS IS CALLED                             */ 01329000
*/*                   AND CMPRSW IS SET ON IF                        */ 01330000
*/*                   GETMAIN FAILS                                  */ 01331000
*/*                 - CURRENT AND NEW PAGE                           */ 01332000
*/*                   CHAINING IS UPDATED                            */ 01333000
*/*              - CNTINPAG IS SET TO ONE                            */ 01334000
*/*              - FIRST RECORD IS SET TO END OF                     */ 01335000
*/*                FILE RECORD                                       */ 01336000
*/********************************************************************/ 01337000
*                                                                  0351 01338000
*GTAGTPAG:                          /*                               */ 01339000
*   PROC(FILEPAGE);                 /*                               */ 01340000
GTAGTPAG STM   @14,@12,@SA00007                                    0351 01341000
         MVC   @PC00007(4),0(@01)                                  0351 01342000
*   DECLARE                         /*                       @Z67SP00*/ 01343000
*     FILEPAGE CHAR(*);             /* CURRENT PAGE IS PASSED        */ 01344000
*   DECLARE                         /*                       @Z67SP00*/ 01345000
*     CURPGPTR PTR(31);             /* PARAMETER PASSED BY CALLER    */ 01346000
*   DECLARE                         /*                       @Z67SP00*/ 01347000
*     GETPAGRC FIXED(31);           /* SUBROUTINE RETURN CODE        */ 01348000
*   DECLARE                         /*                       @Z67SP00*/ 01349000
*     NEWPGPTR PTR(31) INIT(0);     /* POINTER TO GETMAINED BLOCK    */ 01350000
*   RFY                                                            0356 01351000
*     ONEPAGE BASED(CURPGPTR);                                     0356 01352000
*                                                                  0356 01353000
*   /*****************************************************************/ 01354000
*   /*                                                               */ 01355000
*   /* GETMAIN NEW PAGE                                              */ 01356000
*   /*                                                               */ 01357000
*   /*****************************************************************/ 01358000
*                                                                  0357 01359000
*   GETPAGRC=GTPGOOD;               /* INIT TO GOOD RETURN CODE      */ 01360000
         SLR   GETPAGRC,GETPAGRC                                   0357 01361000
*   CURPGPTR=ADDR(FILEPAGE);        /* POINT TO PAGE PASSED          */ 01362000
         L     @09,@PC00007                                        0358 01363000
         ST    @09,CURPGPTR                                        0358 01364000
*   RFY                                                            0359 01365000
*     R2 RSTD;                      /*                               */ 01366000
*   R2=PAGESIZE;                    /* SET SIZE FOR GETMAIN  @Z67SP00*/ 01367000
         L     R2,PAGESIZE                                         0360 01368000
*   GEN(GETMAIN EC,LV=(R2),A=NEWPGPTR)/* ISSUE GETMAIN               */ 01369000
*   REFS(R2,NEWPGPTR);              /* FOR ONE PAGE BLOCK            */ 01370000
         GETMAIN EC,LV=(R2),A=NEWPGPTR                                  01371000
*   RFY                                                            0362 01372000
*     R2 UNRSTD;                    /*                               */ 01373000
*   RFY                                                            0363 01374000
*     RTNCODE RSTD;                 /*                               */ 01375000
*   IF RTNCODE^=GTPGOOD             /* IF UNSUCCESSFUL THEN SIGNAL   */ 01376000
*     THEN                          /* OUT OF SPACE CONDITION        */ 01377000
         LTR   RTNCODE,RTNCODE                                     0364 01378000
         BZ    @RF00364                                            0364 01379000
*     GETPAGRC=GTPSPACE;            /* OUT OF SPACE CONDITION        */ 01380000
         LA    GETPAGRC,12                                         0365 01381000
*   RFY                                                            0366 01382000
*     RTNCODE UNRSTD;                                              0366 01383000
*                                                                  0366 01384000
@RF00364 DS    0H                                                  0367 01385000
*   /*****************************************************************/ 01386000
*   /*                                                               */ 01387000
*   /* IF GETMAIN OK CHAIN NEW PAGE TO PREVIOUS PAGE                 */ 01388000
*   /*                                                               */ 01389000
*   /*****************************************************************/ 01390000
*                                                                  0367 01391000
*   IF GETPAGRC=GTPGOOD             /* IF GETMAIN SUCCESSFUL THEN    */ 01392000
*     THEN                          /*                               */ 01393000
         SLR   @09,@09                                             0367 01394000
         CR    GETPAGRC,@09                                        0367 01395000
         BNE   @RF00367                                            0367 01396000
*     DO;                           /*                       @Z67SP00*/ 01397000
*       NEXTPAG=NEWPGPTR;           /* SET UP NEXT PAGE OF CURRENT 0369 01398000
*                                      PAGE TO NEW PAGE              */ 01399000
         L     @02,NEWPGPTR                                        0369 01400000
         L     @15,CURPGPTR                                        0369 01401000
         ST    @02,NEXTPAG(,@15)                                   0369 01402000
*       NEWPGPTR->PREVPAG=CURPGPTR; /* SET UP PREVIOUS PAGE POINTER  */ 01403000
         ST    @15,PREVPAG(,@02)                                   0370 01404000
*       NEWPGPTR->NEXTPAG=ZERO;     /* INIT TO NO NEXT PAGE          */ 01405000
         ST    @09,NEXTPAG(,@02)                                   0371 01406000
*       CURPGPTR=NEWPGPTR;          /* PASS BACK PAGE ADDRESS        */ 01407000
         ST    @02,CURPGPTR                                        0372 01408000
*       PAGDATA(ONE)=EOFRCD;        /* PLACE EOF RECORD ON PAGE      */ 01409000
         MVC   PAGDATA(1,@02),EOFRCD                               0373 01410000
*       CNTINPAG=ONE;               /* COUNT OF RECORDS SET TO ONE   */ 01411000
         MVC   CNTINPAG(2,@02),@CH00053                            0374 01412000
*       RNTLAST=CURPGPTR;           /* RESET LAST PAGE IN FILE       */ 01413000
         ST    @02,RNTLAST(,RENTPTR)                               0375 01414000
*     END;                          /*                               */ 01415000
*                                                                  0376 01416000
*   /*****************************************************************/ 01417000
*   /*                                                               */ 01418000
*   /* IF GM FOR NEXT PAGE FAILED TRY TO COMPRESS EXISTING PAGES     */ 01419000
*   /*                                                               */ 01420000
*   /*****************************************************************/ 01421000
*                                                                  0377 01422000
*   IF((GETPAGRC=GTPSPACE)&         /* IF NO MORE SPACE AND          */ 01423000
*       (RNTFIRST^=ZERO))           /* NOT CALLED BY GTAINIT THEN    */ 01424000
*     THEN                          /* DO                            */ 01425000
@RF00367 CH    GETPAGRC,@CH00033                                   0377 01426000
         BNE   @RF00377                                            0377 01427000
         ICM   @09,15,RNTFIRST(RENTPTR)                            0377 01428000
         BZ    @RF00377                                            0377 01429000
*     DO;                           /*                       @Z67SP00*/ 01430000
*       CALL GTACMPRS;              /* COMPRESS FILE                 */ 01431000
         BAL   @14,GTACMPRS                                        0379 01432000
*       RFY                                                        0380 01433000
*         RTNCODE RSTD;             /*                               */ 01434000
*       GETPAGRC=RTNCODE;           /* SAVE COMPRESS RETURN CODE     */ 01435000
         LR    GETPAGRC,RTNCODE                                    0381 01436000
*       RFY                                                        0382 01437000
*         RTNCODE UNRSTD;                                          0382 01438000
*     END;                          /*                               */ 01439000
*                                                                  0383 01440000
*   /*****************************************************************/ 01441000
*   /*                                                               */ 01442000
*   /* IF ERROR IN GETMAIN ISSUE MSG IF REQUIRED             @Z67SP00*/ 01443000
*   /*                                                               */ 01444000
*   /*****************************************************************/ 01445000
*                                                                  0384 01446000
*   IF GETPAGRC=GTPSPACE            /* IF GM ERR             @Z67SP00*/ 01447000
*       &GTPNOSPM=OFF               /* AND MSG REQUESTED     @Z67SP00*/ 01448000
*     THEN                          /*                       @Z67SP00*/ 01449000
@RF00377 CH    GETPAGRC,@CH00033                                   0384 01450000
         BNE   @RF00384                                            0384 01451000
         L     @09,@PC00001                                        0384 01452000
         TM    GTPNOSPM(@09),B'10000000'                           0384 01453000
         BNZ   @RF00384                                            0384 01454000
*     DO;                           /*                       @Z67SP00*/ 01455000
*       HMASMMGP=''B;               /* INIT PARM             @Z67SP00*/ 01456000
         XC    HMASMMGP(16),HMASMMGP                               0386 01457000
*       MGPHLDS=ON;                 /* MSG TO LOG AND        @Z67SP00*/ 01458000
*       MGPPRINT=ON;                /* PRINTER               @Z67SP00*/ 01459000
         OI    MGPHLDS,B'10010000'                                 0388 01460000
*       MGPMGNO1=HMA202I;           /* UNABLE TO OBTAIN STORAGE FOR     01461000
*                                      WORK AREAS            @Z67SP00*/ 01462000
         MVC   MGPMGNO1(2),@CH00056                                0389 01463000
*       MGPTYPE=MGPSEV;             /*                       @Z67SP00*/ 01464000
         MVI   MGPTYPE,X'04'                                       0390 01465000
*       CALL HMASMMSG(HMASMMGP);    /* WRITE MSG             @Z67SP00*/ 01466000
         L     @15,@CV00123                                        0391 01467000
         LA    @01,@AL00391                                        0391 01468000
         BALR  @14,@15                                             0391 01469000
*     END;                          /*                       @Z67SP00*/ 01470000
*   RETURN CODE(GETPAGRC);          /* RETURN PASSING BACK RETURN  0393 01471000
*                                      CODE                          */ 01472000
@RF00384 LR    @15,GETPAGRC                                        0393 01473000
         L     @14,@SA00007                                        0393 01474000
         LM    @00,@12,@SA00007+8                                  0393 01475000
         BR    @14                                                 0393 01476000
*   END GTAGTPAG;                   /* END OF GET PAGE ROUTINE       */ 01477000
         EJECT                                                          01478000
*                                                                  0395 01479000
*/********************************************************************/ 01480000
*/*                                                                  */ 01481000
*/*       PROCEDURE IS CALLED TO COMPRESS FILE WHEN UNABLE           */ 01482000
*/*       TO GETMAIN SPACE.                                          */ 01483000
*/*              COMPRESS OUTPUT                                     */ 01484000
*/*                 - CMPRSW SET ON                                  */ 01485000
*/*                 - RETURN CODE OF ZERO IF FILE HAD                */ 01486000
*/*                   ROOM TO DO A COMPRESS                          */ 01487000
*/*                 - RETURN OF GTPSPACE IF NO COMPRESS              */ 01488000
*/*                   WAS DONE                                       */ 01489000
*/*                                                                  */ 01490000
*/********************************************************************/ 01491000
*                                                                  0395 01492000
*GTACMPRS:                                                         0395 01493000
*   PROC;                           /*                               */ 01494000
*                                                                  0395 01495000
GTACMPRS STM   @14,@12,12(@13)                                     0395 01496000
*   /*****************************************************************/ 01497000
*   /*                                                               */ 01498000
*   /* LOCAL DECLARES                                                */ 01499000
*   /*                                                               */ 01500000
*   /*****************************************************************/ 01501000
*                                                                  0396 01502000
*   DECLARE                                                        0396 01503000
*     CMPRSRC FIXED(31);            /* SUBROUTINE RETURN CODE        */ 01504000
*   DECLARE                                                        0397 01505000
*     TOPAGPTR PTR(31);             /* POINTER TO PAGE TO WHICH    0397 01506000
*                                      RECORDS WILL BE MOVED         */ 01507000
*   DECLARE                                                        0398 01508000
*     TORCD PTR(31);                /* ADDRESS TO MOVE RECORD TO     */ 01509000
*   DECLARE                                                        0399 01510000
*     TOCNT FIXED(15);              /* COUNT OF ' TO-RECORDS'        */ 01511000
*   DECLARE                                                        0400 01512000
*     FMPAGPTR PTR(31);             /* POINTER TO PAGE FROM WHICH  0400 01513000
*                                      RECORDS WILL BE MOVED         */ 01514000
*   DECLARE                                                        0401 01515000
*     FMRCD PTR(31);                /* ADDRESS TO MOVE RECORD FROM   */ 01516000
*   DECLARE                                                        0402 01517000
*     FROMCNT FIXED(15);            /* COUNT OF 'FROM-RECORD' TO MOVE   01518000
*                                      IN CURRENT 'FROM-PAGE'        */ 01519000
*   DECLARE                                                        0403 01520000
*     1 CMPRSSW1 BIT(8),            /* SWITCHES USED BY GTACMPRS     */ 01521000
*       3 TORECFND BIT(1),          /* TO RECORD FOUND               */ 01522000
*       3 FMRECFND BIT(1),          /* FROM RECORD FOUND             */ 01523000
*       3 COMPSTOP BIT(1);          /* COMPRESS COMPLETE SWITCH      */ 01524000
*                                                                  0404 01525000
*   /*****************************************************************/ 01526000
*   /*                                                               */ 01527000
*   /* START OF CODE                                                 */ 01528000
*   /*                                                               */ 01529000
*   /*****************************************************************/ 01530000
*                                                                  0404 01531000
*   CMPRSRC=GTPGOOD;                /* INIT RETURN CODE              */ 01532000
         SLR   @09,@09                                             0404 01533000
         ST    @09,CMPRSRC                                         0404 01534000
*   CMPRSW=OFF;                     /* INIT COMPRESS DONE SWITCH     */ 01535000
         NI    CMPRSW,B'11011111'                                  0405 01536000
*   CMPRSSW1='0'B;                  /* INIT INTERNAL SWITCHES        */ 01537000
*                                                                  0406 01538000
         MVI   CMPRSSW1,B'00000000'                                0406 01539000
*   /*****************************************************************/ 01540000
*   /*                                                               */ 01541000
*   /* THIS SEGMENT STARTS WITH THE FIRST PAGE IN THE FILE AND       */ 01542000
*   /* SEARCHES FOR THE FIRST NON-FULL PAGE                          */ 01543000
*   /*                                                               */ 01544000
*   /*****************************************************************/ 01545000
*                                                                  0407 01546000
*   RFY                                                            0407 01547000
*     ONEPAGE BASED(TOPAGPTR);      /*                               */ 01548000
*   TOPAGPTR=RNTFIRST;              /* START WITH FIRST PAGE OF FILE */ 01549000
         L     TOPAGPTR,RNTFIRST(,RENTPTR)                         0408 01550000
*   DO WHILE(TORECFND=OFF&NEXTPAG^=ZERO);/* DO WHILE A 'TO-RECORD' 0409 01551000
*                                      PAGE HAS NOT BEEN FOUND AND 0409 01552000
*                                      ALL PAGES HAVEN'T BEEN SCANNED*/ 01553000
         B     @DE00409                                            0409 01554000
@DL00409 DS    0H                                                  0410 01555000
*     IF CNTINPAG<MAXENTCT          /* IF PAGE NOT FULL              */ 01556000
*       THEN                                                       0410 01557000
         LH    @09,CNTINPAG(,TOPAGPTR)                             0410 01558000
         CH    @09,MAXENTCT                                        0410 01559000
         BNL   @RF00410                                            0410 01560000
*       DO;                         /* THEN 'TO PAGE' FOUND          */ 01561000
*         TORECFND=ON;              /* SIGNAL END OF SEARCH          */ 01562000
         OI    TORECFND,B'10000000'                                0412 01563000
*         TORCD=ADDR(PAGDATA)+      /* POINT TO START                */ 01564000
*             ((CNTINPAG)*GTPRCDLN);/* OF 'TO-RECORDS'               */ 01565000
         LA    @02,PAGDATA(,TOPAGPTR)                              0413 01566000
         L     @15,@PC00001                                        0413 01567000
         LR    @14,@09                                             0413 01568000
         MH    @14,GTPRCDLN(,@15)                                  0413 01569000
         ALR   @02,@14                                             0413 01570000
         ST    @02,TORCD                                           0413 01571000
*         TOCNT=CNTINPAG;           /* INIT 'TO-PAGE' RECORD COUNT   */ 01572000
         STH   @09,TOCNT                                           0414 01573000
*       END;                        /*                               */ 01574000
*     ELSE                                                         0416 01575000
*       TOPAGPTR=NEXTPAG;           /* CONTINUE 'TO-PAGE' SEARCH     */ 01576000
         B     @RC00410                                            0416 01577000
@RF00410 L     TOPAGPTR,NEXTPAG(,TOPAGPTR)                         0416 01578000
*   END;                            /* END OF TO-PAGE SEARCH         */ 01579000
*                                                                  0417 01580000
@RC00410 DS    0H                                                  0417 01581000
@DE00409 TM    TORECFND,B'10000000'                                0417 01582000
         BNZ   @DC00409                                            0417 01583000
         ICM   @09,15,NEXTPAG(TOPAGPTR)                            0417 01584000
         BNZ   @DL00409                                            0417 01585000
@DC00409 DS    0H                                                  0418 01586000
*   /*****************************************************************/ 01587000
*   /*                                                               */ 01588000
*   /* IF A NON-FULL PAGE WAS FOUND IN THE ABOVE SEGMENT THEN THE    */ 01589000
*   /* COMPRESS CAN CONTINUE                                         */ 01590000
*   /*                                                               */ 01591000
*   /*****************************************************************/ 01592000
*                                                                  0418 01593000
*   IF TORECFND=ON                  /* IF NON FULL PAGE FOUND        */ 01594000
*     THEN                                                         0418 01595000
         TM    TORECFND,B'10000000'                                0418 01596000
         BNO   @RF00418                                            0418 01597000
*     CMPRSW=ON;                    /* THEN SIGNAL COMPRESS DONE     */ 01598000
         OI    CMPRSW,B'00100000'                                  0419 01599000
*   ELSE                                                           0420 01600000
*     DO;                           /* ELSE DO                       */ 01601000
         B     @RC00418                                            0420 01602000
@RF00418 DS    0H                                                  0421 01603000
*       TORCD=ADDR(PAGDATA)+((CNTINPAG-1)*GTPRCDLN);/* OVERLAY       */ 01604000
         LA    @09,PAGDATA(,TOPAGPTR)                              0421 01605000
         LH    @01,CNTINPAG(,TOPAGPTR)                             0421 01606000
         BCTR  @01,0                                               0421 01607000
         L     @02,@PC00001                                        0421 01608000
         MH    @01,GTPRCDLN(,@02)                                  0421 01609000
         ALR   @09,@01                                             0421 01610000
         ST    @09,TORCD                                           0421 01611000
*       TORCD->RCDEOF=EOFRCD;       /* WITH END OF FILE INDICATOR    */ 01612000
         MVC   RCDEOF(1,@09),EOFRCD                                0422 01613000
*       CMPRSRC=GTPSPACE;           /* SIGNAL NO SPACE FOR COMPRESS  */ 01614000
         MVC   CMPRSRC(4),@CF00033                                 0423 01615000
*     END;                                                         0424 01616000
*                                                                  0424 01617000
*   /*****************************************************************/ 01618000
*   /*                                                               */ 01619000
*   /* IF A NON-FULL PAGE WAS FOUND THEN SEARCH FOR FIRST PAGE AFTER */ 01620000
*   /* IT CONTAINING RECORDS WHICH CAN BE MOVED TO NON-FULL PAGE     */ 01621000
*   /*                                                               */ 01622000
*   /*****************************************************************/ 01623000
*                                                                  0425 01624000
*   RFY                                                            0425 01625000
*     ONEPAGE BASED(FMPAGPTR);      /*                               */ 01626000
@RC00418 DS    0H                                                  0426 01627000
*   IF CMPRSRC=GTPGOOD              /* IF NON-FULL PAGE FOUND THEN   */ 01628000
*     THEN                                                         0426 01629000
         ICM   @09,15,CMPRSRC                                      0426 01630000
         BNZ   @RF00426                                            0426 01631000
*     DO;                           /* START SEARCH FOR NEXT RECORD  */ 01632000
*       FMPAGPTR=                   /* START WITH NEXT PAGE          */ 01633000
*           TOPAGPTR->NEXTPAG;                                     0428 01634000
         L     @09,NEXTPAG(,TOPAGPTR)                              0428 01635000
         ST    @09,FMPAGPTR                                        0428 01636000
*       FMRCD=ADDR(PAGDATA);        /* START W/FIRST RECORD          */ 01637000
         LA    @02,PAGDATA(,@09)                                   0429 01638000
         ST    @02,FMRCD                                           0429 01639000
*       FROMCNT=CNTINPAG;           /* DETERMINE # OF 'FROM- RECORDS    01640000
*                                      IN CURRENT 'FROM-PAGE'        */ 01641000
         MVC   FROMCNT(2),CNTINPAG(@09)                            0430 01642000
*     END;                                                         0431 01643000
*                                                                  0431 01644000
*   /*****************************************************************/ 01645000
*   /*                                                               */ 01646000
*   /* THIS SEGMENT OF CODE IMPLEMENTS THE COMPRESS OF THE FILE      */ 01647000
*   /*                                                               */ 01648000
*   /*****************************************************************/ 01649000
*                                                                  0432 01650000
*   IF CMPRSRC=GTPGOOD              /* IF COMPRESS CAN CONTINUE      */ 01651000
*     THEN                                                         0432 01652000
@RF00426 ICM   @09,15,CMPRSRC                                      0432 01653000
         BNZ   @RF00432                                            0432 01654000
*     DO WHILE(COMPSTOP=OFF);       /* THEN START ACTUAL COMPRESS    */ 01655000
         B     @DE00433                                            0433 01656000
@DL00433 DS    0H                                                  0434 01657000
*       RFY                                                        0434 01658000
*         ONEPAGE BASED(TOPAGPTR);  /*                               */ 01659000
*       IF TOCNT=MAXENTCT           /* IF 'TO-PAGE FULL              */ 01660000
*         THEN                                                     0435 01661000
         LH    @09,TOCNT                                           0435 01662000
         CH    @09,MAXENTCT                                        0435 01663000
         BNE   @RF00435                                            0435 01664000
*         DO;                       /* THEN                          */ 01665000
*           CNTINPAG=TOCNT;         /* SET UP PAGE RECORD COUNT      */ 01666000
         STH   @09,CNTINPAG(,TOPAGPTR)                             0437 01667000
*           TOPAGPTR=NEXTPAG;       /* GO TO NEXT PAGE IN CHAIN      */ 01668000
         L     TOPAGPTR,NEXTPAG(,TOPAGPTR)                         0438 01669000
*           TORCD=ADDR(PAGDATA);    /* POINT TO FIRST RECORD         */ 01670000
         LA    @09,PAGDATA(,TOPAGPTR)                              0439 01671000
         ST    @09,TORCD                                           0439 01672000
*           TOCNT=ZERO;             /* RE-INIT 'TO-RECORD' COUNT     */ 01673000
         SLR   @09,@09                                             0440 01674000
         STH   @09,TOCNT                                           0440 01675000
*         END;                      /*                               */ 01676000
*       RFY                                                        0442 01677000
*         ONEPAGE BASED(FMPAGPTR);  /*                               */ 01678000
@RF00435 DS    0H                                                  0443 01679000
*       IF FROMCNT=ZERO             /* IF ALL FROM-RECORDS HAVE BEEN    01680000
*                                      MOVED THEN FIND NEXT        0443 01681000
*                                      'FROM-PAGE'                   */ 01682000
*         THEN                                                     0443 01683000
         ICM   @09,3,FROMCNT                                       0443 01684000
         BNZ   @RF00443                                            0443 01685000
*         DO WHILE(FROMCNT=ZERO&    /* WITH A RECORD COUNT           */ 01686000
*               NEXTPAG^=ZERO);     /* GREATER THAN ZERO             */ 01687000
         B     @DE00444                                            0444 01688000
@DL00444 DS    0H                                                  0445 01689000
*           FMPAGPTR=NEXTPAG;       /* WITHIN FILE                   */ 01690000
         L     @09,FMPAGPTR                                        0445 01691000
         L     @09,NEXTPAG(,@09)                                   0445 01692000
         ST    @09,FMPAGPTR                                        0445 01693000
*           FMRCD=ADDR(PAGDATA);    /* INIT FIRST 'FROM-PAGE'        */ 01694000
         LA    @02,PAGDATA(,@09)                                   0446 01695000
         ST    @02,FMRCD                                           0446 01696000
*           FROMCNT=CNTINPAG;       /* TO BE MOVE AND TOTAL          */ 01697000
         MVC   FROMCNT(2),CNTINPAG(@09)                            0447 01698000
*         END;                      /* 'FROM-RECORDS' ON PAGE        */ 01699000
@DE00444 SLR   @09,@09                                             0448 01700000
         CH    @09,FROMCNT                                         0448 01701000
         BNE   @DC00444                                            0448 01702000
         L     @02,FMPAGPTR                                        0448 01703000
         C     @09,NEXTPAG(,@02)                                   0448 01704000
         BNE   @DL00444                                            0448 01705000
@DC00444 DS    0H                                                  0449 01706000
*       IF(FMPAGPTR=RNTLAST&        /* IF MOVING LAST RECORD ON LAST */ 01707000
*           FROMCNT=ZERO)           /* RECORD THEN ALL DONE          */ 01708000
*         THEN                                                     0449 01709000
@RF00443 CLC   FMPAGPTR(4),RNTLAST(RENTPTR)                        0449 01710000
         BNE   @RF00449                                            0449 01711000
         ICM   @09,3,FROMCNT                                       0449 01712000
         BNZ   @RF00449                                            0449 01713000
*         DO;                       /* THEN DO                       */ 01714000
*           TORCD->RCDEOF=EOFRCD;   /* WRITE EOF INTO FILE           */ 01715000
         L     @09,TORCD                                           0451 01716000
         MVC   RCDEOF(1,@09),EOFRCD                                0451 01717000
*           TOPAGPTR->CNTINPAG=TOCNT+ONE;/* UP REC. COUNT            */ 01718000
         LA    @09,1                                               0452 01719000
         AH    @09,TOCNT                                           0452 01720000
         STH   @09,CNTINPAG(,TOPAGPTR)                             0452 01721000
*           COMPSTOP=ON;            /* SIGNAL COMPRESS COMPLETE      */ 01722000
         OI    COMPSTOP,B'00100000'                                0453 01723000
*         END;                      /* END OF EOF PROCESSING         */ 01724000
*       ELSE                                                       0455 01725000
*         DO;                       /* CONTINUE COMPRESS             */ 01726000
         B     @RC00449                                            0455 01727000
@RF00449 DS    0H                                                  0456 01728000
*           TORCD->RECORD(1:GTPRCDLN)=/* MOVE RECORD                 */ 01729000
*               FMRCD->RECORD(1:GTPRCDLN);/*                         */ 01730000
         L     @09,TORCD                                           0456 01731000
         L     @02,@PC00001                                        0456 01732000
         LH    @02,GTPRCDLN(,@02)                                  0456 01733000
         LR    @15,@02                                             0456 01734000
         BCTR  @15,0                                               0456 01735000
         L     @14,FMRCD                                           0456 01736000
         EX    @15,@SM00310                                        0456 01737000
*           TORCD=TORCD+GTPRCDLN;   /* UPDATE TO RECORD PTR          */ 01738000
         ALR   @09,@02                                             0457 01739000
         ST    @09,TORCD                                           0457 01740000
*           FMRCD=FMRCD+GTPRCDLN;   /* UPDATE FROM RECORD PTR        */ 01741000
         ALR   @14,@02                                             0458 01742000
         ST    @14,FMRCD                                           0458 01743000
*           TOCNT=TOCNT+ONE;        /* UP COUNT OF TO PAGE RECS.     */ 01744000
         LH    @09,TOCNT                                           0459 01745000
         LA    @09,1(,@09)                                         0459 01746000
         STH   @09,TOCNT                                           0459 01747000
*           FROMCNT=FROMCNT-ONE;    /* DECREMENT COUNT OF RECS TO  0460 01748000
*                                      MOVE                          */ 01749000
         LH    @09,FROMCNT                                         0460 01750000
         BCTR  @09,0                                               0460 01751000
         STH   @09,FROMCNT                                         0460 01752000
*         END;                      /*                               */ 01753000
*     END;                                                         0462 01754000
@RC00449 DS    0H                                                  0462 01755000
@DE00433 TM    COMPSTOP,B'00100000'                                0462 01756000
         BZ    @DL00433                                            0462 01757000
*   RETURN CODE(CMPRSRC);           /*                               */ 01758000
@RF00432 L     @15,CMPRSRC                                         0463 01759000
         L     @14,12(,@13)                                        0463 01760000
         LM    @00,@12,20(@13)                                     0463 01761000
         BR    @14                                                 0463 01762000
*   END GTACMPRS;                   /*                               */ 01763000
         EJECT                                                          01764000
*                                                                  0465 01765000
*   /*****************************************************************/ 01766000
*   /*                                                               */ 01767000
*   /* THIS PROCEDURE IS CALLED BY THE MAIN LINE OPEN FILE FOR GETN  */ 01768000
*   /* AND GETP PROCESSING                                           */ 01769000
*   /*                                                               */ 01770000
*   /*****************************************************************/ 01771000
*                                                                  0465 01772000
*GTAOPEN:                                                          0465 01773000
*   PROC;                           /*                               */ 01774000
GTAOPEN  STM   @14,@12,12(@13)                                     0465 01775000
*   DECLARE                                                        0466 01776000
*     OPENRC FIXED(8);              /* INTERNAL RETURN CODE          */ 01777000
*   RFY                                                            0467 01778000
*     ONEPAGE BASED(CURPAG);        /*                               */ 01779000
*   OPENRC=GTPGOOD;                 /* INIT RETURN CODE              */ 01780000
         SLR   OPENRC,OPENRC                                       0468 01781000
*   IF GTPFUNCT=GTPOPENN            /* IF OPEN FILE FOR GETN         */ 01782000
*     THEN                                                         0469 01783000
         L     @09,@PC00001                                        0469 01784000
         CLI   GTPFUNCT(@09),1                                     0469 01785000
         BNE   @RF00469                                            0469 01786000
*     DO;                           /* THEN                          */ 01787000
*       RNTCPAGN=RNTFIRST;          /* SET CURRENT GETN PAGE TO FIRST   01788000
*                                      PAGE                          */ 01789000
         L     @02,RNTFIRST(,RENTPTR)                              0471 01790000
         ST    @02,RNTCPAGN(,RENTPTR)                              0471 01791000
*       RFY                                                        0472 01792000
*         ONEPAGE BASED(RNTCPAGN);  /*                               */ 01793000
*       RNTCRCDN=ADDR(PAGDATA);     /* SET CURRENT RECORD PTR TO   0473 01794000
*                                      FIRST RCD             @Z67SP00*/ 01795000
         LA    @02,PAGDATA(,@02)                                   0473 01796000
         ST    @02,RNTCRCDN(,RENTPTR)                              0473 01797000
*       RNTCPOSN=ONE;               /* SET CURRENT POSITION  @Z67SP00*/ 01798000
         MVC   RNTCPOSN(2,RENTPTR),@CH00053                        0474 01799000
*       GTPRESTR=RNTSTATN;          /* RETURN CURRENT RECORD POSITION   01800000
*                                      TO USER                       */ 01801000
         MVC   GTPRESTR(10,@09),RNTSTATN(RENTPTR)                  0475 01802000
*     END;                          /*                               */ 01803000
*   ELSE                                                           0477 01804000
*     DO;                           /* FOR GETP OPN                  */ 01805000
         B     @RC00469                                            0477 01806000
@RF00469 DS    0H                                                  0478 01807000
*       RNTCPAGP=RNTLAST;           /* SET CURRENT GETP PAGE TO LAST    01808000
*                                      PAGE                          */ 01809000
         L     @09,RNTLAST(,RENTPTR)                               0478 01810000
         ST    @09,RNTCPAGP(,RENTPTR)                              0478 01811000
*       RFY                                                        0479 01812000
*         ONEPAGE BASED(RNTCPAGP);  /*                               */ 01813000
*       RNTCRCDP=ADDR(PAGDATA)+     /* SET CURRENT RECORD TO LAST    */ 01814000
*           ((CNTINPAG-1)*GTPRCDLN);/* RECORD-EOF RECORD             */ 01815000
         LA    @02,PAGDATA(,@09)                                   0480 01816000
         LH    @09,CNTINPAG(,@09)                                  0480 01817000
         LR    @01,@09                                             0480 01818000
         BCTR  @01,0                                               0480 01819000
         L     @15,@PC00001                                        0480 01820000
         MH    @01,GTPRCDLN(,@15)                                  0480 01821000
         ALR   @02,@01                                             0480 01822000
         ST    @02,RNTCRCDP(,RENTPTR)                              0480 01823000
*       RNTCPOSP=CNTINPAG;          /* CURRENT POSITION IS LAST    0481 01824000
*                                      RECORD POSITION               */ 01825000
         STH   @09,RNTCPOSP(,RENTPTR)                              0481 01826000
*       GTPRESTR=RNTSTATP;          /* RETURN CURRENT FILE POSITION     01827000
*                                      TO USER                       */ 01828000
         MVC   GTPRESTR(10,@15),RNTSTATP(RENTPTR)                  0482 01829000
*     END;                          /*                               */ 01830000
*   RETURN CODE(OPENRC);            /*                               */ 01831000
@RC00469 LR    @15,OPENRC                                          0484 01832000
         L     @14,12(,@13)                                        0484 01833000
         LM    @00,@12,20(@13)                                     0484 01834000
         BR    @14                                                 0484 01835000
*   END GTAOPEN;                    /*                               */ 01836000
         EJECT                                                          01837000
*                                                                  0486 01838000
*   /*****************************************************************/ 01839000
*   /*                                                               */ 01840000
*   /* THIS PROCEDURE WILL RETURN THE RECORD PREVIOUS TO THE CURRENT */ 01841000
*   /* GETP RECORD. THE CURRENT RECORD POSITION WITHIN THE FILE IS   */ 01842000
*   /* DEFINED BY RNTSTATP IN THE REENTRANT WORK AREA. THIS PROCEDURE*/ 01843000
*   /* WILL MODIFY RNTSTATP IF A RECORD IS FOUND. IF THE RECORD IS   */ 01844000
*   /* NOT FOUND AN END-OF-FILE CONDITION WILL BE RETURNED TO CALLER */ 01845000
*   /*                                                               */ 01846000
*   /*****************************************************************/ 01847000
*                                                                  0486 01848000
*GTAGETP:                                                          0486 01849000
*   PROC;                                                          0486 01850000
GTAGETP  STM   @14,@12,12(@13)                                     0486 01851000
*   DECLARE                                                        0487 01852000
*     GETPRC FIXED(8);              /* INTERNAL RETURN CODE          */ 01853000
*   RFY                                                            0488 01854000
*     ONEPAGE BASED(CURPAG);        /* ADDRESS CURRENT GETP PAGE     */ 01855000
*   GETPRC=GTPGOOD;                 /* INIT RETURN CODE              */ 01856000
         SLR   GETPRC,GETPRC                                       0489 01857000
*   CURSTAT=RNTSTATP;               /* GET CURRENT POSITION OF GETN     01858000
*                                      PROCESSING                    */ 01859000
         MVC   CURSTAT(10),RNTSTATP(RENTPTR)                       0490 01860000
*   IF RCDEOF=EOFRCD                /* IF AT END OF FILE RCD @Z67SP00*/ 01861000
*       |CURPOS<ONE                 /* OR START OF PAGE      @Z67SP00*/ 01862000
*     THEN                          /*                       @Z67SP00*/ 01863000
         L     @09,CURRCD                                          0491 01864000
         CLC   RCDEOF(1,@09),EOFRCD                                0491 01865000
         BE    @RT00491                                            0491 01866000
         ICM   @09,3,CURPOS                                        0491 01867000
         BP    @RF00491                                            0491 01868000
@RT00491 DS    0H                                                  0492 01869000
*     DO;                           /*                       @Z67SP00*/ 01870000
*       CURRCD=CURRCD-GTPRCDLN;     /* BACK UP TO PREV RCD   @Z67SP00*/ 01871000
         L     @09,@PC00001                                        0493 01872000
         L     @02,CURRCD                                          0493 01873000
         SH    @02,GTPRCDLN(,@09)                                  0493 01874000
         ST    @02,CURRCD                                          0493 01875000
*       CURPOS=CURPOS-ONE;          /* AND PREV POSITION     @Z67SP00*/ 01876000
*                                                                  0494 01877000
         LH    @09,CURPOS                                          0494 01878000
         BCTR  @09,0                                               0494 01879000
         STH   @09,CURPOS                                          0494 01880000
*       /*************************************************************/ 01881000
*       /*                                                           */ 01882000
*       /* NOW BACK UP TO NEXT PREV VALID RECORD             @Z67SP00*/ 01883000
*       /*                                                           */ 01884000
*       /*************************************************************/ 01885000
*                                                                  0495 01886000
*       IF CURPOS<ONE               /* IF DONE RCD ON CUR    @Z67SP00*/ 01887000
*         THEN                      /* PAGE                          */ 01888000
         LTR   @09,@09                                             0495 01889000
         BP    @RF00495                                            0495 01890000
*         DO;                       /* THEN FIND PREVIOUS PAGE WITH  */ 01891000
*           IF PREVPAG^=ZERO        /* RECORDS                       */ 01892000
*             THEN                  /*                               */ 01893000
         L     @09,CURPAG                                          0497 01894000
         L     @09,PREVPAG(,@09)                                   0497 01895000
         LTR   @09,@09                                             0497 01896000
         BZ    @RF00497                                            0497 01897000
*             CURPAG=PREVPAG;       /*                               */ 01898000
         ST    @09,CURPAG                                          0498 01899000
*           ELSE                    /*                               */ 01900000
*             GETPRC=GTPEOF;        /* IF FIRST PAGE THEN SIGNAL END    01901000
*                                      OF FILE CONDITION             */ 01902000
         B     @RC00497                                            0499 01903000
@RF00497 LA    GETPRC,4                                            0499 01904000
*           DO WHILE(CNTINPAG=ZERO  /* CONTINUE SEARCH IF NO RECORDS */ 01905000
*                 &PREVPAG^=ZERO    /* NOT END OF FILE AND           */ 01906000
*                 &GETPRC=GTPGOOD); /* EOF NOT ALREADY SIGNALED      */ 01907000
@RC00497 B     @DE00500                                            0500 01908000
@DL00500 DS    0H                                                  0501 01909000
*             CURPAG=PREVPAG;       /* KEEP TRYING TO FIND RECORDS   */ 01910000
         L     @09,CURPAG                                          0501 01911000
         L     @09,PREVPAG(,@09)                                   0501 01912000
         ST    @09,CURPAG                                          0501 01913000
*           END;                                                   0502 01914000
@DE00500 SLR   @09,@09                                             0502 01915000
         L     @02,CURPAG                                          0502 01916000
         CH    @09,CNTINPAG(,@02)                                  0502 01917000
         BNE   @DC00500                                            0502 01918000
         C     @09,PREVPAG(,@02)                                   0502 01919000
         BE    @DC00500                                            0502 01920000
         CR    GETPRC,@09                                          0502 01921000
         BE    @DL00500                                            0502 01922000
@DC00500 DS    0H                                                  0503 01923000
*           IF CNTINPAG=ZERO        /* IF NO PAGES WITH RECORDS FOUND*/ 01924000
*             THEN                                                 0503 01925000
         L     @09,CURPAG                                          0503 01926000
         ICM   @02,3,CNTINPAG(@09)                                 0503 01927000
         BNZ   @RF00503                                            0503 01928000
*             GETPRC=GTPEOF;        /* THEN SIGNAL END OF FILE       */ 01929000
         LA    GETPRC,4                                            0504 01930000
*           ELSE                                                   0505 01931000
*             DO;                   /* PAGE WITH RECORDS FOUND       */ 01932000
         B     @RC00503                                            0505 01933000
@RF00503 DS    0H                                                  0506 01934000
*               CURRCD=ADDR(PAGDATA)+((CNTINPAG-1)*GTPRCDLN);      0506 01935000
         L     @09,CURPAG                                          0506 01936000
         LA    @02,PAGDATA(,@09)                                   0506 01937000
         LH    @09,CNTINPAG(,@09)                                  0506 01938000
         LR    @01,@09                                             0506 01939000
         BCTR  @01,0                                               0506 01940000
         L     @15,@PC00001                                        0506 01941000
         MH    @01,GTPRCDLN(,@15)                                  0506 01942000
         ALR   @02,@01                                             0506 01943000
         ST    @02,CURRCD                                          0506 01944000
*               CURPOS=CNTINPAG;                                   0507 01945000
         STH   @09,CURPOS                                          0507 01946000
*             END;                                                 0508 01947000
*         END;                                                     0509 01948000
@RC00503 DS    0H                                                  0510 01949000
*     END;                          /*                       @Z67SP00*/ 01950000
@RF00495 DS    0H                                                  0511 01951000
*   IF GETPRC=GTPGOOD               /* IF A RECORD WAS FOUND         */ 01952000
*     THEN                                                         0511 01953000
@RF00491 CH    GETPRC,@CH00083                                     0511 01954000
         BNE   @RF00511                                            0511 01955000
*     USRRCD(1:GTPRCDLN)=RECORD(1:GTPRCDLN);/* MOVE RCD TO USER    0512 01956000
*                                      BUFFER                @Z67SP00*/ 01957000
         L     @09,@PC00001                                        0512 01958000
         L     @02,GTPBUFAD(,@09)                                  0512 01959000
         LH    @09,GTPRCDLN(,@09)                                  0512 01960000
         BCTR  @09,0                                               0512 01961000
         L     @01,CURRCD                                          0512 01962000
         EX    @09,@SM00296                                        0512 01963000
*   GTPRESTR=CURSTAT;               /* RETURN CURRENT RECORD POSITION   01964000
*                                      TO USER                       */ 01965000
@RF00511 L     @09,@PC00001                                        0513 01966000
         MVC   GTPRESTR(10,@09),CURSTAT                            0513 01967000
*   CURPOS=CURPOS-ONE;              /* NOW BACK UP PTRS FOR  @Z67SP00*/ 01968000
         LH    @02,CURPOS                                          0514 01969000
         BCTR  @02,0                                               0514 01970000
         STH   @02,CURPOS                                          0514 01971000
*   CURRCD=CURRCD-GTPRCDLN;         /* NEXT GETP REQUEST     @Z67SP00*/ 01972000
         L     @02,CURRCD                                          0515 01973000
         SH    @02,GTPRCDLN(,@09)                                  0515 01974000
         ST    @02,CURRCD                                          0515 01975000
*   RNTSTATP=CURSTAT;               /* UPDATE CURRENT STATUS OF GETP    01976000
*                                      PROCESSING IN REENTRANT AREA  */ 01977000
         MVC   RNTSTATP(10,RENTPTR),CURSTAT                        0516 01978000
*   RETURN CODE(GETPRC);                                           0517 01979000
         LR    @15,GETPRC                                          0517 01980000
         L     @14,12(,@13)                                        0517 01981000
         LM    @00,@12,20(@13)                                     0517 01982000
         BR    @14                                                 0517 01983000
*   END GTAGETP;                                                   0518 01984000
         EJECT                                                          01985000
*                                                                  0519 01986000
*/********************************************************************/ 01987000
*/*                                                                  */ 01988000
*/*      THIS SEGMENT OF CODE WILL RETREIVE THE NEXT GETN RECORD     */ 01989000
*/*      IN THE FILE. THE CURRENT RECORD POSITION IS CONTAINED IN    */ 01990000
*/*      THE REENTRANT WORK AREA. THE OUTPUT FROM THIS SEGMENT IS    */ 01991000
*/*      AS FOLLOWS:                                                 */ 01992000
*/*                1. IF NEXT RECORD IS FOUND THEN                   */ 01993000
*/*                     - ZERO RETURN CODE IS SET                    */ 01994000
*/*                     - CURRENT GETN RECORD POSITION               */ 01995000
*/*                       IS UPDATED IN REENTRANT WORK AREA          */ 01996000
*/*                     - CURRENT GETN RECORD POSITION IS            */ 01997000
*/*                       PASSED BACK TO CALLER                      */ 01998000
*/*                2. IF NEXT RECORD END OF FILE THE END OF          */ 01999000
*/*                   FILE RETURN CODE IS SET                        */ 02000000
*/*                                                                  */ 02001000
*/********************************************************************/ 02002000
*                                                                  0519 02003000
*GTAGETN:                                                          0519 02004000
*   PROC;                                                          0519 02005000
GTAGETN  STM   @14,@12,12(@13)                                     0519 02006000
*   DECLARE                                                        0520 02007000
*     GETNRC FIXED(8);              /* INTERNAL RETURN CODE          */ 02008000
*   RFY                                                            0521 02009000
*     ONEPAGE BASED(CURPAG);        /* USED TO ADDRESS CURRENT GETN     02010000
*                                      PAGE                          */ 02011000
*   GETNRC=GTPGOOD;                 /* INIT TO SUCCESSFUL RETURN CODE*/ 02012000
         SLR   GETNRC,GETNRC                                       0522 02013000
*   CURSTAT=RNTSTATN;               /* SET UP CURRENT GETN RECORD  0523 02014000
*                                      POSITION                      */ 02015000
         MVC   CURSTAT(10),RNTSTATN(RENTPTR)                       0523 02016000
*   IF RCDEOF=EOFRCD                /* IF RECORD RETREIVED IS EOF    */ 02017000
*       |((CURPAG=RNTLAST)          /* IF ON LAST PAGE OF FILE       */ 02018000
*       &(CURPOS>CNTINPAG))         /* AND PAST END OF FILE          */ 02019000
*     THEN                                                         0524 02020000
         L     @09,CURRCD                                          0524 02021000
         CLC   RCDEOF(1,@09),EOFRCD                                0524 02022000
         BE    @RT00524                                            0524 02023000
         L     @09,CURPAG                                          0524 02024000
         C     @09,RNTLAST(,RENTPTR)                               0524 02025000
         BNE   @RF00524                                            0524 02026000
         LH    @02,CURPOS                                          0524 02027000
         CH    @02,CNTINPAG(,@09)                                  0524 02028000
         BNH   @RF00524                                            0524 02029000
@RT00524 DS    0H                                                  0525 02030000
*     GETNRC=GTPEOF;                /* THEN SET EOF RETURN CODE      */ 02031000
         LA    GETNRC,4                                            0525 02032000
*   ELSE                            /* IF NOT THEN EOF INDICATOR     */ 02033000
*     USRRCD(1:GTPRCDLN)=           /* MOVE RECORD IN FILE TO USER   */ 02034000
*         RECORD(1:GTPRCDLN);       /* BUFFER                        */ 02035000
         B     @RC00524                                            0526 02036000
@RF00524 L     @09,@PC00001                                        0526 02037000
         L     @02,GTPBUFAD(,@09)                                  0526 02038000
         LH    @09,GTPRCDLN(,@09)                                  0526 02039000
         BCTR  @09,0                                               0526 02040000
         L     @01,CURRCD                                          0526 02041000
         EX    @09,@SM00296                                        0526 02042000
*   GTPRESTR=CURSTAT;               /* PASS CURRENT GETN RECORD    0527 02043000
*                                      POSITION TO CALLER            */ 02044000
*                                                                  0527 02045000
@RC00524 L     @09,@PC00001                                        0527 02046000
         MVC   GTPRESTR(10,@09),CURSTAT                            0527 02047000
*   /*****************************************************************/ 02048000
*   /*                                                               */ 02049000
*   /* NOW GET TO NEXT RECORD FOR NEXT GETN REQUEST          @Z67SP00*/ 02050000
*   /*                                                               */ 02051000
*   /*****************************************************************/ 02052000
*                                                                  0528 02053000
*   GETNSTOP=OFF;                   /* INIT TO CONTINUE GETN         */ 02054000
         NI    GETNSTOP,B'11101111'                                0528 02055000
*   IF CURPOS>=CNTINPAG THEN        /* IF END OF CURRENT PAGE THEN   */ 02056000
         LH    @09,CURPOS                                          0529 02057000
         L     @02,CURPAG                                          0529 02058000
         CH    @09,CNTINPAG(,@02)                                  0529 02059000
         BL    @RF00529                                            0529 02060000
*     DO WHILE(GETNSTOP=OFF&NEXTPAG^=ZERO);/* FIND NEXT PAGE       0530 02061000
*                                      CONTAINING RECORDS            */ 02062000
         B     @DE00530                                            0530 02063000
@DL00530 DS    0H                                                  0531 02064000
*       CURPAG=NEXTPAG;             /* TRY NEXT PAGE IN FILE         */ 02065000
         L     @09,CURPAG                                          0531 02066000
         L     @09,NEXTPAG(,@09)                                   0531 02067000
         ST    @09,CURPAG                                          0531 02068000
*       IF CNTINPAG>ZERO            /* IF NON-EMPTY PAGE             */ 02069000
*         THEN                                                     0532 02070000
         ICM   @02,3,CNTINPAG(@09)                                 0532 02071000
         BNP   @RF00532                                            0532 02072000
*         DO;                                                      0533 02073000
*           GETNSTOP=ON;            /* FOUND PAGE WITH RECORDS       */ 02074000
         OI    GETNSTOP,B'00010000'                                0534 02075000
*           CURRCD=ADDR(PAGDATA);   /* FIRST RECORD IN PAGE          */ 02076000
         LA    @09,PAGDATA(,@09)                                   0535 02077000
         ST    @09,CURRCD                                          0535 02078000
*           CURPOS=ONE;             /* SET POSIT. OF REC WITHIN PAGE */ 02079000
         MVC   CURPOS(2),@CH00053                                  0536 02080000
*         END;                                                     0537 02081000
*     END;                                                         0538 02082000
@RF00532 DS    0H                                                  0538 02083000
@DE00530 TM    GETNSTOP,B'00010000'                                0538 02084000
         BNZ   @DC00530                                            0538 02085000
         L     @09,CURPAG                                          0538 02086000
         ICM   @02,15,NEXTPAG(@09)                                 0538 02087000
         BNZ   @DL00530                                            0538 02088000
@DC00530 DS    0H                                                  0539 02089000
*   ELSE                                                           0539 02090000
*     DO;                           /* IF OTHER RECORDS ON PAGE      */ 02091000
         B     @RC00529                                            0539 02092000
@RF00529 DS    0H                                                  0540 02093000
*       CURRCD=CURRCD+GTPRCDLN;     /* SET CURRENT RECORD TO NEXT ONE*/ 02094000
         L     @09,@PC00001                                        0540 02095000
         LH    @09,GTPRCDLN(,@09)                                  0540 02096000
         AL    @09,CURRCD                                          0540 02097000
         ST    @09,CURRCD                                          0540 02098000
*       CURPOS=CURPOS+ONE;          /* INCREMENT POSITION OF CURRENT    02099000
*                                      RECORD                        */ 02100000
         LH    @09,CURPOS                                          0541 02101000
         LA    @09,1(,@09)                                         0541 02102000
         STH   @09,CURPOS                                          0541 02103000
*     END;                                                         0542 02104000
*   RNTSTATN=CURSTAT;               /* SAVE NEXT RCD DATA    @Z67SP00*/ 02105000
@RC00529 MVC   RNTSTATN(10,RENTPTR),CURSTAT                        0543 02106000
*   RETURN CODE(GETNRC);                                           0544 02107000
         LR    @15,GETNRC                                          0544 02108000
         L     @14,12(,@13)                                        0544 02109000
         LM    @00,@12,20(@13)                                     0544 02110000
         BR    @14                                                 0544 02111000
*   END GTAGETN;                                                   0545 02112000
         EJECT                                                          02113000
*                                                                  0546 02114000
*   /*****************************************************************/ 02115000
*   /*                                                               */ 02116000
*   /* THIS ROUTINE IS CALLED TO UPDATE THE GETN OR GETP CURRENT     */ 02117000
*   /* RECORD POSITION IN THE REENTRANT WORK AREA WITH RECORD        */ 02118000
*   /* POSITION PASSED BY THE CALLER                                 */ 02119000
*   /*                                                               */ 02120000
*   /*****************************************************************/ 02121000
*                                                                  0546 02122000
*GTASTRT:                                                          0546 02123000
*   PROC;                                                          0546 02124000
GTASTRT  STM   @14,@12,12(@13)                                     0546 02125000
*   DECLARE                                                        0547 02126000
*     STRTRC FIXED(8);              /* INTERNAL RETURN CODE          */ 02127000
*   STRTRC=GTPGOOD;                 /* INIT TO SUCCESSFUL COMPLETION */ 02128000
         SLR   STRTRC,STRTRC                                       0548 02129000
*   IF GTPFUNCT=GTPSTRTN            /* IF GETN AREA AFFECTED         */ 02130000
*     THEN                                                         0549 02131000
         L     @09,@PC00001                                        0549 02132000
         CLI   GTPFUNCT(@09),6                                     0549 02133000
         BNE   @RF00549                                            0549 02134000
*     RNTSTATN=GTPRESTR;            /* THEN UPDATE GETN AREA         */ 02135000
         MVC   RNTSTATN(10,RENTPTR),GTPRESTR(@09)                  0550 02136000
*   ELSE                                                           0551 02137000
*     RNTSTATP=GTPRESTR;            /* OTHERWISE UPDATE GETP AREA    */ 02138000
         B     @RC00549                                            0551 02139000
@RF00549 L     @09,@PC00001                                        0551 02140000
         MVC   RNTSTATP(10,RENTPTR),GTPRESTR(@09)                  0551 02141000
*   RETURN CODE(STRTRC);                                           0552 02142000
@RC00549 LR    @15,STRTRC                                          0552 02143000
         L     @14,12(,@13)                                        0552 02144000
         LM    @00,@12,20(@13)                                     0552 02145000
         BR    @14                                                 0552 02146000
*   END GTASTRT;                                                   0553 02147000
         EJECT                                                          02148000
*                                                                  0554 02149000
*   /*****************************************************************/ 02150000
*   /*                                                               */ 02151000
*   /* THIS ROUTINE IS CALLED TO FREE IN STORAGE FILE. THE FILE AND  */ 02152000
*   /* IT'S ASSOCIATED REENTRANT WORK AREA WILL BE FREED             */ 02153000
*   /*                                                               */ 02154000
*   /*****************************************************************/ 02155000
*                                                                  0554 02156000
*GTAFREE:                                                          0554 02157000
*   PROC;                                                          0554 02158000
GTAFREE  STM   @14,@12,@SA00013                                    0554 02159000
*   DECLARE                                                        0555 02160000
*     FREERC FIXED(8);              /* INTERNAL RETURN CODE          */ 02161000
*   DECLARE                                                        0556 02162000
*     SVNXTPAG PTR(31);             /* SAVE PTR TO NEXT PAGE IN FILE */ 02163000
*   RFY                                                            0557 02164000
*     ONEPAGE BASED(CURPAG);        /* USED TO ADDRESS PAGE IN FILE  */ 02165000
*   FREERC=GTPGOOD;                 /* INIT TO SUCCESSFUL COMPLETION */ 02166000
         MVI   FREERC,X'00'                                        0558 02167000
*   IF GTPWKAD^=ZERO                /* IF A FILE EXISTS      @ZD00003*/ 02168000
*     THEN                          /* THEN FREE IT          @ZD00003*/ 02169000
         L     @09,@PC00001                                        0559 02170000
         ICM   @15,15,GTPWKAD(@09)                                 0559 02171000
         BZ    @RF00559                                            0559 02172000
*     DO;                           /*                       @Z67SP00*/ 02173000
*       CURPAG=RNTFIRST;            /* START WITH FIRST PAGE IN FILE */ 02174000
         L     @09,RNTFIRST(,RENTPTR)                              0561 02175000
         ST    @09,CURPAG                                          0561 02176000
*       SVNXTPAG=NEXTPAG;           /* SAVE POINTER TO NEXT PAGE     */ 02177000
         L     SVNXTPAG,NEXTPAG(,@09)                              0562 02178000
*       RFY                                                        0563 02179000
*         R2 RSTD;                  /* REG 2 CONTAINS LENGTH TO FREE */ 02180000
*       R2=PAGESIZE;                /* SET PAGE SIZE         @Z67SP00*/ 02181000
*                                                                  0564 02182000
         L     R2,PAGESIZE                                         0564 02183000
*       /*************************************************************/ 02184000
*       /*                                                           */ 02185000
*       /* FREE ALL PAGES IN IN STORAGE FILE                         */ 02186000
*       /*                                                           */ 02187000
*       /*************************************************************/ 02188000
*                                                                  0565 02189000
*       DO WHILE(CURPAG^=ZERO);     /* FREE PAGES TILL LAST PAGE     */ 02190000
         B     @DE00565                                            0565 02191000
@DL00565 DS    0H                                                  0566 02192000
*         GEN(FREEMAIN E,LV=(R2),A=CURPAG)                         0566 02193000
*         REFS(R2,CURPAG);                                         0566 02194000
         FREEMAIN E,LV=(R2),A=CURPAG                                    02195000
*         CURPAG=SVNXTPAG;          /* FREE NEXT PAGE                */ 02196000
         ST    SVNXTPAG,CURPAG                                     0567 02197000
*         SVNXTPAG=NEXTPAG;         /* SAVE FOLLOWING PAGE PTR       */ 02198000
         L     @09,CURPAG                                          0568 02199000
         L     SVNXTPAG,NEXTPAG(,@09)                              0568 02200000
*       END;                        /* ALL FILE PAGES FREED          */ 02201000
*                                                                  0569 02202000
@DE00565 ICM   @09,15,CURPAG                                       0569 02203000
         BNZ   @DL00565                                            0569 02204000
*       /*************************************************************/ 02205000
*       /*                                                           */ 02206000
*       /* FREE REENTRANT WORK AREA                                  */ 02207000
*       /*                                                           */ 02208000
*       /*************************************************************/ 02209000
*                                                                  0570 02210000
*       R2=LENGTH(RENTAREA);        /* SET LENGTH TO BE FREED        */ 02211000
         LA    R2,42                                               0570 02212000
*       RENTPTR=ADDR(GTPWKAD);      /* SET PTR TO ADDRESS OF AREA    */ 02213000
         L     RENTPTR,@PC00001                                    0571 02214000
         LA    RENTPTR,GTPWKAD(,RENTPTR)                           0571 02215000
*       GEN(FREEMAIN E,LV=(R2),A=(RENTPTR))                        0572 02216000
*       REFS(R2,RENTPTR);                                          0572 02217000
         FREEMAIN E,LV=(R2),A=(RENTPTR)                                 02218000
*       RFY                                                        0573 02219000
*         R2 UNRSTD;                /* UNRESTRICT REGISTER   @ZA24812*/ 02220000
*     END;                          /* FILE FREED            @ZD00003*/ 02221000
*                                                                  0574 02222000
*   /*****************************************************************/ 02223000
*   /*                                                               */ 02224000
*   /* ZERO OUT CALLERS INPUT PARAMETER                              */ 02225000
*   /*                                                               */ 02226000
*   /*****************************************************************/ 02227000
*                                                                  0575 02228000
*   GTPWKAD=ZERO;                   /* RESET WKAD            @Z67SP00*/ 02229000
@RF00559 L     @09,@PC00001                                        0575 02230000
         SLR   @15,@15                                             0575 02231000
         ST    @15,GTPWKAD(,@09)                                   0575 02232000
*   GTPRESTR=''B;                   /* NO RECOVREY ADDR      @Z67SP00*/ 02233000
         XC    GTPRESTR(10,@09),GTPRESTR(@09)                      0576 02234000
*   RETURN CODE(FREERC);                                           0577 02235000
         SLR   @15,@15                                             0577 02236000
         IC    @15,FREERC                                          0577 02237000
         L     @14,@SA00013                                        0577 02238000
         LM    @00,@12,@SA00013+8                                  0577 02239000
         BR    @14                                                 0577 02240000
*   END GTAFREE;                                                   0578 02241000
*   END HMASMGTA                    /* END READ MODULE               */ 02242000
*                                                                  0579 02243000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 02244000
*/*%INCLUDE SYSLIB  (HMASMGTP)                                       */ 02245000
*/*%INCLUDE SYSLIB  (HMASMMGP)                                       */ 02246000
*                                                                  0579 02247000
*       ;                                                          0579 02248000
@DATA    DS    0H                                                       02249000
@CH00083 DC    H'0'                                                     02250000
@CH00053 DC    H'1'                                                     02251000
@CH00056 DC    H'3'                                                     02252000
@CH00071 DC    H'4'                                                     02253000
@CH00034 DC    H'10'                                                    02254000
@SM00296 MVC   USRRCD(0,@02),RECORD(@01)                                02255000
@SC00298 CLC   RCDKEY(0,@09),USRKEY(@01)                                02256000
@SC00302 CLC   RCDKEY(0,@01),USRKEY(@02)                                02257000
@SC00304 CLC   RCDKEY(0,@14),USRRCD(@15)                                02258000
@SM00306 MVC   RECORD(0,@14),USRRCD(@15)                                02259000
@SM00308 MVC   RECORD(0,@02),RECORD(SAVRCDAD)                           02260000
@SM00310 MVC   RECORD(0,@09),RECORD(@14)                                02261000
@SM00312 MVC   SAVKEY(0),USRKEY(@01)                                    02262000
@SM00314 MVC   USRKEY(0,@01),SAVKEY                                     02263000
@SM00316 MVC   USRRCD(0,@01),RECORD(@15)                                02264000
         DS    0F                                                       02265000
@AL00175 EQU   *                       LIST WITH   1 ARGUMENT(S)        02266000
@AL00391 DC    A(HMASMMGP)             LIST WITH   1 ARGUMENT(S)        02267000
         DS    0F                                                       02268000
@SA00001 DS    18F                                                      02269000
@PC00001 DS    1F                                                       02270000
@SA00003 DS    15F                                                      02271000
@SA00006 DS    15F                                                      02272000
@SA00013 DS    15F                                                      02273000
@SA00007 DS    15F                                                      02274000
@PC00007 DS    1F                                                       02275000
@AL00001 DS    1A                                                       02276000
         DS    0F                                                       02277000
@CF00033 DC    F'12'                                                    02278000
@CH00033 EQU   @CF00033+2                                               02279000
@CF00156 DC    F'512'                                                   02280000
@CF00154 DC    F'1024'                                                  02281000
@CF00152 DC    F'2048'                                                  02282000
@CF00150 DC    F'4096'                                                  02283000
@CV00123 DC    V(HMASMMSG)                                              02284000
         DS    0D                                                       02285000
PAGESIZE DS    F                                                        02286000
ADSAVPAG DC    AL4(SAVPAGE)                                             02287000
INADDR   DS    A                                                        02288000
OUTADDR  DS    A                                                        02289000
CURPGPTR DS    A                                                        02290000
NEWPGPTR DC    A(0)                                                     02291000
CMPRSRC  DS    F                                                        02292000
TORCD    DS    A                                                        02293000
FMPAGPTR DS    A                                                        02294000
FMRCD    DS    A                                                        02295000
MAXENTCT DS    H                                                        02296000
TOCNT    DS    H                                                        02297000
FROMCNT  DS    H                                                        02298000
ADDRC    DS    FL1                                                      02299000
FREERC   DS    FL1                                                      02300000
HMASMMGP DS    CL16                                                     02301000
         ORG   HMASMMGP                                                 02302000
MGPFIXED DS    CL12                                                     02303000
         ORG   MGPFIXED                                                 02304000
MGPCLEAR DS    CL6                                                      02305000
         ORG   MGPCLEAR                                                 02306000
MGPMGNO1 DS    FL2                                                      02307000
MGPMGNO2 DS    FL2                                                      02308000
MGPMGNO3 DS    FL2                                                      02309000
         ORG   MGPFIXED+6                                               02310000
MGPFLAGS DS    BL2                                                      02311000
         ORG   MGPFLAGS                                                 02312000
MGPPRINT DS    BL1                                                      02313000
MGPLIST  EQU   MGPFLAGS+0                                               02314000
MGPRPT   EQU   MGPFLAGS+0                                               02315000
MGPHLDS  EQU   MGPFLAGS+0                                               02316000
MGPWTOR  EQU   MGPFLAGS+0                                               02317000
MGPWTO   EQU   MGPFLAGS+0                                               02318000
MGPWTP   EQU   MGPFLAGS+0                                               02319000
@NM00004 EQU   MGPFLAGS+0                                               02320000
         ORG   MGPFIXED+8                                               02321000
MGPTYPE  DS    FL1                                                      02322000
@NM00005 DS    CL3                                                      02323000
         ORG   HMASMMGP+12                                              02324000
MGPVAR   DS    CL4                                                      02325000
         ORG   MGPVAR                                                   02326000
MGPVARPT DS    1A                                                       02327000
         ORG   HMASMMGP+16                                              02328000
CURSTAT  DS    CL10                                                     02329000
         ORG   CURSTAT                                                  02330000
CURPAG   DS    AL4                                                      02331000
CURRCD   DS    AL4                                                      02332000
CURPOS   DS    FL2                                                      02333000
         ORG   CURSTAT+10                                               02334000
GTASW    DS    BL1                                                      02335000
         ORG   GTASW                                                    02336000
STOP     DS    BL1                                                      02337000
ADDSTOP  EQU   GTASW+0                                                  02338000
CMPRSW   EQU   GTASW+0                                                  02339000
GETNSTOP EQU   GTASW+0                                                  02340000
@NM00006 EQU   GTASW+0                                                  02341000
         ORG   GTASW+1                                                  02342000
         DS    CL1                                                      02343000
PATCHGTA DS    CL80                                                     02344000
         ORG   PATCHGTA                                                 02345000
@NM00007 DC    80X'FF'                                                  02346000
         ORG   PATCHGTA+80                                              02347000
EOFRCD   DC    X'FF'                                                    02348000
SAVKEY   DS    CL255                                                    02349000
SAVBUFFR DS    CL255                                                    02350000
CMPRSSW1 DS    BL1                                                      02351000
         ORG   CMPRSSW1                                                 02352000
TORECFND DS    BL1                                                      02353000
FMRECFND EQU   CMPRSSW1+0                                               02354000
COMPSTOP EQU   CMPRSSW1+0                                               02355000
         ORG   CMPRSSW1+1                                               02356000
HMASMGTA CSECT                                                          02357000
*                                  /*                       @YA20679*/  02358000
SAVPAGE  DS   4096C                                         @YA20679    02359000
HMASMGTA CSECT                                                          02360000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       02361000
@01      EQU   01                                                       02362000
@02      EQU   02                                                       02363000
@03      EQU   03                                                       02364000
@04      EQU   04                                                       02365000
@05      EQU   05                                                       02366000
@06      EQU   06                                                       02367000
@07      EQU   07                                                       02368000
@08      EQU   08                                                       02369000
@09      EQU   09                                                       02370000
@10      EQU   10                                                       02371000
@11      EQU   11                                                       02372000
@12      EQU   12                                                       02373000
@13      EQU   13                                                       02374000
@14      EQU   14                                                       02375000
@15      EQU   15                                                       02376000
SVNXTPAG EQU   @03                                                      02377000
STRTRC   EQU   @03                                                      02378000
GETNRC   EQU   @03                                                      02379000
GETPRC   EQU   @03                                                      02380000
OPENRC   EQU   @03                                                      02381000
TOPAGPTR EQU   @03                                                      02382000
GETPAGRC EQU   @03                                                      02383000
MVCLLEN  EQU   @03                                                      02384000
SAVRCDAD EQU   @03                                                      02385000
SAVADDR  EQU   @03                                                      02386000
DELRC    EQU   @03                                                      02387000
LOCRTNCD EQU   @03                                                      02388000
INITRC   EQU   @03                                                      02389000
VERRTNCD EQU   @03                                                      02390000
GTARTNCD EQU   @03                                                      02391000
R2       EQU   @02                                                      02392000
MVCLTOAD EQU   @04                                                      02393000
MVCLTOLN EQU   @05                                                      02394000
MVCLFMAD EQU   @06                                                      02395000
MVCLFMLN EQU   @07                                                      02396000
RENTPTR  EQU   @08                                                      02397000
CCAPTR   EQU   @11                                                      02398000
RTNCODE  EQU   @15                                                      02399000
ONEPAGE  EQU   0                                                        02400000
PAGEPFX  EQU   ONEPAGE                                                  02401000
NEXTPAG  EQU   PAGEPFX                                                  02402000
PREVPAG  EQU   PAGEPFX+4                                                02403000
CNTINPAG EQU   PAGEPFX+8                                                02404000
PAGDATA  EQU   ONEPAGE+10                                               02405000
RECORD   EQU   0                                                        02406000
RCDKEY   EQU   RECORD                                                   02407000
RCDEOF   EQU   RCDKEY                                                   02408000
USRRCD   EQU   0                                                        02409000
USRKEY   EQU   USRRCD                                                   02410000
RENTAREA EQU   0                                                        02411000
RNTFIRST EQU   RENTAREA                                                 02412000
RNTLAST  EQU   RENTAREA+4                                               02413000
RNTSTAT  EQU   RENTAREA+8                                               02414000
RNTCPAG  EQU   RNTSTAT                                                  02415000
RNTCRCD  EQU   RNTSTAT+4                                                02416000
RNTCPOS  EQU   RNTSTAT+8                                                02417000
RNTSTATN EQU   RENTAREA+20                                              02418000
RNTCPAGN EQU   RNTSTATN                                                 02419000
RNTCRCDN EQU   RNTSTATN+4                                               02420000
RNTCPOSN EQU   RNTSTATN+8                                               02421000
RNTSTATP EQU   RENTAREA+32                                              02422000
RNTCPAGP EQU   RNTSTATP                                                 02423000
RNTCRCDP EQU   RNTSTATP+4                                               02424000
RNTCPOSP EQU   RNTSTATP+8                                               02425000
HMASMGTP EQU   0                                                        02426000
GTPFUNCT EQU   HMASMGTP                                                 02427000
GTPRETRN EQU   HMASMGTP+1                                               02428000
GTPRCDLN EQU   HMASMGTP+4                                               02429000
GTPKEYLN EQU   HMASMGTP+6                                               02430000
GTPWKAD  EQU   HMASMGTP+8                                               02431000
GTPBUFAD EQU   HMASMGTP+12                                              02432000
GTPRESTR EQU   HMASMGTP+16                                              02433000
GTPFLGS1 EQU   HMASMGTP+26                                              02434000
GTPNOSPM EQU   GTPFLGS1                                                 02435000
GTPRCDNF EQU   GTPFLGS1                                                 02436000
GTPPSIZE EQU   GTPFLGS1                                                 02437000
FILEPAGE EQU   0                                                        02438000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    02439000
@NM00003 EQU   HMASMGTP+27                                              02440000
@NM00002 EQU   GTPFLGS1                                                 02441000
GTPPOS   EQU   GTPRESTR+8                                               02442000
GTPRCD   EQU   GTPRESTR+4                                               02443000
GTPPAG   EQU   GTPRESTR                                                 02444000
@NM00001 EQU   HMASMGTP+2                                               02445000
@NM00009 EQU   RENTAREA+30                                              02446000
@NM00008 EQU   RENTAREA+18                                              02447000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      02448000
@RC00228 EQU   @RC00225                                                 02449000
@ENDDATA EQU   *                                                        02450000
         END   HMASMGTA,(C'PLS2025',0802,78334)                         02451000
