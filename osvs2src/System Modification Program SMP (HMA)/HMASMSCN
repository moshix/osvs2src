         TITLE 'HMASMSCN- GENERAL SCAN ROUTINE'                         00001000
HMASMSCN CSECT ,                                                   0001 00002000
@MAINENT DS    0H                                                  0001 00003000
         USING *,@15                                               0001 00004000
         B     @PROLOG                                             0001 00005000
         DC    AL1(16)                                             0001 00006000
         DC    C'HMASMSCN  78.334'                                 0001 00007000
         DROP  @15                                                      00008000
@PROLOG  STM   @14,@12,12(@13)                                     0001 00009000
         BALR  @10,0                                               0001 00010000
@PSTART  DS    0H                                                  0001 00011000
         USING @PSTART,@10                                         0001 00012000
         L     @00,@SIZDATD                                        0001 00013000
         GETMAIN  R,LV=(0)                                              00014000
         LR    @12,@01                                             0001 00015000
         USING @DATD,@12                                           0001 00016000
         ST    @13,@SA00001+4                                      0001 00017000
         LM    @00,@01,20(@13)                                     0001 00018000
         ST    @12,8(,@13)                                         0001 00019000
         LR    @13,@12                                             0001 00020000
         MVC   @PC00001(4),0(@01)                                  0001 00021000
*   SCPWKAR=ADDR(REGSAV);           /* PTR TO WORK AREA              */ 00022000
         L     @11,@PC00001                                        0043 00023000
         LA    @02,REGSAV                                          0043 00024000
         ST    @02,SCPWKAR(,@11)                                   0043 00025000
*   SWITCHES=ZERO;                  /* ZERO SWITCHES                 */ 00026000
         MVI   SWITCHES,X'00'                                      0044 00027000
*   SCTBLPTR=SCPSRCH;               /* PTR TO SEARCH ARGUMENT        */ 00028000
         L     SCTBLPTR,SCPSRCH(,@11)                              0045 00029000
*   EORPTR=SCPCHAR+SCPINLN;         /* CALC PTR TO EOR               */ 00030000
         LH    EORPTR,SCPINLN(,@11)                                0046 00031000
         AL    EORPTR,SCPCHAR(,@11)                                0046 00032000
*   ADIOPRM=SCPIOPAD;               /* SET I/O EXIT PARM     @Z67SP00*/ 00033000
         MVC   ADIOPRM(4),SCPIOPAD(@11)                            0047 00034000
*   ADSCP=ADDR(HMASMSCP);           /* SET PTR BACK TO SCP   @Z67SP00*/ 00035000
*                                                                  0048 00036000
         ST    @11,ADSCP                                           0048 00037000
*   /*****************************************************************/ 00038000
*   /*                                                               */ 00039000
*   /* ADJUST PTR TO INPUT STRING                                    */ 00040000
*   /*                                                               */ 00041000
*   /*****************************************************************/ 00042000
*                                                                  0049 00043000
*SCAN1:                                                            0049 00044000
*   SCANREG=SCPCHAR;                /* SET SCAN PTR                  */ 00045000
*                                                                  0049 00046000
SCAN1    L     @11,@PC00001                                        0049 00047000
         L     SCANREG,SCPCHAR(,@11)                               0049 00048000
*   /*****************************************************************/ 00049000
*   /*                                                               */ 00050000
*   /* CHECK FOR ENF OF RECORD CONDITION                             */ 00051000
*   /*                                                               */ 00052000
*   /*****************************************************************/ 00053000
*                                                                  0050 00054000
*SCAN4:                                                            0050 00055000
*   IF SCANREG=EORPTR               /* IF END OF RECORD      @Z67SP00*/ 00056000
*     THEN                          /* THEN CHECK TO SEE IF  @Z67SP00*/ 00057000
SCAN4    CR    SCANREG,EORPTR                                      0050 00058000
         BNE   @RF00050                                            0050 00059000
*     DO;                           /* NEXT RCD REQUIRED     @Z67SP00*/ 00060000
*       IF INCOMENT=OFF             /* IF NOT COMMENT        @Z67SP00*/ 00061000
*           &DSCCONT=OFF            /* AND CONT CHAR PRESENT @Z67SP00*/ 00062000
*         THEN                      /* YES - GO TO END IF COMMENT    */ 00063000
         TM    INCOMENT,B'10000000'                                0052 00064000
         BNZ   @RF00052                                            0052 00065000
         TM    DSCCONT(SCTBLPTR),B'00010000'                       0052 00066000
         BNZ   @RF00052                                            0052 00067000
*         DO;                       /* CHECK FOR CONT        @Z67SP00*/ 00068000
*           IF(SCPCONT=ON           /* CHECK FOR CONTINUATION        */ 00069000
*               &STRING(1)=BLANK)   /* AND NO CONT CHAR      @Z67SP00*/ 00070000
*               |                   /* OR                    @Z67SP00*/ 00071000
*               SCPNOCT=OFF         /* IF NO CONT EVER       @Z67SP00*/ 00072000
*             THEN                  /* THEN                  @Z67SP00*/ 00073000
         L     @11,@PC00001                                        0054 00074000
         TM    SCPCONT(@11),B'10000000'                            0054 00075000
         BNO   @GL00002                                            0054 00076000
         CLI   STRING(SCANREG),C' '                                0054 00077000
         BE    @RT00054                                            0054 00078000
@GL00002 L     @11,@PC00001                                        0054 00079000
         TM    SCPNOCT(@11),B'01000000'                            0054 00080000
         BZ    @RT00054                                            0054 00081000
*             GO TO GOOD;           /* STOP SCAN WITH RC=0   @Z67SP00*/ 00082000
*         END;                      /* END CONT CHECK        @Z67SP00*/ 00083000
*                                                                  0056 00084000
*       /*************************************************************/ 00085000
*       /*                                                           */ 00086000
*       /* READ NEXT RECORD TO SCAN                          @Z67SP00*/ 00087000
*       /*                                                           */ 00088000
*       /*************************************************************/ 00089000
*                                                                  0057 00090000
*       IF SCPIORTN=0               /* IF NO IO EXIT         @Z67SP00*/ 00091000
*         THEN                      /* THEN NO CONTINUED             */ 00092000
@RF00052 L     @11,@PC00001                                        0057 00093000
         L     @11,SCPIORTN(,@11)                                  0057 00094000
         LTR   @11,@11                                             0057 00095000
         BZ    @RT00057                                            0057 00096000
*         GO TO GOOD;               /* CARDS                         */ 00097000
*       EXITADDR=SCPIORTN;          /* ADDR OF USER I/O RTN          */ 00098000
         LR    EXITADDR,@11                                        0059 00099000
*       CALL EXIT;                  /* CALL IO ROUTINE               */ 00100000
         BAL   @14,EXIT                                            0060 00101000
*       GO TO SCAN1;                /* CONTINUE SCANNING             */ 00102000
         B     SCAN1                                               0061 00103000
*     END;                          /* END END OF RCD GROUP  @Z67SP00*/ 00104000
*                                                                  0062 00105000
*   /*****************************************************************/ 00106000
*   /*                                                               */ 00107000
*   /* CHECK FOR COMMENT START AND END                       @Z67SP00*/ 00108000
*   /*                                                               */ 00109000
*   /*****************************************************************/ 00110000
*                                                                  0063 00111000
*   IF INCOMENT=ON                  /* ARE WE IN A COMMENT FIELD?    */ 00112000
*     THEN                          /* YES - CHECK FOR END OF COMNT  */ 00113000
@RF00050 TM    INCOMENT,B'10000000'                                0063 00114000
         BNO   @RF00063                                            0063 00115000
*     IF STRING(1:2)=ASTSLASH       /* END OF COMMENT?               */ 00116000
*       THEN                        /* YES - INDICATE DONE           */ 00117000
         CLC   STRING(2,SCANREG),@CC00138                          0064 00118000
         BNE   @RF00064                                            0064 00119000
*       DO;                         /*                               */ 00120000
*         INCOMENT=OFF;             /* NO MORE COMMENT               */ 00121000
         NI    INCOMENT,B'01111111'                                0066 00122000
*         SCANREG=SCANREG+2;        /* BUMP PAST ASTERIK SLASH       */ 00123000
         LA    SCANREG,2(,SCANREG)                                 0067 00124000
*         GO TO SCAN4;              /* CONTINUE SCANNING             */ 00125000
         B     SCAN4                                               0068 00126000
*       END;                        /*                               */ 00127000
*     ELSE                          /* OTHERWISE - BUMP TILL ASTSLASH*/ 00128000
*       DO;                         /*                       @Z67SP00*/ 00129000
@RF00064 DS    0H                                                  0071 00130000
*         SCANREG=SCANREG+1;        /* BUMP TO NEXT CHAR     @Z67SP00*/ 00131000
         LA    SCANREG,1(,SCANREG)                                 0071 00132000
*         GO TO SCAN4;              /* CONTINUE SCAN         @Z67SP00*/ 00133000
         B     SCAN4                                               0072 00134000
*       END;                        /* END NOT COMMENT END   @Z67SP00*/ 00135000
*   IF SCPCOMNT=ON                  /* SHOULD CHECK FOR COMMENTS?    */ 00136000
*     THEN                          /* YES - CHECK FOR COMMENT       */ 00137000
@RF00063 L     @11,@PC00001                                        0074 00138000
         TM    SCPCOMNT(@11),B'00100000'                           0074 00139000
         BNO   @RF00074                                            0074 00140000
*     IF STRING(1:2)=SLASHAST       /* IS THIS SLASH ASTERISK?       */ 00141000
*       THEN                        /* YES - INDICATE COMMENT        */ 00142000
         CLC   STRING(2,SCANREG),@CC00136                          0075 00143000
         BNE   @RF00075                                            0075 00144000
*       DO;                                                        0076 00145000
*         INCOMENT=ON;              /* INDICATE LOOKING AT COMMENT   */ 00146000
         OI    INCOMENT,B'10000000'                                0077 00147000
*         SCANREG=SCANREG+2;        /* BUMP PAST IT                  */ 00148000
         LA    SCANREG,2(,SCANREG)                                 0078 00149000
*         GO TO SCAN4;              /* CONTINUE                      */ 00150000
         B     SCAN4                                               0079 00151000
*       END;                                                       0080 00152000
*                                                                  0080 00153000
*   /*****************************************************************/ 00154000
*   /*                                                               */ 00155000
*   /* CHECK FOR COMMA AND BLANK SIGNIFICANCE                @Z67SP00*/ 00156000
*   /*                                                               */ 00157000
*   /*****************************************************************/ 00158000
*                                                                  0081 00159000
*   IF(DSCCOMMA=OFF&STRING(1)=COMMA)/* IF COMMA AND COMMA NOT TO BE     00160000
*                                      SCANNED               @Z67SP00*/ 00161000
*       |(DSCBLANK=OFF&STRING(1)=BLANK)/* IF BLANK AND BLANK NOT TO     00162000
*                                      BE SCANNED            @Z67SP00*/ 00163000
*     THEN                          /* NO - THEN SKIP PAST IF THIS   */ 00164000
@RF00075 DS    0H                                                  0081 00165000
@RF00074 TM    DSCCOMMA(SCTBLPTR),B'00001000'                      0081 00166000
         BNZ   @GL00004                                            0081 00167000
         CLI   STRING(SCANREG),C','                                0081 00168000
         BE    @RT00081                                            0081 00169000
@GL00004 TM    DSCBLANK(SCTBLPTR),B'00100000'                      0081 00170000
         BNZ   @RF00081                                            0081 00171000
         CLI   STRING(SCANREG),C' '                                0081 00172000
         BNE   @RF00081                                            0081 00173000
@RT00081 DS    0H                                                  0082 00174000
*     DO;                           /*                       @Z67SP00*/ 00175000
*       SCANREG=SCANREG+1;          /* MOVE TO NEXT CHARACTER        */ 00176000
         LA    SCANREG,1(,SCANREG)                                 0083 00177000
*       GO TO SCAN4;                /* CONTINUE SCAN                 */ 00178000
         B     SCAN4                                               0084 00179000
*     END;                          /*                       @Z67SP00*/ 00180000
*                                                                  0085 00181000
*   /*****************************************************************/ 00182000
*   /*                                                               */ 00183000
*   /* STRING FOUND. SET PTR TO IT AND CHECK DSCAN KEYS      @Z67SP00*/ 00184000
*   /*                                                               */ 00185000
*   /*****************************************************************/ 00186000
*                                                                  0086 00187000
*   SCPCHAR=SCANREG;                /* UPDATE SCAN PTR               */ 00188000
@RF00081 L     @11,@PC00001                                        0086 00189000
         ST    SCANREG,SCPCHAR(,@11)                               0086 00190000
*SCAN5:                                                            0087 00191000
*   IF DSCKEYLN=0                   /* IF PARM ENTRY, CONTIN @Z67SP00*/ 00192000
*     THEN                          /* SCAN                          */ 00193000
SCAN5    CLI   DSCKEYLN(SCTBLPTR),0                                0087 00194000
         BE    @RT00087                                            0087 00195000
*     GO TO SCAN8;                                                 0088 00196000
*   IF STRING(1:DSCKEYLN)=DSCKEY(1:DSCKEYLN)/* MATCH?        @Z67SP00*/ 00197000
*     THEN                                                         0089 00198000
         SLR   @11,@11                                             0089 00199000
         IC    @11,DSCKEYLN(,SCTBLPTR)                             0089 00200000
         BCTR  @11,0                                               0089 00201000
         EX    @11,@SC00183                                        0089 00202000
         BE    @RT00089                                            0089 00203000
*     GO TO SCAN6;                                                 0090 00204000
*   IF DSCALTAD=0                   /* IF ALT KEYWORD        @Z67SP00*/ 00205000
*     THEN                          /* TRY IT. OTHERWISE, SYNTAX     */ 00206000
         L     @11,DSCALTAD(,SCTBLPTR)                             0091 00207000
         LTR   @11,@11                                             0091 00208000
         BZ    @RT00091                                            0091 00209000
*     GO TO BAD;                    /* ERROR                         */ 00210000
*   SCTBLPTR=DSCALTAD;              /* UPDATE SCAN PTR       @Z67SP00*/ 00211000
         LR    SCTBLPTR,@11                                        0093 00212000
*   GO TO SCAN5;                                                   0094 00213000
         B     SCAN5                                               0094 00214000
*                                                                  0095 00215000
*   /*****************************************************************/ 00216000
*   /*                                                               */ 00217000
*   /* MATCH WITH INPUT FOUND - USER ROUTINE OR CONTINUE             */ 00218000
*   /*                                                               */ 00219000
*   /*****************************************************************/ 00220000
*                                                                  0095 00221000
*SCAN6:                             /*                               */ 00222000
*   LENGTH=DSCKEYLN;                /* LENGTH TO BUMP PTR    @Z67SP00*/ 00223000
SCAN6    SLR   LENGTH,LENGTH                                       0095 00224000
         IC    LENGTH,DSCKEYLN(,SCTBLPTR)                          0095 00225000
*   IF DSCRTAD^=0                   /* IF USER RTN PRESENT   @Z67SP00*/ 00226000
*       &(SCPNORT=OFF               /* AND OK TO CALL IT     @Z67SP00*/ 00227000
*       |DSCCALRT=ON)               /*                       @Z67SP00*/ 00228000
*     THEN                          /* CALL IT               @Z67SP00*/ 00229000
         ICM   @11,15,DSCRTAD(SCTBLPTR)                            0096 00230000
         BZ    @RF00096                                            0096 00231000
         L     @11,@PC00001                                        0096 00232000
         TM    SCPNORT(@11),B'00000100'                            0096 00233000
         BZ    @RT00096                                            0096 00234000
         TM    DSCCALRT(SCTBLPTR),B'00000010'                      0096 00235000
         BNO   @RF00096                                            0096 00236000
@RT00096 DS    0H                                                  0097 00237000
*     DO;                           /*                               */ 00238000
*       SCPPMLN=DSCKEYLN;           /* SET LENGTH FOR ROUT   @Z67SP00*/ 00239000
         L     @11,@PC00001                                        0098 00240000
         SLR   @02,@02                                             0098 00241000
         IC    @02,DSCKEYLN(,SCTBLPTR)                             0098 00242000
         STH   @02,SCPPMLN(,@11)                                   0098 00243000
*       EXITADDR=DSCRTAD;           /* SET ROUTINE ADDRESS   @Z67SP00*/ 00244000
         L     EXITADDR,DSCRTAD(,SCTBLPTR)                         0099 00245000
*       CALL EXIT;                  /* GO TO USER EXIT               */ 00246000
         BAL   @14,EXIT                                            0100 00247000
*       LENGTH=SCPPMLN;             /* SET LENGTH IN CASE UPDATED    */ 00248000
         L     @11,@PC00001                                        0101 00249000
         LH    LENGTH,SCPPMLN(,@11)                                0101 00250000
*     END;                                                         0102 00251000
*SCAN7:                                                            0103 00252000
*   SCANREG=SCPCHAR;                /* GET SCAN PTR                  */ 00253000
@RF00096 DS    0H                                                  0103 00254000
SCAN7    L     @11,@PC00001                                        0103 00255000
         L     SCANREG,SCPCHAR(,@11)                               0103 00256000
*   SCANREG=SCANREG+LENGTH;         /* INCREMENT PAST KEY            */ 00257000
         ALR   SCANREG,LENGTH                                      0104 00258000
*   SCPCHAR=SCANREG;                /* RESET PTR                     */ 00259000
         ST    SCANREG,SCPCHAR(,@11)                               0105 00260000
*   IF DSCSUCAD=0                   /* IF NO SUCCESSOR       @Z67SP00*/ 00261000
*     THEN                          /* END OF SCAN                   */ 00262000
         L     @02,DSCSUCAD(,SCTBLPTR)                             0106 00263000
         LTR   @02,@02                                             0106 00264000
         BZ    @RT00106                                            0106 00265000
*     GO TO GOOD;                                                  0107 00266000
*   IF SCPNOSUC=OFF                 /* IF OK TO GO TO SUCC   @Z67SP00*/ 00267000
*     THEN                          /*                       @Z67SP00*/ 00268000
         TM    SCPNOSUC(@11),B'00001000'                           0108 00269000
         BNZ   @RF00108                                            0108 00270000
*     SCTBLPTR=DSCSUCAD;            /* UPDATE SCAN PTR       @Z67SP00*/ 00271000
         LR    SCTBLPTR,@02                                        0109 00272000
*   ELSE                            /* IF USER INDICATED GO  @Z67SP00*/ 00273000
*     DO;                           /* TO ALT INSTEAD        @Z67SP00*/ 00274000
         B     @RC00108                                            0110 00275000
@RF00108 DS    0H                                                  0111 00276000
*       SCPNOSUC=OFF;               /* RESET SW              @Z67SP00*/ 00277000
         L     @11,@PC00001                                        0111 00278000
         NI    SCPNOSUC(@11),B'11110111'                           0111 00279000
*       SCTBLPTR=DSCALTAD;          /* SET ALT DSCAN ADDR    @Z67SP00*/ 00280000
         L     SCTBLPTR,DSCALTAD(,SCTBLPTR)                        0112 00281000
*     END;                          /*                       @Z67SP00*/ 00282000
*   GO TO SCAN1;                    /* ELSE, SCAN NEXT KEY OR PARM   */ 00283000
         B     SCAN1                                               0114 00284000
*                                                                  0115 00285000
*   /*****************************************************************/ 00286000
*   /*                                                               */ 00287000
*   /* IF DSCAN WAS REQUEST FOR VARIABLE LENGTH CHARACTER STRING SET */ 00288000
*   /* TO DO A TRT. MUST SET THE TRT TABLE TO RELECT THE TYPE OF DATA*/ 00289000
*   /* REQUESTED(HEX,ALPABETIC,ALPHA-NUMERIC OR HEX. THEN SET ADDRESS*/ 00290000
*   /* OF AREA TO SCAN AND MAXIMUM LENGTH FOR TRT. THEN DO TRT.      */ 00291000
*   /*                                                       @Z40SP00*/ 00292000
*   /*                                                               */ 00293000
*   /*****************************************************************/ 00294000
*                                                                  0115 00295000
*SCAN8:                                                            0115 00296000
*   TRTTBL=BLANK;                   /* INIT TRT TBL TO STOP ALL CHAR    00297000
*                                      THEN RESET TO ALLOW SPECIFIED    00298000
*                                      CHAR THRU             @Z40SP00*/ 00299000
SCAN8    MVI   TRTTBL+1,C' '                                       0115 00300000
         MVC   TRTTBL+2(254),TRTTBL+1                              0115 00301000
         MVI   TRTTBL,C' '                                         0115 00302000
*   IF DSCHEX=ON                    /* CHECK FOR HEX DATA?   @Z67SP00*/ 00303000
*     THEN                          /* YES                   @XA05941*/ 00304000
         TM    DSCHEX(SCTBLPTR),B'00000100'                        0116 00305000
         BNO   @RF00116                                            0116 00306000
*     DO;                           /*                       @XA05941*/ 00307000
*       HEX1=ZEROS;                 /* SET HEX FOR TRT       @XA05941*/ 00308000
         MVC   HEX1(6),ZEROS                                       0118 00309000
*       HEX2=ZEROS;                 /* SET HEX FOR TRT       @XA05941*/ 00310000
         MVC   HEX2(10),ZEROS                                      0119 00311000
*     END;                          /* END HEX ON GROUP      @XA05941*/ 00312000
*   IF DSCALPHA=ON                  /* CHECK FOR ALPHA?      @Z67SP00*/ 00313000
*     THEN                          /* YES                   @Z40SP00*/ 00314000
@RF00116 TM    DSCALPHA(SCTBLPTR),B'10000000'                      0121 00315000
         BNO   @RF00121                                            0121 00316000
*     DO;                           /* SET ALPHA FOR TRT     @Z40SP00*/ 00317000
*       ALPHA1=ZEROS;               /* SET ALPHA FOR TRT             */ 00318000
         MVC   ALPHA1(1),ZEROS                                     0123 00319000
*       ALPHA2=ZEROS;                                              0124 00320000
         MVC   ALPHA2(2),ZEROS                                     0124 00321000
*       ALPHA3=ZEROS;                                              0125 00322000
         MVC   ALPHA3(10),ZEROS                                    0125 00323000
*       ALPHA4=ZEROS;                                              0126 00324000
         MVC   ALPHA4(9),ZEROS                                     0126 00325000
*       ALPHA5=ZEROS;                                              0127 00326000
         MVC   ALPHA5(8),ZEROS                                     0127 00327000
*     END;                          /* END ALPHA SET         @Z40SP00*/ 00328000
*   IF DSCNUMER=ON                  /* CHECK FOR NUMERICS?   @Z67SP00*/ 00329000
*     THEN                          /* YES                   @Z40SP00*/ 00330000
@RF00121 TM    DSCNUMER(SCTBLPTR),B'01000000'                      0129 00331000
         BNO   @RF00129                                            0129 00332000
*     NUM=ZEROS;                    /* SET NUMERIC TRT GROUP @Z40SP00*/ 00333000
         MVC   NUM(10),ZEROS                                       0130 00334000
*   R1=EORPTR;                      /* ASSUME SCAN WILL GO TILL END     00335000
*                                                            @Z40SP00*/ 00336000
@RF00129 LR    R1,EORPTR                                           0131 00337000
*   LENREG=EORPTR-SCANREG-1;        /* CALCULATE LENGTH TO SCAN      */ 00338000
         LR    LENREG,EORPTR                                       0132 00339000
         SLR   LENREG,SCANREG                                      0132 00340000
         BCTR  LENREG,0                                            0132 00341000
*   IF LENREG>TRTMAX                /* IF TRT LENGTH EXCEEDED      0133 00342000
*                                                            @Z40SP00*/ 00343000
*     THEN                          /* THEN MUST LIMIT LENGTH      0133 00344000
*                                                            @Z4SP000*/ 00345000
         LA    @11,255                                             0133 00346000
         CR    LENREG,@11                                          0133 00347000
         BNH   @RF00133                                            0133 00348000
*     LENREG=TRTMAX;                /* TO TRT MAX LENGTH     @Z40SP00*/ 00349000
         LR    LENREG,@11                                          0134 00350000
*   GENERATE CODE;                                                 0135 00351000
@RF00133 DS    0H                                                  0135 00352000
         EX    LENREG,TEST             TRANSLATE AND TEST               00353000
*                                                                  0136 00354000
*   /*****************************************************************/ 00355000
*   /*                                                               */ 00356000
*   /* TRT COMPLETED, RE-INITIALIZE THE TRT TABLE, THEN CHECK THE    */ 00357000
*   /* LENGTH OF STRING FOUND AND CHECK TO SEE IF TRT STOPPED AT MAX */ 00358000
*   /* LENGTH OR 0 LENGTH OR IN BETWEEN. IF LENGTH ACCEPTABLE PUT IT */ 00359000
*   /* IT SCP PASSBACK LENGTH FIELD AND CALL USER EXIT ROUTINE IF ONE*/ 00360000
*   /* WAS SPEFIFIED. RESET INTERNAL LENGTH AFTER CALL TO ROUT IN    */ 00361000
*   /* CASE USER EXIT CHANGED PASSBACK LENGTH                @Z40SP00*/ 00362000
*   /*                                                               */ 00363000
*   /*****************************************************************/ 00364000
*                                                                  0136 00365000
*   LENGTH=R1-SCANREG;              /* CALC LEN OF STRING FOUND. R1     00366000
*                                      POINTS TO EITHER END OF RCD OR   00367000
*                                      CHAR THAT STOPPED SCN @Z40SP00*/ 00368000
         LR    LENGTH,R1                                           0136 00369000
         SLR   LENGTH,SCANREG                                      0136 00370000
*   IF LENGTH<DSCMINLN              /* IF LENGTH FROM SCAN IS LESS 0137 00371000
*                                      THAN MINIMUM LENGTH   @Z67SP00*/ 00372000
*       |LENGTH>DSCMAXLN            /* OR LENGTH GREATER THAN THE  0137 00373000
*                                      MAXIMUM               @Z67SP00*/ 00374000
*     THEN                          /*                       @Z40SP00*/ 00375000
         SLR   @11,@11                                             0137 00376000
         IC    @11,DSCMINLN(,SCTBLPTR)                             0137 00377000
         CR    LENGTH,@11                                          0137 00378000
         BL    @RT00137                                            0137 00379000
         SLR   @11,@11                                             0137 00380000
         IC    @11,DSCMAXLN(,SCTBLPTR)                             0137 00381000
         CR    LENGTH,@11                                          0137 00382000
         BH    @RT00137                                            0137 00383000
*     GO TO BAD;                    /*                       @Z40SP00*/ 00384000
*   SCPPMLN=LENGTH;                 /* SAVE IN PASSBACK LENGTH       */ 00385000
         L     @11,@PC00001                                        0139 00386000
         STH   LENGTH,SCPPMLN(,@11)                                0139 00387000
*   IF DSCRTAD^=0                   /* IF USER SPECIFIED EXIT ROUTINE   00388000
*                                                            @Z67SP00*/ 00389000
*       &(SCPNORT=OFF               /* AND OK TO CALL ROUT   @Z67SP00*/ 00390000
*       |DSCCALRT=ON)               /*                       @Z67SP00*/ 00391000
*     THEN                          /* THEN CALL IT                  */ 00392000
         ICM   @02,15,DSCRTAD(SCTBLPTR)                            0140 00393000
         BZ    @RF00140                                            0140 00394000
         TM    SCPNORT(@11),B'00000100'                            0140 00395000
         BZ    @RT00140                                            0140 00396000
         TM    DSCCALRT(SCTBLPTR),B'00000010'                      0140 00397000
         BNO   @RF00140                                            0140 00398000
@RT00140 DS    0H                                                  0141 00399000
*     DO;                           /*                       @Z40SP00*/ 00400000
*       EXITADDR=DSCRTAD;           /* SET ADD OF EXIT       @Z67SP00*/ 00401000
         L     EXITADDR,DSCRTAD(,SCTBLPTR)                         0142 00402000
*       CALL EXIT;                  /* CALL GENERAL EXIT PROC        */ 00403000
         BAL   @14,EXIT                                            0143 00404000
*     END;                          /*                       @Z40SP00*/ 00405000
*   LENGTH=SCPPMLN;                 /* LENGTH TO BUMP SCAN PTR       */ 00406000
@RF00140 L     @11,@PC00001                                        0145 00407000
         LH    LENGTH,SCPPMLN(,@11)                                0145 00408000
*   GO TO SCAN7;                    /* CONTINUE SCAN                 */ 00409000
         B     SCAN7                                               0146 00410000
*                                                                  0147 00411000
*   /*****************************************************************/ 00412000
*   /*                                                               */ 00413000
*   /* INTERFACE WITH USER ROUTINES                                  */ 00414000
*   /*                                                               */ 00415000
*   /*****************************************************************/ 00416000
*                                                                  0147 00417000
*EXIT:                                                             0147 00418000
*   PROCEDURE OPTIONS(NOSAVE);      /* USER RTN INTERFACE            */ 00419000
EXIT     DS    0H                                                  0148 00420000
*   SCPRET=SCPGOOD;                 /* INIT RETURN CODE      @Z67SP00*/ 00421000
         L     @11,@PC00001                                        0148 00422000
         MVI   SCPRET(@11),X'00'                                   0148 00423000
*   R15=EXITADDR;                                                  0149 00424000
         LR    R15,EXITADDR                                        0149 00425000
*   GENERATE CODE;                                                 0150 00426000
D4       EQU   4                       FOUR                             00427000
D20      EQU   20                      TWENTY                           00428000
D24      EQU   24                      TWENTYFOUR                       00429000
D28      EQU   28                      TWENTYEIGHT                      00430000
         STM   R0,R15,REGSAV           SAVE REGS                        00431000
         L     R2,D4(R13)              PTR TO USER SAVE REA  @Z67SP00   00432000
         LA    R1,EXITPARM             ADDR OF EXIT PARM     @Z67SP00   00433000
         L     R0,D20(R2)              LOAD CALLER R0        @Z67SP00   00434000
         LM    R2,R12,D28(R2)          LOAD CALLER R2-R12    @Z67SP00   00435000
*   CALL USER;                      /* GO TO USER RTN                */ 00436000
         BALR  @14,@15                                             0151 00437000
*   GENERATE CODE;                                                 0152 00438000
         L     R14,D4(R13)             GET PTR TO PREV SAVE AREA        00439000
         STM   R0,R12,D20(R14)         SAVE REGS IN CASE UPDATED        00440000
         L     R1,D4(R1)               LOAD ADDR OF SCP      @Z67SP00   00441000
         ST    R1,D24(R14)             SAVE ORIGINAL R1      @Z67SP00   00442000
         L     R1,SCPWKAR(R1)          LOAD ADDR OF SAVE AREA           00443000
         LM    R0,R15,0(R1)            RESTORE REGS                     00444000
*   IF SCPRET=SCPGOOD               /* IF GOOD RETURN        @Z40SP00*/ 00445000
*     THEN                          /* THEN RTN TO CALLER    @Z40SP00*/ 00446000
         L     @11,@PC00001                                        0153 00447000
         CLI   SCPRET(@11),0                                       0153 00448000
         BE    @RT00153                                            0153 00449000
*     RETURN;                       /* IN SCAN MODULE        @Z40SP00*/ 00450000
*   IF SCPRET=SCPNDSCN              /* WAS RTN CODE TO STOP SCAN AND    00451000
*                                      RTN WITH GOOD RTN CODE?     0155 00452000
*                                                            @Z40SP00*/ 00453000
*     THEN                          /* YES                   @Z40SP00*/ 00454000
         CLI   SCPRET(@11),4                                       0155 00455000
         BNE   @RF00155                                            0155 00456000
*     RETURN TO GOOD;               /* GO TO GOOD EXIT       @Z40SP00*/ 00457000
         LA    @14,GOOD                                            0156 00458000
@EL00002 DS    0H                                                  0156 00459000
@EF00002 DS    0H                                                  0156 00460000
@ER00002 BR    @14                                                 0156 00461000
*   IF SCPRET=SCPSTOP               /* ROUT INDICATED STOP   @Z40SP00*/ 00462000
*     THEN                          /* WITH BAD RETURN CODE  @Z40SP00*/ 00463000
@RF00155 L     @11,@PC00001                                        0157 00464000
         CLI   SCPRET(@11),8                                       0157 00465000
         BNE   @RF00157                                            0157 00466000
*     RETURN TO BAD;                /* RETURN TO POINT TO CHANGE   0158 00467000
*                                      RETURN CODE AND RTURN @Z40SP00*/ 00468000
         LA    @14,BAD                                             0158 00469000
         BR    @14                                                 0158 00470000
*   RETURN TO FINISH;               /* OTHERWISE, ERROR, RETURN WITH    00471000
*                                      CODE PASSED           @Z40SP00*/ 00472000
@RF00157 LA    @14,FINISH                                          0159 00473000
         BR    @14                                                 0159 00474000
*   END EXIT;                                                      0160 00475000
         B     @EL00002                                            0160 00476000
*                                                                  0161 00477000
*   /*****************************************************************/ 00478000
*   /*                                                               */ 00479000
*   /* RETURN FROM SCAN TO CALLING MODULE                            */ 00480000
*   /*                                                               */ 00481000
*   /*****************************************************************/ 00482000
*                                                                  0161 00483000
*GOOD:                                                             0161 00484000
*   SCPRET=SCPGOOD;                 /* SUCCESSFULL RETURN    @YA07506*/ 00485000
GOOD     L     @11,@PC00001                                        0161 00486000
         MVI   SCPRET(@11),X'00'                                   0161 00487000
*   GO TO FINISH;                   /* AND RETURN TO CALLER          */ 00488000
         B     FINISH                                              0162 00489000
*BAD:                                                              0163 00490000
*   SCPRET=SCPBAD;                  /* SYNTAX ERROR          @Z40SP00*/ 00491000
BAD      L     @11,@PC00001                                        0163 00492000
         MVI   SCPRET(@11),X'04'                                   0163 00493000
*FINISH:                                                           0164 00494000
*   RETURN;                         /* RETURN TO CALLER              */ 00495000
*                                                                  0164 00496000
@EL00001 L     @13,4(,@13)                                         0164 00497000
@EF00001 L     @00,@SIZDATD                                        0164 00498000
         LR    @01,@12                                             0164 00499000
         FREEMAIN R,LV=(0),A=(1)                                        00500000
@ER00001 LM    @14,@12,12(@13)                                     0164 00501000
         BR    @14                                                 0164 00502000
*   /*****************************************************************/ 00503000
*   /*                                                               */ 00504000
*   /* TRT INSTRUCTION EXECUTED WHEN LOOKING FOR VARIABLE LENGTH     */ 00505000
*   /* PARAMETERS                                            @Z40SP00*/ 00506000
*   /*                                                               */ 00507000
*   /*****************************************************************/ 00508000
*                                                                  0165 00509000
*   GENERATE CODE;                                                 0165 00510000
TEST     TRT   0(0,SCANREG),TRTTBL     SCAN PARM ENTRY                  00511000
*   END HMASMSCN                                                   0166 00512000
*                                                                  0166 00513000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00514000
*/*%INCLUDE SYSLIB  (HMASMSCP)                                       */ 00515000
*                                                                  0166 00516000
*       ;                                                          0166 00517000
         B     @EL00001                                            0166 00518000
@DATA    DS    0H                                                       00519000
@SC00183 CLC   STRING(0,SCANREG),DSCKEY(SCTBLPTR)                       00520000
@DATD    DSECT                                                          00521000
         DS    0F                                                       00522000
@SA00001 DS    18F                                                      00523000
@PC00001 DS    1F                                                       00524000
HMASMSCN CSECT                                                          00525000
         DS    0F                                                       00526000
@DATD    DSECT                                                          00527000
         DS    0D                                                       00528000
TRTTBL   DS    CL256                                                    00529000
         ORG   TRTTBL                                                   00530000
NON1     DS    CL91                                                     00531000
ALPHA1   DS    CL1                                                      00532000
NON2     DS    CL31                                                     00533000
ALPHA2   DS    CL2                                                      00534000
NON3     DS    CL67                                                     00535000
ALPHA3   DS    CL10                                                     00536000
         ORG   ALPHA3                                                   00537000
@NM00003 DS    CL1                                                      00538000
HEX1     DS    CL6                                                      00539000
@NM00004 DS    CL3                                                      00540000
         ORG   TRTTBL+202                                               00541000
NON4     DS    CL7                                                      00542000
ALPHA4   DS    CL9                                                      00543000
NON5     DS    CL8                                                      00544000
ALPHA5   DS    CL8                                                      00545000
NON6     DS    CL6                                                      00546000
NUM      DS    CL10                                                     00547000
         ORG   NUM                                                      00548000
HEX2     DS    CL10                                                     00549000
         ORG   TRTTBL+250                                               00550000
NON7     DS    CL6                                                      00551000
         ORG   TRTTBL+256                                               00552000
EXITPARM DS    CL8                                                      00553000
         ORG   EXITPARM                                                 00554000
ADIOPRM  DS    AL4                                                      00555000
ADSCP    DS    AL4                                                      00556000
         ORG   EXITPARM+8                                               00557000
SWITCHES DS    BL1                                                      00558000
         ORG   SWITCHES                                                 00559000
INCOMENT DS    BL1                                                      00560000
@NM00005 EQU   SWITCHES+0                                               00561000
         ORG   SWITCHES+1                                               00562000
         DS    CL3                                                      00563000
REGSAV   DS    16A                                                      00564000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00565000
@ENDDATD EQU   *                                                        00566000
HMASMSCN CSECT                                                          00567000
         DS    0F                                                       00568000
@SIZDATD DC    AL1(0)                                                   00569000
         DC    AL3(@ENDDATD-@DATD)                                      00570000
         DS    0D                                                       00571000
@CC00136 DC    C'/*'                                                    00572000
@CC00138 DC    C'*/'                                                    00573000
ZEROS    DC    X'00000000000000000000'                                  00574000
PATCHSCN DS    CL80                                                     00575000
         ORG   PATCHSCN                                                 00576000
@NM00006 DC    80X'FF'                                                  00577000
         ORG   PATCHSCN+80                                              00578000
@00      EQU   00                      EQUATES FOR REGISTERS 0-15       00579000
@01      EQU   01                                                       00580000
@02      EQU   02                                                       00581000
@03      EQU   03                                                       00582000
@04      EQU   04                                                       00583000
@05      EQU   05                                                       00584000
@06      EQU   06                                                       00585000
@07      EQU   07                                                       00586000
@08      EQU   08                                                       00587000
@09      EQU   09                                                       00588000
@10      EQU   10                                                       00589000
@11      EQU   11                                                       00590000
@12      EQU   12                                                       00591000
@13      EQU   13                                                       00592000
@14      EQU   14                                                       00593000
@15      EQU   15                                                       00594000
EORPTR   EQU   @06                                                      00595000
LENGTH   EQU   @02                                                      00596000
R1       EQU   @01                                                      00597000
SCANREG  EQU   @03                                                      00598000
SCTBLPTR EQU   @04                                                      00599000
EXITADDR EQU   @05                                                      00600000
LENREG   EQU   @07                                                      00601000
R14      EQU   @14                                                      00602000
R15      EQU   @15                                                      00603000
R0       EQU   @00                                                      00604000
R12      EQU   @12                                                      00605000
R13      EQU   @13                                                      00606000
R2       EQU   @02                                                      00607000
DSCANMAP EQU   0                                                        00608000
DSCALTAD EQU   DSCANMAP                                                 00609000
DSCSUCAD EQU   DSCANMAP+4                                               00610000
DSCRTAD  EQU   DSCANMAP+8                                               00611000
DSCFLAG  EQU   DSCANMAP+12                                              00612000
DSCALPHA EQU   DSCFLAG                                                  00613000
DSCNUMER EQU   DSCFLAG                                                  00614000
DSCBLANK EQU   DSCFLAG                                                  00615000
DSCCONT  EQU   DSCFLAG                                                  00616000
DSCCOMMA EQU   DSCFLAG                                                  00617000
DSCHEX   EQU   DSCFLAG                                                  00618000
DSCCALRT EQU   DSCFLAG                                                  00619000
DSCMAXLN EQU   DSCANMAP+13                                              00620000
DSCMINLN EQU   DSCANMAP+14                                              00621000
DSCKEYLN EQU   DSCANMAP+15                                              00622000
DSCEND   EQU   DSCANMAP+16                                              00623000
USER     EQU   0                                                        00624000
STRING   EQU   0                                                        00625000
SCPIOPRM EQU   0                                                        00626000
SCPSTRNG EQU   0                                                        00627000
HMASMSCP EQU   0                                                        00628000
SCPCHAR  EQU   HMASMSCP                                                 00629000
SCPSRCH  EQU   HMASMSCP+4                                               00630000
SCPWKAR  EQU   HMASMSCP+8                                               00631000
SCPIORTN EQU   HMASMSCP+12                                              00632000
SCPIOPAD EQU   HMASMSCP+16                                              00633000
SCPINLN  EQU   HMASMSCP+20                                              00634000
SCPPMLN  EQU   HMASMSCP+22                                              00635000
SCPEOR   EQU   HMASMSCP+24                                              00636000
SCPCONT  EQU   SCPEOR                                                   00637000
SCPNOCT  EQU   SCPEOR                                                   00638000
SCPCOMNT EQU   SCPEOR                                                   00639000
SCPNOSUC EQU   SCPEOR                                                   00640000
SCPNORT  EQU   SCPEOR                                                   00641000
SCPRETRN EQU   HMASMSCP+25                                              00642000
SCPRET   EQU   SCPRETRN                                                 00643000
DSCKEY   EQU   DSCEND                                                   00644000
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00645000
@NM00001 EQU   SCPEOR                                                   00646000
SCPRTERR EQU   SCPEOR                                                   00647000
@NM00002 EQU   DSCFLAG                                                  00648000
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00649000
@RT00054 EQU   GOOD                                                     00650000
@RT00057 EQU   GOOD                                                     00651000
@RT00087 EQU   SCAN8                                                    00652000
@RT00089 EQU   SCAN6                                                    00653000
@RT00091 EQU   BAD                                                      00654000
@RT00106 EQU   GOOD                                                     00655000
@RC00108 EQU   SCAN1                                                    00656000
@RT00137 EQU   BAD                                                      00657000
@RT00153 EQU   @EL00002                                                 00658000
FINISH   EQU   @EL00001                                                 00659000
@ENDDATA EQU   *                                                        00660000
         END   HMASMSCN,(C'PLS2114',0802,78334)                         00661000
