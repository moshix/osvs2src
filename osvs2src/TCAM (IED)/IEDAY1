         TITLE 'IEDAY1 - TIOC INITIALIZATION'                           00060002
IEDAY1   CSECT                                                          00120002
* ********************************************************************* 00230002
*                                                                       00232002
*01* MODULE-NAME = IEDAY1                                               00234002
*                                                                       00236002
*01* DESCRIPTIVE-NAME = TIOC INITIALIZATION/DE-INITIALIZATION           00238002
*                                                                       00238402
*01* COPYRIGHT = NONE                                                   00238802
*                                                                       00239202
*01* STATUS = 00                                                        00239602
*                                                                       00239702
*01* FUNCTION = START - COMPUTE AND OBTAIN MAIN STORAGE REQUIRED FOR    00239802
*                       TIOC.  INITIALIZE TIOC CONTROL CLOCKS AND       00239902
*                       BUFFERS.                                        00259902
*               STOP  - CLEAR POINTERS IN CONTROL BLOCKS AND FREE       00269902
*                       TIOC MAIN STORAGE.                              00279902
*                                                                       00286602
*01* NOTES = N/A                                                        00288602
*                                                                       00290602
*01* RESTRICTIONS = N/A                                                 00292602
*                                                                       00293002
*02*   DEPENDENCIES = NONE                                              00293102
*                                                                       00293202
*02*   RESTRICTIONS = NONE                                              00309902
*                                                                       00319902
*02*   REGISTER-CONVENTIONS = SEE REGISTER EQUATES                      00321902
*                                                                       00323902
*02*   PATCH-LABEL = PATCH                                              00325902
*                                                                       00326302
*01* MODULE-TYPE = ASSEMBLER LANGUAGE CSECT                             00326402
*                                                                       00326502
*02*   PROCESSOR = ASSEMXF-370R                                         00332102
*                                                                       00334102
*02*   MODULE-SIZE = SEE EXTERNAL SYMBOL DICTIONARY TYPE SD ID-01       00336102
*                                                                       00336502
*02*   ATTRIBUTES = REENTRANT, REUSABLE, ENABLED                        00336902
*                                                                       00337302
*01* ENTRY-POINT = IEDAY1                                               00337402
*                                                                       00337502
*02*   PURPOSE = SEE FUNCTION                                           00339502
*                                                                       00341502
*02*   LINKAGE = FROM TCAM OPERATOR CONTROL MODULE IGCM010D VIA XCTL    00341902
*                                                                       00342302
*01* INPUT = REGISTER 1 CONTAINS ADDRESS OF OPERATOR CONTROL AVT        00342702
*                                                                       00343102
*01* OUTPUT = REGISTER 1 CONTAINS ADDRESS OF OPERATOR CONTROL AVT       00343202
*             REGISTER 4 CONTAINS ADDRESS OF TCAM AVT                   00356002
*                                                                       00366002
*01* EXIT-NORMAL = TO TCAM OPERATOR CONTROL MODUEL IGC0710D VIA XCTL    00368002
*                                                                       00368402
*01* EXIT-ERROR = NONE                                                  00368502
*                                                                       00368602
*01* EXTERNAL REFERENCES = SYSTEM INITIATED CANCEL VIA BRANCH ENTRY     00368702
*                                                                       00373002
*02*   CONTROL-BLOCKS = ASCB, CVT, SCVT, TCAM AVT, TCAM OPCAVT,         00375002
*                       TCAM OPE, DCB, QCB, TNT, TIOCBUF, TIOCRPT,      00377002
*                       TCX, TRM, TSB                                   00379602
*                                                                       00383602
*01* TABLES = SEE WORK AREA MAPPING LABELED DAPLIST, DUPLIST, PARMTBL,  00387702
*             WASTART, WASTOP                                           00388102
*                                                                       00388802
*01* MACROS = GETMAIN, FREEMAIN, ATTACH, DETACH, OPEN, CLOSE, READ,     00391402
*             WTO, FIND, TSEND, TCABEND, MODESET, DYNALLOC, LOAD,       00394002
*             SETLOCK                                                   00396602
*                                                                       00399202
*         VS2 030  SU                                                   00399603
*                                                                       00400003
*                                                              @ZA09955 00400100
*  D 058800                                                     ZA09955 00400200
*  A 058800-059200                                              ZA09955 00400300
*0000079210                                                    @ZA05227 00400403
*                                                                       00400803
*                                                                       00401203
*01* CHANGE-ACTIVITY  VS01806 05/17/73                                  00401802
*                     VS01246 06/06/73                                  00403802
*                     VS01382 06/27/73                                  00404202
*                     VS01176 07/16/73                                  00404302
*                     VS03016 08/07/73                                  00414302
*                     VS03842 09/18/73                                  00416302
*                     VS04639 10/15/73                                  00418302
*                                                                       00423602
*********************************************************************/  00433002
*                                                                       00442402
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00451802
*                                                                       00461202
*              REGISTER EQUATES                                         00470602
*                                                                       00480002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00540002
*                                                                       00600002
R0       EQU   0                        WORK REGISTER                   00660002
R1       EQU   1                        PARM/WORK REGISTER              00720002
R2       EQU   2                        KEYWORD TABLE ENTRY/WORK REG    00780002
R3       EQU   3                        WORK REGISTER                   00840002
R4       EQU   4                        WORK REGISTER                   00900002
R5       EQU   5                        WORK REGISTER                   00960002
R6       EQU   6                        WORK REGISTER                   01020002
RQCB     EQU   7                        HAS ADDRESS OF QCB              01080002
R7       EQU   7                        TIOCRPT ADDRESS/WORK REGISTER   01140002
R8       EQU   8                        TSB ADDRESS/WORK REGISTER       01200002
R9       EQU   9                        BUFFER ADDRESS/WORK REGISTER    01260002
RSTOP    EQU   10                       STOPPER WHILE SCANNING PARM     01320002
R10      EQU   10                       WORK REGISTER                   01380002
RWABASE  EQU   11                       WORK AREA BASE                  01440002
RBASE    EQU   12                       BASE REGISTER                   01500002
R13      EQU   13                       POINT TO REGISTER SAVE AREA     01550002
ROPCAVT  EQU   13                       POINT TO TCAM OP CONTROL AVT    01560002
R14      EQU   14                       RETURN ADDRESS/WORK REGISTER    01620002
R15      EQU   15                       ENTRY ADDRESS/WORK REGISTER     01680002
         SPACE 3                                                        01740002
*                                                                       01800002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 01860002
*                                                                       01920002
*              EQUATES FOR MASKS, LENGTH, DISPLACEMENTS                 01980002
*              AND CONSTANTS                                            02040002
*                                                                       02100002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 02160002
*                                                                       02220002
E0       EQU   0                        '0'                             02280002
ECABEND  EQU   0                        ENTRY CODE FOR TCABEND  YM03842 02330002
E1       EQU   1                        '1'                             02340002
NOTDUMP  EQU   1                        FLAG FOR NOT DUMPING    YM03842 02390002
E2       EQU   2                        '2'                             02400002
E3       EQU   3                        '3'                             02460002
E4       EQU   4                        '4'                             02520002
E5       EQU   5                        '5'                             02580002
E6       EQU   6                        '6'                             02640002
E7       EQU   7                        '7'                             02700002
E8       EQU   8                        '8'                             02760002
E10      EQU   10                       '10'                            02820002
E13      EQU   13                       '13'                            02870002
E20      EQU   20                       '20'                            02880002
E24      EQU   24                       '24'                            02940002
E33      EQU   33                       '33'                            03000002
E36      EQU   36                       '36'                            03060002
E37      EQU   37                       '37'                            03120002
E38      EQU   38                       '38'                            03180002
E63      EQU   63                       '63'                            03240002
E68      EQU   68                       '68'                            03300002
TYPE31   EQU   31                       SMF RECORD TYPE                 03360002
TERMSTUS EQU   94                       SVC NUMBER FOR TERM     YM03842 03410002
*                                       STATUS                  YM03842 03412002
QTIP     EQU   101                      SVC NUMBER FOR QTIP             03420002
TIOCSP   EQU   231                      SUBPOOL NO. FOR TIOC STORAGE    03480002
REPLYL   EQU   5                        REPLY LENGTH FOR WTOR           03530002
EQUAL    EQU   C'='                     EQUAL SIGN                      03540002
BLANK    EQU   X'40'                    BLANK                           03600002
COMMA    EQU   C','                     COMMA                           03660002
LOW      EQU   4                        1ST COMPARAND LOW               03720002
NOTHIGH  EQU   13                       CONDITION CODE NOT HIGH AFTER   03780002
*                                       COMPARE                         03840002
TRMTSO   EQU   X'01'                    TERMINAL IS SUPPORTED BY TS     03900002
NOT      EQU   X'FF'                    USED TO TURN BITS OFF           03960002
XF0      EQU   X'F0'                    USED TO OR THE ZONE FIELD       04020002
UNALLOC  EQU   X'02'                    VERBCODE FOR UNALLOCATION       04070002
WAITBIT  EQU   X'80'                    DENOTE ECB IS BEING WAITED ON   04070102
POSTBIT  EQU   X'40'                    DENOTE ECB HAS BEEN POSTED      04120002
MINIBFNO EQU   4                        MINIMUM BUFFER NUMBER           04140002
MINIBFSZ EQU   20                       MINIMUM BUFFER SIZE             04200002
MAXIBFSZ EQU   252                      MAXIMUM BUFFER SIZE             04260002
DEFTBFSZ EQU   64                       DEFAULT BUFFER SIZE             04320002
DEFTOWTH EQU   20                       DEFAULT OWAITHI                 04380002
DEFTNLKH EQU   4                        DEFAULT INLOCKHI                04440002
INPTDALN EQU   2                        OFFSET TO DATA LENGTH FIELD     04490002
INPTDATA EQU   8                        OFFSET TO DATA FIELD            04492002
SYNTAXID EQU   18                       MSG ID FOR SYNTAX ERROR         04494002
         SPACE 3                                                        04500002
*                                                                       04560002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04620002
*                                                                       04680002
*              BEGINNING OF MODULE                                      04740002
*                                                                       04800002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 04860002
*                                                                       04920002
         SPACE 3                                                        04980002
HEREWEGO EQU   *                                                        05040002
         BALR  RBASE,R0                 SET BASE REGISTER               05100002
         USING *,RBASE                  MODULE ADDRESSABILITY           05160002
         USING IEDQOPCD,ROPCAVT         ADDRESSABILITY FOR OPC AVT      05220002
         USING IEDQAVTD,R10             ADDRESSABILITY FOR TCAM AVT     05280002
         B     SKIPID                   SKIP MODULE ID                  05340002
         DC    C'IEDAY1'                MODULE NAME                     05400002
         DC    X'5253'                  JULIAN DATE - 09/10/75 @ZA05227 05460003
         DS    0H                       ALIGN ON HALF WORD BOUNDARY     05520002
         SPACE 1                                                        05580002
SKIPID   EQU   *                                                        05640002
         LR    ROPCAVT,R1               SET BASE FOR OP CONTROL AVT     05700002
         L     R10,OPCAVTPT             SET BASE FOR TCAM AVT           05760002
         L     R3,OPCCOPCE              GET ADDRESS OF OPC ELEMENT      05810002
         USING IEDQOPCE,R3              USE R3 AS OPC ELEMENT BASE      05812002
         TM    OCFLAG,OCCONSOL          IS MSG FROM SYS OPERATOR        05814002
         BNZ   MSGOK              YES, CONTINUE                @ZA09955 05880000
         L     R5,OPCWORK         GET OPC ELEMENT BASE          ZA09955 05887000
         SR    R4,R4              CLEAR REG.                    ZA09955 05894000
         STH   R4,0(,R5)          ZERO MSG LENGTH               ZA09955 05901000
         B     EXIT               GO TO EXIT                    ZA09955 05908000
MSGOK    EQU   *                                                ZA09955 05915000
         DROP  R3                       DROP OPC ELEMENT BASE           05930002
         L     R2,OPCWORK               GET ADDR OF OPER CTL WORK AREA  05940002
         LA    R3,INPTDATA(,R2)         SET PTR TO DATA                 06000002
         LH    R5,INPTDALN(,R2)         GET LENGTH OF DATA AREA         06060002
         SPACE 1                                                        06120002
FINDEQ   EQU   *                                                        06180002
         CLI   E0(R3),EQUAL             SCAN FOR EQUAL SIGN             06240002
         BE    FOUNDEQ                  BR IF FOUND                     06300002
         LA    R3,E1(R3)                INCREMENT PTR BY 1              06360002
         BCT   R5,FINDEQ                LOOK AT NEXT CHAR IF ANY        06420002
         B     ERROR01                  ERROR CONDITION - STOP          06480002
         SPACE 1                                                        06540002
FOUNDEQ  EQU   *                                                        06600002
         CLC   CSTOP,E1(R3)             IS REQUEST FOR STOP             06660002
         BE    STOP                     YES, GO TO PROCESS STOP         06720002
         CLC   CSTART,E1(R3)            IS REQUEST FOR START            06780002
         BNE   ERROR01                  ERROR CONDITION                 06840002
         LA    R4,E6                    SUBTRACT LENGTH OF '=START'     06890002
         SR    R5,R4                    FROM DATA LENGTH                06892002
         BNP   START                    NO MEMBER NAME SPECIFIED        06894002
         CLI   E6(R3),COMMA             SCAN FOR ',' AFTER 'START'      06896002
         BNE   ERROR01                  ERROR CONDITION IF NOT ','      06898002
         SPACE 3                                                        06900002
*                                                                       06960002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07020002
*                                                                       07080002
*              INITIALIZATION FOR TIME SHARING                          07140002
*                                                                       07200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07260002
*                                                                       07320002
*                                                                       07380002
* GETMAIN FOR WORK AREA                                                 07440002
*                                                                       07500002
START    EQU   *                                                        07560002
         IPK                            GET CALLER'S KEY IN REG 2       07620002
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          07680002
         LA    R0,WAEND-WASTART         SIZE OF WORK AREA               07740002
         GETMAIN R,LV=(0)               GET STORAGE FOR WORK AREA       07800002
         LR    RWABASE,R1               STORAGE RETURNED IN R1          07860002
         USING WASTART,RWABASE          ADDRESSABILITY FOR WORK AREA    07920002
         ST    ROPCAVT,OPCAVTSV         SAVE OPCAV             @ZA05227 07950003
         STC   R2,CALLRKEY              SAVE CALLER'S KEY IN WORK AREA  07980002
         L     R2,CVTPTR                GET CVT ADDRESS                 08040002
         L     R2,CVTAQAVT-CVT(,R2)     POINT TO TCX                    08100002
         L     R4,TCXRPT-IEDQTCX(,R2)   GET RPT POINTER                 08160002
         LTR   R4,R4                    HAS TS ALREADY BEEN INITIALIZED 08220002
         BNZ   ERROR02                  YES, TELL OPERATOR SO           08280002
         L     R4,AVTTSOPT              GET TSINPUT'S QCB ADDR          08340002
         LTR   R4,R4                    DOES TCAM SUPPORT TS            08400002
         BZ    ERROR03                  NO, TELL OPERATOR SO            08460002
         DROP  R10                                                      08520002
         SPACE 3                                                        08580002
*                                                                       08640002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08700002
*                                                                       08760002
*              ALLOCATE SYS1.PARMLIB                                    08820002
*                                                                       08880002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 08940002
*                                                                       09000002
         MVC   RQBLOCK(DAPEND-DAPLIST),DAPLIST  MOVE REQUEST BLOCK FOR  09060002
*                                       DNY ALLOCATION TO WORK AREA     09120002
         MVC   KYWDTBL(ENDPMTBL-PARMTBL),PARMTBL  INITIALIZE TIOC       09180002
*                                                 PARM KEYWORD TABLE    09240002
         LA    R2,RQBLOCK               R2 HAS REQUEST BLOCK ADDRESS    09300002
         O     R2,HIBITON               TURN HIGH ORDER BIT ON          09360002
         ST    R2,RQBLKPTR              PUT IN WORK AREA                09420002
         LA    R4,WATPTR1               ADDR OF TEXT PTR IN WORK AREA   09600002
         ST    R4,TEXTPTR               PUT IT IN REQUEST BLOCK         09660002
         LA    R4,WATEXT1               ADDR OF TEXT UNIT 1 IN WA       09710002
         ST    R4,WATPTR1               RELOCATE WA TEXT POINTER 1      09712002
         LA    R4,WATEXT2               ADDR OF TEXT UNIT 2 IN WA       09714002
         ST    R4,WATPTR2               RELOCATE WA TEXT POINTER 2      09716002
         LA    R4,WATEXT3               ADDR OF TEXT UNIT 3 IN WA       09720002
         ST    R4,WATPTR3               RELOCATE WA TEXT POINTER 3      09780002
         LA    R4,WATEXT4               ADDR OF TEST UNIT 4 IN WA       09830002
         O     R4,HIBITON               SIGNAL LAST POINTER             09830402
         ST    R4,WATPTR4               RELOCATE WA TEXT POINTER 4      09832002
         SPACE 1                                                        09840002
         DYNALLOC                       ALLOCATE SYS1.PARMLIB           09900002
         SPACE 1                                                        09960002
         LH    R4,ERRCODE               GET RETURN CODE                 10020002
         LTR   R4,R4                    IS ALLOCATION SUCCESSFUL        10080002
         BNZ   ERROR041                 NO, SEND ERROR MSG              10140002
         SPACE 3                                                        10200002
*                                                                       10260002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10320002
*                                                                       10380002
*              OPEN SYS1.PARMLIB                                        10440002
*                                                                       10500002
* MOVE DCB TO THE WORK AREA, BUILD A ONE-WORD PARAMETER LIST FOR OPEN   10550002
* AS FOLLOWS -                                                          10552002
*                                                                       10680002
*        BYTE 0     X'80'               LAST DCB, OPEN FOR INPUT        10740002
*        BYTE 1-3                       DCB ADDRESS                     10800002
*                                                                       10860002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 10920002
*                                                                       10980002
         USING IHADCB,R2                ADDRESSABILITY FOR DCB          11040002
         MVC   WADCB(ENDDCB-PARMDCB),PARMDCB MOVE DCB TO WORK AREA      11100002
         LA    R2,WADCB                 GET ADDRESS OF DCB IN WORK AREA 11150002
         O     R2,HIBITON               SET HI ORDER BIT ON TO INDICATE 11152002
*                                       LAST DCB TO OPEN                11154002
         ST    R2,OPENPARM              INITIALIZE PARM LIST IN WA      11156002
         MVC   DOUBLE1(E2),WADDLEN      MOVE LENGTH OF PARMLIB DDNAME   11160002
*                                       RETURNED BY DYNAMIC ALLOCATION  11220002
         LH    R1,DOUBLE1               PUT LENGTH IN REGISTER          11280002
         BCTR  R1,R0                    DECREMENT FOR EX INSTRCTION     11340002
         EX    R1,MOVEDDNM              MOVE PARMLIB DDNAME TO DCB      11400002
         LA    R1,OPENPARM              SET UP PARMLIST PTR             11460002
         OPEN  MF=(E,(1))               OPEN SYS1.PARMLIB               11520002
         TM    DCBOFLGS,DCBOFOPN        IS OPEN SUCCESSFUL              11580002
         BZ    ERROR04                  NO, SEND ERROR MSG              11640002
         DROP  R2                                                       11700002
         SPACE 3                                                        11760002
*                                                                       11820002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 11880002
*                                                                       11940002
*              FIND SYS1.PARMLIB MEMBER WHICH CONTAINS                  12000002
*              TIOC PARAMETERS                                          12060002
*                                                                       12120002
* SEE WHETHER A MEMBER NAME IS SPECIFIED. CONTINUE TO SCAN TCAM         12180002
* OPERATOR WORK AREA. R5 HAS REMAINING DATA LENGTH, R3 POINTS AT        12240002
* THE EQUAL SIGN                                                        12300002
*                                                                       12360002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 12420002
*                                                                       12480002
GETMEM   EQU   *                                                        12780002
         BCTR  R5,R0                    TAKE AWAY LENGTH FOR ','        12840002
         LA    R4,E8                    PUT 8 IN REG                    12900002
         CR    R5,R4                    IS MEMBER NAME GT 8 BYTES       12960002
         BH    ERROR05                  YES, SEND ERROR MESSAGE         13020002
         SPACE 3                                                        13080002
*                                                                       13140002
* FIND MEMBER IF SPECIFIED, OTHERWISE FIND IKJPRM00                     13200002
*                                                                       13260002
*                                                                       13320002
         LTR   R5,R5                    IS MEMBER SPECIFIED             13380002
         BNP   PRM00                    NO, FIND IKJPRM00               13440002
         L     R4,BLANKS                .BLANK OUT THE                  13500002
         ST    R4,DOUBLE1               .DOUBLE WORD WORK AREA          13560002
         ST    R4,DOUBLE1+E4            .FOR FIND MACRO                 13620002
         BCTR  R5,R0                    DECREMENT FOR EX                13680002
         EX    R5,MOVENAME              MOVE MEMBER NAME                13740002
         LA    R5,E1(,R5)               RESTORE MEMBER NAME LENGTH      13800002
         SPACE 1                                                        13860002
FINDMEM  EQU   *                                                        13920002
         FIND  WADCB,DOUBLE1,D          FIND MEMBER NAME                13980002
         SPACE 1                                                        14040002
         LA    R0,E4                    PUT 4 IN REG                    14100002
         CR    R15,R0                   WAS MEMBER FOUND                14160002
         BL    READRCD                  YES, PROCESS MEMBER             14220002
         BH    ERROR06                  I/O ERROR, SEND ERROR MSG       14280002
         LTR   R5,R5                    WAS MEMBER SPECIFIED            14340002
         BNP   ERROR08                  NO, USE DEFAULT VALUES          14400002
         SPACE 3                                                        14460002
*                                                                       14520002
* WHEN MEMBER IS SPECIFIED BUT CANNOT BE FOUND, START TIME SHARING      14580002
* REQUEST WILL BE REJECTED                                              14640002
*                                                                       14700002
ERROR05  EQU   *                                                        14760002
         L     R1,MSG005I               GET ADDR OF MSG LIST            14820002
         BAL   R14,WTO                  INFORM OPERATOR                 14880002
         BAL   R14,CPARMLIB             CLOSE PARMLIB                   14940002
         B     FREEWA                   FREE WORK AREA AND EXIT         15000002
         SPACE 3                                                        15060002
PRM00    EQU   *                                                        15120002
         MVC   DOUBLE1,CPRM00           MOVE NAME 'IKJPRM00' TO WORK    15180002
*                                       AREA                            15240002
         B     FINDMEM                  GO TO FIND IT                   15300002
         SPACE 3                                                        15360002
*                                                                       15420002
* READ MEMBER RECORD                                                    15480002
*                                                                       15540002
READRCD  EQU   *                                                        15600002
         XC    WADECB,WADECB            ZERO DECB IN WORK AREA          15660002
         ST    ROPCAVT,OPCAVTSV         SAVE OPC AVT ADDRESS            15710002
         LA    R13,REGSAVE              GET REGISTER SAVE AREA          15712002
         SPACE 1                                                        15720002
NEXTRCD  EQU   *                                                        15780002
         READ  WADECB,SF,WADCB,BUFFER,MF=E  READ A RECORD               15840002
         CHECK WADECB                   FINISH READING IT               15900002
         SPACE 3                                                        15960002
*                                                                       16020002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 16080002
*                                                                       16140002
*              SCAN THE RECORD WHICH IS IN 80 COLUMN CARD IMAGE         16200002
*              ENTER PARAMETER VALUES IN KEYWORD TABLE                  16260002
*                                                                       16320002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 16380002
*                                                                       16440002
         LA    R3,BUFFER                POINTS AT COLUMN 1              16500002
         LA    RSTOP,E63(,R3)           ONLY WANTS TO SCAN TO COL 64    16560002
         SPACE 1                                                        16620002
SKIPBLNK EQU   *                                                        16680002
         CLI   E0(R3),BLANK             CHECK FOR BLANK                 16740002
         BNE   CHKTIOC                  GO TO FURTHER SCAN              16800002
         CR    R3,RSTOP                 CHECK FOR END OF CARD           16860002
         BNL   NEXTRCD                  IF END OF CARD, READ NEXT RCD   16920002
         LA    R3,E1(,R3)               OTHERWISE ADVANCE 1 COLUMN      16980002
         B     SKIPBLNK                 CHECK FOR BLANK AGAIN           17040002
         SPACE 1                                                        17100002
CHKTIOC  EQU   *                                                        17160002
         CLC   E0(E5,R3),CTIOC          SCAN FOR TIOC CARD              17220002
         BNE   NEXTRCD                  NOT TIOC CARD, READ NEXT RECORD 17280002
         SPACE 1                                                        17340002
*                                                                       17400002
* WHEN A TIOC CARD HAS BEEN IDENTIFIED, SCAN FOR PARAMETERS             17460002
*                                                                       17520002
         SPACE 1                                                        17580002
FINDPARM EQU   *                                                        17640002
         LA    R3,E5(,R3)               POINT TO 1ST POSSIBLE PARM      17700002
         LA    RSTOP,E5(,RSTOP)         STOP AT COL 69                  17760002
         SPACE 1                                                        17820002
SKIPBLK  EQU   *                                                        17880002
         CLI   E0(R3),BLANK             SKIP ANY BLANKS                 17940002
         BNE   EQUSIGN                  NOT BLANK, FURTHER SCAN         18000002
         CR    R3,RSTOP                 CHECK FOR END OF CARD           18060002
         BNL   NEXTRCD                  IF END OF CARD READ NEXT RECORD 18120002
         LA    R3,E1(,R3)               ADVANCE 1 COLUMN                18180002
         B     SKIPBLK                  CONTINUE LOOKING FOR BLANK      18240002
         SPACE 1                                                        18300002
EQUSIGN  EQU   *                                                        18360002
         LA    R4,E1(,R3)               USED TO SCAN EQUAL SIGN         18420002
         LA    RSTOP,E1(,RSTOP)         STOP AT COL 70                  18480002
         SPACE 1                                                        18540002
SCANEQU  EQU   *                                                        18600002
         CLI   E0(R4),EQUAL             LOOK FOR EQUAL SIGN             18660002
         BE    GETVALUE                 FOUND EQUAL SIGN                18720002
         CR    R4,RSTOP                 CHECK END OF CARD               18780002
         BL    NEXTCHAR                 BRANCH IF NOT END OF CARD       18840002
         LA    R5,E1(,R4)               R5 POINTS TO COL 71             18900002
         SPACE 1                                                        18960002
ISITBLNK EQU   *                                                        19020002
         CLI   E0(R5),BLANK             CHECK FOR BLANK                 19080002
         BNE   NOTBLANK                 BRANCH IF NOT BLANK             19140002
         BCTR  R5,R0                    BACK UP 1 COLUMN                19200002
         B     ISITBLNK                 CHECK FOR BLANK AGAIN           19260002
         SPACE 1                                                        19320002
NOTBLANK EQU   *                                                        19380002
         BAL   R14,KYWDBAD              GO TO SEND ERROR MESSAGE        19440002
         B     NEXTRCD                  READ IN NEXT RECORD             19500002
         SPACE 1                                                        19560002
NEXTCHAR EQU   *                                                        19620002
         LA    R4,E1(,R4)               ADVANCE 1 COLUMN                19680002
         B     SCANEQU                  CONTINUE LOOKING FOR EQUAL SIGN 19740002
         SPACE 1                                                        19800002
GETVALUE EQU   *                                                        19860002
         LA    R5,E1(R4)                POINTS TO 1ST BYTE OF VALUE     19920002
         LA    RSTOP,E1(,RSTOP)         STOP AT COL 71                  19980002
         SPACE 1                                                        20040002
DELIMTER EQU   *                                                        20100002
         CLI   E0(R5),BLANK             CHECK FOR BLANK                 20160002
         BE    NOTEOC                   FOUND BLANK. GO GET VALUE       20220002
         CLI   E0(R5),COMMA             CHECK FOR COMMA                 20280002
         BE    NOTEOC                   FOUND COMMA, GO GET VALUE       20340002
         CR    R5,RSTOP                 END OF CARD CHECK               20400002
         BNL   ENDOFCRD                 IF END OF CARD GO GET VALUE     20460002
         LA    R5,E1(,R5)               ADVANCE 1 COL                   20520002
         B     DELIMTER                 CONTINUE SCAN FOR BLANK/COMMA   20580002
         SPACE 1                                                        20640002
ENDOFCRD EQU   *                                                        20700002
         BAL   R14,CHKYWORD             CHECK FOR VALID KEYWORD         20760002
         B     NEXTRCD                  READ IN NEXT RECORD             20820002
         SPACE 1                                                        20880002
NOTEOC   EQU   *                                                        20940002
         BCTR  R5,R0                    BACK UP TO POINT TO LAST        21000002
*                                       BYTE OF VALUE                   21060002
         LA    R14,NEXTPARM             SET UP BRANCH ADDRESS AFTER     21120002
*                                       KEYWORD VALIDATION              21180002
         SPACE 3                                                        21240002
CHKYWORD EQU   *                                                        21300002
         LA    R2,KYWDTBL               POINTS TO FIRST ENTRY IN        21360002
*                                       PARM KEYWORD TABLE              21420002
         USING KYWDSECT,R2              ADDRESSABILITY                  21480002
         SPACE 1                                                        21540002
NEXTNTRY EQU   *                                                        21600002
         LH    R6,PLENGTH               GET KEYWORD LENGTH              21660002
         LTR   R6,R6                    IS IT END OF TABLE              21720002
         BNP   KYWDBAD                  YES, KEYWORD INVALID            21780002
         BCTR  R6,R0                    DECREMENT FOR EX                21840002
         EX    R6,COMPKYWD              IS KEYWORD VALID                21900002
         BE    SECONDCK                 YES, FURTHER CHECK              21960002
         LA    R2,PSIZE(,R2)            POINTS TO NEXT ENTRY IN PARM    22020002
*                                       KEYWORD TABLE                   22080002
         B     NEXTNTRY                 CHECK NEXT ENTRY                22140002
         SPACE 1                                                        22200002
SECONDCK EQU   *                                                        22260002
         LA    R7,E1(R6,R3)             1 BYTE BEYOND LAST CHAR OF KYWD 22320002
         CR    R7,R4                    IS IT THE EQUAL SIGN            22380002
         BE    KYWDOK                   YES, KEYWORD IS OK              22440002
         SPACE 1                                                        22500002
KYWDBAD  EQU   *                                                        22560002
         LR    R7,R5                    POINT TO LAST VALUE BYTE        22610002
         SR    R7,R3                    1 LT NO. OF CHARS TO MOVE       22620002
         LA    R1,E13                   1 LT MAX. NO. OF CHARS ALLOWED  22670002
         CR    R7,R1                    DOES KEYWORD EXCEED MAXIMUM     22672002
         BNH   LENGTHOK                 NO, IT'S OK TO MOVE             22674002
         LR    R7,R1                    TRUNCATE TO MAXIMUM LENGTH      22676002
         SPACE 1                                                        22678002
LENGTHOK EQU   *                                                        22678402
         L     R1,MSG407I               GET ADDR OF WTO'S PARMLIST      22680002
         LH    R15,E0(,R1)              GET MSG LENGTH                  22740002
         LA    R15,E3(,R15)             ADD 1 LT LENGTH OF DESCRIPTOR   22790002
*                                       AND ROUTING CODES               22840002
         EX    R15,MOVEMSG              MOVE MSG TO WORK AREA           22860002
         EX    R7,MOVEKYWD              MOVE PARM TO MSG LIST           22920002
         LA    R1,MSGLIST               SET UP FOR WTO                  22980002
         WTO   MF=(E,(1))               SEND ERROR MESSAGE              23040002
         BR    R14                      CONTINUE SCAN                   23100002
         SPACE 3                                                        23160002
KYWDOK   EQU   *                                                        23220002
         LR    R7,R5                    R7 POINTS TO LAST BYTE OF       23280002
*                                       SPECIFIED VALUE                 23340002
         SR    R7,R4                    GET NO. OF VALUE BYTES          23400002
         BZ    KYWDBAD                  VALUE WAS NOT SPECIFIED         23460002
         LA    R1,E1(,R4)               POINT TO FIRST VALUE BYTE       23510002
         SPACE 1                                                        23510402
FOX029   EQU   *                                                        23512002
         TM    E0(R1),XF0               IS ZONE FOX                     23514002
         BNO   KYWDBAD                  NO, VALUE IS BAD                23516002
         CR    R1,R5                    IS THIS LAST BYTE OF VALUE      23518002
         BNL   PACKIT                   YES, PACK THE VALUE             23518402
         LA    R1,E1(,R1)               OTHERWISE ADVANCE ONE BYTE      23518802
         B     FOX029                   GO TO CHECK ZONE                23519202
         SPACE 1                                                        23519302
PACKIT   EQU   *                                                        23519602
         BCTR  R7,R0                    DECREMENT FOR EX                23520002
         EX    R7,PACKVALU              CHANG TO PACKED DECIMAL         23580002
         CVB   R4,DOUBLE1               CONVERT TO BINARY               23640002
         LTR   R4,R4                    IS VALUE NEGATIVE               23700002
         BM    KYWDBAD                  YES, SEND ERROR MESSAGE         23760002
         C     R4,MAXIMUM               DOES IT EXCEED MAXIMUM          23810002
         BH    KYWDBAD                  YES, SEND ERROR MESSAGE         23812002
         ST    R4,PVALUE                PUT VALUE IN KEYWORD TABLE      23820002
         OI    PFLAG,PUSER              SIGNAL VALUE IS SPECIFIED       23880002
         BR    R14                      GO TO SCAN FOR NEXT PARM        23940002
         SPACE 3                                                        24000002
NEXTPARM EQU   *                                                        24060002
         LA    R3,E2(,R5)               POINTS TO FIRST POSSIBLE        24120002
*                                       CHAR OF NEXT PARM               24180002
         CR    R3,RSTOP                 CHECK FOR END OF CARD           24240002
         BNL   NEXTRCD                  IF END OF CARD, READ NEXT RCD   24300002
         LA    RSTOP,BUFFER+E68         REINITIALIZE STOP POINT         24360002
*                                       AT COLUMN 69                    24420002
         B     SKIPBLK                  GO TO SCAN FOR BLANK            24480002
         SPACE 3                                                        24540002
CLOSELIB EQU   *                                                        24600002
         BAL   R14,CPARMLIB             CLOSE PARMLIB                   24660002
         L     ROPCAVT,OPCAVTSV         RELOAD OPC AVT ADDRESS          24710002
         SPACE 3                                                        24720002
*                                                                       24780002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 24840002
*                                                                       24900002
*              VALIDATE AND DEFAULT PARAMETER VALUES, RESOLVE           24960002
*              CONFLICTS                                                25020002
*                                                                       25080002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 25140002
*                                                                       25200002
         SPACE 3                                                        25260002
*                                                                       25320002
* BUFSIZE VALIDITY CHECK - MINIMUM - 20, MAXIMUM - 252, ROUND UP TO     25380002
*                          WORD BOUNDARY. DEFAULT VALUE IS 64           25440002
*                                                                       25500002
         SPACE 1                                                        25560002
CHKBFSZ  EQU   *                                                        25620002
         LA    R2,BUFSIZE               POINT TO BUFSIZE ENTRY IN       25680002
*                                       KEYWORD TABLE                   25740002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              25800002
         BZ    DEFBFSZ                  NO, DEFAULT BUFFER SIZE         25860002
         L     R3,PVALUE                GET SPECIFIED VALUE             25920002
         LA    R0,MINIBFSZ              GET MINIMUM                     25980002
         CR    R3,R0                    IS VALUE GT/EQ MINIMUM          26040002
         BL    BADBFSZ                  NO, BUFSIZE VALUE INVALID       26100002
         LA    R0,MAXIBFSZ              GET MAXIMUM                     26160002
         CR    R3,R0                    IS VALUE LT/EQ MAXIMUM          26220002
         BH    BADBFSZ                  NO, BUFSIZE VALUE INVALID       26270002
         LA    R3,E3(,R3)               * ROUND UP BUFFER SIZE          26320002
         N     R3,MINUS4                * TO WORD BOUNDARY              26370002
         B     STBFSZ                   GO TO STORE VALUE               26580002
         SPACE 1                                                        26640002
BADBFSZ  EQU   *                                                        26700002
         LR    R10,R2                   SET UP PARM ADDR IN KEYWORD     26760002
*                                       TABLE FOR SUBROUTINE            26820002
         BAL   R14,BADPARM              GO TO RTN TO PROCESS INVALID    26880002
*                                       PARAMETER VALUE                 26940002
         SPACE 1                                                        27000002
DEFBFSZ  EQU   *                                                        27060002
         LA    R3,DEFTBFSZ              GET BUFFER SIZE DEFAULT VALUE   27120002
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT VALUE USED     27180002
STBFSZ   EQU   *                                                        27240002
         ST    R3,PVALUE                PUT DEFAULT/ADJUSTED VALUE IN   27300002
*                                       TABLE                           27360002
         SPACE 3                                                        27420002
*                                                                       27470002
* 'USERMAX' VALIDITY CHECK - MINIMUM IS 1, MAXIMUM IS 32,767, DEFAULT   27472002
*                            IS NUMBER OF TS TERMINALS PLUS TEN PERCENT 27474002
*                                                                       27476002
CHKUSMAX EQU   *                                                        27478002
         LA    R2,USERMAX               POINT TO USERMAX ENTRY IN       27478402
*                                       KEYWORD TABLE                   27478802
         TM    PFLAG,PUSER              IS KEYWORD SPECIFIED            27479202
         BZ    DEFUSMAX                 NO, DEFAULT USERMAX             27479602
         L     R3,PVALUE                GET SPEFICIED VALUE             27479702
         LTR   R3,R3                    IS VALUE ZERO                   27479802
         BP    CHKBFNO                  NO, VALUE IS OK                 27479902
         SPACE 1                                                        27499902
BADUSMAX EQU   *                                                        27509902
         LR    R10,R2                   SET UP PARM ADDRESS IN KEYWORD  27519902
*                                       TABLE FOR SUBROUTINE            27529902
         BAL   R14,BADPARM              GO TO RTN TO PROCESS INVALID    27531902
*                                       PARAMETER VALUE                 27532302
         SPACE 1                                                        27532702
DEFUSMAX EQU   *                                                        27533102
         BAL   R10,CTTSTERM             GO TO FIND OUT NUMBER OF TS     27533202
*                                       TERMINAL UPON RTN R5 HAS IT     27549902
         LTR   R3,R5                    SAVE NUMBER OF TS       YM04639 27560302
*                                       TERMINALS, AND CHECK    YM04639 27560402
*                                       FOR ANY TS TERMINALS    YM04639 27560502
         BZ    ERROR03                  NO, SEND ERROR MSG      YM04639 27560702
         SR    R4,R4                    CLEAR REGISTER FOR DEVIDE       27561902
         LA    R0,E10                   GET 10 PERCENT                  27563902
         DR    R4,R0                    OF NO. OF TS TERMINALS          27565902
         LTR   R4,R4                    ANY REMAINDER                   27566302
         BZ    ADDIT                    NO                              27566402
         LA    R5,E1(,R5)               ROUND UP QUOTIENT               27570602
         SPACE 1                                                        27574902
ADDIT    EQU   *                                                        27576902
         AR    R3,R5                    10 PERCENT + NO. OF TS TERMS    27578902
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT VALUE USED     27579002
         ST    R3,PVALUE                PUT VALUE IN KEYWORD TABLE      27584202
         SPACE 3                                                        27586202
*                                                                       27589602
* 'BUFFERS' VALIDITY CHECK - MINIMUM IS 4, MAXIMUM IS 32,767, DEFAULT   27594802
*                            IS SIX TIMES THE VALUE OF USERMAX  OR      27600002
*                            MAXIMUM VALUE ALLOWED                      27650002
         SPACE 1                                                        27660002
CHKBFNO  EQU   *                                                        27720002
         LA    R2,BUFFERS               POINT TO BUFFERS ENTRY IN       27780002
*                                       KEYWORD TABLE                   27840002
         LA    R6,CHKOWTHI              SET UP BRANCH ADDRESS           27900002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              27960002
         BZ    DEFTBFNO                 NO, USE DEFAULT VALUE           28020002
         L     R9,PVALUE                GET SPECIFIED VALUE             28080002
         LA    R0,MINIBFNO              GET MINIMUM                     28140002
         CR    R9,R0                    IS VALUE GT/EQ TO MINIMUM       28200002
         BL    BADBFNO                  NO, VALUE INVALID               28260002
         L     R0,MAXIMUM               GET MAXIMUM                     28320002
         CR    R9,R0                    IS VALUE LT/EQ TO MAXIMUM       28380002
         BCR   NOTHIGH,R6               VALUE OK, GO TO CHECK 'OWAITHI' 28440002
         SPACE 1                                                        28500002
BADBFNO  EQU   *                                                        28560002
         LR    R10,R2                   SET UP PARM ADDR IN KEYWORD     28620002
*                                       TABLE FOR SUBROUTINE            28680002
         BAL   R14,BADPARM              GO TO RTN FOR ERROR MSG         28740002
         SPACE 1                                                        28800002
*                                                                       28850002
* NOTE - TO PICK UP USERMAX VALUE AGAIN FROM THE KEYWORD TABLE          28852402
*        SEEMS TO BE REDUNDANT IF FLOW OF CONTROL IS FROM ABOVE,        28852802
*        (VALUE NEEDED STILL IS R3), BUT IT IS ESSENTIAL                28853202
*        WHEN ARRIVING HERE VIA BRANCH FROM LABEL 'COMPTOBF'.           28853602
*                                                                       28858002
DEFTBFNO EQU   *                                                        28860002
         LA    R9,USERMAX               POINT TO USERMAX ENTRY IN       28910002
*                                       KEYWORD TABLE                   28960002
         DROP  R2                       * TEMPORARILY MAPPING USERMAX   29010002
         USING KYWDSECT,R9              * ENTRY IN KEYWORD TABLE        29020002
         L     R9,PVALUE                GET NO. OF TS TERMINALS FOR     29030002
*                                       MULTIPLICATION                  29100002
         DROP  R9                       R9 NO LONGER BASE FOR KYWDSECT  29150002
         USING KYWDSECT,R2              R2 RESUMES ADDRESSABILITY TO    29152002
*                                       PARAMETER KEYWORD ENTRY         29154002
         LA    R8,E6                    6 X USERMAX                     29160002
         MR    R8,R8                    GOT DEFAULT VALUE FOR BUFFERS   29220002
         C     R9,MAXIMUM               DOES IT EXCEED MAXIMUM          29270002
         BNH   STBFNO                   NO, IT IS OK                    29272002
         L     R9,MAXIMUM               GET MAXIMUM VALUE ALLOWED       29274002
         SPACE 1                                                        29276002
STBFNO   EQU   *                                                        29278002
         ST    R9,PVALUE                PUT DEFAULT VALUE IN TABLE      29280002
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT VALUE USED     29340002
         BR    R6                       CONTINUE VALIDITY CHECKING      29400002
         SPACE 3                                                        29460002
*                                                                       29520002
* 'OWAITHI' VALIDITY CHECK - MINIMUM IS 1, MAXIMUM IS 32,767, DEFAULT   29580002
*                            IS 20                                      29640002
*                                                                       29700002
         SPACE 1                                                        29760002
CHKOWTHI EQU   *                                                        29820002
         LA    R3,OWAITHI               POINT TO 'OWAITHI' ENTRY IN     29880002
*                                       KEYWORD TABLE                   29940002
         BAL   R5,OWTNLKHI              GO TO COMMON CHECK RTN          30000002
         SPACE 3                                                        30060002
*                                                                       30120002
* 'OWAITLO' VALIDITY CHECK - MUST BE LESS THAN BOTH 'OWAITI' AND        30180002
*                            'BUFFERS', DEFAULT IS 4                    30240002
         SPACE 1                                                        30300002
CHKOWTLO EQU   *                                                        30360002
         LA    R4,OWAITLO               POINT TO 'OWAITLO' ENTRY IN     30420002
*                                       KEYWORD TABLE                   30480002
         BAL   R6,OWTNLKLO              GO TO COMMON CHECK RTN          30540002
         SPACE 3                                                        30600002
*                                                                       30660002
* 'INLOCKHI' VALIDITY CHECK - MINIMUM IS 1, MAXIMUM IS 32,767, DEFAULT  30720002
*                             IS 4                                      30780002
         SPACE 1                                                        30840002
CHKNLKHI EQU   *                                                        30900002
         LA    R3,INLOCKHI              POINT TO 'INLOCKHI' ENTRY       30960002
         BAL   R5,OWTNLKHI              GO TO COMMON CHECK RTN          31020002
         SPACE 3                                                        31080002
*                                                                       31140002
* 'INLOCKLO' VALIDITY CHECK - MUST BE LESS THAN BOTH 'INLOCKHI' AND     31200002
*                             'BUFFERS', DEFAULT IS 1                   31260002
*                                                                       31320002
         SPACE 1                                                        31380002
CHKNLKLO EQU   *                                                        31440002
         LA    R4,INLOCKLO              POINT TO 'INLOCKLO' ENTRY       31500002
         BAL   R6,OWTNLKLO              GO TO COMMON CHECK RTN          31560002
         SPACE 3                                                        31620002
*                                                                       31680002
* 'RESVBUF' VALIDITY CHECK - MINIMUM IS 1, MAXIMUM IS NO. OF BUFFERS,   31740002
*                            DEFAULT IS TEN PER CENT OF NO. OF BUFFERS  31800002
*                                                                       31860002
         SPACE 1                                                        31920002
CHKRSVBF EQU   *                                                        31980002
         LA    R2,RESVBUF               POINT TO 'RESVBUF' ENTRY        32040002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              32100002
         BZ    DEFTRSBF                 NO, USE DEFAULT VALUE           32160002
         L     R4,PVALUE                GET SPECIFIED VALUE             32220002
         LTR   R4,R4                    IS VALUE 0                      32280002
         BZ    BADRSBF                  YES, VALUE IS INVALID           32340002
         CR    R4,R9                    IS VALUE LT/EQ 'BUFERS'         32400002
         BNH   CHKRCLIM                 YES, GO TO CHECK RECONLIM       32460002
         SPACE 1                                                        32520002
BADRSBF  EQU   *                                                        32580002
         LR    R10,R2                   SET UP PARM ADDR IN KEYWORD     32640002
*                                       TABLE FOR SUBROUTINE            32700002
         BAL   R14,BADPARM              WRITE ERROR MESSAGE             32760002
         SPACE 1                                                        32820002
DEFTRSBF EQU   *                                                        32880002
         LA    R0,E10                   DEFAULT IS TEN PER CENT         32940002
*                                       OF TOTAL NUMBER OF BUFFERS      33000002
         LR    R5,R9                    GET TOTAL NO. OF BFRS           33060002
         SR    R4,R4                    CLEAR REG FOR DEVIDE            33120002
         DR    R4,R0                    BFR NO. DEVIDED BY 10           33180002
         LTR   R4,R4                    ANY REMAINDER                   33240002
         BZ    STOREIT                  NO, QUOTIENT IS DEFAULT VALUE   33300002
         LA    R5,E1(,R5)               ROUND UP DEFAULT                33360002
         SPACE 1                                                        33420002
STOREIT  EQU   *                                                        33480002
         ST    R5,PVALUE                PUT DEFAULT VALUE IN TABLE      33540002
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT                33600002
         SPACE 3                                                        33650002
*                                                                       33700002
* 'RECONLIM' VALIDITY CHECK - MINIMUM IS 0, MAXIMUM IS 32,767, DEFAULT  33710002
*                             IS 0 (NO RECONNECT)                       33712002
*                                                                       33712402
*        NO CHECKING IS NECESSARY HERE SINCE BOTH UPPER AND LOWER       33712802
*        LIMITS WERE CHECKED WHILE CONVERTING EBCDIC VALUE TO           33713202
*        BINARY WHEN THE PARAMETER RECORDS WERE READ.  (SEE             33713702
*        LABEL 'PACKIT')                                                33713802
*                                                                       33713902
*        NO DEFAULTING IS NECESSARY EITHER, SINCE DEFAULT VALUE         33714402
*        IS ZERO.                                                       33714802
*                                                                       33715202
CHKRCLIM EQU   *                                                        33715502
         B     CNTRLBLK                 GO TO BUILD CONTROL BLOCKS      33739902
         SPACE 3                                                        33760002
*                                                                       33780002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 33840002
*                                                                       33900002
*              THIS ROUTINE IS TO VALIDITY CHECK BOTH 'OWAITHI' AND     33960002
*              'INLOCKHI'.   INPUT EXPECTED -                           34020002
*                                                                       34080002
*              REG 3 PROPER KEYWORD TABLE ENTRY ADDRESS                 34140002
*              REG 5 RETURN ADDRESS                                     34200002
*                                                                       34260002
*              NOTE - MAXIMUM VALUE OF BOTH KEYWORDS HAS ALREADY        34310002
*                     BEEN CHECKED, SEE LABEL 'PACKIT'.                 34312002
*                                                                       34314002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 34320002
*                                                                       34380002
OWTNLKHI EQU   *                                                        34440002
         DROP  R2                                                       34500002
         USING KYWDSECT,R3                                              34560002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              34620002
         BZ    DEFTHI                   NO, DEFAULT 'HIGH'              34680002
         L     R7,PVALUE                GET SPECIFIED VALUE             34740002
         LTR   R7,R7                    IS VALUE 0                      34980002
         BNP   BADHI                    YES, USE DEFAULT VALUE  YM01176 35040002
         BR    R5                       GO BACK TO MAINLINE             35100002
         SPACE 1                                                        35160002
BADHI    EQU   *                                                        35220002
         LR    R10,R3                   SET UP PARM ADDR IN KEYWORD     35280002
*                                       TABLE FOR SUBROUTINE            35340002
         BAL   R14,BADPARM              GO TO SEND OUT ERROR MSG        35400002
         SPACE 1                                                        35450002
DEFTHI   EQU   *                                                        35460002
         SR    R7,R7                    CLEAR REGISTER                  35520002
         IC    R7,PDEFAULT              GET DEFAULT VALUE               35580002
         ST    R7,PVALUE                PUT IN KEYWORD TABLE            35640002
         NI    PFLAG,NOT-PUSER          INDICATE VALUE IS DEFAULT       35700002
         BR    R5                       GO BACK TO MAINLINE             35760002
         SPACE 3                                                        35820002
*                                                                       35880002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 35940002
*                                                                       36000002
*              THIS ROUTINE IS TO VALIDITY CHECK 'OWAITLO' AND          36060002
*              'INLOCKLO'.                                              36120002
*                                                                       36180002
*              INPUT EXPECTED -                                         36190002
*                                                                       36200002
*              REG 3 'OWAITHI/INLOCKHI' ENTRY ADDRESS IN                36230002
*                    KEYWORD TABLE                                      36232002
*              REG 4 PROPER ENTRY ADDRESS IN KEYWORD TABLE              36240002
*              REG 6 RETURN ADDRESS                                     36300002
*              REG 9 TOTAL NUMBER OF BUFFERS                            36420002
*                                                                       36480002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 36540002
*                                                                       36600002
OWTNLKLO EQU   *                                                        36660002
         DROP  R3                                                       36720002
         USING KYWDSECT,R4                                              36780002
         TM    PFLAG,PUSER              IS VALUE SPECIFIED              36840002
         BZ    DEFTLO                   NO, USE DEFAULT VALUE           36900002
         L     R5,PVALUE                GET SPECIFIED VALUE             36960002
         SPACE 1                                                        36970002
COMPHIGH EQU   *                                                        37010002
         DROP  R4                       DROP KEYWORD ENTRY BASE         37012002
         USING KYWDSECT,R3              USE R3 AS KEYWORD ENTRY BASE    37014002
         C     R5,PVALUE                IS IT LESS THAN 'HIGH'          37020002
         BL    COMPTOBF                 YES, COMPARE WITH 'BUFFERS'     37080002
         DROP  R3                       DROP KEYWORD ENTRY BASE         37130002
         USING KYWDSECT,R4              USE R4 AS KEYWORD ENTRY BASE    37180002
         TM    PFLAG,PUSER              IS 'LOW' DEFAULT                37260002
         BO    BADLO                    NO, 'LOW' IS INVALID            37320002
         LA    R5,COMPTOBF              SET UP RETURN ADDRESS           37380002
         B     BADHI                    GO TO RTN HANDLING BAD 'HIGH'   37440002
         SPACE 1                                                        37500002
COMPTOBF EQU   *                                                        37560002
         L     R5,PVALUE                GET 'LOW' VALUE                 37740002
         CR    R5,R9                    IS 'LOW' LESS THAN 'BUFFERS'    37800002
         BCR   LOW,R6                   YES, 'LOW' OK                   37860002
         TM    PFLAG,PUSER              IS 'LOW' DEFAULT                37920002
         BO    BADLO                    NO, 'LOW' IS INVALID            37980002
         LA    R6,CHKNLKHI              SET UP RETURN ADDRESS           38040002
         B     BADBFNO                  'BUFFERS' IS INVALID            38100002
         SPACE 1                                                        38160002
BADLO    EQU   *                                                        38220002
         LR    R10,R4                   SET UP PARM ADDR IN KEYWORD     38280002
*                                       TABLE FOR SUBROUTINE            38340002
         BAL   R14,BADPARM              SEND OUT 'LOW' ERROR MSG        38400002
         SPACE 1                                                        38460002
DEFTLO   EQU   *                                                        38520002
         SR    R5,R5                    CLEAR REGISTER                  38580002
         IC    R5,PDEFAULT              GET 'LOW' DEFAULT VALUE         38640002
         ST    R5,PVALUE                PUT VALUE IN TABLE              38700002
         NI    PFLAG,NOT-PUSER          INDICATE DEFAULT                38760002
         B     COMPHIGH                 GO TO COMPARE WITH 'HIGH'       38810002
         DROP  R4                       DROP KEYWORD ENTRY BASE         38860002
         SPACE 3                                                        38880002
         SPACE 3                                                        38940002
         SPACE 3                                                        39000002
*                                                                       39060002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 39120002
*                                                                       39180002
*              COMPUTE AMOUNT OF STORAGE NEEDED FOR RPT,                39240002
*              TSB TABLE AND BUFFERS                                    39300002
*                                                                       39360002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 39420002
*                                                                       39480002
CNTRLBLK EQU   *                                                        39540002
         USING KYWDSECT,R2                                              39660002
         LA    R2,BUFSIZE               POINTS TO 'BUFSIZE' ENTRY IN    39720002
*                                       KEYWORD TABLE                   39780002
         L     R3,PVALUE                GET BUFFER SIZE                 39840002
         SR    R0,R0                    CLEAR REGISTER FOR DEVIDE       39900002
         LH    R1,ONEPAGE               GET PAGE SIZE                   39960002
         DR    R0,R3                    NO. OF BUFRS PER PAGE IN R1     40020002
         STH   R1,PGBUFNO               SAVE IT IN WORK AREA            40080002
         LA    R2,BUFFERS               POINTS TO 'BUFFERS' ENTRY       40140002
         L     R5,PVALUE                GET TOTAL NO. OF BUFFERS        40200002
         SR    R4,R4                    CLEAR REGISTER FOR DEVIDE       40260002
         DR    R4,R1                    NO. OF PAGES NEEDED IN R5       40320002
*                                       R4 HAS NO. OF BFRS ON LAST PG   40380002
*                                                                       40390002
*  CALCULATE SIZE OF LAST SECTION OF BUFFERS                            40400002
*                                                                       40410002
         LTR   R4,R4                    DOES ALL BFRS FIT IN FULL PAGES 40430002
         BNZ   SAVEIT                   NO, SAVE THE REMAINDER          40432002
         LR    R4,R1                    PUT ONE FULL PAGE ON LAST SECT  40434002
         BCTR  R5,R0                    ONE LESS NO. OF FULL PAGES      40434402
         SPACE 1                                                        40436002
SAVEIT   EQU   *                                                        40438002
         STH   R4,LPGBUFNO              SAVE NO. OF BFRS ON LAST PAGE   40440002
         STH   R5,BFRPAGE               SAVE NO. OF FULL PAGES FOR BFR  40490002
         LR    R2,R4                    .BUFSIZE X NO. OF BFRS ON LAST  40560002
         MR    R2,R2                    .PAGE = NO. OF BYTES NEEDED FOR 40620002
*                                       .BFRS ON LAST PAGE (IN R3)      40680002
         LR    R4,R3                    SAVE IT IN ANOTHER REGISTER     40682002
*                                                                       40690002
*  CALCULATE TIOCRPT SIZE                                               40730002
*                                                                       40780002
         LA    R5,E1(,R5)               NO. OF ENTRIES IN RPT FREE      40860002
*                                       BFR LIST                        40920002
         SLL   R5,E2                    MULTIPLY BY SIZE OF EACH ENTRY  41100002
         LA    R9,TIOCFBFL-TIOCRPT      GET RPT BASIC SECTION SIZE      41160002
         AR    R5,R9                    RPT SIZE IN R5                  41220002
         STH   R5,RPTSIZE               SAVE RPT SIZE IN WORK AREA      41230002
         AR    R4,R5                    STORAGE NEEDED FOR BUFFERS ON   41240002
*                                       LAST PAGE PLUS RPT              41250002
         LA    R4,E7(,R4)               * MAKE SURE TSB STARTS          41270002
         N     R4,DWBNDY                * ON DOUBLE WORD BOUNDARY       41274002
*                                                                       41290002
*  CALCULATE SIZE OF TSB TABLE                                          41300002
*                                                                       41310002
         LA    R2,USERMAX               POSITION BASE REGISTER          41330002
         L     R5,PVALUE                GET USERMAX VALUE               41380002
         LR    R6,R5                    PUT IT IN R6                    41400002
         LA    R7,TSBEND-TSB            GET TSB SIZE                    41460002
         MR    R6,R6                    STORAGE NEEDED FOR TSB'S IS IN  41520002
*                                       R7                              41580002
*                                                                       41630002
*  TOTAL SIZE FOR LAST SECTION OF BUFFERS, TIOCRPT AND TSB TABLE        41632002
*                                                                       41634002
         AR    R7,R4                    STORAGE NEEDED FOR LAST PAGE(S) 41700002
         ST    R7,LASTPAGE              SAVE IT IN WORK AREA            41820002
         SPACE 1                                                        41870002
         GETMAIN RC,LV=(R7),SP=TIOCSP,BNDRY=PAGE GET STORAGE FOR RPT,   41940002
*                                       TSB TABLE AND BUFFERS           42000002
         SPACE 1                                                        42060002
         LTR   R15,R15                  WAS STORAGE ALLOCATED           42120002
         BNZ   ERROR07                  GETMAIN FAILED                  42180002
*                                                                       42240002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 42300002
*                                                                       42360002
*              INITIALIZE TIOCRPT                                       42420002
*                                                                       42480002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 42540002
*                                                                       42600002
         USING TIOCRPT,R7               ADDRESSABILITY FOR RPT          42660002
         USING TSB,R8                   ADDRESSABILITY FOR TSB          42720002
         USING TIOCBUF,R9               ADDRESSABILITY FOR BUFFERS      42780002
         LR    R7,R1                    ADDR OF PAGE JUST OBTAINED      42840002
         AR    R7,R3                    GET TO BEGINNING OF RPT         42900002
         ST    R7,RPTADDR               SAVE TIOCRPT ADDRESS            42960002
         LH    R8,RPTSIZE               GET RPT SIZE                    43020002
         BCTR  R8,R0                    DECREMENT FOR EX                43080002
         EX    R8,ZERORPT               ZERO OUT RPT                    43140002
         LA    R2,BUFFERS               POINTS TO 'BUFFERS' ENTRY       43200002
*                                       IN KEYWORD TABLE                43260002
         L     R0,PVALUE                GET TOTAL NO. OF TS BUFFERS     43320002
         STH   R0,TIOCNBF               INITIALIZE TIOCNBF FIELD        43380002
         STH   R0,TIOCNFBF              INITIALIZE TIOCNFBF             43440002
         LA    R2,BUFSIZE               R2 POINTS TO 'BUFSIZE' ENTRY    43500002
*                                       IN KEYWORD TABLE                43560002
         L     R0,PVALUE                GET BFR SIZE                    43620002
         STH   R0,TIOCBFSZ              PUT BFR SIZE IN RPT             43680002
         STH   R5,TIOCNTSB              NO. OF TSB'S                    43740002
         LA    R2,OWAITLO               R2 POINTS TO 'OWAITLO' ENTRY    43800002
*                                       IN KEYWORD TABLE                43860002
         L     R0,PVALUE                GET 'OWAITLO'                   43920002
         STH   R0,TIOCOWTH              'OWAITLO' IS OWAIT THRESHOLD    43980002
         LA    R2,INLOCKLO              POSITION R2                     44040002
         L     R0,PVALUE                GET 'INLOCKLO'                  44100002
         STH   R0,TIOCRSTH              'INLOCKLO' IS RESTART THRESHOLD 44160002
         LA    R2,OWAITHI               POSITION R2                     44220002
         L     R0,PVALUE                GET 'OWAITHI'                   44280002
         STH   R0,TIOCAOMX              'OWAITHI' IS AOMX               44340002
         LA    R2,INLOCKHI              POSITION R2                     44400002
         L     R0,PVALUE                GET 'INLOCKHI'                  44460002
         STH   R0,TIOCAIMX              'INLOCKHI' IS AIMX              44520002
         LA    R2,RESVBUF               POSITION R2                     44570002
         L     R0,PVALUE                GET 'RESVBUF' VALUE             44572002
         STH   R0,TIOCUSLW              INITIALIZE TIOCUSLW FIELD       44574002
         LA    R2,RECONLIM              POSITION BASE REGISTER          44576002
         L     R0,PVALUE                GET USERMAX VALUE               44578002
         STH   R0,TIOCRCLM              PUT IT IN TIOCRPT               44578402
         LH    R2,BFRPAGE               GET NO. OF FULL PAGES FOR BFRS  44580002
         LA    R2,E1(,R2)               ADD 1 TO BFR PAGES              44760002
         STH   R2,TIOCNBFL              NO. OF ENTRIES IN FREE BFR LIST 44940002
         LA    R8,E0(R4,R1)             GET ADDR OF TSB TABLE           45000002
*                                       (R1 HAS BEGINNING OF BUFFER     45050002
*                                       ADDR, R4 HAS STORAGE NEEDED FOR 45100002
*                                       BUFFERS ON LAST PAGE AND RPT    45150002
         ST    R8,TIOCTSB-1             PUT IT IN RPT                   45180002
         LA    R0,TSBEND-TSB            GET SIZE OF TSB                 45240002
         STC   R0,TIOCTSBS              PUT IT IN RPT                   45300002
         ST    R1,TIOCFBFL              FREE BUFFER LIST                45480002
         LR    R9,R1                    PUT BFR ADDR IN R9              45540002
         LNR   R3,R1                    NEGATIVE VALUE OF PAGE ADDRESS  45600002
*                                                                       45660002
* GET QTIP BRANCH ENTRY ADDRESS                                         45720002
*                                                                       45780002
         SPACE 1                                                        45840002
QTIPBRAD EQU   *                                                        45900002
         LOAD  EP=IEDAYQT1,DCB=0        GET QTIP BRANCH ENTRY ADDR      45960002
         SPACE 2                                                        46020002
         ST    R0,TIOCQTIP              PUT QTIP ENTRY ADDR IN RPT      46080002
         SPACE 3                                                        46140002
*                                                                       46200002
*                                                                       46260002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 46320002
*                                                                       46380002
*              INITIALIZE TSB'S                                         46440002
*                                                                       46500002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 46560002
*                                                                       46620002
*                                                                       46680002
         LH    R0,TIOCNTSB              GET NO. OF TSB'S FOR CTR        46740002
         SPACE 1                                                        46800002
CLEARTSB EQU   *                                                        46860002
         XC    TSBSTAT(TSBEND-TSB),TSBSTAT  CLEAR TSB                   46920002
         LA    R8,TSBEND-TSB(,R8)       POINTS TO NEXT TSB              46980002
         BCT   R0,CLEARTSB              BR UNTIL ALL TSB'S ARE DONE     47040002
         DROP  R8                                                       47100002
         SPACE 3                                                        47160002
         LA    R8,TIOCFBFL              POINT TO FREE BFR LIST IN RPT   47220002
         LH    R14,BFRPAGE              GET NO. OF PAGES FOR BUFFERS    47280002
         LH    R4,LPGBUFNO              GET NO. OF BFRS ON LAST PAGE    47330002
         SPACE 3                                                        47640002
*                                                                       47700002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 47760002
*                                                                       47820002
*              CHAIN BUFFERS                                            47880002
*                                                                       47940002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 48000002
*                                                                       48060002
CHAINBFR EQU   *                                                        48120002
         BCTR  R4,R0                    1 LT BFR NO. IN THIS PAGE       48180002
         LTR   R4,R4                    IS THIS THE LAST BFR            48240002
         BNP   LASTBFR                  YES, BRANCH                     48300002
         LH    R10,TIOCBFSZ             GET BUFFER SIZE                 48360002
         LNR   R6,R10                   NEG BFR SIZE FOR INDEXING       48420002
         SPACE 1                                                        48480002
LINKBFR  EQU   *                                                        48540002
         AR    R9,R10                   POINT TO NEXT BFR               48600002
         ST    R9,BUFFTRLR-1-TIOCBUF(R6,R9) CHAIN BUFFER                48660002
         BCT   R4,LINKBFR               BR UNTIL ALL BFRS CHAINED       48720002
         SPACE 1                                                        48780002
LASTBFR  EQU   *                                                        48840002
         ST    R3,BUFFTRLR-1            LAST BFR HAS NEGATIVE VALUE     48900002
*                                       OF PAGE ADDRESS                 48960002
         SPACE 1                                                        49020002
FULLPAGE EQU   *                                                        49080002
         LTR   R14,R14                  ANY FULL PAGE BFR NEEDED        49140002
         BZ    FINALE                   NO, GO TO DO FINAL THINGS       49200002
*                                                                       49260002
         LH    R2,ONEPAGE               SIZE FOR ONEPAGE                49320002
         GETMAIN RC,LV=(R2),SP=TIOCSP,BNDRY=PAGE GET STORAGE FOR BFRS   49380002
*                                                                       49440002
         LTR   R15,R15                  WAS STORAGE ALLOCATED           49500002
         BNZ   ERROR09                  NO, CANNOT PROCEED              49560002
         BCTR  R14,R0                   DECREMENT PAGE COUNT            49620002
         LA    R8,E4(,R8)               POINT TO NEXT ENTRY OF FREE     49680002
*                                       BUFFER LIST IN RPT              49740002
         ST    R1,E0(,R8)               PUT PAGE ADDR IN RPT            49800002
         LR    R9,R1                    ADDRESS OF FIRST BUFFER         49860002
         LNR   R3,R1                    NEGATIVE VALUE OF PAGE ADDRESS  49920002
         LH    R4,PGBUFNO               GET NO. OF BFRS PER PAGE        49980002
         B     CHAINBFR                 BR TO CHAIN BUFFERS             50040002
         DROP  R2                       KEYWORD TABLE NOT ADDRESSABLE   50042002
         SPACE 3                                                        50050002
*                                                                       50160002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 50220002
*                                                                       50280002
*              WRITE RECORD TYPE 31 FOR SMF                             50340002
*                                                                       50400002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 50460002
*                                                                       50520002
FINALE   EQU   *                                                        50570002
         L     R3,CVTPTR                GET CVT ADDR                    50640002
         USING CVT,R3                   CVT ADDRESSABLE                 50700002
         L     R2,CVTSMCA               GET SMCA ADDRESS                50760002
         LTR   R2,R2                    IS SMCA IN THE SYSTEM           50820002
         BZ    TSABOFF                  NO, GO TO TURN OFF TS ABEND     50880002
*                                       INDICATOR                       50940002
         XC    TTISMF(RCDSIZE),TTISMF   ZERO OUT RECORD                 51000002
         LA    R2,RCDSIZE               GET SIZE OF                     51060002
         STH   R2,TTIRLEN               RECORD TYPE 31                  51120002
         MVI   TTIRCDTY,TYPE31          RECORD TYPE 31                  51180002
         LH    R2,TIOCNFBF              TOTAL NUMBER OF                 51240002
         STH   R2,TTINBF                TIOC BUFFERS                    51300002
         LH    R2,TIOCBFSZ              TIOC BUFFER                     51360002
         STH   R2,TTIBUFSE              SIZE IN BYTES                   51420002
         L     R2,TIOCAOMX              OWAIT MAX AND                   51480002
         ST    R2,TTIOMAX               INLOCK MAX                      51540002
         L     R2,TIOCOWTH              OWAIT THRESHOLD AND             51600002
         ST    R2,TTIOWTH               RESTART THRESHOLD               51660002
         LH    R2,TIOCUSLW              NUMBER OF BFRS RESERVED         51720002
         STH   R2,TTIUSLW               ON THE FREE QUEUE               51780002
         IC    R2,TIOCTSBS              SIZE OF                         51840002
         STC   R2,TTITSBS               TSB'S                           51900002
         LA    R1,TTISMF                PUT SMF RCD ADDR IN R1          51960002
         SMFWTM (1)                     SEND THIS RECORD TO SMF         52020002
         SPACE 3                                                        52080002
*                                                                       52140002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 52200002
*                                                                       52260002
*            * PUT TIOCRPT ADDRESS AND TSINPUT'S QCB ADDRESS IN TCX     52360002
*            * TURN OFF TS ABEND INDICATOR IN TCAM AVT                  52410002
*            * PUT QTIP ENTRY ADDRESS IN SVC TABLE                      52460002
*                                                                       52500002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 52560002
*                                                                       52620002
TSABOFF  EQU   *                                                        52680002
         L     R4,CVTAQAVT              GET TCX ADDR                    52730002
         USING IEDQTCX,R4               TCX ADDRESSABLE                 52780002
         L     R0,RPTADDR               GET TIOCRPT ADDRESS             52830002
         ST    R0,TCXRPT                PUT RPT ADDR IN TCX             52880002
         L     R2,OPCAVTPT              GET TCAM AVT ADDRESS            52930002
         USING IEDQAVTD,R2              ADDRESSABILITY                  52940002
         NI    AVTBIT3,NOT-AVTTSAB      TURN OFF ABEND INDICATOR        52950002
         L     R0,AVTTSOPT              GET TSINPUT'S QCB ADDRESS       52960002
         ST    R0,TCXTSI                PUT IT IN TCX                   52970002
         L     R2,CVTABEND              GET SECONDARY CVT ADDR          52980002
         DROP  R2                       DROP TCAM AVT BASE              53030002
         USING SCVTSECT,R2              ADDRESSABILITY FOR SEC'DARY CVT 53032002
         L     R2,SCVTSVCT              GET SVC TABLE ADDRESS           53040002
         DROP  R2                       DROP SECONDARY CVT BASE         53090002
         LA    R4,QTIP                  GET QTIP SVC NO.                53100002
         SLL   R4,E3                    MULTIPLY BY 8 TO GET OFFSET     53160002
*                                       TO SLOT FOR SVC 101             53220002
         LOAD  EP=IEDAYQT,DCB=0         GET QTIP MAIN ENTRY ADDRESS     53280002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    53340002
         ST    R0,E0(R4,R2)             PUT IT IN SVC TABLE             53400002
         SPACE 3                                                        53698502
*                                                                       53698602
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 53698702
*                                                                       53698802
*              ATTACH IEDAY802                                          53714002
*                                                                       53724002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 53726002
*                                                                       53728002
         MODESET EXTKEY=TCAM            CHANGE BACK INTO TCAM'S KEY     53728402
         ATTACH EP=IEDAY802             ATTACH IEDAY802                 53728802
         ST    R1,TIOCLDS               SAVE SUBTASK TCB ADDRESS        53729202
         DROP  R3,R4,R9                 DROP BASE REGISTERS             53729402
         L     R1,MSG019I               GET WTO'S PARMLIST              53744702
         BAL   R14,WTO                  TELL OPER TS IS INITIALIZED     53760002
         SPACE 3                                                        53820002
*                                                                       53880002
*                                                                       53940002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 54000002
*                                                                       54060002
*              FREE THE WORK AREA AND XCTL TO NEXT LOAD                 54120002
*                                                                       54180002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 54240002
*                                                                       54300002
*                                                                       54360002
FREEWA   EQU   *                                                        54420002
*                                                                       54480002
         IC    R2,CALLRKEY              SAVE CALLER'S KEY               54540002
         LA    R0,WAEND-WASTART         SIZE OF WORK AREA               54600002
FREEWAB  EQU   *                                                        54650002
         FREEMAIN R,LV=(0),A=(11)       FREE WORK AREA                  54720002
*                                                                       54780002
         SPKA  E0(R2)                   CHANGE BACK INTO CALLER'S KEY   54840002
         SPACE 3                                                        54900002
EXIT     EQU   *                                                        54960002
         L     R5,OPCCOPCE              GET ADDR OF OPC CONTROL ELEM    55020002
         USING IEDQOPCE,R5                                              55080002
         SR    R0,R0                    ZERO OUT REGISTER               55140002
         STH   R0,OCPARM                ZERO OUT BRANCH PARM            55200002
         L     R4,OPCAVTPT              REESTABLISH AVT BASE PTR        55380002
         LR    R1,ROPCAVT               R1 HAS OP CNTRL AVT ADDR        55440002
         XCTL  EP=IGC0710D              GIVE CONTROL TO NEXT LOAD       55490002
         DROP  R5                       DROP OPC CONTROL ELEM BASE      55540002
         SPACE 3                                                        55560002
*                                                                       55620002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 55680002
*                                                                       55740002
*              ERROR ROUTINES                                           55800002
*                                                                       55860002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 55920002
*                                                                       55980002
         SPACE 1                                                        56040002
ERROR01  EQU   *                                                        56100002
         LA    R0,SYNTAXID              GET ERROR MESSAGE ID            56150002
         LR    R1,ROPCAVT               PASS OP CONTROL AVT PTR         56200002
         XCTL  EP=IGC0310D              GIVE CONTROL TO ERROR MSG LOAD  56210002
         SPACE 3                                                        56220002
ERROR02  EQU   *                                                        56280002
         L     R1,MSG007I               GET ADDR OF PARMLIST            56340002
         BAL   R14,WTO                  TELL OPER TS IS ALREADY IN      56400002
*                                       PROGRESS                        56460002
         B     FREEWA                   FREE WORK AREA AND EXIT         56520002
         SPACE 3                                                        56580002
ERROR03  EQU   *                                                        56640002
         L     R1,MSG402I               GET ADDR OF PARMLIST            56700002
         BAL   R14,WTO                  TELL OPER TCAM PROC DOES NOT    56760002
*                                       SUPPORT TIME SHARING            56820002
         B     FREEWA                   FREE WORK AREA AND EXIT         56880002
         SPACE 3                                                        56940002
ERROR04  EQU   *                                                        57000002
         BAL   R14,UNALLOCA             UNALLOCATE PARMLIB              57060002
         SPACE 1                                                        57120002
ERROR041 EQU   *                                                        57180002
         L     R1,MSG414I               GET ADDR OF WTO PARMLIST        57240002
         BAL   R14,WTO                  TELL OPER PARMLIB OPEN FAILED   57300002
         B     CHKBFSZ                  USE DEFAULT VALUES              57360002
         SPACE 3                                                        57420002
ERROR06  EQU   *                                                        57480002
         L     R1,MSG006I               GET WTO PARMLIST ADDR           57540002
         BAL   R14,WTO                  TELL OPER I/O ERROR             57600002
         B     ERROR081                 GO TO USE DEFAULT VALUES        57660002
         SPACE 3                                                        57720002
ERROR07  EQU   *                                                        57780002
         L     R1,MSG404I               GET WTO PARMLIST ADDR           57840002
         BAL   R14,WTO                  SEND MSG FOR INSUFFICIENT       57900002
*                                       MAIN STORAGE                    57960002
         BAL   R14,CPARMLIB             CLOSE PARMLIB                   58020002
         B     FREEWA                   FREE WORK AREA AND EXIT         58080002
         SPACE 3                                                        58140002
ERROR08  EQU   *                                                        58200002
         L     R1,MSG408I               GET ADDR OF PARMLIST            58260002
         BAL   R14,WTO                  TELL OPER IKJPRM00              58320002
*                                       CANNOT BE FOUND                 58380002
ERROR081 EQU   *                                                        58440002
         BAL   R14,CPARMLIB             CLOSE PARMLIB                   58500002
         B     CHKBFSZ                  USE DEFAULT VALUES              58560002
         SPACE 3                                                        58620002
ERROR09  EQU   *                                                        58680002
         LA    R4,TIOCFBFL              AD OF SECT RPT RESIDES  YM03016 58730002
         L     R3,MINUS4                FOR INDEXING            YM03016 58730402
         LH    R2,ONEPAGE               SIZE FOR ONE PAGE       YM03016 58732302
         SPACE 1                                                        58736202
FREESTUP EQU   *                                                YM03016 58738102
         CR    R8,R4                    IS IT LAST SECT TO FREE YM03016 58740002
         BE    FREELAST                 YES, GO TO FREE LAST SECTION    58800002
         L     R1,E0(,R8)               GET ADDR OF PAGE TO FREE        59100002
         SPACE 1                                                        59220002
FREE     EQU   *                                                        59280002
         FREEMAIN R,LV=(2),A=(1),SP=TIOCSP  FREE 1 PAGE OF BUFFERS      59340002
         LTR   R3,R3                    WAS IT LAST PAGE JUST FREED     59400002
         BZ    ERROR07                  YES, SEND ERROR MSG             59460002
         LA    R8,E0(R3,R8)             BACK UP ONE ENTRY IN FREE       59580002
*                                       BUFFER LIST                     59640002
         B     FREESTUP                 FREE NEXT PAGE                  59700002
         SPACE 1                                                        59750002
FREELAST EQU   *                                                        60060002
         L     R1,E0(,R8)               GET ADDR OF PAST PAGE OF BFR    60300002
*                                       PLUS RPT AND TSB'S              60360002
         L     R2,LASTPAGE              GET SIZE OF LAST PAGE           60540002
         SR    R3,R3                    INDICATE LAST PAGE FREED        60600002
         B     FREE                     GO TO FREE STORAGE              60660002
         DROP  R7                                                       60720002
         SPACE 3                                                        60780002
*                                                                       60840002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 60900002
*                                                                       60960002
*              THIS ROUTINE CONVERTS THE PARAMETER VALUE                61020002
*              INTO EBCDIC AND WRITE THE ERROR MESSAGE                  61080002
*              TO THE OPERATOR CONSOLE                                  61140002
*                                                                       61200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 61260002
*                                                                       61320002
BADPARM  EQU   *                                                        61380002
         USING KYWDSECT,R10                                             61440002
         L     R1,MSG407I               GET ADDRESS OF WTO PARMLIST     61500002
         LH    R15,E0(,R1)              GET MSG LENGTH                  61560002
         BCTR  R15,R0                   DECREMENT FOR EX                61620002
         EX    R15,MOVEMSG              MOVE MSG TO WORK AREA           61680002
         LH    R7,PLENGTH               GET LENGTH OF PARM              61740002
         BCTR  R7,R0                    DECREMENT FOR EX                61800002
         EX    R7,MOVEPARM              MOVE PARAMETER TO MSG LIST      61860002
         LA    R8,MSGLIST+E38(R7)       POINT TO END OF KEYWORD         61920002
         MVI   E0(R8),EQUAL             PUT IN '=' SIGN                 61980002
         L     R7,PVALUE                GET INVALUD VALUE               62040002
         CVD   R7,DOUBLE1               CONVERT VALUE TO PACKED DECIMAL 62100002
         UNPK  DOUBLE2(E8),DOUBLE1(E8)  UNPACK TO EBCDIC                62160002
         OI    DOUBLE2+E7,XF0           MAKE LAST DIGIT PRINTABLE       62220002
         LA    R7,DOUBLE2+E3            POINT TO FIRST POSSIBLE CHAR    62280002
         LA    R15,E4                   1 LT MAX BAD VALUE LENGTH       62340002
         SPACE 1                                                        62400002
CHKZERO  EQU   *                                                        62460002
         CLI   E0(R7),XF0               IS IT ZERO                      62520002
         BNE   MOVEIT                   NO, MOVE VALUE                  62580002
         LA    R7,E1(,R7)               POINT TO NEXT CHAR              62640002
         BCT   R15,CHKZERO              CHECK NEXT CHAR IF IT IS 0      62700002
         SPACE 1                                                        62760002
MOVEIT   EQU   *                                                        62820002
         EX    R15,MOVEVAL              MOVE BAD VALUE                  62880002
         B     WTO001                   GO TO SEND ERROR MSG            62940002
         DROP  R10                                                      63000002
         SPACE 3                                                        63060002
*                                                                       63120002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63180002
*                                                                       63240002
*              MOVE WTO'S PARAMETER LIST TO THE WORK AREA               63300002
*              AND ISSUE WTO MACRO                                      63360002
*                                                                       63420002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 63480002
*                                                                       63540002
WTO      EQU   *                                                        63600002
         LH    R15,E0(,R1)              GET MSG LENGTH                  63660002
         LA    R15,E3(,R15)             ADD 1 LT THE LENGTH OF          63710002
*                                       DESCRIPTOR/ROUTING CODES        63760002
         EX    R15,MOVEMSG              MOVE MSG LIST TO WORK AREA      63780002
         SPACE 1                                                        63840002
WTO001   EQU   *                                                        63900002
         LA    R1,MSGLIST               SET UP FOR WTO                  63960002
         WTO   MF=(E,(1))               WRITE MSG OUT TO OPER CONSOL    64020002
         BR    R14                      GO BACK TO CALLER               64070002
         SPACE 3                                                        64140002
*                                                                       64200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 64260002
*                                                                       64320002
*              THIS SUBROUTINE FINDS OUT THE NUMBER OF TERMINALS        64380002
*              WHICH CAN BE USED FOR TIME SHARING                       64440002
*                                                                       64500002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 64560002
*                                                                       64620002
CTTSTERM EQU   *                                                        64680002
         USING IEDQTRM,R1               ADDRESSABILITY FOR TRM          64740002
         USING IEDQAVTD,R4              ADDRESSABILITY FOR TCAM AVT     64800002
         USING IEDQTNTD,R15             ADDRESSABILITY FOR TNT          64860002
*                                                                       64920002
* LOCATE THE TRM VIA INDEX IN REG 1 AND TNT ROUTINE                     64980002
*                                                                       65040002
         L     R4,OPCAVTPT              GET TCAM AVT ADDR               65100002
         SR    R5,R5                    INITIALIZE COUNTER              65160002
         L     R15,AVTRNMPT             GET TNT CODE ADDR               65220002
         LH    R8,TNTLEN                HIGHEST INDEX NO.               65280002
NEXTTRM  EQU   *                                                        65340002
         LR    R1,R8                    PUT INDEX IN REG 1              65400002
         BALR  R14,R15                  GO TO TNT CODE                  65460002
         L     R1,TRMDESTQ-E1           GET ADDRESS OF QCB              65510002
         DROP  R1                       R1 NO LONGER BASE FOR TRM       65512002
         USING IEDQQCB,R1               USE R1 AS QCB BASE              65514002
         TM    QCBDSFLG,QCBTSQ          CAN THIS TERM BE USED FOR TS    65520002
         BZ    CHKSTOP                  NO, SEE IF ANY MORE TERMINALS   65580002
*                                       TO CHECK                        65640002
         LA    R5,E1(,R5)               ADD 1 TO TS TERM NUMBER         65700002
         SPACE 1                                                        65760002
CHKSTOP  EQU   *                                                        65820002
         BCT   R8,NEXTTRM               CHECK NEXT TERM IF ANY          65880002
         BR    R10                      TO BACK TO CALLER               65940002
         DROP  R1,R4,R15                                                66000002
         SPACE 3                                                        66060002
*                                                                       66120002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 66180002
*                                                                       66240002
*              CLOSE SYS1.PARMLIB                                       66300002
*                                                                       66360002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 66420002
*                                                                       66480002
CPARMLIB EQU   *                                                        66540002
         LA    R1,OPENPARM              GET ADDR OF PARMLIST            66600002
         CLOSE MF=(E,(1))               CLOSE PARMLIB                   66660002
         SPACE 3                                                        66720002
*                                                                       66780002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 66840002
*                                                                       66900002
*              UNALLOCATE SYS1.PARMLIB                                  66960002
*                                                                       67020002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67080002
*                                                                       67140002
         SPACE 1                                                        67200002
UNALLOCA EQU   *                                                        67260002
         MVC   RQBLOCK(DAPLEND-DAPLIST),DAPLIST  RE-INTIALIZE REQUEST   67320002
*                                       BLOCK FOR UNALLOCATION          67420002
         MVI   VERBCODE,UNALLOC         REQUEST IS FOR UNALLOCATION     67422002
         MVC   WATEXT1,TEXT1            RE-INITIALIZE TEXT UNIT 1 IN WA 67430002
         LA    R1,WATPTR1               ADDR OF TEXT POINTER IN WA      67432002
         ST    R1,TEXTPTR               RELOCATE PTR TO TEXT PTR        67434002
         LA    R1,WATEXT1               ADDR OF TEXT UNIT 1 IN WA       67436002
         O     R1,HIBITON               SIGNAL LAST POINTER             67436402
         ST    R1,WATPTR1               RELOCATE WA TEXT POINTER 1      67438002
         LA    R1,RQBLKPTR              GET REQUEST BLOCK PTR           67440002
         DYNALLOC                       UNALLOCATE SYS1.PARMLIB         67500002
         BR    R14                      GO BACK TO CALLER               67560002
         DROP  RWABASE                  DROP WORK AREA BASE             67610002
         SPACE 3                                                        67620002
*                                                                       67800002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67850002
*                                                                       67850402
*              STOP TIME SHARING                                        67852002
*                                                                       67854002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67856002
*                                                                       67858002
STOP     EQU   *                                                        67860002
         IPK                            GET CALLER'S KEY IN REG 2       67870002
         LR    R10,R2                   SAVE IT IN REG 10               67880002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    67890002
         LA    R5,E1(,R3)               R5 POINTS TO OPC WORK AREA      67892002
*                                       AFTER 'TS='                     67894002
         L     R3,CVTPTR                GET CVT ADDRESS                 67910002
         USING CVT,R3                   ADDRESSABILITY FOR CVT          67960002
         L     R4,CVTAQAVT              GET ADDRESS OF TCX              67970002
         USING IEDQTCX,R4               ADDRESSABILITY FOR TCX          67970102
         LR    R15,RBASE                SAVE BASE REGISTER              67970502
         LR    R6,ROPCAVT               SAVE OP CONTROL AVT PTR         67972502
         SPACE 1                                                        67972602
GTLOCAL  EQU   *                                                        67972702
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,      * GET LOCAL       X67973002
               RELATED=(TIOCRPT,IEDAY1(FREELCL))     * LOCK             67973402
         SPACE 1                                                        67973802
GTCMS    EQU   *                                                        67974202
         SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,        * GET CMS         X67974302
               RELATED=(TIOCRPT,IEDAY1(FREECMS))     * LOCK             67974402
         SPACE 3                                                        67974502
         LR    RBASE,R15                RESTORE BASE REGISTER           67974602
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          67974702
         L     R7,TCXRPT                GET TIOCRPT ADDRESS             67974802
         LTR   R7,R7                    IS TS IN PROGRESS               67974902
         BZ    RJCTSTOP                 NO, REJECT STOP TS REQUEST      67975202
         USING TIOCRPT,R7               ADDRESSABILITY FOR TIOCRPT      67977002
         TM    TIOCFLG,TIOCSTOP         IS TS STOP IN PROCESS           67978002
         BO    ASKREPLY                 YES, ASK FOR 'U' OR 'FSTOP'     67978402
         SPACE 3                                                        67978502
*                                                                       67978602
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67978702
*                                                                       67978802
*              SET ON TIOCSTOP FLAG                                     67979102
*                                                                       67979402
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 67979602
*                                                                       67980002
         SPACE 3                                                        67999702
         OI    TIOCFLG,TIOCSTOP         SET ON TS STOP FLAG             68019202
         LA    R5,E3(,R5)               * PICK AN ADDRESS ON WORD       68021202
         N     R5,MINUS4                * BOUNDARY IN OP CNTRL BFR      68023202
         L     R1,TIOCLDS               GET TIOC SUBTASK TCB ADDRESS    68025202
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    68026202
         ST    R1,E0(,R5)               SAVE TIOCLDS IN OP CNTRL BUFFER 68029002
         SPACE 3                                                        68030002
*                                                                       68031002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   68032002
*                                                                       68033002
*              LOGOFF EACH TIME SHARING USER                            68034002
*                                                                       68035002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   68036002
*                                                                       68037002
         LH    R9,TIOCUSCT              GET TIOC USE COUNT              68038002
         LTR   R9,R9                    IS THERE ANY TS USER ON         68039002
         BZ    DETAY802                 NO, GO TO DETACH TIOC SUBTASK   68040002
         SPACE 1                                                        68044702
*                                                                       68054702
*  LOGOFF EACH TIME SHARING USER                                        68064702
*                                                                       68065102
*        INTERFACE WITH SYSTEM INITIATED CANCEL -                       68065502
*                                                                       68065902
*        REGISTER  0 - POST CODE                                        68066302
*        REGISTER  1 - ASCB ADDRESS                                     68068002
*        REGISTER 13 - POINT TO A SAVE AREA                             68068402
*        REGISTER 14 - RETURN ADDRESS                                   68070002
*        REGISTER 15 - BRANCH ENTRY ADDRESS                             68072002
*                                                                       68072402
         LH    R2,TIOCNTSB              GET NUMBER OF TSB'S             68072802
         L     R8,TIOCTSB-E1            GET FIRST TSB ADDRESS           68074502
         USING TSB,R8                   ADDRESSABILITY FOR TSB          68076202
         LA    R13,TIOCSAVE             SET UP SAVE AREA POINTER        68077902
         SPACE 1                                                        68079602
TSBLOOP  EQU   *                                                        68081302
         TM    TSBSTAT,TSBINUSE         IS THIS TSB IN USE              68083002
         BNO   NEXTTSB                  NO, CHECK NEXT TSB              68084702
         L     R1,TSBASCBA              GET ASCB ADDRESS                68086402
         L     R0,POSTCODE              'POST CODE' FOR SIC             68088102
         L     R15,CVTSIC               GET BRANCH ENTRY ADDRESS TO SIC 68089802
         BALR  R14,R15                  GO TO SYSTEM INITIATED CANCEL   68091502
         SPACE 1                                                        68093202
NEXTTSB  EQU   *                                                        68094902
         LA    R8,TSBEND-TSB(,R8)       POINT TO NEXT TSB               68096602
         BCT   R2,TSBLOOP               CHECK NEXT TSB IF ANY           68098302
         SPACE 3                                                        68100002
*                                                                       68166102
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68166502
*                                                                       68166902
*              DETACH IEDAY802                                          68167302
*                                                                       68167702
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68167802
*                                                                       68167902
DETAY802 EQU   *                                                        68169002
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          68169102
         NI    TIOCTECB,NOT-WAITBIT     TURN WAIT BIT OFF               68169402
         OI    TIOCTECB,POSTBIT         TURN POST BIT ON                68169802
         BAL   R1,FREECMS               FREE LOCKS                      68171002
         DETACH E0(,R5)                 DETACH IEDAY802                 68172602
         SPACE 3                                                        68179202
*                                                                       68180302
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68181402
*                                                                       68182502
*              IF NO TIME SHARING USER ON, CALL TSEND TO FREE TIOC      68183602
*              STOREAGE.  IF THERE ARE TS USERS ON, TSEND WILL          68185602
*              BE CALLED BY IEDAY8 AFTER THE LAST USER HAS BEEN         68185702
*              LOGGED OFF.                                              68186702
*                                                                       68190002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68191002
*                                                                       68192002
         LTR   R9,R9                    ANY TIME SHARING USER ON        68193002
         BNZ   RESTOREK                 YES, EXIT TO NEXT LOAD          68194002
         TSEND                         ,CALL TSEND TO FREE TIOC STORAGE 68195002
         SPACE 1                                                        68196002
         B     RESTOREK                 GET BACK TO CALLER'S KEY        68197002
         SPACE 1                                                        68198002
RJCTSTOP EQU   *                                                        68199002
         BAL   R1,FREECMS               GO TO FREE LOCKS                68200002
         L     R1,MSG021I               GET ADDRESS OF MSG LIST         68201002
         WTO   MF=(E,(1))               REJECT STOP TS REQUEST          68202002
         SPACE 1                                                        68203002
RESTOREK EQU   *                                                        68204002
         LR    R2,R10                   GET CALLER'S KEY                68205002
         SPKA  E0(R2)                   CHANGE  BACK TO CALLER'S KEY    68206002
         B     EXIT                     EXIT TO NEXT LOAD               68207002
         SPACE 3                                                        68208002
*                                                                       68209002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68210002
*                                                                       68211002
*              FREE LOCK AND CROSS MEMORY LOCKS                         68212002
*                                                                       68213002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68214002
*                                                                       68215002
FREECMS  EQU   *                                                        68216002
         LR    R15,RBASE                SAVE BASE REGISTER              68217002
         MODESET EXTKEY=SUPR            CHANGE INTO SUPERVISOR'S KEY    68218002
         SETLOCK RELEASE,TYPE=CMS,               * FREE CMS            X68219002
               RELATED=(TIOCRPT,IEDAY1(GETCMS))  * LOCK                 68220002
         SPACE 1                                                        68221002
FREELCL  EQU   *                                                        68222102
         SETLOCK RELEASE,TYPE=LOCAL,             * FREE LOCAL          X68223202
               RELATED=(TIOCRPT,IEDAY1(GETLCL))  * LOCK                 68224302
         SPACE 1                                                        68225402
*                                       FREE LOCAL LOCK                 68226502
         LR    RBASE,R15                RESTORE BASE REGISTER           68227602
         LR    ROPCAVT,R6               RESTORE OP CONTROL AVT ADDR     68228702
         BR    R1                       RETURN TO CALLER OF SUBROUTINE  68229802
         SPACE 3                                                        68230902
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68232002
*                                                                       68233102
*              THIS SECTION OF CODE WILL BE ENTERED ONLY                68234202
*              IF TS STOP IS CALLED AGAIN WHEN IT IS IN                 68235302
*              PROGRESS.  IN SUCH CASE, THE OPERATOR IS ASKED           68236402
*              IF HE WANTS 'FSTOP'.  WHEN 'FSTOP' IS REQUESTED,         68237502
*              ISSUE TCABEND TO CANCEL ALL TIME SHARING USERS           68238602
*              AND FREE TIOC STORAGE.  OTHERWISE, JUST EXIT             68239702
*              TO LET NORMAL TS STOP FINISH ITS PROCESSING.             68240802
*                                                                       68241902
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 68243002
*                                                                       68244102
ASKREPLY EQU   *                                                        68245202
         BAL   R1,FREECMS               FREE LOCKS                      68246302
         MODESET EXTKEY=TCAM            CHANGE INTO TCAM'S KEY          68246702
         LA    R0,WASTOPND-WASTOP       SIZE OF WORK AREA               68247402
         GETMAIN R,LV=(0)               GET STORAGE FOR WORK AREA       68248502
         LR    RWABASE,R1               STORAGE RETURNED IN REG 1       68249602
         USING WASTOP,RWABASE           RWABASE IS THE BASE             68250702
         L     R2,MSG024D               GET MSG LIST ADDRESS            68251802
         MVC   MESSAGE,E0(R2)           MOVE MSG LIST TO WORK AREA      68252902
         LA    R2,REPLYECB              GET ADDRESS OF REPLY ECB        68254002
         ST    R2,ECBADDR               PUT IT IN MESSAGE LIST          68255102
         LA    R2,REPLY                 GET ADDRESS TO PLACE REPLY      68256202
         ST    R2,REPLYADD-E1           PUT IT IN MESSAGE LIST          68257302
         LA    R2,REPLYL                GET REPLY LENGTH                68258402
         STC   R2,REPLYLNG              PUT IT IN MESSAGE LIST          68259502
         SPACE 1                                                        68260602
WTOR     EQU   *                                                        68261702
         LA    R1,MESSAGE               POSITION R1 FOR WTOR            68262102
         SR    R0,R0                    CLEAR REGISTER                  68262502
         ST    R0,REPLYECB              ZERO OUT ECB                    68262602
         WTOR  ,,,,,MF=(E,(1))          INFORM OPERATOR TS STOP IN     -68262802
                                        PROGRESS, ASK REPLY U OR FSTOP  68263902
         SPACE 1                                                        68264002
         WAIT  ECB=REPLYECB,LONG=YES    WAIT FOR THE REPLY              68264302
         SPACE 1                                                        68264402
         OC    REPLY(E8),BLANKS         FOLD REPLY TO UPPER CASE        68264802
         CLC   CU,REPLY                 IS REPLY 'U'                    68265002
         BE    FREEWAP                  YES, NOTHING MORE TO DO         68266102
         CLC   CFSTOP(E5),REPLY         IS REPLY 'FSTOP'                68267202
         BNE   WTOR                     NO, LOOP BACK TO ASK AGAIN      68268302
         SPACE 1                                                        68269402
*        TCABEND                        CALL TCABEND TO FORCE STOP TS   68270502
         SPACE 1                                                        68270902
         LA    R0,ECABEND               LOAD ENTRY CODE         YM03842 68271302
         LA    R1,NOTDUMP               INFORM 9400 NOT TO DUMP YM03842 68271402
         SVC   TERMSTUS                 ISSUE TERM STATUS SVC   YM03842 68271502
         SPACE 1                                                        68271602
FREEWAP  EQU   *                                                        68272702
         LR    R2,R10                   GET CALLER'S KEY                68273802
         LA    R0,WASTOPND-WASTOP       SIZE OF WORK AREA               68274902
         B     FREEWAB                  FREE WORK AREA STORAGE AND EXIT 68276002
         DROP  R3,R4,R7,R8,RWABASE      DROP BASE REGISTERS             68277102
         SPACE 3                                                        68278202
         USING WASTART,RWABASE          START WORK AREA ADDRESSABLE     68279302
MOVENAME MVC   DOUBLE1(0),E7(R3)        MOVE MEMBER TO WORK AREA        68280402
MOVEMSG  MVC   MSGLIST(E0),E0(R1)       MOVE WTO PARM LIST TO WORK AREA 68281502
MOVEKYWD MVC   MSGLIST+E37(E0),E0(R3)   MOVE BAD PARM TO MSG LIST       68301002
MOVEVAL  MVC   E1(0,R8),E0(R7)          MOVE BAD VALUE TO MSG LIST      68320502
         USING IHADCB,R2                                                68340002
MOVEDDNM MVC   DCBDDNAM(E0),WADDNAM     MOVE DDNAME OF PARMLIB TO DCB   68400002
         DROP  R2                       DROP DCB BASE                   68460002
         USING KYWDSECT,R10             USE R10 AS KEYWORD ENTRY BASE   68520002
MOVEPARM MVC   MSGLIST+E37(E0),PKEYWORD MOVE KEYWORD TO MSG LIST        68580002
         DROP  R10                      DROP KEYWORD ENTRY BASE         68630002
         USING KYWDSECT,R2              USE R2 AS KEYWORD ENTRY BASE    68632002
COMPKYWD CLC   PKEYWORD(0),E0(R3)       COMPARE KEYWORD                 68640002
         DROP  R2                       DROP KEYWORD ENTRY BASE         68690002
PACKVALU PACK  DOUBLE1(E8),E1(0,R4)     PACK SPECIFIED VALUE            68700002
         USING TIOCRPT,R7               USE R7 AS RPT BASE              68760002
ZERORPT  XC    TIOCQTIP(0),TIOCQTIP     ZERO OUT RPT                    68820002
         SPACE 3                                                        68880002
*                                                                       68940002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 69000002
*                                                                       69060002
*              CONSTANTS                                                69120002
*                                                                       69180002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 69240002
*                                                                       69300002
CSTART   DC    C'START'                 USED TO SCAN FOR STARTING TS    69360002
CFSTOP   DC    C'F'                     USED TO SCAN FOR FORCE STOP     69410002
CSTOP    DC    C'STOP'                  USED TO SCAN FOR STOPPING TS    69420002
CTIOC    DC    CL5'TIOC'                USED TO SCAN FOR TIOC PARAMETER 69480002
CPRM00   DC    C'IKJPRM00'              MEMBER NAME OF INSTALLATION     69540002
*                                       DEFAULT OF START TS PARAMETERS  69550002
CU       DC    C'U'                     USED TO SCAN NORMAL STOP        69590002
MINUS4   DC    F'-4'                    USED TO ROUND UP BUFFER SIZE    69660002
MAXIMUM  DC    F'32767'                 MAXIMUM FOR BUFFER NUMBER,      69720002
*                                       OWAITHI AND INLOCKHI            69780002
BLANKS   DC    X'40404040'              FULL WORD OF BLANKS             69840002
         DC    X'40404040'              FULL WORD OF BLANKS             69890002
HIBITON  DC    X'80000000'              USED TO TURN HIGH ORDER BIT ON  69900002
DWBNDY   DC    X'FFFFFFF8'              USED TO ROUND UP TO DW BNDY     69952002
POSTCODE DC    X'00000622'              COMPLETION CODE FOR             69954002
*                                       TERMINATED MEMORY               69956002
ONEPAGE  DC    H'4096'                  PAGE SIZE                       69960002
MSGWRIT  DC    C'07'                    ID TO MOVE INTO OPCLDNME        70020002
*                                       IN OPCAVT                       70080002
MSG005I  DC    V(WTO005I)               ADDRESS OF MSG LIST             70140002
MSG006I  DC    V(WTO006I)               ADDRESS OF MSG LIST             70200002
MSG007I  DC    V(WTO007I)               ADDRESS OF MSG LIST             70260002
MSG019I  DC    V(WTO019I)               ADDRESS OF MSG LIST             70320002
MSG021I  DC    V(WTO021I)               ADDRESS OF MSG LIST             70380002
MSG024D  DC    V(WTO024D)               ADDRESS OF MSG LIST             70440002
MSG402I  DC    V(WTO402I)               ADDRESS OF MSG LIST             70500002
MSG404I  DC    V(WTO404I)               ADDRESS OF MSG LIST             70560002
MSG407I  DC    V(WTO407I)               ADDRESS OF MSG LIST             70620002
MSG408I  DC    V(WTO408I)               ADDRESS OF MSG LIST             70680002
MSG414I  DC    V(WTO414I)               ADDRESS OF MSG LIST             70740002
         SPACE 3                                                        70800002
*                                                                       70860002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 70920002
*                                                                       70980002
*              DCB FOR SYS1.PARMLIB                                     71040002
*                                                                       71100002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 71160002
*                                                                       71220002
PARMDCB  DCB   BLKSIZE=80,LRECL=80,DSORG=PO,EODAD=CLOSELIB,MACRF=(R),  X71280002
               RECFM=F,DEVD=DA,SYNAD=ERROR06,DDNAME=A                   71340002
ENDDCB   EQU   *                                                        71400002
         SPACE 3                                                        71460002
*                                                                       71520002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 71580002
*                                                                       71640002
*              REQUEST BLOCK FOR ALLOCATING PARMLIB                     71700002
*                                                                       71760002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 71820002
*                                                                       71880002
DAPLIST  DS    0F                                                       71940002
         DC    X'14'                    LENGTH OF REQUEST BLOCK         72000002
         DC    X'01'                    REQUEST FOR DSN ALLOCATION      72060002
         DC    XL2'0000'                USE IT, IF ALREADY ALLOCATED    72120002
         DC    XL2'0000'                USED BY SVC 99 FOR ERROR CODE   72180002
         DC    XL2'0000'                USED BY SVC 99 FOR ERROR INFO   72240002
         DC    A(0)                     PTR TO A LIST OF TEXT PTRS      72300002
         DC    F'0'                     RESERVED                        72360002
         DC    XL4'00000000'            NO SPECIAL REQUEST              72420002
DAPLEND  EQU   *                        END OF REQUEST BLOCK            72470002
             SPACE 1                                                    72540002
*                                                                       72600002
*  TEXT POINTERS                                                        72660002
*                                                                       72720002
TEXTPTRS DC    A(0)                     1ST TEXT POINTER                72780002
         DC    A(0)                     2ND TEXT POINTER                72840002
         DC    A(0)                     3RD TEXT POINTER                72900002
         DC    X'80',AL3(0)             4TH TEXT POINTER                72960002
             SPACE 1                                                    73020002
*                                                                       73080002
*  TEXT UNITS                                                           73140002
*                                                                       73200002
TEXT1    DC    XL2'0002'                DSNAME REQUEST                  73260002
         DC    XL2'0001'                NUMBER                          73320002
         DC    XL2'000C'                LENGTH OF PARM                  73380002
         DC    C'SYS1.PARMLIB'          DATA SET NAME                   73440002
         SPACE 1                                                        73500002
TEXT2    DC    XL2'0004'                DATA SET STATUS                 73560002
         DC    XL2'0001'                NUMBER                          73620002
         DC    XL2'0001'                LENGTH OF PARM                  73680002
         DC    XL1'08'                  SHARE                           73740002
         SPACE 1                                                        73800002
TEXT3    DC    X'0055'                  RETURN ALLOCATED DDNAME         73860002
         DC    X'0001'                  NUMBER                          73920002
         DC    X'0008'                  LENGTH OF PARM                  73980002
         DS    CL8                      DDNAME TO BE RETURNED           74040002
         SPACE 1                                                        74100002
TEXT4    DC    XL2'0005'                DISPOSITION                     74160002
         DC    XL2'0001'                NUMBER                          74220002
         DC    XL2'0001'                LENGTH OF PARM                  74280002
         DC    XL1'08'                  KEEP                            74340002
DAPEND   EQU   *                        END OF DYN ALLOCATION PARM LIST 74390002
         SPACE 3                                                        74400002
*                                                                       75840002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 75900002
*                                                                       75960002
*              TIOC PARAMETER KEYWORD TABLE                             76020002
*                                                                       76080002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 76140002
*                                                                       76200002
PARMTBL  DS    0F                       WORD BOUNDARY ALIGNMENT         76260002
         DC    X'00'                    FLAG                            76320002
         DC    AL1(64)                  BUFSIZE DEFAULT VALUE           76380002
         DC    H'7'                     LENGTH OF KEYWORD               76440002
         DC    C'BUFSIZE '              KEYWORD                         76500002
         DC    F'0'                     SPECIFIED BUFSIZE VALUE         76560002
         DC    X'00'                    FLAG                            76610002
         DC    AL1(0)                   USERMAX DEFAULT NOT USED        76612002
         DC    H'7'                     LENGTH OF KEYWORD               76614002
         DC    C'USERMAX '              KEYWORD                         76616002
         DC    F'0'                     SPECIFIED USERMAX VALUE         76618002
         DC    X'00'                    FLAG                            76620002
         DC    AL1(0)                   BUFFERS DEFAULT NOT USED        76680002
         DC    H'7'                     LENGTH OF KEYWORD               76740002
         DC    C'BUFFERS '              KEYWORD                         76800002
         DC    F'0'                     SPECIFIED BUFFERS VALUE         76860002
         DC    X'00'                    FLAG                            76920002
         DC    AL1(20)                  OWAITHI DEFAULT VALUE           76980002
         DC    H'7'                     LENGTH OF KEYWORD               77040002
         DC    C'OWAITHI '              KEYWORD                         77100002
         DC    F'0'                     SPECIFIED OWAITHI VALUE         77160002
         DC    X'00'                    FLAG                            77220002
         DC    AL1(4)                   OWAITLO DEFAULT VALUE           77280002
         DC    H'7'                     LENGTH OF KEYWORD               77340002
         DC    C'OWAITLO '              KEYWORD                         77400002
         DC    F'0'                     SPECIFIED OWAITLO VALUE         77460002
         DC    X'00'                    FLAG                            77520002
         DC    AL1(4)                   INLOCKHI DEFAULT VALUE          77580002
         DC    H'8'                     LENGTH OF KEYWORD               77640002
         DC    C'INLOCKHI'              KEYWORD                         77700002
         DC    F'0'                     SPECIFIED INLOCKLO VALUE        77760002
         DC    X'00'                    FLAG                            77820002
         DC    AL1(1)                   INLOCKLO DEFAULT VALUE          77880002
         DC    H'8'                     LENGTH OF KEYWORD               77940002
         DC    C'INLOCKLO'              KEYWORD                         78000002
         DC    F'0'                     SPECIFIED INLOCKLO VALUE        78060002
         DC    X'00'                    FLAG                            78120002
         DC    AL1(0)                   RESVBUF DEFAULT NOT USED        78180002
         DC    H'7'                     LENGTH OF KEYWORD               78240002
         DC    C'RESVBUF '              KEYWORD                         78300002
         DC    F'0'                     SPECIFIED RESVBUF VALUE         78360002
         DC    X'00'                    FLAG                            78410002
         DC    AL1(10)                  RECONLIM DEFAULT VALUE          78412002
         DC    H'8'                     LENGTH OF KEYWORD               78414002
         DC    C'RECONLIM'              KEYWORD                         78414402
         DC    F'0'                     SPECIFIED RECONLIM VALUE        78416002
         DC    X'00'                    FLAG                            78420002
         DC    AL1(0)                   USERCHG DEFAULT NOT USED        78480002
         DC    H'7'                     LENGTH OF KEYWORD               78540002
         DC    C'USERCHG '              KEYWORD                         78600002
         DC    F'0'                     SPECIFIED USERCHG VALUE         78660002
         DC    X'00'                    FLAG                            78720002
         DC    AL1(0)                   SLACK DEFAULT NOT USED          78780002
         DC    H'5'                     LENGTH OF KEYWORD               78840002
         DC    C'SLACK   '              KEYWORD                         78900002
         DC    F'0'                     SPECIFIED SLACK VALUE           78960002
         DC    F'-1'                    MARK END OF TABLE               79020002
ENDPMTBL EQU   *                                                        79080002
PATCH    DC    20F'0'                   PATCH AREA FOR IEDAY1           79130002
         SPACE 3                                                        79140002
*                                                                       79200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 79260002
*                                                                       79320002
*              PRIVATE DSECT OF WORK AREA FOR START TS                  79380002
*                                                                       79440002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 79500002
*                                                                       79560002
         DS    0F                                                       79620002
WASTART  DSECT                                                          79680002
RQBLKPTR DS    F                        REQUEST BLOCK POINTER           79740002
RQBLOCK  DS    0X                       REQUEST BLOCK FOR SVC 99        79860002
LENGTH   DS    XL1                      LENGTH OF REQUEST BLOCK         79980002
VERBCODE DS    XL1                      VERB CODE                       80040002
FLAG1    DS    XL2                      FLAGS                           80100002
ERRCODE  DS    XL2                      ERROR CODE                      80160002
INFOCODE DS    XL2                      INFORMATION CODE                80220002
TEXTPTR  DS    A                        PTR TO TEXT POINTERS            80280002
         DS    F                        RESERVED                        80340002
FLAG2    DS    XL4                      FLAGS                           80400002
RQBLKEND EQU   *                                                        80460002
RQBLKLEN EQU   RQBLKEND-RQBLOCK         LENGTH OF REQUEST BLOCK         80520002
WATPTR1  DS    A                        ADDR OF TEXT UNIT 1             80580002
WATPTR2  DS    A                        ADDR OF TEXT UNIT 2             80640002
WATPTR3  DS    A                        ADDR OF TEXT UNIT 3             80700002
WATPTR4  DS    A                        ADDR OF TEXT UNIT 4             80760002
WATEXT1  DS    CL18                     TEXT UNIT 1                     80770002
WATEXT2  DS    CL7                      TEXT UNIT 2                     80780002
WATEXT3  DS    0CL14                    TEXT UNIT 3                     80820002
         DS    CL4                      KEY AND NUMBER                  80880002
WADDLEN  DS    CL2                      PARM LENGTH                     80940002
WADDNAM  DS    CL8                      PARM FOR DDNAME                 81000002
WATEXT4  DS    CL7                      TEXT UNIT 4                     81050002
OPENPARM DS    F                        PARM LIST FOR OPEN              81100002
WADCB    DS    CL88                     WORK COPY FOR THE PARMLIB DCB   81110002
WADECB   DS    CL24                     WORK COPY OF DECB               81120002
BUFFER   DS    CL80                     AREA TO READ IN PARM RECORD     81180002
MSGLIST  DS    CL80                     AREA FOR WTO PARM LIST          81240002
KYWDTBL  DS    0F                       BEGINNING OF KEYWORD TABLE      81300002
BUFSIZE  DS    4F                       BUFFER SIZE                     81360002
USERMAX  DS    4F                       USERMAX                         81410002
BUFFERS  DS    4F                       TOTAL NUMBER OF BUFFERS         81420002
OWAITHI  DS    4F                       OWAITHI                         81480002
OWAITLO  DS    4F                       OWAITLO                         81540002
INLOCKHI DS    4F                       INLOCKHI                        81600002
INLOCKLO DS    4F                       INLOCKLO                        81660002
RESVBUF  DS    4F                       NO. OF RESERVED BUFFERS         81720002
RECONLIM DS    4F                       RECONNECT LIMIT                 81770002
USERCHG  DS    4F                       USER CHANGE                     81780002
SLACK    DS    4F                       SLACK TIME                      81840002
ENDMARK  DS    F                        END OF TABLE MARKER             81900002
DOUBLE1  DS    D                        AREA FOR PACK/UNPACK            81960002
DOUBLE2  DS    D                        AREA FOR PACK/UNPACK            82020002
REGSAVE  DS    18F                      REGISTER SAVE AREA              82070002
OPCAVTSV DS    F                        SAVE AREA FOR OPC AVT           82072002
LASTPAGE DS    F                        SIZE OF LAST PAGE OF BFRS PLUS  82080002
*                                       RPT AND TSB TABLE               82140002
RPTSIZE  DS    H                        CONTAINS SIZE OF TIOCRPT        82200002
PGBUFNO  DS    H                        CONTAINS NO. OF BFRS PER PAGE   82260002
LPGBUFNO DS    H                        NO. OF BFRS ON LAST PAGE        82320002
BFRPAGE  DS    H                        KEEPS NO. OF FULL PAGE FOR BFRS 82380002
RPTADDR  DS    A                        AREA TO SAVE TIOCRPT ADDRESS    82440002
CALLRKEY DS    CL1                      SAVE AREA FOR CALLER'S KEY      82500002
         SPACE 2                                                        82560002
*                                                                       82620002
* SMF RECORD                                                            82680002
*                                                                       82740002
         IFASMFR (31)                                                   82800002
TTIREND  EQU   *                                                        82860002
RCDSIZE  EQU   TTIREND-TTISMF           SIZE OF SMF RCD TYPE 31         82920002
WAEND    EQU   *                        END OF WORK AREA                82980002
         SPACE 3                                                        83040002
*                                                                       83100002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83160002
*                                                                       83220002
*              PRIVATE DSECT FOR MAPPING EACH ENTRY IN                  83280002
*              THE KEYWORD TABLE                                        83340002
*                                                                       83400002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 83460002
*                                                                       83520002
         DS    0F                       ALIGN ON WORD BOUNDARY          83580002
KYWDSECT DSECT                                                          83640002
PFLAG    DS    X                        FLAG BUTE                       83700002
PUSER    EQU   X'80'                    VALUE IS SPECIFIED              83760002
*        BITS 1-7 NOT USED                                              83820002
PDEFAULT DS    X                        DEFAULT VALUE                   83880002
PLENGTH  DS    H                        LENGTH OF KEYWORD               83940002
PKEYWORD DS    CL8                      PARAMETER KEYWORD               84000002
PVALUE   DS    F                        SPECIFIED VALUE                 84060002
PSIZE    EQU   *-PFLAG                  SIZE OF EACH PARMETER ENTRY IN  84120002
*                                       THE KEYWORD TABLE               84180002
         SPACE 3                                                        84190002
*                                                                       84200002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 84210002
*                                                                       84220002
*              PRIVATE DSECT OF WORK AREA FOR STOP TS                   84222002
*                                                                       84224002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 84226002
*                                                                       84228002
         DS    0F                       FORCE WORD BOUNDARY             84230002
WASTOP   DSECT                                                          84232002
REPLYECB DS    F                        ECB FOR WTOR                    84234002
REPLY    DS    2F                       REPLY AREA                      84236002
MESSAGE  DS    0CL67                    MESSAGE LIST                    84238002
REPLYLNG DS    AL1                      REPLY LENGTH                    84238402
REPLYADD DS    AL3                      REPLY ADDRESS                   84238802
ECBADDR  DS    A                        ECB ADDRESS                     84239202
MSGLNGTH DS    AL2                      MESSAGE LENGTH                  84239602
MSGFLAGS DS    AL2                      MESSAGE FLAGS                   84239702
MSGTEXT  DS    CL51                     MESSAGE TEXT                    84239802
DESCCODE DS    AL2                      DESCRIPTOR CODE                 84239902
ROUTCODE DS    AL2                      ROUTING CODE                    84259902
WASTOPND EQU   *                        END OF WORK AREA FOR STOP       84279902
         SPACE 3                                                        84280002
         TAVTD                                                          84300002
         SPACE 3                                                        84360002
         IKJTIOCB                                                       84420002
         SPACE 3                                                        84480002
CVT      DSECT                                                          84540002
         CVT   LIST=YES                                                 84600002
         SPACE 3                                                        84660002
         DCBD  DSORG=PS                                                 84720002
         SPACE 3                                                        84780002
         TOPCAVTD                                                       84840002
         SPACE 3                                                        84900002
         TOPCED                                                         84960002
         SPACE 3                                                        85020002
         IHAPSA                                                         85070002
         SPACE 3                                                        85072002
         TQCBD                                                          85080002
         SPACE 3                                                        85140002
         IHASCVT LIST=YES                                               85200002
         SPACE 3                                                        85260002
         IKJTIOCP LIST=YES                                              85320002
         SPACE 3                                                        85380002
         TTCXD                                                          85440002
         SPACE 3                                                        85500002
         TTNTD                                                          85560002
         SPACE 3                                                        85620002
         TTRMD                                                          85680002
         SPACE 3                                                        85740002
         IKJTSB LIST=YES                                                85800002
         END                                                            85860002
