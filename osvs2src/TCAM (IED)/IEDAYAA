         TITLE 'IEDAYAA  -  TSO/TIOC ATTENTION ROUTINE'                 00010020
IEDAYAA  CSECT                                                          00020020
*********************************************************************** 00030020
*********************************************************************** 00040021
*                                                                     * 00040321
*                  RELEASE 3  VS/2  PTF                                 00040403
*                                                                       00040503
*                                                                       00040603
*                                                                       00040703
*  C 098650-098850                                              ZA24878 00040803
*  A 512900                                                     ZA12528 00041603
*  D 519700                                                     ZA12528 00041703
*0000087000,268200-269110,270910-270950                        @ZA08015 00041937
*0000280810-281700,509410-509460,519310                        @ZA08015 00042737
*         RELEASE 3 VS/2 CHANGES                                        00043602
*  ZA00968 - SEE SA70323                                        ZA00968 00045602
*A191300,191400                                                 ZA02235 00046002
*         RELEASE VS2/2 CHANGES                                 YS02019 00047102
*                                       9/25/1973               YM03889 00050402
*                                       1/23/1974               YM06727 00050802
*         RELEASE 21 DELETIONS                                        * 00051002
*0966727427                                                      A50694 00055902
*0966                                                            M0167  00060802
*0966073100,083100,092000-092200,092700,120600-121500,159300-    S21008 00065702
*0966160200,698400,701100-703800,707400-725600,727270,727354-    S21008 00070602
*0966727606,727669-841500                                        S21008 00075502
*0966000400,087000                                               M0891  00080402
*          RELEASE 20 DELETIONS                                       * 00085302
*                                                                 M4034 00090202
*                                                                M3835  00095102
*0000099780,100440-100500,100620-100680,175800,327600,330300,    TS1637 00100020
*0000600300,678600,680800,697500,719100,720900,724500-727200,    TS1637 00110020
*0000766800-782100,929700,934300,936900-937800,954000,958500-    TS1637 00120020
*0000999999                                                      TS1637 00130020
*0000621000,641900-684900                                        M0029  00150020
*0000                                                            TS0035 00160020
*                                                                 M2265 00170020
*                                                                M3658  00200020
*                                                                     * 00240020
*STATUS CHANGE LEVEL 003                                        YS02019 00310002
*                                                                     * 00380020
* FUNCTION -                                                          * 00450020
*                                                                     * 00480002
*    QTIP0000 - ENTERED FROM ATTN IEDAYA                              * 00520020
*                                                                     * 00590002
*         WHEN ATTENTION EXIT IS AVAILABLE -                    YS02019 00690002
*                                                                     * 00790002
*    * SET NEW ATTENTION COUNT IN TSB                           YS02019 00890002
*    * POST THE RCT TO SCHEDULE AN ATTENTION EXIT               YS02019 00990002
*    * CLEAR INPUT AND OUTPUT QUEUES EXCEPT ASID MESSAGES       YS02019 01090002
*    * RESET AUTOMATIC LINE NUMBERING BITS IN TSB               YS02019 01190002
*    * REMOVE USER AND SYSTEM LWAIT, USER AND SYSTEM OWAIT      YS02019 01290002
*                                                                     * 01390002
*         WHEN ATTENTION EXIT IS NOT AVAILABLE -                YS02019 01570002
*                                                                     * 01620002
*    * TURN ON TSBATTN IF USER IS IN OWAIT                      YS02019 01670002
*    * CLEAR INPUT AND OUTPUT QUEUES EXCEPT ASID MESSAGES       YS02019 01720002
*    * REMOVE USER AND SYSTEM LWAIT, USER AND SYSTEM OWAIT      YS02019 01770002
*                                                                     * 01820002
*    QTIP0030 - ENTERED FROM IEDAYOO FOR HANGUP                       * 01920020
*                                                                     * 01950002
*    1. CLEAR INPUT AND OUTPUT QUEUES INCLUDING TJID MESSAGES         * 01990020
*    2. REMOVE SYSTEM LWAIT, USER AND SYSTEM OWAIT                    * 02060020
*                                                                     * 02090002
*    QTIP0210 - ENTERED FROM IGG09401                           YS02019 02130002
*                                                                     * 02160002
*    1. CLEAR INPUT QUEUE                                             * 02200020
*    2. REMOVE SYSTEM LWAIT AND SYSTEM OWAIT                          * 02270020
*                                                                     * 02300002
*    QTIP0220 - ENTERED FROM IGG09401                           YS02019 02340002
*                                                                     * 02370002
*    1. CLEAR OUTPUT HEADER QUEUE EXCEPT TJID MESSAGES                * 02410020
*    2. REMOVE SYSTEM LWAIT, USER AND SYSTEM OWAIT                    * 02480020
*                                                                     * 02550020
* ENTRY POINTS -                                                      * 02620020
*                                                                     * 02650002
*         QTIP0000 - QTIP 0 ENTRY FROM IEDAYA                         * 02690020
*         QTIP0030 - BRANCH ENTRY FROM IEDAYOO DURING HANGUP          * 02900020
*         QTIP0210 - QTIP 21 ENTRY FROM IGG09401                YS02019 02970002
*         QTIP0220 - QTIP 22 ENTRY FROM IGG09401                YS02019 03040002
*                                                                     * 03110020
* INPUT -                                                             * 03180020
*                                                                     * 03190002
*         WHEN ENTERED FROM IEDAYA                              YS02019 03200002
*                                                                     * 03210002
*    REGISTER 3 - SCB                                           YS02019 03220002
*    REGISTER 4 - LCB                                                 * 03250020
*    REGISTER 5 - ASCB                                          YS02019 03320002
*    REGISTER 6 - TSB                                                 * 03390020
*    REGISTER 7 - QCB                                           YS02019 03420002
*    REGISTER 10 - TIOCRPT                                      YS02019 03460002
*                                                                     * 03600020
*         WHEN ENTERED FROM IEDAYOO                             YS02019 03607002
*                                                                     * 03614002
*    REGISTER  6 - TSB                                          YS02019 03621002
*    REGISTER 10 - TIOCRPT                                      YS02019 03628002
*                                                                     * 03635002
*         WHEN ENTERED FROM IGG09401                            YS02019 03642002
*                                                                     * 03649002
*    REGISTER 15 - TSB                                          YS02019 03656002
*                                                                     * 03663002
* OUTPUT - SAME AS INPUT                                              * 03670020
*                                                                     * 03740020
* EXTERNAL REFERENCES -                                               * 03810020
*         IEA0PT01 - BRANCH ENTRY TO POST ROUTINE                     * 04020020
*         TIOCSAVE - REGISTER SAVE AND WORK AREA IN TIOCRPT           * 04090020
*                                                                     * 04160020
* EXITS,NORMAL -                                                      * 04230020
*    SET RETURN CODE REG. 15 TO 0                                     * 04370020
*    BR 14 RETURN TO CALLER                                           * 04440020
*                                                                     * 04510020
* EXITS,ERROR - NONE                                                  * 04580020
*                                                                     * 04650020
* TABLES/WORKAREAS -                                                  * 04720020
*    TIOCSAVE - 72 BYTE REGISTER SAVE AND WORK AREA IN TIOCRPT  YS02019 04790002
*                                                                     * 04860020
* ATTRIBUTES - REUSABLE,ENABLED                                 YS02019 04930002
*                                                                     * 05000020
* CHARACTER CODE DEPENDENCIES - NONE                                  * 05070020
*                                                                     * 05140020
* NOTES - N/A                                                         * 05210020
*                                                                     * 05280020
*********************************************************************** 05350020
*********************************************************************** 05420020
         EJECT                                                          05490020
* E Q U A T E S                                                         05560020
R0       EQU   0                        PARM,WORK REG.                  05630020
R1       EQU   1                        PARM,WORK REG.                  05700020
R2       EQU   2                        ATTN COUNT AND TJID             05770020
R3       EQU   3                        SCB                     YS02019 05840002
R4       EQU   4                        LCB                             05910020
R5       EQU   5                        ASCB                    YS02019 05980002
R6       EQU   6                        TSB                             06050020
R7       EQU   7                        QCB                             06120020
R8       EQU   8                        WORK REG AND RCB                06190020
R9       EQU   9                        WORK REG                        06260020
R10      EQU   10                       TIOCRPT                 YS02019 06330002
R11      EQU   11                       WORK REG                        06400020
R12      EQU   12                       BASE REG                        06470020
R13      EQU   13                       SAVE AREA                       06540020
R14      EQU   14                       RETURN TO CALLER                06610020
R15      EQU   15                       RETURN FROM INTERNAL SUBRTN     06680020
E0       EQU   0                        LENGTH/DISPLACEMENT CONSTANT    06750020
E1       EQU   1                        LENGTH/DISPLACEMENT CONSTANT    06820020
E3       EQU   3                        LENGTH/DISPLACEMENT CONSTANT    06890020
E4       EQU   4                        LENGTH/DISPLACEMENT CONSTANT    06960020
E5       EQU   5                        LENGTH/DISPLACEMENT CONSTANT    07030020
E16      EQU   16                       LENGTH/DISPLACEMENT     YS02019 07060002
E24      EQU   24                       LENGTH/DISPLACEMENT CONSTANT    07100020
OFF      EQU   X'FF'                    TO TURN OFF BITS                07170020
ON       EQU   4                        FOR TEST AND SET COND.          07240020
         SPACE 2                                                        07380020
*                                                                       08190020
* DEFINE ENTRIES HERE                                                   08230020
*                                                                       08270020
         ENTRY QTIP0000,QTIP0030,QTIP0210,QTIP0220               S21008 08300021
         USING IEDQSCB,R3                                        S21008 08330021
         USING ASCB,R5                                          YS02019 08370002
         USING TSB,R6                                                   08550020
         USING TIOCRPT,R10              ADDRESSABILITY OF RPT   YS02019 08640002
         USING ATTNSAVE,R13                                      TS1637 08680020
         DC    CL8'IEDAYAA'             MODULE ID                S21008 08690021
         DC    X'6098'                  JULIAN DATE - 4/07/76  @ZA08015 08700037
*                                                                       08730020
* ENTRY 0                                                               08820020
*                                                                       08910020
*                                                                       09000020
QTIP0000 DS    0H                                                       09090020
         USING *,R12                                                    09180020
         LA    R13,TIOCSAVE             GET RPT SAVE AREA       YS02019 09181002
         CLI   TSBSTAX,AVTEZERO         IS STAX EXIT AVAILABLE  YS02019 09182002
         BE    QTIPE2                   NO, DO ATTN IGNORED      S21008 09183021
*                                       PROCESSING                      09184021
ATTNCT   EQU   *                                                YS02019 09185002
         CLC   TSBATTNC,TSBSTAX         IS ATTN LEVEL AVAILABLE YS02019 09205002
         BE    QTIPE2                   NO, IGNORE ATTENTION    YS02019 09225002
         L     R1,TSBATTNC              GET FULL WORD - BYTE 0  YS02019 09245002
*                                       HAS ATTNC, BYTE 1 HAS   YS02019 09265002
*                                       STAX                    YS02019 09285002
         LR    R2,R1                    PUT IT IN WORK REGISTER YS02019 09305002
         SRL   R2,E24                   RIGHT ADJUST ATTNC      YS02019 09325002
         TM    SCBERR3,SCBATTN          HARDWARE ATTN RECEIVED  YS02019 09345002
         BNO   CALCATCT                 NO, GO TO CALCULATE SIM YS02019 09365002
*                                       ATTENTION ACOUNT        YS02019 09385002
         LA    R2,E1(,R2)               INCREMENT ATTN CT BY 1  YS02019 09405002
         B     UPDATE                   GO TO UPDATE TSBATTNC   YS02019 09425002
         SPACE 1                                                        09445002
CALCATCT EQU   *                                                YS02019 09465002
         SR    R0,R0                    CLEAR REGISTER          YS02019 09485002
         IC    R0,SCBSALEV              GET ATTN LEVEL ENTERED  YS02019 09505002
         SRL   R0,E4                    RIGHT ADJUST VALUE      YS02019 09525002
         AR    R2,R0                    OBTAIN NEW ATTN COUNT   YS02019 09545002
         LA    R0,E0(,R1)               GET STAX COUNT          YS02019 09565002
         SRL   R0,E16                   RIGHT ADJUST VALUE      YS02019 09585002
         CR    R2,R0                    IS NEW ATTN CT GT STAX  YS02019 09605002
         BNH   UPDATE                   NO, UPDATE TSBATTNC     YS02019 09625002
         LR    R2,R0                    OTHERWISE MAKE ATTN CT  YS02019 09645002
*                                       EQUAL TO STAX CT        YS02019 09665002
         SPACE 1                                                        09685002
UPDATE   EQU   *                                                YS02019 09705002
         SLL   R2,E24                   PUT NEW ATTNC IN BYTE 0 YS02019 09725002
         LA    R0,E0(,R1)               CLEAR HIGH ORDER BYTE   YS02019 09745002
         OR    R2,R0                    MERGE IN BYTES 1-2-3    YS02019 09765002
         CS    R1,R2,TSBATTNC           STORE NEW ATTN COUNT    YS02019 09785002
         BNE   ATTNCT                   LOOP UNTIL IT'S DONE    YS02019 09805002
         SPACE 1                                                        09825002
         NI    SCBERR3,OFF-SCBXPI-SCBXPD  RESET ERROR BITS      YS02019 09845002
         NI    TSBFLG4,OFF-TSBOWAIT-TSBIWAIT-TSBHOLD RESET HOLD ZA24878 09865003
*                       AND WAIT BITS...(SINCE RCT WILL REMOVE  ZA24878 09875003
*                                       IWAIT/OWAIT)            YS02019 09905002
*                                                               YS02019 09925002
* POST THE RCT TO SCHEDULE ATTENTION EXIT                       YS02019 09945002
*                                                               YS02019 09965002
         STM   R8,R14,SAVE8             SAVE REGISTERS          YS02019 09985002
         LR    R8,R13                   SAVE AREA POINTER       YS02019 10005002
         SR    R10,R10                  COMPLETION CODE IS ZERO YS02019 10025002
         LA    R11,ASCBECB              PASS THE ECB ADDRESS    YS02019 10045002
         O     R11,HIGHBIT              HI ORDER BIT ON FOR XM  YS02019 10065002
*                                       POST                    YS02019 10085002
         L     R12,CVTPTR               GET CVT ADDRESS         YS02019 10105002
         L     R15,CVT0PT01-CVT(,R12)   GET POST ROUTINE'S EPA  YS02019 10125002
         LA    R12,CVTBRET-CVT(,R12)    GET ADDRESS OF CVTBRET  YS02019 10145002
         LR    R13,R5                   ADDRESS OF USER'S ASCB  YS02019 10165002
         MODESET EXTKEY=SUPR            CHANGE INTO KEY 0       YS02019 10175002
         BALR  R14,R15                  GO TO POST RCT          YS02019 10185002
         MODESET EXTKEY=TCAM            CHANGE BACK TO TCAM KEY YS02019 10195002
         LR    R13,R8                   GET SAVE AREA POINTER   YS02019 10205002
         LM    R8,R14,SAVE8             RESTORE REGISTERS       YS02019 10225002
         SPACE                                                          10530020
         MVI   CLRSW,CLRTRL+CLRATTN     INDICATE TRLR Q TO BE CLEARED   10620020
         BAL   R15,CLROUTQ              CLEAR OUTPUT QUEUES             10720002
         BAL   R15,CLRINQ               CLEAR INPUT QUEUES              10820002
         SPACE                                                          10980020
         NI    TSBFLG2,OFF-TSBAUTON-TSBSTAUT   RESET AUTOLN BITS        11080020
         SPACE                                                          11250020
         MVI   RMVSW,RMVULW+RMVSLW+RMVUOWT+RMVSOWT    REMOVE SYSTEM     11340020
         BAL   R15,RMVWAITS             TYPE WAITS                      11430002
         SPACE                                                          11520020
         B     RETURN                    RETURN TO CALLER               11610020
         SPACE 1                                                        11700002
QTIPE2   EQU   *                                                 S21008 15890021
         NI    SCBERR3,OFF-SCBXPD-SCBATTN-SCBSATTN  RESET        S21008 15940021
         OI    SCBERR3,SCBXPI           ATTN IGNORED MESSAGE     S21008 15990021
         TM    TSBFLG4,TSBOWAIT         IS USER IN OWAIT        YS02019 16040002
         BNO   QENTRY2A                 NO-DON'T SET TSBATTN            16220002
         OI    TSBFLG3,TSBATTN          YES-SET TSBATTN                 16230002
         SPACE 1                                                        16235002
QENTRY2A EQU   *                                                        16240020
         MVI   CLRSW,CLRTRL+CLRATTN+CLRIGN   SET CLEAR SWITCHES         16380020
         BAL   R15,CLROUTQ              CLEAR OUTPUT QUEUES             16480002
         BAL   R15,CLRINQ               CLEAR INPUT QUEUES              16580002
         SPACE                                                          16740020
         MVI   RMVSW,RMVULW+RMVSLW+RMVUOWT+RMVSOWT    REMOVE SYSTEM     16830020
         BAL   R15,RMVWAITS                   TYPE WAITS                16920020
         SPACE                                                          17010020
         B     RETURN                   RETURN TO CALLER                17100020
         DROP  R3,R5                    DROP SCB AND ASCB BASE YS02019  17140002
         SPACE 3                                                        17190020
*                                                                       17280020
* ENTRY 3                                                               17370020
*                                                                       17460020
QTIP0030 DS    0H                                                       17550020
         LA    R13,TIOCSAVE             GET SAVE AREA ADDRESS   YS02019 17590002
         SPACE                                                          17730020
         MVI   CLRSW,CLRTRL+CLRTJID+CLRHANG                             17820020
         BAL   R15,CLROUTQ              CLEAR OUTPUT QUEUES             17920002
         BAL   R15,CLRINQ               CLEAR INPUT QUEUES              18020002
         SPACE                                                          18180020
         MVI   RMVSW,RMVSLW+RMVUOWT+RMVSOWT    REMOVE SYSTEM            18270020
         BAL   R15,RMVWAITS                    TYPE WAITS               18360002
         SPACE                                                          18450020
         B     RETURN                   RETURN TO CALLER                18540020
         SPACE 3                                                        18580002
*                                                                       18630020
* ENTRY 21                                                              18720020
*                                                                       18810020
QTIP0210 DS    0H                                                       18900020
         BAL   R1,FINDSAVE              FIND THE RPT SAVEAREA   YS02019 18990002
         LR    R6,R15                   GET TSB ADDRESS         YS02019 19010002
         TM    TSBFLG4,TSBHUNG          DID USER HANG UP        YS02019 19030002
         BCR   1,R14                    YES, RETURN             YS02019 19050002
         SPACE 2                                                        19080020
         TM    TSBFLG2,TSBBIPI          IS REPROMPT IN PROCESS  ZA02235 19130002
         BOR   R14                      YES, RETURN             ZA02235 19140002
         MVI   CLRSW,CLRTCLRQ           INDICATE CALL FROM TCLEARQ      19170020
         BAL   R15,CLRINQ               GO CLEAR INPUT Q                19260020
         SPACE 2                                                        19350020
         MVI   RMVSW,RMVSLW+RMVSOWT            REMOVE SYSTEM            19440020
         BAL   R15,RMVWAITS                         REMOVE SYSTEM       19530020
         SPACE 2                                                        19620020
         B     RETURN                   RETURN TO CALLER                19710020
         SPACE 3                                                        19750002
*                                                                       19800020
* ENTRY 22                                                              19890020
*                                                                       19980020
QTIP0220 DS    0H                                                       20070020
         BAL   R1,FINDSAVE              FIND THE RPT SAVEAREA   YS02019 20160002
         LR    R6,R15                   GET TSB ADDRESS         YS02019 20180002
         TM    TSBFLG4,TSBHUNG          DID USER HANG UP        YS02019 20200002
         BCR   1,R14                    YES, RETURN             YS02019 20220002
         SPACE 2                                                        20250020
         MVI   CLRSW,CLRTCLRQ           INDICATE CALL FROM TCLEARQ      20340020
         BAL   R15,CLROUTQ              GO CLEAR OUTPUT Q               20430020
         SPACE 2                                                        20520020
         MVI   RMVSW,RMVSLW+RMVUOWT+RMVSOWT    REMOVE SYSTEM            20610020
         BAL   R15,RMVWAITS                   TYPE WAITS                20700020
         SPACE 2                                                        20790020
RETURN   EQU   *                                                        20880002
         SR    R15,R15                  PASS GOOD RETURN                21420020
         BR    R14                      RETURN TO CALLER                21510020
         SPACE 2                                                 TS1637 21516020
*                                                                       21522020
* THIS SUBROUTINE LOCATES THE SAVE AREA IN TIOCRPT AND RETURNS  YS02019 21528002
* THE ADDRESS IN REGISTER 13                                    YS02019 21534002
*                                                                       21540020
FINDSAVE EQU   *                                                 TS1637 21546020
         L     R10,CVTPTR               GET CVT ADDRESS         YS02019 21552002
         L     R10,CVTAQAVT-CVT(,R10)   GET TCS ADDRESS         YS02019 21561002
         L     R10,TCXRPT-IEDQTCX(,R10) GET RPT ADDRESS         YS02019 21570002
         LA    R13,TIOCSAVE             GET RPT SAVE AREA       YS02019 21579002
         BR    R1                       RETURN TO CALLER        YS02019 21588002
         EJECT                                                          21600020
*                                                                       21690020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 21780020
*                                                                       21870020
*  C L I N Q- CLEAR INPUT QUEUE                                         21960020
*                                                                       22050020
*            INPUT-  R6   TSB                                           22140020
*                    R10  TIOCRPT                               YS02019 22230002
*                    R15  RETURN                                        22410020
*            THE FOLLOWING REGISTERS ARE VOLATILE OVER THIS SUBR        22500020
*                    R0                                                 22590020
*                    R1                                                 22680020
*                    R2                                         YS02019 22710002
*                    R3                                         YS02019 22740002
*                    R8                                                 22770020
*                    R9                                                 22860020
*                    R11                                                22950020
*                                                                       23040020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 23130020
*                                                                       23220020
CLRINQ   DS    0H                                                       23310020
         USING IEDQQCB,R7               ADDRESSABILITY FOR QCB  YS02019 23400002
         ST    R15,SAVE15               SAVE RETURN ADDRESS     YS02019 23490002
         SR    R3,R3                    CLEAR LINE CT REGISTER  YS02019 23760002
         NI    TSBFLG2,OFF-(TSBBRKIN+TSBBIPI) END BREAKIN PROCESSING    23850020
         TM    CLRSW,CLRTCLRQ           CALL FROM TCLEARQ?      YM2814  23860000
         BO    CLINSPIT                 YES, DON'T RESET SPIT,  YM2814  23862000
*                                       OR IFLSH                        23864000
         NI    TSBFLG1,OFF-TSBIFLSH     TURN OFF IFLSH (SET BY    M0029 23870002
*                                       TCLEARQ)                  M0029 23890002
         NI    TSBFLG3,OFF-TSBSPIT      TURN OFF STOP PROMPT BIT  M0029 23910002
CLINSPIT EQU   *                                                YM2814  23920000
*                                                                       23940020
* CHECK FOR ANY BUFFERS ON TRAILER Q                                    24030020
*                                                                       24120020
         OC    TSBITBFP,TSBITBFP        IS  TRLR Q EMPTY                24210020
         BZ    CLIHQ                    YES CLEAR H Q                   24300020
*                                                                       24390020
* PREPARE TO CLEAR TRAILER Q                                            24480020
*                                                                       24570020
         L     R11,TSBITBFP-E1          TRAILR QUE PTR                  24660020
         USING TIOCBUF,R11                                              24750020
         L     R1,TSBIBFP-E1            SAVE HDR Q PTR          YS02019 24840002
         XC    TSBITBFP,TSBITBFP        ZAP T Q                         24930020
         XC    TSBIBFP,TSBIBFP          CLEAR INPUT HDR BFFR POINTER    24970020
         B     CLIXBUFF                 GO REMOVE BUFFER                25020020
*                                                                       25110020
* PREPARE TO CLEAR HEADER Q                                             25200020
*                                                                       25290020
CLIHQ    DS    0H                                                       25380020
         OC    TSBIBFP,TSBIBFP          TEST IF INPUT Q EMPTY           25410020
         BZ    CLIEXITA                 YES,GO TO EXIT                  25440002
         L     R11,TSBIBFP-E1           HEADER QUE PTR                  25500020
         XC    TSBIBFP,TSBIBFP          CLEAR H Q PTR                   25560020
         SPACE 2                                                        25650020
CLIA     DS    0H                                                       25740020
         L     R1,BUFFHEAD-E1           SAVE NEXT HEADER PTR    YS02019 25830002
         LA    R11,0(R11)               CLEAR FOR TEST                  25920020
         LTR   R11,R11                  DID WE JUST PROCESS LAST MSG    26010020
         BZ    CLIEXIT                  YES,BEGIN EXIT PROCESSING       26110002
         TM    BUFFFL1,BUFFNLCR         HAS MSG BEEN COUNTED            26280020
*                                       BY TSINPUT                      26370020
         BZ    CLIXBUFF                 IF NOT, DON'T COUNT             26460020
         LA    R3,E1(R3)                ADD 1 TO LINE COUNT     YS02019 26550002
         SPACE 2                                                        26640020
*                                                                       26730020
* REMOVE BUFFER FROM INPUT QUE AND PUT ON FREE QUE IF          @ZA08015 26820037
* IT IS DETERMINED IT IS NOT ALSO ON OUTPUT QUE(BUFFIHOT).     @ZA08015 26850037
*  IF ON BOTH QUES, DROP BUFFER FROM INPUT QUE BUT DONT        @ZA08015 26880037
* PUT ON FREE QUE.                                             @ZA08015 26910037
*                                                              @ZA08015 26940037
CLIXBUFF DS    0H                                                       26970037
         L     R8,BUFFTRLR-E1           SAVE NEXT TRLR PTR              27000037
         TM    BUFFFL1,BUFFIHOT         BUFFER ON BOTH QUES?   @ZA08015 27030037
         BNO   CLIXBUF1                 NO, PUT IT ON FREE QUE @ZA08015 27060037
         NI    BUFFFL1,OFF-BUFFIHOT     TURN OFF FLAG          @ZA08015 27090037
         B     CLISKIP                  GET NEXT TRAILER       @ZA08015 27120037
CLIXBUF1 EQU   *                                               @ZA08015 27150037
         LR    R2,R11                   BFR TO BE RETURNED      YS02019 27180002
         L     R15,AYQBRAD              BFR RETURN RTN'S EPA    YS02019 27380002
         BALR  R0,R15                   GO TO RETURN BFR        YS02019 27580002
         SPACE                                                          27900020
*                                                                       27990020
* PREPARE NEXT TRAILER FOR REMOVAL                                      28080020
*                                                              @ZA08015 28170037
CLISKIP  EQU   *                                               @ZA08015 28210037
         LA    R11,0(R8)                GET TRAILER POINTER             28260020
         LTR   R11,R11                  WAS THIS THE LAST PART OF MSG   28440020
         BNZ   CLIXBUFF                 NO,CLEAR ANOTHER TRAILER        28530020
         SPACE                                                          28620020
*                                                                       28710020
* PREPARE TO PROCESS NEXT MSG                                           28800020
*                                                                       28890020
         LR    R11,R1                   GET NEXT MSG HDR PRT    YS02019 28980002
         B     CLIA                     AND GO BACK                     29070002
*                                                                       29160020
* ENTERED UPON COMPLETION OF CLEARING INPUT Q.                          29250020
* LAST MSG JUST PROCESSED, DO EXIT PROCESSING                           29520020
*                                                                       29610020
CLIEXIT  EQU   *                                                        29640020
         MVI   TSBNIBF,E0               CLEAR TSBNIFB           YS02019 29670002
CLIEXITA EQU   *                                                        29820020
         TM    CLRSW,CLRHANG            FROM HANGUP                     29880020
         BO    CLIEND                   YES,BRANCH                      29940002
         TM    CLRSW,CLRTCLRQ           CALLED BY TCLEARQ       YS02019 29950002
         BO    IFLSHON                  YES, SKIP BFR CHECKING  YS02019 29960002
         TM    QCBTSOF2,QCBBUFQ         IS BUFF ON HOLD Q               29970002
         BNO   CLIEXITB                 NO,BRANCH TO EXIT               30170002
         SPACE 1                                                        30230002
IFLSHON  EQU   *                                                YS02019 30290002
         OI    TSBFLG1,TSBIFLSH         TELL TSINPUT TO FLSH TCAM BUFS  30370002
CLIEXITB EQU   *                                                        30570020
         TM    CLRSW,CLRIGN+CLRTCLRQ    CALLED BY ATTN IGNORED  YM06727 30770002
*                                       OR TCLEARQ              YM06727 30820002
         BNZ   CLIEXITC                 YES,DON'T TURN OFF QCBREAD/TGET 30970002
         LM    R0,R1,TSBTPOST           GET TSBTPOST CONDITION  YS02019 31290002
RETRY1   EQU   *                                                YS02019 31298002
         LR    R8,R0                    .PUT TSBTPOST STATUS IN YS02019 31306002
         LR    R9,R1                    .WORK REGISTERS         YS02019 31314002
         O     R8,MASK1                 .TURN OFF QCBREAD IN    YS02019 31322002
         N     R8,MASK2                 .QCBFLAG                YS02019 31330002
         O     R9,MASK3                 .TURN OFF QCBTGET IN    YS02019 31338002
         N     R9,MASK4                 .QCBTSOF1               YS02019 31346002
         CDS   R0,R8,TSBTPOST           UPDATE TSBTPOST         YS02019 31354002
         BNE   RETRY1                   LOOP UNTIL IT'S DONE    YS02019 31362002
         BAL   R7,TPOSTAYP              GO TO TPOST AYP         YS02019 31370002
CLIEXITC EQU   *                                                        31380020
         TM    TSBFLG2,TSBAULST+TSBAUTON     IS AUTO LN IN EFFECT       31410020
         BNO   CLIEND                    IF NOT, EXIT                   31500020
         LTR   R3,R3                    ANY LINES DELETED       YS02019 31590002
         BZ    CLIEND                    IF NOT, EXIT                   31680020
         L     R1,TSBAUTOS               CURRENT LINE COUNT             31770020
         L     R0,TSBAUTOI               LINE CNT INCR                  31860020
         SPACE                                                          31950020
CLILNDEC DS    0H                                                       32040020
         SR    R1,R0                    DECR LN CNT                     32130020
         BNP   CLIST0                   IF NOT PLUS, STORE ZERO         32220020
         BCT   R3,CLILNDEC              DECREMENT LD COUNT      YS02019 32310002
         ST    R1,TSBAUTOS              STORE NEW AUTO LN COUNT         32400020
         B     CLIEND                   SKIP NEXT INSTRUCTION           32490020
CLIST0   XC    TSBAUTOS,TSBAUTOS        ZERO LINE COUNT                 32580020
CLIEND   DS    0H                                                       32670020
         L     R15,SAVE15               GET RETURN ADDRESS      YS02019 32770002
         BR    R15                      RETURN                          32940020
         DROP  R7                       DROP QCB BASE                   33750002
         EJECT                                                          38700020
*                                                                       44280020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 44370020
*                                                                       44460020
* C L R O U T Q   -   CLEAR TSO OUTPUT QUEUES                           44550020
*                                                                       44640020
*        INPUT: CLRSW    BIT 0:  0= CLEAR ALL NSGS EXCEPT TJID TYPE     44730020
*                                1= CLEAR ALL MSGS                      44820020
*                        BIT 1:  0= DO NOT CLEAR TRAILER BUFFER         44910020
*                                1= CLEAR IT                            45000020
*                                                                       45090020
*                        R4:  LCB FOR THIS LINE                         45180020
*                        R6:  TSB                                       45270020
*                        R10: TIOCRPT                           YS02019 45360002
*                                                                       45450020
*        REGISTERS VOLATILE OVER THIS SUBROUTINE: R0,R1,R8,R11          45540020
*                                                 R2,R9         YS02019 45580002
*                                                                       45630020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 45720020
*                                                                       45810020
CLROUTQ  DS    0H                                                       45900020
         ST    R15,SAVE15               SAVE RETURN REGISTER            45990002
         SR    R15,R15                  ZAP R15                         46080002
         ST    R15,SAVE11               ZERO OUT SAVE11         YM03889 46130002
         CLI   TSBNOBF,E0               ARE THERE ANY OUTPUT BUF        46160020
         BNZ   CLROQ1                   YES,BRANCH                      46180002
         TM    CLRSW,CLRATTN+CLRHANG    FROM ATTN OR HANGUP             46200020
         BZ    CLOEXIT2                 NO,EXIT                         46220002
         XC    TSBOTBFP(E3),TSBOTBFP    CLEAR OUTBUF POINTER            46240002
*                                       OF POSSIBLE REPROMPT MESSAGES   46245002
         B     CLOEXIT2                 GO TO EXIT                      46250002
CLROQ1   EQU   *                                                        46260020
         L     R9,TSBOBFP-E1            SAVE HQ PTR                     46280020
         LA    R9,0(R9)                 CLEAR HIGH ORDER BYTE           46300002
         XC    TSBOBFP(E3),TSBOBFP      CLEAR TSB HQ PTR                46320020
         TM    CLRSW,CLRTRL             SHOULD TRAILR QUE BE CLEARED    46380020
         BZ    CLOHEAD                  NO, GO CLEAR HEADER Q           46440002
         TM    TSBSTAT,TSB3270          IS THIS A 3270          SA70323 46490002
         BNO   CLRNO327                 NO, CLEAR TRLR NORMALLY SA70323 46500002
         TM    CLRSW,CLRHANG            IS THIS HANGUP          SA70323 46510002
         BNO   CLOHEAD                  FOR 3270, CLEAR TRAILER SA70323 46520002
*                                       ONLY FOR HANGUP ENTRY   SA70323 46522002
CLRNO327 EQU   *                                                SA70323 46524002
         OC    TSBOTBFP(E3),TSBOTBFP    IS TRAILR QUE EMPTY             46530020
         BZ    CLOHEAD                  YES, CLEAR H Q                  46620002
         TM    TSBFLG3,TSBTJMSG         TJID TYPE MESSAGE               46710020
         BZ    CLOTRL                   NO, GO CLEAR                    46800002
         TM    CLRSW,CLRTJID            SHOULD TJID MSGS BE CLEARED     46890020
         BZ    CLOHEAD                  NO, GO CLEAR H Q                46980002
         SPACE 2                                                        47070020
CLOTRL   DS    0H                                                       47160020
         L     R11,TSBOTBFP-E1          GET 1ST TRLR PTR                47250020
         XC    TSBOTBFP(E3),TSBOTBFP    ZERO T Q PTR                    47340020
         USING TIOCBUF,R11                                              47430020
         TM    CLRSW,CLRATTN+CLRHANG    FROM ATTN OR HANGUP             47520020
         BZ    CLOTRL2                  NO, DON'T TEST BIPI             47610002
         TM    TSBFLG2,TSBBIPI          IS BIPI ON (SET BY BREAKIN)     47700002
         BO    CLOHEAD                  DO NOT FREE TRLR QUE BFR        47800002
CLOTRL2  DS    0H                                                       48060020
         LA    R8,0(R9)                 SAVE HQ PTR                     48150020
         B     CLOXBUFF                 GO REMOVE BUFFER FROM Q         48240020
         SPACE 2                                                        48330020
CLOHEAD  DS    0H                                                       48420020
         LTR   R11,R9                   LAST HDR MSG                    48620020
         BZ    CLOEXIT0                 YES,BRANCH                      48820020
         SPACE 2                                                        49770002
CLOBUMP  DS    0H                                                       49860020
         L     R8,BUFFHEAD-E1           SAVE NEXT MSG PTR               49950020
         ST    R11,SAVE11               SAVE CURRENT BUFFER     YS02019 50310002
*                                       HEADER POINTER          YS02019 50350002
         TM    BUFFFL2,BUFFTJID         TEST IF TJID MESSAGE            50400020
         BNO   CLOXBUFF                 NO,GO RENAME BUFFER FROM Q      50490020
         TM    CLRSW,CLRTJID            SHOULD TJID MSGS BE CLRD        50580020
         BZ    CLORECHN                 NO,BRANCH                       50670020
         SPACE                                                          50760020
CLOXBUFF DS    0H                                                       50850020
         L     R3,BUFFTRLR-E1           SAVE CURR BFR TRLR PTR  YS02019 50940002
         TM    BUFFFL1,BUFFIHOT         BUFFER ON BOTH QUES?   @ZA08015 50950037
         BNO   CLOXBUF1                 NO, PUT ON FREE QUE    @ZA08015 50960037
         NI    BUFFFL1,OFF-BUFFIHOT     TURN OFF FLAG          @ZA08015 50970037
         B     CLOSKIP                  GET NEXT TRAILER       @ZA08015 50980037
         SPACE 1                                               @ZA08015 50990037
CLOXBUF1 EQU   *                                               @ZA08015 51000037
         LR    R2,R11                   BFR TO BE RETURNED      YS02019 51040002
         L     R15,AYQBRAD              BFR RETURN RTN'S EPA    YS02019 51140002
         BALR  R0,R15                   GO TO RETURN BFR        YS02019 51240002
CLOSKIP  EQU   *                                                ZA12528 51290003
         SR    R1,R1                    CLEAR REGISTER          YS02019 51340002
         IC    R1,TSBNOBF               GET OUTPUT BUFFER CNT           51480020
         BCTR  R1,R0                    SUBTRACT 1                      51570020
         STC   R1,TSBNOBF               UPDATE TSB CNT                  51660020
*                                                                       51750020
* PREPARE TO FREE NEXT BUFFER                                           51840020
*                                                                       51930020
         LR    R11,R3                   GET TRLR POINTER        YS02019 52020002
         LA    R11,E0(R11)              CLEAR 1ST BYTE                  52110020
         LTR   R11,R11                  LAST OF MSG CLEARED             52200020
         BNZ   CLOXBUFF                 NO, REMOVE NEXT BUFF            52290002
*                                                                       52380020
* GET NEXT MSG FOR REMOVAL                                              52470020
*                                                                       52560020
CLONEXT  DS    0H                                                       52650020
         LA    R8,0(R8)                 CLEAR HI ORDER BYTE             52700020
         LTR   R11,R8                   LAST HDR MSG                    52750020
         BZ    CLOEXIT0                 YES, EXIT                       52800020
         B     CLOBUMP                  NO,CLEAR NEXT MSG               52860020
*                                                                       52920020
* RECHAIN TJID MSG                                                      53010020
*                                                                       53100020
CLORECHN DS    0H                                                       53190020
         XC    BUFFHEAD(E3),BUFFHEAD    ZAP HQ PTR                      53220020
         OC    TSBOBFP(E3),TSBOBFP      IS QUE EMPTY                    53290020
         BNZ   CLOFLAST                 NO, FIND LAST MSG               53370002
         IC    R1,TSBOBFP-E1            GET FLAG BYTE                   53460020
         SLL   R1,E24                   LEFT ADJUST COUNT               53550020
         OR    R11,R1                   PUT CNT IN 1ST BYTE             53640020
         ST    R11,TSBOBFP-E1           UPDATE QUE PTR                  53730020
         B     CLONEXT                  GO GET NEXT HDR MSG             53820020
*                                                                       53910020
* FIND LAST MSG                                                         54000020
*                                                                       54090020
CLOFLAST DS    0H                                                       54180020
         LR    R0,R11                   SAVE HEADER PTR                 54270020
         L     R11,TSBOBFP-E1           GET 1ST MSG PTR                 54360020
         SPACE                                                          54450020
CLOA     DS    0H                                                       54540020
         OC    BUFFHEAD(E3),BUFFHEAD    LAST MSG                        54630020
         BZ    CLOB                     YES, CHAIN TO Q                 54720002
         L     R11,BUFFHEAD-E1          NEXT MSG                        54810020
         B     CLOA                     LOOK FOR LAST MSG               54900020
CLOB     DS    0H                                                       54990020
         IC    R1,BUFFHEAD-E1           GET FLAG BYTE                   55080020
         SLL   R1,E24                   LEFT ADJUST                     55170020
         OR    R0,R1                    MERGE                           55260020
         ST    R0,BUFFHEAD-E1           CHAIN MSG INTO QUE              55350020
         B     CLONEXT                  GO PROCESS NEXT MSG             55440020
         SPACE 2                                                        55490002
CLOEXIT0 DS    0H                                                       55800020
         OC    TSBOTBFP(E3),TSBOTBFP    TEST IF ANY TRAILER IN Q        55810020
         BZ    NOTRILR                  NO,SKIP SETTING BIT             55820020
         TM    TSBFLG3,TSBTJMSG         TEST IF ANY TJID MSG IN Q       55830020
         BO    NOTRILR                  YES,SKIP SETTING BIT            55840020
         TM    TSBFLG2,TSBBIPI          REPROMPT MSG ON OUT TRLR QUE    55845020
         BO    NOTRILR                  YES,BRANCH                      55850002
         OI    TSBFLG1,TSBOFLSH         NO,TELL TSOUTPUT TO FLUSH TRLRQ 55855002
NOTRILR  EQU   *                                                        55860020
         TM    CLRSW,CLRHANG            CALL FROM HANGUP        YS02019 55900002
         BO    CLOEXIT2                 YES, EXIT               YS02019 55930002
         L     R15,SAVE11               GET HEAD QUEUE PTR      YS02019 55960002
         LTR   R15,R15                  WAS HEADER QUE EMPTY            56010002
         BNZ   NOTRILR2                 NO,CHECK LAST MSG CLEARED       56020002
         TM    TSBFLG3,TSBTJMSG         TJID MSG ON OUT TRLR QUE        56030020
         BO    CLOEXIT2                 YES,DO NOT TURN OFF QCBPARTO    56040002
         B     NOTRILR3                 NO,TURN OFF QCBPARTO            56050002
NOTRILR2 EQU   *                                                        56060020
         DROP  R11                                                      56100020
         USING TIOCBUF,R15                                              56200020
         TM    BUFFFL2,BUFFTJID         TEST IF TJID MESSAGE            56280020
         BO    CLOEXIT2                 YES,GOTO RETURN                 56360020
NOTRILR3 EQU   *                                                        56450020
         L     R0,TSBF2M                GET TSBTPOST CONDITION  YS02019 56500002
RETRY2   EQU   *                                                YS02019 56510002
         LR    R1,R0                    .PUT TSBTPOST STATUS IN YS02019 56520002
*                                       .WORK REGISTERS         YS02019 56530002
         O     R1,MASK5                 .TURN OFF QCBPARTO      YS02019 56540002
         N     R1,MASK6                 .IN QCBTSOF1            YS02019 56550002
         CS    R0,R1,TSBF2M             UPDATE TSBTPOST         YS02019 56560002
         BNE   RETRY2                   LOOP UNTIL IT IS DONE   YS02019 56570002
         BAL   R7,TPOSTAYP              GO TO TPOST AYP         YS02019 56580002
         DROP  R15                                                      56600020
CLOEXIT2 DS    0H                                                       57330020
         L     R15,SAVE15               RESTORE RETURN REGISTER         57420002
         BR    R15                      RETURN TO CALLER                57510020
         EJECT                                                          57600020
*                                                                       57690020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   57780020
*                                                                       57870020
*  R M V W A I T S: REMOVE THE VARIOUS SYSTEM AND USER WAIT             57960020
*                   CONDITIONS. THE FLOW OF CONTROL THROUGH             58050020
*                   THIS ROUTINE IS CONTROLLED BY BIT SETTINGS          58140020
*                   IN RMVSW.                                           58230020
*                                                                       58320020
*                       BIT 0:     REMOVE USER LWAITS                   58410020
*                           1:            SYSTEM LWAITS                 58500020
*                           2:            WAITS ON OWAITS               58590020
*                           3:            TJID/TPUT WAITS               58680020
*                           4:            IWAITS                        58770020
*                           5:            OWAITS                        58860020
*                                                                       58950020
*                                                                       59040020
*                   REGISTER INPUTS:                                    59130020
*                        R4: LCB                                        59310020
*                        R6: TSB                                        59490020
*                        R10: TIOCRPT                           YS02019 59580002
*                        R13: TIOCSAVE                          YS02019 59670002
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *   59760020
*                                                                     * 59850020
RMVWAITS DS    0H                                                       59940020
         STM   R14,R15,SAVE14           SAVE REGISTERS           TS1637 60030002
         USING TIOCRPT,R10                                      YS02019 60120002
         OC    TIOCNFBF,TIOCNFBF        ANY FREE BFRS AT ALL    YS02019 60300002
         BZ    RMVEXIT                  NO, GO TO EXIT          YS02019 60400002
         TM    RMVSW,RMVULW             DO WE WANT TO REMOVE USER       60660020
*                                       LWAITS                          60750002
         BZ    RMVTSLW                  NO, MAKE MORE TESTS             60840002
         TM    TSBSTAT,TSBINUSE         IS USER STILL CONNECTED         60870020
         BZ    RMVTSLW                  NO,CHECK SYSTEM LWAIT           60900020
         TM    TSBSTAT,TSBLWAIT         IS USER IN LWAIT                60960020
         BZ    RMVTSLW                  NO, MAKE TEST FOR SYS LWAIT     61020002
*                                                                       61110020
* TRY TO REMOVE USER FROM LWAIT                                         61200020
*                                                                       61290020
         SR    R1,R1                    CLEAR WORK REG.                 61390020
         IC    R1,TSBNIBF               NO. OF BUFRS ON INPUT Q         61490020
         CH    R1,TIOCRSTH              IS THRESHOLD EXCEEDED           61590020
         BH    RMVTSLW                  YES, SKIP FOLLOWING CODE        61740002
         NI    TSBSTAT,OFF-TSBLWAIT     TURN OFF LWAIT                  61830020
*                                                                       61920020
         TM    TIOCFLG,TIOCSYLW         IS SYSTEM IN LWAIT              62010020
         BO    RMVTSLW                  YES, CHK FOR SYS LWAIT    M0029 62070002
*                                       REMOVAL                  M0029  62130020
         L     R0,TSBF2M                GET TSBTPOST CONDITION  YS02019 62190002
RETRY3   EQU   *                                                YS02019 62790002
         LR    R1,R0                    .PUT TSBTPOST IN        YS02019 63390002
*                                       .WORK REGISTERS         YS02019 63990002
         O     R1,MASK7                 .TURN OFF QCBNOBUF      YS02019 64590002
         N     R1,MASK8                 .IN QCBTSOF1            YS02019 65190002
         CS    R0,R1,TSBF2M             UPDATE TSBTPOST         YS02019 65790002
         BNE   RETRY3                   LOOP UNTIL IT IS DONE   YS02019 66390002
         BAL   R7,TPOSTAYP              GO TO INVOKE TPQ FOR    YS02019 66990002
*                                       TPOSTING TSB TO AYP     YS02019 67590002
         SPACE 2                                                        68580020
*                                                                       68670020
* TEST TO SEE IF TCAM BUFFERS CAN BE REMOVED FROM THE WAIT QUEUE        68760020
* AND/OR IF THE SYSTEM CAN BE REMOVED FROM SYSTEM LWAIT                 68850020
*                                                                       68940020
         SPACE 2                                                        69030020
RMVTSLW  EQU   *                                                        69120020
         TM    RMVSW,RMVSLW             DO WE WANT TO REMOVE SYS LWAIT  69210002
         BZ    RMVTUOWT                 NO,GO CHECK USER OWAIT          69300002
         TM    TIOCFLG,TIOCSYLW         NO,IS SYSTEM IN LWAIT           70550002
         BZ    RMVTUOWT                 NO,CHECK USER OWAIT             70570002
         SPACE 3                                                 M0167  70622021
POSTTSI  EQU   *                                                        70630020
         L     R0,TSBTPOST              GET STATUS OF TSBTPOST  YS02019 70630502
RETRY4   EQU   *                                                YS02019 70830502
         LR    R1,R0                    PUT IN WORK REGISTER    YS02019 71030502
         O     R1,MASK9                 TURN ON TSBTPAYI FOR    YS02019 71230502
*                                       TPOSTING TSI TO AYI     YS02019 71430502
         CS    R0,R1,TSBTPOST           UPDATE TSBTPFLG         YS02019 71630502
         BNE   RETRY4                   LOOP UNTIL IT'S DONE    YS02019 71830502
         BAL   R7,TPOSTAYP              CALL AYP TO POST        YS02019 72030502
         SPACE 2                                                        72720720
*                                                                       72721420
* THIS SECTION TESTS TO SEE IF USER OWAIT CAN BE REMOVED                72722120
*                                                                       72722820
         SPACE 2                                                        72723520
RMVTUOWT EQU   *                                                        72724220
         TM    RMVSW,RMVUOWT            DO WE WANT TO REMOVE USER OWAIT 72724902
         BZ    RMVTSOWT                 NO,CHECK SYSTEM OWAIT           72725602
         TM    TSBSTAT,TSBINUSE         IS USER STILL CONNECTED         72725820
         BZ    RMVTSOWT                 NO,CHECK SYSTEM OWAIT           72726020
         TM    TSBFLG4,TSBOWAIT         IS USER IN OWAIT        YS02019 72726302
         BZ    RMVTSOWT                 GO CHECK SYS OWAIT       S21008 72727021
*                                                                       72727720
* REGULAR TPUT IS IN OWAIT - TEST TO SEE IF IT CAN BE REMOVED           72728420
*                                                                       72729120
         SR    R0,R0                    CLEAR TEST REGISTER             72729802
         IC    R0,TSBNOBF               GET NO. BFR USER NOW HOLDING    72730502
         CH    R0,TIOCOWTH              IS THRESHOLD EXCEEDED           72731420
         BH    RMVTSOWT                 YES,CHECK SYSTEM OWAIT          72732320
*                                                                       72733320
* REMOVE USER FROM OWAIT                                                72734020
*                                                                       72734720
         STM   R8,R12,SAVE8             SAVE REGISTERS ACROSS   YS02019 72735702
*                                       CALL                     S21008 72736721
         LA    R8,0(,R6)                SET UP TSB ADDR FOR      S21008 72737721
*                                       SUB-RTN                  S21008 72738721
         IC    R9,TSBFLG2               SAVE TSBBIPI SETTING     S21008 72739721
         NI    TSBFLG2,OFF-TSBBIPI      REQUEST OWAIT REMOVAL    S21008 72740721
*                                                                       72745721
RMVUOWT1 EQU   *                                                 S21008 72746721
         L     R15,UOWRR                GET USER-OWAIT-REMOVAL   S21008 72747721
*                                       RTN ADD                  S21008 72748721
         L     R12,AYOOBASE             GET BASE ADDR OF RTN     S21008 72749721
         BALR  R4,R15                   GO TO OWAIT REMOVAL RTN  S21008 72750721
*                                       ADDR                     S21008 72751721
*                                                                       72752721
         STC   R9,TSBFLG2               RESTORE TSBBIPI SETTING  S21008 72753721
         LM    R8,R12,SAVE8             RESTORE REGISTERS       YS02019 72754702
         SPACE 2                                                        72761320
*                                                                       72762020
* THIS SECTION TESTS FOR REMOVAL OF SYSTEM OWAIT                        72762720
*                                                                       72763420
         SPACE 2                                                        72764120
RMVTSOWT EQU   *                                                        72764820
         TM    RMVSW,RMVSOWT            DO WE WANT TO REMOVE SYS OWAIT  72765502
         BZ    RMVEXIT                  NO,EXIT                         72766202
         LR    R8,R6                    GET TSB ADDR FOR SUB-RTN S21008 73366221
         STM   R6,R7,SAVE6              SAVE REGISTERS          YS02019 76366202
         ST    R12,SAVE12               SAVE BASE ADDRESS       YS02019 76966202
         L     R15,SOWRR                GET SYS-OWAIT REMOVAL    S21008 77566221
*                                       RTN ADDR                 S21008 78166221
         L     R12,AYOOBASE             GET BASE ADDR OF RTN     S21008 78766221
         BALR  R1,R15                   GO REMOVE SYSTEM OWAIT   S21008 79366221
         L     R12,SAVE12               RESTORE BASE ADDRESS    YS02019 79966202
         STM   R6,R7,SAVE6              RESTORE REGISTERS       YS02019 80566202
         SPACE 2                                                        84240020
         SPACE 5                                                        92520020
*                                                                       92610020
* COMMON EXIT FOR RMVWAIT  ROUTINE                                      92700020
*                                                                       92790020
RMVEXIT  DS    0H                                                       92880020
         LM    R14,R15,SAVE14           RESTORE REGISTERS        TS1637 92970002
         BR    R15                      RETURN                          93060020
         SPACE 3                                                        93061002
*                                                               YS02019 93062002
* GO TO TPQ FOR TPOSTING THE TSB TO AYP                         YS02019 93063002
*                                                               YS02019 93064002
*                                                               YS02019 93065002
* INTERFACE TO IEDAYTPQ                                         YS02019 93066002
*                                                               YS02019 93067002
*        R0  - RETURN ADDRESS                                   YS02019 93068002
*        R1  - ZERO, MEANS TPOST TSB TO IEDQYP                  YS02019 93069002
*        R2  - TSB ADDRESS                                      YS02019 93070002
*        R13 - ADDRESS OF 6-WORD SAVE AREA                      YS02019 93071002
*        R15 - ENTRY POINT ADDRESS                              YS02019 93072002
*                                                               YS02019 93073002
TPOSTAYP EQU   *                                                YS02019 93074002
         SR    R1,R1                    INDICATE TPOST TSB TO   YS02019 93075002
*                                       AYP                     YS02019 93076002
         LR    R2,R6                    PASS TSB ADDRESS        YS02019 93077002
         L     R15,TPOSTRTN             GET TPOST RTN'S EPA     YS02019 93078002
         BALR  R0,R15                   GO TO TPOST TSB TO AYP  YS02019 93079002
         BR    R7                       GO BACK TO CALLER       YS02019 93080002
         SPACE 3                                                        93081002
         DS    0F                       FORCE WORD BOUNDARY     YS02019 93082002
MASK1    DC    AL1(0,0,QCBREAD,0)       MASK - INDICATING       YS02019 93083002
*                                       QCBREAD BIT POSITION    YS02019 93084002
MASK2    DC    AL1(255,255,255,255-QCBREAD)  MASK - TURN OFF    YS02019 93085002
*                                       QCBREAD                 YS02019 93086002
MASK3    DC    AL1(0,0,QCBTGET,0)       MASK - INDICATING       YS02019 93087002
*                                       QCBTGET BIT POSITION    YS02019 93088002
MASK4    DC    AL1(255,255,255,255-QCBTGET)  MASK - TURN OFF    YS02019 93089002
*                                       QCBTGET                 YS02019 93090002
MASK5    DC    AL1(0,0,QCBPARTO,0)      MASK - INDICATING       YS02019 93091002
*                                       QCBPARTO BIT POSITION   YS02019 93092002
MASK6    DC    AL1(255,255,255,255-QCBPARTO) MASK - TURN OFF    YS02019 93093002
*                                       QCBPARTO                YS02019 93094002
MASK7    DC    AL1(0,0,QCBNOBUF,0)      MASK - INDICATING       YS02019 93095002
*                                       QCBNOBUF BIT POSITION   YS02019 93096002
MASK8    DC    AL1(255,255,255,255-QCBNOBUF) MASK - TURN OFF    YS02019 93097002
*                                       QCBNOBUF                YS02019 93098002
MASK9    DC    AL1(TSBTPAYI,0,0,0)      MASK - TURN ON TSBTPAYI YS02019 93099002
         EJECT                                                          93150020
*                                                                       93240020
* WORKAREAS,DSECTS                                                      93330020
*                                                                       93420020
HIGHBIT  DS    0F                                                S21008 93420721
         DC    X'80000000'              HIGH ORDER BIT MASK      S21008 93421421
TPOSTRTN DC    V(IEDAYTPQ)              TPOST RTN'S EPA         YS02019 93422102
UOWRR    DC    V(IEDAYQIO)              USER OWAIT REMOVAL RTN  YS02019 93422802
SOWRR    DC    V(IEDAYQSO)              SYS OWAIT REMOVAL RTN   YS02019 93423502
AYOOBASE DC    V(QTIP0110)              IEDAYOO BASE ADDRESS     S21008 93424221
AYQBRAD  DC    V(IEDAYQBR)              BFR RETURN RTN'S EPA    YS02019 93424402
PATCHIT  DC    10F'0'                   PATCH AREA              YS02019 93424602
         SPACE 3                                                        93424802
ATTNSAVE DSECT                                                          93435020
SAVE0    DS    F                        RPT SAVE AREA WORD 0    YS02019 93465002
SAVE1    DS    F                        RPT SAVE AREA WORD 1    YS02019 93485002
SAVE2    DS    F                        RPT SAVE AREA WORD 2    YS02019 93505002
SAVE3    DS    F                        RPT SAVE AREA WORD 3    YS02019 93525002
SAVE4    DS    F                        RPT SAVE AREA WORD 4    YS02019 93545002
SAVE5    DS    F                        RPT SAVE AREA WORD 5    YS02019 93565002
SAVE6    DS    F                        RPT SAVE AREA WORD 6    YS02019 93585002
SAVE7    DS    F                        RPT SAVE AREA WORD 7    YS02019 93605002
SAVE8    DS    F                        RPT SAVE AREA WORD 8    YS02019 93625002
SAVE9    DS    F                        RPT SAVE AREA WORD 9    YS02019 93645002
SAVE10   DS    F                        RPT SAVE AREA WORD 10   YS02019 93665002
SAVE11   DS    F                        RPT SAVE AREA WORD 11   YS02019 93685002
SAVE12   DS    F                        RPT SAVE AREA WORD 12   YS02019 93705002
SAVE13   DS    F                        RPT SAVE AREA WORD 13   YS02019 93725002
SAVE14   DS    F                        RPT SAVE AREA WORD 14   YS02019 93745002
SAVE15   DS    F                        RPT SAVE AREA WORD 15   YS02019 93765002
PARMSW   DS    0XL3                                                     93870020
CLRSW    DC    X'00'                    INPUT PARM TO CLROUTQ           93960020
CLRTRL   EQU   X'80'                    ON=CLEAR TRLR Q                 94050002
CLRTJID  EQU   X'40'                    ON=CLEAR TJID TYPE MSGS         94140002
CLRATTN  EQU   X'20'                    ON=ATTN IS CLEARING Q'S         94230020
CLRHANG  EQU   X'10'                    ON=HANGUP IS CLEARING Q'S       94320020
CLRTCLRQ EQU   X'08'                    ON=TCLEARQ IS CLEARING Q'S      94410020
CLRIGN   EQU   X'04'                    ATTENTION IGNORED               94450002
RMVSW    DC    X'00'                    SWITCH FOR REMOVING WAITS       94520020
RMVULW   EQU   X'80'                    REMOVE USER LWAITS              94590020
RMVSLW   EQU   X'40'                    SYSTEM LWAITS                   94680002
RMVUOWT  EQU   X'20'                    INDICATES REMOVE USER OWAIT     94780002
RMVSOWT  EQU   X'10'                    INDICATES REMOVE SYSTEM OWAIT   94880002
         EJECT                                                          95760020
         IHAASCB                                                YS02019 95860002
         TAVTD                                                          95960020
         IKJTIOCB                                                       96160020
CVT      DSECT                                                          96360020
         CVT                                                            96560020
         TPRIOR                                                         96760020
         TQCBD                                                          96960020
         TSCBD                                                          97210021
         IKJTCB                                                         97360020
         EJECT                                                          97410002
         TTCXD                                                  YS02019 97460002
         EJECT                                                          97510002
         IKJTIOCP                                                       97560020
         IKJTSB                                                         98160020
         TTSID                                                          98560020
         END                                                            98760020
