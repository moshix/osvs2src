         TITLE 'IEDAYI  - TSINPUT'                                      00070000
IEDAYI   CSECT                                                          00140000
         SPACE 1                                                        00210000
         DC    AL1(DSPMCPL2),X'00'      ACTIVATION KEY                  00280000
         SPACE 1                                                        00350000
*********************************************************************** 00420000
*                                                                     * 00490000
*                                                                M2688  00560000
*                                                                M3278  00630000
*                                                                TS1628 00700000
*                                                                M0030  00770000
*                                                                 M3462 00840000
*                                                                 M0045 00910000
*                                                                 M5303 00980000
*                                                                 M5469 01050000
*          POST VS2-1.6 CHANGES                                         01120000
*0000083300,373879,373880,386422                     UY74706   @YA11732 01190000
*0000083300,373300,374210-374260                               @YA11732 01260000
*                                      OY11039 FIX INCLUDED IN @YA11732 01330000
*0000092500-092960                                              YA08403 01400000
*C083300                                                        YA06046 01470000
*A716700,716800,677940,677960                                   YA04775 01540000
*A461700-461920                                                 YA06046 01610000
*C462000                                                        YA06046 01680000
*C581000                                                       @SA77948 01700000
*D581700-585200                                                @SA77948 01720000
*          RELEASE 1, VS/2 CHANGES                              YS06327 01750000
*D005600,185000                                                 YS06327 01820000
*C005500,177000,190000                                          YS06327 01890000
*A182500-183500                                                 YS06327 01960000
*          RELEASE 21 DELETIONS                                       * 02030000
*0884006200,013800,175000-179000,184000,185000-187000,190000,    S22029 02100000
*0884200000,230000-233000,235000-235300,337000,341000-342000,    S22029 02170000
*0884347000,350000,485000,490600-491500,516400-517600,525700-    S22029 02240000
*0884526600,962000-970000                                        S22029 02310000
*0884                                                            A44839 02380000
*                                                                     * 02450000
*0884005860,083300,129000,142000,183000,227000,235600,236400,    S22028 02520000
*0884240500,246000,335200,338000,339200,358940,368700,463000,    S22028 02590000
*0884486200                                                      S22028 02660000
*                                                              @Y17XAYP 02730000
*        TCAM VERSION 10.0 CHANGES                             @Y17XAYP 02800000
*                                                              @Y17XAYP 02870000
*A150500,189700                                                @Y17XAYP 02940000
*C186200                                                       @Y17XAYP 03010000
*                                                              @G36XRYP 03020000
*A143500                                                       @G36XRYP 03030000
*A213500,360500,367500,432600,518000,673400.791700             @G36XRYP 03040000
*C175000-175700,518000,828100,956200,959000                    @G36XRYP 03050000
*D214200-217700,674100,792400                                  @G36XRYP 03060000
*                                                              @G36XRYP 03070000
*C221900,431200-432600                                         @OZ16528 03072010
*A396900,436100,441000,471800                                  @OZ16528 03074010
*A450800                                                       @OZ16528 03076010
*A448700,458500,469000                                         @OZ24913 03078000
*A343700                                                       @OY19848 03078186
************************************************************** @Y17XAYP 03080000
*                                                              @Y17XAYP 03150000
* MODULE NAME = IEDAYI (TCAM,TSO)                              @Y17XAYP 03220000
*                                                              @Y17XAYP 03290000
* DESCRIPTIVE NAME = TIME SHARING INPUT ROUTINE                @Y17XAYP 03360000
*                                                              @Y17XAYP 03430000
* COPYRIGHT = NONE                                             @Y17XAYP 03500000
*                                                              @Y17XAYP 03570000
* STATUS = VERSION 10.0                                        @G36XRYP 03640000
*                                                                     * 03710000
* FUNCTION -                                                          * 03780000
*    THIS ROUTINE IS RESPONSIBLE FOR MOVING THE INCOMING TEXT FROM A  * 03850000
*    TCAM BUFFER INTO A TIME SHARING BUFFER OR BUFFERS AND PLACING    * 03920000
*    THE BUFFER(S) ON THE INPUT QUEUE.                                * 03990000
*                                                                     * 04060000
* ENTRY POINTS -                                                      * 04130000
*    ENTRY IS ALWAYS THROUGH THE FIRST EXECUTABLE INSTRUCTION.        * 04200000
*    CONTROL IS ALWAYS RECEIVED FROM THE TCAM DISPATCHER UNDER ONE OF * 04270000
*    THE FOLLOWING CONDITIONS.                                        * 04340000
*                                                                     * 04410000
*    1 - EITHER THE PCI APPENDAGE, WHICH INDICATES A FULL TCAM BUFFER,* 04480000
*        OR THE LINE END APPENDAGE, WHICH INDICATES THE END OF THE    * 04550000
*        MESSAGE (EOT, EOB, BREAK-IN, OR TIME OUT), QPOSTS A TCAM     * 04620000
*        BUFFER TO THE MHR.  THE FORWARD AND LOGON MACROS IN THE      * 04690000
*        INHDR SECTION OF THE MHR PERFORM THE INITIALIZATION NECES-   * 04760000
*        SARY TO DIRECT THE BUFFER TO TSINPUT.  SUBSEQUENTLY, AT THE  * 04830000
*        END OF THE INPUT MESSAGE HANDLING ROUTINES, THE BUFFER IS    * 04900000
*        QPOSTED TO THE TSINPUT DESTINATION QCB.                      * 04970000
*                                                                     * 05040000
*    2 - WHEN ONE OF THE TIOC ROUTINES (TGET, TCLEARQ, TSOUTPUT, OR   * 05110000
*        ATTENTION) QPOSTS TSINPUT'S DESTINATION QCB TO ITSELF FOR    * 05180000
*        THE PURPOSE OF REMOVING THE SYSTEM LWAIT CONDITION.          * 05250000
*                                                                     * 05320000
* INPUT -                                                             * 05390000
*    THE FOLLOWING PARAMETERS ARE PASSED WHEN CONTROL IS RECEIVED AS  * 05460000
*    THE RESULT OF ENTRY (1) DESCRIBED ABOVE.                         * 05530000
*        REGISTER 1  CONTAINS THE TCAM BUFFER ADDRESS.                * 05600000
*        REGISTER 7  CONTAINS TSINPUT'S DESTINATION QCB ADDRESS.      * 05670000
*        REGISTER 11 CONTAINS THE ADDRESS OF THE TCAM DISPATCHER.     * 05740000
*        REGISTER 13 CONTAINS THE ADDRESS OF AVTSAVE2.                * 05810000
*        REGISTER 15 CONTAINS THE ENTRY POINT ADDRESS OF TSINPUT.     * 05880000
*                                                                     * 05950000
*    THE FOLLOWING PARAMETERS ARE PASSED WHEN CONTROL IS RECEIVED AS  * 06020000
*    THE RESULT OF ENTRY (2) DESCRIBED ABOVE.                         * 06090000
*        REGISTER 1  CONTAINS TSINPUT'S DESTINATION QCB ADDRESS.      * 06160000
*        REGISTER 7  CONTAINS TSINPUT'S DESTINATION QCB ADDRESS.      * 06230000
*        REGISTER 11 CONTAINS THE ADDRESS OF THE TCAM DISPATCHER.     * 06300000
*        REGISTER 13 CONTAINS THE ADDRESS OF AVTSAVE2.                * 06370000
*        REGISTER 15 CONTAINS THE ENTRY POINT ADDRESS OF TSINPUT.     * 06440000
*                                                                     * 06510000
* OUTPUT -                                                            * 06580000
*    REGISTER 1 - CONTAINS THE ADDRESS OF THE FIRST AND ONLY OR FIRST * 06650000
*    IN A CHAIN OF ELEMENTS TO BE POSTED BY THE TCAM DISPATCHER.  IF  * 06720000
*    NO ELEMENTS ARE TO BE POSTED, REGISTER 1 MUST CONTAIN ZEROS. THE * 06790000
*    ELEMENTS BEING POSTED MAY BE QCB'S, LCB'S, OR TCAM BASIC UNITS   * 06860000
*    (ALWAYS RETURNED AS ONE TCAM BUFFER).  THIS CHAIN OF ELEMENTS    * 06930000
*    MAY CONTAIN ANY NUMBER OF QCB'S AND/OR LCB'S, HOWEVER, IF A TCAM * 07000000
*    BUFFER IS BEING POSTED, IT WILL ALWAYS APPEAR AS THE LAST        * 07070000
*    ELEMENT IN THE CHAIN.                                            * 07140000
*                                                                     * 07210000
*    REGISTER 11 - CONTAINS THE ADDRESS OF THE TCAM DISPATCHER.       * 07280000
*                                                                     * 07350000
* EXTERNAL REFERENCES -                                               * 07420000
*    THE QTIP SVC (SVC 101) WITH THE APPROPRIATE ENTRY CODES, IS      * 07490000
*    USED BY THIS ROUTINE TO PASS CONTROL TO A ROUTINE WITHIN QTIP    * 07560000
*    NAMED 'IEDAYII'.  IEDAYII IS A LOGICAL EXTENSION OF TSINPUT USED * 07630000
*    TO INTERFACE WITH THE CONTROL BLOCKS AND BUFFERS WITHIN THE TSO  * 07700000
*    REGION.                                                          * 07770000
*                                                                     * 07840000
* EXITS, NORMAL -                                                     * 07910000
*    CONTROL IS ALWAYS RETURNED BY BRANCHING TO 'DSPCHAIN' WITHIN THE * 07980000
*    TCAM DISPATCHER.                                                 * 08050000
*                                                                     * 08120000
* EXITS, ERROR -                                                      * 08190000
*    NONE                                                             * 08260000
*                                                                     * 08330000
* TABLES/WORK AREAS -                                                 * 08400000
*    THE FIRST BYTE OF THE TCAM BUFFER 'PRFSRCE' FIELD IS CLEARED IN  * 08470000
*    ORDER TO SAVE INFORMATION CONTAINED IN LCB AND THE STATUS OF THE * 08540000
*    TCAM BUFFER IF INSUFFICIENT TS BUFFERS ARE AVAILABLE TO PROCESS  * 08610000
*    ALL THE DATA IN THE TCAM BUFFER.                                 * 08680000
*                                                                     * 08750000
*    A DOUBLE WORD AREA IN THE AVT LABELED 'AVTDOUBL' IS USED TO      * 08820000
*    BUILD THE CHAIN OF ELEMENTS TO BE POSTED BY THE TCAM DISPATCHER  * 08890000
*    AFTER EXITING FROM TSINPUT.                                      * 08960000
*                                                                     * 09030000
* ATTRIBUTES -                                                        * 09100000
*    SERIALLY-REUSABLE, REFRESHABLE, ENABLED                          * 09170000
*                                                                     * 09240000
* CHARACTER CODE DEPENDENCY -                                         * 09310000
*    THIS ROUTINE IS DEPENDENT ON THE FOLLOWING EBCDIC CHARACTERS.    * 09380000
*        X'0D' - EBCDIC CARRIAGE RETURN CHARACTER.  EQUATED TO        * 09450000
*        'CARRRTRN' WITHIN THIS ROUTINE.                              * 09520000
*                                                                     * 09590000
*        X'15' - EBCDIC NEW LINE CHARACTER.  EQUATED TO 'NEWLINE'     * 09660000
*        WITHIN THIS ROUTINE.                                         * 09730000
*                                                                     * 09800000
*        X'25' - EBCDIC LINE FEED CHARACTER.  EQUATED TO 'LINEFEED'   * 09870000
*        WITHIN THIS ROUTINE.                                         * 09940000
*                                                                     * 10010000
* NOTES -                                                             * 10080000
*                                                                     * 10150000
*********************************************************************** 10220000
         EJECT                                                          10290000
*********************************************************************** 10360000
********                                                       ******** 10430000
******** REGISTER EQUATES                                      ******** 10500000
********                                                       ******** 10570000
*********************************************************************** 10640000
         SPACE 1                                                        10710000
R0       EQU   0                        INDEX REGISTER                  10780000
RWRKZ    EQU   R0                       WORK/PARAMETER REGISTER         10850000
RPARM    EQU   1                        WORK/PARAMETER REGISTER         10920000
RSCANF   EQU   2                        POINTER TO BEGIN OF DATA SCANED 10990000
RWRK2    EQU   RSCANF                   WORK/PARAMETER REGISTER         11060000
RSCANL   EQU   3                        POINTER TO END OF DATA SCANNED  11130000
RSCB     EQU   RSCANL                   SCB ADDRESS                     11200000
RWRK3    EQU   RSCB                     WORK/PARAMETER REGISTER         11270000
RBUEND   EQU   4                        END OF BASIC UNIT BEING SCANNED 11340000
RLCB     EQU   RBUEND                   LCB ADDRESS                     11410000
RBUADR   EQU   5                        ADDR OF BASIC UNIT BEING SCANED 11480000
RTRMNTRE EQU   RBUADR                   ADDR OF TERMINAL ENTRY TABLE    11550000
RPREFIX  EQU   6                        TCAM BUFFER ADDRESS             11620000
RQCB     EQU   7                        QCB ADDRESS                     11690000
RWRK7    EQU   RQCB                     WORK/PARAMETER REGISTER         11760000
RDSZE    EQU   8                        SIZE OF DATA IN TCAM BUFFER     11830000
RWRK8    EQU   RDSZE                    WORK/PARAMETER REGISTER         11900000
RTSB     EQU   9                        TSB ADDRESS                     11970000
RTIOC    EQU   10                       TIOCRPT ADDRESS                 12040000
RDISP    EQU   11                       DISPATCHER ADDRESS (IEDQEA)     12110000
RWK11    EQU   RDISP                    WORK/PARAMETER REGISTER         12180000
RBASE    EQU   12                       BASE REGISTER                   12250000
RAVT     EQU   13                       ADDRESS OF AVTSAVE2             12320000
RETRN    EQU   14                       RETURN ADDRESS                  12390000
RDEL     EQU   RETRN                    OFFSET TO DATA IN TCAM BFR      12460000
RWK14    EQU   RDEL                     WORK/PARAMETER REGISTER         12530000
RNTRE    EQU   15                       ENTRY POINT                     12600000
RTRNCD   EQU   RNTRE                    RETURN CODE                     12670000
RWK15    EQU   RTRNCD                   WORK/PARAMETER REGISTER         12740000
         EJECT                                                          12810000
*********************************************************************** 12880000
********                                                       ******** 12950000
******** MASKS AND DISPLACEMENTS                               ******** 13020000
********                                                       ******** 13090000
*********************************************************************** 13160000
         SPACE 1                                                        13230000
K0       EQU   0                        NULL DISPLACEMENT               13300000
K1       EQU   1                        BYTE DISPLACEMENT               13370000
CC3270ND EQU   1                        AID CHAR LENGTH FOR 3270 S22028 13440000
K2       EQU   2                        LENGTH FIELD                    13510000
K3       EQU   3                        LENGTH FIELD                    13580000
CC3270D3 EQU   3                        CONTROL CHAR LNG FOR     S22028 13650000
*                                       3270                     S22028 13720000
K4       EQU   4                        WORD DISPLACEMENT               13790000
CC3270D6 EQU   6                        TOTAL CONTROL CHAR       S22028 13860000
*                                       LENGTH                   S22028 13930000
*                                       FOR 3270                        14000000
NOTEQUAL EQU   7                        MASK FOR A CONDITION CODE OF 7  14070000
EQUAL    EQU   8                        MASK FOR CONDIT'N CODE 8        14140000
K11      EQU   11                       BYTE DISPLACEMENT        S22029 14210000
K12      EQU   12                       SAVE AREA OFFSET                14280000
K24      EQU   24                       LENGTH FIELD                    14350000
K64      EQU   64                       LENGTH FIELD           @G36XRYP 14380000
K68      EQU   68                       LENGTH FIELD                    14420000
ONE      EQU   X'01'                    CONSTANT                        14490000
CARRRTRN EQU   X'0D'                    CARRIAGE RETURN CHARACTER       14560000
NEWLINE  EQU   X'15'                    NEW LINE CHARACTER              14630000
WAITQBFR EQU   X'10'                    USED TO INDICATE TCAM BFR HAS   14700000
*                                       BEEN ON TCAM BFR WAIT QUEUE     14770000
NOTMOVED EQU   X'20'                    IND NOT ALL OF SCANNED DATA IN  14840000
*                                       TCAM BFR WAS MOVED TO TS BFR(S) 14910000
LINEFEED EQU   X'25'                    LINE FEED CHARACTER             14980000
SBA      EQU   X'11'                    SBA CHARACTER            S22028 15050000
TIMEOUT  EQU   X'40'                    TIME OUT OCCURED IN THIS BFR    15120000
WRITEBRK EQU   X'80'                    WRITE BREAK IN PROGRESS         15190000
CC32706  EQU   X'08'                    TCAM BUFFER HAS MORE     S22028 15260000
*                                       THAN                     S22028 15330000
*                                       ONE CONTROL CHARACTER           15400000
OFF      EQU   X'FF'                    USED TO RESET BITS              15470000
ZEROS    EQU   X'00'                    MASK TO ZERO SAVE AREA @YA11732 15540000
         EJECT                                                          15610000
********                                                                15680000
******** ESTABLISH ADDRESSABILITY                                       15750000
********                                                                15820000
         USING *,RBASE                  ESTABLISH ADDRESSABILITY        15890000
         LR    RBASE,RNTRE              PUT ENTRY PT ADDR INTO BASE REG 15960000
IEDAYI   IEDHJN AYI0000                                        @Y17XAYP 16030000
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REGISTER   16100000
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   16170000
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   16240000
         SPACE 2                                                        16310000
********                                                                16380000
******** INITIALIZATION-GET POINTERS TO THE TIOCRPT AND THE AVT.  ALSO  16450000
******** CLEAR A WORK AREA FOR A TCAM BUFFER RETURN QUEUE.              16520000
********                                                                16590000
TSIN0010 EQU   *                                                        16660000
         ST    RDISP,AVTSAVE2+K68       SAVE TCAM DISPATCHER ADDRESS    16730000
         L     RWRK2,CVTPTR             GET CVT ADDRESS                 16800000
         TM    AVTBIT3,AVTTSAB          DID TSO ABEND           YA08403 16870000
         BZ    TSOUP                    YES                     YA08403 16940000
         LA    RQCB,K0(R0,RQCB)         CLEAR HI ORDER BYTE     YA08403 17010000
         LA    RPARM,K0(R0,RPARM)       CLEAR HI ORDER BYTE     YA08403 17080000
         CLR   RPARM,RQCB              WAS A TCAM BUFFER PASSED YA08403 17150000
         BE    TSIN2050              NO, RETURN CONTROL TO TCAM YA08403 17220000
         B     TSIN0174                 YES,RETURN TCAM BUFFER  YA08403 17290000
TSOUP    EQU   *                                                YA08403 17360000
         USING CVT,RWRK2                USE RWRK2 AS CVT BASE REG       17430000
         L     RTIOC,CVTAQAVT           GET TCX ADDRESS        @G36XRYP 17500000
         L     RTIOC,TCXRPT-IEDQTCX(,RTIOC) GET ADDR TIOCRPT   @G36XRYP 17570000
         DROP  RWRK2                    DROP RWRK2 AS CVT BASE REG      17640000
         XC    AVTDOUBL,AVTDOUBL        CLEAR A WORK AREA IN THE AVT    17710000
         SPACE 2                                                        17780000
********                                                                17850000
******** ENTRY CHECK                                                    17920000
********                                                                17990000
         LA    RQCB,K0(R0,RQCB)         CLEAR HI ORDER BYTE OF REGISTER 18060000
         LA    RPARM,K0(R0,RPARM)       CLEAR HI ORDER BYTE OF REGISTER 18130000
         CLR   RPARM,RQCB               WAS A TCAM BUFFER PASSED        18200000
         BE    TSIN2000                 BRANCH IF NO                    18270000
         LR    RPREFIX,RPARM            GET TCAM BUFFER ADDRESS         18340000
         USING IEDQPRF,RPREFIX          USE RPREFIX AS PREFIX BASE REG  18410000
         SPACE 2                                                        18480000
********                                                                18550000
******** FIND ASSOCIATED LCB AND SCB FOR THIS TERMINAL                  18620000
********                                                                18690000
         USING IEDQLCB,RLCB             USE RLCB AS LCB BASE REGISTER   18760000
         USING IEDQSCB,RSCB             USE RSCB AS SCB BASE REGISTER   18830000
         L     RLCB,PRFLCB-K1           GET LCB ADDRESS                 18900000
         L     RSCB,LCBSCBA-K1          ADDRESS OF THE CURRENT SCB      18970000
         SPACE 2                                                        19040000
********                                                                19110000
******** FIND ASSOCIATED TERMINAL ENTRY TABLE AND QCB FOR THIS TERMINAL 19180000
********                                                                19250000
         USING IEDNTRM,RTRMNTRE         TRM PREFIX             @Y17XAYP 19320000
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE REGISTER   19390000
         LH    RPARM,PRFSRCE            GET INDEX TO TNT                19460000
         L     RWK15,AVTRNMPT           GET ADDRESS OF TNT              19530000
         BALR  RETRN,RNTRE              BR TO CODE AT BEGINNING OF TNT  19600000
         LR    RTRMNTRE,RPARM           GET ADDR OF TERM ENTRY TABLE    19670000
         LA    RQCB,TRMPRFSZ            GET SIZE OF TRM PREFIX @Y17XAYP 19740000
         SR    RTRMNTRE,RQCB            BACK UP TO PREFIX      @Y17XAYP 19810000
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 19880000
         BNO   NOTRMBRK                 NO, TRMWRBRK CAN'T BE  @Y17XAYP 19950000
*                                       SET                    @Y17XAYP 20020000
         TM    TRMBYTE2,TRMWRBRK        WRITE BREAK IN PROGRESS@Y17XAYP 20090000
         BNO   NOTRMBRK                 NO, DON'T INDICATE     @Y17XAYP 20160000
*                                       WRITE BREAK IN PROGRESS@Y17XAYP 20230000
         OI    LCBTSOB,LCBWRBRK         INDICATE WRITE BREAK   @Y17XAYP 20300000
*                                       IN PROGRESS            @Y17XAYP 20370000
         NI    TRMBYTE2,OFF-TRMWRBRK    TURN OFF TRM WRITE     @Y17XAYP 20440000
*                                       BREAK INDICATOR        @Y17XAYP 20510000
NOTRMBRK EQU   *                                               @Y17XAYP 20580000
         L     RQCB,TRMDESTQ-K1         GET DEST QCB ADDR FOR THIS TERM 20650000
         TM    QCBFLAG,QCBTSSES         IS TSO SESSION IN PROGRESS      20720000
         BZ    TSIN0174                 RETURN TCAM BFR IF NOT          20790000
         TM    AVTBIT3,AVTTSAB          DID TSO ABEND            A44839 20860000
         BO    TSIN0174                 RETURN TCAM BUFFERS IF   A44839 20930000
*                                       YES                      A44839 21000000
         DROP  RTRMNTRE                 DROP TERM ENTRY TBL BASE REG    21070000
         SPACE 2                                                        21140000
********                                                                21210000
******** FIND ASSOCIATED TSB FOR THIS TERMINAL                          21280000
********                                                                21350000
         ST    RQCB,AVTSAVE2+K64        SAVE QCB ADDR FOR QTIP9@ZM46757 21400000
         LH    RWRK8,QCBTJID            GET ASID               @G36XRYP 21560000
         BCTR  RWRK8,0                  MINUS ONE FOR INDEX    @ZM46757 21565000
         SLL   RWRK8,2                  MULTIPLY ASID BY 4     @G36XRYP 21580000
         L     RWRK2,CVTPTR             GET CVT ADDRESS        @G36XRYP 21590000
         L     RWRK2,CVTASVT-CVT(RWRK2) GET ASVT ADDRESS       @G36XRYP 21600000
         AR    RWRK2,RWRK8              GET INDEX TO ASCB      @G36XRYP 21610000
         L     RTSB,ASVTENTY-ASVT(RWRK2) GET ASCB ADDRESS      @ZM46757 21620000
         L     RTSB,ASCBTSB-ASCBEGIN(RTSB)     GET TSB ASSRESS @ZM46758 21660000
         SPACE 2                                                        21840000
********                                                                21910000
******** IF THIS IS THE LAST TCAM BUFFER OF THE MESSAGE, PERFORM END OF 21980000
******** MESSAGE PROCESSING AND SAVE RELATED INFORMATION IN THE FIRST   22050000
******** BYTE OF THE TIC FIELD IN THE FIRST BASIC UNIT OF THE TCAM      22120000
******** BUFFER ACCORDING TO THE FOLLOWING FORMAT.                      22190000
********                                                                22260000
********       BIT 0 - WILL REFLECT THE LCBWRBRK BIT.                   22330000
********                                                                22400000
********       BIT 1 - WILL REFLECT THE OCCURANCE OF TIME OUT (X'01' IN 22470000
********               LCBSENS0).                                       22540000
********                                                                22610000
********       BIT 2 - WILL INDICATE THAT PART OF THE LAST LINE SCANNED 22680000
********               IN THIS TCAM BFR WAS NOT MOVED TO TS BFR(S).     22750000
********                                                                22820000
********       BIT 3 - WILL INDICATE THAT THIS BUFFER HAS BEEN ON THE   22890000
********               TCAM BUFFER WAIT QUEUE.                          22960000
********                                                                23030000
         CLC   PRFSIZE,AVTFZERO         IS SIZE FIELD ZEROS             23100000
         BE    TSIN0174                 RETURN TCAM BFR IS YES          23170000
         USING IEDQTSI,RWRK8            EST TSINPUT'S QCB BASE          23240000
         L     RWRK8,AVTTSOPT           ADDR OF TSINPUT'S QCB           23310000
         LA    RWRK8,TSIBUFQ            ADDR OF BFR WAIT QUEUE          23380000
         DROP  RWRK8                    DROP TSINPUT'S QCB BASE         23450000
         TM    TSBFLG1,TSBIFLSH         IS TCLEARQ INPUT IN PROGRESS    23520000
         BO    TSIN0012                 YES, CHECK TCAM BFR WAIT QUEUE  23590000
         NI    PRFTIC,AVTEZERO          CLEAR FIRST BYTE OF TIC FIELD   23660000
         TM    PRFSTAT1,PRFNHDRN        NOT FIRST BUFFER OF MSG@OZ16528 23670010
         BO    TSINOK                   YES, SKIP CLEAR        @OZ16528 23680010
         MVI   SCBSRCE,ZEROS            CLEAR SAVE AREA        @OZ16528 23730010
TSINOK   EQU   *                                               @OZ16528 23740010
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST TCAM BFR OF MSG    23800000
         BO    TSIN0019                 BRANCH IF NO                    23870000
         NI    QCBFLAG,OFF-QCBREAD      IND READ NO LONGER HAS PRIORITY 23940000
         TM    LCBTSOB,LCBWRBRK         DID A WRITE BREAK OCCUR         24010000
         BZ    TSIN0011                 BRANCH IF NO                    24080000
         OI    PRFTIC,WRITEBRK          IND WRITE BREAK IN PROGRESS     24150000
         SPACE 1                                                        24220000
TSIN0011 EQU   *                                                        24290000
         NI    LCBTSOB,OFF-LCBWRBRK     RESET WRITE BREAK INDICATOR     24360000
         TM    PRFSTAT1,PRFCNCLN        IS THIS TCAM MSG TO BE CANCELED 24430000
         BO    TSIN0012                 BRANCH IF YES                   24500000
         TM    SCBERR3,SCBATTN+SCBSATTN+SCBXPI+SCBXPD  DID ATTEN OCCUR  24570000
         BZ    TSIN0018                 BRANCH IF NO                    24640000
         OI    PRFSTAT1,PRFCNCLN        IND THAT MSG IS TO BE CANCELED  24710000
         SPACE 1                                                        24780000
TSIN0012 EQU   *                                                        24850000
         TM    QCBTSOF2,QCBBUFQ         ANY TCAM BFRS ON WAIT QUEUE FOR 24920000
*                                       THIS QCB                        24990000
         BZ    TSIN0016                 BRANCH IF NONE FOR THIS QCB     25060000
         LR    RWK11,RPREFIX            SAVE PASSED TCAM BFR ADDRESS    25130000
         LA    RTSB,K0(R0,RTSB)         CLEAR HI-ORDER BYTE OF REG      25200000
         SPACE 1                                                        25270000
TSIN0013 EQU   *                                                        25340000
         L     RPREFIX,K0(R0,RWRK8)     GET NEXT TCAM BFR ON WAIT QUEUE 25410000
         LA    RPREFIX,K0(R0,RPREFIX)   CLEAR HI-ORDER BYTE OF REG      25480000
         LTR   RPREFIX,RPREFIX          ANY MORE TCAM BFRS ON QUEUE     25550000
         BZ    TSIN0015                 BRANCH IF NO MORE               25620000
         L     RWRK2,PRFQCBA-K1         GET ADDR OF ASSOCIATED TSB      25690000
         LA    RWRK2,K0(R0,RWRK2)       CLEAR HI-ORDER BYTE OF REG      25760000
         CR    RTSB,RWRK2               IS BFR PART OF THIS TCAM MSG    25830000
         BE    TSIN0014                 BRANCH IF YES                   25900000
         LA    RWRK8,PRFLINK-K1         ADDR OF NEXT BFR POINTER        25970000
         B     TSIN0013                 BRANCH TO CONTINUE SEARCH       26040000
         SPACE 1                                                        26110000
TSIN0014 EQU   *                                                        26180000
         MVC   K1(K3,RWRK8),PRFLINK     RE-CHAIN TCAM BFR WAIT QUEUE    26250000
         LA    RETRN,TSIN0013           SET RETURN ADDR TO CONT SCAN    26320000
         B     TSIN4000                 BRANCH TO BFR RETURN ROUTINE    26390000
         SPACE 1                                                        26460000
TSIN0015 EQU   *                                                        26530000
         NI    QCBTSOF2,OFF-QCBBUFQ     IND NO MORE TCAM BFRS ARE IN    26600000
*                                       THE WAIT QUEUE FOR THIS QCB     26670000
         LR    RPREFIX,RWK11            RESTORE LAST TCAM BFR ADDRESS   26740000
         USING IEDQTSI,RWRK8            EST TSINPUT'S QCB BASE REGISTER 26810000
         L     RWRK8,AVTTSOPT           GET ADDR OF TSINPUT'S QCB       26880000
         LA    RWRK8,TSIBUFQ            GET ADDR OF TCAM BFR WAIT QUEUE 26950000
         DROP  RWRK8                    DROP TSINPUT'S QCB BASE REG     27020000
         SPACE 1                                                        27090000
TSIN0016 EQU   *                                                        27160000
         TM    TSBFLG1,TSBIFLSH         IS TCLEARQ INPUT IN PROGRESS    27230000
         BO    TSIN2028                 YES, RETURN TCAM BUFFER         27300000
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  27370000
         BE    TSIN0017                 BRANCH IF NONE FOR THIS TSB     27440000
         SPACE 2                                                        27510000
********                                                                27580000
******** CALL QTIP TO DELETE ANY FRAGMENT MESSAGE WHICH MAY BE ON THE   27650000
******** INPUT QUEUE.                                                   27720000
********                                                                27790000
         QTIP  8,(RAVT)                                                 27860000
         SPACE 2                                                        27930000
********                                                                28000000
******** IF AUTOMATIC CHARACTER PROMPTING IS IN PROGRESS, REPROMPT THE  28070000
******** USER WITH THE PROMPT CHARACTER OR THE LAST LINE NUMBER.        28140000
********                                                                28210000
TSIN0017 EQU   *                                                        28280000
         TM    TSBFLG2,TSBAUTON         IS AUTO PROMPTING IN PROGRESS   28350000
         BZ    TSIN0174                 BRANCH IF NO                    28420000
         OI    SCBERR2,SCBALN           TELL TCAM TO PROMPT THE USER    28490000
         B     TSIN0174                 BRANCH TO RETURN TCAM BUFFER    28560000
         DROP  RSCB                     DROP RSCB AS SCB BASE REGISTER  28630000
         SPACE 1                                                        28700000
TSIN0018 EQU   *                                                        28770000
         TM    LCBSENS0,ONE             DID TIME OUT OCCUR IN THIS BFR  28840000
         BZ    TSIN0019                 BRANCH IF NO                    28910000
         OI    PRFTIC,TIMEOUT           IND TIME OUT OCCURED IN BFR     28980000
         SPACE 2                                                        29050000
********                                                                29120000
******** DETERMINE WHETHER THIS IS A TCAM HEADER OR A TCAM TEXT BUFFER  29190000
******** AND SET THE DATA OFFSET EQUAL TO THE APPROPRIATE TCAM PREFIX   29260000
******** SIZE PLUS THE NUMBER OF RESERVES (FROM LCBISZE).               29330000
********                                                                29400000
TSIN0019 EQU   *                                                        29470000
         LH    RDSZE,PRFSIZE            SIZE OF DATA IN TCAM BFR        29540000
         SR    RPARM,RPARM              CLEAR FOR INSERTION     YS06327 29610000
         IC    RPARM,LCBISZE            GET NUMBER OF RESERVES  YS06327 29680000
         DROP  RLCB                     DROP LCB BASE REG       YS06327 29750000
         LA    RDEL,AVTHDRSZ(,RPARM)    DATA OFFSET FOR HDR     YS06327 29820000
         TM    PRFSTAT1,PRFNHDRN        IS THIS FIRST BFR OF MESSAGE    29890000
         BZ    TSIN0028                 BRANCH IF YES                   29960000
         LA    RDEL,AVTTXTSZ(,RPARM)    DATA OFFSET FOR TXT     YS06327 30030000
         SPACE 2                                                        30100000
********                                                                30170000
******** DETERMINE IF THERE ARE ANY TCAM BUFFERS ON THE TCAM BUFFER     30240000
******** WAIT QUEUE FOR THIS TSB.  IF THERE ARE, PLACE THIS TCAM BUFFER 30310000
******** ON THE QUEUE.                                                  30380000
********                                                                30450000
TSIN0020 EQU   *                                                        30520000
         STH   RDEL,PRFSRCE             PUT DATA OFFSET INTO HDR BFR    30590000
         SR    RDSZE,RDEL               ACTUAL SIZE OF DATA IN TCAM BFR 30660000
         STH   RDSZE,PRFSIZE            STORE UPDATED DATA SIZE         30730000
         TM    QCBTSOF2,QCBBUFQ         ANY TCAM BFRS ON BFR WAIT QUEUE 30800000
*                                       FOR THIS TSB                    30870000
         BO    TSIN0240                 YES, PUT BFR ON WAIT Q          30940000
         B     TSIN0052                 BRANCH TO PROCESS TCAM BUFFER   31010000
         SPACE 2                                                        31080000
********                                                                31150000
******** SINCE THIS IS THE FIRST TCAM BUFFER OF THE MESSAGE, THE FIRST  31220000
******** TWO OR THREE BYTES OF DATA MAY BE ALL ZEROS. IF SO, ADJUST     31290000
******** DATA OFFSET AND DATA SIZE VALUES TO EXCLUDE THESE BYTES.       31360000
********                                                                31430000
TSIN0028 EQU   *                                                        31500000
         LA    RSCANF,K12(RDEL,RPREFIX) POINT TO 1ST DATA CHAR   S22029 31570000
         SR    RDSZE,RDEL               DATA SIZE IN BUFFER      S22029 31640000
         SPACE 1                                                        31710000
TSIN0029 EQU   *                                                        31780000
         LTR   RDSZE,RDSZE              ANY DATA LEFT IN TCAM BFR       31850000
         BZ    TSIN0040                 BRANCH IF NO MORE        S22028 31920000
         CLI   K0(RSCANF),AVTEZERO      IS THIS BYTE OF DATA ALL ZEROS  31990000
         BNE   TSIN0030                 BRANCH IF NO                    32060000
         LA    RSCANF,K1(R0,RSCANF)     POINT TO NEXT CHAR IN TCAM BFR  32130000
         LA    RDEL,K1(R0,RDEL)         INCREMENT DATA OFFSET           32200000
         BCTR  RDSZE,R0                 DECR SIZE OF DATA IN TCAM BFR   32270000
         B     TSIN0029                 BR TO CHECK ZEROES AGAIN S22028 32340000
         SPACE 2                                                 S22028 32410000
********                                                                32480000
******** CHECK FOR 3270 TERMINAL, IF IT IS, BYPASS THE CONTROL          32550000
******** CHARACTERS IN SCANNING.  THE CONTROL CHARACTERS WILL BE MOVED  32620000
******** INTO TS BUFFERS BY IEDAYII.  THERE WILL BE ONE CONTROL (AID)   32690000
******** CHARACTER WHEN ONLY PROGRAM FUNCTION KEYS ARE ENTERED, BUT     32760000
******** THERE WILL BE EITHER THREE OR SIX CONTROL CHARACTERS IF ANY    32830000
******** TEXT DATA IS ENTERED. IF THE FOURTH CHARACTER IS X'11',        32900000
******** THE NUMBER OF CONTROL CHARACTERS WILL BE SIX. OTHERWISE        32970000
******** THERE WILL BE THREE CONTROL CHARACTERS. BIT 4 (X'08') IN THE   33040000
******** FIRST BYTE OF THE TIC FIELD IN THE TCAM BUFFER (PRFTIC)        33110000
******** WILL BE TURNED ON INDICATING TO IEDAYII THAT THERE ARE MORE    33180000
******** THAN ONE CONTROL CHARACTERS TO MOVE.                           33250000
********                                                                33320000
TSIN0030 EQU   *                                                 S22028 33390000
         TM    TSBSTAT,TSB3270          TEST FOR 3270            S22028 33460000
         BZ    TSIN0040                 BRANCH IF NO             S22028 33530000
         CH    RDSZE,CC3270L            IS DATA SIZE LESS THAN 3 S22028 33600000
         BNL   TSIN0032                 BRANCH IF NO             S22028 33670000
         LA    RDEL,CC3270ND(R0,RDEL)   ADD 1 TO DATA OFFSET     S22028 33740000
         BCTR  RDSZE,R0                 MINUS 1 FROM DATA SIZE   S22028 33810000
         B     TSIN0040                 GO TO STORE DATA SIZE    S22028 33880000
         SPACE 1                                                 S22028 33950000
TSIN0032 EQU   *                                                 S22028 34020000
         LA    RDEL,CC3270D3(R0,RDEL)   ADD 3 TO DATA OFFSET     S22028 34090000
         SH    RDSZE,CC3270L            SUBTRACT 3 FROM DATA     S22028 34160000
*                                       SIZE                     S22028 34230000
         OI    PRFTIC,CC32706           BUFFER HAS MORE THAN 1   S22028 34300000
*                                       CONTROL CHARACTERS              34370000
         CH    RDSZE,CC3270L            ANOTHER SBA FOLLOWS    @OY19848 34390086
         BL    TSIN0040                 NO                     @OY19848 34410086
         CLI   CC3270D3(RSCANF),SBA     CHECK FOR SBA CHAR       S22028 34440000
         BNE   TSIN0040                 BRANCH IF NOT            S22028 34510000
         SPACE 1                                                 S22028 34580000
         LA    RDEL,CC3270D3(R0,RDEL)   ADD 3 MORE TO DATA       S22028 34650000
*                                       OFFSET                   S22028 34720000
         SH    RDSZE,CC3270L            SUBTRACT 3 MORE FROM     S22028 34790000
*                                       DATA SIZE                S22028 34860000
         SPACE 2                                                        34930000
********                                                                35000000
******** STORE THE UPDATED DATA SIZE AND THE DATA OFFSET IN THE HEADER  35070000
******** BUFFER.                                                        35140000
********                                                                35210000
TSIN0040 EQU   *                                                 S22028 35280000
         STH   RDEL,PRFSRCE             PUT DATA OFFSET INTO HDR BFR    35350000
         STH   RDSZE,PRFSIZE            STORE UPDATED DATA SIZE         35420000
         SPACE 2                                                        35490000
********                                                                35560000
******** IF THERE ARE ANY TIME SHARING BUFFERS ON THE INPUT QUEUE FOR   35630000
******** THIS TSB, GET A POINTER TO THE LAST HEADER BUFFER ON THIS      35700000
******** QUEUE.                                                         35770000
********                                                                35840000
TSIN0052 EQU   *                                                        35910000
         USING TIOCBUF,RWK11            USE RWK11 AS TS BFR BASE REG    35980000
         L     RWK11,TSBIBFP-K1         GET FIRST BFR ON INPUT QUEUE    36050000
         LR    RWK15,RWK11              SAVE BUFFER PTR        @G36XRYP 36080000
         LA    RWK11,K0(R0,RWK11)       CLEAR HI ORDER BYTE OF REG      36120000
         LTR   RWK11,RWK11              ANY TS BFRS ON INPUT HDR QUEUE  36190000
         BZ    TSIN0062                 BRANCH IF NONE                  36260000
         SPACE 1                                                        36330000
TSIN0056 EQU   *                                                        36400000
         CLC   BUFFHEAD,AVTFZERO        MORE HDR BFRS ON INPUT QUEUE    36470000
         BE    TSIN0058                 BRANCH IF NO MORE      @G36XRYP 36540000
         L     RWK11,BUFFHEAD-K1        GET ADDR OF NEXT HDR BFR ON Q   36610000
         B     TSIN0056                 CONT SEARCH FOR LAST HDR BFR    36680000
         SPACE 2                                                        36684000
********                                                       @G36XRYP 36688000
******** ENSURE THAT THE INPUT QUEUE HAS NOT CHANGED DURING             36692000
******** SEARCH.  IF IT HAS, RE-SEARCH, OTHERWISE, THE FOLLOWING        36696000
******** TEST FOR BUFFFRAG WILL BE VALID.  THE BUFFER BEING TESTED      36700000
******** CAN ONLY BE DEQUED ASYNCHRONOUSLY BY TGET OR TCLEARQ.          36704000
******** TGET WILL NOT DEQUEUE A MSG WITH BUFFFRAG ON.  IF BUFFFRAG     36708000
******** IS OFF, IT WILL REMAIN OFF NO MATTER WHERE THE BUFFER          36712000
******** RESIDES AT THE MOMENT IT IS CHECKED, SINCE ONLY TSINPUT        36716000
******** TURNS ON BUFFFRAG.  IF TCLEARQ OCCURS BEFORE THE TEST,         36720000
******** THE REST OF THE MESSAGE WILL BE DISCARDED ANYWAY.              36724000
********                                                                36728000
TSIN0058 EQU   *                                               @G36XRYP 36732000
         CL    RWK15,TSBIBFP-K1         HAS QUEUE CHANGED      @G36XRYP 36736000
         BNE   TSIN0052                 YES, RE-SEARCH         @G36XRYP 36740000
         SPACE 2                                                        36750000
********                                                                36820000
******** IF THIS TCAM BUFFER IS NOT A HEADER BUFFER, AND IF THERE ARE   36890000
******** NO INCOMPLETE TIME SHARING BUFFERS AND NO TCAM BUFFERS BEING   36960000
******** HELD FOR THIS TERMINAL, THE DATA SHOULD BE IGNORED.            37030000
********                                                                37100000
TSIN0060 EQU   *                                                        37170000
         TM    BUFFFL2,BUFFFRAG         IS LAST TCAM MSG ON Q COMPLETE  37240000
         BO    TSIN0070                 BRANCH IF NOT                   37310000
         SPACE 1                                                        37380000
TSIN0062 EQU   *                                                        37450000
         TM    PRFSTAT1,PRFNHDRN        IS THIS FIRST TCAM BFR OF MSG   37520000
         BO    TSIN0174                 BRANCH IF NO                    37590000
         SPACE 2                                                        37660000
********                                                                37730000
******** DETERMINE IF ANY TS BUFFERS ARE AVAILABLE TO PROCESS THE TCAM  37800000
******** BUFFER.  IF SO, CALCULATE THE BEGINNING ADDRESS OF THE DATA    37870000
******** WITHIN THE TCAM BUFFER.  OTHERWISE, PLACE THE TCAM BUFFER ON   37940000
******** THE TCAM BUFFER WAIT QUEUE.                                    38010000
********                                                                38080000
         TM    TSBFLG2,TSBBIPI          IS THIS PARTIAL LINE COMPLETION 38150000
         BO    TSIN0070                 BRANCH IF YES                   38220000
         CLC   TIOCNFBF,AVTFZERO        ARE THERE ANY FREE TS BUFFERS   38290000
         BE    TSIN0240                 NO, PUT BFR ON WAIT Q           38360000
         SPACE 2                                                        38430000
********                                                                38500000
******** DETERMINE IF THE DATA IN THE TCAM BUFFER BEGINS IN THE FIRST   38570000
******** BASIC UNIT.  IF NOT, PART OF THE DATA HAS ALREADY BEEN MOVED   38640000
******** PRIOR TO THE BUFFER HAVING BEEN PLACED ON THE TCAM WAIT QUEUE. 38710000
******** IN THIS EVENT, THE DATA MUST START IN THE SECOND BASIC UNIT OF 38780000
******** THE BUFFER.                                                    38850000
********                                                                38920000
TSIN0070 EQU   *                                                        38990000
         LH    RDSZE,PRFSIZE            GET SIZE OF DATA IN TCAM BFR    39060000
         LR    RBUADR,RPREFIX           SET B.U. SCAN PTR TO BFR ADDR   39130000
         LH    RDEL,PRFSRCE             GET OFFSET TO DATA IN TCAM BFR  39200000
         LH    RWK15,AVTKEYLE           GET BASIC UNIT SIZE             39270000
         CLR   RDEL,RWK15               DOES DATA BEGIN IN FIRST B.U.   39340000
         BL    TSIN0090                 BRANCH IF YES                   39410000
         L     RBUADR,PRFTIC            GET ADDR OF SECOND BASIC UNIT   39480000
         SR    RDEL,RWK15               DECR DATA OFFSET BY FIRST B.U.  39550000
         SPACE 1                                                        39620000
TSIN0090 EQU   *                                                        39690000
         LA    RSCANL,K12(RDEL,RBUADR)  CALCULATE BEGIN OF DATA ADDRESS 39760000
         LH    RBUEND,AVTKEYLE          GET BASIC UNIT SIZE             39830000
         LA    RBUEND,K12(RBUADR,RBUEND)  PT TO END OF THIS BASIC UNIT  39900000
         LA    RWK15,K0(RDSZE,RSCANL)   DOES DATA END IN THIS  @OZ16528 39910010
         CLR   RWK15,RBUEND             UNIT                   @OZ16528 39920010
         BNL   TSIN0091                 NO, DATA END POINTER OK@OZ16528 39930010
         LR    RBUEND,RWK15             CORRECT THE END POINTER@OZ16528 39940010
TSIN0091 EQU   *                                               @OZ16528 39950010
         DROP  RQCB                     DROP RQCB AS QCB BASE REGISTER  39970000
         SPACE 2                                                        40040000
********                                                                40110000
******** REMOVE ALL LINE FEED CHARACTERS FROM THE BEGINNING OF EACH TS  40180000
******** MESSAGE PRIOR TO SCANNING IT FOR VALID DATA.                   40250000
********                                                                40320000
TSIN0092 EQU   *                                                        40390000
         LR    RPARM,RDSZE              SAVE ORIGINAL DATA SIZE         40460000
         SPACE 1                                                        40530000
TSIN0093 EQU   *                                                        40600000
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BFR TO SCAN    40670000
         BNZ   TSIN0094                 BRANCH IF YES                   40740000
         STH   RDSZE,PRFSIZE            UPDATE SIZE OF DATA IN TCAM BFR 40810000
         B     TSIN0170                 BRANCH TO PROCESS TCAM BUFFER   40880000
         SPACE 1                                                        40950000
TSIN0094 EQU   *                                                        41020000
         CLI   K0(RSCANL),LINEFEED      IS NEXT CHAR A LINE FEED CHAR   41090000
         BNE   TSIN0095                 BRANCH IF NOT TO SCAN DATA      41160000
         LA    RSCANL,K1(R0,RSCANL)     INCR END SCAN PTR TO NEXT CHAR  41230000
         BCTR  RDSZE,R0                 DECR DATA SIZE BY ONE           41300000
         CLR   RBUEND,RSCANL            IS SCAN TO END OF BASIC UNIT    41370000
         LA    RETRN,TSIN0093           SET UP RETURN ADDRESS           41440000
         BCR   NOTEQUAL,RETRN           CONT IF NOT END OF BASIC UNIT   41510000
         B     TSIN0150                 BR TO GET ANOTHER BASIC UNIT    41580000
         SPACE 1                                                        41650000
TSIN0095 EQU   *                                                        41720000
         LH    RDEL,PRFSRCE             GET OFFSET TO DATA IN TCAM BFR  41790000
         SR    RPARM,RDSZE              CALCULATE NEW DATA OFFSET       41860000
         AR    RDEL,RPARM               ADD TO OLD DATA OFFSET          41930000
         STH   RDEL,PRFSRCE             STORE UPDATED DATA OFFSET       42000000
         STH   RDSZE,PRFSIZE            STORE UPDATED DATA SIZE         42070000
         SPACE 2                                                        42140000
********                                                                42210000
******** SCAN THE BASIC UNIT CURRENTLY POINTING TO FOR AN SBA, CARRIAGE 42280000
******** RETURN, NEW LINE, LINE FEED, LINE DELETE, OR CHARACTER DELETE  42350000
******** CHARACTER.  IF ONE OF THESE CHARACTERS IS ENCOUNTERED, TAKE    42420000
******** THE APPROPRIATE ACTION DESCRIBED BELOW.  OTHERWISE, CONTINUE   42490000
******** SCANNING WITH THE NEXT BASIC UNIT OF THE TCAM BUFFER.  WHEN NO 42560000
******** MORE BASIC UNITS REMAIN TO BE SCANNED, CONTINUE PROCESSING.    42630000
********                                                                42700000
TSIN0096 EQU   *                                                        42770000
         LR    RSCANF,RSCANL            INITIALIZE BEGIN SCAN POINTER   42840000
         SR    RWRK7,RWRK7              INIT CHARACTER COUNT TO ZERO    42910000
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  42980000
         BE    TSIN0102                 BRANCH IF NONE                  43050000
         TM    BUFFFL1,BUFFNLCR         IS LAST MSG ON QUEUE COMPLETE   43120000
         BO    TSIN0102                 BRANCH IF YES                   43190000
         LH    RWRK7,BUFFWORK           GET PREVIOUS CHARACTER COUNT    43260000
         CLR   RBUEND,RSCANL            IS NEW UNIT NEEDED     @OZ16528 43262010
         BE    TSIN0102                 BRANCH IF YES          @OZ16528 43264010
         TM    PRFSTAT1,PRFNHDRN        NOT FIRST BUFFER OF MSG@OZ16528 43266010
         BO    TSIN0104                 CHECK SKIP CONTROL CHAR@OZ16528 43268010
         SPACE 1                                                        43330000
TSIN0102 EQU   *                                                        43400000
         CLR   RBUEND,RSCANL            IS SCAN TO END OF BASIC UNIT    43470000
         BNE   TSIN0105                 BRANCH IF NOT          @YA11732 43540000
         BAL   RETRN,TSIN0150           BR TO GET ANOTHER BASIC UNIT    43610000
         LA    RWK15,K0(RDSZE,RSCANL)   DATA END BEFORE THE    @OZ16528 43620010
         CLR   RWK15,RBUEND             END OF THIS UNIT       @OZ16528 43630010
         BNL   TSIN0103                  NO.. END POINTER OK   @OZ16528 43640010
         LR    RBUEND,RWK15              CORRECT END POINTER   @OZ16528 43650010
TSIN0103 EQU   *                                               @OZ16528 43660010
         SPACE 1                                                        43680000
********                                                                43750000
******** WHEN AN SBA CHARACTER IS ENCOUNTERED IN THE DATA, THE SBA PLUS 43820000
******** THE FOLLOWING TWO CONTROL CHARACTERS MUST NOT BE COUNTED AS    43890000
******** VALID DATA. WHEN THE SBA IS FOUND WITHIN THE LAST TWO CHARAC-  43960000
******** TERS OF A BUFFER UNIT, ONE OR MORE FOLLOWING CONTROL CHARAC-   44030000
******** TERS MAY BE IN THE NEXT BUFFER UNIT AND MUST ALSO BE SKIPPED.  44100000
********                                                       @YA11732 44170000
TSIN0104 EQU   *                                               @YA11732 44240000
         USING IEDQLCB,RWK15                                   @YA11732 44310000
         USING IEDQSCB,RPARM                                   @YA11732 44380000
         L     RWK15,PRFLCB-K1           GET LCB ADDRESS       @YA11732 44450000
         L     RPARM,LCBSCBA-K1          SCB ADRESSABILITY     @YA11732 44520000
         CLI   SCBSRCE,ZEROS           CONTROL CHARS. TO SKIP  @YA11732 44590000
         BE    TSIN0105                 NO, CONTINUE           @YA11732 44660000
         SR    RDEL,RDEL                ZERO WORK REGISTER     @YA11732 44730000
         IC    RDEL,SCBSRCE             GET NUMBER TO SKIP     @YA11732 44800000
         AR    RSCANL,RDEL              ADD NUMBER TO SCAN PTR @YA11732 44870000
         AR    RWRK7,RDEL               COUNT SBA CHAR AS DATA @OZ24913 44900000
         SR    RDSZE,RDEL               DECREMENT DATA COUNT   @YA11732 44940000
         SR    RDEL,RDEL                ZERO WORK REGISTER     @YA11732 45010000
         STC   RDEL,SCBSRCE             CLEAR SAVE AREA        @YA11732 45080000
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BUFFER@OZ16528 45090010
         BZ    TSIN0115                 NO, CK IF LAST BUFFER  @OZ16528 45100010
         DROP  RWK15                                           @YA11732 45150000
         DROP  RPARM                                           @YA11732 45220000
         SPACE 1                                               @YA11732 45290000
TSIN0105 EQU   *                                               @YA11732 45360000
         CLI   K0(RSCANL),SBA           CHECK FOR SBA CHAR.    @YA11732 45430000
         BNE   TSIN0106                 NO, BRANCH             @YA11732 45500000
         LR    RDEL,RBUEND              LOAD END OF BUFFER PTR @YA11732 45570000
         SH    RDEL,CC3270L             SUBTRACT THREE         @YA11732 45640000
         CR    RSCANL,RDEL              SBA WITHIN TWO OF END  @YA11732 45710000
         BH    TSIN010S                 YES GO CALCULATE       @YA11732 45780000
         LA    RSCANL,CC3270D3(R0,RSCANL) ADD 3 TO SCAN COUNT  @YA11732 45850000
         LA    RWRK7,CC3270D3(R0,RWRK7) COUNT SBA CHAR AS DATA @OZ24913 45880000
         SH    RDSZE,CC3270L            DECREMENT DATA SIZE -3 @YA11732 45920000
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BFR?  @YA11732 45990000
         BZ    TSIN0115                 NO, CHK IF LAST BUFFER @YA11732 46060000
         B     TSIN0102                 CONTINUE CHECKING      @YA11732 46130000
         SPACE 1                                               @YA11732 46200000
TSIN010S EQU   *                                                        46270000
         USING IEDQLCB,RWK15                                   @YA11732 46340000
         USING IEDQSCB,RPARM                                   @YA11732 46410000
         L     RWK15,PRFLCB-K1          GET LCB ADDRESS        @YA11732 46480000
         L     RPARM,LCBSCBA-K1         SCB ADDRESSABILITY     @YA11732 46550000
         SR    RDEL,RDEL                ZERO WORK REGISTER     @YA11732 46620000
         LR    RDEL,RSCANL              LOAD SCAN POINTER      @YA11732 46690000
         SR    RDEL,RBUEND              HOW MANY CHARS FRM END @YA11732 46760000
         LPR   RDEL,RDEL                CONVERT TO POSITIVE    @YA11732 46830000
         AR    RSCANL,RDEL              ADD TO SCAN COUNTER    @YA11732 46900000
         AR    RWRK7,RDEL               COUNT SBA CHAR AS DATA @OZ24913 46930000
         SR    RDSZE,RDEL               DECREMENT DATA SIZE    @YA11732 46970000
         SH    RDEL,CC3270L             GET THREES COMPLEMENT  @YA11732 47040000
         LPR   RDEL,RDEL                CONVERT TO POSITIVE    @YA11732 47110000
         STC   RDEL,SCBSRCE             SAVE NUMBER FOR NXT BU @YA11732 47180000
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BUFFER@OZ16528 47190010
         BZ    TSIN0115                 NO, CK IF LAST BUFFER  @OZ16528 47200010
         DROP  RWK15                                           @YA11732 47250000
         DROP  RPARM                                           @YA11732 47320000
         B     TSIN0102                 CHECK FOR END OF BFR   @YA11732 47390000
         SPACE 1                                               @YA11732 47460000
TSIN0106 EQU   *                                                        47530000
         CLI   TSBLNDCC,K0              0 MEANS NO DELETE CHAR  OS58447 47600000
         BE    TSIN0107                 NO CHAR, DON'T COMPARE  OS58447 47670000
         CLC   K0(K1,RSCANL),TSBLNDCC   IS THE NEXT CHAR LINE DELETE    47740000
         BE    TSIN0130                 BRANCH IF YES                   47810000
TSIN0107 EQU   *                                                OS58447 47880000
         CLI   K0(RSCANL),NEWLINE       IS THE NEXT CHAR NEW LINE CHAR  47950000
         BE    TSIN0120                 BRANCH IF YES                   48020000
         CLI   K0(RSCANL),CARRRTRN      IS THE NEXT CHAR CARRIAGE RETRN 48090000
         BE    TSIN0120                 BRANCH IF YES                   48160000
         CLI   TSBCHDCC,K0              0 MEANS NO DELETE CHAR  OS58447 48230000
         BE    TSIN0108                 NO CHAR, DON'T COMPARE  OS58447 48300000
         CLC   K0(K1,RSCANL),TSBCHDCC   IS THE NEXT CHAR CHAR DELETE    48370000
         BNE   TSIN0108                 BRANCH IF NO                    48440000
         LTR   RWRK7,RWRK7              DOES CHARACTER COUNT EQUAL ZERO 48510000
         BZ    TSIN0110                 BRANCH IF YES                   48580000
         BCTR  RWRK7,R0                 DECR CHARACTER COUNT BY ONE     48650000
         B     TSIN0110                 CONTINUE SCANNING               48720000
         SPACE 1                                                        48790000
TSIN0108 EQU   *                                                        48860000
         CLI   K0(RSCANL),LINEFEED      IS THE NEXT CHAR LINE FEED CHAR 48930000
         BE    TSIN0110                 BRANCH IF YES                   49000000
         LA    RWRK7,K1(R0,RWRK7)       INCR CHARACTER COUNT BY ONE     49070000
         SPACE 1                                                        49140000
TSIN0110 EQU   *                                                        49210000
         LA    RSCANL,K1(R0,RSCANL)     INCR END SCAN PTR TO NEXT CHAR  49280000
         BCT   RDSZE,TSIN0102           CONT SCAN IF MORE DATA LEFT     49350000
         SPACE 1                                                        49420000
TSIN0115 EQU   *                                               @YA11732 49490000
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST TCAM BFR OF MSG    49560000
         BO    TSIN0170                 BRANCH IF NO                    49630000
         SPACE 1                                                        49700000
TSIN0120 EQU   *                                                        49770000
         TM    PRFTIC,NOTMOVED          ANY UNMOVED DATA IN TCAM BFR    49840000
*                                       FROM A PREVIOUS SCAN            49910000
         BO    TSIN0122                 BRANCH IF YES                   49980000
         LTR   RWRK7,RWRK7              DOES CHARACTER COUNT EQUAL ZERO 50050000
         BNZ   TSIN0122                 BRANCH IF NO                    50120000
         LR    RSCANF,RSCANL            INDICATE A NULL LINE            50190000
         LTR   RDSZE,RDSZE              WAS LAST CHAR SCANNED CR OR NL  50260000
         BZ    TSIN0136                 BRANCH IF NO                    50330000
         LA    RSCANL,K1(R0,RSCANL)     INCR END SCAN PTR PAST CR OR NL 50400000
         B     TSIN0136                 BRANCH TO CHAR/LINE DELETE RTN  50470000
         SPACE 1                                                        50540000
TSIN0122 EQU   *                                                        50610000
         LTR   RDSZE,RDSZE              WAS LAST CHAR SCANNED CR OR NL  50680000
         BZ    TSIN0170                 BRANCH IF NO TO MOVE DATA       50750000
         LA    RSCANL,K1(R0,RSCANL)     INCR END SCAN PTR PAST CR OR NL 50820000
         B     TSIN0170                 BRANCH TO MOVE DATA             50890000
         SPACE 2                                                        50960000
********                                                                51030000
******** DELETE THE INPUT LINE WHICH IS CURRENTLY BEING SCANNED AND     51100000
******** INCREMENT THE BEGIN AND END SCAN POINTER TO THE NEXT           51170000
******** CHARACTER IN THE TCAM BUFFER.  IF THE TCAM BUFFER IS NOT THE   51240000
******** FIRST BUFFER OF THE MESSAGE AND THE LAST CHARACTER MOVED INTO  51310000
******** TIME SHARING BUFFERS FOR THIS MESSAGE WAS NOT A CARRAGE RETURN 51380000
******** CHARACTER, A FRAGMENT MESSAGE WHICH IS PART OF THE LINE TO BE  51450000
******** DELETED EXISTS ON THE TS BUFFER INPUT QUEUE.  IN THIS CASE,    51520000
******** THE FRAGMENT MESSAGE WILL BE REMOVED FROM THE INPUT QUEUE.     51590000
********                                                                51660000
TSIN0130 EQU   *                                                        51730000
         BCTR  RDSZE,R0                 DECREMENT DATA SIZE BY ONE      51800000
         LA    RSCANL,K1(R0,RSCANL)     INCR END PTR PAST LINE DEL CHAR 51870000
         LR    RSCANF,RSCANL            RESET BEGINNING OF SCAN PTR     51940000
         LTR   RDSZE,RDSZE              ANY DATA LEFT TO SCAN           52010000
         BZ    TSIN0136                 BRANCH IF NO MORE               52080000
         CLR   RBUEND,RSCANL            IS SCAN TO END OF BASIC UNIT    52150000
         BNE   TSIN0132                 BRANCH IF NO                    52220000
         BAL   RETRN,TSIN0150           BR TO GET ANOTHER BASIC UNIT    52290000
         SPACE 1                                                        52360000
TSIN0132 EQU   *                                                        52430000
         CLI   K0(RSCANL),NEWLINE       IS THE NEXT CHAR NEW LINE CHAR  52500000
         BE    TSIN0134                 BRANCH IF YES                   52570000
         CLI   K0(RSCANL),CARRRTRN      IS THE NEXT CHAR CARRIAGE RETRN 52640000
         BNE   TSIN0136                 BRANCH IF NO                    52710000
         SPACE 1                                                        52780000
TSIN0134 EQU   *                                                        52850000
         LA    RSCANL,K1(R0,RSCANL)     INCR END SCAN PTR PAST CR OR NL 52920000
         SPACE 2                                                        52990000
********                                                                53060000
******** THE FOLLOWING SECTION OF CODE IS COMMON TO BOTH LINE DELETE    53130000
******** AND CHARACTER DELETE FUNCTIONS.  IF PART OF THIS TS MESSAGE    53200000
******** HAS ALREADY BEEN MOVED INTO TS BUFFERS, RETURN ALL BUT THE     53270000
******** HEADER BUFFER ASSOCIATED WITH THIS TS MESSAGE.                 53340000
********                                                                53410000
TSIN0136 EQU   *                                                        53480000
         STH   RDSZE,PRFSIZE            UPDATE AMOUNT OF DATA IN BUFFER 53550000
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  53620000
         BE    TSIN0138                 BRANCH IF NONE                  53690000
         TM    BUFFFL1,BUFFNLCR         IS LAST MSG ON QUEUE COMPLETE   53760000
         BO    TSIN0138                 BRANCH IF YES                   53830000
         SPACE 2                                                        53900000
********                                                                53970000
******** CALL QTIP SVC TO DELETE THE INPUT LINE CURRENTLY BEING SCANNED 54040000
********                                                                54110000
         QTIP  8,(RAVT)                                                 54180000
         B     TSIN0172                 BR TO INIT FOR NEXT SCAN        54250000
         SPACE 1                                                        54320000
TSIN0138 EQU   *                                                        54390000
         CLR   RSCANF,RSCANL            IS NEXT CHARACTER CR OR NL      54460000
         BNE   TSIN0170                 BRANCH IF YES                   54530000
         LTR   RDSZE,RDSZE              ANY MORE DATA LEFT TO SCAN      54600000
         BZ    TSIN0170                 BR IF NO TO CREATE A NULL LINE  54670000
         SR    RWRK7,RWRK7              RESET CHARACTER COUNT TO ZERO   54740000
         B     TSIN0102                 BR TO CONTINUE SCANNING DATA    54810000
         SPACE 2                                                        54880000
********                                                                54950000
******** DETERMINE IF ANY MORE BASIC UNITS REMAIN TO BE SCANED.  IF SO, 55020000
******** POINT TO THE NEXT BASIC UNIT AND CALCULATE THE BEGINNING OF    55090000
******** DATA WITHIN THIS BASIC UNIT.                                   55160000
********                                                                55230000
TSIN0150 EQU   *                                                        55300000
         DROP  RPREFIX                  DROP RPREFIX AS TCAM BFR BASE   55370000
         USING IEDQPRF,RBUADR           USE RBUADR AS TCAM BFR BASE REG 55440000
         L     RBUADR,PRFTIC            GET ADR OF NEXT BASIC UNIT      55510000
         DROP  RBUADR                   DROP RBUADR AS TCAM BFR BASE    55580000
         USING IEDQPRF,RPREFIX          USE RPREFIX AS TCAM BFR BASE    55650000
         LA    RSCANL,K12(R0,RBUADR)    POINT TO DATA IN THE NEXT B.U.  55720000
         CLR   RSCANF,RBUEND            IS BEGIN SCAN AT END LAST B.U.  55790000
         BNE   TSIN0160                 BRANCH IF NOT                   55860000
         LR    RSCANF,RSCANL            SET BEGIN SCAN EQUAL END SCAN   55930000
         SPACE 1                                                        56000000
TSIN0160 EQU   *                                                        56070000
         LH    RBUEND,AVTKEYLE          GET BASIC UNIT SIZE             56140000
         LA    RBUEND,K12(RBUADR,RBUEND)  PT TO END OF THIS BASIC UNIT  56210000
         BR    RETRN                    RETURN TO CALLER                56280000
         SPACE 2                                                        56350000
********                                                                56420000
******** CALL QTIP SVC TO MOVE THE SCANED DATA IN THE TCAM BUFFER       56490000
******** INTO TIME SHARING BUFFER(S).                                   56560000
********                                                                56630000
TSIN0170 EQU   *                                                        56700000
         QTIP  9,(RAVT)                                                 56770000
         SPACE 2                                                        56840000
********                                                                56910000
******** DETERMINE IF THE MOVE ROUTINE WAS SUCCESSFUL IN OBTAINING      56980000
******** ENOUGH TS BUFFERS TO MOVE THE SCANED DATA IN THE TCAM BUFFER   57050000
******** INTO TS BUFFER(S).  IF NOT, RETURN ANY TCAM BASIC UNITS WHICH  57120000
******** MAY BE EMPTY AND PLACE THE REMAINDER OF THE TCAM BUFFER ON THE 57190000
******** TIOCRPT BUFFER WAIT QUEUE.  IF QTIP HAS INDICATED THAT THE MSG 57260000
******** WAS TOO LONG, CANCEL IT.  OTHERWISE, DETERMINE IF ANY MORE     57330000
******** DATA REMAINS TO BE SCANNED.  IF NOT, RETURN THE EMPTY TCAM     57400000
******** BUFFER.                                                        57470000
********                                                                57540000
         LR    RWK11,RTRNCD             GET PTR TO LAST TS HDR ON QUEUE 57610000
         SRL   RTRNCD,K24               RIGHT ADJUST RETURN CODE        57680000
         LTR   RTRNCD,RTRNCD            RTRN CODE IND NO TS BFRS AVAIL  57750000
         BNZ   TSIN0180                 BRANCH IF YES                   57820000
         SPACE 1                                                        57890000
TSIN0172 EQU   *                                                        57960000
         TM    PRFSTAT1,PRFCNCLN        DID QTIP CANCEL MSG?    YA06046 58030000
         BNO   OVER                     BRANCH NO              @G36XRYP 58100000
         L     RSCB,PRFLCB-K1           GET LCB ADDRESS        @G36XRYP 58160000
         L     RSCB,LCBSCBA-K1-IEDQLCB(RSCB) GET SCB ADDRESS   @G36XRYP 58220000
         USING IEDQSCB,RSCB             SCB ADDRESSABILITY     @G36XRYP 58280000
         OI    SCBERR1,SCBCUTFN         INDICATE CUTOFF MSG    @G36XRYP 58340000
*                                       TO BE SENT             @G36XRYP 58400000
         B     TSIN0016                 CANCEL MSG             @G36XRYP 58460000
         DROP  RSCB                                            @G36XRYP 58520000
OVER     LH    RDSZE,PRFSIZE            GET UNMOVED DATA SIZE   YA06046 58590000
         LTR   RDSZE,RDSZE              ANY MORE DATA LEFT TO SCAN      58660000
         BNZ   TSIN0176                 BRANCH IF YES                   58730000
         SPACE 1                                                        58800000
TSIN0174 EQU   *                                                        58870000
         LA    RETRN,TSIN2020           RETURN TO CHK BFR WAIT QUEUE    58940000
         B     TSIN4000                 PUT TCAM BFR ON RETURN QUEUE    59010000
         SPACE 1                                                        59080000
TSIN0176 EQU   *                                                        59150000
         TM    BUFFFL1,BUFFNLCR         IS LAST TS MSG COMPLETE         59220000
         BZ    TSIN0096                 CONT SCANNING IF NOT            59290000
         CLC   TIOCNFBF,AVTFZERO        ARE THERE ANY FREE TS BUFFERS   59360000
         BNE   TSIN0092                 BRANCH IF YES TO CONTINUE SCAN  59430000
         DROP  RWK11                    DROP RWK11 AS TS BFR BASE REG   59500000
         SPACE 2                                                        59570000
********                                                                59640000
******** DETERMINE IF ANY EMPTY TCAM BASIC UNITS CAN BE RETURNED PRIOR  59710000
******** TO PLACING THE TCAM BUFFER ON THE TCAM BUFFER WAIT QUEUE.      59780000
********                                                                59850000
TSIN0180 EQU   *                                                        59920000
         CLI   PRFNBUNT,ONE             MORE THAN ONE BASIC UNIT IN BFR 59990000
         BE    TSIN0240                 BRANCH IF NO                    60060000
         LR    RBUADR,RPREFIX           GET ADDR OF FIRST BASIC UNIT    60130000
         LH    RDEL,PRFSRCE             GET OFFSET TO DATA IN TCAM BFR  60200000
         LH    RWK15,AVTKEYLE           GET BASIC UNIT SIZE             60270000
         SR    RWRK3,RWRK3              CLEAR REGISTER                  60340000
         IC    RWRK3,PRFNBUNT           GET NO. BASIC UNITS IN TCAM BFR 60410000
         BCTR  RWRK3,R0                 DECR NO. BASIC UNITS BY ONE     60480000
         SPACE 2                                                        60550000
********                                                                60620000
******** CALCULATE THE NUMBER OF TCAM BASIC UNITS WHICH ARE EMPTY AND   60690000
******** CAN BE RETURNED.                                               60760000
********                                                                60830000
TSIN0200 EQU   *                                                        60900000
         DROP  RPREFIX                  DROP RPREFIX AS TCAM BFR BASE   60970000
         USING IEDQPRF,RBUADR            USE RBUADR AS TCAM BFR BASE    61040000
         CR    RDEL,RWK15               DOES DATA BEGIN IN THIS B.U.    61110000
         BL    TSIN0210                 BRANCH IF YES                   61180000
         SR    RDEL,RWK15               DECR DATA OFFSET BY DATA AREA   61250000
         L     RBUADR,PRFTIC            GET ADDR OF NEXT BASIC UNIT     61320000
         BCT   RWRK3,TSIN0200                  CONT IF NOT LAST B.U.    61390000
         SPACE 2                                                        61460000
********                                                                61530000
******** IF THE UNMOVED DATA DOES NOT BEGIN IN THE FIRST BASIC UNIT,    61600000
******** DETERMINE IF THE DATA OFFSET IN THE BEGINING BASIC UNIT IS     61670000
******** LARGE ENOUGH TO ALLOW THE PREFIX OF THAT BASIC UNIT TO BE      61740000
******** OVERLAYED WITH THE HEADER AND THE FIRST BASIC UNIT TO BE RE-   61810000
******** TURNED.                                                        61880000
********                                                                61950000
TSIN0210 EQU   *                                                        62020000
         CLR   RBUADR,RPREFIX           DOES DATA BEGIN IN THE FIRST BU 62090000
         BE    TSIN0240                 BRANCH IF YES                   62160000
         TM    PRFSTAT1,PRFNHDRN        HEADER PREFIX            S22029 62230000
         BO    TSIN0215                 NO, USE TEXT PREFIX      S22029 62300000
         LA    RDSZE,AVTHDRSZ           COMPARAND FOR HDR PRF SZ S22029 62370000
         B     TSIN0220                 CHECK FOR EMPTY BASIC    S22029 62440000
*                                       UNITS TO RETURN                 62510000
TSIN0215 EQU   *                                                 S22029 62580000
         LA    RDSZE,AVTTXTSZ           COMPARAND FOR TXT PRF SZ S22029 62650000
TSIN0220 EQU   *                                                 S22029 62720000
         CR    RDEL,RDSZE               ENOUGH ROOM FOR PREFIX   S22029 62790000
         BL    TSIN0230                 BRANCH IF NO                    62860000
         SPACE 2                                                        62930000
********                                                                63000000
******** MOVE HEADER PREFIX TO OVERLAY PREFIX OF FIRST BASIC UNIT       63070000
******** CONTAINING UNMOVED DATA AND RETURN EMPTY BASIC UNITS.          63140000
********                                                                63210000
         MVC   PRFTIC(K1),PRFTIC-IEDQPRF(RPREFIX) MOVE FLAGS TO TIC FLD 63280000
         L     RWK15,PRFTIC             SAVE FLAGS AND TIC ADDRESS      63350000
         LA    RDSZE,K11(RDSZE)         UPDATE FOR MOVE COUNT    S22029 63420000
         EX    RDSZE,MOVEPRFX           MOVE BUFFER PREFIX INTO  S22029 63490000
*                                       NEW FIRST BASIC UNIT            63560000
         ST    RWK15,PRFTIC             RESTORE FLAGS AND TIC ADDRESS   63630000
         STH   RDEL,PRFSRCE             STORE UPDATED DATA OFFSET       63700000
         LA    RWRK3,K1(R0,RWRK3)        INCR NO. OF BASIC UNITS BY 1   63770000
         STC   RWRK3,PRFNBUNT           NO. BASIC UNITS GOING ON QUEUE  63840000
         DROP  RBUADR                   DROP RBUADR AS TCAM BFR BASE    63910000
         USING IEDQPRF,RPREFIX          USE RPREFIX AS TCAM BFR BASE    63980000
         IC    RWK14,PRFNBUNT           GET TOTAL NO. OF BASIC UNITS    64050000
         SR    RWK14,RWRK3              CALC NO. BASIC UNITS TO RETURN  64120000
         STC   RWK14,PRFNBUNT           NO. BASIC UNITS BEING RETURNED  64190000
         BAL   RETRN,TSIN4000           RETURN BASIC UNITS              64260000
         LR    RPREFIX,RBUADR           PT TO BFR TO BE PLACED ON QUEUE 64330000
         B     TSIN0240                 BR TO PLACE TCAM BFR ON QUEUE   64400000
         SPACE 2                                                        64470000
********                                                                64540000
******** RETURN THE EMPTY BASIC UNITS WHICH FOLLOW THE FIRST BASIC UNIT 64610000
******** AND CHAIN TO THE FIRST BASIC UNIT THE BASIC UNITS WHICH        64680000
******** CONTAIN UNMOVED DATA.                                          64750000
********                                                                64820000
TSIN0230 EQU   *                                                        64890000
         LA    RWRK3,K2(R0,RWRK3)       INCR NO. OF BASIC UNITS BY 2    64960000
         AR    RDEL,RWK15               INCR DATA OFFSET FOR HEADER     65030000
         SR    RWK15,RWK15              CLEAR REGISTER                  65100000
         IC    RWK15,PRFNBUNT           GET TOTAL NO. OF BASIC UNITS    65170000
         CLR   RWRK3,RWK15              CAN ANY BASIC UNITS BE RETURNED 65240000
         BE    TSIN0240                 BR IF NO TO PUT BFR ON WAIT Q   65310000
         STC   RWRK3,PRFNBUNT           NO. BASIC UNITS GOING ON QUEUE  65380000
         LR    RPARM,RPREFIX            SAVE ADDR OF FIRST BASIC UNIT   65450000
         L     RPREFIX,PRFTIC           GET ADDR OF SECOND BASIC UNIT   65520000
         SR    RWK15,RWRK3              CALC NO. BASIC UNITS TO RETURN  65590000
         STC   RWK15,PRFNBUNT           NO. BASIC UNITS BEING RETURNED  65660000
         DROP  RPREFIX                  DROP RPREFIX AS TCAM BFR BASE   65730000
         USING IEDQPRF,RPARM            USE RPARM AS TCAM BFR BASE REG  65800000
         XC    PRFTIC+K1(K3),PRFTIC+K1  CLEAR TIC FIELD                 65870000
         LA    RBUADR,K0(R0,RBUADR)     CLEAR HI-ORDER BYTE OF REG      65940000
         O     RBUADR,PRFTIC            MOVE FLAGS TO HI-ORDER BYTE     66010000
         ST    RBUADR,PRFTIC            CHAIN BASIC UNITS TOGETHER      66080000
         STH   RDEL,PRFSRCE             STORE UPDATED DATA OFFSET       66150000
         DROP  RPARM                    DROP RPARM AS TCAM BFR BASE REG 66220000
         USING IEDQPRF,RPREFIX          USE RPREFIX AS TCAM BFR BASE    66290000
         BAL   RETRN,TSIN4000           RETURN BASIC UNITS              66360000
         LR    RPREFIX,RPARM            PT TO BFR TO BE PLACED ON QUEUE 66430000
         SPACE 2                                                        66500000
********                                                                66570000
******** THE FOLLOWING ROUTINE IS USED TO PLACE A TCAM BUFFER ON THE    66640000
******** BUFFER WAIT QUEUE, LOCATED IN TSINPUT'S DESTINATION QCB,       66710000
******** UNTIL TIME SHARING BUFFERS BECOME AVAILABLE TO PROCESS IT.     66780000
******** IF ANY TCAM BUFFERS ASSOCIATED WITH THIS QCB ARE IN THE WAIT   66850000
******** QUEUE, CHAIN THIS TCAM BUFFER TO THE LAST SUCH BUFFER FOR THIS 66920000
******** QCB.  OTHERWISE, PUT THE BUFFER AT THE END OF THE QUEUE.       66990000
********                                                                67060000
         USING IEDQTSI,RWRK8            USE RWRK8 AS TSINPUT QCB BASE   67130000
TSIN0240 EQU   *                                                        67200000
         ST    RTSB,PRFQCBA-K1          SAVE TSB ADDR IN TCAM BFR       67270000
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE REGISTER   67340000
         LH    RPARM,TSBASRCE           GET TNT INDEX          @G36XRYP 67348000
         L     RNTRE,AVTRNMPT           GET TNT CODE ADDRESS   @G36XRYP 67356000
         BALR  RETRN,RNTRE              GET TTE                @G36XRYP 67364000
         USING IEDQTRM,RPARM            TTE ADDRESSABILITY     @G36XRYP 67372000
         L     RQCB,TRMDESTQ-K1         GET QCB ADDRESS        @G36XRYP 67380000
         ST    RQCB,AVTSAVE2+K64        SAVE QCB FOR QTIP 9    @G36XRYP 67388000
         DROP  RPARM                                           @G36XRYP 67396000
         L     RWRK8,AVTTSOPT           GET ADDR OF TSINPUT'S QCB       67480000
         LA    RPREFIX,K0(R0,RPREFIX)   CLEAR HI-ORDER BYTE OF REGISTER 67550000
         CLC   TSIBUFQ,AVTFZERO         ANY TCAM BFRS ON WAIT QUEUE     67620000
         BNE   TSIN0270                 BRANCH IF YES                   67690000
         ST    RPREFIX,TSIBUFQ          PUT TCAM BUFFER ON WAIT QUEUE   67760000
         XC    PRFLINK,PRFLINK          CLEAR LINK FIELD OF LAST BFR    67830000
         B     TSIN0400                 BRANCH TO END                   67900000
         SPACE 1                                                        67970000
TSIN0270 EQU   *                                                        68040000
         DROP  RPREFIX                  DROP RPREFIX AS TCAM BFR BASE   68110000
         USING IEDQPRF,RWRK3            USE RWRK3 AS TCAM BFR BASE REG  68180000
         L     RWRK3,TSIBUFQ            GET ADDR OF FIRST BFR ON QUEUE  68250000
         TM    QCBTSOF2,QCBBUFQ         ANY BFRS ON QUEUE FOR THIS QCB  68320000
         BZ    TSIN0340                 BRANCH IF NONE                  68390000
         LA    RTSB,K0(R0,RTSB)         CLEAR HI ORDER BYTE OF TSB REG  68460000
         LA    RWRK8,TSIBUFQ            ADDR OF BFR WAIT QUEUE          68530000
         DROP  RWRK8                    DROP TSINPUT'S BASE REG         68600000
         SPACE 1                                                        68670000
TSIN0280 EQU   *                                                        68740000
         L     RWRK2,PRFQCBA-K1         GET ADDR OF TSB FOR THIS BUFFER 68810000
         LA    RWRK2,K0(R0,RWRK2)       CLEAR HI ORDER BYTE OF REGISTER 68880000
         CLR   RTSB,RWRK2               IS TSB FOR THIS QUEUE BFR EQUAL 68950000
*                                       TO CURRENT TSB SEARCHING FOR    69020000
         BE    TSIN0300                 BRANCH IF YES                   69090000
         LA    RWRK8,PRFLINK-K1         SAVE ADDR OF LINK FIELD         69160000
         L     RWRK3,PRFLINK-K1         GET ADDR OF NEXT BFR IN QUEUE   69230000
         B     TSIN0280                 CONT SEARCH FOR ASSOCIATED TSB  69300000
         SPACE 1                                                        69370000
TSIN0300 EQU   *                                                        69440000
         DROP  RWRK3                    DROP TCAM BFR BASE REG          69510000
         USING IEDQPRF,RPREFIX          EST TCAM BFR BASE REG           69580000
         TM    PRFTIC,WAITQBFR          WAS THIS BFR ON THE WAIT QUEUE  69650000
         BZ    TSIN0320                 BRANCH IF NOT                   69720000
         MVC   PRFLINK,K1(RWRK8)        CHAIN TO NEXT BFR ON Q          69790000
         ST    RPREFIX,K0(RWRK8)        CHAIN TO PREVIOUS BFR           69860000
         B     TSIN0400                 BRANCH TO END                   69930000
         DROP  RPREFIX                  DROP TCAM BFR BASE REG          70000000
         USING IEDQPRF,RWRK3            EST TCAM BFR BASE REG           70070000
         SPACE 1                                                        70140000
TSIN0320 EQU   *                                                        70210000
         CLC   PRFLINK,AVTFZERO         IS THIS THE LAST BFR IN QUEUE   70280000
         BE    TSIN0380                 BRANCH IF YES                   70350000
         L     RWK15,PRFLINK-K1         GET ADDR OF NEXT BFR IN QUEUE   70420000
         DROP  RWRK3                    DROP RWRK3 AS TCAM BFR BASE REG 70490000
         USING IEDQPRF,RWK15            USE RWK15 AS TCAM BFR BASE REG  70560000
         L     RWRK2,PRFQCBA-K1         GET ADDR OF TSB FOR THIS BUFFER 70630000
         LA    RWRK2,K0(R0,RWRK2)       CLEAR HI ORDER BYTE OF REGISTER 70700000
         CLR   RTSB,RWRK2               IS THE NEXT BFR ALSO ASSOCIATED 70770000
*                                       WITH THE CURRENT TSB            70840000
         BNE   TSIN0380                 BRANCH IF NO                    70910000
         LR    RWRK3,RWK15              POINT TO NEXT BFR IN QUEUE      70980000
         B     TSIN0320                 CONTINUE SCAN                   71050000
         DROP  RWK15                    DROP RWK15 AS TCAM BFR BASE REG 71120000
         USING IEDQPRF,RWRK3            USE RWRK3 AS TCAM BFR BASE REG  71190000
         SPACE 1                                                        71260000
TSIN0340 EQU   *                                                        71330000
         CLC   PRFLINK,AVTFZERO         IS THIS LAST TCAM BFR IN QUEUE  71400000
         BE    TSIN0380                 BRANCH IF YES                   71470000
         L     RWRK3,PRFLINK-K1         GET NEXT BFR IN QUEUE           71540000
         B     TSIN0340                 CONT SEARCH FOR LAST BFR IN Q   71610000
         SPACE 1                                                        71680000
TSIN0380 EQU   *                                                        71750000
         MVC   PRFLINK-IEDQPRF(K3,RPREFIX),PRFLINK  CHAIN NEW BFR TO    71820000
*                                       THE NEXT BFR ON THE WAIT QUEUE  71890000
         ST    RPREFIX,PRFLINK-K1       CHAIN NEW BFR TO THE PREVIOUS   71960000
*                                       BFR ON THE WAIT QUEUE           72030000
         SPACE 1                                                        72100000
TSIN0400 EQU   *                                                        72170000
         OI    QCBTSOF2,QCBBUFQ         IND BFRS IN QUEUE FOR THIS QCB  72240000
         DROP  RWRK3                    DROP RWRK3 AS TCAM BFR BASE REG 72310000
         USING IEDQPRF,RPREFIX          EST TCAM BFR BASE REG           72380000
         OI    PRFTIC,WAITQBFR          IND BFR WAS ON THE WAIT QUEUE   72450000
         TM    TIOCFLG,TIOCSYLW         IS THE SYSTEM IN LWAIT          72520000
         BO    TSIN0440                 BRANCH IF YES                   72590000
         SPACE 2                                                        72660000
********                                                                72730000
******** CALL QTIP SVC TO PUT THE SYSTEM IN AN LWAIT CONDITION.         72800000
********                                                                72870000
         QTIP  7,(RAVT)                                                 72940000
         SPACE 1                                                        73010000
TSIN0440 EQU   *                                                        73080000
         OI    QCBTSOF1,QCBNOBUF        LOCK USER'S KEYBOARD TO INPUT   73150000
         B     TSIN2020                 BRANCH TO CHK BFR WAIT Q        73220000
         DROP  RPREFIX,RQCB             DROP BASE REGISTERS             73290000
         SPACE 2                                                        73360000
********                                                                73430000
******** TURN OFF TSINPUT'S POST BIT                                    73500000
********                                                                73570000
TSIN2000 EQU   *                                                        73640000
         USING IEDQTSI,RQCB             USE RQCB AS TSINPUT'S QCB BASE  73710000
         NI    TSIFLAG,OFF-TSIPOST      TURN OFF TSINPUT'S POST BIT     73780000
         DROP  RQCB                     DROP RQCB AS TSINPUT'S QCB BASE 73850000
         SPACE 2                                                        73920000
********                                                                73990000
******** DETERMINE IF ANY TCAM BUFFERS ARE CHAINED TO THE TCAM BUFFER   74060000
******** WAIT QUEUE.  IF SO, AND IF TS BUFFERS ARE NOW AVAILABLE,       74130000
******** REMOVE THE TCAM BUFFERS ONE AT A TIME IN FIFO ORDER FROM THE   74200000
******** WAIT QUEUE IN ORDER TO PROCESS THEM.                           74270000
********                                                                74340000
TSIN2020 EQU   *                                                        74410000
         USING IEDQTSI,RWRK8            USE RWRK8 AS TSINPUT'S QCB BASE 74480000
         L     RWRK8,AVTTSOPT           GET ADDR OF TSINPUT'S QCB       74550000
         LA    RWRK8,TSIBUFQ            ADDR OF BFR WAIT QUEUE          74620000
         DROP  RWRK8                    DROP TSINPUT'S BASE REG         74690000
         SPACE 1                                                        74760000
TSIN2022 EQU   *                                                        74830000
         USING IEDQPRF,RPREFIX          USE PREFIX AS TCAM BFR BASE     74900000
         L     RPREFIX,K0(R0,RWRK8)     GET NEXT BFR ON QUEUE           74970000
         LA    RPREFIX,K0(R0,RPREFIX)   CLR HI-ORDER BYTE OF REG        75040000
         LTR   RPREFIX,RPREFIX          ANY MORE BFRS ON QUEUE          75110000
         BZ    TSIN2040                 BRANCH IF NO MORE               75180000
         TM    AVTBIT3,AVTTSAB          DID TSO ABEND            A44839 75250000
         BNO   TSIN2023                 GET TSO ADDR IF NO       A44839 75320000
         L     RWRK2,PRFLINK-K1         GET NEXT BFR ON QUEUE    A44839 75390000
         LA    RWRK2,K0(R0,RWRK2)       CLR HI-ORDER BYTE OF REG A44839 75460000
         ST    RWRK2,K0(R0,RWRK8)       RE-CHAIN BFR WAIT QUEUE  A44839 75530000
         BAL   RETRN,TSIN4000           GO TO RETURN BUFFER      A44839 75600000
         B     TSIN2022                 CONTINUE SCAN            A44839 75670000
TSIN2023 EQU   *                                                 A44839 75740000
         LTR   RTIOC,RTIOC              RPT EXIST? / TSO UP?    YA04775 75810000
         BZ    TSIN2050                 NO, RETURN TO DISPATCH  YA04775 75880000
         L     RTSB,PRFQCBA-K1          GET TSB ADDRESS                 75950000
         TM    TSBFLG1,TSBIFLSH         IS TCLEARQ IN PROGRESS          76020000
         BO    TSIN2026                 BRANCH IF YES                   76090000
         CLC   TIOCNFBF,AVTFZERO        ARE THERE ANY FREE TS BUFFERS   76160000
         LA    RETRN,TSIN0052           SET RETURN TO PROC BFR          76230000
         BNE   TSIN2032                 BRANCH IF ANY FREE BFRS         76300000
         SPACE 2                                                        76370000
********                                                                76440000
******** FIND THE NEXT BUFFER ON THE WAIT QUEUE WHICH IS NOT ASSOCIATED 76510000
******** WITH THE CURRENT BUFFER.                                       76580000
********                                                                76650000
TSIN2024 EQU   *                                                        76720000
         L     RWRK2,PRFLINK-K1         GET ADDR OF NEXT BFR IN QUEUE   76790000
         CLC   PRFQCBA,K1(RWRK2)        IS NEXT BFR ASSOCIATED WITH THE 76860000
*                                       SAME TSB AS BFR JUST REMOVED    76930000
         LA    RWRK8,PRFLINK-K1         SAVE PTR TO LINK FIELD          77000000
         BNE   TSIN2022                 BRANCH IF NOT                   77070000
         LR    RPREFIX,RWRK2            UPDATE CURRENT BFR PTR          77140000
         B     TSIN2024                 BRANCH TO CONTINUE SCAN         77210000
         SPACE 2                                                        77280000
********                                                                77350000
******** IF INPUT QUEUE FLUSHING HAS OCCURRED, RETURN THIS TCAM BUFFER. 77420000
******** IF THE TCAM BUFFER IS THE LAST OF THE MESSAGE, TERMINATE INPUT 77490000
******** QUEUE FLUSHING AND RETURN THE BUFFER.                          77560000
********                                                                77630000
TSIN2026 EQU   *                                                        77700000
         BAL   RETRN,TSIN2032           BR TO REMOVE THIS BUFFER        77770000
         SPACE 1                                                        77840000
TSIN2028 EQU   *                                                        77910000
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST BFR OF MESSAGE     77980000
         BO    TSIN2030                 NO, RETURN TCAM BFR             78050000
         SPACE 2                                                        78120000
********                                                                78190000
******** CALL QTIP SVC TO TERMINATE TCLEARQ INPUT PROCESSING.           78260000
********                                                                78330000
         QTIP  5,(RAVT)                                                 78400000
         SPACE 1                                                        78470000
TSIN2030 EQU   *                                                        78540000
         BAL   RETRN,TSIN4000           RETURN TCAM BUFFER              78610000
         B     TSIN2022                 BRANCH TO CONTINUE SCAN         78680000
         SPACE 2                                                        78750000
********                                                                78820000
******** THE FOLLOWING SUBROUTINE IS USED TO REMOVE A TCAM BUFFER FROM  78890000
******** THE TCAM BUFFER WAIT QUEUE.                                    78960000
********                                                                79030000
TSIN2032 EQU   *                                                        79100000
         USING IEDQQCB,RQCB             EST TERM DEST QCB BASE          79170000
         LR    RWK11,RETRN              SAVE RETURN ADDRESS    @G36XRYP 79177000
         LH    RPARM,TSBASRCE           GET TNT INDEX          @G36XRYP 79184000
         L     RNTRE,AVTRNMPT           GET ADDRESS TNT CODE   @G36XRYP 79191000
         BALR  RETRN,RNTRE              GET TTE ADDRESS        @G36XRYP 79198000
         USING IEDQTRM,RPARM            TTE ADDRESSABILITY     @G36XRYP 79205000
         L     RQCB,TRMDESTQ-K1         GET QCB ADDRESS        @G36XRYP 79212000
         ST    RQCB,AVTSAVE2+K64        SAVE QCB FOR QTIP 9    @G36XRYP 79219000
         DROP  RPARM                                           @G36XRYP 79226000
         LR    RETRN,RWK11              RESTORE RETURN ADDRESS @G36XRYP 79233000
         L     RWRK2,PRFLINK-K1         GET NEXT BFR ON QUEUE           79310000
         LA    RWRK2,K0(R0,RWRK2)       CLR HI-ORDER BYTE OF REG        79380000
         ST    RWRK2,K0(R0,RWRK8)       RE-CHAIN BFR WAIT QUEUE         79450000
         LTR   RWRK2,RWRK2              ANY MORE BFRS ON QUEUE          79520000
         BZ    TSIN2034                 BRANCH IF NO MORE               79590000
         CLC   PRFQCBA,PRFQCBA-IEDQPRF(RWRK2) IS THE NEXT BFR ON        79660000
*                                       THE QUEUE PART OF THIS TCAM MSG 79730000
         BCR   EQUAL,RETRN              RETURN TO CALLER IF YES         79800000
         SPACE 1                                                        79870000
TSIN2034 EQU   *                                                        79940000
         NI    QCBTSOF2,OFF-QCBBUFQ     INDICATE NO MORE BUFFERS        80010000
*                                       ON WAIT QUEUE FOR THIS QCB      80080000
         BR    RETRN                    RETURN TO CALLER                80150000
         DROP  RPREFIX,RQCB             DROP BASE REGISTERS             80220000
         SPACE 2                                                        80290000
********                                                                80360000
******** DETERMINE IF ENOUGH TS BUFFERS ARE AVAILABLE TO REMOVE THE     80430000
******** SYSTEM FROM LWAIT.  IS SO, REMOVE ANY TSB'S WHICH MAY BE ON    80500000
******** THE TSB WAIT QUEUE AND UNLOCK THE ASSOCIATED TERMINAL KEYBOARD 80570000
******** TO ALLOW ANOTHER READ TO BE ISSUED.                            80640000
********                                                                80710000
TSIN2040 EQU   *                                                        80780000
         TM    AVTBIT3,AVTTSAB          DID TSO ABEND            A44839 80850000
         BO    TSIN2050                 RETURN CONTROL TO TCAM   A44839 80920000
*                                       DISPATCHER IF YES               80990000
         LTR   RTIOC,RTIOC              RPT EXIST? / TSO UP?    YA04775 81060000
         BZ    TSIN2050                 NO,RETURN TO DISPATCHER YA04775 81130000
         TM    TIOCFLG,TIOCSYLW         IS THE SYSTEM IN LWAIT          81200000
         BZ    TSIN2050                 BRANCH IF NO                    81270000
         SR    RWRK2,RWRK2              CLEAR REGISTER          YA00161 81340000
         CH    RWRK2,TIOCNFBF           ANY FREE BUFFERS AT ALL YA00161 81410000
         BE    TSIN2050                 NO, DON'T REMOVE LWAIT  YA00161 81480000
         CLC   TIOCNFBF,TIOCUSLW        ENOUGH FREE TS BFRS TO REMOVE   81550000
*                                       SYSTEM LWAIT CONDITION          81620000
         BL    TSIN2050                 BRANCH IF NO                    81690000
         SPACE 2                                                        81760000
********                                                                81830000
******** CALL QTIP TO REMOVE THE SYSTEM FROM LWAIT                      81900000
********                                                                81970000
         QTIP  6,(RAVT)                                                 82040000
         SPACE 2                                                        82110000
********                                                                82180000
******** RETURN CONTROL TO DSPCHAIN WITHIN THE TCAM DISPATCHER.  ALSO   82250000
******** RETURN ANY FREE TCAM BUFFERS AND/OR ANY QCBS WAITING TO BE     82320000
******** POSTED.                                                        82390000
********                                                                82460000
TSIN2050 EQU   *                                                        82530000
         USING IEDQDISP,RDISP           TCAM DISPATCHER BASE REGISTER   82600000
         L     RDISP,AVTSAVE2+K68       RESTORE TCAM DISPATCHER ADDRESS 82670000
         L     RPARM,AVTDOUBL           GET QCB AND/OR TCAM BFR ADDR    82740000
         BAL   RETRN,DSPCHAIN           RETURN TO TCAM DISP    @G36XRYP 82810000
         DROP  RDISP                    DROP TCAM DISPATCHER BASE REG   82880000
         SPACE 2                                                        82950000
********                                                                83020000
******** PLACE TCAM BUFFER ON RETURN QUEUE.  THIS QUEUE IS A DOUBLE     83090000
******** WORD WORK AREA LOCATED AT AVTDOUBL.  ALL BASIC UNITS PLACED ON 83160000
******** THIS QUEUE ARE CHAINED TOGETHER AS ONE BUFFER VIA THE TIC      83230000
******** FIELD.  THE FIRST BASIC UNIT PLACED ON THIS QUEUE WILL BE THE  83300000
******** BUFFER HEADER FOR ALL BASIC UNITS BEING RETURNED.  IF ADDING   83370000
******** A BUFFER TO THE LAST BUFFER ALREADY ON THIS QUEUE WOULD CAUSE  83440000
******** THE ONE BYTE BASIC UNIT COUNT FIELD TO OVERFLOW, ANOTHER       83510000
******** BUFFER HEADER WILL BE ADDED TO THE END OF THE QUEUE AND        83580000
******** CHAINNING WILL CONTINUE WITH THIS BUFFER.  THIS QUEUE MAY ALSO 83650000
******** CONTAIN ONE OR MORE LCB'S OR QCB'S WHICH ARE TO BE TPOSTED TO  83720000
******** THEMSELVES.  THE LCB'S, QCB'S, AND THE TCAM HEADERS ARE        83790000
******** CHAINED TOGETHER VIA THEIR LINK FIELDS.  THE TCAM HEADERS, IF  83860000
******** PRESENT, WILL ALWAYS BE THE LAST ELEMENTS IN THIS QUEUE.       83930000
******** THE FIRST WORD OF AVTDOUBL WILL POINT TO THIS CHAIN.  THE      84000000
******** SECOND WORD OF AVTDOUBL WILL POINT TO THE LAST BASIC UNIT ON   84070000
******** THE QUEUE.                                                     84140000
********                                                                84210000
TSIN4000 EQU   *                                                        84280000
         USING IEDQPRF,RPREFIX          USE RPREFIX AS TCAM BFR BASE    84350000
         XC    PRFLINK,PRFLINK          CLEAR BUFFER LINK FIELD         84420000
         SR    RWRK2,RWRK2              CLEAR REGISTER                  84490000
         IC    RWRK2,PRFNBUNT           NO. OF BASIC UNITS TO RETURN    84560000
         L     RWK15,AVTDOUBL           GET FIRST ELEMENT ON RETURN Q   84630000
         LTR   RWK15,RWK15              ANY ELEMENTS ON RETURN QUEUE    84700000
         BZ    TSIN4010                 BRANCH IF NONE                  84770000
         SPACE 1                                                        84840000
TSIN4002 EQU   *                                                        84910000
         CLC   PRFLINK-IEDQPRF(K3,RWK15),AVTFZERO  IS THIS ELEMENT THE  84980000
*                                       LAST ELEMENT IN THE LINK CHAIN  85050000
         BE    TSIN4004                 BRANCH IF YES                   85120000
         L     RWK15,K4(R0,RWK15)       GET ADDR OF NEXT ELEMENT        85190000
         B     TSIN4002                 BRANCH TO CONTINUE SEARCH       85260000
         SPACE 1                                                        85330000
TSIN4004 EQU   *                                                        85400000
         CLC   AVTDOUBL+K4(K4),AVTFZERO  ANY BASIC UNITS ON RETRN QUEUE 85470000
         BE    TSIN4006                 BRANCH IF NONE                  85540000
         DROP  RPREFIX                  DROP RPREFIX AS PREFIX BASE REG 85610000
         USING IEDQPRF,RWK15            USE RWK15 AS PREFIX BASE REG    85680000
         SR    RWRKZ,RWRKZ              CLEAR REGISTER                  85750000
         IC    RWRKZ,PRFNBUNT           GET NO. OF BASIC UNITS ON QUEUE 85820000
         ALR   RWRKZ,RWRK2              UP COUNT BY NO. BEING RETURNED  85890000
         CH    RWRKZ,C255               CAN THESE BASIC UNITS BE ADDED  85960000
*                                       TO HDR BFR ON THE RETURN QUEUE  86030000
         BH    TSIN4005                 BR IF NO TO ADD ANOTHER HDR BFR 86100000
         STC   RWRKZ,PRFNBUNT           STORE UPDATED COUNT IN HDR      86170000
         L     RWK15,AVTDOUBL+K4        ADDR OF LAST BASIC UNIT ON Q    86240000
         ST    RPREFIX,PRFTIC           PUT RETURNED BASIC UNITS ON Q   86310000
         B     TSIN4020                 BR TO COMPLETE CHAIN            86380000
         SPACE 1                                                        86450000
TSIN4005 EQU   *                                                        86520000
         ST    RPREFIX,PRFLINK-K1       CHAIN THIS HDR TO LAST ON QUEUE 86590000
         MVI   PRFPRI,PRISBPCI          RESTORE BUFFER PRIORITY         86660000
         B     TSIN4008                 BRANCH TO COMPLETE CHAIN        86730000
         SPACE 1                                                        86800000
TSIN4006 EQU   *                                                        86870000
         DROP  RWK15                    DROP RWK15 AS TCAM BFR BASE REG 86940000
         USING IEDQQCB,RWK15            USE RWK15 AS QCB BASE REG       87010000
         IC    RWRKZ,QCBPRI             PICK UP ELEMENT PRIORITY        87080000
         SLL   RWRKZ,K24                LEFT ADJUST PRIORITY            87150000
         LA    RPREFIX,K0(R0,RPREFIX)   CLEAR HI-ORDER BYTE OF REGISTER 87220000
         OR    RPREFIX,RWRKZ            RESTORE PRIORITY                87290000
         ST    RPREFIX,QCBLINK-K1       CHAIN HDR TO LAST QCB OR LCB    87360000
         SPACE 1                                                        87430000
TSIN4008 EQU   *                                                        87500000
         DROP  RWK15                    DROP RWK15 AS PREFIX BASE REG   87570000
         USING IEDQPRF,RPREFIX          USE RPREFIX AS PREFIX BASE REG  87640000
         LA    RWK15,AVTBFRTB           GET BFR RETURN QCB ADDRESS      87710000
         ST    RWK15,PRFQCBA-K1         PUT BFR RETURN QCB ADDR IN HDR  87780000
         MVI   PRFPRI,PRISBPCI          PUT BFR PRIORITY IN HDR BFR     87850000
         B     TSIN4020                 BR TO COMPLETE CHAIN            87920000
         SPACE 1                                                        87990000
TSIN4010 EQU   *                                                        88060000
         ST    RPREFIX,AVTDOUBL         PUT BFR ON RETURN QUEUE         88130000
         B     TSIN4008                 BR TO PUT TCAM HEADER ON QUEUE  88200000
         SPACE 1                                                        88270000
TSIN4030 EQU   *                                                        88340000
         L     RPREFIX,PRFTIC           NEXT BASIC UNIT BEING RETURNED  88410000
         SPACE 1                                                        88480000
TSIN4020 EQU   *                                                        88550000
         BCT   RWRK2,TSIN4030           SEARCH FOR LAST BASIC UNIT ON Q 88620000
         ST    RPREFIX,AVTDOUBL+K4      UPDATE LAST IN QUEUE POINTER    88690000
         XC    PRFTIC,PRFTIC            ZERO TIC FLD OF LAST BASIC UNIT 88760000
         BR    RETRN                    RETURN TO CALLER                88830000
         DROP  RPREFIX,RTSB,RTIOC,RAVT  DROP CONTROL BLOCK BASE REGS    88900000
         EJECT                                                          88970000
*********************************************************************** 89040000
********                                                       ******** 89110000
******** CONSTANTS                                             ******** 89180000
********                                                       ******** 89250000
*********************************************************************** 89320000
         SPACE 1                                                        89390000
MOVEPRFX MVC   K0(K0,RBUADR),K0(RPREFIX)  MOVE OLD BFR PREFIX    S22029 89460000
*                                       INTO NEW 1ST BASIC UNIT         89530000
C255     DC    H'255'                   CONSTANT 255 USED TO CHECK FOR  89600000
*                                       BASIC UNIT COUNT OVERFLOW       89670000
CC3270L  DC    H'3'                     CONSTANT USED TO CHECK   S22028 89740000
*                                       3270 CONTROL CHAR LENGTH        89810000
PATCH    DC    10F'0'                   PATCH AREA             @YA11732 89880000
         SPACE 3                                                        89950000
*********************************************************************** 90020000
********                                                       ******** 90090000
******** DSECTS                                                ******** 90160000
********                                                       ******** 90230000
*********************************************************************** 90300000
         SPACE 1                                                        90370000
         TTCXD                                                          90400000
********                                                                90440000
******** AVT - ADDRESS VECTOR TABLE                                     90510000
********                                                                90580000
         SPACE 1                                                        90650000
         TAVTD                                                          90720000
         EJECT                                                          90790000
********                                                                90860000
******** TIOCBUF - TIOC BUFFER FORMAT                                   90930000
********                                                                91000000
         SPACE 1                                                        91070000
         IKJTIOCB                                                       91140000
         EJECT                                                          91210000
********                                                                91280000
******** CVT - COMMUNICATIONS VECTOR TABLE                              91350000
********                                                                91420000
         SPACE 1                                                        91490000
CVT      DSECT                                                          91560000
         CVT                                                            91630000
         EJECT                                                          91700000
********                                                                91770000
******** TCAM DISPATCHER                                                91840000
********                                                                91910000
         SPACE 1                                                        91980000
         TDISPD                                                         92050000
         EJECT                                                          92120000
********                                                                92190000
******** LCB - LINE CONTROL BLOCK                                       92260000
********                                                                92330000
         SPACE 1                                                        92400000
         TLCBD                                                          92470000
         EJECT                                                          92540000
********                                                                92610000
******** TCAM BUFFER PREFIX                                             92680000
********                                                                92750000
         SPACE 1                                                        92820000
         TPRFD                                                          92890000
         EJECT                                                          92960000
********                                                                93030000
******** TCAM BUFFER PRIORITIES                                         93100000
********                                                                93170000
         SPACE 1                                                        93240000
         TPRIOR                                                         93310000
         EJECT                                                          93380000
********                                                                93450000
******** QCB - DESTINATION QUEUE ELEMENT CONTROL BLOCK                  93520000
********                                                                93590000
         SPACE 1                                                        93660000
         TQCBD                                                          93730000
         EJECT                                                          93800000
********                                                                93870000
******** SCB - STATION CONTROL BLOCK                                    93940000
********                                                                94010000
         SPACE 1                                                        94080000
         TSCBD                                                          94150000
         EJECT                                                          94220000
********                                                                94290000
******** TIOCRPT - TIOC REFERENCE POINTER TABLE                         94360000
********                                                                94430000
         SPACE 1                                                        94500000
         IKJTIOCP                                                       94570000
         EJECT                                                          94640000
********                                                                94710000
******** TERMINAL ENTRY TABLE                                           94780000
********                                                                94850000
         SPACE 1                                                        94920000
         TTRMD                                                          94990000
         EJECT                                                          95060000
********                                                                95130000
******** TSB - TERMINAL STATUS BLOCK                                    95200000
********                                                                95270000
         SPACE 1                                                        95340000
         IKJTSB                                                         95410000
         EJECT                                                          95480000
********                                                                95550000
******** ASCB - ADDRESS SPACE CONTROL BLOCK                             95620000
********                                                                95690000
         SPACE 1                                                        95760000
         IHAASCB                                                        95830000
         EJECT                                                          95900000
********                                                                95970000
******** DESTINATION QCB FOR TSINPUT                                    96040000
********                                                                96110000
         SPACE 1                                                        96180000
         TTSID                                                          96250000
         SPACE 1                                                        96270000
         IHAASVT                                             @ZM46757   96290000
         END                                                            96320000
