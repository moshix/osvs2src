         TITLE 'IEDAYII - QTIP CODE FOR TSINPUT'                        00100020
IEDAYII  CSECT                                                          00200020
         SPACE 1                                                        00500020
         DC    CL7'IEDAYII'             IDENTIFIER                      00800020
         DC    X'7203'                  DATE - 07/22/77         ZA25074 00850000
         DS    0H                       FILLER                          00900020
         SPACE 1                                                        01108020
*********************************************************************** 01116020
*                                                                       01116400
*A064400,138118,138980                                          ZA25074 01116800
*C138110                                                        ZA25074 01117200
*D138124-138126,645200-6456000                                  ZA25074 01117600
*          VS2  3.7  PTF                                                01118000
*                                                              @ZA12528 01118400
*                                                              @ZA12528 01118800
*                                                              @ZA12528 01119200
*                                                              @ZA12528 01119600
*                                                              @ZA12528 01120000
*                                                              @ZA12528 01120400
*  A 237230-241230,264430-266230,268430-274030,275930,276930    ZA12528 01120800
*  C 210806,211630-213230,215630-218030                         ZA12528 01121200
*  C 242030-245230,256430-262030,280290                         ZA12528 01121600
*  D 235630,237230-239630,249230,250030,264430-266030           ZA12528 01122000
*  D 268430-274430,275930                                       ZA12528 01122400
*                                                                     * 01124020
*        VS2 3.0 SU                                                     01124100
*0000137840                                                    @ZA11600 01124200
*0000137030,137658                                             @ZA10588 01124300
*0000617000                                                    @ZA08015 01124400
*0000008100,337630                                             @ZA07609 01124500
*0000617000                                                    @ZA05465 01124600
*0000750674                                                    @ZA03667 01124700
*0000530680-530700                                             @ZA02244 01124800
*                                                                       01124900
*                                                                       01125000
*                                                                M2688  01126020
*                                                                TS1628 01128020
*                                                                M0030  01130020
*                                                                 M3660 01131020
*                                                                 M6361 01131520
*          RELEASE 21 DELETIONS                                       * 01148020
*1332137210,311000,335000,339600,412320,453000-453200,455100,    S22028 01148100
*1332455400,455600,456600,530080,530380,684000,747000            S22028 01148200
*1332                                                            A45625 01148521
*1332139370-139400                                               A43888 01149021
*1332535000-542000,548500-600000,663080-663920                   S21008 01150021
*                                                                 M2673 01152020
*                                                               SA59536 01152500
*          VS2-3.0 CHANGES                                              01153000
*D003000,682000,751727,751883                                   ZA01370 01153500
*C008100,751922,677500                                          ZA01370 01154000
*A677100-677484                                                 ZA01370 01154500
*A279612                                                        ZA02167 01155000
*C279640                                                        ZA02167 01155500
*                                                                     * 01156020
**************************************************************  ZA25074 01156500
* MODULE NAME = IEDAYII   (QTIP,TSO)                            ZA25074 01157000
*                                                               ZA25074 01157500
* DESCRIPTIVE NAME = TSINPUT ROUTINE IN QTIP SVC                ZA25074 01158000
*                                                               ZA25074 01158500
* COPYRIGHT = NONE                                              ZA25074 01159000
*                                                               ZA25074 01159500
* STATUS = TCAM VERSION 10.0                                    ZA25074 01160000
*                                                                     * 01172020
* FUNCTION -                                                          * 01180020
*    THIS ROUTINE PROVIDES AN INTERFACE FOR TSINPUT (IEDAYI) BETWEEN  * 01188020
*    THE TCAM AND TSO REGIONS.                                        * 01196020
*                                                                     * 01204020
* ENTRY POINTS -                                                      * 01212020
*    QTIP0050,QTIP0060,QTIP0070,QTIP0080,QTIP0090, AND QTIP0280.      * 01220020
*                                                                     * 01228020
* INPUT -                                                             * 01236020
*    REFER TO THE PREFACE OF THE APPLICABLE ENTRY POINT.              * 01244020
*                                                                     * 01252020
* OUTPUT -                                                            * 01260020
*    FOR QTIP ENTRY CODE 9, REGISTER 15 WILL CONTAIN A RETURN CODE IN * 01268020
*    THE HI ORDER BYTE INDICATING WEITHER OR NOT SUFFICIENT TS        * 01276020
*    BUFFERS WERE AVAILABLE TO PROCESS THE TS MESSAGE.  THE LOW ORDER * 01284020
*    3 BYTES WILL CONTAIN THE ADDRESS OF THE LAST TS HEADER BUFFER ON * 01292020
*    THE INPUT HEADER QUEUE.  THE RETURN CODES ARE AS FOLLOWS.        * 01300020
*        00 - SUFFICIENT TS BUFFERS WERE AVAILABLE.                   * 01308020
*        04 - NO TS BUFFERS WERE AVAILABLE.                           * 01316020
*                                                                     * 01324020
* EXTERNAL REFERENCES -                                               * 01332020
*    THIS ROUTINE CALLS THE TIME SHARING INTERFACE PROGRAM (TSIP)     * 01340020
*    WITH AN ENTRY CODE OF 4, VIA A BRANCH AND LINK, TO BRING THE     * 01348020
*    USER INTO CORE FOLLOWING THE REMOVAL OF AN IWAIT CONDITION.      * 01356020
*                                                                     * 01364020
* EXITS, NORMAL -                                                     * 01372020
*    RETURN IS ALWAYS TO TSINPUT (IEDAYI) VIA A BRANCH ON REGISTER 14.* 01380020
*                                                                     * 01388020
* EXITS, ERROR -                                                      * 01396020
*    NONE                                                             * 01404020
*                                                                     * 01412020
* TABLES/WORK AREAS -                                                 * 01420020
*    NONE                                                             * 01428020
*                                                                     * 01436020
* ATTRIBUTES -                                                        * 01444020
*    SERIALLY-REUSABLE,REFRESHABLE,DISABLED                           * 01452020
*                                                                     * 01460020
* CHARACTER CODE DEPENDENCY -                                         * 01468020
*    THIS ROUTINE IS DEPENDENT ON THE FOLLOWING EBCDIC CHARACTERS.    * 01476020
*        X'0D' - EBCDIC CARRIAGE RETURN CHARACTER.  EQUATED TO        * 01484020
*        'CARRTRN' WITHIN THIS ROUTINE.                               * 01492020
*                                                                     * 01500020
*        X'15' - EBCDIC NEW LINE CHARACTER.  EQUATED TO 'NEWLINE'     * 01508020
*        WITHIN THIS ROUTINE.                                         * 01516020
*                                                                     * 01524020
* NOTES -                                                             * 01532020
*    EACH ENTRY POINT INTO THIS ROUTINE IS PREFACED WITH DESCRIPTION  * 01540020
*    WHICH DEFINES THE FUNCTION AND INPUT PARAMETERS OF THE ASSOCI-   * 01548020
*    ATED ENTRY.                                                      * 01556020
*                                                                     * 01564020
*********************************************************************** 01572020
         EJECT                                                          01580020
*********************************************************************** 01605020
********                                                       ******** 01610020
******** ENTRY POINTS                                          ******** 01615020
********                                                       ******** 01620020
*********************************************************************** 01625020
         SPACE 1                                                        01630020
         ENTRY QTIP0050,QTIP0060,QTIP0070,QTIP0080,QTIP0090             01650020
         ENTRY QTIP0280                                                 01660020
         SPACE 3                                                        01670020
*********************************************************************** 01700020
********                                                       ******** 01800020
******** REGISTER EQUATES                                      ******** 01900020
********                                                       ******** 02000020
*********************************************************************** 02100020
         SPACE 1                                                        02200020
R0       EQU   0                        INDEX REGISTER                  02300020
RMVSZ1   EQU   R0                       SIZE OF DATA IN THE BASIC UNIT  02400020
RMVSZ2   EQU   1                        UNFILLED SPACE SIZE IN TS BFR   02600020
RWRK1    EQU   RMVSZ2                   WORK/PARAMETER REGISTER         02800020
RWK1     EQU   1                        WORK REG               @ZA03667 02850000
RSCANF   EQU   2                        POINTER TO BEGIN OF DATA SCANED 02900020
RWRK2    EQU   RSCANF                   WORK/PARAMETER REGISTER         03000020
RSCANL   EQU   3                        POINTER TO END OF DATA SCANNED  03100020
RWRK3    EQU   RSCANL                   WORK/PARAMETER REGISTER         03200020
RWRK4    EQU   4                        WORK/PARAMETER REGISTER         03300020
RLCB     EQU   RWRK4                    LCB ADDRESS                     03350020
RTSBFR   EQU   5                        TIME SHARING BUFFER ADDRESS     03400020
RTCBFR   EQU   6                        TCAM BUFFER ADDRESS             03700020
RQCB     EQU   7                        DESTINATION QCB ADDRESS         03900020
RFILL    EQU   RQCB                     ADDR OF BEGIN FILL IN TS BFR    04000020
RWRK7    EQU   RFILL                    WORK/PARAMETER REGISTER         04100020
RDSZE    EQU   8                        SIZE OF DATA IN BUFFER          04200020
RWRK8    EQU   RDSZE                    WORK/PARAMETER REGISTER         04300020
RTSB     EQU   9                        TSB ADDRESS                     04400020
RTIOC    EQU   10                       TIOCRPT ADDRESS                 04500020
RWK11    EQU   11                       WORK/PARAMETER REGISTER         04600020
RBASE    EQU   12                       BASE REGISTER                   04700020
RAVT     EQU   13                       ADDRESS OF AVTSAVE2             04800020
RETRN    EQU   14                       RETURN ADDRESS                  05000020
RNTRY    EQU   15                       ENTRY POINT                     05200020
RTRNCD   EQU   RNTRY                    RETURN CODE TO TSINPUT          05300020
RWK15    EQU   RTRNCD                   WORK/PARAMETER REGISTER         05400020
         EJECT                                                          05500020
*********************************************************************** 05600020
********                                                       ******** 05700020
******** MASKS AND DISPLACEMENTS                               ******** 05800020
********                                                       ******** 05900020
*********************************************************************** 06000020
         SPACE 1                                                        06100020
K0       EQU   0                        NULL DISPLACEMENT               06200020
K1       EQU   1                        CONSTANT 1                      06300020
CC3270ND EQU   1                        3270 AID CONTROL CHAR    S22028 06310000
*                                       LENGTH                   S22028 06320000
K2       EQU   2                        LENGTH FIELD                    06330020
K3       EQU   3                        LENGTH FIELD                    06360020
CC3270R  EQU   3                        LENGTH OF EXTRA CONTROL  S22028 06368000
*                                       CONCHARACTERS FOR 3270 REMOTE   06376000
CC3270D3 EQU   3                        CONTROL CHAR LNG FOR     S22028 06384000
*                                       3270                     S22028 06392000
K4       EQU   4                        LENGTH FIELD                    06400020
CC3270D6 EQU   6                        MAXIMUM NO. OF CONTROL   S22028 06410000
*                                       CHARACTERS FOR 3270             06420000
ADDR     EQU   7                        ADDRESS MASK            ZA25074 06430000
ZEROS    EQU   8                        MASK FOR A CONDITION CODE OF 8  06460020
K8       EQU   8                        LENGTH FIELD                    06500020
K12      EQU   12                       LENGTH FIELD                    06600020
K16      EQU   16                       LENGTH FIELD                    06700020
K44      EQU   44                       OFFSET OF 4-WORD SAVE   YS02019 06740000
*                                       AREA IN AVTSAVE2                06780000
K60      EQU   60                       LENGTH FIELD            YS02019 06820000
K64      EQU   64                       LENGTH FIELD            YS02019 06860000
LCBDELAY EQU   X'02'                    LCB IS ON THE DELAY QUEUE       06900020
CARRRTRN EQU   X'0D'                    CARRIAGE RETURN CHARACTER       07110020
SBA      EQU   X'11'                    SBA CHARACTER            S22028 07120000
WAITQBFR EQU   X'10'                    USED TO INDICATE TCAM BFR HAS   07130020
*                                       BEEN ON TCAM BFR WAIT QUEUE     07160020
NEWLINE  EQU   X'15'                    NEW LINE CHARACTER              07190020
NOTMOVED EQU   X'20'                    IND NOT ALL OF SCANNED DATA IN  07210020
*                                       TCAM BFR WAS MOVED TO TS BFR(S) 07230020
TIMEOUT  EQU   X'40'                    TIME OUT OCCURED IN THIS BFR    07260020
WRITEBRK EQU   X'80'                    WRITE BREAK IN PROGRESS         07300020
CC32706  EQU   X'08'                    MORE THAN 1 3270 CONTROL S22028 07330000
*                                       CHARACTER IN BUFFER             07360000
OFF      EQU   X'FF'                    USED TO TURN OFF BITS           07400020
CLRSCREN EQU   X'FF'                    USED TO IND DISPLAY SCREEN MUST 07430020
*                                       BE CLEARED BEFORE CONTINUING    07460020
         EJECT                                                          07500020
*********************************************************************** 07600020
********                                                       ******** 07700020
******** THE FOLLOWING SECTION OF CODE IS USED BY TSINPUT TO   ******** 07800020
******** TERMINATE TCLEARQ PROCESSING.  THE ENTRY POINT INTO   ******** 07900020
******** THIS CODE IS QTIP0050.                                ******** 08000020
********                                                       ******** 08200020
******** INPUT REGISTERS -                                     ******** 08300020
********                                                       ******** 08400020
********       REG 9 - ADDRESS OF THE CURRENT TSB.             ******** 08500020
********                                                       ******** 08600020
*********************************************************************** 08700020
QTIP0050 EQU   *                                                        08800020
         USING *,RBASE                  ESTABLISH ADDRESSABILITY        08900020
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   09000020
         NI    TSBFLG1,OFF-TSBIFLSH     TERMINATE TCLEARQ PROCESSING    09060020
         NI    TSBFLG2,OFF-TSBBIPI      TERMINATE BREAK-IN PROCESSING   09200020
         NI    TSBFLG3,OFF-TSBSPIT      PROMPTING OK NOW         YM2814 09250000
         BR    RETRN                    RETURN TO CALLER                09300020
         DROP  RTSB                     DROP CONTROL BLOCK BASE REGS    09400020
         EJECT                                                          10400020
*********************************************************************** 12300020
********                                                       ******** 12400020
******** THE FOLLOWING SECTION OF CODE IS USED BY TSINPUT TO   ******** 12500020
******** REMOVE THE SYSTEM FROM AN LWAIT CONDITION AND CHECK   ******** 12540020
******** THE LINE STATUS OF EACH TERMINAL WHOSE KEYBOARD WAS   ******** 12580020
******** LOCKED TO INPUT DUE TO THE SYSTEM LWAIT CONDITION.    ******** 12620020
******** IF IT IS NECESSARY TO ACTIVATE THE TERMINAL, THE LINE ******** 12660020
******** WILL BE TPOSTED TO ITSELF.  THE ENTRY POINT INTO THIS ******** 12700020
******** CODE IS QTIP0060.                                     ******** 12740020
********                                                       ******** 12800020
******** INPUT REGISTERS -                                     ******** 12900020
********                                                       ******** 13000020
********       REG 10 - ADDRESS OF THE TIOCRPT.                ******** 13100020
********       REG 13 - ADDRESS OF AVTSAVE2.                   ******** 13150020
********                                                       ******** 13200020
*********************************************************************** 13300020
QTIP0060 EQU   *                                                        13400020
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   13600020
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REGISTER   13650020
         ST    RETRN,AVTSAVE2+K60       SAVE RETURN ADDRESS     YS02019 13670000
         NI    TIOCFLG,OFF-TIOCSYLW     REMOVE SYSTEM FROM LWAIT        13700020
         LH    RWK11,TIOCNTSB           GET CURRENT NO. OF TS  @ZA10588 13703000
*                                       USERS                   YS02019 13706000
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   13727020
         L     RTSB,TIOCTSB-K1          GET ADDR OF FIRST TSB IN TABLE  13730020
         SR    RWRK8,RWRK8              CLEAR REGISTER                  13733020
         IC    RWRK8,TIOCTSBS           GET SIZE OF A TSB               13736020
         SPACE 2                                                        13739020
********                                                                13742020
******** CHECK EVERY TSB IN USE TO DETERMINE IF THE ASSOCIATED TERMINAL 13745020
******** KEYBOARD WAS LOCKED TO INPUT DUE TO THE SYSTEM LWAIT           13748020
******** CONDITION.  IF THE ASSOCIATED TERMINAL IS NOT ALSO IN A USER   13751020
******** LWAIT CONDITION, UNLOCK THE TERMINAL KEYBOARD TO ALLOW ANOTHER 13754020
******** READ TO BE ISSUED.  OTHERWISE, LEAVE THE KEYBOARD LOCKED.      13757020
********                                                                13760020
TSIN6000 EQU   *                                                        13763020
         LTR   RWK11,RWK11              ARE ANY USERS LEFT       A43888 13764021
         BNZ   TSIN6010                 YES, CONTINUE CHECKING  YS02019 13764500
         L     RETRN,AVTSAVE2+K60       GET RETURN ADDRESS      YS02019 13765000
         BR    RETRN                    RETURN TO CALLER        YS02019 13765200
         SPACE 1                                                        13765400
TSIN6010 EQU   *                                                YS02019 13765600
         BCTR  RWK11,R0                 DECR COUNT OF TSBS     @ZA10588 13766000
*                                       LEFT TO SCAN           @ZA10588 13767000
         TM    TSBSTAT,TSBINUSE         IS THIS TSB IN USE              13769000
         BZ    TSIN6070                 BRANCH IF NOT TO GET NEXT TSB   13772000
         TM    TSBSTAT,TSBLWAIT         IS THE TERMINAL IN A USER LWAIT 13775020
         BO    TSIN6070                 BRANCH IF YES TO GET NEXT TSB   13778020
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE REGISTER   13781020
         LH    RWRK1,TSBASRCE           GET INDEX TO TNT        YS02019 13782000
         LTR   RWRK1,RWRK1              IS TNT INDEX ZERO?     @ZA11600 13784000
         BZ    TSIN6070                 YES,GO GET NEXT TSB    @ZA11600 13784300
         L     RNTRY,AVTRNMPT           GET TNT CODE ENTRY ADDR YS02019 13784600
         BALR  RETRN,RNTRY              GO TO TNT CODE          YS02019 13784900
         USING IEDQTRM,RWRK1            TRM ADDRESSABILITY      YS02019 13785200
         L     RQCB,TRMDESTQ-K1         GET QCB ADDRESS         YS02019 13785500
         DROP  RWRK1                    TRM NOT ADDRESSABLE     YS02019 13785800
         TM    QCBFLAG,QCBTSSES         IS A TSO SESSION IN PROGRESS    13787020
         BZ    TSIN6070                 BRANCH IF NOT TO GET NEXT TSB   13790020
         NI    QCBTSOF1,OFF-QCBNOBUF    UNLOCK THE TERMINAL KEYBOARD    13793020
         SPACE 2                                                        13796020
********                                                                13799020
******** POST THE LINE, IF NECESSARY, TO ACTIVATE THE TERMINAL.         13802020
********                                                                13805020
         USING IHADCB,RWRK3             USE RWRK3 AS DCB BASE REGISTER  13805100
         ICM   RWRK3,ADDR,QCBDCBAD      GET DCB ADDRESS         ZA25074 13805200
         LA    RWRK2,IEDQQCB-IEDNQCB    BACK UP TO QCB PREFIX    Y06327 13805300
         SR    RQCB,RWRK2               ADJUST POINTER           Y06327 13805400
         DROP  RQCB                     ADJUST FUTURE REFERENCES Y06327 13805500
         USING IEDNQCB,RQCB             COND ASSEMBLY WILL ADJS  Y06327 13805600
         TM    DCBDSORG,TRMLGB          IS THIS 3705             Y06327 13805700
         BNO   TSIN6011                 BRANCH IF NO             Y06327 13805800
         TM    QCBSTAT1,QCBPLCBN        IS A PLCB ASSIGNED      ZA25074 13805900
         BO    TSIN6070                 YES, DON'T POST QCB     ZA25074 13806000
         TM    QCBTSOF1,QCBDELAY        IS QCB ON THE TIME      ZA25074 13806100
*                                       DELAY QUEUE             ZA25074 13806200
         BO    TSIN6070                 YES, DON'T POST QCB     ZA25074 13806300
         TM    QCBTSOF2,QCBPOSTO        HAS QCB ALREADY BEEN    ZA25074 13806400
*                                       POSTED                  ZA25074 13806500
         BO    TSIN6070                 YES, DON'T POST QCB     ZA25074 13806600
         B     TSIN6030                 GO SEE IF POST REQ'D    ZA25074 13806700
         L     RLCB,QCBPLCBA-K1         FOR 3705, USE PLCB       Y06327 13806800
         B     TSIN6020                 CONTINUE PROCESS         Y06327 13806900
         SPACE 1                                                        13807000
TSIN6011 EQU   *                                                 Y06327 13807100
         L     RLCB,DCBIOBAD            GET IOB ADDRESS                 13807200
         LA    RWRK2,LCBFLAG1-IEDQLCB   GET OFFSET OF IOB FROM LCB      13807300
         SR    RLCB,RWRK2               POINT TO BEGINNING OF FIRST LCB 13807400
         SR    RWRK2,RWRK2              CLEAR REGISTER                  13807500
         IC    RWRK2,DCBEIOBX           GET SIZE OF AN LCB ENTRY        13807600
         DROP  RWRK3                    DROP RWRK3 AS DCB BASE REGISTER 13807700
         SR    RWRK3,RWRK3              CLEAR REGISTER                  13832020
         IC    RWRK3,QCBRELLN           RELATIVE POSITION OF LCB IN TBL 13835020
         MR    RWRK2,RWRK2              CALC OFFSET OF LCB IN TABLE     13838020
         AR    RLCB,RWRK3               ADDRESS OF THE DESIRED LCB      13841020
         ICM   RWRK3,ADDR,QCBDCBAD      GET DCB ADDRESS         ZA25074 13842000
         USING IHADCB,RWRK3             DCB ADDRESSABILITY      ZA25074 13843000
         USING IEDQLCB,RLCB             USE RLCB AS LCB BASE REGISTER   13844020
         SPACE 1                                                        13845000
TSIN6020 EQU   *                                                 Y06327 13846000
         TM    LCBINSRC+K2,LCBDELAY     IS LCB ON THE DELAY QUEUE       13847020
         BO    TSIN6070                 BRANCH IF YES TO GET NEXT TSB   13850020
         CLI   LCBSTAT1,LCBFREEN        IS THIS LINE FREE               13853020
         BE    TSIN6030                 BRANCH IF YES                   13856020
         NI    LCBTSOB,OFF-LCBSOPL      REMOVE LCB FROM POLLING LIST    13859020
         B     TSIN6070                 BRANCH TO GET NEXT TSB          13862020
         SPACE 1                                                        13865020
TSIN6030 EQU   *                                                        13868020
         TM    QCBTSOF1,QCBPARTO        ANY OUTPUT IN PROGRESS          13871020
         BO    TSIN6070                 BRANCH IF YES TO GET NEXT TSB   13874020
         TM    QCBFLAG,QCBNOBRK         DOES TERM HAVE REVERSE BREAK    13877020
         BZ    TSIN6050                 BRANCH IF YES                   13880020
         TM    QCBFLAG,QCBREAD          DOES READ HAVE PRIORITY         13883020
         BO    TSIN6050                 BRANCH IF YES                   13886020
         TM    QCBTSOF1,QCBTGET         HAS TGET BEEN REQUESTED         13889020
         BZ    TSIN6070                 BRANCH IF NOT TO GET NEXT TSB   13892020
         SPACE 1                                                        13895020
TSIN6050 EQU   *                                                        13898020
         TM    DCBDSORG,TRMLGB          TERM ATTACHED VIA NCP   ZA25074 13898100
         BZ    TSIN6051                 NO, GO POST PLCB        ZA25074 13898200
**************************************************************  ZA25074 13898300
*        FOR NCP ATTACHED TERMINALS,QCB IS POSTED TO ITSELF TO  ZA25074 13898400
*        REMOVE LOCK.                                           ZA25074 13898500
**************************************************************  ZA25074 13898600
         LA    RQCB,QCBPRFSZ(RQCB)      POINT TO QCB            ZA25074 13898700
         DROP  RQCB                                             ZA25074 13898800
         USING IEDQQCB,RQCB             QCB ADDRESSABILITY      ZA25074 13898900
         STCM  RQCB,ADDR,QCBELCHN       QCB TO POSTED           ZA25074 13899000
         MVC   QCBLINK,AVTDOUBL+K1      CHAIN ELEMENTS TO BE    ZA25074 13899100
*                                       POSTED                  ZA25074 13899200
         ST    RQCB,AVTDOUBL            PUT QCB ON CHAIN        ZA25074 13899300
         MVI   QCBPRI,PRILNFRE          SET POST PRIORITY       ZA25074 13899400
         B     TSIN6070                 PROCESS NEXT TSB        ZA25074 13899500
         DROP RWRK3                                             ZA25074 13899600
TSIN6051 EQU   *                                                ZA25074 13899700
         MVI   LCBSTAT1,LCBSENDN        INDICATE LINE IS SENDING        13901020
         ST    RLCB,LCBQCBA-K1          TPOST THE LINE TO ITSELF        13904020
         MVC   LCBLINK,AVTDOUBL+K1      CHAIN LCB TO FIRST ELEMENT ON   13907020
*                                       THE RETURN QUEUE                13910020
         ST    RLCB,AVTDOUBL            PLACE THIS LCB ON RETURN QUEUE  13913020
         MVI   LCBPRI,PRILNFRE          PRIORITY TO FREE A LINE         13916020
         SPACE 2                                                        13919020
********                                                                13922020
******** IF THERE ARE ANY MORE TSB'S WHICH ARE IN USE CONTINUE          13925020
******** SCANNING, OTHERWISE RETURN TO TSINPUT.                         13928020
********                                                                13931020
TSIN6070 EQU   *                                                        13934020
         AR    RTSB,RWRK8               POINT TO NEXT TSB IN THE TABLE  13943020
         B     TSIN6000                 BRANCH TO CONTINUE SCAN         13946020
         DROP  RLCB,RQCB,RTSB,RTIOC,RAVT  DROP CONTROL BLOCK BASE REGS  13949020
         EJECT                                                          14000020
*********************************************************************** 14100020
********                                                       ******** 14200020
******** THE FOLLOWING SECTION OF CODE IS USED BY TSINPUT TO   ******** 14300020
******** PUT THE SYSTEM IN AN LWAIT CONDITION.  THE ENTRY      ******** 14400020
******** POINT INTO THIS CODE IS QTIP0070.                     ******** 14500020
********                                                       ******** 14800020
******** INPUT REGISTERS -                                     ******** 14900020
********                                                       ******** 15000020
********       REG 10 - ADDRESS OF THE TIOCRPT.                ******** 15250020
********                                                       ******** 15300020
*********************************************************************** 15400020
QTIP0070 EQU   *                                                        15500020
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   15840020
         OI    TIOCFLG,TIOCSYLW         PLACE THE SYSTEM IN LWAIT       16180020
         BR    RETRN                    RETURN TO TSINPUT               16200020
         DROP  RTIOC                    DROP CONTROL BLOCK BASE REGS    16300020
         EJECT                                                          16400020
*********************************************************************** 16500020
********                                                       ******** 16600020
******** THE FOLLOWING SECTION OF CODE IS USED BY CHARACTER    ******** 16700020
******** LINE DELETE AND CANCEL MESSAGE ROUTINES WITHIN        ******** 16800020
******** TSINPUT TO REMOVE TIME SHARING BUFFERS FROM THE INPUT ******** 16900020
******** QUEUE AND RETURN THEM TO THE FREE QUEUE.  THE ENTRY   ******** 17000020
******** POINT INTO THIS CODE IS QTIP0080.                     ******** 17100020
********                                                       ******** 17200020
******** INPUT REGISTERS -                                     ******** 17300020
********                                                       ******** 17400020
********       REG 6 -  ADDR OF TCAM BFR CURRENTLY PROCESSING. ******** 17500020
********       REG 9 -  ADDR OF THE CURRENT TSB.               ******** 17600020
********       REG 10 - ADDRESS OF THE TIOCRPT.                ******** 17700020
********       REG 13 - ADDRESS OF AVTSAVE2.                   ******** 17800020
********                                                       ******** 17900020
*********************************************************************** 18000020
QTIP0080 EQU   *                                                        18100020
         USING IEDQPRF,RTCBFR           USE RTCBFR AS TCAM BFR BASE REG 18300020
         USING TSB,RTSB                 USE RTSB AS TSB BASE REG        18400020
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REG        18500020
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   18600020
         USING TIOCBUF,RTSBFR           USE RTSBFR AS TS BFR BASE REG   18700020
         SPACE 2                                                        18900020
********                                                                19000020
******** IF CANCEL MESSAGE IS IN PROGRESS, SEARCH FOR THE BEGINNING OF  19100020
******** THE FRAGMENT MESSAGE ON THE INPUT QUEUE.  IF CHARACTER LINE    19200020
******** DELETE HAS OCCURED, SEARCH FOR THE LAST BUFFER (WHICH WILL BE  19300020
******** A PARTIAL LINE) ON THE INPUT QUEUE.                            19400020
********                                                                19500020
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  19550020
         BE    TSIN0800                 BRANCH IF NONE                  19600020
         L     RTSBFR,TSBIBFP-K1        GET FIRST TS BFR ON INPUT QUEUE 19660020
         LR    RWRK4,RTSBFR             SAVE ADDR OF CURRENT HDR BFR    19700020
         SPACE 1                                                        19800020
TSIN0620 EQU   *                                                        19900020
         TM    BUFFFL2,BUFFFRAG         IS THIS TS BFR PART OF FRAG MSG 20000020
         BZ    TSIN0640                 BRANCH IF NOT                   20100020
         TM    PRFSTAT1,PRFCNCLN        IS CANCEL MESSAGE IN PROGRESS   20200020
         BO    TSIN0660                 BRANCH IF YES                   20300020
         SPACE 1                                                        20400020
TSIN0640 EQU   *                                                        20500020
         CLC   BUFFHEAD,AVTFZERO        MORE HDR BFRS ON INPUT QUEUE    20600020
         BE    TSIN0650                 BRANCH IF NO MORE               20700020
         LR    RWRK4,RTSBFR             SAVE ADDR OF CURRENT HDR BFR    20800020
         L     RTSBFR,BUFFHEAD-K1       GET ADDR OF NEXT HDR BFR ON Q   20900020
         B     TSIN0620                 CONTINUE SEARCH                 21000020
         SPACE 1                                                        21020020
TSIN0650 EQU   *                                                        21040020
         TM    BUFFFL1,BUFFNLCR         IS LAST TS MSG COMPLETE         21060020
         BO    TSIN0800                 BRANCH IF YES                   21080020
         NI    BUFFFL1,BUFFHDR+BUFFIHOT RESET FLAG BYTE         ZA12528 21080300
         NI    BUFFFL2,BUFFFRAG         RESET SECOND FLAG BYTE          21081220
         XC    BUFFLNTH,BUFFLNTH        RESET AMOUNT OF DATA TO ZERO    21082020
         XC    BUFFWORK,BUFFWORK        RESET CHAR COUNT TO ZERO        21122020
         L     RWRK2,BUFFTRLR-K1 GET NEXT TRAILER               ZA12528 21132000
         LA    RWRK2,K0(,RWRK2)  CLEAR HI BYTE                  ZA12528 21142000
         LTR   RWRK2,RWRK2       ANY MORE TRAILERS?             ZA12528 21163000
         BZ    TSIN0800                 BRANCH IF NONE                  21403020
         XC    BUFFTRLR,BUFFTRLR        CLEAR TRAILER BUFFER POINTER    21483020
         DROP  RTSBFR          DROP TS BFR BASE                 ZA12528 21503000
TSIN0655 EQU   *                                               @ZA12528 21523000
         USING TIOCBUF,RWRK2   NEW TS BFR BASE                  ZA12528 21563000
         L     RTSBFR,BUFFTRLR-K1 GET NEXT TRAILER              ZA12528 21583000
         LA    RTSBFR,K0(,RTSBFR) CLEAR HI BYTE                 ZA12528 21643000
         BAL   RWRK4,TSIN0760     GO FREE BFR                   ZA12528 21663000
         LTR   RWRK2,RTSBFR       GET NEXT BFR                  ZA12528 21683000
         BZ    TSIN0800           IF NO BFR, DONE               ZA12528 21723000
         B     TSIN0655           HANDLE NEXT BFR               ZA12528 21743000
         SPACE 1                                                        21883020
TSIN0660 EQU   *                                                        21963020
         USING TIOCBUF,RWRK4            USE RWRK4 AS TS BFR BASE REG    22043020
         CR    RTSBFR,RWRK4             IS FIRST BFR TO BE DROPPED ALSO 22123020
*                                       FIRST ON INPUT QUEUE            22203020
         BNE   TSIN0670                 BRANCH IF NO                    22363020
         XC    TSBIBFP,TSBIBFP          CLEAR INPUT QUEUE POINTER       22443020
         B     TSIN0680                 BRANCH TO RETURN BUFFERS        22523020
         SPACE 1                                                        22603020
TSIN0670 EQU   *                                                        22683020
         XC    BUFFHEAD,BUFFHEAD        ZERO LINK FIELD OF PREVIOUS HDR 22763020
         DROP  RWRK4                    DROP RWRK4 AS TS BFR BASE REG   22843020
         SPACE 2                                                        22923020
********                                                                23003020
******** DETERMINE HOW MANY TS BUFFERS ARE TO BE RETURNED AND LINK THEM 23083020
******** TOGETHER FOR PLACEMENT ON THE FREE QUEUE.  IF AUTOMATIC LINE   23163020
******** NUMBERING IS IN PROGRESS, DECREMENT THE LINE COUNT FOR EACH    23243020
******** TS HEADER BUFFER RETURNED.                                     23323020
********                                                                23403020
TSIN0680 EQU   *                                                        23483020
         LR    RWK11,RTSBFR             INITIALIZE NEXT HDR BFR POINTER 23643020
         SPACE 1                                                        24043020
TSIN0700 EQU   *                                                        24123020
         LA    RWRK2,K0(,RWK11)   GET HEADER BFR TO FREE        ZA12528 24143000
         LTR   RWRK2,RWRK2        IS THERE A HEADER BFR?        ZA12528 24163000
         BZ    TSIN0800           NO, DONE                      ZA12528 24203000
         L     RTSBFR,BUFFTRLR-K1 SAVE NEXT TRAILER PTR         ZA12528 24283000
         LA    RTSBFR,K0(,RTSBFR) CLEAR HI BYTE                 ZA12528 24363000
         SPACE 1                                                        24603020
TSIN0720 EQU   *                                                        24683020
         TM    TSBFLG2,TSBAUTON+TSBAULST  IS AUTO LINE NO. IN PROGRESS  24763020
         BNO   TSIN0740                 BRANCH IF NO                    24843020
         TM    BUFFFL1,BUFFNLCR         IS THE LAST TS MSG COMPLETE     25083020
         BZ    TSIN0740                 BRANCH IF NOT                   25163020
         L     RWK15,TSBAUTOS           GET CURRENT VALUE OF LINE NO.   25243020
         S     RWK15,TSBAUTOI           DECR LINE NO. BY INCR VALUE     25323020
         ST    RWK15,TSBAUTOS           UPDATE LINE NUMBER              25403020
         SPACE 1                                                        25483020
TSIN0740 EQU   *                                                        25563020
         L     RWK11,BUFFHEAD-K1  GET NEXT HEADER               ZA12528 25583000
TSIN0750 EQU   *                                               @ZA12528 25603000
         BAL   RWRK4,TSIN0760     GO FREE BFR THATS IN RWRK2    ZA12528 25643000
         LTR   RWRK2,RTSBFR       ANY MORE BUFFERS?             ZA12528 25723000
         BZ    TSIN0700           NO, CHECK NEXT HEADER         ZA12528 25803000
         L     RTSBFR,BUFFTRLR-K1 GET NEXT TRAILER              ZA12528 25883000
         LA    RTSBFR,K0(,RTSBFR) CLEAR HI BYTE                 ZA12528 25963000
         B     TSIN0750           LOOP BACK TO FREE NEXT        ZA12528 26043000
         SPACE 2                                                        26283020
********                                                                26363020
******           BUFFER FREE ROUTINE                            ZA12528 26383000
******  ALWAYS BAL OR BRANCH WITH RETURN ADDRESS IN RWRK4       ZA12528 26403000
******  AND BUFFER TO BE FREED IN RWRK2.                        ZA12528 26443000
******                                                          ZA12528 26523000
********                                                                26683020
TSIN0760 EQU   *                                                        26763020
         SR    RWK15,RWK15      CLEAR REG                       ZA12528 26803000
         IC    RWK15,TSBNIBF    GET INPUT BFR COUNT             ZA12528 26843000
         BCTR  RWK15,K0         DECREMINT COUNT                 ZA12528 26923000
         STC   RWK15,TSBNIBF    STORE UPDATED COUNT             ZA12528 26953000
         TM    BUFFFL1,BUFFIHOT BUFFER ON BOTH QUEUES?          ZA12528 27023000
         BZ    TSIN0770         NO, RETURN BFR TO FREE Q        ZA12528 27123000
         NI    BUFFFL1,OFF-BUFFIHOT YES, TURN OF FLAG           ZA12528 27223000
         BR    RWRK4            RETURN, BFR FREED LATER         ZA12528 27253000
TSIN0770 EQU   *                                                ZA12528 27323000
         L     RNTRY,QBRADDR            GET BFR RETURN RTN EPA  YS02019 27373000
         BALR  R0,RNTRY                 GO TO BFR RETURN RTN    YS02019 27423000
         BR    RWRK4           RETURN                           ZA12528 27473000
         DROP  RWRK2                                            ZA12528 27523000
         SPACE 2                                                        27902020
********                                                                27904020
******** IF ENTRY INTO THIS ROUTINE WAS TO CANCEL A TCAM MESSAGE,       27906020
******** RETURN TO THE CALLER AT THIS TIME.                             27908020
********                                                                27912020
TSIN0800 EQU   *                                                        27920020
         TM    PRFSTAT1,PRFCNCLN        IS CANCEL MESSAGE IN PROGRESS   27930020
         BZ    TSIN0900                 BRANCH IF NOT                   27933020
         NI    TSBFLG2,OFF-TSBBIPI-TSBBRKIN  TERM BREAKIN PROCESSING    27939020
         BR    RETRN                    RETURN TO TSINPUT               27942020
         SPACE 2                                                        27949620
********                                                                27950420
******** IF THIS IS THE LAST TCAM BUFFER OF THE MESSAGE AND NO DATA     27951220
******** REMAINS TO BE SCANNED, OR IF THE NEXT CHARACTER IN THE TCAM    27952020
******** BUFFER IS A NEW LINE OR CARRIAGE RETURN CHARACTER, BRANCH TO   27952820
******** COMPLETE THE TCAM AND/OR TS MESSAGE.  OTHERWISE, RETURN TO     27953620
******** TSINPUT.                                                       27954420
********                                                                27955220
TSIN0900 EQU   *                                                        27959220
         L     RSCANF,AVTSAVE2          GET @ OF TCAM DATA      ZA02167 27960200
         CLR   RSCANL,RSCANF            CR OR NL CHAR NEXT IN   ZA02167 27961200
*                                       TCAM BFR ?              ZA02167 27964000
         BNE   TSIN0170                 BRANCH IF YES                   27972020
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST TCAM BFR OF MSG    27980020
         BCR   ZEROS,RETRN              RETURN TO TSINPUT IF NOT        27990020
         LTR   RDSZE,RDSZE              ANY DATA LEFT TO SCAN           28000020
         BZ    TSIN0170                 BR IF NONE TO EOM PROCESSING    28009020
         BR    RETRN                    RETURN TO TSINPUT               28018020
         DROP  RTCBFR,RTSB,RTIOC,RAVT                           ZA12528 28023000
         EJECT                                                          28038020
*********************************************************************** 28300020
********                                                       ******** 28400020
******** THE FOLLOWING SECTION OF CODE IS USED BY TSINPUT TO   ******** 28500020
******** ALLOCATE TS BUFFERS AND MOVE THE SCANED DATA IN THE   ******** 28600020
******** TCAM BUFFER INTO TS BUFFER(S), AND/OR PERFORM END OF  ******** 28700020
******** TRANSMISSION PROCESSING WHENEVER APPLICABLE.  THE     ******** 28800020
******** ENTRY POINT INTO THIS CODE IS QTIP0090.               ******** 28900020
********                                                       ******** 29000020
******** INPUT REGISTERS -                                     ******** 29100020
********                                                       ******** 29200020
********       REG 2 -  POINTER TO BEGINNING OF DATA SCANNED.  ******** 29260020
********       REG 3 -  POINTER TO END OF DATA SCANNED.        ******** 29320020
********       REG 6 -  ADDR OF TCAM BFR CURRENTLY PROCESSING. ******** 29400020
********       REG 9 -  ADDRESS OF THE CURRENT TSB.            ******** 29500020
********       REG 10 - ADDRESS OF THE TIOCRPT.                ******** 29600020
********       REG 13 - ADDRESS OF AVTSAVE2.                   ******** 29700020
********                                                       ******** 29800020
*********************************************************************** 29900020
QTIP0090 EQU   *                                                        30000020
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REGISTER   30200020
         USING TIOCRPT,RTIOC            USE RTIOC AS TIOCRPT BASE REG   30300020
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   30400020
         USING IEDQPRF,RTCBFR           TCAM BFR ADDRESSABLE    YS02019 30403000
         SPACE 3                                                 A45625 30407021
********                                                                30414021
******** CHECK FOR TCLEARQ INPUT ISSUED, IF SO, RETURN TO TSINPUT       30421021
********                                                                30428021
         TM    TSBFLG1,TSBIFLSH         IS INPUT FLUSH IN        A45625 30435021
*                                       PROGRESS                 A45625 30442021
         BZ    TSIN0150                 NO, CHECK SIZE OF DATA   A45625 30449021
         NI    TSBFLG1,OFF-TSBIFLSH     TURN OFF INPUT FLUSH     A45625 30456021
*                                       FLAG                     A45625 30463021
         NI    TSBFLG2,OFF-(TSBBIPI+TSBBRKIN) TURN OFF BREAKIN-  A45625 30470021
*                                       FLASHBACK FLAGS                 30477021
         XC    PRFSIZE,PRFSIZE          SET DATA SIZE TO ZERO   YS02019 30479000
         SR    RTRNCD,RTRNCD            ZERO RETURN CODE        YS02019 30481000
         BR    RETRN                    RETURN TO TSINPUT        A45625 30484021
         SPACE 2                                                        30500020
********                                                                30600020
******** GET SIZE OF DATA IN THE TCAM BUFFER.                           30700020
********                                                                30800020
TSIN0150 EQU   *                                                 A45625 30850021
         USING IEDQPRF,RTCBFR           USE RTCBFR AS TCAM BFR BASE REG 30900020
         LH    RDSZE,PRFSIZE            GET SIZE OF DATA IN TCAM BFR    31000020
         SPACE 2                                                        31200020
********                                                                31300020
******** DETERMINE IF A PARTIALLY FILLED TS BUFFER EXISTS ON THE INPUT  31400020
******** QUEUE.  IF SO, CONTINUE MOVING DATA INTO THIS TS BUFFER BEGIN- 31500020
******** ING AT THE POINT WHERE THE LAST MOVE LEFT OFF.                 31600020
********                                                                31700020
TSIN0170 EQU   *                                                        31750020
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  31800020
         BE    TSIN0242                 BRANCH IF NONE                  31900020
         USING TIOCBUF,RTSBFR           USE RTSBFR AS TS BFR BASE REG   32000020
         L     RTSBFR,TSBIBFP-K1        GET FIRST TS BFR ON INPUT QUEUE 32010020
         SPACE 1                                                        32020020
TSIN0190 EQU   *                                                        32030020
         CLC   BUFFHEAD,AVTFZERO        MORE HDR BFRS ON INPUT QUEUE    32040020
         BE    TSIN0210                 BRANCH IF NO MORE               32050020
         L     RTSBFR,BUFFHEAD-K1       GET NEXT HDR BFR ON INPUT QUEUE 32060020
         B     TSIN0190                 CONT SEARCH FOR LAST HDR BFR    32070020
         SPACE 1                                                        32080020
TSIN0210 EQU   *                                                        32090020
         LR    RWK11,RTSBFR             SAVE POINTER TO LAST HDR BFR    32100020
         TM    BUFFFL1,BUFFNLCR         IS HDR MARKED AS COMPL TS MSG   32200020
         BZ    TSIN0230                 BRANCH IF NO                    32230020
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BFR TO MOVE    32260020
         BNZ   TSIN0242                 BRANCH IF YES                   32290020
         TM    BUFFFL2,BUFFFRAG         IS LAST TCAM MSG COMPLETE       32320020
         BZ    TSIN0242                 BRANCH IF YES                   32350020
         SPACE 1                                                        32400020
TSIN0230 EQU   *                                                        32500020
         CLC   BUFFTRLR,AVTFZERO        ANY TRLR BFRS LINKED TO LST BFR 32600020
         BE    TSIN0240                 BRANCH IF NO                    32700020
         L     RTSBFR,BUFFTRLR-K1       GET ADDR OF NEXT TRAILER BFR    32800020
         B     TSIN0230                 CONT SEARCH FOR LAST BFR IN Q   32900020
         SPACE 1                                                        33000020
TSIN0240 EQU   *                                                        33100020
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BFR TO MOVE    33200020
         BZ    TSIN0352                 BRANCH IF NONE                  33300020
         TM    BUFFFL1,BUFFFULL         IS THE LAST BFR IN QUEUE FULL   33400020
         BZ    TSIN0249                 BRANCH IF NO             S22028 33450000
         SPACE 1                                                        33600020
TSIN0242 EQU   *                                                        33700020
         LR    R0,RWRK7                 SAVE CURRENT CHARACTER COUNT    33720020
         BAL   RWK15,TSIN0500           BR TO BFR ALLOCATION ROUTINE    33750020
         SPACE 2                                                 S22028 33750900
********                                                                33751800
******** FOR 3270, IF THIS IS BEGINNING OF A TCAM MSG, MOVE CONTROL     33752700
******** CHARACTERS INTO TS BUFFERS                                     33753600
********                                                                33754500
         TM    TSBSTAT,TSB3270          TEST FOR 3270 TERMINAL   S22028 33755400
         BZ    TSIN0248                 BR AROUND IF NOT         S22028 33756300
         TM    PRFSTAT1,PRFNHDRN        IS THIS FIRST TCAM BFR   S22028 33757200
*                                       OF MSG                   S22028 33758100
         BO    TSIN0248                 BR IF NO                 S22028 33759000
         TM    BUFFFL1,BUFFHDR          IS THIS A TS HDR BFR     S22028 33759900
         BZ    TSIN0248                 BR IF NO                 S22028 33760800
         SR    RWRK7,RWRK7              ZERO R7                 OZ07609 33761700
         USING IEDQLCB,RLCB                                     OZ07609 33762600
         L     RLCB,PRFLCB-K1           LCB ADDRESSABILITY      OZ07609 33763500
         IC    RWRK7,LCBISZE            GET RESERVE NUMBER      OZ07609 33764400
         LA    RWRK7,PRFSHDR(RWRK7)     POINT AT FIRST CHAR.    OZ07609 33765300
         DROP  RLCB                                             OZ07609 33766200
*                                       POINTS AT FIRST CHAR IN BFR     33767100
         SPACE 1                                                 S22028 33768000
TSIN0244 EQU   *                                                 S22028 33768900
         CLI   K0(RWRK7),AVTEZERO       CHECK FOR ZEROS          S22028 33769800
         BNE   TSIN0245                 BRANCH IF NO             S22028 33770700
         LA    RWRK7,K1(R0,RWRK7)       POINT PASS ZERO          S22028 33771600
         B     TSIN0244                 CHECK NEXT BYTE          S22028 33772500
         SPACE 1                                                 S22028 33773400
TSIN0245 EQU   *                                                 S22028 33774300
         LA    RMVSZ2,CC3270ND          ASSUME MSG HAS NO DATA   S22028 33775200
*                                       (ONLY 1 AID CHAR)               33776100
         TM    PRFTIC,CC32706           DOES MSG HAVE MORE THAN  S22028 33777000
*                                       1 CONTROL CHARS                 33777900
         BZ    TSIN0246                 NO, BRANCH AROUND        S22028 33778800
         LA    RMVSZ2,CC3270D3          ASSUME 3 CONTROL CHARS   S22028 33779700
         CLI   CC3270D3(RWRK7),SBA      CHECK FOR SBA CHAR       S22028 33780600
         BNE   TSIN0246                 BRANCH IF NO             S22028 33781500
         LA    RMVSZ2,CC3270D6          THERE ARE 6 CONTROL      S22028 33782400
*                                       CHARS                    S22028 33783300
         SPACE 1                                                 S22028 33784200
TSIN0246 EQU   *                                                 S22028 33785100
         STC   RMVSZ2,BUFFLNTH          UPDATE DATA LENGTH IN    S22028 33786000
*                                       BFR                      S22028 33786900
         BCTR  RMVSZ2,R0                DECREMENT FOR EX         S22028 33787800
*                                       INSTRUCTION              S22028 33788700
         SPACE 1                                                 S22028 33789600
TSIN0247 EQU   *                                                 S22028 33790500
         EX    RMVSZ2,TSIN0345          MOVE 3270 CONTROL CHARS  S22028 33791400
*                                       INTO TS BUFFER                  33792300
         OI    BUFFFL2,BUFF3270         TELL TGET THIS BFR HAS   S22028 33793200
*                                       3270                     S22028 33794100
*                                       CONTROL CHARS                   33795000
         SPACE 1                                                 S22028 33795900
TSIN0248 EQU   *                                                 S22028 33796800
         LTR   RDSZE,RDSZE              ANY DATA IN TCAM BFR TO MOVE    33800020
         BZ    TSIN0352                 BRANCH IF NONE                  33900020
         LR    RWRK7,R0                 RESTORE CURRENT CHARACTER COUNT 33903020
         SPACE 2                                                        33906020
********                                                                33912020
******** IF THERE IS ANY DATA IN THIS TCAM BUFFER WHICH IS REMAINING    33918020
******** FROM A PREVIOUS INCOMPLETE MOVE, THE CURRENT CHARACTER COUNT   33924020
******** IN THE LAST TS HEADER BUFFER REFLECTS THE ACTUAL NUMBER OF     33930020
******** CHARACTERS NOT DELETED.  IF THIS IS THE FIRST ATTEMPT TO MOVE  33936020
******** THE SCANNED DATA, PLACE THE CURRENT CHARACTER COUNT INTO THE   33942020
******** LAST TS HEADER BUFFER ON THE INPUT QUEUE.                      33948020
********                                                                33954020
TSIN0249 EQU   *                                                 S22028 33957000
         TM    PRFTIC,NOTMOVED          ANY UNMOVED DATA IN TCAM BUFFER 33966020
*                                       FROM A PREVIOUS SCAN            33972020
         BO    TSIN0250                 BRANCH IF YES                   33978020
         STH   RWRK7,BUFFWORK-TIOCBUF(R0,RWK11) STORE CHARACTER COUNT   34038020
         SPACE 2                                                        34100020
********                                                                34200020
******** DETERMINE IN WHICH BASIC UNIT OF THE TCAM BUFFER THE DATA TO   34300020
******** BE MOVED BEGINS.                                               34400020
********                                                                34500020
TSIN0250 EQU   *                                                        34600020
         DROP  RTCBFR                   DROP RTCBFR AS TCAM BFR BASE    34700020
         USING IEDQPRF,RWRK4            USE RWRK4 AS TCAM BFR BASE REG  34800020
         LR    RWRK4,RTCBFR             GET ADDR OF FIRST BASIC UNIT    34900020
         SPACE 1                                                        35000020
TSIN0260 EQU   *                                                        35100020
         LH    RWK15,AVTKEYLE           GET BASIC UNIT SIZE             35200020
         SPACE 1                                                        35300020
TSIN0270 EQU   *                                                        35400020
         LA    RMVSZ1,K12(RWK15,RWRK4)  POINT TO END OF THIS BASIC UNIT 35500020
         LA    RWRK4,K0(R0,RWRK4)       CLEAR HI ORDER BYTE OF REGISTER 35600020
         CLR   RSCANF,RWRK4             COULD DATA BEGIN IN THIS B.U.   35700020
         BL    TSIN0280                 BRANCH IF NO TO CONT SEARCH     35800020
         CLR   RSCANF,RMVSZ1            DOES DATA BEGIN IN THIS B.U.    35900020
         BE    TSIN0290                 NO, IT BEGINS IN THE NEXT B.U.  36000020
         BNH   TSIN0300                 BRANCH IF YES                   36100020
         SPACE 1                                                        36200020
TSIN0280 EQU   *                                                        36300020
         L     RWRK4,PRFTIC             GET ADDR OF NEXT BASIC UNIT     36400020
         B     TSIN0270                 CONT SEARCH FOR BEGIN OF MOVE   36500020
         SPACE 1                                                        36600020
TSIN0290 EQU   *                                                        36700020
         L     RWRK4,PRFTIC             GET ADDR OF NEXT BASIC UNIT     36800020
         LA    RSCANF,K12(R0,RWRK4)     RESET BEGIN DATA PTR TO THIS BU 36900020
         LA    RMVSZ1,K12(RWK15,RWRK4)  POINT OT END OF THIS BASIC UNIT 37000020
         SPACE 2                                                        37100020
********                                                                37200020
******** DETERMINE HOW MUCH DATA IS TO BE MOVED AT THIS TIME.  THIS     37300020
******** AMOUNT WILL BE THE SMALLER OF EITHER THE NUMBER OF UNFILLED    37400020
******** BYTES IN THE CURRENT TS BUFFER, OR THE AMOUNT OF UNMOVED DATA  37500020
******** IN THE CURRENT BASIC UNIT.                                     37600020
********                                                                37700020
TSIN0300 EQU   *                                                        37800020
         CLR   RSCANL,RMVSZ1            COULD END OF DATA BE IN THIS BU 37900020
         BH    TSIN0310                 BRANCH IF NO                    38000020
         CLR   RSCANL,RSCANF            IS END OF DATA IN THIS B.U.     38100020
         BNH   TSIN0310                 BRANCH IF NO                    38200020
         LR    RMVSZ1,RSCANL            END OF DATA IS IN THIS B.U.     38300020
         SPACE 1                                                        38400020
TSIN0310 EQU   *                                                        38500020
         SR    RMVSZ1,RSCANF            CALC AMOUNT OF DATA IN THIS BU  38600020
         LR    RFILL,RTSBFR             INIT TS BFR BEGIN DATA MOVE PT  38700020
         SR    RWK15,RWK15              CLEAR REGISTER                  38800020
         IC    RWK15,BUFFOFST           GET HDR OR TRLR OFFSET          38900020
         AR    RFILL,RWK15              ADD OFFSET TO TS BFR ADDRESS    39000020
         IC    RWK15,BUFFLNTH           GET LENGTH OF DATA IN TS BFR    39100020
         AR    RFILL,RWK15              CALC BEGIN ADDR OF NEXT MOVE    39200020
         LH    RMVSZ2,TIOCBFSZ          GET TS BUFFER SIZE              39300020
         AR    RMVSZ2,RTSBFR            POINT TO END OF THIS TS BUFFER  39400020
         SR    RMVSZ2,RFILL             CALC UNFILLED SPACE IN TS BFR   39500020
         CLR   RMVSZ2,RMVSZ1            IS UNFILLED SPACE LESS OR EQUAL 39600020
*                                       TO AMOUNT OF DATA IN TCAM B.U.  39700020
         BNH   TSIN0320                 BRANCH IF YES                   39800020
         LR    RMVSZ2,RMVSZ1            MOVE AMOUNT OF DATA IN B.U.     39900020
         B     TSIN0330                 BRANCH TO CONTINUE MOVE         40000020
         SPACE 1                                                        40100020
TSIN0320 EQU   *                                                        40200020
         OI    BUFFFL1,BUFFFULL         MARK TS BUFFER AS FULL          40300020
         SPACE 2                                                        40400020
********                                                                40500020
******** MOVE DATA FROM THE TCAM BASIC UNIT INTO THE TS BUFFER AND      40600020
******** CALCULATE THE AMOUNT OF UNMOVED DATA LEFT IN THE TCAM BUFFER.  40700020
********                                                                40800020
TSIN0330 EQU   *                                                        40900020
         SR    RDSZE,RMVSZ2             DECR AMOUNT OF DATA IN TCAM BFR 41000020
         AR    RWK15,RMVSZ2             INCR AMOUNT OF DATA IN TS BFR   41100020
         STC   RWK15,BUFFLNTH           STORE UPDATED TS BFR DATA COUNT 41200020
         DROP  RWRK4                    DROP RWRK4 AS TCAM BFR BASE REG 41210020
         USING IEDQPRF,RTCBFR           USE RTCBFR AS TCAM BFR BASE REG 41220020
         LH    RWK15,PRFSRCE            GET OLD DATA OFFSET             41226020
         AR    RWK15,RMVSZ2             UPDATE DATA OFFSET              41240020
         STH   RWK15,PRFSRCE            STORE UPDATED OFFSET            41270020
         BCTR  RMVSZ2,R0                DECR MOVE AMOUNT FOR EXECUTE    41300020
         EX    RMVSZ2,TSIN0340          MOVE DATA INTO TS BUFFER        41400020
         LA    RSCANF,K1(RMVSZ2,RSCANF) INCR TCAM BFR BEGIN DATA PTR    41500020
         SPACE 2                                                        41600020
********                                                                41700020
******** DETERMINE IF ALL THE DATA HAS BEEN MOVED FROM THE TCAM BUFFER  41800020
******** INTO TS BUFFER(S).  IF NOT, DETERMINE IF ANOTHER TS BUFFER IS  41900020
******** NEEDED TO PERFORM THE NEXT MOVE.                               42000020
********                                                                42100020
         CLR   RSCANF,RSCANL            ALL OF SCANED DATA MOVED        42200020
         BE    TSIN0350                 BRANCH IF YES                   42300020
         TM    BUFFFL1,BUFFFULL         IS THE LAST TS BUFFER FULL      42400020
         BZ    TSIN0260                 BRANCH IF NO                    42500020
         OI    PRFTIC,NOTMOVED          IND NOT ALL OF SCANNED DATA     42530020
*                                       MOVED FROM TCAM BUFFER          42560020
         LA    RWK15,TSIN0260           RETURN PT FROM BFR ALLOCATION   42600020
         B     TSIN0500                 BR TO BFR ALLOCATION ROUTINE    42700020
         SPACE 1                                                        42800020
TSIN0340 EQU   *                                                        42900020
         MVC   K0(RMVSZ2,RFILL),K0(RSCANF)  MOVE DATA FR TCAM TO TS BFR 43000020
         SPACE 1                                                 S22028 43020000
TSIN0345 EQU   *                                                 S22028 43040000
         MVC   BUFFHDLN(RMVSZ2,RTSBFR),K0(RWRK7) MOVE 3270       S22028 43060000
*                                       CONTROL CHA              S22028 43080000
         SPACE 2                                                        43100020
********                                                                43200020
******** IF A COMPLETE LINE (ENDS IN CARRIAGE RETURN AND/OR EOT) HAS    43300020
******** BEEN MOVED INTO THE TS BUFFER, MARK THE BUFFER AS FULL AND     43400020
******** INCREMENT THE LINE COUNT IF AUTOMATIC LINE NUMBERING IS IN     43500020
******** PROGRESS.  IF EOT OCCURED, TURN OFF THE FRAGMENT INDICATORS    43600020
******** IN ALL THE HEADER BUFFERS WHICH ARE IN THIS TSBS INPUT QUEUE.  43700020
********                                                                43800020
TSIN0350 EQU   *                                                        43900020
         NI    PRFTIC,OFF-NOTMOVED      IND ALL OF SCANNED DATA MOVED   43950020
         BCTR  RSCANL,R0                BACK UP TO LAST CHAR SCANED     44000020
         LTR   RDSZE,RDSZE              ANY UNMOVED DATA IN TCAM BUFFER 44100020
         BNZ   TSIN0362                 BRANCH IF YES                   44160020
         SPACE 1                                                        44280020
TSIN0352 EQU   *                                                        44340020
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE REGISTER   44420020
         L     RQCB,AVTSAVE2+K64        GET QCB ADDRESS (SAVED  YS02019 44430000
*                                       BY IEDAYI)              YS02019 44440000
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST TCAM BFR OF MSG    44460020
         BO    TSIN0360                 BRANCH IF NO                    44480020
         TM    PRFTIC,WRITEBRK          DID WR BREAK OCCUR IN THIS BFR  44540020
         BO    TSIN0420                 BRANCH IF YES                   44600020
         TM    PRFTIC,TIMEOUT           DID TIMEOUT OCCUR IN THIS BFR   44650020
         BZ    TSIN0370                 BRANCH IF NO                    44700020
         TM    PRFTIC,WAITQBFR          WAS THIS BFR ON THE WAIT QUEUE  44750020
         BO    TSIN0420                 BRANCH IF YES                   44800020
         OI    QCBFLAG,QCBREAD          IND READ STILL HAS PRIORITY     44850020
         SPACE 1                                                        44900020
TSIN0360 EQU   *                                                        45000020
         CLC   PRFSIZE,AVTFZERO         ANY DATA MOVED FROM TCAM BFR    45006020
         BE    TSIN0490                 BRANCH IF NONE                  45012020
         TM    PRFSTAT1,PRFEOFN         WAS SET EOF EXECUTED            45020020
         BO    TSIN0370                 YES, TREAT AS END OF MESSAGE    45040020
         SPACE 1                                                        45060020
TSIN0362 EQU   *                                                        45080020
         CLI   K0(RSCANL),NEWLINE       WAS LAST CHAR SCANNED NEW LINE  45086020
         BE    TSIN0364                 BRANCH IF YES                   45093020
         CLI   K0(RSCANL),CARRRTRN      WAS LAST CHAR SCANED CARR RETRN 45100020
         BNE   TSIN0490                 RETURN TO TSINPUT IF NOT        45120020
         SPACE 2                                                        45140020
********                                                                45160020
******** IF THIS TS MESSAGE IS A NULL LINE (NO DATA OR THE ONLY         45180020
******** CHARACTER IN THE TS BUFFER IS NEW LINE OR CARRIAGE RETURN),    45200020
******** TERMINATE AUTOMATIC PROMPTING.                                 45220020
********                                                                45240020
TSIN0364 EQU   *                                                        45260020
         DROP  RTSBFR                   DROP RTSBFR AS TS BFR BASE REG  45280020
         BAL   RWK15,TSIN9010           CALCULATE ACTUAL DATA    S22028 45290000
*                                       SIZE                     S22028 45300000
         CH    R0,ONE                   IS ONLY CHAR NL OR CR    S22028 45306000
         BH    TSIN0390                 BRANCH IF NO                    45340020
         NI    TSBFLG2,OFF-TSBAUTON     TERMINATE AUTO PROMPTING        45360020
         B     TSIN0390                 CONTINUE                        45380020
         SPACE 1                                                        45400020
TSIN0370 EQU   *                                                        45500020
         BAL   RWK15,TSIN9010           CALCULATE ACTUAL DATA    S22028 45505000
*                                       SIZE                     S22028 45510000
         CH    R0,ONE                   IS DATA LENGTH IN TS BFR S22028 45512000
*                                       1                        S22028 45514000
         BH    TSIN0374                 BR IF MORE THAN ONE CHAR IN BFR 45520020
         BL    TSIN0372                 BR IF NO DATA IN TS BFR         45530020
         LA    RWRK1,BUFFHDLN(RWRK1,RWK11) POINTS AT ONLY DATA   S22028 45535000
*                                       CHAR                     S22028 45540000
         CLI   K0(RWRK1),NEWLINE        IS THE ONLY CHAR IN TS   S22028 45542000
*                                       BFR NL                   S22028 45544000
         BE    TSIN0372                 BRANCH IF YES                   45550020
         CLI   K0(RWRK1),CARRRTRN       IS THE ONLY CHAR IN TS   S22028 45555000
*                                       BFR CR                   S22028 45560000
         BNE   TSIN0374                 BRANCH IF NO                    45570020
         SPACE 1                                                        45580020
TSIN0372 EQU   *                                                        45590020
         NI    TSBFLG2,OFF-TSBAUTON     TERMINATE AUTO PROMPTING        45600020
         SPACE 2                                                        45610020
********                                                                45620020
******** INDICATE THIS TCAM MESSAGE IS COMPLETE.                        45630020
********                                                                45640020
TSIN0374 EQU   *                                                        45650020
         USING TIOCBUF,RWRK4            USE RWRK4 AS TS BFR BASE REG    45700020
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  45800020
         BE    TSIN0392                 BRANCH IF NONE                  45900020
         L     RWRK4,TSBIBFP-K1         GET FIRST TS HDR ON INPUT QUEUE 46000020
         SPACE 1                                                        46100020
TSIN0380 EQU   *                                                        46200020
         NI    BUFFFL2,OFF-BUFFFRAG     TURN OFF MSG FRAG INDR IN BFR   46300020
         L     RWRK4,BUFFHEAD-K1        GET NEXT HDR BFR ON INPUT QUEUE 46400020
         LA    RWRK4,K0(R0,RWRK4)       CLEAR HI-ORDER BYTE OF REG      46500020
         LTR   RWRK4,RWRK4              IS THIS END OF INPUT BFR QUEUE  46600020
         BNZ   TSIN0380                 BRANCH IF NO                    46700020
         TM    K0(RWK11),BUFFNLCR       IS LAST TS MESSAGE COMPLETE     46800020
         BO    TSIN0393                 BRANCH IF YES                   46900020
         SPACE 2                                                        46940020
********                                                                46980020
******** INDICATE THIS TS MESSAGE IS COMPLETE.                          47020020
********                                                                47060020
TSIN0390 EQU   *                                                        47100020
         DROP  RWRK4                    DROP RWRK4 AS TS BFR BASE REG   47200020
         USING TIOCBUF,RTSBFR           USE RTSBFR AS TS BFR BASE REG   47300020
         OI    BUFFFL1,BUFFFULL         MARK LAST TS BFR AS FULL        47400020
         DROP  RTSBFR                   DROP RTSBFR AS TS BFR BASE REG  47460020
         USING TIOCBUF,RWK11            USE RWK11 AS TS BFR BASE REG    47520020
         OI    BUFFFL1,BUFFNLCR         MARK LAST TS MSG AS COMPLETE    47580020
         NI    BUFFFL2,OFF-BUFFPART     TURN OFF PART LINE INDR IF ON   47640020
         NI    TSBFLG2,OFF-TSBBRKIN-TSBBIPI  IND PARTIAL LINE COMPLETE  47670020
         SPACE 2                                                        47700020
********                                                                47800020
******** INCREMENT AUTOMATIC LINE NUMBER                                47900020
********                                                                48000020
         TM    TSBFLG2,TSBAUTON+TSBAULST  IS AUTO LINE NO. IN PROGRESS  48100020
         BNO   TSIN0392                 BRANCH IF NO                    48200020
         L     RWK15,TSBAUTOS           GET CURRENT AUTO LINE NUMBER    48500020
         A     RWK15,TSBAUTOI           ADD INCR VALUE TO AUTO LINE NO. 48600020
         ST    RWK15,TSBAUTOS           STORE UPDATED AUTO LINE NUMBER  48700020
         SPACE 2                                                        48800020
********                                                                48900020
******** WHEN END OF MESSAGE IS DETECTED AND THERE IS NO MORE DATA LEFT 49000020
******** IN THE TCAM BUFFER TO BE MOVED INTO TS BUFFERS, PERFORM THE    49100020
******** FOLLOWING FUNCTIONS.                                           49200020
********                                                                49300020
TSIN0392 EQU   *                                                        49400020
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST TCAM BFR OF MSG    49500020
         BO    TSIN0490                 BRANCH IF NO                    49600020
         LTR   RDSZE,RDSZE              ANY UNMOVED DATA IN TCAM BFR    49700020
         BNZ   TSIN0490                 BRANCH IF YES                   49800020
         SPACE 1                                                        49900020
TSIN0393 EQU   *                                                        50000020
         NI    TSBFLG2,OFF-TSBBIPI-TSBBRKIN  IND PARTIAL LINE COMPLETE  50160020
         NI    QCBTSOF1,OFF-QCBTGET     IND READ NO LONGER HAS PRIORITY 50300020
         SPACE 2                                                        50404020
********                                                                50408020
******** IF THE USER HAS EXCEEDED THE MAXIMUM NUMBER OF TIME SHARING    50412020
******** BUFFERS ALLOWED HIS TERMINAL FOR INPUT, PLACE HIM IN LWAIT.    50416020
******** IF THE AMOUNT OF TIME SHARING BUFFERS ON THE FREE QUEUE HAS    50420020
******** FALLEN BELOW THE RESERVE MINIMUM, PLACE THE SYSTEM IN LWAIT.   50424020
******** IN EITHER CASE, LOCK THE USERS KEYBOARD TO FURTHER INPUT.      50428020
********                                                                50432020
         CLC   TSBNIBF,TIOCAIMX+K1      MAX NO. OF INPUT BFRS EXCEEDED  50436020
         BL    TSIN0394                 BRANCH IF NO                    50440020
         OI    TSBSTAT,TSBLWAIT         PLACE USER IN LWAIT             50444020
         OI    QCBTSOF1,QCBNOBUF        LOCK USERS KEYBOARD TO INPUT    50448020
         SPACE 1                                                        50452020
TSIN0394 EQU   *                                                        50456020
         CLC   TIOCNFBF,AVTFZERO        ANY TS BFRS ON FREE QUEUE       50460020
         BE    TSIN0395                 BRANCH IF NONE                  50464020
         CLC   TIOCNFBF,TIOCUSLW        NO. FREE BFRS BELOW MINIMUM     50468020
         BNL   TSIN0396                 BRANCH IF NO                    50472020
         SPACE 1                                                        50476020
TSIN0395 EQU   *                                                        50480020
         OI    TIOCFLG,TIOCSYLW         PLACE THE SYSTEM IN LWAIT       50484020
         OI    QCBTSOF1,QCBNOBUF        LOCK USERS KEYBOARD TO INPUT    50488020
         SPACE 1                                                        50988020
TSIN0396 EQU   *                                                        51488020
         CLI   TSBNIBF,AVTEZERO         ANY TS BFRS ON THE INPUT QUEUE  51988020
         BE    TSIN0410                 BRANCH IF NONE                  52488020
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY SCREEN        52538020
         BZ    TSIN0398                 BRANCH IF NO                    52588020
         SR    R0,R0                    CLEAR REGISTER                  52638020
         SR    RWRK1,RWRK1              CLEAR REGISTER                  52688020
         IC    R0,QCBSATCT              GET NO. OF LINES ENTERED        52738020
         IC    RWRK1,TSBLNNO            GET NO. OF LINES ON SCREEN (N)  52788020
         BCTR  RWRK1,R0                 DECR BY 1 NO. OF SCREEN LINES   52838020
         CLR   R0,RWRK1                 IS NO. OF LINES ENTERED LESS    52888020
*                                       THAN (N-1)                      52938020
         BL    TSIN0398                 BRANCH IF YES                   52948020
         MVI   QCBSATCT,AVTEZERO        RESET NO. LINES ENTERED TO ZERO 52958020
         BH    TSIN0397                 BR IF LINES ENTERED IS GT (N-1) 52968020
         MVI   QCBSATCT,CLRSCREN        INDICATE SCREEN MUST BE CLEARED 52978020
         SPACE 1                                                        52988020
TSIN0397 EQU   *                                                        52998020
         BAL   RWK15,TSIN9010           CALCULATE ACTUAL DATA    S22028 53003000
*                                       SIZE                     S22028 53008000
         CH    R0,ONE                   IS DATA LENGTH IN TS BFR S22028 53010000
*                                       1                        S22028 53012000
         BH    FLASHBAK                 BR IF MORE THAT ONE CHAR IN BFR 53018020
         BL    TSIN0398                 IF NO DATA, DON'T FLASH BACK    53028020
         LA    RWRK1,BUFFHDLN(RWRK1,RWK11) POINTS AT ONLY DATA   S22028 53033000
*                                       CHAR                     S22028 53038000
         CLI   K0(RWRK1),NEWLINE        IS ONLY CHAR IN BFR NEW  S22028 53040000
*                                       LINE                     S22028 53042000
         BE    TSIN0398                 IF CHAR IS NL, DON'T FLASH BACK 53048020
         SPACE 1                                                        53058020
FLASHBAK EQU   *                                                        53068020
*  TEST IF LINE SHOULD BE FLASHED BACK                         @ZA02244 53073000
         TM    TSBFLG3,TSBNFLOP         FLAG ON                @ZA02244 53078000
         BO    TSIN0398                 YES                    @ZA02244 53083000
         OI    BUFFFL2,BUFFPART         MARK TS BFR FOR FLASH BACK      53088020
         OI    TSBFLG2,TSBBRKIN         TELL TSOUTPUT TO FLASH BACK     53138020
         B     TSIN0440                 GO TO CHK IF ANY OUTPUT IN PROG 53188020
         SPACE 2                                                        53300020
********                                                                53400020
******** IF THE USER IS IN IWAIT, CALL THE IKJGGQIO ROUTINE             53700021
******** IN IEDAYOO TO REMOVE IWAIT.                                    54000021
********                                                                54300020
TSIN0398 EQU   *                                                        54400020
         TM    TSBFLG4,TSBIWAIT         IS USER IN IWAIT        YS02019 54450000
         BZ    TSIN0410                 BRANCH IF NO                    54800020
         STM   RTSBFR,RETRN,TIOCSAVE    SAVE REG.S 5-14 ACROSS   S21008 55100021
*                                       CALL                     S21008 55400021
         LA    RWRK8,AVTEZERO(,RTSB)    LD TSB ADDR & CLEAR BYTE S21008 56000021
*                                       0                        S21008 56300021
         IC    RWK11,TSBFLG2            SAVE TSBBIPI SETTING     S21008 56600021
         OI    TSBFLG2,TSBBIPI          REQUEST IWAIT REMOVAL    S21008 56900021
         L     RNTRY,QIOEPA             GET REMOVAL RTN'S EPA    S21008 57200021
         L     RBASE,QIOBASE            GET REMOVAL RTN'S BASE   S21008 57500021
*                                       ADDR                     S21008 57800021
         BALR  RWRK4,RNTRY              GO REMOVE IWAIT          S21008 58100021
         STC   RWK11,TSBFLG2            RESTORE TSBBIPI SETTING  S21008 58400021
         LM    RTSBFR,RETRN,TIOCSAVE    RESTORE REGISTERS        S21008 58700021
         SPACE 2                                                        60004020
********                                                                60008020
******** IF AUTOMATIC PROMPTING IS IN PROGRESS, TELL TCAM OR TSOUTPUT   60011020
******** TO PROMPT THE USER WITH THE PROMPT CHARACTER OR THE NEXT LINE  60014020
******** NUMBER.                                                        60017020
********                                                                60020020
TSIN0410 EQU   *                                                        60024020
         TM    TSBFLG2,TSBAUTON         IS AUTO PROMPTING IN PROGRESS   60029020
         BNO   TSIN0490                 BRANCH IF NO                    60034020
         TM    PRFSRCE,WAITQBFR         WAS THIS BFR ON WAIT QUEUE      60044020
         BZ    TSIN0412                 BRANCH IF NO                    60048020
         OI    TSBFLG2,TSBSTAUT         TELL TSOUTPUT TO PROMPT USER    60049020
         B     TSIN0440                 BRANCH TO POST TSOUTPUT         60052020
         SPACE 1                                                        60056020
TSIN0412 EQU   *                                                        60060020
         USING IEDQLCB,RWRK2            USE RWRK2 AS LCB BASE REG       60064020
         L     RWRK2,PRFLCB-K1          GET LCB ADDRESS                 60068020
         L     RWRK2,LCBSCBA-K1         GET SCB ADDRESS                 60072020
         DROP  RWRK2                    DROP RWRK2 AS LCB BASE REG      60076020
         USING IEDQSCB,RWRK2            USE RWRK2 AS SCB BASE REG       60080020
         OI    SCBERR2,SCBALN           TELL TCAM TO PROMPT THE USER    60084020
         B     TSIN0490                 BRANCH TO RETURN TO TSINPUT     60088020
         DROP  RWRK2                    DROP RWRK2 AS SCB BASE REG      60092020
         SPACE 2                                                        60100020
********                                                                60200020
******** IF A PARTIAL LINE CAUSED BY BREAK-IN EXISTS, MARK THE LAST TS  60300020
******** HEADER BUFFER ON THE INPUT QUEUE AS A PARTIAL LINE.  ALSO      60400020
******** DETERMINE IF THE PARTIAL LINE CAN BE PROCESSED BY TSOUTPUT AT  60500020
******** THIS TIME.                                                     60600020
********                                                                60700020
TSIN0420 EQU   *                                                        60800020
         CLC   PRFSIZE,AVTFZERO         ANY DATA MOVED FROM TCAM BFR    60803020
         BNE   TSIN0430                 BRANCH IF YES                   60806020
         TM    BUFFFL1,BUFFNLCR         WAS LAST CHAR MOVED NL OR CR    60809020
         BO    TSIN0370                 BRANCH IF YES - NO PARTIAL LINE 60812020
         B     TSIN0434                 BR TO INDICATE A PARTIAL LINE   60815020
         SPACE 1                                                        60818020
TSIN0430 EQU   *                                                        60821020
         CLI   K0(RSCANL),NEWLINE       WAS LAST CHAR SCANNED NEW LINE  60830020
         BE    TSIN0370                 BRANCH IF YES - NO PARTIAL LINE 60860020
         CLI   K0(RSCANL),CARRRTRN      WAS LAST CHAR SCANED CARR RETRN 60900020
         BE    TSIN0370                 BRANCH IF YES - NO PARTIAL LINE 61000020
         SPACE 1                                                        61100020
TSIN0434 EQU   *                                                        61200020
         OI    TSBFLG2,TSBBRKIN         IND PARTL LINE DUE TO BREAK-IN  61300020
         OI    BUFFFL2,BUFFPART          IND PART LINE IN BUFF @ZA08015 61700000
         NI    QCBTSOF1,OFF-QCBNOBUF    TURN OFF TCAM NO BFRS INDICATOR 62200020
         DROP  RWK11                    DROP RWK11 AS TS BFR BASE REG   62600020
         SPACE 1                                                        63040020
TSIN0440 EQU   *                                                        63080020
         TM    QCBTSOF1,QCBTPUT+QCBPARTO  ANY OUTPUT IN PROGRESS        63120020
         BNZ   TSIN0490                 BRANCH IF YES                   63160020
         OI    QCBTSOF1,QCBTPUT         REQUEST A TPUT OPERATION        63180020
         TM    QCBTSOF1,QCBDELAY        IS THIS QCB ON THE DELAY QUEUE  63200020
         BZ    TSIN0450                 BRANCH IF NO                    63240020
         SPACE 2                                                        63300020
********                                                                63400020
******** QPOST THE DELAY QUEUE QCB TO ITSELF TO REMOVE THE TERMINAL     63460020
******** DESTINATION QCB FROM THE DELAY QUEUE.                          63520020
********                                                                63600020
         DROP  RQCB                     DROP RQCB AS QCB BASE REGISTER  63620020
         L     RQCB,AVTTSOPT            GET ADDR OF TSINPUT'S QCB       63640020
         USING IEDQTSI,RQCB             USE RQCB AS TSINPUT'S QCB BASE  63660020
         TM    TSIDYQFG,TSIDYPOS        HAS DELAY QUEUE QCB BEEN POSTED 63680020
         BO    TSIN0490                 BR IF YES, NOTHING MORE TO DO   63700020
         OI    TSIDYQFG,TSIDYPOS        IND DELAY QUEUE QCB IS POSTED   63720020
         LA    RQCB,TSIDYQFG            PT TO DELAY QUEUE QCB           63740020
         B     TSIN0470                 BR TO POST DELAY QUEUE QCB      63760020
         DROP  RQCB                     DROP RQCB AS TSINPUT'S QCB BASE 63780020
         SPACE 2                                                        63800020
********                                                                63900020
******** QPOST THE TERMINAL QCB TO ITSELF TO ACTIVATE A SEND            64000020
******** OPERATION FOR THIS TERMINAL.                                   64100020
********                                                                64200020
TSIN0450 EQU   *                                                        64300020
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE REGISTER   64320020
         TM    QCBTSOF2,QCBPOSTO        IS QCB POSTED TO ITSELF         64326020
         BO    TSIN0490                 BRANCH IF YES                   64332020
         OI    QCBTSOF2,QCBPOSTO        IND QCB IS POSTED TO ITSELF     64340020
         MVI   QCBPRI,PRIDESTQ          SET QCB PRIORITY                64360020
         SPACE 2                                                        64380020
********                                                                64400020
******** THIS IS A COMMON ROUTINE USED TO QPOST A QCB TO ITSELF AND     64420020
******** ADD THAT QCB TO THE QUEUE OF ELEMENTS BEING PASSED TO THE TCAM 64440020
******** DISPATCHER FOR POSTING.                                        64460020
********                                                                64480020
TSIN0470 EQU   *                                                        64500020
         IC    RWRK2,QCBELCHN-K1        SAVE FLAG BYTE                  64520020
         ST    RQCB,QCBELCHN-K1         QPOST QCB TO ITSELF             64540020
         STC   RWRK2,QCBELCHN-K1        RESTORE FLAG BYTE               64560020
         MVC   QCBLINK,AVTDOUBL+K1      CHAIN FIRST ELEMENT ALREADY IN  64600020
*                                       QUEUE TO THIS QCB               64700020
         ST    RQCB,AVTDOUBL            CHAIN QCB TO RETURN QUEUE       64800020
         SPACE 2                                                        65100020
********                                                                65200020
******** STORE UPDATED DATA SIZE IN TCAM BUFFER AND RETURN TO TSINPUT   65300020
********                                                                65400020
TSIN0490 EQU   *                                                        65500020
         SR    RTIOC,RTIOC              SET RETURN CODE EQUAL TO ZERO   65600020
         SPACE 1                                                        65700020
TSIN0492 EQU   *                                                        65800020
         SLL   RWK11,K8                 LEFT ADJ LAST TS HDR BFR ADDR   65900020
         SRDL  RTIOC,K8                 ADJ RETURN CODE AND BUFFER ADDR 66000020
         LR    RTRNCD,RWK11             RETRN CODE AND LAST TS HDR ADDR 66100020
         STH   RDSZE,PRFSIZE            STORE UPDATED COUNT IN TCAM BFR 66200020
         BR    RETRN                    RETURN TO TSINPUT               66300020
         SPACE 2                                                        66304020
         SPACE 2                                                        66400020
********                                                                66500020
******** THE FOLLOWING SUBROUTINE OBTAINS A FREE TS BUFFER, IF ANY ARE  66600020
******** AVAILABLE, AND BUILDS A HEADER OR TRAILER BUFFER DEPENDING ON  66700020
******** WHICH IS REQUIRED.  THE BUFFER IS THEN CHAINED TO THE LAST     66800020
******** HEADER OR TRAILER AS REQUIRED.                                 66900020
********                                                                67000020
TSIN0500 EQU   *                                                        67100020
         NC    TIOCNFBF,TIOCNFBF        ANY FREE TS BUFFERS             67200020
         BNZ   TSIN0510                 BRANCH IF YES                   67300020
         LA    RTIOC,K4                 RETURN CODE FOR NO FREE TS BFRS 67400020
         B     TSIN0492                 BRANCH TO RETURN TO TSINPUT     67500020
         SPACE 1                                                        67600020
TSIN0510 EQU   *                                                        67700020
         SR    RWRK7,RWRK7              CLEAR REGISTER          ZA01370 67707000
         IC    RWRK7,TSBNIBF            # OF INPT BFRS ON QUEUE ZA01370 67714000
         CH    RWRK7,TIOCAIMX           MAX ALREADY ASSIGNED?   ZA01370 67721000
         BL    ALLOC                    NO, CONTINUE TO GET BFR ZA01370 67728000
         USING TIOCBUF,RWRK7            USE RWRK7 AS BFR BASE   ZA01370 67735000
         L     RWRK7,TSBIBFP-K1         GET @ OF 1ST INPUT BFR  ZA01370 67742000
         TM    BUFFFL2,BUFFFRAG         DO WE ONLY HAVE FRAGS?  ZA01370 67749000
         BNO   ALLOC                    NO, LET USER HAVE BFR   ZA01370 67756000
         OI    PRFSTAT1,PRFCNCLN        CANCEL THIS MESSAGE     ZA01370 67763000
         B     TSIN0490                 RETURN TO TCAM          ZA01370 67770000
ALLOC    STM   RWK15,RWRK2,AVTSAVE2+K44 SAVE REGISTERS          ZA01370 67777000
         L     RNTRY,QBAADDR            GET BFR ALLOCATION RTN  YS02019 67784000
*                                       ENTRY ADDRESS           YS02019 67800000
         BALR  R0,RNTRY                 GO TO OBTAIN A BFR      YS02019 67900000
         LR    RWRK7,RWRK2              BFR ADDR RETURNED IN    YS02019 68000000
         LM    RWK15,RWRK2,AVTSAVE2+K44 RESTORE REG.S           YS02019 68100000
         XC    BUFFFL1(BUFFHDLN),BUFFFL1  CLEAR PREFIX OF NEW BUFFER    68700020
         CLC   TSBIBFP,AVTFZERO         ANY TS BFRS ON INPUT HDR QUEUE  68800020
         BE    TSIN0530                 BRANCH IF NONE                  68900020
         DROP  RWRK7                    DROP RWRK7 AS TS BFR BASE REG   69000020
         USING TIOCBUF,RTSBFR           TS BFR ADDRESSABILITY   YS02019 69050000
         TM    BUFFFL1,BUFFHDR          IS LAST BFR POINTED TO A HDR    69200020
         BZ    TSIN0520                 BR IF NO TO BUILD A TRAILER BFR 69300020
         TM    BUFFFL1,BUFFNLCR         DOES HDR CONTAIN CARRIAGE RETRN 69400020
         BO    TSIN0540                 BR IF YES TO BUILD A HDR BFR    69500020
         SPACE 2                                                        69600020
********                                                                69700020
******** BUILD A TRAILER BUFFER AND CHAIN IT TO THE LAST BUFFER ON THE  69800020
******** INPUT QUEUE                                                    69900020
********                                                                70000020
TSIN0520 EQU   *                                                        70100020
         O     RWRK7,BUFFFL1            RESTORE FLAGS TO BFR ADDR       70200020
         ST    RWRK7,BUFFFL1            CHAIN NEW TRLR BFR TO LAST BFR  70300020
         DROP  RTSBFR                   DROP RTSBFR AS TS BFR BASE REG  70400020
         USING TIOCBUF,RWRK7            USE RWRK7 AS TS BFR BASE REG    70500020
         MVI   BUFFOFST,BUFFTRLN        OFFSET TO BEGIN DATA IN TRLR    70600020
         B     TSIN0560                 BR TO UPDATE INPUT BFR COUNT    70700020
         SPACE 2                                                        70800020
********                                                                70900020
******** BUILD A HEADER BUFFER AND CHAIN IT TO THE LAST HEADER BUFFER   71000020
******** IN THE INPUT QUEUE OR TO THE QUEUE ITSELF IF THE QUEUE IS      71100020
******** EMPTY                                                          71200020
********                                                                71300020
TSIN0530 EQU   *                                                        71400020
         O     RWRK7,TSBNIBF            RESTORE NO. BFRS TO BFR ADDR    71500020
         ST    RWRK7,TSBNIBF            CHAIN NEW HDR BFR TO QUEUE      71600020
         B     TSIN0550                 BR TO BUILD A HDR BFR           71700020
         SPACE 1                                                        71800020
TSIN0540 EQU   *                                                        71900020
         DROP  RWRK7                    DROP RWRK7 AS TS BFR BASE REG   72000020
         USING TIOCBUF,RTSBFR           USE RTSBFR AS TS BFR BASE REG   72100020
         O     RWRK7,BUFFFL2            RESTORE FLAGS TO BFR ADDR       72200020
         ST    RWRK7,BUFFFL2            CHAIN NEW HDR BFR TO LAST HDR   72300020
         DROP  RTSBFR                   DROP RTSBFR AS TS BFR BASE REG  72400020
         USING TIOCBUF,RWRK7            USE RWRK7 AS TS BFR BASE REG    72500020
         SPACE 1                                                        72600020
TSIN0550 EQU   *                                                        72700020
         OI    BUFFFL1,BUFFHDR          IND THIS IS A HEADER BFR        72800020
         OI    BUFFFL2,BUFFFRAG         IND THIS BFR CONTAINS FRAG MSG  72900020
         MVI   BUFFOFST,BUFFHDLN        OFFSET TO BEGIN DATA IN HDR BFR 73000020
         LR    RWK11,RWRK7              UPDATE LAST HEADER POINTER      73100020
         DROP  RWRK7                    DROP RWRK7 AS TS BFR BASE REG   73200020
         SPACE 2                                                        73300020
********                                                                73400020
******** UPDATE INPUT QUEUE BUFFER COUNT AND RETURN TO CALLER           73500020
********                                                                73600020
TSIN0560 EQU   *                                                        73700020
         SR    RWRK1,RWRK1              CLEAR REGISTER                  73800020
         IC    RWRK1,TSBNIBF            GET NO. OF BFRS ON INPUT QUEUE  73900020
         LA    RWRK1,K1(R0,RWRK1)       INCR NO. OF BFRS ON INPUT QUEUE 74000020
         STC   RWRK1,TSBNIBF            ST UPDATED BFR COUNT            74100020
         LR    RTSBFR,RWRK7             POINT TO NEXT BFR TO BE FILLED  74200020
         BR    RWK15                    RETURN TO CALLING ROUTINE       74300020
         DROP  RAVT,RTCBFR,RTIOC        DROP CONTROL BLOCK BASE  S22028 74350000
*                                       REGS                     S22028 74700000
         SPACE 3                                                 S22028 74700300
********                                                                74700600
******** FOR 3270 THERE WILL BE CONTROL CHARACTERS RANGING FROM 1 TO    74700900
******** 6 BYTES IN LENGTH. SUBTRACT THIS LENGTH FROM DATA SIZE TO      74701200
******** GET THE ACTUAL DATA LENGTH.                                    74701500
********                                                                74701800
TSIN9010 EQU   *                                                 S22028 74702100
         USING TIOCBUF,RWK11            USE RWK11 AS TS BFR BASE S22028 74702400
*                                       REG                      S22028 74702700
         SR    R0,R0                    CLEAR LENGTH REGISTER   SA59536 74703000
         SR    RWRK1,RWRK1              CLEAR OFFSET REGISTER   SA59536 74704000
         IC    R0,BUFFLNTH              GET DATA LENGTH          S22028 74708000
         TM    TSBSTAT,TSB3270          TEST FOR 3270            S22028 74724000
         BZ    TSIN9050                 BRANCH IF NOT            S22028 74728000
         CH    R0,CC3270L               IS DATA LENGTH LESS THAN S22028 74729000
*                                       3                        S22028 74732000
         BNL   TSIN9020                 BRANCH IF NO             S22028 74736000
         BCTR  R0,R0                    SUBTRACT 1 FROM DATA     S22028 74740000
*                                       SIZE                     S22028 74744000
         LA    RWRK1,K1                 REMEMBER OFFSET          S22028 74748000
         B     TSIN9050                 GO BACK                  S22028 74752000
         SPACE 1                                                 S22028 74756000
TSIN9020 EQU   *                                                 S22028 74760000
         SH    R0,CC3270L               SUBTRACT 3 FROM DATA     S22028 74764000
*                                       SIZE                     S22028 74768000
         LA    RWRK1,K3                 REMEMBER OFFSET          S22028 74772000
         CLI   BUFFHDLN+K3(RWK11),SBA   IS FOURTH CHAR SBA       S22028 74776000
         BNE   TSIN9050                 BRANCH IF NOT            S22028 74780000
         SH    R0,CC3270L               SUBTRACT 3 MORE FROM     S22028 74784000
*                                       DATA SIZE                S22028 74788000
         LA    RWRK1,K3(R0,RWRK1)       REMEMBER OFFSET          S22028 74792000
         SPACE 1                                                 S22028 74796000
TSIN9050 EQU   *                                                 S22028 74800000
         BR    RWK15                    RETURN TO CHECK DATA     S22028 74804000
*                                       LENGTH                   S22028 74808000
         DROP  RTSB,RWK11               DROP BASE REGS           S22028 74812000
         EJECT                                                          74816000
*********************************************************************** 74820000
********                                                       ******** 74824000
******** THE FOLLOWING SECTION CODE IS USED BY THE LOGOFF AND  ******** 74828000
******** HANGUP ROUTINES (IEDAYOO AND IEDAYHH) TO REMOVE THE   ******** 74832000
******** USERS TERMINAL FROM THE SYSTEM LWAIT CONDITION AND    ******** 74836000
******** RETURN ANY TCAM BUFFERS WHICH ARE ASSOCIATED WITH     ******** 74840000
******** THIS TERMINAL AND ARE ON THE TCAM BUFFER WAIT QUEUE.  ******** 74844000
******** THE ENTRY POINT INTO THIS CODE IS QTIP0280.           ******** 74848000
********                                                       ******** 74852000
******** INPUT REGISTERS -                                     ******** 74856000
********                                                       ******** 74860000
********       REG 7 -  ADDR OF THE TERMINAL DESTINATION QCB.  ******** 74864000
********       REG 9 -  ADDRESS OF THE CURRENT TSB.            ******** 74868000
********       REG 13 - ADDRESS OF AVTSAVE2.                   ******** 74872000
********                                                       ******** 74876000
*********************************************************************** 74880000
QTIP0280 EQU   *                                                        74884000
         USING IEDQQCB,RQCB             USE RQCB AS TERM QCB BASE REG   74885000
         USING TSB,RTSB                 USE RTSB AS TSB BASE REGISTER   74888000
         USING AVTSAVE2,RAVT            USE RAVT AS AVT BASE REGISTER   74892000
         TM    QCBTSOF2,QCBBUFQ         HOLDING TCAM BFRS FOR THIS TERM 74896000
         BCR   ZEROS,RETRN              RETURN TO CALLER IF NOT         74900000
         L     RWK15,CVTPTR             GET CVT ADDRESS                 74904000
         L     RWK15,CVTAQAVT-CVT(R0,RWK15)    GET TCX ADDR     YS02019 74908000
         L     RWK15,TCXRPT-IEDQTCX(,RWK15)    GET TIOCRPT ADDR YS02019 74912000
         USING TIOCRPT,RWK15            USE RWK15 AS TIOCRPT BASE REG   74916000
         STM   RWRK1,RWRK3,TIOCSAVE     SAVE CALLER'S REGISTERS 1-3     74920000
         STM   RTCBFR,RETRN,TIOCSAVE+K12  SAVE CALLER'S REGISTERS 6-14  74924000
         LA    RTSB,K0(R0,RTSB)         CLEAR HI-ORDER BYTE OF REG      74928000
         USING IEDQTSI,RWRK8            USE RWRK8 AS TSINPUT'S QCB BASE 74932000
         L     RWRK8,AVTTSOPT           GET ADDR OF TSINPUT'S QCB       74936000
         LA    RWRK8,TSIBUFQ            GET ADDR OF TCAM BFR WAIT QUEUE 74940000
         DROP  RWRK8                    DROP RWRK8 AS TSINPUT QCB BASE  74944000
         SPACE 2                                                        74948000
********                                                                74952000
******** REMOVE ALL TCAM BUFFERS FROM THE BUFFER WAIT QUEUE WHICH ARE   74956000
******** ASSOCIATED WITH THIS TERMINAL AND RETURN THEM TO TCAM.         74960000
********                                                                74964000
TSIN7000 EQU   *                                                        74968000
         USING IEDQPRF,RTCBFR           USE RTCBFR AS TCAM BFR BASE REG 74972000
         L     RTCBFR,K0(R0,RWRK8)      GET NEXT TCAM BFR ON WAIT QUEUE 74976000
         LA    RTCBFR,K0(R0,RTCBFR)     CLEAR HI-ORDER BYTE OF REGISTER 74980000
         LTR   RTCBFR,RTCBFR            ANY MORE TCAM BFR ON WAIT QUEUE 74984000
         BZ    TSIN7050                 RETURN TO CALLER IF NOT         74988000
         L     RWRK2,PRFQCBA-K1         GET TSB ASSOCIATED WITH BFR     74992000
         LA    RWRK2,K0(R0,RWRK2)       CLEAR HI-ORDER BYTE OF REGISTER 74996000
         CR    RTSB,RWRK2               DOES BFR BELONG TO CURRENT TSB  75000000
         BE    TSIN7030                 BRANCH IF YES TO RETURN BUFFER  75004000
         LA    RWRK8,PRFLINK-K1         PT TO ADDR OF NEXT BFR ON QUEUE 75008000
         B     TSIN7000                 BR TO CONT SCAN OF WAIT QUEUE   75012000
         SPACE 2                                                        75016000
********                                                                75020000
******** TPOST TCAM BUFFER TO THE BUFFER RETURN QCB VIA THE TCAM        75022000
******** DISPATCHER.                                                    75028000
********                                                                75030000
TSIN7030 EQU   *                                                        75036000
         MVC   K1(K3,RWRK8),PRFLINK     REMOVE BFR FROM WAIT QUEUE      75038000
         XC    PRFLINK,PRFLINK          CLEAR LINK FIELD OF BFR         75040000
         LA    RWRK3,AVTBFRTB           GET ADDR OF BFR RETURN QCB      75044000
         ST    RWRK3,PRFQCBA-K1         TPOST BFR TO BFR RETURN QCB     75046000
         MVI   PRFPRI,PRIBFRTB          GIVE PRIORITY                   75052000
         USING IEDQDISP,RWK11           RWK11 AS TCAM DISP BASE         75054000
         L     RWK11,AVTEA              ADDR OF TCAM DISPATCHER         75060000
         LR    RWK1,RTCBFR              TCAM BFR TO BE RETU    @ZA03667 75062000
         BAL   RETRN,DSPPOSTR           RETURN BFR VIA TCAM             75068000
         B     TSIN7000                 BR TO CONT SCAN OF WAIT QUEUE   75070000
         SPACE 2                                                        75076000
********                                                                75078000
******** INDICATE ALL TCAM BUFFERS HAVE BEEN REMOVED FROM THE BUFFER    75084000
******** WAIT QUEUE WHICH ARE ASSOCIATED WITH THE CURRENT TSB, AND      75087000
******** RETURN TO THE CALLER.                                          75090000
********                                                                75093000
TSIN7050 EQU   *                                                        75100000
         NI    QCBTSOF2,OFF-QCBBUFQ     NO MORE BFRS IN Q FOR THIS TSB  75104000
         LM    RWRK1,RWRK3,TIOCSAVE     RESTORE CALLER'S REGISTERS 1-3  75108000
         LM    RTCBFR,RETRN,TIOCSAVE+K12  RESTORE CALLER'S REGS 6-14    75112000
         BR    RETRN                    RETURN TO CALLER                75116000
         DROP  RTCBFR,RQCB,RTSB,RAVT,RWK15  DROP CONTROL BLK BASE REGS  75120000
         SPACE 2                                                 S21008 75124000
**********************************************************************  75128000
********                                                                75132000
******** CONSTANTS                                                      75136000
********                                                                75140000
**********************************************************************  75144000
QIOEPA   DC    V(IEDAYQIO)              IWAIT REMOVAL RTN'S EPA YS02019 75148000
QIOBASE  DC    V(QTIP0110)              IWAIT REMOVAL RTN'S BASE S21008 75152000
ONE      DC    H'1'                     USED TO DETERMINE DATA   S22028 75156000
*                                       SIZE                     S22028 75160000
CC3270L  DC    H'3'                     USED TO SKIP 3270        S22028 75164000
*                                       CONTROL CHAR             S22028 75168000
QBAADDR  DC    V(IEDAYQBA)              BFR ALLOCATION RTN EPA  YS02019 75172000
QBRADDR  DC    V(IEDAYQBR)              ADDR OF BFR RETURN RTN  YS02019 75176000
TPPRI    DC    AL1(PRIBFRTB)            TPOST PRIORITY                  75180000
PATCH    DC    10F'0'                   PATCH AREA FOR IEDAYII  ZA01370 75184000
         SPACE 1                                                        75188000
         EJECT                                                          75200020
*********************************************************************** 75300020
********                                                       ******** 75400020
******** DSECTS                                                ******** 75500020
********                                                       ******** 75600020
*********************************************************************** 75700020
         SPACE 1                                                        75800020
********                                                                75900020
******** AVT - ADDRESS VECTOR TABLE                                     76000020
********                                                                76100020
         SPACE 1                                                        76200020
         TAVTD                                                          76300020
         EJECT                                                          76400020
********                                                                76500020
******** TIOCBUF - TIOC BUFFER FORMAT                                   76600020
********                                                                76700020
         SPACE 1                                                        76800020
         IKJTIOCB                                                       76900020
         EJECT                                                          77000020
********                                                                77100020
******** CVT - COMMUNICATIONS VECTOR TABLE                              77200020
********                                                                77300020
         SPACE 1                                                        77400020
CVT      DSECT                                                          77500020
         CVT                                                            77600020
         EJECT                                                          77700020
********                                                                77707020
******** DCB - DATA CONTROL BLOCK                                       77714020
********                                                                77721020
         SPACE 1                                                        77728020
         DCBD  DSORG=TX                                                 77735020
         EJECT                                                          77742020
********                                                                77749020
******** TCAM DISPATCHER                                                77756020
********                                                                77763020
         SPACE 1                                                        77770020
         TDISPD                                                         77777020
         EJECT                                                          77784020
********                                                                77800020
******** LCB - LINE CONTROL BLOCK                                       77900020
********                                                                78000020
         SPACE 1                                                        78100020
         TLCBD                                                          78200020
         EJECT                                                          78300020
********                                                                78400020
******** TCAM BUFFER PREFIX                                             78500020
********                                                                78600020
         SPACE 1                                                        78700020
         TPRFD                                                          78800020
         EJECT                                                          78900020
********                                                                79000020
******** TCAM BUFFER PRIORITIES                                         79100020
********                                                                79200020
         SPACE 1                                                        79300020
         TPRIOR                                                         79400020
         EJECT                                                          79500020
********                                                                79600020
******** QCB - DESTINATION QUEUE ELEMENT CONTROL BLOCK                  79700020
********                                                                79800020
         SPACE 1                                                        79900020
         TQCBD                                                          80000020
         EJECT                                                          80100020
********                                                                80200020
******** SCB - STATION CONTROL BLOCK                                    80300020
********                                                                80400020
         SPACE 1                                                        80500020
         TSCBD                                                          80600020
         EJECT                                                          80700020
********                                                                80800020
******** TCB - TASK CONTROL BLOCK                                       80900020
********                                                                81000020
         SPACE 1                                                        81100020
         IKJTCB                                                         81200020
         EJECT                                                          81230000
         TTCXD                                                  YS02019 81260000
         EJECT                                                          81300020
********                                                                81400020
******** TIOCRPT - TIOC REFERENCE POINTER TABLE                         81500020
********                                                                81600020
         SPACE 1                                                        81700020
         IKJTIOCP                                                       81800020
         EJECT                                                          81900020
********                                                                83200020
******** TERMINAL ENTRY TABLE                                           83300020
********                                                                83400020
         SPACE 1                                                        83500020
         TTRMD                                                          83600020
         EJECT                                                          83700020
********                                                                83800020
******** TSB - TERMINAL STATUS BLOCK                                    83900020
********                                                                84000020
         SPACE 1                                                        84100020
         IKJTSB                                                         84200020
         EJECT                                                          84300020
********                                                                85000020
******** DESTINATION QCB FOR TSINPUT                                    85100020
********                                                                85200020
         SPACE 1                                                        85300020
         TTSID                                                          85400020
         END                                                            85500020
