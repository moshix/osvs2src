         TITLE 'IEDAYL - TIOC LOGON'                                    00090000
IEDAYL   CSECT                                                          00180000
         SPACE 3                                                        00270000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00360000
*                                                                       00450000
*        TCAM VERSION 10.0 CHANGES                             @G36XRYP 00540000
*A090000,488700,633600,715500,723600,900000,984600             @G36XRYP 00550000
*C067500-068400,708300,713700,988200                           @G36XRYP 00560000
*D489600-490500,634500-639900,648000-650700                    @G36XRYP 00570000
*                                                              @G36XRYP 00580000
*A045000,260100,270900,486000,487800,511200,527400,595800      @Y17XAYP 00630000
*A597600,606600,614700,693900,894600,901800,909000             @Y17XAYP 00720000
*C720900                                                       @Y17XAYP 00810000
*D151200,167400,527700-528000,552600-553500                    @Y17XAYP 00900000
*                                                                       00990000
*F                                                                      01080000
*                                                              @OY14092 01170000
*        RA0034 CHANGES                                        @OY14092 01260000
*                                                              @OY14092 01350000
*C203400,662400                                                @OY14092 01530000
*D236700,237600                                                @OZ24216 01530182
*A663300                                                       @OZ24216 01530282
*                                                                     * 01620000
*                                                                     * 01710000
*    NAME - IEDAYL, TIOC LOGON                                        * 01800000
*                                                                     * 01890000
*    POST RELEASE VS2-1.6 CHANGES                                       01980000
*0000158121,169800,492081-492085                               @YA13121 02070000
*0000169800,208101-208110                                      @YA12438 02160000
*C169800                                                       @YA03653 02250000
*A158310,489010,489020,492010-492080                           @YA03653 02340000
*C169800,246700                                                 YA00536 02430000
*D001300,536500-537300,537700                                   YA00536 02520000
*D537100                                                        YA00677 02610000
*A320020-320060                                                 YA00677 02700000
*    RELEASE 21 DELETIONS/CHANGES                                     * 02790000
*D604200-606900                                                 SA61123 02880000
*D235000                                                        SA56309 02970000
*0690169800                                                      S22028 03060000
*0690618700                                                      S22029 03150000
*0690023000,035000,058000,070000,071000,072000,120000,148000,    S22029 03240000
*0690155000,169800,180000,185000-187000,187060,187080,187600,    S22029 03330000
*0690187900,188000-195000,200000,215000-222000,229000-234000,    S22029 03420000
*D337000                                                        SA59527 03510000
*0690241000,246700,254000,263000,265000,270000,274000,290000,    S22029 03600000
*0690292000,296000,301000,304000,306000,311000-313000,316000,    S22029 03690000
*0690321000,323000,350000,353000,355000,358000,360000,361500-    S22029 03780000
*0690431800,442000-443000,462000,464000,475000-476000,480000-    S22029 03870000
*0690484000,491000,496000,497000-506000,517000-518000,525800-    S22029 03960000
*0690526000,527000-528000,537000,539000-540000,575000,616000,    S22029 04050000
*0690618000,660000-681000                                        S22029 04140000
*0690041000,168000,169800,187900,504000,505000,506000,575000,    S22025 04230000
*0690022000-023000,169800,537000,573000                          Y01018 04320000
*0690582000,584500-599500                                        S22025 04410000
*0690169800,575000                                               S22025 04500000
*0690169800                                                      A44839 04590000
*    RELEASE 20 DELETIONS/CHANGES                                     * 04680000
*                                                                 M3293 04770000
*                                                                 M0716 04860000
*0000009500,014000,029000,052000-058000,082000-084000,246400-    TS0030 04950000
*0000246600,286000,385000,393000,441000,641000                   TS0030 05040000
*0000                                                             M0019 05130000
*                                                                 M2655 05220000
*                                                                 M2662 05310000
*                                                                 M4681 05400000
*                                                                 M3611 05490000
*                                                                 M4659 05580000
*                                                                 M4660 05670000
***************************************************************@Y17XAYP 05760000
*                                                              @Y17XAYP 05850000
* MODULE NAME = IEDAYL (TCAM,TSO)                              @Y17XAYP 05940000
*                                                              @Y17XAYP 06030000
* DESCRIPTIVE NAME = TIME SHARING LOGON ROUTINE                @Y17XAYP 06120000
*                                                              @Y17XAYP 06210000
* COPYRIGHT = NONE                                             @Y17XAYP 06300000
*                                                              @Y17XAYP 06390000
* STATUS = VERSION 10.0                                        @G36XRYP 06480000
*                                                                     * 06570000
* FUNCTION -                                                          * 06660000
*    START CREATION OF A NEW MEMORY FOR THIS USER, IF HE       @G36XRYP 06750000
*    REQUESTS A 'LOGON' AND CONDITIONS ARE SET FOR A           @G36XRYP 06790000
*    SUCCESSFUL LOGON                                          @G36XRYP 06840000
*    PROMPT USER WHEN HE ENTERS INVALID LOGON REQUESTS                * 06930000
*    NOTIFY USER IF IT IS IMPOSSIBLE TO LOGON                         * 07020000
*                                                                     * 07110000
* ENTRY POINTS -                                                      * 07200000
*         IEDAYL, TO IDENTIFY VALID TSO LOGON ATTEMPTS                * 07290000
*                                                                     * 07380000
* INPUT -                                                             * 07470000
*    REGISTER  1 HAS PARAMETER LIST ADDRESS                           * 07560000
*    REGISTER  3 HAS SCB ADDRESS                                      * 07650000
*    REGISTER  4 HAS LCB ADDRESS                                      * 07740000
*    REGISTER  6 HAS TCAM BUFFER ADDRESS                              * 07830000
*    REGISTER  9 HAS AVT ADDRESS                                      * 07920000
*    REGISTER 12 HAS BASE ADDRESS                                     * 08010000
*    REGISTER 13 HAS AVTSAVE3 ADDRESS                                 * 08100000
*                                                                     * 08190000
* OUTPUT -                                                            * 08280000
*    NONE                                                             * 08370000
*                                                                     * 08460000
* EXTERNAL REFERENCES -                                               * 08550000
*         IEDQTNT, TERMINAL ENTRY ADDRESS FINDER, VIA BRANCH ENTRY AT * 08640000
*         AVTRNMPT                                                    * 08730000
*         QTIP ENTRY 10 VIA SVC 101                                   * 08820000
*         IEDQHG02, TIME DELAY QUEUE REMOVAL ROUTINE, VIA BRANCH ENT- * 08910000
*         RY AT AVTHG02                                               * 09000000
*         MEMORY CREATE, VIA SVC 34 AND CIB                    @G36XRYP 09040000
*                                                                     * 09090000
* EXITS, NORMAL -                                                     * 09180000
*         RETURN TO TS MH VIA TCAM RETURN INTERFACE  ROUTINE (IEDQLM) * 09270000
*         BRANCH TO ALTERNATE MH VIA LOGON MACRO EXIT ADDRESS         * 09360000
*                                                                     * 09450000
* EXITS, ERROR -                                                      * 09540000
*         NONE                                                        * 09630000
*                                                                     * 09720000
* TABLES/WORK AREAS -                                                 * 09810000
*    CONTROL  BLOCKS AND PARAMETER  LISTS ARE DESCRIBED IN THE DSECTS * 09900000
*    AT THE END OF THE LISTING                                        * 09990000
*    A TABLE OF 'OGON' IN LOWER AND IN UPPERCASE CALLED 'LOGCON'      * 10080000
*    A TABLE OF 'CAMON' IN LOWER AND IN UPPERCASE CALLED 'TCAMON'     * 10170000
*    REGISTERS ARE SAVED IN ADDRESS PLUS 72 PASSED IN REGISTER 13     * 10260000
*    AVTDOUBLE IS USED AS A WORK AREA                                 * 10350000
*                                                                     * 10440000
* ATTRIBUTES -                                                        * 10530000
*    ENABLED, PROBLEM PROGRAM MODE, REFRESHABLE, REUSABLE             * 10620000
*                                                                     * 10710000
* CHARACTER CODE DEPENDENCY -                                         * 10800000
*    THE OPERATION OF THIS MODULE IS DEPENDENT UPON CERTAIN  INTERNAL * 10890000
*    REPRESENTATIONS OF ITS CHARACTER SET...IT IS ASSEMBLED IN EBCDIC * 10980000
*    AND MUST BE SPECIALLY MODIFIED IF RE-ASSEMBLY IN ANOTHER CHARAC- * 11070000
*    TER SET IS DESIRED....THE FIELDS REQUIRING THIS MODIFICATION ARE * 11160000
*    FOUND UNDER THE HEADING 'MASKS AND CHARACTERS' (HERE, LOWERL AND * 11250000
*    LOWERT) AND IN THE CONSTANTS LOGCON (THE LOWERCASE 'O', 'G', AND * 11340000
*    'N') AND TCAMCON (THE LOWERCASE 'C', 'A', 'M', 'O', AND 'N')       11430000
*                                                                     * 11520000
* NOTES -                                                             * 11610000
*    REGISTER EQUATES START WITH 'R'                                  * 11700000
*    LENGTH AND DISPLACEMENT EQUATES START WITH 'E'                   * 11790000
*    CERTAIN CONSTANTS START WITH 'KON'                               * 11880000
*                                                                     * 11970000
*                                                                     * 12060000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 12150000
         EJECT                                                          12240000
********                                                                12330000
******** REGISTER EQUATES FOR 'LOGON' SCAN ONLY                         12420000
********                                                                12510000
RBUF1    EQU   2                        SAVES FIRST B.U. ADDR DURING    12600000
*                                       'LOGON' SCAN                    12690000
RDATA1   EQU   3                        SAVES FIRST DATA ADDR DURING    12780000
*                                       'LOGON' SCAN                    12870000
RBUSZ1   EQU   4                        SAVES FIRST B.U. SIZE DURING    12960000
*                                       'LOGON' SCAN                    13050000
RLOGCHAR EQU   5                        ADDR OF CHAR IN 'OGON'          13140000
RHDR     EQU   7                        SIZE OF FIRST B.U.'S HDR        13230000
RHERE    EQU   8                        RET ADDR AFTER GETTING NEW B.U. 13320000
RAT      EQU   10                       ADDR OF CHAR BEING SCANNED      13410000
RCNT     EQU   11                       NUMBER OF CHARS SCANNED         13500000
RBUSZ    EQU   14                       SIZE OF BASIC UNIT              13590000
RMSGSZ   EQU   15                       LENGTH OF DATA TO SCAN          13680000
         SPACE 3                                                        13770000
********                                                                13860000
******** REGISTER EQUATES FOR STRING SCAN AND/OR REST OF ROUTINE        13950000
********                                                                14040000
R0       EQU   0                        WORK REGISTER           SA56309 14130000
R1       EQU   1                        WORK REG                        14220000
RTSCVT   EQU   2                        TSCVT ADDRESS                   14310000
R2       EQU   2                        4K BASE ADDR INCREMENT   S22029 14400000
RSCB     EQU   3                        SCB ADDRESS                     14490000
RLCB     EQU   4                        LCB ADDRESS                     14580000
RDCB     EQU   5                        DCB ADDRESS                     14670000
RWORK5   EQU   5                        WORK REGISTER            Y06327 14760000
RBUF     EQU   6                        BUFFER ADDRESS                  14850000
RQCB     EQU   7                        QCB ADDRESS                     14940000
RTERM    EQU   8                        TERMINAL TABLE ENTRY ADDR       15030000
RAVT     EQU   9                        AVT ADDRESS                     15120000
RCH      EQU   10                       WORK REGISTER                   15210000
RIS      EQU   11                       WORK REGISTER                   15300000
RBASE    EQU   12                       BASE ADDRESS/ENTRY ADDRESS      15390000
R13      EQU   13                       AVT SAVE AREA ADDR              15480000
R14      EQU   14                       WORK REGISTER                   15570000
R15      EQU   15                       WORK REG, TJID PASSED FROM      15660000
*                                       QTIP, AND RETURN CODE           15750000
         SPACE 3                                                        15840000
********                                                                15930000
******** MASKS AND CHARACTERS                                           16020000
********                                                                16110000
CATTEN   EQU   X'20'                    TERM HAS ATTENTION FTR          16200000
TSMH     EQU   X'01'                    DENOTES A TS MH                 16290000
DEBOPATB EQU   12                       OFFSET TO OPATB FLD IN DEB      16380000
DEBOUT   EQU   X'03'                    DEB SPECIFIES OUTPUT OR INOUT   16470000
CINHIBIT EQU   X'80'                    READ INHIBIT CCW CAN BE USED    16560000
C3270    EQU   X'04'                    3270 TERMINAL (TCT)      S22028 16650000
QCBLOGCT EQU   X'C0'                    TESTS LOGON'S RETRY COUNT       16740000
LOWERL   EQU   X'93'                    LOWERCASE 'L' - 'LOGON' TEST    16830000
UPPERL   EQU   C'L'                     UPPERCASE 'L' - 'LOGON' TEST    16920000
LOWERT   EQU   X'A3'                    LOWERCASE 'T'            S22029 17010000
UPPERT   EQU   C'T'                     UPPERCASE 'T'            S22029 17100000
BLANK    EQU   C' '                     BLANKS OUT GARBAGE IN BFR       17190000
SCANEND  EQU   C'X'                     STOPS STRING SCAN        S22029 17280000
INBLOCK  EQU   X'01'                    INBLOCK                  S22029 17370000
LOGON    EQU   10                       CALLS QTIP FOR LOGON DUTIES     17460000
NOT      EQU   X'FF'                    ZEROS VARIOUS BITS              17550000
E1       EQU   1                        GIVES A VALUE OF 1              17640000
E2       EQU   2                        GIVES A VALUE OF 2              17730000
SETINHB  EQU   X'10'                    3705 MODE SET FLAG              17820000
STMONITR EQU   X'02'                    3705 MODE SET FLAG      YS06327 17910000
E3       EQU   3                        GIVES A VALUE OF 3       S22029 18000000
E8       EQU   8                        GIVES A VALUE OF 8     @YA03653 18090000
E32      EQU   32                       GIVES A VALUE OF 32      S22029 18180000
ELEVEN   EQU   11                       DECIMAL ELEVEN           S22029 18270000
E12      EQU   12                       SCAN LENGTH DEFAULT     SA56309 18360000
LCBOFFS  EQU   36                       OFFSET TO RLCB IN S.A.  YA00677 18450000
AUTOPOLL EQU   X'01'                    AUTOPOLL TEST MASK     @YA13121 18540000
         SPACE 3                                                        18630000
********                                                                18720000
******** ESTABLISH ADDRESSABILITY AND INITIALIZE REGISTERS              18810000
********                                                                18900000
         USING IEDAYL,RBASE             USE ENTRY ADDR AS BASE ADDR     18990000
         USING IEDNTRM,RTERM            TRM ADDRESSABILITY     @YM08512 19010000
         USING IEDQSCB,RSCB             USE RSCB AS SCB BASE REG        19080000
         USING IEDQLCB,RLCB             USE RLCB AS LCB BASE REG        19170000
         L     RDCB,LCBDCBPT            GET DCB ADDR                    19260000
         USING IHADCB,RDCB                                              19350000
         USING IEDQPRF,RBUF             USE RBUF AS BFR BASE REG        19440000
         USING IEDQAVTD,RAVT            USE RAVT AS AVT BASE REG        19530000
         XC    AVTDOUBL,AVTDOUBL        INITIALIZE WORK AREA     S22029 19620000
         LR    R2,R1                    SAVE LOGON PARM LIST    SA56309 19710000
         USING LOGPARM,R1                                        S22029 19800000
         L     R1,LOGPMH-1              PICKUP ADDR OF CURRENT   S22029 19890000
*                                       MH PROCESSING THIS MSG          19980000
         DROP  R1                                                S22029 20070000
         USING CURMHQCB,R1                                       S22029 20160000
         B     PASTID                   GET PAST MODULE ID              20250000
IEDAYL   IEDHJN ,                                              @OY14092 20340000
PASTID   DS    0H                                                       20430000
         SPACE 3                                                        20520000
* * * * *  SEE IF CONDITIONS ARE SET FOR A SUCCESSFUL LOGON * * * * * * 20610000
         SPACE 3                                                        20700000
********                                                                20790000
******** IF TERMINAL IS IN EXTENDED LOCK MODE, DON'T TOUCH ANYTHING     20880000
********                                                                20970000
         TM    SCBSTATE,SCBLCK1N        TEST FOR LOCK MODE      SA61128 21060000
         BO    BYEBYE                   IF IN LOCK MODE, EXIT   SA61128 21150000
         SPACE 3                                                SA61128 21240000
********                                                                21330000
******** CHECK FOR HEADER BUFFER                                        21420000
********                                                                21510000
         TM    PRFSTAT1,PRFNHDRN        IS IT A HEADER BFR       S22029 21600000
         BO    CONCAN                   NO, BRANCH               S22029 21690000
         SPACE 3                                                        21780000
********                                                                21870000
******** SEE IF TSO SUPPORTS THIS TERMINAL                              21960000
********                                                                22050000
         TM    LCBSTAT2,LCBDIAL         IS IT A DIAL TERMINAL           22140000
         BZ    NOTDIAL                  NO - FOLLOWING CODE IS INVALID  22230000
         NC    LCBLNENT(E2),LCBLNENT    IS INDEX VALID (NON-ZERO)       22320000
         BZ    CONCAN                   NO - GET RID OF USER     S22029 22410000
         SPACE 3                                                        22500000
********                                                                22590000
******** PUT TNT INDEX IN LCB AND BUFFER PREFIX                         22680000
********                                                                22770000
********                                                                22810000
         MVC   AVTDOUBL+4(E2),LCBLNENT  SAVE CONNECT INDEX       S22029 22860000
         B     CONNECT                  SKIP NON-DIAL CODE       S22029 22950000
NOTDIAL  EQU   *                                                 S22029 23040000
         MVC   AVTDOUBL+4(E2),LCBTTCIN  SAVE CONNECT INDEX       S22029 23130000
CONNECT  EQU   *                                                 S22029 23220000
         SPACE 3                                                        23310000
******** FIND PROPER QCB VIA LCBTTCIN (IN REG 1) AND TNT CODE           23312000
********                                                                23314000
         LR    RIS,R1                   SAVE CURRENT MH'S QCB    S22029 23316000
         LH    R1,AVTDOUBL+4            PICK UP CONNECT INDEX    S22029 23318000
         N     R1,AVTCLRHI              CLEAR HI-ORDER HALFWORD         23320000
         LTR   R1,R1                    SOURCE DETERMINATION     S99228 23322000
*                                       ERROR                    S99228 23324000
         BZ    BADCIN                   YES, BRANCH              S99228 23326000
         L     R15,AVTRNMPT             GET ADDR OF TNT                 23328000
         BALR  R14,R15                  BR TO CODE IN TNT TO GET ADDR   23330000
*                                       OF TERMINAL TBL ENT IN REG 1    23332000
         LR    RTERM,R1                 SAVE TERMINAL TBL ENT ADDR      23334000
         LA    R1,TRMPRFSZ              PREFIX SIZE            @YM08512 23336000
         SR    RTERM,R1                 SET TRM PREFIX BASE    @YM08512 23338000
         LR    R1,RIS                   RESTORE CURRENT MH'S QCB S22029 23340000
         L     RQCB,TRMDESTQ-1          GET QCB ADDR FROM TERM ENTRY    23342000
         LA    RQCB,0(0,RQCB)           ZERO HI-ORDER BYTE       S22029 23344000
         USING IEDQQCB,RQCB             USE RQCB AS QCB BASE ADDR       23346000
         SPACE 3                                                 S22029 23348000
********                                                       @YA12438 23350000
******** CHECK FOR STOPPED TERMINAL                            @YA12438 23352000
********                                                       @YA12438 23354000
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 23356000
         BZ    OXOCNI                   TERM 0X EP             @Y17XAYP 23358000
         TM    TRMBYTE2,TRMRSACT        IS TERMINAL ACTIVE     @Y17XAYP 23360000
         BNO   CONCAN                   NO, IGNORE INPUT       @Y17XAYP 23362000
         TM    TRMBYTE0,TRMSNA          IS THIS SNA TERMINAL   @Y17XAYP 23364000
         BNO   NOTSNA                   NO, BRANCH NOT SNA     @Y17XAYP 23366000
         ICM   R14,7,TRMSIBPT           GET ADDR OF SIB        @Y17XAYP 23368000
         USING IEDSIBD,R14              SIB ADDRESSABILITY     @Y17XAYP 23370000
         TM    SIBSESSN,SIBLGOFF        SNA LOGOFF REQUESTED   @Y17XAYP 23372000
         BO    CONCAN                   SET DEST TO BFR RET    @Y17XAYP 23374000
NOTSNA   EQU   *                                               @Y17XAYP 23376000
         DROP  R14                                             @Y17XAYP 23378000
         TM    TRMPRE1,TRMOCNI          IS STOP TERM,LINE,GP   @Y17XAYP 23380000
*                                       IN PROGRESS            @Y17XAYP 23382000
         BNO   CKOLTR                   NO, CONTINUE LOGON     @YM08526 23384000
         TM    QCBFLAG,QCBTSSES         TERM IN TSO SESSION    @YM08526 23386000
         BNO   CONCAN                   NO, DON'T ALLOW LOGON  @YM08526 23388000
         TM    TRMPRE,TRMSTMM           THIS STOPLINE I        @YM08526 23390000
         BO    CONCAN                   YES, END SESSION       @Y17XAYP 23392000
         B     CKOLTR                   NO, CONTINUE LOGON     @YM08526 23394000
         SPACE 3                                               @YA12438 23396000
OXOCNI   EQU   *                                               @YM08526 23398000
********                                                                23400000
******** SEE IF THIS LOGON SHOULD BE INTERRUPTED                        23490000
********                                                                23580000
CKOLTR   EQU   *                                               @YM08526 23800000
         TM    SCBERR2,SCBOLTR          INVALID ONLINE TEST REQ         23850000
         BO    CONCAN                   YES - IGNORE THIS BFR    S22029 23940000
         TM    SCBERR2,SCBCODER         ERROR IN MSG TRANSLATION S22029 24030000
         BO    CHKMH                    YES - TELL USER SO       S22029 24120000
         TM    SCBERR2,SCBSOHE          CHECK 0 LENGTH BFR       S22028 24210000
         BO    CONCAN                   YES, NO DATA             S22028 24300000
         SPACE 3                                                        24390000
********                                                                24480000
******** SEE IF ANY DATA IN BUFFER                                      24570000
********                                                                24660000
         CLC   PRFSIZE,AVTFZERO         IS DATA LENGTH 0                24750000
         BE    CONCAN                   YES - NO DATA TO PROCESS S22029 24840000
         SPACE 3                                                 A44839 24930000
********                                                                25020000
******** CHECK FOR TSC ABEND                                            25110000
********                                                                25200000
         TM    AVTBIT3,AVTTSAB          DID TSO ABEND            A44839 25290000
         BO    CONCAN                   YES - NO SYS TO LOGON TO S22029 25380000
         SPACE 3                                                        25470000
********                                                                29430000
******** CHECK FOR TSO SESSION ALREADY BEGUN                            29520000
********                                                                29610000
OXTERM   EQU   *                                               @YA12438 29700000
         TM    QCBFLAG,QCBTSSES         TSO SESSION ACTIVE       S22029 29790000
         BO    SETTSIN                  YES - NO NEED TO LOGON   S22029 29880000
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 29970000
         BNO   NOTLOGD                  NO,CAN'T BE SNA TERM   @Y17XAYP 30060000
         TM    TRMBYTE0,TRMSNA          IS THIS A SNA TERM     @Y17XAYP 30150000
         BNO   NOTLOGD                  NO,CAN'T BE SNA LOGON  @Y17XAYP 30240000
*                                       DATA                   @Y17XAYP 30330000
         LA    R14,PRF2LEN              GET LENGTH OF NEGATIVE @Y17XAYP 30420000
*                                       PREFIX                 @Y17XAYP 30510000
         LR    RIS,RBUF                 GET BUFFER ADDRESS     @Y17XAYP 30600000
         SR    RIS,R14                  BACK UP TO NEG PREFIX  @Y17XAYP 30690000
         USING IEDPF1,RIS               BFR PREFIX ADDR        @Y17XAYP 30870000
         TM    PRF1FLG1,PRF1LOGD        IS THIS LOGON DATA     @Y17XAYP 30960000
         BZ    NOTLOGD                  NO, SCAN FOR LOGON     @Y17XAYP 31050000
         TM    CURMHFG2,CURMHTS         IS THIS TSO SNA LOGON  @Y17XAYP 31140000
         BO    LOGONFND                 YES, PROCESS LOGON     @Y17XAYP 31230000
         B     TCAMFND                  NO,PROCESS FOR TCAM MH @Y17XAYP 31320000
         SPACE 3                                                        31410000
NOTLOGD  EQU   *                                               @Y17XAYP 31500000
********                                                                31590000
******** SAVE REGISTERS FOR USE AFTER LOGON SCAN                        31680000
********                                                                31770000
         SAVE  (14,12)                  SAVE REGS FOR LATER USE         31860000
         SPACE 3                                                        31950000
* * * * * * * * * *  PREPARE FOR SCAN FOR 'LOGON' * * * * * * * * * * * 32040000
         SPACE 3                                                        32130000
********                                                                32220000
******** POINT PAST BUFFER HEADER TO DATA WITHIN BUFFER                 32310000
********                                                                32400000
         LR    RAT,RBUF                 GET BFR ADDR FOR SCAN POINTER   32490000
         SR    RHDR,RHDR                CLEAR FOR INSERTION     SA56309 32580000
         IC    RHDR,LCBISZE            GET NUMBER OF RESERVES   SA56309 32670000
         LA    RAT,AVTUMALN+AVTHDRSZ(RHDR,RAT) ADD SIZE OF TCAM SA56309 32760000
*                                       HEADER                  SA56309 32850000
         LA    RHDR,AVTHDRSZ            GET TCAM HDR SIZE (FIRST B.U.)  32940000
         SPACE 3                                                        33030000
********                                                                33120000
******** GET SIZE OF DATA TO SCAN (IN BASIC UNIT AND IN WHOLE BUFFER)   33210000
********                                                                33300000
         LH    RBUSZ,AVTKEYLE           GET SIZE OF BASIC UNIT          33390000
         SR    RBUSZ,RHDR               GET DATA SIZE ONLY (SUB FIRST   33480000
*                                       B.U.'S HDR SIZE)                33570000
         LR    RBUSZ1,RBUSZ             SAVE FIRST B.U. SIZE            33660000
         LH    RMSGSZ,PRFSIZE           GET LENGTH OF DATA TO SCAN      33750000
         SR    RMSGSZ,RHDR              GET DATA SIZE ONLY (SUB  M0019  33840000
*                                       FIRST B.U.'S HDR SIZE)   M0019  33930000
         BNP   NOSTRING                 EXIT IF DATA LNG IS 0   YA00536 34020000
         SPACE 3                                                SA56309 34110000
********                                                                34200000
******** DETERMINE HOW FAR TO SCAN                                      34290000
********                                                                34380000
         SR    R0,R0                    CLEAR FOR INSERTION     SA56309 34470000
         IC    R0,E2(R2)                GET SCAN VALUE FROM     SA56309 34560000
*                                       LOGON MACRO             SA56309 34650000
         LTR   R0,R0                    WAS A VALUE SPECIFIED   SA56309 34740000
         BNZ   SCANVAL                  YES, SKIP DEFAULT       SA56309 34830000
         LA    R0,E12                   NO, GIVE DEFAULT OF 12  SA56309 34920000
SCANVAL  EQU   *                                                        35010000
         SPACE 3                                                        35100000
********                                                                35190000
******** PREPARE SCAN AIDS                                              35280000
********                                                                35370000
         SR    RCNT,RCNT                ZERO REG FOR FUTURE CNTING      35460000
         LR    RBUF1,RBUF               SAVE BFR ADDR FOR LATER USE     35550000
         LR    RDATA1,RAT               SAVE DATA ADDR FOR LATER USE    35640000
         SPACE 3                                                        35730000
* * * * * * * * * * * * *  SCAN FOR 'LOGON' * * * * * * * * * * * * * * 35820000
         SPACE 3                                                        35910000
********                                                                36000000
******** SCAN FOR LOWER AND UPPERCASE 'L'                               36090000
********                                                                36180000
LSCAN    EQU   *                                                        36270000
         MVI   AVTDOUBL+6,UPPERL        INDICATE 'LOGON' SCAN    S22029 36360000
         LA    RLOGCHAR,LOGCON          POINT TO 'OGON'          S22029 36450000
         CLI   0(RAT),LOWERL            DO WE SEE A LOWERCASE 'L' HERE  36540000
         BE    CONTSCAN                 YES - SEE IF 'OGON'      S22029 36630000
*                                       FOLLOWS                         36720000
         CLI   0(RAT),UPPERL            DO WE SEE AN UPPERCASE 'L' HERE 36810000
         BE    CONTSCAN                 YES - SEE IF 'OGON'      S22029 36900000
*                                       FOLLOWS                         36990000
         SPACE 3                                                 S22029 37080000
********                                                                37170000
******** SCAN FOR LOWER AND UPPERCASE 'T'                               37260000
********                                                                37350000
TSCAN    EQU   *                                                 S22029 37440000
         MVI   AVTDOUBL+6,UPPERT        INDICATE 'TCAMON' SCAN   S22029 37530000
         LA    RLOGCHAR,TCAMCON         POINT TO 'CAMON'         S22029 37620000
         CLI   0(RAT),LOWERT            LOWERCASE 'T' HERE       S22029 37710000
         BE    CONTSCAN                 YES - SEE IF 'CAMON'     S22029 37800000
*                                       FOLLOWS                         37890000
         CLI   0(RAT),UPPERT            UPPERCASE 'T' HERE       S22029 37980000
         BE    CONTSCAN                 YES - SEE IF 'CAMON'     S22029 38070000
*                                       FOLLOWS                         38160000
         SPACE 3                                                        38250000
********                                                                38340000
******** CHECK FOR HAVING SCANNED ALL THE DATA OR A WHOLE BASIC UNIT    38430000
********                                                                38520000
         LA    RCNT,E1(0,RCNT)          ADD 1 TO CHAR COUNT             38610000
         LA    RAT,E1(0,RAT)            POINT TO NEXT CHAR IN BFR       38700000
STAYHERE EQU   *                                                        38790000
         CR    RCNT,R0                  SCAN LIMIT REACHED?     SA56309 38880000
         BE    NOSTRING                 YES, STRING NOT FOUND   SA56309 38970000
         CR    RCNT,RMSGSZ              HAS ALL THE DATA BEEN SCANNED   39060000
         BE    NOSTRING                 YES - STRING NOT FOUND   S22029 39150000
         CR    RCNT,RBUSZ               HAS THE WHOLE B.U. BEEN SCANNED 39240000
         BL    LSCAN                    NO - CHECK NEXT CHAR            39330000
         LA    RHERE,LSCAN              GET PROPER RET ADDR             39420000
         SPACE 3                                                        39510000
********                                                                39600000
******** GET NEXT BASIC UNIT SINCE ALL THE DATA HASN'T BEEN SCANNED     39690000
********                                                                39780000
GETBU    EQU   *                                                        39870000
         L     RAT,PRFTIC               GET ADDR OF NEXT B.U.           39960000
         LR    RBUF,RAT                 GET BFR BASE REG FOR NEXT SCAN  40050000
         LA    RAT,AVTUMALN(0,RAT)      POINT PAST PREFIX TO DATA       40140000
         AH    RBUSZ,AVTKEYLE           ADD SIZE OF SUBSEQUENT   TS0030 40230000
*                                       B.U.S                    TS0030 40320000
         BR    RHERE                    CHECK NEXT CHAR                 40410000
         SPACE 3                                                        40500000
********                                                                40590000
******** SCAN FOR LOWER AND UPPERCASE 'OGON' OR 'CAMON'                 40680000
********                                                                40770000
CONTSCAN EQU   *                                                 S22029 40860000
         LA    RCNT,E1(0,RCNT)          ADD 1 TO CHAR COUNT             40950000
         LA    RAT,E1(0,RAT)            POINT TO NEXT CHAR IN BFR       41040000
         CR    RCNT,RMSGSZ              HAS ALL THE DATA BEEN SCANNED   41130000
         BE    NOSTRING                 YES - STRING NOT FOUND   S22029 41220000
         CR    RCNT,RBUSZ               HAS THE WHOLE B.U. BEEN SCANNED 41310000
         BL    COMPARE                  NO - CHECK NEXT CHAR            41400000
         BAL   RHERE,GETBU              YES - TRY NEXT B.U.             41490000
COMPARE  EQU   *                                                        41580000
         CLC   0(E1,RAT),0(RLOGCHAR)    IS THIS CHAR IN STRING   S22029 41670000
*                                       (LOWERCASE)                     41760000
         BE    POINTUP                  YES - POINT TO UPPERCASE CHAR   41850000
         LA    RLOGCHAR,E1(0,RLOGCHAR)  POINT TO UPPERCASE CHAR         41940000
         CLC   0(E1,RAT),0(RLOGCHAR)    IS THIS CHAR IN STRING   S22029 42030000
*                                       (UPPERCASE)                     42120000
         BE    POINTNEX                 YES - POINT TO NEXT CHAR        42210000
         B     STAYHERE                 SEE IF END OF SCAN              42300000
POINTUP  EQU   *                                                        42390000
         LA    RLOGCHAR,E1(0,RLOGCHAR)  GET UPPERCASE CHAR              42480000
POINTNEX EQU   *                                                        42570000
         LA    RLOGCHAR,E1(0,RLOGCHAR)  GET NEXT CHAR IN STRING  S22029 42660000
*                                      (LOWERCASE)                      42750000
         CLI   0(RLOGCHAR),SCANEND      HAS STRING BEEN SCANNED  S22029 42840000
         BNE   CONTSCAN                 NO - CONTINUE SCAN       S22029 42930000
         LA    RCNT,E1(0,RCNT)          ADD 1 FOR LAST CHAR SCANNED     43020000
         SPACE 3                                                        43110000
* * * * * * BLANK ANY GARBAGE PRECEDING 'LOGON' OR 'TCAMON' * * * * * * 43200000
         SPACE 3                                                        43290000
********                                                                43380000
******** INITIALIZE AS NECESSARY AND SEE IF THERE IS ANYTHING TO BLANK  43470000
********                                                                43560000
         L     RLCB,LCBOFFS(,R13)       RELOAD RLCB FROM S.A.   YA00677 43650000
         SR    RAT,RAT                  CLEAR FOR INSERT CHAR   YA00677 43740000
         IC    RAT,LCBISZE              GET NO. RESERVES        YA00677 43830000
         AR    RCNT,RAT                 ADD TO COUNT            YA00677 43920000
         SR    RDATA1,RAT               SUBTR FR START ADDR     YA00677 44010000
         CLI   AVTDOUBL+6,UPPERT        WAS 'TCAMON' FOUND       S22029 44100000
         BNE   BLANKLOG                 NO - BLANK 'LOGON'       S22029 44190000
         SH    RCNT,KON6                DON'T BLANK 'TCAMON'     S22029 44280000
         B     BLANKMSG                 GO BLANK OUT             S22029 44370000
BLANKLOG EQU   *                                                 S22029 44460000
         SH    RCNT,KON5                DON'T BLANK 'LOGON'      S22029 44550000
BLANKMSG EQU   *                                                 S22029 44640000
         LTR   RCNT,RCNT                ANY CHARS TO BLANK              44730000
         BZ    STRNGFND                 NO - PROCESS THIS STRING S22029 44820000
         LR    RBUF,RBUF1               GET ADDR OF FIRST B.U.          44910000
         LR    RAT,RDATA1               GET ADDR OF DATA IN FIRST B.U.  45000000
         LR    RBUSZ,RBUSZ1             GET SIZE OF FIRST B.U.          45090000
         SPACE 3                                                        45180000
********                                                                45270000
******** BLANK WHOLE BASIC UNIT                                         45360000
********                                                                45450000
BLANKHOL EQU   *                                                        45540000
         CR    RCNT,RBUSZ               NO. CHARS SCANNED GT ONE B.U.   45630000
         BNH   BLANKHAF                 NO - GO BLNK RCNT NO. OF CHARS  45720000
         MVI   0(RAT),BLANK             PUT A BLANK IN FIRST BYTE       45810000
         SR    RCNT,RBUSZ               NO. CHARS LEFT TO BLANK SA59527 45900000
         SH    RBUSZ,AVTHA2             SUB 1 FOR MVI AND 1 FOR EX      45990000
         EX    RBUSZ,BLANKIT            BLANK WHOLE B.U.                46080000
         LH    RBUSZ,AVTKEYLE           GET BASIC UNIT SIZE     SA59527 46170000
         L     RAT,PRFTIC               GET ADDR OF NEXT B.U.           46260000
         LR    RBUF,RAT                 GET BFR BASE FOR NEXT TIME      46350000
         LA    RAT,AVTUMALN(0,RAT)      POINT PAST PREFIX TO DATA       46440000
         B     BLANKHOL                 BR TO CONT BLANKING             46530000
         SPACE 3                                                        46620000
********                                                                46710000
******** BLANK PARTIAL BASIC UNIT                                       46800000
********                                                                46890000
BLANKHAF EQU   *                                                        46980000
         MVI   0(RAT),BLANK             PUT A BLANK IN FIRST BYTE       47070000
         CH    RCNT,KON1                IS THERE ONLY 1 CHAR TO BLANK   47160000
         BE    STRNGFND                 YES-PROCESS THIS STRING  S22029 47250000
         SH    RCNT,AVTHA2              SUB 1 FOR MVI AND 1 FOR EX      47340000
         EX    RCNT,BLANKIT             BLANK RCNT PORTION OF B.U.      47430000
         B     STRNGFND                 PROCESS THIS STRING      S22029 47520000
         SPACE 3                                                        47610000
* * * * * * * * * * *  CODE FOR NO STRING FOUND * * * * * * * * * * * * 47700000
         SPACE 3                                                        47790000
********                                                                47880000
******** RESTORE REGISTERS TO CONTENTS BEFORE STRING SCAN               47970000
********                                                                48060000
NOSTRING EQU   *                                                 S22029 48150000
         LM    R14,RBASE,AVTECD12(R13)  RESTORE REGS                    48240000
         TM    CURMHFG2,CURMHTS         IS CURRENT MH A TCAM MH  S22029 48330000
         BZ    BYEBYE                   YES - RETURN MSG INTACT  S22029 48420000
         SPACE 3                                                        48510000
********                                                                48600000
******** SEE IF TSO IS UP - IF NOT, SEND MESSAGE AND RETURN             48690000
********                                                                48780000
         L     RCH,CVTPTR               GET CVT ADDR                    48870000
         L     RCH,CVTAQAVT-CVT(RCH)    GET TCX ADDRESS        @G36XRYP 48880000
         USING IEDQTCX,RCH              TCX ADDRESSABILITY     @G36XRYP 48890000
         ICM   RCH,7,TCXRPT+1           GET TIOCRPT ADDRESS    @ZM46725 48900000
         BNZ   RETRYCT                  IF NOT ZERO,TSO IS UP  @G36XRYP 48910000
         DROP  RCH                                             @G36XRYP 48920000
         OI    AVTDOUBL,SCBNOTSO        SEND 'TSO INACTIVE' MSG  S22029 49140000
         B     CHKMH                    ATTEMPT TO PROMPT        S22029 49230000
         SPACE 3                                                        49320000
********                                                                49410000
******** SET UP QCB RETRY COUNT, IF NECESSARY                           49500000
********                                                                49590000
RETRYCT  EQU   *                                                        49680000
         TM    QCBRETCT,QCBLOGCT        IS RETRY CNT ALREADY SET UP     49770000
         BO    DECR3                    BR IF YES - CNT IS 3            49860000
         BM    DECR1OR2                 BR IF YES - CNT IS 1 OR 2       49950000
         OI    QCBRETCT,QCBLOGCT        SET UP RETRY CNT                50040000
         B     PROMPTEM                 BR TO PROMPT USER               50130000
         SPACE 3                                                        50220000
********                                                                50310000
******** DECREMENT RETRY COUNT ... IF COUNT HITS ZERO, BID USER GOODBYE 50400000
********                                                                50490000
DECR1OR2 EQU   *                                                        50580000
         TM    QCBRETCT,QCBLOG1         IS RETRY CNT 1                  50670000
         BZ    DECR2                    BR IF NO - DECR CNT BY 1        50760000
         NI    QCBRETCT,NOT-QCBLOGCT    ZERO RETRY COUNT                50850000
         OI    AVTDOUBL,SCBHANG         SEND 'LOGON FAILED' MSG  S22029 50940000
         OI    LCBSTAT2,LCBNEGRP        INSTIGATE TCAM HANG-UP PROCESS  51030000
         B     CHKMH                    ATTEMPT TO PROMPT        S22029 51120000
         SPACE 3                                                        51210000
********                                                                51300000
******** PROMPT USER VIA 'TRY AGAIN' MESSAGE                            51390000
********                                                                51480000
DECR2    EQU   *                                                        51570000
         XI    QCBRETCT,QCBLOGCT        DECR CNT BY 1 (IS NOW 1)        51660000
         B     PROMPTEM                 BR TO PROMPT USER               51750000
DECR3    EQU   *                                                        51840000
         NI    QCBRETCT,NOT-QCBLOG1     DECREMENT COUNT BY 1 (NOW 2)    51930000
PROMPTEM EQU   *                                                        52020000
         OI    AVTDOUBL,SCBNOLOG        SEND 'ENTER LOGON' MSG   S22029 52110000
         B     CHKMH                    ATTEMPT TO PROMPT        S22029 52200000
         SPACE 3                                                 S22029 52290000
* * * * * * * * * * * * CODE FOR A VALID STRING * * * * * * * * * * * * 52380000
         SPACE 3                                                 S22029 52470000
********                                                                52560000
******** RESTORE REGISTERS TO CONTENTS BEFORE STRING SCAN               52650000
********                                                                52740000
STRNGFND EQU   *                                                 S22029 52830000
         LM    R14,RBASE,AVTECD12(R13)  RESTORE REGISTERS        S22029 52920000
         ICM   R1,7,LCBMHA              ASSUME PLCB AND GET    @Y17XAYP 53010000
*                                       MH ADDRESS             @Y17XAYP 53100000
         CLI   LCBFLAG1,LCBPLCB         IS THIS A PLCB         @Y17XAYP 53190000
         BE    GETALTMH                 YES, BRANCH            @Y17XAYP 53280000
         L     R1,DCBMH-1               UPDATE CURRENT MH QCB TO S22029 53370000
*                                       OWNING MH QCB                   53460000
GETALTMH EQU   *                                               @Y17XAYP 53550000
         L     RIS,CURMHALT-1           SETUP ALTERNATE MH QCB   S22029 54090000
         USING ALTMHQCB,RIS                                      S22029 54180000
         NI    QCBDSFLG,NOT-QCBALTMH    SETUP QCB CONNECTION TO  S22029 54270000
*                                       OWNING MSG HANDLER              54360000
         CLI   AVTDOUBL+6,UPPERT        WAS 'TCAMON' FOUND       S22029 54450000
         BNE   LOGONFND                 NO - PROCESS 'LOGON'     S22029 54540000
         SPACE 3                                                 S22029 54630000
* * * * * * * * * * * * CODE FOR A VALID TCAMON * * * * * * * * * * * * 54720000
         SPACE 3                                                 S22029 54810000
********                                                                54900000
******** SEND THIS MESSAGE TO ALTERNATE MH, IF POSSIBLE                 54990000
********                                                                55080000
TCAMFND  EQU   *                                                 S22029 55170000
         TM    QCBDSFLG,QCBDISK+QCBCORE CAN TERMINAL USE TCAM    S22029 55260000
         BZ    CONCAN                   NO - CANCEL THIS MSG     S22029 55350000
TCMHSRCH EQU   *                                                 S22029 55440000
         TM    CURMHFG2,CURMHTS         IS OWNING MH TCAM        S22029 55530000
         BZ    BYEBYE                   YES - CONT IN TCAM MH    S22029 55620000
         NC    CURMHALT,CURMHALT        IS THERE AN ALTERNATE MH S22029 55710000
         BZ    CONCAN                   NO - CONTINUE INHDR MSG  S22029 55800000
*                                       PROCESSING IN OWNING MH         55890000
         TM    ALTMHFG2,ALTMHTS         IS ALTERNATE MH TCAM     S22029 55980000
         BO    CONCAN                   NO - CANCEL THIS MSG     S22029 56070000
         NC    ALTMHLEX,ALTMHLEX        IS THERE A LOGON MACRO   S22029 56160000
*                                       EXIT ADDR IN THE ALT MH         56250000
         BZ    CONCAN                   NO - CANCEL THIS MSG     S22029 56340000
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 56430000
         BNO   NOPREF                   NO,CAN'T BE SNA        @Y17XAYP 56520000
         TM    TRMBYTE0,TRMSNA          IS THIS A SNA TERM     @Y17XAYP 56610000
         BO    CONCAN                   YES, CONTINUE          @Y17XAYP 56700000
*                                       PROCESSING IN OWNING MH@Y17XAYP 56790000
************************************************************** @Y17XAYP 56880000
*        ALTERNATE MH NOT PROVIDED FOR SNA TERMINALS           @Y17XAYP 56970000
************************************************************** @Y17XAYP 57060000
NOPREF   EQU   *                                               @Y17XAYP 57150000
         OI    QCBDSFLG,QCBALTMH        SETUP ALTERNATE DEST FOR S22029 57240000
*                                       THIS TERMINAL                   57330000
         LR    R1,RIS                   SETUP ALTERNATE MH AS    S22029 57420000
*                                       CURRENT MH                      57510000
         B     BYEBYE                   CONT IN TCAM MH          S22029 57600000
         SPACE 3                                                        57690000
* * * * * * * * * * * * CODE FOR A VALID LOGON  * * * * * * * * * * * * 57780000
         SPACE 3                                                        57870000
         SPACE 3                                                        57960000
********                                                                58050000
******** SEE IF TERMINAL CAN OPERATE UNDER TSO - IF NOT, SEND MESSAGE.  58140000
******** TERMINAL CANNOT IF IT HAS NO TSO QUEUEING, IF IT IS NOT OPEN   58230000
******** FOR OUTPUT, OR IF GENERAL POLLING HAS BEEN SPECIFIED.          58320000
********                                                                58410000
LOGONFND EQU   *                                                 S22029 58500000
         TM    QCBDSFLG,QCBTSQ          IS TERMINAL DEFINED FOR  S22029 58590000
*                                       TSO QUEUEING                    58680000
         BZ    NONTERM                  NO - TELL USER SO               58770000
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 58860000
         BNO   CKLCB                    NO,CHECK FOR GEN POLL  @Y17XAYP 58950000
         SR    R2,R2                    ZERO FOR NCP OFFSET    @Y17XAYP 59040000
         TM    TRMBYTE0,TRMUDEF         TERM ON 5041, BUT NOT  @Y17XAYP 59130000
*                                       1050 OR 2741           @Y17XAYP 59220000
         BO    NONTERM                  YES, INDICATE CAN'T    @Y17XAYP 59310000
*                                       USE WITH TSO           @Y17XAYP 59400000
         TM    TRMBYTE0,TRMOUTPT        CAPABLE FOR OUTPUT     @Y17XAYP 59490000
         BO    CHKTERM                  YES, CONT CHECKING     @Y17XAYP 59580000
         B     NONTERM                  NO, CAN'T LOGON        @Y17XAYP 59670000
CKLCB    EQU   *                                               @Y17XAYP 59760000
         SR    RCH,RCH                  CLEAR WORK REG.        @YA03653 59850000
         LA    R2,E8                    GET SUBTRACTION VALUE  @YA03653 59940000
         IC    RCH,DCBEIOBX             GET LENGTH OF LCB      @YA03653 60030000
         SR    RCH,R2                   SUBTRACT 8             @YA03653 60120000
         LA    RCH,0(RCH,RLCB)          POINT TO LCB EXTENTION @YA03653 60210000
         USING IEDQLCBX,RCH                                    @YA03653 60300000
         TM    LCBXFLAG,LCBGPCTV        IS TERM GENERAL POLLED @YA03653 60390000
         BO    NONTERM                  YES,CANT LOG HIM ON    @YA03653 60480000
         IC    R2,QCBRELLN              GET LINE NUMBER        @YA13121 60570000
         SLL   R2,E2                    X4=INV. LIST POS.      @YA13121 60660000
         L     RCH,DCBRESER(R2)         LOAD ITS STATUS ADD.   @YA13121 60750000
         TM    3(RCH),AUTOPOLL          IS TERM. AUTOPOLL?     @YA13121 60840000
         BO    NONTERM                  YES, CANT LOG HIM ON   @YA13121 60930000
CHKDEB   EQU   *                                                        61110000
         L     RCH,DCBDEBAD             GET DEB ADDR                    61200000
         TM    DEBOPATB(RCH),DEBOUT     DOES DEB SPECIFY OUTPUT         61290000
         BNZ   CHKTERM                  YES - CONT CHECKING             61380000
NONTERM  EQU   *                                                        61470000
         OI    AVTDOUBL,SCBNOTRM        SEND 'NON-TSO TERM' MSG  S22029 61560000
         B     CHKMH                    ATTEMPT TO PROMPT        S22029 61650000
         SPACE 3                                                        61740000
********                                                                61830000
******** CHECK FOR TERMINAL BEING ABLE TO RECEIVE MESSAGES              61920000
********                                                                62010000
CHKTERM  EQU   *                                                        62100000
         TM    TRMSTATE,TRMACPTN        CAN TERMINAL ACCEPT MSGS        62280000
         BZ    NOMSG                    BR IF NO - SEND 'CANT GET MSGS' 62370000
         TM    TRMSTATE,TRMHELDN        IS TERMINAL IN HOLD MODE        62460000
         BZ    CHKTSO                   BR IF NO - CONT CHECKING        62550000
NOMSG    EQU   *                                                        62640000
         OI    AVTDOUBL+2,SCBTMINN      SEND 'CANT GET MSGS' MSG S22029 62730000
         B     CHKMH                    ATTEMPT TO PROMPT        S22029 62820000
         SPACE 3                                                        62910000
********                                                                63000000
******** CHECK FOR TSO BEING OPERATIVE                                  63090000
********                                                                63180000
CHKTSO   EQU   *                                                        63270000
         L     RCH,CVTPTR               GET CVT ADDR                    63360000
         L     RCH,CVTAQAVT-CVT(RCH)    GET TCX ADDRESS        @G36XRYP 63368000
         USING IEDQTCX,RCH              TCX ADDRESSABILITY     @G36XRYP 63376000
         ICM   RCH,7,TCXRPT+1           GET TIOCRPT ADDRESS    @ZM46725 63384000
         BZ    NOTUP                    ZERO TIOCRPT ADDRESS   @G37XRYP 63392000
*                                       IF TSO NOT UP          @G36XRYP 63400000
         DROP  RCH                                             @G36XRYP 63408000
         USING TIOCRPT,RCH              TIOCRPT ADDRESSABILITY @G36XRYP 63416000
         TM    TIOCFLG,TIOCSTOP         IS TSO STOPPING        @G36XRYP 63424000
         BNO   CHKMAX                   NO, CK IF USER LIMIT   @G36XRYP 63432000
*                                       EXCEEDED               @G36XRYP 63440000
NOTUP    EQU   *                                                        64080000
         OI    AVTDOUBL,SCBNOTSO        SEND 'TSO INACTIVE' MSG  S22029 64170000
         B     CHKMH                    ATTEMPT TO PROMPT        S22029 64260000
         SPACE 3                                                        64350000
********                                                                64440000
******** CHECK FOR MAXIMUM USERS ALREADY LOGGED ONTO TSO                64530000
********                                                                64620000
CHKMAX   EQU   *                                                        64710000
         CLC   TIOCUSCT,TIOCNTSB        IS CURRENT NUMBER OF   @G36XRYP 64720000
*                                       USERS LESS THAN LIMIT  @G36XRYP 64730000
         BL    TSMHSRCH                 YES, BRANCH            @G36XRYP 64740000
         DROP  RCH                                             @G36XRYP 64750000
NOROOM   EQU   *                                                        65160000
         ICM   R1,7,LCBMHA              ASSUME PLCB AND GET    @Y17XAYP 65250000
*                                       MH ADDRESS             @Y17XAYP 65340000
         CLI   LCBFLAG1,LCBPLCB         IS THIS A PLCB         @Y17XAYP 65430000
         BE    RESETALT                 YES, BRANCH            @Y17XAYP 65520000
         L     R1,DCBMH-1               RESTORE OWNING MH ADDR   S22029 65610000
*                                       IF TJB IS UNAVAILABLE           65700000
RESETALT EQU   *                                               @Y17XAYP 65790000
         NI    QCBDSFLG,NOT-QCBALTMH    RESET ALT DEST FLAGS     S22029 65880000
         OI    AVTDOUBL,SCBNOVAC        SEND 'TRY LATER' MSG     S22029 65970000
         B     CHKMH                    ATTEMPT TO PROMPT        S22029 66060000
TSMHSRCH EQU   *                                                 S22029 66150000
*        TM    LCBSTAT1,LCBOCWTN        STOPLINE IN PROGRESS   @OY14092 66240000
*        BO    CONCAN                   YES, GET OUT           @OY14092 66330000
         TM    LCBSTAT1,LCBOCNI         STOPLINE IN PROGRESS   @OZ24216 66360082
         BO    CONCAN                   YES, CANCEL THIS MSG   @OZ24216 66390082
         TM    CURMHFG2,CURMHTS         IS CURRENT MH TSO        S22029 66420000
         BO    TURNON                   YES - INIT CTL BLKS      S22029 66510000
         NC    CURMHALT,CURMHALT        IS THERE AN ALTERNATE MH S22029 66600000
         BZ    CONCAN                   NO - CANCEL THIS MSG     S22029 66690000
         TM    ALTMHFG2,ALTMHTS         IS ALTERNATE MH TSO      S22029 66780000
         BZ    CONCAN                   NO - CANCEL THIS MSG     S22029 66870000
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 66960000
         BNO   NOPREF1                  NO, BRANCH             @Y17XAYP 67050000
         TM    TRMBYTE0,TRMSNA          IS THIS A SNA TERM     @Y17XAYP 67140000
         BO    CONCAN                   NO,CONTINUE PROCESSING @Y17XAYP 67230000
*                                       IN OWNING MH           @Y17XAYP 67320000
************************************************************** @Y17XAYP 67410000
*        ALTERNATE MH NOT PROVIDED FOR SNA TERMINALS           @Y17XAYP 67500000
************************************************************** @Y17XAYP 67590000
NOPREF1  EQU   *                                               @Y17XAYP 67680000
         OI    QCBDSFLG,QCBALTMH        SET ALTERNATE MH         S22029 67770000
         LR    R1,RIS                   MAKE ALT MH CURRENT      S22029 67860000
         SPACE 3                                                        67950000
* * * * * * * * * *  CONTROL BLOCK INITIALIZATION * * * * * * * * * * * 68040000
         SPACE 3                                                        68130000
********                                                                68220000
******** LOCATE TCT SO TO SET QCB BITS AND PASS TCT ADDRESS TO QTIP     68310000
********                                                                68400000
TURNON   EQU   *                                                        68490000
         L     RIS,AVTTSOPT             GET TSINPUT QCB ADDR   @Y17XAYP 68580000
******   MOVE THE DCT ENTRY TO TSWDCT IN TSO WORK AREA         @Y17XAYP 68670000
 IEDDCT  REG=RCH,FLD=TSITSW+TSWDCT-IEDQTSI-IEDQTSW(RIS),LEN=6  @Y17XAYP 68760000
         SPACE 3                                                 S22025 69120000
********                                                                69210000
******** ZERO VARIOUS QCB FIELDS                                        69300000
********                                                                69390000
         MVI   QCBRETCT,AVTEZERO        ZERO LOGON RETRY COUNT   S22025 69480000
         MVI   QCBSATCT,AVTEZERO        ZERO SIM ATTN LINE CT    S22025 69570000
         MVI   QCBTSOF1,AVTEZERO        ZERO QCB TSO FLAGS       S22025 69660000
         MVI   QCBTSOF2,AVTEZERO        ZERO QCB TSO FLAGS       S22025 69750000
         MVI   QCBCARCT,AVTEZERO        ZERO CARRIAGE POS COUNT  S22025 69840000
         SPACE 3                                                 S22025 69930000
********                                                                70020000
******** SET NECESSARY QCB BITS                                         70110000
********                                                                70200000
         TM    E1(RCH),DCT3270          IS THIS A 3270 TRM     @G36XRYP 70290000
         BZ    CHKREST                  NO - CONT QCB INIT       S22028 70380000
         OI    QCBRETCT,QCBIEND         SET QCBIEND ON FOR       S22028 70470000
*                                       SCREEN FORMAT ON OUTPUT         70560000
CHKREST  EQU   *                                                 S22028 70650000
         TM    E1(RCH),DCTINHIB         IS CINHIBIT ON         @G36XRYP 70740000
         BZ    CALLMGCR                 NO - LEAVE QCBINHBN ZERO S22025 70830000
         OI    QCBTSOF2,QCBINHBN        USE OF INHIBIT OK        S22025 70920000
         SPACE 3                                                        71010000
************************************************************** @G36XRYP 71030000
*        START LOGON PROCESS VIA SVC 34 (MGCR)                 @G36XRYP 71050000
************************************************************** @G36XRYP 71070000
CALLMGCR EQU   *                                                 S22025 71370000
********                                                       @G36XRYP 71375000
******** ISSUE MGCR MACRO AND CHECK RETURN CODE                @G36XRYP 71380000
********                                                                71385000
         LA    RTERM,TRMPRFSZ(RTERM)    SET UP TRM FOR QTIP    @YM08512 71390000
         MVC   PRFSRCE,AVTDOUBL+4       SET UP INDEX FOR IEDAYLL S22029 71460000
         LR    RIS,R1                   SAVE MH QCB ADDR         S22029 71550000
         L     R0,MGCRMASK              GET MASK FOR SVC 34    @ZM47806 71559000
         LA    R1,CIB                   POINT TO COMMAND BFR   @G36XRYP 71568000
         MGCR  (1)                                             @G36XRYP 71577000
         LTR   R15,R15                  IS LOGON POSSIBLE      @G36XRYP 71586000
         BNZ   UNINIT                   NO, UNDO INIT          @G36XRYP 71595000
         STH   R0,QCBTJID               PUT ASID IN QCB        @G36XRYP 71604000
********                                                                71613000
******** TSO CONTROL BLOCK INIT - CALL QTIP ENTRY 10 (IEDAYLL)          71622000
********                                                                71631000
         LA    R1,AVTECD12(0,R13)       GET SAVE AREA FOR QTIP   S22029 71640000
         QTIP  LOGON,(1)                INIT TSO CONTROL BLOCKS         71730000
         LA    R1,TRMPRFSZ              TRM PREFIX SIZE        @YM08512 71740000
         SR    RTERM,R1                 BACK TRM ADDR TO PREF  @YM08512 71750000
         LR    R1,RIS                   RESTORE MH QCB ADDR      S22029 71820000
         SPACE 3                                                        71910000
********                                                                72000000
******** SEE IF QTIP FOUND A FREE TSB - IF SO, SET QCBTSSES    @ZM46725 72090000
********                                                                72180000
         LTR   R15,R15                  ANY FREE TSB           @ZM46725 72270000
         BZ    TSOGO                    YES - END CTL BLK INIT @ZM46725 72310000
UNINIT   EQU   *                                               @G36XRYP 72400000
         MVI   QCBTSOF2,AVTEZERO        UNDO PREVIOUS INIT       S22025 72450000
         B     NOROOM                   GO SEND 'MAX USERS' MSG  S22025 72540000
TSOGO    EQU   *                                                 S22025 72630000
         OI    QCBFLAG,QCBTSSES         MAKE SURE TSO IND IS ON         72810000
         SPACE 3                                                        72900000
* * * * * * * * * * * 3705 MODE INITIALIZATION * * * * * * * * * * * *  72990000
         SPACE 3                                                        73080000
********                                                                73170000
******** FOR 3705, SET DEVICE MODE BITS                                 73260000
********                                                                73350000
         TM    TRMDEVFL+1,TRMRNTRM      IS THIS A 3705 LINE             73440000
         BNO   DONE3705                 NO, DO NOTHING                  73530000
         TM    TRMSTATE,TRMOPTFN        ANY OPTION FLDS         Y06327  73620000
         LA    R14,TRMOPNO              ASSUME NONE                     73710000
         BNO   NOOPTION                 BRANCH ON NO OPTION FLDS Y06327 73800000
         SR    R15,R15                  CLEAR REGISTER FOR IC    Y06327 73890000
         IC    R15,TRMOPNO              NUMBER OF OPTION FIELDS  Y06327 73980000
         LA    R14,TRMOPT(R15)          SKIP OPTION FIELDS       Y06327 74070000
NOOPTION EQU   *                                                 Y06327 74160000
         LH    R15,TRMDEVFL             GET DEVICE DEP FLAGS     Y06327 74250000
         LA    R13,ELEVEN               SET FOR BIT SEARCH       Y06327 74340000
         SLL   R15,16                   SHIFT BITS TO HIGH ORDER Y06327 74430000
*                                       TWO BYTES                Y06327 74520000
         SR    RWORK5,RWORK5            CLEAR REGISTER FOR IC    Y06327 74610000
SHIFT    EQU   *                                                 Y06327 74700000
         LTR   R15,R15                  IS BIT PRESENT           Y06327 74790000
         BNM   CHKCOUNT                 BRANCH ON NO             Y06327 74880000
         LA    RWORK5,E1(RWORK5)        NUMBER OF BITS FOUND     Y06327 74970000
CHKCOUNT EQU   *                                                 Y06327 75060000
         SLL   R15,1                    SHIFT TO CHECK NEXT BIT  Y06327 75150000
         BCT   R13,SHIFT                HAVE ALL BITS BEEN CHKED Y06327 75240000
         LTR   RWORK5,RWORK5            ANY DEV DEP FIELDS       Y06327 75330000
         BZ    SETMODE                 NO GO SET DEV MODE FIELDS Y06327 75420000
         SR    R13,R13                  CLEAR REGISTER FOR IC    Y06327 75510000
SKIP     EQU   *                                                 Y06327 75600000
         IC    R13,AVTEZERO(,R14)       GET DEV DEP FIELD LENGTH Y06327 75690000
         LA    R14,E1(R13,R14)          SKIP OVER FIELD          Y06327 75780000
         BCT   RWORK5,SKIP              SKIP TO NEXT FIELD       Y06327 75870000
SETMODE  EQU   *                                                 Y06327 75960000
         LA    R14,E3(R14)              GET DEV DEP FOR SETMODE  Y06327 76050000
         LA    R13,AVTSAVE3             RESTORE SAVEAREA ADDRESS Y06327 76140000
********                                                                76230000
******** SET MODE BIT FOR MONITOR MODE, AND BIT FOR TIMEOUT-SUPPRESSION 76320000
******** DEPENDING ON DCT SETTING                                       76410000
********                                                                76500000
         OI    TRMPRE,TRMCMODE          INDICATE SET MODE REQD @Y17XAYP 77040000
         OI    E1(R14),STMONITR         SET MONITOR MODE        YS06327 77220000
         TM    E1(RCH),DCTINHIB         IS INHIBIT SET IN DCT  @G36XRYP 77310000
         BNO   NOINHB                   NO, GO TURN OFF FLAG            77400000
         OI     E1(R14),SETINHB         SET T.O. SUPPRESS FLAG   Y06327 77490000
         B     DONE3705                 DONE WITH SPECIAL STUFF         77580000
NOINHB   EQU   *                                                        77670000
         NI    E1(R14),NOT-SETINHB      OFF T.O. SUPRESS FLAG           77760000
DONE3705 EQU   *                                                        77850000
         SPACE 3                                                 S22029 77940000
********                                                                78030000
******** REMOVE QCB FROM TIME-DELAY QUEUE, IF NECESSARY                 78120000
********                                                                78210000
         TM    QCBTSOF1,QCBDELAY        IS QCB IN DELAY QUEUE    S22029 78300000
         BZ    NODELAY                  NO - CONTINUE            S22029 78390000
         LR    RIS,R1                   SAVE CURRENT MH'S QCB    S22029 78480000
         LR    R1,RQCB                  PASS QCB ADDR TO TIME    S22029 78570000
*                                       DELAY REMOVAL RTN               78660000
         L     R15,AVTHG02              GET ADDR OF T.D.R. RTN   S22029 78750000
         BALR  R14,R15                  GO REMOVE ELEMENT        S22029 78840000
         LR    R1,RIS                   RESTORE CURR MH'S QCB    S22029 78930000
         NI    QCBSTAT,NOT-QCBTIME      RESET REQUEST FOR ADDTL  S22029 79020000
*                                       12-HOUR REQUEST                 79110000
NODELAY  EQU   *                                                 S22029 79200000
         SPACE 3                                                 S22029 79290000
********                                                                79380000
******** REMOVE QCB FROM DIALOUT CALL QUEUE, IF NECESSARY               79470000
********                                                                79560000
         TM    LCBSTAT2,LCBDIAL         IS THIS A DIAL LINE      S22029 79650000
         BZ    NODIALQ                  NO - SKIP CALLQ CODE     S22029 79740000
         TM    TRMSTATE,TRMPREF         IS TERM VIA 3705       @Y17XAYP 79830000
         BO    NODIALQ                  YES - SKIP CALLQ CODE           79920000
         TM    QCBDSFLG,QCBDISK+QCBCORE PORT DEDICATED TO TSO    S22029 80010000
         BZ    NODIALQ                  YES - SKIP CALLQ CODE    S22029 80100000
         L     R15,DCBIOBAD             FIRST IOB IN LINE GROUP  S22029 80190000
         SR    R14,R14                  ZERO REG FOR IC INSTR    S22029 80280000
         IC    R14,DCBEIOBX             LCB SIZE                 S22029 80370000
         AR    R15,R14                  ADDR OF DESIRED LCB      S22029 80460000
         SH    R15,DIALOUT              BACK UP TO BEGINNING OF  S22029 80550000
*                                       FIRST LCB MINUS 8 BYTE          80640000
*                                       PREFIX TO CALLQ                 80730000
         LA    RIS,QCBSTVTO             UPDATE QCB ADDR TO QCB'S S22029 80820000
*                                       STCB ADDR FOR COMPARE           80910000
*                                       WITH QCBS ON CALLQ              81000000
         USING IEDQSTCB,R14                                      S22029 81090000
LOOPCALL EQU   *                                                 S22029 81180000
         LR    R14,R15                  UPDATE PEVIOUS STCB ADDR S22029 81270000
*                                       WITH CURRENT STCB ADDR          81360000
         L     R15,STCBLINK-1           GET NEXT STCB FOR        S22029 81450000
*                                       NEXT QCB ON CALLQ               81540000
         CLI   STCBPRI-IEDQSTCB(R15),AVTEZERO     END OF CALLQ   S22029 81630000
         BE    NODIALQ                  YES - CONTINUE           S22029 81720000
         LA    R15,0(0,R15)             CLEAR HI BYTE OF QCB'S   S22029 81810000
*                                       STCB ADDR FOR COMPARE           81900000
         CLR   R15,RIS                  IS THIS QCB FOR THE      S22029 81990000
*                                       TERMINAL LOGGING ONTO TS        82080000
         BNE   LOOPCALL                 NO - CONTINUE CALLQ SRCH S22029 82170000
         MVC   STCBLINK(E3),STCBLINK-IEDQSTCB(R15)     REMOVE    S22029 82260000
*                                       THIS QCB FROM THE CALLQ         82350000
         SPACE 3                                                 S22029 82440000
********                                                                82530000
******** SETUP QCB FOR SEND OPERATION                                   82620000
********                                                                82710000
MOVESCH  EQU   *                                                 S22029 82800000
         DROP  R14                                               S22029 82890000
         USING IEDQTSI,R14                                       S22029 82980000
         L     R14,AVTTSOPT             GET TSINPUT QCB          S22029 83070000
         MVC   QCBSLINK(E3),TSITSDST+1  SET UP TSO DEST SCHED    S22029 83160000
NODIALQ  EQU   *                                                 S22029 83250000
         CLC   QCBSTCHN(E3),QCBSLINK    IS QCB SET UP FOR SEND   S22029 83340000
         BNE   SENDPRI                  SET UP SEND PRIORITY     S22029 83430000
         LA    R15,QCBSTCHN-1           DENOTE INVOKE SEND SCHED S22029 83520000
         IC    R14,QCBSTCHN-1           SAVE INDEX               S22029 83610000
         ST    R15,QCBSTCHN-1           SEND SCHED WILL BE       S22029 83700000
*                                       INVOKED VIA INDEX               83790000
         STC   R14,QCBSTCHN-1           RESTORE INDEX            S22029 83880000
SENDPRI  EQU   *                                                 S22029 83970000
         MVI   QCBPRI,PRIDSKRQ          SET UP SEND PRIORITY     S22029 84060000
         SPACE 3                                                        84150000
********                                                                84240000
******** ROUTE THIS BUFFER TO TSO                                       84330000
********                                                                84420000
SETTSIN  EQU   *                                                 S22029 84510000
         L     RIS,AVTTSOPT             GET ADDR OF TSINPUT QCB  S22029 84600000
         B     SETDEST                  SET UP THIS TERMINAL'S   S22029 84690000
*                                       DESTINATION AND SOURCE          84780000
         SPACE 3                                                 S22029 84870000
********                                                                84960000
******** LEAVE - CONTINUE INHDR PROCESSING                              85050000
********                                                                85140000
         USING ALTMHQCB,RIS             ADDRESSABILITY AFTER            85230000
*                                       PREVIOUS CODE WIPED IT OUT      85320000
CHKMH    EQU   *                                                 S22029 85410000
         TM    CURMHFG2,CURMHTS         IS CURRENT MH TSO        S22029 85500000
         BO    SENDMSG                  YES - PROMPT USER        S22029 85590000
         NC    CURMHALT,CURMHALT        IS THERE AN ALTERNATE MH S22029 85680000
         BZ    BYEBYE                   NO - CANNOT PROMPT USER  S22029 85770000
         L     RIS,CURMHALT-1           GET ADDR OF ALT MH       S22029 85860000
         TM    ALTMHFG2,ALTMHTS         IS ALT MH TSO            S22029 85950000
         BZ    BYEBYE                   NO - CANNOT PROMPT USER  S22029 86040000
BADCIN   EQU   *                                                 S99228 86130000
         LR    R1,RIS                   USE ALT MH TO PROMPT     S22029 86220000
CONCAN   EQU   *                                                 S22029 86310000
         TM    CURMHFG2,CURMHTS         IS CURRENT MH TSO        S22029 86400000
         BZ    BYEBYE                   NO - LEAVE INPUT DEST    S22029 86490000
*                                       ADDR INTACT                     86580000
SENDMSG  EQU   *                                                 S22029 86670000
         OC    SCBERRST,AVTDOUBL        PUT BITS INTO SCB        S22029 86760000
         LA    RIS,AVTBFRTB             ADDRESS OF BUFFER RETURN S22029 86850000
SETDEST  EQU   *                                                 S22029 86940000
         IC    RCH,SCBDESTQ-1           SAVE HIGH-ORDER BYTE     S22029 87030000
         ST    RIS,SCBDESTQ-1           SETUP BUFFER RETURN FOR  S22029 87120000
*                                       INPUT DESTINATION               87210000
         STC   RCH,SCBDESTQ-1           RESTORE HIGH-ORDER BYTE  S22029 87300000
         NC    AVTDOUBL+4(E2),AVTDOUBL+4     CONNECT INDEX FOUND S22029 87390000
         BZ    BYEBYE                   NO - DON'T SET UP LINE   S22029 87480000
*                                       WITH CONNECT INDEX              87570000
         MVC   LCBTTCIN,AVTDOUBL+4      SET LINE CONNECT INDEX   S22029 87660000
         MVC   PRFSRCE,LCBTTCIN         SET LINE CONNECT INDEX   S22029 87750000
BYEBYE   EQU   *                                                 S22029 87840000
         L     R13,AVTECD4(0,R13)       RESTORE SAVE AREA ADDR   S22029 87930000
         L     R14,CURMHLEX-1           LOGON EXIT ADDRESS       S22029 88020000
         LA    R2,ELEVEN                USE REG 2 TO BACK UP     S22029 88110000
         SR    R14,R2                   POINT TO PARM BYTE       S22029 88200000
         TM    AVTEZERO(R14),INBLOCK    IS LOGON IN INBLOCK      S22029 88290000
         BZ    NOTINBLK                 NO, BRANCH               S22029 88380000
         NI    SCBSTATE,AVTEFF-SCBCODE  TURN OFF CODE BIT        S22029 88470000
NOTINBLK EQU   *                                                 S22029 88560000
         AR    R14,R2                   RESET REG 14             S22029 88650000
         LH    R2,KON4K                 GET 4K BASE ADDR INCR    S22029 88740000
         LM    RSCB,RBASE,E32(R13)      RESTORE REGS             S22029 88830000
         MVI   AVTECD12(R13),AVTEFF     SET AVAILABILITY BYTE    S22029 88920000
         SR    RBASE,RBASE              ZERO REG FOR IC INSTR    S22029 89010000
         IC    RBASE,CURMHLEN           LNG OF QCB PRECEDING MH  S22029 89100000
         LA    RBASE,0(R1,RBASE)        POINT PAST QCB TO MH     S22029 89190000
         BR    R14                      CONT INHDR PROCESSING    S22029 89280000
         SPACE 3                                                        89370000
********                                                                89460000
******** CONSTANTS                                                      89550000
********                                                                89640000
BLANKIT  MVC   E1(0,RAT),0(RAT)         BLANK GARBAGE                   89730000
DIALOUT  DC    AL2(LCBFLAG1-IEDQLCB+8)  OFFSET FROM IOB OF FIRST S22029 89820000
*                                       LCB FOR THIS LINE GROUP         89910000
*                                       TO DIALOUT CALLQ PREFIX         90000000
MGCRMASK DS    0F                       FORCE FULLWORD BNDRY   @G36XRYP 90010000
         DC    X'80001000'              MASK FOR SVC 34        @G36XRYP 90020000
CIB      DS    0A                       FORCE FULLWORD BNDRY   @G36XRYP 90030000
         DC    AL2(CIBEND-CIB)          LENGTH                 @G36XRYP 90040000
         DC    XL2'0'                                          @G36XRYP 90050000
         DC    C'LOGON '                LOGON,BLANK            @G36XRYP 90060000
CIBEND   EQU   *                                               AG36XRYP 90070000
KON1     DC    H'1'                     GIVES A VALUE OF 1              90090000
KON5     DC    H'5'                     GIVES A VALUE OF 5              90180000
KON6     DC    H'6'                     GIVES A VALUE OF 6       S22029 90270000
KON72    DC    H'72'                    GIVES A VALUE OF 72             90360000
KON4K    DC    H'4096'                  4K INCREMENT             S22029 90450000
         SPACE 3                                                        90540000
********                                                                90630000
******** 'OGON' IN LOWER AND UPPERCASE EBCDIC, RESPECTIVELY             90720000
********                                                                90810000
LOGCON   EQU   *                                                        90900000
         DC    X'96'                    LOWERCASE 'O'                   90990000
         DC    C'O'                     UPPERCASE 'O'                   91080000
         DC    X'87'                    LOWERCASE 'G'                   91170000
         DC    C'G'                     UPPERCASE 'G'                   91260000
         DC    X'96'                    LOWERCASE 'O'                   91350000
         DC    C'O'                     UPPERCASE 'O'                   91440000
         DC    X'95'                    LOWERCASE 'N'                   91530000
         DC    C'N'                     UPPERCASE 'N'                   91620000
         DC    C'X'                     MARKS THE END OF 'LOGCON'       91710000
         SPACE 3                                                 S22029 91800000
********                                                                91890000
******** 'CAMON' IN LOWER AND UPPERCASE EBCDIC, RESPECTIVELY            91980000
********                                                                92070000
TCAMCON  EQU   *                                                 S22029 92160000
         DC    X'83'                    LOWERCASE 'C'            S22029 92250000
         DC    C'C'                     UPPERCASE 'C'            S22029 92340000
         DC    X'81'                    LOWERCASE 'A'            S22029 92430000
         DC    C'A'                     UPPERCASE 'A'            S22029 92520000
         DC    X'94'                    LOWERCASE 'M'            S22029 92610000
         DC    C'M'                     UPPERCASE 'M'            S22029 92700000
         DC    X'96'                    LOWERCASE 'O'            S22029 92790000
         DC    C'O'                     UPPERCASE 'O'            S22029 92880000
         DC    X'95'                    LOWERCASE 'N'            S22029 92970000
         DC    C'N'                     UPPERCASE 'N'            S22029 93060000
         DC    C'X'                     MARKS END OF 'TCAMCON'   S22029 93150000
AYLPATCH DC    20F'0'                                            S22029 93240000
         SPACE 3                                                        93330000
* * * * * * * * * * * *  CONTROL BLOCK DSECTS * * * * * * * * * * * * * 93420000
         SPACE 3                                                        93510000
         TAVTD                                                          93600000
         SPACE 3                                                 S22029 93690000
CVT      DSECT                                                          93780000
         CVT                                                            93870000
         SPACE 3                                                 S22029 93960000
         DCBD  DSORG=TX                                          S22029 94050000
         SPACE 3                                                 S22029 94140000
         TLCBD                                                          94230000
         SPACE 3                                                 S22029 94320000
******** PARAMETER LISTS                                                94410000
         SPACE 3                                                 S22029 94500000
LOGPARM  DSECT                                                          94590000
         SPACE 2                                                 S22029 94680000
LOGPLEN  DS    AL1                      LENGTH OF PARAMETER LIST S22029 94770000
LOGPINDX DS    AL1                      INDEX TO ROUTINE         S22029 94860000
LOGPRSVR DS    AL2                      RESERVED                 S22029 94950000
         DS    AL1                      RESERVED                 S22029 95040000
LOGPMH   DS    AL3                      ADDR OF CURRENT MSG      S22029 95130000
*                                       HANDLER PROCESSING LOGON        95220000
         SPACE 3                                                 S22029 95310000
CURMHQCB DSECT                                                          95400000
         SPACE 2                                                 S22029 95490000
CURMHFG1 DS    AL1                      FLAG BYTE - UNUSED       S22029 95580000
CURMHALT DS    AL3                      ADDR OF ALTERNATE MH     S22029 95670000
CURMHFG2 DS    AL1                      FLAG BYTE                S22029 95760000
*        BIT DEFINITIONS                                                95850000
CURMHTS  EQU   X'01'                    INDICATES A TSO MH       S22029 95940000
CURMHLEX DS    AL3                      EXIT ADDRESS OF LOGON    S22029 96030000
*                                       MACRO IN THIS MH                96120000
CURMHLEN DS    AL1                      LENGTH OF STARTMH QCB    S22029 96210000
         SPACE 3                                                 S22029 96300000
ALTMHQCB DSECT                                                          96390000
         SPACE 2                                                 S22029 96480000
ALTMHFG1 DS    AL1                      FLAG BYTE - UNUSED       S22029 96570000
ALTMHALT DS    AL3                      ADDR OF ALTERNATE MH     S22029 96660000
ALTMHFG2 DS    AL1                      FLAG BYTE                S22029 96750000
*        BIT DEFINITIONS                                                96840000
ALTMHTS  EQU   X'01'                    INDICATES A TSO MH       S22029 96930000
ALTMHLEX DS    AL3                      EXIT ADDRESS OF LOGON    S22029 97020000
*                                       MACRO IN THIS MH                97110000
ALTMHLEN DS    AL1                      LENGTH OF STARTMH QCB    S22029 97200000
         SPACE 3                                               @Y17XAYP 97290000
         TDCTD                                                          97380000
         SPACE 3                                                 S22029 97470000
         TPRFD                                                          97560000
         SPACE 3                                                 S22029 97650000
         TPRIOR                                                         97740000
         SPACE 3                                                 S22029 97830000
         TQCBD                                                          97920000
         SPACE 3                                                 S22029 98010000
         TSCBD                                                          98100000
         SPACE 3                                               @Y17XAYP 98190000
         TSIBD                                                          98280000
         SPACE 3                                                 S22029 98370000
         TSTCBD                                                         98460000
         SPACE 3                                               @G36XRYP 98550000
         TTCXD                                                          98580000
         SPACE 3                                                        98610000
         TTRMD                                                          98640000
         SPACE 3                                               @G36XRYP 98730000
         IKJTIOCP                                                       98820000
         SPACE 3                                                 S22029 98910000
         TTSID                                                          99000000
         SPACE 3                                               @Y17XAYP 99090000
         TTSWD                                                          99180000
         END                                                            99270000
