         TITLE 'IEDAYLL - TIOC LOGON QTIP'                              00200002
IEDAYLL  CSECT                                                          00400020
         ENTRY QTIP0100                                                 00600020
         DC    C'IEDAYLL '              MODULE ID                       00640000
         DC    X'7346'             JULIAN DATE-12/12/77        @Z37XBYT 00660000
         DS    0H                                                       00680000
         SPACE 3                                                        00800020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00900020
*                                                                     * 01000020
*                                                                     * 01100020
*    NAME - IEDAYLL, TIOC LOGON'S SECTION OF QTIP SVC                 * 01200020
*                                                               ZA25074 01210000
*A270600,428360,429600,632000,812900                            ZA25074 01220000
*C254000,332500,428340,429700,438600,440000,550500,576000       ZA25074 01230000
*C588000,594500                                                 ZA25074 01240000
*D428380-428397                                                 ZA25074 01250000
*A546000                                                       @Z37XBYT 01260000
*                                                                     * 01300020
*    VS/2-2 ACTIVITY                                                  * 01350002
*                                       02/19/73                VS00022 01360002
*                                       07/02/73                YM01114 01362002
*    VS2-3.0 ACTIVITY                                                 * 01364003
*C006800,194500                         08/22/74                ZA00966 01366003
*                                                                     * 01366300
*              VS2 - 037   ACTIVITY                            @ZA12511 01366600
*                                                              @ZA12511 01366900
*                                                              @ZA12511 01367200
*  A 272XXX                                                     ZA12511 01367500
*                                                              @ZA12511 01367800
*    VS2-MVS SU ACTIVITY                                              * 01368100
* A 132500,134700,166500,260500-261500   07/15/76       G32TKKM ZA16608 01368400
* A 632221-632234,779640,779660,809100   07/15/76       G32TKKM ZA16608 01368700
* A 809200                               07/15/76       G32TKKM ZA16608 01369000
*                                                                     * 01370002
*    RELEASE 21 DELETIONS/CHANGES                                     * 01600020
*1374006800,439200,441000,443000,450000,478000,504000,530000,    S22028 01630002
*1374536000,546000,550000                                        S22028 01660002
*    RELEASE 20 DELETIONS/CHANGES                                     * 01700020
*                                                                TS1623 01800020
*                                                                 M2668 01900020
*                                                                 M2725 02000020
*                                                                 M4540 02100020
*0000006800,290000,330000                                        M5446  02150020
**************************************************************  ZA25074 02156000
* MODULE NAME = IEDAYII  (QTIP,TSO)                             ZA25074 02162000
*                                                               ZA25074 02170000
* DESCRIPTIVE NAME = TIOC LOGON ROUTINE IN QTIP SVC             ZA25074 02176000
*                                                               ZA25074 02182000
* STATUS = TCAM VERSION 10.0                                    ZA25074 02188000
*                                                                     * 02500020
* FUNCTION -                                                          * 02600020
*    PREPARE TSO CONTROL BLOCKS FOR A NEW USER                        * 02700020
*                                                                     * 02900020
* ENTRY POINTS -                                                      * 03000020
*         IEDAYLL, TO PERFORM LOGON PROCESSING THAT REQUIRES THE      * 03100002
*         LOCAL AND CMS LOCKS.                                        * 03150002
*                                                                     * 03200020
* INPUT -                                                             * 03300020
*    REGISTER  4 HAS LCB ADDRESS                                      * 03500020
*    REGISTER  6 HAS TCAM BUFFER ADDRESS                              * 03600020
*    REGISTER  7 HAS QCB ADDRESS                                      * 03700020
*    REGISTER  8 HAS TERMINAL ENTRY ADDRESS                           * 03800020
*    REGISTER 10 HAS TERMINAL CHARACTERISTICS TABLE ADDRESS           * 03900020
*    REGISTER 12 HAS BASE ADDRESS                                     * 04000020
*    REGISTER 14 HAS RETURN ADDRESS                                   * 04100020
*                                                                     * 04200020
* OUTPUT -                                                            * 04300020
*    REGISTER 15 CONTAINS RETURN CODE                                 * 04320002
*       0 - A TSB-ASCB PAIR HAS BEEN INITIALIZED                      * 04330002
*       4 - NO TSB FOUND, OR TS STOPPED - USER 'SICED'                * 04340002
*                                                                     * 04600020
* EXTERNAL REFERENCES -                                               * 04700020
*         POST, VIA BRANCH ENTRY AT CVT0PT01                          * 04800020
*         SYSTEM-INITIATED CANCEL VIA BRANCH                          * 04840002
*                                                                     * 04900020
* EXITS, NORMAL - BR 14, RETURN TO IEDAYL VIA IDAYQT                  * 04920002
*                                                                     * 04930002
* EXITS, ERROR  - NONE                                                * 04940002
*                                                                     * 05500020
* TABLES/WORK AREAS -                                                 * 05600020
*    CONTROL BLOCKS ARE DESCRIBED IN THE DSECTS AT END OF LISTING     * 05700020
*                                                                     * 05800020
* ATTRIBUTES -                                                        * 05900020
*    REENTRANT, REFRESHABLE, SUPERVISOR STATE, HOLDS TCAM'S KEY       * 05920002
*    AND KEY 0                                                        * 05930002
*                                                                     * 06100020
* CHARACTER CODE DEPENDENCY -                                         * 06200020
*    THE OPERATION OF THIS MODULE IS DEPENDENT  UPON CERTAIN INTERNAL * 06300020
*    REPRESENTATIONS OF ITS CHARACTER SET...IT IS ASSEMBLED IN EBCDIC * 06400020
*    AND MUST BE SPECIALLY MODIFIED IF RE-ASSEMBLY IN ANOTHER CHARAC- * 06500020
*    TER SET IS DESIRED.....THE FIELDS REQUIRE THIS TREATMENT BECAUSE * 06600020
*    THEY ARE REPRESENTED BY HEX VALUES AND ARE OTHERWISE UNPRINTABLE * 06700020
*    THESE FIELDS ARE - TWXLD, TWXCD, AND T4150CD                     * 06800020
*                                                                     * 06900020
* NOTES -                                                             * 07000020
*    REGISTER EQUATES START WITH 'R'                                  * 07100020
*    LENGTH AND DISPLACEMENT EQUATES START WITH 'E'                   * 07200020
*                                                                     * 07300020
*                                                                     * 07400020
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07500020
         EJECT                                                          12400020
********                                                                12600020
******** REGISTERS                                                      12800020
********                                                                13000020
R0       EQU   0                        REGISTER 0              YS02019 13050002
RTERM    EQU   1                        TERMINAL ENTRY ADDR             13200020
RLNTH    EQU   1                   LENGTH OF TERM ID            ZA16608 13250000
RTCX     EQU   2                        TCX ADDRESS             YS02019 13460002
RAVT     EQU   2                   TCAM AVT ADDRESS             ZA16608 13470000
RASCB    EQU   3                        ASCB ADDRESS            YS02019 13490002
RLCB     EQU   4                        LCB ADDRESS                     13800020
RUCB     EQU   5                        UCB ADDRESS                     14000020
RBUF     EQU   6                        BUFFER ADDRESS                  14200020
RWORKA   EQU   6                        WORK REGISTER                   14400020
RQCB     EQU   7                        QCB ADDRESS                     14600020
RWORKB   EQU   7                        WORK REGISTER                   14800020
RRPT     EQU   8                        TIOCRPT ADDR AND TERMINAL ENTRY 14900020
*                                       ADDR AT ENTRY                   15000020
RTSB     EQU   9                        TSB ADDRESS                     15200020
RCH      EQU   10                       WORK REG & TCT ADDR AT ENTRY    15400020
RIS      EQU   11                       WORK REGISTER                   15600020
RBASE    EQU   12                       BASE ADDRESS                    15800020
R13      EQU   13                       TJID FOR POST ROUTINE           16000020
R14      EQU   14                       RETURN ADDRESS                  16200020
R15      EQU   15                       POST ADDR & PASS TJID TO IEDAYL 16400020
RTCT     EQU   15                       TCT ADDRESS                     16600020
RTNT     EQU   15                  TNT ENTRY ADDRESS            ZA16608 16650000
         SPACE 3                                                        16800020
********                                                                17000020
******** MASKS                                                          17200020
********                                                                17400020
E0       EQU   0                        GIVE OFFSET OF 0         Y06327 17450002
E1       EQU   1                        GIVES A VALUE OF 1              17800020
E2       EQU   2                        GIVES A VALUE OF 2              18000020
E3       EQU   3                        GIVES A VALUE OF 3              18200020
E4       EQU   4                        GIVES A VALUE OF 4              18400020
E16      EQU   16                       GIVES VALUE OF 16       ZA25074 18420000
TIMES4   EQU   2                        SHIFT VALUE FOR TIMES 4 YS02019 18450002
E100     EQU   100                      GIVES A VALUE OF 100            18800020
DEBEXSCL EQU   2                        COMM DEVICE DEB EXTENT SCALE    19200020
DEBSIZE  EQU   32                       SIZE OF BASIC SECTION OF DEB    19400020
NOFLAGS  EQU   X'0F'                    ZEROS UCB CHANNEL FLAGS ZA00966 19450003
MODEL    EQU   16                       OFFSET TO UCB MODEL FIELD       19600020
UNITTYPE EQU   19                       OFFSET TO UCB UNIT TYPE FIELD   19800020
TELE     EQU   X'50'                    TELEGRAPH ADAPTER (UCB)         20100020
C1050    EQU   X'80'                    1050 TERMINAL (TCT)      Y06327 20400002
TERMADPT EQU   X'10'                    ADAPTER FOR 1050 TERMINAL (UCB) 20600020
NON1050A EQU   X'E0'                    ADAPTER FOR NON-1050 TERM (UCB) 20800020
TWX      EQU   X'20'                    TWX TERMINAL (TCT)              21000020
C2260    EQU   X'02'                    2260 TERMINAL (TCT)             21200020
C3270    EQU   X'04'                    3270 TERMINAL (TCT)      S22028 21300002
C2741    EQU   X'08'                    2741 TERMINAL (TCT)             21400020
C5041    EQU   X'10'                    1050/2741 LINE (TCT)            21430020
TELELNSZ EQU   72                       LINE SIZE OF TELEGRAPH TERMINAL 21460020
REGLNSZ  EQU   120                      LINE SIZE OF NON-TELEGRAPH TERM 21520020
TWXLD    EQU   X'18'                    LD CHAR FOR TWX                 21600020
TWXCD    EQU   X'6D'                    CD CHAR FOR TWX                 21800020
T4150CD  EQU   X'16'                    CD CHAR FOR 2741 AND 1050       22000020
NODEFALT EQU   X'00'                    DENOTES NO LD/CD DEFAULT CHARS  22200020
TMMASK   EQU   X'80'                    TESTS TRMDEVFL BITS             22400020
NOMASK   EQU   X'00'                    NULL MASK FOR EX TM INSTR       22600020
BITPOS7  EQU   7                        POS OF SCRSIZE BIT IN TRMDEVFL  22900020
NOT      EQU   X'FF'                    TURNS OFF VARIOUS BITS          23400020
         SPACE 3                                                        23600020
* * * * * * * * * * * * *  SET UP ADDRESSES * * * * * * * * * * * * * * 23800020
         SPACE 3                                                        24000020
********                                                                24200020
******** ESTABLISH ADDRESSABILITY                                       24400020
********                                                                24600020
QTIP0100 EQU   *                                                        24800020
         USING *,RBASE                                                  25000020
         LR    RTERM,RRPT               TERM ENT ADDR PASSED IN RRPT    25200020
         USING IEDNTRM,RTERM                                    ZA25074 25250000
         L     RTCX,CVTPTR              GET PTR TO CVT          YS02019 25440002
         L     RTCX,CVTAQAVT-CVT(,RTCX) GET PTR TO TCX          YS02019 25460002
         USING IEDQTCX,RTCX                                     YS02019 25480002
         L     RRPT,TCXRPT              RPT PTR FROM TCX        YS02019 25500002
         USING TIOCRPT,RRPT                                             26000020
         L     RAVT,TCXAVT         GET ADDRESS OF AVT           ZA16608 26050000
         DROP  RTCX                TCX NO LONGER NEEDED         ZA16608 26100000
         USING IEDQAVTD,RAVT       AVT IS ADDRESSABLE           ZA16608 26150000
         USING IEDQLCB,RLCB             LCB ADDR PASSED BY IEDAYL       26600020
         USING IEDQPRF,RBUF             TCAM BFR ADDR PASSED BY IEDAYL  26800020
         USING IEDQQCB,RQCB             QCB ADDR PASSED BY AYL  YS02019 26850002
         LR    RTCT,RCH                 SAVE TCT ADDR PASSED BY IEDAYL  27000020
         SPACE 3                                                YS02019 27010002
********                                                                27045002
******** FIND AN UNUSED TSB, AND USE IT.                                27050002
********                                                                27055002
         L     RTSB,TIOCTSB-E1          INITIAL POINTER         YS02019 27060002
         LA    RCH,TRMPRFSZ             GET SIZE OF TTE INDEX   ZA25074 27061000
         SR    RTERM,RCH                BACK UP TO TTE PREFIX   ZA25074 27062000
         SR    RCH,RCH                  FOR INSERTION           YS02019 27065002
         IC    RCH,TIOCTSBS             GET TSB SIZE            YS02019 27067002
         LR    R0,RCH                   SAVE SIZE               YS02019 27070002
         LH    RIS,TIOCNTSB             GET NO. OF TSB'S        YS02019 27080002
         BCTR  RIS,0                    SUBTRACT 1 FOR LAST TSB YS02019 27082002
         MR    RCH,RCH                  MULT BY SIZE, TO GET    YS02019 27084002
*                                       OFFSET OF LAST TSB      YS02019 27086002
         LR    RCH,R0                   RESTORE SIZE            YS02019 27088002
         AR    RIS,RTSB                 GET PTR TO LAST TSB     YS02019 27090002
* RCH= TSB SIZE, RIS= LAST TSB, RTSB= FIRST TSB AND CURRENT TSB YS02019 27095002
CHKTHIS  EQU   *                                                YS02019 27100002
         USING TSB,RTSB                                         YS02019 27105002
         L     RASCB,TSBASCB-E1         GET POINTER FOR TEST    YS02019 27110002
         LTR   RASCB,RASCB              CHECK FOR 0, WHICH      YS02019 27120002
*                                       MEANS TSB UNUSED        YS02019 27125002
         BNZ   NEXT                     IN USE,TRY AGAIN        YS02019 27130002
         TM    TSBTPFLG,TSBPOSTO        IS TPOST OUTSTANDING    YM03998 27132002
         BZ    EUREKA                   NO,ALLOCATE TSB         YS02019 27134002
NEXT     EQU   *                                                YS02019 27134402
         BXLE  RTSB,RCH,CHKTHIS         ADD SIZE TO CURRENT PTR YS02019 27135002
*                                       CHECK FOR END OF TABLE, YS02019 27140002
*                                       BRANCH IF NOT END       YS02019 27145002
         L     RCH,CVTPTR               GET CVT ADDRESS         YM03998 27145402
         USING CVT,RCH                  CVT ADDRESSABLE         YM03998 27145802
         L     RCH,CVTASVT              GET ASVT ADDRESS        YM03998 27147002
         DROP  RCH                      ADDRESSABILITY ENDS     YS03998 27149002
         USING ASVT,RCH                 ASVT ADDRESSABLE        YM03998 27149402
         LH    RIS,QCBTJID              GET ASID                YM03998 27149802
         SLL   RIS,E2                   GET OFFSET IN ASVT      YM03998 27149902
         L     RASCB,ASVTENTY-L'ASVTENTY(RIS)  GET ASCB ADDRESS YM03998 27199902
         MODESET EXTKEY=SUPR                                    ZA12511 27219900
         B     CALLSIC                  GO CANCEL IF NO TSB     YS02019 27249902
         DROP  RCH                      ASVT NOT ADDRESSABLE    YM03998 27259902
         SPACE 3                                                YS02019 27299902
********                                                        YS02019 27349902
******** AT THIS POINT, RTSB HAS THE TSB ADDRESS                YS02019 27399902
********                                                        YS02019 27449902
EUREKA   EQU   *                                                YS02019 27499902
         SPACE 3                                                        32600020
********                                                                32800020
******** GET UCB ADDRESS TO INITIALIZE TSB                              33000002
********                                                                33200020
         TM    TRMSTATE,TRMPREF         NCP ATTACHED TERM       ZA25074 33220000
         BO    NOUCB                    YES,DON'T WANT UCB       Y06327 33300002
         L     RCH,LCBDCBPT             GET DCB ADDR                    33400020
         L     RIS,DCBDEBAD-IHADCB(0,RCH)    GET DEB ADDR               33600020
         SR    RCH,RCH                  ZERO REG                        33800020
         IC    RCH,LCBUCBX              GET UCB INDEX                   34000020
         SLL   RCH,DEBEXSCL             GET PROPER DEB EXTENT OFFSET    34200020
         LA    RCH,DEBSIZE(RCH,RIS)     POINT TO END OF BASIC DEB AND   34400020
*                                       ADD DEB EXTENT OFFSET VALUE     34600020
         L     RUCB,0(0,RCH)            GET UCB ADDR                    34800020
         USING UCB,RUCB                 UCB ADDRESSABILITY       Y06327 34802002
NOUCB    EQU   *                                                 Y06327 34810002
         SPACE 3                                                YS02019 34820002
* * * * * * * * * * * * * * *  FIND ASCB * * * * * * * * * * * * * * *  34870002
         SPACE 3                                                YS02019 34920002
         LH    RASCB,QCBTJID            GET ASID                YS02019 34970002
         L     RIS,CVTPTR               ADDRESSABILITY ON CVT   YS02019 35020002
         USING CVT,RIS                                          YS02019 35030002
         SLA   RASCB,TIMES4             GET OFFSET OF ENTRY     YS02019 35070002
         L     RIS,CVTASVT              GET ADDRESS OF ASVT     YS02019 35120002
         DROP  RIS                                              YS02019 35170002
         USING ASVT,RIS                                         YS02019 35220002
         L     RASCB,ASVTENTY-L'ASVTENTY(RASCB) ASCB ADDR       YS02019 35270002
         USING ASCB,RASCB                                       YS02019 35320002
         DROP  RIS                                              YS02019 35370002
         SPACE 3                                                YS02019 35420002
* * * * * * * * * * * * *  TSB INITIALIZATION * * * * * * * * * * * * * 40000020
         SPACE 3                                                        40200020
********                                                                40400020
******** REFRESH TSB TO AN UNUSED STATE                                 40600002
********                                                                40800020
         XC    TSB(TSBEND-TSB),TSB      ZERO WHOLE TSB                  40900020
         SPACE 3                                                YS02019 41000002
********                                                        YS02019 41050002
******** PUT ASCB ADDRESS IN TSB, TSB ADDRESS IN ASCB           YS02019 41060002
********                                                        YS02019 41070002
         MODESET EXTKEY=SUPR            GET KEY OF ASCB         YS02019 41072002
         ST    RTSB,ASCBTSB             STORE TSB ADDR          YS02019 41080002
         MODESET EXTKEY=TCAM            GET TCAM'S KEY          YS02019 41082002
         ST    RASCB,TSBASCBA           STORE ASCB ADDR         YS02019 41090002
         SPACE 3                                                        41092002
********                                                        YS02019 41100002
******** UPDATE TIOC USER COUNT                                 YS02019 41200002
********                                                        YS02019 41300002
         L     RCH,TIOCUSCT-E2          GET ENTIRE WORD         YS02019 41400002
UPCOUNT  EQU   *                                                YS02019 41500002
         LR    RIS,RCH                  COPY USER COUNT         YS02019 41600002
         LA    RIS,E1(,RIS)             ADD 1 (WIPES OUT FLG)   YS02019 41700002
         CS    RCH,RIS,TIOCUSCT-E2      STORE IF NOT CHANGED    YS02019 41800002
         BNE   UPCOUNT                  RECOMPUTE IF CHANGED    YS02019 41900002
         STCM  RCH,B'1000',TIOCFLG      RESTORE TIOCFLG         YS02019 41950002
         SPACE 3                                                        42000020
********                                                                42200020
******** TURN ON TSBINUSE                                               42400020
********                                                                42600020
         OI    TSBSTAT,TSBINUSE         DENOTE TSB IS BEING USED        42800020
         LR    R0,RQCB                  SAVE QCB POINTER        YM01114 42810002
         SPACE 2                                                        42810102
**************************************************************  ZA25074 42810300
*        FOR TERMINALS ATTACHED VIA A NCP THE TCAM NETWORK      ZA25074 42810500
*        ADDRESS CONVERT ROUTINE IS USED TO CONVERT THE         ZA25074 42810700
*        TERMINAL NAME TABLE (TNT) INDEX TO A NETWORK ADDRESS   ZA25074 42810900
*        FOR SAVING IN THE TSB LINE ADDRESS FIELD.              ZA25074 42811100
**************************************************************  ZA25074 42811300
         TM    TRMSTATE,TRMPREF         NCP ATTACHED TERM       ZA25074 42811500
         BZ    NORSID                   NO,DON'T USE RESRCE  ID  Y06327 42811700
         STM   R14,RTERM,E4(RTSB)       SAVE REGS USED BY       ZA25074 42811900
*                                       NETWORK ADDRESS         ZA25074 42812100
*                                       CONVERT ROUTINE         ZA25074 42812300
         LH    RTERM,LCBTTCIN           GET TNT INDEX           ZA25074 42812500
         L     R15,CVTPTR               GET CVT                 ZA25074 42812700
         USING CVT,R15                                          ZA25074 42812900
         L     R15,CVTAQAVT             GET TCX                 ZA25074 42813100
         DROP  R15                                              ZA25074 42813300
         USING IEDQTCX,R15                                      ZA25074 42813500
         L     R15,TCXAVT               GET AVT                 ZA25074 42813700
         DROP  R15                                              ZA25074 42813900
         USING IEDQAVTD,R15                                     ZA25074 42814100
         L     R15,AVTSAVTP             GET SAVT                ZA25074 42814300
         DROP  R15                                              ZA25074 42814500
         USING IEDNSVTD,R15             SAVT ADDRESSABILITY     ZA25074 42814700
         L     R15,SAVTTNTX             GET ADDRESS OF THE      ZA25074 42814900
*                                       NETWORK ADDRESS         ZA25074 42815100
*                                       CONVERT ROUTINE         ZA25074 42815300
         BALR  R14,R15                  GET NETWORK ADDRESS     ZA25074 42815500
         DROP  R15                                              ZA25074 42815700
         STH   R15,TSBLINE              PUT NETWORK ADDRESS IN  ZA25074 42815900
*                                       TSB                     ZA25074 42816100
         LM    R14,RTERM,E4(RTSB)       RESTORE SAVED REGS      ZA25074 42816300
         XC    E4(E16,RTSB),E4(RTSB)    REINIT TSB              ZA25074 42816500
         B     TEST3270                 CHECK FOR 3270           Y06327 42816700
NORSID   EQU   *                                                 Y06327 42816900
         MVC   TSBLINE,UCBCHAN          SAVE CHAN & UNIT ADDR   YS02019 42817100
         NI    TSBLINE,NOFLAGS          REMOVE CHAN FLGS IF ANY  Y06327 42817300
         SPACE 3                                                        42817500
********                                                                42817700
******** IF 3270, TURN ON TSB3270                                       42817900
********                                                                42818100
TEST3270 EQU   *                                                 Y06327 42818300
         USING IEDDCT,RTCT              DCT ADDRESSABILITY      ZA25074 42818500
         TM    DCTBYTE1,DCT3270         3270 TERMINAL           ZA25074 42818700
         BZ    CHK2260                  NO - CHK FOR 2260        S22028 42818900
SET3270  EQU   *                                                 S22028 42819100
         OI    TSBSTAT,TSB3270          DENOTE A 3270 TERMINAL   S22028 42819300
         B     SETDSPLY                 GO FINISH 3270 INIT      S22028 42819500
         SPACE 3                                                        43200020
********                                                                43400020
******** IF 2260, TURN ON TSBDSPLY                                      43600020
********                                                                43800020
CHK2260  EQU   *                                                 S22028 43830002
         TM    DCTBYTE3,DCTNOIDL        2260R TERMINAL          ZA25074 43840000
         BO    SETDSPLY                 YES - INIT TSB           S22028 43920002
*                                       ACCORDINGLY              S22028 43960002
         TM    DCTBYTE2,DCTLOCAL        2260 LOCAL TERMINAL     ZA25074 43980000
         BZ    NOTDSPLY                 NO - CHK FOR TELE TERM   S22028 44100002
SETDSPLY EQU   *                                                 S22028 44300002
         OI    TSBSTAT,TSBDSPLY         DENOTE A DISPLAY STATION        44400020
         SPACE 3                                                        44600020
********                                                                44800020
******** FOR DISPLAY TERMINAL, COUNT THE NUMBER OF TRMDEVFL BITS THAT   45000002
******** ARE ON                                                         45100002
********                                                                45200020
         LA    RIS,BITPOS7              GET NUMBER OF BITS TO CHECK     45400020
         LR    RCH,RIS                  GET NUMBER OF BITS TO CHECK     45600020
         LA    RWORKB,TMMASK            GET MASK FOR TM EX INSTR        45800020
         DROP  RQCB                     RWORKB SAME AS RQCB     YS02019 45850002
CHKBITS  EQU   *                                                        46000020
         EX    RWORKB,TESTBITS          IS THIS TRMDEVFL BIT ON         46200020
         BO    SHIFTMSK                 YES - DON'T DECR NO. OF BITS ON 46400020
         BCTR  RIS,0                    DECR NUMBER OF BITS ON          46600020
SHIFTMSK EQU   *                                                        46800020
         SRL   RWORKB,E1                SHIFT MASK RIGHT ONE            47000020
         BCT   RCH,CHKBITS              BRANCH IF ALL BITS NOT CHECKED  47200020
         SPACE 3                                                        47400020
********                                                                47600020
******** FOR DISPLAY TERMINAL, POINT PAST TERMINAL ENTRY OPTION FIELDS, 47800002
******** IF ANY                                                         47900002
********                                                                48000020
         LA    RWORKB,TRMOPNO           ADDR OF NUMBER OF OPTIONS       48200020
*                                       IF ANY; OTHERWISE, ADDR OF      48400020
*                                       FIRST DEVICE DEPENDENT FIELD    48600020
         SR    RCH,RCH                  ZERO REG FOR IC INSTR           48800020
         TM    TRMSTATE,TRMOPTFN        ANY OPTION FIELDS               49000020
         BZ    CHECKDDF                 NO - CHECK FOR DEVICE FIELDS    49200020
         IC    RCH,TRMOPNO              GET NO. & SIZE OF OPTIONS       49400020
         LA    RWORKB,E3(RCH,RWORKB)    BUMP PAST REST OF TERMINAL      49600020
*                                       ENTRY (3) AND ANY OPTIONS (RCH) 49800020
         SPACE 3                                                        50000020
********                                                                50200020
******** FOR DISPLAY TERMINAL, POINT PAST TERMINAL ENTRY DEVICE         50400002
******** DEPENDENT FIELDS, IF ANY                                       50500002
********                                                                50600020
CHECKDDF EQU   *                                                        50800020
         LTR   RIS,RIS                  ANY TRMDEVFL BITS ON            51000020
         BZ    GETINFO                  NO - RWORKB NOW POINTS TO       51200020
*                                       FIRST DEVICE DEPENDENT FIELD    51400020
BUMPDDF  EQU   *                                                        51600020
         IC    RCH,0(0,RWORKB)          GET LNG OF DEVICE DEPENDENT FLD 51800020
         LA    RWORKB,E1(RCH,RWORKB)    BUMP PAST LENGTH FIELD (1) AND  52000020
*                                       DEVICE DEPENDENT FIELD (RCH)    52200020
         BCT   RIS,BUMPDDF              BRANCH IF MORE FIELDS TO SKIP   52400020
         SPACE 3                                                        52600020
********                                                                52800020
******** FOR DISPLAY TERMINAL, INIT TSBLNNO FROM TERMINAL ENTRY DEVICE  53000002
******** DEPENDENT FIELDS                                               53100002
********                                                                53200020
GETINFO  EQU   *                                                        53400020
         MVC   TSBLNNO,E1(RWORKB)       PUT NO. LINES INTO TSB   S22028 53600002
         SPACE 3                                                        53800020
********                                                                54000020
******** INITIALIZE TSBLNSZ ACCORDING TO TERMINAL TYPE                  54200020
********                                                                54400020
         MVC   TSBLNSZ,E2(RWORKB)       PUT LINE SIZE INTO TSB   S22028 54600002
         TM    DCTBYTE5,DCTLSCR         LARGE SCREEN SUPPORTED @Z37XBYT 54602000
         BNO   NULLSTCC                 NO, GO SET NO DEFAULT  @Z37XBYT 54604000
         MVC   TSBPRMR,E1(RWORKB)       PRIMARY ROW SIZE       @Z37XBYT 54606000
         MVC   TSBPRMC,E2(RWORKB)       PRIMARY COLUMN SIZE    @Z37XBYT 54608000
         MVC   TSBALTR,E3(RWORKB)       ALTERNATE ROW SIZE     @Z37XBYT 54610000
         MVC   TSBALTC,E4(RWORKB)       ALTERNATE COLUMN SIZE  @Z37XBYT 54612000
         B     NULLSTCC                 GO SET TSBSTCC TO NO DEFAULT    54800020
NOTDSPLY EQU   *                                                 S22028 55000002
         TM    DCTBYTE2,DCTTWX          TELE TERMINAL           ZA25074 55020000
         BO    SMALLSIZ                 YES - SET TSBLNSZ TO 72         55400020
         LA    RCH,REGLNSZ              GET SIZE OF 120                 55600020
         B     SETLINE                  BR TO SPECIFY SIZE              55800020
SMALLSIZ EQU   *                                                        56000020
         LA    RCH,TELELNSZ             GET SIZE OF 72                  56200020
SETLINE  EQU   *                                                        56400020
         STC   RCH,TSBLNSZ              SPECIFY LINE SIZE IN TSB        56600020
         SPACE 3                                                        56800020
********                                                                57000020
******** INITIALIZE TSBSTCC ACCORDING TO TERMINAL TYPE                  57200020
********                                                                57400020
         TM    DCTBYTE2,DCTTWX          TWX TERMINAL            ZA25074 57450000
         BZ    CHKREST                  NO - CHK FOR 2741 OR 1050       57800020
         MVI   TSBLNDCC,TWXLD           SET TWX LD DEFAULT              58000020
         MVI   TSBCHDCC,TWXCD           SET TWX CD DEFAULT              58200020
         B     SETASRCE                 CONTINUE TSB INIT               58400020
CHKREST  EQU   *                                                        58600020
         TM    DCTBYTE1,DCT2741+DCT5041 2741 OR 1050 TERMINAL   ZA25074 58650000
         BNZ   SETBOTH                  YES - SET PROPER DEFAULT CHARS  59000020
CHK1050  EQU   *                                                        59400020
         TM    DCTBYTE3,DCT1050         IS IT A 1050            ZA25074 59420000
         BNO   NULLSTCC                 NO - DON'T DEFAULT       Y06327 60600002
         OI    TSBTERM2,TSBC1050        TERMINAL IS 1050        YS02019 60650002
SETBOTH  EQU   *                                                        60800020
         MVI   TSBCHDCC,T4150CD         SET 2741 AND 1050 CD DEFAULT    61000020
         OI    TSBSTAT,TSBATNLD         DENOTE ATTN FOR LD              61200020
         B     NULLLD                   INIT LD CHAR                    61400020
NULLSTCC EQU   *                                                        61600020
         MVI   TSBCHDCC,NODEFALT        DENOTE CD HAS NO DEFAULT        61800020
NULLLD   EQU   *                                                        62000020
         MVI   TSBLNDCC,NODEFALT        DENOTE LD HAS NO DEFAULT        62200020
         SPACE 3                                                        62400020
********                                                                62600020
******** SET TERMINAL INDEX AND CHARACTERISTICS                         62800002
********                                                                63000020
SETASRCE EQU   *                                                        63200020
         OC    TSBTERMC,E1(RTCT)        COPY TCT FIELDS         YS02019 63222002
         DROP  RTCT                                             ZA25074 63222200
         LH    RWORKB,PRFSRCE      GET TNT INDEX FROM BFR       ZA16608 63222400
         STH   RWORKB,TSBASRCE     PUT TNT INDEX IN TSB         ZA16608 63222600
         BCTR  RWORKB,R0           DECR INDEX FOR MULT.         ZA16608 63222800
         L     RTNT,AVTRNMPT       GET TNT ENTRY ADDRESS        ZA16608 63223000
*              TCT NO LONGER ADDRESSABLE                        ZA16608 63223200
         SR    RLNTH,RLNTH         ZERO THE REGISTER            ZA16608 63223400
         IC    RLNTH,X'28'(,RTNT)  GET ID LENGTH FROM TNT       ZA16608 63224000
         LA    RIS,E3              GET LENGTH OF ADDRESS        ZA16608 63224200
         AR    RIS,RLNTH           ADD ADR. FIELD TO LENGTH     ZA16608 63224400
         MR    RCH,RWORKB          MULT LNTH * OFFSET           ZA16608 63224600
         AR    RIS,RTNT            ADD START OF TNT             ZA16608 63224800
         MVC   TSBTRMID,BLANKS     BLANK OUT ID FIELD           ZA16608 63225000
         BCTR  RLNTH,R0            DECR TERM NAME LNTH          ZA16608 63225200
         EX    RLNTH,ANMVC         MOVE TERM ID TO TSB          ZA16608 63225400
         LR    RQCB,R0             RESTORE QCB POINTER          YM01114 63225600
         USING IEDQQCB,RQCB             QCB ADDRESSABLE         YM01114 63226002
         TM    QCBFLAG,QCBNOBRK         IS REVERSE BREAK        YM01114 63228002
*                                       FEATURE ALLOWED         YM01114 63228402
         BZ    POSTAY3                  YES, DON'T SET TSBNOBRK YM01114 63228802
         OI    TSBFLG3,TSBNOBRK         USE OF REVERSE BREAK    YM01114 63229202
*                                       FEATURE NOT ALLOWED     YM01114 63229602
         DROP  RQCB                     QCB NO LONG ADDRESSABLE YM01114 63229702
         SPACE 3                                                YS02019 63230002
********                                                        YS02019 63240002
******** GO TO POST ROUTINE, TO WAKE UP IEDAY3, WHICH COULD BE  YS02019 63250002
******** WAITING ON ASCBECB.                                    YS02019 63260002
********                                                        YS02019 63270002
POSTAY3  EQU   *                                                YM01114 63272002
         LA    RIS,ASCBECB                                      YS02019 63280002
         SR    RCH,RCH                  ZERO COMPLETION CODE    YS02019 75120002
         L     RWORKA,CVTPTR            LOAD CVT ADDRESS                75200020
         SPACE 2                                                YS02019 75250002
********                                                                75300002
******** FIND MASTER SCHEDULER'S ASCB FOR POST ROUTINE                  75350002
********                                                                75360002
         USING CVT,RWORKA               ADDRESS CVT                     75400020
         L     R13,CVTMSER              ADDRESS OF BASEA        YS02019 75490002
         L     R13,BAASCB-BASE(,R13)    ASCB OF MASTR SCHED     YS02019 75500002
         SPACE 2                                                YS02019 75518402
********                                                                75518802
******** CONTINUE SETTING UP REGISTERS FOR POST                         75519202
********                                                                75519602
         O     RIS,HIGHON               HI BIT SIGNALS XM POST  YS02019 75520002
         LR    R0,RBASE                 SAVE BASE REGISTER      YS02019 75530002
         LA    RBASE,CVTBRET            'ERRET' ADDRESS (BR14)  YS02019 75570002
         L     R15,CVT0PT01             LOAD POST ROUTINE ADDRESS       76400020
         LR    RWORKB,R14               SAVE RETURN ADDR                76600020
         DROP  RWORKA                                                   76800020
         MODESET EXTKEY=SUPR            GET KEY ZERO FOR POST           76850002
         BALR  R14,R15                  GO TO POST ROUTINE              77000020
         LR    RBASE,R0                 RESTORE BASE REGISTER   YS02019 77050002
         LR    R14,RWORKB               RESTORE RETURN ADDR     YM06501 77100002
         SPACE 3                                                        77200020
********                                                                77250002
******** CHECK FOR TS STOPPING OR ABENDING.  SIC THIS USER IF IT IS     77300002
********                                                                77350002
         TM    TIOCFLG,TIOCSTOP+TIOCTSAB CK FOR TERMINATION     YS02019 77360002
         BNZ   CALLSIC                  CALL CANCEL ROUTINE     YS02019 77370002
         DROP  RBASE                                            YS02019 77372002
         SPACE 3                                                YS02019 77380002
********                                                                77400020
******** RETURN TO TIOC LOGON (IEDAYL)                                  77600020
********                                                                77800020
         SR    R15,R15                  SET 0 RETURN CODE       YS02019 77812002
         BR    R14                      RETURN TO IEDAYQT       YS02019 77824002
         SPACE 3                                                YS02019 77830002
* * * * * * * * * *  CALL SIC TO CANCEL THIS USER  * * * * * * * * * *  77836002
********                                                        YS02019 77848002
******** USE BRANCH ENTRY TO SYSTEM-INITIATED CANCEL            YS02019 77854002
********                                                        YS02019 77860002
CALLSIC  EQU   *                                                YS02019 77866002
         USING QTIP0100,RBASE                                   YS02019 77868002
         L     RWORKA,CVTPTR            CVT ADDRESSABILITY      YS02019 77872002
         LA    R13,TIOCSAVE             GET SAVE AREA POINTER   YS02019 77874002
         L     R0,POSTCODE              'POST CODE' FOR SIC     YS02019 77876002
         USING CVT,RWORKA               CVT ADDRESSABLE         YS02019 77876402
         L     R15,CVTSIC               SIC ROUTINE ENTRY POINT YS02019 77878002
         DROP  RWORKA                   ADDRESSABILITY ENDS     YS02019 77880002
         LR    RTERM,RASCB              ASCB ADDR FOR SIC       YS02019 77882002
         LR    RWORKB,R14               SAVE RETURN ADDR        YS02019 77890002
         BALR  R14,R15                  GO TO SIC               YS02019 77896002
         SPACE 3                                                YS02019 77902002
********                                                        YS02019 77908002
******** SET RETURN CODE TO 4 AND RETURN                        YS02019 77914002
********                                                        YS02019 77920002
         LR    R14,RWORKB               RESTORE RETURN ADDRESS  YS02019 77926002
         LA    R15,E4                   SET CODE                YS02019 77932002
         BR    R14                      RETURN                  YS02019 77938002
         SPACE 3                                                YS02019 77944002
********                                                        YS02019 77950002
******** CONSTANTS                                              YS02019 77956002
********                                                        YS02019 77962002
BLANKS   DS    0F                  8 BYTES OF BLANKS USED       ZA16608 77964000
         DC    C'        '         TO BLANK OUT TSBTRMID        ZA16608 77966000
HIGHON   DS    0F                                               YS02019 77968002
         DC    X'80000000'              HIGH BIT FOR XMPOST     YS02019 77974002
POSTCODE DS    0F                       COMPLETION CODE FOR     YS02019 78024002
         DC    X'00000622'              TERMINATED MEMORY       YS02019 78074002
TESTBITS TM    TRMDEVFL,NOMASK          COUNT THE BITS THAT ARE ON      80000020
ANMVC    MVC   TSBTRMID(0),X'52'(RIS)                           ZA16608 80020000
PATCH    DC    10F'0'                   PATCH AREA              YM03998 80050002
         SPACE 3                                                        80400020
* * * * * * * * * * * *  CONTROL BLOCK DSECTS * * * * * * * * * * * * * 80600020
         SPACE 3                                                        80660002
         IHAASCB                                                        80720002
         EJECT                                                          80800002
         IHAASVT                                                YS02019 80850002
         EJECT                                                YS02019   80900002
         TAVTD                                                  ZA16608 80910000
         EJECT                                                  ZA16608 80920000
         IEEBASEA                                               YS02019 80950002
         EJECT                                                YS02019   80960002
CVT      DSECT                                                          81000020
         CVT                                                            81200020
         EJECT                                                YS02019   81260002
         TDCTD                                                  ZA25074 81270000
         EJECT                                                  ZA25074 81280000
         TTCXD                                                  YS02019 81290002
         EJECT                                                          81800002
         IKJTIOCP                                                       82000020
         EJECT                                                          82200002
         IKJTSB                                                         82400020
         EJECT                                                          83400002
         TLCBD                                                          83600020
         EJECT                                                          83800002
         TPRFD                                                          84000020
         EJECT                                                          84200002
         TQCBD                                                          84250002
         EJECT                                                          84300002
         DCBD  DSORG=TX                                                 84400020
         EJECT                                                          84600002
         TTRMD                                                          84800020
         EJECT                                                          84850002
UCB      DSECT                                                   Y06327 84860002
         IEFUCBOB LIST=YES                                       Y06327 84900002
         END                                                            85000020
