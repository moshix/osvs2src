         TITLE 'IEDAYQ - TSO TIOC 3270 OUTPUT EDIT ROUTINE'             00050000
IEDAYQ   CSECT                                                          00100000
         SPACE 3                                                        00150000
*  CHANGE ACTIVITY AS FOLLOWS:                                          00200000
* A000000-999999                                               @ZM47913 00250000
*A964000                                                       @G36XRYP 00300000
*C175500,183000,201000296500,311000,566500,577000,663000       @G36XRYP 00350000
*C703000                                                       @G36XRYP 00400000
*D120500                                                       @G36XRYP 00450000
*A736500                                                       @OZ24715 00451000
*A586500                                                       @0S79724 00452000
*D146500-147000                                                @OZ26971 00453000
*A148500                                                       @OZ26971 00454000
*C295500                                                       @OY19462 00455000
*A655000,656000,664000                                         @OZ26894 00456000
*C548500                                                       @OZ27387 00457000
*A551000                                                       @OZ27387 00458000
*@ZM47913                                                               00500000
*A121500,304500,307000,415500,425000                           @OZ27604 00510000
*C304820-304900                                                @OZ28765 00520000
*   PACKAGING ERROR                                            @OZ30375 00520186
*A122500,186000,188500,319500,898500                           @OY19561 00520286
*C187000,315000,316000                                         @OY19561 00520386
*A122500,596000                                                @OZ28127 00520486
*C591000,593500                                                @OZ28127 00520586
*A183500,970500                                                @OY19692 00520686
*C616500                                                       @OZ28135 00520786
*A126000,156000,312000,434500                                  @OZ28219 00520886
*A121700,251000,258500,289500,304900,548500                    @OZ28792 00520986
*C230000,249500,250500                                         @OZ28792 00521086
*A122500,590500                                                @OZ29380 00521186
*C606500                                                       @OZ29736 00521286
*C932000                                                       @OZ29793 00521386
*A779000                                                       @OY20575 00521486
*C315090,316060,319650                                         @OY20752 00521586
*D121800-121900,251080-251400,258570-258920,548710-548780      @OY20733 00521686
*C230000-230320,249500,250500,289600-290000,303920-304960      @OY20733 00521786
*A126200,238500,548640                                         @OY20733 00521886
*C606500                                                       @OZ31812 00521986
*A608000                                                       @OZ31812 00522086
*A315000,316000,319560                                         @OZ31929 00522186
*********************************************************************** 00550000
*                                                                     * 00650000
*  MODULE NAME = IEDAYQ           (TCAM,TSO)                   @G36XRYP 00700000
*                                                                     * 00750000
*  DESCRIPTIVE NAME = TSO TIOC 3270 OUTPUT EDIT ROUTINE               * 00800000
*                                                                     * 00850000
*  COPYRIGHT = NONE                                                   * 00900000
*                                                                     * 00950000
*  STATUS = VERSION 10.0                                       @G36XRYP 01000000
*                                                                     * 01050000
*  FUNCTION = THE TSO TIOC OUTPUT EDIT ROUTINE MOVES DATA FOR A TPUT  * 01100000
*             FROM A TIOC BUFFER TO A TCAM BUFFER OR FOR A MSGGEN     * 01150000
*             FROM AN AREA POINTED TO BY A MSGGEN PARAMETER LIST      * 01200000
*             TO A TCAM BUFFER OR THE SCBMBSSA AREA IN THE STATION-   * 01250000
*             CONTROL-BLOCK.  AS THE DATA IS BEING MOVED, IT IS       * 01300000
*             TESTED FOR CONTROL CHARACTERS AND INVALID CHARACTERS    * 01350000
*             THAT REQUIRE SPECIAL PROCESSING OR DELETION FROM THE    * 01400000
*             MESSAGE.  HANDLING OF THESE SPECIAL CHARACTERS IS       * 01450000
*             DEPENDENT UPON THE MODE OF THE TPUT BEING PROCESSED.    * 01500000
*             LINE CONTROL CHARACTERS ARE ADDED WHEN REQUIRED.  WHEN  * 01550000
*             DATA IS EDITTED THAT WILL DISPLAY ON THE NEXT TO LAST   * 01600000
*             LINE OF THE SCREEN, A SIMULATED ATTENTION PROMPT IS     * 01650000
*             REQUESTED.                                              * 01700000
*                                                                     * 01750000
*  NOTES = SEE BELOW                                                  * 01800000
*                                                                     * 01850000
*     DEPENDENCIES = EBCDIC CHARACTER CODE DEPENDENCIES ARE           * 01900000
*                           CORRECTABLE BY REASSEMBLY                 * 01950000
*                                                                     * 02000000
*     RESTRICTIONS = NONE                                             * 02050000
*                                                                     * 02100000
*     REGISTER-CONVENTIONS = SEE REGISTER EQUATES BELOW               * 02150000
*                                                                     * 02200000
*     PATCH-LABEL = AYQPATCH                                          * 02250000
*                                                                     * 02300000
*  MODULE-TYPE = PROCEDURE                                            * 02350000
*                                                                     * 02400000
*     PROCESSOR = ASSEMBLER F                                         * 02450000
*                                                                     * 02500000
*     MODULE-SIZE = 5224 DECIMAL BYTES                                * 02550000
*                                                                     * 02600000
*     ATTRIBUTES = REUSABLE                                           * 02650000
*                                                                     * 02700000
*  ENTRY-POINT = IEDAYQ                                               * 02750000
*                                                                     * 02800000
*     PURPOSE = SEE FUNCTION ABOVE                                    * 02850000
*                                                                     * 02900000
*     LINKAGE = SAMPLE LINKAGE:                                       * 02950000
*                   L     R15,AVTTSOPT  POINTER TO TSINPUT QCB        * 03000000
*                   L     R15,TSI3270-IEDQTSI(,R15)  POINTR TO IEDAYQ * 03050000
*                   BAL   R14,R15  BRANCH-AND-LINK TO IEDAYQ          * 03100000
*                                                                     * 03150000
*  INPUT = R1 POINTS TO OUTPUT AREA IF ENTRY IS FOR MSGGEN EDIT       * 03200000
*          R4 POINTS TO LINE-CONTROL-BLOCK                            * 03250000
*          R7 POINTS TO QUEUE-CONTROL-BLOCK                           * 03300000
*          R13 POINTS TO AVTSAVE2 IN ADDRESS-VECTOR-TABLE             * 03350000
*          R14 POINTS TO RETURN ADDRESS IN CALLING ROUTINE            * 03400000
*          R15 POINTS TO ENTRY POINT OF IEDAYQ                        * 03450000
*          EDIT-WORK-AREA IN TSINPUT QCB (INITIALIZED BY CALLING      * 03500000
*                  ROUTINE)                                           * 03550000
*               GMBFUNIT - NUMBER OF UNITS PER TCAM BUFFER            * 03600000
*               GMCARCT  - NUMBER OF CHARACTERS DISPLAYED ON LINE     * 03650000
*               GMCRBUF  - POINTER TO CURRENT TCAM BUFFER             * 03700000
*               GMDEVCH  - TERMINAL DEVICE-CHARACTERISTICS            * 03750000
*               GMENCON  - FLAG REQUESTING ENDING-CONTROL INSERTION   * 03800000
*               GMINIT   - FLAG INDICATING INITIAL ENTRY FROM IEDAYN  * 03850000
*               GMLNNO   - NUMBER OF LINES ON 3270 DISPLAY            * 03900000
*               GMLNSZ   - NUMBER OF CHARACTERS PER LINE ON 3270      * 03950000
*               GMSATCT  - NUMBER OF LINES DISPLAYED ON 3270          * 04000000
*               GMTSBUF  - POINTER TO TIOC BUFFER                     * 04050000
*          TIOC BUFFER                                                * 04100000
*               BUFFCNTL - FLAG INDICATING CONTROL MODE TPUT          * 04150000
*               BUFFEDIT - FLAG INDICATING EDIT MODE TPUT             * 04200000
*                  BOTH BUFFEDIT & BUFFCNTL ON INDICATES FULLSCR TPUT * 04250000
*                  BOTH BUFFEDIT & BUFFCNTL OFF INDICATES ASIS TPUT   * 04300000
*               BUFFHDR  - FLAG INDICATING TIOC HEADER BUFFER         * 04350000
*               BUFFLNTH - LENGTH OF DATA IN TIOC BUFFER              * 04400000
*               BUFFNLCR - FLAG INDICATING LAST TIOC BUFFER           * 04450000
*               BUFFOFST - OFFSET TO FIRST DATA BYTE IN TIOC BUFFER   * 04500000
*               BUFFTRLR - POINTER TO NEXT TIOC TRAILER BUFFER        * 04550000
*          QUEUE-CONTROL-BLOCK FOR DESTINATION TERMINAL               * 04600000
*               QCBDSSMI - FLAG INDICATING 3270 KEYBOARD IS UNLOCKED  * 04650000
*               QCBIEND  - FLAG INDICATING SCREEN FORMATTING REQUIRED * 04700000
*               QCBTSSES - FLAG INDICATING DISPLAY IS IN TSO SESSION  * 04750000
*          LINE-CONTROL-BLOCK FOR DESTINATION TERMINAL                * 04800000
*               LCBERBCH - POINTER TO FIRST TCAM BUFFER               * 04850000
*               LCBERBPY - PRIORITY WITH WHICH ERB WAS POSTED         * 04900000
*               LCBMSGNN - FLAG INDICATING MSGGEN IN PROGRESS         * 04950000
*          TCAM BUFFER                                                * 05000000
*               PRFTIC   - POINTER TO NEXT UNIT OF TCAM BUFFER        * 05050000
*          ADDRESS-VECTOR-TABLE                                       * 05100000
*               AVTKEYLE - LENGTH OF TCAM BUFFER UNIT                 * 05150000
*               AVTSCBSZ - LENGTH OF STATION-CONTROL-BLOCK            * 05200000
*               AVTTSOPT - POINTER TO TSINPUT QCB                     * 05250000
*               AVTUMALN - LENGTH OF TCAM BUFFER UNIT MANAGEMENT AREA * 05300000
*                                                                     * 05350000
*  OUTPUT = R15 CONTAINS RETURN CODE FOR CALLING ROUTINE              * 05400000
*                FOR MSGGEN PROCESSING:                               * 05450000
*                   HIGH ORDER HALF-WORD - LENGTH OF MSGGEN DATA      * 05500000
*                   LOW ORDER HALF-WORD  - ZERO                       * 05550000
*                FOR TPUT PROCESSING:                                 * 05600000
*                   NEGATIVE VALUE - TCAM BUFFER HAS BEEN FILLED      * 05650000
*                   ZERO           - 3270 SCREEN HAS BEEN FILLED      * 05700000
*                   POSITIVE VALUE - TPUT HAS BEEN COMPLETELY EDITTED * 05750000
*           R0-R14 RESTORED TO ENTRY VALUES                           * 05800000
*           TCAM BUFFER CONTAINING EDITTED DATA FROM TIOC BUFFER      * 05850000
*                   FOR TPUT OR MSGGEN DATA FOR NCP ATTACHED 3270     * 05900000
*                PRFKEY   - CCW COMMAND CODE IF LCBSCRNN IS ON        * 05950000
*                PRFLCB   - POINTER TO LINE-CONTROL-BLOCK             * 06000000
*                PRFLINK  - POINTER TO NEXT TCAM BUFFER               * 06050000
*                PRFNBUNT - NUMBER OF UNITS IN TCAM BUFFER            * 06100000
*                PRFNHDRN - FLAG INDICATING NOT TCAM HEADER BUFFER    * 06150000
*                PRFNLSTN - FLAG INDICATING NOT LAST TCAM BUFFER      * 06200000
*                PRFSIZE  - LENGTH OF DATA IN TCAM BUFFER             * 06250000
*                PRFTSMSG - FLAG INDICATING TSO TCAM BUFFER           * 06300000
*           STATION-CONTROL-BLOCK CONTAINING EDITTED DATA FROM        * 06350000
*                   MSGGEN DATA FOR NON-NCP ATTACHED 3270             * 06400000
*           EDIT-WORK-AREA                                            * 06450000
*                GMENCIN  - FLAG INDICATING ENDING-CONTROL INSERTED   * 06500000
*           LINE-CONTROL-BLOCK FOR DESTINATION TERMINAL               * 06550000
*                LCBSCRNN - FLAG REQUESTING SPECIAL CCW COMMAND       * 06600000
*           QUEUE-CONTROL-BLOCK FOR DESTINATION TERMINAL              * 06650000
*                QCBCARCT - NUMBER OF CHARACTERS DISPLAYED ON LINE    * 06700000
*                QCBDEND  - FLAG INDICATING INSERT INC ORDER ONLY     * 06750000
*                QCBNL    - FLAGS INDICATING NEW-LINE STARTED         * 06800000
*                QCBSATCT - NUMBER OF LINES DISPLAYED ON 3270         * 06850000
*                QCBSATRD - FLAG INDICATING 3270 SCREEN FILLED        * 06900000
*                                                                     * 06950000
*  EXIT-NORMAL = RETURN TO CALLING ROUTINE (IEDAYN OR IEDAYM)         * 07000000
*                SEE OUTPUT ABOVE                                     * 07050000
*                                                                     * 07100000
*  EXIT-ERROR = NONE                                                  * 07150000
*                                                                     * 07200000
*  EXTERNAL-REFERENCES = SEE BELOW                                    * 07250000
*                                                                     * 07300000
*     ROUTINES = QTIP (SVC 101 ENTRY CODE 17)                         * 07350000
*                                                                     * 07400000
*     DATA-AREAS = TIOC BUFFER                                        * 07450000
*                  TCAM BUFFER                                        * 07500000
*                                                                     * 07550000
*     CONTROL-BLOCKS = ADDRESS-VECTOR-TABLE                           * 07600000
*                      TSINPUT QUEUE-CONTROL-BLOCK                    * 07650000
*                      LINE-CONTROL-BLOCK                             * 07700000
*                      TERMINAL DESTINATION QUEUE-CONTROL-BLOCK       * 07750000
*                      STATION-CONTROL-BLOCK                          * 07800000
*                                                                     * 07850000
*  TABLES = CNVTTBL - 3270 BUFFER ADDRESS CONVERSION TABLES           * 07900000
*           EDITTBL - TRANSLATE-AND-TEST TABLE FOR EDIT MODE TPUT     * 07950000
*           ASISTBL - TRANSLATE-AND-TEST TABLE FOR ASIS MODE TPUT     * 08000000
*           FLSCTBL - TRANSLATE-AND-TEST TABLE FOR FULLSCR MODE TPUT  * 08050000
*           CNTLTBL - TRANSLATE-AND-TEST TABLE FOR CONTROL MODE TPUT  * 08100000
*                                                                     * 08150000
*  MACROS = SAVE           - SAVE REGISTERS                           * 08200000
*           IEDHJN         - INSERT MODULE IDENTIFIER AND DATE        * 08250000
*           QTIP (SVC 101) - UPDATE TIOC BUFFER OFFSET AND LENGTH     * 08300000
*           RETURN         - RESTORE REGISTERS AND RETURN             * 08350000
*           IKJTIOCB       - DSECT FOR TIOC BUFFER                    * 08400000
*           TAVTD          - DSECT FOR ADDRESS-VECTOR-TABLE           * 08450000
*           TLCBD          - DSECT FOR LINE-CONTROL-BLOCK             * 08500000
*           TPRFD          - DSECT FOR TCAM BUFFER                    * 08550000
*           TQCBD          - DSECT FOR QUEUE-CONTROL-BLOCK            * 08600000
*           TSCBD          - DSECT FOR STATION-CONTROL-BLOCK          * 08650000
*           TTSID          - DSECT FOR TSINPUT QCB                    * 08700000
*                                                                     * 08750000
*  CHANGE-ACTIVITY = SEE CHANGE ACTIVITY ABOVE                        * 08800000
*                                                                     * 08850000
*                                                                     * 08900000
*********************************************************************** 08950000
         EJECT                                                          09000000
*********************************************************************** 09050000
*********                                                     ********* 09100000
*********                 REGISTER EQUATES                    ********* 09150000
*********                                                     ********* 09200000
*********************************************************************** 09250000
         SPACE 2                                                        09300000
R0       EQU   0                        REGISTER ZERO                   09350000
RTABLE   EQU   1                        ADDRESS OF TRT FUNCTION TABLE   09400000
R1       EQU   1                        ARGUMENT BYTE ADDRESS FROM TRT  09450000
R2       EQU   2                        FUNCTION BYTE FROM TRT          09500000
RBUFF    EQU   2                        ADDRESS OF TSO BUFFER           09550000
RBASE2   EQU   3                        MODULE BASE ADDRESS             09600000
RLCB     EQU   4                        ADDRESS OF LINE CONTROL BLOCK   09650000
RTCBUF   EQU   5                        ADDRESS IN TCAM UNIT FOR DATA   09700000
RTSBUF   EQU   6                        ADDRESS OF TSO DATA TO EDIT     09750000
RQCB     EQU   7                        ADDRESS OF DESTINATION QCB      09800000
RWORKE   EQU   8                        EVEN WORK REGISTER              09850000
RWORKO   EQU   RWORKE+1                 ODD WORK REGISTER               09900000
RCNT     EQU   9                        COUNT OF DATA TO MVC OR TRT     09950000
RWORK    EQU   10                       WORK REGISTER                   10000000
RGMAIN   EQU   11                       ADDRESS OF WORKAREA             10050000
RBASE    EQU   12                       MODULE BASE ADDRESS             10100000
RAVT     EQU   13                       ADDRESS OF ADDRESS VECTOR TABLE 10150000
RLINK    EQU   14                       SUBROUTINE LINKAGE REGISTER     10200000
RENTRY   EQU   15                       MODULE ENTRY POINT ADDRESS      10250000
RRCODE   EQU   15                       RETURN CODE                     10300000
R15      EQU   15                       PARAMETER REGISTER              10350000
         SPACE 2                                                        10400000
*********************************************************************** 10450000
         EJECT                                                          10500000
*********************************************************************** 10550000
*********                                                     ********* 10600000
*********            EQUATES, MASKS AND DISPLACEMENTS         ********* 10650000
*********                                                     ********* 10700000
*********************************************************************** 10750000
         SPACE 2                                                        10800000
ZERO     EQU   0                        EQUATE TO 0                     10850000
ONE      EQU   1                        EQUATE TO 1                     10900000
TWO      EQU   2                        EQUATE TO 2                     10950000
THREE    EQU   3                        EQUATE TO 3                     11000000
FOUR     EQU   4                        EQUATE TO 4                     11050000
FIVE     EQU   5                        EQUATE TO 5                     11100000
SIX      EQU   6                        EQUATE TO 6                     11150000
SEVEN    EQU   7                        EQUATE TO 7                     11200000
TWELVE   EQU   12                       EQUATE TO 12                    11250000
SIXTEEN  EQU   16                       EQUATE TO 16                    11300000
EIGHTEEN EQU   18                       EQUATE TO 18                    11350000
TWENTY   EQU   20                       EQUATE TO 20                    11400000
TWENTY6  EQU   26                       EQUATE TO 26                    11450000
TWENTY8  EQU   28                       EQUATE TO 28                    11500000
FORTY8   EQU   48                       EQUATE TO 48                    11550000
SIXTY4   EQU   64                       EQUATE TO 64                    11600000
SIXTY8   EQU   68                       EQUATE TO 68                    11650000
ESC      EQU   X'27'                    ESCAPE CHARACTER                11700000
EAU      EQU   X'6F'                    ERASE-ALL-UNPROTECTED CMD       11750000
EW       EQU   X'F5'                    ERASE-WRITE COMMAND             11800000
SBA      EQU   X'11'                    SET-BUFFER-ADDRESS ORDER        11850000
SF       EQU   X'1D'                    START-FIELD ORDER               11900000
CR       EQU   X'15'                    CARRIAGE-RETURN                 11950000
COLON    EQU   X'7A'                    REPLACEMENT CHARACTER           12000000
INC      EQU   X'13'                    INSERT-CURSOR ORDER             12050000
RESATTR  EQU   X'C8'                    HIGH INTENSITY DISPLAY ATTR     12100000
BYPATTR  EQU   X'4C'                    NON-DISPLAY ATTRIBUTE           12150000
BYPREST  EQU   X'80'                    BYPASS OR RESTORE CHAR @OZ27604 12160000
*                                       IN DATA                @OZ27604 12170000
SPACE    EQU   X'40'                    SPACE                           12200000
UNLOCK   EQU   X'02'                    KEYBOARD RESTORE FLAG           12250000
RMDT     EQU   X'01'                    RESET MDT BIT          @OZ29380 12252086
UNLWCC   EQU   X'C2'                    KYBD RESTORE WCC       @OY19561 12254086
UNLOCK1  EQU   X'82'                    KEYBOARD RESTORE       @OZ28127 12270086
MDTFLG   EQU   X'81'                    RESET MDT FLAG         @OZ28127 12290086
*QCBNL   EQU   X'30'                    NEW LINE FLAGS                  12300000
*QCBIEND EQU   X'04'                    SCREEN FORMAT REQUEST           12350000
QCBDEND  EQU   X'08'                    MODE OF LAST TPUT               12400000
X05      EQU   X'05'                    ERASE-WRITE OP CODE             12450000
X0F      EQU   X'0F'                    ERASE-ALL-UNPROTECTED OP CODE   12500000
XE4      EQU   X'E4'                    ERB PRIORITY                    12550000
XFF      EQU   X'FF'                    ALL ONES MASK                   12600000
INCLAST  EQU   X'40'                    INC LAST IN BFR INDCTR @OZ28219 12620086
X7F      EQU   X'7F'                    MID PUT FLAG MASK      @OY20733 12630086
* FOUR IS SUBTRACTED FROM THE FOLLOWING RETURN CODES TO PROVIDE         12650000
*    THE PROPER VALUES FOR IEDAYN                                       12700000
ENDBUFR  EQU   0                        END-OF-BUFFER RETURN CODE (-4)  12750000
ENDSCRN  EQU   4                        END-OF-SCREEN RETURN CODE ( 0)  12800000
ENDTPUT  EQU   8                        END-OF-TPUT RETURN CODE   (+4)  12850000
         SPACE 2                                                        12900000
*********************************************************************** 12950000
         EJECT                                                          13000000
*********************************************************************** 13050000
*********                                                     ********* 13100000
*********              ESTABLISH ADDRESSABILITY               ********* 13150000
*********                                                     ********* 13200000
*********************************************************************** 13250000
         SPACE 2                                                        13300000
         USING IEDAYQ,RBASE,RBASE2      SET MODULE ADDRESSABILITY       13350000
         USING AVTSAVE2,RAVT            SET SAVEAREA ADDRESSABILITY     13400000
         USING IEDQQCB,RQCB             SET QCB ADDRESSABILITY          13450000
         USING IEDQLCB,RLCB             SET LCB ADDRESSABILITY          13500000
         USING IEDQTSI,RGMAIN           SET WORKAREA ADDRESSABILITY     13550000
         USING TIOCBUF,RBUFF            SET TSO BUFFER ADDRESSABILITY   13600000
         SPACE 2                                                        13650000
*********************************************************************** 13700000
         EJECT                                                          13750000
*********************************************************************** 13800000
*********                                                     ********* 13850000
*********                 INITIALIZATION                      ********* 13900000
*********                                                     ********* 13950000
*********************************************************************** 14000000
         SPACE 2                                                        14050000
         SAVE  (14,12)                  SAVE REGISTERS                  14100000
         LR    RBASE,RENTRY             SET BASE REGISTER               14150000
         LA    RBASE2,4095(,RBASE)      SET SECOND                      14200000
         LA    RBASE2,1(,RBASE2)           BASE REGISTER                14250000
IEDAYQ   IEDHJN AYBSTART                                                14300000
         L     RGMAIN,AVTTSOPT          POINTER TO TSINPUT QCB          14350000
         TM    LCBSTAT2,LCBMSGNN        IS THIS MSGGEN ENTRY            14400000
         BO    MSGGEN                   YES, PROCESS MSGGEN             14450000
         TM    GMFLAG,GMENCON           IS THIS INSERT ENDING-CONTROL   14500000
*                                          REQUEST                      14550000
         BO    ENDCTL                   YES, INSERT ENDING-CONTROL      14600000
         TM    GMFLAG,GMINIT            IS THIS FIRST ENTRY FOR         14750000
*                                          THIS ERB POST                14800000
         BO    NOTEND                   YES, NOT FOR ENDING-CONTROL     14850000
         CLI   GMSATCT+ONE,XFF          IS COUNT FOR ERASE     @OZ26971 14860000
         BE    ENDCTL                   YES, INSERT END-CNTRL  @OZ26971 14870000
         LH    RWORK,GMSATCT            GET LINE NUMBER                 14900000
         LA    RWORK,ONE(,RWORK)        INCREMENT BY ONE                14950000
         EX    RWORK,CLI                IS THIS NEXT TO LAST LINE       15000000
         BNH   ENDCTL                   YES, INSERT ENDING-CONTROL      15050000
NOTEND   EQU   *                                                        15100000
         L     RBUFF,GMTSBUF            POINTER TO TSO BUFFER           15150000
         SR    RTSBUF,RTSBUF            CLEAR REGISTER FOR IC           15200000
         IC    RTSBUF,BUFFOFST          OFFSET TO DATA IN TSO BUFFER    15250000
         AR    RTSBUF,RBUFF             POINTER TO DATA IN TSO BUFFER   15300000
         MVC   GMTSSIZ+ONE(ONE),BUFFLNTH SET TSO DATA LENGTH            15350000
         MVC   GMTSCNT+ONE(ONE),BUFFLNTH SET TSO DATA LENGTH            15400000
         NI    QCBRETCT,XFF-QCBDEND     ASSUME NOT FULLSCR OR CONTROL   15450000
         TM    BUFFFL1,BUFFCNTL         IS TPUT FULL SCREEN OR CNTRL    15500000
         BNO   CHKINIT                  NO, CHECK FOR INITIAL ENTRY     15550000
         OI    QCBRETCT,QCBDEND         SET FULLSCR OR CONTROL MODE     15600000
         TM    BUFFFL1,BUFFEDIT         IS IT FULLSCR          @OZ28219 15610086
         BNO   CHKINIT                  NO, CONTROL ONLY       @OZ28219 15620086
         L     RWORK,LCBSCBA-1          SCB ADDRESS            @OZ28219 15630086
         OI    SCBSRCE-IEDQSCB(RWORK),INCLAST  SET NO INC      @OZ28219 15640086
CHKINIT  EQU   *                                                        15650000
         TM    GMFLAG,GMINIT            IS THIS FIRST ENTRY FOR         15700000
*                                          THIS ERB POST                15750000
         BO    INITIAL                  YES, INITIAL ENTRY              15800000
         CLI   LCBERBPY,XE4             IS ERB PRIORITY 'E4'            15850000
         BE    BTWTPUT                  YES, INSERT SUBSEQUENT TPUT     15900000
*                                          CONTROL HEADER               15950000
         NC    GMCRBUF,GMCRBUF          IS THERE A CURRENT BUFFER       16000000
         BNZ   BTWTPUT                  YES, INSERT SUBSEQUENT TPUT     16050000
*                                          CONTROL HEADER               16100000
INITIAL  EQU   *                                                        16150000
         SR    RWORK,RWORK              CLEAR REGISTER FOR IC           16200000
         IC    RWORK,GMLNSZ             DISPLAY SCREEN LINE SIZE        16250000
         SH    RWORK,GMCARCT            SUBTRACT CURRENT POSITION       16300000
         STH   RWORK,GMLNSPC            SET LINE SPACE AVAILABLE        16350000
         MVC   GMCRBUF+ONE(THREE),LCBERBCH POINTER TO FIRST TCAM BUFFER 16400000
         MVC   GMCRUNT+ONE(THREE),LCBERBCH POINTER TO FIRST TCAM UNIT   16450000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  16500000
         USING IEDQPRF,RWORK                                            16550000
         MVI   PRFNBUNT,ONE             SET ONE UNIT BUFFER             16600000
         XC    PRFLINK,PRFLINK          CLEAR BUFFER LINK ADDRESS       16650000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST UNIT             16700000
         BE    LSTUNT                   YES, UNIT COUNT SET             16750000
         L     RWORKE,PRFTIC            POINTER TO NEXT TCAM UNIT       16800000
         MVI   PRFNBUNT-IEDQPRF(RWORKE),ZERO UNIT COUNT ZERO            16850000
LSTUNT   EQU   *                                                        16900000
         LH    RCNT,AVTKEYLE            SPACE AVAILABLE IN TCAM UNIT    16950000
         STH   RCNT,PRFSIZE             SET TCAM DATA SIZE              17000000
         LA    RCNT,AVTUMALN(,RCNT)     INCREMENT FOR UNIT CNTRL AREA   17050000
         CLI   LCBERBPY,XE4             IS ERB PRIORITY 'E4'            17100000
         BNE   CHKMID                   NO, CHECK FOR MIDDLE OF TPUT    17150000
         NI    PRFSTAT1,PRFNHDRF        SET HEADER BUFFER               17200000
         SH    RCNT,HDPRFSZ             REDUCE FOR HEADER PREFIX        17250000
         STH   RCNT,GMTCSPC             SET TCAM SPACE AVAILABLE        17300000
         SPACE 2                                                        17350000
*********************************************************************** 17400000
         EJECT                                                          17450000
*********************************************************************** 17500000
*********                                                     ********* 17550000
*********     INSERT BEGINNING CONTROL IN TCAM BUFFER UNIT    ********* 17600000
*********                                                     ********* 17650000
*********************************************************************** 17700000
         SPACE 2                                                        17750000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT TCAM UNIT    17800000
         AH    RTCBUF,HDPRFSZ           POINTER TO TCAM DATA AREA       17850000
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS 3270 LOCAL     @G36XRYP 17900000
         BO    NOSTX                    YES, DON'T INSERT STX           17950000
         CLI   LCBFLAG1,ZERO            IS TERMINAL ON 3705             18000000
         BE    NOSTX                    YES, DON'T INSERT STX           18050000
         MVC   ZERO(ONE,RTCBUF),CNTRL0  INSERT STX IN TCAM UNIT         18100000
         LA    RWORK,ONE                COUNT OF DATA MOVED TO TCAM     18150000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   18200000
NOSTX    EQU   *                                                        18250000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL IS IT ASIS OR FULLSCR MODE     18300000
         BM    INSBC1                   NO, INSERT CONTROL SEQUENCE     18350000
         BZ    ISASIS                   YES, IS ASIS MODE      @OY19692 18360086
         L     RWORK,GMCRBUF            PTR TO CURRENT TCAM BF @OY19692 18370086
         OI    PRFSTAT1,PRFFLSCR        SET FULLSCR IN HEADER  @OY19692 18380086
ISASIS   EQU   *                                               @OY19692 18390086
         CLC   GMTSCNT,HTWO             IS COUNT EQUAL OR GREATER       18400000
*                                          THAN TWO                     18450000
         BL    INSBC1                   NO, ESCAPE,CMD,WCC NOT SUPPLIED 18500000
         CLI   ZERO(RTSBUF),ESC         WAS ESCAPE SUPPLIED             18550000
         BNE   INSBC1                   NO, INSERT CONTROL HEADER       18600000
         OI    GMFLAG,GMNUNLCK          ASSUME NO KEYBOARD RES @OY19561 18620086
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS 3270 LOCAL     @G36XRYP 18650000
         BO    LOCESC                   YES, CHECK LOCAL ESC   @OY19561 18700086
         CLI   ONE(RTCBUF),EAU          IS CMD ERASE-ALL-UNPR  @OY19561 18707086
         BE    MOVBC1                   YES, MOVE SUPPLIED HDR @OY19561 18714086
         NI    GMFLAG,XFF-GMNUNLCK      ALLOW KEYBOARD RESTORE @OY19561 18721086
         B     MOVBC1                   MOVE SUPPLIED HEADER   @OY19561 18728086
LOCESC   EQU   *                                               @OY19561 18735086
         MVI   PRFKEY,X0F               ASSUME ERASE-ALL-UNPROTECTED    18750000
         CLI   ONE(RTSBUF),EAU          IS COMMAND ERASE-ALL-UNPROTECT  18800000
         BE    SETSCR                   YES, REQUEST EAU CCW BE BUILT   18850000
         NI    GMFLAG,XFF-GMNUNLCK      ALLOW KEYBOARD RESTORE @OY19561 18870086
         CLI   ONE(RTSBUF),EW           IS COMMAND ERASE-WRITE          18900000
         BNE   MOVWCC                   NO, MOVE WRITE-CONTROL-CHAR     18950000
         MVI   PRFKEY,X05               SET FOR ERASE-WRITE             19000000
         DROP  RWORK                                                    19050000
SETSCR   EQU   *                                                        19100000
         OI    LCBCHAIN,LCBSCRNN        REQUEST SPECIAL COMMAND         19150000
MOVWCC   EQU   *                                                        19200000
         CLC   GMTSCNT,HTHREE           IS COUNT EQUAL OR GREATER       19250000
*                                          THAN THREE                   19300000
         BL    LOCBC1                   NO, WCC NOT SUPPLIED            19350000
         MVC   ZERO(ONE,RTCBUF),TWO(RTSBUF) MOVE WCC TO TCAM UNIT       19400000
         NI    ZERO(RTCBUF),XFF-UNLOCK  RESET KEYBOARD RESTORE          19450000
         LA    RWORK,THREE              COUNT OF DATA MOVED FROM TSO    19500000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    19550000
         B     UPDBC1                   UPDATE COUNT AND ADDRESS        19600000
MOVBC1   EQU   *                                                        19650000
         LA    RWORK,ONE                SET COUNT FOR EXECUTED MVC      19700000
         CLI   ONE(RTSBUF),EAU          IS COMMAND ERASE-ALL-UNPROTECT  19750000
         BE    NOWCC                    YES, NO WRITE-CONTROL-CHAR      19800000
         LA    RWORK,TWO                ADJUST MOVE COUNT               19850000
NOWCC    EQU   *                                                        19900000
         EX    RWORK,MVC                MOVE ESCAPE,CMD,(WCC) TO TCAM   19950000
         NI    TWO(RTCBUF),XFF-UNLOCK   RESET KEYBOARD RESTORE          20000000
         LA    RWORK,ONE(,RWORK)        SET ACTUAL DATA COUNT           20050000
         AR    RTSBUF,RWORK             UPDATE TSO BUFFER ADDRESS       20100000
         LH    RCNT,GMTSCNT             DECREMENT                       20150000
         SR    RCNT,RWORK                  TSO DATA                     20200000
         STH   RCNT,GMTSCNT                   COUNT                     20250000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   20300000
         B     CHKBC2                   CHECK FOR SET-BUFFER-ADDRESS    20350000
INSBC1   EQU   *                                                        20400000
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS 3270 LOCAL     @G36XRYP 20450000
         BO    LOCBC1                   YES, INSERT WRITE-CONTROL-CHAR  20500000
         MVC   ZERO(TWO,RTCBUF),CNTRL1  INSERT ESC,CMD IN TCAM          20550000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     20600000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   20650000
LOCBC1   EQU   *                                                        20700000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL IS IT FULLSCR MODE             20750000
         BO    LOCWCC                   YES, MOVE WCC TO TCAM           20800000
         BM    INSLOC                   EDIT OR CONTROL, INSERT WCC     20850000
         CLC   GMTSCNT,HTWO             IS COUNT EQUAL OR GREATER       20900000
*                                          THAN TWO                     20950000
         BL    INSLOC                   NO, INSERT WCC IN TCAM          21000000
         CLI   ONE(RTSBUF),SBA          WAS SBA CHARACTER SUPPLIED      21050000
         BNE   INSLOC                   NO, INSERT WCC IN TCAM          21100000
LOCWCC   EQU   *                                                        21150000
         MVC   ZERO(ONE,RTCBUF),ZERO(RTSBUF) MOVE WCC TO TCAM           21200000
         NI    ZERO(RTCBUF),XFF-UNLOCK  RESET KEYBOARD RESTORE          21250000
         LA    RWORK,ONE                COUNT OF DATA MOVED FROM TSO    21300000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    21350000
         B     UPDBC1                   UPDATE COUNT AND ADDRESS        21400000
INSLOC   EQU   *                                                        21450000
         MVC   ZERO(ONE,RTCBUF),CNTRL1+TWO INSERT WCC IN TCAM UNIT      21500000
UPDBC1   EQU   *                                                        21550000
         LA    RWORK,ONE                COUNT OF DATA MOVED TO TCAM     21600000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   21650000
CHKBC2   EQU   *                                                        21700000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL IS IT ASIS OR FULLSCR MODE     21750000
         BM    INSBC2                   NO, INSERT CONTROL SEQUENCE     21800000
         CLC   GMTSCNT,HTHREE           IS COUNT EQUAL OR GREATER       21850000
*                                          THAN THREE                   21900000
         BL    INSBC2                   NO, NO SET-BUFFER-ADDRESS       21950000
         CLI   ZERO(RTSBUF),SBA         WAS SBA SUPPLIED                22000000
         BNE   INSBC2                   NO, SBA NOT SUPPLIED            22050000
         BAL   RLINK,HDWRBIN            CONVERT CURSOR ADDRESS TO       22100000
*                                          BINARY VALUE                 22150000
         MVC   ZERO(THREE,RTCBUF),ZERO(RTSBUF) MOVE SBA,CUR1,CUR2       22200000
         LA    RWORK,THREE              COUNT OF DATA MOVED FROM TSO    22250000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    22300000
         B     UPDBC2                   UPDATE COUNT AND ADDRESS        22350000
INSBC2   EQU   *                                                        22400000
         BAL   RLINK,BINHDWR            CONVERT BINARY VALUE TO         22450000
*                                          CURSOR ADDRESS               22500000
         MVC   ZERO(ONE,RTCBUF),CNTRL2  INSERT SBA IN TCAM UNIT         22550000
UPDBC2   EQU   *                                                        22600000
         LA    RWORK,THREE              COUNT OF DATA MOVED TO TCAM     22650000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   22700000
CHKBC3   EQU   *                                                        22750000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL IS IT ASIS OR FULLSCR MODE     22800000
         BNM   CNTBC3                   YES, CHECK FOR SPACE AVAILABLE  22850000
         TM    BUFFFL1,BUFFCNTL         IS IT CONTROL MODE              22900000
         BO    MOVDATA                  YES, MOVE TSO DATA TO TCAM UNIT 22950000
         B     INSBC3                                          @OY20733 23000086
MPTOFF   NI    QCBTSOF2,X7F             TURN OFF MID PUT FLAG  @OY20733 23020086
         B     MOVDATA                  GO TO MOVE DATA        @OY20733 23030086
CNTBC3   EQU   *                                                        23050000
         CLC   GMTSCNT,HTWO             IS COUNT EQUAL OR GREATER       23100000
*                                          THAN TWO                     23150000
         BL    INSBC3A                  NO, NO START-FIELD              23200000
         CLI   ZERO(RTSBUF),SF          WAS SF SUPPLIED                 23250000
         BNE   INSBC3A                  NO, SF NOT SUPPLIED             23300000
         MVC   ZERO(TWO,RTCBUF),ZERO(RTSBUF) MOVE SF,ATTR TO TCAM       23350000
         LA    RWORK,TWO                COUNT OF DATA MOVED FROM TSO    23400000
         BAL   RLINK,UPDTSO                DATA COUNT                   23450000
         B     UPDBC3                   UPDATE COUNT AND ADDRESS        23500000
INSBC3A  EQU   *                                                        23550000
         CLC   GMTSCNT,HONE             IS COUNT EQUAL OR GREATER       23600000
*                                          THAN ONE                     23650000
         BL    INSBC3                   NO, INSERT SF,ATTR IN TCAM      23700000
         CLI   ZERO(RTSBUF),SPACE       WAS CONTROL CHARACTER SUPPLIED  23750000
         BL    MOVDATA                  YES, MOVE TSO DATA TO TCAM      23800000
INSBC3   EQU   *                                                        23850000
         TM    BUFFFL1,BUFFHDR          TSO HEADER ?           @OY20733 23860086
         BNO   MPTOFF                   NO, MOVE DATA          @OY20733 23870086
         CLI   BUFFOFST,BUFFHDLN        DATA AT START OF BUFFER@OY20733 23880086
         BNE   MPTOFF                   NO, MOVE DATA          @OY20733 23890086
         MVC   ZERO(TWO,RTCBUF),CNTRL3  INSERT SF,ATTR IN TCAM          23900000
UPDBC3   EQU   *                                                        23950000
         LA    RWORK,ONE                COUNT OF DATA DISPLAYED         24000000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     24050000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     24100000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   24150000
         B     MOVDATA                  MOVE TSO DATA TO TCAM UNIT      24200000
CHKMID   EQU   *                                                        24250000
         SH    RCNT,TXPRFSZ             REDUCE FOR TEXT PREFIX          24300000
         STH   RCNT,GMTCSPC             SET TCAM SPACE AVAILABLE        24350000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT TCAM UNIT    24400000
         AH    RTCBUF,AVTKEYLE          LENGTH OF TCAM UNIT             24450000
         LA    RTCBUF,AVTUMALN(,RTCBUF) LENGTH OF UNIT CONTROL AREA     24500000
         SH    RTCBUF,GMTCSPC           POINTER TO TCAM DATA AREA       24550000
         CLI   LCBFLAG1,ZERO            IS DISPLAY ON 3705              24600000
         BNE   CHKHDR                   NO, CHECK FOR TSO HEADER BUFF   24650000
         MVC   ZERO(THREE,RTCBUF),CNTRL1 INSERT ESC,CMD,WCC IN TCAM     24700000
         LA    RWORK,THREE              COUNT OF DATA MOVED TO TCAM     24750000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   24800000
CHKHDR   EQU   *                                                        24850000
         TM    BUFFFL1,BUFFHDR          IS THIS TSO HEADER BUFFER       24900000
         BNO   MPTOFF                   NO, DON'T INSERT HDR   @OY20733 24950086
         CLI   BUFFOFST,BUFFHDLN        IS DATA AT START OF BUFFER      25000000
         BNE   MPTOFF                   NO, DON'T INSERT HDR   @OY20733 25050086
         B     INSBC4                   YES, INSERT HEADER              25100000
BTWTPUT  EQU   *                                                        25150000
         USING IEDQPRF,RWORK                                            25200000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  25250000
         LH    RCNT,PRFSIZE             GET CURRENT TCAM BUFFER SIZE    25300000
         AH    RCNT,GMTCSPC             ADD TCAM SPACE AVAILABLE        25350000
         STH   RCNT,PRFSIZE             STORE NEW TCAM BUFFER SIZE      25400000
         DROP  RWORK                                                    25450000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT TCAM UNIT    25500000
         AH    RTCBUF,AVTKEYLE          LENGTH OF TCAM UNIT             25550000
         LA    RTCBUF,AVTUMALN(,RTCBUF) LENGTH OF UNIT CONTROL AREA     25600000
         SH    RTCBUF,GMTCSPC           POINTER TO TCAM DATA AREA       25650000
         CLC   GMTCSPC,HSEVEN           IS SPACE AVAILABLE IN TCAM      25700000
         BNL   INSBC4                   YES, PUT SEQUENCE IN BUFFER     25750000
         BAL   RLINK,ENDBUFF            NO, END THIS TCAM BUFFER        25800000
INSBC4   EQU   *                                                        25850000
         MVC   ZERO(TWO,RTCBUF),CNTRL4  INSERT SF,ATTR IN TCAM UNIT     25900000
         LA    RWORK,ONE                COUNT OF DATA DISPLAYED         25950000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     26000000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     26050000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   26100000
         BAL   RLINK,BINHDWR            CONVERT BINARY VALUE TO         26150000
*                                          CURSOR ADDRESS               26200000
         MVC   ZERO(ONE,RTCBUF),CNTRL2  INSERT SBA IN TCAM UNIT         26250000
         MVC   THREE(TWO,RTCBUF),CNTRL5 INSERT SF,ATTR IN TCAM UNIT     26300000
         LA    RWORK,ONE                COUNT OF DATA DISPLAYED         26350000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     26400000
         LA    RWORK,FIVE               COUNT OF DATA MOVED TO TCAM     26450000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   26500000
         B     MOVDATA                  MOVE TSO DATA TO TCAM UNIT      26550000
         SPACE 2                                                        26600000
*********************************************************************** 26650000
         EJECT                                                          26700000
*********************************************************************** 26750000
*********                                                     ********* 26800000
*********      INSERT ENDING CONTROL IN TCAM BUFFER UNIT      ********* 26850000
*********                                                     ********* 26900000
*********************************************************************** 26950000
         SPACE 2                                                        27000000
ENDCTL   EQU   *                                                        27050000
         SR    RWORK,RWORK              CLEAR REGISTER FOR IC           27100000
         IC    RWORK,GMLNSZ             DISPLAY SCREEN LINE SIZE        27150000
         SH    RWORK,GMCARCT            SUBTRACT CURRENT POSITION       27200000
         STH   RWORK,GMLNSPC            SET LINE SPACE AVAILABLE        27250000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  27300000
         LTR   RWORK,RWORK              IS THERE A TCAM BUFFER          27350000
         BNZ   SETREG                   YES, INITIALIZE REGISTERS       27400000
         MVC   GMCRBUF+ONE(THREE),LCBERBCH POINTER TO FIRST TCAM BUFFER 27450000
         MVC   GMCRUNT+ONE(THREE),LCBERBCH POINTER TO FIRST TCAM UNIT   27500000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  27550000
         USING IEDQPRF,RWORK                                            27600000
         OI    PRFSTAT1,PRFNHDRN        SET NOT HEADER BUFFER           27650000
         MVI   PRFNBUNT,ONE             SET ONE UNIT BUFFER             27700000
         XC    PRFLINK,PRFLINK          CLEAR BUFFER LINK ADDRESS       27750000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST UNIT             27800000
         BE    ENDUNT                   YES, UNIT COUNT SET             27850000
         L     RWORKE,PRFTIC            POINTER TO NEXT TCAM UNIT       27900000
         MVI   PRFNBUNT-IEDQPRF(RWORKE),ZERO UNIT COUNT ZERO            27950000
ENDUNT   EQU   *                                                        28000000
         LH    RCNT,AVTKEYLE            SPACE AVAILABLE IN TCAM UNIT    28050000
         STH   RCNT,PRFSIZE             SET TCAM DATA SIZE              28100000
         SH    RCNT,TXPRFSZ             REDUCE FOR TEXT PREFIX          28150000
         LA    RCNT,AVTUMALN(,RCNT)     INCREMENT FOR UNIT CNTRL AREA   28200000
         STH   RCNT,GMTCSPC             SET TCAM SPACE AVAILABLE        28250000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT TCAM UNIT    28300000
         AH    RTCBUF,TXPRFSZ           POINTER TO TCAM DATA AREA       28350000
         CLI   LCBFLAG1,ZERO            IS TERMINAL ON 3705             28400000
         BNE   NONCPR                   NO, CHECK TPUT MODE             28450000
         CLC   GMTCSPC,HTHREE           IS SPACE AVAILABLE IN TCAM      28500000
         BNL   NCPREM                   YES, INSERT SEQUENCE IN TCAM    28550000
         BAL   RLINK,ENDBUFF            NO, END THIS TCAM BUFFER        28600000
NCPREM   EQU   *                                                        28650000
         MVC   ZERO(THREE,RTCBUF),CNTRL1 INSERT ESC,CMD,WCC IN TCAM     28700000
         LA    RWORK,THREE              COUNT OF DATA MOVED TO TCAM     28750000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   28800000
NONCPR   EQU   *                                                        28850000
         TM    QCBRETCT,QCBDEND         WAS MODE FULLSCR OR CONTROL     28900000
         BO    CHKEC3                   YES, ONLY INSERT INC ORDER      28950000
         TM    QCBTSOF2,QCBMTP          IS THIS SAME TPUT      @OY20733 28960086
         BNO   CHKSPC                   NO                     @OY20733 28970086
         B     CHKEC4                   YES                    @OY20733 28990086
SETREG   EQU   *                                                        29050000
         L     RBUFF,GMTSBUF            POINTER TO CURRENT TSO BUFFER   29100000
         LH    RCNT,PRFSIZE             GET CURRENT TCAM BUFFER SIZE    29150000
         AH    RCNT,GMTCSPC             ADD TCAM SPACE AVAILABLE        29200000
         STH   RCNT,PRFSIZE             STORE NEW TCAM BUFFER SIZE      29250000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT TCAM UNIT    29300000
         AH    RTCBUF,AVTKEYLE          LENGTH OF TCAM UNIT             29350000
         LA    RTCBUF,AVTUMALN(,RTCBUF) LENGTH OF UNIT CONTROL AREA     29400000
         SH    RTCBUF,GMTCSPC           POINTER TO TCAM DATA AREA       29450000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL IS IT FULLSCR MODE             29500000
         BO    CHKEC3                   YES, INSERT INC ORDER  @OY19462 29550000
         TM    BUFFFL1,BUFFCNTL         IS IT CONTROL MODE              29600000
         BO    CHKEC3                   YES, INSERT INC ORDER           29650000
         TM    QCBRETCT,QCBDEND         IS INC ONLY TO BE ADDED         29700000
         BO    CHKEC3                   YES, INSERT INC ORDER           29750000
CHKSPC   EQU   *                                                        29800000
         CLC   GMTCSPC,HSIX             IS SPACE AVAILABLE IN TCAM      29850000
*                                          FOR LOCAL SEQUENCE           29900000
         BL    NOECSPC                  NO, END THIS TCAM BUFFER        29950000
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS 3270 LOCAL     @G36XRYP 30000000
         BO    MOVEC1                   YES, INSERT SEQUENCE IN TCAM    30050000
         CLI   LCBFLAG1,ZERO            IS TERMINAL ON 3705             30100000
         BE    MOVEC1                   YES, INSERT SEQUENCE IN TCAM    30150000
         CLC   GMTCSPC,HEIGHT           IS SPACE AVAILABLE IN TCAM      30200000
*                                          FOR REMOTE SEQUENCE          30250000
         BNL   MOVEC1                   YES, INSERT SEQUENCE IN TCAM    30300000
NOECSPC  EQU   *                                                        30350000
         BAL   RLINK,ENDBUFF            NO, END THIS TCAM BUFFER        30400000
MOVEC1   EQU   *                                                        30450000
         L     RWORK,LCBSCBA-1          GET SCB ADDRESS        @OZ27604 30455000
         TM    SCBSRCE-IEDQSCB(RWORK),BYPREST BYPASS OR RESTORE@OZ27604 30460000
*                                       CHAR IN THE DATA?      @OZ27604 30465000
         BZ    SFATTR                   NO BYPASS OR RESTORE   @OZ28765 30470000
*                                       IN DATA                @OZ28765 30475000
         NI    SCBSRCE-IEDQSCB(RWORK),XFF-BYPREST TURN OFF     @OZ28765 30480000
         B     NOSFATTR                 SKIP OVER SF ATTR      @OZ28765 30485000
SFATTR   EQU   *                                               @OZ28765 30490000
         TM    QCBTSOF2,QCBMTP          IS THIS SAME TPUT      @OY20733 30492086
         BNO   NOTMTP                   NO                     @OY20733 30493086
         B     NOSFATTR                 YES                    @OY20733 30495086
NOTMTP   EQU   *                                               @OY20733 30496086
         MVC   ZERO(TWO,RTCBUF),CNTRL6  INSERT SF,ATTR IN TCAM          30500000
         LA    RWORK,ONE                COUNT OF DATA DISPLAYED         30550000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     30600000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     30650000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   30700000
NOSFATTR EQU   *                                               @OZ27604 30720000
         BAL   RLINK,BINHDWR            CONVERT BINARY VALUE TO         30750000
*                                          CURSOR ADDRESS               30800000
         MVC   ZERO(ONE,RTCBUF),CNTRL2  INSERT SBA IN TCAM UNIT         30850000
         LA    RWORK,THREE              COUNT OF DATA MOVED TO TCAM     30900000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   30950000
CHKEC3   EQU   *                                                        31000000
         CLC   GMTCSPC,HONE             IS SPACE AVAILABLE IN TCAM      31050000
         BNL   MOVEC3                   YES, INSERT SEQUENCE IN TCAM    31100000
         BAL   RLINK,ENDBUFF            NO, END THIS TCAM BUFFER        31150000
MOVEC3   EQU   *                                                        31200000
         L     RWORK,LCBSCBA-1          SCB ADDRESS            @OZ28219 31210086
         TM    SCBSRCE-IEDQSCB(RWORK),INCLAST  WAS INC MOVED   @OZ28219 31220086
*                                      FROM TSO BFR (FULLSCR)  @OZ28219 31230086
         BO    CHKEC4                YES, DO NOT INSERT ANOTHER@OZ28219 31240086
         MVC   ZERO(ONE,RTCBUF),CNTRL7  INSERT INC IN TCAM              31250000
         LA    RWORK,ONE                COUNT OF DATA MOVED TO TCAM     31300000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   31350000
CHKEC4   EQU   *                                                        31400000
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS 3270 LOCAL     @G36XRYP 31450000
         BNO   REMOTE                   NO, 3270 REMOTE        @OY19561 31500086
         TM    QCBRETCT,QCBDEND         FULLSCR?               @OZ31929 31501086
         BO    ECCOMP                   YES, NO UNLOCK         @OZ31929 31502086
         TM    GMFLAG,GMNUNLCK          IS KYBD TO BE RESTORED @OY19561 31503086
         BO    ECCOMP                   NO, SEQUENCE COMPLETED @OY19561 31506086
         CLI   GMSATCT+ONE,XFF          IS COUNT FOR ERASE     @OY20752 31509086
         BE    ECCOMP                   YES, SEQUENCE COMPLETE @OY19561 31512086
         TM    QCBTSOF1,QCBTGET         IS TGET REQUESTED      @OY19561 31515086
         BNO   ECCOMP                   NO, SEQUENCE COMPLETED @OY19561 31518086
         L     RWORK,LCBERBCH-ONE       POINTER TO FIRST BUFFR @OY19561 31521086
         AH    RWORK,HDPRFSZ            PTR TO DATA AREA       @OY19561 31524086
         OI    ZERO(RWORK),UNLOCK       SET RESTORE IN WCC     @OY19561 31527086
         OI    QCBTSOF2,QCBDSSMI        SET KYBD UNLOCKED      @OY19561 31530086
         B     ECCOMP                   SEQUENCE COMPLETED     @OY19561 31533086
REMOTE   EQU   *                                               @OY19561 31536086
         CLI   LCBFLAG1,ZERO            IS TERMINAL ON 3705             31550000
         BE    REMNCP                   YES, ADD LINE CONTROL  @OY19561 31600086
         TM    QCBRETCT,QCBDEND         FULLSCR?               @OZ31929 31600686
         BO    NORMEND                  YES, NO UNLOCK         @OZ31929 31601286
         TM    GMFLAG,GMNUNLCK          IS KYBD TO BE RESTORED @OY19561 31602086
         BO    NORMEND                  NO, ADD NORMAL ENDING  @OY19561 31604086
         CLI   GMSATCT+ONE,XFF          IS COUNT FOR ERASE     @OY20752 31606086
         BE    NORMEND                  YES, ADD NORMAL ENDING @OY19561 31608086
         TM    QCBTSOF1,QCBTGET         IS TGET REQUESTED      @OY19561 31610086
         BNO   NORMEND                  NO, ADD NORMAL ENDING  @OY19561 31612086
         CLC   GMTCSPC,HONE             IS SPACE AVAILABLE     @OY19561 31614086
         BNL   MOVEC4A                  YES, INSERT SEQUENCE   @OY19561 31616086
         BAL   RLINK,ENDBUFF            NO, END TCAM BUFFER    @OY19561 31618086
MOVEC4A  EQU   *                                               @OY19561 31620086
         MVC   ZERO(ONE,RTCBUF),CNTRL9  INSERT ETB IN TCAM     @OY19561 31622086
         LA    RWORK,ONE                COUNT OF DATA MOVED    @OY19561 31624086
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT/ADDR @OY19561 31626086
         BAL   RLINK,ENDBUFF            END THIS TCAM BUFFER   @OY19561 31628086
         MVC   ZERO(SIX,RTCBUF),CNTRLA  INSERT UNLOCK IN TCAM  @OY19561 31630086
         OI    QCBTSOF2,QCBDSSMI        SET KYBD UNLOCKED      @OY19561 31632086
         LA    RWORK,SIX                COUNT OF DATA MOVED    @OY19561 31634086
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT/ADDR @OY19561 31636086
         B     ECCOMP                   SEQUENCE COMPLETED     @OY19561 31638086
NORMEND  EQU   *                                               @OY19561 31640086
         CLC   GMTCSPC,HTWO             IS SPACE AVAILABLE IN TCAM      31650000
         BNL   MOVEC4                   YES, INSERT SEQUENCE IN TCAM    31700000
         BAL   RLINK,ENDBUFF            NO, END THIS TCAM BUFFER        31750000
MOVEC4   EQU   *                                                        31800000
         MVC   ZERO(TWO,RTCBUF),CNTRL8  INSERT ETX,EOT IN TCAM          31850000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     31900000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   31950000
         B     ECCOMP                   SEQUENCE COMPLETED     @OY19561 31953086
REMNCP   EQU   *                                               @OY19561 31956086
         TM    QCBRETCT,QCBDEND         FULLSCR?               @OZ31929 31957086
         BO    ECCOMP                   YES, NO UNLOCK         @OZ31929 31958086
         TM    GMFLAG,GMNUNLCK          IS KYBD TO BE RESTORED @OY19561 31959086
         BO    ECCOMP                   NO, SEQUENCE COMPLETED @OY19561 31962086
         CLI   GMSATCT+ONE,XFF          IS COUNT FOR ERASE     @OY20752 31965086
         BE    ECCOMP                   YES, SEQUENCE COMPLETE @OY19561 31968086
         TM    QCBTSOF1,QCBTGET         IS TGET REQUESTED      @OY19561 31971086
         BNO   ECCOMP                   NO, SEQUENCE COMPLETED @OY19561 31974086
         BAL   RLINK,ENDBUFF            END THIS TCAM BUFFER   @OY19561 31977086
         LR    RWORK,RTCBUF             PTR TO NEXT DATA BYTE  @OY19561 31980086
         BCTR  RWORK,ZERO               POINT TO WCC           @OY19561 31983086
         MVI   ZERO(RWORK),UNLWCC       INSERT UNLOCK IN TCAM  @OY19561 31986086
         OI    QCBTSOF2,QCBDSSMI        SET KYBD UNLOCKED      @OY19561 31989086
ECCOMP   EQU   *                                                        32000000
         OI    GMFLAG,GMENCIN           SET ENDING-CONTROL INSERTED     32050000
         USING IEDQPRF,RWORK                                            32100000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  32150000
         NI    PRFSTAT1,PRFNLSTF        SET LAST BUFFER                 32200000
         LH    RCNT,PRFSIZE             CURRENT TCAM DATA SIZE          32250000
         SH    RCNT,GMTCSPC             REDUCE BY AMOUNT AVAILABLE      32300000
         STH   RCNT,PRFSIZE             SET NEW TCAM DATA SIZE          32350000
         DROP  RWORK                                                    32400000
         B     EXITN                    EXIT TO IEDAYN                  32450000
         SPACE 2                                                        32500000
*********************************************************************** 32550000
         EJECT                                                          32600000
*********************************************************************** 32650000
*********                                                     ********* 32700000
*********  CALCULATE AMOUNT OF DATA TO BE MOVED TO TCAM UNIT  ********* 32750000
*********                                                     ********* 32800000
*********************************************************************** 32850000
         SPACE 2                                                        32900000
MOVDATA  EQU   *                                                        32950000
RESUMOV  EQU   *                                                        33000000
         MVI   GMCODE,ZERO              CLEAR TRANSLATE AND TEST        33050000
*                                          COMPLETION INDEX             33100000
         LH    RCNT,GMTCSPC             AMOUNT OF SPACE IN TCAM UNIT    33150000
         CH    RCNT,GMTSCNT             COMPARE TO AMOUNT OF TSO DATA   33200000
         BE    TCAMEQ                   TCAM SPACE = TSO DATA           33250000
         BL    TCAMLO                   TCAM SPACE < TSO DATA           33300000
TCAMHI   EQU   *                        TSO DATA < TCAM SPACE           33350000
         LH    RCNT,GMTSCNT             AMOUNT OF TSO DATA              33400000
         CH    RCNT,GMLNSPC             COMPARE TO SPACE ON DISP LINE   33450000
         BE    COND6                    (LINE SPACE = TSO DATA) <       33500000
*                                          TCAM SPACE                   33550000
         BL    COND3                    (TSO DATA < TCAM SPACE) &       33600000
*                                          (TSO DATA < LINE SPACE)      33650000
         B     COND7                    LINE SPACE < TSO DATA <         33700000
*                                          TCAM SPACE                   33750000
TCAMEQ   EQU   *                        TCAM SPACE = TSO DATA           33800000
         CH    RCNT,GMLNSPC             COMPARE SPACE IN TCAM UNIT TO   33850000
*                                          SPACE ON DISPLAY LINE        33900000
         BE    COND1                    TCAM SPACE = TSO DATA =         33950000
*                                          LINE SPACE                   34000000
         BL    COND2                    (TCAM SPACE = TSO DATA) <       34050000
*                                          LINE SPACE                   34100000
         B     COND7                    LINE SPACE < (TCAM SPACE =      34150000
*                                          TSO DATA)                    34200000
TCAMLO   EQU   *                        TCAM SPACE < TSO DATA           34250000
         CH    RCNT,GMLNSPC             COMPARE SPACE IN TCAM UNIT TO   34300000
*                                          SPACE ON DISPLAY LINE        34350000
         BE    COND4                    (TCAM SPACE = LINE SPACE) <     34400000
*                                          TSO DATA                     34450000
         BL    COND5                    (TCAM SPACE < LINE SPACE) &     34500000
*                                          (TCAM SPACE < TSO DATA)      34550000
*        B     COND7                    LINE SPACE < TCAM SPACE <       34600000
*                                          TSO DATA                     34650000
         SPACE 2                                                        34700000
*********************************************************************** 34750000
         EJECT                                                          34800000
*********************************************************************** 34850000
         SPACE 2                                                        34900000
COND7    EQU   *                                                        34950000
         LH    RCNT,GMLNSPC             AMOUNT OF SPACE ON DISP LINE    35000000
         OI    GMCODE,GMLINE            SET LINE SPACE SMALLEST         35050000
         B     TRANSLAT                 TRANSLATE AND TEST              35100000
COND6    EQU   *                                                        35150000
         OI    GMCODE,GMLINE+GMTSO      SET LINE SPACE AND TSO DATA     35200000
*                                          EQUAL AND SMALLER THAN TCAM  35250000
         B     TRANSLAT                 TRANSLATE AND TEST              35300000
COND5    EQU   *                                                        35350000
         OI    GMCODE,GMTCAM            SET TCAM SPACE SMALLEST         35400000
         B     TRANSLAT                 TRANSLATE AND TEST              35450000
COND4    EQU   *                                                        35500000
         OI    GMCODE,GMTCAM+GMLINE     SET TCAM SPACE AND LINE SPACE   35550000
*                                          EQUAL AND SMALLER THAN TSO   35600000
         B     TRANSLAT                 TRANSLATE AND TEST              35650000
COND3    EQU   *                                                        35700000
         OI    GMCODE,GMTSO             SET TSO DATA SMALLEST           35750000
         B     TRANSLAT                 TRANSLATE AND TEST              35800000
COND2    EQU   *                                                        35850000
         OI    GMCODE,GMTCAM+GMTSO      SET TCAM SPACE AND TSO DATA     35900000
*                                          EQUAL AND SMALLER THAN LINE  35950000
         B     TRANSLAT                 TRANSLATE AND TEST              36000000
COND1    EQU   *                                                        36050000
         OI    GMCODE,GMTCAM+GMLINE+GMTSO  SET TCAM SPACE, LINE SPACE   36100000
*                                          AND TSO DATA EQUAL           36150000
         SPACE 2                                                        36200000
*********************************************************************** 36250000
         EJECT                                                          36300000
*********************************************************************** 36350000
*********                                                     ********* 36400000
*********          TRANSLATION AND TEST ROUTINE               ********* 36450000
*********                                                     ********* 36500000
*********************************************************************** 36550000
         SPACE 2                                                        36600000
TRANSLAT EQU   *                                                        36650000
         LTR   RCNT,RCNT                ANY DATA TO TRANSLATE           36700000
         BZ    NOTRANS                  NO, SKIP TRANSLATE & TEST       36750000
         L     RTABLE,EDIT              ASSUME EDIT MODE                36800000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL CHECK MODE OF TPUT             36850000
         BZ    ASISTRT                  IT IS ASIS MODE                 36900000
         BO    FULSCTRT                 EDIT+CONTROL IS FULLSCR         36950000
         TM    BUFFFL1,BUFFCNTL         IS IT CONTROL MODE              37000000
         BNO   TRANTEST                 NO, MUST BE EDIT MODE           37050000
CNTRLTRT EQU   *                                                        37100000
         L     RTABLE,CONTROL           IT IS CONTROL MODE              37150000
         B     TRANTEST                 TRANSLATE AND TEST              37200000
ASISTRT  EQU   *                                                        37250000
FULSCTRT EQU   *                                                        37300000
         L     RTABLE,ASIS              IT IS ASIS OR FULLSCR MODE      37350000
TRANTEST EQU   *                                                        37400000
         SR    R2,R2                    CLEAR PARAMETER REGISTER        37450000
         BCTR  RCNT,ZERO                DECREMENT FOR EXECUTED TRT      37500000
         EX    RCNT,TRT                 EXECUTE TRANSLATE AND TEST      37550000
         BZ    TRTCC0                   NO HITS IN TRANSLATED DATA      37600000
         LR    R15,R2                   SAVE FUNCTION BYTE              37650000
         L     RBUFF,GMTSBUF            POINTER TO CURRENT TSO BUFFER   37700000
         LA    RCNT,ZERO(,R1)           ADDRESS OF ARQUMENT BYTE        37750000
         SR    RCNT,RTSBUF              DETERMINE AMOUNT OF DATA        37800000
*                                          TRANSLATED                   37850000
         BNP   NOMOVE                   NO DATA TO MOVE                 37900000
         BCTR  RCNT,ZERO                DECREMENT FOR EXECUTED MOVE     37950000
         EX    RCNT,MVC                 MOVE TSO DATA TO TCAM UNIT      38000000
         LA    RCNT,ONE(,RCNT)          RESTORE ACTUAL DATA COUNT       38050000
NOMOVE   EQU   *                                                        38100000
         BAL   RLINK,UPDCNTS            UPDATE DATA COUNTS AND ADDRESS  38150000
         SLL   R15,TWO                  MULTIPLY FUNCTION BY FOUR       38200000
TRTBTBL  EQU   *                                                        38250000
         B     TRTBTBL(R15)             BRANCH TO PROPER ROUTINE        38300000
         B     CNVRTCLN                 01 - CONVERT TO COLON           38350000
         B     CNVRTRES                 02 - CONVERT TO RESTORE SEQ     38400000
         B     CNVRTBYP                 03 - CONVERT TO BYPASS SEQ      38450000
         B     NONDISP1                 04 - NON-DISPLAYABLE - 1 CHAR   38500000
         B     NONDISP3                 05 - NON-DISPLAYABLE - 3 CHAR   38550000
         B     NONDISP4                 06 - NON-DISPLAYABLE - 4 CHAR   38600000
         B     SKIPCHAR                 07 - SKIP SENDING 1 CHARACTER   38650000
         SPACE 2                                                        38700000
TRTCC0   EQU   *                                                        38750000
         L     RBUFF,GMTSBUF            POINTER TO CURRENT TSO BUFFER   38800000
         EX    RCNT,MVC                 MOVE TSO DATA TO TCAM UNIT      38850000
         LA    RCNT,ONE(,RCNT)          RESTORE ACTUAL DATA COUNT       38900000
         BAL   RLINK,UPDCNTS            UPDATE DATA COUNTS AND ADDRESS  38950000
NOTRANS  EQU   *                                                        39000000
         SR    RWORK,RWORK              CLEAR WORK REGISTER             39050000
         IC    RWORK,GMCODE             GET INDEX TO PROPER ROUTINE     39100000
MOVBTBL  EQU   *                                                        39150000
         B     MOVBTBL(RWORK)           BRANCH TO PROPER ROUTINE        39200000
         B     ROUT3                    1 - TSO < TCAM,TSO < LINE       39250000
         B     ROUT7                    2 - LINE < TCAM,LINE < TSO      39300000
         B     ROUT6                    3 - LINE=TSO < TCAM             39350000
         B     ROUT5                    4 - TCAM < LINE,TCAM < TSO      39400000
         B     ROUT2                    5 - TCAM=TSO < LINE             39450000
         B     ROUT4                    6 - TCAM=LINE < TSO             39500000
         B     ROUT1                    7 - TCAM=LINE=TSO               39550000
         SPACE 2                                                        39600000
*********************************************************************** 39650000
         EJECT                                                          39700000
*********************************************************************** 39750000
*********                                                     ********* 39800000
*********            CHARACTER CONVERSION ROUTINES            ********* 39850000
*********                                                     ********* 39900000
*********************************************************************** 39950000
         SPACE 2                                                        40000000
CNVRTCLN EQU   *                        CONVERT CHARACTER TO COLON      40050000
         CLI   ZERO(RTSBUF),CR          IS IT CARRIAGE RETURN           40100000
         BNE   NOCR                     NO, REPLACE CHARACTER           40150000
         LA    RWORK,ONE                SET REGISTER TO ONE             40200000
         CH    RWORK,GMTSCNT            IS THIS LAST CHARACTER          40250000
         BNE   NOCR                     NO, REPLACE CHARACTER           40300000
         TM    BUFFFL1,BUFFNLCR         IS THIS LAST TSO BUFFER         40350000
         BNO   NOCR                     NO, REPLACE CHARACTER           40400000
         STH   RWORK,GMLNSPC            GO TO NEW LINE                  40450000
         B     SKIPCHAR                 SKIP SENDING CHARACTER          40500000
NOCR     EQU   *                                                        40550000
         MVI   ZERO(RTCBUF),COLON       MOVE COLON TO TCAM BUFFER       40600000
         LA    RWORK,ONE                COUNT OF DATA MOVED FROM TSO    40650000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    40700000
         LA    RWORK,ONE                COUNT OF DATA MOVED TO TCAM     40750000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   40800000
         LH    RWORK,GMLNSPC            DECREMENT DISPLAY               40850000
         BCTR  RWORK,ZERO                  LINE SPACE                   40900000
         STH   RWORK,GMLNSPC                  AVAILABLE                 40950000
         BAL   RLINK,CHKCNTS            CHECK FOR DEPLETED RESOURCES    41000000
         B     RESUMOV                  RESUME DATA MOVEMENT            41050000
         SPACE 2                                                        41100000
*********************************************************************** 41150000
         SPACE 2                                                        41200000
CNVRTRES EQU   *                        CONVERT TO RESTORE SEQUENCE     41250000
         CLC   GMTCSPC,HTWO             IS SPACE AVAILABLE IN TCAM      41300000
         BNL   RESOK                    YES, PUT RESTORE IN BUFFER      41350000
         BAL   RLINK,ENDBUFF            NO, END THIS TCAM BUFFER        41400000
RESOK    EQU   *                                                        41450000
         MVI   ZERO(RTCBUF),SF          MOVE IN START-FIELD ORDER       41500000
         MVI   ONE(RTCBUF),RESATTR      MOVE IN RESTORE ATTRIBUTE       41550000
         L     RWORK,LCBSCBA-1          GET SCB ADDRESS        @OZ27604 41560000
         OI    SCBSRCE-IEDQSCB(RWORK),BYPREST  RESTORE FOUND   @OZ27604 41570000
         LH    RWORK,GMLNSPC            DECREMENT DISPLAY               41600000
         BCTR  RWORK,ZERO                  LINE SPACE                   41650000
         STH   RWORK,GMLNSPC                  AVAILABLE                 41700000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     41750000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   41800000
         LA    RWORK,ONE                COUNT OF DATA MOVED FROM TSO    41850000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    41900000
         BAL   RLINK,CHKCNTS            CHECK FOR DEPLETED RESOURCES    41950000
         B     RESUMOV                  RESUME DATA MOVEMENT            42000000
         SPACE 2                                                        42050000
*********************************************************************** 42100000
         SPACE 2                                                        42150000
CNVRTBYP EQU   *                        CONVERT TO BYPASS SEQUENCE      42200000
         CLC   GMTCSPC,HTWO             IS SPACE AVAILABLE IN TCAM      42250000
         BNL   BYPOK                    YES, PUT RESTORE IN BUFFER      42300000
         BAL   RLINK,ENDBUFF            NO, END THIS TCAM BUFFER        42350000
BYPOK    EQU   *                                                        42400000
         MVI   ZERO(RTCBUF),SF          MOVE IN START-FIELD ORDER       42450000
         MVI   ONE(RTCBUF),BYPATTR      MOVE IN BYPASS ATTRIBUTE        42500000
         L     RWORK,LCBSCBA-1          GET SCB ADDRESS        @OZ27604 42510000
         OI    SCBSRCE-IEDQSCB(RWORK),BYPREST   BYPASS FOUND   @OZ27604 42520000
         LH    RWORK,GMLNSPC            DECREMENT DISPLAY               42550000
         BCTR  RWORK,ZERO                  LINE SPACE                   42600000
         STH   RWORK,GMLNSPC                  AVAILABLE                 42650000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     42700000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   42750000
         LA    RWORK,ONE                COUNT OF DATA MOVED FROM TSO    42800000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    42850000
         BAL   RLINK,CHKCNTS            CHECK FOR DEPLETED RESOURCES    42900000
         B     RESUMOV                  RESUME DATA MOVEMENT            42950000
         SPACE 2                                                        43000000
*********************************************************************** 43050000
         SPACE 2                                                        43100000
NONDISP1 EQU   *                        NON-DISPLAYABLE 1 CHAR SEQ      43150000
         CLI   ZERO(RTSBUF),INC         IS IT INSERT CURSOR             43200000
         BNE   NOINC                    NO, MOVE DATA TO TCAM           43250000
         CLC   GMTSCNT,HONE             IS THIS LAST CHARACTER          43300000
         BNE   NOINC                    NO, MOVE DATA TO TCAM           43350000
         TM    BUFFFL1,BUFFNLCR         IS THIS LAST TSO BUFFER         43400000
         BNO   NOINC                    NO, MOVE DATA TO TCAM           43450000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL  FULLSCR?             @OZ28219 43457086
         BNO   INCLST                   NO, SET INC REQUIRED   @OZ28219 43464086
         L     RWORK,LCBSCBA-1          SCB ADDRESS            @OZ28219 43471086
         OI    SCBSRCE-IEDQSCB(RWORK),INCLAST  SET NO INC REQD @OZ28219 43478086
         B     NOINC                    MOVE INC TO TCAM BFR   @OZ28219 43485086
INCLST   EQU   *                                               @OZ28219 43492086
         OI    QCBRETCT,QCBDEND         SET ONLY INC REQUIRED           43500000
         B     SKIPCHAR                 SKIP SENDING CHARACTER          43550000
NOINC    EQU   *                                                        43600000
         MVC   ZERO(ONE,RTCBUF),ZERO(RTSBUF) MOVE DATA TO TCAM          43650000
         LA    RWORK,ONE                COUNT OF DATA MOVED TO TCAM     43700000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   43750000
         LA    RWORK,ONE                COUNT OF DATA MOVED FROM TSO    43800000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    43850000
         BAL   RLINK,CHKCNTS            CHECK FOR DEPLETED RESOURCES    43900000
         B     RESUMOV                  RESUME DATA MOVEMENT            43950000
         SPACE 2                                                        44000000
*********************************************************************** 44050000
         SPACE 2                                                        44100000
NONDISP3 EQU   *                        NON-DISPLAYABLE 3 CHAR SEQ      44150000
         LH    R0,HTHREE                CHARACTER SEQUENCE LENGTH       44200000
         B     NONDISPX                 GO TO COMMON ROUTINE            44250000
         SPACE 2                                                        44300000
*********************************************************************** 44350000
         SPACE 2                                                        44400000
NONDISP4 EQU   *                        NON-DISPLAYABLE 4 CHAR SEQ      44450000
         LH    R0,HFOUR                 CHARACTER SEQUENCE LENGTH       44500000
         B     NONDISPX                 GO TO COMMON ROUTINE            44550000
         SPACE 2                                                        44600000
*********************************************************************** 44650000
         SPACE 2                                                        44700000
NONDISPX EQU   *                        NON-DISPLAYABLE 4 CHAR SEQ      44750000
         CH    R0,GMTCSPC               IS SPACE AVAILABLE IN TCAM      44800000
         BL    NDSPXOK                  YES, PUT SEQUENCE IN BUFFER     44850000
         BAL   RLINK,ENDBUFF            NO, END THIS TCAM BUFFER        44900000
NDSPXOK  EQU   *                                                        44950000
         CH    R0,GMTSCNT               IS COMPLETE SEQUENCE IN BUFFER  45000000
         BL    SEQXOK                   YES, CALCULATE NEW CURSOR ADDR  45050000
         LH    RCNT,GMTSCNT             COUNT OF REMAINING TSO DATA     45100000
         BCTR  RCNT,ZERO                DECREMENT FOR EXECUTED MVC      45150000
         EX    RCNT,MVC                 MOVE TSO DATA TO TCAM UNIT      45200000
         LA    RCNT,ONE(,RCNT)          RESTORE ACTUAL DATA COUNT       45250000
         LR    RWORK,RCNT               COUNT OF DATA MOVED TO TCAM     45300000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   45350000
         LR    RWORK,RCNT               COUNT OF DATA MOVED FROM TSO    45400000
         BAL   RLINK,UPDTSO             UPDATE TCAM COUNT AND ADDRESS   45450000
         SR    RCNT,R0                  CALCULATE AMOUNT OF SEQUENCE    45500000
         LPR   RCNT,RCNT                   NOT MOVED TO TCAM UNIT       45550000
         LH    RWORK,GMLNSPC            INCREMENT DISPLAY               45600000
         AR    RWORK,RCNT                  LINE SPACE                   45650000
         STH   RWORK,GMLNSPC                  AVAILABLE                 45700000
         BAL   RLINK,CHKCNTS            CHECK FOR DEPLETED RESOURCES    45750000
         B     RESUMOV                  RESUME DATA MOVEMENT            45800000
SEQXOK   EQU   *                                                        45850000
         BCTR  R0,0                     REDUCE FOR EXECUTED MOVE        45900000
         LR    RWORK,R0                 PUT VALUE IN USEABLE REGISTER   45950000
         EX    RWORK,MVC                MOVE DATA TO TCAM               46000000
         BAL   RLINK,HDWRBIN            CONVERT CURSOR ADDR TO BINARY   46050000
         AH    R0,HONE                  RESTORE ACTUAL DATA COUNT       46100000
         LR    RWORK,R0                 COUNT OF DATA MOVED TO TCAM     46150000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   46200000
         LR    RWORK,R0                 COUNT OF DATA MOVED FROM TSO    46250000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    46300000
         BAL   RLINK,CHKCNTS            CHECK FOR DEPLETED RESOURCES    46350000
         B     RESUMOV                  RESUME DATA MOVEMENT            46400000
         SPACE 2                                                        46450000
*********************************************************************** 46500000
         SPACE 2                                                        46550000
SKIPCHAR EQU   *                        SKIP SENDING ONE CHARACTER      46600000
         LA    RWORK,ONE                COUNT OF DATA SKIPPED IN TSO    46650000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    46700000
         BAL   RLINK,CHKCNTS            CHECK FOR DEPLETED RESOURCES    46750000
         B     RESUMOV                  RESUME DATA MOVEMENT            46800000
         SPACE 2                                                        46850000
*********************************************************************** 46900000
         EJECT                                                          46950000
*********************************************************************** 47000000
*********                                                     ********* 47050000
*********         TRANSLATE AND TEST COMPLETION ROUTINE       ********* 47100000
*********                                                     ********* 47150000
*********************************************************************** 47200000
         SPACE 2                                                        47250000
ROUT1    EQU   *                                                        47300000
         BAL   RLINK,CNTLINE            COUNT OUTPUT LINE               47350000
ROUT2    EQU   *                                                        47400000
         BAL   RLINK,NEWUNIT            GET NEW TCAM BUFFER UNIT        47450000
ROUT3    EQU   *                                                        47500000
         BAL   RLINK,NEWTPUT            GET NEXT TPUT DATA              47550000
         B     RESUMOV                  RESUME DATA MOVEMENT            47600000
         SPACE 2                                                        47650000
ROUT4    EQU   *                                                        47700000
         BAL   RLINK,CNTLINE            COUNT OUTPUT LINE               47750000
ROUT5    EQU   *                                                        47800000
         BAL   RLINK,NEWUNIT            GET NEW TCAM BUFFER UNIT        47850000
         B     RESUMOV                  RESUME DATA MOVEMENT            47900000
         SPACE 2                                                        47950000
ROUT6    EQU   *                                                        48000000
         BAL   RLINK,CNTLINE            COUNT OUTPUT LINE               48050000
         BAL   RLINK,NEWTPUT            GET NEXT TPUT DATA              48100000
         B     RESUMOV                  RESUME DATA MOVEMENT            48150000
         SPACE 2                                                        48200000
ROUT7    EQU   *                                                        48250000
         BAL   RLINK,CNTLINE            COUNT OUTPUT LINE               48300000
         B     RESUMOV                  RESUME DATA MOVEMENT            48350000
         SPACE 2                                                        48400000
*********************************************************************** 48450000
         SPACE 2                                                        48500000
CNTLINE  EQU   *                                                        48550000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL IS IT FULLSCR MODE             48600000
         BO    NOTLAST                  YES, INITIALIZE LINE SPACE      48650000
CNTLIN1  EQU   *                                                        48700000
         TM    QCBFLAG,QCBTSSES         IN TSO SESSION                  48750000
         BNOR  RLINK                    NO, RETURN TO CALLER            48800000
         CLI   GMSATCT+ONE,XFF          IS LINE COUNT FOR ERASE         48850000
         BER   RLINK                    YES, RETURN TO CALLER           48900000
         LH    RWORK,GMSATCT            INCREMENT COUNT                 48950000
         LA    RWORK,ONE(,RWORK)           OF LINES                     49000000
         STH   RWORK,GMSATCT                  DISPLAYED                 49050000
         LA    RWORK,ONE(,RWORK)        INCREMENT TO NEXT LINE          49100000
         EX    RWORK,CLI                IS NEXT LINE LAST LINE          49150000
         BH    NOTLAST                  NO, INITIALIZE LINE SPACE       49200000
         MVI   GMSATCT+ONE,XFF          SET LINE COUNT FOR ERASE        49250000
         OI    QCBTSOF1,QCBSATRD        REQUEST SIM ATTN READ           49300000
         TM    GMFLAG,GMENCON           IS THIS INSERT ENDING-CONTROL   49350000
*                                          REQUEST                      49400000
         BOR   RLINK                    YES, RETURN TO CALLER           49450000
         TM    LCBSTAT2,LCBMSGNN        IS THIS FOR MSGGEN              49500000
         BOR   RLINK                    YES, RETURN TO CALLER           49550000
         LA    RRCODE,ENDSCRN           SET END-OF-SCREEN RETURN CODE   49600000
         B     QTIPSZ                   ISSUE QTIP AND SET PRFSIZE      49650000
NOTLAST  EQU   *                                                        49700000
         MVI   GMLNSPC,ZERO             CLEAR HIGH ORDER BYTE           49750000
         MVC   GMLNSPC+ONE(ONE),GMLNSZ  INITIALIZE DISPLAY LINE SPACE   49800000
         BR    RLINK                    RETURN TO CALLER                49850000
         SPACE 2                                                        49900000
*********************************************************************** 49950000
         SPACE 2                                                        50000000
NEWUNIT  EQU   *                                                        50050000
         LA    RCNT,ONE                 INITIALIZE UNIT COUNT           50100000
         USING IEDQPRF,RWORK                                            50150000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  50200000
UNITLOOP EQU   *                                                        50250000
         C     RWORK,GMCRUNT            IS THIS CURRENT TCAM UNIT       50300000
         BE    UNITCNT                  YES, UNITS COUNTED              50350000
         L     RWORK,PRFTIC             POINTER TO NEXT TCAM UNIT       50400000
         LA    RWORK,ZERO(,RWORK)       CLEAR HIGH ORDER BYTE           50450000
         LA    RCNT,ONE(,RCNT)          UPDATE UNIT COUNT               50500000
         B     UNITLOOP                 LOCATE CURRENT TCAM UNIT        50550000
UNITCNT  EQU   *                                                        50600000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST AVAILABLE UNIT   50650000
         BE    NOUNIT                   YES, EXIT TO IEDAYN             50700000
         CH    RCNT,GMBFUNIT            IS CURRENT UNIT LAST UNIT OF    50750000
*                                          A TCAM BUFFER                50800000
         BE    NEWBUFF                  YES, START A NEW TCAM BUFFER    50850000
         MVC   GMCRUNT+ONE(THREE),PRFTIC+ONE MAKE NEXT UNIT CURRENT     50900000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT UNIT         50950000
         LA    RTCBUF,PRFSUNIT-IEDQPRF(,RTCBUF) POINTER TO TCAM DATA    51000000
         MVC   GMTCSPC,AVTKEYLE         SET TCAM SPACE AVAILABLE        51050000
         L     RWORK,GMCRBUF            POINTER TO START OF BUFFER      51100000
         LA    RCNT,ONE(,RCNT)          INCREMENT UNIT COUNT            51150000
         STC   RCNT,PRFNBUNT            SET NUMBER OF UNITS IN BUFFER   51200000
         LH    RCNT,PRFSIZE             GET CURRENT TCAM DATA SIZE      51250000
         AH    RCNT,AVTKEYLE            INCREMENT FOR NEW UNIT          51300000
         STH   RCNT,PRFSIZE             SET NEW TCAM DATA SIZE          51350000
         L     RWORK,GMCRUNT            POINTER TO CURRENT TCAM UNIT    51400000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST AVAILABLE UNIT   51450000
         BER   RLINK                    YES, RETURN TO CALLER           51500000
         L     RWORK,PRFTIC             POINTER TO NEXT UNIT            51550000
         MVI   PRFNBUNT,ZERO            SET NUMBER OF UNITS TO ZERO     51600000
         BR    RLINK                    RETURN TO CALLER                51650000
NOUNIT   EQU   *                                                        51700000
         L     RWORK,GMCRBUF            POINTER TO LAST TCAM BUFFER     51750000
         STC   RCNT,PRFNBUNT            SET NUMBER OF UNITS IN BUFFER   51800000
         LA    RRCODE,ENDBUFR           SET END-OF-BUFFER RETURN CODE   51850000
         B     QTIPSZ                   ISSUE QTIP AND SET PRFSIZE      51900000
NEWBUFF  EQU   *                                                        51950000
         MVC   GMCRUNT+ONE(THREE),PRFTIC+ONE MAKE NEXT UNIT CURRENT     52000000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  52050000
         MVC   PRFLINK,GMCRUNT+ONE      LINK NEW BUFFER TO CURRENT      52100000
         MVC   GMCRBUF,GMCRUNT          MAKE NEXT UNIT START OF         52150000
*                                          CURRENT TCAM BUFFER          52200000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  52250000
         XC    PRFSRCE(PRFSHDR-PRFSRCE),PRFSRCE CLEAR PREFIX            52300000
         ST    RLCB,PRFLCB-ONE          SET LCB ADDRESS IN BUFFER       52350000
         OI    PRFSTAT1,PRFNLSTN+PRFNHDRN SET NOT LAST AND NOT          52400000
*                                          HEADER BUFFER                52450000
         MVI   PRFNBUNT,ONE             SET ONE UNIT BUFFER             52500000
         XC    PRFLINK,PRFLINK          CLEAR BUFFER LINK ADDRESS       52550000
         LH    RCNT,AVTKEYLE            SPACE AVAILABLE IN TCAM UNIT    52600000
         STH   RCNT,PRFSIZE             SET TCAM DATA SIZE              52650000
         SH    RCNT,TXPRFSZ             REDUCE FOR TEXT PREFIX          52700000
         LA    RCNT,AVTUMALN(,RCNT)     INCREMENT FOR UNIT CNTRL AREA   52750000
         STH   RCNT,GMTCSPC             SET TCAM SPACE AVAILABLE        52800000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT TCAM UNIT    52850000
         AH    RTCBUF,TXPRFSZ           POINTER TO TCAM DATA AREA       52900000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST AVAILABLE UNIT   52950000
         BE    CHKNCP                   YES, CHECK FOR 3705 TERMINAL    53000000
         L     RWORK,PRFTIC             POINTER TO NEXT UNIT            53050000
         MVI   PRFNBUNT,ZERO            SET NUMBER OF UNITS TO ZERO     53100000
         DROP  RWORK                                                    53150000
CHKNCP   EQU   *                                                        53200000
         CLI   LCBFLAG1,ZERO            IS DISPLAY ON 3705              53250000
         BNER  RLINK                    NO, RETURN TO CALLER            53300000
         MVC   ZERO(THREE,RTCBUF),CNTRL1 INSERT ESC,CMD,WCC IN TCAM     53350000
         LA    RWORK,THREE              COUNT OF DATA MOVED TO TCAM     53400000
         ST    RLINK,AVTSAVE4+SIXTY8 SAVE LINKAGE REGISTER     @ZM48042 53450000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   53500000
         L     RLINK,AVTSAVE4+SIXTY8 RESTORE LINKAGE REGISTER  @ZM48042 53550000
         BR    RLINK                    RETURN TO CALLER                53600000
         SPACE 2                                                        53650000
*********************************************************************** 53700000
         SPACE 2                                                        53750000
NEWTPUT  EQU   *                                                        53800000
         ST    RLINK,AVTSAVE4+SIXTY8    SAVE LINKAGE REGISTER           53850000
         BAL   RLINK,QTIP               UPDATE TSO BUFFER               53900000
         L     RLINK,AVTSAVE4+SIXTY8    RESTORE LINKAGE REGISTER        53950000
         L     RWORK,BUFFTRLR-ONE       POINTER TO TRAILER BUFFER       54000000
         LA    RWORK,ZERO(,RWORK)       CLEAR HIGH ORDER BYTE           54050000
         LTR   RWORK,RWORK              IS THERE A TRAILER BUFFER       54100000
         BZ    NOTPUT                   NO, EXIT TO IEDAYN              54150000
         ST    RWORK,GMTSBUF            MAKE NEXT BUFFER CURRENT        54200000
         LR    RBUFF,RWORK              POINT TO NEW TSO BUFFER         54250000
         SR    RTSBUF,RTSBUF            CLEAR REGISTER FOR IC           54300000
         IC    RTSBUF,BUFFOFST          GET OFFSET TO TSO DATA          54350000
         AR    RTSBUF,RBUFF             POINT TO START OF TSO DATA      54400000
         MVI   GMTSCNT,ZERO             CLEAR HIGH ORDER BYTE           54450000
         MVC   GMTSCNT+ONE(ONE),BUFFLNTH SET TSO DATA COUNT             54500000
         MVC   GMTSSIZ+ONE(ONE),BUFFLNTH SET TOTAL TSO SIZE             54550000
         BR    RLINK                    RETURN TO CALLER                54600000
NOTPUT   EQU   *                                                        54650000
         TM    BUFFFL1,BUFFEDIT         IS IT EDIT MODE                 54700000
         BNO   SETEND                   NO, SET RETURN CODE             54750000
         TM    BUFFFL1,BUFFCNTL         IS IT FULLSCR MODE              54800000
         BO    SETFSC                   YES, SET RETURN CODE   @OZ27387 54850000
         TM    BUFFFL1,BUFFNLCR         END OF THIS TPUT       @OZ28792 54857086
         BO    TPUTOK                   YES, CONTINUE          @OZ28792 54864086
         OI    QCBTSOF2,QCBMTP          SET ON MID TPUT FLAG   @OY20733 54874086
         B     SETEND                   DO NOT START ON NL     @OZ28792 54885086
TPUTOK   EQU   *                        SET IN NEW LINE        @OZ28792 54892086
         LA    RWORK,ONE                START NEXT TPUT ON              54900000
         STH   RWORK,GMLNSPC               NEW DISPLAY LINE             54950000
SETEND   EQU   *                                                        55000000
         LA    RRCODE,ENDTPUT           SET END-OF-TPUT RETURN CODE     55050000
         B     SETPRF                   SET SIZE OF TCAM DATA           55100000
SETFSC   EQU   *                                               @OZ27387 55110000
         LA    RRCODE,ENDSCRN           SET END-OF-SCREEN CODE @OZ27387 55120000
         B     SETPRF                   SET SIZE OF TCAM DATA  @OZ27387 55130000
         SPACE 2                                                        55150000
*********************************************************************** 55200000
         SPACE 2                                                        55250000
QTIPSZ   EQU   *                                                        55300000
         BAL   RLINK,QTIP               UPDATE TSO BUFFER               55350000
SETPRF   EQU   *                                                        55400000
         USING IEDQPRF,RWORK                                            55450000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  55500000
         LH    RCNT,PRFSIZE             GET CURRENT TCAM DATA SIZE      55550000
         SH    RCNT,GMTCSPC             REDUCE BY AMOUNT AVAILABLE      55600000
         STH   RCNT,PRFSIZE             SET NEW TCAM DATA SIZE          55650000
         DROP  RWORK                                                    55700000
         B     EXITN                    EXIT TO IEDAYN                  55750000
         SPACE 2                                                        55800000
*********************************************************************** 55850000
         EJECT                                                          55900000
*********************************************************************** 55950000
*********                                                     ********* 56000000
*********             MSGGEN PROCESSING ROUTINE               ********* 56050000
*********                                                     ********* 56100000
*********************************************************************** 56150000
         SPACE 2                                                        56200000
MSGGEN   EQU   *                                                        56250000
         SR    RWORK,RWORK              CLEAR REGISTER FOR IC           56300000
         IC    RWORK,GMLNSZ             DISPLAY SCREEN LINE SIZE        56350000
         CLI   GMCARCT+ONE,XFF          IS CARRIAGE TO BE RETURNED      56400000
         BE    MSGSPC                   YES, SET LINE SPACE AVAILABLE   56450000
         SH    RWORK,GMCARCT            SUBTRACT CURRENT POSITION       56500000
MSGSPC   EQU   *                                                        56550000
         STH   RWORK,GMLNSPC            SET LINE SPACE AVAILABLE        56600000
         LA    RTCBUF,ZERO(,R1)         POINTER TO TCAM DATA AREA       56650000
         L     RTSBUF,GMTSBUF           POINTER TO MSGGEN DATA          56700000
         MVC   GMCRUNT,GMCRBUF          POINTER TO FIRST TCAM UNIT      56750000
         SR    RCNT,RCNT                CLEAR REGISTER FOR IC           56800000
         IC    RCNT,AVTSCBSZ            SIZE OF STATION CONTROL BLOCK   56850000
         SH    RCNT,SCBRESR             LENGTH OF UNUSED PORTION OF SCB 56900000
         SH    RCNT,HSIX                COUNT OF ENDING CONTROL         56950000
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS LOCAL 3270     @G36XRYP 57000000
         BO    SCBMSG                   YES, USE SCB FOR MSGGEN         57050000
         BCTR  RCNT,0                   REDUCE BY ONE FOR REMOTE 3270   57100000
         CLI   LCBFLAG1,ZERO            IS TERMINAL ON 3705             57150000
         BNE   SCBMSG                   NO, USE SCB FOR MSGGEN          57200000
         L     RCNT,GMCRUNT             POINTER TO CURRENT TCAM UNIT    57250000
         AH    RCNT,AVTKEYLE            LENGTH OF TCAM UNIT             57300000
         LA    RCNT,AVTUMALN(,RCNT)     LENGTH OF UNIT CONTROL AREA     57350000
         SR    RCNT,RTCBUF              SPACE AVAILABLE IN TCAM UNIT    57400000
SCBMSG   EQU   *                                                        57450000
         STH   RCNT,GMTCSPC             AMOUNT OF SPACE AVAILABLE       57500000
         LR    R15,RCNT                 SAVE AMOUNT OF SPACE AVAILABLE  57550000
         SPACE 2                                                        57600000
*********************************************************************** 57650000
         EJECT                                                          57700000
*********************************************************************** 57750000
*********                                                     ********* 57800000
*********         INSERT BEGINNING CONTROL FOR MSGGEN         ********* 57850000
*********                                                     ********* 57900000
*********************************************************************** 57950000
         SPACE 2                                                        58000000
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS 3270 LOCAL     @G36XRYP 58050000
         BO    MSGWCC                   YES, INSERT WCC IN TCAM         58100000
         CLI   LCBFLAG1,ZERO            IS TERMINAL ON 3705             58150000
         BE    MSGESC                   YES, DON'T INSERT STX           58200000
         MVC   ZERO(ONE,RTCBUF),CNTRL0  INSERT STX IN TCAM              58250000
         LA    RWORK,ONE                COUNT OF DATA MOVED TO TCAM     58300000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   58350000
MSGESC   EQU   *                                                        58400000
         MVC   ZERO(TWO,RTCBUF),CNTRL1  INSERT ESC,CMD IN TCAM          58450000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     58500000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   58550000
MSGWCC   EQU   *                                                        58600000
         MVC   ZERO(ONE,RTCBUF),CNTRL1+TWO INSERT WCC IN TCAM           58650000
         LTR   RTSBUF,RTSBUF            IS THIS NEW LINE?      @OS79724 58657000
         BNZ   NORESET                  BRANCH NO              @OS79724 58664000
         CLI   QCBSATCT,AVTEZERO        IS THIS LINE ZERO?     @OS79724 58671000
         BNE   NORESET                  BRANCH NO              @OS79724 58678000
         MVI   ZERO(RTCBUF),SPACE       INSERT WCC             @OS79724 58685000
NORESET  EQU   *                                               @OS79724 58692000
         TM    QCBFLAG,QCBTSSES         IS TSO IN SESSION               58700000
         BNO   UNLK                     NO, RESTORE KEYBOARD            58750000
         LTR   RTSBUF,RTSBUF            IS ENTRY FOR CARRIAGE RETURN    58800000
         BZ    NOUNLK                   YES, DON'T RESTORE KEYBOARD     58850000
         TM    QCBTSOF2,QCBDSSMI        IS RESTORE FLAG SET             58900000
         BNO   NOUNLK                   NO, DON'T RESTORE KEYBOARD      58950000
         CLC   ZERO(TWO,RTSBUF),KYBDRES IS THIS KEYBOARD RESTORE        59000000
         BNE   UNLK                     NO, RESTORE KEYBOARD            59050000
         CLI   QCBSATCT,ZERO            LINE ZERO (FULLSCR)    @OZ29380 59060086
         BNE   RESET                    NO                     @OZ29380 59070086
         NI    ZERO(RTCBUF),XFF-RMDT    TURN OFF RESET MDT     @OZ29380 59080086
RESET    EQU   *                                               @OZ29380 59090086
         OI    ZERO(RTCBUF),UNLOCK1     RESTORE KEYBOARD       @OZ28127 59100086
         LA    RWORK,ONE                COUNT OF DATA MOVED TO TCAM     59150000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   59200000
         B     NODAT                    NO MSGGEN DATA                  59250000
UNLK     EQU   *                                                        59300000
         OI    ZERO(RTCBUF),UNLOCK1     RESTORE KEYBOARD       @OZ28127 59350086
NOUNLK   EQU   *                                                        59400000
         LA    RWORK,ONE                COUNT OF DATA MOVED TO TCAM     59450000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   59500000
         TM    QCBRETCT,QCBIEND         IS SCREEN FORMAT REQUIRED       59550000
         BNO   NOFRMAT                  NO, DON'T FORMAT SCREEN         59600000
         BCTR  RTCBUF,ZERO              BACKUP TO WCC          @OZ28127 59610086
         OI    ZERO(RTCBUF),MDTFLG      RESET MDT              @OZ28127 59620086
         LA    RTCBUF,ONE(RTCBUF)       RESTORE BFR PTR        @OZ28127 59630086
         ST    RCNT,AVTSAVE4+SIXTY4     SAVE COUNT REGISTER             59650000
         SR    RWORKE,RWORKE            CLEAR REGISTER FOR IC           59700000
         SR    RWORKO,RWORKO            CLEAR REGISTER FOR IC           59750000
         SR    RWORK,RWORK              CLEAR REGISTER FOR IC           59800000
         IC    RWORKE,GMLNSZ            GET DISPLAY SCREEN WIDTH        59850000
         IC    RWORKO,GMLNNO            GET DISPLAY SCREEN HEIGHT       59900000
         MR    RWORKE,RWORKE            MULTIPLY WIDTH AND HEIGHT       59950000
         BCTR  RWORKO,0                 REDUCE RESULT BY ONE            60000000
         BAL   RLINK,BINHDWR1           CONVERT BINARY VALUE TO         60050000
*                                          CURSOR ADDRESS               60100000
         MVC   ZERO(ONE,RTCBUF),CNTRL2  INSERT SBA IN TCAM              60150000
         LA    RWORK,THREE              COUNT OF DATA MOVED TO TCAM     60200000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   60250000
         MVC   ZERO(TWO,RTCBUF),CNTRL6  INSERT SF,ATTR IN TCAM          60300000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     60350000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   60400000
NOFRMAT  EQU   *                                                        60450000
         LTR   RTSBUF,RTSBUF            IS ENTRY FOR CARRIAGE RETURN    60500000
         BZ    CHKLIN0                  YES, CHECK FOR LINE ZERO        60550000
         CLC   ZERO(FOUR,RTSBUF),PROMPT IS THIS SIMATTN PROMPT          60600000
         BE    CKLINE                   SEE IF AT END OF SCRN  @OZ31812 60650086
         CLI   GMCARCT+ONE,XFF          IS CARRIAGE TO BE RETURNED      60700000
         BE    CARZER                   YES, CLEAR CARRIAGE COUNT       60750000
         B     NONEWLN                  INSERT SBA ORDER                60800000
CKLINE   CLI   GMSATCT+ONE,XFF          IS COUNT FOR ERASE     @OZ31812 60810086
         BNE   CARZER                   NO, PROMPT ON NXT LINE @OZ31812 60820086
LSTLIN   EQU   *                                                        60850000
         SR    RWORK,RWORK              CLEAR REGISTER FOR IC           60900000
         IC    RWORK,GMLNNO             NUMBER OF LINES ON SCREEN       60950000
         BCTR  RWORK,0                  REDUCE BY ONE                   61000000
         STH   RWORK,GMSATCT            SET ON NEXT TO LAST LINE        61050000
         B     CARZER                   CLEAR CARRIAGE COUNT            61100000
CHKLIN0  EQU   *                                                        61150000
         CLI   GMSATCT+ONE,ZERO         IS THIS LINE ZERO               61200000
         BE    MSGDAT                   YES, MOVE MSGGEN DATA           61250000
         CLI   GMCARCT+ONE,XFF          IS CARRIAGE TO BE RETURNED      61300000
         BE    ZERCAR                   YES, CLEAR CARRIAGE COUNT       61350000
         CLI   GMCARCT+ONE,ZERO         IS CARRIAGE RETURN NEEDED       61400000
         BNE   MSGLINE                  YES, COUNT OUTPUT LINE          61450000
         TM    QCBRETCT,QCBIEND         IS SCREEN FORMAT REQUESTED      61500000
         BO    NONEWLN                  YES, INSERT SBA ORDER           61550000
         NI    QCBRETCT,XFF-QCBNL       RESET NEWLINE FLAGS             61600000
         B     MSGCMP                   SEND WCC ONLY          @OZ28135 61650086
CARZER   EQU   *                                                        61700000
         MVI   GMLNSPC,ZERO             CLEAR HIGH ORDER BYTE           61750000
         MVC   GMLNSPC+ONE(ONE),GMLNSZ  INITIALIZE DISPLAY LINE SPACE   61800000
         B     NONEWLN                  INSERT SBA ORDER                61850000
MSGLINE  EQU   *                                                        61900000
         BAL   RLINK,CNTLIN1            COUNT OUTPUT LINE               61950000
ZERCAR   EQU   *                                                        62000000
         SR    RWORK,RWORK              CLEAR REGISTER FOR IC           62050000
         IC    RWORK,GMLNSZ             GET DISPLAY LINE WIDTH          62100000
         LA    RWORK,ONE(,RWORK)        INCREMENT BY ONE                62150000
         STH   RWORK,GMLNSPC            SET CARRIAGE POSITION           62200000
NONEWLN  EQU   *                                                        62250000
         BAL   RLINK,BINHDWR            CONVERT BINARY VALUE TO         62300000
*                                          CURSOR ADDRESS               62350000
         MVC   ZERO(ONE,RTCBUF),CNTRL2  INSERT SBA IN TCAM              62400000
         LA    RWORK,THREE              COUNT OF DATA MOVED TO TCAM     62450000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   62500000
         TM    QCBFLAG,QCBTSSES         IS TSO IN SESSION               62550000
         BNO   MSGDAT                   NO, MOVE MSGGEN DATA TO TCAM    62600000
         LTR   RTSBUF,RTSBUF            IS ENTRY FOR CARRIAGE RETURN    62650000
         BNZ   MSGSFWR                  NO, INSERT SF,WRATTR            62700000
         CLI   GMSATCT+ONE,ZERO         IS THIS LINE ZERO               62750000
         BE    NODAT                    YES, NO MSGGEN DATA             62800000
         MVC   ZERO(TWO,RTCBUF),CNTRL4  INSERT SF,RDATTR IN TCAM        62850000
         LA    RWORK,ONE                COUNT OF DATA DISPLAYED         62900000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     62950000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     63000000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   63050000
         B     NODAT                    NO MSGGEN DATA                  63100000
MSGSFWR  EQU   *                                                        63150000
         MVC   ZERO(TWO,RTCBUF),CNTRL3  INSERT SF,WRATTR IN TCAM        63200000
         LA    RWORK,ONE                COUNT OF DATA DISPLAYED         63250000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     63300000
         LA    RWORK,TWO                COUNT OF DATA MOVED TO TCAM     63350000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   63400000
         SPACE 2                                                        63450000
*********************************************************************** 63500000
         EJECT                                                          63550000
*********************************************************************** 63600000
*********                                                     ********* 63650000
*********       MOVE MSGGEN DATA TO TCAM UNIT OR SCB          ********* 63700000
*********                                                     ********* 63750000
*********************************************************************** 63800000
         SPACE 2                                                        63850000
MSGDAT   EQU   *                                                        63900000
         LTR   RTSBUF,RTSBUF            IS ENTRY FOR CARRIAGE RETURN    63950000
         BZ    NODAT                    YES, NO MSGGEN DATA             64000000
         SR    RCNT,RCNT                CLEAR REGISTER FOR IC           64050000
         IC    RCNT,ZERO(,RTSBUF)       LENGTH OF MSGGEN DATA           64100000
         LR    RWORK,RTSBUF             POINTER TO MSGGEN LENGTH        64150000
         AR    RWORK,RCNT               POINTER TO LAST CHARACTER       64200000
*                                          OF MSGGEN                    64250000
         MVC   AVTDOUBL(ONE),ZERO(RWORK) SAVE LAST CHARACTER            64300000
         CLI   AVTDOUBL,CR              IS LAST CHAR CARRIAGE-RETURN    64350000
         BNE   NOTCR                    NO, COUNT IS CORRECT            64400000
         BCTR  RCNT,0                   REDUCE MSGGEN LENGTH BY ONE     64450000
NOTCR    EQU   *                                                        64500000
         STH   RCNT,GMTSCNT             SET LENGTH OF MSGGEN DATA       64550000
         LA    RTSBUF,ONE(,RTSBUF)      POINTER TO ACTUAL DATA          64600000
         CH    RCNT,GMTCSPC             COMPARE DATA COUNT TO           64650000
*                                          TCAM SPACE                   64700000
         BL    MSGBUF                   MOVE ENTIRE MSGGEN              64750000
         LH    RCNT,GMTCSPC             TRUNCATE MSGGEN TO FIT          64800000
MSGBUF   EQU   *                                                        64850000
         BCTR  RCNT,0                   REDUCE FOR EXECUTED MOVE        64900000
         EX    RCNT,MVC                 MOVE MSGGEN DATA TO TCAM        64950000
         LA    RWORK,ONE(,RCNT)         COUNT OF DATA MOVE FROM MSGGEN  65000000
         BAL   RLINK,UPDTSO             UPDATE MSGGEN COUNT & ADDRESS   65050000
         LA    RWORK,ONE(,RCNT)         COUNT OF DATA MOVED TO TCAM     65100000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   65150000
         LA    RCNT,ONE(,RCNT)          RESTORE ACTUAL DATA COUNT       65200000
LINLP    EQU   *                                                        65250000
         CH    RCNT,GMLNSPC             WILL ALL DATA FIT ON ONE LINE   65300000
         BNH   LSTCNT                   YES, GO UPDATE LINE SPACE       65350000
         LH    RWORK,GMLNSPC            AMOUNT OF DATA FOR ONE LINE     65400000
         SR    RCNT,RWORK               REDUCE AMOUNT MOVED BY ONE LINE 65450000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     65500000
         TM    QCBFLAG,QCBTSSES         IS TSO IN SESSION?     @OZ26894 65510000
         BNO   NOSESN1                  NO                     @OZ26894 65520000
         TM    QCBTSOF1,QCBSATRD        END OF SCREEN REACHED           65550000
         BO    SCREND                   YES, QUIT MOVING DATA           65600000
NOSESN1  EQU   *                                               @OZ26894 65620000
         MVC   GMLNSPC+ONE(ONE),GMLNSZ  SET LINE SPACE AVAILABLE        65650000
         B     LINLP                    COUNT NEXT LINE                 65700000
SCREND   EQU   *                                                        65750000
         SR    RTCBUF,RCNT              ADJUST TCAM DATA POINTER        65800000
         LH    RWORK,GMTCSPC            INCREMENT                       65850000
         AR    RWORK,RCNT                  TCAM SPACE                   65900000
         STH   RWORK,GMTCSPC                  AVAILABLE                 65950000
NODAT    EQU   *                                                        66000000
         XC    GMTSCNT,GMTSCNT          SET NO MORE DATA TO MOVE        66050000
         B     CNTEND                   INSERT ENDING CONTROL           66100000
LSTCNT   EQU   *                                                        66150000
         LR    RWORK,RCNT               AMOUNT OF DATA ON LAST LINE     66200000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     66250000
         L     RWORK,GMTSBUF            POINTER TO MSGGEN DATA          66300000
         CLC   ZERO(FOUR,RWORK),PROMPT  IS THIS SIMATTN PROMPT          66350000
         BE    CNTEND                   YES, PROCESS PROMPT             66400000
         TM    QCBFLAG,QCBTSSES         IS TSO IN SESSION      @OZ26894 66410000
         BNO   CNTEND                   NO                     @OZ26894 66420000
         TM    QCBTSOF1,QCBSATRD        END OF SCREEN REACHED           66450000
         BO    SCREND                   YES, ADJUST COUNTS              66500000
CNTEND   EQU   *                                                        66550000
         LA    RCNT,SIX                 COUNT OF ENDING CONTROL         66600000
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS 3270 LOCAL     @G36XRYP 66650000
         BO    SCBEND                   YES, ADD ENDING CONTROL         66700000
         LA    RCNT,ONE(,RCNT)          INCREMENT FOR 3270 REMOTE       66750000
         CLI   LCBFLAG1,ZERO            IS TERMINAL ON 3705             66800000
         BNZ   SCBEND                   NO, ADD ENDING CONTROL          66850000
         NC    GMTSCNT,GMTSCNT          HAS ALL DATA BEEN MOVED         66900000
         BZ    MSGEND                   YES, ADD ENDING CONTROL         66950000
         BAL   RLINK,MSGUNIT            GET NEXT TCAM UNIT              67000000
         B     MSGBUF                   MOVE MORE MSGGEN DATA           67050000
         SPACE 2                                                        67100000
*********************************************************************** 67150000
         EJECT                                                          67200000
*********************************************************************** 67250000
*********                                                     ********* 67300000
*********          INSERT ENDING CONTROL FOR MSGGEN           ********* 67350000
*********                                                     ********* 67400000
*********************************************************************** 67450000
         SPACE 2                                                        67500000
SCBEND   EQU   *                                                        67550000
         AR    R15,RCNT                 CORRECT TOTAL COUNT             67600000
         AH    RCNT,GMTCSPC             CALCULATE TCAM SPACE AVAILABLE  67650000
         STH   RCNT,GMTCSPC             RESTORE TCAM SPACE AVAILABLE    67700000
MSGEND   EQU   *                                                        67750000
         LR    RCNT,RTCBUF              SAVE CURRENT TCAM ADDRESS       67800000
         LA    RTCBUF,AVTDOUBL+TWO      POINTER TO WORKAREA             67850000
         LTR   RTSBUF,RTSBUF            IS ENTRY FOR CARRIAGE RETURN    67900000
         BZ    SAVDAT                   YES, SAVE DATA ADDRESS          67950000
         TM    QCBTSOF2,QCBDSSMI        IS RESTORE FLAG SET             68000000
         BNO   MSGSAV                   NO, SAVE DATA ADDRESS           68050000
         CLC   ZERO(TWO,RTSBUF),KYBDRES IS THIS KEYBOARD RESTORE        68100000
         BNE   MSGSAV                   NO, SAVE DATA ADDRESS           68150000
         B     MSGCMP                   MSGGEN COMPLETE                 68200000
SAVDAT   EQU   *                                                        68250000
         LR    RTSBUF,RTCBUF            SAVE DATA ADDRESS               68300000
         LA    RWORK,ONE                COUNT OF ENDING CONTROL         68350000
         STH   RWORK,GMTSCNT            SET COUNT OF DATA TO MOVE       68400000
         B     MSGINC                   INSERT INC ORDER IN TCAM        68450000
MSGSAV   EQU   *                                                        68500000
         LR    RTSBUF,RTCBUF            SAVE DATA ADDRESS               68550000
         LA    RWORK,FOUR               COUNT OF ENDING CONTROL         68600000
         STH   RWORK,GMTSCNT            SET COUNT OF DATA TO MOVE       68650000
         TM    QCBFLAG,QCBTSSES         IS TSO IN SESSION               68700000
         BNO   CKCRTN                   NO, CHECK FOR CARRIAGE          68750000
         LA    RWORK,SIX                COUNT OF ENDING CONTROL         68800000
         STH   RWORK,GMTSCNT            SET COUNT OF DATA TO MOVE       68850000
         MVC   ZERO(TWO,RTCBUF),CNTRL6  INSERT SF,ATTR IN TCAM          68900000
         LA    RWORK,ONE                COUNT OF DATA DISPLAYED         68950000
         BAL   RLINK,UPDLINE            UPDATE LINE SPACE AVAILABLE     69000000
         LA    RTCBUF,TWO(,RTCBUF)      UPDATE TCAM ADDRESS             69050000
CKCRTN   EQU   *                                                        69100000
         CLI   AVTDOUBL,CR              IS LAST CHAR CARRIAGE-RETURN    69150000
         BNE   NOCRTN                   NO, DO NOT GO TO NEW LINE       69200000
         BAL   RLINK,CNTLIN1            COUNT ONE DISPLAY LINE          69250000
NOCRTN   EQU   *                                                        69300000
         BAL   RLINK,BINHDWR            CONVERT BINARY VALUE TO         69350000
*                                          HARDWARE ADDRESS             69400000
         MVC   ZERO(ONE,RTCBUF),CNTRL2  INSERT SBA IN TCAM              69450000
         LA    RTCBUF,THREE(,RTCBUF)    UPDATE TCAM ADDRESS             69500000
MSGINC   EQU   *                                                        69550000
         MVC   ZERO(ONE,RTCBUF),CNTRL7  INSERT INC IN TCAM              69600000
         LR    RTCBUF,RCNT              RESTORE CURRENT TCAM ADDRESS    69650000
         CLC   GMTCSPC,GMTSCNT          IS SPACE AVAILABLE IN TCAM      69700000
         BNL   MSGMOV                   YES, MOVE ENDING CONTROL        69750000
         LH    RCNT,GMTCSPC             AMOUNT OF SPACE AVAILABLE       69800000
         BCTR  RCNT,0                   REDUCE FOR EXECUTED MOVE        69850000
         EX    RCNT,MVC                 MOVE ENDING CONTROL TO TCAM     69900000
         LA    RWORK,ONE(,RCNT)         RESTORE ACTUAL DATA COUNT       69950000
         BAL   RLINK,UPDTSO             UPDATE TSO COUNT AND ADDRESS    70000000
         LA    RWORK,ONE(,RCNT)         RESTORE ACTUAL DATA COUNT       70050000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   70100000
         BAL   RLINK,MSGUNIT            GET NEW TCAM UNIT               70150000
MSGMOV   EQU   *                                                        70200000
         LH    RCNT,GMTSCNT             AMOUNT OF DATA REMAINING        70250000
         BCTR  RCNT,0                   REDUCE FOR EXECUTED MOVE        70300000
         EX    RCNT,MVC                 MOVE ENDING CONTROL TO TCAM     70350000
         LA    RWORK,ONE(,RCNT)         RESTORE ACTUAL DATA COUNT       70400000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   70450000
MSGCMP   EQU   *                                                        70500000
         SH    R15,GMTCSPC              TOTAL AMOUNT OF DATA MOVED      70550000
         LR    RRCODE,R15               SET RETURN CODE FOR IEDAYM      70600000
         TM    GMDEVCH+TWO,DCTLOCAL     IS THIS 3270 LOCAL     @G36XRYP 70650000
         BO    EXITM                    EXIT TO IEDAYM                  70700000
         CLI   LCBFLAG1,ZERO            IS TERMINAL ON 3705             70750000
         BE    EXITM                    EXIT TO IEDAYM                  70800000
         LA    RRCODE,ONE(,R15)         SET RETURN CODE FOR IEDAYM      70850000
         MVC   ZERO(ONE,RTCBUF),CNTRL8  INSERT ETX IN TCAM              70900000
         B     EXITM                    EXIT TO IEDAYM                  70950000
         SPACE 2                                                        71000000
*********************************************************************** 71050000
         EJECT                                                          71100000
*********************************************************************** 71150000
*********                                                     ********* 71200000
*********                        EXIT                         ********* 71250000
*********                                                     ********* 71300000
*********************************************************************** 71350000
         SPACE 2                                                        71400000
EXITN    EQU   *                                                        71450000
         SR    RCNT,RCNT                CLEAR REGISTER FOR IC           71500000
         L     RWORK,LCBERBCH-ONE       POINTER TO FIRST TCAM BUFFER    71550000
         USING IEDQPRF,RWORK                                            71600000
NUMUNT   EQU   *                                                        71650000
         IC    RCNT,PRFNBUNT            NUMBER OF UNITS IN BUFFER       71700000
         LTR   RCNT,RCNT                IS NUMBER OF UNITS ZERO         71750000
         BZ    UNUSED                   YES, UNITS NOT USED             71800000
NXTUNIT  EQU   *                                                        71850000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST UNIT             71900000
         BE    ALLUSD                   YES, ALL UNITS USED             71950000
         L     RWORK,PRFTIC             POINTER TO NEXT UNIT            72000000
         BCT   RCNT,NXTUNIT             GET NEXT UNIT POINTER           72050000
         B     NUMUNT                   GET NUMBER OF UNITS             72100000
UNUSED   EQU   *                                                        72150000
         LR    R0,RWORK                 SAVE FIRST UNIT ADDRESS         72200000
         LA    RCNT,XFF                 INITIALIZE UNUSED UNIT COUNT    72250000
CHKLAST  EQU   *                                                        72300000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST AVAILABLE UNIT   72350000
         BE    SETUNTS                  YES, SET NUMBER UNUSED UNITS    72400000
         L     RWORK,PRFTIC             GET NEXT UNIT                   72407000
         BCT   RCNT,CHKLAST             CHECK AGAIN                     72414000
         LR    RCNT,R0                  GET FIRST UNIT OF BFR           72421000
         LA    R0,XFF             MAX. NO. OF UNITS                     72428000
         STC   R0,PRFNBUNT-IEDQPRF(,RCNT) NO. OF UNITS/BFR              72435000
         B     UNUSED                   CHECK UNUSED UNITS              72442000
SETUNTS  EQU   *                                                        72600000
         LR    RWORK,R0                 RESTORE FIRST UNIT ADDRESS      72650000
         LR    R0,RCNT                  GET UNIT COUNT                  72660000
         LA    RCNT,XFF                 GET MAXIMUM NUMBER              72670000
         SR    RCNT,R0                  GET NO. OF UNITS-1              72680000
         LA    RCNT,ONE(,RCNT)          GET CORRECT NO. OF UNITS        72690000
         STC   RCNT,PRFNBUNT            SET NUMBER UNUSED UNITS         72700000
         DROP  RWORK                                                    72750000
ALLUSD   EQU   *                                                        72800000
         SH    RRCODE,HFOUR             ADJUST RETURN CODE              72850000
         B     EXITE                    RETURN TO CALLER                72900000
EXITM    EQU   *                                                        72950000
         NI    QCBRETCT,XFF-QCBIEND     RESET FORMAT REQUEST            73000000
         SLL   RRCODE,SIXTEEN           ADJUST RETURN CODE              73050000
         B     SETCNTS                  SET LINE AND CARRIAGE COUNT     73100000
EXITE    EQU   *                                                        73150000
         TM    GMFLAG,GMENCIN           HAS ENDING-CONTROL BEEN         73200000
*                                          INSERTED                     73250000
         BNO   CHKMODE                  NO, CHECK MODE OF TPUT          73300000
         TM    QCBRETCT,QCBDEND         WAS TPUT FULLSCR OR ASIS        73350000
         BO    NOCNTS                   YES, DO NOT SET COUNTS          73400000
         B     SETCNTS                  SET LINE AND CARRIAGE COUNT     73450000
CHKMODE  EQU   *                                                        73500000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL IS THIS FULLSCR MODE           73550000
         BO    NOCNTS                   YES, DO NOT SET COUNTS          73600000
SETCNTS  EQU   *                                                        73650000
         TM    QCBFLAG,QCBTSSES         IS TSO IN SESSION      @OZ24715 73660000
         BNO   NOCNTS                   NO, DO NOT SET COUNTS  @OZ24715 73670000
         SR    RWORK,RWORK              CLEAR REGISTER FOR IC           73700000
         IC    RWORK,GMLNSZ             GET DISPLAY LINE SIZE           73750000
         SH    RWORK,GMLNSPC            SUBTRACT LINE SPACE AVAILABLE   73800000
         STC   RWORK,QCBCARCT           SET CARRIAGE POSITION IN QCB    73850000
         STH   RWORK,GMCARCT            SAVE CARRIAGE POSITION          73900000
         MVC   QCBSATCT(ONE),GMSATCT+ONE SET LINE COUNT IN QCB          73950000
NOCNTS   EQU   *                                                        74000000
         ST    RRCODE,SIXTEEN(RAVT)     STORE RETURN CODE               74050000
         RETURN (14,12)                 RESTORE REGISTERS AND RETURN    74100000
         SPACE 2                                                        74150000
*********************************************************************** 74200000
         EJECT                                                          74250000
*********************************************************************** 74300000
*********                                                     ********* 74350000
*********             BUFFER TERMINATION ROUTINE              ********* 74400000
*********                                                     ********* 74450000
*********************************************************************** 74500000
         SPACE 2                                                        74550000
ENDBUFF  EQU   *                                                        74600000
         LA    RCNT,ONE                 INITIALZE UNIT COUNT            74650000
         USING IEDQPRF,RWORK                                            74700000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  74750000
LOOPUNIT EQU   *                                                        74800000
         C     RWORK,GMCRUNT            IS THIS CURRENT TCAM UNIT       74850000
         BE    CNTUNIT                  YES, UNITS COUNTED              74900000
         L     RWORK,PRFTIC             POINTER TO NEXT TCAM UNIT       74950000
         LA    RWORK,ZERO(,RWORK)       CLEAR HIGH ORDER BYTE           75000000
         LA    RCNT,ONE(,RCNT)          UPDATE UNIT COUNT               75050000
         B     LOOPUNIT                 LOCATE CURRENT TCAM UNIT        75100000
CNTUNIT  EQU   *                                                        75150000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST AVAILABLE UNIT   75200000
         BE    OUTUNIT                  YES, EXIT TO IEDAYN             75250000
         MVC   GMCRUNT+ONE(THREE),PRFTIC+ONE MAKE NEXT UNIT CURRENT     75300000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  75350000
         STC   RCNT,PRFNBUNT            SET NUMBER OF UNITS IN BUFFER   75400000
         LH    RCNT,PRFSIZE             GET CURRENT TCAM DATA SIZE      75450000
         SH    RCNT,GMTCSPC             DECREMENT FOR SPACE REMAINING   75500000
         STH   RCNT,PRFSIZE             SET NEW TCAM DATA SIZE          75550000
         MVC   PRFLINK,GMCRUNT+ONE      LINK NEW BUFFER TO CURRENT      75600000
         MVC   GMCRBUF,GMCRUNT          MAKE NEXT UNIT START OF CURRENT 75650000
*                                          TCAM BUFFER                  75700000
         L     RWORK,GMCRBUF            POINTER TO CURRENT TCAM BUFFER  75750000
         XC    PRFSRCE(PRFSHDR-PRFSRCE),PRFSRCE CLEAR PREFIX            75800000
         ST    RLCB,PRFLCB-ONE          SET LCB ADDRESS IN BUFFER       75850000
         OI    PRFSTAT1,PRFNLSTN+PRFNHDRN+PRFTSMSG SET NOT LAST, NOT    75900000
*                                          HEADER AND TSO BUFFER        75950000
         MVI   PRFNBUNT,ONE             SET ONE UNIT IN BUFFER          76000000
         XC    PRFLINK,PRFLINK          CLEAR BUFFER LINK ADDRESS       76050000
         LH    RCNT,AVTKEYLE            SPACE AVAILABLE IN TCAM UNIT    76100000
         STH   RCNT,PRFSIZE             SET TCAM DATA SIZE              76150000
         SH    RCNT,TXPRFSZ             REDUCE FOR TEXT PREFIX          76200000
         LA    RCNT,AVTUMALN(,RCNT)     INCREMENT FOR UNIT CNTRL AREA   76250000
         STH   RCNT,GMTCSPC             SET TCAM SPACE AVAILABLE        76300000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT TCAM UNIT    76350000
         AH    RTCBUF,TXPRFSZ           POINTER TO TCAM DATA AREA       76400000
         CLC   PRFTIC+ONE(THREE),INVALTIC IS THIS LAST AVAILABLE UNIT   76450000
         BE    NCPCHK                   YES, CHECK FOR 3705 TERMINAL    76500000
         L     RWORK,PRFTIC             POINTER TO NEXT UNIT            76550000
         MVI   PRFNBUNT,ZERO            SET NUMBER OF UNITS TO ZERO     76600000
NCPCHK   EQU   *                                                        76650000
         CLI   LCBFLAG1,ZERO            IS DISPLAY ON 3705              76700000
         BNER  RLINK                    NO, RETURN TO CALLER            76750000
         MVC   ZERO(THREE,RTCBUF),CNTRL1 INSERT ESC,CMD,WCC IN TCAM     76800000
         LA    RWORK,THREE              COUNT OF DATA MOVED TO TCAM     76850000
         ST    RLINK,AVTSAVE4+SIXTY4    SAVE LINKAGE REGISTER           76900000
         BAL   RLINK,UPDTCAM            UPDATE TCAM COUNT AND ADDRESS   76950000
         L     RLINK,AVTSAVE4+SIXTY4    RESTORE LINKAGE REGISTER        77000000
         BR    RLINK                    RETURN TO CALLER                77050000
OUTUNIT  EQU   *                                                        77100000
         L     RWORK,GMCRBUF            POINTER TO LAST TCAM BUFFER     77150000
         STC   RCNT,PRFNBUNT            SET NUMBER OF UNITS IN BUFFER   77200000
         LA    RRCODE,ENDBUFR           SET END-OF-BUFFER RETURN CODE   77250000
         DROP  RWORK                                                    77300000
         B     QTIPSZ                   ISSUE QTIP AND SET PRFSIZE      77350000
         SPACE 2                                                        77400000
*********************************************************************** 77450000
         EJECT                                                          77500000
*********************************************************************** 77550000
*********                                                     ********* 77600000
*********            TSO BUFFER UPDATE ROUTINE                ********* 77650000
*********                                                     ********* 77700000
*********************************************************************** 77750000
         SPACE 2                                                        77800000
QTIP     EQU   *                                                        77850000
         STM   RLINK,R1,AVTSAVE4+FORTY8 SAVE REGISTERS                  77900000
         TM    GMFLAG,GMENCON           IS END CONTROL ON?     @OY20575 77910086
         BO    NOQTIP                   QTIP ALREADY ISSUED    @OY20575 77920086
         LH    R15,GMTSSIZ              GET TOTAL TSO DATA COUNT        77950000
         SH    R15,GMTSCNT              SUBTRACT AMOUNT REMAINING       78000000
         BNP   NOQTIP                   RETURN IF NO DATA MOVED         78050000
         L     R2,GMTSBUF               POINTER TO CURRENT TSO BUFFER   78100000
         SLR   R0,R0                    CLEAR REGISTER         @ZM47671 78106010
         IC    R0,BUFFOFST              GET OFFSET TO DATA     @ZM47671 78112010
         AR    R0,R15                   ADD LENGTH OF TEXT MOV @ZM47671 78118010
         STC   R0,BUFFOFST              RESTORE UPDATED OFFSET @ZM47671 78124000
         IC    R0,BUFFLNTH              GET DATA LENGTH        @ZM47671 78130010
         SLR   R0,R15                   ADJUST BY AMOUNT MOVED @ZM47671 78136010
         STC   R0,BUFFLNTH              STORE UPDATED LENGTH   @ZM47671 78142010
NOQTIP   EQU   *                                                        78200000
         LM    RLINK,R1,AVTSAVE4+FORTY8 RESTORE REGISTERS               78250000
         BR    RLINK                    RETURN TO CALLER                78300000
         SPACE 2                                                        78350000
*********************************************************************** 78400000
         EJECT                                                          78450000
*********************************************************************** 78500000
*********                                                     ********* 78550000
*********                                                     ********* 78600000
*********                                                     ********* 78650000
*********************************************************************** 78700000
         SPACE 2                                                        78750000
MSGUNIT  EQU   *                                                        78800000
         USING IEDQPRF,RWORK                                            78850000
         L     RWORK,GMCRUNT            POINTER TO CURRENT TCAM UNIT    78900000
         MVC   GMCRUNT+ONE(THREE),PRFTIC+ONE MAKE NEXT UNIT CURRENT     78950000
         DROP  RWORK                                                    79000000
         L     RTCBUF,GMCRUNT           POINTER TO CURRENT UNIT         79050000
         LA    RTCBUF,PRFSUNIT-IEDQPRF(RTCBUF) POINTER TO TCAM DATA     79100000
         MVC   GMTCSPC,AVTKEYLE         SET TCAM SPACE AVAILABLE        79150000
         AH    R15,GMTCSPC              INCREMENT TOTAL SPACE           79200000
         LH    RCNT,GMTCSPC             SPACE AVAILABLE IN TCAM         79250000
         CH    RCNT,GMTSCNT             COMPARE TO REMAINING DATA COUNT 79300000
         BNHR  RLINK                    MOVE REMAINING DATA             79350000
         LH    RCNT,GMTSCNT             COUNT OF REMAINING DATA         79400000
         BR    RLINK                    RETURN TO CALLER                79450000
         SPACE 2                                                        79500000
*********************************************************************** 79550000
         EJECT                                                          79600000
*********************************************************************** 79650000
*********                                                     ********* 79700000
*********            UPDATE LINE SPACE ROUTINE                ********* 79750000
*********                                                     ********* 79800000
*********************************************************************** 79850000
         SPACE 2                                                        79900000
UPDLINE  EQU   *                                                        79950000
         ST    RLINK,AVTSAVE4+SIXTY4    SAVE LINKAGE REGISTER           80000000
         LNR   RWORK,RWORK              DECREMENT LINE                  80050000
         AH    RWORK,GMLNSPC               SPACE                        80100000
         STH   RWORK,GMLNSPC                  AVAILABLE                 80150000
         LTR   RWORK,RWORK              IS DISPLAY LINE FULL            80200000
         BPR   RLINK                    NO, RETURN TO CALLER            80250000
         BAL   RLINK,CNTLINE            COUNT OUTPUT LINE               80300000
         L     RLINK,AVTSAVE4+SIXTY4    RESTORE LINKAGE REGISTER        80350000
         BR    RLINK                    RETURN TO CALLER                80400000
         SPACE 2                                                        80450000
*********************************************************************** 80500000
         EJECT                                                          80550000
*********************************************************************** 80600000
*********                                                     ********* 80650000
*********     UPDATE TSO DATA COUNT AND ADDRESS ROUTINE       ********* 80700000
*********                                                     ********* 80750000
*********************************************************************** 80800000
         SPACE 2                                                        80850000
UPDTSO   EQU   *                                                        80900000
         AR    RTSBUF,RWORK             UPDATE TSO BUFFER ADDRESS       80950000
         LNR   RWORK,RWORK              DECREMENT TSO                   81000000
         AH    RWORK,GMTSCNT               DATA                         81050000
         STH   RWORK,GMTSCNT                  COUNT                     81100000
         BR    RLINK                    RETURN TO CALLER                81150000
         SPACE 2                                                        81200000
*********************************************************************** 81250000
         EJECT                                                          81300000
*********************************************************************** 81350000
*********                                                     ********* 81400000
*********     UPDATE TCAM DATA COUNT AND ADDRESS ROUTINE      ********* 81450000
*********                                                     ********* 81500000
*********************************************************************** 81550000
         SPACE 2                                                        81600000
UPDTCAM  EQU   *                                                        81650000
         AR    RTCBUF,RWORK             UPDATE TCAM BUFFER ADDRESS      81700000
         LNR   RWORK,RWORK              DECREMENT TCAM                  81750000
         AH    RWORK,GMTCSPC               BUFFER UNIT                  81800000
         STH   RWORK,GMTCSPC                  SPACE AVAILABLE           81850000
         BR    RLINK                    RETURN TO CALLER                81900000
         SPACE 2                                                        81950000
*********************************************************************** 82000000
         EJECT                                                          82050000
*********************************************************************** 82100000
*********                                                     ********* 82150000
*********        DATA COUNT AND ADDRESS UPDATE ROUTINE        ********* 82200000
*********                                                     ********* 82250000
*********************************************************************** 82300000
         SPACE 2                                                        82350000
UPDCNTS  EQU   *                                                        82400000
         AR    RTSBUF,RCNT              UPDATE TSO BUFFER ADDRESS       82450000
         AR    RTCBUF,RCNT              UPDATE TCAM BUFFER ADDRESS      82500000
         LH    RWORK,GMTCSPC            DECREMENT TCAM                  82550000
         SR    RWORK,RCNT                  BUFFER UNIT                  82600000
         STH   RWORK,GMTCSPC                  SPACE AVAILABLE           82650000
         LH    RWORK,GMTSCNT            DECREMENT TSO                   82700000
         SR    RWORK,RCNT                  DATA                         82750000
         STH   RWORK,GMTSCNT                  COUNT                     82800000
         LH    RWORK,GMLNSPC            DECREMENT DISPLAY               82850000
         SR    RWORK,RCNT                  LINE SPACE                   82900000
         STH   RWORK,GMLNSPC                  AVAILABLE                 82950000
         BR    RLINK                    RETURN TO CALLER                83000000
         SPACE 2                                                        83050000
*********************************************************************** 83100000
         EJECT                                                          83150000
*********************************************************************** 83200000
*********                                                     ********* 83250000
*********           RESOURCE DEPLETION CHECK ROUTINE          ********* 83300000
*********                                                     ********* 83350000
*********************************************************************** 83400000
         SPACE 2                                                        83450000
CHKCNTS  EQU   *                                                        83500000
         ST    RLINK,AVTSAVE4+SIXTY4    SAVE LINKAGE REGISTER           83550000
         SR    RWORK,RWORK              CLEAR REGISTER                  83600000
         CH    RWORK,GMLNSPC            IS DISPLAY LINE FULL            83650000
         BNZ   LINEOK                   NO, CHECK TCAM UNIT SPACE       83700000
         BAL   RLINK,CNTLINE            COUNT OUTPUT LINE               83750000
LINEOK   EQU   *                                                        83800000
         CH    RWORK,GMTCSPC            IS TCAM BUFFER UNIT FULL        83850000
         BNZ   TCAMOK                   NO, CHECK TSO DATA COUNT        83900000
         BAL   RLINK,NEWUNIT            GET NEW TCAM BUFFER UNIT        83950000
TCAMOK   EQU   *                                                        84000000
         CH    RWORK,GMTSCNT            HAS ALL TSO DATA BEEN MOVED     84050000
         BNZ   DATAOK                   NO, RETURN TO CALLER            84100000
         BAL   RLINK,NEWTPUT            GET NEXT TPUT DATA              84150000
DATAOK   EQU   *                                                        84200000
         L     RLINK,AVTSAVE4+SIXTY4    RESTORE LINKAGE REGISTER        84250000
         BR    RLINK                                                    84300000
         SPACE 2                                                        84350000
*********************************************************************** 84400000
         EJECT                                                          84450000
*********************************************************************** 84500000
*********                                                     ********* 84550000
*********       BINARY VALUE TO HARDWARE BUFFER ADDRESS       ********* 84600000
*********                 CONVERSION ROUTINE                  ********* 84650000
*********                                                     ********* 84700000
*********************************************************************** 84750000
         SPACE 2                                                        84800000
BINHDWR  EQU   *                                                        84850000
         ST    RCNT,AVTSAVE4+SIXTY4     SAVE COUNT REGISTER             84900000
         SR    RWORKE,RWORKE            CLEAR REGISTER FOR IC           84950000
         TM    QCBFLAG,QCBTSSES         IS TSO IN SESSION               85000000
         BNO   POSZERO                  NO, SET POSITION ZERO           85050000
         IC    RWORKE,GMLNSZ            GET DISPLAY SCREEN WIDTH        85100000
         LR    RWORK,RWORKE             SAVE WIDTH FOR CALCULATION      85150000
         SH    RWORK,GMLNSPC            FIND CURRENT POSITION ON LINE   85200000
         LH    RWORKO,GMSATCT           GET LINE COUNT                  85250000
         CLI   GMSATCT+ONE,XFF          IS COUNT FOR ERASE              85300000
         BNE   MULTLIN                  NO, MULTIPLY                    85350000
         SR    RWORKO,RWORKO            CLEAR REGISTER FOR IC           85400000
         IC    RWORKO,GMLNNO            NUMBER OF LINES ON SCREEN       85450000
         BCTR  RWORKO,0                 REDUCE BY ONE                   85500000
POSZERO  EQU   *                                                        85550000
         SR    RWORK,RWORK              CURRENT POSITION ON LINE IS 0   85600000
MULTLIN  EQU   *                                                        85650000
         MR    RWORKE,RWORKE            MULTIPLY WIDTH AND LINE COUNT   85700000
BINHDWR1 EQU   *                                                        85750000
         LR    RWORKE,RWORKO            PUT SCREEN POSITION IN EVEN REG 85800000
         AR    RWORKE,RWORK             ADD LINE POSITION TO SCREEN     85850000
*                                          POSITION                     85900000
         SLL   RWORKE,TWENTY            SPLIT TWELVE BIT                85950000
         SRDL  RWORKE,TWENTY6              VALUE INTO                   86000000
         SRL   RWORKO,TWENTY6                 TWO REGISTERS             86050000
         STC   RWORKE,ONE(RTCBUF)       PUT FIRST VALUE IN TCAM BUFFER  86100000
         STC   RWORKO,TWO(RTCBUF)       PUT SCND VALUE IN TCAM BUFFER   86150000
         L     RWORK,CONVERT            POINTER TO TRANSLATE TABLE      86200000
         TR    ONE(TWO,RTCBUF),ZERO(RWORK) TRANSLATE TO HARDWARE FORMAT 86250000
         L     RCNT,AVTSAVE4+SIXTY4     RESTORE COUNT REGISTER          86300000
         BR    RLINK                    RETURN TO CALLER                86350000
         SPACE 2                                                        86400000
*********************************************************************** 86450000
         EJECT                                                          86500000
*********************************************************************** 86550000
*********                                                     ********* 86600000
*********       HARDWARE BUFFER ADDRESS TO BINARY VALUE       ********* 86650000
*********                 CONVERSION ROUTINE                  ********* 86700000
*********                                                     ********* 86750000
*********************************************************************** 86800000
         SPACE 2                                                        86850000
HDWRBIN  EQU *                                                          86900000
         ST    RCNT,AVTSAVE4+SIXTY4     SAVE COUNT REGISTER             86950000
         SR    RWORKE,RWORKE            CLEAR REGISTER FOR IC           87000000
         SR    RWORKO,RWORKO            CLEAR REGISTER FOR IC           87050000
         L     RWORK,CONVERT            POINTER TO TRANSLATE TABLE      87100000
         IC    RWORKE,ONE(,RTSBUF)      GET FIRST CURSOR ADDRESS        87150000
         IC    RWORKO,TWO(,RTSBUF)      GET SECOND CURSOR ADDRESS       87200000
         IC    RWORKE,ZERO(RWORK,RWORKE) VALUE CORRESPONDING TO ADDR 1  87250000
         IC    RWORKO,ZERO(RWORK,RWORKO) VALUE CORRESPONDING TO ADDR 2  87300000
         SLL   RWORKO,TWENTY6           COMBINE VALUES                  87350000
         SRDL  RWORKE,TWENTY6              IN REGISTER                  87400000
         SR    RWORK,RWORK              CLEAR REGISTER FOR IC           87450000
         IC    RWORK,GMLNSZ             GET DISPLAY SCREEN WIDTH        87500000
         DR    RWORKE,RWORK             DIVIDE VALUE BY WIDTH           87550000
         SR    RWORK,RWORKE             CALCULATE DISPLAY LINE          87600000
         STH   RWORK,GMLNSPC               SPACE REMAINING              87650000
         L     RCNT,AVTSAVE4+SIXTY4     RESTORE COUNT REGISTER          87700000
         TM    BUFFFL1,BUFFEDIT+BUFFCNTL IS IT FULLSCR MODE             87750000
         BOR   RLINK                    YES, DON'T UPDATE LINE COUNT    87800000
         STH   RWORKO,GMSATCT           SET NEW LINE COUNT              87850000
         BR    RLINK                    RETURN TO CALLER                87900000
         SPACE 2                                                        87950000
*********************************************************************** 88000000
         EJECT                                                          88050000
*********************************************************************** 88100000
*********                                                     ********* 88150000
*********         CONSTANTS AND EXECUTED INSTRUCTIONS         ********* 88200000
*********                                                     ********* 88250000
*********************************************************************** 88300000
         SPACE 2                                                        88350000
CLI      CLI   GMLNNO,0                 COMPARE CURRENT LINE TO         88400000
*                                          MAXIMUM LINE NUMBER          88450000
MVC      MVC   ZERO(ZERO,RTCBUF),ZERO(RTSBUF) MOVE DATA FROM TSO        88500000
*                                          BUFFER TO TCAM UNIT          88550000
TRT      TRT   ZERO(ZERO,RTSBUF),ZERO(RTABLE) TRANSLATE AND TEST        88600000
*                                          DATA IN TSO BUFFER           88650000
ASIS     DC    A(ASISTBL)               TRT TABLE POINTER FOR ASIS      88700000
CONTROL  DC    A(CNTLTBL)               TRT TABLE POINTER FOR CONTROL   88750000
EDIT     DC    A(EDITTBL)               TRT TABLE POINTER FOR EDIT      88800000
FULLSCR  DC    A(FLSCTBL)               TRT TABLE POINTER FOR FULLSCR   88850000
CONVERT  DC    A(CNVTTBL)               BUFFER ADDRESS CONVERSION TBL   88900000
HONE     DC    H'1'                     CONSTANT OF 1                   88950000
HTWO     DC    H'2'                     CONSTANT OF 2                   89000000
HTHREE   DC    H'3'                     CONSTANT OF 3                   89050000
HFOUR    DC    H'4'                     CONSTANT OF 4                   89100000
HSIX     DC    H'6'                     CONSTANT OF 6                   89150000
HSEVEN   DC    H'7'                     CONSTANT OF 7                   89200000
HEIGHT   DC    H'8'                     CONSTANT OF 8                   89250000
TXPRFSZ  DC    AL2(PRFSTXT-IEDQPRF)     TEXT PREFIX SIZE                89300000
HDPRFSZ  DC    AL2(PRFSHDR-IEDQPRF)     HEADER PREFIX SIZE              89350000
SCBRESR  DC    AL2(SCBMBSSA-IEDQSCB)    SIZE OF UNUSED SCB SPACE        89400000
CNTRL0   DC    X'02'                    STX                             89450000
CNTRL1   DC    X'27F1C1'                ESC,CMD,WCC                     89500000
CNTRL2   DC    X'11'                    SBA                             89550000
CNTRL3   DC    X'1DC8'                  SF,ATTR                         89600000
CNTRL4   DC    X'1D40'                  SF,ATTR                         89650000
CNTRL5   DC    X'1DC8'                  SF,ATTR                         89700000
CNTRL6   DC    X'1D40'                  SF,ATTR                         89750000
CNTRL7   DC    X'13'                    INC                             89800000
CNTRL8   DC    X'0337'                  ETX,EOT                         89850000
CNTRL9   DC    X'26'                    ETB                    @OY19561 89860086
CNTRLA   DC    X'0227F1C20337'         STX,ESC,CMD,WCC,ETX,EOT @OY19561 89870086
PROMPT   DC    X'03',C'***'             SIMULATED ATTENTION PROMPT      89900000
KYBDRES  DC    X'01',X'C3'              KEYBOARD RESTORE                89950000
INVALTIC DC    X'000002'                INVALID TIC ADDRESS             90000000
         SPACE 2                                                        90050000
AYQPATCH DC    20F'0'                   PATCH AREA                      90100000
         SPACE 2                                                        90150000
*********************************************************************** 90200000
         EJECT                                                          90250000
*********************************************************************** 90300000
*********                                                     ********* 90350000
*********          BUFFER ADDRESS CONVERSION TABLES           ********* 90400000
*********                                                     ********* 90450000
*********************************************************************** 90500000
         SPACE 2                                                        90550000
CNVTTBL  EQU   *                                                        90600000
*              CONVERT BINARY VALUE TO 3270 HARDWARE                    90650000
*                BUFFER ADDRESS  (X'00'-X'3F')                          90700000
*              CONVERT 3270 HARDWARE BUFFER ADDRESS                     90750000
*                TO BINARY VALUE  (X'40'-X'FF')                         90800000
*                 0 1 2 3 4 5 6 7 8 9 A B C D E F                       90850000
         DC    X'40C1C2C3C4C5C6C7C8C94A4B4C4D4E4F' 0                    90900000
         DC    X'50D1D2D3D4D5D6D7D8D95A5B5C5D5E5F' 1                    90950000
         DC    X'6061E2E3E4E5E6E7E8E96A6B6C6D6E6F' 2                    91000000
         DC    X'F0F1F2F3F4F5F6F7F8F97A7B7C7D7E7F' 3                    91050000
         DC    X'000000000000000000000A0B0C0D0E0F' 4                    91100000
         DC    X'100000000000000000001A1B1C1D1E1F' 5                    91150000
         DC    X'202100000000000000002A2B2C2D2E2F' 6                    91200000
         DC    X'000000000000000000003A3B3C3D3E3F' 7                    91250000
         DC    X'00000000000000000000000000000000' 8                    91300000
         DC    X'00000000000000000000000000000000' 9                    91350000
         DC    X'00000000000000000000000000000000' A                    91400000
         DC    X'00000000000000000000000000000000' B                    91450000
         DC    X'00010203040506070809000000000000' C                    91500000
         DC    X'00111213141516171819000000000000' D                    91550000
         DC    X'00002223242526272829000000000000' E                    91600000
         DC    X'30313233343536373839000000000000' F                    91650000
         SPACE 2                                                        91700000
*********************************************************************** 91750000
         EJECT                                                          91800000
*********************************************************************** 91850000
*********                                                     ********* 91900000
*********        TRANSLATE AND TEST TABLE - EDIT MODE         ********* 91950000
*********                                                     ********* 92000000
*********************************************************************** 92050000
         SPACE 2                                                        92100000
EDITTBL  EQU   *                                                        92150000
*              00 - NO CONVERSION                                       92200000
*              01 - CONVERT TO COLON (:)                                92250000
*              02 - CONVERT TO CONTROL SEQUENCE ('1DC8')                92300000
*              03 - CONVERT TO CONTROL SEQUENCE ('1D4C')                92350000
*                 0 1 2 3 4 5 6 7 8 9 A B C D E F                       92400000
         DC    X'00010101010001000000000000010000' 0                    92450000
         DC    X'00010101020101010000000000010000' 1                    92500000
         DC    X'00000000030001000000000000010000' 2                    92550000
         DC    X'00000000000000010000000001010000' 3                    92600000
         DC    X'00000000000000000000000000000000' 4                    92650000
         DC    X'00000000000000000000000000000000' 5                    92700000
         DC    X'00000000000000000000000000000000' 6                    92750000
         DC    X'00000000000000000000000000000000' 7                    92800000
         DC    X'00000000000000000000000000000000' 8                    92850000
         DC    X'00000000000000000000000000000000' 9                    92900000
         DC    X'00000000000000000000000000000000' A                    92950000
         DC    X'00000000000000000000000000000000' B                    93000000
         DC    X'00000000000000000000000000000000' C                    93050000
         DC    X'00000000000000000000000000000000' D                    93100000
         DC    X'00000000000000000000000000000000' E                    93150000
         DC    X'00000000000000000000000000000001' F           @OZ29793 93200086
         SPACE 2                                                        93250000
*********************************************************************** 93300000
         EJECT                                                          93350000
*********************************************************************** 93400000
*********                                                     ********* 93450000
*********     TRANSLATE AND TEST TABLE - ASIS/FULLSCR MODE    ********* 93500000
*********                                                     ********* 93550000
*********************************************************************** 93600000
         SPACE 2                                                        93650000
ASISTBL  EQU   *                                                        93700000
FLSCTBL  EQU   *                                                        93750000
*              00 - NO CONVERSION                                       93800000
*              01 - CONVERT TO COLON (:)                                93850000
*              02 - CONVERT TO CONTROL SEQUENCE ('1DC8')                93900000
*              03 - CONVERT TO CONTROL SEQUENCE ('1D4C')                93950000
*              04 - NON-DISPLAYABLE CHARACTER                           94000000
*              05 - NON-DISPLAYABLE 3 CHARACTER SEQUENCE                94050000
*              06 - NON-DISPLAYABLE 4 CHARACTER SEQUENCE                94100000
*                 0 1 2 3 4 5 6 7 8 9 A B C D E F                       94150000
         DC    X'00010101010001000000000000010000' 0                    94200000
         DC    X'00050504020101010000000000040000' 1                    94250000
         DC    X'00000000030001000000000000010000' 2                    94300000
         DC    X'00000000000000010000000006010000' 3                    94350000
         DC    X'00000000000000000000000000000000' 4                    94400000
         DC    X'00000000000000000000000000000000' 5                    94450000
         DC    X'00000000000000000000000000000000' 6                    94500000
         DC    X'00000000000000000000000000000000' 7                    94550000
         DC    X'00000000000000000000000000000000' 8                    94600000
         DC    X'00000000000000000000000000000000' 9                    94650000
         DC    X'00000000000000000000000000000000' A                    94700000
         DC    X'00000000000000000000000000000000' B                    94750000
         DC    X'00000000000000000000000000000000' C                    94800000
         DC    X'00000000000000000000000000000000' D                    94850000
         DC    X'00000000000000000000000000000000' E                    94900000
         DC    X'00000000000000000000000000000000' F                    94950000
         SPACE 2                                                        95000000
*********************************************************************** 95050000
         EJECT                                                          95100000
*********************************************************************** 95150000
*********                                                     ********* 95200000
*********       TRANSLATE AND TEST TABLE - CONTROL MODE       ********* 95250000
*********                                                     ********* 95300000
*********************************************************************** 95350000
         SPACE 2                                                        95400000
CNTLTBL  EQU   *                                                        95450000
*              02 - CONVERT TO CONTROL SEQUENCE ('1DC8')                95500000
*              03 - CONVERT TO CONTROL SEQUENCE ('1D4C')                95550000
*              07 - SKIP SENDING THIS CHARACTER                         95600000
*                 0 1 2 3 4 5 6 7 8 9 A B C D E F                       95650000
         DC    X'07070707070707070707070707070707'  0                   95700000
         DC    X'07070707020707070707070707070707'  1                   95750000
         DC    X'07070707030707070707070707070707'  2                   95800000
         DC    X'07070707070707070707070707070707'  3                   95850000
         DC    X'07070707070707070707070707070707'  4                   95900000
         DC    X'07070707070707070707070707070707'  5                   95950000
         DC    X'07070707070707070707070707070707'  6                   96000000
         DC    X'07070707070707070707070707070707'  7                   96050000
         DC    X'07070707070707070707070707070707'  8                   96100000
         DC    X'07070707070707070707070707070707'  9                   96150000
         DC    X'07070707070707070707070707070707'  A                   96200000
         DC    X'07070707070707070707070707070707'  B                   96250000
         DC    X'07070707070707070707070707070707'  C                   96300000
         DC    X'07070707070707070707070707070707'  D                   96350000
         DC    X'07070707070707070707070707070707'  E                   96400000
         DC    X'07070707070707070707070707070707'  F                   96450000
         SPACE 2                                                        96500000
*********************************************************************** 96550000
         EJECT                                                          96600000
         IKJTIOCB                                                       96650000
         EJECT                                                          96700000
         TAVTD                                                          96750000
         EJECT                                                          96800000
         TDCTD                                                          96850000
         EJECT                                                          96900000
         TLCBD                                                          96950000
         EJECT                                                          97000000
         TPRFD                                                          97050000
PRFFLSCR EQU   PRFEOFN                  FULLSCR TPUT IN BUFFER @OY19692 97070086
         EJECT                                                          97100000
         TQCBD                                                          97150000
         EJECT                                                          97200000
         TSCBD                                                          97250000
         EJECT                                                          97300000
         TTSID                                                          97350000
         END                                                            97400000
