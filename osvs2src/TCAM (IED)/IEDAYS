         TITLE 'SIMULATED ATTENTION ROUTINE - IEDAYS'                   00040022
IEDAYS   CSECT                                                          00080022
         SPACE 3                                                        00080205
*  CHANGE ACTIVITY AS FOLLOWS                                           00080405
******************** MICROFICHE FLAGS *********************** SUPT CODE 00080605
*C850000-880000,888000-906000                                    S21903 00081005
*A140600-141800,181030-181360,212080-213860,219000               S22028 00081105
*A287030-287360,298080-299860,301000,400500-401500               S22028 00081205
*A442600-443200,712600-713200,906200-907400                      S22028 00081305
*C002080-002110,002130,002150,002170,002200,002220,002440        S22028 00081405
*C002520-002530,002880,002950,003090-003100,003240               S22028 00081505
*C038000-038500,455940-455960,456486-456523,457214-457266        S22028 00081605
*D106000-126000,928000                                           S22028 00081705
*C216000,260300,300000,350600-351200,456486,456965-456969        S22029 00081805
*C457214,457400-457600,496000-496800,498400,554600,555200-555800 S22029 00081905
*C923000                                                         S22029 00082005
*D260900,351800,456973,497600                                    S22029 00082105
*A784000                                                         A44022 00082205
*C038000,171000,275200,405920,455800,457086                      A44887 00082305
*D002044,944000                                                  A44887 00082405
*C394000,396000                                                   M0891 00082505
*C522000,524000                                                   M0891 00082605
*C576600                                                          M0891 00082705
*A581000,909700                                                  S22025 00082805
*C010000-018000,032000,038000,149000,171050,455920,456799,456809 S22025 00082905
*C456859,457116,690000,784500-785700,842000,843000,922000-926000 S22025 00083005
*C580000,582000                                                  S22025 00083105
*D039000                                                         S22025 00083205
*A785800,785900                                                 SA57345 00083305
*D212880-213120,298880-299120,456494-456497                     SA61067 00083405
*C070000-080000,D072000-096000C141770,D141800-147000,A144770    SA60815 00083505
*D432000-453000,A432000,442000,A597300-597600,602500-603500     SA60815 00083605
*A624400-625600D668000-720000,A668000-688000                   SA60815  00083705
*    CLEAN-UP                                                    S21903 00083805
* D268000-273600,457053-457077                                 @SA73375 00083958
*A003845,813600,818200                                          SA66950 00088854
*C002052,002630,002820,002880,002885,002930,002950,003210,003240,Y06327 00093805
*C003310,040000,213600,213680,299600,299680,405800,455934,455936,Y06327 00103805
*C456500-456508,457257-457332,584000,770000,812000               Y06327 00113805
*A002935,003852-003858,140636-140654,140870,181273-181291,       Y06327 00123805
*A213682-213692,287274-287294,299682-299692,455933,455935,455937,Y06327 00133805
*A791630-791990,811500,960600                                    Y06327 00143805
*A003840,813000,818000                                         @SA66950 00143957
*D791630-824000                                                @SA70677 00144057
*A784000,790100                                                @YA11170 00144158
*D790100-791500                                                @YA11170 00144258
*D 003840                                                      @Y17XAYZ 00164200
*C138000,140648,181160,213684,287160,299684,455934,456502,     @Y17XAYP 00174200
*C457262                                                       @Y17XAYP 00184200
*                                                              @G36XRYP 00186200
*A598000,608000,785900,932000                                  @G36XRYP 00188200
*C140900,141230,181030,181090,212080,212320,287000,287090      @G36XRYP 00190200
*C298080,298320,455868,455930,456469,457159,457220             @G36XRYP 00192200
*D003720-003750,600000-604000,610000-624000,934000-938000      @G36XRYP 00194200
*A181060,287060,644000,688000                                  @OZ24035 00197200
*A181066,181080,213520,213560,287036,287060,298240,298280      @OY18014 00198200
*A455892,455908,456475,456481,457179,457199                    @OY18014 00199200
*A003650                                                       @OZ27742 00199382
*C395500-396000,400000,401500,523000-525000,532000,576900      @OZ27742 00199482
*********************************************************************** 00201222
*TITLE  'IEDAYS'  SIMULATED ATTENTION ROUTINE                         * 00202020
*                                                                     * 00203020
*  MODULE NAME = IEDAYS   (TCAM,TSO)                           @Y17XAYP 00204000
*                                                                     * 00204205
*  DESCRIPTIVE NAME = SIMULATED ATTENTION ROUTINE                     * 00204405
*                                                                     * 00204605
*  COPYRIGHT = 'NONE'                                                 * 00204805
*                                                                     * 00205005
*  STATUS:  VERSION 10.0                                       @G36XRYP 00205200
*                                                                     * 00205405
*FUNCTION -- THE SIMULATED ATTENTION ROUTINE HANDLES SIMULATED        * 00206020
*   ATTENTIONS FOR TSO.  THE THREE WAYS OF SIMULATING ATTENTIONS ARE  * 00207020
*   (1) BY CHARACTER STRING/PA1 KEY(3270), (2) BY LINE COUNT, AND (3) * 00208022
*   BY TIME DELAY INTERVAL.                                           * 00209022
*      FOR SIMULATED ATTENTION BY CHARACTER STRING/PA1 KEY, THIS      * 00210022
*   ROUTINE FIRST CHECKS TO SEE IF THE TS BUFFER WAS READ BY THE      * 00211022
*   SIMULATED ATTENTION READ CHANNEL PROGRAM.  IF IT WAS NOT, A CHECK * 00212020
*   IS MADE TO SEE IF THE DEVICE IS A 2260 OR 3270.                   * 00213022
*   IF IT IS, AND THE SCREEN                                          * 00213522
*   IS FULL, THE ERASE DISPLAY REQUEST BIT IN THE SCB ERROR WORD IS   * 00214020
*   SET ON.  THE BUFFER IS THEN SCANNED FOR A CLEAR CHARACTER STRING/ * 00215022
*   CLEAR ENTRY KEY(3270),                                            * 00215522
*   WHICH INDICATES THAT THE SCREEN IS TO BE ERASED IMMEDIATELY.  IF  * 00216020
*   THIS STRING/KEY IS PRESENT, THE BUFFER IS POSTED TO BUF-          * 00217022
*   FER RETURN, AND NO ADDITIONAL SIMULATED ATTENTION PROCESSING      * 00218020
*   TAKES PLACE.                                                      * 00219020
*      IF THE DEVICE IS NOT A 2260 OR 3270,                           * 00220022
*   OR IF NO CLEAR CHARACTER STRING/KEY                               * 00220522
*   IS PRESENT IN THE BUFFER, THIS ROUTINE CHECKS THE QCB TO SEE IF   * 00221020
*   SIMULATED ATTENTION BY CHARACTER STRING/PA1 KEY                   * 00222022
*   WAS REQUESTED.  IF IT                                             * 00222522
*   WAS NOT, CONTROL IS RETURNED TO THE RETURN INTERFACE.  CONTROL IS * 00223020
*   ALSO RETURNED IMMEDIATELY IF IT WAS REQUESTED, BUT NO VALID SIMU- * 00224020
*   LATED ATTENTION CHARACTER STRING IS FOUND IN THE BUFFER.  IF THE  * 00225020
*   CHARACTER STRING IS FOUND, THIS ROUTINE CHECKS TO SEE IF A VALID  * 00226020
*   ATTENTION LEVEL (A NUMBER, 1 THROUGH 9, FOLLOWED BY A CARRIAGE    * 00227020
*   RETURN OR NEW LINE SYMBOL) WAS ALSO ENTERED.  IF IT WAS, IT IS    * 00228020
*   SET IN THE SCB.  IF NONE WAS ENTERED, AN ATTENTION LEVEL OF ZERO  * 00229020
*   IS SET IN THE SCB.  AN INVALID ATTENTION LEVEL CAUSES AN IMMEDI-  * 00230020
*   ATE RETURN TO THE RETURN INTERFACE.  AFTER SETTING THE ATTENTION  * 00231020
*   LEVEL, THIS ROUTINE SETS ON THE SIMULATED ATTENTION REQUEST BIT   * 00232020
*   IN THE SCB ERROR WORD, POSTS THE BUFFER TO BUFFER RETURN, AND     * 00233020
*   RETURNS CONTROL VIA THE RETURN INTERFACE.                         * 00234020
*      IF THE BUFFER WAS READ BY THE SIMULATED ATTENTION READ CHANNEL * 00235020
*   PROGRAM, THE SIMULATED ATTENTION READ BIT IN THE DESTINATION QCB  * 00236020
*   IS SET OFF.  IN THIS CASE, A SIMULATED ATTENTION CHARACTER STRING * 00237020
*   IS NOT REQUIRED.  IF ONE WAS ENTERED, IT IS CHECKED FOR VALIDITY, * 00238020
*   AND THE ATTENTION LEVEL IS ALSO CHECKED.  HOWEVER, IN THIS CASE,  * 00239020
*   AN INVALID CHARACTER STRING OR ATTENTION LEVEL DOES NOT PREVENT   * 00240020
*   THE BUFFER FROM BEING POSTED.  INSTEAD, AN ATTENTION LEVEL OF     * 00241020
*   ZERO IS SET, AND POSTING AND RETURN OCCUR AS STATED ABOVE.  ALSO, * 00242020
*   IN THIS CASE, THE ERASE DISPLAY REQUEST BIT IS AUTOMATICALLY SET  * 00243020
*   ON FOR 2260'S OR 3270'S, BUT NO CHECK FOR A CLEAR CHARACTER       * 00244022
*   STRING/KEY IS MADE.                                               * 00244522
*      FOR SIMULATED ATTENTION BY LINE COUNT, EACH PHYSICAL OUTPUT    * 00245020
*   LINE IS COUNTED, AND THE COUNT KEPT IN THE DESTINATION QCB.  WHEN * 00246020
*   THE THRESHOLD SPECIFIED BY THE USER IN THE TERMINAL STATUS BLOCK  * 00247020
*   IS REACHED, A SPECIAL SIMULATED ATTENTION CHANNEL PROGRAM IS RE-  * 00248020
*   QUESTED BY SETTING ON THE SIMULATED ATTENTION READ REQUEST BIT IN * 00249020
*   THE QCB AND SETTING THE OUTPUT LINE COUNT TO ZERO BEFORE RETURN-  * 00250020
*   ING TO THE EDIT ROUTINE.  THIS IS ALSO DONE WHEN THE DEVICE IS A  * 00251020
*   2260 OR 3270 WITH A FULL SCREEN, EVEN THOUGH THE THRESHOLD MAY    * 00252022
*   NOT HAVE BEEN REACHED.                                            * 00253022
*      FOR SIMULATED ATTENTION BY TIME DELAY INTERVAL, A QCB IS       * 00254020
*   POSTED TO THE TIME DELAY QUEUE WHEN NO I/O IS IN PROGRESS WITH    * 00255020
*   THE TERMINAL.  IF NO INPUT OR OUTPUT IS REQUESTED BEFORE THE TIME * 00256020
*   DELAY INTERVAL EXPIRES, THE TIME DELAY REMOVAL ROUTINE (IEDAYY)   * 00257020
*   REMOVES THE QCB FROM THE TIME DELAY QUEUE, AND THE SIMULATED      * 00258020
*   ATTENTION ROUTINE IS DISPATCHED.  IF SIMULATED ATTENTION BY TIME  * 00259020
*   DELAY WAS NOT REQUESTED IN THE QCB, CONTROL IS RETURNED TO THE    * 00260020
*   DISPATCHER TO DISPATCH THE NEXT SUBTASK.  OTHERWISE, THE SIMU-    * 00261020
*   LATED ATTENTION READ REQUEST BIT IN THE QCB IS SET ON, AND, IF    * 00262020
*   THE LCB/PLCB IS FREE, IT IS POSTED TO ITSELF. THIS ROUTINE THEN   * 00263005
*   BRANCHES TO THE TSO MESSAGE GENERATION ROUTINE.                   * 00264020
*                                                                     * 00265020
*ENTRY POINTS -- IEDAYS - TO HANDLE SIMULATED ATTENTION BY CHARACTER  * 00266020
*   STRING.                                                           * 00267020
*   CALLING SEQUENCE          L    R12,AVTMSGS+OFFSET                 * 00268020
*                             BR   R12                                * 00269020
*   IEDAYS2 - TO HANDLE SIMULATED ATTENTION BY LINE COUNT.            * 00270020
*   CALLING SEQUENCE          L    R15,TSISIMAT                       * 00271020
*                             BAL  R14,16(R15)                        * 00272020
*   IEDAYS3 - TO HANDLE SIMULATED ATTENTION BY TIME DELAY INTERVAL.   * 00273020
*   CALLING SEQUENCE          L    R15,TSIDYQCB                       * 00274020
*                             BR   R15                                * 00275020
*                                                                     * 00276020
*INPUT -- IEDAYS IS ENTERED AT ENTRY POINT IEDAYS FROM THE TCAM USER  * 00277020
*   INTERFACE ROUTINE (IEDQUI) WHEN A SIMATTN MACRO INSTRUCTION IS    * 00278020
*   CODED IN A INBUF SUBGROUP OF AN MH.  AT ENTRY, THE FOLLOWING      * 00279020
*   REGISTERS ARE SET.                                                * 00280020
*   R3 HAS THE SCB ADDRESS.                                           * 00281020
*   R4 HAS THE LCB/PLCB ADDRESS.                                      * 00282005
*   R6 HAS THE CURRENT TCAM BUFFER ADDRESS.                           * 00283020
*   R9 HAS THE AVT ADDRESS.                                           * 00284020
*   R12 HAS THE ENTRY POINT ADDRESS.                                  * 00285020
*                                                                     * 00286020
*      IEDAYS IS ENTERED AT ENTRY POINT IEDAYS2 FROM THE TIOC EDIT    * 00287020
*   ROUTINE (IEDAYV/IEDAYW) OR THE TIOC 3270 EDIT ROUTINE (IEDAYB)    * 00288005
*   WHEN THE CURRENT BUFFER CONTAINS THE END OF AN                    * 00288505
*   OUTPUT LINE (NEW LINE SYMBOL IN BUFFER, OR BUFFER SATISFIES LINE  * 00289020
*   SIZE SPECIFIED IN THE TERMINAL STATUS BLOCK).  AT ENTRY, THE FOL- * 00290020
*   LOWING REGISTERS ARE SET.                                         * 00291020
*   R3 HAS THE SCB ADDRESS.                                           * 00292020
*   R4 HAS THE LCB/PLCB ADDRESS.                                      * 00293005
*   R5 HAS THE QCB ADDRESS.                                           * 00293505
*   R13 HAS THE AVT ADDRESS.                                          * 00294020
*   R14 HAS THE RETURN ADDRESS IN IEDAYV/IEDAYW OR IEDAYB.            * 00295005
*   R15 HAS THE ENTRY POINT ADDRESS.                                  * 00296020
*                                                                     * 00297020
*      IEDAYS IS ENTERED AT ENTRY POINT IEDAYS3 FROM THE TCAM DIS-    * 00298020
*   PATCHER WHEN A QCB IS REMOVED FROM THE TIME DELAY QUEUE, WITH THE * 00299020
*   FOLLOWING REGISTERS SET.                                          * 00300020
*   R1 HAS THE ADDRESS OF THE QCB REMOVED FROM THE TIME DELAY QUEUE.  * 00301020
*   R11 HAS THE DISPATCHER ADDRESS.                                   * 00302020
*   R13 HAS THE ADDRESS OF AVTSAVE2.                                  * 00303020
*   R15 HAS THE ENTRY POINT ADDRESS.                                  * 00304020
*                                                                     * 00305020
*OUTPUT -- FOR SIMULATED ATTENTION BY VALID CHARACTER STRING, THE     * 00306020
*   SIMULATED ATTENTION REQUEST BIT AND ATTENTION LEVEL ARE SET IN    * 00307020
*   THE SCB, AND THE BUFFER IS POSTED TO BUFFER RETURN.  IF APPLICA-  * 00308020
*   BLE FOR A 2260 OR 3270, THE ERASE DISPLAY REQUEST BIT IS ALSO SET * 00309022
*   IN THE SCB.                                                       * 00310022
*      FOR SIMULATED ATTENTION BY LINE COUNT, THE SIMULATED ATTENTION * 00311020
*   READ REQUEST BIT IN THE QCB IS SET, AND THE QCB LINE COUNT IS SET * 00312020
*   TO ZERO.  IF THE LINE COUNT THRESHOLD HAS NOT BEEN REACHED, THE   * 00313020
*   BIT IS NOT SET, AND THE QCB LINE COUNT IS INCREMENTED BY ONE.     * 00314020
*      FOR SIMULATED ATTENTION BY TIME DELAY INTERVAL, THE SIMULATED  * 00315020
*   ATTENTION READ REQUEST BIT IN THE QCB IS SET, AND THE LCB IS      * 00316020
*   POSTED TO ITSELF.  REGISTERS 1 AND 9 ARE CLEARED TO ZERO, AND     * 00317020
*   REGISTER 12 CONTAINS THE ENTRY POINT IN THE TSO MSGGEN ROUTINE.   * 00318020
*                                                                     * 00319020
*EXTERNAL ROUTINE -- IEDQTNT - TO GET THE TERMINAL ENTRY FROM THE     * 00320020
*   INDEX IN THE LCB OR THE RESOURCE ID TABLE (FOR 3705).             * 00321005
*                                                                     * 00322020
*EXITS-NORMAL -- TO THE MH VIA THE RETURN INTERFACE ROUTINE (IEDQLM). * 00323020
*   TO THE TIOC EDIT ROUTINE (IEDAYV-3705/IEDAYW-270X).               * 00324005
*   TO THE TIOC 3270 EDIT ROUTINE (IEDAYB).                           * 00324522
*   TO THE DISPATCHER DISPATCH FUNCTION.                              * 00325020
*   TO THE TSO MESSAGE GENERATION ROUTINE (IEDAYM).                   * 00326020
*                                                                     * 00327020
*EXITS-ERROR -- NONE                                                  * 00328020
*                                                                     * 00329020
*TABLES/WORKAREAS -- CVT, TSB, LCB, SCB, AVT, QCB, TSID, DCB,  @G36XRYP 00330000
*   PLCB, TERMINAL ENTRY, CURRENT BUFFER PREFIX,ASCB,ASVT.     @G36XRYP 00331000
*                                                                     * 00332020
*ATTRIBUTES -- SERIALLY REUSABLE, REFRESHABLE, ENABLED, RESIDENT,     * 00333020
*   PROBLEM PROGRAM MODE.                                             * 00334020
*                                                                     * 00335020
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 00336020
*   PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER      * 00337020
*   SET.                                                              * 00338020
*                                                                     * 00339020
*********************************************************************** 00340020
         SPACE 2                                                        00341005
*  REGISTER EQUATES.                                                    00342005
         SPACE 2                                                        00343005
R0       EQU   0                        REGISTER ZERO            S21903 00344005
R1       EQU   1                        REGISTER ONE             S21903 00345005
RCNT     EQU   2                        REGISTER TWO             S21903 00346005
RSCB     EQU   3                        REGISTER THREE           S21903 00347005
RLCB     EQU   4                        REGISTER FOUR            S21903 00348005
RTRM     EQU   5                        REGISTER FIVE            S21903 00349005
RPRF     EQU   6                        REGISTER SIX             S21903 00350005
RQCB     EQU   7                        REGISTER SEVEN           S21903 00351005
RWRK     EQU   8                        REGISTER EIGHT           S21903 00352005
RAVT     EQU   9                        REGISTER NINE            S21903 00353005
RTSB     EQU   10                       REGISTER TEN             S21903 00354005
RDSP     EQU   11                       REGISTER ELEVEN          S21903 00355005
RDATA    EQU   11                       REGISTER 11              Y06327 00355505
RBAS     EQU   12                       REGISTER TWELVE          S21903 00356005
RSAV     EQU   13                       REGISTER THIRTEEN        S21903 00357005
R14      EQU   14                       REGISTER FOURTEEN        S21903 00358005
RIC      EQU   15                       REGISTER FIFTEEN         S21903 00359005
         SPACE 2                                                        00360005
*  OTHER EQUATES.                                                       00361005
         SPACE 2                                                        00362005
ZERO     EQU   X'00'                    HEX ZERO                 S21903 00363005
ONE      EQU   X'01'                    HEX ONE                  S21903 00364005
LEVMASK  EQU   X'0F'                    REMOVE BITS 0-3          S21903 00365005
LEVEL1   EQU   X'10'                    DEFAULT LEVEL ONE      @OZ27742 00365582
ENDTEXT  EQU   X'03'                    ETX                      S21903 00366005
NEWLINE  EQU   X'0D'                    NEW LINE CHARACTER       S21903 00367005
CRGRTRN  EQU   X'15'                    CARRIAGE RETURN          S21903 00368005
CHAR1    EQU   C'1'                     ONE                      S21903 00369005
CHAR9    EQU   C'9'                     NINE                     S21903 00370005
MASKALL  EQU   X'FF'                    ALL ONES                 S21903 00371005
SBACHAR  EQU   X'11'                    3270 SET BUFFER          S22028 00376005
PA1AID   EQU   X'6C'                    3270 PA1 KEY             S22028 00377005
CLEARAID EQU   X'6D'                    3270 CLEAR KEY           S22028 00378005
ENTERAID EQU   X'7D'                    3270 ENTER KEY           S22028 00379005
AUTOPL   EQU   X'01'                    AUTOPOLL INDICATOR       S22028 00380005
TWENTY1  EQU   X'21'                    HEX TWENTY-ONE           S22028 00381005
PRIORITY EQU   X'E4'                    PRIORITY                 S21903 00382005
BLANK    EQU   X'40'                    BLANK                    S21903 00383005
DELAY    EQU   X'02'                   LCB TIME DELAY BIT       SA66950 00384557
FOUR     EQU   4                        ENTRY POINT FOR RETURN   S22025 00385005
LGBINDIC EQU   X'80'                    LGB FLAG                 Y06327 00385205
RNCLRAID EQU   X'2C'                    3705 AID BYTE DISPL.     Y06327 00385405
ONEMORE  EQU   1                        DECIMAL ONE              Y06327 00385605
TWO      EQU   2                        DECIMAL TWO              Y06327 00385805
         EJECT                                                   S21903 00386005
         SPACE 2                                                        00400020
         BALR  RBAS,0                   LOAD BASE REGISTER              00600020
         USING *,RBAS                   ADDRESSABILITY FOR MODULE       00800020
BEGIN    B     IEDAYS0                  BRANCH AROUND DC'S       S22025 01000022
         NOPR  0                        FULL WORD BOUNDRY        S22025 01200022
         DC    AL1(DSPMCPL4),AL3(*-1)   STCB FOR AYSAYS3         S22025 01400022
         USING *,RIC                    ADDRESSIBILITY FOR       S22025 01600022
IEDAYS3  B     AYSAYS3                  BRANCH TO AYSAYS3 ROUTINES22025 01800022
         DROP  RBAS                                                     02000020
         USING IEDAYS,RIC                                               02200020
IEDAYS2  STM   14,12,AVTSAVE3-AVTSAVE2+12(13)  SAVE REGISTERS           02400020
         L     RBAS,AYSAYS2             LOAD BASE REGISTER              02600020
         BR    RBAS                     BRANCH TO COUNT ROUTINE         02800020
         CNOP  0,4                                                      03000020
AYSAYS2  DC    A(AYS201)                ADDR OF AYS201 ROUTINE   S22025 03200022
         DROP  RIC                                                      03400020
         USING BEGIN,RBAS                                               03600020
IEDAYS   IEDHJN ,                       ID AND DATE              S22025 03800022
         USING IEDQLCB,RLCB             ADDRESS. FOR LCB/PLCB    Y06327 04000005
         USING IEDQSCB,RSCB             ADDRESSABILITY FOR SCB          04200020
         USING IEDQAVTD,RAVT            ADDRESSABILITY FOR AVT          04400020
         USING IEDQQCB,RQCB             ADDRESSABILITY FRO QCB          04600020
         USING IEDQTRM,RTRM             ADDRESSABILITY FOR TRM ENTRY    04800020
         USING IEDQPRF,RPRF             ADDRESSABILITY FOR BUFFER       05000020
IEDAYS0  LH    R1,LCBTTCIN              GET INDEX TO TERM ENTRY         05400020
         L     RIC,AVTRNMPT             ADDRESS OF TERM NAME TABLE      05600020
         BALR  R14,RIC                  BRANCH AND LINK TO GET          05800020
*                                       TERM ENTRY ADDRESS              06000020
         LR    RTRM,R1                  RETURNED IN REGISTER 1          06200020
         L     RQCB,TRMDESTQ-1          GET ADDRESS OF DEST QCB         06400020
         TM    QCBFLAG,QCBTSSES         IS TSO SESSION IN PROGRESS      06600020
         BNO   AYS104                   NO, RETURN                      06800020
         BAL   RWRK,AYSTSB         FIND TSB IF TSO ACTIVE       SA60815 07000005
         B     AYS104              TSO NOT IN SYSTEM            SA60815 08000005
         USING TSB,RTSB                                                 09800020
         SPACE 2                                                        10000020
         TM    LCBSTAT1,LCBRECVN        IS LINE RECEIVING               10200020
         BNO   AYS104                   NO, RETURN                      10400020
         SPACE 2                                                        12800020
         DROP  RTRM                     FREE TTE BASE REG      @Y17XAYO 13000000
         LA    RWRK,TRMPRFSZ            GET PREFIX LENGTH      @Y17XAYO 13100000
         SR    RTRM,RWRK                BACK UP TRM BASE PTR   @Y17XAYO 13200000
         USING IEDNTRM,RTRM             IEDDCT MUST HAVE PREFIX@Y17XAYO 13300000
         IEDDCT REG=RWRK,FLD=AVTPARM3                          @Y17XAYO 13400000
         LA    RTRM,TRMPRFSZ(,RTRM)     RESET TTE BASE         @Y17XAYO 13500000
         DROP  RTRM                     FREE TTE BASE REG      @Y17XAYO 13600000
         USING IEDQTRM,RTRM             BASE OF TTE ADDR       @Y17XAYO 13700000
         SR    RIC,RIC                  CLEAR REGISTER           S22028 14063022
         MVI   AVTPARM3,ZERO            CLEAR STORAGE AREA       Y06327 14063605
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 14064200
         BO    AYS300B                  YES. BRANCH              Y06327 14064805
*                                       NO - NOT A 3705 TERMINAL Y06327 14065405
         IC    RIC,LCBUCBX              PICK UP RLN              S22028 14066022
         SLL   RIC,2                    MULTIPLY BY FOUR         S22028 14069022
         L     R14,LCBDCBPT             GET DCB ADDR             S22028 14072022
         USING IHADCB,R14               DCB ADDRESSABILITY       S22028 14075022
         L     R14,DCBINVLI(RIC)        GET INVITATION LIST ADDR S22028 14078022
         DROP  R14                      DROP ADDRESSABILITY      S22028 14081022
         MVC   AVTPARM3(1),3(R14)       SAVE CONTROL WORD        S22028 14084022
AYS300B  EQU   *                                                 Y06327 14087005
         TM    AVTPARM3+1,DCT3270       IS THIS A 3270 TRM     @G36XRYP 14090000
         BNO   AYS310A                  NO, BRANCH               S22028 14120022
         TM    AVTPARM3+2,DCTLOCAL      IS THIS A 3270 LOCAL   @G36XRYP 14123000
         BO    AYS310A                  YES, BRANCH              S22028 14126022
         TM    PRFSTAT1,PRFNHDRN        IS THIS HEADER BUFFER    S22028 14129022
         BO    AYS310A                  NO, BRANCH               S22028 14132022
         TM    SCBERR2,SCBSOHE          IS THIS 3270 SOH%R MSG   S22028 14135022
         BO    AYS104                   YES, BRANCH              S22028 14138022
AYS310A  EQU   *                                                 S22028 14147022
         SR    RDATA,RDATA              CLEAR REGISTER           Y06327 14147705
         IC    RDATA,LCBISZE            GET NUMBER OF IDLES      Y06327 14148405
         AR    RDATA,RPRF               ADD TO BUFFER START      Y06327 14149105
         NI    QCBTSOF2,MASKALL-QCBDSSMI SET BUFFER RECEIVED     S22028 14150022
         TM    QCBTSOF1,QCBSATRD        WAS BUFFER READ BY SIM   S22028 14153022
*                                       ATTN CHAN PROGRAM        S22028 14156022
         BO    AYS107                   YES, CHECK CONTENTS      S22028 14159022
         SPACE 2                                                        14162022
*  IF THE DEVICE IS A DISPLAY, THE LINE COUNT IS CHECKED TO      S22028 14165022
*  DETERMINE IF DATA HAS BEEN ENTERED INTO THE NEXT TO LAST      S22028 14168022
*  LINE OF THE DISPLAY.  IF SO, A SCREEN ERASURE IS REQUESTED.   S22028 14171022
         SPACE 2                                                        14174022
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY       SA60815 14177005
         BO    AYS310                   BRANCH YES              SA60815 14477005
         MVI   QCBSATCT,AVTEZERO        RESET LINE COUNT                14800020
         B     AYS307                   BYPASS 2260 SCREEN ERASE S22025 14900022
AYS310   EQU   *                                                        15000020
         TM    PRFSTAT1,PRFNLSTN        IS THIS LAST BUFFER             15060020
         BO    AYS311                   BRANCH ON NO                    15120020
         SR    R14,R14                  CLEAR REGISTER             2260 15200020
         SR    RIC,RIC                  CLEAR REGISTER                  15300020
         IC    RIC,TSBLNNO              GET NUMBER OF LINES ON     2260 15400020
*                                       DISPLAY SCREEN             2260 15600020
         BCTR  RIC,0                    REDUCE LINE COUNT BY ONE   2260 15800020
         IC    R14,QCBSATCT             GET NUMBER OF LINES ENTERED2260 16000020
         CR    R14,RIC                  IS NUMBER OF LINES ENTERED 2260 16200020
*                                       EQUAL TO NUMBER OF LINES   2260 16400020
*                                       ON DISPLAY MINUS ONE       2260 16600020
         BL    AYS311                   NO, DON'T ERASE                 16800020
         BH    AYS312                   NO, SCREEN WRAPPED              17000020
         OI    QCBTSOF1,QCBSATRD        REQUEST SIMULATED ATTENTION     17050020
         B     AYS311                   CONTINUE                        17100093
AYS312   EQU   *                                                        17100320
         OI    SCBSTATE,SCBERSDS        REQUEST SCREEN ERASURE   A44887 17100693
         TM    SCBERR1,SCBCUTFN         WAS THERE CUTOFF ERROR          17101020
         BO    AYS312A                  BRANCH ON YES                   17102020
         TM    SCBERR4,SCBTXTTN         WAS THERE A TEXT ERROR          17103020
         BO    AYS312A                  BRANCH ON YES                   17104020
         B     AYS312B                  BRANCH IF NO ERROR       S22025 17105022
AYS312A  EQU   *                                                        17106020
         MVI   QCBSATCT,0               PREVENT FLASHBACK OF INPUT      17107020
AYS312B  EQU   *                                                        17108020
         MVI   QCBCARCT,0               CLEAR CARRIAGE COUNT            17110020
         NI    QCBRETCT,MASKALL-QCBNL   RESET FLAGS                     17120020
         SPACE 2                                                        17200020
*  THE NUMBER OF CHARACTERS IN THE CLEAR CHARACTER STRING IS            17400020
*  CALCULATED.                                                          17600020
         SPACE 2                                                        17800020
AYS311   EQU   *                                                        18000020
         LA    RWRK,PRFSHDR-IEDQPRF(RDATA) POINT TO START OF DATAY06327 18020005
         TM    PRFSTAT1,PRFNHDRN        IS THIS HEADER BUFFER           18050020
         BO    AYS104                   BRANCH ON NO                    18100020
         TM    AVTPARM3+1,DCT3270       IS THIS A 3270 TRM     @G36XRYP 18103000
         BZ    AYS311B                  NO, BRANCH               S22028 18106022
         TM    TSBFLG5,TSBKEYS          TSO SESSION MANAGER    @OZ24035 18106300
         BO    AYS307                   YES, BRANCH            @OZ24035 18106600
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @OY18014 18106700
         BNO   AYS311C                  NO, BRANCH             @OY18014 18106800
         TM    LCBSTAT5,LCBLUNIT        IS THIS A LU           @YM09070 18107000
         BO    AYS311A                  YES, BRANCH            @YM09070 18108000
AYS311C  EQU   *                                               @OY18014 18108500
         TM    AVTPARM3+2,DCTLOCAL      IS THIS A 3270 LOCAL   @G36XRYP 18109000
         BO    AYS311A                  YES, BRANCH              Y06327 18112005
         LA    RWRK,TWO(RWRK)           SKIP TO PROPER CHAR      Y06327 18114005
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 18116000
         BO    AYS311A                  YES, BRANCH              Y06327 18118005
         LA    RWRK,ONEMORE(RWRK)       SKIP TO PROPER CHAR      Y06327 18120005
         TM    AVTPARM3,AUTOPL          IS THIS AUTOPOLL         Y06327 18122005
         BZ    AYS311A                  NO, BRANCH               Y06327 18124005
         LA    RWRK,ONEMORE(RWRK)       SKIP TO PROPER CHAR      Y06327 18126005
AYS311A  EQU   *                                                 Y06327 18128005
         CLI   0(RWRK),CLEARAID         IS THIS AID FOR CLEAR    Y06327 18130005
         BE    AYS309                   YES, BRANCH              S22028 18135522
AYS311B  EQU   *                                                 S22028 18136022
         L     RWRK,TSBERSDS           IS CLEAR CHARACTER               18150020
         LTR   RWRK,RWRK                STRING PRESENT                  18200020
         BZ    AYS307                   NO, CHECK FOR SIMULATED    2260 18400020
*                                       ATTENTION REQUESTED        2260 18600020
         LA    RCNT,4                   MAXIMUM NUMBER OF CHARS    2260 18800020
         LA    RWRK,TSBERSDS            POINT TO CLEAR CHARACTER   2260 19000020
*                                       STRING                     2260 19200020
AYS301   CLI   0(RWRK),BLANK            IS THE CHARACTER A BLANK        19400020
         BE    AYS302                   YES, CALCULATE NUMBER      2260 19600020
*                                       OF CHARACTERS PRESENT      2260 19800020
         LA    RWRK,1(RWRK)             POINT TO NEXT CHARACTER    2260 20000020
         BCT   RCNT,AYS301              BRANCH IF NOT ALL CHECKED  2260 20200020
AYS302   LA    RIC,3                    MAXIMUM NUMBER OF CHARS    2260 20400020
*                                       MINUS ONE                  2260 20600020
         SR    RIC,RCNT                 CALCULATE NUMBER PRESENT   2260 20800020
         SPACE 2                                                        21000020
*  THE INPUT BUFFER IS CHECKED FOR THE CLEAR CHARACTER STRING.          21200020
         TM    AVTPARM3+1,DCT3270       IS THIS A 3270 TRM     @G36XRYP 21208000
         BZ    AYS302C                  NO, BRANCH               S22028 21216022
         LA    RWRK,PRFSHDR-IEDQPRF(RDATA) POINT TO DATA START   Y06327 21224005
         TM    AVTPARM3+2,DCTLOCAL      IS THIS A 3270 LOCAL   @G36XRYP 21232000
         BZ    AYS302B                  NO, MUST BE REMOTE       S22028 21240022
AYS302A  EQU   *                                                 S22028 21248022
         CLI   3(RWRK),SBACHAR          IS THIRD CHARACTER AN    S22028 21256022
*                                       SBA OR A DATA CHARACTER  S22028 21264022
         BNE   AYS302D                  NOT SBA, GO SCAN FOR     S22028 21272022
*                                       CLEAR CHARACTER STRING   S22028 21280022
         LA    RWRK,8(RWRK)             IF SBA PRESENT SKIP TO   S22028 21320022
*                                       FIRST BYTE OF DATA + 2   S22028 21328022
         B     AYS302D                  NOW GO SCAN FOR CLEAR    S22028 21336022
*                                       CHARACTER STRING         S22028 21344022
AYS302B  EQU   *                                                 S22028 21352022
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @OY18014 21352600
         BNO   AYS302BB                 NO, BRANCH             @OY18014 21353200
         TM    LCBSTAT5,LCBLUNIT        IS THIS A LU           @YM09070 21354000
         BO    AYS302A                  YES,BRANCH             @YM09070 21356000
AYS302BB EQU   *                                               @OY18014 21358000
         LA    RWRK,TWO(RWRK)           ASSUME 3705 TERMINAL AND Y06327 21360005
*                                       POINT TO FIRST BYTE IF   Y06327 21368005
*                                       DATA OR TO AID BYTE      Y06327 21368205
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 21368400
         BO    AYS302BA                 YES. BRANCH              Y06327 21368605
         LA    RWRK,ONEMORE(RWRK)       NOT A 3705 TERMINAL      Y06327 21368805
*                                       INCLUDE STX BYTE         Y06327 21369005
AYS302BA EQU   *                                                 Y06327 21369205
         TM    AVTPARM3,AUTOPL          IS THIS AUTOPOLL         S22028 21370022
         BZ    AYS302A                  NO, BRANCH               S22028 21372022
         LA    RWRK,1(RWRK)             SKIP INDEX BYTE          S22028 21374022
         B     AYS302A                  GO CHECK FOR SBA         S22028 21376022
AYS302C  EQU   *                                                 S22028 21386022
         SPACE 2                                                        21400020
         LA    RWRK,PRFSHDR-IEDQPRF+2(RDATA) POINT TO DATA START Y06327 21600005
*                                       DATA PLUS TWO              2260 21800020
AYS302D  EQU   *                                                 S22028 21900022
         LA    RCNT,3                   NUMBER OF CHECKS TO MAKE   2260 22000020
AYS303   EX    RIC,COMPAR2              IS CLEAR STING PRESENT     2260 22200020
         BE    AYS304                   YES, SET UP TO ERASE       2260 22400020
         BCTR  RWRK,0                   BACK UP ONE CHARACTER      2260 22600020
         BCT   RCNT,AYS303              BRANCH IF NOT ALL CHECKED  2260 22800020
         B     AYS307                   CLEAR CHARACTER STRING     2260 23000020
*                                       NOT FOUND, BRANCH          2260 23200020
         SPACE 2                                                        23400020
*  IF THE CLEAR CHARACTER STRING IS PRESENT, A SCREEN ERASURE           23600020
*  IS REQUESTED.                                                        23800020
         SPACE 2                                                        24000020
AYS304   BCT   RCNT,AYS305              BRANCH IF STRING NOT       2260 24200020
*                                       FIRST IN BUFFER            2260 24400020
         B     AYS306                   BRANCH IF STRING FIRST     2260 24600020
AYS305   BCTR  RWRK,0                   POINT TO CHARACTER IN      2260 24800020
*                                       FRONT OF STRING            2260 25000020
         CLI   0(RWRK),ZERO             IS THE CHARACTER ZERO      2260 25200020
         BNE   AYS307                   NO, INVALID STRING         2260 25400020
         LA    RWRK,1(RWRK)             RESET POINTER              2260 25600020
AYS306   LA    RWRK,1(RIC,RWRK)         POINT TO CHARACTER AFTER        25800020
*                                       CLEAR STRING               2260 26000020
         LA    RCNT,PRFSUNIT            ADDR OF HDR PREFIX       S22029 26030022
         AH    RCNT,PRFSIZE             ADD DATA SIZE PLUS HDR   S22029 26060022
*                                       PREFIX SIZE              S22029 26090022
         CR    RCNT,RWRK                IS THIS END OF DATA             26120020
         BE    AYS309                   BRANCH ON YES                   26150020
         CLI   0(RWRK),CRGRTRN          IS IT A CARRIAGE RETURN    2260 26200020
         BE    AYS309                   BRANCH ON YES                   26400020
         CLI   0(RWRK),NEWLINE          IS IT A NEW LINE CHAR           26600020
         BNE   AYS307                   BRANCH ON NO                    27440020
AYS309   OI    SCBSTATE,SCBERSDS        REQUEST SCREEN ERASURE   A44887 27520021
         MVI   QCBSATCT,AVTEZERO        CLEAR LINE COUNT                27560020
         NI    QCBRETCT,MASKALL-QCBNL   CLEAR CARRIAGE FLAGS            27566020
         MVI   QCBCARCT,ZERO            CLEAR CARRIAGE COUNT            27572020
         NI    QCBTSOF1,MASKALL-QCBSATRD NO SIMATTN NEEDED              27580020
         B     AYS110                   BRANCH TO RETURN BUFFER    2260 27600020
         SPACE 2                                                        27800020
*  THE FOLLOWING CODE CHECKS TO SEE IF SIMULATED ATTENTION BY           28000020
*  CHARACTER STRING HAS BEEN REQUESTED.                                 28200020
         SPACE 2                                                        28400020
AYS307   EQU   *                                                        28600020
         LA    RWRK,PRFSHDR-IEDQPRF(RDATA) POINT TO DATA START   Y06327 28620005
         TM    PRFSTAT1,PRFNHDRN       IS THIS HEADER BUFFER            28650020
         BO    AYS104                  BRANCH ON NO                     28700020
         TM    AVTPARM3+1,DCT3270       IS THIS A 3270 TRM     @G36XRYP 28701000
         BZ    AYS307B                  NO, BRANCH               S22028 28703000
         TM    TSBFLG5,TSBKEYS          TSO SESSION MANAGER    @OZ24035 28703300
         BO    AYS104                   YES, BRANCH            @OZ24035 28703600
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @OY18014 28703700
         BNO   AYS307G                  NO, BRANCH             @OY18014 28703800
         TM    LCBSTAT5,LCBLUNIT        IS THIS A LU           @YM09070 28704000
         BO    AYS307A                  YES, BRANCH            @YM09070 28706000
AYS307G  EQU   *                                               @OY18014 28707000
         TM    AVTPARM3+2,DCTLOCAL      IS THIS A 3270 LOCAL   @G36XRYP 28709000
         BO    AYS307A                  YES, BRANCH              Y06327 28712005
         LA    RWRK,TWO(RWRK)           SKIP TO PROPER CHAR      Y06327 28714005
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 28716000
         BO    AYS307A                  YES, BRANCH              Y06327 28718005
         LA    RWRK,ONEMORE(RWRK)       SKIP TO PROPER CHAR      Y06327 28720005
         TM    AVTPARM3,AUTOPL          IS THIS AUTOPOLL         Y06327 28722005
         BZ    AYS307A                  NO, BRANCH               Y06327 28724005
         LA    RWRK,ONEMORE(RWRK)       SKIP TO PROPER CHAR      Y06327 28726005
AYS307A  EQU   *                                                 Y06327 28728005
         CLI   0(RWRK),PA1AID           IS THIS AID FRO PA1      Y06327 28730005
         BE    AYS105A                  YES, BRANCH              S22028 28735422
AYS307B  EQU   *                                                 S22028 28736022
         TM    QCBTSOF2,QCBSATCH       IS SIMULATED ATTENTION BY        28750020
*                                       CHARACTER STRING REQUESTED      28800020
         BNO   AYS104                   NO, BRANCH                      29000020
         SPACE 2                                                        29200020
*  THE FOLLOWING CODE DETERMINES IF THE CHARACTER STRING SPECIFIED FOR  29400020
*  SIMULATED ATTENTION IS PRESENT IN THE DATA BUFFER.                   29600020
         SPACE 2                                                        29800020
         TM    AVTPARM3+1,DCT3270       IS THIS A 3270 TRM     @G36XRYP 29808000
         BZ    AYS307E                  NO, BRANCH               S22028 29816022
         LA    RWRK,PRFSHDR-IEDQPRF(RDATA) POINT TO DATA START   Y06327 29824005
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @OY18014 29824600
         BNO   AYS307BA                 NO, BRANCH             @OY18014 29825200
         TM    LCBSTAT5,LCBLUNIT        IS THIS A LU           @YM09070 29826000
         BO    AYS307C                  YES,BRANCH             @YM09070 29828000
AYS307BA EQU   *                                               @OY18014 29830000
         TM    AVTPARM3+2,DCTLOCAL      IS THIS A 3270 LOCAL   @G36XRYP 29832000
         BZ    AYS307D                  NO, MUST BE REMOTE       S22028 29840022
AYS307C  EQU   *                                                 S22028 29848022
         CLI   3(RWRK),SBACHAR          IS THIRD CHARACTER AN    S22028 29856022
*                                       SBA OR A DATA CHARACTER  S22028 29864022
         BNE   AYS307F                  NOT SBA GO SCAN FOR SIM  S22028 29872022
*                                       ATTN CHARACTER STRING    S22028 29880022
         LA    RWRK,8(RWRK)             IF SBA PRESENT SKIP TO   S22028 29920022
*                                       FIRST BYTE OF DATA + 2   S22028 29928022
         B     AYS307F                  NOW GO SCAN FOR SIM ATTN S22028 29936022
*                                       CHARACTER STRING         S22028 29944022
AYS307D  EQU   *                                                 S22028 29952022
         LA    RWRK,TWO(RWRK)           ASSUME 3705 TERMINAL AND Y06327 29960005
*                                       POINT TO FIRST BYTE OF   Y06327 29968005
*                                       DATA OR AID BYTE         Y06327 29968205
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 29968400
         BO    AYS307DA                 YES. BRANCH              Y06327 29968605
         LA    RWRK,ONEMORE(RWRK)       NOT A 3705 TERMINAL      Y06327 29968805
*                                       INCLUDE STX BYTE         Y06327 29969005
AYS307DA EQU   *                                                 Y06327 29969205
         TM    AVTPARM3,AUTOPL          IS THIS AUTOPOLL         S22028 29970022
         BZ    AYS307C                  NO, BRANCH               S22028 29972022
         LA    RWRK,1(RWRK)             SKIP OVER INDEX BYTE     S22028 29974022
         B     AYS307C                  GO CHECK FOR SBA         S22028 29976022
AYS307E  EQU   *                                                 S22028 29986022
         LA    RWRK,PRFSHDR-IEDQPRF+2(RDATA) POINT TO DATA START Y06327 30000005
AYS307F  EQU   *                                                 S22028 30100022
         IC    RIC,TSBFLG2              GET COUNT OF CHARACTER STRING   30200020
         N     RIC,CNTMASK              REMOVE ALL BUT TWO LOW ORDER    30400020
*                                       BITS - INDICATES COUNT OF       30600020
*                                       CHARACTER STRING MINUS ONE      30800020
         LA    RCNT,3                   PUT COUNT OF 3 IN REGISTER      31000020
AYS103   EX    RIC,COMPARE              SEARCH FOR CHARACTER STRING     31200020
         BE    AYS102                   EQUAL, STRING FOUND             31400020
         BCTR  RWRK,0                   BACK UP ONE CHARACTER           31600020
         BCT   RCNT,AYS103              BRANCH TO CHECK AGAIN           31800020
         B     AYS104                   STRING NOT FOUND                32000020
         SPACE 2                                                        32200020
*  THE FOLLOWING CODE DETERMINES IF THE CHARACTER STRING IS FOLLOWED    32400020
*  BY A CARRIAGE RETURN OR A NUMBER AND A CARRIAGE RETURN.              32600020
         SPACE 2                                                        32800020
AYS102   BCT   RCNT,AYS113              BRANCH IF CHARACTER STRING      33000020
*                                       IS NOT FIRST DATA IN BUFFER     33200020
         B     AYS114                   BRANCH IF CHARACTER STRING      33400020
*                                       IS FIRST IN BUFFER              33600020
AYS113   BCTR  RWRK,0                   POINT TO CHARACTER IN           33800020
*                                       FRONT OF STRING                 34000020
         CLI   0(RWRK),ZERO             IS THE CHARACTER 0              34200020
         BNE   AYS104                   NO, STRING INVALID              34400020
         LA    RWRK,1(RWRK)             READJUST POINTER TO STRING      34600020
AYS114   LA    RWRK,1(RIC,RWRK)         POINT TO CHARACTER AFTER        34800020
*                                       CHARACTER STRING                35000020
         LA    RCNT,PRFSUNIT            ADDR OF HDR PREFIX       S22029 35060022
         AH    RCNT,PRFSIZE             ADD DATA SIZE PLUS HDR   S22029 35120022
*                                       PREFIX SIZE              S22029 35180022
         CR    RCNT,RWRK                IS THIS END OF DATA             35240020
         BE    AYS105                   BRANCH ON YES                   35300020
         CLC   0(2,RWRK),LFCRTRN        IS IT LINE FEED RETURN          35360020
         BE    AYS126                   BRANCH ON YES                   35420020
         CLC   0(2,RWRK),CRTRNLF        IS IT RETURN LINE FEED          35480020
         BE    AYS126                   BRANCH ON YES                   35540020
         CLI   0(RWRK),CRGRTRN          IS IT A CARRAIGE RETURN         35600020
         BE    AYS127                   BRANCH ON YES                   35660020
         CLI   0(RWRK),NEWLINE          IS IT A NEW LINE                35720020
         BE    AYS127                   BRANCH ON YES                   35780020
         BCTR  RCNT,0                   REDUCE COUNT BY ONE             35840020
         CR    RCNT,RWRK                IS THIS END OF DATA             35900020
         BE    AYS123                   BEANCH ON YES                   35960020
         CLC   1(2,RWRK),LFCRTRN        IS IT LINE FEED RETURN          36020020
         BE    AYS128                   BRANCH ON YES                   36080020
         CLC   1(2,RWRK),CRTRNLF        IS IT RETURN LINE FEED          36140020
         BE    AYS128                   BRANCH ON YES                   36200020
         CLI   1(RWRK),CRGRTRN          IS IT A CARRIAGE RETURN         36260020
         BE    AYS129                   BRANCH ON YES                   36320020
         CLI   1(RWRK),NEWLINE          IS IT A NEW LINE                36380020
         BE    AYS129                   BRANCH ON YES                   36440020
         B     AYS104                   BRANCH, INVALID                 36500020
AYS126   BCTR  RCNT,0                   REDUCE COUNT BY ONE             36560020
AYS127   BCTR  RCNT,0                   REDUCE COUNT BY ONE             36620020
         CR    RCNT,RWRK                IS THIS LAST CHARACTER          36680020
         BE    AYS105                   BRANCH ON YES                   36740020
         B     AYS104                   BRANCH, INVALID                 36800020
AYS128   BCTR  RCNT,0                   REDUCE COUNT BY ONE             36860020
AYS129   BCTR  RCNT,0                   REDUCE COUNT BY ONE             36920020
         CR    RCNT,RWRK                IS THIS LAST CHARACTER          36980020
         BNE   AYS104                   BRANCH ON NO                    37040020
AYS123   CLI   0(RWRK),CHAR1            IS THIS CHARACTER '1' OR        37200020
*                                       GREATER                         37400020
         BL    AYS104                   NO, INVALID REQUEST             37600020
         CLI   0(RWRK),CHAR9            IS THIS CHARACTER '9' OR        37800020
*                                       SMALLER                         38000020
         BH    AYS104                   NO, INVALID REQUEST             38200020
         SPACE 2                                                        38400020
*  IF THE CHARACTER STRING WAS VALID, THE FOLLOWING CODE STORES THE     38600020
*  ATTENTION LEVEL (OR ZERO IF NO LEVEL SPECIFIED) IN THE SCB AND       38800020
*  RETURNS THE BUFFER TO THE BUFFER RETURN QUEUE.                       39000020
         SPACE 2                                                        39200020
*  AS OF RELEASE 21.0 TSO/TCAM, THE SIMULATED ATTENTION LEVEL     M0891 39400022
*  PASSED FROM IEDAYS TO TSO WILL BE IN THE HIGH-ORDER 4 BITS OF  M0891 39450022
*  SCBSALEV INSTEAD OF THE LOW ORDER 4. AVOIDS TCAM CLEARING LOW BIT    39500022
         SR    RCNT,RCNT                CLEAR WORK REG         @OZ27742 39550082
         SR    RIC,RIC                  CLEAR WORK REG         @OZ27742 39560082
         IC    RIC,AVTEZERO(,RWRK)      GET SIM ATTN LEVEL REQ @OZ27742 39570082
         SLL   RIC,FOUR                 MOVE TO BITS 0-3       @OZ27742 39580082
         IC    RCNT,SCBSALEV            SAVE BITS 4-7          @OZ27742 39590082
         OR    RIC,RCNT                 COMBINE TWO HALF-BYTES @OZ27742 39600082
         STC   RIC,SCBSALEV             STORE IN SCB           @OZ27742 39610082
         STC   RIC,SCBSALEV             STORE IN SCB              M0891 39700022
         B     AYS106                   BRANCH TO CONTINUE              39800020
AYS105   EQU   *                                               @OZ27742 40000082
         NI    SCBSALEV,LEVMASK         SET ATTN LEVEL TO ZERO @OZ27742 40010082
         B     AYS106                   BRANCH TO CONTINUE       S22028 40050022
AYS105A  EQU   *                                                 S22028 40100022
         OI    SCBSALEV,LEVEL1          SET ATTN LEVEL TO ONE  @OZ27742 40150082
AYS106   OI    SCBERR3,SCBSATTN         INDICATE SIMULATED ATTENTION    40200020
*                                       REQUESTED                       40400020
         TM    TSBSTAT,TSBDSPLY         IS TERMINAL A DISPLAY           40410020
         BZ    AYS110                   BRANCH ON NO                    40420020
         SR    RIC,RIC                  CLEAR REGISTER                  40450020
         SR    R14,R14                  CLEAR REGISTER                  40500020
         IC    RIC,TSBLNNO              GET NUMBER OF LINES ON SCREEN   40550020
         BCTR  RIC,0                    REDUCE BY ONE                   40560020
         IC    R14,QCBSATCT             GET NUMBER LINES ENTERED        40570020
         CR    R14,RIC                  NEXT TO LAST LINE        Y06327 40580005
         BL    AYS110                   BRANCH ON NO                    40590020
         OI    SCBSTATE,SCBERSDS        REQUEST SCREEN ERASURE   A44887 40592021
         NI    QCBTSOF1,MASKALL-QCBSATRD NO SIMATTN PROMPT NEEDED       40594020
AYS106A  EQU   *                                                        40595020
         NI    QCBRETCT,MASKALL-QCBNL   CLEAR FLAGS                     40596020
         MVI   QCBSATCT,0               CLEAR LINE COUNT                40598020
         MVI   QCBCARCT,0               CLEAR CARRIAGE COUNT            40598420
AYS110   LA    RWRK,AVTBFRTB            GET ADDRESS OF BUFFER RETURN    40600020
*                                       QUEUE CONTROL BLOCK             40800020
         IC    RCNT,SCBSTATE            SAVE FLAG BYTE                  40900020
         ST    RWRK,SCBDESTQ-1          STORE IN SCB DESTINATION        41000020
*                                       QUEUE POINTER TO RETURN BUFFER  41200020
         STC   RCNT,SCBSTATE            RESTORE FLAG BYTE               41300020
         B     AYS104                   RETURN                          41400020
         SPACE 2                                                        41600020
*  THE FOLLOWING CODE CHECKS TO SEE IF A CARRIAGE RETURN OR A NUMBER    41800020
*  AND A CARRIAGE RETURN ARE PRESENT IN DATA READ BY THE SIMULATED      42000020
*  ATTENTION CHANNEL PROGRAM.  A CHECK IS ALSO MADE TO DETERMINE IF     42200020
*  THE SIMULATED ATTENTION CHARACTER STRING WAS ENTERED.                42400020
         SPACE 2                                                        42600020
AYS107   EQU   *                                                        42800020
         TM    PRFSTAT1,PRFNHDRN       IS THIS HEADER BUFFER            42850020
         BO    AYS104                  BRANCH ON NO                     42900020
         NI    QCBTSOF1,MASKALL-QCBSATRD SET OFF SIMULATED ATTENTION    42950020
         NI    QCBTSOF2,MASKALL-QCBSIMRD     READ INDICATORS            43000020
         TM    TSBSTAT,TSBDSPLY         IS THIS A DISPLAY       SA60815 43200005
         BZ    AYS121                   BRANCH NO               SA60815 44200005
         SR    R14,R14                  CLEAR REGISTER                  45350020
         SR    RIC,RIC                  CLEAR REGISTER                  45400020
         IC    RIC,TSBLNNO              GET NUMBER OF LINES             45450020
         IC    R14,QCBSATCT             GET NUMBER LINES ENTERED        45500020
         BCTR  RIC,0                    REDUCE BY ONE                   45550020
         CR    R14,RIC                  LAST LINE                       45560020
         BL    AYS115H                  BRANCH ON NO                    45570020
         OI    SCBSTATE,SCBERSDS        REQUEST SCREEN ERASURE   A44887 45580021
         MVI   QCBSATCT,AVTEZERO        CLEAR LINE COUNT                45581020
         NI    QCBRETCT,MASKALL-QCBNL   RESET CARRIAGE FLAGS            45583020
         MVI   QCBCARCT,0               RESET CARRIAGE COUNT            45584000
         B     AYS115X                  CONTINUE PROCESSING      S22025 45586000
AYS115H  EQU   *                                                        45586800
         TM    AVTPARM3+1,DCT3270       IS THIS A 3270 TRM     @G36XRYP 45587600
         BZ    AYS115I                  NO, BRANCH               S22028 45588400
         LA    RWRK,PRFSHDR-IEDQPRF(RDATA) POINT TO DATA START   Y06327 45589200
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @OY18014 45589400
         BNO   AYS115HA                 NO, BRANCH             @OY18014 45589600
         TM    LCBSTAT5,LCBLUNIT        IS THIS A LU           @YM09070 45590000
         BO    AYS115Z                  YES, BRANCH            @YM09070 45590800
AYS115HA EQU   *                                               @OY18014 45591800
         CLI   AVTPARM3+2,DCTLOCAL      3270 LOCAL             @G36XRYP 45593000
         BO    AYS115Z                  YES, BRANCH              S22028 45593222
         LA    RWRK,TWO(RWRK)           SKIP PAST C.U. & DEV.    Y06327 45593305
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 45593400
         BO    AYS115R                  YES. BRANCH              Y06327 45593505
         LA    RWRK,ONEMORE(RWRK)       AND STX IF NOT 3705      Y06327 45593605
AYS115R  EQU   *                                                 Y06327 45593705
         TM    AVTPARM3,AUTOPL          IS THIS AUTOPOLL         S22028 45593822
         BZ    AYS115HH                 NO,BRANCH                S22028 45594022
         LA    RWRK,1(RWRK)             SKIP OVER INDEX BYTE     S22028 45594222
AYS115HH EQU   *                                                 S22028 45594422
         CLI   0(RWRK),ENTERAID         IS AID BYTE FOR ENTER KEYS22028 45594822
         BNE   AYS115Z                  NO, CHECK FOR CLEAR OR   S22028 45594922
*                                       PA1 AID BYTE             S22028 45595022
         CLI   3(RWRK),ENDTEXT          WAS ANY DATA ENTERED     S22028 45595122
         BE    AYS111                   IF NO, GO SET ATTN LEVEL S22028 45595222
*                                       TO ZERO                  S22028 45595322
AYS115Z  EQU   *                                                 S22028 45595422
         CLI   0(RWRK),CLEARAID         IS AID BYTE FOR CLEAR KEYS22028 45595522
         BE    AYS115G                  IF YES TREAT IT THE SAME S22028 45595622
*                                       AS IF THE CLEAR CHARACTERS22028 45595722
*                                       STRING WERE FOUND        S22028 45595822
         CLI   0(RWRK),PA1AID           IS AID BYTE FOR PA1 KEY  S22028 45596122
         BE    AYS124                   IF YES GO SET ATTN LEVEL S22028 45596222
*                                       TO ONE                   S22028 45596322
*  IF THE DEVICE IS A 3270 LOCAL AND THE AID BYTE IS NOT FOR THE S22028 45596422
*  CLEAR KEY OR THE PA1 KEY, THEN THE ENTER KEY MUST HAVE BEEN   S22028 45596522
*  DEPRESSED                                                     S22028 45596622
         CLI   PRFSIZE,TWENTY1          WAS ANY DATA ENTERED     S22028 45596722
         BE    AYS111                   IF NO, GO SET ATTN LEVEL S22028 45596822
*                                       TO ZERO                  S22028 45596922
AYS115I  EQU   *                                                 S22028 45597022
         L     RWRK,TSBERSDS            GET CLEAR STRING         S22028 45597122
         LTR   RWRK,RWRK                IS IT PRESENT                   45598020
         BZ    AYS115X                  BRANCH ON NO                    45598420
         LA    RCNT,4                   MAXIMUM CHAR COUNT              45598820
         LA    RWRK,TSBERSDS            POINT TO STRING                 45599220
AYS115A  EQU   *                                                        45599620
         CLI   0(RWRK),BLANK            IS IT A BLANK                   45599720
         BE    AYS115B                  BRANCH ON YES                   45599820
         LA    RWRK,1(RWRK)             BUMP TO NEXT                    45599920
         BCT   RCNT,AYS115A             BRANCH IF NOT ALL CHECKED       45619920
AYS115B  EQU   *                                                        45629920
         LA    RIC,3                    SET TO THREE                    45639920
         SR    RIC,RCNT                 CALCULATE NUMBER OF CHARS       45646620
         TM    AVTPARM3+1,DCT3270       IS THIS A 3270 TRM     @G36XRYP 45646900
         BZ    AYS115BA                 NO, CONTINUE             S22028 45647200
         LA    RWRK,PRFSHDR-IEDQPRF(RDATA) POINT TO DATA START   Y06327 45647500
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @OY18014 45647600
         BNO   AYS115BE                 NO, BRANCH             @OY18014 45647700
         TM    LCBSTAT5,LCBLUNIT        IS THIS A LU           @YM09070 45647800
         BO    AYS115BC                 YES,BRANCH             @YM09070 45648100
AYS115BE EQU   *                                               @OY18014 45648500
         TM    AVTPARM3+2,DCTLOCAL      IS THIS A 3270 LOCAL   @G36XRYP 45648900
         BZ    AYS115BD                 NO, MUST BE REMOTE       S22028 45649022
AYS115BC EQU   *                                                 S22028 45649122
         CLI   3(RWRK),SBACHAR          IS THIRD CHARACTER AN SBAS22028 45649222
         BNE   AYS115BB                 NO, GO SCAN CHAR STRING  S22028 45649322
         LA    RWRK,8(RWRK)             SKIP OVER THE SBA TO DATAS22028 45649822
         B     AYS115BB                 NOW GO SCAN CHAR STRING  S22028 45649922
AYS115BD EQU   *                                                 S22028 45650005
         LA    RWRK,TWO(RWRK)           SKIP PAST C.U. & DEV.    Y06327 45650105
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 45650200
         BO    AYS115S                  YES. BRANCH              Y06327 45650305
         LA    RWRK,ONEMORE(RWRK)       AND STX IF NOT 3705      Y06327 45650405
AYS115S  EQU   *                                                 Y06327 45650505
         TM    AVTPARM3,AUTOPL          IS THIS AUTOPOLL         S22028 45650605
         BZ    AYS115BC                 NO. BRANCH               S22028 45650705
         LA    RWRK,1(RWRK)             SKIP OVER INDEX BYTE     S22028 45650805
         B     AYS115BC                 GO CHECK FOR SBA         S22028 45651122
AYS115BA EQU   *                                                 S22028 45651422
         LA    RWRK,PRFSHDR-IEDQPRF+2(RDATA) POINT TO DATA START Y06327 45651705
AYS115BB EQU   *                                                 S22028 45652022
         LA    RCNT,3                   NUMBER OF TIMES TO CHECK S22028 45652322
AYS115C  EQU   *                                                        45652620
         EX    RIC,COMPAR2              LOOK FOR STRING                 45653020
         BE    AYS115D                  BRANCH WHEN FOUND               45653120
         BCTR  RWRK,0                   BACK UP ONE BYTE                45653220
         BCT   RCNT,AYS115C             BRANCH IF NOT ALL CHECKED       45669920
         B     AYS115X                  BRANCH IF CHAR STRING    S22025 45679922
*                                       NOT FOUND                S22025 45680922
AYS115D  EQU   *                                                        45681920
         BCT   RCNT,AYS115E             BRANCH IF NOT FIRST IN BUFF     45683920
         B     AYS115F                  BRANCH IF FIRST IN BUFFERS22025 45685922
AYS115E  EQU   *                                                        45686320
         BCTR  RWRK,0                   BACK UP ONE                     45686420
         CLI   0(RWRK),0                IS IT ZERO                      45686520
         BNE   AYS115X                  BRANCH ON NO                    45692120
         LA    RWRK,1(RWRK)             RESET POINTER                   45694120
AYS115F  LA    RWRK,1(RIC,RWRK)         POINT TO END OF DATA            45696120
         LA    RCNT,PRFSUNIT            ADDR OF HDR PREFIX       S22029 45696522
         AH    RCNT,PRFSIZE             ADD DATA SIZE PLUS HDR   S22029 45696722
*                                       PREFIX SIZE              S22029 45696922
         CR    RCNT,RWRK                END OF DATA                     45697420
         BE    AYS115G                  BRANCH ON YES                   45697520
         CLI   0(RWRK),CRGRTRN          IS IT CARRIAGE RETURN           45697620
         BE    AYS115G                  BRANCH ON YES                   45703220
         CLI   0(RWRK),NEWLINE          IS IT NEWLINE                   45703320
         BNE   AYS115X                  BRANCH ON NO                    45708120
AYS115G  EQU   *                                                        45708520
         OI    SCBSTATE,SCBERSDS        REQUEST SCREEN ERASURE   A44887 45708621
         B     AYS106A                  RETURN                   S22025 45711622
AYS115X  EQU   *                                                        45714920
         TM    AVTPARM3+1,DCT3270       IS THIS A 3270 TRM     @G36XRYP 45715900
         BZ    AYS121                   NO, BRANCH               S22028 45716900
         LA    RWRK,PRFSHDR-IEDQPRF(RDATA) POINT TO DATA START   Y06327 45717900
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @OY18014 45718200
         BNO   AYS115XD                 NO, BRANCH             @OY18014 45718500
         TM    LCBSTAT5,LCBLUNIT        IS THIS A LU           @YM09070 45718900
         BO    AYS115XA                 YES, BRANCH            @YM09070 45719900
AYS115XD EQU   *                                               @OY18014 45720900
         TM    AVTPARM3+2,DCTLOCAL      IS THIS A 3270 LOCAL   @G36XRYP 45722000
         BZ    AYS115XB                 NO, MUST BE REMOTE       S22028 45722222
AYS115XA EQU   *                                                 S22028 45722422
         CLI   0(RWRK),PA1AID           IS AID BYTE FOR PA1 KEY  S22028 45722622
         BE    AYS124                   YES, BRANCH              S22028 45722822
         CLI   0(RWRK),CLEARAID         IS AID BYTE FOR CLEAR KEYS22028 45723022
         BE    AYS115G                  YES, BRANCH              S22028 45723122
         CLI   0(RWRK),ENTERAID         IS AID BYTE FOR ENTER KEYS22028 45723422
         BNE   AYS111                   NO, BRANCH               S22028 45723622
         CLI   3(RWRK),SBACHAR          WAS ANY DATA ENTERED     S22028 45723822
         BNE   AYS111                   NO, BRANCH               S22028 45724022
         MVI   5(RWRK),ZERO             ZERO OUT THE CURSOR ADDR S22028 45724222
*                                       PRECEDING THE FIRST BYTE S22028 45724422
*                                       OF DATA SO IT WONT BE    S22028 45724622
*                                       MISTAKEN FOR DATA        S22028 45724822
         LA    RWRK,8(RWRK)             POINT TO FIRST BYTE      S22028 45725022
         B     AYS122                   GO SCAN FOR CHAR STRING  S22028 45725122
AYS115XB EQU   *                                                 S22028 45725222
         LA    RWRK,TWO(RWRK)           SKIP PAST C.U. & DEV.    Y06327 45725705
         TM    TRMSTATE,TRMPREF         IS THERE A PREFIX      @Y17XAYP 45726200
         BO    AYS115XC                 YES. BRANCH              Y06327 45726705
         LA    RWRK,ONEMORE(RWRK)       AND STX IF NOT 3705      Y06327 45727205
AYS115XC EQU   *                                                 Y06327 45727705
         TM    AVTPARM3,AUTOPL          IS THIS AUTOPOLL         S22028 45728205
         BZ    AYS115XA                 NO. BRANCH               S22028 45728705
         LA    RWRK,1(RWRK)             SKIP OVER INDEX BYTE     S22028 45729205
         B     AYS115XA                 GO CHECK FOR AID BYTE    S22028 45729705
AYS121   EQU   *                                                 S22029 45730205
         LA    RWRK,PRFSHDR-IEDQPRF+2(RDATA) POINT TO DATA START Y06327 45730705
AYS122   EQU   *                                                 S22028 45731205
         IC    RIC,TSBFLG2              GET CHARACTER COUNT             45731705
         N     RIC,CNTMASK              REMOVE EXTRANEOUS BITS          45732205
         LH    RCNT,PRFSIZE             GET DATA COUNT           S22029 45732705
         SH    RCNT,HDRPRFX             IS THERE ANY DATA        S22029 45733205
         BZ    AYS111                   BRANCH IF NO DATA               45780020
         LA    RCNT,3                   PUT COUNT OF THREE IN REGISTER  45800020
AYS109   L     R14,TSBATNCC             GET CHARACTER STRING            45900020
         LTR   R14,R14                  IS THERE ONE                    46000020
         BZ    AYS139                   BRANCH ON NO                    46100020
         EX    RIC,COMPARE              SEARCH FOR CHARACTER STRING     46200020
         BE    AYS117                   BRANCH WHEN FOUND               46300020
AYS139   CLI   0(RWRK),CHAR1            COULD THIS BE A NUMBER          46400020
         BL    AYS130                   BRANCH ON NO                    46500020
         CLI   0(RWRK),CHAR9            IS IT A NUMBER                  46600020
         BNH   AYS108                   BRANCH ON YES                   46700020
AYS130   BCTR  RWRK,0                   BACK UP ONE CHARACTER           46800020
         BCT   RCNT,AYS109              BRANCH IF NOT ALL CHECKED       46900020
         B     AYS111                   INVALID REQUEST                 47500020
         SPACE 2                                                        48200020
*  THE FOLLOWING  CODE DETERMINES IF A VALID NUMBER IS PRESENT IN       48400020
*  FRONT OF THE CARRIAGE RETURN.                                        48600020
         SPACE 2                                                        48800020
AYS108   BCT   RCNT,AYS137              BRANCH IF NUMBER NOT FIRST      48880020
*                                       DATA IN BUFFER                  48960020
         B     AYS138                   BRANCH IF FIRST                 49040020
AYS137   BCTR  RWRK,0                   BACK UP ONE CHARACTER           49120020
         LA    RCNT,1(RCNT)             RESET COUNTER                   49200020
         CLI   0(RWRK),ZERO             IS IT A ZERO                    49280020
         LA    RWRK,1(RWRK)             RESET POINTER                   49360020
         BNE   AYS130                   NO, RESUME CHECKING             49440020
AYS138   SR    RIC,RIC                  CLEAR REGISTER                  49520020
         LA    RCNT,PRFSUNIT            ADDR OF HDR PREFIX       S22029 49600022
         AH    RCNT,PRFSIZE             ADD DATA SIZE PLUS HDR   S22029 49680022
*                                       PREFIX SIZE              S22029 49760022
         BCTR  RCNT,ZERO                BACKUP ONE CHARACTER     S22029 49840022
         CR    RCNT,RWRK                IS THIS END OF DATA             49920020
         BE    AYS135                   BRANCH ON YES                   50000020
         B     AYS136                   BRANCH TO CHECK END CHAR        50080020
AYS120   CLI   0(RWRK),CHAR1            IS THE CHARACTER LESS           50200020
*                                       THAN '1'                        50400020
         BL    AYS124                   BRANCH ON YES                   50600020
         CLI   0(RWRK),CHAR9            IS THE CHARACTER GREATER        50800020
*                                       THAN '9'                        51000020
         BH    AYS124                   BRANCH ON YES                   51200020
         SPACE 2                                                        51400020
*  THE FOLLOWING CODE SETS THE ATTENTION LEVEL IN THE SCB TO REFLECT    51600020
*  THE LEVEL INDICATED BY THE NUMBER IN FRONT OF THE CARRIAGE RETURN.   51800020
         SPACE 2                                                        52000020
AYS135   EQU   *                                                  M0891 52200022
         SR    RCNT,RCNT                CLEAR WORK REG         @OZ27742 52300082
         SR    RIC,RIC                  CLEAR WORK REG         @OZ27742 52330082
         IC    RIC,AVTEZERO(,RWRK)      GET SIM ATTN LEVEL REQ @OZ27742 52360082
         SLL   RIC,FOUR                 MOVE TO BITS 0-3       @OZ27742 52390082
         IC    RCNT,SCBSALEV            SAVE BITS 4-7          @OZ27742 52420082
         OR    RIC,RCNT                 COMBINE TWO HALF-BYTES @OZ27742 52450082
         STC   RIC,SCBSALEV             STORE IN SCB           @OZ27742 52480082
AYS112   OI    SCBERR3,SCBSATTN         SET SIMULATED ATTENTION         52600020
*                                       REQUESTED                       52800020
         B     AYS110                   RETURN                          53000020
AYS111   EQU   *                                               @OZ27742 53200082
         NI    SCBSALEV,LEVMASK         SET ATTEN LEVEL TO ZERO@OZ27742 53250082
         B     AYS110                   BRANCH                          53400020
AYS117   BCT   RCNT,AYS118              BRANCH IF CHARACTER STRING      53600020
*                                       IS NOT FIRST DATA IN BUFFER     53800020
         B     AYS119                   BRANCH IF FIRST                 54000020
AYS118   BCTR  RWRK,0                   POINT TO CHARACTER IN FRONT     54200020
*                                       OF STRING                       54400020
         LA    RCNT,1(RCNT)             RESET COUNTER                   54500020
         CLI   0(RWRK),ZERO             IS THE CHARACTER 0              54600020
         LA    RWRK,1(RWRK)             READJUST POINTER                54700020
         BNE   AYS139                   RESUME CHECKING                 54900020
AYS119   LA    RWRK,1(RIC,RWRK)         POINT TO CHARACTER AFTER        55200020
*                                       CHARACTER STRING                55400020
         LA    RCNT,PRFSUNIT            ADDR OF HDR PREFIX       S22029 55460022
         AH    RCNT,PRFSIZE             ADD DATA SIZE PLUS HDR   S22029 55520022
*                                       PREFIX SIZE              S22029 55580022
         CR    RCNT,RWRK                IS THIS END OF DATA             55640020
         BE    AYS124                   BRANCH ON YES                   55700020
         CLC   0(2,RWRK),LFCRTRN        IS IT LINE FEED RETURN          55760020
         BE    AYS131                   BRANCH ON YES                   55820020
         CLC   0(2,RWRK),CRTRNLF        IS IT RETURN LINE FEED          55880020
         BE    AYS131                   BRANCH ON YES                   55940020
         CLI   0(RWRK),CRGRTRN          IS IT A CARRAIGE RETURN         56000020
         BE    AYS132                   BRANCH ON YES                   56060020
         CLI   0(RWRK),NEWLINE          IS IT A NEW LINE                56120020
         BE    AYS132                   BRANCH ON YES                   56180020
         BCTR  RCNT,0                   REDUCE COUNT BY ONE             56240020
         CR    RCNT,RWRK                IS THIS END OF DATA             56300020
         BE    AYS120                   BRANCH ON YES                   56360020
AYS136   CLC   1(2,RWRK),LFCRTRN        IS IT LINE FEED RETURN          56420020
         BE    AYS133                   BRANCH ON YES                   56480020
         CLC   1(2,RWRK),CRTRNLF        IS IT RETURN LINE FEED          56540020
         BE    AYS133                   BRANCH ON YES                   56600020
         CLI   1(RWRK),CRGRTRN          IS IT A CARRIAGE RETURN         56660020
         BE    AYS134                   BRANCH ON YES                   56720020
         CLI   1(RWRK),NEWLINE          IS IT A NEW LINE                56780020
         BE    AYS134                   BRANCH ON YES                   56840020
         B     AYS111                   BRANCH, INVALID                 56900020
AYS131   BCTR  RCNT,0                   REDUCE COUNT BY ONE             56960020
AYS132   BCTR  RCNT,0                   REDUCE COUNT BY ONE             57020020
         CR    RCNT,RWRK                IS THIS LAST CHARACTER          57080020
         BE    AYS120                   BRANCH ON YES                   57140020
         B     AYS111                   BRANCH, INVALID                 57200020
AYS133   BCTR  RCNT,0                   REDUCE COUNT BY ONE             57260020
AYS134   BCTR  RCNT,0                   REDUCE COUNT BY ONE             57320020
         CR    RCNT,RWRK                IS THIS LAST CHARACTER          57380020
         BE    AYS120                   BRANCH ON YES                   57440020
         B     AYS111                   BRANCH, INVALID                 57500020
AYS124   EQU   *                                                  M0891 57660022
         OI    SCBSALEV,LEVEL1          SET ATTN LEVEL TO ONE  @OZ27742 57690082
         B     AYS112                   BRANCH TO REQUEST ATTENTION     57720020
         SPACE 2                                                        57800020
AYS104   EQU   *                                                 S22025 58000022
         L     RIC,AVTUI                PICK UP RETURN ADDRESS   S22025 58100022
         B     FOUR(RIC)                RETURN TO CALLER         S22025 58200022
         EJECT                                                          58400005
*  THE FOLLOWING CODE DETERMINES IF SIMULATED ATTENTION BY LINE         58600020
*  COUNT HAS BEEN REQUESTED.                                            58800020
         SPACE 2                                                        59000020
         USING *,RBAS                                                   59200020
         USING AVTSAVE2,RSAV                                            59400020
AYS201   LR    RQCB,RTRM                GET ADDRESS OF QCB              59600020
         TM    QCBFLAG,QCBTSSES         IS THIS TIME SHARING SESSION    59660020
         BNO   AYS204                   BRANCH ON NO                    59720020
         LA    RWRK,AYS202              SET UP RETURN REG.      SA60815 59730005
*  THE FOLLOWING CODE TO AYS202 IS USED AS A SUBROUTINE BY IEDAYS0.     59740005
         SPACE                                                          59750005
AYSTSB   EQU   *                                                SA60815 59760005
         L     RTSB,CVTPTR              POINTER TO COM VECT TABLE       59800020
         USING CVT,RTSB                                                 60000020
         L     RTSB,CVTASVT             GET ASVT ADDRESS       @G36XRYP 60040000
         DROP  RTSB                                            @G36XRYP 60080000
         USING ASVT,RTSB                ASVT ADDRESSABILITY    @G36XRYP 60120000
         LA    RTSB,ASVTENTY            GET ASCB LIST ADDRESS  @ZM46782 60160000
         LH    R0,QCBTJID               GET ASID               @G36XRYP 60600000
         BCTR  R0,0                     REDUCE BY ONE                   60800020
         SLL   R0,2                     MULTIPLY BY 4          @G36XRYP 60820000
         AR    RTSB,R0                                         @G36XRYP 60840000
         L     RTSB,AVTEZERO(RTSB)      GET ASCB ADDRESS       @G36XRYP 60860000
         LTR   RTSB,RTSB                                       @G36XRYP 60880000
         BZR   RWRK                                            @G36XRYP 60900000
         DROP  RTSB                                            @G36XRYP 60920000
         USING ASCB,RTSB                ASCB ADDRESSABILITY    @G36XRYP 60940000
         L     RTSB,ASCBTSB             GET TSB ADDRESS        @G36XRYP 60960000
         DROP  RTSB                                            @G36XRYP 60980000
         B     FOUR(RWRK)               RTN +4 TSB IS VALID     SA60815 62440005
* * * *   E N D  O F  T S B  S U B R O U T I N E  * * * * * *   SA60815 62480005
AYS202   EQU   *                        ERROR RETURN TO TCAM    SA60815 62520005
         B     AYS204              RETURN TSO NOT ACTIVE        SA60815 62560005
         USING TSB,RTSB                                                 62600020
         SR    RWRK,RWRK                CLEAR REGISTER             2260 62800020
         TM    QCBTSOF2,QCBSATLC        IS SIMULATED ATTENTION BY LINE  63000020
*                                       COUNT REQUESTED                 63200020
         BNO   AYS205                   NO, BRANCH                 2260 63400020
         SPACE 2                                                        63600020
*  IF SIMULATED ATTENTION BY LINE COUNT HAS BEEN REQUESTED, THE COUNT   63800020
*  OF NEW LINE CHARACTERS IN THE QCB IS INCREMENTED BY ONE AND          64000020
*  COMPARED TO THE THRESHOLD COUNT IN THE TSB.                          64200020
         SPACE 2                                                        64400020
         TM    TSBFLG5,TSBKEYS          TSO SESSION MANAGER    @OZ24035 64450000
         BO    AYS205                   YES, BRANCH            @OZ24035 64500000
         IC    RWRK,QCBSATCT            PICK UP LINE COUNT              64600020
         LA    RWRK,1(RWRK)             INCREMENT LINE COUNT BY ONE     64800020
         STC   RWRK,QCBSATCT            STORE UPDATED VALUE             65000020
         CLC   QCBSATCT(1),TSBATNLC+1   HAS LINE COUNT REACHED          65200020
*                                       THRESHOLD                       65400020
         BNL   AYS206                   YES, BRANCH                2260 65600020
         SPACE 2                                                        65800020
*  A CHECK IS MADE TO DETERMINE IF THE TERMINAL IS A DISPLAY.  IF IT    66000020
*  IS AND THE NEXT TO LAST LINE OF THE DISPLAY CONTAINS DATA, A FLAG    66200020
*  REQUESTING A SIMULATED ATTENTION CHANNEL PROGRAM IS SET.             66400020
         SPACE 2                                                        66600020
AYS205   EQU   *                                                SA60815 66800005
         TM    TSBSTAT,TSBDSPLY         IS THIS DISPLAY SCREEN  SA60815 67800005
         BZ    AYS204                   BR NO. COUNT NOT REQ.   SA60815 68800005
         TM    TSBFLG5,TSBKEYS          TSO SESSION MANAGER    @OZ24035 68850000
         BO    AYS204                   YES, BRANCH            @OZ24035 68900000
         SR    RWRK,RWRK                CLEAR REGISTER           S21903 72200005
         IC    RWRK,QCBSATCT            PICK UP LINE COUNT              72400020
         TM    QCBTSOF2,QCBSATLC        HAS LINE COUNT BEEN UPDATED     72600020
         BO    AYS207                   YES, BRANCH                2260 72800020
         CLI   QCBSATCT,MASKALL         IS COUNT FOR ERASE              72850020
         BE    AYS204                   BRANCH ON YES                   72900020
         LA    RWRK,1(RWRK)             INCREMENT LINE COUNT       2260 73000020
         STC   RWRK,QCBSATCT            STORE UPDATED VALUE        2260 73200020
AYS207   SR    RIC,RIC                  CLEAR REGISTER             2260 73400020
         IC    RIC,TSBLNNO              GET NUMBER OF LINES ON     2260 73600020
*                                       DISPLAY SCREEN             2260 73800020
         BCTR  RIC,0                    REDUCE BY ONE              2260 74000020
         CR    RWRK,RIC                 IS NUMBER OF LINES         2260 74200020
*                                       DISPLAYED EQUAL TO NUMBER  2260 74400020
*                                       OF LINES ON DISPLAY - 1    2260 74600020
         BL    AYS204                   NO, RETURN                 2260 74800020
         MVI   QCBSATCT,MASKALL         SET COUNT FOR ERASE             74840020
         OI    QCBTSOF1,QCBSATRD        REQUEST SIMATTN READ            74920020
         B     AYS204                   RETURN                          74960020
         SPACE 2                                                        75000020
*  IF THE NUMBER OF LINES SPECIFIED FOR A SIMULATED ATTENTION HAS       75200020
*  BEEN REACHED, A FLAG REQUESTING A SIMULATED ATTENTION CHANNEL        75400020
*  PROGRAM IS SET IN THE QCB AND THE LINE COUNT IN THE QCB IS ZEROED.   75600020
         SPACE 2                                                        75800020
AYS206   OI    QCBTSOF1,QCBSATRD        REQUEST SIMULATED ATTENTION     76000020
*                                       CHANNEL PROGRAM                 76200020
         MVI   QCBSATCT,ZERO            ZERO LINE COUNT                 76400020
AYS204   LM    14,12,AVTSAVE3-AVTSAVE2+12(13) RESTORE REGS              76600020
         BR    R14                      RETURN TO CALLER                76800020
         EJECT                                                          77000005
*  THE FOLLOWING ROUTINE GAINS CONTROL FROM THE TCAM DISPATCHER WHEN    77200020
*  A QCB IS REMOVED FROM THE TIME DELAY QUEUE.  A SIMULATED ATTENTION   77400020
*  READ IS REQUESTED AND THE LCB IS POSTED TO ITSELF.                   77600020
         SPACE 2                                                        77800020
AYSAYS3  BALR  RBAS,0                   LOAD BASE REGISTER              78000020
         USING *,RBAS                                                   78200020
         USING IEDQDISP,RDSP                                     Y06327 78300005
         LA    RQCB,0(R1)               GET ADDRESS OF QCB POSTED       78400020
         NI    QCBTSOF2,AVTEFF-QCBPOSTO RESET POSTED FLAG      @YA11170 78420058
         TM    AVTBIT3,AVTTSAB          TSO ABENDED              A44022 78450022
         BNO   NOABEND                  BRANCH NO ABEND          A44022 78480022
         NI    QCBTSOF1,AVTEFF-QCBDELAY TURN OFF DELAY BIT       A44022 78510022
         B     AYS401                   TO POST QCB              A44022 78540022
NOABEND  EQU   *                                                 A44022 78570022
         TM    QCBTSOF1,QCBDISC         IS USER LOGGING OFF     SA57345 78580000
         BO    AYS401                   BR YES TO POST QCB      SA57345 78590000
         NI    QCBTSOF2,AVTEFF-QCBPOSTO INDICATE QCB           @G36XRYP 78593000
*                                       CAN BE POSTED NOW      @G36XRYP 78596000
         TM    QCBTSOF2,QCBSATTI        IS SIMULATED ATTENTION BY       78600020
*                                       TIME DELAY REQUESTED            78800020
         BNO   DSPDISP                  NO, RETURN TO DISPATCH          79000020
         TM    QCBTSOF1,QCBTPUT         TPUT REQUESTED         @YA11170 79010058
         BO    AYS401                   BRANCH YES             @YA11170 79080058
         OI    QCBTSOF1,QCBSATRD        REQUEST SIMULATED ATTN READ     79160020
AYS401   IC    RWRK,QCBDSFLG            SAVE QCB FLAGS                  82500020
         ST    RQCB,QCBELCHN-1          QCB POSTED TO ITSELF            82600020
         STC   RWRK,QCBDSFLG            RESTORE QCB FLAGS               82700020
         MVI   QCBPRI,PRIORITY          SET POSTING PRIORITY            82750020
         OI    QCBTSOF2,QCBPOSTO        SET QCB POSTED TO ITSELF        82800020
         LR    R1,RQCB                  ELEMENT TO BE POSTED            83000020
         BAL   R14,DSPPOST              BRANCH TO DISPATCHER   @Y17XAYX 83100000
         SPACE 2                                                        83400020
*  EXECUTED INSTRUCTIONS.                                               83600020
         SPACE 2                                                        83800020
COMPARE  CLC   TSBATNCC(0),0(RWRK)      COMPARE CHAR CONSTANT TO DATA   84000020
COMPAR2  CLC   TSBERSDS(0),0(RWRK)      COMPARE DATA TO ERASE    S22025 84200022
*                                       CHARACTERS               S22025 84300022
         SPACE 2                                                        91000020
*  CONSTANTS.                                                           91200020
         SPACE 2                                                        91400020
CNTMASK  DC    F'3'                     REMOVE ALL BITS BUT 30,31       91600020
AYSLCBOF DC    AL2(LCBFLAG1-IEDQLCB)    OFFSET FROM LCB TO IOB   S22025 92200022
HDRPRFX  DC    H'30'                    SIZE OF LHEADER PREFIX   S22029 92300022
LFCRTRN  DC    X'250D'                  LINE FEED/CARRIAGE RETURNS22025 92400022
CRTRNLF  DC    X'0D25'                  CARRIAGE RETURN/LINE FEEDS22025 92500022
*                                       IN EBCDIC                S22025 92600022
CVT      DSECT                                                          93000020
         CVT                                                            93200020
         IHAASCB                                                        93260000
         IHAASVT                                                        93320000
         IKJTSB                                                         93600020
         TDCTD                                                          93900000
         TLCBD                                                          94000020
         TSCBD                                                          94200020
         TSIBD                                                          94400000
         TAVTD                                                          94600020
         TQCBD                                                          94800020
         TTRMD                                                          95200020
         TPRFD                                                          95400020
         TDISPD                                                         95600020
         DCBD  DSORG=TX                                                 95800020
         TTSID                                                          96000020
         TLGBD                                                          96060005
         END                                                            96200020
