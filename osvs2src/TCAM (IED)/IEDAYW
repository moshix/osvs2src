         TITLE 'IEDAYW - OUTPUT EDIT ROUTINE FOR 270X TERMINALS'        00050005
IEDAYW   CSECT                                                          00100005
         SPACE 3                                                        00100154
* CHANGE ACTIVITY AS FOLLOWS:                                           00100254
******************* MICROFICHE FLAGS ************************ SUPT CODE 00100354
*D374000-374500,381000-381500                                   SA67757 00100454
*A376000,382500                                                 SA67757 00100554
*C726500                                                       @SA69640 00100658
* C369500                                                      @YA08091 00100758
* D109000,838500-839000,841500,845500                          @YA08091 00100858
*C179500                                                       @YA08763 00100958
*A087000,309000,487500                                         @SA74058 00101058
*A179700                                                       @YA09113 00101158
*C145500                                                       @SA74875 00101258
*A156000                                                       @SA74875 00101358
*D369000-370000,377500-383000                                  @YA10216 00101458
*A826500                                                       @SA75159 00101558
*A191500                                                       @YA11153 00101658
*A179700                                                       @OZ07091 00101758
*D099000-100500,101500                                         @Y17XAYP 00110700
*A692500                                                       @G36XRYP 00111600
*C117500,122500,125000,140500,144000,166000,180000,204000      @G36XRYP 00112500
*C209000,217500,221000,259000,313000,314000,340500,341500      @G36XRYP 00113400
*C395000,396000,454500,455500,459000,520500,521500,533000      @G36XRYP 00114300
*C534000,554000,570500,571500,572500,575000,585000,594500      @G36XRYP 00115200
*C601500,607000,609000,611500,612500,630500,633500,639500      @G36XRYP 00116100
*C642000,658000,664500,665500,673500,728000,729000,733500      @G36XRYP 00117000
*C768000                                                       @G36XRYP 00117900
*D096000-098000,693000,838000                                  @G36XRYP 00118800
*A470500,471000                                                @OS78322 00119200
*C395500,418000                                                @OS78322 00119600
*D409500-412000                                                @OS78322 00120000
* $01=OZ41221  JTC2202  79.10.14  547784:                          @01A 00120212
* $11=OZ45196  ETC2302  80.04.09  076195:                          @11A 00120326
* $12=OZ47889  ETC2302  80.08.21  723465:                          @12A 00120426
***************** DEVELOPEMENT **************************************** 00120558
         SPACE 3                                                        00150058
*********************************************************************** 00200058
*                                                                     * 00250005
*  $MOD(IEDAYW) COMP(Y@) PROD(TCAM):                               @01C 00300012
*                                                                     * 00350005
*  DESCRIPTIVE NAME = OUTPUT EDIT ROUTINE FOR TSO                     * 00400005
*                                                                     * 00450005
* COPYRIGHT = 'NONE'                                                  * 00500000
*                                                                     * 00550005
* STATUS = VERSION 10.0                                        @G36XRYP 00600000
*                                                                     * 00650005
*FUNCTION -- THE TIOC EDIT ROUTINE INSPECTS AND EDITS OUTPUT MESSAGES * 00700005
*   CONTAINED IN TSO BUFFERS AND MSGGEN MESSAGES IN THE SCB FOR TERM- * 00750005
*   INALS CONNTECTED TO 270X CONTROL UNITS, EXCEPT FOR 3270'S. EDITED * 00800005
*   TSO MESSAGES ARE MOVED TO TCAM BUFFERS TO BE SENT.  MSGGEN MES-   * 00850005
*   SAGES REMAIN IN THE SCB.  THE EDIT SCAN IS BASED ON THE LINE SIZE,* 00900005
*   THE RECEIVING BUFFER SIZE, AND THE PRESENCE OF NEW LINE CHAR-     * 00950005
*   ACTERS IN THE MESSAGE.  THE LINE SIZE FOR TSO MESSAGES IS SPECI-  * 01000005
*   FIED BY THE USER IN THE TERMINAL STATUS BLOCK.  FOR MSGGEN MES-   * 01050005
*   SAGES, IT IS 120 BYTES.  IF THE MAXIMUM LINE SIZE IS REACHED,     * 01100005
*   A NEW LINE CHARACTER AND THE APPROPRIATE NUMBER OF IDLE CHAR-     * 01150005
*   ACTERS ARE INSERTED INTO THE BUFFER TO AVOID OVERPRINTING THE     * 01200005
*   LINE AT THE TERMINAL.  THE TCAM BUFFER SIZE MAY NOT BE EXCEEDED.  * 01250005
*   IF THE ENTIRE TCAM BUFFER IS FILLED BEFORE REACHING THE LINE SIZE * 01300005
*   OR A NEW LINE CHARACTER, THE EDIT IS TERMINATED, AND ONLY A PAR-  * 01350005
*   TIAL LINE IS SENT.  THE PRESENCE OF A NEW LINE CHARACTER IN THE   * 01400005
*   BUFFER SIGNIFIES THE END OF A COMPLETE LINE.  AT THE END OF A     * 01450005
*   LINE OR A MESSAGE, THIS ROUTINE FIRST CHECKS TO SEE IF SIMULATED  * 01500005
*   ATTENTION BY LINE COUNT WAS REQUESTED.  IF IT WAS, THIS ROUTINE   * 01550005
*   LINKS TO THE SIMULATED ATTENTION ROUTINE (IEDAYS) TO UPDATE THE   * 01600005
*   QCB SIMULATED ATTENTION LINE COUNT, AND TO REQUEST A SIMULATED    * 01650005
*   ATTENTION READ IF THE THRESHOLD IS REACHED.  NEXT, THIS ROUTINE   * 01700005
*   CHECKS TO SEE IF THE MESSAGE IS A CONTROL OR "AS IS" MESSAGE.     * 01750005
*   THESE MESSAGES CANNOT CONTAIN STANDARD LINE AND CARRIAGE CONTROL  * 01800005
*   CHARACTERS.  FOR THESE MESSAGES, THIS ROUTINE REPLACES ANY IN-    * 01850005
*   VALID CHARACTERS (EOT, NEW LINE, TAB, ETC.) WITH A COLON TO AVOID * 01900005
*   PROGRAM-CAUSED I/O ERRORS.  IN ADDITION TO INSERTING NEW LINE AND * 01950005
*   IDLE CHARACTERS, AND REPLACING INVALID CHARACTERS, THIS ROUTINE   * 02000005
*   INSERTS ANY OTHER LINE CONTROL CHARACTERS (E.G. STX, ETX) AND     * 02050005
*   CARRIAGE CONTROL CHARACTERS (E.G. LINE FEED CHARACTER) REQUIRED   * 02100005
*   TO EDIT THE MESSAGE FOR OUTPUT TO A PARTICULAR TERMINAL.  WHEN    * 02150005
*   THE TCAM BUFFER IS READY TO BE SENT, THIS ROUTINE ISSUES THE QTIP * 02200005
*   SVC (SVC 101) TO UPDATE THE OFFSET AND LENGTH FIELDS IN THE TIME  * 02250005
*   SHARING BUFFER PREFIX.  IF THE TCAM BUFFER ACCOMMODATED THE EN-   * 02300005
*   TIRE TSO BUFFER, THE PREFIX IS MARKED EDITED IN FULL.  OTHERWISE, * 02350005
*   THE OFFSET INDICATES THE POINT IN THE TSO BUFFER TO START EDITING * 02400005
*   ON THE NEXT ENTRY TO THIS ROUTINE, AND THE LENGTH INDICATES THE   * 02450005
*   LENGTH OF THE DATA YET TO BE EDITED.  ON RETURN TO THE CALLING    * 02500005
*   ROUTINE, THIS ROUTINE SETS A RETURN CODE INDICATING THE STATUS OF * 02550005
*   THE EDIT REQUEST.                                                 * 02600005
*                                                                     * 02650005
*ENTRY POINT -- IEDAYW TO EDIT A 270X CONNTECTED OUTPUT MESSAGE       * 02700005
*                                                                     * 02750005
*    CALLING SEQUENCE                                                 * 02800005
*          L    R15,AVTTSOPT                                          * 02850005
*          L    R15,TSI270X-IEDQTSI(,R15)                             * 02900005
*          BR   R15                                                   * 02950005
*                                                                     * 03000005
*INPUT -- IEDAYW IS CALLED BY THE TIOC OUTPUT EDIT CONTROL ROUTINE TO * 03050005
*   EDIT TSO MESSAGES FOR TERMINALS CONNTECTED TO TSO THROUGH A 270X  * 03100005
*   UNIT, WITH THE FOLLOWING REGISTERS SET:                           * 03150005
*   R4  HAS THE LCB ADDRESS                                           * 03200005
*   R6  HAS THE TIME SHARING BUFFER ADDRESS ( IN THE TSO REGION) OR   * 03250005
*       THE MSGGEN DATA ADDRESS                                       * 03300005
*   R7  HAS THE TCAM BUFFER ADDRESS OR THE ADDRESS OF THE RECEIVING   * 03350005
*       AREA IN THE SCB                                               * 03400005
*   R11 HAS THE ADDRESS OF AVTSAVE4 (GMAIN)                           * 03450005
*   R13  HAS THE ADDRESS OF AVTSAVE2                                  * 03500005
*   R15 HAS THE ENTRY POINT ADDRESS OF IEDAYW                         * 03550005
*                                                                     * 03600005
*   IEDAYW IS CALLED BY THE TIOC OUTPUT EDIT CONTROL ROUTINE (IEDAYE) * 03650005
*   TO EDIT MSGGEN MESSAGES, WITH THE FOLLOWING REGISTERS SET.        * 03700005
*   R0 HAS THE LENGTH OF THE DATA AREA IN THE SCB                     * 03750005
*   R1 HAS THE ADDRESS OF THE RECEIVING AREA IN THE SCB               * 03800005
*   R2 HAS THE MESSAGE ADDRESS                                        * 03850005
*   R3 HAS THE SCB ADDRESS                                            * 03900005
*   R4 HAS THE LCB ADDRESS                                            * 03950005
*   R11 HAS THE DISPATCHER ADDRESS                                    * 04000005
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 04050005
*   R14 HAS THE RETURN ADDRESS IN IEDAYM                              * 04100005
*   R15 HAS THE ENTRY POINT ADDRESS                                   * 04150005
*                                                                     * 04200005
*OUTPUT -- ON RETURN TO THE CALLING ROUTINE AFTER FINISHING THE EDIT  * 04250005
*   THE MESSAGE IS IN EDITED FORM, THE QCB CARRAIGE POSITION COUNT IS * 04300005
*   UPDATED, AND THE FOLLOWING REGISTERS ARE SET:                     * 04350005
*   R1  HAS THE LENGTH OF THE DATA MOVED                              * 04400005
*   R5  HAS THE DESTINATION QCB ADDRESS                               * 04450005
*   R14 HAS THE RETURN ADDRESS                                        * 04500005
*   R15 HAS ONE OF THE FOLLOWING RETURN CODES:                        * 04550005
*        X'00' = SUCCESSFUL COMPLETION                                * 04600005
*        X'0C' = PARTIAL LINE MOVED                                   * 04650005
*        X'10' = END OF LINE REACHED                                  * 04700005
*                                                                     * 04750005
*EXTERNAL ROUTINES -- IEDQTNT - TO GET THE TERMINAL ENTRY FROM THE    * 04800005
*   LCB TERMINAL INDEX OR LINE ENTRY, OR FROM THE INVITATION LIST FOR * 04850005
*   THE LINE.                                                         * 04900005
*   IEDAYS - TO HANDLE REQUESTS FOR SIMULATED ATTENTION BY LINE COUNT * 04950005
*   QTIP SVC ROUTINE - TO UPDATE THE TIME SHARING BUFFER PREFIX       * 05000005
*                                                                     * 05050005
*EXITS-NORMAL -- TO THE TSOUTPUT ROUTINE                              * 05100005
*   TO THE TSO MESSAGE GENERATION ROUTINE                             * 05150005
*                                                                     * 05200005
*EXITS-ERROR -- NONE                                                  * 05250005
*                                                                     * 05300005
*TABLES/WORKAREAS -- CVT, TSCVT, AVT, TSB, QCB, TSID, LCB, SCB, DCB,  * 05350005
*   TERMINAL ENTRY, TCAM BUFFER PREFIX, TSO BUFFER PREFIX.            * 05400005
*                                                                     * 05450005
*ATTRIBUTES -- SERIALLY REUSABLE, REFRESHABLE, ENABLED, RESIDENT,     * 05500005
*   PROBLEM PROGRAM MODE.                                             * 05550005
*                                                                     * 05600005
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 05650005
*   PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER SET. * 05700005
*      THE MESSAGE PROVIDED FROM THE TSO MESSAGE GENERATION ROUTINE   * 05750005
*   MAY BE A MSGGEN MESSAGE, A SIMULATED ATTENTION MESSAGE, AN AUTO-  * 05800005
*   MATIC LINE NUMBERING MESSAGE, OR A PROMPT MESSAGE.  THIS ROUTINE  * 05850005
*   PROCESSES THEM IDENTICALLY.                                       * 05900005
*                                                                     * 05950005
*********************************************************************** 06000005
         SPACE                                                          06050005
* * * * *     R E G I S T E R  E Q U A T E S  * * * * * * * *           06100005
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             06150005
R0       EQU   0                        REGISTER 0                      06200005
RPARM    EQU   1                        REGISTER 1                      06250005
RPARM2   EQU   2                        REGISTER 2                      06300005
RNDX     EQU   1                        REGISTER 1                      06350005
RTIOC    EQU   2                        TSO BUFFER                      06400005
RBASEDIT EQU   3                        BASE REG FOR EDIT SUBROUTINE    06450005
RLCB     EQU   4                        LCB                             06500005
RQCB     EQU   5                        QCB                             06550005
RTSBUF   EQU   6                        TSO BUFFER ADDRESS              06600005
RTCBUF   EQU   7                        TCAM BUFFER ADDRESS             06650005
RTSB     EQU   8                        TSB                             06700005
RTEMP    EQU   8                        RTEMP/RTEMPA MUST BE EVN/ODD PR 06750005
RTEMPA   EQU   9                        WORK REGISTER                   06800005
RDCB     EQU   10                       DCB                             06850005
RMAIN    EQU   11                       SAVE AREA                       06900005
RBASE    EQU   12                       BASE REGISTER                   06950005
RAVT     EQU   13                       AVT SAVE AREA                   07000005
RLINK    EQU   14                       LINK REGISTER                   07050005
RRTN     EQU   15                       RETURN REGISTER                 07100005
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * *             07150005
         SPACE                                                          07200005
* * * * * * * * *  M I S C E L L A N E O U S  E Q U A T E S  * * * *    07250005
ZERO     EQU   0                        ZERO                            07300005
ONE      EQU   1                        ONE                             07350005
TWO      EQU   2                        TWO                             07400005
THREE    EQU   3                        THREE                           07450005
FOUR     EQU   4                        FOUR                            07500005
FIVE     EQU   5                        FIVE                            07550005
EIGHT    EQU   8                        EIGHT                           07600005
TWELVE   EQU   12                       TWELVE                          07650005
THIRTEEN EQU   13                       THIRTEEN                        07700005
FOURTEEN EQU   14                       FOURTEEN                        07750005
FIFTEEN  EQU   15                       FIFTEEN                         07800005
SIXTEEN  EQU   16                       SIXTEEN                         07850005
THIRTY2  EQU   32                       THIRTY TWO                      07900005
E3       EQU   3                        THREE                           07950005
E11      EQU   11                       ELEVEN                          08000005
E12      EQU   12                       TWELVE                          08050005
E16      EQU   16                       SIXTEEN                         08100005
E20      EQU   20                       TWENTY                          08150005
E24      EQU   24                       TWENTY FOUR                     08200005
E28      EQU   28                       TWENTY EIGHT                    08250005
E32      EQU   32                       THIRTY TWO                      08300005
E40      EQU   40                       FORTY                           08350005
E44      EQU   X'44'                    DISP TO BUFFER ADDR.            08400005
E52      EQU   52                       FIFTY TWO                       08450005
E80      EQU   80                       2260 REMOTE DEFAULT LINE SIZE   08500005
E120     EQU   120                      1050/2741 DEFAULT LINE SIZE     08550005
RC0      EQU   0                        RETURN CODE 0                   08600005
RC12     EQU   12                       RETURN CODE X'C'                08650005
RC16     EQU   16                       RETURN CODE X'10'               08700005
RC44     EQU   44                       RET.CODE, NO DATA TSBUF@SA74058 08720058
X2741    EQU   0                        SETTINGS FOR 'DEVICE'           08750005
X2260R   EQU   8                        DITTO                           08800005
X2260L   EQU   12                       DITTO                           08850005
XTWX     EQU   16                       DITTO                           08900005
CR       EQU   X'0D'                    CARR RTN                        08950005
LF       EQU   X'25'                    TTY LINE FEED                   09000005
NLCHAR   EQU   X'15'                    NEW LINE                        09050005
IDLECHAR EQU   X'17'                    IDLE                            09100005
BYP      EQU   X'24'                    BYPASS CHAR                     09150005
RES      EQU   X'14'                    RESTORE CHAR                    09200005
HTAB     EQU   X'05'                    HORIZ TAB                       09250005
EOT      EQU   X'37'                    CIRCLE C                        09300005
EOB      EQU   X'26'                    CIRCLE B                        09350005
BSP      EQU   X'16'                    BACKSPACE                       09400005
PRE      EQU   X'27'                    PREFIX                          09450005
UC       EQU   X'36'                    UPPER CASE                      09500005
LC       EQU   X'06'                    DOWN SHIFT                      09550005
STX      EQU   X'02'                    STX                             09850005
ETX      EQU   X'03'                    ETX                             09900005
QCBDEND  EQU   8                        QCB FLAG                        10100005
NOT      EQU   X'FF'                    ALL BITS                        10200005
IDLES    EQU   X'F0'                    IDLES INDICATOR                 10250005
FIVEIDLS EQU   X'F5'                    FIVE IDLES                      10300005
MAXIDLES EQU   X'FC'                    MAXIMUM IDLES                   10350005
NEEDBOTH EQU   X'E2'                    NEED BOTH LF AND CR             10400005
NEEDLF   EQU   X'C2'                    NEED LINE FEED                  10450005
COLON    EQU   C':'                     COLON                           10500005
         SPACE                                                          10550005
* * * * * *  A D D R E S S A B I L I T Y  * * * * * * * *               10600005
         USING IEDAYW,RBASE             ESTABLISH ADDRESSABILITY        10650005
         USING AVTSAVE2,RAVT            ESTABLISH SAVE AREA             10700005
         USING IEDQQCB,RQCB             ESTABLISH QCB ADDRESS           10750005
         USING EDIT,RBASEDIT             ESTABLISH ADDRESSABILITY       10800005
         USING IEDQLCB,RLCB             ESTABLISH LCB ADDRESS           10850005
         USING TIOCBUF,RTIOC            TSO BUFFER DSECT                10950005
         USING TSBUFR,RMAIN             SAVE AREA ADDRESS               11000005
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         11050005
         SPACE                                                          11100005
         LR    RBASE,RRTN               SET BASE REGISTER               11150005
         L     RBASEDIT,VEDIT           PICK UP VCON                    11200005
IEDAYW   IEDHJN AYW00020                MODIFICATION DATE               11250005
         TM    WFLGS,TSOASIS+CONTROLM   IS THIS ASIS CONTROL            11300005
         BNO   AYE0000                  NO, CONTINUE                    11350005
         NI    WFLGS,NOT-CONTROLM       TURN OFF CONTROL MODE           11400005
AYE0000  EQU   *                                                        11450005
         SPACE                                                          11500005
         LTR   RTSBUF,RTSBUF            SEE IF ENTRY TO SEND IDLES      11550005
         BNZ   CHKTYP                   NO.                             11600005
         TM    WFLGS,TSOMSG             TPUT SEND IDLES HERE            11650005
         BZ    CHKTYP                   BRANCH NO                       11700005
         TM    AVTPARM3+THREE,DCTNOIDL  IS THIS 2260 REMOTE    @G36XRYP 11750000
         BZ    AYW00030                 NO, BRANCH                      11800005
         BAL   RLINK,INSTX              IF SO ADD STX                   11850005
AYW00030 EQU   *                                                        11900005
         TM    QCBRETCT,QCBNL           IF BOTH BITS OFF AND            11950005
         BNZ   AYW00040                 CARR COUTN = LINESIZE           12000005
         LA    RLINK,AYW00040           IS INDIC OF ENTRY TO            12050005
         CLC   QCBCARCT,LINESV+ONE      RETURN CARRIAGE AFTER           12100005
         BE    INSNL                    TCLEARQ (OUTPUT)                12150005
AYW00040 EQU   *                                                        12200005
         TM    AVTPARM3+THREE,DCTNOIDL  CHECK FOR 2260 REMOTE  @G36XRYP 12250000
         BZ    AYW00050                 BRANCH NOT ZERO                 12300005
         BAL   RLINK,INSETX             ADD ETX FOR REMOTE              12350005
         B     AYW00070                 SUCCESSFUL COMPLETION           12400005
AYW00050 EQU   *                                                        12450005
         TM    AVTPARM3+TWO,DCTTWX      IDLES FOR TWX ?        @G36XRYP 12500000
         BZ    AYW00060                 NO, BRANCH                      12550005
         LA    RTEMPA,ONE               AVOID RETURN COUNT OF 0         12600005
         BAL   RLINK,NOROUND            IMBEDDED IN SNDIDLES            12650005
         B     AYW00070                 SUCCESSFUL COMPLETION           12700005
AYW00060 EQU   *                                                        12750005
         BAL   RLINK,SNDIDLES           SEND IDLES,CLR OR UPDATE CARCT  12800005
         SPACE                                                          12850005
AYW00070 EQU   *                                                        12900005
         LA    RRTN,RC0                 SUCCESS RETURN CODE             12950005
         B     EXIT                     EXIT                            13000005
         SPACE                                                          13050005
AYW00080 EQU   *                                                        13100005
         LA    RRTN,RC16                END OF LINE RETURN CODE         13150005
         B     EXIT                     EXIT                            13200005
         SPACE                                                          13250005
AYW00090 EQU   *                                                        13300005
         LA    RRTN,RC12                INCOMPLETE MOVE RETURN CODE     13350005
         SPACE                                                          13400005
EXIT     EQU   *                                                        13450005
         MVC   QCBCARCT,CARCT+ONE       UPDATE CARRIAGE POSITION COUNT  13500005
         MVC   E20(E12,RAVT),TOR        SAVE CONTENTS OF RTN REGS       13550005
         ST    RRTN,E16(RAVT)           SAVE RETURN CODE FOR 15         13600005
         RETURN (14,12)                                                 13650005
         SPACE 2                                                        13700005
CHKTYP   EQU   *                                                        13750005
         TM    WFLGS,TSOMSG             TSO OR MSGGEN                   13800005
         BO    SENDTSO                  TSO                             13850005
         NI    QCBRETCT,NOT-QCBDEND-QCBIEND  SPECIAL OUTPUT FLAGS OFF   13900005
         IC    RLINK,MSGLEN+ONE         SIZE IN SCB                     13950005
         STC   RLINK,WBUFSZ+ONE        IS TCAM BFR SIZE                 14000000
         TM    AVTPARM3+THREE,DCTNOIDL  IS THIS 2260 REMOTE    @G36XRYP 14050000
         BZ    CHK00                    BRANCH NO.                      14100005
         BAL   RLINK,INSTX              YES. BEGIN WITH STX             14150005
CHK00    EQU   *                                                        14200005
         LTR   RTSBUF,RTSBUF            ENTRY FOR LEFT ADJUSTMENT?      14250005
         BNZ   DATA                     BRANCH NO                       14300005
*  ENTRY IS TO RETURN CARRIAGE. SEE IF IT NEEDS TO BE RETURNED.         14350005
         TM    AVTPARM3+TWO,DCTTWX      IS THIS A TWX LINE     @G36XRYP 14400000
         BZ    CHK02                    NO. CONTINUE                    14450005
         TM    QCBRETCT,QCBCR+QCBLF     CHECK FOR BOTH SEND             14500005
         BNZ   CHKWHICH                 YES, DETERMINE WHICH   @SA74875 14550058
*                                       WAS SENT               @SA74875 14557058
         TM    WFLGS,TSOMSG             TSO OR MSGGEN          @SA74875 14564058
         BO    CHK01                    TSO                    @SA74875 14571058
         B     CHK07                    GO CHECK CARRIAGE COUNT@SA74875 14578058
         SPACE 2                                               @SA74875 14585058
CHKWHICH EQU   *                                               @SA74875 14592058
         TM    QCBRETCT,QCBCR           CHECK FOR CR SENT               14600005
         BO    CHKLF                    CR SENT. CHECK LF               14650005
         MVI   ZERO(RTCBUF),CR          INSERT CR                       14700005
         B     CHKLF1                   USE COMMON CODE                 14750005
         SPACE                                                          14800005
CHKLF    EQU   *                                                        14850005
         TM    QCBRETCT,QCBLF           WAS LF SENT                     14900005
         BO    RESET1                   YES. NOTHING TO DO              14950005
         MVI   ZERO(RTCBUF),LF          INSERT LF                       15000005
CHKLF1   EQU   *                                                        15050005
         BAL   RLINK,MVD1               UPDATE COUNT AND POINTER        15100005
         MVI   CARCT+ONE,ZERO           CLEAR CARR POSITION             15150005
         NI    QCBRETCT,NOT-QCBNL       TURN OFF CR/LF FLAGS            15200005
         B     RESET1                   TO RETURN                       15250005
CHK02    EQU   *                                                        15300005
         CLI   CARCT+ONE,NOT            REQ FOR LINE RETURN             15350005
         BE    CHK01                    FROM 2260 REMOTE                15400005
         CLI   CARCT+ONE,IDLES          0 IDLES                         15450005
         BE    RESET1                   SEND NOTHING                    15500005
         TM    CARCT+ONE,IDLES          INDICATE IDLES                  15550005
         BO    ANNL02                   SEND IDLES ONLY                 15600005
CHK07    EQU   *                                               @SA74875 15620058
         CLI   CARCT+ONE,ZERO           DOES IT NEED LEFT ADJUSTMENT    15650005
         BE    CHK03                    BRANCH NO                       15700005
         BAL   RLINK,INSNL              ADD NL                          15750005
         B     CHK05                    THEN COUNT IT                   15800005
CHK03    EQU   *                                                        15850005
         MVI   CARCT+ONE,ZERO           CLEAR CARR                      15900005
         MVI   TOR+THREE,ZERO           RETURN COUNT OF ZERO            15950005
         B     RESET1                   BRANCH                          16000005
CHK01    EQU   *                                                        16050005
         BAL   RLINK,INSNL              RETURN LINE                     16100005
         TM    AVTPARM,E3               ANY 2260?                       16150005
         BZ    CHK05                    BRANCH NO                       16200005
         MVI   CARCT+ONE,ZERO           LINE WAS COUNTED IN IEDAYC      16250005
         B     CHK06                    CONTINUE                        16300005
CHK05    EQU   *                                                        16350005
         CLI   CARCT+ONE,X'FF'          REQ. TO RETN CARR/CURSOR?       16400005
         BE    CHK06                    BR YES TO SKIP COUNT LINE       16450005
         BAL   RLINK,SMCALL             COUNT ONE LINE                  16500005
CHK06    EQU   *                                                        16550005
         TM    AVTPARM3+THREE,DCTNOIDL  2260 REMOTE?           @G36XRYP 16600000
         BZ    ANNL02                   BRANCH NO                       16650005
         BAL   RLINK,INSETX             ADD ETX FOR REMOTE              16700005
         NI    QCBRETCT,QCBNL           CLEAR FLAGS                     16750005
         MVI   CARCT+ONE,ZERO           CLEAR CARR COUNT                16800005
         B     RESET2                   BRANCH                          16850005
*********************************************************************** 16900005
DATA     EQU   *                                                        16950005
         MVC   LINE,LINESV              SET LINE SIZE                   17000005
         IC    RLINK,0(RTSBUF)          FIRST BYTE IS COUNT             17050005
         STC   RLINK,BLNTH+ONE          BUF LENGTH                      17100005
         STC   RLINK,MSGLEN+ONE         = MSG LENGTH                    17150005
         LA    RTSBUF,ONE(,RTSBUF)                                      17200005
         TM    WFLGS,NOLEFT             WANT CARRIAGE RETURNED          17250005
         BO    PUTDATA                  BRANCH NO TO MOVE NOW           17300005
         L     RLINK,LCBSCBA-ONE        GET SCB ADDRESS                 17350005
         USING IEDQSCB,RLINK            ADDRESSABILITY                  17400005
         TM    SCBERR2,SCBALN          ENTRY FOR AUTO LINE NO?          17450005
         DROP  RLINK                                                    17500005
         BZ    NOALN                    BRANCH NO                       17550005
         CLI   MSGLEN+ONE,EIGHT         IS THIS AUTO DATA OR MSG        17600005
         BH    NOALN                    BRANCH ON MSG                   17650005
         MVC   DEND+EIGHT(EIGHT),ZERO(RTSBUF) SAVE EBCDIC LINE NO TO    17700005
*                                       AVOID OVERSTORING W/IDLES       17750005
         LA    RTSBUF,DEND+EIGHT        CHANGE INPUT POINTER            17800005
NOALN    EQU   *                                                        17850005
         CLI   CARCT+ONE,ZERO           DOES IT NEED TO BE RETURN       17900005
         BNE   CKTWX                    YES, BRANCH            @YA08763 17950058
         TM    WFLGS,TSOMSG             IS THIS MSGGEN         @YA08763 17960058
         BO    MIDLES                   NO, BRANCH             @YA08763 17970058
         TM    AVTPARM,E3               IS IT 2260 DISPLAY     @OZ07091 17971058
         BNZ   MIDLES                   YES, BRANCH            @OZ07091 17972058
         TM    LCBTSOB,LCB2741N         IS THIS A 2741 TERM.   @YA09113 17973058
         BO    MIDLES                   YES, BRANCH            @YA09113 17976058
CKTWX    EQU   *                                               @YA08763 17980058
         TM    AVTPARM3+TWO,DCTTWX      IS THIS A TWX LINE     @G36XRYP 18000000
         BZ    DATA01                   CHECK FOR SPECIAL CASE          18050005
         TM    QCBRETCT,QCBCR+QCBLF     HAVE LF/CR BEEN SENT            18100005
         BZ    DATA04                   BR NO TO SEND BOTH              18150005
         BO    MIDLES                   BR YES TO SEND NEITHER          18200005
         TM    QCBRETCT,QCBCR           WAS CR SENT                     18250005
         BZ    DATA02                   BR NO TO INSERT CR              18300005
         MVI   ZERO(RTCBUF),LF          INSERT LF                       18350005
         B     DATA03                   TO COMMON CODE                  18400005
DATA01   EQU   *                                                        18450005
         CLI   CARCT+ONE,NOT            NEED CARR RETURN                18500005
         BE    DATA01A                  BRANCH YES                      18550005
         TM    CARCT+ONE,IDLES          CARR FIELD INDICATE IDLES       18600005
         BO    MIDLES                   BRANCH YES FOR IDLES ONLY       18650005
         BAL   RLINK,SMCALL             COUNT LINE FOR CARR RTN         18700005
DATA01A  EQU   *                                                        18750005
         BAL   RLINK,INSNL              YES. BUT DON'T COUNT LINE.      18800005
         B     MIDLES                   CONTINUE                        18850005
DATA02   EQU   *                                                        18900005
         MVI   ZERO(RTCBUF),CR          INSERT CR                       18950005
DATA03   EQU   *                                                        19000005
         BAL   RLINK,MVD1               UPDATE COUNT AND TCAM PTR       19050005
         B     MIDLES                   CLEAR COUNT FIELD               19100005
DATA04   EQU   *                                                        19150005
         CLI   CARCT+ONE,ZERO           IS CR/LF NEEDED?       @YA11153 19160058
         BE    MIDLES                   NO                     @YA11153 19170058
         BAL   RLINK,INSNL              RETURN CARRIAGE                 19200005
         BAL   RLINK,SMCALL             COUNT ONE LINE                  19250005
MIDLES   EQU   *                                                        19300005
         BAL   RLINK,SNDIDLES           PUT IN IDLES                    19350005
         MVI   CARCT+ONE,ZERO           CLEAR CARR COUNT                19400005
*********************************************************************** 19450005
PUTDATA  EQU   *                                                        19500005
         L     RLINK,LCBSCBA-ONE        GET SCB ADDRESS                 19550005
         USING IEDQSCB,RLINK            ADDRESSABILITY                  19600005
         TM    SCBERR2,SCBALN           AUTO LINE OR AUTO CHAR          19650005
         DROP  RLINK                                                    19700005
         BZ    PUT00                    BRANCH NO                       19750005
         CLI   MSGLEN+ONE,EIGHT         IS THIS AUTO DATA OR MSG        19800005
         BH    PUT00                    BRANCH ON MSG                   19850005
         TM    LCBTSOB,LCB2741N         IS IT A 2741                    19900005
         BZ    PUT00                    BRANCH NO                       19950005
         MVI   CARCT+ONE,FIVEIDLS       TO INSERT 5 IDLES               20000005
         BAL   RLINK,SNDIDLES           TO KEEP PROMPT FROM PRT ON FLY  20050005
PUT00    EQU   *                                                        20100005
         LH    RNDX,MSGLEN              ASSUME ROOM FOR ALL             20150005
         CLC   MSGLEN,WBUFSZ            IS THERE ROOM                   20200005
         BNH   PUT01                    BRANCH YES                      20250005
         LH    RNDX,WBUFSZ              TRUNCATE TO SIZE IN SCB         20300005
PUT01    EQU   *                                                        20350005
         TM    AVTPARM3+TWO,DCTLOCAL    IS THIS 2260 LOCAL     @G36XRYP 20400000
         BZ    PUT02                    BRANCH NO                       20450005
         CH    RNDX,LINE                WILL MSG WRAP TO NEXT LINE      20500005
         BNH   PUT02                    BRANCH NO                       20550005
         BAL   RLINK,SMCALL             UPDATE LINE COUNT IF SO         20600005
PUT02    EQU   *                                                        20650005
         BAL   RRTN,UPTOTCCT            UPDT TO,TCAM BUF, AND CARR      20700005
         BCTR  RNDX,ZERO                REDUCE FOR MOVE                 20750005
         EX    RNDX,MOVDATA             MSG TO SCB                      20800005
         AR    RTCBUF,RNDX              UPDATE PTR TO LAST MOVED        20850005
         TM    AVTPARM3+TWO,DCTTWX      TWX LINE               @G36XRYP 20900000
         BO    CTWXND                   BRANCH YES                      20950005
         TM    AVTPARM,E3               ANY 2260                        21000005
         BM    IS2260                   YES                             21050005
         CLI   ZERO(RTCBUF),NLCHAR      WAS LAS CHAR A NEW LINE (NL)    21100005
         LA    RTCBUF,ONE(,RTCBUF)      POINT BEYOND LAST CHAR          21150005
         BNE   RESET1                   BRANCH NO                       21200005
         BAL   RLINK,SMCALL             COUNT ONE LINE                  21250005
         TM    WFLGS,NOLEFT             ATTN ONLY ENTRY WITH NOLEFT     21300005
         BNO   ANNL02                   BRANCH NO                       21350005
         MVI   CARCT+ONE,MAXIDLES       MAX IDLES FOR ATTN              21400005
         B     ANNL02                   BRANCH YES                      21450005
*********************************************************************** 21500005
IS2260   EQU   *                                                        21550005
         CLI   ZERO(RTCBUF),NLCHAR      WAS LAST CHAR NL?               21600005
         BNE   NOEND                    NO                              21650005
         BAL   RLINK,SMCALL             COUNT OUTPUT LINE               21700005
         TM    AVTPARM3+TWO,DCTLOCAL    FOR A 2260 LOCAL       @G36XRYP 21750000
         BO    ANNL02                   YES. LEAVE NL                   21800005
         MVI   ZERO(RTCBUF),CR          OVERLAY WITH CR FOR REMOTE      21850005
         LA    RTCBUF,ONE(,RTCBUF)      STEP PAST LAST CHAR             21900005
         BAL   RLINK,INSETX             ADD ETX AT END                  21950005
         B     ANNL02                   RESET CARRIAGE COUNT            22000005
NOEND    EQU   *                                                        22050005
         TM    AVTPARM3+THREE,DCTNOIDL  SEE IF REMOTE          @G36XRYP 22100000
         BZ    RESET1                   NO.                             22150005
         LA    RTCBUF,ONE(,RTCBUF)      POINT TO NEXT CHAR SLOT         22200005
         BAL   RLINK,INSETX             TO ADD ETX AT END               22250005
         B     RESET2                   LEAVE W/O RESETTING CARR COUNT  22300005
ANNL02   EQU   *                                                        22350005
         BAL   RLINK,SNDIDLES           INSERT IDLES IF REQUIRED,CLR CT 22400005
RESET1   EQU   *                                                        22450005
         BCTR  RTCBUF,ZERO              BACK UP TO LAST CHAR            22500005
         CLI   ZERO(RTCBUF),BSP         IS THIS A BACKSPACE             22550005
         BNE   RESET2                   BRANCH NO                       22600005
         CLI   CARCT+ONE,TWO            IS THIS THE PROMPT              22650005
         BNE   RESET2                   BRANCH NO                       22700005
         MVI   CARCT+ONE,ZERO           SHOW  CARRIAGE AT LEFT          22750005
RESET2   EQU   *                                                        22800005
         L     RLINK,TOR                GET NO. CHAR MOVED              22850005
         ST    RLINK,FROMR              REARRANGE RETURN REGS           22900005
         B     AYW00070                 SUCCESSFUL COMPLETION           22950005
         SPACE                                                          23000005
CTWXND   EQU   *                                                        23050005
         CLI   ZERO(RTCBUF),CR          WAS LAST CHAR CR                23100005
         BE    CTWXCR                   YES. ASSUME AUTO CHAR PROMPT    23150005
         CLI   0(RTCBUF),NLCHAR         WAS LST ONE NL                  23200005
         BNE   RESET1                   NO. THAT IS ALL                 23250005
         MVI   0(RTCBUF),CR             CHANGE TO RETURN                23300005
         NC    WBUFSZ,WBUFSZ            ANY MORE ROOM?             @01A 23310000
         BNZ   CTWXLF                   YES, CONTINUE              @01A 23320000
         B     CTWXCR                   NO, RETURN                 @01A 23330000
CTWXLF   EQU   *                                                   @01A 23340000
         LA    RTCBUF,ONE(,RTCBUF)      STEP TO NEXT BYTE               23350005
         BAL   RLINK,SNLF               ADD LINE FEED                   23400005
         BAL   RLINK,SMCALL             COUNT ONE LINE                  23450005
CTWXCR   EQU   *                                                        23500005
         MVI   CARCT+ONE,ZERO           CLEAR CARR COUNT                23550005
         B     RESET1                   PREPARE TO RETURN               23600005
*********************************************************************** 23650005
         SPACE                                                          23700005
UPDATE   EQU   *                                                        23750005
         IC    RTEMP,0(RNDX,RTSBUF)     GET LAST CHARACTER MOVED        23800005
         STC   RTEMP,TSBUFR             AND SAVE IT FOR LATER LOOK      23850005
         LA    RNDX,ONE(,RNDX)          RESTORE COUNT MOVED             23900005
         AR    RTCBUF,RNDX              UPDATE TCAM POINTER             23950005
         LH    RDCB,LINE                AVAILABLE LINE SIZE             24000005
         SR    RDCB,RNDX                LESS MESSAGE LENGTH             24050005
         AH    RDCB,DEND+TWO            LESS NON-PRINT COUNT            24100005
         STH   RDCB,LINE                                                24150005
         BAL   RRTN,UPTOTCCT            UPDT TO, TCAM BUF, AND CARR     24200005
         SPACE                                                          24250005
         AR    RTSBUF,RNDX              UPDATE TS BUFR POINTER          24300005
         LH    RDCB,MSGLEN              MSG LENGTH PASSED TO AYE        24350005
         SR    RDCB,RNDX                LESS NO. CHAR MOVED             24400005
         STH   RDCB,MSGLEN                                              24450005
         L     RDCB,FROMR               NO. REMOVED FROM TS BUFF        24500005
         AR    RDCB,RNDX                PLUS THOSE REMOVED THIS TIME    24550005
         ST    RDCB,FROMR                                               24600005
         LH    RDCB,BLNTH               NO. CHAR IN TS BUFR             24650005
         SR    RDCB,RNDX                REDUCE BY NO. MOVED             24700005
         STH   RDCB,BLNTH                                               24750005
         LH    RDCB,MOVED               AMOUNT REMOVED FROM 1 TS BUFR   24800005
         AR    RDCB,RNDX                PLUS NO. MOVED THIS TIME        24850005
         STH   RDCB,MOVED                                               24900005
         BR    RLINK                    RETURN TO CALLER                24950005
         SPACE                                                          25000005
UPTOTCCT EQU   *                                                        25050005
         LH    RDCB,WBUFSZ              CURRENT TCAM BFR SIZE           25100005
         SR    RDCB,RNDX                SUBTRACT NO. CHAR MOVED         25150005
         STH   RDCB,WBUFSZ              STORE REMAINDER                 25200005
         L     RDCB,TOR                 'TO' COUNT TO BE RETURNED       25250005
         AR    RDCB,RNDX                ADD NO. CHAR MOVED THIS TIME    25300005
         ST    RDCB,TOR                 STORE IT BACK                   25350005
         LH    RDCB,CARCT               CURRENT CARR COUNT              25400005
         AR    RDCB,RNDX                ADD NO. MOVED                   25450005
         SH    RDCB,DEND+TWO            SUBTRACT NON-PRINT IF ANY       25500005
         BP    UPDT                     DO NOT ALLOW NEG COUNT          25550005
         SR    RDCB,RDCB                SET TO 0                        25600005
UPDT     EQU   *                                                        25650005
         STH   RDCB,CARCT               STORE IT BACK                   25700005
         BR    RRTN                     RETURN TO CALLER                25750005
         SPACE                                                          25800005
SNDIDLES EQU   *                                                        25850005
         TM    AVTPARM3+TWO,DCTTWX      IS THIS A TWX LINES    @G36XRYP 25900000
         BO    CLRCAR                   YES. DO NOT ADD IDLES           25950005
         TM    AVTPARM,THREE            ANY 2260                        26000005
         BM    CLRCAR                   YES                             26050005
         TM    SAVX1,ONE                ANY HORIZONTAL TABS             26100005
         BZ    SND00                    BRANCH NO                       26150005
         MVC   CARCT,LINESV             USE MAX IDLES W/TABS            26200005
         NI    SAVX1,NOT-ONE            SWITCH OFF                      26250005
SND00    EQU   *                                                        26300005
         NC    WBUFSZ,WBUFSZ                                            26350005
         BNZ   SND                      BRANCH ROOM LEFT                26400005
         OI    WFLGS+ONE,ONE            INDICATE NOT ALL INSERTED       26450005
         LH    RTEMPA,CARCT             GET CURRENT COUNT               26500005
         BAL   RRTN,DIVIDE              CALC NO. OF IDLES               26550005
         STH   RTEMPA,CARCT             PUT INTO CARR FIELD             26600005
         OI    CARCT+ONE,IDLES          INDICATE COUNT IS IDLES         26650005
         BR    RLINK                    RETURN                          26700005
*********************************************************************** 26750005
CLRCAR   EQU   *                                                        26800005
         MVI   CARCT+ONE,ZERO           ZERO CARRIAGE POSITION          26850005
         NI    QCBRETCT,NOT-QCBNL                                       26900005
         BR    RLINK                    RETURN                          26950005
SND      EQU   *                                                        27000005
         TM    LCBTSOB,LCB2741N         IS THIS A 2741                  27050005
         BO    SND01                    BRANCH YES TO INSERT IDLES      27100005
         LTR   RPARM2,RPARM2            1050. CHK FOR ENTRY TO RTN CARR 27150005
         BNZ   SND01                    NO. TREAT NORMALLY              27200005
         MVI   ZERO(RTCBUF),IDLECHAR    INSERT ONE IDLE                 27250005
         MVC   ONE(E11,RTCBUF),ZERO(RTCBUF)  PROPAGATE FOR 12           27300005
         MVI   E12(RTCBUF),EOT          FINISH WITH EOT                 27350005
         LA    RNDX,THIRTEEN            TOTAL INSERTED                  27400005
         B     CLRC                     TO UPDATE COUNTS                27450005
SND01    EQU   *                                                        27500005
         LH    RTEMPA,CARCT             CURRENT CARR COUNT              27550005
         SR    RNDX,RNDX                IN CASE NO IDLES NEEDED         27600005
         CLI   CARCT+ONE,IDLES          IDLES OR COUNT                  27650005
         BE    CLRC                     CLR COUNT AND RETURN            27700005
         BH    NOROUND                  IDLES                           27750005
         LTR   RTEMPA,RTEMPA            ANY NEED FOR IDLES              27800005
         BZ    CLRC                     BRANCH NO                       27850005
         BAL   RRTN,DIVIDE              ELSE CONVERT TO IDLES           27900005
NOROUND  EQU   *                                                        27950005
         N     RTEMPA,K15               GET IDLE COUNT                  28000005
         LR    RNDX,RTEMPA                                              28050005
         CH    RNDX,WBUFSZ              SEE IF ENOUGH ROOM              28100005
         BH    PARTI                    SEND ONLY PART                  28150005
         NI    WFLGS+ONE,NOT-ONE        INDICATE ALL SENT               28200005
ALLI     EQU   *                                                        28250005
         MVI   ZERO(RTCBUF),IDLECHAR    INSERT FIRST IDLE               28300005
         BCT   RNDX,NOTONE              BRANCH IF MORE THAN ONE NEEDED  28350005
         B     MODCK                    ONLY ONE REQUIRED               28400005
NOTONE   EQU   *                                                        28450005
         BCTR  RNDX,ZERO                REDUCE FOR MOVE                 28500005
         EX    RNDX,MOVIDL              PROPAGATE THE REST              28550005
         LA    RNDX,ONE(,RNDX)          RESTORE COUNT                   28600005
MODCK    EQU   *                                                        28650005
         LA    RNDX,ONE(,RNDX)          ONLY ONE USED FOR ONE IDLE      28700005
         AR    RTCBUF,RNDX              POINT BEYOND IDLES              28750005
         SR    RTEMPA,RNDX              SEE IF WE GOT THEM ALL          28800005
         LTR   RTEMPA,RTEMPA            DID THEY ALL GO                 28850005
         BZ    CLRC                     BRANCH IF THEY DID              28900005
         STC   RTEMPA,CARCT+ONE         STORE COUNT NOT MOVED           28950005
         OI    CARCT+ONE,IDLES          INDICATES IDLES                 29000005
         B     NOCLR                    DO NOT CLEAR CARCT              29050005
CLRC     EQU   *                                                        29100005
         MVI   CARCT+ONE,ZERO           INDICATE ALL SEND               29150005
NOCLR    EQU   *                                                        29200005
         LH    RTEMPA,WBUFSZ            TCAM BUFFER SIZE                29250005
         SR    RTEMPA,RNDX              REDUCE BY NO. IDLES             29300005
         STH   RTEMPA,WBUFSZ            STORE IT BACK                   29350005
         L     RTEMPA,TOR               GET 'TO' COUNT PASSED BACK      29400005
         AR    RTEMPA,RNDX              ADD NO. CHAR MOVED TO BUF       29450005
         ST    RTEMPA,TOR               PUT IT BACK                     29500005
         BR    RLINK                    RETURN                          29550005
PARTI    EQU   *                                                        29600005
         OI    WFLGS+ONE,ONE            INDICATE NOT ALL SENT           29650005
         LH    RNDX,WBUFSZ              SEND AS MUCH AS POSSIBLE        29700005
         B     ALLI                     BRANCH                          29750005
         SPACE                                                          29800005
DIVIDE   EQU   *                                                        29850005
         SR    RTEMP,RTEMP              CLEAR FOR DIVIDE                29900005
         LA    RDCB,E11                 N / 11 ROUNDED                  29950005
         DR    RTEMP,RDCB               DO THE DIVIDE                   30000005
         LTR   RTEMP,RTEMP              SEE IF ROUNDING REQUIRED        30050005
         BZ    DIVX                     BRANCH NO                       30100005
         LA    RTEMPA,ONE(,RTEMPA)      ROUND                           30150005
DIVX     EQU   *                                                        30200005
         C     RTEMPA,K15               IF GREATER IS TROUBLE           30250005
         BNH   DIVY                     IS OK                           30300005
         L     RTEMPA,K15               SET AT MAXIMUM NO.              30350005
DIVY     EQU   *                                                        30400005
         BR    RRTN                     RETURN                          30450005
         SPACE                                                          30500005
         SPACE                                                          30550005
**  ROUTINE TO CALCULATE SPACE AVAILABLE IN TCAM BUFFER AND/OR          30600005
**  ON THE CURRENT LINE.  THE SIZE OF AVAILABLE SPACE IS RETURNED IN    30650005
**  RNDX....  INPUT SIZE IS IN 'BLNTH' IN WORK AREA.                    30700005
CALCSIZ  EQU   *                                                        30750005
         NC    WBUFSZ,WBUFSZ            TEST ROOM IN TCAM               30800005
         BZ    NOBUF                    NO ROOM LEFT IN TCAM BUFFER     30850005
         LH    RNDX,BLNTH               CURRENT TS BUFFER SIZE          30900005
         LTR   RNDX,RNDX                TEST TSO BUFFER SIZE   @SA74058 30908058
         BP    VALIDCNT                 BUFFER SIZE >  ZERO    @SA74058 30916058
         MVI   SWT2,RC44                INDICATE NO DATA MOVE  @SA74058 30924058
         BR    RLINK                                           @SA74058 30932058
VALIDCNT EQU   *                                               @SA74058 30940058
         BCTR  RNDX,ZERO                MINUS 1                         30950005
         IC    RDCB,ZERO(RNDX,RTSBUF)   GET LAST CHARACTER              31000005
         STC   RDCB,SAVX2               SAVE IT FOR NOW                 31050005
         CLC   BLNTH,MSGLEN             EQUAL FOR END OF MSG OR BFR     31100005
         BNE   CALC1                    IF NOT END, JUST GET SIZE       31150005
         TM    BUFFFL1,BUFFNLCR         IS THIS LAST BUFFER             31200005
         BZ    CALC1                    BRANCH NO                       31250005
         TM    AVTPARM3+TWO,DCTTWX      IS THIS A TWX LINE     @G36XRYP 31300000
         BO    BUFMCHK                  YES. TWX MAY NEED 2 CHAR ADDED  31350005
         TM    AVTPARM3+THREE,DCTNOIDL  IS IT 2260 REMOTE      @G36XRYP 31400000
         BZ    OTHER                    OTHERS NEED NL ONLY             31450005
BUFMCHK  EQU   *                                                        31500005
         LH    RNDX,WBUFSZ              SIZE OF TCAM BUFFER             31550005
         BCTR  RNDX,ZERO                REDUCE FOR MSG=BFR-1 CHK        31600005
         CH    RNDX,MSGLEN              IS MSG=BFR-1?                   31650005
         BE    FAKER                    BRANCH YES                      31700005
OTHER    EQU   *                                                        31750005
         CLC   MSGLEN,WBUFSZ            IS MSGSZE = TCAM BFR SIZE       31800005
         BE    FAKER                    BRANCH YES. FORCE ANOTHER ENTRY 31850005
CALC1    EQU   *                                                        31900005
         CLC   BLNTH,WBUFSZ             COMPARE TO CURRENT LENGTH OF    31950005
**                                      SPACE AVAILABLE                 32000005
         BH    SPART                    BRANCH HIGH                     32050005
         LH    RNDX,BLNTH               LET IT ALL GO                   32100005
         TM    WFLGS,CONTROLM           CONTROL MODE INPUT              32150005
         BO    CTLSZ                    YES                             32200005
         CH    RNDX,LINE                COMPARE TO SPACE THIS LINE      32250005
         BH    SPLNMG                   SEND REST OF LINE               32300005
CTLSZ    EQU   *                                                        32350005
         TM    BUFFFL1,BUFFNLCR         IS THIS LAST BUFFER             32400005
         BO    CHK1050                  BRANCH YES                      32450005
NOT1050  EQU   *                                                        32500005
         MVI   SWT2,FOUR                SEND ALL DATA THIS LINE         32550005
         BR    RLINK                    RETURN                          32600005
CHK1050  EQU   *                                                        32650005
         TM    FLAG2,X1050              IS THE DEVICE A 1050            32700005
         BZ    NOT1050                  NO, BRANCH                      32750005
         LA    RDCB,ONE                 FOR COMPARE                     32800005
         CR    RDCB,RNDX                IS THERE ONLY ONE CHAR          32850005
         BE    NOT1050                  BRANCH YES                      32900005
         CLI   SAVX2,NLCHAR             WAS LAST CHAR NL                32950005
         BE    C105X                    YES. WILL NEED IDLES            33000005
         TM    WFLGS,TSOASIS+CONTROLM   IS IT ASIS OR CTRL MODE         33050005
         BM    NOT1050                  IF SO, IDLES WILL NOT BE ADDED  33100005
C105X    EQU   *                                                        33150005
         OI    QCBRETCT,QCBIEND+QCBDEND FAKING FLAGS                    33200005
         BCTR  RNDX,ZERO                EDIT BUMPS BY ONE IF QCBDEND ON 33250005
         MVI   SWT2,THIRTY2             RTN CODE                        33300005
         BR    RLINK                    RETURN                          33350005
*  WILL NOT BE ROOM TO INSERT NEW LINE.                                 33400005
*  REDUCE APPARENT TCAM BUFFER SIZE TO FORCE RETURN WITH NEW BUFFER     33450005
FAKER    EQU   *                                                        33500005
         TM    WFLGS,TSOASIS+CONTROLM                                   33550005
         BM    CALC1                    NO NEED FOR NL AT END           33600005
         TM    FLAG1,TRAILER            IS TRAILER BUFFER INDICATED     33650005
         BO    CALC1                    YES. NOTHING SPECIAL TO DO      33700005
         CLC   MSGLEN,LINE              IS DATA LONGER THAN LINE        33750005
         BH    CALC1                    YES. WILL TAKE END OF LINE EXIT 33800005
         TM    BUFFFL1,BUFFNLCR         IS THIS ALL OF MSG              33850005
         BZ    CALC1                    NO. OWAIT                       33900005
         TM    AVTPARM3+TWO,DCTTWX      IS THIS MSG FOR TWX?   @G36XRYP 33950000
         BO    FAKETWX                  BRANCH YES. SPECIAL TREATMENT   34000005
         TM    AVTPARM3+THREE,DCTNOIDL  IS THIS 2260 REMOTE    @G36XRYP 34050000
         BO    FAK2260                  YES. MAKE 2260 CHECKS           34100005
         TM    AVTPARM3+TWO,DCTLOCAL    IS THIS 2260 LOCAL     @G36XRYP 34150000
         BZ    LESS1                    BRANCH NO                       34200005
         CLC   MSGLEN,LINE              YES. IS MSG EQUAL LINE          34250005
         BE    CALC1                    IF SO, DO NOTHING NL NOT NEEDED 34300005
LESS1    EQU   *                                                        34350005
         OI    QCBRETCT,QCBDEND         LAST. FORCE SECOND ENTRY        34400005
         LH    RNDX,WBUFSZ                                              34450005
         BCTR  RNDX,ZERO                SUBTRACT ONE                    34500005
         STH   RNDX,WBUFSZ                                              34550005
         OI    SAVX1,TWO                INDICATE TCAM REDUCED           34600005
         B     CALC1                    BLNTH/MSGLEN MAY NOT BE SAME    34650005
         SPACE                                                          34700005
FAK2260  EQU   *                                                        34750005
         LH    RNDX,BLNTH               GET ALL OF TS BFR               34800005
*  DECREMENT RNDX BECAUSE EDIT ADDS 1 IF QCBDEND IS ON.                 34850005
         BCTR  RNDX,ZERO                MINUS 1 FOR EDIT                34900005
         CLC   MSGLEN,WBUFSZ            IS MSG LENGTH = TCAM BFR SIZE   34950005
         BE    NLCHK                    YES. SEE IF LAST IS NL          35000005
*  MESSAGE IS 1 CHAR SHORTER THAN TCAM BUFFER. IF LAST CHAR IS NL       35050005
*  OR MSG FILLS LINE, ONLY ETX WILL BE NEEDED.                          35100005
         CLC   MSGLEN,LINE              DOES MSG = LINE                 35150005
         BE    CALC1                    YES. WILL NEED ONLY ETX         35200005
         CLI   SAVX2,NLCHAR             IS LAST CHAR NL                 35250005
         BE    CALC1                    YES. NEEDS ONLY ETX             35300005
*  LAST CHAR IS NOT A NL AND LINE IS NOT FULL. SET QCBDEND TO           35350005
*  REDUCE QTIP FOR MOVE TO FORCE SECOND ENTRY TO SEND ETX               35400005
*  ADD NL BEFORE EXIT IEDAYE.                                           35450005
FAKETX   EQU   *                                                        35500005
         OI    QCBRETCT,QCBDEND         SET SECOND ENTRY FLAG           35550005
         MVI   SWT2,E16                 RTN CODE FOR ETX ONLY           35600005
         BR    RLINK                    RETURN                          35650005
         SPACE                                                          35700005
*  MESSAGE IS EXACTLY AS LONG AS TCAM BUFFER. UNLESS IT ENDS IN NL      35750005
*  OR FILLS LINE, MUST SET QCBDEND AND FOR SECOND ENTRY FOR NL,TEX.     35800005
*                                                                       35850005
*  IF IT ENDS IN NL OR MSG FILLS LINE, FORCE SECOND ENTRY FOR ETX ONLY  35900005
NLCHK    EQU   *                                                        35950005
         CLI   SAVX2,NLCHAR             IS LAST CHAR NL                 36000005
         BE    CHGNL                    YES. NL CHANGE TO CR            36050005
         CLC   BLNTH,LINE               DOES IT FILL LINE               36100005
         BE    NONL                     YES. DO NOT INSERT CR           36150005
*  NL AND ETX WILL BOTH BE NEEDED AT SECOND ENTRY.                      36200005
         OI    QCBRETCT,QCBDEND         SET SPECIAL FLAG                36250005
         MVI   SWT2,E20                 SET RETURN CODE                 36300005
         BR    RLINK                    AND RETURN                      36350005
CHGNL    EQU   *                                                        36400005
         MVI   SWT2,E24                 TO CHANGE NL TO CR              36450005
         B     CHGX                     COMMON CODE                     36500005
NONL     EQU   *                                                        36550005
         MVI   SWT2,E28                 NOT TO ADD NL                   36600005
CHGX     EQU   *                                                        36650005
         OI    QCBRETCT,QCBDEND         SECOND ENTRY FLAG               36700005
         BR    RLINK                    RETURN TO CALLER                36750005
         SPACE                                                          36800005
*  THE WBUFSZ MUST HAVE AT LEAST ONE TO GET HERE                   @12A 36831126
FAKETWX  EQU   *                                                   @12A 36862226
         L     RNDX,TOR                 GET TOR COUNT              @12A 36893326
         LA    RDCB,ONE                 SET UP TO TEST FOR         @12A 36924426
         CH    RDCB,WBUFSZ              TCAM BUFFER DATA SIZE      @12A 36955526
*                                        OF ONE                    @12A 36986626
         BE    ADDTOR1                  YES, BRANCH                @12A 37017726
         LA    RNDX,ONE(,RNDX)          ADD ONE TO TOR COUNT       @12A 37048826
ADDTOR1  EQU   *                                                   @12A 37079926
         LA    RNDX,ONE(,RNDX)          ADD ONE TO TOR COUNT       @12A 37111026
         ST    RNDX,TOR                 SAVE UPDATED TOR COUNT     @12A 37142126
         LH    RNDX,WBUFSZ              GET TCAM BUFFER SIZE       @12A 37173226
         BCTR  RNDX,ZERO                REDUCE BY ONE              @12A 37204326
         LA    RDCB,ZERO(RTCBUF,RNDX)   POINT TO LAST POSITION     @12A 37235426
*                                       OF TCAM BUFFER             @12A 37266526
         MVI   ZERO(RDCB),IDLECHAR      MOVE IN A IDLE CHAR        @12A 37297626
         LTR   RNDX,RNDX                TCAM BUFFER SIZE ZERO?     @12A 37328726
         BZ    BUFSZERO                 YES, BRANCH                @12A 37359826
         BCTR  RNDX,ZERO                REDUCE TCAM BUFFER         @12A 37390926
*                                       LENGTH BY ONE MORE         @12A 37422026
         LA    RDCB,ZERO(RTCBUF,RNDX)   POINT TO NEXT TO LAST      @12A 37453126
*                                 POSITION OF THE TCAM BUFFER      @12A 37484226
         MVI   ZERO(RDCB),IDLECHAR      MOVE IN A IDLE CHAR        @12A 37515326
BUFSZERO EQU   *                                                   @12A 37546426
         STH   RNDX,WBUFSZ              LENGTH OF DATA MOVE        @12A 37577526
         LTR   RNDX,RNDX                WAS REDUCTION TO ZERO?  SA67757 37610054
         BZ    NOBUF                    BR YES TO NO SPACE RETRNSA67757 37620054
         B     CALC1                    CONTINUE                        37650005
         SPACE                                                          37700005
         SPACE                                                          38350005
*  CAN ONLY SEND PART AS NOT ENOUGH ROOM IN TCAM BUFFER                 38400005
SPART    EQU   *                                                        38450005
         LH    RNDX,WBUFSZ              MAX IS TCAM BUF SIZE            38500005
         CH    RNDX,LINE                COMPARE TO  LINE SIZE           38550005
         BNL   SPLNMG                   PARTIAL LINE, PARTIAL MSG       38600005
         MVI   SWT2,EIGHT               FILL TCAM BUFFER                38650005
         BR    RLINK                    RETURN                          38700005
         SPACE                                                          38750005
*  NOT ENOUGH ROOM ON LINE AND POSSIBLY                                 38800005
*  NOT ENOUGH ROOM IN TCAM BUFFER                                       38850005
SPLNMG   EQU   *                                                        38900005
         MVI   SWT2,TWELVE              MAX MOVE IS TO FILL LINE        38950005
         LH    RNDX,LINE                GET COUNT FROM LINE SIZE AVAIL  39000005
         BR    RLINK                    RETURN                          39050005
         SPACE                                                          39100005
NOBUF    EQU   *                                                        39150005
         MVI   SWT2,E40                 INDICATE NO SPACE IN TCAM BFR   39200005
         BR    RLINK                    RETURN                          39250005
         SPACE                                                          39300005
INSNL    EQU   *                                                        39350005
         NC    WBUFSZ,WBUFSZ            TEST TCAM BUFFERSIZE            39400005
         BCR   EIGHT,RLINK              IF EMPTY, RETURN                39450005
         TM    AVTPARM3+TWO,DCTTWX      IS DEVICE TWX?         @G36XRYP 39500000
         BO    SNCR                     YES                    @OS78322 39550000
         TM    AVTPARM3+THREE,DCTNOIDL  2260 REMOTE?           @G36XRYP 39600000
         BO    INSCR                    YES                             39650005
         MVI   0(RTCBUF),NLCHAR         INSERT NEW LINE                 39700005
MVD1     EQU   *                                                        39750005
         LA    RTCBUF,ONE(,RTCBUF)      BUMP TCAM ADDRESS               39800005
         L     RTEMP,TOR                GET 'TO' COUNT                  39850005
         LA    RTEMP,ONE(,RTEMP)        UPDATE IT                       39900005
         ST    RTEMP,TOR                AND SAVE IT                     39950005
         LH    RTEMP,WBUFSZ             SIZE OF TCAM BUFFER             40000005
         BCTR  RTEMP,ZERO               DECREMENT FOR NL                40050005
         STH   RTEMP,WBUFSZ             UPDATE TCAM BUF SIZE            40100005
         BR    RLINK                    RETURN                          40150005
         SPACE                                                          40200005
INSETX   EQU   *                                                        40250005
         MVI   ZERO(RTCBUF),ETX         ETX TO TCAM BUFFER              40300005
         B     MVD1                     RETURN FROM MVD1 VIA RLINK      40350005
         SPACE                                                          40400005
INSCR    EQU   *                                                        40450005
         NC    WBUFSZ,WBUFSZ            ANY MORE SPACE IN TCAM          40500005
         BCR   8,RLINK                  NO. RETURN                      40550005
         MVI   0(RTCBUF),CR             REMOTE USES CARR RET            40600005
         B     MVD1                     GO UPDATE COUNT, PTR AND RTN    40650005
INSTX    EQU   *                                                        40700005
         NC    WBUFSZ,WBUFSZ            TEST BUFFERSIZE                 40750005
         BCR   EIGHT,RLINK              IF EMPTY, RETURN                40800005
         MVI   ZERO(RTCBUF),STX         ELSE INSERT STX                 40850005
         B     MVD1                     AND COUNT IT, THEN RETURN       40900005
SNCR     EQU   *                                                        41250005
         MVI   ZERO(RTCBUF),CR          INSERT CARR RETURN              41300005
SNCRX    EQU   *                                                        41350005
         LR    RNDX,RLINK               SAVE ENTRY REG                  41400005
         BAL   RLINK,MVD1               UPDATE COUNT,POINTER            41450005
         LR    RLINK,RNDX               RETRIEVE ENTRY REG              41500005
         NC    WBUFSZ,WBUFSZ            ANY MORE ROOM                   41550005
         BNZ   SNLF                     BRANCH YES                      41600005
*  NOT ROOM TO INSERT LF                                                41650005
         MVI   CARCT+ONE,NEEDLF         INDICATE LF STILL NEEDED        41700005
         OI    WFLGS+ONE,ONE            INDICATE REQUEST NOT COMPLETE   41750005
         B     AYW00080                 FINISH                 @OS78322 41800000
         SPACE                                                          41850005
SNLF     EQU   *                                                        41900005
         MVI   ZERO(RTCBUF),LF          INSERT LINE FEED                41950005
         B     MVD1                     GO COUNT, UPDT AND RETURN       42000005
         SPACE                                                          42050005
         SPACE                                                          42100005
SENDTSO  EQU   *                                                        42150005
         L     RLINK,BUFFTRLR-ONE       SEE IF TRAILER BUFFER FOLLOWS   42200005
         LA    RLINK,ZERO(,RLINK)       CLEAR FLAG BYTE                 42250005
         LTR   RLINK,RLINK              TEST FOR ADDRESS                42300005
         BNZ   SENDT01                  BRANCH IF ADDRESS               42350005
         NI    FLAG1,AVTEFF-TRAILER     NO TRAILER, CLEAR FLAG          42400005
         B     SENDT02                  CONTINUE                        42450005
SENDT01  EQU   *                                                        42500005
         OI    FLAG1,TRAILER            SET TRAILER FLAG                42550005
SENDT02  EQU   *                                                        42600005
         SR    RTEMP,RTEMP                                              42650005
         IC    RTEMP,BUFFOFST           OFFSET TO DATA IN TS BUF        42700005
         AR    RTSBUF,RTEMP             POINT TO DATA                   42750005
         MVC BLNTH+ONE(ONE),BUFFLNTH    AMT OF DATA IN BUFFER           42800005
         TM    QCBRETCT,QCBIEND         ENTRY FOR IDLES ONLY            42850005
         BZ    SENDT03                  BRANCH NO                       42900005
         NI    QCBRETCT,NOT-QCBDEND-QCBIEND FLAGS OFF                   42950005
         BAL   RLINK,SNDIDLES           PUT IN IDLES                    43000005
         MVI   MOVED+ONE,ONE            SET UP DUMMY QTIP               43050005
         BAL   RLINK,QTIPR              UPDATE THE BUFFER FOR 1 CHAR    43100005
         B     AYW00070                 SUCCESSFUL COMPLETION           43150005
SENDT03  EQU   *                                                        43200005
         TM    AVTPARM3+THREE,DCTNOIDL  2260 REMOTE?           @G36XRYP 43250000
         BZ    SEND01                   NO                              43300005
         TM    QCBRETCT,QCBDEND         IS THIS SPECIAL ENTRY           43350005
         BZ    SEND00                   BRANCH NO                       43400005
         NI    QCBRETCT,NOT-QCBDEND     TURN OFF FLAG                   43450005
         MVI   MOVED+ONE,ONE            SET FOR DUMMY QTIP              43500005
         BAL   RLINK,QTIPR              EXEC QTIP                       43550005
         CLI   CARCT+ONE,NOT-ONE        IS IT FOR NL AND ETX            43600005
         BE    SEND05                   BRANCH YES                      43650005
         B     SEND04                   FOR NL AND ETX                  43700005
SEND00   EQU   *                                                        43750005
*  IF THIS IS THE FIRST BASIC UNIT OF A 2260 REMOTE MESSAGE, WE MUST    43800005
*  INSERT AN STX AS THE FIRST CHARACTER OF THE BUFFER.                  43850005
         L     RTEMPA,LCBERBCH-ONE      ADDRESS OF FIRST BASIC UNIT.    43900005
         LA    RTEMPA,0(,RTEMPA)        CLEAR FOR COMPARE               43950005
         LA    RLINK,0(RTCBUF)          BFR ADDR PASSED                 44000005
         L     RTEMP,LCBSCBA-ONE        GET SCB ADDRESS                 44050005
         L     RTEMP,E44(RTEMP)         GET BUFFER ADDRESS              44100005
         LA    RTEMP,0(RTEMP)          CLEAR FOR COMPARE                44150005
         CR    RTEMP,RTEMPA            ARE THEY THE SAME                44200005
         BNE   NOTFIRST                 NO                              44250005
         CLI   LCBERBPY,PRIINTRQ        FIRST INITL REQUEST             44300005
         BNE   NOTFIRST                 BR NO . DO NOT ADD STX          44350005
         L     RTEMP,TOR                PICKUP COUNT OF INSERTED        44400005
*                                       DATA                            44450005
         LTR   RTEMP,RTEMP              STX ALREADY INSERTED            44500005
         BNZ   NOTFIRST                 YES, CONTINUE DATA              44550005
*                                       STREAM EDITING                  44600005
         BAL   RLINK,INSTX              YES. ADD STX                    44650005
         B     NOTFIRST                 BRANCH                          44700005
SEND01   EQU   *                                                        44750005
         TM    QCBRETCT,QCBDEND         ENTRY TO INSERT NL              44800005
         BZ    SEND02                   NO                              44850005
         NI    QCBRETCT,NOT-QCBDEND     TURN OFF BIT                    44900005
         MVI   MOVED+ONE,ONE                                            44950005
         BAL   RLINK,QTIPR              UPDATE TSO BUFFER               45000005
         TM    FLAG1,TRAILER            IS THERE A TRAILER BUFFER       45050005
         BZ    SEND07                   BRANCH IF NO MORE BUFFERS       45100005
         BAL   RLINK,INSNL              IS SPECIAL CASE WHEN LINE       45150005
*                                       ENDS WITH END OF TCAM BUFFER    45200005
         BAL   RLINK,SNDIDLES           INSERT IDLES                    45250005
         BAL   RLINK,SMCALL             COUNT ONE OUTPUT LINE           45300005
         B     MDA3                     GET NEXT BUFFER AND RESTART     45350005
SEND07   EQU   *                                                        45400005
         TM    AVTPARM3+TWO,DCTTWX      SEEIF TWX LINE         @G36XRYP 45450000
         BO    TWXEND                   YES                             45500005
         TM    AVTPARM3+TWO,DCTLOCAL    IS THIS 2260 LOCAL     @G36XRYP 45550000
         BZ    SEND05                   BRANCH NO TO SEND NL            45600005
         CLC   CARCT,LINESV             IS LINE FULL                    45650005
         BE    SEND03                   BRANCH YES TO SKIP NL           45700005
SEND05   EQU   *                                                        45750005
         BAL   RLINK,INSNL              BRANCH TO INSERT NL CHAR        45800005
SEND03   EQU   *                                                        45850005
         TM    AVTPARM3+THREE,DCTNOIDL  IS IT 2260 REMOTE      @G36XRYP 45900000
         BZ    SEND06                   BR NO  TO SEND NOTHING ELSE     45950005
SEND04   EQU   *                                                        46000005
         BAL   RLINK,INSETX             ADD ETX AS LAST CHAR            46050005
SEND06   EQU   *                                                        46100005
         BAL   RLINK,SMCALL             COUNT ONE LINE                  46150005
         BAL   RLINK,SNDIDLES           FOR IDLES AND/OR CLEAR CARR CT  46200005
         B     AYW00070                 SUCCESSFUL COMPLETION           46250005
TWXEND   EQU   *                                                        46300005
         MVI   0(RTCBUF),CR             LF WAS IN LAST BUFFER           46350005
         BAL   RLINK,MVD1               ADD 1 TO COUNT                  46400005
         B     SEND03                   GET IDLES AND GO                46450005
SEND02   EQU   *                                                        46500005
         CLI   CARCT+ONE,NOT            WAS LAST OPERATION INPUT WITH   46550005
*                                       CR OR LF MISSING                46600005
         BE    SEND12                   YES. SEE WHAT IS NEEDED         46650005
         CLI   CARCT+ONE,NEEDLF         IS LF NEEDED                    46700005
         BE    NOLF                     YES. INSERT IT IN BFR           46750005
         CLI   CARCT+ONE,NEEDBOTH       BOTH LF/CR NEEDED               46800005
         BE    NOCTL                    YES. PUT THEM IN                46850005
         TM    CARCT+ONE,IDLES          INDICATE IDLES                  46900005
         BNO   NOTFIRST                 BRANCH NO                       46950005
         B     SEND08                   INSERT NEEDED IDLES             47000005
SEND12   EQU   *                                                        47050005
         TM    LCBTSOB,LCB2741N         IS IT 2741?            @OS78322 47060000
         BO    NOCLR2                   YES, DON'T CLEAR YET   @OS78322 47070000
         MVI   CARCT+ONE,ZERO           CLEAR CARRIAGE COUNT            47100005
NOCLR2   EQU   *                                               @OS78322 47120000
         TM    QCBRETCT,QCBCR+QCBLF     SEE IF ONE OR BOTH MISSING      47150005
         BZ    NOCTL                    BOTH. INSERT BOTH               47200005
         TM    QCBRETCT,QCBCR           WAS CR RECEIVED                 47250005
         BO    NOLF                     BRANCH YES TO ADD LF            47300005
         MVI   ZERO(RTCBUF),CR          ELSE INSERT CR                  47350005
         BAL   RLINK,MVD1               AND COUNT IT                    47400005
TWXI     EQU   *                                                        47450005
         NI    QCBRETCT,NOT-QCBNL                                       47500005
         B     NOTFIRST                 BRANCH                          47550005
NOLF     EQU   *                                                        47600005
         BAL   RLINK,SNLF               INSERT LINE FEED (TTY)          47650005
SEND08   EQU   *                                                        47700005
         BAL   RLINK,SNDIDLES           WILL CLEAR CARR COUNT           47750005
NOTFIRST EQU   *                                                        47800005
         LH    RLINK,LINESV             LD TERMINAL LINE SIZE           47850005
         SH    RLINK,CARCT              GET  LINE SIZE LEFT             47900005
         BP    PASTNL                   BRANCH POSITIVE                 47950005
         TM    WFLGS,CONTROLM           CONTROL MODE                    48000005
         BZ    NOCTL                    NO                              48050005
         LH    RLINK,LINESV                                             48100005
         B     PASTNL                   BRANCH                          48150005
NOCTL    EQU   *                                                        48200005
         BAL   RLINK,INSNL              INSERT NL                       48250005
         BAL   RLINK,SNDIDLES           INSERT IDLES                    48300005
         TM    WFLGS+ONE,ONE            WAS THERE ROOM                  48350005
         BO    AYW00090                 NO, BRANCH                      48400005
         LH    RLINK,LINESV             YES. START COUNT AT 0           48450005
PASTNL   EQU   *                                                        48500005
         STH   RLINK,LINE               SET REMAINING LINE SIZE         48550005
MOREIN   EQU   *                                                        48600005
         BAL   RLINK,CALCSIZ            AMT. THAT CAN BE  MOVED         48650005
         CLI   SWT2,E40                 SEE IF ANY ROOM IN TCAM BFR     48700005
         BE    AYW00090                 NO, EXIT FOR NEW BUFFER         48750005
         CLI   SWT2,RC44                SEE IF TSO BFR HAS DATA@SA74058 48760058
         BE    NEWLINE                  NODATA IN TSBUF TO EDIT@SA74058 48770058
         BAL   RLINK,EDIT               EDIT IT                         48800005
         SR    RTEMP,RTEMP                                              48850005
         IC    RTEMP,SWT2               WHERE TO GO NEXT                48900005
WTG      EQU   *                                                        48950005
         B     WTG(RTEMP)               USE CALCSIZE RC FOR BRANCH      49000005
         B     NEWLINE                  RTN CODE 4. CURR TS BUF EMPTY   49050005
         B     EBUF                     RTN CODE 8. TCAM BFR FILLED.    49100005
         B     PARTML                   RTN CODE 12. A LINE IS COMPLETE 49150005
         B     SNCRNOW                  RTN CODE 16. CR NOW,ETX NXT     49200005
         B     NXNLETX                  RTN CODE 20. NL + ETX NEXT      49250005
         B     CHNGNOW                  RTN CODE 24. CHG NO TO CR NOW   49300005
         B     SN0NOW                   RTN CODE 28. ETX NEXT ENTRY     49350005
         B     SP1050                   RTN CODE 32. FORCE IDLES ENTRY  49400005
*********************************************************************** 49450005
         SPACE                                                          49500005
SNCRNOW  EQU   *                                                        49550005
         BAL   RLINK,INSNL              ADD CR AS LAST CHAR             49600005
SN0NOW   EQU   *                                                        49650005
         BAL   RLINK,QTIPR              UPDATE TS BUFFER                49700005
         MVI   CARCT+ONE,ZERO           FOR ETX ONLY                    49750005
         B     AYW00090                 FORCE SECOND ENTRY              49800005
CHNGNOW  EQU   *                                                        49850005
         BCTR  RTCBUF,ZERO              BACK UP TO LAST CHAR            49900005
         MVI   ZERO(RTCBUF),CR          OVERSTORE WITH CR               49950005
         B     SN0NOW                   WAIT FOR ETX NEXT ENTRY         50000005
NXNLETX  EQU   *                                                        50050005
         MVI   CARCT+ONE,AVTEFF-ONE     FOR NL/ETX                      50100005
         BAL   RLINK,QTIPR              UPDATE TS BUFF                  50150005
         B     AYW00090                 FORCE SECOND ENTRY              50200005
SP1050   EQU   *                                                        50250005
         BAL   RLINK,QTIPR              UPDATE BUFFER                   50300005
         BAL   RLINK,SMCALL             COUNT A LINE                    50350005
         CLI   SAVX2,NLCHAR             WAS LAST A NL                   50400005
         BE    SP105                    BRANCH YES                      50450005
         TM    WFLGS,TSOASIS+CONTROLM   IS IT ASIS OR CONTROL MODE      50500005
         BM    SP106                    BRANCH EITHER TO SKIP NL        50550005
         BAL   RLINK,INSNL              INSERT NL                       50600005
SP105    EQU   *                                                        50650005
         BAL   RLINK,SNDIDLES           ADD IDLES                       50700005
         TM    WFLGS+ONE,ONE            DID THEY ALL GO                 50750005
         BO    AYW00090                 NO, FORCE SECOND ENTRY          50800005
SP106    EQU   *                                                        50850005
         NI    QCBRETCT,NOT-QCBDEND-QCBIEND  NO NEED TO FAKE IT         50900005
         MVI   MOVED+ONE,ONE            YES. FINISH OFF TS BUFFR        50950005
         BAL   RLINK,QTIPR              WITH THIS CALL TO QTIP          51000005
         B     AYW00070                 SUCCESSFUL COMPLETION           51050005
         SPACE                                                          51100005
*  FILLED LINE. MORE TO DO.                                             51150005
PARTML   EQU   *                                                        51200005
         BAL   RLINK,QTIPR              UPDATE TSO BUFFER               51250005
         NC    LINE,LINE                SEE IF BSP LEFT ROOM            51300005
         BZ    LINEFINI                 BR LINE IS FULL                 51350005
         NC    WBUFSZ,WBUFSZ            CAN TCAM TAKE MORE              51400005
         BNZ   MOREIN                   IF SO, GET THEM                 51450005
         B     AYW00090                 EXIT FOR NEW BUFFER             51500005
LINEFINI EQU   *                                                        51550005
         BAL   RLINK,SMCALL             COUNT LINE                      51600005
         NC    MSGLEN,MSGLEN                                            51650005
         BNZ   PART01                   MORE TO DO                      51700005
         TM    BUFFFL1,BUFFNLCR                                         51750005
         BZ    PART01                   NOT LAST BUFFER                 51800005
         MVI   SWT2,FOUR                                                51850005
PART01   EQU   *                                                        51900005
         CLI   TSBUFR,NLCHAR            WAS LAST CHAR A NL              51950005
         BE    EOL60                    2260 CHECKS                     52000005
         TM    AVTPARM3+TWO,DCTLOCAL    LOCAL DOES NOT USE ETX @G36XRYP 52050000
         BO    LIDLES                   JUST CLEARS COUNT               52100005
         TM    AVTPARM3+THREE,DCTNOIDL  REMOTE,ETX AT END LINE @G36XRYP 52150000
         BO    ETXNOW                   INSERT IT                       52200005
         NC    WBUFSZ,WBUFSZ            ROOM FOR NL                     52250005
         BNZ   PART02                   BRANCH YES                      52300005
         MVI   CARCT+ONE,NOT            TO GET NL NEXT ENTRY            52350005
         NI    QCBRETCT,NOT-QCBNL       INDICATE NO NL                  52400005
         B     AYW00080                 EXIT                            52450005
PART02   EQU   *                                                        52500005
         BAL   RLINK,INSNL              NO. ADD NL AND IDLES            52550005
LIDLES   EQU   *                                                        52600005
         BAL   RLINK,SNDIDLES           INSERT IDLES                    52650005
         B     AYW00080                 EXIT                            52700005
ETXNOW   EQU   *                                                        52750005
         NC    WBUFSZ,WBUFSZ            ANY ROOM IN TCAM                52800005
         BZ    NOBF1                    NO. OVERLAY CR                  52850005
         BAL   RLINK,INSETX             ADD ETX AS LAST IN BFR          52900005
         B     LIDLES                   TO CLEAR CARR COUNT             52950005
NOBF1    EQU   *                                                        53000005
         BCTR  RTCBUF,ZERO              BACK UP                         53050005
         MVI   0(RTCBUF),ETX            INSERT ETX                      53100005
         B     LIDLES                   INSERT IDLES                    53150005
         SPACE                                                          53200005
EOL60    EQU   *                                                        53250005
         TM    AVTPARM3+THREE,DCTNOIDL  IS IT REMOTE           @G36XRYP 53300000
         BO    CHNG                     YES                             53350005
         TM    AVTPARM3+TWO,DCTTWX      IS IT TWX              @G36XRYP 53400000
         BO    CHNGTWX                  YES                             53450005
         B     LIDLES                   INSERT IDLES                    53500005
CHNG     EQU   *                                                        53550005
         BCTR  RTCBUF,ZERO              BACK OFF POINTER                53600005
         MVI   0(RTCBUF),CR             REMOTE USES CR                  53650005
         LA    RTCBUF,ONE(,RTCBUF)      ADD ONE TO BUFFER               53700005
         NC    WBUFSZ,WBUFSZ            ANY ROOM IN TCAM                53750005
         BZ    NOROOM                   NO                              53800005
         BAL   RLINK,INSETX             ADD ETX TO BUFFERS              53850005
         B     LIDLES                   INSERT IDLES                    53900005
NOROOM   EQU   *                                                        53950005
         BCTR  RTCBUF,ZERO              SUBTRACT ONE                    54000005
         MVI   0(RTCBUF),ETX            INSERT ETX                      54050005
         B     AYW00080                 EXIT                            54100005
         SPACE                                                          54150005
CHNGTWX  EQU   *                                                        54200005
         BCTR  RTCBUF,ZERO              SUBTRACT ONE                    54250005
         MVI   0(RTCBUF),CR             CHANGE TO CR FOR TWX            54300005
         LA    RTCBUF,ONE(,RTCBUF)      ADD ONE TO BUFFER               54350005
         NC    WBUFSZ,WBUFSZ            ANY MORE ROOM                   54400005
         BNZ   CHG01                    MORE ROOM LEFT                  54450005
         MVI   CARCT+ONE,NEEDLF         INDIC LF NEEDED                 54500005
         B     AYW00080                 EXIT                            54550005
CHG01    EQU   *                                                        54600005
         BAL   RLINK,SNLF               INSERT LF                       54650005
         B     LIDLES                   INSERT IDLES AND EXIT           54700005
         SPACE                                                          54750005
EBUF     EQU   *                                                        54800005
         BAL   RLINK,QTIPR              GO UPDATE TSO BUFFER            54850005
         TM    SAVX1,TWO                WAS THIS MSG EQUAL TCAM BUF     54900005
         BZ    LNCHK                    NO. CHECK IF END OF LINE        54950005
         B     AYW00090                 INCOMPLETE MOVE                 55000005
         SPACE                                                          55050005
*  NBR OF CHAR MOVED IS LESS THAN OR EQUAL TO LINESIZE, BUT THERE IS    55100005
*  NO MORE ROOM IN THE TCAM BUFFER.                                     55150005
LNCHK    EQU   *                                                        55200005
         NC    LINE,LINE                ANY ROOM ON LINE                55250005
         BNZ   AYW00090                 YES, OUT OF BUFFERS             55300005
         BAL   RLINK,SMCALL             NO. COUNT ONE LINE              55350005
         TM    AVTPARM3+THREE,DCTNOIDL  IS THIS A 2260 REMOTE  @G36XRYP 55400000
         BZ    AYW00080                 EXIT                            55450005
         BCTR  RTCBUF,ZERO              WILL HAVE TO OVERLAY TO GET ETX 55500005
         MVI   ZERO(RTCBUF),ETX         INSERT ETX                      55550005
         B     AYW00080                 EXIT                            55600005
         SPACE                                                          55650005
*  ALL DATA IN TS BUF MOVED.                                            55700005
NEWLINE  EQU   *                                                        55750005
         NC    LINE,LINE                WAS THIS CASE OF END OF LINE    55800005
         BNZ   NEW03                    BRANCH NO                       55850005
*  YES. IS END OF THE LINE. THE FOLLOWING CODE CHECKS FOR ROOM TO       55900005
*  INSERT NL (2741),OR LF/CR (TWX). IF THERE WILL NOT BE ROOM, THEN     55950005
*  QCBDEND IN QCBRETCT WILL BE TURNED ON. THE CALL TO QTIP WILL         56000005
*  REDUCE THE 'MOVED' COUNT BY 1 TO FORCE A NEW ENTRY. AT THAT TIME,    56050005
*  THE NL OR CR/LF WILL BE INSERTED, AND THE NEXT BUFFER WILL BE        56100005
*  PICKED UP AND HANDLED.                                               56150005
         TM    LCBTSOB,LCB2741N         IS THIS A 2741 TERM             56200005
         BZ    NEW02                    BRANCH NO                       56250005
NEW01    EQU   *                                                        56300005
         CLI   WBUFSZ+ONE,ZERO          IS TCAM BFR FULL?               56350005
         BNE   NEW03                    IF NOT IS FALSE ALARM           56400005
         TM    AVTPARM3+THREE,DCTNOIDL  IS IT 2260 REMOTE      @G36XRYP 56450000
         BO    NEW05                    IF SO, EXIT UNLESS BUFFNLCR ON  56500005
NEW06    EQU   *                                                        56550005
         OI    QCBRETCT,QCBDEND         SET SPECIAL FLAG                56600005
         BAL   RLINK,QTIPR              UPDATE BUFFER POINTERS          56650005
         B     AYW00090                 GO GET A NEW BUFFER             56700005
NEW05    EQU   *                                                        56750005
         TM    BUFFFL1,BUFFNLCR         END OF MSG                      56800005
         BO    NEW06                    BRANCH YES                      56850005
         BAL   RLINK,QTIPR              UPDATE BUFFER                   56900005
         B     AYW00090                 WAIT FOR NEW BUFFER             56950005
NEW02    EQU   *                                                        57000005
         TM    AVTPARM3+TWO,DCTTWX      IS IT A TWX LINE       @G36XRYP 57050000
         BO    NEW01                    TREAT SAME AS FOR 2741          57100005
         TM    AVTPARM3+THREE,DCTNOIDL  SEE IF 2260 REMOTE     @G36XRYP 57150000
         BO    NEW01                    SAME LOGIC. IT NEEDS ETX        57200005
         TM    AVTPARM3+TWO,DCTLOCAL    IS IT 2260 LOCAL       @G36XRYP 57250000
         BZ    NEW01                    NO. ASSUME IT MUST BE 1050      57300005
NEW03    EQU   *                                                        57350005
         NC    WBUFSZ,WBUFSZ            SEE IF TCAM EMPTY               57400005
         BNZ   NEW04                    BRANCH NOT EMPTY                57450005
         TM    AVTPARM3+THREE,DCTNOIDL  IS THIS 2260 REMOTE    @G36XRYP 57500000
         BO    NEW01                    BRANCH YES FOR FAKE             57550005
NEW04    EQU   *                                                        57600005
         BAL   RLINK,QTIPR              UPDATE TS BUFFER                57650005
         LH    RTEMP,MSGLEN             SEE IF ANY MORE MSG CHAR        57700005
         LTR   RTEMP,RTEMP              COUNT = 0?                      57750005
         BNZ   MOREDA                   BRANCH NO TO CHK NEXT BFR       57800005
*  THIS MAY BE THE END OF MESSAGE OR BUFFERS.                           57850005
         TM    WFLGS,TSOASIS+CONTROLM   ASIS OR CTL NO NL AT END        57900005
         BM    ASISCHK                  ASIS MODE                       57950005
         TM    BUFFFL1,BUFFNLCR         IS THIS LAST BUFFER             58000005
         BO    LINE0                    LAST BUFFER                     58050005
         NC    LINE,LINE                ANY MORE ROOM THIS LINE         58100005
         BNZ   NOLINE                   ROOM LEFT LINE                  58150005
LINE0    EQU   *                                                        58200005
         BAL   RLINK,SMCALL             COUNT LINE                      58250005
NOLINE   EQU   *                                                        58300005
*  EDIT MODE. INSERT WHATEVER NECESSARY TO START NEXT MESSAGE           58350005
*  AT BEGINNING OF NEXT LINE.                                           58400005
         SPACE                                                          58450005
         TM    AVTPARM3+THREE,DCTNOIDL  IS DEVICE 2260 REMOTE? @G36XRYP 58500000
         BNO   NOT2260R                 BRANCH ON NO                    58550005
         CLI   TSBUFR,NLCHAR            WAS LAST CHAR A NL              58600005
         BNE   ED01                     NO                              58650005
         B     SWNL                     GO CHANGE NL TO CR              58700005
ED01     EQU   *                                                        58750005
         TM    BUFFFL1,BUFFNLCR         LAST BUFFER                     58800005
         BO    ED03                     BRANCH END OF MSG               58850005
         BAL   RLINK,INSETX             APPEND ETX                      58900005
         B     AYW00070                 SUCCESSFUL COMPLETION           58950005
ED03     EQU   *                                                        59000005
         NC    LINE,LINE                END OF SCREEN LINE?             59050005
         BZ    JUSTETX                  BRANCH YES. CR NOT NEEDED       59100005
         BAL   RLINK,INSNL              NO. ADD CR AND ETX              59150005
JUSTETX  EQU   *                                                        59200005
         BAL   RLINK,INSETX             ADD ETX                         59250005
         B     JUSTIDL                  ADD IDLES                       59300005
         SPACE                                                          59350005
NOT2260R EQU   *                                                        59400005
         TM    AVTPARM3+TWO,DCTLOCAL    IS IT LOCAL 2260       @G36XRYP 59450000
         BO    ITSLOC                   YES                             59500005
         CLI   TSBUFR,NLCHAR            WAS LAST CHARACTER AN NL?       59550005
         BE    CTWX03                   YES. CHECK FOR TWX LINE         59600005
AYW01440 EQU   *                                                        59650005
         TM    BUFFFL1,BUFFNLCR         THIS THE END OF MSG             59700005
         BZ    GETLATER                 NO, BRANCH                      59750005
LEND     EQU   *                                                        59800005
         BAL   RLINK,INSNL              PUT IN NL                       59850005
JUSTIDL  EQU   *                                                        59900005
         BAL   RLINK,SNDIDLES           INSERT IDLES                    59950005
         B     AYW00070                 SUCCESSFUL COMPLETION           60000005
         SPACE                                                          60050005
CTWX03   EQU   *                                                        60100005
         TM    AVTPARM3+TWO,DCTTWX      IS IT TWX              @G36XRYP 60150000
         BZ    JUSTIDL                  NO                              60200005
         BCTR  RTCBUF,ZERO              BACK OFF                        60250005
         MVI   0(RTCBUF),CR             REPLACE WITH CR                 60300005
         LA    RTCBUF,ONE(,RTCBUF)      ADD ONE TO BUFFER               60350005
         BAL   RLINK,SNLF               ADD LINE FEED                   60400005
         B     JUSTIDL                  ADD IDLES                       60450005
         SPACE                                                          60500005
         SPACE                                                          60550005
*  COULD BE LOCAL 2260. IF SO, NL IS NOT NEEDED                         60600005
NOTR     EQU   *                                                        60650005
         TM    AVTPARM3+TWO,DCTLOCAL    IS IT A LOCAL          @G36XRYP 60700000
         BO    JUSTIDL                  BRANCH 2260 LOCAL               60750005
         CLI   0(RTCBUF),NLCHAR                                         60800005
         BNE   LEND                     NOT NEW LINE CHAR               60850005
         TM    AVTPARM3+TWO,DCTTWX      IS IT TWX LINE         @G36XRYP 60900000
         BO    TWXCR                    YES                             60950005
         B     JUSTIDL                  INSERT IDLES                    61000005
         SPACE                                                          61050005
CK60R    EQU   *                                                        61100005
         TM    AVTPARM3+TWO,DCTLOCAL    2260 LOCAL             @G36XRYP 61150000
         BO    JUSTIDL                  YES. JUST CLR COUNT AND GO      61200005
         TM    AVTPARM3+THREE,DCTNOIDL  IS IT REMOTE           @G36XRYP 61250000
         BZ    LEND                     NO, BRANCH                      61300005
         BAL   RLINK,INSETX             ADD ETX                         61350005
         B     JUSTIDL                  ADD IDLES                       61400005
SWNL     EQU   *                                                        61450005
         BCTR  RTCBUF,ZERO              BACK OFF                        61500005
         MVI   0(RTCBUF),CR             OVERLAY WITH CR                 61550005
         LA    RTCBUF,ONE(,RTCBUF)                                      61600005
         B     JUSTETX                  ADD ETX                         61650005
         SPACE                                                          61700005
ITSLOC   EQU   *                                                        61750005
         CLI   TSBUFR,NLCHAR            WAS LAST ONE AN NL              61800005
         BE    JUSTIDL                  YES                             61850005
         NC    LINE,LINE                ROOM LEFT THIS LINE             61900005
         BZ    JUSTIDL                  NO, ADD IDLES                   61950005
         B     AYW01440                 BRANCH                          62000005
         SPACE                                                          62050005
*  MORE DATA IN THIS MSG. PROBABLY OWAIT.                               62100005
*  INSERT NL/IL ONLY IF END OF A LINE.                                  62150005
GETLATER EQU   *                                                        62200005
         NC    LINE,LINE                ANY ROOM ON LINE                62250005
         BZ    CK60R                    CHK FOR 2260R                   62300005
         NI    QCBRETCT,NOT-QCBNL       CLEAR NL/CR BITS                62350005
*  STILL HAVE ROOM ON THIS LINE.                                        62400005
*  SET RETURN CODE 0, AND LEAVE QCBCARCT AS IT IS.                      62450005
         B     AYW00070                 SUCCESSFUL COMPLETION           62500005
         SPACE                                                          62550005
*  MSGLEN=0 WHEN ENTERED.                                               62600005
ASISCHK  EQU   *                                                        62650005
         TM    BUFFFL1,BUFFNLCR         IS THE LAST BUFFER              62700005
         BO    ASIS                     YES, IS END OF MSG              62750005
*  ASIS AND NOT THE LAST BUFFER                                         62800005
         NC    LINE,LINE                IS IT END OF A LINE             62850005
         BNZ   AS60CK                   SEE IF A 2260 REMOTE            62900005
*  END OF A LINE. LET IT COUNT FOR SIMATTN.                             62950005
         BAL   RLINK,SMCALL             COUNT LINE                      63000005
         TM    AVTPARM3+THREE,DCTNOIDL  2260R                  @G36XRYP 63050000
         BZ    NOTR                     NO                              63100005
         BAL   RLINK,INSETX             ADD ETX TO BUFFERS              63150005
         B     JUSTIDL                  NOW WE CAN LEAVE                63200005
         SPACE                                                          63250005
AS60CK   EQU   *                                                        63300005
         TM    AVTPARM3+THREE,DCTNOIDL  IS IT 2260 REMOTE      @G36XRYP 63350000
         BZ    AYW00070                 SUCCESSFUL COMPLETION           63400005
END60    EQU   *                                                        63450005
         BAL   RLINK,INSETX             APPEND ETX                      63500005
         B     AYW00070                 SUCCESSFUL COMPLETION           63550005
         SPACE                                                          63600005
*  ASIS MODE, END OF MSG. REPLACE AN NL WITH WHATEVER REQUIRED TO BEGIN 63650005
*  NEXT MESSAGE ON A NEW LINE                                           63700005
         SPACE                                                          63750005
ASIS     EQU   *                                                        63800005
         TM    WFLGS,CONTROLM           IS IT CONTROL MODE?             63850005
         BO    AS60CK                   YES. LET IT GO, CHECK FOR 2260  63900005
         TM    AVTPARM3+THREE,DCTNOIDL  IS DEVICE 2260 REMOTE? @G36XRYP 63950000
         BO    AS2260                   BRANCH ON YES                   64000005
         CLI   TSBUFR,NLCHAR            WAS LAST CHARACTER AN NL?       64050005
         BNE   EOLEOM                   COULD BE END LINE OR END MSG    64100005
         BAL   RLINK,SMCALL             COUNT ONE LINE                  64150005
         TM    AVTPARM3+TWO,DCTTWX      THIS A TWX LINE        @G36XRYP 64200000
         BO    TWXCR                    GO FOR TWX CR                   64250005
         B     JUSTIDL                  ADD IDLES                       64300005
TWXCR    EQU   *                                                        64350005
         BCTR  RTCBUF,ZERO              SUBTRACT ONE                    64400005
         MVI   0(RTCBUF),CR             INSERT CARRIAGE RETURN          64450005
         LA    RTCBUF,ONE(,RTCBUF)      ADD ONE TO BUFFER               64500005
         NC    WBUFSZ,WBUFSZ            ANY ROOM LEFT                   64550005
         BNZ   DOLF                     YES, BRANCH                     64600005
         MVI   CARCT+ONE,NEEDLF         INDICATE LINE FEED NEEDED       64650005
         B     AYW00070                 SUCCESSFUL COMPLETION           64700005
DOLF     EQU   *                                                        64750005
         BAL   RLINK,SNLF               PUT IN LINE FEED                64800005
         B     JUSTIDL                  THEN CLEAR CHAR COUNT           64850005
AS2260   EQU   *                                                        64900005
         NC    LINE,LINE                IS THIS END OF A LINE           64950005
         BNZ   ASNO                     NO. COUNT LINE IF ENDS WITH NL  65000005
         BAL   RLINK,SMCALL             COUNT A LINE                    65050005
         CLI   TSBUFR,NLCHAR            WAS LAST CHAR A NL              65100005
         BE    SWNL                     IF SO, CHANGE TO CR             65150005
         B     JUSTETX                  ELSE, JUST ADD ETX              65200005
ASNO     EQU   *                                                        65250005
         CLI   TSBUFR,NLCHAR            WAS LAST CHAR NL                65300005
         BNE   END60                    NO. IS MORE ROOM  THIS LINE     65350005
         BAL   RLINK,SMCALL             COUNT A LINE                    65400005
         B     SWNL                     THEN CHANGE NL TO CR            65450005
         SPACE                                                          65500005
*  END OF MESSAGE. LAST CHAR NOT A NL.                                  65550005
EOLEOM   EQU   *                                                        65600005
         NC    LINE,LINE                END OF A LINE                   65650005
         BNZ   AYW00070                 SUCCESSFUL COMPLETION           65700005
         BAL   RLINK,SMCALL             COUNT LINE                      65750005
         TM    AVTPARM3+TWO,DCTLOCAL    LOCAL 2260             @G36XRYP 65800000
         BO    EOL01                    YES, BRANCH                     65850005
         NC    WBUFSZ,WBUFSZ            ANY ROOM LEFT IN BUFFER         65900005
         BZ    AYW00080                 EXIT                            65950005
         BAL   RLINK,INSNL              YES. PUT IN NL AND IDLES NOW    66000005
EOL01    EQU   *                                                        66050005
         BAL   RLINK,SNDIDLES           INSERT IDLES                    66100005
         B     AYW00070                 SUCCESSFUL COMPLETION           66150005
         SPACE                                                          66200005
MOREDA   EQU   *                                                        66250005
         NC    LINE,LINE                WAS THIS END OF LINE            66300005
         BNZ   NOTEND                   BRANCH ON NO                    66350005
         BAL   RLINK,SMCALL             COUNT LINE                      66400005
         TM    AVTPARM3+THREE,DCTNOIDL  2260 REMOTE            @G36XRYP 66450000
         BO    MOREA                    YES, BRANCH                     66500005
         TM    AVTPARM3+TWO,DCTLOCAL    2260 LOCAL             @G36XRYP 66550000
         BZ    MDA1                     NO, BRANCH                      66600005
         MVI   CARCT+ONE,ZERO                                           66650005
         B     AYW00080                 EXIT                            66700005
MDA1     EQU   *                                                        66750005
         BAL   RLINK,INSNL              INSERT NEW LINE                 66800005
         BAL   RLINK,SNDIDLES           ADD IDLES                       66850005
         B     AYW00080                 EXIT                            66900005
MOREA    EQU   *                                                        66950005
         BAL   RLINK,INSETX             ADD ETX FOR REMOTE              67000005
         MVI   CARCT+ONE,ZERO                                           67050005
         B     AYW00080                 EXIT                            67100005
NOTEND   EQU   *                                                        67150005
         TM    QCBRETCT,QCBDEND                                         67200005
         BZ    MDA2                     NOT SPECIAL CASE                67250005
         NI    QCBRETCT,NOT-QCBDEND     TURN OFF FLAG                   67300005
         TM    AVTPARM3+TWO,DCTTWX      IS IT TWX              @G36XRYP 67350000
         BZ    AYW00090                 NO, EXIT                        67400005
         MVI   0(RTCBUF),LF             LF AS LAST IN BUFFER            67450005
         BAL   RLINK,MVD1               COUNT IT                        67500005
         B     AYW00090                 EXIT NOT ALL                    67550005
MDA2     EQU   *                                                        67600005
         NC    WBUFSZ,WBUFSZ            ANY ROOM LEFT                   67650005
         BZ    AYW00090                 NO, EXIT                        67700005
MDA3     EQU   *                                                        67750005
         TM    FLAG1,TRAILER            IS A TRAILER BFR PRESENT        67800005
         BZ    AYW00090                 INCOMPLETE RETURN               67850005
         L     RTSBUF,BUFFTRLR-ONE      YES. GET ITS ADDRESS            67900005
         LA    RTSBUF,ZERO(,RTSBUF)     CLEAR HIGH BYTE                 67950005
         ST    RTSBUF,TSCURR            STORE AS CURRENT BUFFER         68000005
         LR    RTIOC,RTSBUF             SAVE START ADDRESS OF BUF       68050005
         B     SENDTSO                  CONTINUE  EDIT                  68100005
         SPACE                                                          68150005
SMCALL   EQU   *                                                        68200005
         STM   RLINK,RRTN,AVTDOUBL      SAVE REGISTERS                  68250005
         L     RRTN,AVTTSOPT            POINT TO WORK AREA              68300005
         USING IEDQTSI,RRTN                                             68350005
         L     RRTN,TSISIMAT            ADDR OF SIM ATTN ROUTINE        68400005
         DROP  RRTN                                                     68450005
         LA    RRTN,0(,RRTN)            SEE IF SIM ATTN USED            68500005
         LTR   RRTN,RRTN                SIM ATTN SPECIFIED              68550005
         BZ    NOGO                     NO SIM ATTN                     68600005
         BAL   RLINK,SIXTEEN(RRTN)      CALL IEDAYS                     68650005
NOGO     EQU   *                                                        68700005
         LM    RLINK,RRTN,AVTDOUBL      RESTORE REGISTERS               68750005
         BR    RLINK                    RETURN                          68800005
QTIPR    EQU   *                                                        68850005
         STM   ZERO,ONE,AVTDOUBL        SAVE                            68900005
         STM   FOURTEEN,FIFTEEN,AVTSAVE2 REGISTERS                      68950005
         LH    RRTN,MOVED               DATA MOVED                      69000005
         TM    QCBRETCT,QCBDEND         WAS THIS MSG=BUF CASE           69050005
         BZ    QTIP01                   NO                              69100005
         BCTR  RRTN,ZERO                LEAVE ONE IF BUFFER TO GET BACK 69150005
QTIP01   EQU   *                                                        69200005
         XC    MOVED,MOVED              NONE MOVED NEXT BFR YET         69250005
************************************************************** @G36XRYP 69254000
*        CHANGE DATA OFFSET AND LENGTH FIELD IN THE TSO BUFFER @G36XRYP 69258000
************************************************************** @G36XRYP 69262000
         SR    R0,R0                    CLEAR REG FOR IC       @G36XRYP 69266000
         IC    R0,BUFFOFST              GET OFFSET TO DATA     @G36XRYP 69270000
         AR    R0,RRTN                  ADD LENGTH OF TEXT     @G36XRYP 69274000
*                                       MOVED                  @G36XRYP 69278000
         STC   R0,BUFFOFST              STORE UPDATED OFFSET   @G36XRYP 69282000
         IC    R0,BUFFLNTH              GET DATA LENGTH        @G36XRYP 69286000
         SR    R0,RRTN                  ADJUST BY AMOUNT MOVED @G36XRYP 69290000
         STC   R0,BUFFLNTH              STORE UPDATED LENGTH   @G36XRYP 69294000
         LM    ZERO,ONE,AVTDOUBL        RESTORE                         69350005
         LM    FOURTEEN,FIFTEEN,AVTSAVE2 REGISTERS                      69400005
         BR    RLINK                    RETURN                          69450005
         SPACE                                                          69500005
F8       DC    F'8'                     STCB OFFSET                     69550005
VEDIT    DC    A(EDIT)                  EDIT SUBROUTINE                 69600005
K15      DC    F'15'                    HEX 15                          69650005
         SPACE                                                          69700005
**  RNDX HAS AMOUNT OF DATA TO BE MOVED. RTSBUF/RTCBUF ARE MOVE ADDR    69750005
EDIT     EQU   *                                                        69800005
         ST    RLINK,AVTDOUBL+FOUR      SAVE REGISTERS                  69850005
         TM    QCBRETCT,QCBDEND         WAS TCAM SIZE REDUCED           69900005
         BZ    ED02                     NO                              69950005
         LA    RNDX,ONE(,RNDX)          YES. ADD IT BACK TO EDIT        70000005
ED02     EQU   *                                                        70050005
         LR    RTEMP,RNDX               SAVE COUNT                      70100005
         XC    DEND(FOUR),DEND                                          70150005
         BCTR  RNDX,ZERO                REDUCE FOR EX                   70200005
         EX    RNDX,MOVDATA             MOVE DATA                       70250005
*  BEFORE POINTERS ARE UPDATED, CHECK CHARACTERS JUST MOVED FOR         70300005
*  VALIDITY. IN EDIT OR ASIS MODE, AN EOT OR EOB WILL BE REPLACED.      70350005
*  IN EDIT MODE ONLY WILL CERTAIN CHARACTERS BE REPLACED. THESE ARE     70400005
*  BYPASS, RESTORE, HORIZONTAL TABS AND NL CHARACTERS. THEY WILL BE     70450005
*  OVERSTORED WITH THE COLON (:). IN ASIS OR EDIT MODE, THE TCAM        70500005
*  TRANSLATION TABLES WILL TRANSLATE UPPRINTABLE CHARACTERS TO SOME     70550005
*  PRINTABLE CHARACTER TO AVOID PROGRAM-CAUSED I/O ERRORS.              70600005
         SPACE                                                          70650005
         LR    RTEMPA,RTCBUF                                            70700005
         TM    WFLGS,CONTROLM           CONTROL MODE                    70750005
         BO    REDUC                    BRANCH YES                      70800005
LOOPY    EQU   *                                                        70850005
         CLI   0(RTEMPA),X'3F'          IN CONTROL RANGE                70900005
         BH    LOOPX                    NO                              70950005
CTAB     EQU   *                                                        71000005
         CLI   0(RTEMPA),EOT                                            71050005
         BE    REPLCH                   REPLACE WITH COLON              71100005
         CLI   0(RTEMPA),LC             DOWN SHIFT                      71150005
         BE    CTAB1                    YES, BRANCH                     71200005
         TM    WFLGS,TSOASIS            ASIS MODE?                      71250005
         BZ    NOIS                     NO                              71300005
         CLI   0(RTEMPA),IDLECHAR       IDLE                            71350005
         BE    CTAB1                    YES, BRANCH                     71400005
         CLI   0(RTEMPA),LF             ALSO LET LINE FEED GO           71450005
         BE    CTAB1                    YES, BRANCH                     71500005
         CLI   ZERO(RTEMPA),CR          IS CHAR A CARRIAGE RET     @11A 71550026
         BE    CTAB2                    YES, CR ALLOWED ASIS       @11A 71560026
NOIS     EQU   *                                                        71650005
         CLI   0(RTEMPA),BSP            BACKSPACE CAN GO IN EITHER MODE 71700005
         BE    TESTBS                   DEPENDS ON CHAR DEL CHAR        71750005
         CLI   0(RTEMPA),RES            RESTORE CHAR                    71800005
         BE    CMOD                     OK FOR ASIS, OUT FOR EDIT       71850005
         CLI   0(RTEMPA),BYP                                            71900005
         BE    CMOD                     OK FOR ASIS, OUT FOR EDIT       71950005
         CLI   0(RTEMPA),PRE                                            72000005
         BE    CMOD                     OK FOR ASIS, OUT FOR EDIT       72050005
         CLI   0(RTEMPA),HTAB           HORIZONTAL TAB                  72100005
         BE    CMOD                     YES, BRANCH                     72150005
         CLI   0(RTEMPA),CR             IF CR, REPLACE WITH NL          72200005
         BE    REPLCR                   YES, BRANCH                     72250005
         CLI   0(RTEMPA),NLCHAR         IF NL, IS SPECIAL               72300005
         BE    CKNL                     YES, BRANCH                     72350005
         B     REPLCH                   REPLACE ANY OTHER IN CTL RANGE  72400005
         SPACE                                                          72450005
CTAB1    EQU   *                                                        72500005
         TM    AVTPARM,THREE            2260                            72550005
         BM    REPLCH                   YES, BRANCH                     72600005
         B     NOTAB                    LET GO BUT NON-PRINT   @SA69640 72650057
         EJECT                                                          72700005
CTAB2    EQU   *                                                        72750005
         TM    AVTPARM3+THREE,DCTNOIDL  IS THIS 2260 REMOTE    @G36XRYP 72800000
         BO    CTAB3                    B YES TO RPLACE WITH CR         72850005
         TM    AVTPARM3+TWO,DCTTWX      OR IS IT TWX           @G36XRYP 72900000
         BZ    LOOPX                    OTHERS GO AS IS                 72950005
CTAB3    EQU   *                                                        73000005
         MVI   ZERO(RTEMPA),CR          OVERLAY FOR TWX/2260R           73050005
         B     LOOPX                    THEN RETURN TO MAIN CODES       73100005
         SPACE                                                          73150005
TESTBS   EQU   *                                                        73200005
         TM    AVTPARM,THREE            2260?                           73250005
         BM    REPLCH                   YES, BRANCH                     73300005
         TM    AVTPARM3+TWO,DCTTWX      IS THIS TWX DATA?      @G36XRYP 73350000
         BO    REPWID                   NO BSP FOR TWX. REPLACE W/IDLE  73400005
         LH    RLINK,DEND+TWO           COUNT NOT PRINT = 2             73450005
         LA    RLINK,TWO(,RLINK)                                        73500005
         STH   RLINK,DEND+TWO                                           73550005
LOOPX    EQU   *                                                        73600005
         LA    RTEMPA,ONE(,RTEMPA)      STEP TO NEXT CHAR               73650005
         BCT   RTEMP,LOOPY              SEE IF ANY MORE                 73700005
BACK     EQU   *                                                        73750005
         BAL   RLINK,UPDATE             UPDATE COUNTS, POINTERS, ETC.   73800005
         L     RLINK,AVTDOUBL+FOUR      RETRIEVE RETURN ADDR            73850005
         BR    RLINK                    RETURN                          73900005
REPWID   EQU   *                                                        73950005
         MVI   ZERO(RTEMPA),IDLECHAR    OVERLAY BSP W/IDLE              74000005
         LH    RLINK,DEND+TWO           NO PRINT COUNT                  74050005
         LA    RLINK,ONE(,RLINK)        UPDATE BY ONE                   74100005
         STH   RLINK,DEND+TWO           REPLACE IT                      74150005
         B     LOOPX                    RESUME SCAN                     74200005
         SPACE                                                          74250005
CMOD     EQU   *                                                        74300005
         TM    AVTPARM,THREE            2260                            74350005
         BM    REPLCH                   YES, BRANCH                     74400005
         TM    WFLGS,TSOASIS            EDIT OR ASIS                    74450005
         BZ    REPLCH                   EDIT MODE. REPLACE IT           74500005
         CLI   0(RTEMPA),HTAB           WAS THIS TAB                    74550005
         BNE   NOTAB                    NO, BRANCH                      74600005
*  HORIZONTAL TAB. LET IT GO BUT DO NOT CHANGE NON/PRINT COUNT          74650005
         OI    SAVX1,ONE                FLAG FOR UPDATE SUBROUTINE      74700005
         B     LOOPX                    CHECK NEXT                      74750005
NOTAB    EQU   *                        NON PRINT TYPE                  74800005
*  ASIS MODE. LET IT GO BUT ADD TO NON-PRINT COUNT FOR LINE.            74850005
         LH    RLINK,DEND+TWO           NON-PRINT COUNT                 74900005
         LA    RLINK,ONE(,RLINK)        ADD ONE                         74950005
         STH   RLINK,DEND+TWO                                           75000005
         B     LOOPX                    CONTINUE SCAN                   75050005
         SPACE                                                          75100005
*  EDIT MODE. REPLACE WITH COLON.                                       75150005
         SPACE                                                          75200005
REPLCH   EQU   *                                                        75250005
         MVI   ZERO(RTEMPA),COLON       REPLACE CHAR IN TCAM            75300005
         B     LOOPX                    CHECK NEXT                      75350005
         SPACE                                                          75400005
CKNL     EQU   *                                                        75450005
         BCT   RTEMP,CKLST              WAS THIS LAST CHARACTER         75500005
*   NL WAS LAST. IF NOT END OF LINE AND NOT END OF MSG, REPLACE IT      75550005
         LA    RTEMP,ONE                RESTORE INDEX                   75600005
         CLI   SWT2,TWELVE              END OF LINE                     75650005
         BE    LOOPX                    YES                             75700005
         LH    RLINK,BLNTH              GET DATA LENGTH                 75750005
         SR    RLINK,RNDX               SUBTRACT MOVED                  75800005
         BCTR  RLINK,ZERO               SUBTRACT ONE                    75850005
         LTR   RLINK,RLINK              LAST CHAR                       75900005
         BNZ   REPLCH                   NO, BRANCH                      75950005
         L     RLINK,TSBUFR             ADDRESS OF FIRST TS BUFFER      76000005
         TM    BUFFFL1-BUFFFL1(RLINK),BUFFHDR      WAS IT BUFFER        76050005
         BZ    LOOPX                    NO. ASSUME THAT THIS IS THE     76100005
*                                       END OF THE MSG AFTER OWAIT      76150005
         TM    BUFFFL2-BUFFFL1(RLINK),BUFFPART SEE IF PARTIAL MSG       76200005
         BZ    LOOPX                    NO, BRANCH                 @11A 76250026
         NI    WFLGS,NOT-TSOASIS        RESET FLAG                      76300005
         B     LOOPX                    CHECK NEXT                      76350005
CKNL01   EQU   *                                                        76400005
         TM    BUFFFL1,BUFFNLCR         SEE IF END OF MSG               76450005
         BO    LOOPX                    YES, CHECK NEXT                 76500005
         B     REPLCH                   REPLACE                         76550005
CKLST    EQU   *                                                        76600005
         LA    RTEMP,ONE(,RTEMP)        RESTORE COUNT                   76650005
         B     REPLCH                   REPLACE                         76700005
REDUC    EQU   *                                                        76750005
         TM    AVTPARM3+TWO,DCTLOCAL    IS IT 2260 L           @G36XRYP 76800000
         BZ    REDUC01                  NO, BRANCH                      76850005
         LTR   RNDX,RNDX                CHECK FOR 1 CHAR MSG            76900005
         BNZ   REDUC02                  MORE THAN 1                     76950005
*  PROBABLY TCLEARQ TPUT CTRL 1 IDLE. MAKE IT A COLON.                  77000005
         MVI   ZERO(RTCBUF),COLON       INSERT COLON                    77050005
         B     LOOPY                    CHECK NEXT                      77100005
REDUC02  EQU   *                                                        77150005
         BCTR  RNDX,ZERO                SUBTRACT ONE                    77200005
         MVI   ZERO(RTCBUF),COLON       PUT IN A COLON                  77250005
         EX    RNDX,MOVIDL              PROPAGATE ALL                   77300005
         LA    RNDX,ONE(,RNDX)          RESET INDEX                     77350005
         B     LOOPY                    CHECK NEXT                      77400005
REDUC01  EQU   *                                                        77450005
         EX    RNDX,CTLTR               TEST CONTROL CHARS              77500005
         LR    RRTN,RTEMP               CHAR COUNT                      77550005
CTLOOP   EQU   *                                                        77600005
         CLI   ZERO(RTEMPA),COLON       IS CHAR COLON                   77650005
         BNE   NOPRINT                  NO, BRANCH                      77700005
         BCTR  RRTN,ZERO                REDUCE NON-PRINT COUNT          77750005
NOPRINT  EQU   *                                                        77800005
         LA    RTEMPA,ONE(,RTEMPA)      STEP TO NEXT                    77850005
         BCT   RTEMP,CTLOOP             COUNT TEST                      77900005
         STH   RRTN,DEND+TWO            STORE NON-PRINT COUNT           77950005
         B     BACK                     LOOP BACK                       78000005
         SPACE                                                          78050005
REPLCR   EQU   *                                                        78100005
         MVI   ZERO(RTEMPA),NLCHAR      MAKE CR=NL                      78150005
         B     CKNL                     NOW SEE IF IT WAS VALID         78200005
         SPACE                                                          78250005
MOVDATA  MVC   ZERO(ZERO,RTCBUF),ZERO(RTSBUF) MOVE DATA                 78300005
MOVIDL   MVC   ONE(ZERO,RTCBUF),ZERO(RTCBUF) PROPAGATE THE REST         78350005
CTLTR    TR    ZERO(ZERO,RTEMPA),CTLTBL TRANSLATE DATA                  78400005
CTLTBL   EQU   *                                                        78450005
         DC    CL1':'                   C                               78500005
         DC    XL4'01020304'            *O                              78550005
         DC    CL1':'                   **N                             78600005
         DC    XL2'0607'                ***T                            78650005
         DC    6CL1':'                  ****R                           78700005
         DC    XL2'0E0F'                *****O                          78750005
         DC    CL1':'                   ******L                         78800005
         DC    XL1'11'                  *                               78850005
         DC    2CL1':'                  T                               78900005
         DC    XL1'14'                  *A                              78950005
         DC    2CL1':'                  **B                             79000005
         DC    XL1'17'                  ***L                            79050005
         DC    12CL1':'                 ****E                           79100005
         DC    XL1'24'                  *                               79150005
         DC    2CL1':'                  C                               79200005
         DC    XL1'27'                  *H                              79250005
         DC    7CL1':'                  **E                             79300005
         DC    XL1'2F'                  ***C                            79350005
         DC    4CL1':'                  ****K                           79400005
         DC    XL3'343536'              *                               79450005
         DC    9CL1':'                  *                               79500005
         DC    192CL1':'                REST GET COLON                  79550005
AYWPATCH DC    10F'0'                   PATCH AREA                      79600005
         SPACE                                                          79650005
         EJECT                                                          79700005
GMAIN    DSECT                                                          79750005
TSBUFR   DS    F                        TSO BUF OR MSGGEN ADDRESS       79800005
TCBUFR   DS    F                        TCAM/SCB ADDRESS                79850005
MOVED    DS    H                        DATA MOVED                      79900005
LINE     DS    H                        LINE SIZE REMAINING             79950005
BLNTH    DS    H                        TSO BUFFER DATA SIZE            80000005
MSGLEN   DS    H                        MESSAGE SIZE                    80050005
WBUFSZ   DS    H                        TCAM BUFFER SIZE                80100005
*                                                                     * 80150005
CARCT    DS    H                        QCBCARCT                        80200005
*                             BIT DEFINITIONS                         * 80250005
SBASCND  EQU   X'F0'                    SECOND ENTRY OFFSET             80300005
CUR1SCND EQU   X'F1'                    SECOND ENTRY OFFSET             80350005
CUR2SCND EQU   X'F2'                    SECOND ENTRY OFFSET             80400005
STFDSCND EQU   X'F3'                    SECOND ENTRY OFFSET             80450005
RDATSCND EQU   X'F4'                    SECOND ENTRY OFFSET             80500005
INCSCND  EQU   X'F5'                    SECOND ENTRY OFFSET             80550005
ETXSCND  EQU   X'F6'                    SECOND ENTRY OFFSET             80600005
EOTSCND  EQU   X'F7'                    SECOND ENTRY OFFSET             80650005
*                                                                     * 80700005
LINESV   DS    H                        FROM TSB OR DEFAULT             80750005
*                                                                     * 80800005
LINENUM  EQU   LINESV                   DISPLAY NUMBER OF LINES         80850005
LINESIZE EQU   LINESV+1                 DISPLAY LINE SIZE               80900005
*                                                                     * 80950005
SWT1     DS    X                        SWITCH 1                        81000005
*                             BIT DEFINITIONS                         * 81050005
CUR2FLAG EQU   X'80'                    SECOND CURSOR FLAG              81100005
CUR1FLAG EQU   X'40'                    FIRST CURSOR FLAG               81150005
RDATTNLF EQU   X'20'                    READ ATTRIBUTE BYTE FLAG        81200005
SFATTSW  EQU   X'10'                    START FIELD FLAG                81250005
BYPFLAG  EQU   X'08'                    BYPASS FLAG                     81300005
CRNL     EQU   X'04'                    CARRIAGE RETURN/NEWLINE FLAG    81350005
SBAENDSW EQU   X'02'                    SET BUFFER ADDRESS FLAG         81400005
INCSW    EQU   X'01'                    INSERT CURSOR FLAG              81450005
*                                                                     * 81500005
SWT2     DS    X                        SWITCH 2                        81550005
*                             BIT DEFINITIONS                         * 81600005
RETCOD4  EQU   4                        CALCSIZE RETURN CODE 4          81650005
RETCOD8  EQU   8                        CALCSIZE RETURN CODE OF 8       81700005
RETCOD12 EQU   12                       CALCSIZE RETURN CODE OF 12      81750005
RETCOD16 EQU   16                       CALCSIZE RETURN CODE OF 16      81800005
RETCOD40 EQU   40                       CALCSIZE RETURN CODE NO ROOM    81850005
*                                                                     * 81900005
WFLGS    DS    H                        TSO FLAGS                       81950005
*                             BIT DEFINITIONS                         * 82000005
TSOMSG   EQU   X'80'                    TSO ENTRY                       82050005
CONTROLM EQU   X'40'                    CONTROL MODE                    82100005
TSOASIS  EQU   X'20'                    TSO TPUT ASIS                   82150005
FRSTMGEN EQU   X'10'                    FIRST MSGGEN IND                82200005
NOLEFT   EQU   X'06'                    NO LEFT JUSTIFICATION REQUEST   82250005
LEFT     EQU   X'05'                    LEFT JUSTIFICATION REQUEST      82300005
*                                                                     * 82350005
SAVX1    DS    H                        SCREEN CURSOR ADDRESS           82400005
*                                                                     * 82450005
FLAG1    DS    X                        FLAG BYTE 1                     82500005
*                             BIT DEFINITIONS                         * 82550005
TRAILER  EQU   X'80'                    TRAILER BUFFER FLAG             82600005
FLASHBCK EQU   X'40'                    FLASHBACK REQUESTED FLAG        82650005
RESTSW   EQU   X'20'                    RESTORE CHAR FLAG      @SA73817 82660058
RECALC   EQU   X'10'                    USED LOCALLY IN AYB.   @SA75159 82670058
*                                       BYPASS CODE AND RESET  @SA75159 82680058
EOTSW    EQU   X'02'                    EOT FLAG                        82700005
ETXSW    EQU   X'01'                    ETX FLAG                        82750005
*                                                                     * 82800005
FLAG2    DS    X                        FLAG BYTE 2                     82850005
*                             BIT DEFINITIONS                         * 82900005
X3705    EQU   X'80'                    TERMINAL ON A 3705              82950005
X1050    EQU   X'40'                    DEVICE IS A 1050                83000005
NLCRFLAG EQU   X'10'                    NL/CR COUNT FLAG                83050005
NWLNCNT  EQU   X'08'                    LINE COUNT FLAG                 83100005
CARRDATT EQU   X'04'                    READ ATTRIBUTE LINE POS FLAG    83150005
HEADERFG EQU   X'02'                    FIRST BASIC UNIT FLAG           83200005
NOMOVECT EQU   X'01'                    NO MOVECOUNT FLAG               83250005
*                                                                     * 83300005
SAVX2    DS    H                        FIRST/LAST CHARACTER            83350005
TOR      DS    F                        DATA COUNT                      83400005
FROMR    DS    F                        DATA COUNT MOVED                83450005
TSCURR   DS    F                        CURRENT TSO BUFFER              83500005
MSGNLNTH DS    H                        LENGTH OF MSGGEN DATA           83550005
DEND     DS    D                        DOUBLE SAVE                     83600005
SIZE     EQU   *-GMAIN                  LENGTH OF WORKAREA              83650005
         EJECT                                                          83700005
         IKJTIOCB                                                       83750005
         SPACE                                                          83770000
         IKJTIOCP                                                       83950005
         SPACE                                                          84000005
         TTNTD                                                          84050005
         SPACE                                                          84100005
         TTSID                                                          84200005
         TPRFD                                                          84250005
         TLCBD                                                          84300005
         TQCBD                                                          84350005
         TSCBD                                                          84400005
         TDCTD                                                          84420000
AYOSRCE  EQU   SCBSRCE+16               CONFORM WITH IEDAYO             84450005
         TAVTD                                                          84500005
         IKJTSB                                                         84600005
         TPRIOR                                                         84650005
         SPACE                                                          84700005
TSOPART  EQU   X'40'                                                    84750005
         END                                                            84800005
