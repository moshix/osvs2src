         TITLE 'IEDAYZ - TSO SCHEDULER ROUTINE'                         00100020
IEDAYZ   CSECT                                                          00102022
         SPACE 3                                                        00104022
*  CHANGE ACTIVITY AS FOLLOWS:                                          00106022
******************** MICROFICHE FLAGS *********************** SUPT CODE 00108022
*C064000-064200,064400,065000,163000,194000,211940,212025,213300,S21903 00110022
*C237170,237808,238000-238860,327000,352600,371000,413500,576000,S21903 00110122
*C578400,629000,688700,707000,733000,819000,843000,903000,971000,S21903 00110222
*C971070,036100-036600,036800,040000-048000,064600,066000,113000 S21903 00110322
*A003936,036660-036730,211766-211772,238360-238380,238820-238860 S22028 00110422
*A765013,765022,789023-789026,789161-789167,789185               S22028 00110522
*A135000,234900,287000                                          SA55387 00110622
*C002792,002848-002876,003056-003064,003432-003440,              S22028 00110722
*D117000,234600,284000                                          SA55387 00110822
*C068000-069000,177000-178000,211936,237100-237200,404000-404500 S22028 00110922
*C765024                                                         S22028 00111022
*A759000,971000,684200                                           S22029 00111122
*C405000,763200,764000                                           S22029 00111222
*D405500-413500,581000-584000                                    S22029 00111322
*A684120,684200                                                   M2550 00111422
*C069000,602600,682350                                            M2550 00111522
*D682350-682900                                                   M2550 00111622
*A318400                                                          M5954 00111722
*C069000                                                          M5954 00111822
*A729000                                                          M6360 00111922
*C069000,688000,729000,730500                                     M6360 00112022
*A688200,689000,729100                                           A42370 00112122
*A723400                                                         A42372 00112222
*A161000                                                         A44022 00112322
*A235800                                                         A44022 00112422
*A328500                                                         A44022 00112522
*C069000,723400                                                  A42372 00112622
*C069000                                                          M0892 00112722
*C684220,684340                                                   M0892 00112822
*A688200,689000,729100                                           A42370 00112922
*A689650                                                          M0892 00113022
*A687210,687290                                                   M0892 00113122
*A723400                                                         A42372 00113222
*A814010-814050,903010,903020                                    A52506 00113322
*C816000,818000,824000                                           A52506 00113422
*C830000,834000,836000,881000,882000,884000,887000,890000        A52506 00113522
*770003-770030,036805-036815,C776000                            SA56332 00113622
*A354000-355000,216000-217000                                   SA56307 00113722
*A763290                                                        SA59184 00113822
*A237050,237100                                                 SA59987 00113922
*D236800                                                        SA59987 00114022
*C232340-232360                                                 SA62315 00114122
*D684206-684212                                                 SA62394 00114205
*A189000,190000                                                 SA65440 00114405
*D689650-689700                                                 SA68242 00114505
*A689000                                                        SA68242 00114605
*A689650                                                        SA68242 00114705
*D689800                                                        SA68242 00114805
*C237760,765015,765021-765024                                  @SA71937 00115061
*A237784                                                       @SA71937 00115261
*C842000,843000                                                @SA73152 00115461
*C067000,640000                                                  Y01004 00115861
*C003520,003884,031000-032000,187000,199500,317200,789320-789330 X02004 00116861
*D185000,188000,199600-199700,317800,789340                      X02004 00117861
*A064350                                                         Y01948 00118861
*C003964,057000,064300,364000                                    Y01948 00119861
*D002176,002476-002504,002904-002928,003160-003208,003576-003616,Y01948 00120861
*D003872-003876,003900,003968-003972,028000-029000,033000,063000,Y01948 00121861
*D125000,154000,288000,313000,343000,368000,789700               Y01948 00122861
*A233060                                                        OY00523 00123861
*A 204600,727000                                               @SA68674 00124861
*C 205400,728700-728800                                        @SA68674 00125861
*D884800,884900                                                @YA05130 00126861
*C684000                                                       @YA05164 00127861
*A689650                                                        OY03940 00134805
*C689600                                                        OY03940 00154805
*D689100-689200,689700                                          OY03940 00174805
*D001143,884100-884900                                         @YA05475 00174961
*C237760                                                       @ZA03087 00175081
* C684006-684008                                               @YA07698 00175181
*A237784                                                       @YA08799 00175281
*C233040,237760                                                @YA08799 00175381
*A236100                                                       @SA74985 00175481
*D881000-903020                                                @YA10969 00175581
*A881000                                                       @YA10969 00175681
*A843600                                                       @SA76279 00175781
*D765021                                                       @OY12417 00175881
*                                                                       00195022
         SPACE 3                                                        00197022
*                                                                     * 00200522
*A682620-682860                                                @SA67152 00215261
*C429000,505000,789030                                         @ZA01117 00215461
*C682620-682780                                                @SA67152 00215661
*        TCAM LEVEL 10 CHANGES                                 @G36XRYP 00215700
*                                                              @G36XRYP 00215800
*A211720,237140,577000,591000,985000                           @G36XRYP 00215900
*C192000,211766,211780,211840,211880,211937,237120,237140      @G36XRYP 00216000
*C237808,327000,577000,733000,765022,792000,921000             @G36XRYP 00216100
*C210600,236700,347000,733992                                  @OY14092 00216210
*A761100                                                       @OY14092 00216310
*D232400-232600                                                @YA12685 00216410
*D789010,789020                                                @OZ14196 00216510
*A002900,A003156,A036800,C057000,C513000,A517000               @OZ14196 00216610
*D002904-002928,003160-003200,517800-532600                    @OZ17622 00216710
*C057000,513000-516000                                         @OZ17622 00216810
*A684360                                                       @OZ28271 00216900
*C765027                                                       @OZ28271 00217000
*A122000                                                       @OY20733 00217100
*D237560,237570                                                @OY20841 00217200
*C205400-205700,728500-728840                                  @OS76502 00217300
*A178200                                                       @OZ35418 00217412
* $01=OZ41285  JTC2202  79.11.06 047252:                           @01A 00217512
* $02=OZ41495  JTC2202  79.11.06 047252:                           @02A 00217612
* $03=OZ41521  JTC2202  79.11.06 047252:                           @03A 00217712
* $P1=ZM11064  JTC2202  80.02.19 098061:                           @P1A 00217825
* $11=OZ44959  JTC2302  80.03.27 398332:                           @11A 00218126
* $21=OZ55529  ETC2402  81.12.21 460025: INCREASE LOOP COUNT       @21A 00218227
*********************************************************************** 00218425
*                                                                     * 00218525
*  TITLE: 'IEDAYZ' TIME SHARING SCHEDULER                             * 00218625
*                                                                     * 00218725
*  $MOD(IEDAYZ) COMP(Y@) PROD(TCAM):                               @01C 00218825
*                                                                     * 00218925
*  DESCRIPTIVE NAME = TIME SHARING SCHEDULER                          * 00219025
*                                                                     * 00219125
*  COPYRIGHT = 'NONE'                                                 * 00219225
*                                                                     * 00219325
*  STATUS:  VERSION 10.0                                       @G36XRYP 00219425
*                                                                     * 00219525
*FUNCTION --  THE FUNCTION OF THE TIME SHARING SCHEDULER VARIES, DE-  * 00219625
*   PENDING UPON THE ROUTINE FROM WHICH IT RECEIVES CONTROL, AND THE  * 00219725
*   ENTRY POINT.                                                      * 00219825
*      WHEN THIS ROUTINE IS ENTERED FROM THE LEASED RECEIVE SCHEDULER * 00219925
*   (IGG019R3), IT LINKS TO THE TERMNAME TABLE CODE (IEDQTNT) TO GET  * 00220030
*   THE TERMINAL ENTRY, FROM WHICH IT EXTRACTS THE DESTINATION QCB    * 00220430
*   ADDRESS.  IF THE TERMINAL IS NOT DEDICATED TO A TIME SHARING      * 00220830
*   SESSION, THE LCB POINTER TO THE CURRENT INVITATION LIST ENTRY IS  * 00221230
*   UPDATED, AND CONTROL RETURNS TO THE LEASED RECEIVE SCHEDULER.  IF * 00221630
*   A TIME SHARING SESSION IS IN PROGRESS WITH THE TERMINAL, THIS     * 00222030
*   ROUTINE CHECKS VARIOUS SCHEDULING BITS IN THE QCB TO DETERMINE    * 00222430
*   WHETHER OR NOT TO INITIATE A READ OPERATION.  IF A HARDWARE       * 00222830
*   ATTENTION INTERRUPT HAS JUST BEEN RECEIVED, THIS ROUTINE SETS OFF * 00223230
*   THE SIMULATED ATTENTION READ REQUEST BIT IN THE QCB AND EXITS TO  * 00223630
*   THE DISPATCHER POST FUNCTION TO POST THE LCB TO THE ATTENTION     * 00224030
*   ROUTINE SPECIFIED IN THE MH.  WHEN THE DECISION TO START A READ   * 00224430
*   OPERATION OR NOT HAS BEEN MADE, THIS ROUTINE DETERMINES IF A RE-  * 00224830
*   QUEST FOR A SIMULATED ATTENTION READ IS PRESENT WHICH OVERRIDES   * 00225230
*   THE PREVIOUS DECISION.  IF SO, THE SPECIAL SIMULATED ATTENTION    * 00225630
*   READ CHANNEL PROGRAM WILL BE INITIATED.                           * 00226030
*      IF NO READ OPERATION IS TO BE STARTED, THIS ROUTINE CHECKS TO  * 00226430
*   SEE IF A SIMULATED ATTENTION BY TIME DELAY INTERVAL WAS REQUESTED.* 00226830
*   IF IT WAS, A CHECK IS MADE TO SEE IF A SEND OPERATION WAS RE-     * 00227230
*   QUESTED OR IF THE QCB IS ALREADY IN THE TIME DELAY QUEUE.  IF     * 00227630
*   NEITHER OF THESE CONDITIONS EXISTS, THIS ROUTINE SETS THE PRIOR-  * 00228030
*   ITY, THE TIME DELAY INTERVAL, AND THE TIME DELAY FLAG IN THE QCB  * 00228430
*   AND LINKS TO THE TIME DELAY SUBTASK (IEDQHG) TO INSERT THE QCB    * 00228830
*   INTO THE TIME DELAY QUEUE.  THIS ROUTINE THEN UPDATES THE INVI-   * 00229230
*   TATION LIST POINTER TO POINT TO THE NEXT ENTRY, UPDATES THE LCB   * 00229630
*   POINTER TO THE CURRENTLY CONNECTED TERMINAL, AND BRANCHES BACK TO * 00230030
*   THE BEGINNING TO GET THE TERMINAL ENTRY AND QCB ADDRESS FOR THE   * 00230430
*   NEW TERMINAL AND REPEAT THE PROCEDURE FOR IT.  WHEN THE END OF    * 00230830
*   THE INVITATION LIST IS REACHED, THIS ROUTINE CHECKS TO SEE IF     * 00231230
*   ANY ENTRIES WERE POLLED.  IF THEY WERE, THE START OF POLLING LIST * 00231630
*   BIT IS SET ON IN THE LCB, AND CONTROL RETURNS TO THE LEASED RE-   * 00232030
*   CEIVE SCHEDULER.  IF NO ENTRIES WERE POLLED, THIS ROUTINE SETS    * 00232430
*   THE LCB INVITATION LIST POINTER TO POINT TO THE FIRST ENTRY AND   * 00232830
*   EXITS TO THE DISPATCHER BYPASS FUNCTION TO IMMEDIATELY ACTIVATE   * 00233230
*   THE NEXT STCB IN THE LCB'S CHAIN.                                 * 00233630
*      IF A READ OPERATION IS TO BE STARTED, THIS ROUTINE CHECKS TO   * 00234030
*   SEE IF THE QCB IS IN THE TIME DELAY QUEUE.  IF IT IS, THIS ROU-   * 00234430
*   TINE LINKS TO THE TIME DELAY SUBTASK TO REMOVE IT FROM THE QUEUE. * 00234830
*   FINALLY, THIS ROUTINE SETS ON THE TIME SHARING BUFFER BIT IN THE  * 00235230
*   LCB, UPDATES THE LCB INVITATION LIST POINTER, AND RETURNS CONTROL * 00235630
*   TO THE LEASED RECEIVE SCHEDULER.                                  * 00236030
*      WHEN THIS ROUTINE IS ENTERED FROM THE DIAL RECEIVE SCHEDULER   * 00236430
*   (IGG019R1), THE SAME TESTS ARE MADE TO DETERMINE WHETHER OR NOT   * 00236830
*   TO INITIATE A READ OPERATION.  THE SAME PROCESSING ALSO OCCURS    * 00237230
*   WHEN A QCB IS TO BE INSERTED INTO OR REMOVED FROM THE TIME DELAY  * 00237630
*   QUEUE, OR IF THE LCB IS TO BE POSTED TO THE ATTENTION ROUTINE.    * 00238030
*      IF NO REGULAR READ OPERATION IS TO BE STARTED, BUT A SIMULATED * 00238430
*   ATTENTION READ WAS REQUESTED, THIS ROUTINE SETS OFF THE NEGATIVE  * 00238830
*   RESPONSE TO POLLING BIT IN THE LCB AND INITIATES THE SPECIAL      * 00239230
*   SIMULATED ATTENTION READ CHANNEL PROGRAM.  OTHERWISE, AFTER PER-  * 00239630
*   FORMING ANY NECESSARY TIME DELAY PROCESSING, THIS ROUTINE FREES   * 00240030
*   THE LINE, PUTS UP A PREPARE CHANNEL PROGRAM ON THE LINE TO MONI-  * 00240430
*   TOR FOR AN ATTENTION INTERRUPT, SETS OFF THE SEND PRIORITY BIT    * 00240830
*   AND THE NEGATIVE RESPONSE TO POLLING BIT IN THE LCB, AND EXITS TO * 00241230
*   THE DISPATCHER DISPATCH FUNCTION TO DISPATCH THE NEXT SUBTASK.    * 00241630
*      IF A REGULAR READ OPERATION IS TO BE STARTED, THIS ROUTINE     * 00242030
*   PERFORMS ANY NECESSARY TIME DELAY PROCESSING AND CHECKS TO SEE IF * 00242430
*   A NEGATIVE RESPONSE TO POLLING WAS RECEIVED ON THE LAST POLL.  IF * 00242830
*   IT WAS, THE LCB IS SET TO RE-POLL, AND A CHECK IS MADE TO SEE IF  * 00243230
*   THE POLLING DELAY INTERVAL IN THE DCB IS ZERO.  IF IT IS NOT, A   * 00243630
*   PREPARE CHANNEL PROGRAM IS PUT UP ON THE LINE TO MONITOR FOR AN   * 00244030
*   ATTENTION INTERRUPT, AND THIS ROUTINE EXITS TO THE DISPATCHER     * 00244430
*   POST FUNCTION TO POST THE LCB TO THE TIME DELAY QCB.  IF THE      * 00244830
*   POLLING DELAY IS ZERO, IF A NEGATIVE RESPONSE TO POLLING WAS NOT  * 00245230
*   RECEIVED, OR IF A SIMULATED ATTENTION READ OPERATION IS TO BE     * 00245630
*   STARTED, THIS ROUTINE SETS ON THE TIME SHARING BUFFER BIT IN THE  * 00246030
*   LCB AND RETURNS CONTROL TO THE DIAL RECEIVE SCHEDULER.  NO UP-    * 00246430
*   DATING OF INVITATION LIST POINTERS TAKES PLACE WHEN ENTRY IS FROM * 00246830
*   THE DIAL RECEIVE SCHEDULER.                                       * 00247230
*      THIS ROUTINE IS ALSO ENTERED FROM THE QEVENT ENTRY POINT IN    * 00250830
*   THE LEASED RECEIVE SCHEDULER WHEN TSO IS IN THE SYSTEM.  QEVENT   * 00251230
*   IS DISPATCHED AS THE LAST STCB IN THE CHAIN OF SCHEDULER STCB'S   * 00251630
*   FOR A LINE.  AFTER LINKING TO THE TERMNAME TABLE CODE AND GETTING * 00252030
*   THE ADDRESSES OF THE DCB, INVITATION LIST, AND DESTINATION QCB,   * 00252430
*   THIS ROUTINE CHECKS TO SEE IF THE FOLLOWING CONDITIONS ARE MET:   * 00252830
*   (1) THE TERMINAL IS DEDICATED TO A TIME SHARING SESSION, (2) A    * 00253230
*   PREPARE IS NOT ALREADY UP ON THE LINE, (3) THE TERMINAL HAS THE   * 00253630
*   ATTENTION FEATURE, (4) AN ATTENTION EXIT WAS SPECIFIED IN THE MH, * 00254030
*   AND (5) THE INVITATION LIST CONSISTS OF ONLY ONE ENTRY.  IF ALL   * 00254430
*   OF THESE CONDITIONS ARE NOT MET, CONTROL IS RETURNED TO THE       * 00254830
*   QEVENT ROUTINE.  THIS ROUTINE NEXT CHECKS TO SEE IF THE TERMINAL  * 00255230
*   IS A 2741.  IF IT IS NOT, A CHECK IS MADE TO SEE IF THE TERMINAL  * 00255630
*   CAN TIME OUT.  IF IT CAN, CONTROL IS RETURNED TO THE QEVENT ROU-  * 00256030
*   TINE.  IF IT IS INHIBITED FROM TIMING OUT, THIS ROUTINE SETS UP   * 00256430
*   A PREPARE ON THE LINE, LINKS TO THE ACTIVATE - I/O GENERATOR      * 00256830
*   MODULE (IEDQKA) TO BUILD THE CHANNEL PROGRAM, AND BRANCHES TO THE * 00257230
*   ROUTINE SPECIFIED BELOW THAT ISSUES THE EXCP.                     * 00257630
*      IF THE TERMINAL IS A 2741, THE LINE IS TO BE FREED.  IF THE    * 00258030
*   LCB INDICATES THAT A CIRCLE D HAS NOT BEEN SENT TO THE 2741, THIS * 00258430
*   ROUTINE GENERATES A WRITE CIRCLE D - PREPARE CHANNEL PROGRAM TO   * 00258830
*   PUT THE LINE INTO RECEIVE MODE AND MONITOR FOR AN ATTENTION INTER-* 00259230
*   RUPT.  IF A CIRCLE D HAS BEEN SENT, THE LINE IS ALREADY IN RE-    * 00259630
*   CEIVE MODE, SO A PREPARE CHANNEL PROGRAM IS GENERATED.  THE CCW   * 00260030
*   STARTING ADDRESS IS SET IN THE LCB.  THIS ROUTINE THEN LOADS THE  * 00260430
*   IOB ADDRESS IN REGISTER 1, ISSUES THE EXCP SVC (SVC 0) TO START   * 00260830
*   THE CHANNEL PROGRAM, AND RETURNS CONTROL TO THE QEVENT ROUTINE.   * 00261230
*      THIS ROUTINE IS ENTERED FROM THE SEND SCHEDULER (IGG019R4)     * 00261630
*   WHEN IT HAS BEEN DISPATCHED OFF THE QCB.  IT FIRST CHECKS TO SEE  * 00262030
*   IF A SIMULATED ATTENTION READ WAS REQUESTED.  IF IT WAS, CONTROL  * 00262430
*   PASSES TO THE DISPATCHER AT DSPUNAV TO REMOVE THE STCB FROM ITS   * 00262830
*   CURRENT QCB AND INSERT IT IN THE SEND SCHEDULER'S QCB.  IF NOT, A * 00263230
*   CHECK IS MADE TO SEE IF A WRITE BREAK HAS BEEN REQUESTED.  IF IT  * 00263630
*   HAS NOT, CONTROL RETURNS TO THE SEND SCHEDULER.  IF A WRITE BREAK * 00264030
*   HAS BEEN REQUESTED, THIS ROUTINE SETS OFF THE READ PRIORITY BIT   * 00264430
*   IN THE QCB AND TESTS SEVERAL STATUS BITS IN THE LCB AND QCB TO    * 00264830
*   DETERMINE WHETHER OR NOT A WRITE BREAK CHANNEL COMMAND CAN BE     * 00265230
*   ISSUED.  IF IT CAN NOT, CONTROL RETURNS TO THE SEND SCHEDULER.    * 00265630
*   IF THE LINE IS LEASED, THIS ROUTINE LINKS TO THE TERMNAME TABLE   * 00266030
*   CODE, GETS THE TERMINAL ENTRY, AND EXTRACTS THE QCB ADDRESS.  IF  * 00266430
*   THE TERMINAL FOR WHICH THE WRITE BREAK WAS REQUESTED IS NOT CUR-  * 00266830
*   RENTLY CONNECTED, CONTROL RETURNS TO THE SEND SCHEDULER.  OTHER-  * 00267230
*   WISE, THIS ROUTINE GETS THE ADDRESS OF THE FIRST BUFFER, SETS THE * 00267630
*   WRITE BREAK IN PROGRESS BIT ON IN THE LCB, GETS THE UCB ADDRESS,  * 00268030
*   AND ISSUES AN IOHALT SVC (SVC 33).  THE IOHALT INTERRUPT WILL BE  * 00268430
*   HANDLED BY LINE END APPENDAGE, WHICH WILL CAUSE A BREAK CHANNEL   * 00268830
*   PROGRAM TO BE EXECUTED.  AFTER THE IOHALT IS ISSUED, CONTROL      * 00269230
*   PASSES TO THE DISPATCHER AT DSPUNAV TO SWITCH THE STCB TO THE     * 00269630
*   SEND SCHEDULER'S QCB.                                             * 00270030
*      IF THIS ROUTINE IS ENTERED FROM THE TIME SHARING DESTINATION   * 00270430
*   SCHEDULER (IEDAYD), A WRITE BREAK HAS BEEN REQUESTED.  THE PRO-   * 00270830
*   CESSING IS THE SAME AS WHEN ENTERED FROM THE SEND SCHEDULER ABOVE,* 00271230
*   EXCEPT THAT THE FIRST TWO CHECKS FOR SIMULATED ATTENTION AND      * 00271630
*   WRITE BREAK ARE BYPASSED, AND CONTROL IS ALWAYS RETURNED TO THE   * 00272030
*   TIME SHARING DESTINATION SCHEDULER.                               * 00272430
*      THIS ROUTINE MAY ALSO BE ENTERED FROM THE SEND SCHEDULER WHEN  * 00272830
*   IT HAS BEEN DISPATCHED OFF THE LCB.  IF A TSO SESSION IS NOT IN   * 00273230
*   PROGRESS, AND NO NON-TSO (QUEUING) FUNCTIONS ARE TO BE PERFORMED, * 00273630
*   CONTROL RETURNS TO THE SEND SCHEDULER TO PUT THE SEND SCHEDULER'S * 00274030
*   STCB BACK IN THE QCB'S CHAIN.  IF A NON-TSO OUTPUT FUNCTION IS TO * 00274430
*   BE PERFORMED, CONTROL RETURNS TO THE SEND SCHEDULER TO INITIATE A * 00274830
*   SEND OPERATION.  IF A TSO SESSION IS IN PROGRESS, THE VARIOUS     * 00275230
*   SCHEDULING BITS IN THE QCB ARE CHECKED TO DETERMINE WHETHER OR    * 00275630
*   NOT TO INITIATE A TSO SEND OPERATION.  IF A SEND OPERATION IS TO  * 00276030
*   BE INITIATED, CONTROL RETURNS TO THE SEND SCHEDULER TO DO SO.  IF * 00276430
*   A SIMULATED ATTENTION READ OR A READ OF A PARTIAL INPUT LINE IS   * 00276830
*   REQUESTED, IT TAKES PRIORITY OVER OUTPUT.  IN THIS CASE, IF THE   * 00277230
*   LCB IS IN THE TIME DELAY QUEUE, THIS ROUTINE LINKS TO THE TIME    * 00277630
*   DELAY SUBTASK TO REMOVE IT.  THEN THE LCB IS POSTED TO ITSELF,    * 00278030
*   AND CONTROL PASSES TO THE DISPATCHER BYPASS FUNCTION TO IMMEDI-   * 00278430
*   ATELY ACTIVATE THE NEXT STCB IN THE LCB'S CHAIN.                  * 00278830
*      THIS ROUTINE IS ENTERED FROM THE ACTIVATE - I/O                * 00279222
*   GENERATOR MODULE BEFORE IT BUILDS AN INPUT OR OUTPUT CHANNEL      * 00279630
*   PROGRAM.  THIS ROUTINE FIRST LINKS TO THE TERMNAME TABLE CODE,    * 00280030
*   GETS THE TERMINAL ENTRY, AND EXTRACTS THE QCB ADDRESS FROM IT.    * 00280430
*   IF A TSO SESSION IS NOT IN PROGRESS, CONTROL IMMEDIATELY RETURNS  * 00280830
*   TO THE ACTIVATE - I/O GENERATOR MODULE.  FOR INPUT, IF A HARDWARE * 00281230
*   ATTENTION WAS RECEIVED OR IF A TPUT WAS REQUESTED, THE LCB IS     * 00281630
*   POSTED EITHER TO THE ATTENTION ROUTINE SPECIFIED IN THE MH OR TO  * 00282030
*   ITSELF, RESPECTIVELY, AND CONTROL IS PASSED TO THE DISPATCHER     * 00282430
*   CHAIN FUNCTION TO POST THE INPUT BUFFERS TO THE BUFFER RETURN     * 00282830
*   SUBTASK.  IF A PREPARE IS UP ON THE LINE, THIS ROUTINE ISSUES AN  * 00283230
*   IOHALT SVC (SVC 33) TO HALT I/O ON THE LINE.  THEN ANOTHER CHECK  * 00283630
*   FOR A HARDWARE ATTENTION ON INPUT IS MADE, AND, IF ONE WAS RE-    * 00284030
*   CEIVED, IT IS PROCESSED AS STATED ABOVE.  OTHERWISE, CONTROL IS   * 00284430
*   RETURNED TO THE ACTIVATE - I/O GENERATOR MODULE AFTER THE IOHALT  * 00284822
*      FINALLY, THIS ROUTINE IS ENTERED WHEN EITHER THE ATTENTION     * 00284922
*   ELEMENT OR THE LCB IS POSTED TO THE LOCAL RECEIVE SCHEDULER.  IF  * 00285022
*   THIS ROUTINE IS ACTIVATED BECAUSE THE ATTENTION ELEMENT WAS       * 00285122
*   POSTED, THE SCHEDULER DETERMINES IF THE QCB IS DEDICATED TO TSO.  * 00285222
*   IF THE QCB IS DEDICATED AND THE START MI/WCC CHARACTER (2260/3270)* 00285322
*   HAS NOT BEEN SENT, THE SCHEDULER RETURNS CONTROL TO THE TCAM      * 00285422
*   DISPATCHER.  OTHERWISE THE ROUTINE POSTS THE LCB TO ITSELF. IF THE* 00285522
*   SCHEDULER IS ACTIVATED BECAUSE THE LCB WAS POSTED, AND IF TIME    * 00285622
*   SHARING IS NOT ACTIVE, THE ROUTINE RETURNS CONTROL TO THE         * 00285722
*   LOCAL RECEIVE SCHEDULER.  IF THE START MI/WCC PROMPT HAS BEEN     * 00285822
*   SENT THE ROUTINE RETURNS TO THE LOCAL RECEIVE SCHEDULER.  IF      * 00285922
*   THE QCB IS ON THE TIME DELAY QUEUE, THE ROUTINE REMOVES IT        * 00286022
*   FROM THE QUEUE.  IF A SIMULATED ATTENTION IS REQUESTED, THE       * 00286122
*   ROUTINE BRANCHES TO THE TSO MSGEN ROUTINE TO SEND A               * 00286222
*   PROMPT.  IF NO TGET HAS BEEN REQUESTED, THE ROUTINE               * 00286322
*   RETURNS TO THE LOCAL RECEIVE SCHEDULER.  OTHERWISE, THE           * 00286422
*   ROUTINE BRANCHES TO THE TSO MSGEN ROUTINE TO SEND THE             * 00286522
*   START MI/WCC PROMPT.                                              * 00286622
*                                                                     * 00286722
*ENTRY POINTS -- AYZ000 - ON ENTRY FROM THE LEASED RECEIVE SCHEDULER, * 00286822
*   TO DETERMINE WHETHER OR NOT TO INITIATE A READ OPERATION.         * 00286922
*   CALLING SEQUENCE          L    R6,AVTTSOPT                        * 00287022
*                             L    R6,TSISCHED-IEDQTSI(,R6)           * 00287122
*                             BAL  R3,0(,R6)                          * 00287222
*                                                                     * 00287322
*   AYZ100 - ON ENTRY FROM THE DIAL RECEIVE SCHEDULER, TO DETERMINE   * 00288030
*   WHETHER OR NOT TO INITIATE A READ OPERATION.                      * 00288430
*   CALLING SEQUENCE          L    R6,AVTTSOPT                        * 00288830
*                             L    R6,TSISCHED-IEDQTSI(,R6)           * 00289230
*                             BAL  R2,4(,R6)                          * 00289630
*                                                                     * 00290030
*   AYZ300 - ON ENTRY FROM THE QEVENT ROUTINE OF THE LEASED RECEIVE   * 00293230
*   SCHEDULER, TO GENERATE A PREPARE CHANNEL PROGRAM WHEN A LINE CON- * 00293630
*   NECTED TO A 2741 IS TO BE FREED.                                  * 00294030
*   CALLING SEQUENCE          L    R6,AVTTSOPT                        * 00294430
*                             L    R6,TSISCHED-IEDQTSI(,R6)           * 00294830
*                             BAL  R3,16(,R6)                         * 00295230
*                                                                     * 00295630
*   AYZ400 - ON ENTRY FROM THE SEND SCHEDULER WHEN IT IS DISPATCHED   * 00296030
*   OFF THE QCB, TO DETERMINE WHETHER OR NOT A WRITE BREAK CHANNEL    * 00296430
*   COMMAND CAN BE ISSUED.                                            * 00296830
*   CALLING SEQUENCE          L    R6,AVTTSOPT                        * 00297230
*                             L    R6,TSISCHED-IEDQTSI(,R6)           * 00297630
*                             BAL  R3,8(,R6)                          * 00298030
*                                                                     * 00298430
*   AYZ410 - ON ENTRY FROM THE TIME SHARING DESTINATION SCHEDULER, TO * 00298830
*   DETERMINE WHETHER OR NOT A WRITE BREAK CHANNEL COMMAND CAN BE     * 00299230
*   ISSUED.                                                           * 00299630
*   CALLING SEQUENCE          L    R6,AVTTSOPT                        * 00300030
*                             L    R6,TSISCHED-IEDQTSI(,R6)           * 00300430
*                             BAL  R3,28(,R6)                         * 00300830
*                                                                     * 00301230
*   AYZ500 - ON ENTRY FROM THE SEND SCHEDULER WHEN IT IS DISPATCHED   * 00301630
*   OFF THE LCB, TO DETERMINE WHETHER OR NOT TO INITIATE A SEND       * 00302030
*   OPERATION.                                                        * 00302430
*   CALLING SEQUENCE          L    R6,AVTTSOPT                        * 00302830
*                             L    R6,TSISCHED-IEDQTSI(R6)            * 00303230
*                             BAL  R2,12(,R6)                         * 00303630
*                                                                     * 00304030
*   AYZ600 - ON ENTRY FROM THE ACTIVATE - I/O GENERATOR MODULE BEFORE * 00304430
*   BUILDING AN INPUT OR OUTPUT CHANNEL PROGRAM.                      * 00304830
*   CALLING SEQUENCE          L    R6,AVTTSOPT                        * 00305230
*                             L    R6,TSISCHED-IEDQTSI(,R6)           * 00305622
*                             BAL  R3,24(,R6)                         * 00305722
*                                                                     * 00305822
*   AYZ700 - ON ENTRY FROM THE LOCAL RECEIVE SCHEDULER (IGG019Q1)     * 00305922
*   WHEN EITHER THE ATTENTION ELEMENT OR THE LCB IS POSTED TO THE     * 00306022
*   LOCAL RECEIVE SCHEDULER.                                          * 00306122
*                             L    R6,AVTTSOPT                        * 00306222
*                             L    R6,TSISCHED-IEDQTSI(,R6)           * 00306322
*                             BAL  R3,32(,R6)                         * 00306422
*                                                                     * 00306522
*INPUT -- IEDAYZ IS ENTERED AT ENTRY POINT AYZ000 FROM THE LEASED RE- * 00306830
*   CEIVE SCHEDULER WITH THE FOLLOWING REGISTERS SET.                 * 00307230
*   R3 HAS THE RETURN ADDRESS IN THE LEASED RECEIVE SCHEDULER         * 00307630
*   R4 HAS THE LCB ADDRESS                                            * 00308030
*   R6 HAS THE BASE ADDRESS OF IEDAYZ                                 * 00308430
*   R8 HAS THE ADDRESS OF THE CURRENT INVITATION LIST ENTRY           * 00308830
*   R9 HAS THE INVITATION LIST ADDRESS                                * 00309230
*   R10 HAS THE DCB ADDRESS                                           * 00309630
*   R11 HAS THE DISPATCHER ADDRESS                                    * 00310030
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 00310430
*   R15 HAS THE BASE ADDRESS OF THE LEASED RECEIVE SCHEDULER          * 00310830
*                                                                     * 00311230
*      IEDAYZ IS ENTERED AT ENTRY POINT AYZ100 FROM THE DIAL RECEIVE  * 00311630
*   SCHEDULER WITH THE FOLLOWING REGISTERS SET.                       * 00312030
*   R2 HAS THE RETURN ADDRESS IN THE DIAL RECEIVE SCHEDULER           * 00312430
*   R3 HAS THE STCB ADDRESS                                           * 00312830
*   R4 HAS THE LCB ADDRESS                                            * 00313230
*   R6 HAS THE BASE ADDRESS OF IEDAYZ                                 * 00313630
*   R10 HAS THE DCB ADDRESS                                           * 00314030
*   R11 HAS THE DISPATCHER ADDRESS                                    * 00314430
*   R12 HAS THE BASE ADDRESS OF THE DIAL RECEIVE SCHEDULER            * 00314830
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 00315230
*                                                                     * 00315630
*      IEDAYZ IS ENTERED AT ENTRY POINT AYZ300 FROM THE QEVENT ENTRY  * 00321230
*   POINT IN THE LEASED RECEIVE SCHEDULER WITH THE FOLLOWING REGIS-   * 00321630
*   TERS SET.                                                         * 00322030
*   R3 HAS THE RETURN ADDRESS IN THE QEVENT ROUTINE                   * 00322430
*   R4 HAS THE LCB ADDRESS                                            * 00322830
*   R6 HAS THE BASE ADDRESS OF IEDAYZ                                 * 00323230
*   R10 HAS THE DCB ADDRESS                                           * 00323630
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 00324030
*   R15 HAS THE BASE ADDRESS OF THE QEVENT ROUTINE                    * 00324430
*                                                                     * 00324830
*      IEDAYZ IS ENTERED AT ENTRY POINT AYZ400 FROM THE SEND SCHED-   * 00325230
*   ULER, WHEN IT IS DISPATCHED OFF THE QCB, WITH THE FOLLOWING       * 00325630
*   REGISTERS SET.                                                    * 00326030
*   R3 HAS THE RETURN ADDRESS IN THE SEND SCHEDULER                   * 00326430
*   R4 HAS THE LCB ADDRESS                                            * 00326830
*   R6 HAS THE BASE ADDRESS OF IEDAYZ                                 * 00327230
*   R7 HAS THE DESTINATION QCB ADDRESS                                * 00327630
*   R10 HAS THE DCB ADDRESS                                           * 00328030
*   R11 HAS THE DISPATCHER ADDRESS                                    * 00328430
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 00328830
*   R15 HAS THE BASE ADDRESS OF THE SEND SCHEDULER                    * 00329230
*                                                                     * 00329630
*      IEDAYZ IS ENTERED AT ENTRY POINT AYZ410 FROM THE TIME SHARING  * 00330030
*   DESTINATION SCHEDULER WITH THE FOLLOWING REGISTERS SET.           * 00330430
*   R2 HAS THE RETURN ADDRESS IN THE TIME SHARING DESTINATION         * 00330830
*      SCHEDULER                                                      * 00331230
*   R3 HAS THE RETURN ADDRESS IN THE TIME SHARING DESTINATION         * 00331630
*      SCHEDULER                                                      * 00332030
*   R4 HAS THE LCB ADDRESS                                            * 00332430
*   R6 HAS THE BASE ADDRESS OF IEDAYZ                                 * 00332830
*   R7 HAS THE DESTINATION QCB ADDRESS                                * 00333230
*   R10 HAS THE DCB ADDRESS                                           * 00333630
*   R11 HAS THE DISPATCHER ADDRESS                                    * 00334030
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 00334430
*                                                                     * 00334830
*      IEDAYZ IS ENTERED AT ENTRY POINT AYZ500 FROM THE SEND SCHED-   * 00335230
*   ULER, WHEN IT IS DISPATCHED OFF THE LCB, WITH THE FOLLOWING       * 00335630
*   REGISTERS SET.                                                    * 00336030
*   R2 HAS THE RETURN ADDRESS IN THE SEND SCHEDULER                   * 00336430
*   R3 HAS THE ADDRESS OF THE NEXT STCB                               * 00336830
*   R4 HAS THE LCB ADDRESS                                            * 00337230
*   R6 HAS THE BASE ADDRESS OF IEDAYZ                                 * 00337630
*   R7 HAS THE DESTINATION QCB ADDRESS                                * 00338030
*   R9 HAS THE SCB ADDRESS                                            * 00338430
*   R11 HAS THE DISPATCHER ADDRESS                                    * 00338830
*   R12 HAS THE BASE ADDRESS OF THE SEND SCHEDULER                    * 00339230
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 00339630
*                                                                     * 00340030
*      IEDAYZ IS ENTERED AT ENTRY POINT AYZ600 FROM THE ACTIVATE -    * 00340430
*   I/O GENERATOR MODULE WITH THE FOLLOWING REGISTERS SET.            * 00340830
*   R2 HAS THE LCB ADDRESS                                            * 00341230
*   R3 HAS THE RETURN ADDRESS IN ACTIVATE - I/O GENERATOR             * 00341630
*   R4 HAS THE DCB ADDRESS                                            * 00342030
*   R6 HAS THE BASE ADDRESS OF IEDAYZ                                 * 00342430
*   R11 HAS THE DISPATCHER ADDRESS                                    * 00342830
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 00343222
*   R15 HAS THE BASE ADDRESS OF ACTIVATE - I/O GENERATOR              * 00343322
*                                                                     * 00343422
*      IEDAYZ IS ENTERED AT ENTRY POINT AYZ700 FROM THE LOCAL RECEIVE * 00343522
*   SCHEDULER WITH THE FOLLOWING REGISTERS SET.                       * 00343622
*   R3 HAS THE RETURN ADDRESS IN THE LOCAL RECEIVE SCHEDULER          * 00343722
*   R4 HAS THE LCB ADDRESS                                            * 00343822
*   R6 HAS THE BASE ADDRESS OF IEDAYZ                                 * 00343922
*   R13 HAS THE ADDRESS OF AVTSAVE2                                   * 00344022
*                                                                     * 00344122
*OUTPUT -- ON LINKING TO THE TERMNAME TABLE CODE THE FOLLOWING REGIS- * 00344430
*   TERS ARE SET.                                                     * 00344830
*   R1 HAS THE TERMINAL INDEX OR LINE ENTRY                           * 00345230
*   R14 HAS THE RETURN ADDRESS IN IEDAYZ                              * 00345630
*   R15 HAS THE ENTRY POINT ADDRESS                                   * 00346030
*                                                                     * 00346430
*      ON LINKING TO THE TIME DELAY SUBTASK THE FOLLOWING REGISTERS   * 00346830
*   ARE SET.                                                          * 00347230
*   R1 HAS THE ADDRESS OF THE QCB OR LCB TO BE REMOVED FROM OR IN-    * 00347630
*      SERTED INTO THE TIME DELAY QUEUE.                              * 00348030
*   R14 HAS THE RETURN ADDRESS IN IEDAYZ                              * 00348430
*   R15 HAS THE ENTRY POINT ADDRESS                                   * 00348830
*                                                                     * 00349230
*      ON LINKING TO THE ACTIVATE - I/O GENERATOR MODULE THE TP CODE  * 00349630
*   FLAG IS SET IN THE LCB AND THE FOLLOWING REGISTERS ARE SET.       * 00350030
*   R2 HAS THE LCB ADDRESS                                            * 00350430
*   R5 HAS THE RETURN ADDRESS IN IEDAYZ                               * 00350830
*   R12 HAS THE ENTRY POINT ADDRESS                                   * 00351230
*                                                                     * 00351630
*      ON ENTRY TO THE EXCPVR ROUTINE, REGISTER 1 CONTAINS THE   X02004 00352005
*   ADDRESS OF THE IOB.  ON LINKING TO THE IOHALT SVC ROUTINE REGIS-  * 00352430
*   TER 1 CONTAINS THE UCB ADDRESS.                                   * 00352830
*                                                                     * 00353230
*      ON RETURN TO THE LEASED RECEIVE SCHEDULER, THE LCB INVITATION  * 00353630
*   LIST POINTER IS UPDATED, AND, AT END OF LIST, THE LCB START OF    * 00354030
*   POLLING LIST BIT IS SET ON.  REGISTER 7 CONTAINS THE DESTINATION  * 00354430
*   QCB ADDRESS, AND REGISTER 6 IS CLEARED TO ZERO.                   * 00354830
*                                                                     * 00355230
*      ON RETURN TO THE DIAL RECEIVE SCHEDULER, REGISTER 7 CONTAINS   * 00355630
*   THE DESTINATION QCB ADDRESS, AND REGISTER 14 CONTAINS THE SCB     * 00356030
*   ADDRESS.  IF A TSO SESSION IS IN PROGRESS, THE LCB TIME SHARING   * 00356430
*   BUFFER BIT IS ON, AND THE LCB IS SET TO RE-POLL.                  * 00356830
*                                                                     * 00357230
*      ON RETURN TO THE QEVENT ROUTINE, REGISTER 7 CONTAINS THE       * 00362030
*   DESTINATION QCB ADDRESS.  IF THE DEVICE IS A 2741 OR A DEVICE IN- * 00362430
*   HIBITED FROM TIMING OUT, THE LCB PREPARE BIT IS ON.  FOR 2741'S,  * 00362830
*   THE LCB POINTS TO THE BEGINNING CCW OF THE GENERATED PREPARE      * 00363230
*   CHANNEL PROGRAM.                                                  * 00363630
*                                                                     * 00364030
*      ON RETURN TO THE SEND SCHEDULER, WHEN POSTED OFF THE QCB,      * 00364430
*   REGISTER 14 CONTAINS THE ENTRY POINT OF THE DISPATCHER DISPATCH   * 00364830
*   FUNCTION, UNLESS A WRITE BREAK WAS REQUESTED, BUT COULD NOT BE    * 00365230
*   ISSUED.  IN THAT CASE, THE QCB READ PRIORITY BIT IS SET OFF.      * 00365630
*   ON RETURN TO THE SEND SCHEDULER, WHEN POSTED OFF THE LCB, TO      * 00366030
*   START A SEND OPERATION, THE QCB READ PRIORITY BIT IS ALSO SET     * 00366430
*   OFF, EXCEPT WHEN A WRITE BREAK WAS REQUESTED.                     * 00366830
*                                                                     * 00367230
*      ON RETURN TO THE TIME SHARING DESTINATION SCHEDULER, THE QCB   * 00367630
*   READ PRIORITY BIT IS SET OFF.  IF THE REQUESTED WRITE BREAK COULD * 00368030
*   BE ISSUED, THE LCB WRITE BREAK BIT IS ON, AND REGISTER 8 CONTAINS * 00368430
*   THE ADDRESS OF THE FIRST BUFFER.                                  * 00368830
*                                                                     * 00369230
*      ON RETURN TO THE ACTIVATE - I/O GENERATOR MODULE, REGISTER 7   * 00369630
*   CONTAINS THE DESTINATION QCB ADDRESS AND REGISTER 14 CONTAINS THE * 00370030
*   SCB ADDRESS.  IF IOHALT WAS ISSUED, THE LCB PREPARE BIT IS OFF.   * 00370430
*                                                                     * 00370830
*      ON EXIT TO THE DISPATCHER POST FUNCTION, REGISTER 7 CONTAINS   * 00371230
*   THE DESTINATION QCB ADDRESS AND REGISTER 1 CONTAINS THE ADDRESS   * 00371630
*   OF THE LCB TO BE POSTED.  IF THE EXIT IS TAKEN AFTER A HARDWARE   * 00372030
*   ATTENTION, THE QCB SIMULATED ATTENTION READ BIT IS OFF, THE LINE  * 00372430
*   IS SET TO SEND MODE, AND THE LCB IS SET TO BE POSTED TO THE       * 00372830
*   ATTENTION ROUTINE SPECIFIED IN THE MH.  IF THE EXIT IS TAKEN      * 00373230
*   AFTER A NEGATIVE RESPONSE TO POLLING, A PREPARE IS PUT UP ON THE  * 00373630
*   LINE, AND THE LCB IS SET TO RE-POLL AND TO BE POSTED TO THE TIME  * 00374030
*   DELAY QUEUE.  REGISTER 14 CONTAINS THE SCB ADDRESS.               * 00374430
*                                                                     * 00374830
*      ON EXIT TO THE DISPATCHER BYPASS FUNCTION, THE LCB IS POSTED   * 00375230
*   TO ITSELF, REGISTER 7 CONTAINS THE DESTINATION QCB ADDRESS, AND   * 00375630
*   REGISTER 1 CONTAINS THE LCB ADDRESS.  IF ENTRY WAS FROM THE       * 00376030
*   LEASED RECEIVE SCHEDULER, THE LCB INVITATION LIST POINTER POINTS  * 00376430
*   TO THE FIRST ENTRY, AND THE ADDRESS OF THE NEXT STCB IS SET IN    * 00376830
*   REGISTER 3.                                                       * 00377230
*                                                                     * 00377630
*      ON EXIT TO THE DISPATCHER DISPATCH FUNCTION, THE LINE IS FREED * 00378030
*   AND A PREPARE IS PUT UP ON IT.  THE LCB IS SET TO RE-POLL, REGIS- * 00378430
*   TER 7 CONTAINS THE DESTINATION QCB ADDRESS, AND REGISTER 14 CON-  * 00378830
*   TAINS THE SCB ADDRESS.                                            * 00379230
*                                                                     * 00379630
*      ON EXIT TO THE DISPATCHER AT DSPUNAV, REGISTER 3 CONTAINS THE  * 00380030
*   LCB ADDRESS.  IF AN IOHALT WAS ISSUED, THE QCB READ PRIORITY BIT  * 00380430
*   IS OFF, THE LCB WRITE BREAK BIT IS ON, AND REGISTER 8 CONTAINS    * 00380830
*   THE ADDRESS OF THE FIRST BUFFER.                                  * 00381230
*                                                                     * 00381630
*      ON EXIT TO THE DISPATCHER CHAIN FUNCTION, THE LINE IS SET TO   * 00382030
*   SEND MODE, REGISTER 7 CONTAINS THE DESTINATION QCB ADDRESS, AND   * 00382430
*   REGISTER 14 CONTAINS THE SCB ADDRESS.  THE INPUT BUFFERS ARE SET  * 00382830
*   TO BE POSTED TO BUFFER RETURN, AND THE LCB IS POSTED EITHER TO    * 00383230
*   ITSELF OR TO THE ATTENTION ROUTINE SPECIFIED IN THE MH, DEPENDING * 00383630
*   UPON WHETHER A TPUT WAS REQUESTED OR A HARDWARE ATTENTION RE-     * 00384030
*   CEIVED, RESPECTIVELY.                                             * 00384430
*                                                                     * 00384830
*EXTERNAL ROUTINES -- IEDQTNT - TO GET THE TERMINAL ENTRY FROM THE    * 00385230
*   TERMINAL OR LINE ENTRY IN THE LCB.                                * 00385630
*   IEDQHG - TO REMOVE AN LCB OR A QCB FROM THE TIME DELAY QUEUE, OR  * 00386030
*   TO INSERT A QCB INTO IT.                                          * 00386430
*   IEDQKA - TO BUILD A PREPARE CHANNEL PROGRAM                       * 00386830
*   IOHALT SVC ROUTINE - TO HALT I/O ON A LINE                        * 00388030
*   EXCPVR ROUTINE (SVC 114) - TO START A PREPARE CHANNEL PGM.   X02004 00388405
*                                                                     * 00388830
*EXITS-NORMAL -- TO THE LEASED RECEIVE SCHEDULER                      * 00389230
*   TO THE DIAL RECEIVE SCHEDULER                                     * 00389630
*   TO THE QEVENT ROUTINE IN THE LEASED RECEIVE SCHEDULER             * 00390430
*   TO THE SEND SCHEDULER                                             * 00390830
*   TO THE TIME SHARING DESTINATION SCHEDULER                         * 00391230
*   TO THE ACTIVATE - I/O GENERATOR MODULE                            * 00391630
*   TO THE DISPATCHER POST FUNCTION                                   * 00392030
*   TO THE DISPATCHER BYPASS FUNCTION                                 * 00392430
*   TO THE DISPATCHER DISPATCH FUNCTION                               * 00392830
*   TO THE DISPATCHER AT DSPUNAV                                      * 00393230
*   TO THE DISPATCHER CHAIN FUNCTION                                  * 00393630
*   TO THE LOCAL RECEIVE SCHEDULER                                    * 00393822
*                                                                     * 00394030
*EXITS-ERROR -- NONE                                                  * 00394430
*                                                                     * 00394830
*TABLES/WORKAREAS -- CVT, AVT, TSB, QCB, TSID, LCB, DCB, SCB,         * 00395200
*   BUFFER PREFIX, TERMINAL ENTRY, INVITATION LIST, TPRIOR ERB.       * 00395630
*                                                                     * 00396030
*ATTRIBUTES -- REENTRANT, ENABLED, PROBLEM PROGRAM MODE.         Y01948 00396405
*                                                                     * 00397630
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON A         * 00398030
*   PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER SET. * 00398430
*                                                                     * 00398830
*********************************************************************** 00399230
         SPACE 2                                                        00399630
*        REGISTER EQUATES                                               00400020
         SPACE                                                          00500020
R0       EQU   0                        WORK REGISTER                   00600020
R1       EQU   1                        WORK REGISTER                   00700020
RTRM     EQU   1                        ADDRESS OF TERM ENTRY, WORK REG 00800020
RECB     EQU   1                        ADDR OF ELEMENT TO DSPPOST      00900020
R2       EQU   2                        WORK REGISTER                   01000020
RETURN   EQU   3                        RETURN ADDRESS, WORK REG        01100020
RSTCB    EQU   3                        STCB BASE REGISTER        @P1A  01100525
RLCB     EQU   4                        ADDRESS OF LCB, WORK REG        01200020
R5       EQU   5                        WORK REGISTER                   01300020
FFF      EQU   4095                     CONTROL COUNT              @21C 01350027
RBASE    EQU   6                        ROUTINE BASE REGISTER           01400020
RQCB     EQU   7                        ADDRESS OF DEST QCB, WORK REG   01500020
R7       EQU   7                        WORK REGISTER                   01550020
R8       EQU   8                        ADDRESS OF BUFFER, WORK REG     01600020
R9       EQU   9                        WORK REGISTER                   01700020
RDCB     EQU   10                       ADDRESS OF DCB, WORK REG        01800020
R10      EQU   10                       WORK REGISTER                   01850020
RDISP    EQU   11                       ADDRESS OF DISPATCHER, WORK REG 01900020
R12      EQU   12                       WORK REGISTER                   02000020
R13      EQU   13                       ADDRESS OF AVTSAVE2             02100020
RSCB     EQU   14                       ADDRESS OF SCB, WORK REG        02200020
R14      EQU   14                                                       02300020
R15      EQU   15                       WORK REGISTER                   02400020
         SPACE 2                                                        02500020
*        MISCELLANEOUS EQUATES                                          02600020
         SPACE                                                          02700020
X10      EQU   X'10'                                                    03000020
HIOCC    EQU   X'48'                    HALT I/O COMPLETION CODE Y02027 03050006
LOWBYTE  EQU   1                        MASK TO ICM LO-ORDER BYTEX02004 03100005
ADDR     EQU   7                        MASK TO STCM ADDRESSES.  X02004 03200005
INVPRFIX EQU   8                        SIZE OF INVLIST CONTROL WORDS   03400020
CATTN    EQU   X'20'                    TERMINAL HAS ATTENTION FEATURE  03500020
CTWX     EQU   X'20'                    TWX CHARACTERISTIC              03550020
WRITE    EQU   X'01'                    WRITE COMMAND            S21903 03610022
TIC      EQU   X'08'                    TIC COMMAND              S21903 03619022
ADDRCHAR EQU   X'20'                    ADDRESSING CHAR          S21903 03628022
DIALDIGS EQU   X'40'                    DIAL CHAR                S21903 03637022
CCSLI    EQU   X'60'                    CHAINING FLAGS           S21903 03646022
BUFSIZE  EQU   X'80'                    BUFFERSIZE               S21903 03655022
BSCDEV   EQU   X'90'                    BSC DEVICE               S22028 03666022
D3270    EQU   X'04'                    3270 TERMINAL            S22028 03673022
D2260    EQU   X'02'                    2260 TERMINAL            S21903 03680022
ZERO     EQU   0                        EQUATED CONSTANT       @OZ14197 03680110
FOUR     EQU   4                        EQUATED CONSTANT         A56332 03680521
EIGHT    EQU   8                        EQUATED CONSTANT         A56332 03681021
NOT      EQU   X'FF'                    A BYTE OF ALL ONES       A56332 03681521
AUTOPOLL EQU   X'09'                    AUTOPOLL COMMAND CODE    S22029 03685022
*                                       COMMAND CODE.            S22029 03690022
CMDCODE  EQU   24                       OFFSET TO AUTOPOLL       S22029 03695022
ONE      EQU   1                        DISPLACEMENT VALUE       Y02027 03696006
TWO      EQU   2                        MASK FOR SHIFTING        Y02027 03697006
THREE    EQU   3                        LENGTH VALUE             Y02027 03698006
NOTZERO  EQU   7                        MASK FOR TM INSTRUCTION  Y02027 03699006
         SPACE 2                                                        03700020
*        ADDRESSABILITY                                                 03800020
         SPACE                                                          03900020
         USING AVTSAVE2,R13             AVT SAVE AREA ADDRESS    S21903 04000022
         USING IEDQDISP,RDISP           DISPATCHER ADDRESS       S21903 04100022
         USING IEDQLCB,RLCB             LCB ADDRESS              S21903 04200022
         USING IEDQPRF,R8               PRIOR ADDRESS            S21903 04300022
         USING IEDQQCB,RQCB             QCB ADDRESS              S21903 04400022
         USING IEDQSCB,RSCB             SCB ADDRESS              S21903 04500022
         USING IEDQTRM,RTRM             TERMTABLE ADDRESS        S21903 04600022
         USING IHADCB,RDCB              DCB ADDRESS              S21903 04700022
         USING IEDQSTCB,RSTCB           STCB ADDRESS               @P1A 04700525
         USING *,RBASE                  BASE ADDRESS             S21903 04800022
         SPACE 2                                                        04900020
*        ENTRY POINTS                                                   05000020
         SPACE                                                          05100020
         B     AYZ000                   ENTRY FROM LEASED SCHEDULER     05200020
         B     AYZ100                   ENTRY FROM DIAL SCHEDULER       05300020
         B     AYZ400                   INITIAL ENTRY FROM SEND SCHED   05400020
         B     AYZ500                   SEND SCHED DISPATCHED OFF LCB   05500020
         B     AYZ300                   ENTRY FROM QEVENT               05600020
         B     AYZ200                   UNUSED ENTRY POINT.    @OZ17622 05700010
         B     AYZ600                   ENTRY FROM ACTIVATE             05800020
         B     AYZ410                   ENTRY FROM TS DESTINATION SCHED 05900020
         B     AYZ700                   ENTRY FROM LOCAL RECEIVE SCHED  05950020
         SPACE 2                                                        05960020
         SPACE 2                                                        06000020
*        CONSTANTS                                                      06100020
         SPACE                                                          06200020
CIRCLED  DC    X'16'                    CIRCLE D                 S21903 06400022
CIRCLECS DC    3X'1F'                   CIRCLE C                 S21903 06410022
BLAT     DC    X'C988C988'              DATA FOR TWX MONITOR CCW Y01948 06430005
*                                       (NOISE CCW).             Y01948 06435005
WRCCCW   CCW   1,CIRCLECS,X'60',3       WRITE CIRCLE C           S21903 06440022
RSPCCW   CCW   2,*,X'70',1              RESPONSE CCW             S21903 06460022
WRDCCW   CCW   1,CIRCLED,X'60',1        WRITE CIRCLE D           S21903 06500022
PREPCCW  CCW   6,*,0,1                  PREPARE CCW              S21903 06600022
SPRBTCH  CCW   1,BLAT,X'B0',4           NOISE CCW                Y01004 06700005
IEDAYZ   IEDHJN ,                                                S22028 06800022
         DS    0H                                                       07000020
         SPACE 2                                                        07100020
*        THIS CODE IS EXECUTED ON ENTRY FROM THE LEASED RECEIVE         07200020
*        SCHEDULER WHEN TSO IS IN THE SYSTEM.                           07300020
         SPACE                                                          10700020
AYZ000   EQU   *                                                        10800020
         LH    RTRM,LCBTTBIN            PARAMETERS FOR TERMINAL         10900020
AYZ002   EQU   *                                                        11000020
         N     RTRM,AVTCLRHI              NAME ROUTINE                  11100020
         LR    R12,R15                  SAVE REGISTER 15                11200020
         L     R15,AVTRNMPT             TNT ADDRESS              S21903 11300022
         BALR  RSCB,R15                 BRANCH TO ROUTINE               11400020
         LR    R15,R12                  RESTORE REGISTER 15             11500020
         L     RSCB,LCBSCBA-1           GET SCB ADDRESS FOR RCV SCHED   11600020
         L     RQCB,TRMDESTQ-1          GET QCB ADDRESS                 11800020
         TM    QCBFLAG,QCBTSSES         TSO SESSION IN PROGRESS?        11900020
         BO    AYZ020                   BRANCH ON YES                   12000020
         B     AYZ015                   RETURN IF NOT                   12100020
AYZ010   EQU   *                                                        12200020
         TM    LCBSTAT2,LCBSYNC         BSC TERMINAL           @OY20733 12200100
         BO    AYZ014                   NO NEED TO CHK INHIBIT @OY20733 12200200
         TM    QCBTSOF2,QCBINHBN        DO WE WANT INHIBITS?            12300020
         BZ    AYZ014                   BRANCH ON NO                    12400020
         OI    LCBTSOB,LCBINHBN         INDICATE USE OF INHIBITS        12600020
AYZ014   EQU   *                                                        12700020
         OI    LCBTSOB,LCBTSBUF         TURN ON TIME SHARING BIT        12800020
AYZ015   EQU   *                                                        12900020
         SR    RBASE,RBASE              CLEAR REGISTER                  13300020
         NI    LCBTSOB,X'FF'-LCBSOPL    RESET POLL FLAG                 13350020
         B     4(,RETURN)               RETURN                          13400020
AYZ020   EQU   *                                                        13500020
         ST    RTRM,SCBSCSEG-1          SAVE TERM ENTRY ADDRESS SA55387 13550022
         TM    LCBTSOB,LCBPREP          IS LINE BEING MONITORED?        13600020
         BO    AYZ060                   BRANCH ON YES                   13700020
         TM    QCBTSOF2,QCBDSSMI        START MI ON SCREEN              13730020
         BO    AYZ030                   BRANCH IF YES                   13760020
         TM    QCBTSOF1,QCBNOBUF+QCBPARTO+QCBWRBRK CAN WE READ?         13800020
         BNZ   AYZ040                   BRANCH ON NO                    13900020
         TM    QCBFLAG,QCBREAD          READ HAVE PRIORITY?             14000020
         BO    AYZ030                   BRANCH ON YES                   14100020
         TM    QCBTSOF1,QCBTPUT         SEND HAVE PRIORITY?             14200020
         BO    AYZ040                   BRANCH ON YES                   14300020
         TM    QCBFLAG,QCBNOBRK         CAN WE READ AHEAD?              14400020
         BZ    AYZ030                   BRANCH ON YES                   14500020
         TM    QCBTSOF1,QCBTGET         TGET ISSUED?                    14600020
         BZ    AYZ040                   BRANCH ON NO                    14700020
AYZ030   EQU   *                                                        14800020
         TM    QCBTSOF1,QCBSATRD        SIMULATED ATTENTION REQUESTED?  14900020
         BO    AYZ080                   BRANCH ON YES                   15100020
         TM    QCBTSOF1,QCBDELAY        IS QCB IN TIME DELAY QUEUE?     15500020
         BZ    AYZ010                   BRANCH ON NO                    15600020
         LR    RECB,RQCB                SEND ADDR OF QCB TO BE REMOVED  15700020
         LR    R12,R15                 SAVE REGISTER 15                 15800020
         L     R15,AVTHG02             ADDR OF TIME DELAY REMOVAL RTN   15900020
         BALR  R14,R15                  REMOVE QCB FROM DELAY Q.        16000020
         LR    R15,R12                 RESTORE REGISTER 15              16100020
         NI    QCBTSOF1,X'FF'-QCBDELAY     TURN OFF DELAY BIT    A44022 16150030
         B     AYZ010                   BRANCH TO RETURN         S21903 16300022
         SPACE 2                                                        16400020
*        UPDATE TO NEXT INVITATION LIST ENTRY                           16500020
         SPACE                                                          16600020
AYZ040   EQU   *                                                        16700020
         TM    QCBTSOF1,QCBSATRD        SIMULATED ATTENTION READ?       16800020
         BO    AYZ080                   BRANCH ON YES                   16900020
         TM    QCBTSOF2,QCBSATTI        SIMULATED ATTN BY TIME INTERVAL 17000020
         BNO   AYZ042                   BRANCH ON NO                    17060020
         BAL   RDCB,AYZ090              LINK TO TIME DELAY ROUTINE      17120020
AYZ042   EQU   *                                                        17200020
         L     RDCB,LCBDCBPT            GET DCB ADDRESS                 17230020
         SR    RTRM,RTRM                CLEAR REGISTER                  17260020
         IC    RTRM,LCBUCBX             RELATIVE LINE - 1               17290020
         SLL   RTRM,2                   MULTIPLY BY FOUR                17320020
         L     RTRM,DCBINVLI(RTRM)      ADDRESS INVITATION LIST         17350020
         SR    RQCB,RQCB                                                17400020
         IC    RQCB,2(,RTRM)            GET SIZE OF EACH ENTRY          17500020
         AR    R8,RQCB                  UPDATE TO NEXT ENTRY            17600020
         TM    LCBSTAT2,LCBSYNC         IS THIS A BSC DEVICE     S22028 17700022
         BZ    AYZ043                   NO, BRANCH               S22028 17720022
         CLI   1(R8),X'FE'              END OF INVITATION LIST?  S22028 17740022
         BNE   AYZ050                   NO, BRANCH               S22028 17760022
         LA    R8,1(R8)                 INCREMENT PAST EOT CHAR  S22028 17780022
         B     AYZ044                   CONTINUE                 S22028 17800022
AYZ043   EQU   *                                                 S22028 17820022
         CLI   1(R8),X'FE'              END OF INVITATION LIST @OZ35418 17822012
         BE    AYZ044                   YES                    @OZ35418 17824012
         CLI   0(R8),X'FE'              END OF INVITATION LIST?  S22028 17840022
         BNE   AYZ050                   NO, BRANCH               S22028 17860022
AYZ044   EQU   *                                                 S22028 17880022
         TM    LCBTSOB,LCBSOPL          WERE ANY ENTRIES POLLED?        17900020
         BO    AYZ045                   BRANCH ON NO                    18000020
         OI    LCBTSOB,LCBSOPL          TURN ON START OF POLL LIST BIT  18100020
         SR    RBASE,RBASE              CLEAR REGISTER                  18200020
         BR    RETURN                   RETURN                          18300020
AYZ045   EQU   *                                                        18400020
         LA    R8,INVPRFIX(,RTRM)       POINT TO FIRST ENTRY            18600020
         STCM  R8,ADDR,LCBINVPT         UPDATE CURRENT ENTRY.    X02004 18700005
         LR    RTRM,RLCB                ADDRESS OF ELEMENT              18900020
         SR    RSTCB,RSTCB                                         @P1C 18910025
         ICM   RSTCB,ADDR,LCBSTCBA      GET FIRST STCB ADDRESS     @P1C 18910525
         CLI   STCBVTO,DSP327L          IS FIRST STCB THE 327L     @P1A 18911025
*                                       OUTPUT SCHEDULER(IEDGLO21) @P1A 18911525
         BE    NEXTSTCB                 GET NEXT STCB              @P1A 18912025
         LA    RQCB,LCBRSKEY            GET RECEIVE SCHEDULER   SA65440 18930005
*                                        STCB ADDRESS           SA65440 18940005
         CR    RQCB,RSTCB               IS RECEIVE SCHEDULER       @P1C 18950025
*                                        FIRST STCB IN CHAIN    SA65440 18960005
         BNE   AYZ047                   NO, ACTIVATE FIRST STCB SA65440 18970005
NEXTSTCB EQU   *                                                        18970525
         ICM   RSTCB,ADDR,LCBRSLNK      ADDRESS OF NEXT STCB       @P1C 19000025
AYZ047   EQU   *                                                SA65440 19050005
         LR    RQCB,RLCB                ADDRESS OF QCB                  19100020
         BAL   R14,DSPBYPAS             ACTIVATE NEXT SUBTASK  @G36XRYP 19200000
AYZ050   EQU   *                                                        19300020
         BCTR  RQCB,0                   SUBTRACT ONE             S21903 19400022
         IC    RQCB,0(R8,RQCB)          GET INDEX BYTE                  19500020
         AR    RQCB,RQCB                                                19600020
         SR    RTRM,RQCB                POINT TO TERMINAL INDEX         19700020
         LH    RTRM,0(,RTRM)            GET TERMINAL INDEX              19800020
         STH   RTRM,LCBTTBIN            UPDATE CURRENTLY CONNECTED      19900020
         STCM  R8,ADDR,LCBINVPT         UPDATE CURRENT ENTRY.    X02004 19950005
         B     AYZ002                   BRANCH TO PROCESS               20000020
         SPACE 2                                                        20100020
*        HALT MONITORING CHANNEL PROGRAM                                20140020
         SPACE                                                          20180020
AYZ060   EQU   *                                                        20220020
         SR    R8,R8                                                    20300020
         IC    R8,LCBUCBX               RLN MINUS ONE                   20340020
         SLL   R8,2                     MULTIPLY FOR INDEX              20380020
         L     RTRM,DCBDEBAD            DEB ADDRESS                     20420020
         L     RTRM,32(RTRM,R8)         ADDRESS OF UCB                  20460020
         LR    R8,RTRM                  SAVE UCB ADDR          @SA68674 20465061
         LA    R5,FFF(,0)               LOAD COUNT(4095)           @21C 20467027
         SPACE 1                                                        20470061
AYZ060A  EQU   *                                               @SA68674 20475061
         MVI   LCBECBCC,HIOCC           PREVENT LOST LINE        Y02027 20480006
         IOHALT (1)                                                     20500020
         LTR   R15,R15                  HIO COMPLETE?              @03A 20505012
         BZ    DSPDISP                  BRANCH YES                 @03A 20510012
         OC    LCBCSW,LCBCSW            CSW STORED                 @03A 20515012
         BNZ   DSPDISP                  YES RETURN TO DISP.        @03A 20520012
         BCT   R5,AYZ060A               BRANCH NO-REISSUE HIO      @03A 20525012
         B     DSPDISP                  RETURN TO DISPATCHER.      @03A 20530012
         SPACE 2                                                        20580020
*        SIMULATED ATTENTION SUPPORT                                    20620020
         SPACE                                                          20660020
AYZ080   EQU   *                                                        20700020
         TM    QCBTSOF2,QCBSIMRD        IS READ PART REQUESTED          20740020
         BO    AYZ010                   BRANCH ON YES                   20780020
AYZ085   EQU   *                                                        20940020
         OI    QCBTSOF2,QCBSIMRD        REQUEST READ PART               20960020
         LA    R8,X0100                 ADDRESS OF CONSTANT             20980020
         ST    R8,SCBMACR-1             STORE IN SCB                    21020020
         NI    LCBSTAT1,LCBOCNI+LCBOCWTN CLEAR STATUS          @OY14092 21020110
         OI    LCBSTAT1,LCBRECVN        SET LCB RECEIVING      @OY14092 21060010
         L     RETURN,LCBSCBA-1         PASS SCB ADDRESS TO IEDAYM      21160020
         SR    R9,R9                    CLEAR REGISTER                  21163020
         IC    R9,TRMCHCIN              INDEX TO CHARACTERISTICS        21166020
         BCTR  R9,0                     REDUCE BY ONE                   21169020
         MH    R9,AVTDCTLN              MULTIPLY BY SIZE OF A  @G36XRYP 21172000
*                                       DCT ENTRY              @G36XRYP 21173000
         A     R9,AVTCSTCS              ADD CHARACTERISTICS START       21175020
         USING IEDDCT,R9                DCT ADDRESSABILITY     @G36XRYP 21175500
         SR    R1,R1                    CLEAR REGISTER                  21176020
         TM    DCTBYTE1,DCT3270         IS THIS A 3270 TRM     @G36XRYP 21176600
         BO    AYZ084                   YES, BRANCH              S22028 21177222
         TM    DCTBYTE3,DCTNOIDL        IS THIS A 2260 REMOTE  @G36XRYP 21178000
         BO    AYZ088                   BRANCH ON YES                   21181020
         TM    DCTBYTE2,DCTLOCAL        IS THIS 2260 LOCAL     @G36XRYP 21184000
         BO    AYZ086                   BRANCH ON YES                   21187020
         TM    DCTBYTE2,DCTTWX          IS THIS A TWX          @G36XRYP 21188000
         BO    AYZ089                   BRANCH ON YES                   21189020
         LA    R8,AYZMASK               ADDRESS OF MASK                 21190020
         B     AYZ087                   PREPARE TO GO TO MSGGEN         21193020
AYZ084   EQU   *                                                 S22028 21193622
         TM    DCTBYTE2,DCTBISYN+DCTSTCTL IS THIS 3270 REMOTE  @G36XRYP 21193700
         BZ    AYZ081                   NO, IT IS 3270 LOCAL     S22028 21193822
         LA    R8,AYZMASK6              ADDRESS OF MASK          S22028 21193922
         B     AYZ087                   SET CONNECTED            S22028 21194022
AYZ081   EQU   *                                                 S22028 21194122
         LA    R8,AYZMASK8              ADDRESS OF MASK          S22028 21194222
         B     AYZ087                   BRANCH                   S22028 21194322
AYZ088   EQU   *                                                        21194422
         LA    R8,AYZMASK4              ADDRESS OF MASK                 21194820
         B     AYZ087                   SET CONNECTED            S21903 21202522
AYZ086   EQU   *                                                        21206020
         LA    R8,AYZMASK3              ADDRESS OF MASK                 21209520
AYZ087   EQU   *                                                        21213020
         MVC   LCBTTCIN,LCBTTBIN        SER 'CONNECTED'                 21214020
         DROP  R9                       DROP DCT               @G36XRYP 21215000
         SR    R9,R9                    CLEAR REGISTER                  21216520
         L     R12,AVTTSOPT             ADDRESS OF TIME SHARING QCB     21220020
         L     R12,TSIMSGEN-IEDQTSI(,R12) ADDRESS OF MSGGEN             21260020
         BR    R12                      BRANCH TO MSGGEN                21300020
AYZ089   EQU   *                                                        21310020
         LA    R8,AYZMASK5              GET TWX MASK                    21320020
         B     AYZ087                   SET CONNECTED            S21903 21330022
         SPACE 2                                                        21340020
AYZ090 EQU     *                                                        21500020
         TM    QCBTSOF2,QCBPOSTO        IS QCB ON RDY Q         SA56307 21600000
         BCR   1,RDCB                   IF SO, CNNOT DELAY      SA56307 21700000
         LR    R12,R15                  SAVE RCV SCHEDULR BASE ADDR     22000020
         BAL   R14,QTIP25               GO PREPARE TO PUT QCB    Y02027 22500006
*                                       IN TIME DELAY QUEUE      Y02027 22550006
         LTR   R15,R15                  GO TO TIME DELAY RTN?           22600020
         BNZ   DLY0010                  NO. CONTINUE.                   22700020
         LR    R1,RQCB                  PASS QCB ADDRESS TO TIME DELAY  22800020
         L     R15,AVTHG01              ADDR OF TIME DELAY RTN.         22900020
         BALR  R14,R15                  GO TO TIME DELAY RTN.           23000020
DLY0010  EQU   *                                                        23100020
         LR    R15,R12                  RESTORE RCV SCHEDULR BASE ADDR  23200020
         BR    RDCB                     RETURN                          23210020
         SPACE 2                                                        23220020
*********************************************************************** 23225022
AYZ700   EQU   *                                                        23230020
         SR    R9,R9                    ASSUME LCB POSTED               23232020
         LA    RLCB,0(RLCB)             LCB ADDRESS             SA62315 23234022
         LA    R1,0(R1)                 ELEMENT POSTED          SA62315 23235022
         CR    RLCB,R1                  ATTENTION ELEMENT       SA62315 23236022
         BE    AYZ710                   BRANCH IF LCB           SA62315 23237022
         LR    R9,RTRM                  INDICATE ATTENTION ELEMENT      23238020
AYZ710   EQU   *                                                        23238420
         SR    R12,R12                  CLEAR REGISTER                  23270020
         IC    R12,LCBUCBX              RLN - 1                         23280020
         SLL   R12,2                    MULTIPLY BY FOUR                23290020
         L     RSCB,DCBINVLI(R12)       ILIST FOR THIS LINE             23300020
         CLI   1(RSCB),0                ANY ACTIVE ENTRIES              23301020
         BNE   AYZ715                   BRANCH IF YES                   23302020
         LTR   R9,R9                    ATTENTION ELEMENT               23303020
         BNZ   AYZ758                   BR YES                 @YA08799 23304081
         BR    RETURN                   LINE IS STOPPED GET OUT         23305020
*                                                                       23305522
AYZ715   EQU   *                                                        23306020
         SR    R12,R12                  CLEAR INDEX REGISTER    OY00523 23308005
         IC    R12,2(RSCB)              LIST ENTRY SIZE                 23310020
         BCTR  R12,0                    REDUCE BY ONE TO INDEX          23320020
         LA    RTRM,8(RSCB)             ADDRESS OF FIRST ENTRY          23330020
         IC    R12,0(RTRM,R12)          GET INDEX BYTE                  23340020
         AR    R12,R12                  DOUBLE FOR NEGATIVE INDEX       23350020
         SR    RSCB,R12                 GET TERM TABLE INDEX            23360020
         MVC   LCBTTBIN(2),0(RSCB)      TEMPORARILY TO LCB              23370020
         LH    RTRM,LCBTTBIN            GET INDEX IN REGISTER           23380020
AYZ720   EQU   *                                                        23390020
         N     RTRM,AVTCLRHI            CLEAR HIGH ORDER HALF           23400020
         LR    R12,R15                  SAVE REGISTER 15                23410020
         L     R15,AVTRNMPT             ADDRESS TERM ENTRY ROUTINE      23420020
         BALR  RSCB,R15                 LINK TO ROUTINE                 23430020
         LR    R15,R12                  RESTORE REGISTER 15             23440020
         L     RSCB,LCBSCBA-1           ADDRESS OF SCB                  23450020
         L     RQCB,TRMDESTQ-1          ADDRESS OF DESTINATION QCB      23470020
         LTR   R9,R9                    ATTENTION ELEMENT POSTED        23472020
         BNZ   AYZ750                   BRANCH ON YES                   23474020
         TM    QCBFLAG,QCBTSSES         IS THIS TIME SHARING            23480020
         BCR   8,RETURN                 RETURN ON NO                    23490020
         ST    RTRM,SCBSCSEG-1          SAVE TERM ENTRY ADDRESS SA55387 23495022
         TM    QCBTSOF2,QCBDSSMI        HAS START MI BEEN SENT          23500020
         BCR   1,RETURN                 RETURN ON YES                   23510081
         TM    QCBTSOF1,QCBDELAY        IS QCB IN TIME DELAY QUEUE      23520020
         BZ    AYZ730                   BRANCH ON NO                    23530020
         LR    RECB,RQCB                ADDRESS OF ELEMENT              23540020
         LR    R12,R15                  SAVE REGISTER 15                23550020
         L     R15,AVTHG02              TIME DELAY REMOVAL RTN          23560020
         BALR  R14,R15                  REMOVE QCB FROM DELAY           23570020
         LR    R15,R12                  RESTORE REGISTER 15             23580020
         NI    QCBTSOF1,X'FF'-QCBDELAY     TURN OFF DELAY BIT    A44022 23582030
         L     RSCB,LCBSCBA-1           ADDRESS OF SCB                  23585020
AYZ730   EQU   *                                                        23590020
         TM    QCBTSOF1,QCBSATRD        SIMULATED ATTN REQUESTED        23600020
         BO    AYZ740                   BRANCH ON YES                   23610020
         TM    QCBTSOF1,QCBPARTO+QCBNOBUF+QCBWRBRK CAN WE READ @SA74985 23613081
         BNZ   AYZ770                   BRANCH ON NO           @SA74985 23616081
         TM    QCBTSOF1,QCBTGET         HAS TGET BEEN REQUESTED         23620020
         BZ    AYZ770                   BRANCH ON NO                    23630020
         OI    QCBTSOF2,QCBDSSMI        SET START MI SENT               23640020
         LA    R8,X0100                 ADDRESS OF CONSTANT             23650020
         ST    R8,SCBMACR-1             STORE IN SCB                    23660020
         NI    LCBSTAT1,LCBOCNI+LCBOCWTN CLEAR STATUS          @OY14092 23660110
         OI    LCBSTAT1,LCBRECVN        SET LCB RECEIVING      @OY14092 23670010
         MVC   LCBTTCIN,LCBTTBIN        SET CURRENTLY CONNECTED         23675020
         SR    R9,R9                    CLEAR REGISTER                  23690020
         LR    RETURN,RSCB              PASS SCB TO IEDAYM              23700020
***************  CHECK FOR 3270  ***************                        23705022
         L     R1,SCBSCSEG-1            RELOAD TRM REG          SA59987 23707022
         IC    R9,TRMCHCIN              INDEX TO CHARACTERISTICS S22028 23710022
         SR    R1,R1                    CLEAR REG               SA59987 23710522
         BCTR  R9,0                     REDUCE BY ONE            S22028 23711022
         MH    R9,AVTDCTLN              MULTIPLY BY SIZE OF A  @G36XRYP 23712000
*                                       DCT ENTRY              @G36XRYP 23712500
         A     R9,AVTCSTCS              ADD CHARACTERISTICS STARTS22028 23713022
         USING IEDDCT,R9                DCT ADDRESSABILITY     @G36XRYP 23713500
         TM    DCTBYTE1,DCT3270         IS THIS A 3270 TRM     @G36XRYP 23714000
         BZ    AYZ731                   NO, BRANCH               S22028 23715022
         LA    R8,AYZMASK7              ADDRESS OF MASK          S22028 23716022
         B     AYZ732                   GET ADDRESS MSGGEN       S22028 23717022
AYZ731   EQU   *                                                 S22028 23718022
         LA    R8,AYZMASK2              ADDRESS OF MASK          S22028 23719022
AYZ732   EQU   *                                                 S22028 23720022
         DROP  R9                       DROP DCT               @G36XRYP 23720500
         SR    R9,R9                    CLEAR REGISTER           S22028 23721022
         L     R12,AVTTSOPT             ADDRESS OF TIME SHARING QCB     23722022
         L     R12,TSIMSGEN-IEDQTSI(,R12) ADDRESS OF MSGGEN ROUTINE     23730020
         BR    R12                      BRANCH TO MSGGEN                23740020
AYZ740   EQU   *                                                        23750081
         OI    QCBTSOF2,QCBDSSMI        SET START MI SENT               23751081
         B     AYZ085                   SEND SIMATTN PROMPT             23752081
AYZ750   EQU   *                                                        23753081
         TM    QCBFLAG,QCBTSSES         IS THIS TIME SHARING            23754081
         BZ    AYZ758                   BR NO                  @YA08799 23755081
AYZ755   EQU   *                                               @SA71937 23758081
         MVI   LCBTSTSW,AVTEZERO        LCB CAN BE REUSED      @SA71937 23759081
         BR    RETURN                   RETURN TO CALLER       @SA71937 23760081
AYZ758   EQU   *                                               @YA08799 23761081
         TM    LCBSTAT1,LCBFREEN        LCB FREE               @YA08799 23762081
         BNO   AYZ760                   BR  NO                 @YA08799 23763081
         XI    LCBSTAT1,LCBRECVN+LCBFREEN SET RECEIVING STATUS @YA08799 23764081
AYZ760   EQU   *                                                        23778820
         MVI   LCBTSTSW,AVTEZERO        LCB CAN BE USED                 23779220
AYZ761   EQU   *                                                  21008 23779321
         ST    RLCB,LCBQCBA-1           QCB FOR POST                    23779620
         MVI   LCBPRI,PRILNFRE          LCB PRIORITY                    23779720
         LR    RTRM,RLCB                DISPATCH PARAMETER              23779820
         BAL   R14,DSPPOST              BRANCH TO POST         @G36XRYP 23780800
AYZ770   EQU   *                                                        23781820
         TM    QCBTSOF2,QCBSATTI        SIMULATED ATTENTION BY TIME     23783820
         BZ    AYZ780                   BRANCH ON NO                    23785820
         BAL   RDCB,AYZ090              LINK TO TIME DELAY ROUTINE      23787820
AYZ780   EQU   *                                                        23789820
         L     RDCB,LCBDCBPT            RESTORE DCB ADDRESS             23791820
         BR    RETURN                   RETURN                          23793820
*******************   DISPLAY MSGGENS  ***********************          23794822
         SPACE 2                                                        23795820
         DS    0F                                                       23797820
AYZMASK  DC    X'000C800000000000',A(SATMSG)     SIM ATTN MSG    S21903 23800022
AYZMASK2 DC    X'000C800000000000',A(SMI)        SMI             S21903 23805022
AYZMASK3 DC    X'000C800000000000',A(SAT2260)    2260 SIM ATTN   S21903 23810022
AYZMASK4 DC    X'000C800000000000',A(SAT2260R)   2260 SIM ATTN   S21903 23815022
AYZMASK5 DC    X'000C800000000000',A(SATTWX)     TWX SIM ATTN    S21903 23820022
AYZMASK6 DC    X'000C800000000000',A(SAT3270R)   3270R SIM ATTN  S22028 23825022
AYZMASK7 DC    X'000C800000000000',A(L327PRPT)   3270L PROMPT    S22028 23830022
AYZMASK8 DC    X'000C800000000000',A(SAT3270L)   3270L SIM ATTN  S22028 23835022
X0100    DC    X'0100'                           MASK            S21903 23840022
SATMSG   DC    X'07',X'17063606360617'           SIM ATTN MSG    S21903 23845022
SATTWX   DC    X'08',X'3C113C113C113C11'         TWX SIM ATTN    S21903 23850022
SMI      DC    X'01',X'4A'                       SMI             S21903 23855022
SAT2260  DC    X'04',C'***',X'4A'                2260 SIM ATTN   S21903 23860022
SAT2260R DC    X'03',C'***'                      2260R SIM ATTN  S21903 23865022
L327PRPT DC    X'01',X'C3'                       3270L PROMPT    S22028 23870022
SAT3270L DC    X'03',C'***'                      3270L SIM ATTN  S22028 23875022
SAT3270R DC    X'03',C'***'                      3270R SIM ATTN  S22028 23880022
         DS    0H                                                       23890020
         SPACE 2                                                        23900020
*        THIS CODE IS EXECUTED ON ENTRY FROM THE DIAL RECEIVE           23910020
*        SCHEDULER WHEN TSO IS IN THE SYSTEM.                           24000020
         SPACE                                                          27500020
AYZ100   EQU   *                                                        27600020
         LH    RTRM,LCBLNENT            GET LINE ENTRY                  27700020
         N     RTRM,AVTCLRHI            PARAMETERS FOR TERM NAME RTN    27800020
         LTR   RTRM,RTRM                IS THERE A LINE ENTRY?          27900020
         BCR   8,R2                     RETURN IF NOT - CAN'T BE TSO    28000020
         L     R15,AVTRNMPT                                             28100020
         BALR  RSCB,R15                 BRANCH TO ROUTINE               28200020
         L     RSCB,LCBSCBA-1           GET ADDRESS OF SCB              28300020
         L     RQCB,TRMDESTQ-1          GET QCB ADDRESS                 28500020
         TM    QCBFLAG,QCBTSSES         TSO SESSION IN PROGRESS?        28600020
         BCR   8,R2                     RETURN IF NOT                   28700020
         ST    RTRM,SCBSCSEG-1          SAVE TERM ENTRY ADDRESS SA55387 28750022
         TM    LCBTSOB,LCBPREP          IS THE LINE BEING MONITORED?    28900020
         BO    AYZ060                   BRANCH ON YES                   29100020
         TM    QCBTSOF1,QCBNOBUF+QCBPARTO+QCBWRBRK CAN WE READ?         29200020
         BNZ   AYZ140                   BRANCH ON NO                    29300020
         TM    QCBFLAG,QCBREAD          READ HAVE PRIORITY?             29400020
         BO    AYZ120                   BRANCH ON YES                   29500020
         TM    QCBFLAG,QCBNOBRK         CAN WE READ AHEAD?              29600020
         BZ    AYZ120                   BRANCH ON YES                   29700020
         TM    QCBTSOF1,QCBTGET         WAS A TGET ISSUED?              29800020
         BZ    AYZ140                   BRANCH ON NO TO FREE LINE       29900020
AYZ120   EQU   *                                                        30000020
         TM    QCBTSOF1,QCBSATRD        SIMULATED ATTENTION REQUESTED?  30100020
         BO    AYZ180                   BRANCH ON YES                   30700020
         TM    LCBSTAT2,LCBNEGRP        NEGATIVE RESPONSE TO POLL?      31400020
         BZ    AYZ130                   BRANCH ON NO                    31500020
         NI    LCBSTAT2,X'FF'-LCBNEGRP  SET TO REPOLL                   31600020
         SR    RTRM,RTRM                                                31660020
         ICM   RTRM,LOWBYTE,DCBINTVL    IS THERE A POLL DELAY    X02004 31720005
         BZ    AYZ130                   BRANCH ON NO                    31840020
         L     R15,LCBSTCBA-1           ADDRESS OF FIRST STCB     M5954 31850020
         CLI   0(R15),DSPDIASC          IS IT RECEIVE SCHEDULER   M5954 31860020
         BNE   AYZ130                   BRANCH IF NOT             M5954 31870020
         SPACE 2                                                        31900020
*        PUT LINE IN DELAY QUEUE                                        31960020
         SPACE                                                          32020020
         STH   RTRM,LCBEOLTD            TIME DELAY PARAMETER            32080020
         MVI   LCBTDL,X'14'             SET LCB INDEX                   32140020
         MVC   LCBSTCBA,LCBRSLNK        NEXT STCB IN CHAIN              32200020
         MVI   LCBPRI,PRILNFRE          PRIORITY                        32260020
         OI    LCBTSOB,LCBTSBUF         INDICATE TO DELAY RTN TSO LINE  32320020
         LA    RTRM,AVTDELYB            SET UP TO POST TO               32400020
         ST    RTRM,LCBQCBA-1             TIME DELAY QUEUE              32500020
         LR    RTRM,RLCB                                                32600020
         BAL   R14,DSPPOST              BRANCH TO POST         @G36XRYP 32700000
AYZ130   EQU   *                                                        32800020
         TM    QCBTSOF1,QCBDELAY        IS QCB IN THE DELAY QUEUE?      32810020
         BZ    AYZ132                   BRANCH ON NO                    32820020
         LR    RECB,RQCB                SET ADDRESS OF QCB TO BE REMOVE 32830020
         L     R15,AVTHG02              ADDRESS OF TIME DELAY REMOVAL   32840020
         BALR  R14,R15                  REMOVE QCB FROM DELAY QUEUE     32850020
         NI    QCBTSOF1,X'FF'-QCBDELAY     TURN OFF DELAY BIT    A44022 32852030
AYZ132   EQU   *                                                        32860020
         TM    QCBTSOF2,QCBINHBN        DO WE WANT INHIBITS?            32900020
         BZ    AYZ135                   BRANCH ON NO                    33000020
         OI    LCBTSOB,LCBINHBN         INDICATE USE OF INHIBITS        33100020
AYZ135   EQU   *                                                        33200020
         OI    LCBTSOB,LCBTSBUF         TURN ON TIME SHARING BIT        33300020
         BR    R2                       RETURN                          33400020
         SPACE 2                                                        33500020
*        PUT UP PREPARE ON APPROPRIATE LINES AND FREE LINE              33600020
         SPACE                                                          33700020
AYZ140   EQU   *                                                        33800020
         TM    QCBTSOF1,QCBSATRD        SIMULATED ATTENTION READ?       33900020
         BO    AYZ180                   BRANCH ON YES                   34100020
         TM    QCBTSOF2,QCBSATTI        SIMULATED ATTN BY TIME INTERVAL 34400020
         BO    AYZ190                   BRANCH ON YES                   34500020
AYZ150   EQU   *                                                        34600020
         NI    LCBSTAT1,LCBOCNI+LCBOCWTN CLEAR STATUS          @OY14092 34600110
         OI    LCBSTAT1,LCBFREEN        SET LCB FREE           @OY14092 34700010
         L     RSCB,LCBSCBA-1           GET ADDRESS OF SCB              34730020
         L     RTRM,SCBSCSEG-1          GET TERM ENTRY ADDRESS          34760020
         BAL   RETURN,AYZ320            BRANCH TO PUT UP PREPARE        34800020
         NI    LCBSTAT2,X'FF'-LCBNEGRP-LCBSNDPR                         34900020
         B     DSPDISP                  GO TO 'FORGET' LINE             35000020
AYZ180   EQU   *                                                        35100020
         TM    QCBTSOF2,QCBSIMRD        IS READ PART REQUESTED          35140020
         BZ    AYZ085                   BRANCH ON NO                    35180020
         NI    LCBSTAT2,X'FF'-LCBNEGRP  TURN OFF NEGATIVE RESPONSE      35220020
         B     AYZ132                   CHECK INHIBITS           S21903 35260022
AYZ190   EQU   *                                                        35300020
         TM    QCBTSOF2,QCBPOSTO        IS QCB ON RDY Q         SA56307 35400000
         BO    AYZ150                   IF SO, CNNOT DELAY      SA56307 35500000
         BAL   R14,QTIP25               GO PREPARE TO PUT QCB    Y02027 36200006
*                                       IN TIME DELAY QUEUE      Y02027 36250006
         LTR   R15,R15                  GO TO TIME DELAY RTN?           36300020
         BNZ   AYZ150                   NO - GO SET LCB FREE.    Y01948 36400005
         LR    R1,RQCB                  PASS QCB ADDRESS TO TIME DELAY  36500020
         L     R15,AVTHG01              ADDR OF TIME DELAY RTN.         36600020
         BALR  R14,R15                  GO TO TIME DELAY RTN.           36700020
         B     AYZ150                   SET LCB FREE             S21903 37100022
         SPACE 2                                                        37200020
**************************************************************** Y02027 37300006
*        SET UP QCB FOR INSERTION ON TIME DELAY QUEUE          * Y02027 37700006
**************************************************************** Y02027 38100006
QTIP25   EQU   *                                                 Y02027 38500006
         LA    R15,FOUR                 SET POSSIBLE RET CODE    Y02027 38900006
         TM    QCBTSOF1,QCBTPUT+QCBDELAY    IF A SEND OPER REQ'D Y02027 39300006
         BCR   NOTZERO,R14              OR IF QCB ALREADY ON TIMEY02027 39700006
*                                       DELAY Q, RETURN TO CALLERY02027 40100006
         L     R1,AVTTSOPT              GET ADDR OF TSINPUT QCB  Y02027 40500006
         USING IEDQTSI,R1               TSI ADDRESSIBILITY       Y02027 40900006
         MVC   QCBELCHN(THREE),TSISIMAT+ONE   SET UP TO POST QCB Y02027 41300006
         DROP  R1                       TO SIMULATED ATTN RTN    Y02027 41700006
*                                       WHEN TIME DELAY EXPIRES  Y02027 42100006
         MVI   QCBPRI,PRITIME           SET PRIORITY             Y02027 42500006
         BAL   R2,GETTSB                GO FIND TSB            @ZA01117 42900061
         SPACE 1                                                        43300006
         USING TSB,R5                   TSB ADDRESSIBILITY       Y02027 43700006
         MVC   QCBEOLDT(TWO),TSBATNTC   UPDATE TIME INTERVAL     Y02027 44100006
         DROP R5                                                 Y02027 44500006
         OI    QCBTSOF1,QCBDELAY        SET DELAY FLAG           Y02027 44900006
         MVC   QCBLINK(THREE),QCBCARCT  SAVE CARRIAGE CNT & TJID Y02027 45300006
         MVI   QCBRETCT,AVTEZERO        MARK ELEMENT AS A QCB    Y02027 45700006
         SR    R15,R15                  SET OK RETURN CODE       Y02027 46100006
         BR    R14                      RETURN TO CALLER         Y02027 46500006
         SPACE 1                                                        46900006
GETTSB   EQU   *                                                 Y02027 47300006
         L     R5,CVTPTR                GET CVT PTR              Y02027 47700006
         L     R5,CVTASVT-CVT(R5)       GET ASVT PTR             Y02027 48100006
         LA    R5,ASVTENTY-ASVT(R5)     GET ASCB LIST PTR        Y02027 48500006
         LH    R15,QCBTJID              GET TJID                 Y02027 48700006
         BCTR  R15,AVTEZERO             ADJUST FOR PROPER OFFSET Y02027 48900006
         SLL   R15,TWO                  MULTIPLY BY 4            Y02027 49300006
         AR    R5,R15                                            Y02027 49700006
         L     R5,AVTEZERO(,R5)         ASCB BASE                Y02027 49900006
         L     R5,ASCBTSB-ASCB(R5)      GET TSB                  Y02027 50100006
         BR    R2                       RETURN TO CALLER       @ZA01117 50500061
         SPACE 1                                                        50900006
*        THIS ENTRY POINT IS NO LONGER USED                    @OZ17622 51300010
AYZ200   EQU   *                                                        51700006
         SPACE 2                                                        53600020
*        THIS CODE IS EXECUTED ON ENTRY FROM QEVENT WHEN TSO IS IN      53700020
*        THE SYSTEM.                                                    53800020
         SPACE                                                          55200020
AYZ300   EQU   *                                                        55300020
         USING IEDQTRM,RTRM             REEST ADDRESSIBILITY     Y02027 55350006
         SR    RTRM,RTRM                                                55400020
         IC    RTRM,LCBUCBX             RLN MINUS ONE                   55500020
         L     RDCB,LCBDCBPT            PICK UP DCB ADDRS               55700020
         SR    R5,R5                    CLEAR REGISTER                  55710020
         IC    R5,DCBILCT               GET NUMBER OF LISTS             55720020
         BCTR  R5,0                     REDUCE BY ONE                   55730020
         CR    RTRM,R5                  IS RLN GREATER THAN NUMBER      55740020
*                                       OF LISTS                        55750020
         BCR   2,RETURN                 RETURN ON YES                   55760020
         SLL   RTRM,2                   MULTIPLY BY FOUR                55770020
         L     RSCB,DCBINVLI(RTRM)      GET INVITATION LIST ADDRESS     55800020
         CLI   0(RSCB),1                ONLY ONE ENTRY?                 55900020
         BCR   7,RETURN                 BRANCH ON NO TO RETURN          56000020
         SH    RSCB,AVTHA2              POINT TO TERMINAL INDEX         56100020
         LH    RTRM,0(RSCB)             PARAMETERS FOR TERMINAL         56200020
         N     RTRM,AVTCLRHI              NAME ROUTINE                  56300020
         ST    R15,AVTDOUBL             SAVE QEVENT BASE REGISTER       56400020
         L     R15,AVTRNMPT                                             56500020
         BALR  RSCB,R15                 BRANCH TO ROUTINE               56600020
         L     R15,AVTDOUBL             RESTORE QEVENT BASE REGISTER    56700020
         L     RQCB,TRMDESTQ-1          GET QCB ADDRESS                 56800020
         TM    QCBFLAG,QCBTSSES         IS IT A TIME SHARING SESSION?   56900020
         BCR   8,RETURN                 BRANCH ON NO TO RETURN          57000020
AYZ320   EQU   *                                                        57100020
         TM    LCBSTAT1,LCBOCNI         NON-IMMEDIATE OP CNTL    @01A   57130012
         BOR   RETURN                   BRANCH YES               @01A   57160012
         TM    LCBTSOB,LCBPREP          IS THERE ALREADY A PREPARE UP?  57200020
         BCR   1,RETURN                 RETURN IF YES                   57300020
         SR    R5,R5                                                    57400020
         IC    R5,TRMCHCIN              INDEX TO CHARACTERISTIC ENTRY   57500020
         BCTR  R5,0                     SUBTRACT ONE             S21903 57600022
         MH    R5,AVTDCTLN              MULTIPLY BY SIZE OF A  @G36XRYP 57700000
*                                       DCT ENTRY              @G36XRYP 57750000
         A     R5,AVTCSTCS              ADD ADDRESS OF TABLE            57800020
         USING IEDDCT,R5                DCT ADDRESSABILITY     @G36XRYP 57805000
         TM    LCBSTAT2,LCBDIAL         IS IT A DIAL LINE?              57810020
         BZ    AYZ325                   BRANCH ON NO                    57820020
         MVC   LCBTTBIN,LCBLNENT        MOVE IN TERMIANL INDEX          57830020
         B     AYZ330                   CHECK CONNECTED          S21903 57840022
AYZ325   EQU   *                                                        57850020
         TM    DCTBYTE1,DCTATTEN        TERMINAL HAVE ATTEN    @G36XRYP 57900000
         BCR   8,RETURN                 RETURN ON NO                    58000020
         SR    R8,R8                                                    58500020
         IC    R8,LCBUCBX               RLN MINUS ONE                   58600020
         SLL   R8,2                     MULTIPLY BY FOUR                58700020
         L     R8,DCBINVLI(R8)          GET INVITATION LIST ADDRESS     58800020
         CLI   0(R8),1                  ONLY ONE ENTRY?                 58900020
         BCR   7,RETURN                 BRANCH ON NO TO RETURN          59000020
AYZ330   EQU   *                                                        59030020
         NC    LCBTTCIN,LCBTTCIN        TERMINAL CONNECTED?             59040020
         BNZ   AYZ3300                  YES. INITIALIZATION UNNECESSARY 59050020
         MVC   LCBTTCIN,LCBTTBIN        INITIALIZE FOR MSGGEN ROUTINE   59060020
AYZ3300  EQU   *                                                        59080020
         TM    DCTBYTE2,DCTTWX          IS IT A TWX            @G36XRYP 59100000
         BO    AYZ340                   BRANCH ON YES                   59200020
         TM    LCBTSOB,LCB2741N         IS IT A 2741?                   59300020
         BO    AYZ360                   BRANCH ON YES                   59400020
         SPACE 2                                                        59500020
*        PUT UP PREPARE FOR 1050                                        59600020
         SPACE                                                          59700020
         DROP  R5                       DROP DCT               @G36XRYP 59800000
         SR    R5,R5                    CLEAR REGISTER                  59950020
         LA    R8,TRMOPNO               ADDRESS OF NUMBER OF OPTIONS    60000020
         TM    TRMDEVFL,ADDRCHAR        ARE ADDRESSING CHARS PRESENT    60050020
         BCR   14,RETURN                RETURN ON NO                    60100020
         TM    TRMSTATE,TRMOPTFN        ARE OPTION FIELDS PRESENT       60150020
         BNO   AYZ331                   BRANCH ON NO                    60200020
         IC    R5,TRMOPNO               NUMBER OF OPTION FIELDS         60250020
         LA    R8,3(R5,R8)              SKIP OVER OPTION FIELDS         60300020
AYZ331   EQU   *                                                        60350020
         TM    TRMDEVFL,BUFSIZE+DIALDIGS ARE DIAL DIGITS OR BUFFER      60400020
*                                       SIZE SPECIFIED                  60450020
         BZ    AYZ335                   BRANCH IF NEITHER PRESENT       60500020
         BM    AYZ333                   BRANCH IF ONLY ONE PRESENT      60550020
*   BOTH BUFFER SIZE AND DIAL DIGITS PRESENT                            60600020
         IC    R5,0(R8)                 LENGTH OF DEVICE FIELD          60650020
         LA    R8,1(R5,R8)              SKIP OVER FIELD                 60700020
AYZ333   EQU   *                                                        60750020
         IC    R5,0(R8)                 LENGTH OF DEVICE FIELD          60800020
         LA    R8,1(R5,R8)              SKIP OVER FIELD                 60850020
AYZ335   EQU   *                                                        60900020
         MVC   LCBCPA(8),WRCCCW         WRITE EOT CCW                   60950020
         XC    LCBCPA+8(8),LCBCPA+8     CLEAR CCW AREA                  61000020
         MVC   LCBCPA+15(1),0(R8)       SET CCW COUNT                   61050020
         LA    R8,1(R8)                 SKIP PAST COUNT                 61100020
         ST    R8,LCBCPA+8              STORE ADDRESS OF ADDRESSING     61150020
*                                       CHARACTERS IN CCW               61200020
         MVI   LCBCPA+8,WRITE           SET CCW COMMAND CODE            61250020
         MVI   LCBCPA+12,CCSLI          SET CCW FLAGS                   61300020
         MVC   LCBCPA+16(24),RSPCCW     MOVE REST OF CHANNEL PROGRAM    61350020
         MVI   LCBTPCD,X10              SET TP OP CODES                 61400020
         MVC   LCBTPCD+1(4),LCBTPCD     AND PROPAGATE                   61450020
         TM    LCBSTAT2,LCBRESP         RESPONSE OWED                   61456020
         BZ    AYZ390                   BRANCH NO                       61462020
*                                                                       61468020
       L       R8,LCBCPA                WRITE EOT ADDRESS               61474020
         BCTR  R8,0                     BACK IT UP TO EOA SEQUENCE      61480020
         ST    R8,LCBCPA                PUT BACK                        61486020
         NI    LCBSTAT2,X'FF'-LCBRESP   RESET RESPONSE OWED BIT         61492020
         B     AYZ390                   BRANCH TO EXCP                  61500020
         SPACE 2                                                        61550020
AYZ360   EQU   *                                                        62000020
         SPACE 2                                                        62100020
*        PUT UP A PREPARE FOR A 2741                                    62200020
         SPACE                                                          62300020
         TM    LCBTSOB,LCBCIRCD         WAS CIRCLE D OR CIRCLE C SENT?  62400020
         BO    AYZ385                   BRANCH IF IT WAS CIRCLE D       62500020
         MVC   LCBCPA(16),WRDCCW        SET UP CHANNEL PROGRAM          62700020
         MVI   LCBTPCD+1,X10            MOVE IN TP CODE                 62800020
         B     AYZ390                   SET UP CCW               S21903 62900022
         SPACE 2                                                        62920020
*        PUT UP MONITOR CHANNEL PROGRAM FOR TWX                         62940020
         SPACE 2                                                        62960020
AYZ340   EQU   *                                                        62980020
         MVC   LCBCPA(8),SPRBTCH   SET UP CCW                           62982020
         MVI   LCBTPCD+1,X10       SET SECOND TP OP CODE                62984020
         LA    RTRM,LCBCPA         ADDRESS OF WRITE                     62986020
         ST    RTRM,LCBCPA+8       SET UP TIC ADDRESS                   62988020
         MVI   LCBCPA+8,TIC        SET OP CODE                          62990020
         B     AYZ390              CONYINUE                             62992020
*                                                                       62994020
AYZ385   EQU   *                                                        63000020
         MVC   LCBCPA(8),PREPCCW        SET UP CHANNEL PROGRAM          63100020
AYZ390   EQU   *                                                        63200020
         MVI   LCBTPCD,X10              MOVE IN TP CODE                 63300020
         OI    LCBTSOB,LCBPREP          SET 'PREPARE ON LINE' BIT       63400020
         LA    RTRM,LCBCPA                                              63500020
         ST    RTRM,LCBSTART-1          MOVE IN START ADDRESS OF CCW    63600020
         LA    RTRM,LCBFLAG1            IOB ADDRESS IN REG 1 FOR EXCP   63800020
         ST    R15,AVTDOUBL             SAVE QEVENT BASE REGISTER       63900020
         EXCPVR (1),SUBSYS                                       Y01004 64000005
         L     R15,AVTDOUBL             RESTORE QEVENT BASE REGISTER    64100020
         BR    RETURN                   RETURN                          64200020
         SPACE 2                                                        64300020
*        THIS CODE IS EXECUTED ON ENTRY FROM THE SEND SCHEDULER WHEN    64400020
*        IT IS DISPATCHED OFF THE QCB, AND THE PRESENT TERMINAL IS      64500020
*        DEDICATED TO A TIME SHARING SESSION.  CODE AT ENTRY POINT      64600020
*        AYZ410 IS EXECUTED ON ENTRY FROM THE TS DESTINATION SCHEDULER  64700020
*        WHEN A TPUT WITH THE BREAK OPTION HAS BEEN REQUESTED.          64800020
         SPACE                                                          68100020
AYZ400   EQU   *                                                        68200020
         TM    QCBTSOF1,QCBDISC         ARE WE LOGGONG OFF              68230020
         BO    AYZ402                   BRANCH YES                M2550 68260020
         ST    R15,AVTSAVE3+4           SAVE REG 15            @SA67152 68262061
         BAL   R2,GETTSB                GET TSB                @SA67152 68266061
         L     R15,AVTSAVE3+4           RESTORE REG 15         @SA67152 68270061
         TM    TSBSTAT-TSB(R5),TSBDISC  IS IT LOGGING OFF      @SA67152 68274061
         BZ    AYZ400A                  NO  BRANCH             @SA67152 68280061
         NI    QCBTSOF2,NOT-QCBDSSMI    SMI OFF                @SA67152 68282061
         B     AYZ403                                          @SA67152 68284061
AYZ400A  EQU   *                                               @SA67152 68286061
         TM    QCBTSOF1,QCBSATRD        SIMULATED ATTENTION READ?       68300020
         BZ    AYZ400B                  NOT REQUESTED          @YA05164 68400061
         LR    RETURN,RLCB              MOVE SEND SCH TO LCB   @YA05164 68400261
         BAL   R14,DSPUNAVR             MOVE AND RETURN        @YA05164 68400461
         TM    LCBSTAT1,LCBFREEN        LCB FREE ?             @YA05164 68400681
         BNO   DSPDISP                  DISPATCH NEXT UNIT     @YA05164 68400781
         XI    LCBSTAT1,LCBSENDN+LCBFREEN   SEND ON,FREE OFF   @YA07698 68400881
         B     AYZ761                   POST LCB               @YA05164 68401061
         SPACE 1                                               @YA05164 68401261
AYZ400B  EQU   *                                               @YA05164 68401461
         TM    QCBTSOF1,QCBTPUT         Q IS THERE AN OUTSTANDING 21008 68402021
*                                       TPUT                      21008 68404021
         BO    AYZ401                   YES - CONTINUE SEND       21008 68404221
*                                       OPERATION                 21008 68404421
         TM    QCBTSOF1,QCBTGET         Q IS THERE AN OUTSTANDING 21008 68404821
*                                       TGET                      21008 68405221
         BO    AYZ498                   YES - SCHEDULE RECEIVE    21008 68405621
*                                       OPERATION                 21008 68405721
AYZ401   EQU   *                                                  21008 68405821
         TM    QCBTSOF2,QCBDSSMI        HAS STARTMI BEEN SENT           68406020
         BO    AYZ495                   BRANCH ON YES                   68412020
         B     AYZ403                   BRANCH AROUND 2741 CODE   M2550 68416020
AYZ402   EQU   *                                                        68420020
*  THE FOLLOWING CARD FOR M0892 REPLACES CODE ADDED BY PTM2550 TO       68422021
*  CHECK FOR A 2741 LEASED LOGGING OFF AND SETTING THE FIRST TIME       68424021
*  SWITCH IN LCBTPCD+11 TO CAUSE INITIAL READ AFTER LOGOFF TO SKIP      68426021
*  WRITE CIRCLE C. THIS IS TO ALLOW THE KEYBOARD TO LOCK, AND KEEP THE  68428021
*  METER FROM RUNNING UNTIL A USER WISHES TO LOG ON AGAIN.              68430021
*  THE CODE IS NOW A SUBROUTINE                                         68432021
         BAL   R2,AYZ403A               CHK FOR 2741 LEASED             68434021
AYZ403   EQU   *                                                  M2550 68436020
         TM    QCBTSOF1,QCBSATRD        SIMATTN?               @OZ28271 68436100
         BZ    AYZ403B                  NO                     @OZ28271 68436200
         MVI   QCBSATCT,ZERO            ZERO LINE COUNT        @OZ28271 68436300
         MVI   QCBCARCT,ZERO            ZERO CARRIAGE COUNT    @OZ28271 68436400
AYZ403B  EQU   *                                               @OZ28271 68436500
         NI    QCBTSOF1,X'FF'-QCBSATRD  RESET SIMATTN                   68440020
         NI    QCBTSOF2,X'FF'-QCBSIMRD  READ INDICATORS                 68460020
         LA    RSCB,DSPDISP             SET UP REG 14 FOR RETURN        68500020
         TM    QCBTSOF1,QCBWRBRK        WRITE BREAK REQUESTED?          68600020
         BO    AYZ405                   BRANCH ON YES                   68630020
         TM    QCBFLAG,QCBREAD          DOES READ HAVE PRIORITY?        68660020
         BO    AYZ495                   BRANCH ON YES                   68690020
         BR    RETURN                   RETURN                          68720020
         SPACE 1                                                  M0892 68721021
AYZ403A  EQU   *                                                  M0892 68722021
*  REMAINING PART  OF SUBROUTINE ADDED BY M2550 NOW MOVED BY M0892...   68723021
         TM    LCBTSOB,LCB2741N         IS THIS A 2741 LEASED     M2550 68724021
         BCR   8,R2                     BRANCH NO                 M2550 68725021
         TM    LCBSTAT2,LCBDIAL         IS IT LEASED LINE         M2550 68726021
         BCR   1,R2                     BRANCH NO                 M2550 68727021
         MVI   LCBTPCD+11,X'AB'         SET FIRST TIME SWITCH     M2550 68728021
         BR    R2                       RETURN TO CALLER          M2550 68729021
AYZ405   EQU   *                                                        68750020
         LA    R2,AYZ496                SET RETURN NOT FROM IEDAYDM6360 68820020
         B     AYZ411                   BRANCH                   A42370 68870022
AYZ410   EQU   *                                                        68900020
         TM    QCBTSOF1,QCBDISC         ARE WE LOGGING OFF       A42370 68950020
         BNO   AYZ410A                  BRANCH NO               OY03940 68960005
         BAL   R2,AYZ403A               CHK FOR 2741 LSD LOGOFF   M0892 68965021
AYZ410A  EQU   *                                                OY03940 68965305
         LA    R2,AYZ497                SET TO HIO RET CODE     OY03940 68965605
         SPACE 3                                                        68966005
AYZ411   EQU   *                                                SA68242 68967005
         NI    QCBFLAG,X'FF'-QCBREAD    TURN OFF 'READ PRIORITY' BIT    69000020
         SPACE 2                                                        69100020
*        DETERMINE WHETHER A WRITE BREAK CHANNEL COMMAND CAN BE         69200020
*        ISSUED.  IF SO, ISSUE AN IOHALT.                               69300020
         SPACE                                                          69400020
         TM    LCBSTAT1,LCBFREEN        IS LCB FREE                     69430020
         BO    AYZ412                   BRANCH ON YES                   69460020
         TM    LCBSTAT1,LCBRECVN        IS LINE RECEIVING               69500020
         BCR   8,RETURN                 BRANCH ON NO TO RETURN          69600020
AYZ412   EQU   *                                                        69610020
         TM    LCBTSOB,LCBWRBRK         WRITE BREAK IN PROGRESS         69630020
         BCR   1,RETURN                 RETURN IF YES                   69660020
         TM    LCBSTAT2,LCBMSGNN        IS IT FOR MSGGEN?               69700020
         BCR   1,RETURN                 RETURN IF YES                   69800020
         CLI   LCBCPA+CMDCODE,AUTOPOLL  IS LINE IN AUTOPOLL?     S22029 69810022
         BCR   8,RETURN                 YES. DO NOT BREAK LINE.  S22029 69820022
         TM    QCBTSOF1,QCBDISC         ARE WE LOGGING OFF              69830020
         BO    AYZ415                   BRANCH ON YES                   69860020
         TM    QCBFLAG,QCBNOBRK         CAN TERMINAL BE BROKEN?         69900020
         BCR   1,RETURN                 BRANCH ON NO TO RETURN          70000020
AYZ415   EQU   *                                                        70050020
         TM    LCBSTAT2,LCBDIAL         IS IT A DIAL LINE?              70100020
         BO    AYZ425                   BRANCH ON YES                   70200020
         LH    RTRM,LCBTTCIN            GET INDEX TO TERMINAL           70300020
         N     RTRM,AVTCLRHI                                            70400020
         LR    R8,R15                   SAVE REG 15                     70500020
         L     R15,AVTRNMPT             ADDRESS OF TERMINAL NAME RTN    70600020
         BALR  RSCB,R15                 GET TERM ENTRY ADDRESS   S21903 70700022
         LR    R15,R8                   RESTORE REG 15                  70800020
         LA    RSCB,DSPDISP             SET UP REG 14 FOR RETURN        70900020
         L     RTRM,TRMDESTQ-1          ADDRESS OF QCB                  71000020
         LA    RTRM,0(RTRM)                                             71100020
         LA    RQCB,0(RQCB)             CLEAR HIGH ORDER BYTE           71150020
         CR    RTRM,RQCB                ARE WE CONNECTED TO THIS TERM?  71200020
         BCR   7,RETURN                 BRANCH ON NO TO RETURN          71300020
AYZ425   EQU   *                                                        71400020
         L     R8,LCBLSPCI-1            GET ADDRESS OF FIRST BUFFER     71500020
         SR    RSCB,RSCB                                                71900020
         IC    RSCB,LCBUCBX             RLN MINUS ONE                   72000020
         SLL   RSCB,2                   MULTIPLY BY FOUR FOR INDEX      72100020
         L     RTRM,DCBDEBAD            DEB ADDRESS                     72200020
         L     RTRM,32(RTRM,RSCB)       UCB ADDRESS                     72300020
         TM    QCBFLAG,QCBNOBRK         CAN WE ISSUE BREAK              72310020
         BO    AYZ440                   BRANCH NO BREAK FEATURE         72320020
         OI    LCBTSOB,LCBWRBRK         BIT TO TELL CEA TO BREAK        72350020
         LR    R8,RTRM                  SAVE UCB ADDR          @SA68674 72353061
         SPACE 1                                                        72356061
AYZ440   EQU   *                                                        72360020
         SPACE 2                                                        72400020
*        ISSUE IOHALT                                                   72500020
         SPACE                                                          72600020
         MVI   LCBECBCC,HIOCC           PREVENT LOST LINE        Y02027 72700006
         IOHALT (1)                                                     72800020
         BR    R2                       RETURN TO CALLER       @OS76502 72850000
AYZ496   EQU   *                                                  M6360 72890020
         LR    RETURN,RLCB              TO MOVE SEND SCHED TO LCB M6360 72900020
         BAL   R14,DSPUNAVR             MOVE IT AND RETURN        M6360 72910020
AYZ497   EQU   *                                                 A42370 72912020
         TM    LCBSTAT1,LCBFREEN        LCB FREE                        72950020
         BNO   DSPDISP                  BRANCH NO                S22029 73000022
         XI    LCBSTAT1,LCBFREEN+LCBSENDN  SET LCB SENDING       S22029 73030022
         B     AYZ760                   POST LCB                 S22029 73060022
AYZ495   EQU   *                                                        73100020
         LR    RETURN,RLCB              MOVE SEND SCHEDULER TO LCB      73200020
         BAL   R14,DSPUNAV              BRANCH TO UNAVAIL      @G36XRYP 73300000
AYZ498   EQU   *                                                  21008 73350021
         NI    LCBSTAT2,X'FF'-LCBSNDPR  RESET SEND PRIORITY FLAG  21008 73360021
         CLI   LCBSTAT1,LCBFREEN        Q IS THE LINE FREE?       21008 73370021
         BE    AYZ499                   YES - GO CHECK FOR        21008 73380021
*                                       PARTIAL OUTPUT OR NO BUFR 21008 73385021
         NI    LCBTSOB,X'FF'-LCBSOPL    RESET START OF POLLING    21008 73390021
*                                       LIST INDICATOR            21008 73392021
         B     DSPDISP                  DISPATCH NEXT SUBTASK     21008 73394021
AYZ499   EQU   *                                                  21008 73396021
         TM    QCBTSOF1,QCBNOBUF+QCBPARTO Q IS THERE A PARTIAL    21008 73398021
*                                         OUTPUT LINE OR NO BFRS  21008 73398421
         BM    DSPDISP                  DISPATCH NEXT SUBTASK     21008 73398821
         NI    LCBSTAT1,LCBOCNI+LCBOCWTN CLEAR STATUS          @OY14092 73398910
         OI    LCBSTAT1,LCBSENDN        SET LCB SENDING        @OY14092 73399210
         B     AYZ761                   GO POST LCB               21008 73399621
         SPACE 2                                                        73400020
*        THIS CODE IS EXECUTED ON ENTRY FROM THE SEND SCHEDULER WHEN    73500020
*        IT IS DISPATCHED OFF THE LCB AND TIME SHARING IS IN THE        73600020
*        SYSTEM.                                                        73700020
         SPACE                                                          75800020
AYZ500   EQU   *                                                        75900020
         TM    QCBFLAG,QCBTSSES         TSO SESSION IN PROGRESS  S22029 76000022
         BNO   TCFUNCT                  NO - CHK TCAM FUNCTIONS  S22029 76010022
         TM    QCBTSOF1,QCBDELAY        IS QCB ON DELAY QUEUE    S22029 76020022
         BNO   CHKTJID                  CHECK FOR NON-ZERO TJID  S22029 76030022
*    QCB TSSES WILL BE ON WHEN TJID IS ZERO ONLY FOR THE LAST    S22029 76040022
*    PASS THROUGH THE SEND SCHEDULER WHEN A TSO SESSION ENDS     S22029 76050022
         CLC   AVTFZERO(2),QCBLINK+1    CHECK SAVED TJID         S22029 76060022
         BE    RESETSES                 ZERO TJID GO RESET TSSES S22029 76070022
         B     AYZ510                   CONTINUE TSO PROCESSING  S22029 76080022
CHKTJID  CLC   AVTFZERO(2),QCBTJID      IS IT A ZERO TJID        S22029 76090022
         BNE   AYZ510                   CONTINUE TSO PROCESSING  S22029 76100022
RESETSES NI    QCBFLAG,X'FF'-QCBTSSES   RESET TSO SESSION FLAG   S22029 76110022
         TM    LCBSTAT1,LCBOCWTN        STOPLINE IN PROGRESS   @OY14092 76110110
         BZ    RETSCHD                  NO                     @OY14092 76110210
         SR    R5,R5                    CLEAR REG              @OY14092 76110310
         IC    R5,LCBUCBX               PICK UP RLN-1          @OY14092 76110410
         SLL   R5,2                     MULTIPLY BY FOUR       @OY14092 76110510
         L     R5,DCBINVLI(R5)          GET ADDR INVLIST       @OY14092 76110610
         SR    RETURN,RETURN            CLEAR REG              @OY14092 76110710
         IC    RETURN,1(R5)             ACTIVE ENTRIES         @OY14092 76110810
         LTR   RETURN,RETURN            ANY ACTIVE ENTRIES?    @OY14092 76110910
         BZ    RETSCHD                  NO                     @OY14092 76111010
         LA    R8,7(R5)                 PT TO 1ST ENTRY-1      @OY14092 76111110
NEXTONE  EQU   *                                               @OY14092 76111210
         SR    R1,R1                    CLEAR REG              @OY14092 76111310
         IC    R1,2(R5)                 SIZE OF ENTRY          @OY14092 76111410
         AR    R8,R1                    PT TO INDEX BYTE       @OY14092 76111510
         SR    R0,R0                    CLEAR REG              @OY14092 76111610
         IC    R0,0(R8)                 PICK UP INDEX BYTE     @OY14092 76111710
         SLL   R0,1                     MULTIPLY BY 2          @OY14092 76111810
         LR    R1,R5                    SET PTR TO INV LIST    @OY14092 76111910
         SR    R1,R0                    BACK UP TO TNT INDEX   @OY14092 76112010
         LH    R1,0(R1)                 PICK UP TNT INDEX      @OY14092 76112110
         L     R15,AVTRNMPT             TERMNAME LOOKUP        @OY14092 76112210
         BALR  R14,R15                  GO TO TNT LOOKUP       @OY14092 76112310
         L     R1,TRMDESTQ-IEDQTRM-1(R1) PICK UP QCB           @OY14092 76112410
         TM    QCBFLAG-IEDQQCB(R1),QCBTSSES IS TSO SESSION     @OY14092 76112510
*                                           IN PROGRESS?       @OY14092 76112610
         BNZ   RETSCHD                  YES EXIT               @OY14092 76112710
         BCT   RETURN,NEXTONE           DECREMENT ACTIVE CNT   @OY14092 76112810
         NI    LCBSTAT1,AVTEFF-LCBOCWTN TURN OFF BIT           @OY14092 76112910
         OI    LCBSTAT1,LCBOCNI         SET NON-IMMEDIATE BIT  @OY14092 76113010
RETSCHD  EQU   *                                               @OY14092 76113110
         B     0(R2)                    DELAY SENDING TCAM MSGS  S22029 76120022
TCFUNCT  EQU   *                        CHECK FOR TCAM FUNCTIONS S22029 76130022
         TM    QCBDSFLG,QCBDISK+QCBCORE ANY NON-TSO FUNCTIONS?          76200020
         BZ    0(R2)                    PUT SEND SCH BACK IN QCB S22029 76300022
         L     RDCB,LCBDCBPT            PICKUP MHANDLER THIS     S22029 76310022
         LR    R8,RQCB                  DEST QCB FOR TESTING     S22029 76320022
         TM    LCBSTAT2,LCBDIAL         IS IT A DIAL LINE        S22029 76323022
         BZ    AYZ506                   NO - DONOT CHK LINE ENTRYS22029 76326022
         LH    RTRM,LCBLNENT            GET LINE ENTRY INDEX     S22029 76329022
         N     RTRM,AVTCLRHI            IS THERE A TERM OFFSET  SA59184 76330022
         BZ    AYZ506                   NO, BRANCH              SA59184 76331022
         L     R15,AVTRNMPT             GET ADDR OF TNT CODE     S22029 76332022
         BALR  R14,R15                  BRANCH TO ROUTINE        S22029 76335022
         L     R8,TRMDESTQ-1            GET LINE ENTRY QCB       S22029 76338022
AYZ506   EQU   *                                                 S22029 76341022
         L     R14,DCBMH-1              GET OWNING MH QCB        S22029 76344022
         USING CURMHQCB,R14             SMH QCB ADDRESSABILITY   S22029 76347022
         TM    QCBDSFLG-IEDQQCB(R8),QCBALTMH                     S22029 76350022
*                                       IS TERMINAL CONNECTED TO S22029 76353022
*                                       OWNING MSG HANDLER       S22029 76356022
         BZ    CHKTCAM                  YES. CHECK FOR TCAM MH   S22029 76360022
         L     R14,CURMHALT-1           PICKUP ALTERNATE MH      S22029 76370022
CHKTCAM  EQU   *                                                 S22029 76380022
         TM    CURMHFG2,CURMHTS         IS TERMINAL CURRENTLY    S22029 76390022
*                                       CONNECTED TO A TCAM MH?  S22029 76400022
         BO    0(R2)                    NO. DELAY SEND OPERATION S22029 76420022
*                                       UNTIL TERMINAL IS CONN-  S22029 76440022
*                                       ECTED TO A TCAM MH.      S22029 76460022
         B     8(R2)                    YES. BEGIN SENDING.      S22029 76480022
AYZ510   EQU   *                                                        76500020
         TM    QCBTSOF1,QCBDISC         ARE WE LOGGING OFF              76500320
         BO    AYZ511                   BRANCH IF YES                   76500620
         TM    QCBTSOF2,QCBDSSMI        START MI ON SCREEN              76500920
         BNO   AYZ512                   BRANCH ON NO                    76501220
         LR    R2,RQCB                  SAVE REG 7               S22028 76501322
         LR    R1,RLCB                  ELEMENT IN REG ONE     @SA71937 76501561
         LR    RQCB,RLCB                FOR UNAVAIL                     76501820
         BAL   R14,DSPBYPAS             RETURN TO DISPATCHER   @G36XRYP 76502200
AYZ511   EQU   *                                                        76502720
         TM    QCBTSOF1,QCBSATRD        SIMATTN?               @OZ28271 76502800
         BZ    AYZ511A                  NO                     @OZ28271 76502900
         MVI   QCBSATCT,ZERO            ZERO LINE COUNT        @OZ28271 76503000
         MVI   QCBCARCT,ZERO            ZERO CARRIAGE COUNT    @OZ28271 76503100
AYZ511A  EQU   *                                               @OZ28271 76503200
         NI    QCBTSOF1,X'FF'-QCBSATRD  RESET SIATTN                    76503400
         NI    QCBTSOF2,X'FF'-QCBSIMRD       READ INDICATORS            76503500
AYZ512   EQU   *                                                        76503620
         CLI   LCBTSTSW,AVTEFF          IS SWITCH SET                   76504020
         BNE   AYZ505                   BRANCH ON NO                    76508020
         MVI   LCBTSTSW,X'F0'           INSURE CONNECTION FOR SEND      76512020
AYZ505   EQU   *                                                        76516020
         L     RDCB,LCBDCBPT            GET DCB                         76520020
         TM    LCBTSOB,LCBPREP          IS LINE BEING MONITORED?        76540020
         BO    AYZ060                   BRANCH ON YES                   76560020
         TM    QCBTSOF1,QCBSATRD        SIMULATED ATTENTION READ?       76600020
         BO    AYZ520                   BRANCH ON YES                   76700020
         TM    QCBTSOF1,QCBWRBRK        WAS A WRITE READ REQUESTED @11C 76800026
         BZ    AYZ515                   BRANCH ON NO                    76900020
         NI    QCBFLAG,X'FF'-QCBREAD    TURN OFF READ PRIORITY BIT      77000020
AYZ514   EQU   *                                                SA56332 77000300
         TM    QCBTSOF1,QCBDELAY        IS QCB ON DELAY Q        A56332 77000521
         BC    EIGHT,FOUR(R2)           IF NOT RTN TO SEND       A56332 77001021
         LR    RECB,RQCB                ADDRESS OF QCB ELEMENT   A56332 77001521
         L     R15,AVTHG02              TIME DELAY REMOVAL       A56332 77002021
         BALR  R14,R15                  REMOVE FROM DELAY        A56332 77002521
         NI    QCBTSOF1,NOT-QCBDELAY    INDICATE NOT ON DELAY    A56332 77003021
         B    4(R2)                     RETURN TO START SEND            77100020
AYZ515   EQU   *                                                        77200020
         TM    QCBFLAG,QCBREAD          READ HAVE PRIORITY?             77300020
         BO    AYZ520                   BRANCH ON YES                   77400020
         TM    QCBTSOF1,QCBTPUT         ANY OUTPUT?                     77500020
         BO    AYZ514                   BR YES TO START SEND    SA56332 77600000
         BR    R2                       PUT SEND SCH BACK IN QCB        77700020
         SPACE 2                                                        77800020
*        A READ OF A PARTIAL INPUT LINE HAS PRIORITY OVER OUTPUT.       77900020
         SPACE                                                          78000020
AYZ520   EQU   *                                                        78100020
         TM    LCBINSRC+2,QCBDELAY      IS LCB IN THE DELAY QUEUE?      78200020
         BZ    AYZ530                   BRANCH ON NO                    78300020
         LR    RECB,RLCB                SEND ADDR OF LCB TO BE REMOVED  78400020
         LR    R12,R15                 SAVE REGISTER 15                 78500020
         L     R15,AVTHG02             ADDR OF TIME DELAY REMOVAL RTN   78600020
         BALR  R14,R15                  REMOVE LCB FROM DELAY Q.        78700020
         LR    R15,R12                 RESTORE REGISTER 15              78800020
         LR    R2,RQCB                  SAVE REG 7                      78810020
         LA    RQCB,LCBRSKEY            LINK REC SCHED INTO STCB CHAIN  78820020
         LR    RTRM,RQCB                                                78840020
         BAL   R14,DSPPRIOR             DISPATCHER WILL DO LINK         78860020
         LR    RQCB,R2                  RESTORE REG 7                   78880020
AYZ530   EQU   *                                                        78900020
         TM    QCBTSOF2,QCBDSSMI        START MI ON SCREEN       S22028 78902322
         BO    AYZ530B                  YES, BRANCH              S22028 78902622
         BAL   R2,GETTSB                GO FIND TSB            @ZA01117 78903061
*                                       WITH TSB ADDRESS IN R5   Y02027 78906006
         LH    R14,TSBASRCE-TSB(R5)     LOAD TERM INDEX                 78909020
         SR    R9,R9                    CLEAR REGISTER                  78910020
         IC    R9,LCBUCBX               RLN-1                           78911020
         SLL   R9,2                     MULTIPLY BY FOUR                78912020
         L     R5,DCBINVLI(R9)          INVITATION LIST ADDR            78913020
         LR    R12,R5                   SAVE ADDR                       78914020
         LA    R12,8(R12)               FIRST ACTIVE ENTRY              78915020
AYZ530A  EQU   *                                                        78916020
         TM    LCBSTAT2,LCBSYNC         IS THIS A BSC DEVICE     S22028 78916122
         BZ    AYZ530D                  NO, BRANCH               S22028 78916222
         CLI   1(R12),X'FE'             END OF INVITATION LIST   S22028 78916322
         BNE   AYZ530E                  NO, BRANCH               S22028 78916422
         LA    R12,1(R12)               INCREMENT PAST EOT CHAR  S22028 78916522
         B     AYZ530B                  BRANCH                   S22028 78916622
AYZ530D  EQU   *                                                 S22028 78916722
         CLI   0(R12),X'FE'             END OF LIST                     78917020
         BE    AYZ530B                  BRANCH IF YES                   78918020
AYZ530E  EQU   *                                                 S22028 78918522
         LR    R15,R12                  SAVE CURRENT ENTRY ADDR         78919020
         SR    R2,R2                    CLEAR REGISTER                  78920020
         IC    R2,2(R5)                 GET SIZE OF LIST ENTRY          78921020
         BCTR  R2,0                     REDUCE BY ONE                   78922020
         LA    R12,0(R12,R2)            ADDR OF INDEX BYTE              78923020
         IC    R2,0(R12)                PICK UP INDEX                   78924020
         SLL   R2,1                     MULTIPLY BY TWO                 78925020
         LR    R9,R5                    INVITATION LIST ADDR            78926020
         SR    R9,R2                    POINT TO TERM INDEX             78927020
         LH    R9,0(R9)                 LOAD TERM INDEX                 78928020
         LA    R12,1(R12)               POINT TO NEXT ENTRY             78929020
         CR    R9,R14                   TERM INDEX EQUAL                78930020
         BNE   AYZ530A                  BRANCH IF NO                    78931020
         STCM  R15,ADDR,LCBINVPT        UPDATE INVITATION LIST   X02004 78932005
*                                       ADDRESS.                 X02004 78933005
AYZ530B  EQU   *                                                        78935020
         LA    RETURN,LCBRSKEY          ACTIVATE RECEIVE SCHEDULER      78950020
         LR    RTRM,RLCB                ADDRESS OF ELEMENT              79000020
         LR    RQCB,RLCB                ADDRESS OF QCB                  79100020
         BAL   R14,DSPBYPAS             ACTIVATE NEXT SUBTASK  @G36XRYP 79200000
         SPACE 2                                                        79300020
*        THIS CODE IS EXECUTED ON ENTRY FROM ACTIVATE BEFORE            79400020
*        BUILDING AN INPUT OR OUTPUT CHANNEL PROGRAM WHEN TSO IS IN     79500020
*        THE SYSTEM.                                                    79600020
         SPACE                                                          81400020
*  PLEASE NOTE DIFFERENT BASE REGS FOR LCB AND DCB DSECTS.       A52506 81401021
         DROP  RLCB                                              A52506 81402021
         DROP  RDCB                                              A52506 81403021
         USING IEDQLCB,R2               ACTIVATE LCB BASE        A52506 81404021
         USING IHADCB,RLCB              ACTIVATE DCB BASE        A52506 81405021
AYZ600   EQU   *                                                        81500020
         TM    LCBSTAT2,LCBDIAL         IS THIS A DIAL LINE      A52506 81600021
         BZ    AYZ691                   NO, BRANCH                      81700020
         LH    RTRM,LCBLNENT            GET LINE ENTRY FOR DIAL  A52506 81800021
         B     AYZ692                   GET TERM ENTRY           S21903 81900022
AYZ691   EQU   *                                                        82000020
         LH    RTRM,LCBTTBIN            TO BE CONN. INDEX FOR LSD 52506 82400021
AYZ692   EQU   *                                                        82500020
         LR    RQCB,R15                 SAVE REGISTER 15                82600020
         L     R15,AVTRNMPT             ADDRESS OF TERM NAME TABLE      82700020
         BALR  RSCB,R15                 GET TERM ENTRY ADDRESS          82800020
         LR    R15,RQCB                 RESTORE REGISTER 15             82900020
         L     RSCB,LCBSCBA-1           GET SCB ADDRESS          A52506 83000021
         L     RQCB,TRMDESTQ-1          GET ADDRESS OF DESTINATION QCB  83100020
         TM    QCBFLAG,QCBTSSES         IS THIS A TSO SESSION?          83200020
         BCR   8,RETURN                 BRANCH ON NO TO RETURN          83300020
         TM    LCBSTAT1,LCBRECVN        IS LINE RECEIVING        A52506 83400021
         BCR   8,RETURN                 BRANCH ON NO TO RETURN          83500020
         TM    LCBSTAT2,LCBMSGNN        IS IT FOR MSGGEN         A52506 83600021
         BCR   1,RETURN                 BRANCH ON YES TO RETURN         83700020
         TM    QCBFLAG,QCBREAD          READ HAVE PRIORITY?             84000020
         BCR   1,RETURN                 RETURN ON YES                   84100020
         TM    QCBTSOF1,QCBSATRD        SIM ATTN READ IN PROGRS@SA73152 84200061
         BOR   RETURN                   YES - BRANCH           @SA73152 84220061
         TM    QCBFLAG,QCBNOBRK         IS IT A BREAK TERMINAL @SA73152 84240061
         BZ    BREAK                    YES-SEE BREAK REQUESTED@SA73152 84260061
         TM    QCBTSOF1,QCBTGET         WAS A TGET ISSUED      @SA73152 84280061
         BOR   RETURN                   YES - BRANCH           @SA73152 84300061
BREAK    EQU   *                                               @SA73152 84320061
         TM    QCBTSOF1,QCBTPUT         WAS A TPUT ISSUED      @SA73152 84340061
         BZR   RETURN                   NO - BRANCH            @SA73152 84360061
         NI    QCBTSOF2,AVTEFF-QCBDSSMI TURN OFF SMI           @SA76279 85360081
         L     R12,AVTMSGS-1            GET ADDR OF BD         @YA10969 88100081
         MVC   LCBQCBA,1(R12)                                  @YA10969 89100081
         MVI   LCBPRI,PRILCB            PRIORITY FOR CLEANUP   @YA10969 90100081
         LR    RTRM,R2                  POST LCB               @YA10969 91100081
         BAL   R14,DSPPOST                                     @G36XRYP 92100000
         EJECT                                                          97000020
CURMHQCB DSECT                                                   S22029 97114022
         SPACE 2                                                 S22029 97121022
CURMHFG1 DS    AL1                      FLAG BYTE - UNUSED       S22029 97128022
CURMHALT DS    AL3                      ADDR OF ALTERNATE MH     S22029 97135022
CURMHFG2 DS    AL1                      FLAG BYTE                S22029 97142022
*        BIT DEFINITIONS                                         S22029 97149022
CURMHTS  EQU   X'01'                    INDICATES A TIME-SHARING S22029 97156022
*                                       MESSAGE HANDLER          S22029 97163022
CURMHLEX DS    AL3                      EXIT ADDRESS OF LOGON    S22029 97170022
*                                       MACRO IN THIS MH         S22029 97177022
CURMHLEN DS    AL1                      LENGTH OF STARTMH QCB    S22029 97184022
         SPACE 3                                                 S22029 97191022
         TTRMD                                                          97200020
         EJECT                                                          97300020
         TAVTD                                                          97900020
         TTSID                                                          98000020
         TSCBD                                                          98100020
         TSTCBD                                                    @P1A 98100525
         TLCBD                                                          98200020
         TQCBD                                                          98300020
         TPRFD                                                          98400020
         DCBD  DSORG=TX                                                 98500020
         TDCTD                                                          98550000
         TDISPD                                                         98600020
         TPRIOR                                                         98700020
CVT      CVT                                                            98720006
         IKJTSB                                                         98740020
CVTTSCVT EQU   CVTRMS+4                 ******  FOR TESTING***** MVMTST 98760006
CVTMAP   EQU   CVT                      TEST                     MVMTST 98762006
         IHAASCB                                                 Y02027 98764006
         SPACE 2                                                        98766006
         IHAASVT                                                 Y02027 98768006
         SPACE 2                                                        98770006
         TTCXD                                                   Y02027 98772006
         SPACE 3                                                        98774006
         END                                                            98800020
