         TITLE 'IEDIAA - TCAM COMMON OPEN ROUTINE'                      00100008
IEDIAA   CSECT                                                          00200008
*A-000000-999999                                               @X31X8N0 00250008
         SPACE 3                                                        00300008
*  CHANGE ACTIVITY AS FOLLOWS                                           00400008
******************** MICROFICHE FLAGS *********************** SUPT CODE 00500008
*****   THIS MODULE IS A RE-WRITE OF IGG01932   *****          @Z30X8NJ 00600008
*A116800                                                       @ZA02601 01600008
*A118600                                                       @ZA07083 01600181
*          TCAM LEVEL 10.0 CHANGES                             @G36XRNP 01700100
*A158000                                                       @G36XRNP 01800100
*C190000,237700,252400-253100,254500,512000,542000,373000      @G36XRNP 01900100
*C385000                                                       @G36XRNP 02000100
*D34600-350000,352000,514000                                   @G36XRNP 02100100
*A116900                                                       @G36XRNU 02200100
*********************************************************************** 02800008
* MODULE NAME - IEDIAA  (TCAM,INITIALIZATION)                  @G36XRNP 02900000
*                                                              @Z30X8NJ 03000008
* DESCRIPTIVE NAME - TCAM COMMON OPEN ROUTINE                  @Z30X8NJ 03100008
*                                                              @Z30X8NJ 03200008
* COPYRIGHT - 'NONE'                                           @Z30X8NJ 03300008
*                                                              @Z30X8NJ 03400008
* STATUS - CHANGE LEVEL 10.0                                   @G36XRNP 03500000
*                                                              @Z30X8NJ 03600008
* FUNCTION - THIS ROUTINE OBTAINS THE TCAM CVT EXTENSION.      @Z30X8NJ 03700008
*    THIS ROUTINE THEN FIXES DATA AREAS WHICH MUST BE IN CORE IN      * 03800008
*    ORDER FOR TCAM TO OPERATE UNDER VS.  THE AVT,             @Z30X8NJ 03900008
*    CPB'S, TERMINAL TABLE, TNT, DCT, I/O TRACE AREA, BUFFER   @Z30X8NJ 04000008
*    POOL,AND, IF ENVIRON = TSO OR MIXED, THE TSINPUT QCB WILL   X02004 04100008
*    BE FIXED BY THIS MODULE.  THE FOLLOWING DATA AREAS WILL BE@Z30X8NJ 04200008
*    FIXED FOR EACH LINE BY IGG01936 - DCB, SCB, LCB, AND THE  @Z30X8NJ 04400008
*    INVITATION LIST. IF TCAM IS RUNNING UNDER VM, THEN THE    @Z30X8NJ 04600008
*    VIRTUAL DIAGNOSE ROUTINE WILL BE LOADED.                  @Z30X8NJ 04800008
*                                                                X03039 05100008
* ENTRY POINT - THIS ROUTINE IS ENTERED AT IEDIAA VIA A LINK   @Z30X8NJ 05200008
*               FROM IEDQOA                                    @Z30X8NJ 05250008
*                                                                X03039 05400008
* INPUT - REGISTERS 1 AND 14 ARE INPUT AS FOLLOWS:               X03039 05500008
*    1 - CONTAINS THE AVT ADDRESS                                X03039 05600008
*   14 - CONTAINS THE RETURN ADDRESS FOR IEDQOA                  X03039 05700008
*                                                                X03039 05800008
* OUTPUT - ALL NEEDED DATA AREAS WILL BE FIXED.                       * 05900008
*                                                                     * 06200008
* EXTERNAL ROUTINES - AOS LOAD ROUTINE (SVC 8)                        * 06300008
*                                                                     * 06400008
* EXITS, NORMAL                                                       * 06500008
*    THIS ROUTINE EXITS VIA BR 14 TO IEDQOA                      X03039 06600008
*                                                                     * 06700008
* EXITS, ERROR     N/A                                                * 06800008
*                                                                     * 06900008
* TABLES/WORKAREAS - DCB                                       @Z30X8NJ 07000008
*                    AVT                                       @Z30X8NJ 07010008
*                    PRIORITY                                  @Z30X8NJ 07020008
*                    CVT                                       @Z30X8NJ 07030008
*                    COMMON BUFFER MASTER QCB                  @Z30X8NJ 07040008
*                    TERMNAME TABLE                            @Z30X8NJ 07050008
*                    TSID                                      @Z30X8NJ 07060008
*                                                                     * 07100008
*  ATTRIBUTES - THIS ROUTINE IS EXECUTED ENABLED AND RE-ENTRANT  X03039 07200008
*                                                                     * 07400008
* CHARACTER CODE DEPENDENCY - THE OPERATION OF THIS MODULE DOES NOT   * 07500008
*    DEPEND UPON A PARTICULAR INTERNAL REPRESENTATION OF THE EXTERNAL * 07600008
*    CHARACTER SET.                                                   * 07700008
*                                                                     * 07800008
* NOTES - NONE                                                        * 07900008
*                                                                     * 08000008
*********************************************************************** 08100008
        EJECT                                                           08200008
*        REGISTER USAGE                                                 08300008
R0       EQU   0                        WORK REGISTER          @Z30X8NJ 08400008
R1       EQU   1                        WORK REGISTER          @Z30X8NJ 08500008
R2       EQU   2                        WORK REGISTER          @Z30X8NJ 08600008
R3       EQU   3                        WORK REGISTER          @Z30X8NJ 08700008
RCORE    EQU   4                        WORK REGISTER FOR FIXING Y01948 08800008
R6       EQU   6                        WORK REGISTER          @Z30X8NJ 09000008
R7       EQU   7                        WORK REGISTER          @Z30X8NJ 09060008
R8       EQU   8                        WORK REGISTER          @Z30X8NJ 09120008
RAVT     EQU   9                        ADDRESS OF TCAM AVT             09200008
RTNT     EQU   10                       ADDR OF TERMNAME TABLE @Z30X8NJ 09300008
RCMB     EQU   10                       ADDR OF MASTER QCB     @Z30X8NJ 09350008
R10      EQU   10                       WORK REGISTER          @Z30X8NJ 09400008
R11      EQU   11                       WORK REGISTER          @Z30X8NJ 09450008
RBASE    EQU   12                       BASE OF IEDIAA         @Z30X8NJ 09500008
RTCX     EQU   13                       ADDR OF TCX            @Z30X8NJ 09550008
R13      EQU   13                       WORK REGISTER          @Z30X8NJ 09600008
R14      EQU   14                       RETURN ADDRESS           X03039 09700008
R15      EQU   15                       WORK REGISTER          @Z30X8NJ 09800008
RCVT     EQU   15                       CVT BASE REGISTER      @Z30X8NJ 09850008
*                                                                       09900008
         USING IEDQAVTD,RAVT            AVT DSECT                       10100008
         USING IEDQTNTD,RTNT            TERMNAME TABLE DSECT   @Z30X8NJ 10200008
         USING IEDQTCX,RTCX             TCX DSECT              @Z30X8NJ 10230008
         USING CVT,RCVT                 CVT BASE               @Z30X8NJ 10260008
         USING IEDNSVTD,R7              THE SECONDARY AVT DSECT  X03039 10300008
         SPACE 2                                                        10400008
         BALR  RBASE,ZERO               SET UP ADDRESSABILITY           10500008
         USING *,RBASE                                                  10600008
         SPACE 2                                                        10700008
IEDIAA IEDHJN SKIPP                                              X03039 10800008
*                                                                       10900008
         LR    RAVT,R1                  INITIALIZE AVT BASE    @Z30X8NJ 11000008
         AH    R1,MINUS3                POINT TO SYSTEM TYPE     X03039 11000108
         CLI   AVTEZERO(R1),VS          CORRECT MACRO USED              11000208
         BE    GOODASM                  YES,CONTNUUE                    11000308
         MVI   MESGERR1,MACROERR        MOVE ERROR CHAR          X03039 11000408
         MVC   MESGERR2(EIGHT),MACERR   MOVE ERROR WORD          X03039 11000508
         B     ERRMSG                   WRITE ERR MSG AND ABEND  X03039 11000608
GOODASM  EQU   *                                                        11000708
         MODESET MODE=SUP               GET INTO SUPERVISOR    @ZM30327 11001008
*                                         STATE                @ZM30327 11002008
         MODESET EXTKEY=SUPR            PLACE MODULE IN KEY 0  @ZM30327 11003008
*                                                                Y02027 11005008
*              GET CORE FOR PAGE FIX PARAMETER LIST              Y02027 11010008
*                                                                Y02027 11015008
         GETMAIN RC,LV=16,SP=254                                        11020008
         LTR   R15,R15                  GETMAIN SUCCESSFUL     @Z30X8NJ 11025008
         BNZ   ERRORMSG                 NO, INDICATE ERROR     @Z30X8NJ 11030008
         LR    R11,R1                   GET ADDR OF GOTTEN CORE@Z30X8NJ 11035008
         XC    ZERO(PGFXAREA,R11),ZERO(R11)  CLEAR PAGEFIX     @Z30X8NJ 11040008
*                                       PARAMETER LIST           Y02027 11045008
*                                                                Y02027 11050008
*              GET CORE FOR TCAM'S CVT EXTENSION                 Y02027 11055008
*                                                                Y02027 11060008
         MODESET EXTKEY=TCAM                                            11065008
         GETMAIN RC,LV=TCXSIZE,SP=231   GET TCX AREA             Y02027 11070008
         MODESET EXTKEY=SUPR                                            11075008
*                                                                Y02027 11080008
         LTR   R15,R15                  GETMAIN SUCCESSFUL     @Z30X8NJ 11085008
         BNZ   ERRORMSG                 NO, INDICATE ERROR     @Z30X8NJ 11090008
         XC    ZERO(TCXSIZE,R1),ZERO(R1)  CLEAR TCX AREA       @Z30X8NJ 11095008
         EJECT                                                          11200008
         L     RCVT,CVTPTR              ADDRESS OF CVT         @Z30X8NJ 11300008
         ST    R1,CVTAQAVT              STORE ADDRESS OF TCX IN@Z30X8NJ 11320008
*                                       CVT                      Y02027 11340008
         USING IEDQTCX,RTCX             TCX BASE               @Z30X8NJ 11360008
         LR    RTCX,R1                  SAVE TCX ADDRESS       @Z30X8NJ 11380008
         LR    R0,R1                    START OF TCX FOR       @Z30X8NJ 11400008
*                                         PAGEFIX ROUTINE      @Z30X8NJ 11420008
         LA    R1,TCXSIZE               SIZE OF TCX FOR PAGEFIX@Z30X8NJ 11440008
*                                         ROUTINE              @Z30X8NJ 11460008
         BAL   R6,FIXPAGE               FIX THE TCX            @Z30X8NJ 11480008
         L     RCVT,CVTPTR              RESTORE CVT ADDRESS    @Z30X8NJ 11500008
         EJECT                                                          11520008
*****************************************************************Y02027 11540008
*                                                               *Y02027 11560008
*        INITIALIZE TCAM'S CVT EXTENSION                        *Y02027 11580008
*                                                               *Y02027 11600008
*****************************************************************Y02027 11620008
         STCM  RAVT,AD,TCXAVT+ONE       ADDRESS OF AVT         @Z30X8NJ 11640008
         MVC   TCXPASWD,AVTPASWD        MOVE THE SCRAMBLED       Y02027 11660008
*                                       PASSWORD FROM THE AVT    Y02027 11680008
         MVC   TCXSCBSZ(ONE),AVTSCBSZ   COPY SIZE OF SCB       @ZA02601 11690008
         MVC   TCXABEPL,AVTABEPL        MOVE ABEND PARM TO TCX @G36XRNU 11695000
         MVC   TCXOCQ,AVTOCQPT          MOVE ADDR OF OPEN/CLOSE  Y02027 11700008
*                                       QCB TO TCX               Y02027 11720008
         MVC   TCXCOMPT,AVTCOMPT        MOVE CSCB ADDR TO TCX    Y02027 11740008
         LH    R1,AVTEW                 PICKUP THE AIB SIZE    @Z30X8NJ 11760008
         LA    R1,AIBPRFSZ(,R1)         ADD 72 BYTE AIB PREFIX @Z30X8NJ 11780008
         STH   R1,TCXSZAIB              STORE AIB SIZE IN TCX  @Z30X8NJ 11800008
         TM    AVTEW+TWO,TCXAUTH        DO A. P. REQUIRE AUTH.   Y02027 11820008
         BNO   UPDATCX                  BRANCH IF NO             Y02027 11840008
         OI    TCXFLAG1,TCXAUTH         TURN OF AUTH FLAG        Y02027 11860008
         TM    AVTSCOPT,AVTAPDMP        IS APPL DUMP REQUESTED @ZA07083 11865081
         BZ    UPDATCX                  BRANCH IF NO           @ZA07083 11870081
         OI    TCXFLAG1,TCXAPDMP        TURN ON APPL DUMP FLAG @ZA07083 11875081
UPDATCX  EQU   *                                                 Y02027 11880008
         MVC   TCXTCB,AVTTCB            ADDRESS OF TCB           Y02027 11900008
         USING PSA,R0                   SET UP PSA BASE REG    @Z30X8NJ 11920008
         L     R1,PSAAOLD               ADDR OF CURRENT ASCB   @Z30X8NJ 11940008
*                                         FOR TCAM'S MEMORY    @Z30X8NJ 11960008
         USING ASCB,R1                  ASCB BASE              @Z30X8NJ 11980008
         ST    R1,TCXASCB               ADDR OF SPACE CONTROL  @Z30X8NJ 12000008
*                                       BLOCK FOR TCAM MEMORY    Y02027 12020008
         MVC   TCXASID,ASCBASID         ADDRESS SPACE IDENTIFIER Y02027 12040008
*                                       FOR TCAM MEMORY          Y02027 12060008
         SPACE 1                                                        12080008
*        SAVE ATTENTION TABLE ROUTINE POINTER                    Y02027 12100008
         L     R1,CVTIXAVL              GET POINTER TO         @Z30X8NJ 12120008
*                                       COMMUNICATIONS AREA FOR  Y02027 12140008
*                                       I/O SUPERVISOR           Y02027 12160008
         DROP  R1                       DROP ASCB BASE         @Z30X8NJ 12170008
         USING IOCOM,R1                 IOCOM ADDRESSABILITY   @Z30X8NJ 12180008
         L     R1,IOCATTBL              GET ATTN TABLE POINTER @Z30X8NJ 12200008
         DROP  R1                       DROP IOCOM BASE        @Z30X8NJ 12210008
         USING ATB,R1                   ATTN TABLE BASE        @Z30X8NJ 12220008
         LA    R1,TCAM(R1)              INCREMENT ATTN TABLE   @Z30X8NJ 12240008
*                                         ADDRESS              @Z30X8NJ 12260008
         MVC   TCXSATTN,ATBRTN          SAVE INITIAL VALUE OF    Y02027 12280008
*                                       ATTN ROUTINE POINTER     Y02027 12300008
*                                       FOR TCAM                 Y02027 12320008
         DROP  R0                       DROP PSA BASE REG      @Z30X8NJ 12340008
         DROP  R1                       DROP ATB  BASE         @Z30X8NJ 12360008
         EJECT                                                          12900008
*****************************************************************       13000008
*                                                               *       13100008
*        THE FOLLOWING CODE IS EXECUTED AT INTRO TIME TO        *       13200008
*        FIX THE AVT, QCBS, CPBS, TNT, TERMINAL TABLE, DCT,     *       13300008
*        BUFFER POOL, AND, IF ENVIRON = TSO OR MIXED, THE       *X02004 13400008
*        TSINPUT QCB.                                           *X02004 13500008
*                                                               *       13600008
*****************************************************************       13700008
         LR    R0,RAVT                  ADDRESS OF THE AVT     @Z30X8NJ 13800008
         LA    R1,AVTLNG                MAXIMUM AVT LENGTH     @Z30X8NJ 13900008
         BAL   R6,FIXPAGE               FIX AVT                @Z30X8NJ 14000008
*                                                                       14100008
         USING IEDQTNTD,RTNT            SET UP ADDRESSIBILITY  @Z30X8NJ 14200008
         L     RTNT,AVTRNMPT            ADDRESS OF TERMNAME    @Z30X8NJ 14270008
*                                         TABLE (TNT)          @Z30X8NJ 14340008
         SR    R1,R1                    CLEAR REGISTER 1       @Z30X8NJ 14410008
         IC    R1,TNTENLEN              LENGTH OF ENTRY        @Z30X8NJ 14480008
         LA    R0,THREE                 LENGTH OF ADDRESS      @Z30X8NJ 14550008
         AR    R1,R0                    LENGTH OF TNT ENTRY    @Z30X8NJ 14620008
         LR    R7,R1                    SAVE THE ENTRY LENGTH  @Z30X8NJ 14690008
         MH    R1,TNTLEN                MULTIPLY LENGTH OF     @Z30X8NJ 14760008
*                                         ENTRY BY NUMBER OF   @Z30X8NJ 14830008
*                                         ENTRIES              @Z30X8NJ 14900008
         LA    R1,TNTOFF(R1)            ADD TO LENGTH THE CODE @Z30X8NJ 15000008
*                                         BEFORE THE FIRST     @Z30X8NJ 15100008
*                                         ENTRY                @Z30X8NJ 15200008
         SR    R6,R6                    CLEAR FOR IC           @Z30X8NJ 15300008
         IC    R6,ZERO(R1,RTNT)         GET TOTE ENTRY COUNT   @Z30X8NJ 15400008
         L     RCORE,AVTCOREC           LOCATE START OF BUFFERS  X02004 15500008
*                                       ETC. TO FIX              X02004 15600008
         STC   R6,EIGHT(RCORE)          SAVE NUMBER OF TOTE TNT@Z30X8NJ 15700008
*                                         ENTRIES FOR CLOSE    @Z30X8NJ 15800008
         STC   R6,TCXTOTE               PUT NUMBER OF TOTE TNT @G36XRNP 15830000
*                                       ENTRIES IN TCX         @G36XRNP 15860000
         MR    R6,R6                    ENTRIES TO FIX FOR TOTE@Z30X8NJ 15900008
         AR    R1,R7                    ADD TOTE TO TNT LENGHT @Z30X8NJ 16000008
         LTR   R7,R7                    ANY TOTE ENTRIES         X03039 16100008
         BNZ   TOTEYES                  YES, BRANCH              X02004 16200008
         LA    R1,ONE(R1)               ADJUST TERM TABLE      @Z30X8NJ 16300008
*                                         OFFSET               @Z30X8NJ 16350008
TOTEYES  EQU   *                                                 X02004 16400008
         LR    R15,RTNT                 COPY TNT START ADDR    @Z30X8NJ 16500008
         AR    R1,R0                    ROUND TO WORD BOUNDARY @Z30X8NJ 16600008
         SRL   R1,TWO                   SHIFT OUT LOW ORDER    @Z30X8NJ 16700008
         SLL   R1,TWO                     TWO BITS             @Z30X8NJ 16800008
         LA    RCORE,ZERO(R1,R15)       GET ADDRESS OF TERMNAME@Z30X8NJ 16900008
         ICM   RCORE,ALL,ZERO(RCORE)      TABLE                @Z30X8NJ 17000008
         LR    R0,R15                   PUT TNT ADDRESS IN PARM@Z30X8NJ 17100008
*                                         REGISTER             @Z30X8NJ 17200008
         BAL   R6,FIXPAGE               FIX TNT                @Z30X8NJ 17300008
         L     R1,ZERO(RCORE)           ADDRESS OF END OF THE  @Z30X8NJ 17400008
*                                         TERMINAL TABLE AND   @Z30X8NJ 17500008
*                                         QCBS                 @Z30X8NJ 17600008
         LR    R10,R1                   SAVE ADDRESS OF SCBS   @Z30X8NJ 17700008
         SR    R1,RCORE                 GET LENGTH OF TERMINAL @Z30X8NJ 17800008
*                                         TABLE                @Z30X8NJ 17900008
         LR    R0,RCORE                 ADDR OF TERMINAL TABLE @Z30X8NJ 18000008
         L     RCORE,FOUR(RCORE)        ADDRESS OF THE NUMBER OF        18300008
*                                         ENTRIES IN DEVICE             18400008
*                                         CHARACTERISTICS TABLE         18500008
         BAL   R6,FIXPAGE               FIX TERMINAL TABLE AND @Z30X8NJ 18600008
*                                         QUEUE CONTROL BLOCKS @Z30X8NJ 18680008
         LH    R1,ZERO(RCORE)           NUMBER OF ENTRIES IN   @Z30X8NJ 18760008
*                                         DEVICE CHARACTERIS-  @Z30X8NJ 18840008
*                                         TICS TABLE           @Z30X8NJ 18920008
         MH    R1,AVTDCTLN              MULTIPY BY SIZE OF A   @G36XRNP 19000000
*                                       DCT ENTRY FOR LENGTH   @G36XRNP 19050000
*                                       DCT                    @G36XRNP 19100000
         LTR   R1,R1                    DEV CHAR TABLE PRESENT?@Z30X8NJ 19160008
         BZ    NODEVC                   BRANCH IF NO           @Z30X8NJ 19240008
         L     R0,AVTCSTCS              ADDRESS OF DCT         @Z30X8NJ 19320008
         BAL   R6,FIXPAGE               FIX DCT                @Z30X8NJ 19400008
NODEVC   EQU   *                                                OY03928 19480008
         LR    R0,R10                   ADDRESS OF SCBS        @Z30X8NJ 19600008
         LH    R1,TWO(RCORE)            SCB LENGTH IN DOUBLE   @Z30X8NJ 19680008
*                                         WORDS                @Z30X8NJ 19760008
         SLL   R1,THREE                 SCB LENGTH             @Z30X8NJ 19840008
         BAL   R6,FIXPAGE               FIX SCB                @Z30X8NJ 19920008
         TM    AVTSCOPT,AVTCMBUF        COMMON BUFFER USED       X02004 20000008
         BZ    CKTSO                    NO, CHECK FOR TSO        X02004 20100008
         L     RCMB,AVTCBQCB            ADDRESS OF MASTER QCB  @Z30X8NJ 20200008
         USING IEDCMB,RCMB              CMB BASE               @Z30X8NJ 20300008
         L     RCORE,CMBFIRST-ONE       ADDRESS OF FIRST PREFIX  X02004 20400008
         LR    R0,RCMB                  ADDR OF QCB, STCB'S AND@Z30X8NJ 20500008
*                                         PREFIXES FOR COMMBUF @Z30X8NJ 20580008
         L     R1,CMBLAST-ONE           ADDRESS OF LAST PREFIX @Z30X8NJ 20660008
         LA    R1,PRELNG(,R1)           ADDR END OF LAST PREFIX@Z30X8NJ 20740008
         SR    R1,R0                    LENGTH OF QCB'S, ETC   @Z30X8NJ 20820008
         BAL   R6,FIXPAGE               FIX COMMBUF CONTROL    @Z30X8NJ 20900008
*                                         BLOCKS               @Z30X8NJ 20980008
         LH    R3,CMBDAREA              NUMBER OF DATA AREAS   @Z30X8NJ 21060008
         N     R3,AVTCLRHI              FORCE POSITIVE         @Z30X8NJ 21200008
         DROP  RCMB                     DROP CMB BASE          @Z30X8NJ 21250008
COMLOOP  EQU   *                                                 X02004 21300008
         LA    R13,EIGHT                CONSTANT TO LOCATE IDA @Z30X8NJ 21400008
         SR    R0,R0                    CLEAR FOR ICM          @Z30X8NJ 21500008
         ICM   R0,AD,ONE(RCORE)         ADDRESS OF DATA AREA   @Z30X8NJ 21600008
         SR    R0,R13                   ADJUST TO IDA LIST PTR @Z30X8NJ 21700008
         LR    R15,R0                   COPY ADDRESS           @Z30X8NJ 21800008
         LR    R13,R0                   COPY ADDRESS           @Z30X8NJ 21900008
         L     R1,FOUR(R15)             TOTAL LENGTH TO FIX    @Z30X8NJ 22000008
         TM    ZERO(R15),CCWIDA         IDA TO BE USED         @Z30X8NJ 22100008
         BNO   COMLOOP1                 NO, BRANCH             @Z30X8NJ 22200008
         L     R0,ZERO(R15)             ADDRESS OF IDA LIST    @Z30X8NJ 22300008
COMLOOP1 EQU   *                                                        22370008
         BAL   R6,FIXPAGE               FIX COMMBUF DATA AREA  @Z30X8NJ 22440008
         TM    ZERO(R13),CCWIDA         IDA TO BE USED         @Z30X8NJ 22510008
         BNO   COMLOOP3                 NO, FIX BUFFER         @Z30X8NJ 22580008
         L     R6,ZERO(R13)             ADDRESS OF IDA LIST    @Z30X8NJ 22650008
COMLOOP2 EQU   *                                                        22720008
         L     R10,ZERO(R6)             GET IDA ENTRY          @Z30X8NJ 22790008
         LRA   R10,ZERO(R10)            CONVERT TO REAL ADDR   @Z30X8NJ 22860008
         ST    R10,ZERO(R6)             PUT REAL ADDR IN ENTRY @Z30X8NJ 22930008
         LA    R6,FOUR(R6)              BUMP TO NEXT ENTRY     @Z30X8NJ 23000008
         CR    R13,R6                   END OF LIST            @Z30X8NJ 23070008
         BH    COMLOOP2                 NO, CONVERT NEXT ENTRY @Z30X8NJ 23140008
COMLOOP3 EQU   *                                                        23210008
         LA    RCORE,PRELNG(RCORE)      BUMP TO NEXT PREFIX    @Z30X8NJ 23280008
         BCT   R3,COMLOOP               FIX NEXT DATA AREA     @Z30X8NJ 23350008
CKTSO    EQU   *                                                        23420008
         TM    AVTBIT1,AVTTSON          TSO OR MIXED ENVIRON   @Z30X8NJ 23490008
         BZ    FIXBUFS                  NO, BRANCH             @Z30X8NJ 23560008
         ICM   R0,ALL,AVTTSOPT          ADDR OF TSINPUT QCB    @Z30X8NJ 23630008
         BZ    FIXBUFS                  BRANCH IF IT IS ZERO   @Z30X8NJ 23700008
         LA    R1,TSITSW-IEDQTSI+TSWLEN LENGTH TO FIX          @G36XRNP 23770000
         BAL   R6,FIXPAGE               FIX TSINPUT QCB        @Z30X8NJ 23840008
         L     R1,AVTKA02               ADDRESS OF IEDQKA02    @Z30X8NJ 23910008
         LR    R0,R1                    COPY ADDRESS           @Z30X8NJ 23980008
         LTR   R0,R0                    IS KA IN THE SYSTEM?   @Z30X8NJ 24050008
         BZ    NOKA                     NO, BRANCH             @Z30X8NJ 24120008
         SH    R1,AVTHA4                ADJUST TO LENGTH       @Z30X8NJ 24190008
         L     R1,ZERO(R1)              LENGTH TO PAGE FIX     @Z30X8NJ 24260008
         BAL   R6,FIXPAGE               FIX IEDQKA02           @Z30X8NJ 24330008
NOKA     EQU   *                                                        24400008
         L     R1,AVTTSOPT              ADDRESS OF TSO SUPPORT @Z30X8NJ 24470008
         L     R0,TSISCHED-IEDQTSI(,R1) ADDRESS OF IEDAYZ      @Z30X8NJ 24540008
         LTR   R0,R0                    IS 270X TSO SCHEDULER  @Z30X8NJ 24610008
*                                         IN THE SYSTER?       @Z30X8NJ 24680008
         BZ    FIXBUFS                  NO, BRANCH                      24750008
         LA    R1,AYZLNG                LENGTH OF IEDAYZ       @Z30X8NJ 24820008
         BAL   R6,FIXPAGE               FIX IEDAYZ             @Z30X8NJ 24890008
FIXBUFS  EQU   *                                                        24960008
         ICM   R0,ALL,AVTSAVTP          GET SECONDARY AVT ADDR @Z30X8NJ 25030008
         BZ    NOSAVT                   BRANCH IF ADDR IS ZERO @Z30X8NJ 25100008
         LA    R1,SAVTVMSZ              VM ONLY                @Z30X8NJ 25170008
         TM    AVTSAVTF,AVTVTMCP        EP ONLY IN SYSTEM?     @G36XRNP 25240000
         BZ    EPONLY                   NO, BRANCH             @G36XRNP 25310000
         LA    R1,SAVTSIZE              ENTIRE LENGTH          @Z30X8NJ 25380008
EPONLY   EQU   *                                               @G36XRNP 25450000
         BAL   R6,FIXPAGE               FIX SECONDARY AVT      @Z30X8NJ 25520008
NOSAVT   EQU   *                                                        25590008
         L     R3,AVTCOREC              ADDRESS OF I/O TRACE,  @Z30X8NJ 26000008
*                                         BUFFERS AND CPB'S    @Z30X8NJ 26030008
         LM    R0,R1,EIGHT(R3)          ADDR AND LENGTH TO FIX @Z30X8NJ 26060008
         XC    EIGHT(EIGHT,R3),EIGHT(R3)  CLEAR BUFFER         @Z30X8NJ 26090008
         LR    R3,R0                    SAVE ADDRESS TO FIX    @Z30X8NJ 26120008
         LR    RCORE,R1                 SAVE LENGTH TO FIX     @Z30X8NJ 26150008
         BAL   R6,FIXPAGE               FIX TRACE, BUFFERS,    @Z30X8NJ 26180008
*                                         AND CPB'S            @Z30X8NJ 26210008
         EJECT                                                          26240008
         L     RCVT,CVTPTR              PICKUP CVT ADDRESS     @Z30X8NJ 26270008
         L     RTCX,CVTAQAVT            PICKUP TCX ADDRESS     @Z30X8NJ 26300008
         XC    TCXREADY,TCXREADY        CLEAR TCX READY POINTER  Y02027 26330008
         STM   R3,RCORE,TCXBUFA         SAVE ADDRESSES AND     @Z30X8NJ 26360008
*                                         LENGTH FOR FREE CORE @Z30X8NJ 26390008
*                                         FOR PAGE FIX         @Z30X8NJ 26420008
*                                         PARAMETER LIST       @Z30X8NJ 26450008
*                                                                Y02027 26480008
         LR    R1,R11                   MOVE ADDR OF PGFX PARAM@Z30X8NJ 26510008
*                                       LIST INTO FREEMAIN PARAM Y02027 26540008
         FREEMAIN RC,A=(1),LV=16,SP=254                                 26570008
         SPACE 2                                                        26700008
         L     R13,AVTMSGS-ONE          ADDR OF OPTIONAL VCONS @Z30X8NJ 26800008
         L     R13,ZERO(R13)            ADDRESS OF IEDQBD      @Z30X8NJ 27000008
         ST    R13,AVTBSCAN             STORE IT IN AVT        @Z30X8NJ 27200008
         EJECT                                                          27500008
* * * * * * ** * * * * * * * * * * * * * * * * * * * * * * * * * Y02027 28300008
*                                                                Y02027 29100008
*        LOAD VIRTUAL DIAGNOSE ROUTINE IF IN A VIRTUAL MACHINE   Y02027 29900008
*                                                                Y02027 30700008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * ** * * Y02027 31500008
         SPACE                                                          32300008
CHECKDA  EQU   *                                                 Y05331 33708008
         L     R7,AVTSAVTP              SECONDARY AVT POINTER    X03039 33716008
         TM    SAVTDIAF,SAVTVIRT        IN VIRTUAL ENVIRONMENT ? Y05331 33724008
         BZ    DISPLOAD                 NO, BRANCH               X03039 33732008
         LA    R0,QDA                   IEDQDA NAME FOR LOAD   @Z30X8NJ 33740008
         BAL   R6,LOADER                LOAD IEDQDA FROM       @Z30X8NJ 33745008
*                                         LINKLIB              @Z30X8NJ 33750008
         STCM  R1,AD,SAVTDIAG+ONE       SAVE ADDRESS           @Z30X8NJ 33756008
         EJECT                                                          33764008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 33800008
*        THIS SECTION OF CODE LOADS THE APPROPRIATE DISPATCHER  *X03039 33900008
*        AND SAVES ITS ADDRESS IN THE AVT AND IN THE FORMATTED  *X03039 34000008
*        AREA IN SUBPOOL 254. THE ADDRESS OF THE AVT IS SAVED   *X03039 34100008
*        IN THE FIRST WORD OF THE DISPATCHER.                   *X03039 34200008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 34300008
*                                                                X03039 34400008
DISPLOAD EQU   *                                                        34500008
         LA    R13,DTRDISP              YES, LOAD ITS ADDRESS  @Z30X8NJ 35100008
         BAL   R6,LOADRTNE              BRANCH AND LOAD THE    @Z30X8NJ 35300008
*                                         DISPATCHER           @Z30X8NJ 35400008
         L     RCVT,CVTPTR              PICKUP CVT ADDRESS     @Z30X8NJ 35500008
         L     R13,CVTAQAVT             LOAD THE ADDRESS OF THE@Z30X8NJ 35600008
*                                         FREE AREA            @Z30X8NJ 35700008
         OI    CVTTCMFG,CVTTCRDY        TURN ON TCAM READY FLAG@ZM30334 35750008
         LR    R6,R0                    COPY THE ADDRESS OF    @Z30X8NJ 35800008
*                                         THE DISPATCHER       @Z30X8NJ 35900008
         ST    R6,TCXDISP               STORE THE DISPATCHER'S @Z30X8NJ 36000008
*                                         ADDR IN THE FREE AREA@Z30X8NJ 36100008
         ST    R6,AVTSAVE2+SIXTY4       STORE THE DISPATCHER'S @Z30X8NJ 36900008
         ST    R6,AVTEA                   ADDR IN TWO LOCATIONS@Z30X8NJ 37000008
         L     R13,AVTRDYA              START UP MSG SPECIFIED @Z30X8NJ 37100008
         NC    ZERO(EIGHT,R13),ZERO(R13) ANY ROUTINES SPECIFIED@Z30X8NJ 37200008
         BZ    GETE8                    LOAD IEDQE8            @G36XRNP 37300000
         LA    R13,STARTUP              ADDR OF START UP MSG   @Z30X8NJ 37400008
*                                         ROUTINE ID           @Z30X8NJ 37500008
         BAL   R6,LOADRTNE              LOAD THE ROUTINE       @Z30X8NJ 37600008
         ST    R0,AVTSUPPT              SAVE ADDR IN AVT       @Z30X8NJ 37700008
         MVI   AVTDSIOB+4,HIGHPRI       SET HIGH READY Q PRI     X03039 37800008
         MVC   AVTDSIOB+1(3),AVTSUPPT+1 SET ST UP MSG QCB ADDR   X03039 37900008
         MVC   AVTDSIOB+5(3),AVTREADY+1 PLACE AS TOP ON RDY Q    X03039 38000008
         LA    R6,AVTDSIOB              GET ADDR OF DISK I/O   @Z30X8NJ 38100008
*                                         QCB                  @Z30X8NJ 38160008
         ST    R6,AVTREADY              SAVE THE ADDRESS       @Z30X8NJ 38220008
GETE8    EQU   *                                               @G36XRNP 38230000
         LA    R0,QE8                   LOAD ADDR OF MOD NAME  @G36XRNP 38240000
         BAL   R6,LOADER                LOAD IEDQE8            @G36XRNP 38250000
         L     RCVT,CVTPTR              POINT TO CVT           @ZM05881 38253000
         L     R13,CVTAQAVT             POINT TO TCX           @ZM05881 38256000
         STCM  R0,AD,TCXQE8+1           STORE ADDRESS OF QE8   @ZM46590 38260000
MODE6    EQU   *                                               @ZM30327 39660008
         MODESET EXTKEY=TCAM            SET MODULE'S KEY TO 6  @ZM30327 39720008
         MODESET MODE=PROB              RETURN TO PROBLEM      @ZM30327 39780008
*                                         PROGRAM STATE        @ZM30327 39840008
         BR    R14                      RETURN TO IEDQOA         X03039 39900008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 40000008
*                                                               *X03039 40100008
*        THIS SECTION OF CODE ISSUES THE LOAD MACRO TO LOAD     *X03039 40200008
*        THE DISPATCHER.                                        *X03039 40300008
*                                                               *X03039 40400008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 40500008
*                                                                X03039 40600008
LOADRTNE EQU   *                                                 X03039 40700008
         L     RCVT,CVTPTR              PICKUP CVT ADDRESS     @Z30X8NJ 40800008
         LR    R0,R13                   LOAD ID ADDR INTO REG 0@Z30X8NJ 40900008
         L     R1,CVTSVDCB              ADDR OF DCB FOR SVCLIB @Z30X8NJ 41000008
*                                                                X03039 41100008
         LOAD  EPLOC=(0),DCB=(1)        LOAD MODULE              X03039 41200008
*                                                                X03039 41300008
         BR    R6                       RETURN                 @Z30X8NJ 41400008
         SPACE 3                                                 X02004 41500008
LOADER   EQU   *                        LOAD MODULES FROM LINKLIBX02004 41600008
         L     RCVT,CVTPTR              GET ADDRESS OF CVT     @Z30X8NJ 41700008
         L     R10,CVTLINK              ADDR OF LINKLIB DCB    @Z30X8NJ 41720008
         LA    R1,ZERO(R10)             CLEAR HI-ORDER BYTE AND@Z30X8NJ 41740008
*                                       SET UP FOR LOAD          Y02027 41760008
         LOAD  EPLOC=(0),DCB=(1)        LOAD MODULE FORM LINKLIB X02004 41800008
         LR    R1,R0                    COPY MODULE ADDRESS    @Z30X8NJ 41900008
         BR    R6                       RETURN TO MAINLINE CODE@Z30X8NJ 42100008
         EJECT                                                          42400008
*****************************************************************       42500008
*                                                               *       42600008
*        THIS ROUTINE FIXES ALL DATA AREA THAT MUST BE IN REAL  *       42700008
*        CORE.                                                  *       42800008
*                                                               *       42900008
*****************************************************************       43000008
FIXPAGE  EQU   *                                                        43100008
         LR    R15,R0                   COPY STARTING ADDRESS  @Z30X8NJ 43200008
         LA    R15,ZERO(R1,R15)         GET ENDING ADDRESS OF  @Z30X8NJ 43300008
*                                         PARM LIST            @Z30X8NJ 43400008
         LR    R1,R0                    GET STARTING ADDRESS   @Z30X8NJ 43500008
*                                         OF PARM LIST         @Z30X8NJ 43600008
         XC    ZERO(FOUR,R11),ZERO(R11)  CLEAR ECB             @Z30X8NJ 43900008
         LR    R0,R11                   MOVE ECB TO REG 0      @Z30X8NJ 44100008
*                                                                       44200008
         PGFIX R,A=(1),EA=(15),ECB=(0)  ISSUE PAGE FIX SVC     @Z30X8NJ 44300008
*                                                                       44400008
*                                                                       44700008
         WAIT  ECB=(R11)                WAIT FOR PAGE FIX      @Z30X8NJ 44800008
*                                                                       44900008
         TM    THREE(R11),FOUR          FIX GOOD?              @Z30X8NJ 45000008
         BCR   EIGHT,R6                 YES, RETURN TO CALLER  @Z30X8NJ 45100008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 45200008
*                                                               *X03039 45300008
*        THIS CODE BUILDS AND WRITES THE ERROR MESSAGES         *X03039 45400008
*                                                               *X03039 45500008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 45600008
*                                                                X03039 45700008
ERRORMSG EQU   *                                                 X03039 45800008
         MVI   MESGERR1,G               MOVE ERROR CHAR INTO MSG X03039 45900008
         MVC   MESGERR2(EIGHT),NOSQS    MOVE ERROR WORD INTO MSG X03039 46000008
ERRMSG   EQU   *                                                 X03039 46050008
         LA    R1,MESSAGE               LOAD ADDR OF MESSAGE   @Z30X8NJ 46100008
*                                                                X03039 46200008
         WTO   MF=(E,(1))               ISSUE WTO SVC          @Z30X8NJ 46300008
*                                                                X03039 46400008
ABENDCD  EQU *                                                   X03039 46500008
         L     R0,AVTTCB                LOAD TCB ADDR          @Z30X8NJ 46600008
         L     R1,COMPCODE              LOAD CODES INTO REG 1  @Z30X8NJ 46700008
         ABEND (1)                      ISSUE ABEND SVC        @Z30X8NJ 46800008
         EJECT                                                          46900008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 48900008
*                                                               *X03039 49000008
*        THIS IS THE FORMAT OF THE OPEN ERROR MESSAGE           *X03039 49100008
*                                                               *X03039 49200008
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 49300008
*                                                                X03039 49400008
         CNOP  0,4                                               X03039 49500008
MESSAGE  DC    AL2(MESGEND-*)           LENGTH OF MESSAGE        X03039 49600008
         DC    X'8000'                  MCSFLAGS FIELD           X03039 49700008
         DC    C'IED008I TCAM OPEN ERROR ' MESSAGE TEXT          X03039 49800008
MESGERR0 DC    C'040 - '                ABEND CODE               X03039 49900008
MESGERR1 DC    C'0'                     ERROR CHARACTER          X03039 50000008
         DC    C' '                     TRAILING BLANK           X03039 50100008
MESGERR2 DC    CL8' '                   ERROR WORD               X03039 50200008
MESGEND  EQU   *                                                 X03039 50300008
         DC    X'1000'                  DESCRIPTOR CODES         X03039 50400008
         DC    X'4020'                  ROUTING CODES            X03039 50500008
         EJECT                                                          50600008
QDA      DC    CL8'IEDQDA'              MODULE NAME FOR LOAD     Y05331 51150008
QE8      DC    CL8'IEDQE8'              BINARY SEARCH RTN      @G36XRNP 51200000
MACERR   DC    CL8'OS MCP'              ERROR WORD FOR MSG       X03039 51250008
NOSQS    DC    CL8'DSPAREA'             ERROR WORD FOR MSG     @Z30X8NJ 51300008
DTRDISP  DC    C'IGG019RO'              DTRACE DISPATCHER ID     X03039 51500008
STARTUP  DC    C'IGG019R6'                                       X03039 51600008
         DS    0F                                                       51700008
MINUS3   DC    H'-3'                    OFFSET TO SYSTYPE FROM AVT      51720008
VS       EQU   C'V'                     SYSTEM TYPE                     51740008
MACROERR EQU   C'I'                     DOWNLEVEL MACRO ERROR    X03039 51760008
         DS    0F                       FORCE ALIGNMENT        @Z30X8NJ 51780008
COMPCODE DC    XL1'80'                  DUMP/STEP CODE           X03039 51800008
         DC    XL3'040000'              COMPLETION CODE          X03039 51900008
HIGHPRI  EQU   X'FC'                    HIGH READY Q PRIOTITY    X03039 52000008
CVTADDR  EQU   16                       LOCATION OF CVT ADDR     X03039 52200008
CVTLNK   EQU   8                        OFFSET TO LINKLIB DCB    X03039 52300008
AVTLNG   EQU   1280                     MAXIMUM AVT LENGTH       Y01948 52400008
ZERO     EQU   0                        LENGTH                          52500008
ONE      EQU   1                        LENGTH                          52600008
TWO      EQU   2                        LENGTH                          52700008
THREE    EQU   3                        LENGTH                          52800008
FOUR     EQU   4                        LENGTH                          52900008
FIVE     EQU   5                        LENGTH                          53000008
SIX      EQU   6                        LENGTH                          53100008
EIGHT    EQU   8                        LENGTH                          53200008
NINE     EQU   9                        LENGTH                          53300008
TEN      EQU   10                       LENGTH                          53400008
TWELVE   EQU   12                       LENGTH                   X03039 53500008
FOURTEN  EQU   14                       LENGTH                          53600008
ALL      EQU   15                       MASK TO ICM ALL 4 BYTES  Y01948 53700008
FIXPARM  EQU   16                       OFFSET TO PGFIX PARMS    Y01948 53800008
SIXTEEN  EQU   16                       DISPLACEMENT           @Z30X8NJ 53830008
SIXTY4   EQU   64                       DISPLACEMENT           @Z30X8NJ 53860008
WAIT     EQU   1                        WAIT SVC NUMBER          Y01948 53900008
FIXPG    EQU   X'52'                    CODE INDICATING PGFIX    Y01948 54000008
PGFIX    EQU   113                      PGFIX SVC NUMBER         Y01948 54100008
AYZLNG   EQU   X'AF4'                   LENGTH OF IEDAYZ       @G36XRNU 54200000
TCAM23   EQU   23                       GETMAIN FAILURE CODE     Y01948 54300008
SP234    EQU   234                      SUBPOOL 234 - FIXED SQS  Y01948 54400008
CCWIDA   EQU   4                        INDIRECT ADDRESSING FLAG X02004 54500008
AD       EQU   7                        ICM/STCM MASK            X02004 54600008
PRELNG   EQU   12                       LENGTH OF COMMBUF PREFIX X02004 54700008
G        EQU   C'G'                     ERROR CHAR FOR MESSAGE @Z30X8NJ 54900008
PGFXAREA EQU   16                       SIZE OF PAGE FIX PARAM   Y02027 55100008
*                                       LIST                     Y02027 55160008
AIBPRFSZ EQU   72                       AIB PREFIX SIZE          Y02027 55220008
ATTNTAB  EQU   20                       ATTENTION TABLE INDEX    Y02027 55280008
TCAM     EQU   ATTNTAB*TWO              OFFSET OF TCAM'S ENTRY   Y02027 55340008
*                                       IN ATTENTION TABLE       Y02027 55400008
         SPACE 2                                                        55460008
         EJECT                                                          55600008
         DCBD  DSORG=TX                                                 55700008
         EJECT                                                          55800008
         TAVTD                                                          55900008
         TPRIOR                                                         56000008
         EJECT                                                          56100008
         EJECT                                                          56300008
         IEDCMB                                                  X02004 56400008
         EJECT                                                          56500008
         TTNTD                                                          56600008
         EJECT                                                          56700008
         TTSID                                                          56800008
         EJECT                                                          56801000
         TTSWD                                                          56802000
         EJECT                                                          56803000
         CVT   DSECT=YES                                         Y02027 56805008
         EJECT                                                          56810008
         TTCXD                                                   Y02027 56815008
         EJECT                                                          56820008
         IHAPSA                                                         56825008
         EJECT                                                          56830008
FORCORE  DSECT                                                   Y02027 56835008
         IECDSECT                                                Y02027 56840008
         SPACE 3                                                        56845008
         EJECT                                                          56850008
         SPACE 3                                                        56855008
         EJECT                                                          56860008
         IHAASCB                                                 Y02027 56865008
         EJECT                                                          56870008
         IECDIOCM ,                                              Y02027 56875008
         EJECT                                                          56880008
         IECDATB ,                                               Y02027 56885008
         END                                                            56900008
