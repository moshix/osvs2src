A601     TITLE '''IEDQA6'' - LINE CONTROL INITIALIZATION ROUTINE'       00300020
IEDQA6   CSECT                                                          00600020
*C580000                                                         S21903 00600122
*A696000                                                         A42378 00600500
*D711000                                                         A42378 00601000
*C222000                                                         A42378 00601500
*A237300-239100,248500,                                          S22026 00601622
*C255000                                                         S22026 00601722
*A124000,151000,352000,353000,690600-692700                      S22025 00602022
*C219000,687000,690000                                           S22025 00602522
*D220000-228000                                                  S22025 00603022
*A125000,351100-351700,353500                                    S99238 00603222
*A193000-194500,270300-272100,352000-352900                      S22024 00603322
*A433000,523000,559000-560000,604000,726000-754000               S22024 00603422
*C006060,785000                                                  S22024 00603522
*A270600,271920,801000                                           X03039 00603607
*C006070,271840,271880                                           X03039 00603707
*C271500,271840,271880,294000                                  @YA08433 00603809
*C271500,271840,271880                                         @YA10995 00603909
*A237000                                                       @OS76508 00604081
*A270600,270620                                                @Y17XAMG 00605000
*C270300,271929,270640                                         @Y17XAMG 00606000
*C336000                                                       @OY18008 00606310
*D270680-270820                                                @OY18118 00606610
*********************************************************************** 00607081
*                                                                     * 00607381
*STATUS -- CHANGE LEVEL 8                                        X03039 00607681
*                                                                     * 00608020
*FUNCTION --                                                          * 00610020
*   INITIALIZES FIELDS IN THE SCB TO INDICATE THE LINE CONTROL        * 00612022
*   CHARACTERS TO BE INSERTED, SUBBLOCK SIZE AND BLOCK SIZE           * 00613022
*   OR THE NUMBER OF SUBBLOCKS PER BLOCK AND THE SUBBLOCK DELIMITER   * 00614022
*   (VARIABLE-LENGTH REBLOCKING).                                     * 00615022
*                                                                     * 00616020
*   THE KEY FOR THE DESTINATION IS ACCESSED FROM THE PREFIX           * 00618020
*   (PRFDEST) AND PASSED TO THE TNT CODE (AVTRNMPT) TO RETURN THE     * 00620020
*   ADDRESS OF THE TERMINAL TABLE ENTRY.                              * 00622020
*                                                                     * 00624020
*   FROM INFORMATION IN THE PARAMETER LIST,  THE ROUTINE INITIAL-     * 00626020
*   IZES THE FOLLOWING FIELDS: (1) SCBEOBSZ AND SCBEOBAC TO THE       * 00628020
*   INTERVAL BETWEEN EOBS,  IF EOB INSERTION IS REQUESTED, OR TO      * 00630020
*   THE INTERVAL BETWEEN ETBS,  IF ETB INSERTION IS REQUESTED; AND    * 00632020
*   (2) SCBITBSZ AND SCBITBAC TO THE INTERVAL BETWEEN ITBS,  IF ITB   * 00634020
*   INSERTION IS REQUESTED; OR (3) SCBBLKCT,SCBENDCR,AND SCBCRLEN FOR * 00636022
*   VARIABLE REBLOCKING.  THE INTERVAL IS SET FROM THE PARAMETER      * 00637022
*   LIST,  IF SPECIFIED THERE;  OTHERWISE IT IS ACCESSED FROM         * 00638020
*   FIELDS IN THE TERMINAL TABLE ENTRY.  IF EOBS/ETBS OR ITBS ARE     * 00640020
*   NOT TO BE INSERTED,  THE CORRESPONDING SCB FIELDS ARE SET TO      * 00642020
*   ZERO.  THE ROUTINE RETURNS A RETURN CODE OF FOUR AND DOES NOT     * 00644020
*   PERFORM THE FUNCTION IF THE USER REQUESTS INTERVALS NOT SPECI-    * 00646020
*   FIED EITHER IN THE MACRO OR IN THE TERMINAL TABLE ENTRY, OR       * 00648020
*   IF THE USER SPECIFIES LINE CONTROL INVALID FOR THE DESTINATION    * 00650020
*   (E.G., ITBS FOR A START/STOP TERMINAL).                           * 00652020
*                                                                     * 00654020
*   IF INITIALIZATION HAS BEEN PERFORMED SUCCESSFULLY,  THE MSGFORM   * 00656020
*   REQUEST BIT IN SET IN THE SCB (SCBMGFMN) AND CONTROL RETURNS TO   * 00658020
*   THE CALLER WITH A RETURN CODE OF ZERO.                            * 00660020
*                                                                     * 00662020
*ENTRY POINTS --                                                      * 00664020
*       'IEDQA601' TO INITIALIZE SCB FIELDS TO LINE CONTROL           * 00666020
*   INTERVALS.  CALLING SEQUENCE FROM USER INTERFACE IS:              * 00668020
*                                                                     * 00670020
*        L     R12,AVTMSGS-1            GET ADDR OF VCON TABLE        * 00672020
*        IC    R15,AVTEZERO(,R1)        GET INDEX TO ROUTINE ADDR     * 00674020
*        L     R12,AVTEZERO(R12,R15)    GET ROUTINE ADDRESS           * 00676020
*        BR    R12                      EXIT TO ROUTINE               * 00678020
*                                                                     * 00680020
*INPUT --                                                             * 00682020
*   REGISTER 1 - ADDRESS OF A MACRO-GENERATED PARAMETER LIST.         * 00684020
*   PARAMETER LIST FORMATS ARE:                                       * 00686020
*                                                                     * 00688020
*        *********************************   BLOCK AND                * 00690020
*        * INDEX *       *     BLOCK     *     SUBBLOCK SPECIFIED     * 00692020
*        *  TO   * X'05' *   INTERVAL    *                            * 00694020
*        *   A6  *       *               *                            * 00696020
*        *********************************                            * 00698020
*        *SUBBLCK*                                                    * 00700020
*        * INTER-*                                                    * 00702020
*        *  VAL  *                                                    * 00704020
*        *********                                                    * 00706020
*                                                                     * 00708020
*        *********************************   BLOCK ONLY               * 00710020
*        * INDEX *       *     BLOCK     *     SPECIFIED              * 00712020
*        *  TO   * X'04' *   INTERVAL    *                            * 00714020
*        *   A6  *       *               *                            * 00716020
*        *********************************                            * 00718020
*                                                                     * 00720020
*        *************************   SUBBLOCK ONLY                    * 00722020
*        * INDEX *       *SUBBLCK*     SPECIFIED                      * 00724020
*        *  TO   * X'03' * INTER-*                                    * 00726020
*        *   A6  *       *  VAL  *                                    * 00728020
*        *************************                                    * 00730020
*        *********************************   ENDCHAR AND              * 00730222
*        * INDEX *       *       *NUMBER *     COUNT SPECIFIED        * 00730422
*        *  TO   * X'04' *ENDCHAR*SUBBLKS*                            * 00730622
*        *   A6  *       *       *PER BLK*                            * 00730822
*        *********************************                            * 00731022
*                                                                     * 00731222
*                                                                     * 00732020
*        *****************   NEITHER                                  * 00734020
*        * INDEX *       *     SPECIFIED                              * 00736020
*        *  TO   * X'02' *                                            * 00738020
*        *   A6  *       *                                            * 00740020
*        *****************                                            * 00742020
*                                                                     * 00744020
*        A6 INDEX BYTE: X'01' ON - TRANSPARENT MODE                   * 00746020
*                       X'01' OFF - TEXT MODE                         * 00748020
*                       X'02' ON - ENDCHAR AND COUNT SPECIFIED          00749022
*                       X'03' ON - TRANSPARENT WITH NO PADDING   S99238 00749522
*                                                                     * 00750020
*   REGISTER 3 - ADDRESS OF SCB                                       * 00752020
*                                                                     * 00754020
*   REGISTER 6 - ADDRESS OF CURRENT BUFFER                            * 00756020
*                                                                     * 00758020
*   REGISTER 9 - ADDRESS OF THE AVT                                   * 00760020
*                                                                     * 00762020
*   REGISTER 12 - ENTRY POINT ADDRESS AND BASE FOR THIS ROUTINE       * 00764020
*                                                                     * 00766020
*OUTPUT --                                                            * 00768020
*   SCBEOBSZ AND SCBEOBAC - IF EOBS/ETBS ARE BEING INSERTED,  CON-    * 00770020
*   TAIN  THE INTERVAL BETWEEN EOBS/ETBS.  IF NOT,  CONTAIN ZERO.     * 00772020
*   SCBBLKCT,SCBENDCR,AND SCBCRLEN - IF VARIABLE-LENGTH REBLOCKING    * 00772622
*   IS TO BE PERFORMED.                                               * 00773222
*                                                                     * 00774020
*   SCBITBSZ AND SCBITBAC - IF ITBS ARE BEING INSERTED,  CONTAIN      * 00776020
*   THE INTERVAL BETWEEN ITBS.  IF NOT,  CONTAIN ZERO.                * 00778020
*                                                                     * 00780020
*   SCB MSGFORM REQUEST BIT (SCBMGFMN IN SCBSTATE) - TURNED ON        * 00782020
*   EXCEPT WHEN ERRORS DETECTED                                       * 00784020
*                                                                     * 00786020
*EXTERNAL REFERENCES --                                               * 00788020
*   'AVTRNMPT' - TNT CODE                                             * 00790020
*                                                                     * 00792020
*   AVT - ADDRESS VECTOR TABLE                                        * 00798020
*                                                                     * 00800020
*   SCB - STATION CONTROL BLOCK                                       * 00802020
*                                                                     * 00804020
*   BUFFER CURRENTLY BEING PROCESSED                                  * 00806020
*                                                                     * 00808020
*   TERMINAL TABLE ENTRY FOR THE DESTINATION                          * 00810020
*                                                                     * 00812020
*EXITS,  NORMAL --                                                    * 00814020
*   SCB FIELDS ARE INITIALIZED AS SPECIFIED.  REGISTER 15 CONTAINS    * 00816020
*   A RETURN CODE OF X'00'.                                           * 00818020
*                                                                     * 00820020
*EXITS,  ERROR --                                                     * 00822020
*   IF THE USER REQUESTS INTERVALS NOT SPECIFIED IN EITHER THE        * 00824020
*   MACRO OR IN THE TERMINAL TABLE ENTRY,  OR IF THE USER SPECIFIES   * 00826020
*   LINE CONTROL INVALID FOR THE DESTINATION,  REGISTER 15 CONTAINS   * 00828020
*   A RETURN CODE OF FOUR.                                            * 00830020
*                                                                     * 00832020
*TABLES/WORK AREAS -- N/A.                                            * 00834020
*                                                                     * 00836020
*ATTRIBUTES -- SERIALLY REUSABLE, REFRESHABLE, ENABLED, RESIDENT,     * 00838020
*   PROBLEM PROGRAM MODE.                                             * 00840020
*                                                                     * 00842020
*NOTES -- THE OPERATION OF THIS MODULE DOES NOT DEPEND UPON AN        * 00844020
*   INTERNAL REPRESENTATION OF THE EXTERNAL CHARACTER SET.            * 00846020
*                                                                     * 00848020
*********************************************************************** 00850020
         EJECT                                                          00852020
********* REGISTER EQUATES *********                                    00900020
         SPACE                                                          01200020
R0       EQU   0                        WORK REGISTER                   01500020
         SPACE                                                          01800020
R1       EQU   1                        TERMINAL TABLE ENTRY ADDR       02100020
         SPACE                                                          02400020
RPTR2    EQU   2                        POINTER TO DEV DEP AREA         02700020
         SPACE                                                          03000020
RSCB3    EQU   3                        SCB ADDRESS                     03300020
         SPACE                                                          03600020
RLCB4    EQU   4                        LCB ADDRESS                     03900020
         SPACE                                                          04200020
RBLOCK5  EQU   5                        BLOCKING FACTOR                 04500020
         SPACE                                                          04800020
RPREFIX  EQU   6                        BUFFER ADDRESS                  05100020
         SPACE                                                          05400020
RSUBBLK7 EQU   7                        SUB-BLOCKING FACTOR             05700020
         SPACE                                                          06000020
RPARM8   EQU   8                        PARAMETER LIST ADDRESS          06300020
         SPACE                                                          06600020
RAVT9    EQU   9                        AVT ADDRESS                     06900020
         SPACE                                                          07200020
RRET10   EQU   10                       LOCAL RETURN REGISTER           07500020
         SPACE                                                          07800020
RBASE    EQU   12                       BASE REGISTER                   08100020
         SPACE                                                          08400020
R13      EQU   13                       SAVE AREA ADDRESS               08700020
R14      EQU   14                       WORK REGISTER                   09000020
R15      EQU   15                       WORK REGISTER                   09300020
         SPACE                                                          09600020
********* OTHER EQUATES *********                                       09900020
         SPACE                                                          10200020
PARMINDX EQU   0                        INDEX BYTE                      10500020
PARMLEN  EQU   1                        PARAMETER LIST LENGTH           10800020
PARMBLOK EQU   2                        BLOCKING FACTOR                 11100020
         SPACE                                                          11400020
PARMTRPN EQU   X'01'                    TRANSPARENT MODE                11700020
         SPACE                                                          12000020
HEX01    EQU   X'01'                    SUBBLK SPECIFIED IN MACRO       12300020
HEX02    EQU   X'02'                    COUNT & ENDCHAR SPEC     S22025 12400022
NOPADTRP EQU   X'03'                    NO PADDING TRANSPARENT   S99238 12500022
HEX04    EQU   X'04'                    BLOCK SPECIFIED IN MACRO        12600020
         SPACE                                                          12900020
TRMBLOKN EQU   X'10'                    BLOCK SPEC IN TERM ENTRY        13200020
TRMSUBKN EQU   X'08'                    SUBBLK SPEC IN TERM ENTRY       13500020
TRMTRPBN EQU   X'04'                    FLAG                     S22024 13800022
         SPACE                                                          14100020
ONE      EQU   1                        INCREMENT VALUE OF ONE          14400020
TWO      EQU   2                        INCREMENT VALUE OF TWO          14700020
THREE    EQU   3                        INCREMENT VALUE OF THREE        15000020
FOUR     EQU   4                        OFFSET USED ON RETURN    S22025 15100022
         SPACE                                                          15300020
SHIFT1   EQU   1                        SHIFT VALUE OF ONE              15600020
SHIFT2   EQU   2                        SHIFT VALUE OF TWO              15900020
SHIFT5   EQU   5                        SHIFT VALUE OF FIVE             16200020
SHIFT8   EQU   8                        SHIFT VALUE OF EIGHT            16500020
SHIFT29  EQU   29                       SHIFT VALUE OF 29               16800020
         SPACE                                                          17100020
SCTEOB   EQU   18                       SCT INDEX BYTE TO EOB           17400020
SCTITB   EQU   19                       SCT INDEX BYTE TO ITB           17700020
SCTEOT   EQU   20                       SCT INDEX BYTE TO EOT           18000020
         SPACE                                                          18300020
CHECKING EQU   X'10'                    FLAG IN DEVICE CHAR TABLE       18600020
         SPACE                                                          18900020
ZERO     EQU   8                        CONDITION CODE: ZERO            19200020
         SPACE 1                                                        19250022
BIT12    EQU   12                       NUMBER OF OPTION FLAGS   S22024 19300022
*                                       TO CHECK                 S22024 19320022
MODELCF  EQU   X'FD'                    FLAGS                    S22024 19350022
MODELCN  EQU   X'02'                    FLAGS                    S22024 19400022
BIT3     EQU   4                        VALUE4                   S22024 19450022
         EJECT                                                          19500020
         USING IEDQAVTD,RAVT9                                           19800020
         USING IEDQLCB,RLCB4                                            20100020
         USING IEDQPRF,RPREFIX                                          20400020
         USING IEDQSCB,RSCB3                                            20700020
         USING IEDQA601,RBASE                                           21000020
         SPACE                                                          21300020
IEDQA601 EQU   *                                                        21600020
IEDQA6   IEDHJN LCTLINIT                                         S22025 21900022
         LH    R15,PRFSIZE              TEST FOR ZERO-                  23100020
         LTR   R15,R15                    LENGTH BUFFER                 23400020
         BZ    EXITOFF                  YES, EXIT IMMEDIATELY           23700020
         SR    R15,R15                  CLEAR RETURN CODE      @OS76508 23710081
         TM    SCBQTYPE,SCBCONC         CONCENTRATOR SCB ?       S22026 23730022
         BZ    NOCONC                   NO, CONTINUE             S22026 23760022
         L     RSCB3,LCBSCBDA-1         GET CONCENTRATOR SCB     S22026 23790022
         TM    SCBSTAT1,SCBCBGN         CONC MSG BEGIN?          S22026 23820022
         BZ    EXITOFF                  NO,EXIT IMMEDIATELY      S22026 23850022
         B     CONC                     GO FIND TERM ENTRY       S22026 23880022
NOCONC   EQU   *                                                 S22026 23910022
         SPACE                                                          24000020
         TM    PRFSTAT1,PRFNHDRN        IS THIS A HEADER BUFFER         24300020
         BO    EXITOFF                  NO, EXIT IMMEDIATELY            24600020
         SPACE                                                          24670020
         TM    LCBTSOB,LCB2741N         IS DEVICE IBM 2741              24740020
         BO    EXITOFF                  YES, EXIT IMMEDIATELY           24810020
CONC     EQU   *                                                 S22026 24850022
         SPACE                                                          24900020
         LR    RPARM8,R1                SAVE PARAMETER LIST ADDRESS     25200020
         LH    R1,LCBTTCIN              GET DESTINATION OFFSET   S22026 25500022
         N     R1,AVTCLRHI                                              25800020
         L     R15,AVTRNMPT             GET ADDRESS OF TNT CODE         26100020
         BALR  R14,R15                  GET TERM ENTRY ADDRESS          26400020
         SR    RBLOCK5,RBLOCK5          CLEAR REG TO ZERO        S22024 26500022
         SR    RSUBBLK7,RSUBBLK7        CLEAR REG TO ZERO        S22024 26600022
         SPACE                                                          26700020
         USING IEDQTRM,R1                                               27000020
         TM    TRMSTATE,TRMPREF         IS TERMINAL ON 3705    @Y17XAMG 27030000
         BNO   NO3705                   BRANCH ON NO             S22024 27060022
         LA    R14,TRMPRFSZ             PREFIX SIZE            @Y17XAMG 27060500
         LR    RPTR2,R1                 TRM ENTRY ADDRESS      @Y17XAMG 27061000
         SR    RPTR2,R14                PREFIX ADDRESS         @Y17XAMG 27061500
         CLI   TRMTYPE-IEDNTRM(RPTR2),TRMLUNT LOGICAL UNIT     @Y17XAMG 27062000
         BE    EXITOFF                  BR YES                 @Y17XAMG 27064000
*                                                                X03039 27066007
         LA    R14,BIT12                SET FOR BIT SEARCH       S22024 27090022
         BAL   RRET10,POINT             FIND DEVICE DEP FIELD    S22024 27120022
         NI    THREE(RPTR2),MODELCF     INDICATE LINE CONTROL  @YA10995 27150009
         TM    PARMINDX(RPARM8),HEX02   LC=IN SET ?              S22024 27182022
         BZ    CKCHANGE                 BRANCH ON NO           @YA10995 27184009
         TM    PARMLEN(RPARM8),HEX01    LC=IN SET ?              S22024 27186022
         BZ    CKCHANGE                 BRANCH ON NO           @YA10995 27188009
         OI    THREE(RPTR2),MODELCN     INDICATE LC SUPPLIED   @YA10995 27190009
CKCHANGE EQU   *                                                 X03039 27192107
*                                       DID MODE CHANGE          X03039 27192207
         CLC   ONE(TWO,RPTR2),THREE(RPTR2)                       X03039 27192307
         BE    TESTTRAN                 BR NO                    X03039 27192407
*                                                                X03039 27192507
         LA    RPTR2,TRMPRFSZ           GET TERMINAL PREFIX SIZE X03039 27192607
         SR    R1,RPTR2                 BACK UP TO TRM PREFIX    X03039 27192707
*                                       SET REQUEST MODE CHANGE  X03039 27192807
         OI    TRMPRE-IEDNTRM(R1),TRMCMODE                     @Y17XAMG 27192900
TESTTRAN EQU   *                                                 S22024 27193022
         SR    R15,R15                  SET RETURN CODE          S22024 27194022
         TM    PARMINDX(RPARM8),PARMTRPN TRANSPARENT MODE ?      S22024 27196022
         BZ    EXITOFF                  NO, EXIT                 S22024 27198022
         OI    SCBSTATE,SCBTRANP        SET TRANS IN SCB         S22024 27200022
         B     EXITOFF                  EXIT                     S22024 27202022
NO3705   EQU   *                                                 S22024 27210022
         SPACE                                                          27900020
         L     R15,LCBDCBPT             GET DCB ADDRESS FROM LCB        28200020
         USING IHADCB,R15                                               28500020
         L     R15,DCBSCTAD-1           GET SCT ADDRESS FROM DCB        28800020
         CLI   SCTEOT(R15),AVTEZERO     IS INDEX TO EOT ZERO            29100020
         BNE   EOBCHK                   NO, CHECK EOB OFFSET   @YA08433 29400009
         SR    R15,R15                  SET RETURN CODE        @YA08433 29460009
         B     EXITOFF                  NO EOT, EXIT           @YA08433 29520009
         SPACE                                                          29580009
EOBCHK   EQU   *                                               @YA08433 29640009
         SPACE                                                          29700020
         CLI   SCTEOB(R15),AVTEZERO     IS INDEX TO EOB ZERO            30000020
         BNE   TESTCHEK                 NO, GO TEST FOR CHECKING        30300020
         SPACE                                                          30600020
         TM    PARMINDX(RPARM8),PARMTRPN IS IT TRANSPARENT MODE         30900020
         BNO   SETFIELD                 NO, GO SET TO INSERT            31200020
*                                         EOT ONLY                      31500020
         B     MACRBLOK                 YES, GO GET BLOCK SIZE          31800020
         SPACE                                                          32100020
TESTCHEK EQU   *                                                        32400020
         SR    R15,R15                                                  32700020
         IC    R15,TRMCHCIN             PICK UP DEV CHAR TBL INDEX      33000020
         BCTR  R15,AVTEZERO             DECR TO MAKE TRUE INEDX         33300020
         MH    R15,AVTDCTLN              SHIFT TO MAKE OFFSET  @OY18008 33600010
         A     R15,AVTCSTCS             GET THIS TERM'S ENTRY ADDR      33900020
         TM    THREE(R15),CHECKING      CHECKING FOR THIS TERMINAL      34200020
         BNO   SETFIELD                 NO, INSERT EOT ONLY             34500020
         SPACE                                                          34800020
MACRBLOK EQU   *                                                        35100020
         NI    SCBBSCFM,AVTEFF-SCBNPDTR INITILIAZE PAD BIT       S99238 35110022
         TM    PARMINDX(RPARM8),NOPADTRP PADDING WANTED          S99238 35120022
         BNO   PAD                      NO, DON'T SET BIT        S99238 35130022
         OI    SCBBSCFM,SCBNPDTR        SET NO PADDING BIT       S99238 35140022
         B     MACBLOK                  CHECK BLOCK CODED ON MAC S99238 35150022
         SPACE                                                          35160022
PAD      EQU   *                                                 S99238 35170022
         TM    PARMINDX(RPARM8),HEX02   ARE COUNT AND ENCHAR     S22024 35200022
*                                       SPECIFIED ?              S22024 35250022
         BO    SETSCBFL                 YES, SET SCB FIELDS      S22025 35300022
MACBLOK  EQU   *                                                 S99238 35350022
         TM    PARMLEN(RPARM8),HEX04    IS BLOCK SPECIFIED IN MACRO     35400020
         BNO   TESTBLOK                 NO, MUST GET FROM TRMENTRY      35700020
         SPACE                                                          36000020
         LH    RBLOCK5,PARMBLOK(,RPARM8) YES, PICK IT UP                36300020
         TM    PARMINDX(RPARM8),PARMTRPN IS IT TRANSPARENT MODE         36600020
         BNO   TESTSUB                  NO, GO SEE IF SUBBLK SPEC       36900020
         SPACE 2                                                        36970022
         SPACE                                                          37200020
         TM    LCBSTAT2,LCBSYNC         IS THIS A BISYNC LINE           37500020
         BO    SETFLAG                  YES, GO SET FLAG                37800020
         SPACE                                                          38100020
         B     SETFIELD                 NO, HANDLE AS NON-TRANSP        38400020
         SPACE                                                          38700020
TESTBLOK EQU   *                                                        39000020
         TM    PARMINDX(RPARM8),PARMTRPN IS IT TRANSPARENT MODE         39300020
         BNO   LINKBLOK                 NO, GO GET FROM TRMENTRY        39600020
         SPACE 2                                                        39670022
         SPACE                                                          39900020
         TM    LCBSTAT2,LCBSYNC         IS THIS A BISYNC LINE           40200020
         BNO   LINKBLOK                 NO, HANDLE AS NON-TRANSP        40500020
         SPACE                                                          40800020
         TM    TRMDEVFL,TRMTRPBN        IS TRANSP BLOCK IN TRMENTRY     41100020
         BO    POINTRP                  YES, GO POINT TO IT             41400020
         SPACE 2                                                        41470022
         SPACE                                                          41700020
ERREXIT  EQU   *                                                        42000020
         LA    R15,AVTECD4              NO, SET ERROR RETURN CODE       42300020
         B     EXITOFF                  RETURN                          42600020
         SPACE                                                          42900020
POINTRP  EQU   *                                                        43200020
         LA    R14,BIT3                 SET FOR BIT SEARCH       S22024 43300022
         BAL   RRET10,POINT             POINT TO DEVICE DEP AREA        43500020
         SPACE                                                          43800020
         TM    TRMDEVFL,TRMBLOKN        IS BLOCK SPECIFIED              44100020
         BNO   TESTBUMP                 NO, SEE IF SUBBLK IS            44400020
         SPACE                                                          44700020
         LA    RPTR2,THREE(,RPTR2)      YES, BUMP PAST IT               45000020
         SPACE                                                          45300020
TESTBUMP EQU   *                                                        45600020
         TM    TRMDEVFL,TRMSUBKN        IS SUBBLK SPECIFIED             45900020
         BNO   ICTRPB                   NO, GO PICK UP TRP BLOCK        46200020
         SPACE                                                          46500020
         LA    RPTR2,TWO(,RPTR2)        YES, BUMP PAST IT               46800020
         SPACE                                                          47100020
ICTRPB   EQU   *                                                        47400020
         IC    RBLOCK5,ONE(,RPTR2)      PICK UP FIRST BLOCK BYTE        47700020
         SLL   RBLOCK5,SHIFT8           SHIFT LEFT                      48000020
         IC    RBLOCK5,TWO(,RPTR2)      PICK UP SECOND BLOCK BYTE       48300020
         B     SETFLAG                  GO SET FLAG                     48600020
         SPACE                                                          48900020
LINKBLOK EQU   *                                                        49200020
         TM    TRMDEVFL,TRMBLOKN        IS BLOCK SPEC IN TERM ENTRY     49500020
         BO    GETBLOK                  YES, GO GET IT                  49800020
         SPACE                                                          50100020
         TM    LCBSTAT2,LCBSYNC         IS DESTINATION BISYNC           50400020
         BO    ERREXIT                  YES, ERROR, GO SET FLAG         50700020
         SPACE                                                          51000020
         B     SETFIELD                 NO, GO SET ZEROES & EXIT        51300020
         SPACE                                                          51600020
GETBLOK  EQU   *                                                        51900020
         SPACE                                                          52200020
         LA    R14,BIT3                 SET FOR BIT SEARCH       S22024 52300022
         BAL   RRET10,POINT             YES, POINT TO DEV DEP AREA      52500020
         SPACE                                                          52800020
         IC    RBLOCK5,ONE(,RPTR2)      PICK UP FIRST BLOCK BYTE        53100020
         SLL   RBLOCK5,SHIFT8           SHIFT LEFT                      53400020
         IC    RBLOCK5,TWO(,RPTR2)      PICK UP SECOND BLOCK BYTE       53700020
         SPACE                                                          54000020
TESTSUB  EQU   *                                                        54300020
         L     R15,LCBDCBPT             GET DCB ADDRESS FROM LCB        54600020
         L     R15,DCBSCTAD-1           GET SCT ADDRESS FROM DCB        54900020
         CLI   SCTITB(R15),AVTEZERO     IS INDEX TO ITB ZERO            55200020
         BE    SETFIELD                 YES, GO SET FIELDS              55500020
         SPACE                                                          55800020
         TM    PARMLEN(RPARM8),HEX01    IS SUBBLK SPEC IN MACRO         56100020
         BNO   LINKSUBK                 NO, MUST GET FROM TRMENTRY      56400020
         SPACE                                                          56700020
         IC    RSUBBLK7,PARMLEN(,RPARM8) YES, GET ITS OFFSET            57000020
         BCTR  RSUBBLK7,AVTEZERO        ADJUST                          57300020
         IC    RSUBBLK7,AVTEZERO(RSUBBLK7,RPARM8) PICK IT UP            57600020
         B     SETFIELD                 GO SET SCB FIELDS               57900020
*                                                                       58000022
         SPACE                                                          58200020
LINKSUBK EQU   *                                                        58500020
         TM    TRMDEVFL,TRMSUBKN        IS SUBBLK SPEC IN TRMENTRY      58800020
         BNO   SETFIELD                 NO, NOT SPEC AT ALL             59100020
         SPACE                                                          59400020
         LTR   R0,R0                    HAVE WE LINKED TO POINT YET     59700020
         BZ    GETSUBK                  YES, DON'T NEED TO AGAIN        60000020
         SPACE                                                          60300020
         LA    R14,BIT3                 SET FOR BIT SEARCH       S22024 60400022
         BAL   RRET10,POINT             LINK TO POINT TO DEV DEP        60600020
         SPACE                                                          60900020
GETSUBK  EQU   *                                                        61200020
         TM    TRMDEVFL,TRMBLOKN        IS BLOCK IN TERM ENTRY          61500020
         BNO   ICSUBK                   NO, NOW AT SUBBLK               61800020
         SPACE                                                          62100020
         LA    RPTR2,THREE(,RPTR2)      YES, BUMP TO SUBBLK             62400020
         SPACE                                                          62700020
ICSUBK   EQU   *                                                        63000020
         IC    RSUBBLK7,ONE(,RPTR2)     PICK UP SUBBLK BYTE             63300020
         B     SETFIELD                 SET UP SCB FIELDS        S22025 63600022
         SPACE 2                                                        63670022
         SPACE                                                          63900020
SETFLAG  EQU   *                                                        64200020
         OI    SCBSTATE,SCBTRANP        YES, TURN ON BIT                64500020
         B     SETFDEOB                 SET EOB ONLY                    64800020
         SPACE                                                          65100020
SETFIELD EQU   *                                                        65400020
         OI    SCBSTATE,SCBMGFMN        SET MSGFORM REQUEST BIT         65700020
         STC   RSUBBLK7,SCBITBSZ        SET SUBBLK IN SCB               66000020
         STC   RSUBBLK7,SCBITBAC        SET SUBBLK INITIAL OFFSET       66300020
         STH   RBLOCK5,SCBEOBAC         SET BLOCK INITIAL OFFSET        66600020
         SPACE                                                          66900020
SETFDEOB EQU   *                                                        67200020
         STH   RBLOCK5,SCBEOBSZ         SET BLOCK IN SCB                67500020
         SR    R15,R15                  SET GOOD RETURN CODE            67800020
         SPACE                                                          68100020
EXITOFF  EQU   *                                                        68400020
         L     RBASE,AVTUI              GET RET INTERFACE ADDR   S22025 68700022
         B     FOUR(RBASE)              BRANCH TO RETURN ROUTINE S22025 69000022
         SPACE                                                          69030022
SETSCBFL EQU   *                                                 S22025 69060022
         OI    SCBSTATE,SCBMGFMN        SET MSGFORM REQ BIT      S22025 69090022
         STC   RSUBBLK7,SCBBCTR         ZERO BLK COUNTER         S22025 69120022
         LA    RSUBBLK7,ONE(RSUBBLK7)   SET LENGTH OF ONE        S22025 69150022
         STC   RSUBBLK7,SCBCRLEN        STORE IT IN SCB          S22025 69180022
         MVC   SCBENDCR,TWO(RPARM8)     SET ENDCHAR IN SCB       S22025 69210022
         MVC   SCBBLKCT,THREE(RPARM8)   SET BLK COUNT IN SCB     S22025 69240022
         B     SETFDEOB                 BRANCH FOR GOOD RETURN   S22025 69270022
         EJECT                                                          69300020
POINT    EQU   *                                                        69600020
         SR    R15,R15                  CLEAR FOR INSERT         A42378 69700000
         TM    TRMSTATE,TRMOPTFN        ARE THERE ANY OPT FIELDS        69900020
         LA    RPTR2,TRMOPNO            ASSUME NO                       70200020
         BNO   SETFLAGS                 NO, NOW AT DEV DEP AREA         70500020
         SPACE                                                          70800020
         IC    R15,TRMOPNO              PICK UP NO. OF OPT OFFSETS      71400020
         LA    RPTR2,TRMOPT(R15)        POINT TO DEV DEP AREA           71700020
         SPACE                                                          72000020
SETFLAGS EQU   *                                                        72300020
         LH    R15,TRMDEVFL             PICK UP DEVICE FLAGS     S22024 72600022
         N     R15,AVTCLRHI             CLEAR LEFT 2 BYTES       S22024 72700022
         LTR   R15,R15                  ANY FLAGS PRESENT        S22024 72800022
         BCR   ZERO,RRET10              BRANCH ON NO             S22024 73000022
         SLL   R15,15                   SHIFT TO HIORDER HALF    S22024 73200022
         SR    R0,R0                    CLEAR REGISTER           S22024 73400022
         SPACE 1                                                        73600022
SHIFT    EQU   *                                                 S22024 73800022
         LTR   R15,R15                  IS THIS BIT ON           S22024 74000022
         BNM   CHKCOUNT                 BRANCH ON NO             S22024 74200022
         AH    R0,HONE                  COUNT OF BITS FOUND      S22024 74400022
CHKCOUNT EQU   *                                                 S22024 74600022
         SLL   R15,1                    SHIFT TO NEXT BIT        S22024 74800022
         BCT   R14,SHIFT                HAVE ALL BITS BEEN CHKD  S22024 75000022
         LTR   R0,R0                    ANY DEV DEP FIELDS       S22024 75200022
         BCR   ZERO,RRET10              BRANCH ON NO             S22024 75400022
         SPACE                                                          76500020
BUMP     EQU   *                                                        76800020
         IC    R15,AVTEZERO(,RPTR2)     GET LENGTH OF FIELD             77100020
         LA    RPTR2,ONE(R15,RPTR2)     BUMP PAST FIELD                 77400020
         BCT   R0,BUMP                  LOOP TILL ALL FIELDS PASSED     77700020
         SPACE                                                          78000020
         BR    RRET10                   RETURN TO (LOCAL) CALLER        78300020
         SPACE 2                                                        78400022
HONE     DC    H'1'                     HEX ONE                  S22024 78500022
         EJECT                                                          78600020
********* DSECTS *********                                              78900020
         SPACE                                                          79200020
         TAVTD                                                          79500020
         EJECT                                                          79800020
         DCBD  DSORG=TX                                                 80100020
         EJECT                                                          80130007
DCT      DSECT                          DEVICE CHAR TBL DSECT    X03039 80160007
         DS    XL1                      RESERVED                 X03039 80190007
DCTSTAT1 DS    XL1                      FIRST STATUS BYTE        X03039 80220007
DCT3270  EQU   X'04'                    3270 FLAG                X03039 80250007
DCTSTAT2 DS    XL1                      SECOND STATUS BYTE       X03039 80280007
DCTLOCAL EQU   X'02'                    LOCAL FLAG               X03039 80310007
         EJECT                                                          80400020
         TLCBD                                                          80700020
         EJECT                                                          81000020
         TPRFD                                                          81300020
         EJECT                                                          81600020
         TSCBD                                                          81900020
         EJECT                                                          82200020
         TTRMD                                                          82500020
         SPACE                                                          82800020
         END                                                            83100020
