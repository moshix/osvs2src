AN01     TITLE '''IEDQAN'' -- MULTIPLE INSERT/REMOVE ROUTINE'           00040056
IEDQAN   CSECT                                                          00080056
         SPACE 3                                                        00120056
*   CHANGE ACTIVITY AS FOLLOWS                                          00160056
******************** MICROFICHE FLAGS *********************** SUPT CODE 00200056
*A123600,240140,527000                                          SA54948 00200105
*A192000                                                        SA53607 00200205
*A124100-124200,240000                                           S22025 00200305
*A065600,0786000,089090-089900,121000,123600,124100-124700       S22025 00200405
*A147200-147800,270100-270500,290002-290980,291020-291980        S22025 00200505
*A292020-292740,331200-331800,437900-435100,436900-448700,450300 S22025 00200605
*A454500,470100-470700,506070-506910                             S22025 00200705
*C207000,241260,245000-246000,272000-289000,291000-292000,310000 S22025 00200805
*C436000,003006.003807                                           S22025 00200905
*D120000-123200,130000-139000,206000,208000-209000,242000        S22025 00201005
*D293000-297000,311000,332000,395000,428000-435000,437000-448000 S22025 00201105
*D450000,462000,464000,5040000,514000-523000                     S22025 00201205
*D127200-128200,241190-244000                                   SA58444 00201305
*C126000                                                        SA58444 00201405
*A292680                                                        SA68683 00201505
*D292720                                                        SA68683 00201605
*D291020-291040                                                @SA70224 00201756
*C089720,089810,291660,292380                                  @SA70224 00201856
*C292392                                                       @SA74031 00203810
         SPACE                                                          00206622
*********************************************************************** 00207222
*                                                                     * 00207856
* MODULE NAME = IEDQAN                                                * 00207956
*                                                                     * 00208056
*  DESCRIPTIVE NAME = MULTIPLE INSERT REMOVE                          * 00208156
*                                                                     * 00208256
*  COPYRIGHT = 'NONE'                                                 * 00208356
*                                                                     * 00208456
*  STATUS:  CHANGE LEVEL 5                                            * 00208556
*                                                                     * 00208656
*FUNCTION -- PERFORMS INSERTIONS, DELETIONS AND REPLACEMENTS OF       * 00209022
*   DATA AT LOCATIONS IN THE MESSAGE SPECIFIED BY THE APPEARANCE OF   * 00209622
*   CHARACTER STRINGS.                                                * 00210222
*                                                                     * 00210822
*   THE HEART OF THE MULTIPLE INSERT/REMOVE ROUTINE IS A TRANSLA-     * 00211422
*   TION TABLE BUILT BY THE ROUTINE FROM THE INITIAL LETTER OF EACH   * 00212022
*   CHARACTER STRING AND USED BY A TRANSLATION-AND-TEST INSTRUCTION   * 00212622
*   WHICH IS PERFORMED ON ALL DATA IN THE BUFFER.                     * 00213222
*                                                                     * 00213822
*   ON ENTRY, THE ROUTINE CLEARS THE TRANSLATION TABLE AND BUILDS     * 00214422
*   IT FROM THE CHARACTER STRINGS SPECIFIED IN THE PARAMETER LIST.    * 00215022
*   AT AN OFFSET INTO THE TABLE EQUAL TO THE INITIAL LETTER OF A      * 00215622
*   CHARACTER STRING IS SET THE OFFSET FROM THE START OF THE PARA-    * 00216222
*   METER LIST TO THE SUBPARAMETER LIST WHOSE FUNCTION IS GOVERNED    * 00216822
*   BY THAT CHARACTER STRING.                                         * 00217422
*                                                                     * 00218022
*   IN THE PREFIX OF THE BUFFER ARE SAVED THE OFFSET OF THE BYTE OF   * 00218622
*   DATA (THE DATA OFFSET) AND THE NUMBER OF LOGICALLY EMPTY BYTES    * 00219222
*   AVAILABLE FOR INSERTION (THE INSERT OFFSET). THE INITIAL INSERT   * 00219822
*   OFFSET IS ZERO. THE MAIN LOOP IS THEN ENTERED.                    * 00220422
*                                                                     * 00221022
*   MAIN LOOP (TESTEOS) --                                            * 00221622
*   THE DATA OFFSET IS COMPARED WITH THE TOTAL SIZE OF DATA IN THE    * 00222222
*   BUFFER (PRFSIZE). IF THE DATA OFFSET IS NOT LOW, EXIT IS MADE     * 00222822
*   TO NORMAL COMPLETION, WHERE PRFSIZE IS ADJUSTED TO DECREMENT      * 00223422
*   ANY LEFTOVER LOGICALLY EMPTY BYTES AT THE END AND RETURN IS       * 00224022
*   MADE TO THE MESSAGE HANDLER VIA THE RETURN INTERFACE ROUTINE      * 00224622
*   (IEDQUI).                                                         * 00225222
*                                                                     * 00225822
*   IF THE DATA OFFSET IS LOW, IT IS PASSED TO THE ADDRESS FINDER     * 00226422
*   ROUTINE (ENTERLOP), WHICH RETURNS THE DATA ADDRESS AND THE        * 00227022
*   ADDRESS OF THE END OF THE UNIT IN WHICH THE ADDRESS IS LOCATED.   * 00227622
*   THE TRANSLATE-AND-TEST INSTRUCTION IS THEN PERFORMED STARTING     * 00228222
*   AT THE DATA ADDRESS FOR THE LENGTH OF THE UNIT OR,  IF THE UNIT   * 00228822
*   IS THE LAST UNIT IN THE BUFFER, FOR THE LENGTH OF DATA IN THE     * 00229422
*   UNIT.                                                             * 00230022
*                                                                     * 00230622
*   IF THE UNIT TRANSLATES ALL ZEROES,  A LINK IS MADE TO A TEST-     * 00231222
*   SHIFT SUBROUTINE. THIS SUBROUTINE TESTS IF THERE ARE ANY          * 00231822
*   LOGICALLY EMPTY BYTES PRECEDING THE DATA JUST TRANSLATED. IF      * 00232422
*   NOT, THE SUBROUTINE RETURNS IMMEDIATELY. OTHERWISE THE SUB-       * 00233022
*   ROUTINE LINKS TO THE INSERT DATA ROUTINE (IEDQAF) WHICH SHIFTS    * 00233622
*   THE DATA JUST TRANSLATED LEFTWARDS IN THE BUFFER, OVERLAYING      * 00234222
*   THE LOGICALLY EMPTY BYTES AND EFFECTIVELY MOVING THE LOGICALLY    * 00234822
*   EMPTY AREA TO THE RIGHT-HAND END OF THE UNIT.                     * 00235422
*                                                                     * 00236022
*   ON RETURN FROM THIS SUBROUTINE, THE MAIN LOOP INCREMENTS THE      * 00236622
*   DATA OFFSET BY THE LENGTH OF DATA JUST TRANSLATED AND REENTERS    * 00237222
*   THE MAIN LOOP TO TRANSLATE THE NEXT UNIT.                         * 00237822
*                                                                     * 00238422
*   IF THE TRANSLATE-AND-TEST RESULTS IN A 'HIT' (A BYTE IN THE       * 00239022
*   BUFFER TRANSLATES NON-ZERO), A BRANCH IS TAKEN TO A HIT ANAL-     * 00239622
*   YSIS SUBROUTINE.                                                  * 00240222
*                                                                     * 00240822
*   HIT ANALYSIS SUBROUTINE (NORMHIT) --                              * 00241422
*   THE SUBROUTINE DETERMINES IF THE HIT OCCURRED ON THE FIRST        * 00242022
*   BYTE TRANSLATED AND IF NOT LINKS TO THE TEST-SHIFT SUBROUTINE     * 00242622
*   TO SHIFT THE BYTES JUST TRANSLATED LEFTWARDS IN THE BUFFER,       * 00243222
*   THUS MOVING THE LOGICALLY EMPTY AREA RIGHTWARDS UP TO THE HIT     * 00243822
*   BYTE. ON RETURN THE DATA OFFSET IS INCREMENTED BY THE LENGTH      * 00244422
*   OF DATA JUST TRANSLATED.                                          * 00245022
*                                                                     * 00245622
*   THE SUBPARAMETER LIST INDICATED BY THE OFFSET TO WHICH THE HIT    * 00246222
*   BYTE TRANSLATED IS LOCATED. FROM INFORMATION IN THIS SUBPARA-     * 00246822
*   METER LIST IS BUILT A PARAMETER LIST FOR THE SCAN ROUTINE         * 00247422
*   (IEDQAL). THE OFFSET OF THE HIT IS PASSED TO THE SCAN ROUTINE     * 00248022
*   TO DETERMINE IF THE HIT BYTE IS THE FIRST BYTE OF  A  CHARACTER   * 00248622
*   STRING EQUAL TO THE STRING GOVERNING THE FUNCTION SPECIFIED BY    * 00249222
*   THE SUBPARAMETER LIST.                                            * 00249822
*                                                                     * 00250422
*   IF THE STRINGS ARE NOT EQUAL, THE DATA OFFSET IS INCREMENTED      * 00251022
*   PAST THIS SPURIOUS HIT BYTE AND MAIN LOOP IS RE-ENTERED. IF       * 00251622
*   THERE ARE INSUFFICIENT CHARACTERS REMAINING IN THE BUFFER TO      * 00252222
*   TELL IF THE STRINGS ARE EQUAL, A CHECK IS MADE TO SEE IF THE      * 00252822
*   FUNCTION IS BEING PERFORMED IN AN INBLOCK SUBGROUP. IF THE        * 00253422
*   FUNCTION IS IN INBLOCK AND THIS IS NOT THE LAST BUFFER, CONTROL   * 00254022
*   IS GIVEN TO THE CROSS-BUFFER ROUTINE (BNLINK). IF THE FUNCTION    * 00254622
*   IS NOT IN INBLOCK, OR THIS IS THE LAST BUFFER, THE CORRESPONDING  * 00255222
*   BYTE IN THE TRANSLATE TABLE IS CLEARED. THE DATA OFFSET IS        * 00255822
*   INCREMENTED AND THE MAIN LOOP IS RE-ENTERED.                      * 00256422
*                                                                     * 00257022
*   IF THE STRINGS ARE EQUAL, THE STRING IN THE BUFFER IS SHIFTED     * 00257622
*   LEFTWARDS IN THE BUFFER VIA A LINK TO THE TEST-SHIFT SUBROU-      * 00258222
*   TINE. THE SHIFT IS NOT PERFORMED, HOWEVER, IF THE FUNCTION        * 00258822
*   SPECIFIED IS A REMOVE FUNCTION WHICH INCLUDES REMOVAL OF THE      * 00259422
*   STRING ITSELF. IN THIS CASE THE INSERT OFFSET IS INCREMENTED      * 00260022
*   BY THE LENGTH OF THE STRING INSTEAD.                              * 00260622
*                                                                     * 00261222
*   IF THE FUNCTION SPECIFIED IS AN INSERT FUNCTION, THE INSERT       * 00261822
*   SUBROUTINE IS ENTERED. IF A REMOVE FUNCTION, THE REMOVE SUB-      * 00262422
*   ROUTINE IS ENTERED.                                               * 00263022
*                                                                     * 00263622
*   CROSS-BUFFER SUBROUTINE --                                        * 00264222
*   THIS SUBROUTINE DELETES DATA FROM A BUFFER AND PUTS THE DELETED   * 00264822
*   DATA ON THE HOLD QUEUE SO THAT IT WILL BE INSERTED INTO THE       * 00265422
*   NEXT BUFFER OF THE CURRENT MESSAGE. THIS SUBROUTINE LINKS TO      * 00266022
*   THE UNIT REQUEST ROUTINE (IEDQAO) AND THE SHIFT DATA ROUTINE      * 00266622
*   (IEDQAF) TO GET AN ADDITIONAL UNIT AND SHIFT INTO IT ALL OF       * 00267222
*   THE DATA IN A SINGLE UNIT, FOLLOWING AND INCLUDING THE 'FROM'     * 00267822
*   CHARACTER STRING. A TEXT PREFIX IS BUILT IN THE NEW UNIT AND      * 00268422
*   IT PLUS SUBSEQUENT UNITS FORM A BUFFER THAT IS PLACED ON THE      * 00269022
*   HOLD QUEUE. THE ORIGINAL BUFFER, WITH PRFSIZE DECREMENTED, IS     * 00269622
*   RETURNED FOR FURTHER MH PROCESSING.                               * 00270222
*                                                                     * 00270822
*   INSERT SUBROUTINE --                                              * 00271422
*   FROM INFORMATION IN THE SUBPARAMETER LIST, PARAMETERS ARE BUILT   * 00272022
*   FOR THE USER REQUEST INTERFACE AND A LINK IS MADE TO IT. THIS     * 00272622
*   INTERFACE ACCESSES ANOTHER UNIT IF NEEDED FOR SPACE TO INSERT     * 00273222
*   AND LINKS TO THE INSERT DATA ROUTINE. THIS ROUTINE INSERTS THE    * 00273822
*   DATA SPECIFIED, ADJUSTS THE DATA AND INSERT OFFSETS ACCORDINGLY   * 00274422
*   AND RETURNS TO THE MULTIPLE INSERT/REMOVE ROUTINE.  THE MAIN      * 00275022
*   LOOP IS THEN RE-ENTERED.                                          * 00275622
*   IF THE UNIT REQUEST INTERFACE FINDS NO EMPTY UNITS AVAILABLE,     * 00276222
*   IT RETURNS IMMEDIATELY WITH X'04' IN REGISTER 15.  THE ROUTINE    * 00276822
*   DISCONTINUES THE TRANSLATE-AND-TEST AND RETURNS IMMEDIATELY TO    * 00277422
*   THE USER WITH THIS RETURN CODE.                                   * 00278022
*                                                                     * 00278622
*   REMOVE SUBROUTINE --                                              * 00279222
*   THE SUBROUTINE DETERMINES WHAT THE 'TO' DELIMITER IS FOR THIS     * 00279822
*   REMOVE FUNCTION. (THE 'FROM' DELIMITER IS THE CHARACTER STRING    * 00280422
*   ALREADY FOUND.)                                                   * 00281022
*                                                                     * 00281622
*   IF THE 'TO' DELIMITER IS A CHARACTER STRING, THE SUBROUTINE       * 00282222
*   LINKS TO THE BUFFER SCAN ROUTINE (IEDQAX) TO SCAN PAST 'FROM' FOR * 00282822
*   DELIMITING CHARACTER STRING. ON RETURN, IF THE STRING WAS NOT     * 00283422
*   FOUND, THE FUNCTION CANNOT BE PERFORMED IN THIS BUFFER. THE       * 00284022
*   ROUTINE CHECKS TO SEE IF THE FUNCTION MAY CROSS BUFFERS (THIS     * 00284622
*   FUNCTION IS IN INBLOCK AND THIS IS NOT THE LAST BUFFER). IF       * 00285222
*   ACROSS BUFFERS, CONTROL IS GIVEN TO BNLINK. OTHERWISE THE         * 00285822
*   APPROPRIATE BYTE IN THE TRANSLATE TABLE IS CLEARED TO ZERO,       * 00286422
*   THE DATA OFFSET IS INCREMENTED PAST THE HIT BYTE AND RE-ENTRY     * 00287022
*   IS MADE TO THE MAIN LOOP.                                         * 00287622
*                                                                     * 00288222
*   IF THE STRING WAS FOUND, THE OFFSET TO ITS LAST BYTE IS           * 00288822
*   RETURNED. THE SUBROUTINE DETERMINES IF THE 'TO' STRING IS TO      * 00289422
*   BE ITSELF REMOVED.  IF NOT, THE OFFSET IS DECREMENTED BY THE      * 00290022
*   LENGTH OF THE 'TO' STRING; OTHERWISE IT IS NOT CHANGED.  THIS     * 00290622
*   OFFSET NOW BECOMES THE NEW DATA OFFSET,  AND THE INSERT OFFSET    * 00291222
*   IS INCREMENTED BY THE LENGTH OF DATA LOGICALLY REMOVED.  IF THE   * 00291822
*   REMOVE FUNCTION SPECIFIED IS A CONTRACT, THE MAIN LOOP IS         * 00292422
*   RE-ENTERED.                                                       * 00293022
*                                                                     * 00293622
*   IF THE REMOVE FUNCTION IS A REPLACE,  THE ROUTINE ENTERS THE      * 00294222
*   INSERT SUBROUTINE. IF THE REPLACE DATA IS A DELIMITER CHARAC-     * 00294822
*   TER, HOWEVER, THE ROUTINE MUST FIND THE TERMINAL TABLE ENTRY      * 00295422
*   FOR THE DESTINATION AND EXTRACT THE CONFIGURATION OF THE          * 00296022
*   DELIMITER FROM IT.  THE DELIMITER IS SET INTO THE SUBPARAMETER    * 00296622
*   LIST AND ENTRY IS THEN MADE TO THE INSERT SUBROUTINE.             * 00297222
*                                                                     * 00297822
*   IF THE 'TO' DELIMITER IS AN EXTENT,  THE EXTENT IS PICKED UP      * 00298422
*   FROM THE SUBPARAMETER LIST AND ADDED TO THE DATA OFFSET.  THE     * 00299022
*   RESULT IS THE NEW DATA OFFSET,  AND THE INSERT OFFSET IS INCRE-   * 00299622
*   MENTED BY THE LENGTH OF DATA LOGICALLY REMOVED.  IF THE REMOVE    * 00300222
*   FUNCTION IS A CONTRACT, THE MAIN LOOP IS RE-ENTERED.  OTHERWISE   * 00300822
*   PROCESSING PROCEEDS IN THE SAME MANNER AS FOR A REPLACE FUNC-     * 00301422
*   TION WITH A CHARACTER STRING AS THE 'TO' DELIMITER.               * 00302022
*                                                                     * 00302622
*ENTRY POINTS --                                                      * 00303222
*       'IEDQAN01' TO PERFORM MULTIPLE INSERT/REMOVE FUNCTIONS.       * 00303822
*   CALLING SEQUENCE FROM USER INTERFACE IS:                          * 00304422
*                                                                     * 00305022
*        L     R12,AVTMSGS-1            GET ADDR OF VCON TABLE        * 00305622
*        IC    R15,AVTEZERO(,R1)        GET INDEX TO ROUTINE ADDR     * 00306222
*        L     R12,AVTEZERO(R12,R15)    GET ROUTINE ADDRESS           * 00306822
*        BR    R12                      EXIT TO ROUTINE               * 00307422
*                                                                     * 00308022
*INPUT --                                                             * 00308622
*   REGISTER 1 - THE ADDRESS OF A MACRO-GENERATED PARAMETER LIST.     * 00309222
*   PARAMETER LIST FORMAT IS:                                         * 00309822
*                                                                     * 00310422
*        *********************************                            * 00311022
*        * INDEX * PARAM * INDEX * INDEX *                              00311622
*        *  TO   * LIST  *  TO   *  TO   *                              00312222
*        *   AN  *  LNG  *   AF  *   AO  *                            * 00312822
*        *********************************                            * 00313422
*        * (UN-  * BLANK *  NO.  * (UN-  *                            * 00314022
*        * USED) *  CHAR *   OF  * USED) *                              00314622
*        *       *       *ENTRIES*       *                            * 00315222
*        *********************************                            * 00315822
*        * (UN-  *      ADDRESS OF       *                            * 00316422
*        * USED) *      CHARACTERS       *                            * 00317022
*        *       *        TABLE          *                            * 00317622
*        ************************************                         * 00318222
*        *       *       *     DATA      *                            * 00318822
*        *  KEY  *STATUS *  DESCRIPTION  *                            * 00319422
*        *       *       *               *   FIRST                    * 00320022
*        *********************************     SUB-PARAMETER          * 00320622
*        *      FROM     *      TO       *       LIST                 * 00321222
*        *   DELIMITER   *   DELIMITER   *                            * 00321822
*        *  DESCRIPTION  *  DESCRIPTION  *                            * 00322422
*        ************************************                         * 00323022
*        *                               *                            * 00323622
*        *                               *                            * 00324222
*                                                                     * 00324822
*                                                                     * 00325422
*                                                                     * 00326022
*        *                               *                            * 00326622
*        *                               *                            * 00327222
*        *********************************                            * 00327822
*                                                                     * 00328422
*        DATA=CHARACTERS                                              * 00329022
*          | DATA=IDLES COUNT                                         * 00329622
*          |   | DATA=CONTRACT                                        * 00330222
*          |   |   | TO=CHAR STRING                                   * 00330822
*          |   |   |   | TO=OFFSET                                    * 00331422
*          |   |   |   |   | TO=EXTENT                                * 00332022
*          |   |   |   |   |   | INCLUSIVE FROM                       * 00332622
*          |   |   |   |   |   |   | INCLUSIVE TO                     * 00333222
*          |   |   |   |   |   |   |   |          BIT ON              * 00333822
*        *********************************                            * 00334422
*        *   *   *   *   *   *   *   *   * SUB-PARAMETER              * 00335022
*        * 0 * 1 * 2 * 3 * 4 * 5 * 6 * 7 *  STATUS BYTE               * 00335622
*        *   *   *   *   *   *   *   *   *   FORMAT                   * 00336222
*        *********************************                            * 00336822
*                                  |   |          BIT OFF             * 00337422
*                                  | EXCLUSIVE TO                     * 00338022
*                                EXCLUSIVE FROM                       * 00338622
*                                                                     * 00339222
*   REGISTER 3 - THE ADDRESS OF THE SCB                               * 00339822
*                                                                     * 00340422
*   REGISTER 4 - THE ADDRESS OF THE LCB                               * 00341022
*                                                                     * 00341622
*   REGISTER 6 - THE ADDRESS OF THE BUFFER                            * 00342222
*                                                                     * 00342822
*   REGISTER 9 - THE ADDRESS OF THE AVT                               * 00343422
*                                                                     * 00344022
*   REGISTER 12 - THE ENTRY POINT ADDRESS AND BASE REGISTER FOR       * 00344622
*   THIS ROUTINE.                                                     * 00345222
*                                                                     * 00345822
*OUTPUT --                                                            * 00346422
*   REGISTER 15 - A RETURN CODE OF X'00' IF ALL FUNCTIONS REQUESTED   * 00347022
*   ARE PERFORMED OR X'04' IF EMPTY UNITS NEEDED FOR DATA INSERTION   * 00347622
*   WERE NOT AVAILABLE.                                               * 00348222
*                                                                     * 00348822
*EXTERNAL REFERENCES --                                               * 00349422
*   'IEDQAF' - INSERT DATA ROUTINE                                    * 00350022
*                                                                     * 00350622
*   'IEDQAL' - SCAN AT OFFSET ROUTINE                                 * 00351222
*                                                                     * 00351822
*   'IEDQAX' - SCAN BUFFER ROUTINE                                    * 00352422
*                                                                     * 00353022
*   'IEDQAO' - UNIT REQUEST INTERFACE                                 * 00353622
*                                                                     * 00354222
*   AVT - ADDRESS VECTOR TABLE                                        * 00354822
*                                                                     * 00355422
*   SCB - STATION CONTROL BLOCK                                       * 00356022
*                                                                     * 00356622
*   LCB - LINE CONTROL BLOCK                                          * 00357222
*                                                                     * 00357822
*   HOLD QUEUE                                                        * 00358422
*                                                                     * 00359022
*   BUFFER CURRENTLY BEING PROCESSED                                  * 00359622
*                                                                     * 00360222
*EXITS, NORMAL -- ALL FUNCTIONS HAVE BEEN PERFORMED.  REGISTER 15     * 00360822
*   CONTAINS A RETURN CODE OF X'00'.                                  * 00361422
*                                                                     * 00362022
*EXITS, ERROR -- NOT ALL FUNCTIONS HAVE BEEN PERFORMED BECAUSE        * 00362622
*   EMPTY UNITS NEEDED FOR DATA INSERTION WERE NOT AVAILABLE.         * 00363222
*   REGISTER 15 CONTAINS A RETURN CODE OF X'04'.                      * 00363822
*                                                                     * 00364422
*TABLES/WORK AREAS --                                                 * 00365022
*                                                                     * 00365622
*   TRANSLATE TABLE FOR EXECUTED TRANSLATE-AND-TEST INSTRUCTION       * 00366222
*                                                                     * 00366822
*ATTRIBUTES -- SERIALLY REUSABLE, REFRESHABLE, ENABLED, RESIDENT,     * 00367422
*   PROBLEM PROGRAM MODE.                                             * 00368022
*                                                                     * 00368622
*NOTE -- THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL        * 00369222
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS             * 00369822
*   EQUIVALENT TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS      * 00370422
*   BEEN ARRANGED SO THAT REDEFINITION OF ''CHARACTER'' CONSTANTS,    * 00371022
*   BY REASSEMBLY, WILL RESULT IN A CORRECT MODULE FOR THE NEW        * 00371622
*   DEFINITIONS.                                                      * 00372222
*                                                                     * 00372822
*********************************************************************** 00373422
         EJECT                                                          00374022
*********************************************************************** 00381020
         EJECT                                                          05100020
********* REGISTER EQUATES *********                                    05200020
         SPACE                                                          05300020
R0       EQU   0                        WORK REGISTER                   05400020
         SPACE                                                          05500020
R1       EQU   1                        PARAMETER LIST ADDRESS          05600020
         SPACE                                                          05700020
RWORK2   EQU   2                        WORK REGISTER                   05800020
         SPACE                                                          05900020
RSCB     EQU   3                        SCB ADDRESS                     06000020
         SPACE                                                          06100020
RLCB4    EQU   4                        LCB ADDRESS                     06200020
RSTRING4 EQU   4                        CHARACTER STRING ADDRESS        06300020
         SPACE                                                          06400020
RDATAD5  EQU   5                        DATA ADDRESS                    06500020
         SPACE 1                                                 S22025 06510022
         SPACE 1                                                 S22025 06530022
RSCAN    EQU   5                        SCAN POINTER OFFSET      S22025 06560022
         SPACE                                                          06600020
RPREFIX  EQU   6                        BUFFER ADDRESS                  06700020
         SPACE                                                          06800020
RPARM7   EQU   7                        PARAMETER LIST ADDRESS          06900020
         SPACE                                                          07000020
RWORK8   EQU   8                        WORK REGISTER                   07100020
         SPACE                                                          07200020
RAVT     EQU   9                        AVT ADDRESS                     07300020
         SPACE                                                          07400020
RHIT10   EQU   10                       SUB-PARAMETER LIST ADDRESS      07500020
         SPACE                                                          07600020
RCT11    EQU   11                       SUB-PARAM COUNT REGISTER        07700020
REX11    EQU   11                       EXECUTE REGISTER                07800020
         SPACE 1                                                 S22025 07810022
         SPACE 1                                                 S22025 07830022
REOUAD   EQU   11                       CURRENT EOU ADDR         S22025 07860022
         SPACE                                                          07900020
RBASE    EQU   12                       BASE REGISTER                   08000020
         SPACE                                                          08100020
R13      EQU   13                       SAVE AREA ADDRESS               08200020
R14      EQU   14                       RETURN REGISTER                 08300020
R15      EQU   15                       LINK REGISTER                   08400020
         SPACE                                                          08500020
********* OTHER EQUATES *********                                       08600020
         SPACE                                                          08700020
ONE      EQU   1                        INCREMENT VALUE OF ONE          08800020
FOUR     EQU   4                        MOVE LENGTH OF FOUR             08850020
SHIFT8   EQU   8                        SHIFT LENGTH OF 1 BYTE          08900020
EIGHT    EQU   8                        TO POINT TO AN PARM LIST S22025 08909022
FIVE     EQU   5                        OFFSET TO BUFFER ADDR    S22025 08918022
THREE    EQU   3                        COMPARE LENGTH           S22025 08927022
LCBSCB   EQU   13                       LCB ADDR OFFSET IN PREFIXS22025 08936022
INBLK    EQU   X'02'                    TO SPECIFY INBLOCK       S22025 08945022
BLNKCHAR EQU   5                        OFFSET TO BLANK          S22025 08954022
TFOUR    EQU   24                       SHIFT LENGTH             S22025 08963022
MVOFF    EQU   12                       MOVE OFFSET            @SA70224 08972056
LEN      EQU   23                       MOVE LENGTH            @SA70224 08978056
TWO      EQU   2                        OFFSET                   S22025 08984022
BFREDIT  EQU   X'40'                    DATA MOVEMENT FLAG       S22025 08987022
LOWEQ    EQU   12                       LOW/EQUAL CONDITION      S22025 08990022
         SPACE                                                          09000020
IDLEFLAG EQU   X'01'                    INSERT CHARACTERS = IDLES       09100020
SHIFFLAG EQU   X'01'                    MULTIPLE SHIFT REQUEST FLAG     09200020
SHIFUNIT EQU   X'02'                    ONE-UNIT SHIFT REQUEST          09300020
NOBLANKN EQU   X'02'                    'NO BLANK' FLAG                 09400020
         SPACE                                                          09500020
CCZERO   EQU   8                        CONDITION CODE OF ZERO          09600020
CCEQUAL  EQU   8                        CONDITION CODE OF EQUAL         09700020
         SPACE                                                          09800020
DATACHAR EQU   X'80'                    DATA = CHARACTER STRING         09900020
DATAIDCT EQU   X'40'                    DATA = COUNT OF IDLES           10000020
DATACONT EQU   X'20'                    DATA = CONTRACT                 10100020
TOCHAR   EQU   X'10'                    TO DELIMITER = CHAR STRING      10200020
TOOFFS   EQU   X'08'                    TO DELIMITER = OFFSET           10300020
TOEXTN   EQU   X'04'                    TO DELIMITER = EXTENT           10400020
FROMINCL EQU   X'02'                    FROM STRING INCL IN REMOVE      10500020
TOINCL   EQU   X'01'                    TO STRING INCL IN REMOVE        10600020
         SPACE                                                          10700020
ADA      EQU   X'10'                    RCV SCHED KEY VALUES            10800020
VAN      EQU   X'12'                      FOR APPLICATION PROGRAM       10900020
         EJECT                                                          11000020
         USING IEDQAVTD,RAVT            AVT ADDRESSABILITY       S22025 11100022
         USING IEDQLCB,RLCB4            LCB ADDRESSABILITY       S22025 11200022
         USING IEDQPARM,RPARM7          PARMLIST ADDRESSABILTY   S22025 11300022
         USING IEDQPRF,RPREFIX          BUFFER   ADDRESSABILTY   S22025 11400022
         USING IEDQSCB,RSCB             SCB ADDRESSABILITY       S22025 11500022
         USING IEDQSBPM,RHIT10          SUB-PARMLIST ADDR'BILITY S22025 11600022
         USING IEDQAN,RBASE             MODULE ADDRESSABILITY    S22025 11700022
         SPACE 1                                                 S22025 11800022
IEDQAN01 EQU   *                        ENTRY POINT              S22025 11900022
IEDQAN   IEDHJN MULTINRE                                         S22025 12100022
         L     RPREFIX,AVTADBUF         GET CURRENT BUFFER ADDR  S22025 12360022
         MVC   KEYSAVE(2),PRFKEY        SAVE LOCAL OPCODE BYTE  SA54948 12380022
         SR    RCT11,RCT11              CLEAR FOR COMPARE               12400020
         TM    LCBSTAT1,LCBSENDN        IS IT SEND               S22025 12410022
         BO    ITSEND                   YES                      S22025 12420022
         STH   RCT11,PRFXTRA+1          INITIALIZE COUNT FIELD   S22025 12450022
ITSEND   EQU   *                                                 S22025 12470022
         CH    RCT11,PRFSIZE            IS THIS A ZERO-LENGTH BFR       12500020
         BE    TESTINCL                 YES, RETURN IMMEDIATELY SA58444 12600022
         SPACE                                                          12700020
         LR    RPARM7,R1                SET PARAMETER REGISTER          12840020
         IC    R0,PARMBLNK              PICK UP BLANK CHARACTER         12900020
         SPACE                                                          13700020
         SPACE                                                          14000020
CLEARTAB EQU   *                                                        14100020
         XC    TRANTAB(256),TRANTAB     CLEAR TRANSLATE TABLE           14200020
         L     RWORK2,PARMCHAR          GET CHARACTERS TABLE ADDR       14300020
         IC    RCT11,PARMENTS           GET NO. OF SUB-PARAMS           14400020
         LA    RHIT10,PARMFIRS          POINT TO FIRST SUB-PARAM        14500020
         SPACE                                                          14600020
TABLOOP  EQU   *                                                        14700020
         TM    LCBSTAT1,LCBSENDN        SEND                     S22025 14720022
         BO    DELM                     YES                      S22025 14740022
         MVC   PRFXTRA(1),SBPMSTAT      GET STATUS BYTE          S22025 14760022
DELM     EQU   *                                                 S22025 14780022
         TM    SBPMSTAT,DATACHAR+DATAIDCT IS DATA DELIMITER             14800020
         BO    DELIMIT                  YES, GO VERIFY                  14900020
         SPACE                                                          15000020
SETTRANS EQU   *                                              N         15100020
         IC    R0,SBPMKEY               GET INDEX                       15200020
         LH    R14,SBPMFROM             GET CHAR STRING OFFSET          15300020
         N     R14,AVTCLRHI                                             15400020
         SR    R15,R15                  (CLEAR FOR INSERT)              15500020
         IC    R15,ONE(R14,RWORK2)      GET 1ST CHAR IN STRING          15600020
         STC   R0,TRANTAB(R15)          SET TRANSLATE TABLE BYTE        15700020
         B     NEXTSBPM                 GO BUMP TO NEXT SUB-PARM        15800020
         SPACE                                                          15900020
DELIMIT  EQU   *                                                        16000020
         TM    LCBSTAT1,LCBSENDN        SEND SIDE OF MH                 16100020
         BNO   NEXTSBPM                 NO, BYPASS THIS ENTRY           16200020
         SPACE                                                          16300020
         CLI   LCBRSKEY,ADA             TEST RCV SCHED KEY VALUE        16400020
         BE    LINKTNT                  IT IS APPL PGM, PROCEED         16500020
         SPACE                                                          16600020
         CLI   LCBRSKEY,VAN             TEST RCV SCHED KEY VALUE        16700020
         BNE   NEXTSBPM                 IT ISN'T, BYPASS THIS ENTRY     16800020
         SPACE                                                          16900020
LINKTNT  EQU   *                                                        17000020
         LH    R1,LCBTTCIN              GET DESTINATION OFFSET          17100020
         N     R1,AVTCLRHI                                              17200020
         L     R15,AVTRNMPT             GET ADDR OF TNT CODE            17300020
         BALR  R14,R15                  LINK TO GET TERMINAL ADDR       17400020
         SPACE                                                          17500020
         USING IEDQTRM,R1                                               17600020
         IC    R1,TRMCHCIN              GET DELIMITER CHARACTER         17700020
         STC   R1,SBPMDATA+1            PUT IT IN SUB-PARM LIST         17800020
         MVI   SBPMDATA,ONE             PUT IN COUNT OF ONE             17900020
         B     SETTRANS                 GO SET KEY IN TABLE             18000020
         SPACE                                                          18100020
NEXTSBPM EQU   *                                                        18200020
         LA    RHIT10,SBPMNEXT          POINT TO NEXT SUB-PARAM         18300020
         BCT   RCT11,TABLOOP            LOOP TILL OUT OF SUB-PARAMS     18400020
         SPACE                                                          18500020
         SR    RDATAD5,RDATAD5          (CLEAR FOR INSERT)              18600020
         IC    RDATAD5,LCBISZE          PICK UP NO. OF RESERVES         18700020
         LA    RDATAD5,AVTTXTSZ+1(,RDATAD5) ADD SIZE OF TEXT PREFIX     18800020
         TM    PRFSTAT1,PRFNHDRN        IS IT HEADER PREFIX             18900020
         BO    SETINIT                  NO, GO SET                      19000020
         SPACE                                                          19100020
         LA    RDATAD5,AVTHDRSZ-AVTTXTSZ(,RDATAD5) YES, ADD EXTRA       19200020
         TM    LCBSTAT1,LCBRECVN       RECEIVE OPERATION        SA53607 19210000
         BZ    SETINIT                 NO, PROCEED              SA53607 19220000
         TM    SCBBSCFM,SCBDATEN       DATE/TIME REQUESTED      SA53607 19230000
         BZ    SETINIT                 NO, PROCEED              SA53607 19240000
         LA    RDATAD5,EIGHT(RDATAD5)  YES, ADD FOR DATE/DIME   SA53607 19250000
         SPACE                                                          19300020
SETINIT  EQU   *                                                        19400020
         ST    RDATAD5,PRFINS           SET INITIAL OFFSETS             19500020
*        B     TESTEOS                  ENTER TRT LOOP                  19600020
         EJECT                                                          19700020
TESTEOS  EQU   *                                                        19800020
         LH    RWORK8,PRFSIZE           GET TOTAL DATA SIZE             19900020
         N     RWORK8,AVTCLRHI                                          20000020
         LA    RWORK8,ONE(,RWORK8)      GET OFFSET TO LAST DATA         20100020
*                                         BYTE + 1                      20200020
         SR    RWORK8,RDATAD5           SUBTRACT NEW DATA OFFSET        20300020
         BZ    NORMCOMP                 ALL DATA PROCESSED, RETURN      20400020
         SPACE                                                          20500020
         BAL   R14,ENTERLOP             GET ADDRESS OF ITEM      S22025 20700022
         SPACE                                                          21000020
         SR    REX11,RDATAD5            GET DATA LEFT IN UNIT           21100020
         CR    RWORK8,REX11             IS IT LESS THAN TOTAL LEFT      21200020
         BNL   TRANTEST                 NO, DO TRT ON WHOLE UNIT        21300020
         SPACE                                                          21400020
         LR    REX11,RWORK8             YES, DO TRT ON DATA LEFT        21500020
         SPACE                                                          21600020
TRANTEST EQU   *                                                        21700020
         SR    RWORK2,RWORK2            CLEAR FOR HIT INSERT            21800020
         BCTR  REX11,AVTEZERO                                           21900020
         EX    REX11,TRTX               TRANSLATE-AND-TEST              22000020
         LA    REX11,ONE(,REX11)                                        22100020
         BNE   NORMHIT                  HIT, GO PROCESS                 22200020
         SPACE                                                          22300020
         BAL   R14,TESTSHIF             GO SHIFT DATA IF NEEDED         22400020
         L     R1,PRFLCB-1              GET LCB ADDRESS          S22025 22410022
         TM    LCBSTAT1-IEDQLCB(R1),LCBSENDN   SENDING           S22025 22420022
         BO    SEND1                    YES, NO EOB UPDATE       S22025 22430022
         MVC   PRFXTRA(3),AVTFZERO      CLEAR  FOR AF            S22025 22440022
SEND1    EQU   *                                                 S22025 22450022
         SPACE                                                          22500020
TRUNOUT  EQU   *                                                        22600020
         LH    RDATAD5,PRFDAT           GET CURRENT DATA OFFSET         22700020
         N     RDATAD5,AVTCLRHI                                         22800020
         AR    RDATAD5,REX11            ADD TRT LENGTH TO IT            22900020
         STH   RDATAD5,PRFDAT           STORE IT BACK                   23000020
         B     TESTEOS                  RE-ENTER TRT LOOP               23100020
         SPACE                                                          23200020
NORMCOMP EQU   *                                                        23300020
         SR    R15,R15                  SET GOOD RETURN CODE            23400020
         SPACE                                                          23500020
FINALSZE EQU   *                                                        23600020
         LH    R0,PRFSIZE               GET OLD DATA SIZE               23700020
         N     R0,AVTCLRHI                                              23800020
         SH    R0,PRFINS                SUBTRACT LEFT-OVER BYTES        23900020
         STH   R0,PRFSIZE               SET FINAL DATA SIZE             24000020
         SPACE 1                                                        24002022
CHKSIZE  EQU   *                                                 S22025 24004022
         SR    R1,R1                    (CLEAR FOR INSERT)              24007020
         L     RLCB4,PRFLCB-1           RELOAD LCB ADDRESS              24014020
         MVC   PRFKEY(2),KEYSAVE        RSTR LOCAL OPCODE BYTE  SA54948 24017022
         IC    R1,LCBISZE               PICK UP NO. OF RESERVES         24021020
         LA    R1,AVTTXTSZ+1(,R1)       ADD LNG OF TEXT PFX+1           24028020
         TM    PRFSTAT1,PRFNHDRN        IS THIS A HEADER BUFFER         24035020
         BO    TESTNONE                 NO, TEXT, SIZE IS RIGHT         24042020
         SPACE                                                          24049020
         LA    R1,AVTHDRSZ-AVTTXTSZ(,R1) YES, ADD EXTRA                 24056020
         SPACE                                                          24063020
TESTNONE EQU   *                                                        24070020
         CR    R1,R0                    AT LEAST ONE DATA BYTE?         24077020
         BNH   TESTINCL                 YES, BRANCH                     24084020
         SPACE                                                          24091020
         STH   R1,PRFSIZE               INDICATE ONE DATA BYTE          24098020
         SPACE                                                          24105020
TESTINCL EQU   *                                                        24112020
         L     RBASE,AVTUI              GET RET INTERFACE ADDR   S22025 24500022
         B     FOUR(RBASE)              BRANCH TO RETURN ROUTINE S22025 24600022
         EJECT                                                          24700020
NORMHIT  EQU   *                                                        24800020
         LA    R1,AVTEZERO(,R1)         CLEAR HIGH-ORDER BYTE           24900020
         SR    R1,RDATAD5               GET NO. TRANS BYTES - 1         25000020
         BZ    SETOFF                   HIT ON FIRST, DON'T SHIFT       25100020
         SPACE                                                          25200020
         LR    REX11,R1                 SET SHIFT LENGTH                25300020
         BAL   R14,TESTSHIF             GO SHIFT DATA IF NEEDED         25400020
         L     R1,PRFLCB-1              GET LCB ADDRESS          S22025 25410022
         TM    LCBSTAT1-IEDQLCB(R1),LCBSENDN   SENDING           S22025 25420022
         BO    SEND                     YES, NO EOB UPDATE       S22025 25430022
         MVC   PRFXTRA(3),AVTFZERO      CLEAR  FOR AF            S22025 25440022
         OI    PRFTQBCK+TWO,BFREDIT     INDICATE DATA MOVEMENT   S22025 25445022
SEND     EQU   *                                                 S22025 25450022
         SPACE                                                          25500020
         LH    RDATAD5,PRFDAT           GET OLD DATA OFFSET             25600020
         LA    RDATAD5,AVTEZERO(REX11,RDATAD5) ADD SHIFT LENGTH         25700020
         STH   RDATAD5,PRFDAT           STORE IT BACK                   25800020
         B     FROMCHAR                 GO SCAN FOR 'FROM' CHARS        25900020
         SPACE                                                          26000020
SETOFF   EQU   *                                                        26100020
         LH    RDATAD5,PRFDAT           RESET DATA OFFSET               26200020
         N     RDATAD5,AVTCLRHI                                         26300020
         SPACE                                                          26400020
FROMCHAR EQU   *                                                        26500020
         LA    RHIT10,AVTEZERO(RWORK2,RPARM7) GET SUB-PARAM LIST        26600020
         L     RSTRING4,PARMCHAR        GET CHAR TABLE ADDRESS          26700020
         LH    RWORK8,SBPMFROM          GET OFFSET TO FROM CHARS        26800020
         N     RWORK8,AVTCLRHI                                          26900020
         IC    R0,AVTEZERO(RWORK8,RSTRING4) GET LENGTH OF STRING        27000020
         LA    RSTRING4,ONE(RWORK8,RSTRING4) POINT TO 1ST CHAR          27100020
         LR    RWORK8,R0                SAVE LENGTH OF STRING    S22025 27200022
         TM    AVTEZERO(RPARM7),NOBLANKN CHECK FOR BLANKS        S22025 27300022
         BO    NOTBLK                   NO                       S22025 27400022
         SR    RWORK2,RWORK2            YES                      S22025 27500022
         IC    RWORK2,BLNKCHAR(RPARM7)  OBTAIN BLANK CHAR        S22025 27600022
         B     SCANLINK                 KEEP IT                  S22025 27660022
*                                                                S22025 27720022
NOTBLK   EQU   *                                                 S22025 27800022
         LNR   RWORK2,RWORK2            INDICATE NO BLANKS       S22025 27900022
SCANLINK EQU   *                                                 S22025 28000022
         LR    R0,RSTRING4              ADDR OF CHARACTERS       S22025 28100022
         LH    R1,PRFDAT                OFFSET IN BUFFER         S22025 28200022
         N     R1,AVTCLRHI              CLEAR HI HALF OF REG     S22025 28300022
         BCTR  R1,R0                    DECREMENT BY ONE         S22025 28400022
         STH   R1,PRFKEY                SAVE OFFSET TO AT STRING S22025 28500022
         SLL   RWORK8,TFOUR             TO PUT COUNT IN HI BYTE  S22025 28600022
         AR    R1,RWORK8                LENGTH AND BUF OFF IN R1 S22025 28700022
         SRL   RWORK8,TFOUR             TO PUT COUNT IN LO BYTE  S22025 28800022
         L     R15,AVTAL                GET ADDR OF SCAN ROUTINE S22025 28900022
         BALR  R14,R15                  LINK TO SCAN ROUTINE     S22025 29000022
         TM    PARMAO,INBLK             IS IT INBLK              S22025 29002022
         BZ    SKPINBLK                 NO                       S22025 29004022
         LH    R1,PARMAF                GET AO AND AF INDEX      S22025 29006022
         STH   R1,AVTPARM+2             STORE IN AVTPARM         S22025 29008022
SKPINBLK EQU   *                        CHECK FOUND              S22025 29010022
         LTR   R15,R15                  HOW MANY CHARS FOUND     S22025 29012022
         BZ    THROBACK                 NO CHAR FOUND            S22025 29014022
         L     R1,PRFLCB-1              GET LCB ADDRESS          S22025 29014122
         TM    LCBSTAT1-IEDQLCB(R1),LCBSENDN SEND OPERATION      S22025 29014222
         BO    PARML                    YES, DON'T UPDATE EOBOFF S22025 29014322
         LR    R1,R0                    GET OFFSET AFTER FROM    S22025 29014422
         LA    R1,ONE(,R1)              ADD ONE                  S22025 29014522
         SH    R1,PRFDAT                SUBTRACT OFFSET TO 'FROM'S22025 29014622
         AH    R1,PRFXTRA+1             ADD TO TOTAL             S22025 29014722
         STH   R1,PRFXTRA+1             SAVE LENGTH TO DELETE    S22025 29014822
         MVC   PRFXTRA(1),SBPMSTAT      SET STATUS               S22025 29014922
PARML    EQU   *                                                 S22025 29015022
         CR    R15,RWORK8               WAS CHAR STRING FOUND    S22025 29016022
         BE    FOUNDEQU                 YES                      S22025 29018022
         TM    PARMAO,INBLK             IS INBLOCK SUBGROUP USED S22025 29020022
         BZ    THROBACK                 NO                       S22025 29022022
         TM    PRFSTAT1,PRFNLSTN        LAST                     S22025 29022622
         BNO   THROBACK                 YES                      S22025 29023222
BNLINK   EQU   *                                                 S22025 29024022
         LH    RWORK8,PRFKEY            GET DATA OFFSET          S22025 29024622
BNLINK1  EQU   *                                                 S22025 29025222
         LA    RPARM7,AVTEZERO(RPARM7)                           S22025 29026122
         LA    RWORK2,FOUR              TO ACCESS HOLD Q         S22025 29027022
         SR    RPARM7,RWORK2            GET ADDR OF HOLD Q       S22025 29027922
         MVC   PRFKEY+2(2),PRFINS       SAVE THE DATA OFFSET     S22025 29028822
         CLC   AVTADBUF+1(3),SCBDEOB+1  LAST GOOD EOB IN BUFFER  S22025 29029722
         BNE   BNLINK2                  NO, PUT DATA ON HOLD Q   S22025 29030622
         SPACE 1                                                 S22025 29031522
         LR    RWORK2,RWORK8            GET DATA OFFSET          S22025 29032422
         SH    RWORK2,PRFINS            SUBTRACT LOGICAL GARBAGE S22025 29033322
         CH    RWORK2,SCBEOB            EOB IN DATA TO HOLD      S22025 29034222
         BNH   THROBACK                 YES, DON'T HOLD DATA     S22025 29035122
BNLINK2  EQU   *                                                 S22025 29036022
         LA    RWORK8,ONE(RWORK8)       INCREMENT BY ONE         S22025 29038022
         ST    RWORK8,PRFINS            SET DATOFF,ZERO INSOFF   S22025 29040022
         IC    R15,AVTPARM+3            GET AO INDEX             S22025 29042022
         STC   R15,AVTPARM              SET INDEX FOR AO         S22025 29044022
         OI    AVTPARM,ONE              INDICATE DIRECT RETURN   S22025 29046022
         MVI   AVTPARM3,AVTEFF          INDICATE UNIT NEEDED     S22025 29048022
         MVI   AVTPARM+1,AVTEZERO       INDICATE DATA=CHARS      S22025 29050022
         LA    R1,AVTPARM               LINK TO                  S22025 29052022
         L     R15,AVTUI                AO TO GET                S22025 29054022
         BALR  R14,R15                  UNIT                     S22025 29056022
         LTR   R15,R15                  OUT OF UNITS             S22025 29056622
         BNZ   NOUNIT                   YES, GET OUT             S22025 29057222
         LH    RWORK8,PRFDAT            OBTAIN DATA OFFSET       S22025 29058022
         N     RWORK8,AVTCLRHI          CLEAR HALF               S22025 29060022
         BCTR  RWORK8,AVTEZERO          POINT TO LAST CHAR       S22025 29062022
         LH    RDATAD5,PRFSIZE          GET PREFIX SIZE          S22025 29064022
         N     RDATAD5,AVTCLRHI         CLEAR HALF               S22025 29066022
         SR    RDATAD5,RWORK8           GET AT CHAR LENGTH       S22025 29068022
         STH   RDATAD5,PRFKEY           SAVE AT CHAR LENGTH      S22025 29070022
         SH    RWORK8,PRFINS            FINAL SIZE               S22025 29072022
         LR    REX11,RWORK8             SAVE TRUE SIZE           S22025 29072322
         SH    RWORK8,PRFKEY+2          SUBTRACT THE DATA OFFSET S22025 29072622
         STH   RWORK8,PRFSIZE           SET SIZE                 S22025 29072822
         LR    RWORK8,REX11             RESET TRUE SIZE          S22025 29073822
UNITSCAN EQU   *                        TO FIND THE UNIT         S22025 29076022
         CH    RWORK8,AVTKEYLE          END OF DATA IN THIS UNIT S22025 29078022
         BNH   QMANIP                   YES                      S22025 29080022
         SH    RWORK8,AVTKEYLE          OBTAIN NEXT              S22025 29082022
         B     UNITSCAN                 UNIT                     S22025 29084022
*                                                                S22025 29085022
QMANIP   EQU   *                                                 S22025 29086022
         L     RWORK2,PRFLCB-1          LCB ADDRESS              S22025 29088022
         L     RWORK2,LCBDCBPT-IEDQLCB(,RWORK2)  DCB ADDRESS     S22025 29090022
         SR    R0,R0                    INITIALIZE REGISTER      S22025 29092022
         IC    R0,DCBRESER+1-IHADCB(,RWORK2) NO OF TEXT IDLES    S22025 29094022
         LR    RWORK2,R0                SAVE NUMBER OF IDLES     S22025 29096022
         LA    RWORK2,AVTTXTSZ(,RWORK2) TEXT PREFIX SIZE         S22025 29098022
GETUNIT  EQU   *                                                 S22025 29106022
         SR    R0,R0                    CLEAR                    S22025 29108022
         STH   R0,PRFINS                ZERO SPACE AVAILABLE     S22025 29110022
         LA    R1,AVTPARM               LINK TO                  S22025 29112022
         L     R15,AVTUI                AO TO GET                S22025 29114022
         BALR  R14,R15                  UNIT                     S22025 29116022
         LTR   R15,R15                  OUT OF UNITS             S22025 29116622
         BNZ   NOUNIT                   YES, GET OUT             S22025 29117222
         LH    R15,PRFSIZE              GET SIZE OF UNIT         S22025 29118022
         N     R15,AVTCLRHI             CLEAR                    S22025 29120022
         SH    R15,AVTKEYLE             GET CORRECT SIZE         S22025 29122022
         STH   R15,PRFSIZE              STORE                    S22025 29124022
         AH    RWORK8,AVTKEYLE          ADJUST DATA OFFSET       S22025 29128022
BLDPRF   EQU   *                                                 S22025 29130022
         L     RLCB4,PRFLCB-1           GET LCB ADDRESS          S22025 29132022
         SR    R15,R15                  CLEAR                    S22025 29134022
         IC    R15,PRFNBUNT             GET TOTAL NUMBER OF UNITSS22025 29136022
         SR    R0,R0                    CLEAR                    S22025 29138022
         LR    R1,REX11                 GET TRUE SIZE            S22025 29139022
         N     R1,AVTCLRHI              CLEAR FOR DIVIDE         S22025 29140022
         LH    R14,AVTKEYLE             GET UNIT SIZE            S22025 29142022
         DR    R0,R14                   GET NUMBER OF FULL UNITS S22025 29144022
         LTR   R0,R0                    ANY PARTIALLY FILLED     S22025 29146022
         BZ    SETUNITS                 NO                       S22025 29148022
         LA    R1,ONE(,R1)              ADD ONE                  S22025 29150022
SETUNITS EQU   *                        PUT NUMBER OF UNITS IN   S22025 29152022
         STC   R1,PRFNBUNT              IN ORIGINAL BUFFER       S22025 29154022
         SR    R15,R1                   GET NUMBER IN NEW        S22025 29156022
         LR    RDATAD5,RPREFIX          GET FIRST UNIT           S22025 29158022
BLOOP    EQU   *                                                 S22025 29160022
         L     RDATAD5,PRFTIC-IEDQPRF(,RDATAD5)  GET UNIT        S22025 29162022
         BCT   R1,BLOOP                 FIND CORRECT UNIT        S22025 29164022
         MVC   MVOFF(LEN,RDATAD5),MVOFF(RPREFIX) MOVE PREFIX     S22025 29168022
         L     RLCB4,AVTADBUF           SAVE OLD BUF ADDRESS     S22025 29170022
         ST    RDATAD5,AVTADBUF         SET UP NEW BUF ADDRESS   S22025 29172022
         LR    RPREFIX,RDATAD5          SET BASE TO NEW BUFFER   S22025 29174022
         STC   R15,PRFNBUNT             SET NO UNITS NEW BUF     S22025 29176022
         LA    R15,ONE(,RWORK8)         DATA OFFSET PLUS ONE     S22025 29178022
         STH   R15,PRFDAT               DATA OFFSET              S22025 29180022
         BCTR  R15,R0                   SUBT ONE FROM OFFSET     S22025 29182022
         SR    R15,RWORK2               CALCULATE AVAILABLE SPACES22025 29184022
         STH   R15,PRFINS               SPACE AVAILABLE          S22025 29186022
         OI    PRFSTAT1,PRFNHDRN        INSURE TEXT BUFFER       S22025 29188022
         OI    PRFTQBCK+TWO,BFREDIT     INDICATE DATA MOVEMENT   S22025 29189022
         STH   RWORK2,PRFSCAN           SCAN PAST PRFIX AND RES  S22025 29190022
         LH    RWORK2,PRFKEY-IEDQPRF(,RLCB4) GET AT CHAR LENGTH  S22025 29192022
         AR    RWORK8,RWORK2            GET SIZE                 S22025 29194022
         STH   RWORK8,PRFSIZE           STORE SIZE               S22025 29196022
         LR    RWORK8,RWORK2            SET UP REG 8 FOR AF      S22025 29198022
         IC    R15,AVTPARM+2            AF INDEX                 S22025 29200022
         LA    R15,ONE(R15)             SHIFT DATA FUNCTION      S22025 29202022
         STC   R15,AVTPARM              PUT INDEX IN PARM LIST CES22025 29204022
         MVI   AVTPARM+1,AVTEZERO       INDICATE DATA IA CHAR    S22025 29206022
         LA    R1,AVTPARM               POINT TO PARAMETER LISTCES22025 29208022
         L     R15,AVTUI                GET INTERFACE ROUTINE    S22025 29210022
         BALR  R14,R15                  GO TO AF                 S22025 29212022
         LH    RWORK2,PRFSIZE           GET SIZE SPACE AVAIL     S22025 29214022
         SH    RWORK2,PRFINS            SUBTRACT SPACE AVAILABLE S22025 29216022
         STH   RWORK2,PRFSIZE           STORE CORRECT SIZE       S22025 29218022
         LH    R14,AVTHA2               GET TIC ADDR FOR LAST UNIS22025 29220022
         SR    R15,R15                  CLEAR                    S22025 29222022
         IC    R15,PRFNBUNT             NO UNITS IN NEW BUF      S22025 29224022
         B     GETLAST                  CHECK FOR LAST           S22025 29228022
         SPACE 1                                                 S22025 29228422
NOUNIT   EQU   *                                                 S22025 29228822
         MVC   PRFINS(2),PRFKEY+2       RESET SPACE AVAILABLE    S22025 29229222
         LH    RWORK8,PRFSIZE           GET SIZE                 S22025 29229622
         N     RWORK8,AVTCLRHI          CLEAR                    S22025 29230022
         LA    RWORK8,ONE(,RWORK8)      BUMP ONE                 S22025 29230422
         SH    RWORK8,PRFDAT            GET MOVE LENGTH          S22025 29230822
         LA    RPARM7,FOUR(,RPARM7)     GET  PARM LIST           S22025 29231022
         L     RLCB4,PRFLCB-1           RESET LCB BASE           S22025 29231222
         LA    R14,FINALSZE             SET RETURN POINT         S22025 29231422
         B     CLEARUP                  CLOSE BUFFER             S22025 29231622
ONEUNIT  EQU   *                                                 S22025 29232022
         L     RDATAD5,PRFTIC-IEDQPRF(,RDATAD5) GET NEXT         S22025 29232522
GETLAST  EQU   *                        FIND LAST UNIT           S22025 29233022
         BCT   R15,ONEUNIT              FOUND                    S22025 29233522
         ST    R14,PRFTIC-IEDQPRF(,RDATAD5)  INVALID TIC ADDR    S22025 29234022
         MVI   PRFTIC-IEDQPRF(RDATAD5),EIGHT SET TIC FLAG        S22025 29236022
         LR    RDATAD5,RPREFIX          POINT TO FIRST UNIT      S22025 29238022
         L     R14,PRFLCB-ONE-IEDQPRF(RDATAD5) SET UP LCB ADDR @SA70224 29238656
         MVC   LCBSCB(3,RDATAD5),LCBSCBA-IEDQLCB(R14)  SCB ADDR@SA74031 29239210
         LR    RPREFIX,RLCB4            RESTORE ORIGINAL BUFFER  S22025 29240022
         ST    RPREFIX,AVTADBUF         IN AVT                   S22025 29242022
         NC    ONE(THREE,RPARM7),ONE(RPARM7)  IS Q EMPTY         S22025 29244022
         BZ    NOBUFS                   YES                      S22025 29246022
         L     RWORK8,AVTEZERO(RPARM7)  NO GET NEXT BUFFER ADDR  S22025 29248022
LOOP1    EQU   *                                                 S22025 29250022
         NC    FIVE(THREE,RWORK8),FIVE(RWORK8) IS THIS LAST ON Q S22025 29252022
         BZ    QLINK                    YES LINK IN NEW BUF      S22025 29254022
         L     RWORK8,FOUR(RWORK8)      NO GET NEXT BUF ADDR     S22025 29256022
         B     LOOP1                    GET NEXT BUF ADDR        S22025 29258022
QLINK    EQU   *                                                 S22025 29260022
         ST    RDATAD5,FOUR(RWORK8)     LINK BUF IN Q            S22025 29262022
         B     LASTBUF                  INDICATE LAST BUFFER     S22025 29264022
NOBUFS   EQU   *                                                 S22025 29266022
         ST    RDATAD5,AVTEZERO(RPARM7) PUT BUFFER ON Q          S22025 29268022
LASTBUF  EQU   *                                                SA68683 29269005
         MVC   FIVE(THREE,RDATAD5),AVTFZERO  CLEAR LINK FIELD    S22025 29270022
         LH    R0,PRFSIZE               GET PRFISIZE AND CHECK   S22025 29372022
         B     CHKSIZE                  FOR NO DATA LEFT IN BUFF S22025 29472022
         EJECT                                                          29800020
CLEAR    EQU   *                                                        29900020
         SR    R15,R15                  CLEAR 'FROM'                    30000020
         LR    R0,R15                     BYTE FROM                     30100020
         IC    R15,AVTDOUBL                 TRANSLATE                   30200020
         STC   R0,TRANTAB(R15)                TABLE                     30300020
         SPACE                                                          30400020
THROBACK EQU   *                                                        30500020
         LH    RWORK8,PRFDAT            GET OLD DATA OFFSET             30600020
         N     RWORK8,AVTCLRHI                                          30700020
         LR    RDATAD5,RWORK8           SET INPUT FOR IEDQAL            30800020
         SH    RDATAD5,PRFINS           GET TRUE INSERT OFFSET          30900020
         BAL   R14,ENTERLOP             GET ADDRESS OF ITEM      S22025 31000022
         SPACE                                                          31200020
         IC    R15,AVTDOUBL             MOVE HIT BYTE                   31300020
         STC   R15,AVTEZERO(,RDATAD5)     BACK TO INSERT POINT          31400020
         SPACE                                                          31500020
PASSNORM EQU   *                                                        31600020
         LA    RDATAD5,ONE(,RWORK8)     BUMP PAST HIT BYTE              31700020
         STH   RDATAD5,PRFDAT           STORE IT BACK                   31800020
         B     TESTEOS                  RE-ENTER TRT LOOP               31900020
         SPACE 3                                                        32000020
CLERFROM EQU   *                                                        32100020
         LH    RWORK8,SBPMFROM          GET OFFSET TO FROM STRING       32200020
         N     RWORK8,AVTCLRHI                                          32300020
         L     RSTRING4,PARMCHAR        GET CHARS TABLE ADDRESS         32400020
         SR    R15,R15                                                  32500020
         IC    R15,ONE(RWORK8,RSTRING4) PICK UP 1ST BYTE FROM           32600020
*                                         STRING                        32700020
         STC   R15,AVTDOUBL             SAVE IT IN AVT WORK AREA        32800020
         B     CLEAR                    GO CLEAR 'FROM' BYTE            32900020
         EJECT                                                          33000020
FOUNDEQU EQU   *                                                        33100020
         LR    RWORK8,R0                NEXT CHAR FOR SCAN       S22025 33120022
         LA    RWORK8,ONE(,RWORK8)      BUMP OFFSET              S22025 33140022
         L     RWORK2,PARMCHAR          RESTORE ADDR OF CHAR TABLS22025 33180022
         SPACE                                                          33400020
TESTREM  EQU   *                                                        33500020
         TM    SBPMSTAT,TOCHAR+TOOFFS+TOEXTN REMOVE FUNCTION            33600020
         BNZ   XREMOVE                  YES, GO PROCESS                 33700020
         SPACE                                                          33800020
         LA    R14,INSERT               SET RETURN TO INSERT            33900020
         SPACE                                                          34000020
TSTFINCL EQU   *                                                        34100020
         LH    RDATAD5,PRFDAT           GET OFFSET TO START             34200020
         N     RDATAD5,AVTCLRHI           OF FROM STRING                34300020
         SR    RWORK8,RDATAD5           GET LNG OF FROM STRING          34600020
         SPACE                                                          34700020
         TM    SBPMSTAT,FROMINCL        FROM STRING TO BE REMOVED       34800020
         BO    FROMREM                  YES, GO UPDATE OFFSETS          34900020
         SPACE                                                          35000020
         CLI   PRFINS+1,AVTEZERO        ANY EMPTY BYTES                 35100020
         BE    UPDATOFF                 NO, NO SHIFT NEEDED, BRANCH     35200020
         SPACE 1                                                 S22025 35230022
CLEARUP  EQU   *                                                 S22025 35260022
         SPACE                                                          35300020
         IC    R1,PARMAF                YES, GET IEDQAF INDEX           35400020
         LA    R1,SHIFFLAG(,R1)         REQUEST MULTI-UNIT SHIFT        35500020
         B     DOUBSHIF                 GO SHIFT STRING AND RETURN      35600020
         SPACE                                                          35700020
FROMREM  EQU   *                                                        35800020
         LR    R0,RWORK8                UPDATE INSERT                   35900020
         AH    R0,PRFINS                  OFFSET BY                     36000020
         STH   R0,PRFINS                  STRING LENGTH                 36100020
         SPACE                                                          36200020
UPDATOFF EQU   *                                                        36300020
         LA    RDATAD5,AVTEZERO(RWORK8,RDATAD5) UPDATE DATA OFFSET      36400020
         STH   RDATAD5,PRFDAT             BY LENGTH OF FROM STRING      36500020
         BR    R14                      RETURN TO CALLER                36600020
         EJECT                                                          36700020
INSERT   EQU   *                                                        36800020
         TM    SBPMSTAT,DATAIDCT        IS DATA IDLES                   36900020
         BO    INSIDLE                  YES, GO INSERT IDLES            37000020
         SPACE                                                          37100020
INSDATA  EQU   *                                                        37200020
         L     RSTRING4,PARMCHAR        NO, GET CHAR TABLE ADDRESS      37300020
         LH    RDATAD5,SBPMDATA         GET OFFSET TO DATA CHARS        37400020
         N     RDATAD5,AVTCLRHI                                         37500020
         IC    REX11,AVTEZERO(RDATAD5,RSTRING4) GET LENGTH OF DATA      37600020
         LA    RSTRING4,ONE(RDATAD5,RSTRING4) GET ADDRESS OF DATA       37700020
         ST    RSTRING4,AVTPARM3        SET IN PARAMETER AREA           37800020
         STC   REX11,AVTPARM3           SET LNG IN PARAMETER AREA       37900020
         SR    R0,R0                    SET DATA TYPE = CHARS           38000020
         B     INSERT3                  GO BUILD AO PARAM LIST          38100020
         SPACE                                                          38200020
INSIDLE  EQU   *                                                        38300020
         LH    R0,SBPMDATA              PICK UP IDLES CT & CHAR         38400020
         STH   R0,AVTPARM3              PUT IN PARAMETER AREA           38500020
         LA    R0,IDLEFLAG              SET DATA TYPE = IDLES           38600020
         SPACE                                                          38700020
INSERT3  EQU   *                                                        38800020
         STC   R0,AVTPARM+1             SET DATA TYPE                   38900020
         IC    R0,PARMAO                PICK UP IEDQAO INDEX            39000020
         STC   R0,AVTPARM               SET IN PARM LIST                39100020
         IC    R0,PARMAF                PICK UP IEDQAF INDEX            39200020
         STC   R0,AVTPARM+2             SET IN PARM LIST                39300020
         LA    R1,AVTPARM               POINT TO IEDQAO'S PARM LIST     39400020
         L     R15,AVTUI                GET USER INTERFACE ADDRESS      39600020
         BALR  R14,R15                  LINK TO INSERT DATA             39700020
         SPACE                                                          39800020
         LH    RDATAD5,PRFDAT           REINITIALIZE                    39900020
         N     RDATAD5,AVTCLRHI           DATA OFFSET REGISTER          40000020
         L     R1,PRFLCB-1              GET LCB ADDRESS          S22025 40010022
         TM    LCBSTAT1-IEDQLCB(R1),LCBSENDN SEND OPERATION      S22025 40020022
         BO    PARMM                    YES, DON'T UPDATE EOBOFF S22025 40030022
         MVC   PRFXTRA(3),AVTFZERO      CLEAR FOR SCBEOB UPDTE   S22025 40040022
         OI    PRFTQBCK+TWO,BFREDIT     INDICATE DATA MOVEMENT   S22025 40045022
PARMM    EQU   *                                                 S22025 40050022
         LTR   R15,R15                  TEST RETURN                     40100020
         BZ    TESTEOS                  GOOD, RE-ENTER TRT LOOP         40200020
         SPACE                                                          40300020
NOMORE   EQU   *                                                        40400020
         CLI   PRFINS+1,AVTEZERO        ANY LOGICAL GARBAGE LEFT        40500020
         BE    FINALSZE                 NO, BYPASS CLOSEUP              40600020
         SPACE                                                          40700020
         LH    RWORK8,PRFSIZE           PICK UP TOTAL DATA SIZE         40800020
         N     RWORK8,AVTCLRHI                                          40900020
         LA    RWORK8,ONE(,RWORK8)      POINT BEYOND DATA               41000020
         SR    RWORK8,RDATAD5           SET LIMIT REG = RESIDUAL CT     41100020
         SPACE                                                          41200020
         IC    R1,PARMAF                PICK UP IEDQAF INDEX            41300020
         LA    R1,SHIFFLAG(,R1)         REQUEST MULTIPLE SHIFT          41400020
         BAL   R14,DOUBSHIF             GO CLOSE UP BUFFER              41500020
         SPACE                                                          41600020
         LA    R15,AVTECD4              SET ERROR RETURN CODE           41700020
         B     FINALSZE                 GO SET FINAL SIZE               41800020
         EJECT                                                          41900020
XREMOVE  EQU   *                                                        42000020
         STH   RWORK8,PRFKEY+2          SAVE START OF DELETE DATA       42050020
         TM    SBPMSTAT,TOCHAR          IS TO A CHARACTER STRING        42100020
         BNO   XREMOVE2                 NO, TEST AGAIN                  42200020
*                                                                S22025 42300022
         LH    RSTRING4,SBPMTO          GET OFFSET TO TO CHARS          42400020
         N     RSTRING4,AVTCLRHI                                        42500020
         L     RWORK8,PARMCHAR          GET CHARS TABLE OFFSET          42600020
         LA    RSTRING4,AVTEZERO(RSTRING4,RWORK8) GET TO CHARS ADDR     42700020
         TM    AVTEZERO(RPARM7),NOBLANKN  CHECK FOR BLANKS       S22025 42790022
         BO    FIXBLNK                  NO                       S22025 42880022
         SR    RWORK2,RWORK2            CLEAR REGISTER           S22025 42970022
         IC    RWORK2,BLNKCHAR(RPARM7)  GET BLANK CHAR           S22025 43060022
         B     LINKSCAN                 KEEP IT POSITIVE         S22025 43150022
FIXBLNK  EQU   *                                                 S22025 43240022
         LNR   RWORK2,RWORK2            INDICATE NO BLANKS       S22025 43330022
LINKSCAN EQU   *                                                 S22025 43420022
         IC    RWORK8,AVTEZERO(RSTRING4) GET LENGTH OF STRING    S22025 43510022
         LA    R1,ONE(,RSTRING4)        GET ADDR OF CHAR STRING  S22025 43600022
         SLL   RWORK8,TFOUR             TO PUT COUNT IN HI BYTE  S22025 43690022
         AR    R0,RWORK8                SET UP REG FOR AX        S22025 43780022
         SRL   RWORK8,TFOUR             SET REG FOR COMPARE      S22025 43870022
         L     R15,AVTAX                GET ADDR OF SCAN ROUTINE S22025 43960022
         BALR  R14,R15                  LINK TO SCAN ROUTINE     S22025 44050022
         SPACE                                                          44300020
         CR    R15,RWORK8               WAS CHAR STRING FOUND    S22025 44810022
         BE    TOFOUND                  YES                      S22025 44820022
         TM    PARMAO,INBLK             IN INBLOCK GROUP         S22025 44830022
         BZ    CLERFROM                 NO CHAR STRING FOUND     S22025 44840022
         TM    PRFSTAT1,PRFNLSTN        LAST                     S22025 44843022
         BNO   CLERFROM                 YES                      S22025 44846022
         B     BNLINK                   PUT ON HOLD QUEUE        S22025 44856022
TOFOUND  EQU   *                                                 S22025 44870022
         SPACE                                                          44900020
         LH    RWORK8,PRFKEY+2          GET OFFSET TO START OF          44930020
         N     RWORK8,AVTCLRHI           DELETE DATA                    44960020
         LR    R15,R0                   FOUND,SAVE OFFSET TO     S22025 45030022
         STH   R15,PRFKEY+2               RESTART OF DATA               45100020
         BAL   R14,TSTFINCL             GO HANDLE FROM STRING           45200020
         SPACE                                                          45300020
         LH    R15,PRFKEY+2             RESTORE OFFSET TO               45400020
         LA    R15,ONE(,R15)            FOR DATA OFFSET          S22025 45450022
         N     R15,AVTCLRHI               RESTART OF DATA               45500020
*        B     XREMFIND                 PROCEED                         45600020
         EJECT                                                          45700020
XREMFIND EQU   *                                                        45800020
         TM    SBPMSTAT,TOINCL          IS TO INCLUDED IN FUNC          45900020
         BO    UPINSOFF                 YES, R15 IS CORRECT AS IS       46000020
         SPACE                                                          46100020
         LA    R15,ONE(,RWORK2)         POINT TO START           S22025 46300022
         SPACE                                                          46500020
UPINSOFF EQU   *                                                        46600020
         LR    RDATAD5,R15              SET NEW DATA OFFSET             46700020
         LH    R0,PRFDAT                GET OLD DATA OFFSET             46800020
         N     R0,AVTCLRHI                                              46900020
         SR    R15,R0                   GET LENGTH OF NEW GARBAGE       47000020
         L     R1,PRFLCB-1              GET ADDRESS OF LCB       S22025 47010022
         TM    LCBSTAT1-IEDQLCB(R1),LCBSENDN INPUT OPERATION     S22025 47020022
         BO    NOUPDATE                 YES                      S22025 47030022
         LR    R0,R15                   OBTAIN REMOVE LENGTH     S22025 47040022
         AH    R0,PRFXTRA+1             INCREMENT COUNT          S22025 47050022
         STH   R0,PRFXTRA+1             STORE COUNT              S22025 47060022
NOUPDATE EQU   *                                                        47070022
         AH    R15,PRFINS               ADD TO NO. AVAIL BYTES          47100020
         STH   R15,PRFINS               STORE IT BACK                   47200020
         STH   RDATAD5,PRFDAT           STORE NEW DATA OFFSET           47300020
         SPACE                                                          47400020
         TM    SBPMSTAT,DATACONT        IS FUNCTION CONTRACT            47500020
         BO    TESTEOS                  YES, RE-ENTER TRT LOOP          47600020
         B     INSERT                   NO, GO INSERT                   47700020
         SPACE                                                          47800020
XREMOVE2 EQU   *                                                        47900020
         BAL   R14,TSTFINCL             GO HANDLE FROM STRING           48000020
         SPACE                                                          48100020
         LH    R14,PRFDAT               PICK UP DATA OFFSET             48200020
         N     R14,AVTCLRHI                                             48300020
         LH    R15,SBPMTO               PICK UP EXTENT                  48400020
         N     R15,AVTCLRHI                                             48500020
         AR    R15,R14                  ADD TO GET TO OFFSET            48600020
         LH    R14,PRFSIZE              PICK UP                         48610020
         N     R14,AVTCLRHI               TOTAL SIZE                    48620020
         CR    R15,R14                  IS NEW OFFSET BEYOND END        48630020
         BNH   UPINSOFF                 NO, GO COMPUTE NEW PRFINS       48640020
         SPACE                                                          48650020
         LA    R15,ONE(,R14)            YES, MAKE IT COME OUT EVEN      48660020
         B     UPINSOFF                 GO COMPUTE NEW PRFINS           48700020
         EJECT                                                          48800020
TESTSHIF EQU   *                                                        48900020
         LH    R0,PRFINS                PICK UP NO. AVAIL BYTES         49000020
         LTR   R0,R0                    ARE THERE ANY                   49100020
         BCR   CCZERO,R14               NO, NO SHIFT NEEDED, RETURN     49200020
         SPACE                                                          49300020
         ST    RDATAD5,AVTPARM3         SET INSERT ADDRESS              49400020
         STC   REX11,AVTPARM3           SET INSERT LENGTH               49500020
         MVI   AVTPARM+1,AVTEZERO       SET DATA TYPE = CHARS           49600020
         SPACE                                                          49700020
         IC    R1,PARMAF                PICK UP IEDQAF OFFSET           49800020
         LA    R1,SHIFUNIT(,R1)         REQUEST ONE-UNIT SHIFT          49900020
         SPACE                                                          50000020
DOUBSHIF EQU   *                                                        50100020
         STC   R1,AVTPARM               SET IN PARAMETER LIST           50200020
         LA    R1,AVTPARM               GET PARAM LIST ADDR             50300020
         L     R15,AVTUI                GET USER INTERFACE ADDRESS      50500020
         BR    R15                      LINK TO INSERT OR SHIFT         50600020
ENTERLOP EQU   *                                                 S22025 50607022
         LH    REOUAD,AVTKEYLE          GET KEY LENGTH           S22025 50614022
         LR    RWORK2,RPREFIX           LOAD BUFFER ADDR         S22025 50621022
         B     FINDUNIT                 BR TO GET UNIT ADDR      S22025 50628022
ADDRLOOP EQU   *                                                 S22025 50635022
         L     RWORK2,PRFTIC-IEDQPRF(RWORK2) PT TO NEXT UNIT     S22025 50642022
         SR    RSCAN,REOUAD             SUBT NO OF BYTES PASSED  S22025 50649022
FINDUNIT EQU   *                                                 S22025 50656022
         CR    RSCAN,REOUAD             IS ITEM IN THIS UNIT     S22025 50663022
         BH    ADDRLOOP                 NO, TEST NEXT UNIT       S22025 50670022
         LA    RSCAN,AVTUMALN-1(RSCAN,RWORK2) YES, UNIT ADDR     S22025 50677022
         LA    REOUAD,AVTUMALN(RWORK2,REOUAD) END OF UNIT ADDR   S22025 50684022
         BR    R14                      RETURN TO CALLER         S22025 50691022
         SPACE                                                          50700020
********* EXECUTED INSTRUCTIONS *********                               50800020
         SPACE                                                          50900020
CLCX     CLC   AVTDOUBL(ONE),ONE(RSTRING4)                              51000020
         SPACE                                                          51100020
TRTX     TRT   AVTEZERO(ONE,RDATAD5),TRANTAB                            51200020
         SPACE                                                          51300020
         SPACE                                                          51500020
         SPACE                                                          51900020
         SPACE                                                          52100020
         SPACE                                                          52400020
********* TRANSLATE TABLE *********                                     52500020
         SPACE                                                          52600020
TRANTAB  DC    256X'00'                                                 52700020
KEYSAVE  DC    H'0'                     OPCODE SAVEAREA         SA54948 52750022
         EJECT                                                          52800020
********* DSECTS *********                                              52900020
         SPACE                                                          53000020
IEDQPARM DSECT                                                          53100020
         SPACE                                                          53200020
PARMAN   DS    XL1                      IEDQAN INDEX                    53300020
PARMLEN  DS    XL1                      PARAMETER LIST LENGTH           53400020
PARMAF   DS    XL1                      IEDQAF INDEX                    53500020
PARMAO   DS    XL1                      IEDQAO INDEX                    53600020
PARMAJ   DS    XL1                      IEDQAJ INDEX                    53700020
PARMBLNK DS    XL1                      BLANK CHARACTER                 53800020
PARMENTS DS    XL1                      NUMBER OF ENTRIES               53900020
         DS    XL1                      (UNUSED)                        54000020
PARMCHAR DS    AL4                      CHARACTERS TABLE ADDRESS        54100020
PARMFIRS DS    0XL1                     FIRST SUB-PARAMETER LIST        54200020
         SPACE 3                                                        54300020
IEDQSBPM DSECT                                                          54400020
         SPACE                                                          54500020
SBPMKEY  DS    XL1                      KEY (OFFSET) OF THIS LIST       54600020
SBPMSTAT DS    XL1                      STATUS BYTE                     54700020
SBPMDATA DS    H                        DATA DESCRIPTOR                 54800020
SBPMFROM DS    H                        'FROM' DELIMITER DESCRIPTOR     54900020
SBPMTO   DS    H                        'TO' DELIMITER DESCRIPTOR       55000020
SBPMNEXT DS    0XL1                     NEXT SUB-PARAMETER LIST         55100020
         EJECT                                                          55200020
         TAVTD                                                          55300020
         EJECT                                                          55400020
         TLCBD                                                          55500020
         EJECT                                                          55600020
         TPRFD                                                          55700020
         SPACE                                                          55800020
IEDQPRF  DSECT                                                 @Y17XAMZ 55850010
         ORG   IEDQPRF                                                  55900020
PRFTINS  DS    H                        TEMPORARY INSERT OFFSET         56000020
PRFTDAT  DS    H                        TEMPORARY DATA OFFSET           56100020
PRFINS   DS    H                        INSERT OFFSET                   56200020
PRFDAT   DS    H                        DATA OFFSET                     56300020
         EJECT                                                          56400020
         TSCBD                                                          56500020
         EJECT                                                          56600020
         TTRMD                                                          56700020
         DCBD  DSORG=TX                                          S22025 56750022
         END                                                            56800020
