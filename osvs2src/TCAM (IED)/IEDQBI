         TITLE 'IEDQBI  POLLSTOP-VARYOFF ROUTINE'                       00030000
IEDQBI   CSECT                                                          00060000
*********************************************************************** 00090000
*                                                                     * 00120000
* $MOD(IEDQBI) COMP(M@) PROD(TCAM):                               @01A* 00130012
*                                                                     * 00157000
* DESCRIPTIVE NAME = POLLSTOP/VARYOFF ROUTINE                 @ZM00796* 00164000
*                                                                     * 00180000
* COPYRIGHT= 5735-RC3 COPYRIGHT IBM CORP 1979                 @ZM00796* 00210000
* LICENSED MATERIAL - PROGRAM PROPERTY OF IBM                 @ZM00796* 00217000
* REFER TO COPYRIGHT INSTRUCTIONS FORM NMBER G120-2083        @ZM00796* 00224000
*                                                                     * 00240000
* STATUS = ACF/TCAM VERSION 2 RELEASE 1                        @ZM00796 00270000
*                                                                     * 00300000
* FUNCTION --                                                         * 00330000
*   THIS ROUTINE DEACTIVATES THE CURRENTLY CONNECTED TERMINAL FOR     * 00360000
*   ENTERING.  THIS FUNCTION IS NOT PERFORMED FOR DIAL TERMINALS,     * 00390000
*   TSO, PROCESS ENTRIES, OR LOCK MODE.  AT THE FIRST OF THE          * 00420000
*   ROUTINE IT IS DETERMINED WHAT THE MAXIMUM NUMBER OF BUFFERS       * 00450000
*   NEEDED SHOULD BE.  ANY BUFFERS NOT USED BY THE END OF THE         * 00480000
*   ROUTINE WILL BE RETURNED TO THE BUFFER POOL.  THE BUFFERS ARE     * 00510000
*   USED TO CREATE OPERATOR CONTROL COMMANDS FOR VARYING A TERMINAL   * 00540000
*   OFF THROUGH OPERATOR CONTROL OR HAVING OPERATOR CONTROL PRINT A   * 00570000
*   MESSAGE SAYING THAT THE TERMINAL HAS BEEN VARIED OFF.  IF THE     * 00600000
*   CURRENTLY CONNECTED TERMINAL/CONTROL UNIT (270X) IS IN THE        * 00630000
*   ACTIVE SIDE OF THE INVITATION LIST THEN ALL OCCURANCES OF THAT    * 00660000
*   TERMINAL ARE MOVED TO THE INACTIVE SIDE OF THE INVITATION LIST.   * 00690000
*   THIS IS FOR SPECIFIC AND GENERAL POLL.  A BUFFER WILL BE BUILT    * 00720000
*   WITH A COMMAND TO OPERATOR CONTROL TO PRINT MESSAGE, IED026I,     * 00750000
*   WHICH INDICATES A TERMINAL HAS BEEN STOPPED.  IF THE CURRENTLY    * 00780000
*   CONNECTED TERMINAL, 270X, GENERAL POLL, IS ON THE INACTIVE SIDE   * 00810000
*   OF THE INVITATION LIST, THEN GENERAL POLL IS DEACTIVATED BY       * 00840000
*   MOVING THE CONTROL UNIT ENTRIES ASSOCIATED WITH THE CURRENTLY     * 00870000
*   CONNECTED TERMINAL TO THE INACTIVE SIDE OF THE INVITATION LIST.   * 00900000
*   SPECIFIC POLL IS THEN STARTED FOR ALL TERMINALS ASSOCIATED WITH   * 00930000
*   THE EXCEPTION OF THE CURRENTLY CONNECTED TERMINAL.  TWO BUFFERS   * 00960000
*   ARE THEN BUILT FOR OPERATOR CONTROL TO PRINT MESSAGES TO          * 00990000
*   INDICATE THAT GENERAL POLL HAS BEEN STOPPED (IED144I) AND THAT    * 01020000
*   THE TERMINAL HAS BEEN STOPPED (IED026I).                          * 01050000
*   IF THE CURRENTLY CONNECTED TERMINAL IS 3705, SPECIFIC POLL,       * 01080000
*   THEN THE TRMRSACT BIT IS TURNED ON AND A BUFFER IS BUILT FOR      * 01110000
*   OPERATOR CONTROL TO HAVE THE TERMINAL STOPPED MESSAGE, IED026I,   * 01140000
*   PRINTED.  IF THE CURRENTLY CONNECTED TERMINAL IS A CONTROL UNIT   * 01170000
*   ATTACHED TO A 3705, THEN A BUFFER IS BUILT FOR OPERATOR CONTROL   * 01200000
*   TO DO A V XXX,OFFTP,E.  THIS WILL CAUSE GENERAL POLL TO           * 01230000
*   BE STOPPED AND SPECIFIC POLL TO BE STARTED.  IF THE CURRENTLY     * 01260000
*   CONNECTED TERMINAL IS 3705, GENERAL POLL, THEN THE PREVIOUS       * 01290000
*   OPERATION OF BUILDING A BUFFER FOR OPERATOR CONTROL TO STOP       * 01320000
*   GENERAL POLL IS DONE, THEN ANOTHER BUFFER IS BUILT FOR OPERATOR   * 01350000
*   CONTROL TO DO A V XXX,OFFTP,E FOR THE CURRENTLY CONNECTED         * 01380000
*   TERMINAL.                                                         * 01410000
*   IF THE FUNCTION TO BE PERFORMED IS VARYOFF THEN A ROUTINE         * 01440000
*   DETERMINES FROM THE OPTION TARGET= ON THE IEDVOFF MACRO,          * 01470000
*   WHETHER TO DO A V LINE NO.,OFFTP,C OR V STATNAME,OFFTP,B OR       * 01500000
*   F JOBNAME,DEACT.                                                    01530000
*   ONE OF THESE COMMANDS IS BUILT IN A BUFFER TO BE SENT TO OPERATOR * 01560000
*   CONTROL.                                                          * 01590000
*   IF INTVL= IS SPECIFIED (POLLSTOP AND VARYOFF) THEN A TIME DELAY   * 01620000
*   ELEMENT IS BUILT.  THE SUBTASK ASSOCIATED WITH THIS ELEMENT IS    * 01650000
*   LOCATED AT THE END OF THIS MODULE.  WHEN THE ELEMENT IS TAKEN     * 01680000
*   OFF THE TIME DELAY QUEUE THE SUBTASK BUILDS A VARY ONTP COMMAND   * 01710000
*   OR A MODIFY COMMAND IN A BUFFER FOR OPERATOR CONTROL. IF THE      * 01740000
*   COMMAND WAS V STATNAME,OFFTP,B, THEN THE VARY ONTP COMMAND WILL   * 01770000
*   BE V STATNAME,ONTP,B INSTEAD OF V STATNAME,ONTP,E OR F JOBNAME,   * 01800000
*   ACTIV, WHEN THE COMMAND IS F JOBNAME,DEACT.                       * 01830000
*                                                                     * 01860000
* ENTRY POINTS --                                                     * 01890000
*   IEDQBI                                                            * 01920000
*   SUBTASK FOLLOWING IEDQBI                                          * 01950000
*                                                                     * 01980000
* INPUT                                                               * 02010000
*   REGISTER 0 - ZERO (IEDQBD)                                        * 02040000
*   REGISTER 1 - ADDRESS OF PARAMETER LIST (IEDQUI)                   * 02070000
*   REGISTER 1 - ELEMENT (OR ZERO) FROM IEDQBD                        * 02100000
*   REGISTER 3 - ADDRESS OF SCB                                       * 02130000
*   REGISTER 4 - ADDRESS OF LCB                                       * 02160000
*   REGISTER 7 - ADDRESS OF QCB                                       * 02190000
*   REGISTER 8 - ADDRESS OF PARAMETER LIST (IEDQBD)                   * 02220000
*   REGISTER 9 - ADDRESS OF AVT SAVE AREA (IEDQUI)                    * 02250000
*   REGISTER 11 - DISPATCHER BASE ADDRESS                             * 02280000
*   REGISTER 12 - IEDQBI BASE ADDRESS                                 * 02310000
*   REGISTER 13 - ADDRESS OF AVTSAVE2                                 * 02340000
*                                                                     * 02370000
* OUTPUT --                                                           * 02400000
*   REGISTER 1 - CHAIN OF ELEMENTS TO BE POSTED                       * 02430000
*   REGISTER 4 - ADDRESS OF LCB                                       * 02460000
*   REGISTER 11 - DISPATCHER BASE ADDRESS                             * 02490000
*   REGISTER 13 - ADDRESS OF AVTSAVE2                                 * 02520000
*                                                                     * 02550000
* EXTERNAL REFERENCES --                                              * 02580000
*   AVTRNMPT - TO COMPUTE ADDRESS OF TERMINAL ENTRY                   * 02610000
*   IEDQBJ - TO EVALUATE COUNT= EXPRESSION IF SPECIFIED               * 02640000
*   DSPPOSTR - TO INSERT ELEMENT ON READY QUEUE                       * 02670000
*   AVTHG01 - TO PUT ELEMENT ON TIME DELAY QUEUE                      * 02700000
*                                                                     * 02730000
* EXITS, NORMAL --                                                    * 02760000
*   TO IEDQUI IF ENTERED FROM IEDQUI                                  * 02790000
*   TO DISPATCHER IF ENTERED FROM IEDQBD                              * 02820000
*   TO DISPATCHER IF ENTRY POINT WAS SUBTASK                          * 02850000
*                                                                     * 02880000
* EXITS, ERROR --                                                     * 02910000
*   SAME AS NORMAL                                                    * 02940000
*                                                                     * 02970000
* TABLES/WORK AREAS --                                                * 03000000
*   TCAM AVT, SCB, DCB, UCB, LCB, TERMNAME TABLE,                     * 03030000
*   TERMINAL ENTRY, QCB, BUFFER PREFIX.                               * 03060000
*                                                                     * 03090000
* ATTRIBUTES --                                                       * 03120000
*   REUSABLE, REFRESHABLE, ENABLED                                    * 03150000
*                                                                     * 03180000
* CHARACTER CODE DEPENDENCY --                                        * 03210000
*   NONE.                                                             * 03240000
*                                                                     * 03270000
* CHANGE ACTIVITY=AS FOLLOWS:                                         * 03300000
*A000000-999999                                                @XA09783 03330000
*A312800,389600,504000,644800                                  @OY12413 03360000
*C245600                                                       @OY12413 03390000
*A894400                                                       @OY12681 03420000
*C216000                                                       @OY12950 03450000
*A316800,472000,477600                                         @OX12530 03480000
*A206400                                                       @OS77020 03510000
*C216000,216600                                                @OS77020 03540000
*A502400,645100                                                @Y17XAMG 03570000
*C184800,503200,504600,645200,645400                           @Y17XAMG 03600000
*A361900,361200,345800                                         @OZ08370 03630000
*C223300,345800,3619-362600                                    @OZ08370 03660000
*D363300-364000                                                @OZ08370 03690000
*A092400,191100,742700,329700                                  @OS77950 03720000
*C139300,191800                                                @OS77950 03750000
*A825301                                                       @OZ25852 03780000
*C161000                                                       @OZ25789 03810000
*A163100                                                       @OZ25789 03840000
* DUMMY APAR                                                   @OZ27328 03870000
*A473060,473840                                                @OY19464 03900000
*A350700                                                       @OZ29485 03930000
*A160307                                                       @OZ32423 03960000
*D515900                                                       @OZ32423 03990000
*A853600                                                       @OZ33017 04020000
*C520800,538300-539000                                         @OZ33017 04050000
*A229200,338700,414900                                         @OZ35509 04056022
*A225000                                                       @OZ36230 04062022
*D225300                                                       @OZ36230 04068022
*$01=OZ41953  ETC2202  79.11.15 726652:                            @01A 04074027
*$02=OZ44509  ETC2202  80.02.20 742564:                            @02A 04077027
*$11=OZ46909  ETC2302  80.06.20 613706:                            @11A 04078526
*$21=OZ49548  ETC2402  81.09.17 076195: STOP TERM IMMEDIATE        @21A 04089027
*$22=OZ48753  ETC2402  81.09.18 937763:                            @22A 04099527
*$23=OZ55539  ETC2402  81.11.19 797350:                            @23A 04104727
*$24=OZ55511  ETC2402  81.12.07 797350: IEDVOFF TARGET=LINE ERROR  @24A 04107327
*$25=OZ49846  ETC2402  81.12.15 797350:                            @25A 04108627
*$R1=ZM30932  ETC2402  82.03.04 139003: IEDVOFF, STOPTERM I        @R1A 04109327
*********************************************************************** 04110000
         EJECT                                                          04140000
R0       EQU   0                        ENTRY INDICATOR                 04170000
RLENGTH  EQU   5                        LENGTH OF INVITATION ENTRY      04200000
R1       EQU   1                        DISPATCHER PARM LIST            04230000
RPARM    EQU   1                        TCB ADDRESSABILITY     @Y17XARR 04260000
RTERM    EQU   7                        TERM ENTRY BASE                 04290000
RDCB     EQU   2                        DCB ADDRESS                     04320000
RSCB     EQU   3                        SCB ADDRESS                     04350000
RWORK1   EQU   3                        WORK REGISTER                   04380000
RTNT     EQU   3                        REG FOR TNT INDEX               04410000
RLCB     EQU   4                        LCB ADDRESS                     04440000
RLCBX    EQU   11                       LCBX EXTENSION ADDR    @OS77950 04470000
RWRK     EQU   15                       WORK REGISTER          @OS77950 04500000
RNDX     EQU   5                        INDEX                           04530000
MOVELEN  EQU   8                        LENGTH FOR EXECUTES             04560000
RLIST    EQU   10                       INV LIST ADDRESS                04590000
RQCB     EQU   7                        ADDRESS OF QCB FOR BD           04620000
RWORK    EQU   7                        SWAP ENTRY                      04650000
ROFF     EQU   8                        OFFSET                          04680000
R9       EQU   9                        WORK REG.                       04710000
RDISP    EQU   11                       DISPATCHER BASE ADDRESS         04740000
RPOINT   EQU   11                       POINTER WITHIN BUFFER           04770000
RBFR     EQU   6                        BFR FOR 3705                    04800000
RBASE    EQU   12                       BASE                            04830000
RAVT     EQU   13                       AVTSAVE2                        04860000
RRET     EQU   14                       COUNTER                         04890000
R14      EQU   14                       RETURN ADDRESS                  04920000
RSAV     EQU   15                       FOR OFFSET                      04950000
RENTRY   EQU   15                        CURRENT ENTRY POINTER          04980000
R15      EQU   15                       BRANCH ADDRESS                  05010000
ZERO     EQU   0                         CONSTANT 0                     05040000
ONE      EQU   1                        CONSTANT 1                      05070000
TWO      EQU   2                        CONSTANT 2                      05100000
THREE    EQU   3                        CONSTANT 3                      05130000
FOUR     EQU   4                        CONSTANT 4                      05160000
FIVE     EQU   5                        CONSTANT 5                      05190000
SIX      EQU   6                        CONSTANT 6                      05220000
SEVEN    EQU   7                        CONSTANT 7                      05250000
EIGHT    EQU   8                        CONSTANT 8                      05280000
NINE     EQU   9                        CONSTANT 9                      05310000
TWELVE   EQU   12                       CONSTANT 12                     05340000
FOURTEEN EQU   14                       CONSTANT 14                     05370000
SIXTEEN  EQU   16                       CONSTANT 16                     05400000
TWENTY   EQU   20                       CONSTANT 20                     05430000
TWENTY4  EQU   24                       CONSTANT 24                     05460000
OFFBBIT  EQU   X'10'                    BIT FOR OFFTP,B                 05490000
OFFCBIT  EQU   X'20'                    BIT FOR OFFTP,C                 05520000
OFFIBIT  EQU   X'04'                    OFFTP,I (TERM ONLY)        @21A 05535027
DEACTBIT EQU   X'40'                    BIT FOR DEACT                   05550000
CLEAR    EQU   X'22'                    NO. OF BYTES TO CLEAR IN PREFIX 05580000
EOT      EQU   X'80'                    EOT FLAG                        05610000
ENDACT   EQU   X'FE'                    END OF ACTIVE ENTRIES           05640000
XFF      EQU   X'FF'                    GENREAL MASK BITS               05670000
MASKF0   EQU   X'F0'                    MASK FOR ZONE DECIMAL DIGIT     05700000
SNGLTRM  EQU   X'E0'                    SINGLE ENTRY                    05730000
CUSW     EQU   X'08'                    CONTROL UNIT SWITCH             05760000
ACTIVSW  EQU   X'80'                    ACTIVE SWITCH                   05790000
ORDERBIT EQU   X'01'                    TRYING TO ORDER ENTRIES         05820000
POL01    EQU   X'01'                    BIT TO SET FOR SPECIAL 3705     05850000
POL02    EQU   X'02'                    BUT TO SPECIFY MSG.             05880000
TIC02    EQU   X'02'                    TIC FOR SECOND UNIT IN BFR      05910000
TIC08    EQU   X'08'                    BYTE TO TIC TO NEXT UNIT        05940000
UNIT01   EQU   X'01'                    ONE UNIT PER BFR                05970000
UNIT02   EQU   X'02'                    TWO UNITS PER BFR               06000000
*                                          BUFFERS GOING TO OP CNTL     06030000
PRFLNGTH EQU   X'2C'                    LENGTH OF BFR PREFIX            06060000
DATAOFF  EQU   X'20'                    OFFSET  FOR START OF DATA       06090000
FE       EQU   X'FE'                    END OF LIST            @OX12530 06120000
VARYLEN  EQU   X'0C'                    LENGTH OF DATA-TRMNAME          06150000
*                                       (LEN OF CMD+1 TO TAKE CARE OF   06180000
*                                         LEN-1 OF TERMNAME)            06210000
MCMDLEN  EQU   10                       LEN OF MODIFY CMD      @YM08412 06240000
         SPACE 2                                                        06270000
*        USING STATEMENTS                                             * 06300000
         SPACE 2                                                        06330000
         USING IHADCB,RDCB                                              06360000
         USING IEDQTRM,RTERM                                            06390000
         USING AVTSAVE2,RAVT                                            06420000
         USING IEDQSCB,RSCB                                             06450000
         USING INPARM,ROFF                                              06480000
         USING IEDQPRF,RBFR                                             06510000
         USING IEDQLCB,RLCB                                             06540000
         USING IEDQLCBX,RLCBX                                  @OS77950 06570000
         USING *,RBASE                                                  06600000
         SPACE 2                                                        06630000
*        ENTRY FROM IEDQBD                                              06660000
         SPACE 2                                                        06690000
IEDQBI   IEDHJN   STRTHERE                                              06720000
         LTR   R0,R0                    WAS ENTRY FROM IEDQBD           06750000
         BZ    BDENTRY                    BRANCH YES                    06780000
         SPACE                                                          06810000
         O     RBASE,SPMASK             INDICATE ENTRY FROM IEDQUI      06840000
         LR    ROFF,R1                  PARM LIST TO REG 8              06870000
         ST    RAVT,AVTPARM-IEDQAVTD(,R9)  SAVE SAVE AREA ADDRESS       06900000
         LA    RAVT,AVTSAVE2-IEDQAVTD(,R9)  SET UP AVT BASE             06930000
         SR    RNDX,RNDX                INDICATE NOTHING TO POST        06960000
         B     LOCTERM                  GO LOCATE TERMINAL              06990000
         SPACE 2                                                        07020000
BDENTRY  EQU   *                                                        07050000
         LPR   RQCB,RQCB                INSURE POSITIVE ADDRESS         07080000
         ST    RQCB,LCBERBQB-ONE        SET TO POST ERB TO BD           07110000
         ST    R1,LCBERBLK-ONE          ADD TO POST LIST                07140000
         MVI   LCBERBPY,PRIRCQCB        SET PRIORITY                    07170000
         LA    RNDX,LCBERB              ERB TO POST                     07200000
         SPACE 2                                                        07230000
*        LOCATE TERMINAL ENTRY                                          07260000
         SPACE 2                                                        07290000
LOCTERM  EQU   *                                                        07320000
         ST    ROFF,AVTSAVE3+TWENTY4    SAVE PARM LIST ADDR             07350000
         ST    RNDX,AVTSAVE3+TWENTY     SAVE ERB ADDRESS                07380000
         L     R15,AVTRNMPT             GET ADDR OF TERMNAME TABLE      07410000
         LH    R1,LCBTTCIN              GET INDEX OF CURRENT TERM.      07440000
         N     R1,AVTCLRHI              CLEAR HIGH ORDER BITS           07470000
         BNZ   GOTTCIN                  HAS TTCIN              @OZ25789 07500000
         L     RDCB,LCBDCBPT            GET DCB ADDRESS        @OZ32423 07530000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80 3705 TERMINAL ?    @OZ32423 07560000
         BO    RETDISP                  YES, GET OUT.          @OZ32423 07590000
         TM    INPFLAG,INPVARY          VARYOFF                @OZ25789 07620000
         BNO   RETDISP                                         @OZ25789 07650000
         TM    INPFLAG,INPLINE          VARYOFF FOR LINE       @OZ25789 07680000
         BNO   RETDISP                                         @OZ25789 07710000
         TM    INPFLAG,INPCOUNT         COUNT SPECIFIED        @OZ25789 07740000
         BO    RETDISP                                         @OZ25789 07770000
         B     NOTTRM                                          @OZ25789 07800000
GOTTCIN  EQU   *                                               @OZ25789 07830000
         BALR  R14,R15                  GO GET TERM ENTRY               07860000
         SPACE                                                          07890000
         LR    RTERM,R1                 COPY TERM ADDRESS               07920000
NOTTRM   EQU   *                                               @OZ25789 07950000
         LA    R15,ONE                  ASSUME 1 UNIT                   07980000
         TM    INPFLAG,INPVARY          VARYOFF SPECIFIED               08010000
         BO    NOGENPL                    BYPASS 3270/2260 TEST         08040000
         SPACE                                                          08070000
         SR    R14,R14                  CLEAR FOR IC                    08100000
         IC    R14,TRMCHCIN             CHARACTERISTICS INDEX           08130000
         BCTR  R14,0                    MINUS ONE                       08160000
         MH    R14,AVTDCTLN             TIMES DCT ENTRY LENGTH @Y17XAMG 08190000
         AL    R14,AVTCSTCS             TABLE ORIGIN                    08220000
         TM    TWO(R14),TWO             LOCAL DEVICE                    08250000
         BO    NOGENPL                   BRANCH YES NO GEN POLL         08280000
         SPACE                                                          08310000
         TM    ONE(R14),FOUR            3270 REMOTE                     08340000
         BO    ISGENPL                    BRANCH YES                    08370000
         SPACE                                                          08400000
         TM    THREE(R14),TWO           2260                            08430000
         BZ    NOGENPL                    BRANCH NO                     08460000
         SPACE                                                          08490000
ISGENPL  EQU   *                                                        08520000
         ALR   R15,R15                  GET EXTRA UNIT                  08550000
NOGENPL  EQU   *                                                        08580000
         CLC   AVTKEYLE,MSGLEN          NEED TWO UNITS/MESSAGE          08610000
         BNL   ONEOK                      BRANCH NO                     08640000
         SPACE                                                          08670000
         ALR   R15,R15                  DOUBLE BUFFER REQUIREMENT       08700000
ONEOK    EQU   *                                                        08730000
         TM    INPFLAG,INPINVL          IS INTVL= SPECIFIED             08760000
         BZ    GOTREQ                     BRANCH NO                     08790000
         SPACE                                                          08820000
         LA    R15,ONE(,R15)            GET ONE MORE                    08850000
GOTREQ   EQU   *                                                        08880000
         BAL   R14,GETBFR               GET BUFFER UNITS                08910000
         SPACE                                                          08940000
         LTR   R15,R15                  ENOUGH BUFFERS - 0=OK           08970000
         BNZ   RETDISP                  RETURN CONDITION CODE '0C'      09000000
         TM    INPFLAG,INPVARY          VARY OFF?              @OS77020 09030000
         BO    VOFF                     YES, SKIP PSTOP TESTS  @OS77020 09060000
         SPACE 2                                                        09090000
*        CHECK FOR SINGLE NONDIAL TERMINAL                            * 09120000
         SPACE 2                                                        09150000
         L     RDCB,LCBDCBPT            GET DCB ADDR           @OS77950 09180000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80 TERM ATTACHED 3705 @OS77950 09210000
         BO    NXTCK                    BYPASS STATUS PND CHK  @OS77950 09240000
         SR    RWRK,RWRK                CLEAR WORK REGISTER    @OS77950 09270000
         IC    RWRK,DCBEIOBX            INSERT LCB LENGTH      @OS77950 09300000
         SH    RWRK,HALF8               REDUCE LENGTH BY 8     @OS77950 09330000
         LA    RLCBX,ZERO(RWRK,RLCB)    LCB EXTENSION ADDR     @OS77950 09360000
         TM    LCBXFLAG,LCBERPND        SOH% PENDING ?         @OS77950 09390000
         BO    RETDISP1                 BRANCH YES             @OS77950 09420000
         SPACE                                                          09450000
NXTCK    TM    TRMSTATE,SNGLTRM         IS THIS SINGLE TERM    @OS77950 09480000
         BNZ   RETDISP1                 IF NO - GO TO DSPCHAIN          09510000
         TM    TRMSTATE,TRMPREF         DOES A PREFIX EXIST    @XM05658 09540000
         BNO   NOPREFIX                 NO BRANCH              @XM05658 09570000
         LR    R15,RTERM                GET TERM ENTRY         @Y17XARR 09600000
         S     R15,TRMPREFL             BACKUP TO THE PREFIX   @Y17XARR 09630000
         TM    TRMBYTE0-IEDNTRM(R15),TRMSNA  SNA?              @Y17XARR 09660000
         BO    RETDISP1                 REJECT                 @Y17XARR 09690000
NOPREFIX DS    0H                                              @XM05658 09720000
         L     R15,TRMDESTQ-ONE         QCB ADDRESS                     09750000
         TM    QCBFLAG-IEDQQCB(R15),QCBTSSES   TSO SESSION ACTIVE       09780000
         BO    RETDISP1                 BRANCH YES                      09810000
         SPACE 2                                                        09840000
         TM    LCBSTAT2,LCBDIAL        IS THIS A DIAL TERMINAL          09870000
         BO    RETDISP1                 BRANCH YES             @OS77020 09900000
         SPACE 2                                                        09930000
         TM    SCBSTATE,SCBMSGLN+SCBLCK1N  CHECK FOR MSG LOCK OR        09960000
*                                            EXTENDED LOCK BITS ON      09990000
         BNZ   RETDISP1                 BR IF LOCK MODE ON              10020000
         SPACE                                                          10050000
         DROP  RSCB                                                     10080000
         USING IEDQTNTD,RTNT                                            10110000
         SPACE 2                                                        10140000
*   CHECK TO SEE IF THE COUNT OPTION  IS SPECIFIED                      10170000
         SPACE 2                                                        10200000
VOFF     EQU   *                                                        10230000
         TM    INPFLAG,INPCOUNT         WAS COUNT= CODED                10260000
         BZ    NOCOUNT                    BRANCH NO                     10290000
         SPACE                                                          10320000
         LA    RDCB,FOUR(,ROFF)         PARM LIST FOR BJ                10350000
         TM    INPIND,INPMSK            WAS MASK SPECIFIED              10380000
         BO    NOMASK                     BRANCH NO                     10410000
         SPACE                                                          10440000
         LA    RDCB,FOUR(,RDCB)         BUMP PAST ERROR MASK            10470000
NOMASK   EQU   *                                                        10500000
         SR    R15,R15                  CLEAR REGISTER                  10530000
         IC    R15,ZERO(RDCB)           INDEX TO IEDQBJ                 10560000
         AL    R15,AVTMSGS-1            VCON TABLE ADDRESS              10590000
         L     R15,0(,R15)              ADDRESS OF IEDQBJ               10620000
         BALR  R14,R15                  LINK TO IEDQBJ                  10650000
         SPACE                                                          10680000
         LTR   R15,R15                  CHECK RETURN CODE FROM BJ       10710000
         BNZ   RETDISP1                 DO NOT EXECUTE FUNCTION         10740000
         SPACE                                                          10770000
*       NORMAL RETURN TO +4                                             10800000
         SPACE 2                                                        10830000
*        CHECK FOR TERMINAL ATTACHED VIA 3705                         * 10860000
         SPACE 2                                                        10890000
NOCOUNT  EQU   *                                                        10920000
         XC    AVTDOUBL(EIGHT),AVTDOUBL INIT WORK AREA                  10950000
         L     R1,AVTSAVE3+TWENTY       POST LIST TO R1                 10980000
         TM    INPFLAG,INPVARY          IS THIS IEDVOFF        @OZ08370 11010000
         BO    VARYOFF                  BRANCH YES                      11040000
         L     RDCB,LCBDCBPT            GET LGB OR DCB ADDRESS          11070000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80   IS TERM ATTACHED VIA 3705 11100000
         BO    YES3705                  IF YES - GO TO YES3705          11130000
         SPACE 2                                                        11160000
*        ACCESS INVITATION LIST                                       * 11190000
         SPACE 2                                                        11220000
*         CODE FOR 270X  TERMINALS                                      11250000
         SR    RNDX,RNDX                INIT REG                        11280000
         IC    RNDX,LCBUCBX             LOAD INVLIST INDEX              11310000
         SLL   RNDX,TWO                 MULTIPLY POINTER BY 4           11340000
         L     RLIST,DCBINVLI(RNDX)     GET ADDR OF INVLIST             11370000
         SPACE 2                                                        11400000
*        CHECK FOR CONTENTION BOX                                     * 11430000
         SPACE 2                                                        11460000
         CLI   TWO(RLIST),ONE           CHECK FOR CONTENTION BOX        11490000
         BE    RETDISP2                 IF YES, DO NOTHING              11520000
         SPACE                                                          11550000
         CLI   ONE(RLIST),ZERO          ANY ACTIVE ENTRIES?             11580000
         BE    RETDISP2                 NO                              11610000
         SPACE 2                                                        11640000
*        INITIALIZATION                                               * 11670000
         SR    RLENGTH,RLENGTH          INIT REG                        11700000
         IC    RLENGTH,TWO(,RLIST)      LENGTH OF ENTRY                 11730000
         LR    RWORK1,RLENGTH           LENGTH OF ENTRY                 11760000
         BCTR  RWORK1,0                 DECREMENT FOR EXECUTE           11790000
         SPACE 2                                                        11820000
*        CHECK STATUS OF INVITATION LIST                              * 11850000
         SPACE 2                                                        11880000
NXTENTRY EQU   *                                                        11910000
         LH    ROFF,AVTDOUBL            GET NEXT ENTRY                  11940000
         LA    ROFF,ONE(ROFF)           INCR BY ONE                     11970000
         STH   ROFF,AVTDOUBL            STORE BACK                      12000000
         CLC   AVTDOUBL+ONE(ONE),ZERO(RLIST)   OUT OF ENTRIES?          12030000
         BH    TEST                     YES                             12060000
         SPACE 2                                                        12090000
         ALR   ROFF,ROFF                MULTIPLY BY TWO                 12120000
         LR    RENTRY,RLIST             BEGINNING                       12150000
         SR    RENTRY,ROFF              BACK TO ENTRY                   12180000
         CLC   ZERO(TWO,RENTRY),LCBTTCIN   TO BE DEACTIVATED            12210000
         BNE   NXTENTRY                 NO                              12240000
         SPACE 2                                                        12270000
*        SEARCH ACTIVE LIST FOR CORRECT INDEX                           12300000
         SPACE 2                                                        12330000
         LA    RENTRY,SEVEN(,RLIST)     POINTER TO FIRST ENTRY INDEX    12360000
         SR    RRET,RRET                CLEAR                           12390000
         IC    RRET,ONE(,RLIST)         NO. OF ACTIVE ENTRIES           12420000
         SPACE 2                                                        12450000
CKNEXTA  EQU   *                                                        12480000
         AR    RENTRY,RLENGTH           GO TO NEXT ENTRY'S INDEX        12510000
         CLC   ZERO(ONE,RENTRY),AVTDOUBL+ONE   DOES INDEX MATCH         12540000
         BE    DACTIVT                  BR TO DEACTIVATE TERMINAL ENTRY 12570000
         SPACE 2                                                        12600000
         BCT   RRET,CKNEXTA             NOT END OF ACTIVE, GO BACK      12630000
         SPACE 2                                                        12660000
*        SEARCH FOR ENTRY IN INACTIVE LIST                            * 12690000
         SPACE 2                                                        12720000
         TM    AVTDOUBL+TWO,ACTIVSW     IS ACTIVE SWITCH ON             12750000
         BO    NXTENTRY                 YES                             12780000
         XC    AVTDOUBL+FOUR(FOUR),AVTDOUBL+FOUR   CLEAR WORK AREA      12810000
         TM    THREE(RLIST),EOT         IS THIS EOT-FE (BSC)            12840000
         BNO   ADD1                     IF NO - ONLY ADD 1              12870000
         SPACE 2                                                        12900000
         LA    RENTRY,ONE(,RENTRY)      ADD EXTRA ONE FOR EOT           12930000
ADD1     EQU   *                                                        12960000
         LA    RENTRY,ONE(RENTRY)       ADD ONE FOR 'FE'                12990000
         IC    RRET,ZERO(,RLIST)        GET TOTAL ENTRIES               13020000
         MVC   AVTDOUBL+SEVEN(ONE),ONE(RLIST)   GET NO. OF ACTIVE ENTS. 13050000
         S     RRET,AVTDOUBL+FOUR       COMPUTE INACTIVE ENTRIES        13080000
         BZ    NXTENTRY                 YES                             13110000
         SPACE 2                                                        13140000
CKINACT  EQU   *                                                        13170000
         AR    RENTRY,RLENGTH           GET TO NEXT INDEX               13200000
         CLC   ZERO(ONE,RENTRY),AVTDOUBL+ONE  DOES INDEX MATCH          13230000
         BE    CKCU                     YES                             13260000
         SPACE 2                                                        13290000
         BCT   RRET,CKINACT             LOOK AT NEXT ENTRY              13320000
         B     NXTENTRY                 IF NOT INACTIVE, GET NEXT ENT.  13350000
         SPACE 2                                                        13380000
*        SET UP TO MOVE ENTRY FROM ACTIVE TO INACTIVE                 * 13410000
         SPACE 2                                                        13440000
DACTIVT  EQU   *                                                        13470000
         OI    AVTDOUBL+TWO,ACTIVSW     TURN ON ACTIVE SW               13500000
DACTIVCU EQU   *                                                        13530000
         L     ROFF,AVTSAVE3+TWENTY4    PARM LIST ADDRESS      @OY12413 13560000
         TM    INPFLAG,INPVARY          VARY OFF               @OY12413 13590000
         BO    VARYOFF                  BRANCH IF YES          @OY12413 13620000
         L     R9,LCBINVPT-1            GET INV LIST ENTRY POINTER      13650000
         LA    R9,ZERO(,R9)             CLEAR HIGH ORDER BYTE           13680000
         CR    RENTRY,R9                WHERE IS ENTRY COMPARED TO      13710000
*                                         LCBINVPT                      13740000
         BNL   NOUPDTE                  DON'T UPDATE LCBINVPT           13770000
         SR    RWORK,RWORK              CLEAR REGISTER         @OX12530 13800000
         IC    RWORK,ONE(,RLIST)        NO. ACTIVE ENTRIES     @OX12530 13830000
         STH   RWORK,AVTSAVE3+TWO       SAVE NO. ACTIVE ENTRIE @OX12530 13860000
         SR    RWORK,RWORK              CLEAR REGISTER         @OX12530 13890000
         LR    RWORK,RLENGTH            LENGTH OF EACH ENTRY   @OX12530 13920000
         MH    RWORK,AVTSAVE3+TWO       TOTAL LENGTH OF ENTRIE @OX12530 13950000
         LA    RWORK,EIGHT(RWORK,RLIST)  ADDR OF END OF LIST   @OX12530 13980000
*                                        INDICATOR             @OX12530 14010000
         CLI   ZERO(RWORK),FE           END OF LIST            @OX12530 14040000
         BE    NOTEOT                   YES, BRANCH            @OX12530 14070000
         LA    RWORK,ONE(,RWORK)        ADJUST FOR EOT CHARACT @OX12530 14100000
NOTEOT   EQU   *                                               @OX12530 14130000
         CR    RWORK,R9                 R9 IN INVITATION LIST  @OX12530 14160000
         BL    NOUPDTE                  NO, DON'T CHAMGE LCB   @OX12530 14190000
         SLR   R9,RLENGTH               CORRECT THE POINTER             14220000
         IC    RDCB,LCBINVPT-1          SAVE HIGH ORDER BYTE            14250000
         ST    R9,LCBINVPT-1            RESTORE POINTER                 14280000
         STC   RDCB,LCBINVPT-1          RESTORE HIGH ORDER BYTE         14310000
         SPACE                                                          14340000
NOUPDTE  EQU   *                                                        14370000
         LR    RWORK,RENTRY                                             14400000
         SR    RENTRY,RLENGTH           SET TO ENTRY LENGTH-1           14430000
         BCT   RRET,SWAPLOOP            SWAP ENTRIES                    14460000
         SPACE 2                                                        14490000
         B     LOOPOUT                  MOVE LAST ENTRY                 14520000
         SPACE 2                                                        14550000
SWAPLOOP EQU   *                                                        14580000
         EX    RWORK1,SWAP1              SWAP TWO                       14610000
         EX    RWORK1,SWAP2             SUCCESSIVE                      14640000
         EX    RWORK1,SWAP1             ENTRIES                         14670000
         AR    RENTRY,RLENGTH           MOVE TO                         14700000
         AR    RWORK,RLENGTH            NEXT ENTRY                      14730000
         BCT   RRET,SWAPLOOP            NOT DONE RETURN                 14760000
         SPACE 2                                                        14790000
LOOPOUT  EQU   *                                                        14820000
         LR    RRET,RLENGTH             RESTORE LENGTH FOR MOVE         14850000
         TM    THREE(RLIST),EOT         IS THIS EOT-FE (BSC)            14880000
         BO    SETEOT                   YES                             14910000
         SPACE 2                                                        14940000
SETLOOP  EQU   *                                                        14970000
         MVC   ONE(ONE,RWORK),ZERO(RWORK)   MOVE ONE CHARACTER          15000000
         BCTR  RWORK,ZERO                      AT A TIME                15030000
         BCT   RRET,SETLOOP                    UNTIL FINISHED           15060000
         MVI   ONE(RWORK),ENDACT        INSERT ACTIVE END CHAR.         15090000
         B     RSETACT                  GO RESET ACTIVE COUNT           15120000
         SPACE 2                                                        15150000
SETEOT   EQU   *                                                        15180000
         MVC   AVTSAVE3+TWO(TWO),ONE(RWORK)    SAVE EOT CHARS.          15210000
         SPACE                                                          15240000
SETEOT1  EQU   *                                                        15270000
         MVC   TWO(ONE,RWORK),ZERO(RWORK)    MOVE ONE CHARACTER         15300000
         BCTR  RWORK,ZERO                       AT A TIME               15330000
         BCT   RRET,SETEOT1                     UNTIL FINISHED          15360000
         SPACE                                                          15390000
         MVC   ONE(TWO,RENTRY),AVTSAVE3+TWO    RESTORE EOT CHARS.       15420000
         SPACE 2                                                        15450000
RSETACT  EQU   *                                                        15480000
         IC    RRET,ONE(,RLIST)         COUNT OF ACTIVE ENTRIES         15510000
         BCTR  RRET,ZERO                DECREMENT ACTIVE COUNT          15540000
         STC   RRET,ONE(,RLIST)         STORE COUNT BACK                15570000
         LTR   RRET,RRET                ZERO ACTIVE ENTRIES ?  @OS77950 15600000
         BNZ   CKMVE                    NO, CONTINUE           @OS77950 15630000
         NI    LCBXFLAG,LCBGPSTP        YES, TURN OFF GEN POLL @OS77950 15660000
         B     TEST                                            @OS77950 15690000
CKMVE    EQU   *                                               @OS77950 15720000
         TM    AVTDOUBL+TWO,ACTIVSW     CHECK FOR HAVING MOVED          15750000
*                                          AN ACTIVE TERMINAL ENTRY     15780000
         BO    NXTENTRY                 YES                             15810000
         SPACE 2                                                        15840000
         B     CKCU1                    BR TO LOOK FOR NEXT CNTL UNIT   15870000
         SPACE 2                                                        15900000
*        CHECK ACTIVE LIST FOR CONTROL UNIT ASSOCIATED WITH           * 15930000
*        TERMINAL ENTRY IN INACTIVE LIST                              * 15960000
         SPACE 2                                                        15990000
CKCU     EQU   *                                                        16020000
         SR    RENTRY,RLENGTH           BACK UP TO FIRST OF ENTRY       16050000
         MVC   AVTDOUBL+THREE(ONE),ONE(RENTRY)   CONTROL UNIT ADDRESS   16080000
CKCU1    EQU   *                                                        16110000
         LA    RENTRY,SEVEN(,RLIST)     GET TO FIRST ENTRY              16140000
         SR    RENTRY,RLENGTH           BACK UP ONE                     16170000
         IC    RRET,ONE(RLIST)          GET ACTIVE COUNT                16200000
         LTR   RRET,RRET                CHECK ACTIVE COUNT              16230000
         BZ    NXTENTRY                 IF ZERO, GET NEXT ENTRY         16260000
         SPACE 2                                                        16290000
CKNEXTCU EQU   *                                                        16320000
         AR    RENTRY,RLENGTH           GO TO NEXT ENTRY                16350000
         CLC   ONE(ONE,RENTRY),AVTDOUBL+THREE    CONTROL UNIT MATCH?    16380000
         BNE   UPDATE                   NO CONTROL UNIT        @OZ08370 16410000
         CLC   THREE(TWO,RENTRY),X7F7F  IS THIS A 3270 CNTL UN @OZ08370 16440000
         BE    SETUP                    YES                    @OZ08370 16470000
         CLC   THREE(TWO,RENTRY),X2222  IS THIS ASCII CNTL UNI @OZ08370 16500000
         BE    SETUP                    YES                    @OZ08370 16530000
         CLI   TWO(RENTRY),XFF          IS THIS 2260 CNTL UNIT @OZ08370 16560000
         BE    SETUP                    YES                    @OZ08370 16590000
         SPACE                                                          16620000
UPDATE   EQU   *                                               @OZ08370 16650000
         BCT   RRET,CKNEXTCU            NOT END OF ACTIVE, GO BACK      16680000
         SPACE 2                                                        16710000
         B     NXTENTRY                 END OF ACTIVE LIST,GET NEXT ENT 16740000
         SPACE 2                                                        16770000
*        SET UP POINTERS TO MOVE CONTROL UNIT                         * 16800000
SETUP    EQU   *                                                        16830000
         OI    AVTDOUBL+TWO,CUSW        TURN ON CONTROL UNIT SW         16860000
         NI    LCBXFLAG,LCBGPSTP        TURN OFF GEN POLL BIT  @OZ29485 16890000
         AR    RENTRY,RLENGTH           SET UP POINTER                  16920000
         SR    ROFF,ROFF                CLEAR FOR IC                    16950000
         IC    ROFF,ZERO(,RENTRY)       GET INDEX                       16980000
         AR    ROFF,ROFF                DOUBLE INDEX TO FIND TNT        17010000
         LNR   ROFF,ROFF                NEGATE OFFSET                   17040000
         AR    ROFF,RLIST               BACK UP TO OFFSET               17070000
         MVC   GENPOLLT(TWO),ZERO(ROFF) SAVE TNT OFF SET           @25C 17100027
         B     DACTIVCU                 DEACTIVATE CONTROL UNIT         17130000
         SPACE 2                                                        17160000
*        TEST TO SEE IF A CONTROL UNIT HAS BEEN MOVED.                * 17190000
*        IF IT HAS, THEN SPECIFIC TERMINALS IN INACTIVE LIST          * 17220000
*        ASSOCIATED WITH THAT CONTROL UNIT SHOULD BE MOVED TO ACTIVE  * 17250000
*        LIST.                                                        * 17280000
         SPACE 2                                                        17310000
TEST     EQU   *                                                        17340000
         TM    AVTDOUBL+TWO,CUSW        CONTROL UNIT MOVED     @OZ08370 17370000
         BO    MOVESPEC                 YES                    @OZ08370 17400000
         TM    AVTDOUBL+TWO,ACTIVSW     ACTIVE TERM MOVED      @OZ08370 17430000
         BZ    RETDISP1                 NO                     @OZ08370 17460000
         SPACE                                                          17490000
         B     GENMSG                   FINISHED                        17520000
         SPACE 2                                                        17550000
*        MOVE SPECIFIC TERMINALS FROM INACTIVE TO ACTIVE LIST         * 17580000
         SPACE 2                                                        17610000
MOVESPEC EQU   *                                                        17640000
         SR    RRET+ONE,RRET+ONE        CLEAR ODD NUMBERED REG.         17670000
         IC    RRET+ONE,ONE(,RLIST)      GET NO. OF ACTIVE ENTRIES      17700000
         MR    RRET,RLENGTH             GET LENGTH OF ACTIVE LIST       17730000
         LR    RRET,RRET+ONE            GET RESULTS OF MULTIPLY         17760000
         LA    RENTRY,EIGHT(RRET,RLIST)  GET TO INACTIVE LIST           17790000
         TM    THREE(RLIST),EOT         EOT ENTRY PRESENT?              17820000
         BNO   INCR1                    NO                              17850000
         SPACE 2                                                        17880000
         LA    RENTRY,ONE(,RENTRY)      ADJUST POINTER TO FIRST ENTRY   17910000
         SPACE 2                                                        17940000
INCR1    EQU   *                                                        17970000
         LA    RENTRY,ONE(,RENTRY)                                      18000000
         SR    RENTRY,RLENGTH           BACK UP ONE                     18030000
         SR    ROFF,ROFF                CLEAR                           18060000
         IC    ROFF,ZERO(,RLIST)        COMPUTE                         18090000
         MVC   AVTDOUBL+SEVEN(ONE),ONE(RLIST)    NO. OF                 18120000
         S     ROFF,AVTDOUBL+FOUR               INACTIVE ENTRIES        18150000
         SPACE 2                                                        18180000
CKNEXT1  EQU   *                                                        18210000
         AR    RENTRY,RLENGTH           GET TO NEXT ENTRY               18240000
         CLC   ZERO(ONE,RENTRY),AVTDOUBL+THREE   COMPARE CONTROL CHAR   18270000
         BE    TESTTNT                  CHECK TNT INDEX                 18300000
         SPACE 2                                                        18330000
         BCT   ROFF,CKNEXT1             IF NOT END, GO BACK             18360000
         B     GENMSG                   FINISHED                        18390000
         SPACE 2                                                        18420000
*        TEST TO SEE IF THIS IS TERMINAL IN "ERROR"                   * 18450000
         SPACE 2                                                        18480000
TESTTNT  EQU   *                                                        18510000
         SR    RRET,RRET                CLEAR                           18540000
         IC    RRET,ZERO(RWORK1,RENTRY) GET INDEX                       18570000
         ALR   RRET,RRET                MULTIPLY BE TWO                 18600000
         LR    RWORK,RLIST              GET FIRST OF LSIT               18630000
         SR    RWORK,RRET               BACK TO ENTRY                   18660000
         CLC   ZERO(TWO,RWORK),LCBTTCIN   TO BE ACTIVATED               18690000
         BE    CKNEXT1                                                  18720000
         SPACE 2                                                        18750000
         CLC   TWO(TWO,RENTRY),X7F7F    IS THIS A 3270 CONTROL UNIT     18780000
         BE    CKNEXT1                  YES                             18810000
         CLC   TWO(TWO,RENTRY),X2222    CHECK FOR ASCII CONTROL UNIT    18840000
         BE    CKNEXT1                  YES                             18870000
         SPACE 2                                                        18900000
         CLI   ONE(RENTRY),XFF          IS THIS A 2260 CONTROL UNIT     18930000
         BE    CKNEXT1                  YES                             18960000
         SPACE 2                                                        18990000
*        MOVE ENTRY FROM INACTIVE TO ACTIVE                           * 19020000
         SPACE 2                                                        19050000
MOVE     EQU   *                                                        19080000
         ALR   RENTRY,RWORK1            POINT TO INDEX                  19110000
         MVC   AVTDOUBL+SEVEN(ONE),ZERO(RENTRY)   SAVE INDEX            19140000
         SR    RENTRY,RLENGTH           POINT TO PREVIOUS ENTRY         19170000
         LR    RWORK,RENTRY                                             19200000
         SR    RWORK,RLENGTH            POINT TO PREVIOUS ENTRY         19230000
ACTIVATE EQU   *                                                        19260000
         CLI   ZERO(RENTRY),ENDACT      FIRST INACTIVE ENTRY            19290000
         BE    MACTIVE                  YES                             19320000
         SPACE 2                                                        19350000
SWAPLOP2 EQU   *                                                        19380000
         EX    RWORK1,SWAP1             SWAP ONE POSITION               19410000
         EX    RWORK1,SWAP2             WITH THE NEXT                   19440000
         EX    RWORK1,SWAP1             SUCCESSIVE POSITION             19470000
         TM    AVTDOUBL+TWO,ORDERBIT    TRYING TO ARRANGE               19500000
         BO    CKPOS                    YES                             19530000
         SPACE 2                                                        19560000
         SR    RENTRY,RLENGTH           BACK UP ONE ENTRY               19590000
         SR    RWORK,RLENGTH            BACK PREVIOUS ENTRY BY ONE      19620000
         B     ACTIVATE                 CHECK FOR INACTIVE ENTRY        19650000
         SPACE 2                                                        19680000
MACTIVE  EQU   *                                                        19710000
         TM    THREE(RLIST),EOT         EOT ENTRY PRESENT?              19740000
         BO    MACTIVE1                 YES                             19770000
         SPACE 2                                                        19800000
         EX    RWORK1,MOVACT            PLACE ENTRY ON ACTIVE SIDE      19830000
         LA    RRET,ZERO(RLENGTH,RENTRY)   POINT TO NEW END OF ACTIVE   19860000
         BCTR  RENTRY,ZERO              GET ON LESS                     19890000
         BCTR  RWORK,ZERO               GET ONE LESS                    19920000
         MVI   ZERO(RRET),ENDACT        RESET ACTIVE POINTER            19950000
         SPACE 2                                                        19980000
MACTIVE2 EQU   *                                                        20010000
         BCTR  RENTRY,0                 BACK UP POINTER                 20040000
         BCTR  RWORK,0                  BACK UP POINTER                 20070000
         SR    RRET,RRET                CLEAR                           20100000
         IC    RRET,ONE(,RLIST)         GET NO. OF ACTIVE ENTRIES       20130000
         LA    RRET,ONE(,RRET)          INCR. FOR BCT                   20160000
         SPACE 2                                                        20190000
ACTLOOP  EQU   *                                                        20220000
         BCT   RRET,ACTPOS              IF NOT LAST POSITION , COMPARE  20250000
         SPACE 2                                                        20280000
RETURNA  EQU   *                                                        20310000
         L     R9,LCBINVPT-1            GET INV LIST POINTER            20340000
         LA    R9,ZERO(,R9)             CLEAR HIGH ORDER BYTE           20370000
         SR    RENTRY,RWORK1            POINT TO FIRST OF ENTRY         20400000
         CR    RENTRY,R9                WHERE IS ENTRY COMPARED TO      20430000
*                                         LCBINVPT?                     20460000
         BH    ARND                     DON'T UPDATE LCBINVPT           20490000
         STH   RLENGTH,AVTSAVE3+TWO     LENGTH OF EACH ENTRY   @OX12530 20520000
         SR    RRET,RRET                CLEAR REGISTER         @OX12530 20550000
         IC    RRET,ONE(,RLIST)         NO. ACTIVE ENTRIES     @OX12530 20580000
         MH    RRET,AVTSAVE3+TWO        TOTAL LENGTH OF ENTRIES@OX12530 20610000
         LA    RRET,EIGHT(RRET,RLIST)   ADDR OF END OF LIST    @OX12530 20640000
*                                        INDICATOR             @OX12530 20670000
         CLI   ZERO(RRET),FE            END OF LIST            @OX12530 20700000
         BE    NOTEOT1                  YES, BRANCH            @OX12530 20730000
         LA    RRET,ONE(,RRET)          ADJUST FOR EOT CHARACT @OX12530 20760000
NOTEOT1  EQU   *                                               @OX12530 20790000
         CR    RRET,R9                  R9 IN INVITATION LIST  @OX12530 20820000
         BL    ARND                     NO, DON'T CHANGE LCB   @OX12530 20850000
         ALR   R9,RLENGTH               ADJUST LCBINVPT                 20880000
         IC    RDCB,LCBINVPT-1          SAVE HIGH ORDER BYTE            20910000
         ST    R9,LCBINVPT-1            UPDATE POINTER                  20940000
         STC   RDCB,LCBINVPT-1          RESTORE HIGH ORDER BYTE         20970000
         SPACE                                                          21000000
ARND     EQU   *                                                        21030000
         SR    RRET,RRET                CLEAR REGISTER         @OX12530 21060000
         IC    RRET,ONE(,RLIST)         GET                             21090000
         LA    RRET,ONE(,RRET)          AND INCREMENT                   21120000
         STC   RRET,ONE(,RLIST)         NUMBER OF ACTIVE ENTRIES        21150000
         NI    AVTDOUBL+TWO,XFF-ORDERBIT   TURN OFF BIT                 21180000
         B     MOVESPEC                 CHECK TO SEE IF ANYMORE TO MOV) 21210000
         SPACE 2                                                        21240000
ACTPOS   EQU   *                                                        21270000
         CLC   ZERO(ONE,RENTRY),AVTDOUBL+SEVEN  ENTRY IN RIGHT POSITION 21300000
         BL    RETURNA                  PREVIOUS ENTRY LESS, FINISHED   21330000
         SPACE 2                                                        21360000
         OI    AVTDOUBL+TWO,ORDERBIT    TRYING TO ARRANGE               21390000
         B     SWAPLOP2                 GO SWAP ENTRIES                 21420000
         SPACE 2                                                        21450000
CKPOS    EQU   *                                                        21480000
         SR    RENTRY,RLENGTH           BACK UP ONE                     21510000
         SR    RWORK,RLENGTH            ENTRY                           21540000
         B     ACTLOOP                  GO CHECK FOR CORRECT ORDER      21570000
         SPACE 2                                                        21600000
MACTIVE1 EQU   *                                                        21630000
         BCTR  RENTRY,ZERO              BACK UP TWO FOR EOT-FE          21660000
         BCTR  RWORK,ZERO                                               21690000
         MVC   AVTSAVE3+TWO(TWO),ZERO(RENTRY)  SAVE EOT-FE              21720000
         EX    RWORK1,MOVEACT1          MOVE TO ACTIVE                  21750000
         LR    RRET,RENTRY              RESET TO                        21780000
         ALR   RRET,RLENGTH               MOVE EOT-FE                   21810000
         MVC   ZERO(TWO,RRET),AVTSAVE3+TWO   RESET EOT-FE               21840000
         B     MACTIVE2                                                 21870000
         SPACE 2                                                        21900000
*        CHECK FOR GENERAL POLL ACTIVE. (TERMINAL ATTACHED VIA 3705)  * 21930000
         SPACE 2                                                        21960000
YES3705  EQU   *                                               @XM05658 21990000
         SR    ROFF,ROFF                                       @XM05658 22020000
         LH    ROFF,LCBTTCIN                                   @XM05658 22050000
         LR    R14,RTERM                                       @XM05658 22080000
         LA    R15,TRMPRFSZ             TRM PREFIX SIZE        @XM05658 22110000
         SR    R14,R15                  PREFIX ADDRESS         @XM05658 22140000
         CLI   TRMTYPE-IEDNTRM(R14),TRMCLUST IF CLUSTER        @XM05658 22170000
         BE    ISCLUS                         BRANCH           @XM05658 22200000
         TM    TRMBYTE0-IEDNTRM(R14),TRMGP   IF GP TERMINAL    @XM05658 22230000
         BZ    CHKSPEC                        DO NOT BRANCH    @XM05658 22260000
         TM    TRMBYTE2-IEDNTRM(R14),TRMGPACT IF GP IS ACTIVE  @XM05658 22290000
         BO    FINDCU                          BRANCH          @XM05658 22320000
CHKSPEC  TM    TRMBYTE2-IEDNTRM(R14),TRMRSACT IF TERMINAL IS   @XM05658 22350000
         BZ    RETDISP1                        INACTIVE,BRCH   @XM05658 22380000
         TM    TRMBYTE0-IEDNTRM(R14),TRMSNA   IF SNA TERMINAL  @XM05658 22410000
         BO    DACTSNA                         BRANCH          @XM05658 22440000
         TM    TRMBYTE0-IEDNTRM(R14),TRMINPUT IF CANNOT SEND   @XM05658 22470000
         BZ    RETDISP1                        DATA, BRANCH    @XM05658 22500000
         NI    TRMBYTE2-IEDNTRM(R14),AVTEFF-TRMRSACT    RESET  @OZ36230 22510022
         B     GENMSG                    GENERATE MSG          @OZ36230 22520022
FINDCU   L     R15,AVTRNMPT           LOAD TTE ADDR SEARCH RT  @XM05658 22560000
         OI    AVTDOUBL+TWO,CUSW      MUST SEND TERM VARY CMD  @XM05658 22590000
         LR    RWORK1,R1             SAVE POST LIST ENTRY ADDR @OY19464 22620000
         SR    R1,R1                 INSURE THAT HI BYTES ZERO @XM05658 22650000
NEXTCOH  LH    R1,TRMCOHRT-IEDNTRM(R14) LOAD COHORT TTCIN      @XM05658 22680000
         LR    ROFF,R1                STORE TTCIN              @XM05658 22710000
         BALR  R14,R15                GO GET TTE ADDR          @XM05658 22740000
         LR    R14,R1                 MOVE TTE ADDR            @XM05658 22770000
         LA    R1,TRMPRFSZ            GET PREFIX               @XM05658 22800000
         SR    R14,R1                  ADDR                    @XM05658 22830000
         CLI   TRMTYPE-IEDNTRM(R14),TRMCLUST HAS CLUSTER BEEN  @XM05658 22860000
         BNE   NEXTCOH                 FOUND? NO, BRANCH       @XM05658 22890000
         LR    R1,RWORK1               RESTORE POST LIST ADDR  @OY19464 22920000
         STH   ROFF,GENPOLLT             SAVE GEN POLL TNT     @OZ35509 22930022
ISCLUS   EQU   *                                               @XM05658 22950000
         BAL   R14,COMPTRMN           GET ADDR TO TERM NAME    @XM05658 22980000
         BAL   R14,BLANKS             STRIP BLANKS FROM NAME   @XM05658 23010000
         BAL   R14,PREFIX             SET UP BUFFER PREFIX     @XM05658 23040000
         BAL   R14,MOVEDATA           MOVE COMMAND INTO BUFFER @XM05658 23070000
         TM    AVTDOUBL+TWO,CUSW      IS TERM COMMAND NEEDED   @XM05658 23100000
         BNO   POSTIT                  NO, BRANCH              @XM05658 23130000
         ST    RBFR,AVTSAVE3          SAVE BUFFER ADDR         @XM05658 23160000
         LR    ROFF,RBFR                                       @XM05658 23190000
         L     RBFR,PRFLINK-ONE       GET NEXT BFR IN CHAIN    @XM05658 23220000
         MVC   PRFLINK-IEDQPRF(THREE,ROFF),PRFLINK CHAIN BUFF  @XM05658 23250000
ISSPEC   LH    ROFF,LCBTTCIN          GET TERMINAL TTCIN       @XM05658 23280000
         N     ROFF,AVTCLRHI          ZERO HI BYTES            @XM05658 23310000
         BAL   R14,COMPTRMN           GET TERMINAL NAME        @XM05658 23340000
         BAL   R14,BLANKS             STRIP BLANKS FROM NAME   @XM05658 23370000
         BAL   R14,PREFIX             SET UP BUFFER            @XM05658 23400000
         BAL   R14,MOVEDATA           MOVE COMMAND             @XM05658 23430000
         BAL   R14,POST               POST BUFFER              @XM05658 23460000
         TM    AVTDOUBL+TWO,CUSW      WAS CLUS CMD BUILT?      @XM05658 23490000
         BNO   CHCKINTV               NO, SEE IF INTV SPECIF'D @XM05658 23520000
         L     RBFR,AVTSAVE3          RESTORE ADDR OF CMD      @XM05658 23550000
POSTIT   BAL   R14,POST               POST BUFFER              @XM05658 23580000
         B     CHCKINTV               SEE IF INTV SPECIFIED    @XM05658 23610000
         SPACE 2                                                        23640000
*   THIS SUBROUTINE COMPUTES ADDRESS OF TERMNAME AND ALSO               23670000
*   COMPUTES LENGTH-1 OF NAME.  (THIS IS LATER USED FOR EX MVC)         23700000
         SPACE                                                          23730000
COMPTRMN EQU   *                                                        23760000
         LR    R0,RRET                  SAVE RETURN ADDRESS             23790000
         L     RTNT,AVTRNMPT            GET ADDR OF TRMNAME TABLE       23820000
         SR    RLENGTH,RLENGTH          CLEAR REG                       23850000
         IC    RLENGTH,TNTENLEN         GET LENGTH OF NAME FIELD        23880000
         LA    RWORK,THREE(,RLENGTH)   ADJUST ENTRY WITH LENGTH OF      23910000
*                                             ADDR. FIELD               23940000
         LR    RSAV,ROFF                SAVE TNT VALUE                  23970000
         BCTR  RSAV,ZERO                ADJUST TNT OFFSET BEFORE MULT   24000000
         MR    RSAV-ONE,RWORK           COMPUTE OFFSET WITHIN TABLE     24030000
         LA    RWORK,TNTFIRST(RSAV)     ADDR OF TERMNAME ENTRY          24060000
         LR    RRET,R0                  GET RETURN ADDRESS              24090000
         BR    RRET                     RETURN                          24120000
         SPACE                                                          24150000
BLANKS   EQU   *                                                        24180000
         LR    RWORK1,RWORK             MAKE SURE NAME IS NOT PADDED    24210000
         ALR   RWORK1,RLENGTH              WITH BLANKS                  24240000
TRYAGIN  EQU   *                                                        24270000
         BCTR  RLENGTH,ZERO             DECR. LENGTH                    24300000
         BCTR  RWORK1,ZERO              LOOK AT LAST BYTE OF NAME       24330000
         CLI   ZERO(RWORK1),AVTEBLNK    IS IT A BLANK?                  24360000
         BE    TRYAGIN                  LOOK AT NEXT ONE                24390000
         BR    RRET                                                     24420000
         SPACE 2                                                        24450000
PREFIX   EQU   *                                                        24480000
         ST    RRET,RRETSAVE            SAVE RETURN ADDRESS    @YM08502 24510000
         SR    RWORK1,RWORK1            CLEAR TO INSERT THE LEN@YM08412 24540000
         ICM   RWORK1,THREE,AVTKEYLE    GET THE UNIT SIZE      @YM08412 24570000
         BCTR  RWORK1,0                 DECREMENT FOR EX       @YM08412 24600000
         EX    RWORK1,CLRINSTR                 ZERO OUT BFR    @YM08412 24630000
         LA    RWORK1,AVTOPCOB          GET ADDR OF OP CTL QCB          24660000
         ST    RWORK1,PRFQCBA-ONE        PUT QCB ADDR INTO PREFIX       24690000
         ST    RLCB,PRFLCB-ONE          SET UP LCB ADDRESS              24720000
         OI    PRFLCB+TWO,POL01         SET BIT FOR SPECIAL CASE        24750000
         TM    AVTDOUBL+TWO,DEACTBIT    DEACT OR VARY?         @YM08412 24780000
         BNO   VARYLENG                 VARY,SKIP SETTING M LEN@YM08412 24810000
         L     RWORK,AVTTCB             GET THE TCB ADDRESS    @YM08528 24840000
         L     RWORK,TCBTIO-IEDQTCB(RWORK) GET THE JOBNAME     @YM08528 24870000
         LA    RLENGTH,EIGHT            LONGEST LENGTH POSSIBLE@YM09083 24900000
         BAL   RRET,BLANKS              STRIP BLANKS           @YM08528 24930000
         LR    RPOINT,RLENGTH           SAVE THE EXACT LENGTH  @YM08528 24960000
         LH    ROFF,LCBTTCIN            GET THE TNT INDEX      @YM08412 24990000
         N     ROFF,AVTCLRHI            CLEAR HIGH ORDER HALF  @YM08412 25020000
         BAL   RRET,COMPTRMN            GET THE TERMNAME       @YM08412 25050000
         BAL   RRET,BLANKS              STRIP BLANKS FROM NAME @YM08412 25080000
         LA    RWORK1,MCMDLEN+TWO(RLENGTH,RPOINT) COMPUTE TOTAL@YM09098 25110000
         B     PTTODATA                 READY TO COMPUTE OFFSET@YM08412 25140000
VARYLENG EQU   *                                               @YM08412 25170000
         LA    RWORK1,VARYLEN+ONE(,RLENGTH) COMPUTE LENGTH OF DATA      25200000
PTTODATA EQU   *                                               @YM08412 25230000
         LA    RWORK1,DATAOFF(,RWORK1)   COMPUTE LENGTH OF DATA         25260000
         STH   RWORK1,PRFSIZE           SET UP SIZE OF DATA IN PREFIX   25290000
         LH    MOVELEN,AVTKEYLE         GET LENGTH OF BFR UNIT          25320000
         MVI   PRFSCAN,C32              OFFSET FOR DATA        @ZM00864 25330000
         CR    RWORK1,MOVELEN           COMPARE LENGTH OF DATA WITH     25380000
*                                         REMAINING SPACE               25410000
         BH    DELINK2                  GET ANOTHER BFR. UNIT           25440000
         LA    RPOINT,PRFLNGTH(,RBFR)   COMPUTE ADDR OF WHERE DATA STS  25470000
         MVI   PRFNBUNT,UNIT01          ONE UNIT BUFFER                 25500000
         MVC   PRFTIC,INVTIC            SET UP TIC FIELD       @OZ33017 25530000
         L     RRET,RRETSAVE            RESTORE RETURN ADDRESS @YM08502 25560000
         BR    RRET                     RETURN                          25590000
         SPACE 2                                                        25620000
MOVEDATA EQU   *                                               @XM05658 25650000
         MVC   ZERO(THREE,RPOINT),VARY  MOVE ' V ' INTO BFR    @XM05658 25680000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR TO NEXT FLD   @XM05658 25710000
         EX    RLENGTH,MOVENAME         MOVE TRM. NAME         @XM05658 25740000
         LA    RPOINT,ONE(RPOINT,RLENGTH) UPDATE POINTER       @XM05658 25770000
         MVC   ZERO(NINE,RPOINT),OFFTP  MOVE REST OF CMD       @XM05658 25800000
         SR    R15,R15                  SET GOOD RETRUN CODE   @XM05658 25830000
         BR    R14                      RETURN                 @XM05658 25860000
DELINK2  EQU   *                                                        25890000
         MVI   PRFNBUNT,UNIT02          TWO UNITS                       25920000
         LH    RWORK1,PRFSIZE           CORRECT SIZE BY SPACE LEFT      25950000
         ALR   RWORK1,MOVELEN              OVER IN LAST UNIT            25980000
         STH   RWORK1,PRFSIZE           RESTORE SIZE                    26010000
         SLR   RWORK1,RWORK1            CLEAR                  @ZM00864 26020000
         IC    RWORK1,PRFSCAN           CORRECT SCAN PTR. BY   @ZM00864 26030000
         ALR   RWORK1,MOVELEN              LEFT OVER IN LAST UNIT       26070000
         STC   RWORK1,PRFSCAN           RESTORE SCAN PTR.      @ZM00864 26080000
         L     RPOINT,PRFLINK-ONE       GET NEXT BFR                    26130000
         ST    RPOINT,PRFTIC            LINK TWO UNITS TOGETHER         26160000
         MVI   PRFTIC,TIC08             SET UP TIC TO NEXT UNIT         26190000
         L     RWORK1,PRFLINK-ONE-IEDQPRF(RPOINT)  GET NEXT BFR         26220000
         ST    RWORK1,PRFLINK-ONE                                       26250000
         MVC   PRFTIC-IEDQPRF(FOUR,RPOINT),INVTIC SET UP TIC   @OZ33017 26280000
         LA    RPOINT,TWELVE(,RPOINT)   POINT TO MSG. FIELD             26310000
         L     RRET,RRETSAVE            RESTORE RETURN ADDRESS @YM08502 26340000
         BR    RRET                     RETURN                          26370000
         SPACE 2                                                        26400000
*    THIS SECTION OF CODE PUTS A BUFFER ON A CHAIN TO                   26430000
*     LATER BE POSTED TO THE DISPATCHER.                                26460000
         SPACE                                                          26490000
POST     EQU   *                                                        26520000
         L     R0,PRFLINK-ONE                                           26550000
         ST    R1,PRFLINK-ONE           PUT OLD BUFFERS ON NEW ONE      26580000
         MVI   PRFPRI,PRIMHBFR          SET UP PRIORITY                 26610000
         LR    R1,RBFR                                                  26640000
         LR    RBFR,R0                  GET NEXT BFR ADDRESS            26670000
         BR    RRET                     RETURN                          26700000
         SPACE 2                                                        26730000
*   THE FOLLOWING SECTION OF CODE SETS UP BUFFERS FOR OPERATOR          26760000
*   CONTROL TO JUST PRINT A MESSAGE SAYING THAT THE TERMINAL            26790000
*   OR THE CONTROL UNIT HAS BEEN STOPPED.                               26820000
         SPACE 2                                                        26850000
*  FIX BUFFER FOR TERMINAL STOPPED                                      26880000
         SPACE                                                          26910000
GENMSG   EQU   *                                                        26940000
         XC    PRFSTAT1(ONE),PRFSTAT1   CLEAR FIELD                     26970000
         LA    RWORK1,AVTOPCOB          GET OPERATOR CONTROL QCB ADDR   27000000
         ST    RWORK1,PRFQCBA-ONE       PUT IT INTO PREFIX              27030000
         LH    ROFF,LCBTTCIN            GET TNT OFFSET                  27060000
         N     ROFF,AVTCLRHI            CLEAR HIGH PART                 27090000
         BAL   RRET,COMPTRMN            GET ADDR OF TRMNAME             27120000
         SPACE                                                          27150000
         BAL   RRET,BLANKS              STRIP BLANKS FROM TERMNAME      27180000
         SPACE                                                          27210000
         ST    RLCB,PRFLCB-ONE          SET UP LCB ADDRESS              27240000
         MVI   PRFNBUNT,UNIT01          SET NO. OF UNITS/BFR            27270000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                27300000
         OI    PRFLCB+TWO,POL02         SET SPECIAL BIT FOR MSG         27330000
         MVC   PRFCRCD-ONE(FOUR),MSG1A  GET MSG NO. FOR TERM.           27360000
         LA    RPOINT,PRFNHDR           WHERE TO MOVE NAME              27390000
         EX    RLENGTH,MOVENAME                                         27420000
         LA    RPOINT,ONE(RLENGTH,RPOINT)  POINT TO FIRST BYTE          27450000
*                                          AFTER NAME                   27480000
         BAL   RRET,PAD                 PAD NAME WITH BLANKS            27510000
         SPACE                                                          27540000
         BAL   RRET,POST                POST MSG BFR                    27570000
         TM    AVTDOUBL+TWO,CUSW        IS THERE A CONTROL UNIT         27600000
*                                          MSG TO PRINT                 27630000
         BNO   CHCKINTV                                                 27660000
         SPACE                                                          27690000
*   BUILD BUFFER FOR CONTROL UNIT                                       27720000
         SPACE                                                          27750000
         XC    PRFSTAT1(ONE),PRFSTAT1   CLEAR FIELD                     27780000
         LA    RWORK1,AVTOPCOB          GET OPERATOR CONTROL QCB ADDR   27810000
         ST    RWORK1,PRFQCBA-ONE       PUT IT INTO PREFIX              27840000
         LH    ROFF,GENPOLLT            GET TNT INDEX FOR CU       @25C 27870027
         N     ROFF,AVTCLRHI            CLEAR HIGH                      27900000
         BAL   RRET,COMPTRMN            COMPUTE TRMNAME ADDRESS         27930000
         SPACE                                                          27960000
         BAL   RRET,BLANKS              STRIP BLANKS FROM TERMNAME      27990000
         SPACE                                                          28020000
         ST    RLCB,PRFLCB-ONE          SET UP LCB ADDRESS              28050000
         MVI   PRFNBUNT,UNIT01          SET NO. OF UNITS/BFR            28080000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                28110000
         OI    PRFLCB+TWO,POL02         SET SPECIAL BIT FOR MSG.        28140000
         MVC   PRFCRCD-ONE(FOUR),MSG90  GET MSG NO. FOR C.U.            28170000
         LA    RPOINT,PRFNHDR           WHERE TO MOVE NAME              28200000
         EX    RLENGTH,MOVENAME                                         28230000
         LA    RPOINT,ONE(RLENGTH,RPOINT)   POINT TO FIRST BYTE         28260000
*                                          AFTER NAAE                   28290000
         BAL   RRET,PAD                 PAD NAME WITH BLANKS            28320000
         SPACE                                                          28350000
         BAL   RRET,POST                POST BUFFER                     28380000
         SPACE                                                          28410000
         B     CHCKINTV                                                 28440000
         SPACE 2                                                        28470000
*   THE FOLLOWING SECTION OF CODE PADS THE TERMINAL NAME                28500000
*   WITH BLANKS TO MAKE IT 8 CHARACTERS LONG.                           28530000
         SPACE                                                          28560000
PAD      EQU   *                                                        28590000
         LA    RLENGTH,ONE(,RLENGTH)    INCR. LENGTH                    28620000
         CH    RLENGTH,HALF8            IS NAME 8 CHARACTERS?           28650000
         BER   RRET                     YES                             28680000
         MVI   ZERO(RPOINT),AVTEBLNK    PAD NAME WITH BLANKS            28710000
         LA    RPOINT,ONE(,RPOINT)                                      28740000
         B     PAD                                                      28770000
         SPACE                                                          28800000
VARYOFF  EQU   *                                                        28830000
         TM    INPFLAG,INPLINE          IS TARGET=LINE SPECIFIED?       28860000
         BO    MOVOFFC                  BR YES                          28890000
         SPACE                                                          28920000
MOVOFFB  EQU   *                                                        28950000
         L     RDCB,LCBDCBPT            GET LCB OR DCB ADDRESS @OY12413 28980000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80      3705 TERM     @OY12413 29010000
         BNO   VARYOFF1                 BRANCH IF NO           @OY12413 29040000
         LR    R14,RTERM                                       @Y17XAMG 29070000
         LA    R15,TRMPRFSZ             TRM PREFIX SIZE        @Y17XAMG 29100000
         SR    R14,R15                  TRM PREFIX ADDRESS     @Y17XAMG 29130000
         TM    TRMBYTE2-IEDNTRM(R14),TRMRSACT   TERM ACTIVE    @Y17XAMG 29143327
*                                                FOR INPUT     @OY12413 29156627
         BO    SNATEST                  O K TO STOP IT             @R1C 29169927
         TM    INPFLAG,INPSTPTI         STOP TERM IMMEDIATE        @R1P 29183227
         BZ    RETDISP1                 NO, INPUT ALREADY STOPPED  @R1A 29196527
*                                       YES, OFFTP,I CAN STOP THE  @R1A 29209827
*                                            PSEUDO-SNA SESSION    @R1A 29223127
SNATEST  EQU   *                                                   @R1A 29236427
         TM    TRMBYTE0-IEDNTRM(R14),TRMSNA      SNA?          @Y17XARR 29250000
         BO    DACTSNA                  YES,REQUEST DEACT      @Y17XARR 29280000
VARYOFF1 EQU   *                                               @OY12413 29310000
         OI    AVTDOUBL+TWO,OFFBBIT     SET UP FOR INTVL IF NEEDED      29340000
         TM    INPFLAG,INPSTPTI         STOP TERM IMMEDIATE        @21A 29344227
         BZ    STOPB                    NO, BRANCH                 @21A 29348427
         OI    AVTDOUBL+TWO,OFFIBIT     SET FOR INTVL IF NEEDED    @21A 29352627
         OI    AVTDOUBL,OFFIBIT         YES, SAVE REQ TYPE         @21A 29356827
         NI    AVTDOUBL+TWO,XFF-OFFBBIT RESET OFFTP,B INDIC.       @21A 29361027
STOPB    EQU   *                                                   @21A 29365227
         LH    ROFF,LCBTTCIN            GET TNT INDEX TO FIND           29370000
         BAL   RRET,COMPTRMN              TRMNAME                       29400000
         SPACE                                                          29430000
         BAL   RRET,BLANKS              STRIP BLANKS FROM TERMNAME      29460000
         SPACE                                                          29490000
         BAL   RRET,PREFIX              SET UP BFR PREFIX               29520000
         SPACE                                                          29550000
         MVC   ZERO(THREE,RPOINT),VARY  MOVE ' V ' CMD INTO BFR         29580000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR. TO NEXT FIELD         29610000
         EX    RLENGTH,MOVENAME         MOVE TRM. NAME INTO BFR         29640000
         LA    RPOINT,ONE(RPOINT,RLENGTH)   UPDATE PTR.                 29670000
         MVC   ZERO(NINE,RPOINT),OFFTPB   MOVE CMD INTO BFR             29700000
         L     ROFF,AVTSAVE3+TWENTY4    RESTORE ADDR OF PARM LIST  @R1A 29703027
         TM    INPFLAG,INPSTPTI         STOP TERM IMMEDIATE        @21A 29706027
         BZ    NOSTPTI                  NO, BRANCH                 @21A 29712027
         MVC   ZERO(NINE,RPOINT),OFFTPBI  MOVE CMD TO BUFFER       @21A 29718027
NOSTPTI  EQU   *                                                   @21A 29724027
         BAL   RRET,POST                GO POST BFR                     29730000
         SR    R15,R15                  CLEAR REG                       29760000
         B     CHCKINTV                 CHECK INTERVAL SPECIFIED        29790000
         SPACE                                                          29820000
DACTSNA  EQU   *                                               @Y17XARR 29850000
         OI    AVTDOUBL+TWO,DEACTBIT    SET FOR INTERVAL       @Y17XARR 29880000
         BAL   RRET,PREFIX              SETUP BFR PREFIX       @Y17XARR 29910000
         MVC   ZERO(THREE,RPOINT),MODIFY MOVE CMD INTO BFR     @Y17XARR 29940000
         LA    RPOINT,THREE(,RPOINT)    BUMP PASSED THE CMD    @Y17XARR 29970000
         L     RWORK,AVTTCB             GET THE TCB ADDRESS    @Y17XARR 30000000
         L     RWORK,TCBTIO-IEDQTCB(RWORK)  GET JOBNAME        @Y17XARR 30030000
         LA    RLENGTH,EIGHT            GET MAX LENGTH         @YM08528 30060000
         BAL   RRET,BLANKS              STRIP BLANKS           @YM08528 30090000
         EX    RLENGTH,MOVENAME         MOVE JOBNAME           @YM08528 30120000
         LA    RPOINT,ONE(RLENGTH,RPOINT) BUMP PASSED JOBNAME  @YM08528 30150000
         MVC   ZERO(SEVEN,RPOINT),DEACT MOVE IN MODIFY CMD TYPE@Y17XARR 30180000
         LA    RPOINT,SEVEN(,RPOINT)    BUMP PASSED M CMD TYPE @Y17XARR 30210000
         LH    ROFF,LCBTTCIN            GET THE TNT INDEX      @Y17XARR 30240000
         N     ROFF,AVTCLRHI            CLEAR HIGH ORDER HALF  @YM08412 30270000
         BAL   RRET,COMPTRMN            GET THE TERMNAME       @Y17XARR 30300000
         BAL   RRET,BLANKS              STRIP BLANKS FROM NAME @Y17XARR 30330000
         EX    RLENGTH,MOVENAME         MOVE RESOURCE NAME     @Y17XARR 30360000
         LA    RPOINT,ONE(RLENGTH,RPOINT) BUMP PASSED RESOURCE @Y17XARR 30390000
         MVI   ZERO(RPOINT),AVTEBLNK    MOVE IN A DELIMITER    @YM09009 30420000
         LA    RPOINT,ONE(RPOINT)       BUMP PASSED THE BLANK  @YM09009 30450000
         BAL   RRET,POST                POST THE BFR           @Y17XARR 30480000
         SR    R15,R15                  ZERO RETCDE            @Y17XARR 30510000
         B     CHCKINTV                 CHECK INTERVAL SPECIFID@Y17XARR 30540000
MOVOFFC  EQU   *                                                        30570000
         OI    AVTDOUBL+TWO,OFFCBIT     SET UP FOR INTV IF NEEDED       30600000
         L     RDCB,LCBDCBPT            GET DCB ADDR.                   30630000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80  IS THIS 3705 TERM.?        30660000
         BNO   MOVOFFC1                 NO-CONTINUE                @11A 30662726
         TM    LCBSTAT2,LCBDIAL         DIAL LCB?                  @11A 30665426
         BZ    FINDGRP                  NO-CONTINUE GROUP          @11A 30668126
*                                       PROCESSING                 @11A 30670826
         OI    LCBSTAT,LCBVSTP          SET INDICATOR FOR          @11A 30673526
*                                       IEDIAM NOT TO SEND ANY     @11A 30676226
*                                       MORE INVITES               @11A 30678926
         OI    LCBSTAT2,LCBNEGRP        INDICATE DISC              @11A 30681626
         B     FINDGRP                  CONTINUE GRP PROCESSING    @11A 30684326
MOVOFFC1 EQU   *                                                   @11A 30687026
         SPACE                                                          30720000
         LA    RLENGTH,TWO              GET LENGTH-1 OF LINE NO.        30750000
         BAL   RRET,PREFIX              SET UP BFR PREFIX               30780000
         SPACE                                                          30810000
         BAL   RRET,FINDUCB             FIND UCB ADDRESS                30840000
         SPACE                                                          30870000
         USING    UCBOB,RDCB            SET UP DSECT                    30900000
         SPACE                                                          30930000
         MVC   ZERO(THREE,RPOINT),VARY  MOVE ' V ' CMD INTO BFR         30960000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR TO NEXT FIELD          30990000
         MVC   ZERO(THREE,RPOINT),UCBNAME  GET LINE NUMBER              31020000
         B     ENDPROC                                                  31050000
         SPACE 2                                                        31080000
FINDGRP  EQU   *                                                        31110000
         LA    RWORK,DCBDDNAM-IHADCB(RDCB)   GET ADDR OF GRPNAME        31140000
         LA    RLENGTH,EIGHT            GET LENGTH OF NAME              31170000
         BAL   RRET,BLANKS              STRIP BLANKS FROM GRPNAME       31200000
         SPACE                                                          31230000
         LA    RLENGTH,FOUR(,RLENGTH)   INCR FOR ',RLN'                 31260000
         BAL   RRET,PREFIX              SET UP BFR PREFIX               31290000
         MVC   ZERO(THREE,RPOINT),VARY  MOVE ' V ' CMD INTO BFR         31320000
         LA    R0,FOUR                  PUT 4 INTO R0                   31350000
         SR    RLENGTH,R0               ADJUST TO LENGTH-1 OF TRMN      31380000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR TO NEXT FIELD          31410000
         EX    RLENGTH,MOVENAME         MOVE GRPNAME INTO BFR           31440000
         ST    RPOINT,AVTSAVE3+SIXTEEN  SAVE ADDR OF GRPNAME FOR        31470000
*                                         INTVL IF NECESSARY            31500000
         STC   RLENGTH,AVTSAVE3+SIXTEEN   SAVE LENGTH OF GRPNAME        31530000
         LA    RPOINT,ONE(RLENGTH,RPOINT)  POINT TO FIELD AFTER NAME    31560000
         MVC   ZERO(ONE,RPOINT),OFFTPC   MOVE IN COMMA                  31590000
         LA    RPOINT,ONE(,RPOINT)      MOVE POINTER ONE MORE           31620000
         LH    ROFF,LCBTTCIN            GET TNT INDEX                   31650000
         TM    LCBSTAT2,LCBDIAL         DIAL?                      @24A 31652127
         BNO   NOTDIAL                  NO                         @24A 31654227
         LR    RWORK1,R1                YES-SAVE R1                @24A 31656327
         SR    R1,R1                    CLEAR FOR                  @24A 31658427
         LR    R1,ROFF                  LCBTTCIN                   @24A 31660527
         L     R15,AVTRNMPT             ADDR TRMNAME TABLE         @24A 31662627
         BALR  R14,R15                  GET TTE FOR DIAL TERM      @24A 31664727
         LA    R15,TRMPRFSZ             PREFIX SIZE                @24A 31666827
         SR    R1,R15                   PREFIX ADDR                @24A 31668927
         LH    ROFF,TRMCOHRT-IEDNTRM(R1) USE CONNECTED LINE'S      @24A 31671027
*                                       TTE TO GET REL LINE NO     @24A 31673127
         LR    R1,RWORK1                RESTORE R1                 @24A 31675227
NOTDIAL  EQU   *                                                   @24A 31677327
         N     ROFF,AVTCLRHI            CLEAR HIGH ORDER PART           31680000
         BAL   RRET,COMPTRMN            GET ADDR OF TERM ENTRY          31710000
         SPACE                                                          31740000
         ALR   RWORK,RLENGTH            POINT TO QCB ADDRESS            31770000
         MVC   AVTDOUBL+FIVE(THREE),0(RWORK)   GET TRM ADDR             31800000
         L     RWORK,AVTDOUBL+FOUR      PUT TRM ADDR INTO REG           31830000
         L     RWORK,TRMDESTQ-ONE-IEDQTRM(RWORK)                        31860000
         SR    RWORK1,RWORK1            CLEAR REG FOR IC                31890000
         IC    RWORK1,QCBRELLN-IEDQQCB(RWORK)  GET REL. LINE NO.        31920000
         CVD   RWORK1,AVTSAVE3+EIGHT    CONVERT REL LINE NO. TO DEC.    31950000
         UNPK  ZERO(THREE,RPOINT),AVTSAVE3+FOURTEEN(TWO)                31980000
         OI    TWO(RPOINT),MASKF0       FIX ZONE FOR LAST DIGIT         32010000
         SPACE                                                          32040000
ENDPROC  EQU   *                                                        32070000
         LA    RPOINT,THREE(,RPOINT)    UPDATE POINTER                  32100000
         MVC   ZERO(NINE,RPOINT),OFFTPC  MOVE IN COMMAND                32130000
         BAL   RRET,POST                POST BFR                        32160000
         SPACE                                                          32190000
         B     CHCKINTV                 SEE IF INTV SPECIFIED           32220000
         SPACE                                                          32250000
FINDUCB  EQU   *                                                        32280000
         SR    R15,R15                  CLEAR FOR IC                    32310000
         IC    R15,LCBUCBX                                              32340000
         SLL   R15,TWO                  MULTIPLY BY FOUR                32370000
         L     RDCB,DCBDEBAD-IHADCB(,RDCB)                              32400000
         L     RDCB,DEBUCBAD-DEBNMSUB(R15,RDCB)                         32430000
         LR    RWORK1,RDCB              SAVE UCB ADDR.                  32460000
         BR    RRET                     RETURN                          32490000
         SPACE 2                                                        32520000
*   THE FOLLOWING SECTION OF CODE CHECKS TO SEE IF THE                  32550000
*   INTERVAL OPTION IS SPECIFIED.                                       32580000
         SPACE                                                          32610000
CHCKINTV EQU   *                                                        32640000
         L     ROFF,AVTSAVE3+TWENTY4    GET ADDR OF PARM LIST           32670000
         TM    INPFLAG,INPINVL          IS INTERVAL SPECIFIED           32700000
         BZ    RETDISP2                                                 32730000
         SPACE                                                          32760000
*   BUILD TIME DELAY QUEUE ELEMENT                                      32790000
         SPACE                                                          32820000
         MVI   PRFNBUNT,EIGHT           SET UP OFFSET FOR TIME DELAY    32850000
         IC    R9,INPLEN                GET LENGTH OF PARMLIST          32880000
         LA    RWORK,ENDACT             LOAD FE INTO WORK REG.          32910000
         NR    R9,RWORK                 MAKE SURE LENGTH IS EVEN        32940000
         LA    RWORK,TWO                LOAD 2 INTO WORK REG            32970000
         SR    R9,RWORK                 GET TO INTERVAL OPTION FIELD    33000000
         LH    R9,INPIND(R9)            R9 NOW CONTAINS HWD INTVL       33030000
         STH   R9,PRFSRCE               SET UP PREFIX FOR TIME          33060000
*                                          DELAY QUEUE                  33090000
         MVI   PRFSIZE,EIGHT                                            33120000
         LA    R9,QCBNAME                                               33150000
         ST    R9,PRFTIC                                                33180000
         MVI   PRFPRI,PRIRELSE          SET PRIORITY                    33210000
         TM    AVTDOUBL+TWO,OFFCBIT     WAS OFFTP,C SPECIFIED?          33240000
         BNO   GETNDX                                                   33270000
         SPACE                                                          33300000
         MVI   PRFTIC,OFFCBIT           SET OFFTP,C BIT                 33330000
         L     RDCB,LCBDCBPT            GET DCB ADDR.                   33360000
         TM    DCBDSORG-IHADCB(RDCB),AVTE80  IS THIS A 3705 TERM?       33390000
         BO    MOVERLN                  YES                             33420000
         SPACE                                                          33450000
         LA    RLENGTH,THREE            GET LINE NO. INSTEAD OF TERM    33480000
         LA    RWORK,UCBNAME-UCBOB(,RWORK1) ADDRESS OF LINE NO.         33510000
         B     CONTIN                                                   33540000
         SPACE                                                          33570000
MOVERLN  EQU   *                                                        33600000
         SR    RLENGTH,RLENGTH          CLEAR FOR IC                    33630000
         IC    RLENGTH,AVTSAVE3+SIXTEEN  GET LENGTH-1 OF GRPNAME        33660000
         LA    RLENGTH,FIVE(,RLENGTH)   ADD 5 FOR ',RLN' & ADJUST       33690000
*                                          LENGTH BY ONE                33720000
         L     RWORK,AVTSAVE3+SIXTEEN   GET ADDR OF GRPNAME,RLN         33750000
         B     CONTIN                                                   33780000
         SPACE                                                          33810000
GETNDX   EQU   *                                                        33840000
         LH    ROFF,LCBTTCIN            GET TNT INDEX                   33870000
         TM    AVTDOUBL+TWO,CUSW         GEN POLL STOPPED      @OZ35509 33875022
         BZ    USELCBTT                  NO , USE LCBTTCIN     @OZ35509 33880022
         LH    ROFF,GENPOLLT             USE GEN POLL TNT      @OZ35509 33885022
USELCBTT EQU   *                                               @OZ35509 33890022
         BAL   RRET,COMPTRMN            COMPUTE TERMNAME ADDRESS        33900000
         SPACE                                                          33930000
         BAL   RRET,BLANKS              STRIP BLANKS FROM TERMNAME      33960000
         SPACE                                                          33990000
         LA    RLENGTH,ONE(,RLENGTH)    STORE CORRECT LENGTH            34020000
         TM    AVTDOUBL+TWO,OFFIBIT     WAS CMD OFFTP,I?           @21A 34026027
         BZ    CHKOFFB                  NO, BRANCH                 @21A 34032027
         MVI   PRFTIC,OFFIBIT           SET BIT FOR OFFTP,I        @21A 34038027
CHKOFFB  EQU   *                                                   @21A 34044027
         TM    AVTDOUBL+TWO,OFFBBIT     WAS CMD OFFTP,B?                34050000
         BNO   CONTINUE                 NO, THEN MUST BE OFFTP,E        34080000
*                                       (NO BIT IS SET FOR OFFTP,E)     34110000
         SPACE                                                          34140000
         MVI   PRFTIC,OFFBBIT           SET BIT FOR ONTP LATER          34170000
CONTINUE EQU   *                                                        34200000
         TM    AVTDOUBL+TWO,DEACTBIT    DEACT?                 @Y17XARR 34230000
         BNO   CONTIN                   NO CONTINUE            @Y17XARR 34260000
         MVI   PRFTIC,DEACTBIT          SET ACTIV LATER        @Y17XARR 34290000
         SPACE                                                          34320000
CONTIN   EQU   *                                                        34350000
         STC   RLENGTH,PRFSIZE+ONE                                      34380000
         LA    RPOINT,PRFNHDR                                           34410000
         BCTR  RLENGTH,ZERO             DECR FOR EXECUTE                34440000
         EX    RLENGTH,MOVENAME         MOVE TERMINAL NAME              34470000
*   CODE MAY BE ADDED LATER TO SAVE CONTROL UNIT ADDRESS INSTEAD        34500000
*   OF TERMNAME.  IN THAT CASE A ZERO WILL BE STORED AT PRFSIZE+1       34530000
*   TO INDICATE CONTROL UNIT ADDRESS                                    34560000
         SPACE                                                          34590000
         ST    R1,AVTDOUBL              SAVE CHAIN OF ELEMS             34620000
         LR    R1,RBFR                  GET ADDR OF TIME DELAY QELEM    34650000
         L     RBFR,PRFLINK-1           GET NEXT BFR ADDR               34680000
         XC    PRFLINK-IEDQPRF(THREE,R1),PRFLINK-IEDQPRF(R1)            34710000
         L     R15,AVTHG01              GET READY TO PLACE ELEM.        34740000
         LA    RAVT,AVTSAVE3               ON TIME DELAY QUEUE          34770000
         BALR  R14,R15                                                  34800000
         SPACE                                                          34830000
         SH    RAVT,HALF48              RESTORE REG 13                  34860000
         SR    R15,R15                  CLEAR R15                       34890000
         L     R1,AVTDOUBL              RESTORE R1                      34920000
         B     RETDISP2                 RETURN                          34950000
         SPACE 2                                                        34980000
*    RETURN TO THE DISPATCHER                                           35010000
         SPACE                                                          35040000
RETDISP  EQU   *                                                        35070000
         SR    RBFR,RBFR                CLEAR REG                       35100000
         SPACE                                                          35130000
RETDISP1 EQU   *                                                        35160000
         L     R1,AVTSAVE3+TWENTY       RESTORE POST LIST               35190000
         SPACE                                                          35220000
RETDISP2 EQU   *                                                        35250000
         LA    RBFR,ZERO(,RBFR)         ZERO HIGH ORDER BYTE            35280000
         LTR   RBFR,RBFR                ANY BUFFERS TO REMOVE           35310000
         BZ    NOXTRAS                    BRANCH NO                     35340000
         SPACE                                                          35370000
         SR    R14,R14                  CLEAR                           35400000
         LR    R0,RBFR                  SAVE FIRST UNIT ADDRESS         35430000
         SPACE                                                          35460000
NEXTRET  EQU   *                                                        35490000
         CLC   PRFLINK,AVTFZERO         END OF CHAIN                    35520000
         BE    RETFND                     BRANCH YES                    35550000
         SPACE                                                          35580000
         L     RBFR,PRFLINK-1           NEXT UNIT                       35610000
         BCT   R14,NEXTRET                COUNT UNITS AND BRANCH        35640000
         SPACE                                                          35670000
RETFND   EQU   *                                                        35700000
         TM    AVTBFRFG,AVTBFRTN        RETURN UNITS HI OR LO      @22C 35705627
         BNO   ONTOP                    BR, RETURN HI              @22C 35711227
         NC    AVTBFREB+1(3),AVTBFREB+1  ANY UNITS AVAILABLE       @22C 35716827
         BZ    NOCOR                    NO, BRANCH                 @22C 35722427
         L     RPOINT,AVTSELCH-1        GET LAST UNIT ADDRESS      @22C 35728027
         STCM  R0,SEVEN,PRFLINK-IEDQPRF(RPOINT) ADD NEW UNIT       @23C 35733627
NOCOR    EQU   *                                                   @22C 35739227
         STCM  RBFR,7,AVTSELCH          SET ADDR OF LAST UNIT      @22C 35744827
         XC    PRFLINK,PRFLINK          CLEAR LINK FIELD           @22C 35750427
         NC    AVTBFREB+1(3),AVTBFREB+1  ANY UNITS AVAILABLE       @22C 35756027
         BNZ   ONTOPOF                  YES, BRANCH                @22C 35761627
ONTOP    EQU   *                                                   @22C 35767227
         MVC   PRFLINK(3),AVTBFREB+1    LINK UNIT INTO CHAIN       @22C 35772827
         STCM  R0,SEVEN,AVTBFREB+1      RESET BUFFER POINTER       @23C 35778427
ONTOPOF  EQU   *                                                   @22C 35784027
         LH    R0,AVTAVFCT              AVAILABLE COUNT                 35790000
         N     R0,AVTCLRHI              CLEAR HIGH ORDER BYTE           35820000
         BCTR  R14,ZERO                 DECREMENT R14                   35850000
         LPR   R14,R14                  CONVERT TO POSITIVE             35880000
         ALR   R0,R14                   ADD NUMBER RETURNED             35910000
         STH   R0,AVTAVFCT              STORE UPDATED COUNT             35940000
         DROP  RLCBX                                           @OS77950 35970000
         USING IEDQDISP,RDISP                                  @OS77950 36000000
NOXTRAS  EQU   *                                                        36030000
         L     RDISP,AVTEA              RESTORE DISPATCHER ADDRESS      36060000
         LTR   RBASE,RBASE              CHECK ENTRY                     36090000
         BNP   NEXTEL                     ENTRY FROM IEDQBD -  @Y17XAMX 36120000
         BAL   R14,DSPCHAIN                                    @Y17XAMX 36150000
*                                       RETURN IS TO DISPATCHER         36180000
NEXTEL   EQU   *                                                        36210000
         LTR   R1,R1                    IS THERE ANOTHER ELEMENT        36240000
         BZ    GOTOUI                   NOTHING ON ELEM. CHAIN          36270000
         L     R9,FOUR(,R1)             NEXT ELEMENT ADDRESS            36300000
         BAL   R14,DSPPOSTR             INSERT ELEMENT ON READY Q       36330000
         SPACE                                                          36360000
         LA    R1,0(,R9)                CLEAR HIGH ORDER BYTE           36390000
         B     NEXTEL                   POST ANOTHER ELEMENT            36420000
         SPACE                                                          36450000
GOTOUI   EQU   *                                                        36480000
         L     RBASE,AVTUI              RETURN IS TO IEDQUI             36510000
         L     RAVT,AVTPARM             RESTORE SAVE AREA ADDRESS       36540000
         B     FOUR(,RBASE)               RETURN TO IEDQUI              36570000
GETBFR   EQU   *                                                        36600000
         LH    R0,AVTAVFCT              AVAILABLE UNIT COUNT            36630000
         N     R0,AVTCLRHI              ACCOUNT FOR 32K+                36660000
         SR    R0,R15                   DECREMENT COUNT                 36690000
         LA    RBFR,AVTBFREB-FOUR       SET FOR FIRST TIME              36720000
*        CONSTANTS                                                      36750000
NEXTBF   EQU   *                                                        36780000
         L     RBFR,PRFLINK-1           NEXT UNIT                       36810000
         LA    RBFR,0(,RBFR)            CLEAR HI BYTE                   36840000
         LTR   RBFR,RBFR                OUT OF UNITS                    36870000
         BZ    SETRT                      YES, SET RET CODE TO 12       36900000
         SPACE                                                          36930000
         SR    RDCB,RDCB                CLEAR REGISTER             @01A 36936012
         LH    RDCB,AVTKEYLE            GET BUFFER LENGTH          @01A 36942012
         BCTR  RDCB,ZERO                ADJUST LENGTH FOR MOVE     @01A 36948012
         EX    RDCB,CLRINSTR            ZERO OUT INSTRUCTION       @02C 36954025
         BCT   R15,NEXTBF               LOOP TILL ALL OBTAINED          36990000
         SPACE                                                          37020000
         STH   R0,AVTAVFCT              STORE NEW COUNT                 37050000
         L     R0,AVTBFREB              FIRST UNIT ADDRESS              37080000
         MVC   AVTBFREB+1(THREE),PRFLINK  DELINK UNITS                  37110000
         XC    PRFLINK-ONE(FOUR),PRFLINK-ONE ZERO LINK FIELD OF BFR     37140000
*                                         BUFFER ON THE CHAIN           37170000
         LR    RBFR,R0                  FIRST UNIT ADDRESS TO RBFR      37200000
         BR    RRET                                                     37230000
         SPACE                                                          37260000
SETRT    EQU   *                                                        37290000
         LA    R15,TWELVE               SET RET CODE (NOT ENOUGH BFRS)  37320000
         BR    RRET                     RETURN                          37350000
         SPACE 2                                                        37380000
*   SUBTASK FOR TIME DELAY QUEUE                                        37410000
         SPACE                                                          37440000
         DS    0F                       START ON FULLWORD BDY.          37470000
QCBNAME  EQU   *-8                      DUMMY QCB                       37500000
STCB     DC    AL1(DSPMCPL4)                                            37530000
         DC    AL3(STCB)                                                37560000
ROUTINE  EQU   *                                                        37590000
         USING ROUTINE,R15                                              37620000
         L     RBASE,BASE                                               37650000
         DROP  R15                                                      37680000
         USING IEDQBI,RBASE                                             37710000
         LR    RBFR,R1                                                  37740000
         MVC   AVTDOUBL(ONE),PRFTIC     SAVE TP INDICATOR               37770000
         SR    RLENGTH,RLENGTH          CLEAR REG                       37800000
         IC    RLENGTH,PRFSIZE+1        GET LENGTH                      37830000
*                                          OF TERMNAME                  37860000
         LA    RWORK1,VARYLEN-1(,RLENGTH)  COMPUTE LEN OF DATA @YM08412 37890000
         TM    AVTDOUBL,DEACTBIT        DEACT OR VARY          @YM08412 37920000
         BNO   COMPUTE                  VARY                   @YM08412 37950000
         LA    RWORK1,MCMDLEN+1(,RLENGTH) MODIFY LEN- JOBNME L @YM09098 37980000
         SR    RPARM,RPARM               CLEAR TO SAVE TERMNAME@YM09098 38010000
         IC    RPARM,PRFSIZE+ONE         PICKUP TERMNAME LENGTH@YM09098 38040000
         LR    RPOINT,RWORK1             SAVE THE LEN-JOBNAME L@YM09098 38070000
         L     RWORK,AVTTCB              GET THE TCAM TCB ADDR @YM09098 38100000
         L     RWORK,TCBTIO-IEDQTCB(RWORK) GET JOBNAME PTR     @YM09098 38130000
         LA    RLENGTH,EIGHT             MAXIMUM LENGTH        @YM09098 38160000
         BAL   RRET,BLANKS               GET TOTAL LENGTH-1    @YM09098 38190000
         LA    RLENGTH,ONE(,RLENGTH)     GET TOTAL LENGTH      @YM09098 38220000
         LR    RWORK1,RPOINT             RESTORE LEN-JOBNME L  @YM09098 38250000
         ALR   RWORK1,RLENGTH            GET THE TOTAL LENGTH  @YM09098 38280000
COMPUTE  EQU   *                                               @YM08412 38310000
         LA    RWORK1,DATAOFF(,RWORK1)                                  38340000
         LH    MOVELEN,AVTKEYLE         GET LENGTH OF BFR UNIT          38370000
         SH    MOVELEN,HALF32                                           38400000
         ST    RLCB,PRFLCB-ONE          SAVE LCB ADDRESS                38430000
         MVI   PRFNBUNT,UNIT01          SET UP NO. OF UNITS/BFR         38460000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                38490000
         CR    RWORK1,MOVELEN           COMPARE LENGTH                  38520000
*                                         OF DATA WITH SPACE IN BFR     38550000
         BH    BUF3                                                     38580000
         LA    RPOINT,PRFLNGTH(,RBFR)   COMPUTE ADDR OF WHERE DATA      38610000
*                                          STARTS                       38640000
         MVI   PRFSCAN,C32              SET SCAN POINTER      @ZM00864  38650000
         SPACE                                                          38700000
MOVEIT   EQU   *                                                        38730000
         XC    PRFLINK,PRFLINK          CLEAR LINK FIELD                38760000
         OI    PRFLCB+TWO,POL01         SET SPECIAL BIT                 38790000
         STH   RWORK1,PRFSIZE           SET UP SIZE OF DATA IN          38820000
*                                          PREFIX                       38850000
         LA    RWORK1,AVTOPCOB          GET ADDR OF OP CTL QCB          38880000
         ST    RWORK1,PRFQCBA-1         PUT QCB ADDR INTO PREFIX        38910000
         MVI   PRFPRI,PRIMHBFR          SET PRIORITY TO 'E4'            38940000
         TM    AVTDOUBL,DEACTBIT        DEACT?                 @Y17XARR 38970000
         BNO   VARYCMD                  NO, VARY               @Y17XARR 39000000
         MVC   ZERO(THREE,RPOINT),MODIFY  SET CMD              @Y17XARR 39030000
         LA    RPOINT,THREE(,RPOINT)    POINT PASSED THE CMD   @Y17XARR 39060000
         L     RWORK,AVTTCB             GET TCB ADDR           @Y17XARR 39090000
         L     RWORK,TCBTIO-IEDQTCB(RWORK)   GET JOBNAME       @Y17XARR 39120000
         LA    RLENGTH,EIGHT            MAX LENGTH             @YM08528 39150000
         BAL   RRET,BLANKS              STRIP BLANKS           @YM08528 39180000
         EX    RLENGTH,MOVENAME         MOVE THE JOBNAME       @YM08528 39210000
         LA    RPOINT,ONE(RLENGTH,RPOINT) BUMP PASSED THE NAME @YM08528 39240000
         MVC   ZERO(SEVEN,RPOINT),ACTIV SET MODIFY CMD         @Y17XARR 39270000
         LA    RPOINT,SEVEN(,RPOINT)    POINT PASSED THE CMD   @YM09098 39300000
         LR    RLENGTH,RPARM            RESTORE TERMNAME       @YM09098 39330000
*                                       LENGTH              @YM09098    39360000
         B     MOVENME                  READY TO MOVE THE NAME @Y17XARR 39390000
VARYCMD  EQU   *                                               @Y17XARR 39420000
         MVC   0(THREE,RPOINT),VARY     MOVE 'VARY' CMD        @Y17XARR 39450000
         LA    RPOINT,THREE(,RPOINT)    MOVE PTR. TO NEXT FIELD@Y17XARR 39480000
MOVENME  EQU   *                                               @Y17XARR 39510000
         LA    RWORK,PRFNHDR            GET ADDR OF NAME                39540000
         BCTR  RLENGTH,ZERO             DECR. FOR EXECUTE               39570000
         EX    RLENGTH,MOVENAME         MOVE NAME                       39600000
         ALR   RPOINT,RLENGTH                                           39630000
         LA    RPOINT,ONE(,RPOINT)                                      39660000
         TM    AVTDOUBL,DEACTBIT        DEACT                  @Y17XARR 39690000
         BNO   CKOFFTPC                 CHECK OFFTP,C          @YM09009 39720000
         MVI   ZERO(RPOINT),AVTEBLNK    SET DELIMITER          @YM09009 39750000
         B     NEXT4                    POST THE BUFFER        @YM09009 39780000
CKOFFTPC EQU   *                                               @YM09009 39810000
         TM    AVTDOUBL,OFFCBIT         WAS OFFTP,C SPECIFIED?          39840000
         BNO   NEXT1                    NO                              39870000
         SPACE                                                          39900000
         MVC   ZERO(SIX,RPOINT),ONTP    SET UP CMD FOR ONTP             39930000
         B     NEXT4                                                    39960000
         SPACE                                                          39990000
NEXT1    EQU   *                                                        40020000
         TM    AVTDOUBL,OFFBBIT         WAS OFFTP,B SPECIFIED?          40050000
         BNO   NEXT2                    NO                              40080000
         SPACE                                                          40110000
         MVC   ZERO(EIGHT,RPOINT),ONTPB  SET UP CMD FOR ONTP,B          40140000
         B     NEXT4                                                    40170000
         SPACE                                                          40200000
NEXT2    EQU   *                                                        40230000
         TM    AVTDOUBL,OFFIBIT         STOP TERM IMMEDIATE        @21A 40235027
         BZ    NEXT3                    NO, BRANCH                 @21A 40240027
         MVC   ZERO(NINE,RPOINT),OFFTPBI MOVE CMD TO BUFFER        @21A 40245027
         B     NEXT4                    POST THE BUFFER            @21A 40250027
NEXT3    EQU   *                                                   @21A 40255027
         MVC   0(EIGHT,RPOINT),ONTPE    MOVE CMD ONTP,E INTO BFR        40260000
         SPACE                                                          40290000
NEXT4    EQU   *                                                        40320000
         LR    R1,RBFR                  SET UP                          40350000
         L     RDISP,AVTEA              GET DISPATCHER'S BASE ADDR      40380000
         BAL   R14,DSPCHAIN                 RETURN             @Y17XAMX 40410000
         SPACE                                                          40440000
BUF3     EQU   *                                                        40470000
         LR    R1,RBFR                  PUT BFR BACK ON QUEUE TO        40500000
*                                          WAIT UNTIL A BFR IS FREE     40530000
         LA    R15,ONE                  GET ADDR OF AVAIL BFR           40560000
         BAL   RRET,GETBFR              GET A BUFFER                    40590000
         LTR   R15,R15                  WAS THERE A BUFFER              40620000
         BZ    REMOVE                   YES                             40650000
         LR    RBFR,R1                  RESTORE BFR POINTER    @OZ25852 40680000
         L     RDISP,AVTEA              GET DISPATCHER'S BASE ADDR      40710000
         MVI   PRFPRI,PRISYSDT          NO BUFFERS AVAILABLE,  @OY12681 40740000
*                                        LOWER PRIORITY        @OY12681 40770000
         BAL   R14,DSPPOST         WAIT UNTIL A BFR IS FREE    @Y17XAMX 40800000
REMOVE   EQU   *                                                        40830000
         AR    RWORK1,MOVELEN                                           40860000
         XC    EIGHT(CLEAR,RBFR),EIGHT(RBFR)  CLEAR PART OF PREFIX      40890000
         LR    RPOINT,RBFR                                              40920000
         LR    RBFR,R1                  RESTORE BUFFER POINTER          40950000
         ST    RPOINT,PRFTIC            LINK UNITS TOGETHER             40980000
         MVI   PRFTIC,TIC08             SET UP TIC FIELD                41010000
         MVI   PRFTIC+THREE-IEDQPRF(RPOINT),TIC02  TIC IN SECOND UNIT   41040000
         MVI   PRFTIC-IEDQPRF(RPOINT),TIC08  SET UP TIC FIELD           41070000
         MVI   PRFNBUNT,UNIT02          SET UP NO. OF UNITS/BFR         41100000
         LA    MOVELEN,DATAOFF(,MOVELEN)  COMPUTE SCAN PTR              41130000
         STC   MOVELEN,PRFSCAN          SET SCAN PTR          @ZM00864  41140000
         LA    RPOINT,TWELVE(,RPOINT)                                   41190000
         B     MOVEIT                                                   41220000
         SPACE 2                                                        41250000
*      CONSTANTS & DATA                                                 41280000
         SPACE                                                          41310000
         DS    0F                                                       41340000
SPMASK   DC    X'80000000'              MASK FOR IEDQUI ENTRY           41370000
HALF48   DC    X'0048'                  HALFWORD 48                     41400000
HALF2    DC    H'2'                     HALFWORD OF 2                   41430000
HALF32   DC    H'32'                    HALFWORD OF 32                  41460000
C32      EQU   32                       EQUATE OF 32           @ZM00864 41470000
HALF8    DC    H'8'                     HALFWORD OF 8                   41490000
GENPOLLT DC    H'0'                     GEN POLL TNT SAVEAREA      @25C 41500027
TRMPREFL DC    A(TRMPRFSZ)              PREFIX LENGTH OF TRM   @Y17XARR 41520000
VARY     DC    C' V '                   VARY COMMAND                    41550000
MODIFY   DC    C' F '                   MODIFY COMMAND         @Y17XARR 41580000
ACTIV    DC    C',ACTIV='               ACTIV COMMAND          @Y17XARR 41610000
DEACT    DC    C',DEACT='               DEACT COMMAND          @Y17XARR 41640000
OFFTPB   DC    C',OFFTP,B '             END OF VARY COMMAND             41670000
OFFTPC   DC    C',OFFTP,C '             END OF VARY COMMAND             41700000
OFFTP    DC    C',OFFTP,E '             END OF VARY COMMAND             41730000
OFFTPBI  DC    C',OFFTP,I '             END OF VARY COMMAND        @21A 41745027
ONTP     DC    C',ONTP '                END OF VARY COMMAND             41760000
ONTPB    DC    C',ONTP,B '              END OF VARY COMMAND             41790000
ONTPE    DC    C',ONTP,E '              END OF VARY COMMAND             41820000
X7F7F    DC    X'7F7F'                  CONTROL UNIT CHARS. FOR 3270    41850000
X2222    DC    X'2222'                  CONTROL UNIT CHARS FOR ASCII    41880000
MSGLEN   DC    H'56'                    MAXIMUM LENGTH OF DATA @YM08502 41910000
MSG1A    DC    X'001A0000'              MSG NO. FOR TERMINAL STOPPED    41940000
MSG90    DC    X'00900000'              MSG NO. FOR CU STOPPED          41970000
BASE     DC    A(IEDQBI)                ESTABLISH ADDRESSABILITY        42000000
RRETSAVE DC    F'0'                     REG 14 SAVEAREA        @YM08502 42030000
INVTIC   DC    X'08000002'              LAST UNIT TIC FIELD    @OZ33017 42060000
MOVENAME MVC   ZERO(ZERO,RPOINT),ZERO(RWORK)            MOVE TRM NAME   42090000
SWAP1    XC    ONE(ZERO,RWORK),ONE(RENTRY)    SWAP TWO                  42120000
SWAP2    XC    ONE(ZERO,RENTRY),ONE(RWORK)    SUCCESSIVE ENTRIES        42150000
MOVACT   MVC   ZERO(ZERO,RENTRY),ONE(RENTRY)   MOVE ENTRY               42180000
MOVEACT1 MVC   ZERO(ZERO,RENTRY),TWO(RENTRY)   MOVE ENTRY               42210000
CLRINSTR XC   TWELVE(ZERO,RBFR),TWELVE(RBFR) CLEAR BUFFER      @YM08412 42240000
*        DSECTS                                                       * 42270000
         EJECT                                                          42300000
INPARM   DSECT                                                          42330000
INPIND   DS    AL1                      INDEX TO IEDQBI                 42360000
INPMSK   EQU   X'01'                    MASK NOT SPECIFIED              42390000
INPLEN   DS    AL1                      LENGTH OF PARAMETER LIST        42420000
INPFLAG  DS    XL1                      FLAG BYTE                       42450000
INPCOUNT EQU   X'80'                    COUNT= SPECIFIED                42480000
INPINVL  EQU   X'20'                    INTVL= SPECIFIED                42510000
INPLINE  EQU   X'10'                    TARGET=LINE SPECIFIED           42540000
INPVARY  EQU   X'08'                    VARYOFF MACRO CALL              42570000
INPSTPTI EQU   X'04'                    VARY TERM IMMEDIATE        @21A 42585027
INPMASK  DS    XL5                      ERROR MASK                      42600000
INPCIND  DS    AL1                      INDEX TO IEDQBJ                 42630000
INPCC    DS    XL1                      CONDITION CODE                  42660000
INPNOCLR EQU   X'40'                    CLEAR= NO SPECIFIED             42690000
INPUPDAT EQU   X'20'                    UPDATE= SPECIFIED               42720000
INPUPADD EQU   X'10'                    UPDATE=ADD                      42750000
INPCNINT EQU   X'80'                    COUNT(3) = INTEGER              42780000
INPOPT   DS    AL1                      INDEX TO OPTION FIELD           42810000
INPOPT2  DS    AL1                      OPTION FIELD2 OR 0              42840000
INPINTG  DS    XL4                      INTEGER FOR COUNT(3)            42870000
INPINTV  DS    XL2                      INTERVAL                        42900000
         EJECT                                                          42930000
         TAVTD                                                          42960000
         EJECT                                                          42990000
         DCBD  DSORG=TX                                                 43020000
         EJECT                                                          43050000
         TDEBD                                                          43080000
         EJECT                                                          43110000
         TDISPD                                                         43140000
         EJECT                                                          43170000
         TLCBD                                                          43200000
         EJECT                                                          43230000
         TPRFD                                                          43260000
         EJECT                                                          43290000
         TPRIOR                                                         43320000
         EJECT                                                          43350000
         TQCBD                                                          43380000
         EJECT                                                          43410000
         TSCBD                                                          43440000
         EJECT                                                          43470000
         TTCBD                                                          43500000
         EJECT                                                          43530000
         TTNTD                                                          43560000
         EJECT                                                          43590000
         TTRMD                                                          43620000
         EJECT                                                          43650000
         DSECT                                                          43680000
         IEFUCBOB                                                       43710000
         SPACE 3                                                        43740000
         END                                                            43770000
