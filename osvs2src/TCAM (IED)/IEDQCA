         TITLE 'IEDQCA - RESIDENT OPERATOR CONTROL MODULE'              00100022
IEDQCA   CSECT                                                 @Y17XARX 00130000
         SPACE 3                                                        00200122
*********************************************************************** 00380000
*                                                                     * 00420000
* MODULE NAME = IEDQCA (TCAM, OPERATOR CONTROL)                @Y17XARX 00460000
*                                                                     * 00500000
* DESCRIPTIVE NAME=TCAM OPERATOR CONTROL RESIDENT MODULE              * 00540000
*                                                                     * 00580000
* COPYRIGHT='NONE'                                                    * 00620000
*                                                                     * 00660000
* STATUS = VERSION 10.0                                        @Y17XARX 00700000
*                                                                     * 00740000
* FUNCTION - THIS MODULE SAVES REGISTERS, SETS UP A WAIT LIST, THEN   * 00780000
*        GIVES CONTROL TO THE INITIAL OP CONTROL TRANSIENT VIA SVC 104* 00820000
*        IT CONTAINS THE OPERATOR CONTROL AVT AND SEVERAL SUBROUTINES * 00860000
*        INCLUDING AN OUTPUT SUBTASK ACCESSED DIRECTLY BY TCAM.       * 00900000
*                                                                     * 00940000
* NOTES = COMMUNICATION BETWEEN THE VARIOUS TRANSIENT MODULES  @Y17XARX 00980000
* IS PRIMARILY THROUGH THE OPERATOR CONTROL AVT.               @Y17XARX 01020000
*    DEPENDENCIES = EBCDIC CHARACTER CODE DEPENDENCIES ARE     @Y17XARX 01060000
*    CORRECTABLE BY REASSEMBLY.                                @Y17XARX 01100000
*    RESTRICTIONS = NA                                         @Y17XARX 01140000
*    REGISTER CONVENTIONS = STANDARD                           @Y17XARX 01180000
*    PATCH LABEL = ZAPPATCH                                    @Y17XARX 01220000
*                                                              @Y17XARX 01260000
* MODULE TYPE = PROCEDURE                                      @Y17XARX 01300000
*    PROCESSOR = ASSEMBLER                                     @Y17XARX 01340000
*    MODULE SIZE = 4264 BYTES                                  @Y17XARX 01380000
*    ATTRIBUTES = ATTACHED, RESIDENT, ENABLED, REUSEABLE       @Y17XARX 01420000
*                                                              @Y17XARX 01460000
* ENTRY POINTS - IEDQCA IS PASSED CONTROL BY OS WHEN OPERATOR CONTROL * 01500000
*        IS ATTACHED.                                                 * 01540000
*               SUBROUTINES LISTED BELOW ARE LINKED TO BY VARIOUS     * 01580000
*        TRANSIENTS.                                                  * 01620000
*                   COHORTLK                                   @Y17XARX 01660000
*                   CHORTGLK                                   @Y17XARX 01700000
*                   FREEBUFF                                   @Y17XARX 01740000
*                   TNTENTAD                                   @Y17XARX 01780000
*                   TRMOFLOC                                          * 01820000
*                   DCBLOCAT                                          * 01860000
*                   DECRCT                                     @Y17XARV 01900000
*                   ALLOCBUF                                          * 01940000
*                   LCBSETUP                                          * 01980000
*                   OPCSCAN                                    @OY12425 02020000
*                   PROGRTNE                                   @Y17XARV 02060000
*               THE SUBROUTINE OSTCB IS ENTERED DIRECTLY BY THE TCAM  * 02100000
*        DISPATCHER WHEN THE DUMMY LCB IS POSTED TO ITSELF TO BE FREED* 02300022
*                                                                     * 02400022
*        THE SUBROUTINE OPENCODE IS USED BY IPL TO ISSUE OPENS.@Y17XARX 02410000
*                                                              @Y17XARX 02420000
*        THE SUBROUTINE PROGRTNE SHOULD BE THE LAST SUBROUTINE @Y17XARV 02430000
*        IN THE MODULE.                                        @Y17XARV 02440000
*                                                              @Y17XARV 02450000
* INPUT - TO IEDQCA                                                   * 02500000
*              REGISTER 1 CONTAINS THE ADDRESS OF THE AVT             * 02600022
*              REGISTER 14 CONTAINS THE RETURN ADDRESS                * 02700022
*        TO THE VARIOUS SUBROUTINES                                   * 02800022
*              A PROLOGUE FOR EACH SUBROUTINE DOCUMENTS ITS INPUT     * 02900022
*                                                                     * 03000022
* OUTPUT - FROM IDEQCA                                                * 03100000
*              NONE                                                   * 03200022
*         FROM SUBROUTINES                                            * 03300022
*              OUTPUT IS DOCUMENTED IN EACH SUBROUTINE PROLOGUE       * 03400022
*                                                                     * 03500022
* EXTERNAL REFERENCES - IGC0010D, CALLING ROUTINE                     * 03600000
*                                                                     * 03700022
* EXITS,NORMAL                                                        * 03800000
*   TO TCAM OPERATOR CONTROL VIA SVC 104                              * 03900022
*   TO OS IF CLOSEDOWN IN PROGRESS                                    * 04000022
*                                                                     * 04100022
* EXITS,ERROR - N/A                                                   * 04200000
*                                                                     * 04300022
* TABLES/WORK AREAS - TCAM AVT, OPC AVT, OPCE                         * 04400000
*                                                                     * 04410000
* MACROS = AQCTL, GETMAIN, RETURN, CLOSE, OPEN, DCB,DCBD,POST, @Y17XARX 04420000
* WAIT, QEDIT, XCTL                                            @Y17XARX 04430000
*                                                                     * 04440000
* CHANGE-ACTIVITY = AS FOLLOWS:                                         04450000
*A065500,069300,075500,077200,081500,086500,108200,140000        S22024 04500000
*A142100,190000,320000,327007,3340000,398000,541200,710200       S22024 04520000
*A710340,710420,710640,71900                                     S22024 04540000
*C007000                                                         S22024 04560000
*A675000                                                        SA62344 04580000
*A710340,710420,710640,71900,297000,327385,327392                S22024 04600000
*C532000,534000,536000,540000                                   SA63617 04620000
*A568000,589000                                                 SA67103 04640000
*C694000                                                       @SA69063 04660000
*C199000-201000                                                @XA03954 04680000
*A142600,710000,710660,760000                                  @YA04391 04700000
*C101000                                                       @YA05946 04720000
*C327805,327812                                                @ZA00226 04740000
*A339500                                                       @ZA00226 04760000
*C710001-710022                                                @YA07487 04780000
*C327266                                                       @YA06867 04800000
*D327756-327840,                                               @YA06867 04820000
*D250000-256000,327168-327203,                                 @ZA02068 04840000
*C710001-710017,                                               @YA07497 04860000
*A762000,                                                      @XA06556 04880000
*A589800,                                                      @SA74873 04900000
*A589050,589900,                                               @ZA05044 04920000
*A592000,760500,                                               @XA09783 04940000
*A249000,327161,                                               @OY12414 04960000
*A021000,065000,071000,074000,075500,077600,082000,142800      @OY12425 04980000
*A303000,400000,                                               @OY12425 05000000
*C710680,                                                      @OY12425 05020000
*A474000,489000,508000,                                        @OS76998 05040000
*C479000,482000,                                               @OS76998 05060000
*A709000,                                                      @OZ09915 05080000
*A592420,                                                      @OY13278 05100000
*A013000,017000,024000,045000,065500,069600,074000,075500      @Y17XARX 05120000
*A077600,080000,082000,272000,290000,290600,297800,304000      @Y17XARX 05140000
*A327266,327280,395000,396000,398500,400000,710670,716000      @Y17XARX 05160000
*A718000,720000,741000,745000,746000,760700,775000,778000,     @Y17XARX 05180000
*C007000,007600,220000,292000,297200,297400,297800,302000      @Y17XARX 05200000
*C303000,327259,327280,713000,722000,741000,744000,            @Y17XARX 05220000
*D005000-006000,069300,069600,077400,077600,081500             @Y17XARX 05240000
*D327301-327437,327504-327742                                  @Y17XARX 05260000
*A021500,024600,065700,067000,071500,074500,075700,077300,     @Y17XARV 05280000
*A080500,082500,142970,711902,711909                           @Y17XARV 05300000
*C720200                                                       @Y17XARV 05320000
*A646000                                                       @Y17XAWC 05340000
*C720600                                                       @Y17XAWC 05360000
*A019000,540000,592800,760800,760900,                          @Y17XARV 05380000
*A589220-589250                                                @Y17XARA 05400000
*A000000-999999                                                @Y16XAR0 05420000
*A252000                                                       @OX16389 05420100
*A086500,613000,814000                                         @G36XRRU 05420200
*C712659,712660,712663                                         @ZM47546 05420300
*C768000                                                       @OX19903 05420482
*D628000-629000                                                @OZ28593 05420582
*C712398                                                       @OZ27694 05420682
*A711467                                                       @OY20955 05420782
*C631000                                                       @OZ32786 05420882
*D635000,642000-646005                                         @OZ32786 05420982
*                                                                     * 05440000
*********************************************************************** 05900022
         EJECT                                                          06000022
         SPACE                                                          06100022
*              E Q U A T E S                                            06200022
         SPACE                                                          06300022
RZERO    EQU   0                       REGISTER 0 - BRANCH PARAMETER    06400022
RPARM    EQU   1                       OPC AVT ADDRESS                  06500022
RSWITCH  EQU   1                        SWITCH FOR OPCSCAN     @OY12425 06520000
RLGBAD   EQU   1                        LGB ADDRESS              S22024 06550022
RGSUBPTR EQU   1                       POINTER TO SUBSTRUCT    @Y17XARX 06560000
RCURTTE  EQU   1                        CURRENT TTE ADDR.      @Y17XARV 06570000
ROPCAVT  EQU   2                       POINTER TO OPC AVT               06600022
ROPCE    EQU   3                       POINTER TO CURRENT OPCE          06700022
RTOPOFF  EQU   3                        TTCIN OF TOP RESOURCE  @Y17XARV 06750000
RAVT     EQU   4                       POINTER TO TCAM AVT              06800022
RWORKA   EQU   5                       POINTER TO RESIDENT WORKAREA     06900022
REGTABLT EQU   5                       SAVE TTE TABLE ADDRESS  @Y17XARX 06910000
ROFF     EQU   6                       TIOT OFFSET                      07000022
RTERM    EQU   6                       TERMINAL ENTRY POINTER           07100022
RNUM     EQU   6                        LENGTH REG             @OY12425 07130000
RORGTTE  EQU   6                        ORIGINAL TTE ADDR.     @Y17XARV 07160000
RTNT     EQU   7                       TERM NAME TABLE POINTER          07200022
RTIOT    EQU   7                       TIOT POINTER                     07300022
RUCB     EQU   7                       POINTER TO UCB                   07400022
RLENTH   EQU   7                        LENGTH REG             @OY12425 07430000
RORGOFF  EQU   7                        ORIGINAL OFFSET        @Y17XARV 07460000
RSAVT    EQU   7                        PTR. TO SEC. AVT       @YM03697 07480000
RWORK    EQU   8                       WORK REGISTER                    07500022
RTRMENTA EQU   8                        TERM ENTRY ADDR          S22024 07550022
RPTR     EQU   8                        EOM PTR/WORK AREA      @OY12425 07560000
REGQ     EQU   8                       TTE TYPE TO BE FOUND    @Y17XARX 07570000
RCUROFF  EQU   8                        TTCIN HOLDER           @Y17XARV 07580000
RDEB     EQU   9                       POINTER TO DEB                   07600022
RSTART   EQU   9                        SAVES START ADDRESS    @OY12425 07650000
RWORK1   EQU   9                       WORK REGISTER                    07700022
RQCBPTR  EQU   9                        QCB ADDRESS              S22024 07720022
RTTEBASE EQU   9                       INPUT TTCIN COHORTG     @Y17XARX 07730000
RLASTYPE EQU   9                        TYPE OF LAST RESOURCE  @Y17XARV 07740000
RWAITCHN EQU   9                        A/D WAIT CHAIN POINTER @Y17XARV 07760000
RPREFIX  EQU   10                      POINTER TO BUFFER                07800022
RWORK2   EQU   10                      WORK REGISTER                    07900022
RLEN     EQU   10                      RELATIVE LINE NO.                08000022
RCOHRTPT EQU   10                 SAVE COHORT PTR REGISTER     @Y17XARX 08020000
RCURTYPE EQU   10                       TYPE OF CURRENT        @Y17XARV 08040000
*                                        RESOURCE              @Y17XARV 08060000
ROPCEOFF EQU   10                       OFFSET OF OPCE         @Y17XARV 08080000
RDCB     EQU   11                      DCB POINTER                      08100022
RCIB     EQU   11                      POINTER TO INPUT CIB             08200022
RSCAN    EQU   11                       SCAN PTR FOR ADDR & DDN@OY12425 08220000
RWORK3   EQU   11                       WORK REGISTER          @Y17XARV 08240000
RHRCHY   EQU   11                       HOLDS HIERARCHY PTR.   @Y17XARV 08260000
RBASE    EQU   12                      BASE REGISTER                    08300022
RSAVE    EQU   13                      POINTER TO SAVEAREA              08400022
RRET     EQU   14                      RETURN FROM SUBROUTINES          08500022
RBRNCH   EQU   15                      SUBROUTINE ENTRY AND BASE        08600022
RBRANCH  EQU   15                       BRANCH REG AND BASE REG  S22024 08650022
ADDRESS  EQU   7                       ADDRESS MASK            @G36XRRU 08650100
         SPACE 2                                                        08700022
ALL      EQU   255                 ALL ONES                             08800022
ALTDEST  EQU   X'80'               INDICATE PROCESSING ALTERNATE DEST   08900022
AL0      EQU   0                       LENGTH USED IN EXECUTED INSTRUCT 09000022
AL1      EQU   1                       MOVE LENGTH OF ONE               09100022
AL2      EQU   2                   LENGTH OF 2                          09200022
AL3      EQU   3                       MOVE LENGTH OF THREE             09300022
AL4      EQU   4                       MOVE LENGTH OF 4                 09400022
AL8      EQU   8                       COMPARE LENGTH                   09500022
BACKCHN  EQU   4                       BACKWARD SAVEAREA CHAINING       09600022
BADDD    EQU   X'20'                    NO DDNAME OR LGB       @Y17XARX 09650000
INVALRLN EQU   8                        INDICATE INVALID RLN            09800022
BUFFERB  EQU   X'E4'                    BUFFER ERB PRIORITY             09900022
BUSY     EQU   4                       ROUTINE BEING USED BY MP         10000022
CLRFLAG  EQU   X'0F'                    CLEAR UCB FLAGS        @YA05946 10100056
CVTPTR   EQU   16                       LOW CORE ADDRESS OF CVT         10200022
DDOFF    EQU   24                      OFFSET TO FIRST DD IN TIOT       10300022
DEB      EQU   4                       OFFSET TO DEB                    10400022
ECB      EQU   4                   OFFSET TO OP CONTROL ECB             10500022
EIGHT    EQU   8                       ADD EIGHT TO REGISTER            10600022
ERBBUFF  EQU   8                        OFFSET TO BUFFER ADDRESS        10700022
ERBSTATE EQU   X'41'                   STATE OF ERB TO BD               10800022
OPENED   EQU   X'10'                    DCB IS OPENED MASK       S22024 10820022
NOERRTN  EQU   X'0C'                    NO SYSTEM ERROR RTNS     S22024 10840022
MSG166   EQU   166                      ERROR MSG FOR DCB OPEN   S22024 10860022
*                                       FAILED                   S22024 10880022
FOUR     EQU   4                       ADD FOUR TO REGISTER             10900022
FORCHAIN EQU   8                       FORWARD CAHIN SAVEAREAS          11000022
LINK     EQU   4                        OFFSET TO QUEUE LINKAGE FIELDS  11100022
MPPREQ   EQU   2                   BUFFER REQ FROM MPP                  11200022
OFF00    EQU   0                       ZERO OFFSET FOR LOAD             11300022
OFF01    EQU   1                       ONE OFFSET FOR MOVE              11400022
OFF02    EQU   2                       TWO OFFSET                       11500022
OFF04    EQU   4                       FOUR OFFSET FOR LOAD             11600022
OFF05    EQU   5                   OFFSET OF 5 FOR ERB SETUP            11700022
OFF08    EQU   8                       EIGHT OFFSET FOR MOVE            11800022
OFF09    EQU   9                   OFFSET OF 9 FOR ERB SETUP            11900022
OFF0B    EQU   11                  OFFSET TO TIC ADDR OF 2              12000022
OFF0C    EQU   12                       12 OFFSET                       12100022
OFF0D    EQU   13                      MOVE OFFSET OF 13                12200022
ONE      EQU   1                       VALUE OF 1                       12300022
ONEBUFF  EQU   1                   INDICATE ONE BUFFER                  12400022
OPEN     EQU   X'10'                   INDICATES OPEN DCB               12500022
OPENERR  EQU   1                        DCB NOT OPEN                    12600022
OUTPRI   EQU   X'F9'                   OUTPUT MESSAGE PRIORITY          12700022
PARTREQ  EQU   64                  PARTIAL UNIT REQUEST                 12800022
POST     EQU   X'0C'                   CROSS PARTITION POST             12900022
PRIOFF   EQU   4                        OFFSET TO INPUT PRIORITIES      13000022
PROCESS  EQU   X'20'               INDICATES PROCESS ENTRY              13100022
REST     EQU   36                  LENGTH OF LAST OF OPCE               13200022
SAVEOFF  EQU   0                        OFFSET FOR SUBROUTINES   S22024 13300022
SAVE12   EQU   12                      OFFSET 12 INTO SAVE AREA LINKAGE 13400022
TEN      EQU   10                      ADD 10 TO REGISTER               13500022
THREE    EQU   3                       ADD THREE                        13600022
TIC      EQU   8                        OFFSET TO TIC FIELD IN UNIT     13700022
TIOT     EQU   12                      TIOT OFFSET IN TCB               13800022
TWO      EQU   2                        TWO                      S22024 13900022
TXTRDCB  EQU   X'44'                    INDICATES TCAM DCB FOR A S22024 14000022
*                                       270X                     S22024 14030022
*                                       LINE OR A 3705 CONTROL UNIT     14060022
UNITCNT  EQU   13                  OFFSET TO COUNT GOTTEN               14100022
ZERO     EQU   0                        ZERO                     S22024 14200022
BADNAME  EQU   4                        RETURN CODE INVALID NAME S22024 14210022
SEVEN    EQU   7                        MASK                     S22024 14220022
HEXZERO  EQU   X'00'                    NULL TNT OFFSET ENTRY    S22024 14230022
ISOPEN   EQU   X'10'                    OFLGS MASK               S22024 14240022
LINENT   EQU   X'80'                    LINE ENTRY MASK          S22024 14250022
OPCFRMCA EQU   X'10'                    ENTRY FROM IEDQCA        S22024 14260022
MSG451   EQU   451                                             @YA04391 14270056
HEX40    EQU   X'40'                                           @YA04391 14280056
RLNALL   EQU   X'20'                    INDICATES RLN=ALL      @OY12425 14281000
NUMBER   EQU   X'F0'                    NUMBER INDICATOR       @OY12425 14282000
CHARNINE EQU   C'9'                     CHARACTER INDICATOR    @OY12425 14283000
COMMA    EQU   C','                                            @OY12425 14284000
PARENR   EQU   C')'                                            @OY12425 14285000
CHARC    EQU   C'C'                     CHECK FOR CLEANUP REQ  @YM08113 14285300
CHARF    EQU   C'F'                     CHECK FOR MODIFY CMD   @YM08113 14285600
OH       EQU   C'O'                     CHK OFF OR ON          @OY12425 14286000
RPAREN   EQU   64                                              @OY12425 14287000
LPAREN   EQU   128                                             @OY12425 14288000
BLANK    EQU   C' '                                            @OY12425 14289000
SIX      EQU   6                                               @OY12425 14290000
SLASH    EQU   C'/'                                            @OY12425 14291000
THIRTY6  EQU   36                       REG 14 OFFSET IN SAVE  @Y17XARX 14292000
ABNORX02 EQU   X'02'                    ABNOR RETURN,3705 PROB @Y17XARX 14293000
DCBLMASK EQU   X'03'                    TO LOAD SUBSTRUCT PTR  @Y17XARX 14294000
CHTGMASK EQU   B'0011'                  MASK LOAD COHORTG PTR  @Y17XARX 14295000
COHTMASK EQU   B'0011'                  MASK LOAD COHORT  PTR  @Y17XARX 14296000
TABSIZE  EQU   3                        FOR TABLE BUMP TABLETTE@Y17XARX 14297000
LLH      EQU   X'03'                    LOAD LOGICAL HALFWORD  @Y17XARV 14298000
TYPEMASK EQU   X'01'                    LOAD TYPE FIELD        @Y17XARV 14299000
         EJECT                                                          14300022
*        BASE REGISTERS FOR TCAM CONTROL BLOCKS USED                    14400022
*                                                                       14500022
         USING IEDQAVTD,RAVT           TCAM AVT ADDRESSABILITY          14600022
         USING IEDQOPCE,ROPCE          OPC ELEMENT ADDRESSABILITY       14700022
         USING IEDQPRF,RPREFIX     BUFFER PREFIX BASE                   14800022
         USING IEDQTRM,RTERM       TERM ENTRY ADDRESSABILITY            14900022
         USING IEDQTNTD,RTNT           TNT ADDRESSABILITY               15000022
         SPACE                                                          15100022
         STM   RRET,RBASE,SAVE12(RSAVE) SAVE CALLER'S REGISTERS         15200022
         BALR  RBASE,0             SET BASE REGISTER                    15300022
         USING *,RBASE             ADDRESSABILITY                       15400022
IEDQCA   IEDHJN  SKIPID                                                 15500022
         LR    RAVT,RPARM          SAVE AVT POINTER                     16000022
         L     ROPCAVT,OPCAVTAD    PICK UP OP CONTROL AVT ADDR @YM04671 16100000
         USING OPCAVT,ROPCAVT          OPC AVT ADDRESSABILITY           16200022
         ST    RAVT,OPCAVTPT       SAVE TCAM AVT ADDRESS                16300022
         LA    RWORK,AVTINOUT      PICK UP ADDRESS OF DUMMY IN/OUT      16400022
         ST    RWORK,OSCBINOT      PLACE ADDRESS ON LCB/SCB             16500022
         LA    RWORK,AVTDELEM      GET ADDR OF DUMMY LAST ELM  @YM08486 16530000
         STCM  RWORK,7,OPCPWCHN    INDICATE NO MORE ELEMENTS   @YM08486 16560000
         ST    ROPCAVT,AVTOCGET    PLACE OUR AVT ADDRESS IN TCAM AVT    16800022
         LOAD  EP=IEDKHISC         BRING TOTE HEIRARCHY SCAN   @Y17XARR 16830000
         ST    RZERO,OPCTOTCK      SAVE THE IEDKHISC ADDRESS   @Y17XARR 16860000
         SPACE                                                          16900022
WAIT     EQU   *                                                        17000022
         LA    RWORK,AVTOPCOB+OFF04 GET ECB ADDRESS (TERM INPUT)        17100022
         ST    RWORK,OPCWAIT+OFF04 PLACE ADDRESS IN WAIT LIST           17200022
         L     RWORK,AVTCOMPT      GET CSCB ADDRESS (CONSOLE INPUT ECB) 17300022
         L     RWORK1,OFF00(RWORK) GET CONSOLE ECB ADDRESS              17400022
         ST    RWORK1,OPCWAIT+OFF08 PLACE ECB ADDR IN WAIT LIST         17500022
         MVI   OPCWAIT+OFF08,AVTE80 SET END OF LIST INDICATOR           17600022
         LTR   RWORK1,RWORK1       CIB'S SPECIFIED?                     17700022
         BNZ   CHKINPUT            YES, CHECK FOR INPUT                 17800022
         SPACE                                                          17900022
         MVI   OPCWAIT+OFF04,AVTE80 SET END OF LIST AFTER TERM ECB      18000022
CHKINPUT EQU   *                                                        18100022
         L     RWORK,OFF04(RWORK)  PICK UP CIB ADDRESS                  18200022
         LA    RWORK,ZERO(RWORK)   CLEAR HIGH BYTE                      18300022
         LTR   RWORK,RWORK         ANY CIB'S?                           18400022
         BNZ   XCTL                YES, START COMMAND SERVICING         18500022
         CLC   AVTOPCOB+ONE(THREE),AVTDELAD+ONE ANYTHING QUEUED         18530022
         BNE   XCTL                     YES, SERVICE COMMAND            18560022
         SPACE                                                          18600022
         WAIT  1,ECBLIST=OPCWAIT   WAIT FOR INPUT                       18700022
         MVI   AVTOPCOB+OFF04,AVTEZERO  RESET COMPLETE BIT              18750022
         SPACE                                                          18800022
XCTL     EQU   *                                                        18900022
         OI    OPCSPEC,OPCFRMCA         SET ENTRY FLAG FOR 00    S22024 19000022
         SR    RZERO,RZERO              CLEAR PARAMETER REGISTER S22024 19050022
         LR    RPARM,ROPCAVT       POINT REG 1 TO OPC AVT               19100022
         TOPCTL                    FIRST LOAD OF SVC 104                19200022
         SPACE                                                          19300022
         TM    AVTBIT1,AVTCLOSN    CLOSEDOWN IN EFFECT?                 19400022
         BNO   WAIT                NO, WAIT FOR NEXT INPUT              19500022
         SPACE                                                          19600022
         CLC   OPCWAITO(AL4),AVTFZERO ALL OUTPUT DONE?                  19700022
         BNE   WAIT                NO, WAIT FOR COMPLETION              19800022
         TM    AVTCKELF,AVTCMCPN+AVTCCLCN  MCP CLOSE FINISHED  @XA03954 19900056
*                                          AND CHKPT REQUESTED @XA03954 20000056
         BZ    WAIT                     NO                     @XA03954 20100056
         DELETE EP=IEDKHISC        DELETE BEFORE OPCTL GOES AWA@Y17XARR 20150000
         SPACE                                                          20200022
         RETURN (14,12),T          RESTORE REGS, RETURN TO OS           20300022
         DROP  RBASE               CHANGE BASE REGISTERS                20400022
OPCAVTAD DC    A(OPCAVT)           OPCAVT ADDRESS              @YM04671 20450000
         TITLE 'IEDQCA - TERM NAME OFFSET CALCULATING ROUTINE'          20500022
*********************************************************************** 20600022
*                                                                     * 20700022
*        ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS SVC          * 20800022
*        TRANSIENT MODULES.  THE INPUT IS AS FOLLOWS -                * 20900022
*                   REGISTER 2 - POINTER TO OP CONTROL AVT            * 21000022
*                   REGISTER 3 - POINTER TO THE CURRENT OPCE          * 21100022
*                   REGISTER 4 - POINTER TO THE TCAM AVT              * 21200022
*                   REGISTER 13 - POINTS TO OP CONTROL SAVE AREA      * 21300022
*                   REGISTER 14 - CONTAINS RETURN ADDRESS             * 21400022
*                   REGISTER 15 - CONTAINS ROUTINE ENTRY POINT ADDRESS* 21500022
*                   OPCDOUBL CONTAINS TERMNAME TO BE CHECKED          * 21600022
*                           (LEFT JUSTIFIED PADDED WITH BLANKS)       * 21700022
*        RETURN IS - NORMAL - REGISTER 14 PLUS 0 -                    * 21800022
*                           REGISTER 1 HAS THE TERM ENTRY ADDRESS     * 21900022
*                           OPCE CONTAINS TNT OFFSET(OCTRMTBL) @Y17XARX 21950000
*                   ABNORMAL - REGISTER 14 PLUS 4 -                   * 22100022
*                           INVALID TERMINAL NAME                     * 22200022
*                                                                     * 22300022
*********************************************************************** 22400022
         USING TRMOFLOC,RBRNCH     BASE FOR THIS CODE                   22500022
TRMOFLOC EQU   *                                                        22600022
         STM   RTERM,RWORK3,SAVEOFF(RSAVE) SAVE REGISTERS    @YM08136   22700000
         TM    OCFLAG,OCTOTE       TOTE REQUEST?             @YM08136   22705000
         BNO   FINDMACH            NO,EXECUTE NORMAL PATH    @YM08136   22710000
         L     RPARM,OCCIB         GET THE CIB ADDRESS       @YM08136   22715000
         TM    CIBFLAG-IEDQCIB(RPARM),CIBALT WHICH TO USE    @YM08136   22720000
*                                  TTCIN OR THE NAME?        @YM08136   22725000
         BNO   FINDMACH            USE THE NAME              @YM08136   22730000
         MVC   OCTRMTBL,CIBTTCIN-IEDQCIB(RPARM) SETUP AS REQ @YM08136   22735000
         LH    RPARM,OCTRMTBL      SETUP INTERFACE           @YM08136   22740000
         LR    RWORK2,RRET         SAVE REG 14               @YM08136   22745000
         LR    RWORK3,RBRNCH       SAVE REG 15               @YM08136   22750000
         L     RBRNCH,AVTRNMPT     SETUP TNT CODE ADDRESS    @YM08136   22755000
         BALR  RRET,RBRNCH         GET TERMINAL ENTRY ADDR   @YM08136   22760000
         LR    RBRNCH,RWORK3       RESTORE REG 15            @YM08136   22765000
         LR    RRET,RWORK2         RESTORE REG 14            @YM09002   22770000
         ST    RPARM,OPCTRMWA      SAVE TRM ENTRY ADDRESS    @YM08136   22775000
         B     TRMRETUN            EXIT                      @YM08136   22780000
FINDMACH EQU   *                                             @YM08136   22785000
         L     RTNT,AVTRNMPT       TNT ADDRESSABILITY                   22800022
         SR    RWORK,RWORK         CLEAR COUNTER OFFSET                 22900022
         LH    RWORK1,TNTLEN       GET NUMBER OF TNT ENTRIES            23000022
         N     RWORK1,AVTCLRHI     CLEAR LEFT HALF OF REGISTER          23100022
         SR    RTERM,RTERM         CLEAR REG FOR NAME LENGTH            23200022
         IC    RTERM,TNTENLEN      PICK UP MAXIMUM TERMNAME LENGTH      23300022
         BCTR  RTERM,RZERO         DECREMENT LENGTH FOR EXECUTE         23400022
         LA    RTNT,TNTFIRST       GET FIRST ENTRY ADDRESS              23500022
TESTTRM  EQU   *                                                        23600022
         LA    RWORK,ONE(RWORK)    UPDATE OFFSET COUNTER                23700022
         CR    RWORK,RWORK1        END OF TNT?                          23800022
         BH    TRMERROR            YES, RETURN WITH ERROR               23900022
         SPACE                                                          24000022
         EX    RTERM,COMPNAME      COMPARE NAME                         24100022
         BE    NAMEMAT             CORRECT NAME, CHECK LENGTH           24200022
         SPACE                                                          24300022
         LA    RTNT,FOUR(RTERM,RTNT) POINT TO NEXT ENTRY                24400022
         B     TESTTRM             CHECK FOR END OF TABLE OF NEXT ENTRY 24500022
         SPACE                                                          24600022
COMPNAME CLC   OPCDOUBL(AL0),OFF00(RTNT) COMPARE TERM NAMES             24700022
         SPACE 2                                                        24800022
NAMEMAT  EQU   *                                                        24900022
         LA    RWORK1,SEVEN             SET TO MAXLEN-1        @OY12414 25000000
         CR    RTERM,RWORK1             MAXIMUM SPECIFIED      @OY12414 25100000
         BE    ENTRYOK                  YES, BRANCH            @OY12414 25200000
         TM    OCFLAG,OCMPP             APPL INPUT  ?          @OX16389 25200100
         BO    ENTRYOK                  YES, APPL INPUT OK     @OX16389 25200200
         LA    RWORK1,OPCDOUBL(RTERM)   POINT TO LAST BYTE     @OY12414 25300000
         CLI   OFF01(RWORK1),AVTEBLNK   FOLLOWED BY BLANK      @OY12414 25400000
         BNE   TRMERROR                 NO,RETURN ERROR        @OY12414 25500000
         SPACE                                                          25700022
ENTRYOK  EQU   *                                                        25800022
         STH   RWORK,OCTRMTBL      STORE TNT OFFSET IN OPCE             25900022
         LA    RTNT,ZERO(RTNT,RTERM)    ADD LENGTH TO GET ADDRESS       26000022
         MVC   OPCTRMWA(AL4),OFF00(RTNT) MOVE ADDRESS TO WORD FOR LOAD  26100022
         L     RPARM,OPCTRMWA      PICK UP TERM ENTRY ADDRESS           26200022
         B     TRMRETUN            RETURN WITHOUT ERROR                 26300022
         SPACE                                                          26400022
TRMERROR EQU   *                                                        26500022
         LA    RRET,FOUR(RRET)     RETURN AT ERROR POINT                26600022
TRMRETUN EQU   *                                                        26700022
         LM    RTERM,RWORK3,SAVEOFF(RSAVE) RESTORE REGISTERS   @YM08136 26800000
         BR    RRET                RETURN TO CALLING TRANSIENT          26900022
         TITLE 'IEDQCA - DCB LOOK-UP ROUTINE'                           27000022
*********************************************************************** 27100022
*                                                                     * 27200022
* ROUTINES CALLED = AVTRNMPT(ADDRESS TERMNAME TABLE),          @Y17XARX 27220000
* SAVTNAX(ADDRESS NAT CONV RTN), OPCHORT(ADDR COHORT LOOKUP)   @Y17XARX 27240000
*                                                              @Y17XARX 27260000
*        ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS SVC          * 27300022
*        TRANSIENT MODULES.  THE INPUT IS AS FOLLOWS -                * 27400022
*                   REGISTER 1 IS ZERO                                * 27500022
*                           OPCDOUBL CONTAINS EBCDIC LINE NUMBER      * 27600022
*                           (LEFT JUSTIFIED)                          * 27700022
*                   REGISTER 1 - CONTAINS RLN                         * 27800022
*                           OPCDOUBL CONTAINS DDNAME                  * 27900022
*                           (LEFT JUSTIFIED PADDED WITH BLANKS)       * 28000022
*                   REGISTER 2 - POINTER TO THE OP CONTROL AVT        * 28100022
*                   REGISTER 3 - POINTER TO THE CURRENT OPCE          * 28200022
*                   REGISTER 4 - POINTER TO THE TCAM AVT              * 28300022
*                   REGISTER 13 - POINTS TO OP CONTROL SAVE AREA      * 28400022
*                   REGISTER 14 - CONTAINS RETURN ADDRESS             * 28500022
*                   REGISTER 15 - CONTAINS ROUTINE ENTRY POINT ADDRESS* 28600022
*        RETURN IS - NORMAL - REGISTER 14 PLUS 0 -                    * 28700022
*                           REGISTER 0 HAS THE UCB ADDRESS            * 28800022
*                           REGISTER 1 HAS THE DCB ADDRESS            * 28900022
*                           OPCE CONTAINS THE RLN IN OCRLN     @Y17XARX 28950000
*                              FOR 270X AND 3705.              @Y17XARX 29000000
*                       IF GROUPNAME,RLN LOOKUP THEN:                 * 29020022
*                           REGISTER 0 HAS THE LINE ENTRY ADDRESS     * 29040022
*                           REGISTER 1 HAS THE LGB ADDRESS            * 29060022
*                           OCRSID IN OPCE CONTAINS THE NETWORK@Y17XARX 29064000
*                               ADDRESS OF THE 3705 LINE ONLY. @Y17XARX 29068000
*                           OCTRMTBL IN OPCE CONTAINS THE TNT  @Y17XARX 29072000
*                               OFFSET OF A 3705 LINE IF VALID @Y17XARX 29076000
*                               RLN WAS FOUND. OTHERWISE,IT IS @Y17XARX 29080000
*                               THE TNT OFFSET OF THE GROUP.   @Y17XARX 29084000
*                           OPCTRMWA IN OPCAVT CONTAINS THE    @Y17XARX 29088000
*                               GROUP TTE 3705 LINE ADDR ONLY. @Y17XARX 29092000
*                   ABNORMAL - REGISTER 14 PLUS 4 -                   * 29100022
*                           DDNAME NOR LGB NOT FOUND           @Y17XARX 29150000
*                              REGISTER 0 CONTAINS X'20'              * 29300022
*                           INVALID RELATIVE LINE NUMBER              * 29400022
*                              REGISTER 0 CONTAINS X'08'              * 29500022
*                           DCB NOT OPEN                              * 29600022
*                              REGISTER 0 CONTAINS X'01'              * 29700022
*                            NCP NOT ACTIVE                    @Y17XARX 29710000
*                               REGISTER 0 CONTAINS X'01'      @YM08560 29720000
*                            3705 IS BEING IPLED OR DUMPED      S22024* 29760022
*                               REGISTER 0 CONTAINS X'02'      @Y17XARX 29770000
*                           NAME NOT FOUND IN TNT              @Y17XARX 29780000
*                              REGISTER 0 CONTAINS X'04'       @Y17XARX 29790000
*                                                                     * 29800022
*********************************************************************** 29900022
         USING DCBLOCAT,RBRNCH     ESTABLISH ADDRESSABILTY     @YM03678 29950000
DCBLOCAT DS    0H                                              @Y17XARX 30200000
         B     CONT                     CONTINUE IN LOOKUP RTN @OY12425 30250000
         B     OPCSCAN                  BRANCH TO SCAN ROUTINE @OY12425 30300000
CONT     EQU   *                                               @OY12425 30330000
         STM   RWORKA,RBRNCH,AVTEZERO(RSAVE)  SAVE REGISTERS   @Y17XARX 30360000
         LR    RBASE,RBRNCH        LOAD BASE REGISTER 12       @Y17XARX 30400000
         DROP RBRNCH                                           @YM03678 30430000
         USING DCBLOCAT,RBASE                                  @YM03678 30460000
         L     RWORKA,AVTTCB       GET TCAM TCB ADDRESS                 30500022
         STC   RPARM,OCRLN         PLACE RLN IN OPCE                    30600022
         OI    OCFLAG,OCLINE       INDICATE LINE NO. PROCESSED          30700022
         LTR   RPARM,RPARM         RLN EQUAL ZERO                       30800022
         BE    GETUCB              YES, ADDRESS IN COMMAND              30900022
         SPACE                                                          31000022
         NI    OCFLAG,ALL-OCLINE   CLEAR LINE NO. FLAG                  31100022
         L     RTIOT,TIOT(RWORKA)  GET TIOT ADDRESS                     31200022
         LA    ROFF,DDOFF          POINT TO FIRST DD ENTRY              31300022
         AR    RTIOT,ROFF          ADD START OFFSET TO BASE             31400022
         SR    RLEN,RLEN           CLEAR REGISTER                       31500022
DDLOOP   EQU   *                                                        31700022
         IC    RLEN,OFF00(RTIOT)   GET LENGTH OF DD ENTRY               31800022
         CLI   OFF00(RTIOT),ZERO   OUT OF ENTRIES                       31900022
         BE    GRPRLNLK                 LOOK FOR GROUP ENTRY     S22024 32000022
         SPACE                                                          32100022
         CLC   OFF04(EIGHT,RTIOT),OPCDOUBL IS THIS THE DDNAME?          32200022
         BE    DDFOUND             YES, GET INFO                        32300022
         SPACE                                                          32400022
         AR    RTIOT,RLEN          BUMP TO NEXT DD ENTRY                32500022
         AR    ROFF,RLEN           UPDATE OFFSET                        32600022
         B     DDLOOP                   TRY NEXT ENTRY                  32700022
GRPRLNLK EQU   *                                                 S22024 32700722
         SPACE                                                          32702822
         L     RTNT,AVTRNMPT            TNT ADDRESSABILITY       S22024 32704222
         SR    RWORK,RWORK              CLEAR COUNTER OFFSET     S22024 32704922
         LH    RWORK1,TNTLEN            GET NUMBER OF TNT ENTRIE S22024 32705622
         N     RWORK1,AVTCLRHI          CLEAR LFT HALF OF REG    S22024 32706322
         SR    RTERM,RTERM              CLEAR REG FOR NM LEN     S22024 32707022
         IC    RTERM,TNTENLEN           PICK UP MAX TERM LEN     S22024 32707722
         BCTR  RTERM,RZERO              DEC LENGTH FOR EXECUTE   S22024 32708422
         LA    RTNT,TNTFIRST            GET FIRST ENTRY ADDR     S22024 32709122
TESTTRM2 EQU   *                                                 S22024 32709822
         LA    RWORK,ONE(RWORK)         UPDATE OFFSET COUNTER    S22024 32710522
         CR    RWORK,RWORK1             END OF TNT?              S22024 32711222
         BH    TRMERR                   YES, RETURN WITH ERROR   S22024 32711922
         EX    RTERM,COMPNAM            COMPARE NAME             S22024 32712622
         BE    NAMEMA                   CORRECT NAME, CHECK LEN  S22024 32713322
         LA    RTNT,FOUR(RTERM,RTNT)    POINT TO NEXT ENTRY      S22024 32714022
         B     TESTTRM2                 CHECK FOR END OF TABLE   S22024 32714722
COMPNAM  CLC   OPCDOUBL(AL0),OFF00(RTNT) COMPARE TERM NAMES      S22024 32715422
NAMEMA   EQU   *                                                 S22024 32716122
         LA    RWORK1,SEVEN             SET TO MAXLEN-1        @OY12414 32716700
         CR    RTERM,RWORK1             MAXIMUM SPECIFIED      @OY12414 32717300
         BE    ENTRYO                   YES, BRANCH            @OY12414 32717900
         LA    RWORK1,OPCDOUBL(RTERM)   POINT TO LAST BYTE     @OY12414 32718500
         CLI   OFF01(RWORK1),AVTEBLNK   FOLLOWED BY BLANK      @OY12414 32719100
         BNE   TRMERR                   NO,RETURN ERROR        @OY12414 32719700
*                                                                     * 32720622
ENTRYO   EQU   *                                                 S22024 32721022
         STH   RWORK,OCTRMTBL           STORE TNT OFFSET IN OPCE S22024 32721722
         LA    RTNT,ZERO(RTNT,RTERM)    ADD LENGTH TO GET ADDR   S22024 32722422
         MVC   OPCTRMWA(AL4),OFF00(RTNT) MOVE ADDRESS TO WORD    S22024 32723122
         L     RLGBAD,OPCTRMWA          PICKUP TERM ENTRY ADDR   S22024 32724522
         LR    RTERM,RLGBAD             SAVE TERM ENTRY ADDR     S22024 32725222
         TM    TRMSTATE,TRMPREF         CHK FOR NEG PREFIX     @Y17XARX 32725500
         BNO   BAD                      NO ERROR                 S22024 32725900
         DROP  RTERM                                           @Y17XARX 32726000
         USING IEDNTRM,RTERM            GET ADDRESSABILITY TTE @Y17XARX 32726100
         LA    RWORKA,TRMPRFSZ          DISPLACEMENT IEDNTRM   @Y17XARX 32726200
         SR    RTERM,RWORKA             BACKUP TO NEG PART TTE @Y17XARX 32726300
         CLI   TRMTYPE,TRMGRP           GROUP TTE              @Y17XARX 32726400
         BNE   BAD                      NO,ERROR REG 0 = X'20' @Y17XARX 32726500
         SH    RLGBAD,TWENTY            GET ADDRESS OF LGB       S22024 32727322
         LR    RDCB,RLGBAD              SAVE RESOURCE ID LGB   @Y17XARX 32727400
         SR    RGSUBPTR,RGSUBPTR        CLEAR REGISTER         @Y17XARX 32727500
         ICM   RGSUBPTR,DCBLMASK,TRMSUBST   GET SUBSTRUCT PTR  @Y17XARX 32727600
         BZ    TBLEND                   RETURN ERROR TO CALLER @Y17XARR 32727800
         LR    RWORK2,RGSUBPTR          SAVE SUBSTRUCT PTR     @Y17XARX 32728000
LOOKMORE EQU   *                                               @Y17XARX 32728100
         L     RBRANCH,AVTRNMPT    LOAD REG 15 FOR TNT LOOK RTN@Y17XARX 32728200
         BALR  RRET,RBRANCH             GO TO TNT LOOKUP RTN   @Y17XARX 32728300
         LR    RTERM,RPARM              TTE BASE PTR REGISTER  @Y17XARX 32728700
         LA    RWORKA,TRMPRFSZ          DISPLACEMENT IEDNTRM   @Y17XARX 32728900
         SR    RTERM,RWORKA             BACKUP TO NEG PART TTE @Y17XARX 32729100
         TM    TRMSTATE,TRMLINE         IS IT A LINE           @Y17XARX 32729400
         BZ    TBLEND                   RETURN ERROR TO CALLER @Y17XARX 32729500
         LR    RTRMENTA,RPARM           SAVE TTE ADDRESS       @Y17XARX 32729600
         L     RQCBPTR,TRMDESTQ-ONE     SET UP BASE ADDR QCB   @Y17XARX 32729700
         USING IEDQQCB,RQCBPTR          ESTABLISH ADDRESS QCB  @Y17XARX 32730100
         CLC   OCRLN,QCBRELLN           TEST FOR QCB           @Y17XARX 32730300
         BE    FOUNDIT                  GO FIND NAT RTN        @Y17XARX 32730500
         SR    RPARM,RPARM              CLEAR REGISTER         @Y17XARX 32730800
         ICM   RPARM,DCBLMASK,TRMCOHTG  LOAD COHORTG PTR REG 1 @Y17XARX 32730900
         LR    RWORK2,RPARM             TEMP SAVE COHORTG PTR  @Y17XARX 32731000
         B     LOOKMORE                 START LOOP AGAIN       @Y17XARX 32731100
FOUNDIT  EQU   *                        COMMENT                @Y17XARX 32731200
         USING OPCAVT,ROPCAVT          BASE FOR OPC AVT        @YM07252 32731300
         TM    OPCSPEC,OPCRSTRT        RESTART IN PROGRESS     @YM07252 32731400
         BO    RESTRET                 YES, GOOD RETURN        @YM07252 32731500
         L     RWORKA,AVTSAVTP         GET SAVT ADDR FROM AVT  @Y17XARX 32731600
         STH   RWORK2,OCTRMTBL         TEMP SAVED TTCIN        @Y17XARX 32731700
         USING IEDNSVTD,RWORKA         ESTAB ADDRESS TO SAVT   @Y17XARX 32731800
         L     RBRANCH,SAVTTNTX         GET ADDR NAT CONVR RTN @YM03729 32731900
         DROP  RWORKA                   COMMENT                @Y17XARX 32732200
         LR    RPARM,RWORK2            TTCIN WAS TEMP SAVED    @Y17XARX 32732400
         BALR  RRET,RBRANCH            GO TO NAT CONVERSN RTN  @Y17XARX 32732500
         STH   RBRANCH,OCRSID          STORE NA OF LINE        @Y17XARX 32732700
         LR    RWORKA,RSAVE            SAVE ORIG REG 13        @Y17XARX 32732900
         LA    RSAVE,SAVEDOPC          PASS DCBLOCAT SAVEAREA  @Y17XARX 32733100
         L     RBRNCH,OPCHORT          SETUP ADDR COHORT RTN   @Y17XARX 32733300
         LA    RPARM,TRMPRFSZ           GET NEG PREFIX SIZE    @YM04609 32733400
         AR    RPARM,RTERM              PUT TTE IN PARM REG    @YM04609 32733500
         BALR  RRET,RBRNCH             GO TO COHORT SEARCH RTN @Y17XARX 32733800
         LR    RSAVE,RWORKA            RESTORE ORIG REG 13     @Y17XARX 32733900
         LTR   RZERO,RZERO              ERROR RETURN           @YM03729 32734100
         BZ    BADOPEN                  BAD,SET ERROR EXIT 01  @YM08560 32734300
         LR    RTERM,RPARM              REESTAB ADDRESS TO TTE @Y17XARX 32735900
         LA    RWORKA,TRMPRFSZ          DISPLACEMENT IEDNTRM   @Y17XARX 32736100
         SR    RTERM,RWORKA             BACK TO NEG PART TTE   @Y17XARX 32736400
         TM    TRMBYTE2,TRMRSACT        TEST IF NCP ACTIVE     @Y17XARX 32736500
         BZ    BADOPEN                  SET ERROR X'01' RZERO  @YM08560 32736600
         TM    TRMBYTE2,TRMINPG         IS ACT/DEACT IN PROGRES@Y17XARX 32736700
         BO    BADOPEN                  SET ERROR X'01' RZERO  @YM08560 32737100
RESTRET  EQU   *                                               @YM07252 32737200
         LR    RZERO,RTRMENTA           LOAD ADDR OF TRM ENTRY @Y17XARX 32737300
         B     DCBRETUN                 RETURN TO CALLER       @Y17XARX 32737500
         SPACE                                                          32744122
TBLEND   EQU   *                                                 S22024 32744822
         LA    RZERO,AL8                SET ERROR RETURN CODE    S22024 32745522
         B     ERROR                    RETURN ERROR TO CALLER   S22024 32746222
*                                                                     * 32746522
         SPACE                                                          32746922
TRMERR   EQU   *                                                 S22024 32747622
         LA    RZERO,BADNAME            LOAD ERROR RETURN CODE   S22024 32748322
         B     ERROR                    RETURN ERROR TO CALLER   S22024 32749022
*                                                                     * 32749322
         SPACE                                                          32749722
         SPACE                                                          32774922
BAD      EQU   *                                                 S22024 32784722
         LA    RZERO,BADDD              SET ERROR                S22024 32785422
         B     ERROR                    RETURN                   S22024 32786122
         SPACE                                                          32800022
DDFOUND  EQU   *                                                        32900022
         STH   ROFF,OCTIOT         SAVE OFFSET IN TIOT TO DDENTRY       33000022
GETUCB   EQU   *                                                        33100022
         LA    RDEB,DEB(RWORKA)    POINT BEFORE FIRST DEB ADDRESS       33200022
NEXTDEB  EQU   *                                                        33300022
         SR    RDCB,RDCB                ZERO DCB REG IN CASE DDNAME     33330022
*                                         NOT FOUND                     33360022
         L     RDEB,OFF04(RDEB)    GET ADDRESS OF NEXT DEB              33400022
         LA    RDEB,ZERO(RDEB)     CLEAR HIGH BYTE                      33500022
         LTR   RDEB,RDEB           ANOTHER DEB                          33600022
         BZ    BAD                 NO, ERROR-DCB NOT OPEN      @YM08560 33700000
         USING DEBNMSUB,RDEB            ESTABLISH DEB BASE     @Y17XARX 33750000
         SPACE                                                          33800022
         L     RDCB,DEBDCBAD       GET DCB ADDRESS                      33900022
         USING IHADCB,RDCB             DCB ADDRESSABILITY      @ZA00226 33950056
         TM    DCBDSORG+OFF01,TXTRDCB   DCB FOR 270X OR 3705 ?   S22024 34000022
         BZ    NEXTDEB                  NO, TRY ANOTHER DEB      S22024 34100022
         SPACE                                                          34200022
         TM    OCFLAG,OCLINE       PROCESSING LINE NUMBER?              34300022
         BNO   GETDCB              NO, PROCESS DDNAME                   34400022
         SPACE                                                          34500022
         SR    RWORKA,RWORKA       CLEAR FOR NO OF EXTENTS              34600022
         IC    RWORKA,DEBNMEXT     GET NUMBER OF RLNS                   34700022
         LA    RWORK,DEBUCBAD      GET UCB ADDRESS POINTER              34800022
         LA    RLEN,ONE            SET COUNT TO ONE                     34900022
NEXTUCB  EQU   *                                                        35000022
         L     RUCB,OFF00(RWORK)   GET UCB ADDRESS                      35100022
         CLC   OFF0D(THREE,RUCB),OPCDOUBL THIS THE UCB?                 35200022
         BE    GOTUCB              YES, RETURN INFO                     35300022
         SPACE                                                          35400022
         LA    RLEN,ONE(RLEN)      ADD ONE TO COUNT                     35500022
         LA    RWORK,FOUR(RWORK)        GET NEXT UCB ADDRESS            35600022
         CR    RLEN,RWORKA         ANY MORE EXTENTS?                    35700022
         BNH   NEXTUCB             YES, LOOK AT NEXT UCB                35800022
         SPACE                                                          35900022
         B     NEXTDEB             NO, TRY NEXT DEB                     36000022
         SPACE                                                          36100022
GOTUCB   EQU   *                                                        36200022
         STC   RLEN,OCRLN          SAVE RLN                             36300022
         LR    RWORKA,RUCB         SET PASS FOR UCB ADDRESS             36400022
         MVC   OCLINENO(AL2),OFF04(RWORKA) PLACE LINE NO. IN ELEMENT    36500022
         NI    OCLINENO,CLRFLAG    CLEAR UCB FLAGS                      36600022
         B     UCBRET              RETURN DCB ADDR TO CALLER            36700022
         SPACE                                                          36800022
GETDCB   EQU   *                                                        36900022
         LH    RLEN,DCBTIOT        GET OFFSET TO TIOT                   37000022
         N     RLEN,AVTCLRHI       CLEAR HIGH TWO BYTES                 37100022
         CR    RLEN,ROFF           RIGHT DCB?                           37200022
         BNE   NEXTDEB             NO, TRY NEXT DEB AND DCB             37300022
         SPACE                                                          37400022
         TM    DCBOFLGS,OPEN       DCB OPENED                           37500022
         BNO   BAD                 NO, RETURN ERROR INDICATION @YM08560 37600000
         SPACE                                                          37700022
         LA    RZERO,INVALRLN           SET POSSIBLE ERROR              37800022
         CLC   OCRLN(AL1),DEBNMEXT RLN MORE THAN NO OF EXTENTS          37900022
         BH    ERROR               YES, RETURN ERROR                    38000022
         SPACE                                                          38100022
         LR    RWORKA,RPARM        PICK UP RELATIVE LINE NUMBER         38200022
         SLL   RWORKA,TWO          MULTIPLY BY FOUR                     38300022
         L     RWORKA,DEBUCBAD-OFF04-DEBNMSUB(RWORKA,RDEB) UCB ADDRESS  38400022
         LA    RWORKA,ZERO(RWORKA) CLEAR HIGH BYTE                      38500022
UCBRET   EQU   *                                                        38600022
         LR    RZERO,RWORKA        RETURN UCB ADDRESS                   38700022
         LTR   RWORKA,RWORKA       OPENED DUMMY?                        38800022
         BNZ   DCBRETUN            NO, RETURN GOOD INFORMATION          38900022
         SPACE                                                          39000022
*                  R E T U R N   T O   C A L L E R                      39100022
*                                                                       39200022
BADOPEN  EQU   *                                                        39300022
         LA    RZERO,OPENERR       SET NOT OPEN RETURN CODE             39400022
ERROR    EQU   *                                                        39500022
         L     RRET,THIRTY6(RSAVE)      ADJUST REG 14 IN SAVE  @Y17XARX 39550000
         LA    RRET,FOUR(RRET)     RETURN TO ERROR ROUTINE              39600022
         ST    RRET,THIRTY6(RSAVE)      PUT ADJUSTED REG14 BACK@Y17XARX 39650000
DCBRETUN EQU   *                                                        39700022
         LA    RPARM,AVTEZERO(RDCB)     ZERO HIGH ORDER BYTE AND S22024 39800022
*                                        RETURN DCB ADDRESS      S22024 39850022
         LM    RWORKA,RBRNCH,AVTEZERO(RSAVE)  RESTORE REGISTERS@Y17XARX 39870000
         BR    RRET                RETURN INFORMATION                   40000022
         EJECT                                                          40000400
TWENTY   DC    H'20'                    USED IN OBTAINING LGB  @Y17XARX 40000800
SAVEDOPC DS    18F'0'                   REGSAVE BALR FORMAT    @Y17XARX 40001200
         TITLE 'IEDQCA   -   SCAN ROUTINE FOR OP CONTROL COMMANDS '     40001600
*********************************************************************** 40002000
*                                                                     * 40002400
*        ENTRY TO THIS CODE IS VIA A 'BAL' TO DCBLOOKUP+4 FROM        * 40002800
*        VARIOUS OP CONTROL MODULES WITH A 'DDN,RLN', 'DDN' OR        * 40003200
*        'ADDR' FIELD IN THE OP CONTROL CMD.                          * 40003600
*                                                              @YM04671 40003700
*        THE INPUT IS AS FOLLOWS:                              @YM04671 40003800
*           1. THE FIELD TO BE SCANNED MUST BE FOLLOWED BY ONE @YM04671 40003900
*              OF THESE DELIMITERS:                            @YM04671 40004000
*                 BLANK                                        @YM04671 40004100
*                 RIGHT PAREN                                  @YM04671 40004200
*                 COMMA                                        @YM04671 40004300
*                 SLASH                                        @YM04671 40004400
*                                                              @YM04671 40004500
*           2. REGISTERS CONTAIN FOLLOWING ON INPUT:           @YM04671 40004600
*              R2 - POINTER TO OP CNTRL AVT                           * 40005200
*              R3 - POINTER TO THE OPCE                               * 40005600
*              R4 - POINTER TO THE TCAM AVT                           * 40006000
*              R5 - POINTER TO OP CNTRL WRKAREA                       * 40006400
*              R11 - POINTER TO FIRST BYTE OF SCAN FIELD              * 40007200
*              R13 - POINTER TO OP CNTRL SAVEAREA                     * 40007600
*              R14 - CONTAINS RETURN ADDR TO CALLING MOD              * 40008000
*                                                                     * 40008400
*           3. OCSCAN MUST BE SET TO INDICATE ONE OF           @YM04671 40008500
*              FOLLOWING SETTINGS:                             @YM04671 40008600
*              OCSCAN = X'80' IF PASSED AN ADDR ONLY           @YM04671 40008700
*                       X'70' IF PASSED A DDNAME OR DDNAME,RLN @YM04671 40008800
*                             AND THE RLN CAN BE ALL           @YM04671 40009000
*                       X'40' IF PASSED A DDN,RLN ONLY                * 40009200
*                       X'20' IF PASSED A DDNAME                      * 40009600
*                       X'A0' IF PASSED A DDNAME OR ADDR              * 40010000
*                       X'C0' IF PASSED A DDN,RLN OR ADDR             * 40010400
*                       X'F0' IF PASSED AN ADDR, DDNAME, OR    @YM04671 40010500
*                             A DDN,RLN AND THE RLN CAN BE ALL @YM04671 40010600
*                                                                     * 40010700
*           4. FIELD CANNOT BE PASSED IN OPCDOUBL              @YM04671 40010800
*           5. IF A DDN,RLN IS AN INPUT, OCMODNME WILL BE USED @YM04671 40010900
*              BY OPCSCAN TO CONVERT THE RLN IF ONE EXISTS     @YM04671 40011000
*                                                              @YM04671 40011200
*        OUTPUT IS AS FOLLOWS:                                        * 40011600
*                                                                     * 40012000
*              IF RETURN IS NORMAL-                                   * 40012400
*                                                                     * 40012800
*                   OPCDOUBL=ADDR OR DDN OR A DDN,RLN                 * 40013200
*                   OCNOTUCB='1'B IF NOT A UCB ADDRESS                * 40013600
*                   R11=POINTS ONE PAST LAST DELIMITER FOUND          * 40014000
*                                                                     * 40014400
*              IF RETURN IS ABNORMAL BECAUSE NAME NOT FOUND           * 40014800
*                   BY DCBLOOKUP THEN RETURN IS REG 14 + 4            * 40015200
*                                                                     * 40015600
*              IF RETURN IS ABNORMAL BECAUSE OF INVALID SYNTAX        * 40016000
*                   OR LENGTH ERRORS THEN RETURN IS REG 14 & 8        * 40016100
**                                                             @OY12425 40016200
**********************************************************************  40016300
OPCSCAN  EQU   *                                               @OY12425 40016400
         STM   RWORKA,RSAVE,OPCSAVE     SAVE REGISTERS         @YM03678 40016500
         LR    RBASE,RBRNCH             SET UP BASE REGISTER   @YM03678 40016600
         ST    RRET,SAVEAREA            SAVE RTN ADDRESS       @OY12425 40016700
         USING REGSAVE,RSAVE            SAVE AREA DSECT        @YM05671 40016800
         LA    RSAVE,OPCSAVE            SAVE AREA ADDR         @YM05671 40016900
         MVC   USERBASE(4),RSAVEC       SAVE USER BASE REG     @YM05671 40017000
         ST    RBASE,RSAVEC             SET OPCSCAN BASE       @YM05671 40017100
         MVI   OPCDOUBL,AVTEBLNK        CLEAR FIRST BYTE       @OY12425 40018800
         MVC   OPCDOUBL+ONE(SEVEN),OPCDOUBL CLEAR FIELD        @OY12425 40019200
         SPACE 2                                                        40019600
* SCAN FIELD FOR BLANK, COMMA, OR RIGHT PAREN                  @OY12425 40020000
         LH    RNUM,MAXTEN              SET FLD TO MAXLEN + 1  @OY12425 40020400
         SR    RSWITCH,RSWITCH          INDICATE 1RST TIME THRU@OY12425 40020800
SCAN     EQU   *                                               @OY12425 40021200
         LR    RSTART,RSCAN             SAVE START ADDR        @OY12425 40021600
FINDDEL  EQU   *                                               @OY12425 40022000
         BCT   RNUM,CONTINUE            ZERO BYTES LEFT?       @OY12425 40022400
         B     BADCMD                   YES                    @OY12425 40022800
CONTINUE EQU   *                                               @OY12425 40023200
         CLI   ZERO(RSCAN),BLANK        IS IT A BLANK?         @OY12425 40023600
         BE    BLANKDEL                 GO TO BLANK CODE       @OY12425 40024000
         CLI   ZERO(RSCAN),COMMA        IS IT A COMMA?         @OY12425 40024400
         BE    COMMADEL                 GO TO COMMA CODE       @OY12425 40024800
         CLI   ZERO(RSCAN),PARENR       IS IT A RIGHT PAREN?   @OY12425 40025200
         BE    PARENDEL                 GO TO PAREN CODE       @OY12425 40025600
         CLI   ZERO(RSCAN),SLASH        IS IT A SLASH?         @OY12425 40026000
         BE    SLASHDEL                 YES, GOTO SLASH CODE   @OY12425 40026400
         LA    RSCAN,ONE(RSCAN)         INCR PTR BY ONE        @OY12425 40026800
         B     FINDDEL                  GO CHK NXT BYTE        @OY12425 40027200
         SPACE 2                                                        40027600
BLANKDEL EQU   *                                               @OY12425 40028000
         LTR   RSWITCH,RSWITCH          FIRST TIME THRU SCAN?  @OY12425 40028400
         BNZ   PASSTWO                  NO,GONE THRU TWICE     @OY12425 40028800
         BAL   RRET,SAVEFLD             SAVE FLD IN OPCDOUBL   @OY12425 40029200
         TM    OCSCAN,OCDDNAME+OCADDR   DDNAME OR ADDRESS FLD? @OY12425 40029600
         BZ    BADCMD                   NEITHER, BAD COMMAND   @OY12425 40030000
         BO    DDNADR                   BOTH POSSIBLE          @OY12425 40030400
         TM    OCSCAN,OCADDR            IS IT JUST AN ADDR?    @OY12425 40030800
         BZ    DDN                      NO, MUST BE DDNAME     @OY12425 40031200
         B     ADDR                     YES, MUST BE ADDR ONLY @OY12425 40031600
PASSTWO  EQU   *                                               @OY12425 40032000
* SECOND DELIM IS A BLANK - NEED TO CHKRLN                     @OY12425 40032400
         TM    OCSCAN,OCDDNRLN          CAN IT BE A DDN,RLN?   @OY12425 40032800
         BZ    BADCMD                   NO, BAD OPCSCAN SETTING@OY12425 40033200
         BAL   RRET,CHKRLN              GO VERIFY RLN          @OY12425 40033600
         LR    RPARM,RNUM               SET RLN REG            @OY12425 40034000
         B     EXIT                     GO TO DCBLOOKUP WHICH  @OY12425 40034400
*                                       WILL RETURN DIRECTLY TO@OY12425 40034800
*                                       MOD THAT CALLED OPCSCAN@OY12425 40035200
         SPACE 2                                                        40035600
COMMADEL EQU   *                                               @OY12425 40036000
         LTR   RSWITCH,RSWITCH          FIRST TIME THRU SCAN?  @OY12425 40036400
         BNZ   PASS2                    NO, HAS GONE THRU TWICE@OY12425 40036800
         BAL   RRET,SAVEFLD             SAVE FLD IN OPCDOUBL   @OY12425 40037200
         LA    RSCAN,ONE(RSCAN)         INCR PTR BY ONE        @OY12425 40037600
         TM    OCSCAN,OCADDR+OCDDNRLN   DDN,RLN OR ADDR?       @OY12425 40038000
         BO    RLNADR                   YES, WHICH IS IT?      @OY12425 40038400
         TM    OCSCAN,OCADDR+OCDDNAME   ADDRESS OR DDNAME?     @OY12425 40038800
         BO    DDNADR                   YES, CHK FIELDS        @OY12425 40039200
         TM    OCSCAN,OCDDNRLN          IS IT DDN,RLN ONLY?    @OY12425 40039600
         BO    NXTDEL                   YES, GO FIND RLN       @OY12425 40040000
         B     BADCMD                   BAD OPCSCAN SETTING    @OY12425 40040400
PASS2    EQU   *                                               @OY12425 40040800
* SECOND DELIM IS A COMMA - GET RLN AND VERIFY IT              @OY12425 40041200
         BAL   RRET,CHKRLN              GO VERIFY RLN          @OY12425 40041600
         LR    RPARM,RNUM               SETUP RLN              @OY12425 40042000
         LA    RSCAN,ONE(RSCAN)         SETUP PTR PAST DELIM   @OY12425 40042400
         B     EXIT                     GO TO DCBLOOKUP WHICH  @OY12425 40042800
*                                       WILL RETURN DIRECTLY TO@OY12425 40043200
*                                       MOD THAT CALLED OPCSCAN@OY12425 40043600
         SPACE 2                                                        40044000
PARENDEL EQU   *                                               @OY12425 40044400
         TM    OPCFLAG1,LPAREN          IS THERE A LEFT PAREN? @OY12425 40044800
         BZ    BADCMD                   NO, BAD CMD            @OY12425 40045200
         OI    OPCFLAG1,RPAREN          SETUP RIGHT PAREN FLAG @OY12425 40045600
         LTR   RSWITCH,RSWITCH          IS THIS 1RST DELIM?    @OY12425 40046000
         BNZ   LAST                     NO, GO VALIDATE RLN    @OY12425 40046400
         BAL   RRET,SAVEFLD             GO SAVE GRPNME         @OY12425 40046800
         LR    RSTART,RSCAN             SETUP FOR RLN=ALL      @OY12425 40047200
LAST     EQU   *                                               @OY12425 40047600
         BAL   RRET,CHKRLN              GO CHECK RLN           @OY12425 40048000
         LR    RPARM,RNUM               SETUP RLN REG          @OY12425 40048400
         LA    RSCAN,ONE(RSCAN)         SET PTR PAST DELIM     @OY12425 40048800
         B     EXIT                     GOTO DCBLOOKUP WHICH   @OY12425 40049200
*                                       WILL RETURN DIRECTLY TO@OY12425 40049600
*                                       MOD THAT CALLED OPCSCAN@OY12425 40050000
         SPACE 2                                                        40050400
SLASHDEL EQU *                                                 @OY12425 40050800
         LTR   RSWITCH,RSWITCH          FIRST TIME THRU SCAN   @OY12425 40051200
         BNZ   BADCMD                   NO, MISPLACED SLASH    @OY12425 40051600
         BAL   RRET,SAVEFLD             SAVE FLD IN OPCDOUBL   @OY12425 40052000
         LA    RSCAN,ONE(RSCAN)         SET PTR PAST DELIMITER @OY12425 40052400
         TM    OCSCAN,OCADDR            IS IT AN ADDR          @OY12425 40052800
         BO    ADDR                     YES,,GOTO DCBLOOKUP    @OY12425 40052900
         B     BADCMD                   NO,,SYNTAX ERROR       @OY12425 40053000
         SPACE  2                                                       40053100
ADDR     EQU   *                        ADDR                   @OY12425 40053200
         CH    RNUM,SIXX                IS ADDR 3 BYTES LONG?? @OY12425 40053400
         BNE   BADCMD                   NO,ERROR.              @OY12425 40053600
         SR    RPARM,RPARM              SETUP RLN REG.         @YM04671 40053800
         B     EXIT                     GO TO DCBLOOKUP WHICH. @YM04671 40054000
*                                       WILL RETURN DIRECTLYTO @YM04671 40054200
*                                       MOD THAT CALLED OPSCAN @YM04671 40054400
DDNADR   EQU   *                       DDNADR                  @YM04671 40054600
**********************************************************************  40054800
*                                                            * @YM04671 40054900
*         AT THIS POINT, THE LENGTH OF THE FIELD IS CHECKED..  @YM04671 40055000
*    IF THE LENGTH IS NOT 3 BYTES,,THE FIELD IS PROCESSED AS A @YM04671 40055100
*    DDNAME..                                                  @YM04671 40055200
*         IF THE LENGTH IS EQUAL TO 3 BYTE  THEN IT IS EITHER  @YM04671 40055300
*    A UCB ADDRESS OR A DDNAME.. THE FIELD IS FIRST SENT TO    @YM04671 40055400
*    LOOKUP ROUTINE AS AN ADDRESS.. IF IT IS A VALID UCB ADDR, @YM04671 40055500
*    LOOKUP WILL RETURN TO OPCSCAN AT A  0   OFFSET AND THEN   @YM04671 40055600
*    RETURN TO THE CALLER.. ELSE LOOKUP RETURNS AT A +4 OFFSET @YM04671 40055700
*    INTO OPCSCAN.. THE FIELD IS THEN SENT TO LOOKUP AS A DDN  @YM04671 40055800
*    AND LOOKUP WILL RETURN TO THE CALLER OF OPSCAN DIRECTLY.. @YM04671 40055900
*                                                            * @YM04671 40056000
**********************************************************************  40056100
         CH    RNUM,SIXX                EITHER ADDR OR DDN?    @OY12425 40056300
         BNE   DDN                      NO, MUST BE DDNAME     @OY12425 40056500
         MVC   OCPARM(1),OCRLN          SAVE RLN.              @YM04671 40056700
         SR    RPARM,RPARM              ELSE,TRY ADDR FIRST    @YM04671 40056900
         LR    RBRNCH,RBASE             SET FOR DCBLOOKUP.     @YM04636 40057100
         LM    RWORKA,RWORK2,RSAVE5B    RESTORE USER'S REGS    @YM06461 40057200
         LM    RBASE,RSAVE,RSAVEC       USERS 12-13            @YM06461 40057900
         BALR  RRET,RBRNCH              GOTO DCBLOOKUP.        @YM04636 40058000
         B     FOUND                    IT IS ADDR?            @YM04636 40058100
         TM    OCFLAG,OCTOTE            IS THIS TOTE??         @YM04671 40058200
         BZ    DDN                      NO, CONTINUE.          @YM04671 40058300
         CLI   OCOPTCDE,OCSTARTL        IS IT STARTLINE??      @YM04671 40058400
         BE    GETRLN                   RESTORE RLN.           @YM04671 40058500
         CLI   OCOPTCDE,OCSTOPL         IS IT STOPLINE??       @YM04671 40058600
         BNE   DDN                      NO, CONTINUE.          @YM04671 40058700
GETRLN   EQU   *                       GET RLN                 @YM04671 40058800
         SR    RPARM,RPARM              CLEAR RLN REG.         @YM04671 40058900
         IC    RPARM,OCPARM             RESTORE RLN.           @YM04671 40059000
         B     EXIT                     GOTO DCBLOCATE.        @YM04671 40059100
DDN      EQU   *                        NO, TRY DDNAME         @OY12425 40060000
         LH    RPARM,RLNONE             SET RLN REG            @OY12425 40060400
         B     EXIT                     GOTO DCBLOOKUP WHICH   @OY12425 40060800
*                                       WILL RETURN DIRECTLY   @OY12425 40060900
**                                      MOD THAT CALLED OPCSCAN@OY12425 40061000
RLNADR   EQU   *                                               @YM04671 40061100
*********************************************************************** 40061200
*                                                              @YM04671 40061300
*       AT THIS POINT, THE LENGTH OF THE FIELD IS CHECKED.     @YM04617 40061400
*    IF THE LENGTH IS NOT 3 BYTES, THE FIELD IS PROCESSED AS A @YM04671 40061500
*    DDNAME,RLN.                                               @YM04671 40061600
*       OTHERWISE, THE 3 BYTE FIELD IS A DDN,RLN OR AN ADDR.   @YM04671 40061700
*    THE FIELD IS FIRST SENT TO LOOKUP AS AN ADDRESS. IF ITS A @YM04671 40061800
*    VALID UCB ADDRESS, LOOKUP WILL RETURN TO OPCSCAN AT A +0  @YM04671 40061900
*    OFFSET AND THEN RETURN TO THE CALLER.  ELSE LOOKUP RETRNS @YM04671 40062000
*    TO OPCSCAN AT A +4 OFFSET NOT HAVING FOUND THE UCB ADDR.  @YM04671 40062100
*    OPCSCAN WILL THEN SCAN THE FIELD FOR AN RLN AND RE-SEND   @YM04671 40062200
*    FIELD TO LOOKUP AS A DDN,RLN.  LOOKUP WILL VERIFY THE FLD @YM04671 40062300
*    AND RETURN TO THE CALLER OF OPCSCAN DIRECTLY.             @YM04671 40062400
*                                                              @YM04671 40062500
*********************************************************************** 40062600
         CH    RNUM,SIXX                IS IT DDN,RLN OR ADDR  @YM04671 40062700
         BNE   TRYRLN                   NO, JUST DDN,RLN       @YM04671 40062800
         SR    RPARM,RPARM              SET RLN REG FOR ADDR.  @OY12425 40062900
         LR    RBRNCH,RBASE             SETUP FOR DCBLOCATE.   @YM04671 40063000
         LM    RWORKA,RWORK2,RSAVE5B    RESTORE REGS           @YM06461 40063200
         LM    RBASE,RSAVE,RSAVEC       USERS 12-13            @YM06461 40063400
         BALR  RRET,RBRNCH              GOTO DCBLOCATE         @YM04671 40064000
         B     FOUND                    NAME FOUND             @OY12425 40064400
TRYRLN   EQU   *                                               @OY12425 40064800
         TM    OCSCAN,OCALLRLN          IS RLN=ALL POSSIBLE?   @OY12425 40065200
         BZ    NXTDEL                   NO, SCAN FOR NXT DEL   @OY12425 40065600
         CLI   ZERO(RSCAN),OH           DO 'OFF' OR 'ON' FOLLOW@OY12425 40066000
         BNE   NXTDEL                   NO, CONTINUE RLN CHK   @OY12425 40066400
         LH    RPARM,RLNONE             SETUP RLN REG          @OY12425 40066800
         OI    OPCFLAG1,RLNALL          SET RLN=ALL SWITCH     @OY12425 40067200
         B     EXIT                     GOTO DCBLOOKUP WHICH   @OY12425 40067600
*                                       WILL RETURN DIRECTLY TO@OY12425 40068000
*                                       MOD THAT CALLED OPCSCAN@OY12425 40068400
NXTDEL   EQU   *                                               @YM04671 40068500
*********************************************************************** 40068600
*                                                              @YM04671 40068700
*        AT THIS POINT, WE KNOW IT IS NOT AN ADDRESS, SO THE   @YM04671 40068800
*   FIELD IS SCANNED FOR AN RLN.  OPCSCAN WILL THEN GO TO      @YM04671 40068900
*   LOOKUP TO VERIFY THE DDNAME,RLN.                           @YM04671 40069000
*                                                              @YM04671 40069100
*********************************************************************** 40069200
         LH    RSWITCH,RLNONE           GET READY FOR PASS TWO @YM04671 40069400
         LH    RNUM,FIVE                SET MAX RLN LEN        @OY12425 40069600
         B     SCAN                     GO SCAN FOR RLN        @OY12425 40070000
         SPACE 2                                                        40070400
EXIT     EQU   *                        EXIT                            40070600
         L     RRET,SAVEAREA            LOAD RETURN ADDR.      @OY12425 40070800
         LR    RBRNCH,RBASE             SET DCBLOCAT BASE REG. @YM03678 40071000
         LM    RWORKA,RWORK2,RSAVE5B    RESTORE REGS,NOT BASE  @YM06461 40071200
         L     RSAVE,RSAVED             LOAD USERS R13         @YM06461 40071400
         L     RBASE,USERBASE           RESTORE USER BASE      @YM05671 40072100
         BR    RBRNCH                   GO TO DCBLOOKUP        @YM03678 40072400
FOUND    EQU   *                                               @OY12425 40073600
         L     RRET,SAVEAREA            LOAD RETURN ADDR       @OY12425 40074000
         L     RBASE,USERBASE           RESTORE USER BASE      @YM05771 40074200
         BR    RRET                     RETURN TO CALLING MOD  @OY12425 40074400
BADCMD   EQU   *                        BAD COMMAND            @OY12425 40074500
         LM    RWORKA,RWORK2,RSAVE5B    RESTORE REGS           @YM06461 40074600
         L     RSAVE,RSAVED             USERS R13              @YM06461 40074800
         L     RRET,SAVEAREA            LOAD RETURN ADDR       @OY12425 40075000
         L     RBASE,USERBASE           RESTORE USER BASE      @YM05671 40075800
         B     EIGHT(RRET)              GO SET RZERO TO 18     @OY12425 40076000
         SPACE 2                                                        40076400
* THIS SUBRTN STORES THE DDN OR ADDR IN OPCDOUBL               @OY12425 40076800
SAVEFLD  EQU   *                                               @OY12425 40077200
         LR    RLENTH,RSCAN             CALCULATE LEN OF RLN   @OY12425 40077600
         SR    RLENTH,RSTART            ZERO BYTES TO SCAN?    @OY12425 40078000
         BZ    BADCMD                   YES,ERROR              @OY12425 40078400
         CH    RLENTH,MAX               LEN GREATER THAN MAX   @OY12425 40078800
         BH    BADCMD                   YES, ERROR             @OY12425 40079200
         BCTR  RLENTH,RZERO             DECREMENT LEN FOR EX   @OY12425 40079600
         EX    RLENTH,MOVENAME          MOVE FLD INTO OPCDOUBL @OY12425 40080000
         BR    RRET                     BRANCH BACK TO MODULE  @OY12425 40080400
         SPACE 2                                                        40080800
* THIS SUBROUTINE CHECKS RLN FOR VALID NUMERIC DATA,           @OY12425 40081200
*      PACKS RLN IN REG6, THEN CHECKS FOR VALID RLN VALUE      @OY12425 40081600
CHKRLN   EQU   *                                               @OY12425 40082000
         LR    RLENTH,RSCAN             CALCULATE LEN OF RLN   @OY12425 40082400
         SR    RLENTH,RSTART                                   @OY12425 40082800
         BZ    ALLRLN                   YES, GO CHK RLN=ALL    @OY12425 40083200
         CLC   ZERO(THREE,RSTART),STOPALL IS RLN EQUAL TO ALL? @OY12425 40083600
         BE    ALLRLN                   YES, GO CHK RLN=ALL    @OY12425 40084000
         MVI   OCSCAN,OCNOTUCB          NOT UCB ADDR, HAS RLN  @OY12425 40084400
         LR    RNUM,RLENTH              SETUP LEN OF FIELD     @OY12425 40084800
         LR    RPTR,RSTART              POINT TO START TO FIELD@OY12425 40085200
NUMERIC  EQU   *                                               @OY12425 40085600
         CLI   ZERO(RPTR),NUMBER        IS IT NUMERIC?         @OY12425 40086000
         BL    BADCMD                   NO, ERROR              @OY12425 40086400
         CLI   ZERO(RPTR),CHARNINE      IS IT NUMERIC?         @OY12425 40086800
         BH    BADCMD                   NO, ERROR              @OY12425 40087200
         LA    RPTR,ONE(RPTR)           POINT TO NEXT BYTE     @OY12425 40087600
         BCT   RNUM,NUMERIC             ARE WE DONE SCANNING?  @OY12425 40088000
PACKIT   EQU   *                                               @OY12425 40088400
         BCTR  RLENTH,RZERO             PREPARE FOR EXECUTE    @OY12425 40088800
         EX    RLENTH,MVRLN             MOVE RLN TO OCBACKUP   @OY12425 40089200
         EX    RLENTH,PACKRLN           PACK RLN               @OY12425 40089600
         XC    OCMODNME(SIX),OCMODNME   CLEAR HIGH BYTES       @OY12425 40090000
         CVB   RNUM,OCMODNME            CONVERT RLN            @OY12425 40090400
         LTR   RNUM,RNUM                ZERO RLN?              @OY12425 40090800
         BZ    BADCMD                   YES, INVALID           @OY12425 40091200
         CH    RNUM,MAXRLN              RLN > MAX?             @OY12425 40091600
         BH    BADCMD                   YES,INVALID            @OY12425 40092000
         BR    RRET                                            @OY12425 40092400
ALLRLN   EQU   *                                               @OY12425 40092800
         TM    OCSCAN,OCALLRLN          IS THIS RLN=ALL?       @OY12425 40093200
         BZ    BADCMD                   NO, INVALID CMD        @OY12425 40093600
         LH    RNUM,RLNONE              SETUP RLN VALUE        @OY12425 40094000
         OI    OPCFLAG1,RLNALL          SET FLAG FOR RLN=ALL   @OY12425 40094400
         BR    RRET                                            @OY12425 40094800
         DROP   RSAVE                                          @YM06461 40095300
REGSAVE  DSECT                                                 @YM05671 40095800
RSAVE5B  DS     7F                                             @YM05671 40096800
RSAVEC   DS     F                                              @YM05671 40097800
RSAVED   DS     F                                              @YM06461 40098300
IEDQCA   CSECT                                                 @YM05671 40098800
         TITLE 'IEDQCA - BUFFER ALLOCATION ROUTINE'                     40100022
*********************************************************************** 40200022
*                                                                     * 40300022
*        ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS SVC          * 40400022
*        TRANSIENT MODULES.  THE INPUT IS AS FOLLOWS -                * 40500022
*                   REGISTER 1 - CONTAINS NUMBER OF UNITS REQUESTED   * 40600022
*                   REGISTER 2 - POINTER TO THE OP CONTROL AVT        * 40700022
*                   REGISTER 4 - POINTER TO THE TCAM AVT              * 40800022
*                   REGISTER 13 - POINTS TO OP CONTROL SAVE AREA        40850000
*                   REGISTER 14 - CONTAINS RETURN ADDRESS             * 41000022
*                   REGISTER 15 - CONTAINS ROUTINE ENTRY POINT ADDRESS* 41100022
*        RETURN IS - NORMAL - REGISTER 14 PLUS 0 -                    * 41200022
*                           REGISTER 0 CONTAINS UNIT COUNT            * 41300022
*                           REGISTER 1 POINTS TO THE FIRST NEW UNIT   * 41400022
*                                                                     * 41500022
*********************************************************************** 41600022
         USING ALLOCBUF,RBRNCH                                          41700022
ALLOCBUF EQU   *                                                        41800022
         STM   RWORK,RWORK2,SAVEOFF(RSAVE) SAVE REGISTERS               41900022
         LH    RWORK1,OPCAVBUF     PICK UP NO. AVAILABLE                42000022
         N     RWORK1,AVTCLRHI     CLEAR HIGH TWO BYTES                 42100022
         SR    RWORK1,RPARM             ALLOCATE NUMBER NEEDED          42200022
         BNM   AVAIL                    POSITIVE MEANS WE HAVE THEM     42300022
         SPACE                                                          42400022
         LCR   RWORK1,RWORK1            GET NUMBER NEEDED FROM TCAM     42500022
         STC   RWORK1,OPCBFERB+UNITCNT SET ERB COUNT                    42600022
         SR    RPARM,RWORK1             FIND NUMBER GOTTEN FROM POOL    42700022
         BZ    REQBUFF             NO, REQUEST ALL                      42800022
         SPACE                                                          42900022
         OI    OPCSPEC,PARTREQ     PARTIAL UNIT REQUEST                 43000022
         SR    RWORK1,RWORK1            CLEAR NUMBER LEFT IN POOL       43100022
AVAIL    EQU   *                                                        43200022
         LR    RZERO,RPARM         SAVE NUMBER                          43300022
         STH   RWORK1,OPCAVBUF     STORE NEW COUNT                      43400022
         L     RWORK2,OPCBFIRS          PICK UP ADDR OF FIRST UNIT      43500022
         LR    RWORK,RWORK2             SAVE FIRST UNIT ADDRESS         43600022
ALLOCATE EQU   *                                                        43700022
         LR    RWORK1,RWORK2       SAVE POINTER TO PREVIOUS UNIT        43800022
         L     RWORK2,OFF08(RWORK1) GET BUFF UNIT LINK FIELD            43900022
         BCT   RPARM,ALLOCATE      LOOP UNTIL NEEDED COUNT IS ZERO      44000022
         SPACE                                                          44100022
         LR    RPARM,RWORK              SET FIRST UNIT POINTER          44200022
         ST    RWORK2,OPCBFIRS     PLACE NEW FIRST UNIT POINTER IN QCW  44300022
         TM    OPCSPEC,PARTREQ     PARTIAL REQUEST?                     44500022
         BO    SAVCNT                   BRANCH ON YES            S22024 44600022
         LR    RWORK,RWORK1             SAVE POINTER TO LAST UNITS22024 44640022
         B     ALRETURN                 RETURN UNITS             S22024 44680022
         SPACE 1                                                        44720022
SAVCNT   EQU   *                                                 S22024 44760022
         LR    RWORK2,RZERO        SAVE COUNT                           44800022
         STM   RWORK,RWORK2,OFF0C(RSAVE) SAVE REGS FOR LATER            44900022
         SPACE                                                          45000022
REQBUFF  EQU   *                                                        45100022
         XC    OPCBFERB+OFF05(AL8),OPCBFERB+OFF05 CLEAR FIELDS          45200022
         MVI   OPCBFERB+OFF08,MPPREQ INDICATE MPP UNIT REQ              45300022
         MVI   OPCBFERB+OFF0C,ONEBUFF REQUEST ONE BUFFER                45400022
         LA    RWORK,AVTBFREB      GET BUFFER REQUEST QCB ADDRESS       45500022
         ST    RWORK,OPCBFERB      PLACE THAT ADDRESS IN THE ERB        45600022
         LA    RWORK,OPCBFERB      PICK UP ERB ADDRESS                  45700022
         LR    RWORK1,RWORK        SET ERB ADDRESS                      45800022
         STM   RWORK,RWORK1,OPCAQCTL PUT ADDRESS IN AQCTL LIST          45900022
         MVI   OPCAQCTL,POST       SET POST FLAGS                       46000022
         MVI   OPCAQCTL+OFF04,AVTE80 SET END OF LIST                    46100022
         LA    RPARM,OPCAQCTL      POINT TO 102 PARAMETER LIST          46200022
         LR    RWORK,RBRNCH        SAVE BASE REGISTER                   46300022
         SPACE 2                                                        46400022
         AQCTL                     CROSS PARTITION POST                 46500022
         SPACE 2                                                        46600022
*                  WAIT FOR ANOTHER CALL TO DUTY                        46700022
*                                                                       46800022
         LR    RBRNCH,RWORK             RESTORE BASE REGISTER           46850022
WAITBUFF EQU   *                                                        46900022
         LR    RWORK,RBRNCH             SAVE BASE REGISTER              46950022
         WAIT  ECB=OPCPWECB             WAIT FOR ERB RETURN    @YM08508 47000000
         SPACE 2                                                        47100022
         LR    RBRNCH,RWORK        RESTORE BASE REGISTER                47200022
         MVI   OPCPWCCC,ZERO            CLEAR COMPLETION BIT   @YM08508 47300000
         ICM   RWORK1,7,OPCPWCHN        GET ERB ADDRESS        @YM08508 47400000
         MVC   OPCPWCHN,LINK+1(RWORK1)  DELINK ERB             @YM08508 47500000
         L     RPARM,ERBBUFF(RWORK1)    GET NEW BUFFER POINTER          50800022
         IC    RZERO,PRFNBUNT-IEDQPRF(RPARM) GET COUNT RETURNED         50900022
         TM    OPCSPEC,PARTREQ     PARTIAL REQUEST?                     52300022
         BNO   TOTREQ              NO, TOTAL                            52400022
         SPACE                                                          52500022
         LM    RWORK,RWORK2,OFF0C(RSAVE) RESTORE REGS                   52600022
         ST    RPARM,PRFTIC-IEDQPRF(RWORK1) LINK NEW UNITS              52700022
         AR    RZERO,RWORK2        GET TOTAL COUNT                      52800022
         LR    RPARM,RWORK              GET FIRST UNIT POINTER          52900022
TOTREQ   EQU   *                                                        53000022
         LR    RPREFIX,RPARM       GET FIRST UNIT ADDRESS               53100022
         LR    RWORK,RZERO              GET COUNT RECEIVED      SA63617 53200052
GETEND   EQU   *                                                        53300022
         LR    RWORK1,RPREFIX           SAVE LAST POINTER       SA63617 53400052
         L     RPREFIX,PRFTIC      PICK UP TIC FIELD                    53500022
         BCT   RWORK,GETEND             FIND LAST UNIT          SA63617 53600052
         SPACE                                                          53700022
         NI    OPCSPEC,ALL-PARTREQ TURN OFF FLAG                        53800022
ALRETURN EQU   *                                                        53900022
         SPACE                                                          53960022
         MVI   OFF0B(RWORK1),TWO        SET END OF CHAIN        SA63617 54000052
         SPACE 2                                               @Y17XARV 54006000
*        CLEAR EACH BUFFER UNIT EXCEPT FOR UNIT CONTROL AREA   @Y17XARV 54012000
*                                                              @Y17XARV 54018000
         LR    RWORK1,RPARM             COPY ADDR OF FIRST UNIT@Y17XARV 54024000
         SLR   RWORK2,RWORK2            CLEAR                  @Y17XARV 54030000
         ICM   RWORK2,LLH,AVTKEYLE      LOAD UNIT SIZE         @Y17XARV 54036000
         BCTR  RWORK2,RZERO             SUBTRACT FOR EX INSTR. @Y17XARV 54042000
CLRBUFUT DS    0H                                              @Y17XARV 54048000
         EX    RWORK2,CLRINSTR          CLEAR BUFFER UNIT      @Y17XARV 54054000
         TM    AVTSAVTF,AVTVTMCP        CHECK FOR NEG PREFIX   @Y17XARV 54054300
         BNO   CLRBRNCH                 BR AROUND IF NONE      @Y17XARV 54054600
         LA    RWORK,OCPREFSZ           GET NEG PREF LGTH      @Y17XARV 54055000
         LCR   RWORK,RWORK              MAKE IT NEG            @Y17XARV 54056000
         ALR   RWORK,RWORK1             ADD ADDR TO BACK UP    @Y17XARV 54057000
         XC    OFF00(OCPREFSZ,RWORK),OFF00(RWORK)  CLR NEG PREF@Y17XARV 54058000
CLRBRNCH L     RWORK1,OFF08(RWORK1)     LOAD FULL WORD CONTAIN-@Y17XARV 54060000
*                                         ING TIC              @Y17XARV 54066000
         EX    RWORK1,OPCHNEND          IS THIS THE LAST UNIT? @Y17XARV 54072000
         BZ    CLRBUFUT                 NO - GO CLEAR NEXT UNIT@Y17XARV 54078000
         SPACE 2                                               @Y17XARV 54084000
         MVI   PRFPRI-IEDQPRF(RPARM),PRIBFRTB   SET PRIORITY TO  S22024 54120022
*                                       NON-X'D8' VALUE TO AVOID S22024 54140022
*                                       CONFUSION IN IGC0210D    S22024 54160022
         LM    RWORK,RWORK2,SAVEOFF(RSAVE) RESTORE REGISTERS            54200022
         BR    RRET                RETURN WITH NEW UNIT ADDR IN REG 1   54300022
         SPACE                                                          54400022
CLRINSTR XC    OFF0C(0,RWORK1),OFF0C(RWORK1) TEMPLATE FOR      @Y17XARV 54430000
*                                       CLEARING BUFFER UNIT   @Y17XARV 54460000
         TITLE 'IEDQCA - POLLSTOP ROUTINE'                              54460100
*********************************************************************** 54600022
*                                                                     * 54700022
*        ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS SVC          * 54800022
*        TRANSIENT MODULES.  THE INPUT IS AS FOLLOWS -                * 54900022
*                   REGISTER 1 - ADDRESS OF FIRST UNIT IN CHAIN TO BE * 55000022
*                      FREED                                          * 55100022
*                   REGISTER 2 - POINTER TO THE OP CONTROL AVT        * 55200022
*                   REGISTER 4 - POINTER TO THE TCAM AVT              * 55300022
*                   REGISTER 13 - POINTS TO OP CONTROL SAVE AREA      * 55400022
*                   REGISTER 14 - CONTAINS RETURN ADDRESS             * 55500022
*                   REGISTER 15 - CONTAINS ROUTINE ENTRY POINT ADDRESS* 55600022
*        RETURN IS - NORMAL - REGISTER 14 PLUS 0 -                    * 55700022
*                                                                     * 55800022
*********************************************************************** 55900022
         USING FREEBUFF,RBRNCH                                          56000022
FREEBUFF EQU   *                                                        56100022
         STM   RWORK,RZERO,SAVEOFF(RSAVE) SAVE REGISTERS     @ZM46634   56100100
         LR    RPREFIX,RPARM       GET FIRST UNIT ADDRESS               56300022
         SR    RWORK,RWORK         CLEAR COUNTER REGISTER               56400022
NEXTUNIT EQU   *                                                        56500022
         EX    RPREFIX,OPCHNEND    END OF CHAIN?                        56600022
         BNZ   FREEEND             YES, PLACE UNITS IN POOL             56700022
         SPACE                                                          56800022
         MVI   PRFTIC,TIC          SET TIC CODE IN UNIT                 56850000
         L     RPREFIX,PRFTIC      PICK UP NEXT UNIT ADDRESS            56900022
         BCT   RWORK,NEXTUNIT      KEEP COUNT OF UNITS                  57000022
         SPACE                                                          57100022
FREEEND  EQU   *                                                        57200022
         LPR   RWORK,RWORK         UNITS FREED MADE NON-NEGATIVE        57300022
         LR    RWORK1,RWORK        SAVE NUMBER OF UNITS FREED           57400022
         AH    RWORK,OPCAVBUF      ADD NEW UNITS TO COUNT               57500022
         STH   RWORK,OPCAVBUF      STORE NEW COUNT IN AVAILABLE AREA    57600022
         LA    RPREFIX,OPCBFIRS-(PRFTIC-IEDQPRF) POINT BEFORE QCW       57700022
         LR    RWORK,RPREFIX       SAVE BEGINNING POINTER               57800022
LOOPQUE  EQU   *                                                        57900022
         L     RPREFIX,PRFTIC      GET NEXT UNIT ADDR                   58000022
         EX    RPREFIX,OPCHNEND    END OF CHAIN?                        58100022
         BNZ   QUEEND              YES, PLACE NEW UNITS IN CHAIN        58200022
         SPACE                                                          58300022
         LR    RWORK,RPREFIX       POINT TO NEXT UNIT                   58400022
         B     LOOPQUE             CONTINUE SEARCH                      58500022
         SPACE                                                          58600022
QUEEND   EQU   *                                                        58700022
         ST    RPARM,PRFTIC-IEDQPRF(RWORK) PLACE NEW UNITS IN POOL      58800022
         MVI   PRFTIC-IEDQPRF(RWORK),TIC SET TIC CODE IN UNIT           58900000
         L     RPREFIX,OPCBFIRS         1ST BFR IN POOL         SA67103 58905054
         EX    RPREFIX,OPCHNEND         ANY TO FREE            @ZA05044 58906058
         BNZ   ENDFREE                  NO,GET OUT             @ZA05044 58907058
         LA    RWORK,AVTBFRTB           ADDR OF BFR-RETURN QCB  SA67103 58910054
         ST    RWORK,PRFQCBA-ONE        ADDR FOR QPOST          SA67103 58915054
         MVI   PRFPRI,PRIBFRTB          PRIORITY                SA67103 58920054
         ICM   RPARM,SEVEN,PRFNBUNT     GET OP/CTL COMMAND ETC @Y17XARA 58921000
         ICM   RPARM,EIGHT,OPCAVBUF+1   AVAILABLE-BFR COUNT    @Y17XARA 58922000
         ST    RPARM,PRFNBUNT           SAVE OP/CTL COMMAND ETC@Y17XARA 58923000
         ST    RPREFIX,OPCAQCTL         BFR ADDR IN PARM LIST   SA67103 58935054
         ST    RPREFIX,OPCAQCTL+FOUR    BFR ADDR IN PARM LIST   SA67103 58940054
         MVI   OPCAQCTL,POST            SET FLAG FOR POST       SA67103 58945054
         MVI   OPCAQCTL+FOUR,AVTE80     SET END-OF-LIST         SA67103 58950054
         LA    RPARM,OPCAQCTL           POINT TO PARM LIST      SA67103 58955054
         LR    RWORK,RBRNCH             SAVE BASE REG           SA67103 58960054
         AQCTL                          CROSS-PARTITION POST    SA67103 58965054
         LR    RBRNCH,RWORK             RESTORE BASE REG        SA67103 58970054
         LA    RWORK,TWO                CLEAR THE OP CTL ...    SA67103 58975054
         ST    RWORK,OPCBFIRS           ... BFR POOL            SA67103 58980054
         SR    RWORK,RWORK              SET AVAILABLE-BFR ...   SA67103 58985054
         STH   RWORK,OPCAVBUF           ... COUNT TO ZERO       SA67103 58990054
ENDFREE  EQU   *                                               @ZA05044 58995058
         LR    RPARM,RWORK1        RETURN NUMBER OF UNITS FREED         59000022
         LM    RWORK,RZERO,SAVEOFF(RSAVE) RESTORE REGISTERS    @ZM46634 59000100
         BR    RRET                RETURN TO CALLER                     59200022
         EJECT                                                 @XA09783 59202058
         USING POLSTOP,RBRNCH                                  @XA09783 59204058
POLSTOP  EQU *                                                 @XA09783 59206058
         TM    PRFLCB+TWO-IEDQPRF(ROPCE),OCX01  BFR FOR 3705 PO@XA09783 59208058
         BNZ   GETDEST1                 GET DESTINATION TNT IND@XA09783 59210058
         SPACE 2                                               @XA09783 59212058
AROUND   EQU   *                                               @XA09783 59214058
         TM    PRFLCB+TWO-IEDQPRF(ROPCE),OCX02  BFR FOR 270X PO@XA09783 59216058
         BZR   RRET                                            @XA09783 59218058
         MVI   OCUNIT+3,OFF02           SET END OF BFR UNIT CHA@XA09783 59228058
         LH    RZERO,OCPARM                                    @XA09783 59230058
         MVC   OPCLDNME+THREE(TWO),MOD09                       @XA09783 59232058
         BAL   RRET,GETDEST1            GET DESTINATION TNT IND@XA09783 59234058
         B     XCTLTOMH                                        @XA09783 59236058
         SPACE 2                                               @XA09783 59238058
GETDEST1 EQU   *                                               @XA09783 59240058
         OI    OCFLAG,OCCONSOL                                 @XA09783 59242058
         XC    OCCONID(AL2),OCCONID     CLEAR CONSOLE ID       @OY13278 59243000
         OC    AVTOPCIN,AVTOPCIN                               @XM05809 59243100
         BZR   RRET                                            @XA09783 59246058
         NI    OCFLAG,AVTEFF-OCCONSOL                          @XA09783 59248058
         MVC   OCDEST(AL2),AVTOPCIN     PUT PRITERM TTCIN IN DEST       59248100
*                                                              @XM05809 59250000
         BR    RRET                                            @XA09783 59276058
         SPACE 2                                               @XA09783 59278058
MOD09    DC    C'09'                    MODULE IGC0910D        @XA09783 59280058
         TITLE 'DECREMENT A/D BUFFER UNIT COUNT AND REDRIVE'   @Y17XARV 59280200
***************************************************************@Y17XARV 59280400
*                                                              @Y17XARV 59280600
*        ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS       @Y17XARV 59280800
*        TRANSIENT MODULES.  THE ENTRY ADDRESS IS CONTAINED    @Y17XARV 59281000
*        IN THE OP. CTL. AVT AT OPCDECR.  THIS SUBROUTINE      @Y17XARV 59281200
*        PERFORMS THE FOLLOWING FUNCTIONS:                     @Y17XARV 59281400
*        1)    OPCADGOT (THE NUMBER OF BUFFER UNITS ACT/       @Y17XARV 59281600
*              DACT IS USING) IS DECREMENTED BY THE CONTENTS   @Y17XARV 59281800
*              OF REGISTER 0 (THE PARAMETER CONTAINING THE     @Y17XARV 59282000
*              NUMBER OF UNITS BEING RELEASED).                @Y17XARV 59282200
*        2)    IF THERE ARE OPCE'S ON THE REDRIVE CHAIN,       @Y17XARV 59282400
*              IF THE REDRIVE ELEMENT IS NOT CURRENTLY IN      @Y17XARV 59282600
*              USE, AND IF ACT/DACT BUFFER UNIT USAGE COUNT    @Y17XARV 59282800
*              IS LESS THAN 1/2 THE TOTAL NO. OF BUFFER UNITS  @Y17XARV 59283000
*              IN TCAM, THEN THE REDRIVE ELEMENT IS POSTED     @Y17XARV 59283200
*              TO THE OP. CTL. QCB (AVTOPCOB).                 @Y17XARV 59283400
*                                                              @Y17XARV 59283600
*        THE INPUT TO THIS ROUTINE IS AS FOLLOWS:              @Y17XARV 59283800
*              REG 00 - CONTAINS THE NUMBER OF BUFFERS         @Y17XARV 59284000
*                       UNITS BEING RELEASED.                  @Y17XARV 59284200
*              REG 02 - ADDR. OF OP. CTL. AVT                  @Y17XARV 59284400
*              REG 04 - ADDR. OF TCAM'S AVT                    @Y17XARV 59284600
*              REG 13 - ADDR. OF OP. CTL. SAVE AREA            @Y17XARV 59284800
*              REG 14 - RETURN ADDR.                           @Y17XARV 59285000
*              REG 15 - ENTRY POINT FOR ROUTINE                @Y17XARV 59285200
*                                                              @Y17XARV 59285400
*        NO RETURN CODES ARE PRESENTED TO THE CALLER.          @Y17XARV 59285600
*                                                              @Y17XARV 59285800
***************************************************************@Y17XARV 59286000
         SPACE 4                                               @Y17XARV 59286200
         USING DECRCT,RBRNCH            SET UP BASE REG.       @Y17XARV 59286400
DECRCT   DS    0H                                              @Y17XARV 59286600
         STM   RZERO,RBRNCH,SAVEOFF(RSAVE) SAVE REGS.          @Y17XARV 59286800
         L     RSAVT,AVTSAVTP           SET PTR. TO SEC. AVT   @YM03697 59286900
         SPACE 2                                               @Y17XARV 59287000
         LH    RWORK,OPCADGOT           LOAD # OF BUFFER UNITS @Y17XARV 59287200
*                                         A/D IS USING         @Y17XARV 59287400
         SR    RWORK,RZERO              SUB. FREED BUFFERS     @Y17XARV 59287600
         STH   RWORK,OPCADGOT           UPDATE # OF UNITS A/D  @Y17XARV 59287800
*                                         IS USING             @Y17XARV 59288000
         L     RWORK1,OPCBUFWT          LOAD ANCHOR FOR REDRIVE@Y17XARV 59288200
*                                         OPCE'S               @Y17XARV 59288400
         LTR   RWORK1,RWORK1            IS OPCE CHAIN EMPTY ?  @Y17XARV 59288600
         BZ    DECRTN                   YES - GO RETURN        @Y17XARV 59288800
         CLI   SAVTRDPY-IEDNSVTD(RSAVT),ZERO IS REDRIVE ELEM.  @YM03697 59289000
*                                         FREE ?               @Y17XARV 59289200
         BNZ   DECRTN                   NO - GO RETURN         @YM06046 59289400
         SLR   RWORK1,RWORK1            CLEAR                  @Y17XARV 59289600
         ICM   RWORK1,LLH,AVTNOLBF      LOAD # OF TCAM BUFFER  @Y17XARV 59289800
*                                         UNITS                @Y17XARV 59290000
         SRL   RWORK1,ONE               DIVIDE BY TWO          @Y17XARV 59290200
         CLR   RWORK,RWORK1             IS THE # OF BUFFER     @Y17XARV 59290400
*                                         A/D USING GT OR E TO @Y17XARV 59290600
*                                         1/2 THE TOTAL UNITS ?@Y17XARV 59290800
         BNL   DECRTN                   YES - GO RETURN        @Y17XARV 59291000
         SPACE 2                                               @Y17XARV 59291200
****                                                           @Y17XARV 59291400
*        POST THE REDRIVE ELEMENT TO THE OP.CTL QCB.           @Y17XARV 59291600
*                                                              @Y17XARV 59291800
         MVI   SAVTRDPY-IEDNSVTD(RSAVT),PRILOFLG REDRIVE PRTY. @YM03697 59292000
         LA    RWORK,AVTOPCOB           OBTAIN OP.CTL. QCB ADDR@Y17XARV 59292200
         ST    RWORK,SAVTRDKY-IEDNSVTD(RSAVT)   &PLACE IN ELEM.@YM03697 59292400
         LA    RWORK,SAVTRDRV-IEDNSVTD(RSAVT) LOAD ELEM. ADDR. @YM03697 59292600
         LR    RWORK1,RWORK             COPY                   @Y17XARV 59292800
         STM   RWORK,RWORK1,OPCAQCTL    PUT ADDR. IN AQCTL     @Y17XARV 59293000
*                                         PARM. LIST           @Y17XARV 59293200
         MVI   OPCAQCTL,POST            SET POST FLAGS         @Y17XARV 59293400
         MVI   OPCAQCTL+OFF04,AVTE80    SET FOR END OF LIST    @Y17XARV 59293600
         LA    RPARM,OPCAQCTL           POINT TO AQCTL PARM.   @Y17XARV 59293800
*                                         LIST                 @Y17XARV 59294000
         LR    RWORK,RBRNCH             COPY BASE REG.         @Y17XARV 59294200
         SPACE 2                                               @Y17XARV 59294400
         AQCTL                                                 @Y17XARV 59294600
         SPACE 2                                               @Y17XARV 59294800
         LR    RBRNCH,RWORK             RESTORE BASE REG.      @Y17XARV 59295000
         SPACE 2                                               @Y17XARV 59295200
DECRTN   DS    0H                                              @Y17XARV 59295400
         LM    RZERO,RBRNCH,SAVEOFF(RSAVE) RESTORE REGS.       @Y17XARV 59295600
         BR    RRET                     RETURN                 @Y17XARV 59295800
         TITLE 'IEDQCA - OPERATOR CONTROL OUTPUT SUBTASK'               59300022
*********************************************************************** 59400022
*                                                                     * 59500022
*        ENTRY IS FROM TCAM DISPATCHER TO 2 BYTES BEYOND OSTCB        * 59600022
*        THIS ROUTINE CHECKS THE OUTPUT QUEUE.  IF IT IS NOT EMPTY,   * 59700022
*        THE DUMMY LCB/SCB IS RE-INITIALIZED AND TPOSTED BACK TO      * 59800022
*        IEDQBD.  IF THE QUEUE IS EMPTY, RETURN IS TO THE DISPATCHER. * 59900022
*        BEFORE RETURN, THE TCAM AVT IS CHECKED FOR CLOSEDOWN.        * 60000022
*        IF CLOSEDOWN IS IN PROGRESS, OP CONTROL ECB IS               * 60100022
*        POSTED COMPLETE TO ALLOW OP CONTROL TO CLEAN UP ITS QUEUES.  * 60200022
*                                                                     * 60300022
*********************************************************************** 60400022
         DROP  RBRNCH                                                   60500022
         USING OSTCB,RPARM         BASE FOR STCB                        60600022
         USING IEDQDISP,RCIB       BASE FOR DISPATCHER                  60700022
OSTCB    DC    X'04',X'00'         STCB FOR OUTPUT                      60800022
         LR    RPARM,ROPCE         SET BASE REGISTER                    60900022
         DROP  ROPCAVT                                                  61000022
         LA    ROPCAVT,OPCAVT      PICK UP OPC AVT ADDRESS              61100022
         USING OPCAVT,ROPCAVT                                           61200022
         L     RAVT,OPCAVTPT       GET ADDRESS OF TCAM AVT              61300022
         LR    RWORKA,RPARM       SAVE BASE REGISTER           @G36XRRU 61300100
         MODESET MODE=SUP         SET SUPERVISOR STATE         @G36XRRU 61300200
         MODESET EXTKEY=SUPR      SET KEY ZERO                 @G36XRRU 61300300
SETATSK1 EQU   *                                               @G36XRRU 61300400
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,REGS=USE,               *61300500
               RELATED=OPCWAITO-IGC0710D(SETATSK)              @G36XRRU 61300600
         LR    RPARM,RWORKA       RESTORE BASE REGISTER        @G36XRRU 61300700
         SLR   ROPCE,ROPCE        CLEAR REGISTER               @G36XRRU 61300800
         MVI   OPCSTCBS,ZERO      INDICATE STCB NOT BUSY       @G36XRRU 61300900
         ICM   ROPCE,ADDRESS,OPCWAITO+ONE GET FIRST ELEMENT             61301000
*                                 ON QUEUE                     @G36XRRU 61301100
         BZ    NONETHER           NONE PRESENT, BRANCH         @G36XRRU 61301200
         MVC   OPCWAITO+ONE(AL3),ONE(ROPCE) DELINK ELEMENT     @G36XRRU 61301300
         MVI   OPCSTCBS,AVTEFF    INDICATE STCB STILL BUSY     @G36XRRU 61301400
NONETHER EQU   *                                               @G36XRRU 61301500
         SETLOCK RELEASE,TYPE=LOCAL,REGS=USE,                          *61301600
               RELATED=IEDQCA(SETATSK1)                        @G36XRRU 61301700
         MODESET EXTKEY=TCAM      SET TO TCAM KEY              @G36XRRU 61301800
         LR    RPARM,RWORKA       SAVE BASE REGISTER           @G36XRRU 61301900
         MODESET MODE=PROB        SET PROBLEM STATE            @G36XRRU 61302000
         LR    RPARM,RWORKA       RESTORE BASE REGISTER        @G36XRRU 61302100
         LA    RBRNCH,LCBSETUP     BASE FOR SETUP CODE                  61400022
         LA    RRET,DSPPOST             SET RETURN ADDRESS              61500022
MPTEST   EQU   *                                                        61600022
*                                                                       61700056
*                                                                       61800056
*                                                                       61900056
*                                                                       62000056
*                                                                       62100056
*                                                                       62200056
*                                                                       62300056
*                                                                       62400056
*                                                                       62500056
*                                                                       62600056
*                                                                       62700056
         LTR   ROPCE,ROPCE         QUEUE EMPTY?                         63000022
         BNZ   LCBSETUP            GO TO LCBSETUP              @OZ32786 63100082
         SPACE                                                          63200022
         MVI   OPCOQSW,ZERO        CLEAR TS SWITCH                      63300022
         LA    RPARM,OLCBECB       PICK UP ECB ADDRESS                  63400022
         TM    AVTBIT1,AVTCLOSN    CLOSEDOWN IN PROGRESS?               63600022
         BNO   DSPDISP             NO, RETURN TO THE DISPATCHER         63700022
         SPACE                                                          63800022
         POST  (1)                 POST OP CONTROL COMPLETE             63900022
         B     DSPDISP             GIVE CONTROL TO THE DISPATCHER       64000022
         SPACE                                                          64100022
         TITLE 'IEDQCA - POSTWAIT ROUTINE'                              64601000
************************************************************** @Y17XAWC 64602000
*                                                              @Y17XAWC 64603000
*        THIS SUBROUTINE IS PASSED THE ADDRESS OF A REQUEST    @Y17XAWC 64604000
*        ELEMENT WHICH IS COMPLETELY SET UP FOR A TPOST.       @Y17XAWC 64605000
*        THE ELEMENT IS TPOSTED VIA SVC 102.  THE OP CONTROL   @Y17XAWC 64606000
*        TASK IS THEN PUT INTO A WAIT UNTIL THAT SAME ELEMENT  @Y17XAWC 64607000
*        HAS BEEN TPOSTED BACK TO OP CONTROL AND PUT ON THE    @Y17XAWC 64608000
*        OPCPWCOB ELEMENT CHAIN.  THE ELEMENT IS THEN          @YM08486 64609000
*        REMOVED FROM THE CHAIN, AND CONTROL IS RETURNED TO    @Y17XAWC 64610000
*        THE CALLER.                                           @Y17XAWC 64611000
*                                                              @Y17XAWC 64612000
*        THIS POST-&-WAIT PROCEDURE IS USEFUL WHEN EVENTS      @Y17XAWC 64613000
*        IN THE OP CONTROL AND TCAM TASKS MUST BE SYNCHRONIZED @Y17XAWC 64614000
*        TO INSURE PROPER OPERATION.                           @Y17XAWC 64615000
*                                                              @Y17XAWC 64616000
*        ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS       @Y17XAWC 64617000
*        MODULES RUNNING UNDER THE OP CONTROL TASK.  THE       @Y17XAWC 64618000
*        INPUT IS AS FOLLOWS:                                  @Y17XAWC 64619000
*              REGISTER 1  - POINTER TO THE REQUEST ELEMENT    @Y17XAWC 64620000
*              REGISTER 2  - POINTER TO THE OP CONTROL AVT     @Y17XAWC 64621000
*              REGISTER 4  - POINTER TO THE TCAM AVT           @Y17XAWC 64622000
*              REGISTER 14 - RETURN ADDRESS                    @Y17XAWC 64623000
*              REGISTER 15 - ENTRY POINT ADDRESS               @Y17XAWC 64624000
*                                                              @Y17XAWC 64625000
************************************************************** @Y17XAWC 64626000
         USING POSTWAIT,RBASE                                  @Y17XAWC 64627000
POSTWAIT DS    0H                                              @Y17XAWC 64628000
         STM   RZERO,RBRNCH,OPCSAVE     SAVE CALLER'S REGS     @Y17XAWC 64629000
         LR    RBASE,RBRNCH             SET UP BASE REGISTER   @Y17XAWC 64630000
*                                                              @Y17XAWC 64631000
*              SET UP PARM LIST FOR SVC 102 TO TPOST ELEMENT   @Y17XAWC 64632000
         LR    RZERO,RPARM              COPY ELEMENT ADDRESS   @Y17XAWC 64633000
         STM   RZERO,RPARM,OPCAQCTL     ELEMENT ADDRESS        @Y17XAWC 64634000
         MVI   OPCAQCTL,POST            SET POST FLAGS         @Y17XAWC 64635000
         MVI   OPCAQCTL+OFF04,AVTE80    SET END-OF-LIST        @Y17XAWC 64636000
         LA    RPARM,OPCAQCTL           POINT TO PARM LIST     @Y17XAWC 64637000
         AQCTL                          TPOST THE ELEMENT      @Y17XAWC 64638000
*                                                              @Y17XAWC 64639000
WAITELEM EQU   *                                               @Y17XAWC 64640000
         WAIT  ECB=OPCPWECB             AWAIT ELEMENT'S RETURN @YM08403 64641000
*                                                              @Y17XAWC 64642000
         MVI   OPCPWCCC,0               CLEAR COMPLETION BIT   @YM08403 64643000
*                                                              @Y17XAWC 64644000
         ICM   RPARM,7,OPCPWCHN         GET THE ELEMENT ADDR   @YM08486 64649000
         MVC   OPCPWCHN,PRFLINK-IEDQPRF(RPARM) DELINK ELEMENT  @YM08486 64650000
         LM    RZERO,RBRNCH,OPCSAVE     RESTORE CALLER'S REGS  @Y17XAWC 64675000
         BR    RRET                     RETURN TO CALLER       @Y17XAWC 64676000
         DS    0H                                              @Y17XAWC 64682000
         TITLE 'IEDQCA - LCB/SCB INITIALIZATION'                        64700022
*********************************************************************** 64800022
*                                                                     * 64900022
*        THIS ROUTINE SETS UP ALL FIELDS IN THE LCB/SCB NECESSARY     * 65000022
*        TO GET THE OPERATOR CONTROL OUTPUT MESSAGE ON THE CORRECT    * 65100022
*        OUTPUT QUEUE.  INPUT IS AS FOLLOWS:                          * 65200022
*                   REGISTER 2 - POINTER TO OP CONTROL AVT            * 65300022
*                   REGISTER 3 - POINTER TO THE CURRENT OPCE(BUFFER)  * 65400022
*                   REGISTER 4 - POINTER TO THE TCAM AVT              * 65500022
*                   REGISTER 14 - CONTAINS RETURN ADDRESS             * 65600022
*                   REGISTER 15 - CONTAINS ROUTINE ENTRY POINT ADDRESS* 65700022
*                                                                     * 65800022
*********************************************************************** 65900022
         DROP  RPARM                                                    66000022
         USING LCBSETUP,RBRNCH                                          66100022
         USING IEDQTRM,RTERM                                   @YM05671 66150000
LCBSETUP EQU   *                                                        66200022
         L     RWORK,AVTMSGS-OFF01 PICK UP VCON POINTER                 66300022
         MVC   OCLINK+OFF01(AL3),OFF01(RWORK) PLACE BD QCB ADDR IN BUFF 66400022
         MVI   OCELEM,PRIDESTQ          SET PRIORITY                    66500022
         ST    ROPCE,OLCBBUFF      SET LCB BUFFER POINTER               66600022
         MVI   OSCBPRI,OUTPRI      RESET OUTPUT PRIORITY                66700022
         MVI   OLCBERB,ERBSTATE    RESET ERB BITS                       66800022
         LH    RWORK,OCDEST             GET DESTINATION OFFSET          66900022
FINDTRM  EQU   *                                                        67000022
         N     RWORK,AVTCLRHI           CLEAR HIGH BYTES                67100022
         STH   RWORK,PRFDEST-IEDQPRF(ROPCE) SET DESTINATION OFFSET      67200022
         L     RTNT,AVTRNMPT            GET TERM NAME TABLE ADDRESS     67300022
         LA    RPARM,TNTFIRST           GET FIRST ENTRY ADDRESS         67400022
         SR    RWORK1,RWORK1            CLEAR FOR ENTRY LENGTH          67500022
         STH   RWORK1,PRFISEQ-IEDQPRF(ROPCE) CLEAR SEQ FIELD    SA62344 67550022
         IC    RWORK1,TNTENLEN          GET NAME LENGTH                 67600022
         AR    RPARM,RWORK1             ADD LENGTH TO FIRST TO GET ADDR 67700022
         LA    RWORK1,THREE(RWORK1)     ALLOW FOR ADDRESS FIELDS        67800022
         BCTR  RWORK,RZERO              DECREMENT OFFSET                67900022
         MR    RWORK,RWORK              CALCULATE OFFSET TO TNT ENTRY   68000022
         AR    RPARM,RWORK1             ADD OFFSET                      68100022
         MVC   OLCBZ2+OFF01(AL3),OFF00(RPARM)   MOVE ADDR FOR LOAD      68200022
         L     RTERM,OLCBZ2        TERM ENTRY ADDRESS TO REG            68300022
         L     RWORK,TRMDESTQ-1    PICK UP DESTINATION QCB ADDR         68400022
         TM    OPCSPEC,ALTDEST     PROCESSING ALTDEST?                  68500022
         BO    GETDEST             YES, THIS IS WHERE IT GOES           68600022
         SPACE                                                          68700022
         TM    TRMSTATE,PROCESS    PROCESS ENTRY?                       68800022
         BNO   GETDEST             NO, SEND MESSAGE TO DESTINATION      68900022
         SPACE                                                          69000022
         OI    OPCSPEC,ALTDEST     INDICATE ALTERNATE DEST              69100022
         LH    RWORK,TRMALTD            PICK UP ALT DEST TNT OFFSET     69200022
         CH    RWORK,AVTFZERO           ALTDEST SPECIFIED?              69300022
         BE    FINDTRM1                 NO, CHECK DLQ          @SA69063 69400056
         N     RWORK,AVTCLRHI           CLEAR TOP HALF         @SA69063 69420056
         STH   RWORK,PRFSRCE-IEDQPRF(,ROPCE)  SET SOURCE       @SA69063 69440056
         B     FINDTRM                                         @SA69063 69460056
FINDTRM1 EQU   *                                               @SA69063 69480056
         SPACE                                                          69500022
         LH    RWORK,AVTDLQX            GET DLQ OFFSET                  69600022
         CH    RWORK,AVTFZERO           DLQ SPECIFIED?                  69700022
         BNE   FINDTRM             YES, IT WILL BE DESTINATION          69800022
         SPACE                                                          69900022
         LA    RWORK,AVTBFRTB      GET BUFFER RETURN ADDRESS            70000022
GETDEST  EQU   *                                                        70100022
         LA    RWORK,ZERO(RWORK)   CLEAR HIGH BYTE                      70200022
         NI    OPCSPEC,ALL-ALTDEST CLEAR ALTDEST FLAG                   70300022
         ST    RWORK,OSCBQCB       STORE QCB ADDRESS IN SCB             70400022
         LA    RPARM,OLCBQCBA           POINT TO LCB                    70500022
         MVI   LCBSTAT1-IEDQLCB(RPARM),LCBRECVN SET SEND                70600022
         IC    RWORK,PRFNBUNT-IEDQPRF(ROPCE) SAVE NUMBER OF UNITS       70700022
         ST    RPARM,PRFLCB-IEDQPRF-1(ROPCE) PLACE LCB ADDRESS IN BUFF  70800022
         STC   RWORK,PRFNBUNT-IEDQPRF(ROPCE) RESTORE UNIT COUNT         70900022
         LR    RPARM,ROPCE              PT TO BUFFER ADDRESS   @OZ09915 70950000
         BALR  RRET,RRET           GO TO RETURN ADDRESS        @Y17XARX 71000000
CHECKCIB EQU   *                                               @YA07487 71000158
         STM   RBASE,RBRNCH,SAVEOFF(RSAVE)  SAVE REGS          @YA07487 71000258
         USING CHECKCIB,RBRNCH          ADDRESSABILITY         @YA07487 71000358
         LR    RPARM,RCIB               PT TO CIB TO BE REMOVED@YA07487 71000458
         L     RCIB,AVTCOMPT            GET CSCB ADDR          @YA07487 71000558
         LA    RZERO,FOUR(RCIB)         PT TO HEAD OF QUEUE    @YA07487 71000658
**                                      REMOVE CIB FROM QUEUE  @YA07487 71000758
         QEDIT BLOCK=(1),ORIGIN=(0)     REMOVE CIB FROM QUEUE  @YA07487 71000858
         LM    RBASE,RBRNCH,SAVEOFF(RSAVE)  RESTORE REGS       @YA07487 71000958
         TM    AVTBIT1,AVTCLOSN         CLOSEDOWN NOW          @YA07487 71001058
         BO    ZERO(RRET)               YES NOT STOP TCAM      @YA07487 71001158
         CLI   OCOPTCDE,HEX40           STOP COMMAND           @YA07487 71001258
         BNE   OFF04(RRET)              NO , CONT PROCESSING   @YA07487 71001358
         LA    RZERO,FOUR(RCIB)         ORIGIN ADDR            @YA07487 71001458
         SR    RPARM,RPARM                                     @YA07487 71001558
         IC    RPARM,AVTCIB                                    @YA07487 71001658
         STM   RBASE,RBRNCH,SAVEOFF(RSAVE)  SAVE REGS          @YA07487 71001758
         QEDIT CIBCTR=(1),ORIGIN=(0)                           @YA07487 71001858
         LM    RBASE,RBRNCH,SAVEOFF(RSAVE)  RESTORE REGS       @YA07487 71001958
         LA    RZERO,MSG451                                    @YA07487 71002058
         MVC   OPCLDNME+AL3(AL2),STOPMSG                       @YA07487 71002158
         B     XCTLTOMH                 XCTL TO MSG MOD        @YA07487 71002258
         EJECT                                                          71002357
*********************************************************************** 71004022
*        THIS ROUTINE DETERMINES IF THE DCB USED IN IPLING A 3705     * 71006022
*        NEEDS TO BE OPENED. IF NO HE BRANCHES TO THE ROUTINE POINTED * 71008022
*        TO BY REGISTER 14. IF NOT OPEN HE ISSUES AN OPEN FOR IT      * 71010022
*        AND IF UNSUCCESSFUL LOADS AN ERROR MSG NUMBER AND XCTLS TO   * 71012022
*        IGC0310D TO WRITE OUT THE MESSAGE. IF SUCCESSFUL HE BRANCHES * 71014022
*        ON REGISTER 14. BACK TO IGCMD10D TO CONTINUE IPLING          * 71016022
*********************************************************************** 71018022
         USING IHADCB,RWORK2            DCB ADDRESSABILITY       S22024 71020022
         USING OPENCODE,RBRNCH          ESTABLISH ADDRESSABILITY S22024 71022022
OPENCODE EQU   *                                                 S22024 71024022
         LR    RDCB,RBRNCH              SAVE BASE REGISTER       S22024 71026022
         TM    DCBOFLGS,OPENED          ALREADY OPENED ?         S22024 71028022
         BNO   NOTOPEN                  NO                       S22024 71030022
         CLOSE ((RWORK2))               CLOSE THE DCB            S22024 71032022
         LR    RBRNCH,RDCB              SET UP BASE              S22024 71034022
         L     RWORK2,DDOFF(RWORKA)     GET DCB ADDRESS          S22024 71036022
NOTOPEN  EQU   *                                                 S22024 71038022
         OPEN  ((RWORK2))               ISSUE AN OPEN SVC        S22024 71040022
         LR    RBRNCH,RDCB              RESTORE BASE REGISTER    S22024 71042000
         TM    DCBOFLGS,OPENED          OPEN SUCCESSFUL ?        S22024 71044022
         BNO   OPENFAIL                 NO                       S22024 71046022
         SR    RPARM,RPARM              CLEAR FOR IC           @YM08447 71046300
         IC    RPARM,OPCIPLCT           CURRENT IPL COUNT      @YM08447 71046600
         LA    RPARM,ONE(RPARM)         INCREMENT COUNT        @YM08447 71046900
         STC   RPARM,OPCIPLCT           NEW COUNT OF 3705'S    @YM08447 71047200
*                                       BEING IPLED            @YM08447 71047500
         LR    RPARM,RWORK2             INSERT DCB ADDR IN REG 1 S22024 71048022
         BR    RRET                     YES- RETURN TO IGCMD10D  S22024 71050022
OPENFAIL EQU   *                                                 S22024 71052022
         LA    RZERO,MSG166             ERROR MSG NUMBER         S22024 71054022
         MVC   OPCLDNME+THREE(AL2),XCTLMH  ID OF IGCMH10D        S22024 71056022
         L     R3,OPCCOPCE              GET CURRENT ELEMENT ADDRESS     71056222
         CLI   FOUR(R3),AUTOIPL         IS THIS AN AUTO IPL REQUEST     71056422
         BE    XCTLTOMH                 YES, SKIP PRIORITY RESET        71056622
         MVI   FOUR(R3),CLNUPPRI        RESET PRIORITY FOR MH           71056822
XCTLTOMH EQU   *                                                        71057022
R3       EQU   3                        REG USED BY XCTL CODE           71057222
AUTOIPL  EQU   X'DF'                    AUTO IPL ELEMENT PRIORITY       71057422
CLNUPPRI EQU   X'88'                    CLEANUP PRIORITY FOR MH         71057622
         LR    RPARM,ROPCAVT            SET UP PARAMETER REG     S22024 71058022
         XCTL  SF=(E,OPCXCTL)           XCTL TO IGC0310D         S22024 71060022
         SPACE 3                                                        71062022
XCTLMH   DC    C'MH'                    ID OF COMMON LOAD OF IPL S22024 71064022
*                                       AND DUMP FOR THE 3705    S22024 71066022
STOPMSG  DC    C'0G'                    MSG MODULE ID          @YA04391 71067056
MAXRLN   DC    H'255'                                          @OY12425 71067500
MAX      DC    H'8'                                            @OY12425 71068000
SAVEAREA DC    F'0'                                            @OY12425 71068700
USERBASE DC    F'0'                                            @YM05671 71069000
RLNONE   DC    H'1'                                            @OY12425 71069400
FIVE     DC    H'5'                                            @OY12425 71070100
SIXX     DC    H'6'                                            @OY12425 71070800
MAXTEN   DC    H'10'                                           @OY12425 71071500
STOPALL  DC    C'ALL'                                          @OY12425 71072200
PACKRLN  PACK  OCMODNME+SIX(TWO),OCMODNME(AVTEZERO) PACK NO.   @OY12425 71072900
MOVENAME MVC   OPCDOUBL(ZERO),ZERO(RSTART)    SAVE FIELD       @OY12425 71073600
MVRLN    MVC   OCMODNME(ZERO),AVTEZERO(RSTART) PREPARE RLN FOR @OY12425 71074300
*                                           CONVERT TO BINARY  @OY12425 71075000
         TITLE 'IEDQCA - TNT LOOK-UP ROUTINE'                  @Y17XARX 71075700
***************************************************************@Y17XARX 71076400
*                                                              @Y17XARX 71077100
* THIS CODE IS REENTRANT.                                      @Y17XARX 71077800
*                                                              @Y17XARX 71078500
* GIVEN A TTCIN IN REGISTER 1, THIS ROUTINE CALCULATES THE     @Y17XARX 71079200
* ENTRY ADDRESS INTO THE TNT.  THIS ADDRESS IS RETURNED IN     @Y17XARX 71079900
* REGISTER 1.  PRIMARY USE OF THIS SUBROUTINE IS FOR THOSE     @Y17XARX 71080600
* MODULES THAT NEED ACCESS TO THIS NAME PORTION OF A TNT ENTRY.@Y17XARX 71081300
*    ON INPUT - REGISTER  1 = TTCIN                            @Y17XARX 71082000
*               REGISTER  2 = OPCTL AVT                        @Y17XARX 71082700
*               REGISTER 13 = REGISTER SAVE AREA PTR           @Y17XARX 71083400
*               REGISTER 14 = RETURN ADDRESS                   @Y17XARX 71084100
*               REGISTER 15 = ENTRY ADDRESS TO SUBROUTINE      @Y17XARX 71084800
*    ON OUTPUT- REGISTER  1 = PTR TO TNT ENTRY NAME            @Y17XARX 71085500
*                                                              @Y17XARX 71086200
***************************************************************@Y17XARX 71086900
*                                                              @Y17XARX 71087600
         DROP  RTNT                                            @Y17XARX 71088300
         USING TNTENTAD,RBRNCH          BASE FOR THIS CODE     @Y17XARX 71089000
TNTENTAD DS    0H                                              @Y17XARX 71089700
         STM   ROPCE,RTERM,AVTEZERO(RSAVE)  SAVE REGS 3-6      @Y17XARX 71090400
         USING IEDQTNTD,RPARM           SETUP ADDR TNT TABLE   @Y17XARX 71091100
         L     RAVT,OPCAVTPT            ESTAB ADDR AVT         @Y17XARX 71091800
         LR    RWORKA,RPARM             LOAD TTCIN IN WORK REG @Y17XARX 71092500
         N     RWORKA,AVTCLRHI          CLEAR LEFT HALF OF REG @Y17XARX 71093200
         BCTR  RWORKA,ZERO              USE ORIGIN 1 ARITHMETIC@Y17XARX 71093900
         L     RPARM,AVTRNMPT           LOAD ADDR TNT BASE REG @Y17XARX 71094600
         SR    RAVT,RAVT                CLEAR REGISTER         @Y17XARX 71095300
         IC    RAVT,TNTENLEN            PUT ENTRY IN REG 4     @Y17XARX 71096000
         LA    RAVT,THREE(RAVT)         INCLUDE LENGTH OF ADDR @Y17XARX 71096700
         MR    RAVT,RAVT                TOT ENTRY LEN (REG 4)  @Y17XARX 71097400
*                                       TIMES TTCIN (REG 5)    @Y17XARX 71098100
         LA    RPARM,TNTFIRST(RWORKA)   COMPUTE TNT ENTRY      @Y17XARX 71098800
         LM    ROPCE,RTERM,AVTEZERO(RSAVE)  RESTORE REGS 3-6   @Y17XARX 71100000
         BR    RRET                                            @Y17XARX 71100500
         DROP  RPARM                     DROP TNT BASE         @YM08404 71100700
         TITLE 'IEDQCA - COHORTG LOOK-UP ROUTINE'              @Y17XARX 71101000
***************************************************************@Y17XARX 71101500
* THIS CODE IS REENTRANT.                                      @Y17XARX 71102000
*                                                              @Y17XARX 71102500
* ROUTINE CALLED = AVTRNMPT(ADDRESS TERMNAME TABLE)            @Y17XARX 71103000
*                                                              @Y17XARX 71103500
* ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS SVC          @Y17XARX 71104000
* TRANSIENT MODULES.  THIS ROUTINE FOLLOWS COHORTG POINTERS    @Y17XARX 71104500
* UNTIL IT FINDS A GROUP TTE.                                  @Y17XARX 71105000
*    ON INPUT - REGISTER  1 = LINE TTE PTR                     @Y17XARX 71105500
*               REGISTER  2 = OPCTL AVT PTR                    @Y17XARX 71106000
*               REGISTER 13 = REGISTER SAVE AREA PTR           @Y17XARX 71106500
*               REGISTER 14 = RETURN ADDRESS                   @Y17XARX 71107000
*               REGISTER 15 = ENTRY ADDRESS TO SUBROUTINES     @Y17XARX 71107500
*    ON OUTPUT- REGISTER  0 = TTCIN OF GROUP                   @Y17XARX 71108000
*               REGISTER  1 = TTE PTR FOR THE GROUP            @Y17XARX 71108500
* RETURN IS ALWAYS ON REGISTER 14.                             @Y17XARX 71109000
*                                                              @Y17XARX 71109500
***************************************************************@Y17XARX 71110000
*                                                              @Y17XARX 71110100
         DROP  RTERM                                           @Y17XARX 71110200
         USING CHORTGLK,RBASE           BASE FOR THIS CODE     @Y17XARX 71110500
         USING IEDNTRM,RTTEBASE         BASE FOR TTE PASSED    @Y17XARX 71110700
CHORTGLK DS    0H                                              @Y17XARX 71111000
         STM   RAVT,RBRNCH,AVTEZERO(RSAVE) SAVE REGS 4-15      @Y17XARX 71111100
         LR    RBASE,RBRNCH             ESTAB ADDR THIS RTN    @Y17XARX 71111200
         LR    RWORK,RPARM              SAVE INPUT             @YM08163 71111500
         LR    RTTEBASE,RPARM           SAVE PARM REG          @Y17XARX 71111700
         LA    RWORKA,TRMPRFSZ          GET ABSOLUTE LENGTH    @Y17XARX 71112000
         SR    RTTEBASE,RWORKA          BACKUP TO NEG PART TTE @Y17XARX 71112100
TTEGLOOP EQU   *                                               @Y17XARX 71112200
         SR    RPARM,RPARM              CLEAR REGISTER         @Y17XARX 71112500
         ICM   RPARM,CHTGMASK,TRMCOHTG  LOAD COHORTG PTR       @Y17XARX 71112700
         LR    RWORK2,RPARM             SAVE ORIG TTCIN PARM   @Y17XARX 71113000
         L     RAVT,OPCAVTPT            LOAD ADDR AVT          @Y17XARX 71113100
         L     RBRANCH,AVTRNMPT         LOAD ADDR TNT ROUTINE  @Y17XARX 71113200
         BNZ   GO                       TTCIN IS OK            @YM08163 71113500
         TM    TRMSTATE,TRMLINE         IS IT A LINE ENTRY ?   @YM08163 71113700
         BO    BADTTE                   BAD IF LINE            @YM08163 71114000
         TM    TRMBYTE0,TRMDIAL         IS IT DIAL ?           @YM08163 71114100
         BNO   BADTTE                   BAD IF NOT DIAL        @YM08163 71114200
         L     RWORK1,TRMDESTQ-1        GET QCB ADDR           @YM08480 71114500
         LH    RWORK2,TNTLEN-IEDQTNTD(,RBRANCH) HIGHEST TTCIN  @YM08404 71114700
MORE     EQU   *                                                        71115000
         LR    RPARM,RWORK2             SET TTCIN IN REG1      @YM08163 71115100
         BALR  RRET,RBRANCH             GET TTE                @YM08163 71115200
         TM    TRMSTATE-IEDQTRM(RPARM),TRMLINE  LINE ?         @YM08480 71115500
         BNO   BCT1                     NO TRY ANOTHER         @YM08163 71115700
         L     RPARM,TRMDESTQ-1-IEDQTRM(RPARM) GET QCB ADDR    @YM08163 71115800
         CLC   QCBRELLN-IEDQQCB(AL4,RPARM),QCBRELLN-IEDQQCB(RWORK1)     71116100
*                                       LGB AND RLN MATCH?     @YM08480 71116200
         BNE   BCT1                     TRY TRY AGAIN          @YM08163 71116500
         LA    RWORKA,TRMPRFSZ          PREFIX SIZE            @YM08163 71116600
         LR    RTTEBASE,RZERO           TTE ADDRESS            @YM08163 71116700
         SR    RTTEBASE,RWORKA          SET TO PREFIX          @YM08163 71117000
         B     TTEGLOOP                 FIND THE GROUP         @YM08163 71117100
BCT1     BCT   RWORK2,MORE              TRY NEXT ONE           @YM08163 71117200
BADTTE   LR    RPARM,RWORK              SET TO ORIGINAL        @YM08163 71117500
         B     BADTTE1                  GET OUT                @YM08163 71117700
GO       EQU   *                                               @YM08163 71118000
         BALR  RRET,RBRANCH             GO TO TNT SEARCH RTN   @Y17XARX 71118500
         LR    RTTEBASE,RPARM           ESTABLISH NEW BASE TTE @Y17XARX 71119000
         LA    RWORKA,TRMPRFSZ          GET ABSOLUTE LENGTH    @Y17XARX 71119500
         SR    RTTEBASE,RWORKA          BACKUP TO NEG PART TTE @Y17XARX 71120000
         CLI   TRMTYPE,TRMGRP           TEST IF GROUP ENTRY    @Y17XARX 71120500
         BNE   TTEGLOOP                 GO LOOP UNTIL FIND     @Y17XARX 71121000
BADTTE1  EQU   *                                               @YM08163 71121200
         LR    RZERO,RWORK2             RELOAD GRP TTCIN PARM  @Y17XARX 71121500
         LM    RAVT,RBRNCH,AVTEZERO(RSAVE) RESTORE REGS 4-15   @Y17XARX 71122000
         BR    RRET                     RETURN TO CALLER RTN   @Y17XARX 71122500
         TITLE 'IEDQCA - COHORT LOOK-UP ROUTINE'               @Y17XARX 71123000
***************************************************************@Y17XARX 71123500
*                                                              @Y17XARX 71124000
* THIS CODE IS REENTRANT.                                      @Y17XARX 71124500
*                                                              @Y17XARX 71125000
* EXTERNAL CALL = AVTRNMPT(ADDRESS TERMNAME TABLE)             @Y17XARX 71125500
*                                                              @Y17XARX 71126000
* ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS SVC          @Y17XARX 71126500
* TRANSIENT MODULES.  THIS ROUTINE FOLLOWS COHORT POINTERS     @Y17XARX 71127000
* UNTIL A DIFFERENT TYPE IS FOUND.                             @Y17XARX 71127500
*    ON INPUT - REGISTER  1 = TTE TO BE SEARCHED               @Y17XARX 71128000
*               REGISTER  2 = OPCTL AVT                        @Y17XARX 71128500
*               REGISTER 13 = REGISTER SAVE AREA               @Y17XARX 71129000
*               REGISTER 14 = RETURN ADDRESS                   @Y17XARX 71129500
*               REGISTER 15 = ENTRY ADDRESS TO SUBROUTINE      @Y17XARX 71130000
*    ON OUTPUT- REGISTER  0 = TTCIN OF NEXT HIGHER RESOURCE OF @Y17XARX 71130500
*                             HIERARCHY                        @Y17XARX 71131000
*               REGISTER  0 = 0  THIS IS ERROR CONDITION       @Y17XARX 71131500
*               REGISTER  1 = TTE PTR OF NEXT HIGHER RESOURCE  @Y17XARX 71132000
*                             FROM HIERARCHY                   @Y17XARX 71132500
* RETURN IS ALWAYS ON REGISTER 14.                             @Y17XARX 71133000
*                                                              @Y17XARX 71133500
***************************************************************@Y17XARX 71134000
         USING COHORTLK,RBASE           BASE FOR THIS CODE     @Y17XARX 71134500
         USING IEDNTRM,RTTEBASE         BASE FOR TTE PASSED    @Y17XARX 71135000
COHORTLK DS    0H                                              @Y17XARX 71135500
         STM   RAVT,RBRNCH,AVTEZERO(RSAVE)   SAVE REGS 4-15    @Y17XARX 71136000
         LR    RBASE,RBRNCH             ESTAB ADDR OF RTN      @Y17XARX 71136500
         LR    RTTEBASE,RPARM           GET ADDRESS TERM ENTRY @Y17XARX 71137000
         LA    RWORKA,TRMPRFSZ          GET ABSOLUTE TTE LENGTH@Y17XARX 71137500
         SR    RTTEBASE,RWORKA          BACKUP TO NEG PART TTE @Y17XARX 71138000
         TM    TRMSTATE,TRMPREF         NEGATIVE PREFIX TEXT   @Y17XARX 71138500
         BO    LOOKTTE1                 YES,LOOKUP TTE TYPE    @Y17XARX 71139000
GOOUT    SR    RZERO,RZERO              SET PARM REG 0 TO 0    @Y17XARX 71139500
         B     EEXITCDE                 GO EXIT TO CALLER      @Y17XARX 71140000
LOOKTTE1 EQU   *                                               @Y17XARX 71140500
         LA    REGTABLT,TABLETTE        SET TABLE ADDRESS      @Y17XARX 71141000
LOOKTTEA EQU   *                                               @Y17XARX 71141500
         CLI   ZERO(REGTABLT),ZERO      IS IT END OF TABLE     @Y17XARX 71142000
         BE    GOOUT                    YES, GO OUT            @Y17XARX 71142500
         CLC   ZERO(AL1,REGTABLT),TRMTYPE COMPARE TTE TYPE     @Y17XARX 71143000
         BE    LOOKTTE2                 EQUAL,GO CHK 2ND BYTE  @Y17XARX 71143500
         LA    REGTABLT,TABSIZE(REGTABLT) BUMP REG BY THREE    @Y17XARX 71144000
         B     LOOKTTEA                 LOOP AGAIN             @Y17XARX 71144100
LOOKTTE2 EQU   *                                               @Y17XARX 71144200
         L     RAVT,OPCAVTPT            LOAD ADDR OF TCAM AVT  @Y17XARX 71144500
         CLI   TRMTYPE,TRMPSNA          CHK IF PRESNA TERM     @Y17XARX 71144700
         BNE   TTELOOP                  NO,GO TEST COHORT PTR  @Y17XARX 71145000
         TM    TRMBYTE0,TRMGP           CHK FOR GEN POLL       @Y17XARX 71145100
         BZ    TTELOOP                  NO,CHECK COHORT PTR    @Y17XARX 71145200
         LA    REGTABLT,TABSIZE(REGTABLT)  BUMP REG BY THREE   @Y17XARX 71145500
TTELOOP  EQU   *                                               @Y17XARX 71145700
         SR    RCOHRTPT,RCOHRTPT        CLEAR REGISTER         @Y17XARX 71146000
         ICM   RCOHRTPT,COHTMASK,TRMCOHRT    COHORT PTR IN REG @Y17XARX 71146100
         BNZ   OK                       COHORT IS THERE        @YM08163 71146200
         TM    TRMBYTE0,TRMDIAL         IS IT DIAL ?           @YM08163 71146500
         BZ    GOOUT                    ERROR NOT DIAL         @YM08163 71146700
         TM    TRMSTATE,TRMLINE         IS IT LINE ENTRY       @OY20955 71146882
         BO    GOOUT                    YES,ERROR              @OY20955 71146982
         L     RWORK1,TRMDESTQ-1        GET QCB ADDRESS        @YM08480 71147000
         L     RBRANCH,AVTRNMPT         GET TNT                @YM08163 71147100
         LH    RWORK2,TNTLEN-IEDQTNTD(,RBRANCH) HIGHEST TTCIN  @YM08404 71147500
AGAIN    EQU   *                                                        71147700
         LR    RPARM,RWORK2             GET TTCIN              @YM08163 71148000
         BALR  RRET,RBRANCH             GET TERM ENTRY         @YM08163 71148100
         TM    TRMSTATE-IEDQTRM(RPARM),TRMLINE  LINE ?         @YM08163 71148200
         BNO   BCT                      NO                     @YM08163 71148500
         L     RPARM,TRMDESTQ-1-IEDQTRM(RPARM) GET THE QCB ADDR@YM08480 71148700
         CLC   QCBRELLN-IEDQQCB(AL4,RPARM),QCBRELLN-IEDQQCB(RWORK1)     71148800
*                                       LGB AND RLN MATCH?     @YM08480 71149100
         BNE   BCT                      NO                     @YM08163 71149200
         LR    RPARM,RZERO              COPY TTE ADDRESS       @YM08480 71149500
         B     GOTIT                    HAVE RIGHT ENTRY       @YM08163 71149600
BCT      BCT   RWORK2,AGAIN             TRY AGAIN              @YM08163 71149700
         B     GOOUT                    NEVER FOUND IT         @YM08163 71150000
OK       EQU   *                                                        71150200
         LR    RPARM,RCOHRTPT           PUT COHORT PTR IN REG 1@Y17XARX 71150500
         L     RBRANCH,AVTRNMPT         LOAD ADDRESS TNT RTN   @Y17XARX 71151000
         BALR  RRET,RBRANCH             GO TO TNT SUB RTN      @Y17XARX 71151500
GOTIT    EQU   *                                                        71151700
         LR    RTTEBASE,RPARM           RELOAD TTE BASE        @Y17XARX 71152000
         LA    RRET,TRMPRFSZ            GET ABSOLUTE LENGTH    @Y17XARX 71152500
         SR    RTTEBASE,RRET            BACKUP TO NEG PART TTE @Y17XARX 71153000
         TM    TRMSTATE,TRMPREF         NEGATIVE PREFIX CHECK  @Y17XARX 71153500
         BZ    GOOUT                    YES, PREPARE TO EXIT   @Y17XARX 71154000
         CLC   TRMTYPE,AL1(REGTABLT)    DOES TABLE MATCH COL2  @Y17XARX 71154500
         BE    PASSPARM                 YES, PREPARE TO EXIT   @Y17XARX 71155000
         CLC   TRMTYPE,AL2(REGTABLT)    DOES TABLE MATCH COL3  @Y17XARX 71155500
         BNE   TTELOOP                  NO, GO TTELOOP AGAIN   @Y17XARX 71156000
PASSPARM EQU   *                                               @Y17XARX 71156500
         LR    RZERO,RCOHRTPT           LOAD COHORT PTR IN PARM@Y17XARX 71157000
EEXITCDE EQU   *                                               @Y17XARX 71157500
         LM    RAVT,RBRNCH,AVTEZERO(RSAVE) RESTORE REGS 4-15   @Y17XARX 71158000
         BR    RRET                     GO BACK TO CALLER      @Y17XARX 71158500
TABLETTE EQU   *                        TABLE OF POSSIBLE TTE'S@Y17XARX 71159000
*                                  TTE TYPE    TYPE TO BE FOUND@Y17XARX 71159500
         DC    X'18',X'21',X'00'   PUNT        SDLC            @Y17XARX 71160000
         DC    X'20',X'0F',X'00'   NSDLC       NCP             @Y17XARX 71160500
         DC    X'21',X'0F',X'00'   SDLC        NCP             @Y17XARX 71161000
         DC    X'30',X'18',X'00'   LUNT        PUNT            @Y17XARX 71161500
         DC    X'40',X'20',X'00'   PRESNACLUST NSDLC           @Y17XARX 71162000
         DC    X'48',X'20',X'21'   CTERM       NSDLC(SDLC)     @Y17XARX 71162500
         DC    X'4F',X'20',X'00'   PRESNATERM  NSDLC           @Y17XARX 71163000
         DC    X'4F',X'40',X'00'   PRESNATERM  PRESNACLUST     @Y17XARX 71163500
         DC    X'00',X'00',X'00'   GRP         0   (TABLE END) @Y17XARX 71164000
         EJECT                                                 @Y17XARV 71164500
         TITLE ' IEDQCA - A/D IN-PROGRESS '                    @Y17XARV 71165000
***************************************************************@Y17XARV 71165500
*                                                              @Y17XARV 71166000
*        ENTRY TO THIS CODE IS VIA A 'BALR' FROM VARIOUS       @Y17XARV 71166500
*        TRANSIENT MODULES.  THE ENTRY ADDRESS IS CONTAINED    @Y17XARV 71167000
*        IN THE OP CNTL AVT AT OPCPGCK. THIS SUBROUTINE        @Y17XARV 71167500
*        PERFORMS ONE OF THE FOLLOWING FUNCTIONS:              @Y17XARV 71168000
*              1 - IF REG0=0, THE HIERARCHY POINTERS ARE       @Y17XARV 71168500
*                  FOLLOWED AND IN-PROG IS TURNED OFF IN       @Y17XARV 71169000
*                  ALL TTE'S WHICH ARE NOT BSC-SS LINES OR     @Y17XARV 71169500
*                  TERMINALS.                                  @Y17XARV 71170000
*                                                              @Y17XARV 71170500
*              2 - IF REG0^=0, IN-PROG FOR THE RESOURCE        @Y17XARV 71171000
*                  NAMED IN THE OPCE IS CHECKED.  IF ON,       @Y17XARV 71171500
*                  THE HIERARCHY PTRS ARE FOLLOWED UP THE      @Y17XARV 71172000
*                  HIERARCY TO LOCATE THE OPCE ON THE          @Y17XARV 71172500
*                  THE A/D WAIT CHAIN WHICH IS CURRENTLY       @Y17XARV 71173000
*                  OPERATING ON THE RESOURCE, AND THE          @Y17XARV 71173500
*                  NEW OPCE IS 'ATTACHED' TO THE CURRENT       @Y17XARV 71174000
*                  OPCE FOR SUBSEQUENT OPERATION.  IF          @Y17XARV 71174500
*                  IN-PROG NOT ON FOR THE RESOURCE, THE        @Y17XARV 71175000
*                  HIERARCHY POINTERS ARE FOLLOWED TO          @Y17XARV 71175500
*                  DETERMINE IF THIS ACTION WOULD AFFECT       @Y17XARV 71176000
*                  THE COMMAND ORIGINATOR (OCDEST).  IF IT     @Y17XARV 71176500
*                  WOULD, AND THE COMMAND IS NOT FOR           @Y17XARV 71177000
*                  THE 3705 ITSELF, THE REQUEST IS             @Y17XARV 71177500
*                  REJECTED.  NEXT, THE HIERARCHY POINTERS     @Y17XARV 71178000
*                  ARE FOLLOWED DOWNWARD TO DETERMINE IF       @Y17XARV 71178500
*                  IN-PROG IS ON FOR ANY SUBORDINATE           @Y17XARV 71179000
*                  RESOURCE.  IF IT IS, THE OPCE IS            @Y17XARV 71179500
*                  'ATTACHED' TO THE CURRENT OPCE OPERATING.   @Y17XARV 71180000
*                  IF NOT, THE IN-PROG BITS ARE SET FOR THE    @Y17XARV 71180500
*                  NAMED RESOURCE AND ALL RESOURCES            @Y17XARV 71181000
*                  SUBORDINATE TO IT THAT ARE NOT BSC-SS       @Y17XARV 71181500
*                  LINES OR TERMINALS.                         @Y17XARV 71182000
*                                                              @Y17XARV 71182500
*        THE INPUT TO THIS SUBROUTINE IS AS FOLLOWS:           @Y17XARV 71183000
*                                                              @Y17XARV 71183500
*        REG0: 0 OR ^=0 AS EXPLAINED ABOVE                     @Y17XARV 71184000
*        REG1: ADDRESS OF OPCE(OCTRMTBL=TTCIN OF RESOURCE)     @Y17XARV 71184500
*        REG2: PTR TO OP CNTL AVT                              @Y17XARV 71185000
*        REG4: PTR TO TCAM AVT                                 @Y17XARV 71185500
*        REG13:PTR TO OPCNTL SAVE AREA                         @Y17XARV 71186000
*        REG14:CONTAINS RETURN ADDRESS                         @Y17XARV 71186500
*        REG15:CONTAINS ROUTINE ENTRY POINT ADDRESS            @Y17XARV 71187000
*                                                              @Y17XARV 71200000
*        ON RETURN, THE OUTPUT IS:                             @Y17XARV 71200200
*                                                              @Y17XARV 71200400
*        REG0: 0 = IN-PROG BITS TURNED OFF                     @Y17XARV 71200600
*              1 = 'NOT ATTACHED'. CONTINUE PROCESS            @Y17XARV 71200800
*              2 = 'ATTACHED'.  SUSPEND PROCESS                @Y17XARV 71201000
*              3 = 'REJECTED'.  AFFECTS PRIMARY OPERATOR       @Y17XARV 71201200
*                  CONTROL TERMINAL.                           @Y17XARV 71201400
*                                                              @Y17XARV 71201600
*                                                              @Y17XARV 71201800
****************************************************************        71202000
         SPACE 3                                               @Y17XARV 71202200
***      REGISTER CONVENTIONS                                  @Y17XARV 71202400
*                                                              @Y17XARV 71202600
*        0     RZERO -  INTER-ROUTINE COMMUNICATION            @Y17XARV 71202800
*        1     RCURTTE - TTE ADDR. OF CURRENT RESOURCE         @Y17XARV 71203000
*              RPARM - INTER-ROUTINE COMMUNICATION             @Y17XARV 71203200
*        3     RTOPOFF - HIGHEST RESOURCE WITH IN-PROG ON      @Y17XARV 71203400
*        6     RORGTTE - TTE ADDR. OF RESOURCE IN OCTRMTBL     @Y17XARV 71203600
*        7     RORGOFF - TTCIN OF RESOURCE (EQUALS OCTRMTBL)   @Y17XARV 71203800
*        8     RCUROFF - CURRENT TTCIN                         @Y17XARV 71204000
*              RWORK - WORK REG.                               @Y17XARV 71204200
*        9     RLASTYPE  - HOLD TYPE  OF PREVIOUS RESOURCE     @Y17XARV 71204400
*              RWAITCHN - POINTER TO OPCE'S IN A/D WAIT CHAIN  @Y17XARV 71204600
*              RWORK1 - WORK REG.                              @Y17XARV 71204800
*        10    ROPCEOFF - HOLDS OCTRMTBL                       @Y17XARV 71205000
*              RCURTYPE - TYPE OF CURRENT RESOURCE LOOKED AT   @Y17XARV 71205200
*              RWORK2 - WORK REG.                              @Y17XARV 71205400
*        11    RWORK3 - WORK REG.                              @Y17XARV 71205600
*              RHRCHY - HOLDS HIERARCHY POINTER                @Y17XARV 71205800
         SPACE 3                                               @Y17XARV 71206000
         DROP  ROPCE,RTTEBASE                                  @Y17XARV 71206200
         USING IEDNTRM,RCURTTE                                 @Y17XARV 71206400
PROGRTNE DS    0H                                              @Y17XARV 71206600
         STM   14,12,0(RSAVE)      SAVE REGS                   @Y17XARV 71206800
         BALR  RBASE,RZERO         SET UP SUBROUTINE           @Y17XARV 71207000
         USING *,RBASE               BASE REGISTER             @Y17XARV 71207200
         SPACE 1                                               @Y17XARV 71207400
         LA    RPARM,0(RPARM)      CLEAR HI ORDER BYTE         @Y17XARV 71207600
         ST    RPARM,ORGOPCEA      STORE ADDR OF OPCE          @Y17XARV 71207800
         LTR   RZERO,RZERO         CHECK FUNCTION PARAMETER    @Y17XARV 71208000
         BZ    FUNC1               0 - PERFORM FUNCTION 1      @Y17XARV 71208200
         BAL   RRET,TONRTN         PERFORM FUNCTION 2          @Y17XARV 71208400
         B     PROGRTN             RETURN                      @Y17XARV 71208600
         SPACE 2                                               @Y17XARV 71208800
*        THIS CODE PERFORMS FUNCTION 1 AS DEFINED IN           @Y17XARV 71209000
*        INTRODUCTORY COMMENTS                                 @Y17XARV 71209200
         SPACE 1                                               @Y17XARV 71209400
FUNC1    EQU   *                                               @Y17XARV 71209600
         LH    RORGOFF,OCTRMTBL-IEDQOPCE(RPARM) LOAD TTCIN     @Y17XARV 71209800
         N     RORGOFF,AVTCLRHI      OF RESOURCE AFFECTED      @Y17XARV 71210000
         LR    RPARM,RORGOFF       COPY TTCIN                  @Y17XARV 71210200
         L     RBRNCH,AVTRNMPT     LOAD ADDR. OF TTCIN - TTE   @Y17XARV 71210400
*                                    CONVERSION ROUTINE        @Y17XARV 71210600
         BALR  RRET,RBRNCH         CONVERT                     @Y17XARV 71210800
         S     RCURTTE,NEGTTEL     POINT TO START OF NEG TTE   @Y17XARV 71211000
         LR    RORGTTE,RCURTTE     COPY TTE ADDRESS            @Y17XARV 71211200
         SR    RZERO,RZERO         CLEAR PARAMETER FOR CASCADE @Y17XARV 71211400
         BAL   RRET,CASCADE        TURN OFF IN-PROG BITS       @Y17XARV 71211600
         BAL   RRET,CHNRMV         REMOVE OPCE FROM WAIT CHAIN @Y17XARV 71211800
         SPACE 3                                               @Y17XARV 71212000
PROGRTN  EQU   *                                               @Y17XARV 71212200
         LM    14,15,0(RSAVE)     RESTORE REGS 14,15           @Y17XARV 71212400
         LM    1,12,12(RSAVE)     RESTORE REGS 1 THRU 12       @Y17XARV 71212600
         BR    RRET                RETURN                      @Y17XARV 71212800
         EJECT                                                 @Y17XARV 71213000
*********                                                      @Y17XARV 71213200
**       THIS SECTION OF CODE PERFORMS FUNCTION 2 AS           @Y17XARV 71213400
**       DESCRIBED IN INTRODUCTION                             @Y17XARV 71213600
*********                                                      @Y17XARV 71213800
         SPACE 1                                               @Y17XARV 71214000
TONRTN   EQU   *                                               @Y17XARV 71214200
         ST    RRET,TONSAVE        SAVE RETURN ADDR.           @Y17XARV 71214400
         LH    RORGOFF,OCTRMTBL-IEDQOPCE(RPARM) SET ORIG. TTCIN@Y17XARV 71214600
         N     RORGOFF,AVTCLRHI      TO OCTRMTBL               @Y17XARV 71214800
         LR    RPARM,RORGOFF       COPY TTCIN                  @Y17XARV 71215000
         L     RBRNCH,AVTRNMPT     ADDR OF TTCIN TO TTE ADDR.  @Y17XARV 71215200
*                                                              @Y17XARV 71215400
         BALR  RRET,RBRNCH         CONVERT                     @Y17XARV 71215600
         S     RCURTTE,NEGTTEL     POINT TO START OF NEG. TTE  @Y17XARV 71215800
         LR    RORGTTE,RCURTTE     SET ORIGINAL TTE            @Y17XARV 71216000
         LR    RCUROFF,RORGOFF     SET CURRENT TTCIN           @Y17XARV 71216200
         TM    TRMBYTE2,TRMINPG    IS IN-PROG ON               @Y17XARV 71216400
         BNO   NOINPROG            NO - BRANCH                 @Y17XARV 71216600
         SPACE 2                                               @Y17XARV 71216800
*        IN-PROG ON.  SCAN HIERARCHY POINTERS UPWARD TO FIND   @Y17XARV 71217000
*        HIGHEST RESOURCE TTE WITH IN-PROG ON                  @Y17XARV 71217200
         SPACE 1                                               @Y17XARV 71217400
SETTOP   EQU   *                                               @Y17XARV 71219200
         LR    RTOPOFF,RCUROFF     SET TOP TTCIN TO ORIG.      @Y17XARV 71219400
         ST    RSAVE,SAVE13        SAVE SAVE AREA ADDR.        @YM04632 71219600
         LA    RSAVE,PROGSAVE      POINT TO NEW SAVE AREA      @YM04632 71219800
         A     RCURTTE,NEGTTEL     RESET TTE BASE              @YM04632 71220000
         L     RBRNCH,OPCHORT      LD COHORTLK RTNE ADDR       @YM04632 71220200
         BALR  RRET,RBRNCH         OBTAIN NEXT HIGHEST RSC.    @YM04632 71220400
         L     RSAVE,SAVE13        RESTORE SAVE AREA ADDR.     @YM04632 71220600
         LR    RCUROFF,RZERO       COPY TTCIN OF NEXT HIGHEST  @YM04632 71220800
*                                    RESOURCE                  @YM04632 71221000
         LTR   RZERO,RZERO         Q-IS TOP RSC NCP            @YM04632 71221200
         BZ    CHAIN               Y-GO PLACE ON WAIT CHAIN    @YM04632 71221400
         S     RCURTTE,NEGTTEL     POINT TO NEG. PREFIX        @YM04632 71221600
         TM    TRMBYTE2,TRMINPG    Q-IS IN-PROG BIT ON         @YM04632 71221800
         BNO   CHAIN               N-PLACE OPCE ON WAIT CHAIN  @YM04632 71222000
         B     SETTOP              Y-GO FIND NEXT HIGHER RSC.  @YM04632 71222200
**                                                             @Y17XARV 71223400
**       IN-PROG NOT ON                                        @Y17XARV 71223600
**                                                             @Y17XARV 71223800
NOINPROG EQU   *                                               @Y17XARV 71224000
         SR    RWORK2,RWORK2       CLEAR                       @Y17XARV 71224200
         SH    RWORK2,TRMCOHRT     IS COHORT 0                 @Y17XARV 71224400
         BNZ   CHKOPCTL            NO - BRANCH                 @Y17XARV 71224600
         SH    RWORK2,TRMSUBST     IS SUBSTRUCT 0              @Y17XARV 71224800
         BNZ   CHKOPCTL            NO - BRANCH                 @Y17XARV 71225000
         BAL   RRET,CHNADD         PLACE OPCE ON WAIT CHAIN    @Y17XARV 71225200
*                                                              @Y17XARV 71225400
*        SET IN-PROG BIT USING COMPARE AND SWAP                @Y17XARV 71225600
*                                                              @Y17XARV 71225800
         L     RWORK1,TRMBYTE2     IN-PROG BIT IN TRMBYTE2     @Y17XARV 71226000
RETRY1   LR    RWORK2,RWORK1       COPY                        @Y17XARV 71226200
         O     RWORK2,INPGON       SET IN-PROG BIT IN REG.     @Y17XARV 71226400
         CS    RWORK1,RWORK2,TRMBYTE2 SET BIT IF POSSIBLE      @Y17XARV 71226600
         BNE   RETRY1              TRY AGAIN IF NOT SET        @Y17XARV 71226800
*                                                              @Y17XARV 71227000
         LA    RZERO,ONE           RETURN CODE = CONTINUE      @Y17XARV 71227200
*                                    PROCESS                   @Y17XARV 71227400
         B     TONRETN             RETURN                      @Y17XARV 71227600
**       CHECK SUBORDINATE RESOURCES                           @Y17XARV 71227800
**       TO SEE IF THIS OPCE WOULD AFFECT THE PRIMARY          @Y17XARV 71228000
**       OP-CTL TERM.                                          @Y17XARV 71228200
CHKOPCTL EQU   *                                               @Y17XARV 71228400
         LA    RZERO,ONE           PARAMETER FOR OP CTL TERM CK@Y17XARV 71228600
         BAL   RRET,CASCADE        CASCADE AND PERFORM CHECK   @Y17XARV 71228800
*                                                              @Y17XARV 71229000
         LTR   RZERO,RZERO         DOES REG 0 = 0              @Y17XARV 71229200
         BNZ   TONRETN             NO - BRANCH                 @Y17XARV 71229400
         LR    RCURTTE,RORGTTE     CURRENT TTE = ORIGINAL      @Y17XARV 71229600
         LR    RCUROFF,RORGOFF     SET CURRENT TTCIN = ORIG.   @Y17XARV 71229800
         LA    RZERO,TWO           PARAMETER FOR IN-PROG CHK   @Y17XARV 71230000
         BAL   RRET,CASCADE        CHECK IF IN-PROG ON FOR     @Y17XARV 71230200
*                                    SUBORDINATE               @Y17XARV 71230400
         LTR   RZERO,RZERO         DOES SUBORDINATE HAVE       @Y17XARV 71230600
*                                     IN-PROG ON               @Y17XARV 71230800
         BZ    PROGON              NO - GO TURN ON IN-PROG BITS@Y17XARV 71231000
         LR    RTOPOFF,RZERO       SET TOP TTCIN FOR CHAINER   @Y17XARV 71231200
         B     CHAIN                                           @Y17XARV 71231400
*        CASCADE AND TURN ON ALL IN-PROG BITS                  @Y17XARV 71231600
*                                                              @Y17XARV 71231800
PROGON   EQU   *                                               @Y17XARV 71232000
         LR    RCURTTE,RORGTTE     SET CURRENT TTE = ORIGINAL  @Y17XARV 71232200
         LR    RCUROFF,RORGOFF     SET CURRENT TTCIN = ORIG.   @Y17XARV 71232400
         LA    RZERO,THREE         PARAMETER FOR TURN ON IN-   @Y17XARV 71232600
*                                    PROG                      @Y17XARV 71232800
         BAL   RRET,CASCADE        TURN ON ALL IN-PROG BITS    @Y17XARV 71233000
*                                                              @Y17XARV 71233200
         BAL   RRET,CHNADD         PUT OPCE ON A/D WAIT CHAIN  @Y17XARV 71233400
*                                                              @Y17XARV 71233600
         LA    RZERO,ONE           RETURN CODE = CONTINUE      @Y17XARV 71233800
*                                    PROCESS                   @Y17XARV 71234000
         B     TONRETN             RETURN                      @Y17XARV 71234200
         SPACE 2                                               @Y17XARV 71234400
*        THIS ROUTINE SCANS THE A/D WAIT CHAIN LOOKING FOR     @Y17XARV 71234600
*        THE OPCE CURRENTLY OPERATING ON THE RESOURCE          @Y17XARV 71234800
*        SPECIFIED AS THE TOP TTCIN.                           @Y17XARV 71235000
         SPACE 1                                               @Y17XARV 71235200
CHAIN    EQU   *                                               @Y17XARV 71235400
         L     RWAITCHN,OPCWAITA   A/D WAIT CHAIN ANCHOR       @Y17XARV 71235600
         USING IEDQOPCE,RWAITCHN                               @Y17XARV 71235800
         SR    ROPCEOFF,ROPCEOFF   CLEAR FOR HOLDING 2 BYTE    @Y17XARV 71236000
*                                    TTCIN                     @Y17XARV 71236200
         B     CKOPCE              EXAMINE 1ST OPCE ON CHAIN   @Y17XARV 71236400
WAITSCAN EQU   *                                               @Y17XARV 71236600
         L     RWAITCHN,OCLINK     POINT TO NEXT OPCE ON CHAIN @Y17XARV 71236800
CKOPCE   ICM   ROPCEOFF,LLH,OCTRMTBL LOAD TTCIN                @Y17XARV 71237000
         CR    ROPCEOFF,RTOPOFF    OPCE TTCIN = TOP TTCIN      @Y17XARV 71237200
         BNE   WAITSCAN                                        @Y17XARV 71237400
         B     CHKELEM             CHECK THIS OPCE             @Y17XARV 71237800
NXTELEM  EQU   *                                               @Y17XARV 71238000
         L     RWAITCHN,OCELEM     POINT TO NEXT OPCE          @Y17XARV 71238200
CHKELEM  EQU   *                                               @Y17XARV 71238400
         TM    OCFLAG,OCATTACH     IS THERE AN ATTACHED ELEM.  @Y17XARV 71238600
         BO    NXTELEM             YES - POINT TO ATTACHED OPCE@Y17XARV 71238800
*                                                              @Y17XARV 71239000
*        ATTACH NEW OPCE                                       @Y17XARV 71239200
*                                                              @Y17XARV 71239400
         L     RPARM,ORGOPCEA      LOAD ADDR OF ORIGINAL OPCE  @Y17XARV 71239600
         STCM  RPARM,SEVEN,OCELEM+ONE STORE IN OLD OPCE        @OZ27694 71239882
*                                    NEW OPCE                  @Y17XARV 71240000
         OI    OCFLAG,OCATTACH     SET ELEMENT ATTACHED FOR    @Y17XARV 71240200
*                                    RESOURCES                 @Y17XARV 71240400
         DROP  RWAITCHN                                        @Y17XARV 71240600
*                                                              @Y17XARV 71242800
         LA    RZERO,TWO           SET RETURN CODE = SUSPEND   @Y17XARV 71243000
         SPACE 3                                               @Y17XARV 71243200
TONRETN  EQU   *                                               @Y17XARV 71243400
         L     RRET,TONSAVE        LOAD RETURN ADDR            @Y17XARV 71243600
         BR    RRET                RETURN                      @Y17XARV 71243800
         EJECT                                                 @Y17XARV 71244000
*********                                                      @Y17XARV 71244200
*        THIS  SECTION OF CODE PERFORMS THE CASCADING OF AN    @Y17XARV 71244400
*        ACTION THROUGH ALL RESOURCES IN THE TTE HIERARCHY     @Y17XARV 71244600
*        UNDER THE ORIGINAL TTE, THE ACTION IS SPECIFIED       @Y17XARV 71244800
*        BY THE CODE IN REG. 0                                 @Y17XARV 71245000
*********                                                      @Y17XARV 71245200
*                                                              @Y17XARV 71245400
*****    REGISTER USAGE (REGS SET)                             @Y17XARV 71245600
*                                                              @Y17XARV 71245800
*        0 - CONTAINS ACTION CODE ON ENTRY                     @Y17XARV 71246000
*        1 - RCURTTE (POINTS TO ORIGINAL TTE ENTRY)            @Y17XARV 71246200
*        8 - RCUROFF                                           @Y17XARV 71246400
*        9 - RLASTYPE                                          @Y17XARV 71246600
*        11 - RHRCHY                                           @Y17XARV 71246800
*                                                              @Y17XARV 71247000
*****                                                          @Y17XARV 71247200
         SPACE 2                                               @Y17XARV 71247400
CASCADE  EQU   *                                               @Y17XARV 71247600
*                                                              @Y17XARV 71247800
*        INITIALIZE                                            @Y17XARV 71248000
*                                                              @Y17XARV 71248200
         ST    RRET,CASSAVE        SAVE RETURN ADDR.           @Y17XARV 71248400
         STC   RZERO,ACTFLG        SET ACTION FLAG             @Y17XARV 71248600
         SLR   RLASTYPE,RLASTYPE   CLEAR REG.                  @Y17XARV 71248800
*                                                              @Y17XARV 71249000
CHKSUB   EQU   *                                               @Y17XARV 71249200
         LH    RHRCHY,TRMSUBST     LOAD                        @Y17XARV 71249400
         N     RHRCHY,AVTCLRHI       SUBSTRUCT                 @Y17XARV 71249600
         LTR   RHRCHY,RHRCHY       IS SUBSTRUCT POINTER 0      @Y17XARV 71249700
         BZ    PERFACT             YES - GO PERFORM ACTION     @Y17XARV 71249800
*                                                              @Y17XARV 71249900
         CLI   TRMTYPE,TRMCLUST    IS THIS A PRE-SNA CLUSTER   @Y17XARV 71250000
         BNE   GETSUBST            NO - GO GET SUBSTRUCT       @Y17XARV 71250100
         OI    FLAGS,CLUST         TURN ON CLUSTER FLAG        @Y17XARV 71250200
*                                                              @Y17XARV 71250300
*        USE SUBSTRUCT TO GET NEXT LOWER RESOURCE IN           @Y17XARV 71250400
*        HIERARCHY                                             @Y17XARV 71250600
*                                                              @Y17XARV 71250800
GETSUBST EQU   *                                               @Y17XARV 71250900
         CLI   ACTFLG,TWO          IN PROGRESS SEARCH          @YM07254 71251000
         BNE   SUBST               BR NO, GET SUBSTRUCT        @YM07254 71251100
         BAL   RRET,ACTION         CHECK FOR IN PROGRESS       @YM07254 71251200
         LTR   RZERO,RZERO         IN PROGRESS HERE            @YM07254 71251300
         BNZ   CHKDONE             BR YES, FINISHED            @YM07254 71251400
SUBST    EQU   *                                               @YM07254 71251500
         LR    RPARM,RHRCHY        LOAD TTCIN FOR CONVERSION   @Y17XARV 71251600
         L     RBRNCH,AVTRNMPT     LOAD ADDR. OF CONV. ROUTINE @Y17XARV 71251700
         BALR  RRET,RBRNCH         CONVERT TTCIN TO TTE ADDR.  @Y17XARV 71251800
         S     RCURTTE,NEGTTEL     POINT TO NEG. TTE           @Y17XARV 71251900
         LR    RCUROFF,RHRCHY      SET CURRENT TTCIN           @Y17XARV 71252000
         B     CHKDONE             CHECK SUBSTRUCT             @Y17XARV 71252100
*                                                              @Y17XARV 71252200
*        PERFORM ACTION                                        @Y17XARV 71252400
*                                                              @Y17XARV 71252600
PERFACT  EQU   *                                               @Y17XARV 71252800
         NI    FLAGS,X'FF'-LUP     TURN LUP FLAG OFF           @Y17XARV 71253000
         BAL   RRET,ACTION         PERFORM ACTION              @Y17XARV 71253200
         TM    FLAGS,DONE          IS DONE FLAG ON             @Y17XARV 71253400
         BO    CHKDONE             YES - GO TO END OF LOOP     @Y17XARV 71253600
         CLR   RCURTTE,RORGTTE     IS THIS THE ORIGINAL TTE    @Y17XARV 71253800
         BNE   GETCOHRT            NO - GET COHORT             @Y17XARV 71254000
*                                                              @Y17XARV 71254100
         OI    FLAGS,DONE          SET DONE FLAG               @Y17XARV 71254200
         B     CHKLUP              GO TO END OF LOOP           @Y17XARV 71254300
*                                                              @Y17XARV 71254400
*        USE COHORT TO GET  NEXT TTE                           @Y17XARV 71254500
GETCOHRT EQU   *                                               @Y17XARV 71254600
         IC    RLASTYPE,TRMTYPE    SAVE TRM TYPE AS LAST       @Y17XARV 71254700
         LH    RPARM,TRMCOHRT      LOAD                        @Y17XARV 71254800
         N     RPARM,AVTCLRHI       COHORT                     @Y17XARV 71254900
         LR    RCUROFF,RPARM       SET TO COHORT               @Y17XARV 71255000
         L     RBRNCH,AVTRNMPT     LOAD ADDR. OF CONV. ROUTINE @Y17XARV 71255100
         BALR  RRET,RBRNCH         CONVERT TTCIN TO TTE ADDR.  @Y17XARV 71255200
         S     RCURTTE,NEGTTEL     POINT TO NEG. TTE           @Y17XARV 71255300
*                                                              @Y17XARV 71255400
*        CHECK FOR NEXT HIGHEST REOURCE                        @Y17XARV 71255500
*                                                              @Y17XARV 71255600
         CLM   RLASTYPE,TYPEMASK,TRMTYPE IS RESOURCE DIFFERENT @Y17XARV 71255700
         BE    CHKLUP              NO - GO TO END OF LOOP      @Y17XARV 71255800
         CLI   TRMTYPE,TRMNSDLC    IS THIS A PRE-SDLC LINK     @Y17XARV 71255900
         BE    LINEDVCE            YES - GO PROCESS LINE       @Y17XARV 71256000
         CLI   TRMTYPE,TRMSDLC     IS THIS A SDLC LINE         @Y17XARV 71256100
         BE    LINEDVCE            YES - GO PROCESS LINE       @Y17XARV 71256200
         TM    TRMBYTE0,TRMSNA     IS THIS AN SNA DEVICE       @Y17XARV 71256300
         BO    SNADVCE             YES - GO PROCESS SNA DEVICE @Y17XARV 71256400
         CLI   TRMTYPE,TRMCLUST    IS THIS A PRE-SNA CLUSTER   @Y17XARV 71256500
         BNE   CHKLUP              NO - BRANCH                 @Y17XARV 71256600
         TM    FLAGS,CLUST         IS CLUSTER FLAG ON          @Y17XARV 71256700
         BNO   CHKLUP              NO - BRANCH                 @Y17XARV 71256800
         NI    FLAGS,X'FF'-CLUST   TURN OFF CLUSTER FLAG       @Y17XARV 71256900
         OI    FLAGS,LUP           TURN ON LUP FLAG            @Y17XARV 71257000
         B     CHKLUP              BRANCH                      @Y17XARV 71257100
SNADVCE  DS    0H                                              @Y17XARV 71257200
         OI    FLAGS,LUP           TURN ON LUP FLAG            @Y17XARV 71257300
         B     CHKLUP              BRANCH                      @Y17XARV 71257400
LINEDVCE DS    0H                                              @Y17XARV 71257500
         SRL   RLASTYPE,4          ISOLATE RANGE FOR TYPE FIELD@Y17XARV 71257600
*                                    OF LAST RESOURCE          @Y17XARV 71257700
         CL    RLASTYPE,LINERG     WAS THE LAST RESOURCE A LINE@Y17XARV 71257800
         BE    CHKLUP              YES - BRANCH                @Y17XARV 71257900
         OI    FLAGS,LUP           TURN ON LUP FLAG            @Y17XARV 71258000
         SPACE 2                                               @Y17XARV 71258100
CHKLUP   EQU   *                                               @Y17XARV 71258200
         TM    FLAGS,LUP           FLAG ON                     @Y17XARV 71258400
         BO    PERFACT             YES - GO PERFORM ACTION     @Y17XARV 71258600
         SPACE 2                                               @Y17XARV 71258800
CHKDONE  EQU   *                                               @Y17XARV 71259000
         TM    FLAGS,DONE          DONE ON                     @Y17XARV 71259200
         BZ    CHKSUB              NO - GO CHECK SUBSTRUCT     @Y17XARV 71259400
         SPACE 2                                               @Y17XARV 71259600
         MVI   FLAGS,ZERO          RESET FLAGS                 @Y17XARV 71259800
         L     RRET,CASSAVE        LOAD RETURN ADDR.           @Y17XARV 71260000
         BR    RRET                RETURN                      @Y17XARV 71260200
         EJECT                                                 @Y17XARV 71260400
*********                                                      @Y17XARV 71260600
**       THIS SECTION OF CODE PERFORMS THE ACTION SPECIFIED    @Y17XARV 71260800
**       IN ACTFLG.                                            @Y17XARV 71261000
*********                                                      @Y17XARV 71261200
         SPACE 2                                               @Y17XARV 71261400
ACTION   EQU   *                                               @Y17XARV 71261600
         ST    RRET,ACTSAVE        STORE RETURN ADDR.          @Y17XARV 71261800
         SLR   RZERO,RZERO         INIT RETURN CODE            @Y17XARV 71262000
         CLI   ACTFLG,ONE          IS ACTION FLAG = 1          @Y17XARV 71262200
         BNE   ACTTWO              NO - GO CHECK IF FLAG=2     @Y17XARV 71262400
         SPACE 2                                               @Y17XARV 71262600
*        CHECK IF CURRENT TTCIN = OCDEST IN ORIGINAL OPCE      @Y17XARV 71262800
*        INDICATING THAT THIS COMMAND AFFECTS THE OPERATOR     @Y17XARV 71263000
*        CONTROL TERMINAL                                      @Y17XARV 71263200
         SPACE 1                                               @Y17XARV 71263400
         L     RWORK2,ORGOPCEA     LOAD ADDR OF ORIGINAL OPCE  @Y17XARV 71263600
         LH    RWORKA,OCDEST-IEDQOPCE(RWORK2) LOAD TTCIN OF    @Y17XARV 71263800
         N     RWORKA,AVTCLRHI        OP CTL TERM              @Y17XARV 71264000
         CLR   RCUROFF,RWORKA      IS OP CTL TERM AFFECTED     @Y17XARV 71264200
         BNE   ACTRTN              NO - RETURN                 @Y17XARV 71264400
*                                                              @Y17XARV 71264600
*        ALLOW THE COMMAND IF TARGET RESOURCE IS THE NCP OR    @YM08113 71264700
*        IF THIS IS A ACT/DEACT COMMAND RECEIVED INTERNALLY    @YM08113 71264800
*        FROM CLEANUP                                          @YM08113 71264900
*                                                              @Y17XARV 71265200
         TM    OCFLAG-IEDQOPCE(RWORK2),OCCONSOL IS INPUT FROM  @ZM47796 71265300
         BO    ACTRTN              CONSOLE? YES, BRANCH        @ZM47796 71265400
         CLI   TRMTYPE-IEDNTRM(RORGTTE),TRMLNCP IS THIS FOR    @Y17XARV 71265500
*                                  AN NCP?                     @Y17XARV 71265600
         BE    ACTRTN              YES - RETURN                @Y17XARV 71265800
         L     RBRNCH,ORGOPCEA     POINT TO ORIGINAL OPCE      @ZM47546 71265900
         CLI   OCWTG-IEDQOPCE(RBRNCH),CHARF IS THIS A MODIFY   @ZM47546 71266100
*                                  ACTIVATE/DEACTIVATE COMMAND @YM08113 71266300
         BNE   CMDREJ              BR NO, REJECT COMMAND       @YM08113 71266400
         CLI   OCWTGSAV-IEDQOPCE(RBRNCH),CHARC CLNUP ACTIVATE  @ZM47546 71266500
*                                  OR DEACTIVATE REQUEST       @YM08113 71266700
         BE    ACTRTN              BR YES, ALLOW COMMAND       @YM08113 71266800
         CLI   OCSWITCH-IEDQOPCE(RBRNCH),OCTOFA IF TO IGCFA10D @ZM47724 71266900
         BE    ACTRTN              BR YES, ALLOW COMMAND       @ZM47724 71267000
CMDREJ   EQU   *                                               @YM08113 71267200
         LA    RZERO,THREE         SET RETURN CODE TO INDICATE @Y17XARV 71267900
*                                    COMMAND REJECTED BECAUSE  @Y17XARV 71268000
*                                    OP CTL TERM AFFECTED      @Y17XARV 71268200
         OI    FLAGS,DONE          DONE                        @Y17XARV 71268300
         B     ACTRTN              RETURN                      @Y17XARV 71268500
         SPACE 2                                               @Y17XARV 71268600
ACTTWO   EQU   *                                               @Y17XARV 71268800
         CLI   ACTFLG,TWO          IS ACTION FLAG TWO          @Y17XARV 71268900
         BNE   ACTCHKRT            NO - BRANCH                 @Y17XARV 71269100
*                                                              @Y17XARV 71269200
*        IS IN-PROG BIT ON IN CURRENT TTE                      @Y17XARV 71269400
*                                                              @Y17XARV 71269500
         TM    TRMBYTE2,TRMINPG    IS IN-PROG BIT ON           @Y17XARV 71269700
         BNO   ACTRTN              NO - RETURN                 @Y17XARV 71269800
         LR    RZERO,RCUROFF       LOAD TTCIN                  @Y17XARV 71270000
         OI    FLAGS,DONE          SET DONE FLAG               @Y17XARV 71270100
         B     ACTRTN              RETURN                      @Y17XARV 71270300
         SPACE 2                                               @Y17XARV 71270400
*        IF SNA LINE TURN IN-PROG BIT ON OR OFF DEPENDING      @Y17XARV 71270500
*        ON ACTION FLAG                                        @Y17XARV 71270600
*                                                              @Y17XARV 71270700
ACTCHKRT CLI   TRMTYPE,TRMNSDLC    IS THIS A BSC LINE          @Y17XARV 71270800
         BE    ACTRTN              YES - RETURN                @Y17XARV 71270900
         TM    TRMBYTE0,TRMSNA     IS THIS A BSC TERMINAL      @YM07727 71271000
         BNO   ACTRTN              YES - RETURN                @YM07727 71271100
*                                                              @Y17XARV 71271200
*        SET IN-PROG BIT USING COMPARE AND SWAP                @Y17XARV 71271300
*                                                              @Y17XARV 71271400
         L     RRET,TRMBYTE2       TRMBYTE2 CONTAINS TRMINPG   @Y17XARV 71271600
RETRY2   LR    RBRNCH,RRET         COPY                        @Y17XARV 71271800
         CLI   ACTFLG,ZERO         IS ACTION FLAG ZERO         @Y17XARV 71272000
         BE    ACTOFF              YES - GO TURN               @Y17XARV 71272200
         O     RBRNCH,INPGON       TURN ON IN-PROG BIT         @Y17XARV 71272400
         B     SETINPG             TURN ON TRMINPG             @Y17XARV 71272600
ACTOFF   EQU   *                                               @Y17XARV 71272800
         N     RBRNCH,INPGOFF      TURN OFF IN-PROG BIT        @Y17XARV 71273000
SETINPG  EQU   *                                               @Y17XARV 71273200
         CS    RRET,RBRNCH,TRMBYTE2   ATTEMPT TO SET TRMINPG   @Y17XARV 71273400
         BNE   RETRY2              TRY AGAIN IF BIT NOT SET    @Y17XARV 71273600
*                                                              @Y17XARV 71273800
ACTRTN   EQU   *                                               @Y17XARV 71274000
         L     RRET,ACTSAVE        LOAD RETURN REGISTER        @Y17XARV 71274200
         BR    RRET                                            @Y17XARV 71274400
         EJECT                                                 @Y17XARV 71274600
*********                                                      @Y17XARV 71274800
**       THIS SECTION OF CODE ADDS THE ORIGINAL OPCE TO THE    @Y17XARV 71275000
**       A/D WAIT CHAIN                                        @Y17XARV 71275200
*********                                                      @Y17XARV 71275400
         SPACE 3                                               @Y17XARV 71275600
CHNADD   EQU   *                                               @Y17XARV 71275800
         ST    RRET,CHNASAVE       SAVE RETURN ADDR.           @Y17XARV 71276000
         SLR   RWORK3,RWORK3       CLEAR                       @Y17XARV 71276200
         L     RWAITCHN,OPCWAITA   LOAD A/D WAIT CHAIN ANCHOR  @Y17XARV 71276400
         LTR   RWAITCHN,RWAITCHN   IS WAIT CHAIN EMPTY         @Y17XARV 71276600
         BH    CHNSRCH             NO - GO SEARCH CHAIN FOR END@Y17XARV 71276800
         MVC   OPCWAITA(4),ORGOPCEA  PUT ADDR OF ORIGINAL OPCE @Y17XARV 71277000
*                                    INTO A/D WAIT CHAIN ANCHOR@Y17XARV 71277200
         B     CHNLINK             GO SET OCLINK FIELD IN ORIG @Y17XARV 71277400
*                                    OPCE                      @Y17XARV 71277600
         SPACE 2                                               @Y17XARV 71277800
*        SEARCH CHAIN FOR END AND ADD ORIGINAL OPCE            @Y17XARV 71278000
         SPACE 1                                               @Y17XARV 71278200
         USING IEDQOPCE,RWAITCHN                               @Y17XARV 71278400
CHNNXTEL EQU   *                                               @Y17XARV 71278600
         L     RWAITCHN,OCLINK                                 @Y17XARV 71278800
CHNSRCH  EQU   *                                               @Y17XARV 71279000
         SR    RWORK3,RWORK3       CLEAR WORK REGISTER         @YM03732 71279200
         ICM   RWORK3,SEVEN,OCLINK+1  GET LINK ADDR            @YM03732 71279400
         BNZ   CHNNXTEL            MOVE CHAIN POINTER TO NEXT  @Y17XARV 71279600
*                                    OPCE                      @Y17XARV 71279800
         SPACE 2                                               @Y17XARV 71280000
*        ADD ORIGINAL OPCE TO CHAIN                            @Y17XARV 71280200
         SPACE 1                                               @Y17XARV 71280400
         MVC   OCLINK(4),ORGOPCEA  POINT TO ORIGINAL OPCE      @Y17XARV 71280600
CHNLINK  EQU   *                                               @Y17XARV 71280800
         L     RWAITCHN,ORGOPCEA   LOAD ADDR OF ORIG OPCE      @Y17XARV 71281000
         ST    RWORK3,OCLINK       SET OCLINK TO 0             @Y17XARV 71281200
         SPACE 2                                               @Y17XARV 71281400
         L     RRET,CHNASAVE                                   @Y17XARV 71281600
         BR    RRET                                            @Y17XARV 71281800
         EJECT                                                 @Y17XARV 71282000
*********                                                      @Y17XARV 71282200
**       THIS SECTION REMOVES THE ORIGINAL OPCE FROM           @Y17XARV 71282400
**       THE A/D WAIT CHAIN                                    @Y17XARV 71282600
*********                                                      @Y17XARV 71282800
         SPACE 3                                               @Y17XARV 71283000
CHNRMV   EQU   *                                               @Y17XARV 71283200
         ST    RRET,CHNRSAVE       SAVE RETURN ADDR            @Y17XARV 71283400
         L     RWAITCHN,OPCWAITA   LOAD A/D WAIT CHAIN ANCHOR  @Y17XARV 71283600
         LA    RWORK2,OPCWAITA-(OCLINK-IEDQOPCE) SET LAST OPCE @Y17XARV 71283800
*                                   ADDR SO OPCWAITA IN OCLINK @Y17XARV 71284000
         SR    RWORK3,RWORK3            CLEAR REG FOR ICM      @YM03732 71284200
         ICM   RWORK3,SEVEN,OCLINK+1 GET LINK ADDR             @YM03732 71284400
         BNZ   CHNRCHK             FIND ORIGINAL OPCE IN       @Y17XARV 71284600
*                                    WAIT CHAIN                @Y17XARV 71284800
         ST    RWORK3,OPCWAITA     REMOVE ORIG OPCE FROM CHAIN @Y17XARV 71285000
*                                    AND SET ANCHOR TO 0       @Y17XARV 71285200
         B     CHNRRTN             RETURN                      @Y17XARV 71285400
CHNRLOOP EQU   *                                               @Y17XARV 71285600
         LR    RWORK2,RWAITCHN     SAVE CHAIN PTR AS LAST      @Y17XARV 71285800
         L     RWAITCHN,OCLINK     POINT TO NEXT OPCE ON CHAIN @Y17XARV 71286000
CHNRCHK  EQU   *                                               @Y17XARV 71286200
         LH    RWORK3,OCTRMTBL     LOAD                        @Y17XARV 71286400
         N     RWORK3,AVTCLRHI       OCTRMTBL                  @Y17XARV 71286600
         SR    RWORK3,RORGOFF      IS THIS THE ORIGINAL OPCE   @Y17XARV 71286800
         BNZ   CHNRLOOP            NO - GO LOOK AT NEXT OPCE   @Y17XARV 71287000
         L     RWORK,OCLINK        COPY ADDR OF NEXT OPCE      @Y17XARV 71287200
         ST    RWORK3,OCLINK       SET OCLINK TO ZERO FOR      @Y17XARV 71287400
*                                    ORIG OPCE                 @Y17XARV 71287600
         ST    RWORK,OCLINK-IEDQOPCE(RWORK2) REMOVE OPCE       @Y17XARV 71287800
         SPACE 2                                               @Y17XARV 71288000
CHNRRTN  EQU   *                                               @Y17XARV 71288200
         L     RRET,CHNRSAVE       LOAD RETURN ADDR.           @Y17XARV 71288400
         BR    RRET                RETURN                      @Y17XARV 71288600
         EJECT                                                 @Y17XARV 71288800
NEGTTEL  DC    A(TRMPRFSZ)              LENGTH OF NEG. PART    @Y17XARV 71289000
*                                        OF TTE                @Y17XARV 71289200
TONSAVE  DS    1A                       SAVE AREA FOR RRET     @Y17XARV 71289400
CASSAVE  DS    1A                       SAVE AREA FOR RRET     @Y17XARV 71289600
ACTSAVE  DS    1A                       SAVE AREA FOR RRET     @Y17XARV 71289800
CHNASAVE DS    1A                       SAVE AREA FOR RRET     @Y17XARV 71290000
CHNRSAVE DS    1A                       SAVE AREA FOR RRET     @Y17XARV 71290200
ORGOPCEA DS    1A                       ADDR. OF ORIG. OPCE    @Y17XARV 71290400
SAVEREG  DS    2F                       REG. SAVE AREA         @Y17XARV 71290600
INPGON   DS    0F                       MASK TO TURN ON        @Y17XARV 71290800
         DC    AL1(TRMINPG)              TRMINPG               @Y17XARV 71291000
         DC    AL3(0)                                          @Y17XARV 71291200
INPGOFF  DS    0F                       MASK TO TURN OFF       @Y17XARV 71291400
         DC    AL1(255-TRMINPG)          TRMINPG BIT           @Y17XARV 71291500
         DC    X'FFFFFF'                                       @Y17XARV 71291600
LINERG   DC    F'2'                     VALUE OF HI ORDER      @Y17XARV 71291700
*                                         NIBBLE FOR LINES IN  @Y17XARV 71291800
*                                         TRMTYPE              @Y17XARV 71291900
FLAGS    DC    X'00'                    FLAGS                  @Y17XARV 71292000
NOP      EQU   X'08'                    NO OPERATION           @Y17XARV 71292200
DONE     EQU   X'04'                    DONE FLAG              @Y17XARV 71292400
LUP      EQU   X'02'                    LOOK UP FLAG           @Y17XARV 71292500
CLUST    EQU   X'01'                    CLUSTER FLAG           @Y17XARV 71292600
ACTFLG   DC    X'00'                    ACTION FLAG            @Y17XARV 71292700
SAVE13   DS    A                        SAVE AREA FOR REG 13   @YM04632 71292800
PROGSAVE DS    18A                      SAVE AREA              @YM04632 71292900
ZAPPATCH DC    50X'00'                  PATCH AREA             @Y17XARX 71293000
         EJECT                                                 @Y17XARV 71293200
         TITLE 'IEDQCA-OP CTL AVT'                             @Y17XARX 71293400
OPCAVT   DS    0D                  AVT ON DOUBLE WORD BOUNDARY          71293600
OPCDOUBL DC    D'0'                WORK SPACE FOR TRANSIENTS   @Y17XARX 71293800
OPCAVTPT DC    A(0)                ADDRESS OF TCAM AVT                  71400022
OPCCOPCE DC    A(0)                ADDRESS OF CURRENT OPCE              71500022
OPCDCBLK DC    A(DCBLOCAT)         ADDRESS OF DCB, RLN, ADDRESS LOOK-UP 71600022
OPCGTBLD DC    A(GETBLDL)          ADDRESS OF OPTION FLD LOOKUP@Y17XARX 71650000
OPCTOFLK DC    A(TRMOFLOC)         ADDRESS TO GET TNT OFFSET,TERM ENTRY 71800022
OPCIPLAD DC    A(ADDRDCB)               ADDRESS OF IPL DCB     @Y17XARX 71830000
         DC    A(0)                     UNUSED                 @Y17XARX 71860000
OPCLCB   DC    A(LCBSETUP)         ADDRESS OF LCB SET UP ROUTINE        72000022
OPCPGCK  DC    A(PROGRTNE)         IN-PROG CHECK AND SET RTN   @Y17XARV 72020000
OPCTNTEA DC    A(TNTENTAD)         FIND TNT ROUTINE            @Y17XARX 72040000
OPCPSTWT DC    A(POSTWAIT)         TPOST-&-WAIT ROUTINE        @Y17XAWC 72060000
OPCTRMWA DC    F'0'                WORKAREA FOR PICKING UP TNT ADDRESS  72100022
OPCSAVE  DC    18F'0'              OP CONTROL SAVE AREA        @Y17XARX 72150000
*   DO NOT INSERT CARDS OR MOVE CARDS BETWEEN THESE COMMENTS          * 72300022
OPCQCBAD DC    A(OPCPWCOB)         ADDRESS OF OPC QCB          @YM08508 72400000
OPCRSAVE DC    2F'0'               BASE AND RETURN SAVEAREA (IGC0010D)  72500022
OPCWORK  DC    A(CMDWORKA)         ADDRESS OF RESIDENT WORKAREA         72600022
OPCWRKSZ DC    H'540'              SIZE OF RESIDENT WORKAREA            72700022
OPCFLAG1 DC    X'00'               FLAG BYTE FOR TRANSIENT USE          72800022
OPCFLAG2 DC    X'00'               FLAG BYTE FOR TRANSIENT USE          72900022
OPCBFERB DC    F'0'                BUFFER                               73000022
         DC    X'E4',AL3(0)              REQUEST                        73100022
         DC    X'02',AL3(0),X'0100',H'0'        ERB                     73200022
*   DO NOT INSERT CARDS OR MOVE CARDS BETWEEN THESE COMMENTS          * 73300022
OPCCKERB DC    X'40',AL3(0)        CHECKPOINT                           73400022
         DC    X'EC',AL3(0)                  REQUEST                    73500022
         DC    X'00',AL3(0),H'0',H'0'               ERB                 73600022
OPCAQCTL DC    3F'0'               SVC 102 PARAMETER LIST               73700022
OPCWAIT  DC    A(OLCBECB)          OP CONTROL WAIT LIST                 73800022
         DC    2F'0'               WAIT LIST (CONT)                     73900022
OPCXCTL  XCTL  EPLOC=OPCLDNME,SF=L                                      74000022
OPCLDNME DS    0CL8                XCTL MODULE NAME            @Y17XARX 74050000
         DC    CL3'IGC'            MODULE NAME PREFIX          @Y17XARX 74100000
OPCMODID DC    CL2' '              MODULE ID                   @Y17XARX 74130000
         DC    CL3'10D'            MODULE NAME SUFFIX          @Y17XARX 74160000
OPCWAITC DC    F'0'                QCW FOR CHECKPOINT WAIT QUEUE        74200022
OPCWAITL DC    F'0'                QCW FOR LCB WAIT QUEUE               74300022
OPCWAITN DC    F'0'                FID0 RESP WAIT CHAIN        @Y17XARX 74350000
OPCWAITO DC    F'0'                OUTPUT QUEUE QCW                     74500022
OPCWAITP DC    A(0)                SSCP OPCE Q FOR ACTPU'S     @Y17XARX 74550000
OPCWAITR DC    F'0'                QCW FOR RESOURSE WAIT QUEUE          74600022
OPCWAITA DC    F'0'                QCA FOR ACT/DEACT WAIT CHN  @Y17XARX 74610000
OPCCKPTF DC    F'0'                FIRST OPCE FOR CHECKPT      @Y17XARX 74620000
OPCCKPTL DC    F'0'                LAST OPCE FOR CHECKPT       @Y17XARX 74630000
OPCHORT  DC    A(COHORTLK)         COHORT SEARCH ROUTINE       @Y17XARX 74640000
OPCHORTG DC    A(CHORTGLK)         COHORTG SEARCH ROUTINE      @Y17XARX 74650000
OPCSCNC  DC    F'0'                FID1 SC/NC WAIT CHAIN       @Y17XARX 74660000
OPCFMDFC DC    F'0'                FID1 FM/DFC WAIT CHAIN      @Y17XARX 74670000
OPCNEXT  DC    A(0)                ADDRESS OF ELEMENT FREED BY PREVIOUS 74700022
OPCGETBF DC    A(ALLOCBUF)         ADDRESS OF BUFFER REQUEST ROUTINE    74800022
OPCFREBF DC    A(FREEBUFF)         ADDRESS OF BUFFER UNIT FREE ROUTINE  74900022
OPCBFREQ DC    H'0'                NO. OF BUFFERS NEEDED BY WAIT LIST   75000022
OPCHA8   DC    H'8'                HALF WORD SET TO 8                   75100022
OPCCLNTS DC    X'0'                TEST AND SET SWITCH FOR     @YM07310 75200000
*                                  QUEUE SEARCH                @YM07310 75230000
OPCIPLCT DC    X'0'                COUNT OF 3705'S BEING IPLED @YM08447 75260000
OPCAVBUF DC    H'0'                NO, OF BUFFERS IN OPC FREE POOL      75300022
OPCBFIRS DC    F'2'                ADDRESS OF FIRST UNIT IN FREE POOL   75400022
OPCBFEND DC    F'0'                CURRENT UNIT END (IGC0110D)          75500022
OPCSPEC  DC    X'00'               SPECIAL FLAGS USED BY IEDQCA         75600022
OPCRSTRT EQU   X'20'               RESTART IN PROGRESS FLAG    @YM07252 75650000
OPCOQSW  DC    X'00'               SWITCH THAT INDICATES OUTPUT BUSY    75700022
OPCHNEND TM    OPCEND,ZERO         EXECUTED TO FIND END OF BUFFER UNITS 75800022
OPCSTCBS DC    X'00'               SWITCH TO INDICATE STCB BUSY         75900022
OPCEND   DC    X'03'               TESTED BYTE TO DECTECT UNIT END      76000022
OPCCKCIB DC    A(CHECKCIB)              ADDR OF CMD CHECK RTN  @YA04391 76050056
OPPOLSTP DC    A(POLSTOP)               ADDRESS OF POLLSTOP SUB@XA09783 76070058
OPCRQCNT DC    H'0'                FID1 SC/NC COUNTER/SEQ      @Y17XARX 76080000
OPCADGOT DC    H'0'                # OF BUFFER UNITS A/D USING @Y17XARV 76085000
OPCWRKSP DC    7F'0'                    INTERNAL SAVE AREA     @Y17XARX 76090000
OPCBUFWT DC    F'0'                A/D REDRIVE CHAIN           @Y17XARV 76092000
OPCDECR  DC    A(DECRCT)                ADDR. OF A/D DECREMENT @Y17XARV 76094000
*                                         ROUTINE              @Y17XARV 76096000
OPCAPXTL DC    A(OPCXCTL2)         ADDR TO XCTL LIST FOR APPL  @Y17XARV 76098000
*                                  PGM USAGE                   @Y17XARV 76099000
OPCTOTCK DC    A(0) .              TOTE HEIRARCHY SCAN ROUTINE @Y17XARR 76100000
OPCWAITV DC    A(0) .              VARY FOR 3705 RESOURCES WAIT CHAIN   76120000
*                                                              @Y17XARR 76140000
OPCPWCOB DS    0CL12               OPERATOR CONTROL QCB FOR POSTWAIT    76142000
*                                  ROUTINE TO SYNCHRONIZE TASKS@YM08403 76144000
OPCPWQCB DS    0F                  QCB MAP                     @YM08403 76146000
OPCPWVTO DC    XL1'2'              VTO                         @YM08486 76148000
OPCPWCHN DC    AL3(0)              ELEMENT CHAIN               @YM08403 76150000
OPCPWECB DS    0F                  ECB                         @YM08403 76152000
OPCPWCCC DC    XL1'0'              ECB COMPLETION CODE         @YM08403 76154000
         DC    AL3(0)              UNUSED                      @YM08403 76156000
         DC    XL1'0'              UNUSED                      @YM08486 76158000
OPCPWSTC DC    AL3(OPCPWVTO)       NEXT STCB                   @YM08486 76159000
CMDWORKA DC    140F'0'                  RESIDENT WORKAREA               76160000
         TITLE 'IEDQCA-DUMMY LCB/SCB FOR OUTPUT'                        76200022
OPCXCTL2 XCTL  EPLOC=OPCLDNM2,SF=L      XCTL FIELD             @XA06556 76230058
OPCLDNM2 DC    C'IGC0010D'              XCTL NAME FIELD        @XA06556 76260058
OLCBQCBA DC    A(0)                ADDRESS OF IEDQBD QCB                76300022
OLCBPRI  DC    X'E7',AL3(0)        PRIORITY FOR OUTPUT                  76400022
OLCBSTCB DC    A(OSTCB)            ADDRESS OF OUR STCB FOR OUTPUT       76500022
OLCBZ1   DC    6F'0'               FIELDS ZEROED BY BD                  76600022
OLCBECB  DC    F'0'                ECB FOR THIS LCB                     76700022
OLCBZ2   DC    3F'0'               SOME FIELDS USED BY BD      @OX19903 76800082
         DC    X'70',AL3(OLCBZ1+4) DUMMY QCB ADDR USED BY BD   @OX19903 76820082
         DC    2F'0'               WORK FIELDS USED BY BD      @OX19903 76840082
OLCBBUFF DC    A(0)                ADDRESS OF OUTPUT BUFFER             76900022
OLCBZ3   DC    H'0'                RESERVED BYTES                       77000022
OLCBSEND DC    2X'00'              RECIEVE OPERATION                    77100022
OLCBZ4   DC    3F'0'               FIELDS USED BY BD                    77200022
OLCBERB  DC    X'41',AL3(0)        ERB STATUS FLAGS                     77300022
OLCBZ5   DC    F'0'                RESERVED FIELD                       77400022
OLCBSCBA DC    A(OSCBQCB)          ADDRESS OF OUR STCB                  77500022
OLCBRMDR DC    12F'0'                   REMAINING DUMMY LCB    @Y17XARX 77550000
OSCBQCB  DC    A(0)                ADDRESS OF DESTINATION QCB           77600022
OSCBINOT DC    A(0)                ADDRESS OF DUMMY IN/OUT IN AVT       77700022
OSCBPRI  DC    X'F9',AL3(0)        HIGHEST PRIORITY FOR OUTPUT          77800022
OSCBRMDR DC    18F'0'                   REMAINING DUMMY SCB    @Y17XARX 77850000
OPCDSRWT DC    F'0'                     DISPLAY STORE QUEUE    @ZM47883 77870000
         DC    18F'0'                   DEBUG WORK AREA                 77900022
GETBLDL  EQU   *                                                        78000022
         DC    A(0)                     LA OR LU                        78100022
         DC    AL1(0)                   HIARCHY FILL                    78200022
         DC    AL3(0)                   ADDR. OF ADDFR. LIST            78300022
         DC    X'20'                    EC MODE                         78400022
         DC    AL1(0)                   SUBPOOL VALUE                   78500022
BLDLLIST DC    AL2(1),AL2(58)           PREFIX FOR BLDL                 78600022
NAME     DC    CL8'IEDQFE',XL50'00'        BLDL ENTRY FOR SERVICE AID L 78700022
*                                       LOAD                            78800022
ADDROPEN DC    A(OPENCODE)              ADDR OF CODE TO OPEN DCB S22024 78810022
*                                       FOR IPL                  S22024 78820022
ADDRDCB  DCB   DDNAME=DDIPL,BLKSIZE=1028,BUFL=1028,DEVD=DA,DSORG=PO,   X78830022
               MACRF=R,RECFM=U                                          78840022
ADDRDCB2 DCB   DDNAME=DDITEST,BLKSIZE=1028,BUFL=1028,DEVD=DA,DSORG=PO, X78850022
               MACRF=R,RECFM=U                                          78860022
         TITLE 'IEDQCA - DSECTS REFERENCED BY THIS MODULE'              78900022
IEDQCIB  DSECT                          MAP OF A CIB           @YM08136 78906000
CIBQCBA  DS    F                        QCB ADDRESS            @YM08136 78912000
CIBPRI   DS    XL1                      PRIORITY               @YM08136 78918000
CIBLINK  DS    AL3                      LINK FIELD             @YM08136 78924000
CIBVERB  DS    XL1                      VERB COMMAND CODE      @YM08136 78930000
CIBLEN   DS    XL1                      LENGTH OF THE CIB      @YM08136 78936000
CIBRLN   DS    XL1                      RELATIVE LINE NUMBER   @YM08136 78942000
CIBRC    DS    XL1                      REQUEST REURN CODE     @YM08136 78948000
CIBFLAG  DS    XL1                      TOTE FLAG              @YM08136 78954000
CIBALT   EQU   X'80'                    TTCIN OF THE RESOURCE  @YM08136 78960000
*                                       IS AT END OF CIB       @YM08136 78966000
CIBECBA  DS    AL3                      ECB ADDRESS            @YM08136 78972000
CIBTNAME DS    CL8                 TERMNAME                    @YM08136 78978000
CIBTTCIN DS    H                   TTCIN  OF COUNTERFEIT       @YM08136 78984000
         TAVTD                                                          79000022
         EJECT                                                          79100022
         DCBD  DSORG=TX                                                 79200022
         EJECT                                                          79300022
         TDEBD                                                          79400022
         EJECT                                                          79500022
         TDISPD                                                         79600022
         EJECT                                                          79700022
*                                                                       79800056
         EJECT                                                          79900022
         TLCBD                                                          80000022
         TLGBD                                                   S22024 80050022
         EJECT                                                          80100022
         TOPCED                                                         80200022
         EJECT                                                          80300022
         TPRFD                                                          80400022
         EJECT                                                          80500022
         TPRIOR                                                         80600022
         EJECT                                                          80700022
         TQCBD                                                          80800022
         EJECT                                                          80900022
         TSCBD                                                          81000022
         EJECT                                                          81100022
         TTNTD                                                          81200022
         EJECT                                                          81300022
         TTRMD                                                          81400022
         EJECT                                                          81400100
         IHAPSA                                                @G36XRRU 81400200
         SPACE 2                                                        81400300
         END                                                            81500022
