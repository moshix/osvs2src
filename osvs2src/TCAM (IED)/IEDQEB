IEDQEB   TITLE '''IEDQEB (IGC102)'' - AQCTL SVC'                        00100005
IGC0010B CSECT                                                   Y02027 00200006
*A000000-999999                                                @X31X8D0 00200500
         SPACE 4                                                        00201022
*CHANGE-ACTIVITY = AS FOLLOWS:                                  SA21903 00202022
************************MICROFICHE FLAGS ******************** SUPT CODE 00203022
*C THIS MODULE HAS BEEN COMPLETELY REWRITTEN FOR TCAM LEVEL 6    Y02027 00203506
*C167000,198500,202000,296000,300000,478000                     0Y00448 00204022
*A202300,202600,501700                                           A44022 00205022
*A383000,502000                                                  A42413 00210021
*C198500,199400,427000,431000                                    CLUP21 00220021
*A422000                                                         CLUP21 00230021
*A202300,202600,501700                                           A44022 00240021
*A198000,206000                                                  A42362 00250021
*C199400,252000,379000                                           CLUP21 00250121
*C199400                                                         A42362 00260021
*A468000                                                         CLUP21 00260121
*A237760,237800,489500-489600                                    X01004 00262105
*A058580-058900,122910-122970,188000,196200-196600,237020-237740,Y01004 00264105
*A237780,459670-459950,468100-468400,489100-489400,490070-490770 Y01004 00266105
*C185000,187000,199200,229500-229700,252000,379000,395000,       Y01004 00268105
*C397000-398000,427000,431000,445000,447000,450000               Y01004 00270105
*D186000,190000-192000,195000,199400,229800,252500-253000,289000,Y01004 00272105
*D379500,386000-387000,391000,448000-449000,452000,477000,492000,Y01004 00274105
*D501500,502500                                                  Y01004 00276105
*A459280,459520                                                  Y05330 00278105
*C006000,236180-236270                                           Y05330 00280105
*D236360                                                         Y05330 00282105
*C001000,158000,199000,213000,236810,272000,400000,457000,466000,Y01948 00284105
*C468500,473000,490000,491000,493000,495000-497000,501100-501200 Y01948 00286105
*D468600-468700                                                  Y01948 00288105
*A459840,501400                                                 OY01838 00290105
*A459170,459625-459635                                          OX03022 00290205
*C459300,459526                                                 OX03022 00290305
*C237540,A237546-237552                                          Y05331 00290405
*C004000-513000                                                  Y02027 00290506
*A237140                                                        OX02211 00294454
*A002000                                                       @Z30X8DM 00294508
*C003000,006000                                                @Z30X8DM 00294608
*D351800                                                       @Z30X8DM 00294708
*A294800,297800                                                @ZA02099 00295461
*C297400                                                       @ZA02615 00296461
*D297800                                INSTRUCTION IN TWICE   @ZA02099 00297461
*C446800                                                       @ZA02086 00298461
*C239200-240000,367800-368600,369400-369600                    @ZA03744 00298609
*A363200,366000                                                @ZA04032 00298809
*C201200,202800                                                @ZA05014 00299009
*D202060                                                       @ZA05014 00299209
*A202400                                                       @ZA05014 00299409
*A202430,203000,443700                                         @ZA05000 00299609
*A010100,031800,099000,161600,166000,170000                    @Z40X9DG 00300009
*A185600,186000,194200,464200                                  @Z40X9DG 00300109
*C006000,438400,439600,439800-441800,443300,443400-444800      @Z40X9DG 00300209
*C445000-446000,446200-446600,446800-451200,451400,451800      @Z40X9DG 00300309
*C454000,459200,461150                                         @Z40X9DG 00300409
*C199000-200600                                                @Z40X9DG 00300509
*C200800-203000,439800-441800,446200-446600                    @Z40X9DG 00300609
*C363320                                                       @OY11959 00300781
*C226400-226600,355600-355800,385600-385800                    @OZ07830 00300891
*D232400                                                       @OZ09927 00320891
*C312180-312228                                                @OZ08344 00340891
*A455600                                                       @OZ08344 00360891
*C252800                                                       @OZ08368 00360991
*A252600                                                       @OZ08368 00361091
*C360200                                                       @OZ16523 00361191
*A206800,207400,208900,209800,451850                           @OZ17630 00361291
*D332650-332750                                                @OY14092 00361391
*A274200                                                       @OZ17641 00361491
* A010300,100000,158000,169000,194320,198600,222600,           @G36XRDV 00368400
* A439690,464200                                               @G36XRDV 00375400
* C006000,100000,461150                                        @G36XRDV 00382400
*D191000-191200                                                @OZ26648 00382582
*A191800                                                       @OZ26648 00382682
*C461150                                                       @OZ26648 00382782
* DUMMY APAR                                                   @OZ27328 00382882
*C241600,373400                                                @OZ27843 00382982
*A325600                                                       @OZ18744 00383082
*                                                                       00389400
         EJECT                                                 @Z40X9DG 00400009
*********************************************************************** 00430009
*                                                                     * 00460009
*TITLE: 'IEDQEB'  TCAM COMMUNICATION SVC                              * 00500020
*STATUS = CHANGE LEVEL 10                                      @G36XRDV 00600000
*MODULE-NAME = IEDQEB                                           SA21903 00650022
*DESCRIPTIVE NAME = TCAM COMMUNICATION SVC                      SA21903 00660022
*COPYRIGHTS = 'NONE'                                            SA21903 00670022
*FUNCTION: THIS ROUTINE SUPPORTS TCAM APPLICATION PROGRAMS AND        * 00700020
*   ATTACHED TASKS BY HANDLING THE COMMUNICATIONS IN KEY ZERO         * 00870006
*   BETWEEN THE APPLICATION PROGRAM MEMORY AND THE MCP MEMORY         * 00940006
*   USING CONTROL BLOCKS IN KEY 6 IN CSA.                             * 01010006
*                                                              @Z40X9DG 01020009
*   THIS ROUTINE PROCESSES REQUESTS BY TCAM'S DISK IO ROUTINE  @Z40X9DG 01030009
*   AND THE NCP INPUT/OUTPUT DRIVER                            @G36XRDV 01035000
*   TO ISSUE A STARTIO MACRO. IT ALSO PROCESSES REQUESTS TO    @Z40X9DG 01040009
*   SCHEDULE SRB'S TO DO 'CROSS MEMORY' POSTS. A SUBROUTINE    @Z40X9DG 01050009
*   OF THIS MODULE WILL RUN UNDER THE SRB.                     @Z40X9DG 01060009
*                                                                     * 01080006
*   UPON ENTRY, A TESTAUTH IS DONE FOR APF AUTHORIZATION. IF NOT      * 01150006
*   FOUND, THE TCX IS CHECKED FOR NO AUTHORIZATION NEEDED.  IF        * 01220006
*   THIS IS THE CASE, THE CHAIN OF PEB'S (ONE FOR EACH OPEN A.P.)     * 01290006
*   IS SEARCHED FOR A TCB-ASCB MATCH. IF NO MATCH IS FOUND, THE       * 01360006
*   TASK IS ABENDED.                                                  * 01430006
*                                                                     * 01500006
         EJECT                                                          01570006
*   THE FOLLOWING ARE PERFORMED ACCORDING TO CODE:                    * 01640006
*                                                                     * 01710006
*   CODE  FUNCTION                                                    * 01780006
*   (4) - OPERATOR CONTROL AN NETWORK CONTROL                         * 01850006
*   (8) - MOVE IN MEMORY                                              * 01920006
*   (C) - POST ELEMENT TO ASYNCHRONOUS READY QUEUE AND POST           * 01990006
*         MCP ECB COMPLETE                                            * 02060006
*   (10)- GET/READ PREPARES AN AIB WITH INFORMATION FOR THE MCP       * 02130006
*         ROUTINE, POSTS THE AIB TO ACTIVATE IEDQEW, WAITS FOR        * 02200006
*         COMPLETION, MOVES MESSAGE TO WORKAREA, AND SETS RETURN CODE * 02270006
*   (14)- PUT/WRITE MOVES THE MESSAGE AND OTHER INFORMATION FOR THE   * 02340006
*         MCP ROUTINE TO THE AIB, POSTS THE AIB TO ACTIVATE IEDQEC,   * 02410006
*         WAITS FOR COMPLETION, AND SETS RETURN CODE.                 * 02480006
*   (18)- POINT CHECKS FOR RETRIEVE TERMINATION, SETS UP MULTIPLE     * 02550006
*         RETRIEVAL, MOVES USER DATA AND OTHER INFORMATION TO AIB,    * 02620006
*         POSTS AIB TO ACTIVATE IEDQES TO DO CHECKING, WAITS ON       * 02690006
*         COMPLETION, AND SETS RETURN CODE.                           * 02760006
*   (1C)- CHECK REQUESTS SETS UP THE AIB AS A CRE FOR THE MCP CHECK   * 02830006
*         POINT ROUTINE. THE RCB IS POSTED TO THE QCB IN THE AVT,     * 02900006
*   (20)- POST ECB IN MEMORY                                          * 02970006
*   (24)- QUEUE RESET INITIALIZES AIB WITH INFORMATION NEEDED BY THE  * 03040006
*         MCP ROUTINE, POSTS THE AIB TO ACTIVATE IEDQGQ, WAITS FOR    * 03110006
*         COMPLETION,AND SETS RETURN CODE.                            * 03180006
*   (28)- ISSUE STARTIO MACRO FOR MESSAGE QUEUES DISK I/O      @Z40X9DG 03200009
*   (2C)- SCHEDULE AN SRB TO DO 'CROSS MEMORY' POST            @Z40X9DG 03220009
*                                                                     * 03250006
*   THE FOLLOWING SUBROUTINES ARE USED BY THE FUNCTION CODE:          * 03320006
*                                                                     * 03390006
*   AIBSUBR - THIS SUBROUTINE GETS A FREE AIB FROM THE CHAIN, MARKS   * 03460006
*         IT BUSY, AND PASSES THE ADDRESS IN REGISTER 1.              * 03530006
*                                                                     * 03600006
*   TPOSTSUB - THIS SUBROUTINE PUTS AN ELEMENT ON THE ASYNCHRONOUS    * 03670006
*         READY QUEUE THROUGH COMPARE AND SWAP. IT POSTS THE          * 03740006
*         MCP-ECB COMPLETE.                                           * 03810006
*ENTRY POINT:                                                         * 04300020
*       IGC0010B                                                      * 04400006
*INPUT:                                                               * 04500020
*   REGISTER 1 POINTS TO A PARAMETER LIST WHICH HAS A FUNCTION CODE   * 04600006
*         IN THE FIRST BYTE AND THE HIGH ORDER BIT ON IN THE LAST     * 04700006
*         WORD.                                                       * 04800006
*                                                                     * 04900006
*         FUNCTION                      PARAMETER LIST                * 05000006
*                                                                     * 05100006
*                                       ************************      * 05200006
*         OPCTL & NETWORK CONTROL       *X'84'* PARAM ADDRESS  *      * 05300006
*                                       ************************      * 05400006
*                                                                     * 05500006
         EJECT                                                          05600006
*                                       ************************      * 05700006
*         MOVE IN MEMORY                **'08'* DATA ADDRESS          * 05800006
*                                       ************************      * 05900006
*                                       **'00'* TARGET ADDRESS *      * 06000006
*                                       ************************      * 06100006
*                                       **'80'* LENGTH ADDRESS *      * 06200006
*                                       ************************      * 06300006
*                                                                     * 06400006
*                                       ************************      * 06500006
*         TPOST TO READY QUEUE          *X'0C'* RCB ADDRESS    *      * 06600006
*                                       ************************      * 06700006
*                                       *X'00'* RCB ADDRESS    *      * 06800006
*                                       ************************      * 06900006
*                                       *X'80'* LENGTH ADDRESS *      * 07000006
*                                       ************************      * 07100006
*                                                   OR                * 07200006
*                                       ************************      * 07300006
*                                       *X'8C'* RCB ADDRESS    *      * 07400006
*                                       ************************      * 07500006
*                                                                     * 07600006
*                                       ************************      * 07700006
*         GET/READ                      *X'90'* ECB ADDRESS    *      * 07800006
*                                       ************************      * 07900006
*                                                                     * 08000006
*                                       ************************      * 08100006
*         PUT/WRITE                     *X'94'* ECB ADDRESS    *      * 08200006
*                                       ************************      * 08300006
*                                                                     * 08400006
*                                       ************************      * 08500006
*         POINT                         *X'98'* ECB ADDRESS    *      * 08600006
*                                       ************************      * 08700006
*                                                                     * 08800006
*                                       ************************      * 08900006
*         CKREQ                         *X'9C'* ECB ADDRESS    *      * 09000006
*                                       ************************      * 09100006
*                                                                     * 09200006
*                                       ************************      * 09300006
*         POST ECB                      *X'A0'* ECB ADDRESS    *      * 09400006
*                                       ************************      * 09500006
*                                                                     * 09600006
*                                       ************************      * 09700006
*         QRESET                        *X'A4'* ECB ADDRESS    *      * 09800006
*                                       ************************      * 09900006
*                                                                     * 09905009
*                                       ************************      * 09910009
*         STARTIO                       *X'28'* IOSB ADDRESS   *      * 09915009
*                                       ************************      * 09920009
*                                       *X'80'* CPB ADDRESS    *      * 09925009
*                                       ************************      * 09930009
*                                                                     * 09935009
*                                       ************************      * 09940009
*         SCHSRB                        *X'2C'* ECB ADDRESS    *      * 09945009
*                                       ************************      * 09950009
*                                       *      ASCB ADDRESS    *      * 09955009
*                                       ************************      * 09960009
*                                       * CC  *     *  ASID    *      * 09965009
*                                       ************************      * 09970009
*                                       *       TCB ADDRESS    *      * 09975009
*                                       ************************      * 09980009
*         NCP STARTIO                   ************************      * 09981000
*                                       *X'B0'* IOSB ADDRESS   *      * 09982000
*                                       ************************      * 09983000
*                                       * CHANNEL PROG ADDRESS *      * 09984000
*                                       ************************      * 09985000
*                                                                     * 09986000
*         LIST POST                     ************************      * 09987000
*                                       *X'B4'* FIRST ELEMENT @*      * 09988000
*                                       ************************        09989000
*                                       * SECOND ELEMENT @     *      * 09990000
*                                       ************************      * 09991000
*                                                                     * 09992000
*                                                                     * 09993000
*                                                                     * 09994000
*   3 -  CVT ADDRESS                                                  * 12400020
*   4 -  TCB ADDRESS                                                  * 12500020
*   5 -  SVRB ADDRESS                                                 * 12530006
*   7 -  ASCB ADDRESS                                                 * 12560006
*   14-  RETURN ADDRESS                                               * 12600020
*   15-  ENTRY POINT                                                  * 12700020
*OUTPUT:                                                              * 12800020
*   15-  COMPLETION CODE                                              * 12900020
*EXTERNAL ROUTINES:                                                   * 13000020
*         POST (BRANCH ENTRY)                                         * 13100006
*         TESTAUTH (BRANCH ENTRY)                                     * 13170006
*         GETMAIN (BRANCH ENTRY)                                      * 13240006
*         SETLOCK                                                     * 13310006
*EXIT-NORMAL: RETURN TO SVC INTERRUPT HANDLER(R15=0)                  * 13400020
*EXIT ERROR:  RETURN TO SVC INTERRUPT HANDLER- R15=X'80'  IF TCAM IS  * 13500006
*             NOT ACTIVE OR R15=X'90' FOR INVALID FUNCTION CODE.      * 13600006
*TABLES/WORKAREAS:                                                    * 13700020
*   CVT    AIB    PSA    ASXB                                         * 13800006
*   AVT    PECB   PEB    DCB                                          * 13900006
*   TCB    TCX    PEWA                                                * 14000006
*   DEB    ASCB                                                       * 14100006
*ATTRIBUTES: REENTRANT, REFRESHABLE, SUPERVISOR MODE                  * 14200020
*NOTES: THIS ROUTINE RESIDES IN LPA LIB FOR USE ONLY BY TCAM.         * 14300006
*       SVC 102 IS A TYPE 3 SVC AND IS ENTERED WITH THE LOCAL LOCK.   * 14350006
*   THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL             * 14400020
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 14500020
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   * 14600020
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     * 14700020
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.          * 14800020
*********************************************************************** 14900020
         EJECT                                                          15000020
         SPACE 2                                                        15100020
         ENTRY IEDQEB                                            Y02027 15200006
         SPACE 2                                                        15300020
*                                                                     * 15400020
*            S Y M B O L I C   R E G I S T E R S                      * 15500020
*                                                                     * 15600020
         SPACE 2                                                        15700020
RZERO    EQU   0                        WORK REGISTER            Y01948 15800005
RFIRST   EQU   1                        FIRST ELMT IN LIST POST@G36XRDV 15850000
RPARM    EQU   1                        PARAMETER LIST REGISTER         15900020
*                                       ECB TO BE WAITED ON      Y02027 16000006
*                                       RCB TO BE TPOSTED        Y02027 16040006
*                                       BASE FOR AIB             Y02027 16080006
*                                                                Y02027 16120006
RPEB     EQU   2                        ADDRESS OF PEB           Y02027 16160006
RIOSB    EQU   2                        POINTER TO IOSB        @Z40X9DG 16180009
RCVT     EQU   3                        COMM. VECTOR TABLE              16200020
RTCB     EQU   4                        TASK CONTROL BLOCK              16300020
RSVRB    EQU   5                        SVRB ADDRESS             Y02027 16400006
RTCX     EQU   6                        TCX ADDRESS              Y02027 16500006
RASCB    EQU   7                        ADDRESS OF ASCB          Y02027 16600006
RIOSBE   EQU   7                        POINTER TO IOSBE       @Z40X9DG 16650009
RDEB     EQU   8                        ADDRESS OF DEB           Y02027 16700006
RBASE    EQU   9                        CSECT BASE REGISTER      Y02027 16800006
RCOMPC   EQU   10                       COMPLETION CODE                 16900020
RLAST    EQU   10                       LAST ELMT IN LIST POST @G36XRDV 16950000
RCECB    EQU   11                       COMPLEMENT OF ECB ADDRESS       17000020
RCPB     EQU   11                       POINTER TO CPB         @Z40X9DG 17050009
RWORK    EQU   12                       WORK REGISTER            Y02027 17100006
RTEMP    EQU   13                       WORK REGISTER            Y02027 17200006
RETURN   EQU   14                       RETURN ADDRESS                  17300020
RENTRY   EQU   15                       ENTRY POINT ADDRESS             17400020
         EJECT                                                 @Z40X9DG 17500009
IEDQEB   DS    0F                                                Y02027 17600006
         BALR  RBASE,RZERO              ESTABLISH                       17700020
*                                                                Y02027 17720006
*              ADDRESSABILITY                                    Y02027 17740006
*                                                                Y02027 17760006
         USING *,RBASE                            ADDRESSABILITY        17800020
         USING IEDQTCX,RTCX             TCAM CVT EXTENSION       Y02027 17900006
*                                       ADDRESSABILITY                  18000020
         USING IEDQTCB,RTCB             TASK CONTROL BLOCK              18100020
*                                       ADDRESSABILITY                  18200020
         USING IEDQPEB,RPEB             ADDRESS OF PEB           Y02027 18300006
         B     IEDPASS                  BRANCH AROUND CONSTANTS@Z40X9DG 18320009
         DC    AL2(PURGE-IGC0010B)      OFFSET TO PURGE CODE - @Z40X9DG 18322009
*                                       THIS HALFWORD MUST BE  @Z40X9DG 18324009
*                                       AT OFFSET 6; VALUE IS  @Z40X9DG 18326009
*                                       USED BY IGG01931       @Z40X9DG 18328009
IEDQEB   IEDHJN ,                                              @Z40X9DG 18330009
IEDPASS  EQU   *                                               @Z40X9DG 18332009
         ST    RETURN,REG15(RSVRB)      SAVE REGISTER FOR RETURN Y02027 18340006
*                                                                Y02027 18360006
*              CHECK FOR AUTHORIZATION                           Y02027 18380006
*                                                                Y02027 18400006
         ICM   RTCX,ALL,CVTAQAVT-CVTMAP(RCVT)  GET TCX ADDRESS   Y02027 18420006
         BZ    NOTACT                   BR IF MCP NOT ACTIVE     Y02027 18440006
         TM    TCXFLAG1-IEDQTCX(RTCX),TCXMCPCD TEST TCX FLAGS    Y02027 18446006
         BNO   AOK                      BR MCP NOT CLOSING DOWN  Y02027 18452006
NOTACT   EQU   *                                                 Y02027 18456006
         LA    RENTRY,EIGHTY            MCP NOT ACTIVE           Y02027 18460006
         B     EXIT                     RETURN TO CALLER         Y02027 18480006
*                                       RETURN  RC=X'80'         Y02027 18500006
AOK      EQU   *                                                 Y02027 18520006
         LR    RCOMPC,RPARM             SAVE PARM THRU TESTAUTH  Y02027 18540006
*                                       AND SETLOCK              Y02027 18560006
         SPACE 1                                               @Z40X9DG 18561009
         CLM   RTCB,ADD,TCXTCB+ONE      IS TCB ADDR SAME AS    @Z40X9DG 18562009
*                                       TCAM'S                 @Z40X9DG 18563009
         BNE   TESTAUTH                 NO, BRANCH             @Z40X9DG 18564009
         CLM   RASCB,ADD,TCXASCB+ONE    IS ASCB ADDR SAME AS   @Z40X9DG 18565009
*                                       TCAM'S                 @Z40X9DG 18566009
         BE    AUTH                     YES, BRANCH - TCAM     @Z40X9DG 18567009
*                                       ISSUED SVC 102 AND     @Z40X9DG 18568009
*                                       AUTH CHECK NOT NEEDED  @Z40X9DG 18569009
         SPACE 1                                               @Z40X9DG 18570009
*                        CHECK FOR AUTHORITY OF APF              Y02027 18580006
*                                                                Y02027 18600006
TESTAUTH EQU   *                                               @Z40X9DG 18610009
         TESTAUTH   FCTN=1,BRANCH=YES                            Y02027 18620006
         LTR   RENTRY,RENTRY            PROGRAM AUTHORIZED       Y02027 18640006
         BZ    AUTH                     BRANCH IF YES            Y02027 18660006
         TM    TCXFLAG1,TCXAUTH         DO A.P. NEED AUTHORIZA-  Y02027 18680006
         BO    ABEND                    TION? BRANCH IF YES      Y02027 18700006
*        IF NO AUTHORIZATION NEEDED, CHECK TO SEE IF ISSUE       Y02027 18720006
*        BY TCAM A.P. BY SEARCHING PEB CHAIN                     Y02027 18740006
PEBO     SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,RELATED=(PEB,       Y02027X18760006
               IEDQEB,PEBR)             LOCK TO SEARCH CHAIN     Y02027 18780006
         LA    RPEB,TCXPEBC             ADDR OF PEB POINTER      Y02027 18800006
PLOOP    ICM   RPEB,ALL,PEBLINK-IEDQPEB(RPEB) ADDRESS OF PEB     Y02027 18820006
         BZ    ABEND                    NO MATCH FOUND IN CHAIN  Y02027 18840006
         CL    RASCB,PEBASCB            ASCB OF SVC = A.P. ASCB  Y02027 18860006
         BNE   PLOOP                    BRANCH NO TO NEXT PEB    Y02027 18880006
*        IF MATCH WAS FOUND, SVC WAS ISSUED BY TCAM A.P.         Y02027 18900006
PEBR     SETLOCK RELEASE,TYPE=CMS,RELATED=(PEB,IEDQEB,PEBO)      Y02027 18920006
*                                                                Y02027 18940006
         EJECT                                                          18960006
AUTH     EQU   *                        VALID SVC ISSUER         Y02027 18980006
*                                                                Y02027 19000006
*              BRANCH TO FUNCTION BASED ON CODE IN FIRST         Y02027 19020006
*              BYTE OF PARAMETER LIST POINTED BY REG1            Y02027 19040006
*                                                                Y02027 19060006
         LA    RPARM,0(RCOMPC)          RELOAD SAVED PARAM REG   Y02027 19080006
         IC    RCOMPC,ZERO(RPARM)       GET FUNCTION CODE FROM   Y02027 19140006
         LA    RZERO,X7F                PARAM LIST. REMOVE EOL   Y02027 19160006
         NR    RCOMPC,RZERO             INDICATOR                Y02027 19180006
         CLM   RCOMPC,ONE,MAXCODE       TEST FOR VALID CODE    @OZ26648 19186082
         BH    RETURN90                 BR IF INVALID          @OZ26648 19192082
         B     CODETAB(RCOMPC)          BRANCH TO FUNCTION       Y02027 19200006
*                                       BASED ON TABLE           Y02027 19220006
CODETAB  B     RETURN90                 ERROR                    Y02027 19240006
         B     NETWKCTL                 NETWORK CONTROL X'04'    Y02027 19260006
         B     MOVE                     MOVE IN MEMORY X'08'     Y02027 19280006
         B     TPOST                    POST RCB TO R.Q. X'0C'   Y02027 19300006
         B     GETREAD                  GET/READ        X'10'    Y02027 19320006
         B     PUTWRITE                 PUT/WRITE       X'14'    Y02027 19340006
         B     POINT                    RETRIEVE        X'18'    Y02027 19360006
         B     CKREQ                    CHECKPOINT      X'1C'    Y02027 19380006
         B     POSTECB                  OS POST ECB     X'20'    Y02027 19400006
         B     QRESET                   QRESET          X'24'    Y02027 19420006
         B     STARTIO                  ISSUE STARTIO   X'28'  @Z40X9DG 19426009
         B     SCHSRB                   SCHEDULE SRB    X'2C'  @Z40X9DG 19432009
         B     NCPIO                    NCP STARTIO     X'30'  @G36XRDV 19434000
         B     LISTPOST                 LIST POST TO R QX'34'  @G36XRDV 19436000
         EJECT                                                          19440006
***************************************************************  Y02027 19460006
*****    THIS ROUTINE PUTS AN ELEMENT ON THE ASYNCHRONOUS *****  Y02027 19480006
*****    READY QUEUE,AND THEN POSTS THE MCP-ECB COMPLETE. *****  Y02027 19500006
*****    REGISTER CONTENTS ON ENTRY MUST BE :             *****  Y02027 19520006
*****     RPARM = ADDRESS OF NEW ELEMENT(RECB).           *****  Y02027 19540006
*****     RTCB  = ADDRESS OF TCB.                         *****@Z40X9DG 19546009
*****     RSVRB = ADDRESS OF SVRB.                        *****@Z40X9DG 19552009
*****     RASCB = ASCB ADDRESS.                           *****  Y02027 19560006
*****     RTCX = TCX ADDRESS.                             *****  Y02027 19580006
*****     RETURN= RETURN ADDRESS.                         *****  Y02027 19600006
*****     REGISTER 15 IS ALTERED                          *****  Y02027 19620006
***************************************************************  Y02027 19640006
TPOSTSUB EQU   *                                                 Y02027 19660006
         L     RENTRY,TCXREADY          1ST ELEMENT ADDR         Y02027 19680006
POSTLOOP STCM  RENTRY,SEVEN,RECBLINK-IEDQRECB(RPARM) POINT NEW RCB02027 19700006
*                                       TO FIRST ELEMENT         Y02027 19720006
         CS    RENTRY,RPARM,TCXREADY    CURRENT ELEMENT UPDATED  Y02027 19740006
         BNE   POSTLOOP                 BRANCH IF YES            Y02027 19760006
*                                       YES, LINK NEW ELEMENT TO Y02027 19780006
*                                       NEW 1ST ELEMENT.         Y02027 19800006
*                                       NO, ASYCN READY QUEUE    Y02027 19820006
*                                       UPDATED WITH NEW ELEMENT Y02027 19840006
*                                       BY COMPARE & SWAP INST.  Y02027 19860006
         SPACE 2                                               @G36XRDV 19861000
***************************************************************@G36XRDV 19862000
*        THE 'POST' ENTRY OF THE TPOSTSUB ROUTINE IS USED BY   @G36XRDV 19863000
*        THE LIST POST ROUTINE TO POST THE MCP ECB COMPLETE.   @G36XRDV 19864000
*        IT IS CALLED AFTER THE LIST OF ELEMENTS IS POSTED     @G36XRDV 19865000
*        TO THE ASYCHRONOUS READY QUEUE.                       @G36XRDV 19866000
*        THE INPUT IS THE SAME AS THE TPOSTSUB ENTRY.          @G36XRDV 19867000
***************************************************************@G36XRDV 19868000
         SPACE 1                                               @G36XRDV 19869000
POST     DS    0H                                              @G36XRDV 19870000
         CLM   RASCB,ADD,TCXASCB+ONE    IS REQUESTOR A SUBTASK @Z40X9DG 19880009
*                                       OF TCAM                @Z40X9DG 19886009
         BNE   XMPOST                   NO, BRANCH             @Z40X9DG 19892009
         STM   RCOMPC,RETURN,EXTSA(RSVRB) SAVE REGS 10-14      @Z40X9DG 19898009
         L     RCECB,TCXAVT             GET AVT ADDRESS        @Z40X9DG 19904009
         LA    RCECB,AVTOSECB-IEDQAVTD(,RCECB) GET ADDRESS OF  @Z40X9DG 19910009
*                                       TCAM'S ECB             @Z40X9DG 19916009
         L     RENTRY,ZERO(,RCECB)      GET CONTENTS OF ECB    @Z40X9DG 19922009
         L     RTEMP,POSTBIT            POST BIT FOR CS        @Z40X9DG 19928009
         TM    ZERO(RCECB),WAITBIT      ECB WAITING            @Z40X9DG 19934009
         BO    POST1                    YES, BRANCH            @Z40X9DG 19940009
         CS    RENTRY,RTEMP,ZERO(RCECB) DO COMPARE AND SWAP TO @Z40X9DG 19946009
*                                       SET ECB AS POSTED      @Z40X9DG 19952009
         BZ    NOPOST                   BRANCH IF CS SUCCESSFUL@Z40X9DG 19958009
POST1    EQU   *                                               @Z40X9DG 19964009
         SLR   RCOMPC,RCOMPC            SET COMPLETION CODE    @Z40X9DG 19970009
         L     RENTRY,CVTPTR            GET CVT ADDRESS        @Z40X9DG 19976009
         L     RENTRY,CVT0PT01-CVT(,RENTRY) GET POST ENTRY ADDR@Z40X9DG 19982009
         BALR  RETURN,RENTRY            BRANCH TO POST WITH:   @Z40X9DG 19988009
*                                        R10=COMPLETION CODE   @Z40X9DG 19994009
*                                        R11=ECB ADDRESS       @Z40X9DG 20000009
*                                        R14=RETURN ADDRESS    @Z40X9DG 20006009
*                                        R15=ENTRY POINT ADDR  @Z40X9DG 20012009
*                                       REGS 0-9 ARE PRESERVED @Z40X9DG 20018009
NOPOST   EQU   *                                               @Z40X9DG 20024009
         LM    RCOMPC,RETURN,EXTSA(RSVRB) RESTORE REGS         @Z40X9DG 20030009
         BR    RETURN                   RETURN TO CALLER       @Z40X9DG 20036009
         EJECT                                                 @Z40X9DG 20042009
************************************************************** @Z40X9DG 20048009
*                                                            * @Z40X9DG 20054009
*        SCHEDULE AN SRB TO RUN IN TCAM'S MEMORY TO POST     * @Z40X9DG 20060009
*        THE TCAM ECB                                        * @Z40X9DG 20066009
*                                                            * @Z40X9DG 20072009
************************************************************** @Z40X9DG 20078009
XMPOST   EQU   *                                               @Z40X9DG 20084009
         ST    RETURN,EXTSA(,RSVRB)     SAVE REG 14 IN SVRB    @Z40X9DG 20090009
*                                       EXTENDED SAVE AREA     @Z40X9DG 20096009
         STM   RZERO,RCOMPC,EXTSA+FOUR(RSVRB) SAVE REGS 0-10   @Z40X9DG 20102009
LOCSRB   EQU   *                                               @Z40X9DG 20108009
         USING PSRBSECT,RPARM           PREFIX ADDRESSABILITY  @Z40X9DG 20114009
         LA    RPARM,TCXSRBS            POINT TO TCX AS DUMMY  @Z40X9DG 20120009
*                                       FIRST SRB PREFIX       @Z40X9DG 20126009
LOOPSRB  EQU   *                                               @Z40X9DG 20132009
         ICM   RPARM,ADD,PSRBLINK       GET SRB PREFIX PTR     @Z40X9DG 20138009
         BZ    CALLGET                  BRANCH IF NO MORE SRB'S@Z40X9DG 20144009
         TS    PSRBTSFL                 IS SRB AVAILABLE       @Z40X9DG 20150009
         BNZ   LOOPSRB                  NO, BRANCH             @Z40X9DG 20156009
         LA    RPARM,PSRBSRB            POINT TO SRB START     @Z40X9DG 20162009
         USING SRBSECT,RPARM            SRB ADDRESSABILITY     @Z40X9DG 20168009
         MVC   SRBASCB,TCXASCB          SET ASCB ADDRESS       @Z40X9DG 20174009
         MVC   SRBPASID,TCXASID         SET ASID               @Z40X9DG 20180009
         MVC   SRBPTCB,TCXTCB           SET TCB ADDRESS        @Z40X9DG 20186009
         L     RENTRY,TCXAVT            GET AVT ADDRESS        @Z40X9DG 20192009
         LA    RENTRY,AVTOSECB-IEDQAVTD(,RENTRY) GET TCAM ECB  @Z40X9DG 20198009
*                                       ADDRESS AND SET        @Z40X9DG 20204009
*                                       COMPLETION CODE (CC)   @Z40X9DG 20210009
*                                       OF 0 IN HIGH BYTE      @Z40X9DG 20216009
         ST    RENTRY,SRBPARM           SET ECB ADDR AND CC    @Z40X9DG 20222009
         SCHEDULE SRB=(1),SCOPE=LOCAL   SCHEDULE TO POST TCAM  @Z40X9DG 20228009
         L     RETURN,EXTSA(,RSVRB)     RESTORE RETURN ADDR    @Z40X9DG 20234009
         LM    RZERO,RCOMPC,EXTSA+FOUR(RSVRB) RESTORE REGS     @Z40X9DG 20240009
         BR    RETURN                   RETURN TO CALLER       @Z40X9DG 20246009
CALLGET  EQU   *                                               @Z40X9DG 20252009
         BAL   RDEB,SRBGETM             GO REQUEST THAT MORE   @Z40X9DG 20258009
*                                       SRB'S BE OBTAINED      @Z40X9DG 20264009
         B     LOCSRB                   TRY AGAIN FOR SRB      @Z40X9DG 20270009
         DROP  RPARM                                           @Z40X9DG 20276009
         EJECT                                                          20320006
***************************************************************  Y02027 20340006
*****    THIS ROUTINE EITHER LOCATES OR GETS CORE FOR A   *****  Y02027 20360006
*****   FREE AIB, MARKS IT BUSY, AND RETURNS ITS ADDRESS  *****  Y02027 20380006
*****   IN REGISTER 1.                                    *****  Y02027 20400006
*****   REGISTERS ON ENTRY MUST BE AS FOLLOWS:            *****  Y02027 20420006
*****      RASCB= ASCB ADDRESS.                           *****  Y02027 20440006
*****      RTCX = TCX  ADDRESS.                           *****  Y02027 20460006
*****      RETURN=RETURN ADDRESS.                         *****  Y02027 20480006
*****    REGS 0,1,13, AND 15 ARE ALTERED                         Y02027 20500006
***************************************************************  Y02027 20540006
         USING IEDQAIB,RPARM            SET UP AIB BASE REG.     Y02027 20560006
AIBSUBR  EQU   *                                                 Y02027 20580006
*                                                                Y02027 20600006
         LA    RPARM,TCXAIBC-(AIBCHAIN-IEDQAIB-1)  TCX AIB PTR   Y02027 20620006
AIBGET   ICM   RPARM,SEVEN,AIBCHAIN     ANY AIB'S AVAIL          Y02027 20650006
         BNZ   GOTAIBS                  BR IF YES                Y02027 20680006
         LH    RZERO,TCXSZAIB           GET SIZE OF AIB        @OZ17630 20687091
         CH    RZERO,FOURK              SIZE GREATER THAN 4K   @OZ17630 20694091
         BH    GETCORE                  YES, BRANCH            @OZ17630 20701091
         LA    RZERO,HPAGE              2K VALUE                 Y02027 20710006
         AR    RZERO,RZERO              DOUBLE FOR 4K PAGE SIZE  Y02027 20740006
GETCORE  EQU   *                                               @OZ17630 20750091
         LR    RTEMP,RETURN             SAVE RETURN REG          Y02027 20770006
*                    GETMAIN FOR AIB'S                           Y02027 20800006
         GETMAIN RU,LV=(0),SP=CSA,KEY=KEY6,BNDRY=PAGE,BRANCH=YES Y02027 20830006
         L     RCVT,CVTPTR              LOAD CVT PTR             Y02027 20860006
         LH    RETURN,TCXSZAIB          GET SIZE OF AIB          Y02027 20890006
         CH    RETURN,FOURK             SIZE GREATER THAN 4K   @OZ17630 20895091
         BNH   SMALLAIB                 NO, BRANCH             @OZ17630 20900091
         LR    RENTRY,RPARM             GET ADDR OF ONLY AIB   @OZ17630 20905091
         B     CLRBYTE                  BRANCH TO CLEAR BYTE   @OZ17630 20910091
SMALLAIB EQU   *                                               @OZ17630 20915091
         LA    RENTRY,HPAGE             2K VALUE                 Y02027 20920006
         LA    RENTRY,HPAGE(RENTRY,RPARM) GET ADDR OF END OF AIBSY02027 20950006
         SR    RENTRY,RETURN            ADDR LAST POSS AIB       Y02027 20980006
CLRBYTE  EQU   *                                               @OZ17630 20990091
         LA    RZERO,0(RPARM)           CLEAR HI ORDER BYTE      Y02027 21010006
         B     BXLE                     BR TO INIT               Y02027 21040006
CHAINAIB ST    RZERO,AIBCHAIN-ONE       STORE PTR TO AIB         Y02027 21070006
*                                         AND MARK FREE          Y02027 21100006
         LR    RPARM,RZERO              SAVE CURRENT PTR         Y02027 21130006
BXLE     BXLE  RZERO,RETURN,CHAINAIB    LOOP THRU NEW CORE TILL  Y02027 21160006
*                                         ALL AIB'S ARE LINKED   Y02027 21190006
         LR    RENTRY,RPARM             LAST AIB PTR             Y02027 21220006
         N     RPARM,CLRLOW             ORIG START OF NEW CORE   Y02027 21250006
AIBLOOP  L     RZERO,TCXAIBC            GET CURRENT AIB PTR      Y02027 21280006
         ST    RZERO,AIBCHAIN-ONE-IEDQAIB(RENTRY)  LINK AIB BLKS Y02027 21310006
         CS    RZERO,RPARM,TCXAIBC      CHAIN NEW BLK OFF TCX    Y02027 21340006
         BNZ   AIBLOOP                  BR IF CS FAILED          Y02027 21370006
         LR    RETURN,RTEMP             RESTORE RETURN ADDR      Y02027 21400006
GOTAIBS  EQU   *                                                 Y02027 21430006
         TS    AIBSTATE                 ALLOCATE AND MARK AIB    Y02027 21460006
         BNZ   AIBGET              AIB IN USE, BR TO RETRY       Y02027 21490006
         BR    RETURN                   RETURN TO CALLING ROUTINEY02027 21640006
         DROP  RPARM                                             Y02027 21660006
         TITLE '''MOVE IN MEMORY FUNCTION'''                            21680006
*                                                                Y02027 21700006
*                        MOVE IN MEMORY FUNCTION                 Y02027 21720006
*                                                                Y02027 21740006
*                                                                     * 21760006
*              RPARM POINTS TO A THREE WORD PARAMETER LIST:           * 21780006
*                  1. ADDRESS OF DATA TO BE MOVED.                    * 21800006
*                  2. ADDRESS OF TARGET FIELD OF THE MOVE.            * 21820006
*                  3. ADDR OF FIELD CONTAINING LENGTH OF DATA FIELD.  * 21840006
*                                                                     * 21860006
MOVE     EQU   *                                                 Y02027 21880006
         L     RCECB,EIGHT(RPARM)       ADDRESS OF BYTE COUNT    Y02027 21900006
         LH    RCECB,ZERO(RCECB)        GET BYTE COUNT           Y02027 21920006
         LR    RTEMP,RCECB              PUT COUNT IN ODD REGISTERY02027 21940006
         L     RCOMPC,FOUR(RPARM)       ADDRESS OF TARGET OF MOVEY02027 21960006
         L     RWORK,ZERO(RPARM)        ADDRESS OF FIELD TO MOVE Y02027 21980006
         MVCL  RCOMPC,RWORK             MOVE DATA IN MEMORY      Y02027 22000006
         B     EXIT                     RETURN                   Y02027 22020006
         TITLE '''POST TO ASYNC READY QUEUE'''                          22040006
*                                                                Y02027 22060006
*                        POST RCB TO ASYCHRONOUS READY QUEUE     Y02027 22080006
*                        AND POST MCP-ECB COMPLETE               Y02027 22100006
*                                                                Y02027 22120006
*              RPARM POINTS TO EITHER A ONE OR TWO WORD PARM LISTY02027 22140006
*                  THE FIRST WORD CONTAINS THE ADDR OF THE RCB   Y02027 22160006
*                                                                Y02027 22180006
TPOST    EQU   *                                                 Y02027 22200006
         ICM   RPARM,SEVEN,ONE(RPARM)   GET ADDRESS OF RCB       Y02027 22220006
         BAL   RETURN,TPOSTSUB          BRANCH TO SUBROUTINE     Y02027 22240006
         B     EXIT                     RETURN TO CALLER         Y02027 22260006
         TITLE 'LIST POST ROUTINE'                             @G36XRDV 22260700
***************************************************************@G36XRDV 22261400
*                                                              @G36XRDV 22262100
*        LIST POST ROUTINE                                     @G36XRDV 22262800
*                                                              @G36XRDV 22263500
*        THIS ROUTINE POSTS A LIST OF ELEMENTS (RCB'S) TO      @G36XRDV 22264200
*        THE ASYCHRONOUS READY QUEUE AND POSTS THE MCP         @G36XRDV 22264900
*        COMPLETE.                                             @G36XRDV 22265600
*                                                              @G36XRDV 22266300
***************************************************************@G36XRDV 22267000
         SPACE 2                                               @G36XRDV 22267700
LISTPOST DS    0H                                              @G36XRDV 22268400
         SLR   RLAST,RLAST                                     @G36XRDV 22269100
         ICM   RLAST,SEVEN,FIVE(RPARM) ADDR OF LAST ELMT       @G36XRDV 22269800
         ICM   RFIRST,SEVEN,ONE(RPARM) ADDR OF FIRST ELMT      @G36XRDV 22270500
         L     RENTRY,TCXREADY    ASYCH READY Q ANCHOR         @G36XRDV 22271200
LISTLOOP DS    0H                                              @G36XRDV 22271900
         STCM  RENTRY,SEVEN,RECBLINK-IEDQRECB(RLAST) SET LAST  @G36XRDV 22272600
*                                 ELMT IN LIST TO POINT TO     @G36XRDV 22273300
*                                 FIRST ELMT ON QUEUE          @G36XRDV 22274000
         CS    RENTRY,RFIRST,TCXREADY SET ANCHOR TO POINT TO   @G36XRDV 22274700
*                                 FIRST ELMT IN LIST           @G36XRDV 22275400
         BNE   LISTLOOP           TRY AGAIN IF QUEUE UPDATED   @G36XRDV 22276100
*                                 BY ANOTHER TASK              @G36XRDV 22276800
         BAL   RETURN,POST        GO POST MCP TASK             @G36XRDV 22277500
         B     EXIT               RETURN TO CALLER             @G36XRDV 22278200
         TITLE '''GET/READ FUNCTION'''                                  22280006
*                                                                Y02027 22300006
*                        GET-READ FUNCTION                       Y02027 22320006
*                                                                Y02027 22340006
*              REGISTER EQUATES FOR GETREAD FUNCTION             Y02027 22360006
*                                                                Y02027 22380006
RDCB     EQU   10                       ADDRESS OF DCB           Y02027 22400006
RPEWA    EQU   11                       ADDRESS OF PEWA          Y02027 22420006
RPECB    EQU   12                       ADDRESS OF PECB          Y02027 22440006
*                                                                Y02027 22460006
*              ADDRESSABILITY                                    Y02027 22480006
*                                                                Y02027 22500006
         USING IEDQPECB,RPECB           ADDRESSABILITY OF PECB   Y02027 22520006
         USING IHADCB,RDCB              DCB ADDRESSABILITY       Y02027 22540006
         USING IEDQDEB,RDEB             DEB ADDRESSIBILITY       Y02027 22560006
         USING IEDQPEWA,RPEWA           ADDRESSABILITY OF PEWA   Y02027 22580006
GETREAD  EQU   *                        ENTERED VIA BRANCHING ON Y02027 22600006
*                                       INDEX GOTTEN FROM CODE   Y02027 22620006
         L     RPECB,ZERO(RPARM)        GET ECB ADDR           @OZ07830 22640091
         XC    PECBECB(FOUR),PECBECB    CLEAR ECB                Y02027 22680006
         L     RDCB,REG11(RSVRB)        GET REG 11 FROM SVRB     Y02027 22700006
*                                       DCB FROM IGG019RG        Y02027 22720006
         L     RDEB,DCBDEBAD            GET DEB ADDR             Y02027 22740006
         L     RPEWA,DEBPEWA-ONE        GET PEWA ADDRESS         Y02027 22760006
         CLI   PEWARTVE+TWO,BLANK       RETRIEVE TERMINATION     Y02027 22780006
         BE    GETAIB                   BRANCH IF YES,AVOID TESTSY02027 22800006
*                                                                Y02027 22820006
*              CHECK FOR EODAD EXIT                              Y02027 22840006
*                                                                Y02027 22860006
         TM    PEWAOPTC,EODADFLG        TIME TO TAKE EODAD EXIT  Y02027 22880006
         BZ    GETAIB                   BRANCH IF NO             Y02027 22900006
         TM    PEWAGSW+1,EOM            EOM PROCESSED LAST TIME  Y02027 22920006
         BNO   GETAIB                   BRANCH NO TO DELAY EODAD Y02027 22940006
         TM    PEWAOPTC,PARTBUF         EOM BUFFER PROCESSED     Y02027 22960006
         BO    GETAIB                   BRANCH IF NO             Y02027 22980006
         NI    PEWAOPTC,XFF-EODADFLG    TURN OFF EODAD FLAG      Y02027 23000006
         LA    RENTRY,FOUR              EODAD RETURN CODE        Y02027 23020006
         B     EXIT                     RETURN TO RG             Y02027 23040006
         EJECT                                                          23060006
GETAIB   BAL   RETURN,AIBSUBR           GET AIB                  Y02027 23080006
*                                                                Y02027 23100006
         USING IEDQAIB,RPARM            ADDRESSABILITY OF AIB    Y02027 23120006
*                                       RETURNED FROM SUBRT IN R1Y02027 23140006
         ST    RPECB,AIBECBA            STORE ECB IN PECB TO BE  Y02027 23160006
*                                       WAITED ON IN AIB         Y02027 23180006
         LA    RDEB,AIBWAG              ADDR OF WORKAREA IN AIB  Y02027 23200006
         ST    RDEB,AIBWAPTR            STORE IN AIB             Y02027 23220006
*              ENSURE USER'S WORKAREA IS NOT GREATER THAN AIB'S  Y02027 23260006
         L     RDEB,REG2(RSVRB)         GET REGISTER 2           Y02027 23280006
         STH   RDEB,PEWASOWA            STORE SIZE IN PEWA       Y02027 23300006
         LA    RDEB,AIBWAG-IEDQAIB(RDEB)  ADD SIZE OF PREFIX     Y02027 23320006
         LA    RENTRY,SOWAERR           SET RETURN CODE          Y02027 23340006
         CH    RDEB,TCXSZAIB            SIZE GREATER THAN AIB    Y02027 23360006
         BH    FREEAIB                  BRANCH IF USER SPECIFIED Y02027 23380006
*                                       SIZE IS LARGER THAN AIB  Y02027 23400006
*                                       TO  RETURN TO USER       Y02027 23420006
*                                                                Y02027 23440006
*                   INITIALIZE AIB                               Y02027 23460006
*                                                                Y02027 23480006
         ST    RPEWA,AIBGPEWA           STORE PEWA ADDRESS IN AIBY02027 23500006
         ICM   RTEMP,EIGHT,DCBRECFM     STORE DCB INFORMATION    Y02027 23520006
         ICM   RTEMP,FOUR,DCBMACRF      NEEDED BY                Y02027 23540006
         ICM   RTEMP,THREE,DCBBUFL      IEDQEW                   Y02027 23560006
         ST    RTEMP,AIBRECFG           OF THE MCP               Y02027 23580006
         ICM   RTEMP,TWELVE,DCBBLKSI    IN THE                   Y02027 23600006
         ICM   RTEMP,THREE,DCBLRECL     AIB FUNCTION             Y02027 23620006
         ST    RTEMP,AIBBLKSI           EXTENSION                Y02027 23640006
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 23660006
         TM    DCBMACRF,QSAMFLG         CHECK IF QSAM            Y02027 23680006
         BO    BYPASS                   BRANCH IF QSAM           Y02027 23700006
         L     RDEB,REG9(RSVRB)         IF BSAM, GET DECB ADDRESSY02027 23720006
         ST    RDEB,AIBDECBG            AND STORE ADDRESS AND    Y02027 23740006
         L     RDEB,DECSDECB-IECTDECB(RDEB)  DECSDECB            Y02027 23760006
         ST    RDEB,AIBDECS             IN AIB                   Y02027 23780006
         ICM   RTEMP,THREE,DECLNGTH-IECTDECB(RDEB) GET DECLNGTH  Y02027 23800006
BYPASS   ICM   RTEMP,EIGHT,DCBOPTCD     GET DCBOPTCD             Y02027 23820006
*                                       CHECK FOR CHECKPOINT     Y02027 23840006
         ICM   RDEB,SEVEN,DCBEXLST+ONE  GET EXIT LIST ADDRESS    Y02027 23860006
         BZ    OUT                      BRANCH IF NOT SPECIFIED  Y02027 23880006
CLOOP    EQU   *                        START OF LOOP            Y02027 23900006
         TM    ZERO(RDEB),CKPTFLG       CKECK FOR CHECKPOINT   @ZA03744 23920009
         BO    SETCKPT                  YES, BRANCH            @ZA03744 23930009
         TM    ZERO(RDEB),EIGHTY        END OF EXIT LIST       @ZA03744 23940009
         BO    OUT                      YES, BR TO CONT        @ZA03744 23950009
         LA    RDEB,FOUR(RDEB)          BUMP TO NEXT ENTRY     @ZA03744 23960009
         B     CLOOP                    CONT SCAN              @ZA03744 23970009
SETCKPT  EQU   *                                               @ZA03744 23980009
         ICM   RTEMP,FOUR,ZERO(RDEB)    GET ENTRY INDICATOR    @ZA03744 23990009
OUT      EQU   *                        STORE DCBOPTCD,EXIT LIST Y02027 24020006
         ST    RTEMP,AIBOPTCG           FLAG,AND DECLNGTH IN AIB Y02027 24040006
         MVC   AIBPCBAD(4),PEPCBAD      STORE PCB ADDR IN AIB    Y02027 24060006
*                                                                Y02027 24080006
*                   SET UP RCB                                   Y02027 24100006
*                                                                Y02027 24120006
         MVI   AIBPRI,GETPRI            SET PRIORITY OF POST     Y02027 24140006
         LA    RPEB,PEWAQCB             GET DUMMY QCB ADDR     @OZ27843 24168082
         STCM  RPEB,SEVEN,AIBQCBA       PUT QCB ADDR IN RCB    @OZ27843 24170082
         LR    RPEB,RPARM               SAVE AIB ADDRESS         Y02027 24180006
         LA    RPARM,AIBKEY             SET REG1 = RCB ADDRESS   Y02027 24200006
         BAL   RETURN,TPOSTSUB          TPOST RCB TO ASYC READY QY02027 24220006
*                                                                Y02027 24240006
*                             WAIT ON ECB IN PECB                Y02027 24260006
*                                                                Y02027 24280006
         LA    RETURN,GRRETURN          GET RETURN ADDR FROM WAITY02027 24300006
         STCM  RETURN,SEVEN,RBOPSW+FIVE(RSVRB) AND STORE IN      Y02027 24320006
*                                       RIGHT HALF OF PSW IN SVRBY02027 24340006
         STM   RZERO,RENTRY,TCBGRS-IEDQTCB(RTCB) SAVE REGISTERS  Y02027 24360006
*                                       IN TCB                   Y02027 24380006
         LA    RZERO,ONE                WAIT COUNT               Y02027 24400006
         LA    RPARM,PECBECB            ADDRESS OF ECB           Y02027 24420006
         L     RCVT,CVTPTR              GET CVT ADDRESS          Y02027 24440006
         L     RENTRY,CVTVWAIT-CVTMAP(RCVT)  GET BRANCH ENTRY TO Y02027 24460006
*                                       WAIT                     Y02027 24480006
         BALR  RETURN,RENTRY            BRANCH TO WAIT           Y02027 24500006
         EJECT                                                          24520006
*                                                                Y02027 24540006
*              MCP HAS POSTED A. P. ECB COMPLETE                 Y02027 24560006
*                                                                Y02027 24580006
GRRETURN EQU   *                                                 Y02027 24600006
         LR    RPARM,RPEB               GET AIB ADDRESS          Y02027 24620006
         L     RPECB,AIBECBA            ADDR OF PECB AND ECB     Y02027 24640006
         MVI   PECBFLAG,ZERO            INITIALIZE TO ZERO       Y02027 24660006
         L     RPEWA,AIBGPEWA           GET PEWA ADDRESS         Y02027 24680006
*                                                                Y02027 24700006
*              CHECK FOR CLOSEDOWN EODAD                         Y02027 24720006
*                                                                Y02027 24740006
         LA    RENTRY,FOUR              SET RETURN CODE = 4      Y02027 24760006
         CLI   PECBECB+THREE,FOUR       CHECK FOR EODAD RETURN   Y02027 24780006
         BE    FREEAIB                  BRANCH IF YES TO AVOID   Y02027 24800006
*                                       DATA MOVE                Y02027 24820006
*                                                                Y02027 24840006
*              CHECK FOR ERRORS                                  Y02027 24860006
*                                                                Y02027 24880006
         LA    RENTRY,STOPQRC           DISABLED ENTRY CODE      Y02027 24885006
         CLI   PECBECB+THREE,STOPQRC    CK FOR DISABLED ENTRY    Y02027 24890006
         BE    FREEAIB                  BR YES TO RETURN         Y02027 24895006
         L     RDEB,AIBDECBG            GET ADDRESS OF DECB      Y02027 24900006
         CLI   PEWASAVE,RETERR          RETRIEVE ERROR SET       Y02027 24920006
         BNE   CKTYPE                   BRANCH IF NO             Y02027 24940006
         MVI   PEWASAVE,ZERO            CLEAR INDICATOR          Y02027 24960006
         LA    RENTRY,RETERR            SET RETURN CODE          Y02027 24980006
         TM    AIBMACRF,QSAMFLG         QSAMDCB                  Y02027 25000006
         BO    FREEAIB                  BRANCH IF YES            Y02027 25020006
         MVI   DECSDECB-IECTDECB(RDEB),RETCC MOVE IN COND. CODE  Y02027 25040006
         B     FREEAIB                  EXIT                      02027 25060006
CKTYPE   EQU   *                                                 Y02027 25080006
         LA    RENTRY,SOWAERR           SET RETURN CODE          Y02027 25100006
         CLI   PECBECB+THREE,SOWACC     CHECK COMPLETION CODE FORY02027 25120006
*                                       SOWA ERROR               Y02027 25140006
         BE    FREEAIB                  RETURN                   Y02027 25160006
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 25180006
         TM    AIBMACRF,QSAMFLG         QSAM DCB                 Y02027 25200006
         BO    CKSYNAD                  BRANCH IF YES            Y02027 25220006
         CLI   AIBDECS,WAFULL           X'40' SET IN DECS        Y02027 25240006
         BE    CKSYNAD                  BRANCH IF YES            Y02027 25260006
         L     RWORK,DECSDECB-IECTDECB(,RDEB)   GET CURRENT    @OZ08368 25260691
*                                        DECB CONTENTS         @OZ08368 25261291
         CLI   DECSDECB-IECTDECB(RDEB),MSGRAQCB  HAS DECB BEEN   Y02027 25262006
*                                       POSTED AS MSG ON RA QUEUEY02027 25264006
*                                       SINCE AIBDECS WAS SET AS Y02027 25266006
*                                       NO MSG ON DEST QCB OR    Y02027 25268006
*                                       RA QUEUE.                Y02027 25270006
         BE    FREEAIB                  BR IF YES TO PREVENT     Y02027 25272006
*                                       OVERLAY OF DECB          Y02027 25274006
         L     RTEMP,AIBDECS            GET AIBDECS CONTENTS   @OZ08368 25280091
         CS    RWORK,RTEMP,DECSDECB-IECTDECB(RDEB)  PUT IN     @OZ08368 25284091
*                                       DECB UNLESS IT HAS     @OZ08368 25288091
*                                       CHANGED SINCE CLI      @OZ08368 25292091
*                                       FOR X'40'              @OZ08368 25296091
         B     FREEAIB                  IN DECB AND RETURN       Y02027 25300006
CKSYNAD  EQU   *                                                 Y02027 25320006
         TM    PEWAOPTC,SYNADFLG        SYNAD TO BE TAKEN        Y02027 25340006
         BNO   CKCKPT                   BRANCH IF NO             Y02027 25360006
         LA    RENTRY,SYNADERR          RETURN CODE              Y02027 25380006
         NI    PEWAOPTC,XFF-SYNADFLG    TURN OFF FLAG            Y02027 25400006
         OI    PEWAOPT2,OVERFLOW        INDICATE OVERFLOW FOR    Y02027 25420006
*                                       CLOSE                    Y02027 25440006
         B     NOCKPT                   SKIP CHECKPOINT          Y02027 25460006
CKCKPT   EQU   *                                                 Y02027 25480006
         CLI   AIBEXLFG,ZERO            CHECKPT EXIT TO BE TAKEN Y02027 25500006
         BE    NOCKPT                   BRANCH IF NO             Y02027 25520006
         MVI   PECBFLAG,CKPTFLG         SET EXIT TO BE TAKEN     Y02027 25540006
NOCKPT   EQU   *                                                 Y02027 25560006
         TM    AIBRECFG,UNDFLG          UNDEFINED LENGTH         Y02027 25580006
         BNO   MOVEDATA                 BRANCH IF NOT            Y02027 25600006
         MVC   DCBLRECL(2),PEWALREC     PUT LENGTH IN DCB        Y02027 25620006
*                                                                Y02027 25640006
*              MOVE DATA FROM AIB WORKAREA TO USERS WORKAREA     Y02027 25660006
*                                                                Y02027 25680006
MOVEDATA EQU   *                                                 Y02027 25700006
         CLI   AIBKEY,DATE              USER NEED DATE/TIME      Y02027 25702006
         BNE   NOTPDATE                 NO, BRANCH               Y02027 25704006
         ICM   RTEMP,SEVEN,PEWADTSA     GET USER DTS AREA        Y02027 25706006
         MVC   ONE(SEVEN,RTEMP),AIBKEY+ONE MOVE TIME/DATE        Y02027 25708006
         MVC   EIGHT(EIGHT,RTEMP),PEWAELEM+EIGHT MOVE SOURCE     Y02027 25710006
NOTPDATE EQU   *                                                 Y02027 25714006
         L     RDCB,REG3(RSVRB)         GET USERS SAVE AREA ADDR Y02027 25720006
         LH    RTEMP,PEWALREC           GET SIZE OF MOVE         Y02027 25740006
         L     RPECB,AIBWAPTR           ADDRESS OF MOVE FROM     Y02027 25760006
         LR    RPEWA,RTEMP              GET LENGTH               Y02027 25780006
         MVCL  RDCB,RPECB               MOVE FROM AIB WORKAREA   Y02027 25800006
*                                       TO USER WORKAREA         Y02027 25820006
         TM    AIBMACRF,QSAMFLG         QSAM DCB                 Y02027 25840006
         BO    FREEAIB                  BRANCH IF YES            Y02027 25860006
         MVI   DECSDECB-IECTDECB(RDEB),NORMAL SET GOOD COMPL CODEY02027 25880006
FREEAIB EQU    *                                                 Y02027 25900006
         MVI   AIBSTATE,AIBFREE         FREE AIB                 Y02027 25920006
         B     EXIT                     GOOD RETURN              Y02027 25940006
         DROP  RPECB                                             Y02027 25960006
         DROP  RDCB                                              Y02027 25980006
         DROP  RDEB                                              Y02027 26000006
         DROP  RPEWA                                             Y02027 26020006
         DROP  RPARM                    MAKE REG 1 AVAILABLE     Y02027 26040006
         TITLE '''NETWORK CONTROL - OPCTL'''                            26060006
NETWKCTL EQU   *                                                 Y02027 26080006
RAIB     EQU   3                        AIB BASE                 Y02027 26100006
         SPACE 1                                                        26120006
         USING APCIBMAP,RPEB            APCIB ADDRESSABILITY     Y02027 26140006
         USING IEDQAIB,RAIB             AIB ADDRESSABILITY       Y02027 26160006
         USING IEDQDEB,RDEB             DEB ADDRESSABILITY       Y02027 26180006
         SPACE 1                                                        26200006
         LA    RENTRY,EIGHTY            SET POSS ERR RET CODE    Y02027 26205006
         TM    TCXBIT1,AVTCLOSN         MCP CLOSE IN PROGRESS    Y02027 26210006
         BNO   TCAMOK                   NO - BRANCH              Y02027 26215006
         L     RTEMP,REG0(RSVRB)        GET FUNCTION CODE REG    Y02027 26215506
         LA    RWORK,SIX                MCPCLOSE CODE            Y02027 26216006
         CR    RTEMP,RWORK              ANOTHER CLOSE REQUEST    Y02027 26216506
         BNE   EXIT                     NO - EXIT WITH ERR RC    Y02027 26217006
         SR    RENTRY,RENTRY            ZERO REG FOR RET CODE    Y02027 26217506
         B     EXIT                     RETURN TO CALLER - CLOSE Y02027 26218006
*                                       ALREADY IN PROGRESS      Y02027 26218506
         SPACE 1                                                        26219006
TCAMOK   EQU   *                                                 Y02027 26219506
         L     RPEB,ZERO(,RPARM)        GET POINTER TO INPUT     Y02027 26220006
         LA    RPEB,ZERO(,RPEB)         CLEAR HIGH ORDER BYTE    Y02027 26240006
         TM    APPCOMCD,CHKPASWD        NEED TO CHECK PASSWORD   Y02027 26260006
         BZ    OPCTLAIB                 BRANCH IF NO             Y02027 26280006
         BAL   RETURN,PASSCHK           GO CHECK PASSWORD        Y02027 26300006
         TM    APPCOMCD,NOTTCHNG        TCHNG FUNCTION           Y02027 26320006
         BZ    OPCTLAIB                 BR, YES - DON'T DESTROY  Y02027 26340006
*                                       COMMAND CODE             Y02027 26360006
         NI    APPCOMCD,XFF-CHKPASWD    TURN OFF PASSWORD FLAG   Y02027 26380006
         SPACE 1                                                 Y02027 26400006
OPCTLAIB EQU   *                                                 Y02027 26420006
         BAL   RETURN,AIBSUBR           GO GET AN AIB            Y02027 26440006
         LR    RAIB,RPARM               SET UP AIB BASE          Y02027 26460006
         SPACE 1                                                        26480006
**************************************************************** Y02027 26500006
*                        INITIALIZE AIB                         *Y02027 26520006
**************************************************************** Y02027 26540006
         XC    CLROFF(CLRLEN,RAIB),CLROFF(RAIB)   CLEAR AREA IN  Y02027 26560006
*                                       AIB FOR FUNCTION INPUT   Y02027 26580006
         L     RTEMP,TCXAVT             GET AVT POINTER          Y02027 26600006
         LA    RTEMP,AVTOPCOB-IEDQAVTD(RTEMP)   GET OP CONTROL   Y02027 26620006
*                                       QCB ADDRESS              Y02027 26640006
         STCM  RTEMP,SEVEN,AIBQCBA      SET QCB ADDRESS          Y02028 26660006
         MVI   AIBKEY,AIBAPKEY          SET FLAG = MPP REQUESTOR Y02027 26680006
         MVI   AIBPRI,PRIOPCTL          SET POST PRIORITY        Y02027 26700006
         MVC   AIBCOMCD(ONE),APPCOMCD   MOVE COMMAND CODE TO AIB Y02027 26720006
         SPACE 1                                                 Y02027 26740006
         LA    RTEMP,APECB              GET ECB ADDRESS AND      Y02027 26760006
         ST    RTEMP,AIBECBA            STORE IN AIB             Y02027 26780006
         MVC   AIBWAPTR+ONE(3),APUSWKA  MOVE USER WORK AREA PTR  Y02027 26800006
         SPACE 2                                                        26820006
**************************************************************** Y02027 26840006
* ASSURE THAT USER'S MPP MEETS ONE OF THE FOLLOWING CONDITIONS * Y02027 26860006
*                                                              * Y02027 26880006
*              1 - OPENS A TCAM DCB                            * Y02027 26900006
*              2 - IS A DAUGHTER OF AN APPL PROG THAT OPENS    * Y02027 26920006
*                  A TCAM DCB                                  * Y02027 26940006
*              3 - IS A DAUGHTER OF THE TCAM MCP               * Y02027 26960006
**************************************************************** Y02027 26980006
         USING IEDQTCB,RTCB             TCB ADDRESSABILITY       Y02027 27000006
         SR    RENTRY,RENTRY            CLEAR                    Y02027 27020006
         SR    RDEB,RDEB                REGISTERS                Y02027 27040006
         ICM   RDEB,ADD,TCBDEB+ONE      ADDRESS OF FIRST DEB     Y02027 27060006
         BZ    CHKMOTHR                 BRANCH IF NO DCB'S OPEN  Y02027 27080006
*                                       IN MPP TASK              Y02027 27100006
LOOP     EQU   *                                                 Y02027 27120006
         TM    DEBTAMID,ID              TCAM DEB                 Y02027 27140006
         BO    TCAMAPP                  BRANCH IF YES            Y02027 27160006
         ICM   RDEB,ADD,DEBDEBAD        GET PTR TO NEXT DEB      Y02027 27180006
         BNZ   LOOP                     CHECK NEXT DEB           Y02027 27200006
         SPACE 1                                                        27220006
CHKMOTHR EQU   *                                                 Y02027 27240006
         LTR   RENTRY,RENTRY            FIRST TIME THROUGH       Y02027 27260006
         BNZ   NODCB                    NO BRANCH                Y02027 27280006
         LA    RENTRY,ONE               SET 2ND PASS SWITCH      Y02027 27300006
         LA    RWORK,TCBOTC             GET PTR TO ADDRESS OF    Y02027 27320006
*                                       MOTHER'S TCB             Y02027 27340006
         NC    ZERO(FOUR,RWORK),ZERO(RWORK)  IS THERE AN ATTACHR Y02027 27360006
         BZ    NODCB                    BRANCH IF NO             Y02027 27380006
         CLC   ZERO(FOUR,RWORK),TCXTCB  ATTACHER = TCAM MCP      Y02027 27400006
         BE    MPPOK                    BRANCH IF YES            Y02027 27420006
         L     RWORK,ZERO(RWORK)        GET MOTHER'S TCB       @OZ17641 27430091
         ICM   RDEB,ADD,TCBDEB+ONE-IEDQTCB(RWORK) GET MOTHER'S   Y02027 27440006
*                                       DEBCHAIN                 Y02027 27460006
         BNZ   LOOP                     GO CHECK MOTHER'S DEBS   Y02027 27480006
         SPACE 1                                                        27500006
NODCB    EQU   *                                                 Y02027 27520006
         LA    RENTRY,NOPENDCB          SET ERROR RETURN CODE    Y02027 27540006
         TM    AIBCOMCD,XF0             FUNCTION OTHER THAN      Y02027 27544006
*                                       TPDATE OR MCOUNT         Y02027 27548006
         BNZ   FREEAIB2                 YES, BRANCH              Y02027 27552006
         LA    RENTRY,EIGHTY            SET RETURN CODE          Y02027 27556006
         B     FREEAIB2                 FREE AIB AND EXIT        Y02027 27560006
MPPOK    EQU   *                                                 Y02027 27580006
         ST    RASCB,AIBPCBAD           SET ASCB ADDR FOR XMPOST Y02027 27600006
*                                       FROM OPERATOR CONTROL    Y02027 27620006
         OI    AIBPCBAD,USEASCB         INDICATOR FOR OP CONTROL Y02027 27640006
         B     CHECKCD                  GO CHECK FUNCTION REQ    Y02027 27660006
TCAMAPP  EQU   *                                                 Y02027 27680006
         MVC   AIBPCBAD+ONE(THREE),DEBPCBAD  SET PCB ADDR IN AIB Y02027 27700006
         DROP  RTCB                     FREE REGISTER            Y02027 27720006
         DROP  RDEB                     FREE REGISTER            Y02027 27740006
         SPACE 1                                                        27760006
CHECKCD  EQU   *                                                 Y02027 27780006
         L     RTEMP,REG0(RSVRB)        SET FUNCTION INDEX REG   Y02027 27800006
*                                       FROM CALLER'S REG 0      Y02027 27820006
         SLL   RTEMP,TWO                MULTIPLY ENTRY CODE BY 4 Y02027 27840006
         B     TABLE(RTEMP)             BRANCH TO FUNCTION RTN   Y02027 27860006
TABLE    EQU   *                                                 Y02027 27880006
         B     TCHNCOPY                 BR IF TCOPY OR TCHNG     Y02027 27900006
         B     QCOPY                    BR IF QCOPY              Y02027 27920006
         B     ICHNCOPY                 BR IF ICHNG OR ICOPY     Y02027 27940006
         B     TPDATE                   BR IF TPDATE             Y02027 27960006
         B     MCOUNT                   BR IF MCOUNT             Y02027 27980006
         B     MRELEASE                 BR IF MRELEASE           Y02027 28000006
         B     MCPCLOSE                 BR IF MCPCLOSE           Y02027 28020006
         SPACE 1                                                        28040006
*************************************************************** Y02027  28060006
*      THIS CODE PROCESSES THE TCOPY AND TCHNG FUNCTIONS       * Y02027 28080006
*************************************************************** Y02027  28100006
         SPACE 1                                                        28120006
TCHNCOPY EQU   *                                                 Y02027 28140006
         L     RTEMP,APNAME             GET PTR TO TERM NAME     Y02027 28160006
         MVC   AIBNAME(EIGHT),ZERO(RTEMP)    MOVE TERM NA TO AIB Y02027 28180006
         TM    AIBCOMCD,AIBTCOPY        TCOPY FUNCTION           Y02027 28200006
         BO    GOTCOPY                  BRANCH IF YES            Y02027 28220006
         OI    AIBFLAG1,AIBGETSZ        SET SIZE REQUEST FLAG    Y02027 28240006
*                                       FOR TCHNG                Y02027 28260006
         L     RCOMPC,AIBWAPTR          GET WORK AREA PTR        Y02027 28280006
         TM    TRMSTATE-IEDQTRM(RCOMPC),TRMLIST  DIST OR CAS LISTY02027 28300006
         BNO   GOTCOPY                  NO, BRANCH               Y02027 28320006
         NI    AIBFLAG1,XFF-AIBGETSZ    TURN OFF SIZING FLAG     Y02027 28340006
         SPACE 1                                                        28360006
         LA    RWORK,TLISTEN-IEDQTRM    MINIMUM LIST ENTRY       Y02027 28380006
         LH    RTEMP,TLISTCNT-IEDQTRM(RCOMPC) # OF 2 BYTE ENT'S  Y02027 28400006
*                                       IN UPDATED LIST          Y02027 28420006
         SLL   RTEMP,ONE                TIMES SIZE OF 1 ENTRY    Y02027 28440006
         AR    RTEMP,RWORK              TOTAL LENGTH             Y02027 28460006
         STH   RTEMP,AIBCOUNT           SAVE COUNT               Y02027 28480006
         BAL   RETURN,TOAIB             GO MOVE UPDATED LIST     Y02027 28500006
         SPACE 1                                                        28520006
GOTCOPY  EQU   *                                                 Y02027 28540006
*                                                              * Y02027 28560006
* GO TO SUBROUTINE TO PUT AIB ON DISABLED READY Q.  UPON RETURN *Y02027 28580006
* PREPARE FOR BRANCH ENTRY TO WAIT                              *Y02027 28600006
*                                                              * Y02027 28620006
         SPACE 1                                                 Y02027 28640006
         OI    AIBFLAG1,AIBTNT          TURN ON 'TERMNAME LOOK   Y02027 28660006
*                                       UP' FLAG                 Y02027 28680006
         LA    RPARM,AIBKEY             SET UP RCB ADDRESS       Y02027 28700006
         BAL   RETURN,TPOSTSUB          PUT AIB ON DISABLED RDY QY02027 28720006
         BAL   RETURN,BRWAIT            GO TO OS WAIT ROUTINE    Y02027 28740006
         SPACE 1                                                 Y02027 28760006
*                                                              * Y02027 28780006
* RETURN FROM OPERATOR CONTROL WITH ...                        * Y02027 28800006
*        TCOPY - TERM AND OPTION DATA COPIED INTO AIB          * Y02027 28820006
*        TCHNG - BYTE COUNT OF DATA TO BE MOVED FROM USER'S    * Y02027 28840006
*                WORKAREA.                                     * Y02027 28860006
*                                                              * Y02027 28880006
         SPACE 1                                                 Y02027 28900006
SIZERET  EQU   *                                                 Y02027 28920006
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 28940006
         ICM   RENTRY,ONE,AIBOPRC       CHECK RETURN CODE        Y02027 28960006
         BNZ   FREEAIB2                 BRANCH IF ERROR          Y02027 28980006
         TM    AIBCOMCD,AIBTCHNG        TCHNG OR TCOPY           Y02027 29000006
         BO    GOTCHNG                  BRANCH IF TCHNG          Y02027 29020006
*                                                              * Y02027 29040006
*          FOR TCOPY MOVE DATA FROM AIB TO USER WORK AREA        Y02027 29060006
*                                                              * Y02027 29080006
         LH    RTEMP,AIBCOUNT           GET SIZE FOR MOVE        Y02027 29100006
         BAL   RETURN,TOUSWKAR          GO MOVE DATA             Y02027 29120006
         SR    RENTRY,RENTRY            CLEAR FOR GOOD RETURN CD Y02027 29140006
         LR    RPARM,RAIB               SET AIB PTR FOR SUBRTN   Y02027 29160006
         B     FREEAIB2                 GO FREE AIB AND EXIT     Y02027 29180006
         SPACE 1                                                        29200006
*                                                              * Y02027 29220006
*        FOR TCHNG MOVE DATA FROM USER'S WORK AREA TO AIB      * Y02027 29240006
*        AND RETURN TO OPERATOR CONTROL TO UPDATE TERM ENTRY   * Y02027 29260006
*                                                              * Y02027 29280006
GOTCHNG  EQU   *                                                 Y02027 29300006
         TM    AIBFLAG1,AIBGETSZ        FOR LIST OR SINGLE       Y02027 29320006
         BZ    CHNGRET                  BR IF LIST TO SET UP FOR Y02027 29340006
*                                       CHECK POINT              Y02027 29360006
         XC    AIBFLAG1(ONE),AIBFLAG1   CLEAR FLAG FIELD         Y02027 29380006
         LH    RTEMP,AIBCOUNT           GET SIZE FOR MOVE        Y02027 29400006
         BAL   RETURN,TOAIB             GO MOVE DATA TO AIB      Y02027 29420006
         SPACE 1                                                        29440006
         L     RTEMP,TCXAVT             RESTORE OPERATOR         Y02027 29444006
         LA    RTEMP,AVTOPCOB-IEDQAVTD(RTEMP)     CONTROL        Y02027 29448006
         STCM  RTEMP,SEVEN,AIBQCBA      ADDRESS                  Y02027 29452006
         MVI   AIBKEY,AIBAPKEY          SET FLAG = MPP REQUESTOR Y02027 29456006
         XC    AIBLINK,AIBLINK          CLEAR LINK FIELD         Y02027 29460006
         LA    RPARM,AIBKEY             SET UP RCB ADDRESS       Y02027 29480006
SET1     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @ZA02099X29486061
               RELATED=(MCP,IEDQEB,SET2)                       @ZA02099 29492061
         BAL   RETURN,TPOSTSUB          PUT AIB ON DISABLED RDY QY02027 29500006
         BAL   RETURN,BRWAIT            GO TO OS WAIT ROUTINE    Y02027 29520006
         SPACE 1                                                 Y02027 29540006
CHNGRET  EQU   *                                                 Y02027 29560006
         SR    RENTRY,RENTRY            CLEAR RETURN CD REG      Y02027 29580006
         ICM   RENTRY,BY3,AIBOPRC       GET RETURN CODE          Y02027 29600006
         BNZ   FREEAIB2                 BRANCH IF ERROR          Y02027 29620006
         TM    TCXCKPM,CHKPT            IS CHECKPOINT IN SYSTEM  Y02027 29640006
         BNO   FREEAIB2                 BRANCH IF NO             Y02027 29660006
         LR    RPARM,RAIB               SET PARM REG FOR SUBRTN  Y02027 29680006
         MVI   AIBKEY,TCHKPT            SET TCHNG CHECKPOINT     Y02027 29700006
*                                       REQUEST CODE IN AIB      Y02027 29720006
         MVC   AIBOFFS(TWO),AIBTNDX     SET TERM OFFSET        @ZA02615 29740061
*                                       ENTRY FOR SUBROUTINE     Y02027 29760006
SET2     SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @ZA02099X29780061
               RELATED=(MCP,IEDQEB,SET1)                       @ZA02099 29790061
         B     CKPT                     GO TO TAKE A CHECKPOINT  Y02027 29800006
*                                       RETURN FROM CKPT SUBRTN  Y02027 29820006
*                                       IS TO 'EXIT'             Y02027 29840006
         SPACE 1                                                        29860006
**************************************************************** Y02027 29880006
*         THIS CODE PROCESSES THE QCOPY FUNCTION               * Y02027 29900006
**************************************************************** Y02027 29920006
         SPACE 1                                                        29940006
QCOPY    EQU   *                                                 Y02027 29960006
         L     RWORK,APNAME             GET PTR TO TRM NAME      Y02027 29980006
         ICM   RTEMP,ALL,APPASWD        GET LIMIT SPECIFICATION  Y02027 30000006
         BZ    NOTLIMIT                 BR IF NOT ITERATIVE FUNC Y02027 30020006
         STH   RTEMP,AIBLIMIT           SAVE IN AIB              Y02027 30040006
         ST    RWORK,AIBQLMNA           SAVE TERMNAME PTR        Y02027 30060006
         SPACE 1                                                 Y02027 30080006
NOTLIMIT EQU   *                                                 Y02027 30100006
         MVC   AIBNAME(EIGHT),ZERO(RWORK)    MOVE TERM NA TO AIB Y02027 30120006
         OI    AIBFLAG1,AIBTNT          TURN ON TERM LOOKUP FLAG Y02027 30140006
         LA    RPARM,AIBKEY             SET PARM REGISTER        Y02027 30160006
         BAL   RETURN,TPOSTSUB          GO PUT AIB ON ASYNCH R Q Y02027 30180006
         BAL   RETURN,BRWAIT            GO TO WAIT SUBRTN        Y02027 30200006
*                                                              * Y02027 30220006
*              RETURN FROM MCP WITH QCB COPIED INTO AIB        * Y02027 30240006
*              COPY QCB INTO USER WORKAREA AND EXIT            * Y02027 30260006
*                                                              * Y02027 30280006
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 30300006
         ICM   RENTRY,ONE,AIBOPRC       PICK UP RETURN CODE      Y02027 30320006
         BZ    RTGOOD                   BR IF GOOD COMPLETION    Y02027 30340006
         LA    RTEMP,EIGHTY             CHECK FOR END OF QCOPY   Y02027 30360006
*                                       LIMIT FUNCTION           Y02027 30380006
         CR    RENTRY,RTEMP             CHECK FOR END OF QCOPY   Y02027 30400006
*                                       LIMIT FUNCTION           Y02027 30420006
         BNE   FREEAIB2                 NO, BRANCH               Y02027 30440006
         LA    RENTRY,ALL               SET RET CODE FOR IEDQE2  Y02027 30460006
         B     FREEAIB2                 PREPARE TO EXIT          Y02027 30480006
RTGOOD   EQU   *                                                 Y02027 30500006
         ICM   RENTRY,THREE,AIBLIMIT    WAS LIMIT SPECIFIED      Y02027 30520006
         BZ    REGULAR                  NO, BRANCH               Y02027 30540006
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 30560006
         IC    RTEMP,AIBQLMNA           MAXIMUM TERM NAME LENGTH Y02027 30580006
         L     RWORK,AIBQLMNA           AREA TO RETURN TERM NAME Y02027 30600006
         LA    RWORK,ZERO(,RWORK)       CLEAR HIGH ORDER BYTE    Y02027 30620006
         EX    RTEMP,MOVENAME           MOVE TERM NAME TO USER   Y02027 30640006
*                                       AREA                     Y02027 30660006
*                                       USER AREA                Y02027 30680006
         SPACE 1                                                        30700006
REGULAR  EQU   *                                                 Y02027 30720006
         LH    RTEMP,AIBCOUNT           GET QCB SIZE             Y02027 30740006
         BAL   RETURN,TOUSWKAR          GO MOVE QCB DATA TO      Y02027 30760006
*                                       USER'S WORK AREA         Y02027 30780006
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 30800006
         B     FREEAIB2                 FREE AIB AND EXIT        Y02027 30820006
         SPACE 1                                                        30840006
MOVENAME MVC   ZERO(ZERO,RWORK),AIBNAME MOVE TERMINAL NAME       Y02027 30860006
         SPACE 2                                                        30880006
*****************************************************************Y02027 30900006
*        THIS CODE HANDLES THE ICOPY AND ICHNG FUNCTIONS        *Y02027 30920006
*****************************************************************Y02027 30940006
ICHNCOPY EQU   *                                                 Y02027 30960006
         L     RWORK,APNAME             PICK UP DDNAME PTR & RLN Y02027 30980006
         STCM  RWORK,EIGHT,AIBFLAG2     MOVE RLN TO AIB          Y02027 31000006
         LA    RWORK,ZERO(,RWORK)       CLEAR HIGH ORDER BYTE    Y02027 31020006
         MVC   AIBNAME(EIGHT),ZERO(RWORK)    DDNAME IN AIB       Y02027 31060006
         CLI   AIBCOMCD,AIBICHNG        ICHNG FUNCTION           Y02027 31080006
         BNE   INVGO                    NO, BRANCH               Y02027 31100006
         MVC   AIBTNDX(FOUR),AIBWAPTR   MOVE WORKAREA PTR OR     Y02027 31120006
*                                       ACT/DEACT CODE           Y02027 31140006
         CLC   AIBWAPTR(THREE),ZEROES   REPLACE OR ACT/DEACT     Y02027 31160006
         BE    INVGO                    BRANCH IF ACT/DEACT      Y02027 31180006
         L     RWORK,AIBWAPTR           GET WORK AREA PTR               31200006
         SR    RPARM,RPARM              CLEAR                    Y02027 31203006
         SR    RTEMP,RTEMP                    REGISTERS          Y02027 31206006
         IC    RPARM,ZERO(RWORK)        GET NUMBER OF ENTRIES &  Y02027 31209006
         IC    RTEMP,TWO(RWORK)         LENGTH OF EACH FR WRKAREAY02027 31212006
         MR    RWORK,RPARM              GET TOTAL LIST LENGTH    Y02027 31215006
         LA    RTEMP,TEN(,RTEMP)      ADD SIZE OF CONTROL      @OZ08344 31218091
*                                      WORD+EOL+EOT(BSC)       @OZ08344 31221091
         BAL   RETURN,TOAIB             GO MOVE LIST TO AIB      Y02027 31224006
         LA    RTEMP,AIBDATA            SET WORK AREA PTR        Y02027 31227006
         ST    RTEMP,AIBTNDX            AND SAVE                 Y02027 31230006
         SPACE 1                                                        31240006
INVGO    EQU   *                                                 Y02027 31260006
         LA    RPARM,AIBKEY             SET PARM REG FOR SUBRTN  Y02027 31280006
         BAL   RETURN,TPOSTSUB          GO POST AIB TO OP CONT   Y02027 31300006
         BAL   RETURN,BRWAIT            AND WAIT FOR OP CONTROL  Y02027 31320006
*                                       TO PROCESS               Y02027 31340006
*                                                              * Y02027 31360006
*     RETURN FROM MCP WITH INVITATION LIST COPIED TO AIB       * Y02027 31380006
*                                                              * Y02027 31400006
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 31420006
         ICM   RENTRY,BY3,AIBOPRC       PICK UP RETURN CODE      Y02027 31440006
         BNZ   FREEAIB2                 BRANCH IF ERROR          Y02027 31460006
         SPACE 1                                                        31480006
         TM    AIBCOMCD,AIBICHNG        ICHNG FUNCTION           Y02027 31500006
         BO    FREEAIB2                 PREPARE TO EXIT                 31520006
         LH    RTEMP,AIBCOUNT           GET BYTE COUNT FOR MOVE  Y02027 31540006
         BAL   RETURN,TOUSWKAR          GO MOVE DATA TO USER     Y02027 31560006
*                                       WORK AREA                Y02027 31580006
         SR    RENTRY,RENTRY            CLEAR FOR GOOD RETURN CD Y02027 31600006
         B     FREEAIB2                 GO FREE AIB AND EXIT     Y02027 31620006
         SPACE 2                                                        31640006
         SPACE 2                                                        32240006
TPDATE   EQU   *                                                 Y02027 32260006
         SPACE 1                                                        32280006
         SR    RTEMP,RTEMP              CLEAR                    Y02027 32300006
         SR    RETURN,RETURN            REGISTERS                Y02027 32320006
         IC    RTEMP,APNAME             PICK UP OPTION BYTE      Y02027 32340006
         STC   RTEMP,AIBFLAG2           AND STORE IN AIB         Y02027 32360006
         ICM   RTEMP,ADD,APUSWKA        DTS AREA SPECIFICATION   Y02027 32380006
         ICM   RETURN,ADD,APNAME+ONE    AND GET PEWA PTR         Y02027 32400006
         STM   RTEMP,RETURN,AIBNAME     STORE PTRS IN AIB        Y02027 32420006
         LA    RPARM,AIBKEY             SET PARM REG FOR SUBRTN  Y02027 32440006
         BAL   RETURN,TPOSTSUB          GO POST AIB TO OP CONT   Y02027 32460006
         BAL   RETURN,BRWAIT            AND WAIT FOR OPERATOR    Y02027 32480006
*                                       CONTROL TO PROCESS       Y02027 32500006
*                                                              * Y02027 32520006
*                       RETURN FROM OP CONTROL                 * Y02027 32540006
*                                                              * Y02027 32560006
         ICM   RETURN,ADD,APNAME+ONE    GET PEWA PTR           @OZ18744 32562082
         ICM   RENTRY,ALL,PEWADEB-IEDQPEWA(RETURN) GET DEB PTR @OZ18744 32564082
         ICM   RENTRY,ALL,DEBDCBAD-1-IEDQDEB(RENTRY)  DCB PTR  @OZ18744 32566082
         ICM   RENTRY,ALL,DCBPECB-IHADCB(RENTRY)   GET PECB PTR@OZ18744 32568082
         MVC   PECBDTSA-IEDQPECB(3,RENTRY),PEWADTSA-IEDQPEWA(RETURN)    32570082
*                                       SAVE DTSA FOR TPDATE   @OZ18744 32572082
         MVC   PECBOPTC-IEDQPECB(1,RENTRY),PEWAOPT2-IEDQPEWA(RETURN)    32574082
*                                        SAVE DELETE=YES FLAG  @OZ18744 32576082
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 32580006
         ICM   RENTRY,EIGHT,AIBFLAG2    GET RECDLM OR ZERO       Y02027 32600006
         B     FREEAIB2                 GO FREE AIB AND EXIT     Y02027 32620006
         SPACE 2                                                        32640006
MCOUNT   EQU   *                                                 Y02027 32660006
         MVC   AIBNAME(4),APNAME        SET PEWA PTR             Y02027 32680006
         LA    RPARM,AIBKEY             SET PARM REG FOR TPOST   Y02027 32700006
         BAL   RETURN,TPOSTSUB          GO POST AIB TO OP CNTRL  Y02027 32720006
         BAL   RETURN,BRWAIT            AND GO WAIT              Y02027 32740006
*                                                              * Y02027 32760006
*    RETURN FROM OPERATOR CONTROL WITH MESSAGE COUNT IN AIB    * Y02027 32780006
*                                                              * Y02027 32800006
         SR    RENTRY,RENTRY            CLEAR REGISTER           Y02027 32820006
         ICM   RENTRY,BY3,AIBOPRC       PICK UP RETURN CODE      Y02027 32840006
         LH    RPARM,AIBCOUNT           SET REG 1 FOR USER       Y02027 32860006
         B     FREEAIB2                 GO FREE AIB AND EXIT     Y02027 32920006
         SPACE 2                                                        32940006
MRELEASE EQU   *                                                 Y02027 32960006
         SPACE 1                                                        32980006
         L     RWORK,APNAME             PTR TO STATION NAME      Y02027 33000006
         MVC   AIBNAME(EIGHT),ZERO(RWORK)    SET NAME IN AIB     Y02027 33020006
         LA    RPARM,AIBKEY             SET UP PARM REGISTER     Y02027 33040006
         BAL   RETURN,TPOSTSUB          GO POST AIB TO OP CNTRL  Y02027 33060006
         BAL   RETURN,BRWAIT            AND WAIT FOR OPERATOR    Y02027 33080006
*                                       CONTROL TO PROCESS       Y02027 33100006
*                                                              * Y02027 33120006
*  RETURN FROM OPERATOR CONTROL - GET RETURN CODE AND EXIT     * Y02027 33140006
*                                                              * Y02027 33160006
         SR    RENTRY,RENTRY            CLEAR RET CD REG         Y02027 33180006
         IC    RENTRY,AIBOPRC           PICK UP RETURN CODE      Y02027 33200006
         B     FREEAIB2                 FREE AIB AND EXIT        Y02027 33220006
         SPACE 2                                                        33240006
MCPCLOSE EQU   *                                                 Y02027 33260006
         LA    RPARM,AIBKEY             SET PARM REGISTER        Y02027 33280006
         BAL   RETURN,TPOSTSUB          POST AIB TO OP CONTROL   Y02027 33300006
         OI    TCXBIT1,AVTCLOSN         SET CLOSEDOWN IN PROGRESSY02027 33310006
         SR    RENTRY,RENTRY            CLEAR FOR GOOD RET CD    Y02027 33320006
         B     EXIT                     RETURN TO USER           Y02027 33340006
         SPACE 2                                                        33360006
**************************************************************** Y02027 33380006
* THIS CODE MOVES DATA FROM THE USER'S WORK AREA TO THE AIB.   * Y02027 33400006
* AT ENTRY, RTEMP CONTAINS THE BYTE COUNT.                     * Y02027 33420006
**************************************************************** Y02027 33440006
TOAIB    EQU   *                                                 Y02027 33460006
         LA    RENTRY,AIBSZERR          SET POSS ERROR CODE      Y02027 33480006
         LH    RZERO,TCXSZAIB           GET SIZE OF AIB          Y02027 33500006
         LA    RPARM,AIBDATA-IEDQAIB    GET PREFIX AREA SIZE     Y02027 33520006
         SR    RZERO,RPARM              GET SIZE OF USER DATA    Y02027 33540006
*                                       AREA IN AIB              Y02027 33560006
         CR    RZERO,RTEMP              IS AMT OF DATA LARGER    Y02027 33580006
*                                       THAN AIB AREA            Y02027 33600006
         BL    FREEAIB2                 YES, BRANCH              Y02027 33620006
         SPACE 1                                                        33640006
         L     RWORK,AIBWAPTR           GET USER WORKAREA PTR    Y02027 33660006
         LA    RCOMPC,AIBDATA           RECIPIENT AREA IN AIB    Y02027 33680006
         LR    RCECB,RTEMP              RECEIVING AREA LENGTH    Y02027 33700006
         ICM   RTEMP,EIGHT,BLANKS       SET PAD CHARACTER        Y02027 33720006
         MVCL  RCOMPC,RWORK             MOVE DATA                Y02027 33740006
         BR    RETURN                   RETURN TO CALLER         Y02027 33760006
         SPACE 2                                                        33780006
**************************************************************** Y02027 33800006
*  THIS CODE MOVES DATA FROM THE AIB TO THE USER'S WORK AREA.  * Y02027 33820006
*  AT ENTRY, RTEMP CONTAINS THE BYTE COUNT.                    * Y02027 33840006
**************************************************************** Y02027 33860006
TOUSWKAR EQU   *                                                 Y02027 33880006
         L     RCOMPC,AIBWAPTR          GET PTR TO USER'S        Y02027 33900006
*                                       WORKAREA                 Y02027 33920006
         LA    RWORK,AIBDATA            GET PTR TO DATA IN AIB   Y02027 33940006
         LR    RCECB,RTEMP              RECIEVING AREA LENGTH    Y02027 33960006
         ICM   RTEMP,EIGHT,BLANKS       SET PADDING CHARACTER    Y02027 33980006
         MVCL  RCOMPC,RWORK             MOVE DATA                Y02027 34000006
         BR    RETURN                   RETURN TO CALLER         Y02027 34020006
         SPACE 2                                                 Y02027 34040006
**************************************************************** Y02027 34060006
*                  THIS CODE PROVIDES THE INTERFACE            * Y02027 34080006
*                  FOR THE BRANCH ENTRY TO WAIT                * Y02027 34100006
**************************************************************** Y02027 34120006
         SPACE 1                                                        34140006
BRWAIT   EQU   *                                                 Y02027 34160006
         LA    RZERO,ONE                SET WAIT COUNT           Y02027 34180006
         LA    RTEMP,WAITRET            ADD FOR RETURN FROM WAIT Y02027 34200006
         STCM  RTEMP,SEVEN,RBOPSW+FIVE(RSVRB) AND SET IT IN SVRB Y02027 34220006
         L     RENTRY,CVTPTR            GET CVT POINTER          Y02027 34240006
         L     RENTRY,CVTVWAIT-CVTMAP(RENTRY)    EPA FOR BRANCH  Y02027 34260006
*                                       ENTRY TO WAIT            Y02027 34280006
         STM   RZERO,RENTRY,TCBGRS-IEDQTCB(RTCB)   SAVE REGS IN  Y02027 34300006
*                                       THE TCB                  Y02027 34320006
         LA    RPARM,APECB              GET ECB ADDRESS          Y02027 34340006
         XC    ZERO(FOUR,RPARM),ZERO(RPARM)   CLEAR ECB          Y02027 34360006
         BR    RENTRY                   GO TO WAIT ROUTINE       Y02027 34380006
         SPACE 1                                                 Y02027 34400006
WAITRET  EQU   *                                                 Y02027 34420006
         L     RTEMP,AIBECBA            GET ECB ADDRESS          Y02027 34440006
         XC    ZERO(FOUR,RTEMP),ZERO(RTEMP)  CLEAR ECB           Y02027 34460006
         BR    RETURN                   RETURN TO CALLER         Y02027 34480006
         SPACE 2                                                 Y02027 34500006
PASSCHK  EQU   *                                                 Y02027 34520006
**************************************************************** Y02027 34540006
*                   SCRAMBLE AND CHECK PASSWORD                  Y02027 34560006
**************************************************************** Y02027 34580006
         SPACE 1                                                 Y02027 34600006
         CLC   TCXPASWD(EIGHT),BLANKS   IS PASSWORD REQUIRED     Y02027 34620006
         BER   RETURN                   NO, BRANCH               Y02027 34640006
         ICM   RTEMP,ALL,APPASWD        GET PTR TO PASSWORD      Y02027 34660006
         BZ    PASSERR                  BRANCH IF NO             Y02027 34680006
         ICM   RCOMPC,BY0+BY1,TWO(RTEMP)    SCRAMBLE             Y02027 34700006
         ICM   RCOMPC,BY2,ONE(RTEMP)    PASSWORD                 Y02027 34720006
         ICM   RCOMPC,BY3,SIX(RTEMP)    INTO                     Y02027 34740006
         ICM   RCECB,BY0,SEVEN(RTEMP)   REGISTERS                Y02027 34760006
         ICM   RCECB,BY1,ZERO(RTEMP)    FOR                      Y02027 34780006
         ICM   RCECB,BY2+BY3,FOUR(RTEMP)     COMPARISON          Y02027 34800006
         N     RCOMPC,NR                                         Y02027 34820006
         N     RCECB,NR                                          Y02027 34840006
         X     RCOMPC,XR                                         Y02027 34860006
         X     RCECB,XR                                          Y02027 34880006
         SPACE 1                                                 Y02027 34900006
         C     RCOMPC,TCXPASWD          FIRST HALF VALID         Y02027 34920006
         BNE   PASSERR                  BRANCH IF NO             Y02027 34940006
         C     RCECB,TCXPASWD+FOUR      SECOND HALF VALID        Y02027 34960006
         BER   RETURN                   YES, BRANCH              Y02027 34980006
         SPACE 1                                                 Y02027 35000006
PASSERR  EQU   *                                                 Y02027 35020006
         LA    RENTRY,INVPASS           SET ERROR RETURN CODE    Y02027 35040006
         B     EXIT                     RETURN TO CALLER         Y02027 35060006
         SPACE 2                                                        35080006
FREEAIB2 EQU   *                                                 Y02027 35100006
         MVI   AIBSTATE,AIBFREE         INDICATE AIB IS FREE     Y02027 35120006
         B     EXIT                     LEAVE                    Y02027 35140006
         DROP  RAIB                                              Y02027 35160006
         TITLE '''PUT/WRITE FUNCTION'''                                 35200006
PUTWRITE EQU   *                                                 Y02027 35220006
*                                                                Y02027 35240006
*                        PUT-WRITE FUNCTION                      Y02027 35260006
*                                                                Y02027 35280006
*              REGISTER EQUATES FOR PUT WRITE FUNCTION           Y02027 35300006
*RDCB    EQU   10                       ADDRESS OF DCB           Y02027 35320006
*RPEWA   EQU   11                       ADDRESS OF PEWA          Y02027 35340006
*RPECB   EQU   12                       ADDRESS OF PECB          Y02027 35360006
*                                                                Y02027 35380006
*                                                                Y02027 35400006
*              ADDRESSABILITY                                    Y02027 35420006
*                                                                Y02027 35440006
         USING IEDQPECB,RPECB           PECB ADDRESSABILITY      Y02027 35460006
         USING IHADCB,RDCB              DCB ADDRESSABILITY       Y02027 35480006
         USING IEDQDEB,RDEB             DEB ADDRESSABILITY       Y02027 35500006
         USING IEDQPEWA,RPEWA           PEWA ADDRESSABILITY      Y02027 35520006
*                                                                Y02027 35540006
         L     RPECB,ZERO(RPARM)        GET ECB ADDR           @OZ07830 35560091
         XC    PECBECB(4),PECBECB       CLEAR ECB                Y02027 35600006
         L     RDCB,REG10(RSVRB)        GET REG 10 FROM SVRB-    Y02027 35620006
*                                       DCB FROM IGG019RI        Y02027 35640006
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02027 35660006
         ICM   RPEWA,SEVEN,DEBPEWA      GET PEWA ADDRESS         Y02027 35680006
*                                                                Y02027 35700006
         BAL   RETURN,AIBSUBR           GET AIB                  Y02027 35720006
         USING IEDQAIB,RPARM            ADDRESSABILITY OF AIB    Y02027 35740006
*                                       RETURNED IN REG 1        Y02027 35760006
         L     RETURN,REG2(RSVRB)       GET ADDRESS OF WORKAREA  Y02027 35780006
         L     RCVT,REG3(RSVRB)         GET MSG SIZE AS SET      Y02027 35800006
*                                       BY IGG019RI              Y02027 35820006
         L     RTEMP,REG6(RSVRB)        GET ADDR OF MSG OR OPTIONY02027 35840006
*                                       FIELDS AS SET BY IGG019RIY02027 35860006
         TM    DCBOPTCD,CTLBYTE         WORKAREA CONTENTS BYTE   Y02027 35880006
         BZ    SETOFF                   BRANCH IF NO             Y02027 35900006
         MVC   PEWACTL(1),PECBFLAG      MOVE FROM TEMPORATY      Y02027 35920006
*                                       STORAGE AS SET BY 019RI  Y02027 35940006
         TM    PEWAGSW+ONE,NEEDHDRN     NEED A HEADER NOW        Y02027 35960006
         BO    HDRTST                   BRANCH IF YES            Y02027 35980006
         TM    ZERO(RTEMP),HDRFLG       HAVE HEADER ANYWAY       Y02027 36000006
         BNO   EOMTST                   BR IF NO               @OZ16523 36020091
         MVI   PECBERR,SEQERR           SET COMPL. CODE FOR SEQ  Y02027 36040006
         B     FREEUP                   BRANCH IF YES - ERROR    Y02027 36060006
HDRTST   EQU   *                                                 Y02027 36080006
         TM    ZERO(RTEMP),HDRFLG       HEADER SPECIFIED         Y02027 36100006
         BO    SETFLAG                  BRANCH IF YES            Y02027 36120006
         MVI   PECBERR,SEQERR           SET COMPL CODE FOR SEQ   Y02027 36140006
         B     FREEUP                   RETURN                   Y02027 36160006
SETFLAG  NI    PEWAGSW+ONE,XFF-NEEDHDRN TURN OFF HEADER FLAG     Y02027 36180006
EOMTST   EQU   *                                                 Y02027 36200006
         TM    ZERO(RTEMP),EOMFLAG      EOM SPECIFIED IN WORKAREAY02027 36220006
         BNO   SEQOK                    BRANCH IF NO             Y02027 36240006
         OI    PEWAGSW+ONE,NEEDHDRN     SET NEED HEADER NEXT     Y02027 36260006
SEQOK    EQU   *                                                 Y02027 36280006
         LA    RTEMP,ONE(RTEMP)         BUMP PASSED CTL BYTE     Y02027 36300006
         BCTR  RCVT,RZERO               SUBTRACT ONE FROM MSGSIZEY02027 36320006
         LTR   RCVT,RCVT                TEST SIZE              @ZA04032 36326009
         BM    LENERR                   BRANCH IF NEG SIZE     @OY11959 36332081
SETOFF   EQU   *                                                 Y02027 36340006
         SR    RTEMP,RETURN             OFFSET TO START OF MSG   Y02027 36360006
         STH   RTEMP,AIBMSTRT           AND STORE IN AIB         Y02027 36380006
         STCM  RCVT,THREE,AIBWASZE      SIZE OF WORKAREA MINUS   Y02027 36400006
*                                       OPTIONAL FIELDS IF ANY   Y02027 36420006
         L     RCVT,REG3(RSVRB)         SIZE OF WORKAREA         Y02027 36440006
         TM    DCBRECFM,FIXFLG          FIXED OR UNDEFINED       Y02027 36460006
         BO    NOTVAR                   BRANCH IF YES            Y02027 36480006
         LH    RCVT,ZERO(RETURN)        LOAD WORKAREA SIZE FOR   Y02027 36500006
*                                       VARIABLE FORMAT          Y02027 36520006
NOTVAR   EQU   *                                                 Y02027 36540006
         LA    RTEMP,AIBWAP-IEDQAIB(RCVT) ADD SIZE OF AIB PREFIX Y02027 36560006
         CH    RTEMP,TCXSZAIB           SIZE GREATER THAN AIB    Y02027 36580006
         BNH   SIZEOK                   BRANCH IF NO             Y02027 36600006
LENERR   EQU   *                                               @ZA04032 36610009
         MVI   PECBERR,SOWACC           SET COMPLETION CODE      Y02027 36620006
         B     FREEUP                   RETURN TO RI             Y02027 36640006
SIZEOK   EQU   *                                                 Y02027 36660006
*                                                                Y02027 36680006
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 36700006
         ICM   RDEB,SEVEN,DCBEXLST+ONE  GET EXIT LIST ADDRESS    Y02027 36720006
         BZ    REC                      BRANCH IF NOT SPECIFIED  Y02027 36740006
CKLOOP   EQU   *                                                 Y02027 36760006
         TM    ZERO(RDEB),CKPTFLP       CHECK FOR CHECKPOINT   @ZA03744 36780009
         BO    SETCKPT1                 YES, BR                @ZA03744 36790009
         TM    ZERO(RDEB),EIGHTY        END OF EXIT LIST       @ZA03744 36800009
         BO    REC                      YES, BR TO CONT        @ZA03744 36810009
         LA    RDEB,FOUR(RDEB)          BUMP TO NEXT ENTRY     @ZA03744 36820009
         B     CKLOOP                   CONT SCAN              @ZA03744 36830009
SETCKPT1 EQU   *                                               @ZA03744 36840009
         ICM   RTEMP,FOUR,ZERO(RDEB)    GET ENTRY INDICATOR    @ZA03744 36850009
REC      EQU   *                                                 Y02027 36880006
         IC    RTEMP,DCBRECFM           GET RECFM FOR AIB        Y02027 36900006
         ICM   RTEMP,TWO,DCBOPTCD       GET OPTCD FOR AIB        Y02027 36920006
         ST    RTEMP,AIBEXLFP-ONE       STORE WITH EXLST FLAG  @ZA03744 36940009
*                                        IN AIB                @ZA03744 36960009
         ST    RPEWA,AIBPPEWA           PUT PEWA ADDR IN AIB     Y02027 36980006
         MVC   AIBPCBAD(4),PEPCBAD      PUT PCB ADDR IN AIB      Y02027 37000006
         ST    RPECB,AIBECBA            STORE ADDR OF ECB IN PECBY02027 37020006
*                                       IN AIB (WAITED ON IN EB) Y02027 37040006
         ST    RPECB,PEWAECBA           STORE ECB ADDR IN PEWA   Y02027 37060006
*                                       POSTED BY IEDQEC         Y02027 37080006
         LA    RPEB,AIBWAP              ADDR OF WORKAREA IN AIB  Y02027 37100006
         ST    RPEB,AIBWAPTR            STORE IN AIB             Y02027 37120006
         ST    RPEB,PEWAWA              AND STORE IN PEWA        Y02027 37140006
         LR    RENTRY,RCVT              PUT SIZE IN ODD REGISTERSY02027 37160006
         MVCL  RPEB,RETURN              MOVE DATA FROM USERS TO  Y02027 37180006
*                                       AIB'S WORKAREA           Y02027 37200006
*                                       RPEB=AIBWAP, RETURN=USERSY02027 37220006
*                                       WORKAREA ADDR, RCVT=SIZE Y02027 37240006
*                                                                Y02027 37260006
*              SET UP RCB                                        Y02027 37280006
*                                                                Y02027 37300006
         MVI   AIBPRI,PUTPRI            SET PRIORITY OF POST     Y02027 37320006
         LA    RPEB,PEWAQCB             PUT QCB ADDR IN RCB    @OZ27843 37348082
         STCM  RPEB,SEVEN,AIBQCBA       PUT QCB ADDR IN RCB    @OZ27843 37350082
         LR    RPEB,RPARM               SAVE AIB ADDR            Y02027 37360006
         LA    RPARM,AIBKEY             SET REG 1 = RCB ADDRESS  Y02027 37380006
         BAL   RETURN,TPOSTSUB          TPOST RCB TO ASYC READY QY02027 37400006
*                                                                Y02027 37420006
*              WAIT ON ECB IN PECB                               Y02027 37440006
*                                                                Y02027 37460006
         LA    RETURN,PWRETURN          GET RETURN ADDR FROM WAITY02027 37480006
         STCM  RETURN,SEVEN,RBOPSW+FIVE(RSVRB) AND STORE IN      Y02027 37500006
*                                       RIGHT HALF OF PSW IN SVRBY02027 37520006
         STM   RZERO,RENTRY,TCBGRS-IEDQTCB(RTCB) SAVE REGISTERS  Y02027 37540006
*                                       IN TCB                   Y02027 37560006
         LA    RZERO,ONE                WAIT COUNT               Y02027 37580006
         LA    RPARM,PECBECB            ADDRESS OF ECB           Y02027 37600006
         L     RCVT,CVTPTR              GET CVT ADDRESS          Y02027 37620006
         L     RENTRY,CVTVWAIT-CVTMAP(RCVT) GET BRANCH ENTRY     Y02027 37640006
*                                       TO WAIT                  Y02027 37660006
         BALR  RETURN,RENTRY            BRANCH TO WAIT           Y02027 37680006
*                                                                Y02027 37700006
*              MCP HAS POSTED A. P. ECB COMPLETE                 Y02027 37720006
*                                                                Y02027 37740006
         EJECT                                                          37760006
PWRETURN EQU   *                                                 Y02027 37780006
         SR    RENTRY,RENTRY            SET GOOD RETURN CODE     Y02027 37800006
         LR    RPARM,RPEB               GET SAVED AIB ADDRESS    Y02027 37820006
         L     RPECB,AIBECBA            ADDR OF PECB AND ECB     Y02027 37840006
         MVI   PECBFLAG,ZERO            INITIALIZE TO ZERO       Y02027 37860006
         MVC   PECBERR(1),PECBECB+THREE SAVE COMPLETION CODE     Y02027 37880006
*                                                                Y02027 37900006
*              CHECK FOR EXIT AND MOVE COMPLETION CODE           Y02027 37920006
*                                                                Y02027 37940006
         CLI   AIBEXLFP,ZERO            CK/PT EXIT TO BE TAKEN   Y02027 37960006
         BE    FREEUP                   BRANCH IF NO             Y02027 37980006
         MVI   PECBFLAG,CKPTFLG         SET EXIT TO BE TAKEN     Y02027 38000006
*                                                                Y02027 38020006
FREEUP   EQU   *                                                 Y02027 38040006
         MVI   AIBSTATE,AIBFREE         FREE AIB                 Y02027 38060006
         B     EXIT                     BRANCH TO RETURN         Y02027 38080006
*                                                                Y02027 38100006
         DROP  RDCB                                              Y02027 38120006
         DROP  RPECB                                             Y02027 38140006
         DROP  RDEB                                              Y02027 38160006
         DROP  RPEWA                                             Y02027 38180006
         DROP  RPARM                    MAKE REG1 AVAILABLE      Y02027 38200006
         TITLE '''POINT FUNCTION'''                                     38220006
POINT    EQU   *                                                 Y02027 38240006
*                                                                Y02027 38260006
*                        POINT FUNCTION                          Y02027 38280006
*                                                                Y02027 38300006
*              REGISTER EQUATES FOR POINT FUNCTION               Y02027 38320006
*RDCB    EQU   10                       ADDRESS OF DCB           Y02027 38340006
*RPEWA   EQU   11                       ADDRESS OF PEWA          Y02027 38360006
*RPECB   EQU   12                       ADDRESS OF PECB          Y02027 38380006
*                                                                Y02027 38400006
*              ADDRESSABILITY                                    Y02027 38420006
*                                                                Y02027 38440006
         USING IEDQPECB,RPECB           PECB ADDRESSABILITY      Y02027 38460006
         USING IHADCB,RDCB              DCB ADDRESSABILITY       Y02027 38480006
         USING IEDQDEB,RDEB             DEB ADDRESSABILITY       Y02027 38500006
         USING IEDQPEWA,RPEWA           PEWA ADDRESSABILITY      Y02027 38520006
*                                                                Y02027 38540006
         L     RPECB,ZERO(RPARM)        GET ECB ADDR           @OZ07830 38560091
         L     RDCB,REG5(RSVRB)         GET REG 5 FROM SVRB-     Y02027 38600006
*                                       DCB FROM RM              Y02027 38620006
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02027 38640006
         ICM   RPEWA,SEVEN,DEBPEWA      GET PEWA ADDRESS         Y02027 38660006
         L     RDEB,REG2(RSVRB)         GET REG 2 FROM SVRB      Y02027 38680006
*                                       ADDRESS OF RETRIEVE DATA Y02027 38700006
         CLI   EIGHT(RDEB),BLANK        RETRIEVAL TERMINATION    Y02027 38720006
         BNE   GO                       BRANCH IF NO             Y02027 38740006
*                                                                Y02027 38760006
*              RETRIEVE TERMINATION                              Y02027 38780006
*                                                                Y02027 38800006
         NI    PEWAOPTC,AVTEFF-PARTBUF  TURN OFF PARTIAL BUFFER  Y02027 38820006
         OI    PEWAGSW,RETRIEVE         SET RETRIEVE OK FLAG     Y02027 38840006
         NI    PEWARTVE+THREE,AVTEFF-MRM RESET FIRST TIME SWITCH Y02027 38860006
         MVI   PEWARTVE+TWO,BLANK       INDICATE END OF RETRIEVE Y02027 38880006
         SR    RENTRY,RENTRY            NORMAL RETURN CODE       Y02027 38900006
         B     EXIT                     RETURN                   Y02027 38920006
*                                                                Y02027 38940006
GO       EQU   *                                                 Y02027 38960006
         CLI   ZERO(RDEB),ZERO          MULTIPLE RETRIEVE MODE   Y02027 38980006
         BNE   RETCONT                  BRANCH IF NO             Y02027 39000006
*                                                                Y02027 39020006
*              MULTIPLE RETRIEVAL                                Y02027 39040006
*                                                                Y02027 39060006
         NI    PEWARTVE+THREE,AVTEFF-MRM RESET THE FIRST TIME SW Y02027 39080006
         ICM   RDCB,ONE,PEWARTVE+TWO    IS I OR O SPECIFIED      Y02027 39100006
         BNZ   MULTRET1                 BRANCH IF NO             Y02027 39120006
         MVC   PEWARTVE+TWO(1),EIGHT(RDEB)  ELSE MOVE ORIGINAL   Y02027 39140006
MULTRET1 EQU   *                                                 Y02027 39160006
         LA    RENTRY,INVTERM           POSSIBLE ERROR CODE      Y02027 39180006
         ICM   RDCB,SEVEN,PEWARTVE+FIVE TERMINAL ADDRESS         Y02027 39200006
         BZ    EXIT                     BRANCH IF NO RC=8        Y02027 39220006
         LA    RENTRY,INVSEQ            POSSIBLE ERROR CODE      Y02027 39240006
         ICM   RDCB,THREE,PEWARTVE+THREE SEQUENCE NUMBER         Y02027 39260006
         BZ    EXIT                     BRANCH IF NO RC=4        Y02027 39280006
         SR    RENTRY,RENTRY            NORMAL RETURN CODE       Y02027 39300006
         OI    PEWAOPTC,RTVFLG          TURN ON RETRIEVE MODE    Y02027 39320006
         B     EXIT                     BRANCH TO RETURN         Y02027 39340006
RETCONT  EQU   *                                                 Y02027 39360006
*              GET AIB                                           Y02027 39380006
*                                                                Y02027 39400006
         BAL   RETURN,AIBSUBR           GET AIB                  Y02027 39420006
         USING IEDQAIB,RPARM            AIB ADDRESSABILITY       Y02027 39440006
*                                       RETURNED IN REG 1        Y02027 39460006
*                                                                Y02027 39480006
*              INITIALIZE AIB FOR RETRIEVE CHECKING              Y02027 39500006
*                                                                Y02027 39520006
         MVC   AIBSTANM(11),ZERO(RDEB)  MOVE RETRIEVE DATA FROM  Y02027 39540006
*                                       USER AREA TO AIB         Y02027 39560006
         ST    RPEWA,AIBRPEWA           STORE PEWA ADDR IN AIB   Y02027 39580006
         XC    PEWAECBA,PEWAECBA        ENSURE ECB IS NOT POSTED Y02027 39600006
*                                       BY IEDQEW                Y02027 39620006
         ST    RPECB,AIBECBA            ADDRESS OF ECB IN AIB    Y02027 39640006
         LA    RDCB,AIBWAR              ADDR OF WORKAREA IN AIB  Y02027 39660006
         ST    RDCB,AIBWAPTR            STORE IN AIB             Y02027 39680006
         ICM   RDCB,SEVEN,PEPCBAD+ONE   ADDRESS OF DCB           Y02027 39700006
         ST    RDCB,AIBPCBAD            IN AIB                   Y02027 39720006
*                                                                Y02027 39740006
*              SET UP RCB                                        Y02027 39760006
*                                                                Y02027 39780006
         MVI   AIBPRI,PTPRI             SET PRIORITY OF POST     Y02027 39800006
         MVC   AIBQCBA(3),TCXPNTQ+ONE   GET QCB ADDR FOR ES      Y02027 39820006
         LR    RPEB,RPARM               SAVE AIB ADDRESS         Y02027 39840006
         LA    RPARM,AIBKEY             SET REG 1 = RCB ADDRESS  Y02027 39860006
         BAL   RETURN,TPOSTSUB          TPOST RCB TO ASYC READY QY02027 39880006
*                                                                Y02027 39900006
*              WAIT ON ECB IN PECB                               Y02027 39920006
*                                                                Y02027 39940006
         LA    RETURN,RRETURN           GET RETURN ADDR FROM WAITY02027 39960006
         STCM  RETURN,SEVEN,RBOPSW+FIVE(RSVRB) AND STORE IN      Y02027 39980006
*                                       RIGHT HALF OF PSW IN SVRBY02027 40000006
         STM   RZERO,RENTRY,TCBGRS-IEDQTCB(RTCB) SAVE REGISTERS  Y02027 40020006
*                                       IN TCB                   Y02027 40040006
         XC    PECBECB(FOUR),PECBECB    CLEAR ECB                Y02027 40060006
         LA    RZERO,ONE                WAIT COUNT               Y02027 40080006
         LA    RPARM,PECBECB            ADDRESS OF ECB           Y02027 40100006
         L     RCVT,CVTPTR              GET CVT ADDRESS          Y02027 40120006
         L     RENTRY,CVTVWAIT-CVTMAP(RCVT)  GET BRANCH ENTRY TO Y02027 40140006
*                                       WAIT                     Y02027 40160006
         BALR  RETURN,RENTRY            BRANCH TO WAIT           Y02027 40180006
         EJECT                                                   Y02027 40200006
*                                                                Y02027 40220006
*              MCP (IEDQES) HAS POSTED A. P. ECB COMPLETE        Y02027 40240006
*                                                                Y02027 40260006
RRETURN  EQU   *                                                 Y02027 40280006
         SR    RENTRY,RENTRY            CLEAR RETURN CODE        Y02027 40300006
         LR    RPARM,RPEB               GET SAVED AIB ADDRESS    Y02027 40320006
         L     RPECB,AIBECBA            ADDRESS OF ECB IN PECB   Y02027 40340006
         ICM   RENTRY,SEVEN,ONE(RPECB)  GET COMPLETION CODE      Y02027 40360006
*                                       SET RETURN CODE IN REG15 Y02027 40380006
         BNZ   RELAIB                   BRANCH IF ERROR          Y02027 40400006
         TM    NINE(RDEB),MULTSEQ       TEST SEQ FIELD FOR       Y02027 40420006
*                                       MULTIPLE RETRIEVAL       Y02027 40440006
         BZ    RELAIB                   BRANCH IF NO             Y02027 40460006
         MVI   ZERO(RDEB),ZERO          SET MULTI-RETRIEVAL MODE Y02027 40480006
*                                       SWITCH IN USERS WORKAREA Y02027 40500006
         L     RPEWA,AIBRPEWA           GET PEWA ADDRESS         Y02027 40520006
         OI    PEWARTVE+THREE,MRM       ENSURE FLAG SET          Y02027 40540006
RELAIB   EQU   *                                                 Y02027 40560006
         MVI   AIBSTATE,AIBFREE         FREE AIB                 Y02027 40580006
         B     EXIT                     BRANCH TO RETURN TO RM   Y02027 40600006
         DROP  RDCB                                              Y02027 40620006
         DROP  RPECB                                             Y02027 40640006
         DROP  RDEB                                              Y02027 40660006
         DROP  RPEWA                                             Y02027 40680006
         DROP  RPARM                    MAKE REG1 AVAILABLE      Y02027 40700006
         TITLE '''CHECK REQUEST FUNCTION'''                             40720006
*                                                                Y02027 40740006
*                        CHECK REQUEST FUNCTION                  Y02027 40760006
*                                                                Y02027 40780006
CKREQ    EQU   *                                                 Y02027 40800006
         LA    RENTRY,QNBNOCKR          SET ERROR CODE           Y02027 40820006
         L     RCECB,ZERO(RPARM)        GET ECB ADDRESS          Y02027 40840006
         TM    TCXCKPM,MCPCKPT          CHECK FOR ACTIVE CHECK   Y02027 40860006
*                                       POINT TASK               Y02027 40880006
         BNO   EXIT                     BRANCH IF NO RC = 04     Y02027 40900006
         CLI   TCXNCKPR,ZERO            CHECK FOR CKREQS         Y02027 40920006
*                                       SPECIFIED ON INTRO       Y02027 40940006
         BE    EXIT                     BRANCH IF NO CKREQ RCDS  Y02027 40960006
         BAL   RETURN,AIBSUBR           GET AIB                  Y02027 40980006
         USING IEDQAIB,RPARM            ADDRESSABILITY OF AIB    Y02027 41000006
*                                                                Y02027 41020006
*              INITIALIZE AIB FOR CHECK REQUEST                  Y02027 41040006
*                                                                Y02027 41060006
         LA    RCECB,ZERO(RCECB)        CLEAR HIGH ORDER BYTE    Y02027 41080006
         ST    RCECB,AIBECBA            STORE ECB ADDRESS IN AIB Y02027 41100006
         L     RWORK,REG11(RSVRB)       GET PEWA ADDRESS AS      Y02027 41120006
*                                       FOUND BY IEDQNB          Y02027 41140006
         ST    RWORK,AIBCPEWA           STORE FIRST PEWA IN AIB  Y02027 41160006
         L     RWORK,PEPCBAD-IEDQPEWA(RWORK) GET PCB ADDR        Y02027 41180006
         ST    RWORK,AIBPCBAD           STORE IN AIB             Y02027 41200006
         MVI   AIBKEY,CRECKREQ          SET KEY FOR CKREQ        Y02027 41220006
*                                                                Y02027 41240006
*              ENTRY POINT FOR CHECK REQUEST FROM TCHNG          Y02027 41260006
*              AIBKEY=X'10'                                      Y02027 41280006
*              ECB HAS BEEN CLEARED                              Y02027 41300006
*              TERM ENTRY OFFSET HAS BEEN STORED IN AIBOFFS      Y02027 41320006
*                                                                Y02027 41340006
CKPT     EQU   *                                                 Y02027 41360006
         MVC   AIBCKECB(4),AIBECBA      PUT ECB IN CRE           Y02027 41380006
*              SET UP RCB                                        Y02027 41400006
         L     RWORK,TCXAVT             ADDRESS OF AVT           Y02027 41420006
         LA    RWORK,AVTCKPTB-IEDQAVTD(RWORK)  ADDR OF CK PT QCB Y02027 41440006
         STCM  RWORK,SEVEN,AIBQCBA      PUT IN RCB               Y02027 41460006
         MVI   AIBPRI,PRIAPCKP          SET PRIORITY             Y02027 41480006
         LR    RPEB,RPARM               SAVE AIB ADDRESS         Y02027 41500006
         LA    RPARM,AIBKEY             SET REG 1 = RCB ADDRESS  Y02027 41520006
         BAL   RETURN,TPOSTSUB          TPOST RCB TO ASYC READY QY02027 41540006
*                                                                Y02027 41560006
*              WAIT ON ECB IN RCB                                Y02027 41580006
*                                                                Y02027 41600006
         LA    RETURN,CPRETURN          GET RETURN ADDR FROM WAITY02027 41620006
         STCM  RETURN,SEVEN,RBOPSW+FIVE(RSVRB) AND STORE IN      Y02027 41640006
*                                       RIGHT HALF OF PSW IN SVRBY02027 41660006
         STM   RZERO,RENTRY,TCBGRS-IEDQTCB(RTCB) SAVE REGISTERS  Y02027 41680006
         LA    RZERO,ONE                WAIT COUNT               Y02027 41700006
         L     RPARM,AIBECBA-IEDQAIB(RPEB) ADDRESS OF ECB        Y02027 41720006
         L     RCVT,CVTPTR              GET CVT ADDRESS          Y02027 41740006
         L     RENTRY,CVTVWAIT-CVTMAP(RCVT) GET ADDRESS OF BRANCHY02027 41760006
*                                       ENTRY TO WAIT            Y02027 41780006
         BALR  RETURN,RENTRY            BRANCH TO WAIT           Y02027 41800006
*                                                                Y02027 41820006
*              MCP (IEDQNQ) HAS POSTED A.P. ECB COMPLETE         Y02027 41840006
*                                                                Y02027 41860006
CPRETURN EQU   *                                                 Y02027 41880006
         SR    RENTRY,RENTRY            SET GOOD RETURN CODE     Y02027 41900006
         LR    RPARM,RPEB               GET SAVED AIB ADDRESS    Y02027 41920006
         MVI   AIBSTATE,AIBFREE         SET AIB AS FREE          Y02027 41940006
         B     EXIT                     EXIT                     Y02027 41960006
         DROP  RPARM                    MAKE REG1 AVAILABLE      Y02027 41980006
         TITLE '''QUEUE RESET FUNCTION'''                               42000006
QRESET   EQU   *                                                 Y02027 42020006
*                                                                Y02027 42040006
*                        QUEUE RESET FUNCTION                    Y02027 42060006
*                                                                Y02027 42080006
*              REGISTER EQUATES FOR QRESET FUNCTION              Y02027 42100006
*RDCB    EQU   10                       ADDRESS OF DCB           Y02027 42120006
*RPEWA   EQU   11                       ADDRESS OF PEWA          Y02027 42140006
*                                                                Y02027 42160006
*              ADDRESSABILITY                                    Y02027 42180006
*                                                                Y02027 42200006
         USING IHADCB,RDCB              DCB ADDRESSABILITY       Y02027 42220006
         USING IEDQPEWA,RPEWA           PEWA ADDRESSABILITY      Y02027 42240006
         USING IEDQDEB,RDEB             DEB ADDRESSABILITY       Y02027 42260006
         L     RWORK,ZERO(RPARM)        GET ECB ADDRESS          Y02027 42280006
         LA    RENTRY,QRERR             POSSIBLE ERROR CODE      Y02027 42300006
         L     RDCB,REG10(RSVRB)        GET REG 10 FROM SVRB     Y02027 42320006
*                                       DCB FROM GR              Y02027 42340006
         L     RDEB,DCBDEBAD            GET DEB ADDRESS          Y02027 42360006
         ICM   RPEWA,SEVEN,DEBPEWA      GET PEWA ADDRESS         Y02027 42380006
*                                                                Y02027 42400006
*              TEST TO SEE IF QRESET CAN BE DONE NOW             Y02027 42420006
*                                                                Y02027 42440006
         TM    PEWAGSW+ONE,ARESET       QRESET ALLOWED ON QUEUE  Y02027 42460006
         BNO   EXIT                     BRANCH IF NO RC= X'10'   Y02027 42480006
         TM    PEWAGSW+ONE,RESETACT     QRESET CURRENTLY ACTIVE  Y02027 42500006
         BO    EXIT                     BRANCH IF YES RC = X'10' Y02027 42520006
         LA    RDCB,EPAGE               IS AIB SIZE 512 OR       Y02027 42540006
         CH    RDCB,TCXSZAIB            GREATER                  Y02027 42560006
         BH    EXIT                     BRANCH IF NO - AIB NOT   Y02027 42580006
*                                       BIG ENOUGH FOR WORKAREA  Y02027 42600006
*                                                                Y02027 42620006
*              GET AIB                                           Y02027 42640006
*                                                                Y02027 42660006
         BAL   RETURN,AIBSUBR           GET AIB                  Y02027 42680006
         USING IEDQAIB,RPARM            AIB ADDRESSABILITY       Y02027 42700006
*                                       RETURNED IN REG 1        Y02027 42720006
*                                                                Y02027 42740006
*              INITIALIZE AIB WITH INFORMATION NEEDED BY IEDQGQ  Y02027 42760006
*                                                                Y02027 42780006
         LA    RPEWA,0(RPEWA)           CLEAR HI-ORDER BYTE      Y02027 42800006
         ST    RPEWA,AIBQPEWA           STORE PEWA ADDR IN AIB   Y02027 42820006
         L     RDCB,REG2(RSVRB)         GET REG 2 FROM SVRB      Y02027 42840006
*                                       ADDR OF USER INFO        Y02027 42860006
         MVC   AIBDESTN(10),ZERO(RDCB)  MOVE DESTINATION NAME    Y02027 42880006
*                                       AND SEQENCE NUMBER TO AIBY02027 42900006
         L     RDCB,REG6(RSVRB)         GET REG 6 FROM SVRB      Y02027 42920006
*                                       MAXIMUM SEQ NUMBER       Y02027 42940006
         ST    RDCB,AIBMAXNO            AND STORE IN AIB         Y02027 42960006
         LA    RWORK,ZERO(RWORK)        CLEAR HIGH ORDER BYTE    Y02027 42980006
         ST    RWORK,AIBECBA            STORE ECB ADDR IN AIB    Y02027 43000006
         ICM   RWORK,SEVEN,PEPCBAD+ONE  GET PCB ADDRESS AND      Y02027 43020006
         ST    RWORK,AIBPCBAD           STORE IN AIB             Y02027 43040006
         LA    RWORK,AIBWAQR            ADDR OF WORKAREA IN AIB  Y02027 43060006
         ST    RWORK,AIBWAPTR           STORE IN AIB             Y02027 43080006
*                                                                Y02027 43100006
*              SET UP RCB                                        Y02027 43120006
*                                                                Y02027 43140006
         MVI   AIBPRI,PRIRTBFR          SET X'D4' PRIORITY       Y02027 43160006
         MVC   AIBQCBA(3),TCXQRQ+ONE    GET QCB ADDRESS          Y02027 43180006
         LR    RPEB,RPARM               SAVE AIB ADDRESS         Y02027 43200006
         LA    RPARM,AIBKEY             SET REG 1 = RCB ADDRESS  Y02027 43220006
         BAL   RETURN,TPOSTSUB          TPOST RCB TO ASYC READY QY02027 43240006
*                                                                Y02027 43260006
*              WAIT ON ECB IN IEDQGR                             Y02027 43280006
*                                                                Y02027 43300006
         LA    RETURN,QRETURN           GET RETURN ADDR FROM WAITY02027 43320006
         STCM  RETURN,SEVEN,RBOPSW+FIVE(RSVRB) AND STORE IN      Y02027 43340006
*                                       RIGHT HALF OF PSW IN SVRBY02027 43360006
         STM   RZERO,RENTRY,TCBGRS-IEDQTCB(RTCB) SAVE REGISTERS  Y02027 43380006
*                                       IN TCB                   Y02027 43400006
         LA    RZERO,ONE                WAIT COUNT               Y02027 43420006
         L     RPARM,AIBECBA-IEDQAIB(RPEB) GET ECB ADDR          Y02027 43440006
         L     RCVT,CVTPTR              GET CVT ADDR             Y02027 43460006
         L     RENTRY,CVTVWAIT-CVTMAP(RCVT) GET BRANCH ENTRY TO  Y02027 43480006
*                                       WAIT                     Y02027 43500006
         BALR  RETURN,RENTRY            BRANCH TO WAIT           Y02027 43520006
*                                                                Y02027 43540006
*              MCP (IEDQGQ) HAS POSTED A. P. ECB COMPLETE        Y02027 43560006
*                                                                Y02027 43580006
QRETURN  EQU   *                                                 Y02027 43600006
         LR    RPARM,RPEB               GET AIB ADDRESS          Y02027 43620006
         LH    RENTRY,AIBRETCD          GET RETURN CODE AS SET   Y02027 43640006
*                                       BY IEDQGQ                Y02027 43660006
         LH    RZERO,AIBMSGNO           GET MSG # IF AVAILABLE   Y02027 43680006
*                                       AS SET BY IEDQGQ         Y02027 43700006
         MVI   AIBSTATE,AIBFREE         FREE AIB                 Y02027 43720006
         B     EXIT                     RETURN TO IEDQGR         Y02027 43740006
         DROP  RDCB                                              Y02027 43760006
         DROP  RPEWA                                             Y02027 43780006
         DROP  RDEB                                              Y02027 43800006
         DROP  RPARM                    MAKE REG 1 AVAILABLE     Y02027 43820006
         TITLE '''POST ECB FUNCTION'''                                  43821009
*                                                                Y02027 43822009
*                        POST ECB IN MEMORY COMPLETE             Y02027 43823009
*                                                                Y02027 43824009
*              RPARM POINTS TO A ONE OR TWO WORD PARAMETER LIST  Y02027 43825009
*                   THE FIRST WORD CONTAINS THE ADDRESS OF ECB   Y02027 43826009
*                                                                Y02027 43827009
*              PREPARE INTERFACE WITH SYSTEM POST ROUTINE        Y02027 43828009
*                                                                Y02027 43829009
POSTECB  EQU   *                                                 Y02027 43830009
         L     RCECB,ZERO(RPARM)        GET ADDRESS OF ECB TO BE Y02027 43831009
         LA    RCECB,ZERO(RCECB)        POSTED - CLEAR HI-ORDER  Y02027 43832009
         SR    RCOMPC,RCOMPC            SET COMPLETION CODE TO 0 Y02027 43833009
         L     RENTRY,CVTPTR            GET CVT ADDRESS          Y02027 43834009
         L     RENTRY,CVT0PT01-CVTMAP(RENTRY) ADDRESS OF BRANCH  Y02027 43835009
*                                       ENTRY TO POST ROUTINE    Y02027 43836009
         BALR  RETURN,RENTRY            BRANCH TO POST           Y02027 43837009
         B     EXIT                     RETURN TO CALLER         Y02027 43838009
         TITLE '''DISK I/O FUNCTION'''                                  43840009
************************************************************** @Z40X9DG 43843009
*                                                            * @Z40X9DG 43846009
*              ISSUE A STARTIO MACRO TO START I/O TO A       * @Z40X9DG 43849009
*              MESSAGE QUEUES DISK. BEFORE THE MACRO IS      * @Z40X9DG 43852009
*              ISSUED, CALL THE START I/O APPENDAGE          * @Z40X9DG 43855009
*              ADDRESSED BY THE DEB FOR INITIAL SETUP.       * @Z40X9DG 43858009
*                                                            * @Z40X9DG 43861009
************************************************************** @Z40X9DG 43864009
         USING IOSB,RIOSB               IOSB ADDRESSABILITY    @Z40X9DG 43867009
         USING IOSBE,RIOSBE             IOSBE ADDRESSABILITY   @Z40X9DG 43870009
         USING SRBSECT,RPARM            SRB ADDRESSABILITY     @Z40X9DG 43873009
STARTIO  EQU   *                                               @Z40X9DG 43876009
         LR    RIOSBE,RPARM             GET PARM LIST ADDR     @Z40X9DG 43879009
*                                       (PARM LIST IS BUILT IN @Z40X9DG 43882009
*                                       IOSBE)                 @Z40X9DG 43885009
         L     RIOSB,IOSBEIOS-ONE       GET IOSB ADDRESS       @Z40X9DG 43888009
         L     RCPB,IOSBECPB-ONE        GET CPB ADDRESS        @Z40X9DG 43891009
         L     RENTRY,IOSDSID           GET DEB ADDRESS        @Z40X9DG 43894009
         L     RENTRY,SIOA(,RENTRY)     GET ADDR OF SIO APPEN  @Z40X9DG 43897009
*                                       FROM THE DEB           @Z40X9DG 43900009
         BALR  RETURN,RENTRY            GO TO SIO APPENDAGE    @Z40X9DG 43903009
*                                       WITH REGS AS FOLLOWS:  @Z40X9DG 43906009
*                                         R2  - ADDR OF IOSB   @Z40X9DG 43909009
*                                         R7  - ADDR OF IOSBE  @Z40X9DG 43912009
*                                         R11 - ADDR OF CPB    @Z40X9DG 43915009
*                                         R14 - RETURN ADDRESS @Z40X9DG 43918009
*                                         R15 - ENTRY ADDR     @Z40X9DG 43921009
*                                       APPENDAGE ALTERS       @Z40X9DG 43924009
*                                       REGISTERS 1, 10, 11    @Z40X9DG 43927009
         L     RPARM,IOSSRB             GET SRB ADDRESS        @Z40X9DG 43930009
         XC    FOUR(SRBSIZE-FOUR,RPARM),FOUR(RPARM) CLEAR SRB  @Z40X9DG 43933009
         STCM  RIOSB,ADD,SRBPARM+ONE    POINT SRB TO IOSB      @Z40X9DG 43936009
         ST    RBASE,EXTSA(,RSVRB)      SAVE BASE REGISTER     @Z40X9DG 43939009
         LR    RTEMP,RSVRB              SAVE SVRB ADDR         @Z40X9DG 43942009
*                                       REG 13 IS THE ONLY REG @Z40X9DG 43945009
*                                       NOT DESTROYED BY       @Z40X9DG 43948009
*                                       STARTIO MACRO          @Z40X9DG 43951009
         STARTIO SRB=(1),TCB=0          ISSUE STARTIO          @Z40X9DG 43954009
         LR    RSVRB,RTEMP              RESTORE SVRB ADDR      @Z40X9DG 43957009
         L     RBASE,EXTSA(,RSVRB)      RESTORE BASE REG       @Z40X9DG 43960009
         B     EXIT                     RETURN TO SYSTEM       @Z40X9DG 43963009
         SPACE 1                                               @Z40X9DG 43966009
         DROP  RPARM,RIOSB,RIOSBE                              @Z40X9DG 43969009
         TITLE 'STARTIO FOR 3705 I/O'                          @G36XRDV 43969200
***************************************************************@G36XRDB 43969400
*                                                              @G36XRDB 43969600
* THIS ROUTINE ISSUES A STARTIO MACRO FOR 3705 I/O             @G36XRDB 43969800
*                                                              @G36XRDB 43970000
***************************************************************@G36XRDB 43970200
         USING PLSIO,RPARM                                     @G36XRDB 43970400
         USING IOSB,RIOSB                                      @G36XRDB 43970600
*                                                              @G36XRDB 43970800
NCPIO    DS    0H                                              @G36XRDV 43971000
         ICM   RIOSB,7,PLIOSB      GET IOSB ADDRESS            @G36XRDB 43971200
         SR    RWORK,RWORK         CLEAR REG                   @G36XRDB 43971400
         STC   RWORK,IOSFLA        ZERO FLAG BYTE              @G36XRDB 43971600
         MVC   IOSVST,PLSTART      START OF CHANNEL PROGRAM    @G36XRDB 43971800
         L     RWORK,PLSTART       GET REAL ADDRESS OF...      @G36XRDB 43971900
         LRA   RWORK,0(RWORK)      ...START OF CHANNEL PROGRAM @G36XRDB 43972000
         DROP  RPARM                                           @G36XRDV 43972400
         ST    RWORK,IOSRST        PUT REAL ADDR IN IOSB       @G36XRDB 43972600
         L     RENTRY,IOSDSID      ADDR OF DEB                 @G36XRDB 43972800
         L     RENTRY,SIOA(,RENTRY) ADDR OF 3705 SIO APPEND.   @G36XRDB 43973000
         LR    RPARM,RIOSB         ADDR OF IOSB IN REG 1       @G36XRDB 43973200
         BALR  RETURN,RENTRY       TRANSLATE CHANNEL PROGRAM   @G36XRDB 43973400
*                                  FROM VIRTUAL TO REAL        @G36XRDB 43973600
         L     RPARM,IOSSRB        SRB ADDRESS                 @G36XRDB 43973800
         USING SRBSECT,RPARM                                   @G36XRDV 43974000
         XC    FOUR(SRBSIZE-FOUR,RPARM),FOUR(RPARM) CLEAR SRB  @G36XRDB 43974200
         STCM  RIOSB,7,SRBPARM+ONE POINT SRB TO IOSB           @G36XRDB 43974400
         ST    RBASE,EXTSA(RSVRB)  SAVE BASE REG               @G36XRDB 43974600
         LR    RTEMP,RSVRB         SAVE SVRB ADDRESS           @G36XRDB 43974800
*                                  REG13 IS THE ONLY REG NOT   @G36XRDB 43975000
*                                  DESTROYED BY STARTIO MACRO  @G36XRDB 43975200
*                                                              @G36XRDB 43975400
         STARTIO SRB=(1),TCB=0     ISSUE START I/O             @G36XRDB 43975600
*                                                              @G36XRDB 43975800
         LR    RSVRB,RTEMP         RESTORE SVRB ADDRESS        @G36XRDB 43976000
         L     RBASE,EXTSA(,RSVRB) RESTORE BASE REG            @G36XRDB 43976200
         B     EXIT                EXIT                        @G36XRDB 43976400
         DROP  RPARM,RIOSB                                     @G36XRDB 43976600
         TITLE 'SCHEDULE SRB FOR POST'                                  43980009
************************************************************** @Z40X9DG 43981009
*                                                            * @Z40X9DG 43982009
*        SCHEDULE AN SRB TO RUN IN ANOTHER MEMORY. THE       * @Z40X9DG 43983009
*        CODE THAT RUNS UNDER THE SRB WILL POST AN ECB       * @Z40X9DG 43984009
*        COMPLETE. INPUT AT ENTRY POINT SCHSRB IS:           * @Z40X9DG 43985009
*              REGISTER 1  - PARAMETER LIST ADDRESS          * @Z40X9DG 43986009
*              REGISTER 3  - CVT ADDRESS                     * @Z40X9DG 43987009
*              REGISTER 4  - TCB ADDRESS                     * @Z40X9DG 43988009
*              REGISTER 5  - SVRB ADDRESS                    * @Z40X9DG 43989009
*              REGISTER 6  - TCX ADDRESS                     * @Z40X9DG 43990009
*              REGISTER 7  - ASCB ADDRESS                    * @Z40X9DG 43991009
*              REGISTER 9  - BASE ADDRESS                    * @Z40X9DG 43992009
*                                                            * @Z40X9DG 43993009
************************************************************** @Z40X9DG 43994009
         USING SSRBSECT,RWORK           PARM LIST ADDRESS      @Z40X9DG 43995009
SCHSRB   EQU   *                                               @Z40X9DG 43996009
         LR    RWORK,RPARM              GET PARM LIST ADDR     @Z40X9DG 43997009
         B     GETSRB                   GET AN SRB             @Z40X9DG 43998009
         SPACE 3                                               @Z40X9DG 43999009
************************************************************** @Z40X9DG 44000009
*                                                            * @Z40X9DG 44001009
*        GET AN SRB AND MARK IT 'IN USE'                     * @Z40X9DG 44002009
*                                                            * @Z40X9DG 44003009
************************************************************** @Z40X9DG 44004009
         USING PSRBSECT,RPARM           PREFIX ADDRESSABILITY  @Z40X9DG 44005009
SRBALLOC EQU   *                                               @Z40X9DG 44006009
         BAL   RDEB,SRBGETM             GET MORE SRB'S         @Z40X9DG 44007009
GETSRB   EQU   *                                               @Z40X9DG 44008009
         LA    RPARM,TCXSRBS            POINT TO TCX AS DUMMY  @Z40X9DG 44009009
*                                       FIRST SRB PREFIX       @Z40X9DG 44010009
NEXTSRB  EQU   *                                               @Z40X9DG 44011009
         ICM   RPARM,ADD,PSRBLINK       GET NEXT SRB ADDR      @Z40X9DG 44012009
         BZ    SRBALLOC                 NO MORE SRB'S -        @Z40X9DG 44013009
*                                       GO GET MORE            @Z40X9DG 44014009
         TS    PSRBTSFL                 IS SRB AVAILABLE       @Z40X9DG 44015009
         BNZ   NEXTSRB                  NO, BRANCH             @Z40X9DG 44016009
         LA    RPARM,PSRBSRB            GET START OF SRB       @Z40X9DG 44017009
         EJECT                                                 @Z40X9DG 44018009
************************************************************** @Z40X9DG 44019009
*                                                            * @Z40X9DG 44020009
*        INITIALIZE THE SRB FROM THE PARAMETER LIST AND      * @Z40X9DG 44021009
*        SCHEDULE THE SRB FOR THE POST FUNCTION.             * @Z40X9DG 44022009
*                                                            * @Z40X9DG 44023009
************************************************************** @Z40X9DG 44024009
         USING SRBSECT,RPARM            SRB ADDRESSABILITY     @Z40X9DG 44025009
         MVC   SRBASCB,SSRBASCB         GET ASCB ADDRESS       @Z40X9DG 44026009
         MVC   SRBPASID,SSRBASID        GET ASID               @Z40X9DG 44027009
         MVC   SRBPTCB,SSRBTCB          GET TCB ADDRESS        @Z40X9DG 44028009
         MVC   SRBPARM(ONE),SSRBCC      SET COMPLETION CODE    @Z40X9DG 44029009
         MVC   SRBPARM+ONE(THREE),SSRBECBA GET ECB ADDRESS     @Z40X9DG 44030009
         SPACE 1                                               @Z40X9DG 44031009
         SCHEDULE SRB=(1),SCOPE=LOCAL   SCHEDULE SRB           @Z40X9DG 44032009
         SPACE 1                                               @Z40X9DG 44033009
         SLR   RENTRY,RENTRY            RETURN CODE = 0        @Z40X9DG 44034009
         B     EXIT                     RETURN TO CALLER       @Z40X9DG 44035009
         EJECT                                                 @Z40X9DG 44036009
************************************************************** @Z40X9DG 44037009
*                                                            * @Z40X9DG 44038009
*        THIS SUBROUTINE WILL GETMAIN SRB'S TO BE USED FOR   * @Z40X9DG 44039009
*        THE 'SCHEDULE SRB FOR POST' FUNCTION. A POOL OF     * @Z40X9DG 44040009
*        SRB'S IS CHAINED OFF THE TCX (TCXSRBS). EACH TIME   * @Z40X9DG 44041009
*        ADDITIONAL SRB'S ARE NEEDED, 8 SRB'S WITH PREFIXES  * @Z40X9DG 44042009
*        ARE OBTAINED. EACH SRB IS OBTAINED WITH A FOUR-BYTE * @Z40X9DG 44043009
*        PREFIX WHICH CONTAINS THE TEST-AND-SET FLAGS AND    * @Z40X9DG 44044009
*        THE LINK FIELD. SRB'S ARE OBTAINED FROM SUBPOOL 245 * @Z40X9DG 44045009
*        IN SQA (FIXED STORAGE) IN KEY 0. THE SRB POOL IS    * @Z40X9DG 44046009
*        FREED BY IEDQOT01.                                  * @Z40X9DG 44047009
*                                                            * @Z40X9DG 44048009
*        INPUT:     REGISTER 4  = TCB ADDRESS                * @Z40X9DG 44049009
*                   REGISTER 7  = ASCB ADDRESS               * @Z40X9DG 44050009
*                   REGISTER 8  = RETURN ADDRESS             * @Z40X9DG 44051009
*                   REGISTER 9  = BASE REGISTER              * @Z40X9DG 44052009
*                   (REGS 0-3,10,14,15 ARE USED AS WORK REGS)* @Z40X9DG 44053009
*                                                            * @Z40X9DG 44054009
************************************************************** @Z40X9DG 44055009
SRBGETM  EQU   *                                               @Z40X9DG 44056009
         LA    RZERO,SRBBLKSZ           GET SIZE OF BLOCK OF   @Z40X9DG 44057009
*                                       SRB'S WITH PREFIXES    @Z40X9DG 44058009
         LR    RPEB,RASCB               SAVE ASCB ADDRESS      @Z40X9DG 44059009
         SPACE 1                                               @Z40X9DG 44060009
************************************************************** @Z40X9DG 44061009
*                                                            * @Z40X9DG 44062009
*        BRANCH ENTRY TO GETMAIN EXPECTS LENGTH IN REG 0,    * @Z40X9DG 44063009
*        TCB ADDRESS IN REG 4, AND ASCB ADDRESS IN REG 7.    * @Z40X9DG 44064009
*        MACRO EXPANSION USES REGS 1,3,14, AND 15. REG 7 IS  * @Z40X9DG 44065009
*        DESTROYED BY GETMAIN AND SHOULD BE SAVED. GETMAINED * @Z40X9DG 44066009
*        AREA ADDRESS IS RETURNED IN REG 1.                  * @Z40X9DG 44067009
*                                                            * @Z40X9DG 44068009
************************************************************** @Z40X9DG 44069009
         SPACE 1                                               @Z40X9DG 44070009
         GETMAIN RU,LV=(0),SP=SQA,KEY=SRBKEY,BRANCH=YES        @Z40X9DG 44071009
         EJECT                                                 @Z40X9DG 44072009
************************************************************** @Z40X9DG 44073009
*                                                            * @Z40X9DG 44074009
*        INITIALIZE THE SRB'S AND CHAIN THEM OFF THE TCX.    * @Z40X9DG 44075009
*                                                            * @Z40X9DG 44076009
************************************************************** @Z40X9DG 44077009
         LR    RASCB,RPEB               RESTORE ASCB ADDRESS   @Z40X9DG 44078009
         LR    RPEB,RPARM               POINT TO SRB BLOCK     @Z40X9DG 44079009
         LA    RCVT,SRBBLKSZ            GET SIZE OF BLOCK AND  @Z40X9DG 44080009
*                                       SET PAD CHARACTER      @Z40X9DG 44081009
         SLR   RENTRY,RENTRY            CLEAR TO INDICATE NO   @Z40X9DG 44082009
*                                       BYTES MOVED FROM       @Z40X9DG 44083009
*                                       'FROM' FIELD           @Z40X9DG 44084009
         MVCL  RPEB,RETURN              CLEAR GETMAIN AREA     @Z40X9DG 44085009
*                                       ('RETURN' IS NOT USED) @Z40X9DG 44086009
         SPACE 1                                               @Z40X9DG 44087009
         LA    RZERO,SRBPOST            SRBEP ADDRESS          @Z40X9DG 44088009
         LA    RENTRY,SRBCLEAN          SRB CLEANUP ADDR       @Z40X9DG 44089009
         LA    RPEB,NUMSRBS             GET NUMBER OF SRB'S    @Z40X9DG 44090009
*                                       TO INITIALIZE          @Z40X9DG 44091009
         LR    RCOMPC,RPARM             SAVE POINTER TO 1ST    @Z40X9DG 44092009
*                                       SRB PREFIX             @Z40X9DG 44093009
         USING SRBSECT,RPARM            SRB ADDRESSABILITY     @Z40X9DG 44094009
INITSRB  EQU   *                                               @Z40X9DG 44095009
         LA    RCVT,PSRBSIZE+SRBSIZE(,RPARM) PTR TO NEXT SRB   @Z40X9DG 44096009
         ST    RCVT,PSRBLINK-ONE-PSRBSECT(,RPARM) SET LINK...  @Z40X9DG 44097009
*                                       ... AND TS FLAG        @Z40X9DG 44098009
         MVC   SRBID+PSRBSIZE,IDSRB     SET SRB ID             @Z40X9DG 44099009
         ST    RZERO,SRBEP+PSRBSIZE     SET ENTRY POINT FOR    @Z40X9DG 44100009
*                                       POST CODE UNDER SRB    @Z40X9DG 44101009
         ST    RENTRY,SRBRMTR+PSRBSIZE  SET CLEANUP ADDR       @Z40X9DG 44102009
         LR    RPARM,RCVT               POINT TO NEXT SRB      @Z40X9DG 44103009
         BCT   RPEB,INITSRB             IF ANOTHER SRB, THEN   @Z40X9DG 44104009
*                                       GO INIT IT             @Z40X9DG 44105009
         SH    RPARM,SIZE               BACK UP TO LAST SRB    @Z40X9DG 44106009
         L     RZERO,TCXSRBS            GET POINTER TO 1ST     @Z40X9DG 44107009
*                                       SRB ON CHAIN           @Z40X9DG 44108009
SRBLOOP  EQU   *                                               @Z40X9DG 44109009
         STCM  RZERO,ADD,PSRBLINK-PSRBSECT(RPARM) POINT LAST   @Z40X9DG 44110009
*                                       SRB IN NEW BLOCK TO    @Z40X9DG 44111009
*                                       CURRENT TOP SRB ON TCX @Z40X9DG 44112009
         CS    RZERO,RCOMPC,TCXSRBS     CHAIN NEW SRB'S ON TCX @Z40X9DG 44113009
         BNE   SRBLOOP                  IF CHAIN WAS UPDATED   @Z40X9DG 44114009
*                                       ASYNCHRONOUSLY, THEN   @Z40X9DG 44115009
*                                       TRY AGAIN              @Z40X9DG 44116009
         BR    RDEB                     RETURN TO CALLER       @Z40X9DG 44117009
         DROP  RPARM                                           @Z40X9DG 44118009
         TITLE '''IGC102-AQCTL SVC'''                                   44200006
RETURN90 LA    RENTRY,NINETY            INVALID FUNCTION CODE    Y02027 44220006
EXIT     EQU   *                                                 Y02027 44240006
         L     RETURN,REG15(RSVRB)      RESTORE RETURN REGISTER  Y02027 44260006
         RETURN                                                         44280006
ABEND    EQU   *                                                 Y02027 44300006
         L     RPARM,ABEND047           ABEND 047 PROG NOT AUTHA Y02027 44320006
         ABEND (1)                      ABEND                  @Z40X9DG 44330009
         TITLE '''PURGE DISK I/O'''                                     44340009
************************************************************** @Z40X9DG 44344009
*                                                            * @Z40X9DG 44348009
*        THIS ENTRY POINT IS CALLED BY IOS WHEN A PURGE      * @Z40X9DG 44352009
*        HAS BEEN ISSUED. THIS IS NOT PART OF SVC 102.       * @Z40X9DG 44356009
*                                                            * @Z40X9DG 44360009
*        REGISTERS AT ENTRY:                                 * @Z40X9DG 44364009
*              REGISTER 1  - ADDRESS OF IOS PURGE INTERFACE  * @Z40X9DG 44368009
*                             BLOCK (IPIB)                   * @Z40X9DG 44372009
*              REGISTER 13 - ADDRESS OF 13-WORD SAVE AREA    * @Z40X9DG 44376009
*              REGISTER 14 - RETURN ADDRESS                  * @Z40X9DG 44380009
*              REGISTER 15 - ENTRY POINT                     * @Z40X9DG 44384009
*                                                            * @Z40X9DG 44388009
*        THE FUNCTION OF THIS ENTRY POINT IS TO RECOGNIZE    * @Z40X9DG 44392009
*        THAT AN IPIB IS FOR A HALT FOR TCAM AND THEN TO     * @Z40X9DG 44396009
*        DECHAIN THE SRB'S FROM THE IPIB.                    * @Z40X9DG 44400009
*                                                            * @Z40X9DG 44404009
*        THIS ENTRY POINT IS ADDRESSED BY THE VOID WHICH     * @Z40X9DG 44408009
*        IS INITIALIZED BY MESSAGE QUEUES OPEN AND RESET BY  * @Z40X9DG 44412009
*        IEDQOT01.                                           * @Z40X9DG 44416009
*                                                            * @Z40X9DG 44420009
************************************************************** @Z40X9DG 44424009
         USING *,RENTRY                 SET ROUTINE BASE       @Z40X9DG 44428009
         USING IPIB,RPARM               IPIB ADDRESSABILITY    @Z40X9DG 44432009
PURGE    EQU   *                                               @Z40X9DG 44436009
         TM    IPIBOPT,IPIBHALT         IS REQUEST FOR HALT    @Z40X9DG 44440009
         BZR   RETURN                   NO, RETURN TO CALLER   @Z40X9DG 44444009
         SPACE 1                                               @Z40X9DG 44448009
         STM   RZERO,RSVRB,ZERO(RTEMP)  SAVE REGS 0-5          @Z40X9DG 44452009
         SLR   RZERO,RZERO              CLEAR REGISTER         @Z40X9DG 44456009
         L     RSVRB,IPIBSRB            GET PTR TO CHAIN OF    @Z40X9DG 44460009
*                                       SRB'S                  @Z40X9DG 44464009
CLRIPIB  EQU   *                                               @Z40X9DG 44468009
         CS    RSVRB,RZERO,IPIBSRB      CLEAR IPIBSRB IF       @Z40X9DG 44472009
*                                       NOT UPDATED            @Z40X9DG 44476009
         BNE   CLRIPIB                  IF UPDATED, TRY AGAIN  @Z40X9DG 44480009
         LM    RZERO,RSVRB,ZERO(RTEMP)  RESTORE REGS 0-5       @Z40X9DG 44484009
         BR    RETURN                   RETURN TO CALLER       @Z40X9DG 44488009
         DROP  RENTRY                                          @Z40X9DG 44492009
         TITLE 'POST ECB UNDER SRB'                                     44500009
************************************************************** @Z40X9DG 44501009
*                                                            * @Z40X9DG 44502009
*        THIS ENTRY POINT IS ENTERED UNDER SRB SCHEDULED     * @Z40X9DG 44503009
*        BY THE SCHSRB CODE IN SVC 102. THIS IS NOT A PART   * @Z40X9DG 44504009
*        OF SVC 102. THE CODE IS ENTERED IN SUPERVISOR       * @Z40X9DG 44505009
*        STATE, ENABLED, NO LOCKS HELD, KEY 0. THE CODE      * @Z40X9DG 44506009
*        MUST RETURN TO ADDRESS IN R14 IN SUPERVISOR STATE   * @Z40X9DG 44507009
*        WITH NO LOCKS HELD.                                 * @Z40X9DG 44508009
*                                                            * @Z40X9DG 44509009
*        INPUT:                                              * @Z40X9DG 44510009
*              REGISTER 0  - ADDRESS OF SRB                  * @Z40X9DG 44511009
*              REGISTER 1  - CONTENTS OF SRBPARM             * @Z40X9DG 44512009
*              REGISTER 14 - RETURN ADDRESS                  * @Z40X9DG 44513009
*              REGISTER 15 - ENTRY POINT ADDRESS             * @Z40X9DG 44514009
*                                                            * @Z40X9DG 44515009
*        SRBPARM CONTAINS ECB ADDRESS TO POST. THE HIGH      * @Z40X9DG 44516009
*        ORDER BYTE OF SRBPARM CONTAINS THE COMPLETION CODE. * @Z40X9DG 44517009
*                                                            * @Z40X9DG 44518009
*        THIS CODE WILL USE THE BRANCH ENTRY POINT OF POST   * @Z40X9DG 44519009
*        TO POST AN ECB ADDRESSED BY SRBPARM. IT WILL        * @Z40X9DG 44520009
*        MARK ITS SRB AVAILABLE.                             * @Z40X9DG 44521009
*                                                            * @Z40X9DG 44522009
************************************************************** @Z40X9DG 44523009
         USING *,RBASE                  ADDRESSABILITY         @Z40X9DG 44524009
         USING SRBSECT,RTCX             SRB ADDRESSABILITY     @Z40X9DG 44525009
SRBPOST  EQU   *                                               @Z40X9DG 44526009
         LR    RBASE,RENTRY             SET BASE               @Z40X9DG 44527009
         LR    RTCX,RZERO               SAVE SRB ADDRESS       @Z40X9DG 44528009
         LR    RDEB,RETURN              SAVE RETURN ADDR       @Z40X9DG 44529009
         SPACE 2                                               @Z40X9DG 44530009
************************************************************** @Z40X9DG 44531009
*                                                            * @Z40X9DG 44532009
*        GET LOCAL LOCK REQUIRED FOR BRANCH ENTRY TO POST    * @Z40X9DG 44533009
*                                                            * @Z40X9DG 44534009
************************************************************** @Z40X9DG 44535009
GETLOCK  EQU   *                                               @Z40X9DG 44536009
         SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                        X44537009
               RELATED=(RELLOCK)        GET LOCAL LOCK         @Z40X9DG 44538009
         EJECT                                                 @Z40X9DG 44539009
************************************************************** @Z40X9DG 44540009
*                                                            * @Z40X9DG 44541009
*        USE 'QUICK POST' TECHNIQUE TO POST ECB              * @Z40X9DG 44542009
*                                                            * @Z40X9DG 44543009
************************************************************** @Z40X9DG 44544009
         L     RCECB,ZERO(,RPARM)       GET CONTENTS OF ECB    @Z40X9DG 44545009
         L     RCOMPC,POSTBIT           SET POST BIT           @VS41494 44546009
         IC    RCOMPC,SRBPARM           GET COMPLETION CODE    @VS41494 44547009
         TM    ZERO(RPARM),WAITBIT      WAIT BIT ON ?          @Z40X9DG 44549009
         BO    CALLPOST                 YES, BRANCH            @Z40X9DG 44550009
         CS    RCECB,RCOMPC,ZERO(RPARM) COMPARE AND SWAP       @Z40X9DG 44551009
*                                       COMPLETION BIT AND CODE@Z40X9DG 44552009
         BZ    RELLOCK                  BRANCH IF CS SUCCESSFUL@Z40X9DG 44553009
         SPACE 1                                               @Z40X9DG 44554009
************************************************************** @Z40X9DG 44555009
*                                                            * @Z40X9DG 44556009
*        BRANCH ENTER TO POST:                               * @Z40X9DG 44557009
*              REGISTER 10 - COMPLETION CODE                 * @Z40X9DG 44558009
*              REGISTER 11 - ECB ADDRESS                     * @Z40X9DG 44559009
*              REGISTER 14 - RETURN ADDRESS                  * @Z40X9DG 44560009
*              REGISTER 15 - ENTRY POINT                     * @Z40X9DG 44561009
*        REGS 0-9 ARE PRESERVED BY POST                      * @Z40X9DG 44562009
*                                                            * @Z40X9DG 44563009
************************************************************** @Z40X9DG 44564009
CALLPOST EQU   *                                               @Z40X9DG 44565009
         LA    RCOMPC,ZERO(,RCOMPC)     CLEAR POST BIT FROM    @VS41494 44566009
*                                       COMPLETION CODE        @VS41494 44567009
         LA    RCECB,ZERO(,RPARM)       SET ECB ADDRESS        @Z40X9DG 44568009
         L     RCVT,CVTPTR              GET CVT ADDRESS        @Z40X9DG 44569009
         L     RENTRY,CVT0PT01-CVT(,RCVT) GET BRANCH ENTRY ADDR@Z40X9DG 44570009
         BALR  RETURN,RENTRY            POST ECB               @Z40X9DG 44571009
         SPACE 1                                               @Z40X9DG 44572009
************************************************************** @Z40X9DG 44573009
*                                                            * @Z40X9DG 44574009
*        RELEASE THE LOCAL LOCK AND RETURN TO CALLER         * @Z40X9DG 44575009
*                                                            * @Z40X9DG 44576009
************************************************************** @Z40X9DG 44577009
RELLOCK  EQU   *                                               @Z40X9DG 44578009
         SETLOCK RELEASE,TYPE=LOCAL,RELATED=(GETLOCK)          @Z40X9DG 44579009
         SPACE 1                                               @Z40X9DG 44580009
         USING PSRBSECT,RTCX            SRB PREFIX ADDR        @Z40X9DG 44581009
         SH    RTCX,PRESIZE             BACK UP TO SRB PREFIX  @Z40X9DG 44582009
         MVI   PSRBTSFL,ZERO            MARK SRB AVAILABLE     @Z40X9DG 44583009
         LR    RETURN,RDEB              RESTORE RETURN ADDR    @Z40X9DG 44584009
         BR    RETURN                   RETURN TO CALLER       @Z40X9DG 44585009
         DROP  RTCX,RBASE                                      @Z40X9DG 44586009
         TITLE 'SRB RESOURCE MANAGER'                                   44620009
************************************************************** @Z40X9DG 44621009
*                                                            * @Z40X9DG 44622009
*        THIS ROUTINE GETS CONTROL WHEN A PURGEDQ IS         * @Z40X9DG 44623009
*        ISSUED. ITS FUNCTION IS TO CLEANUP A DEQUEUED       * @Z40X9DG 44624009
*        SRB. THE ONLY SRB'S THAT IT PROCESSES ARE           * @Z40X9DG 44625009
*        THOSE WHOSE SRBEP FIELD EQUALS THE ADDRESS OF       * @Z40X9DG 44626009
*        SRBCLEAN. THE CLEANUP FUNCTION CONSISTS OF          * @Z40X9DG 44627009
*        MARKING THE SRB AVAILABLE. IEDQOT01 WILL FREE       * @Z40X9DG 44628009
*        THE SRB.                                            * @Z40X9DG 44629009
*                                                            * @Z40X9DG 44630009
*        INPUT:                                              * @Z40X9DG 44631009
*              REGISTER 0  - CONTENTS OF REGISTER 0 OF       * @Z40X9DG 44632009
*                            CALLER OF PURGEDQ               * @Z40X9DG 44633009
*              REGISTER 1  - SRB ADDRESS                     * @Z40X9DG 44634009
*              REGISTER 2  - CONTENTS OF SRBPARM             * @Z40X9DG 44635009
*              REGISTER 14 - RETURN ADDRESS                  * @Z40X9DG 44636009
*              REGISTER 15 - ENTRY POINT ADDRESS             * @Z40X9DG 44637009
*                                                            * @Z40X9DG 44638009
*        THIS CODE IS NOT PART OF SVC 102. IT RECEIVES       * @Z40X9DG 44639009
*        CONTROL IN SUPERVISOR STATE,KEY 0, NO LOCKS HELD.   * @Z40X9DG 44640009
*                                                            * @Z40X9DG 44641009
************************************************************** @Z40X9DG 44642009
SRBCLEAN EQU   *                                               @Z40X9DG 44643009
         USING *,RENTRY                 CODE ADDRESSABILITY    @Z40X9DG 44644009
         USING PSRBSECT,RPARM           SRB PREFIX ADDRESS     @Z40X9DG 44645009
         SH    RPARM,PRESIZE            BACK UP TO PREFIX      @Z40X9DG 44646009
*                                       OF SRB                 @Z40X9DG 44647009
         MVI   PSRBTSFL,ZERO            MARK SRB AVAILABLE     @Z40X9DG 44648009
         BR    RETURN                   RETURN TO CALLER       @Z40X9DG 44649009
         DROP  RPARM,RENTRY                                    @Z40X9DG 44650009
         TITLE 'IGC102 - AQCTL SVC'                                     45140009
************************************************************** @Z40X9DG 45143009
*                                                            * @Z40X9DG 45146009
*        DATA DEFINITIONS                                    * @Z40X9DG 45149009
*                                                            * @Z40X9DG 45152009
************************************************************** @Z40X9DG 45155009
         DS    0F                       ALIGNMENT                Y02027 45160009
CLRLOW   DC    X'FFFFF000'              USED TO CLEAR LO 3 BYTES Y02027 45163009
ABEND047 DC    X'80047000'              047 ABEND PROG NOT AUTHA Y02027 45166009
         DS    0F                       ALIGN 'XR' AND 'NR'      Y02027 45170009
NR       DC    4X'BF'                   NON BLANK MASK           Y02027 45171009
XR       DC    4X'0F'                   BIT FLIPPER              Y02027 45172009
MAX      DC    F'255'                   MASK FOR BYTE COUNT MASK Y02027 45173009
ZEROES   DC    F'0'                     COMPARISON VALUE         Y02027 45174009
BLANKS   DC    CL8' '                   MASK = PASSWORD NOT REQ'DY02027 45175009
MAXIM    DC    H'256'                   MAX VALUE FOR SUBTRACTIONY02027 45176009
HEX80    DC    X'80'                    HIGH ORDER BIT ON        Y02027 45177009
         DS    0F                                              @Z40X9DG 45180009
POSTBIT  DC    X'40000000'              POST BIT FOR C/S       @Z40X9DG 45181009
SIZE     DC    AL2(PSRBSIZE+SRBSIZE)    SIZE OF PREFIX +       @Z40X9DG 45182009
*                                       SIZE OF SRB            @Z40X9DG 45183009
PRESIZE  DC    AL2(PSRBSIZE)            SIZE OF SRB PREFIX     @Z40X9DG 45184009
IDSRB    DC    CL4'SRB'                 SRB ID                 @Z40X9DG 45185009
FOURK    DC    H'4096'                  LENGTH OF A PAGE       @OZ17630 45185591
         SPACE 2                                               @Z40X9DG 45186009
PAD      DC    25H'0'                   PATCH AREA             @Z40X9DG 45187009
         EJECT                                                 @Z40X9DG 45188009
************************************************************** @Z40X9DG 45189009
*                                                            * @Z40X9DG 45190009
*        OFFSETS IN THE SVRB ADDRESSED BY REGISTER 5 AT      * @Z40X9DG 45191009
*        ENTRY TO IEDQEB VIA SVC 102.                        * @Z40X9DG 45192009
*                                                            * @Z40X9DG 45193009
************************************************************** @Z40X9DG 45194009
REG0     EQU   32                       REGISTER 0 IN SAVE AREA  Y02027 45200006
REG1     EQU   36                       REGISTER 1 IN SAVE AREA  Y02027 45220006
REG2     EQU   40                       REGISTER 2 IN SAVE AREA  Y02027 45240006
REG3     EQU   44                       REGISTER 3 IN SAVE AREA  Y02027 45260006
REG5     EQU   52                       REGISTER 5 IN SAVE AREA  Y02027 45280006
REG6     EQU   56                       REGISTER 6 IN SAVE AREA  Y02027 45300006
REG9     EQU   68                       REG 9 IN SAVE AREA       Y02027 45320006
REG10    EQU   72                       REGISTER 10 IN SAVE AREA Y02027 45340006
REG11    EQU   76                       REGISTER 11 IN SAVE AREA Y02027 45360006
REG15    EQU   92                       REGISTER 15 IN SAVE AREA Y02027 45380006
EXTSA    EQU   96                       OFFSET IN SVRB TO 12   @Z40X9DG 45400009
*                                       WORD EXTENDED SAVE AREA@Z40X9DG 45402009
         EJECT                                                 @Z40X9DG 45404009
************************************************************** @Z40X9DG 45406009
*                                                            * @Z40X9DG 45408009
*        EQUATES                                             * @Z40X9DG 45410009
*                                                            * @Z40X9DG 45412009
************************************************************** @Z40X9DG 45414009
ZERO     EQU   0                        ZERO DISPLACEMENT        Y02027 45420006
ONE      EQU   1                        LENGTH OF ONE            Y02027 45440006
TWO      EQU   2                        MASK OF 0010             Y02027 45460006
THREE    EQU   3                        MASK OF 0011             Y02027 45480006
FOUR     EQU   4                        MASK OF 0100             Y02027 45500006
FIVE     EQU   5                        DISPLACEMENT OF 5        Y02027 45520006
SEVEN    EQU   7                        MASK OF 0111             Y02027 45540006
NINE     EQU   9                        DISPLACEMENT             Y02027 45560006
TEN      EQU   10                     DISPLACEMENT             @OZ08344 45570091
EIGHT    EQU   8                        MASK OF 1000             Y02027 45580006
TWELVE   EQU   12                       MASK OF 1100             Y02027 45600006
ALL      EQU   15                       MASK OF 1111             Y02027 45620006
ADD      EQU   7                        ADDRESS MASK             Y02027 45640006
AIBSZERR EQU   X'18'                    RC = DATA EXCEEDS AIB    Y02027 45660006
BADTRM   EQU   X'20'                    INVALID TERM NAME ERR CD Y02027 45680006
BSC      EQU   X'80'                    INVLIST FLAG = BYSYNCH   Y02027 45690006
BY0      EQU   8                        BYTE 0 MASK              Y02027 45700006
BY1      EQU   4                        BYTE 1 MASK              Y02027 45720006
BY2      EQU   2                        BYTE 2 MASK              Y02027 45740006
BY3      EQU   1                        BYTE 3 MASK              Y02027 45760006
CHKPASWD EQU   X'20'                    MASK FOR VERBS ALLOWING  Y02027 45780006
*                                       PASSWORD SPECIFICATION   Y02027 45800006
CCEQ     EQU   8                        MASK FOR CC EQUAL        Y02027 45820006
CHKPT    EQU   X'01'                    FLAG= CHECKPOINT ACTIVE  Y02027 45840006
CLROFF   EQU   4                        OFFSET AND LENGTH FOR    Y02027 45860006
CLRLEN   EQU   68                       CLEARING AIB PREFIX      Y0202M 45880006
ID       EQU   X'C0'                    TCAM DEB IDENTIFIER      Y02027 45900006
SIOA     EQU   4                        OFFSET TO SIO APPENDAGE@Z40X9DG 45920009
*                                       ADDR IN THE DEB        @Z40X9DG 45930009
INVPASS  EQU   X'14'                    INVALID PASSWORD ERR CODEY02027 45940006
MAXI     EQU   256                      MAX BYTE COUNT FOR 1 MVC Y02027 45960006
NOPENDCB EQU   12                       ERROR CODE FOR NO OPEN   Y02027 45980006
*                                       TCAM DCB                 Y02027 46000006
NOTTCHNG EQU   X'DF'                    MASK  FOR TCHNG FUNCTION Y02027 46020006
OFF16    EQU   16                       OFFSET                   Y02027 46040006
SIX      EQU   6                        OFFSET                   Y02027 46060006
TCHKPT   EQU   X'10'                    TCHNG CHKPOINT REQ CODE  Y02027 46080006
HPAGE    EQU   2048                     HALF PAGE SIZE           Y02027 46080609
EPAGE    EQU   512                      EIGHTH OF PAGE           Y02027 46081209
KEY6     EQU   6                        KEY 6                    Y02027 46081809
CSA      EQU   231                      COMMON STORAGE AREA      Y02027 46082409
RBOPSW   EQU   16                       OLD PSW IN SVRB          Y02027 46083009
PUTPRI    EQU  X'D5'                    PUT  PRIORITY          @ZA02086 46083609
GETPRI   EQU   X'D4'                    GET PRIORITY             Y02027 46084209
PTPRI    EQU   X'50'                    POINT PRIORITY           Y02027 46084809
PRIRTBFR EQU   X'D4'                    RETRIEVE REQUEST PRIORITYY02027 46085409
CRECHNGT EQU   X'10'                    KEY FOR TCHNG            Y02027 46086009
MCPCKPT  EQU   X'01'                    CHECK POINT ACTIVE IN MCPY02027 46086609
CRECKREQ EQU   X'60'                    KEY FOR CKREQ            Y02027 46087209
QSAMFLG  EQU   X'40'                    QSAM DCBMACRF FLAG       Y02027 46087809
BLANK    EQU   X'40'                    RETRIEVE TERMINATION     Y02027 46088409
EQUAL    EQU   8                        EQUAL CONDITION          Y02027 46089009
X7F      EQU   X'7F'                    CLEAR HIGH ORDER BIT     Y02027 46089609
NORMAL   EQU   X'7F'                    NORMAL COMPLETION CODE   Y02027 46090209
XFF      EQU   X'FF'                    USED TO TURN OFF FLAG    Y02027 46090809
EIGHTY   EQU   X'80'                    RETURN CODE              Y02027 46091409
NINETY   EQU   X'90'                    RETURN CODE              Y02027 46092009
SEQERR   EQU   X'58'                    COMPL. CODE FOR SEQ.ERRORY02027 46092609
SOWAERR  EQU   X'10'                    BAD SOWA RETURN CODE     Y02027 46093209
STOPQRC  EQU   20                       DISABLED QUEUE R.C.      Y02027 46093809
INVSEQ   EQU   4                        INVALID SEQUENCE NUMBER  Y02027 46094409
INVTERM  EQU   8                        INVALID TERM GIVEN       Y02027 46095009
RETERR   EQU   X'0C'                    RETRIEVE RETURN CODE     Y02027 46095609
RETCC    EQU   X'50'                    RETRIEVE CONDITION CODE  Y02027 46096209
QRERR    EQU   X'10'                    QRESET ERROR             Y02027 46096809
QNBNOCKR EQU   4                        RETURN CODE              Y02027 46097409
SYNADERR EQU   8                        SYNAD RETURN CODE        Y02027 46098009
SOWACC   EQU   X'52'                    SOWA ERROR COMPLETION C. Y02027 46098609
MSGRAQCB EQU   X'40'                    MSG ON RA QUEUE          Y02027 46099209
USEASCB  EQU   X'80'                    FLAG BIT FOR OP CONTROL  Y02027 46100006
XF0      EQU   X'F0'                    MASK FOR TESTING FOR     Y02027 46105006
*                                       MCOUNT OR TPDATE                46110006
MAXCODE  DC    X'34'                    MAX FUNCTION CODE      @OZ26648 46115082
WAITBIT  EQU   X'80'                    ECB WAIT BIT           @Z40X9DG 46116009
SQA      EQU   245                      SQA SUBPOOL            @Z40X9DG 46117009
SRBKEY   EQU   0                        STORAGE KEY FOR SRB'S  @Z40X9DG 46118009
         EJECT                                                 @Z40X9DG 46119009
**************************************************************** Y02027 46120006
*              MAP OF INPUT DATA PROVIDED TO SVC 102           * Y02027 46140006
**************************************************************** Y02027 46160006
APCIBMAP DSECT                                                   Y02027 46170006
         DS    0F                       FORCE ALIGNMENT          Y02027 46180006
APPASWD  DC    AL4(0)                   POINTER TO PASSWORD      Y02027 46220006
APECB    DC    F'0'                     ECB FOR WAIT IN SVC 102  Y02027 46240006
*                                       AND SUBSEQUENT XMPOST    Y02027 46260006
APPCBAD  DC    AL4(0)                   PCB POINTER              Y02027 46280006
APPCOMCD DS    XL(1)                    FUNCTION CODE BYTE       Y02027 46300006
APUSWKA  DC    AL3(0)                   PTR TO USER WORK AREA    Y02027 46320006
APNAME   DC    AL4(0)                   PTR TO TERMINAL NAME     Y02027 46340006
APPARM   DS    0F                       PARAMETER FOR SVC 102    Y02027 46360006
         DC    X'84'                    EOL X'80' + FUNCTION     Y02027 46380006
*                                       CODE X'04'               Y02027 46400006
         DC    AL3(APCIBMAP)            PTR TO INPUT DATA        Y02027 46401000
         SPACE 4                                               @G36XRDV 46402000
***************************************************************@G36XRDV 46403000
*                                                              @G36XRDV 46404000
*        PARM LIST FOR 3705 STARTIO                            @G36XRDV 46405000
*                                                              @G36XRDV 46406000
***************************************************************@G36XRDV 46407000
         SPACE 1                                               @G36XRDV 46408000
PLSIO    DSECT                     PARM LIST FOR 3705 STARTIO  @G36XRDB 46409000
PLCODE   DS    XL1                 STARTIO ENTRY CODE          @G36XRDB 46410000
PLIOSB   DS    AL3                 IOSB ADDRESS                @G36XRDB 46411000
PLSTART  DS    A                   VIRTUAL ADDRESS OF START    @G36XRDB 46412000
*                                  OF CHANNEL PROGRAM          @G36XRDB 46413000
         EJECT                                                 @Z40X9DG 46420209
*        PARAMETER LIST FOR SCHEDULE SRB FUNCTION OF SVC 102 * @Z40X9DG 46420409
         SPACE 1                                               @Z40X9DG 46420609
SSRBSECT DSECT                                                 @Z40X9DG 46420809
SSRBENTC DS    XL1                      ENTRY CODE             @Z40X9DG 46421009
SSRBCODE EQU   X'2C'                    ENTRY CODE = '2C'      @Z40X9DG 46421209
SSRBECBA DS    AL3                      ADDRESS OF ECB         @Z40X9DG 46421409
SSRBASCB DS    A                        ADDRESS OF ASCB        @Z40X9DG 46421609
SSRBCC   DS    XL1                      COMPLETION CODE        @Z40X9DG 46421809
         DS    XL1                      UNUSED                 @Z40X9DG 46422009
SSRBASID DS    H                        ASID                   @Z40X9DG 46422209
SSRBTCB  DS    A                        TCB ADDRESS            @Z40X9DG 46422409
         SPACE 4                                               @Z40X9DG 46422609
*********************************************************************** 46422809
*                *                                                    * 46423009
*    SSRBENTC    *                      SSRBECBA                      * 46423209
*                *                                                    * 46423409
*********************************************************************** 46423609
*                                                                     * 46423809
*                              SSRBASCB                               * 46424009
*                                                                     * 46424209
*********************************************************************** 46424409
*                *                 *                                  * 46424609
*    SSRBCC      *                 *             SSRBASID             * 46424809
*                *                 *                                  * 46425009
*********************************************************************** 46425209
*                                                                     * 46425409
*                              SSRBTCB                                * 46425609
*                                                                     * 46425809
*********************************************************************** 46426009
         EJECT                                                 @Z40X9DG 46426209
*        IOSB DSECT                                            @Z40X9DG 46426409
         SPACE 2                                               @Z40X9DG 46426609
         IECDIOSB                                              @Z40X9DG 46426809
         EJECT                                                 @Z40X9DG 46427009
*        SRB DSECT                                             @Z40X9DG 46427209
         SPACE 2                                               @Z40X9DG 46427409
         IHASRB                                                @Z40X9DG 46427609
         EJECT                                                 @Z40X9DG 46427809
*        DSECT FOR FOUR-BYTE PREFIX TO SRB                     @Z40X9DG 46428009
         SPACE 1                                               @Z40X9DG 46428209
PSRBSECT DSECT                                                 @Z40X9DG 46428409
PSRBTSFL DS    XL1                      TEST AND SET FLAG      @Z40X9DG 46428609
PSRBLINK DS    AL3                      LINK TO NEXT SRB       @Z40X9DG 46428809
PSRBSRB  EQU   *                        START OF SRB           @Z40X9DG 46429009
PSRBSIZE EQU   *-PSRBSECT               SIZE OF PREFIX         @Z40X9DG 46429209
         SPACE 4                                                        46429409
NUMSRBS  EQU   8                        NUMBER OF SRB'S WITH   @Z40X9DG 46429609
*                                       PREFIX IN ONE BLOCK    @Z40X9DG 46429809
SRBBLKSZ EQU   NUMSRBS*(SRBSIZE+PSRBSIZE) SIZE OF SRB BLOCK    @Z40X9DG 46430009
         EJECT                                                 @Z40X9DG 46430209
*        IOSB EXTENSION                                        @Z40X9DG 46430409
         SPACE 1                                               @Z40X9DG 46430609
IOSBE    DSECT                                                 @Z40X9DG 46430809
IOSBEENT DS    XL1                      ENTRY FLAG             @Z40X9DG 46431009
IOSBESIO EQU   X'28'                    ENTRY FOR START I/O    @Z40X9DG 46431209
IOSBEIOS DS    AL3                      ADDRESS OF IOSB        @Z40X9DG 46431409
IOSBEFLG DS    XL1                      FLAG BYTE              @Z40X9DG 46431609
IOSBEEOL EQU   X'80'                    END OF PARM LIST       @Z40X9DG 46431809
IOSBERDY EQU   X'40'                    IOSBE READY FOR        @Z40X9DG 46432009
*                                       NEW I/O OPERATION      @Z40X9DG 46432209
IOSBEBUS EQU   X'FF'-IOSBERDY           IOSBE BUSY - CANNOT    @Z40X9DG 46432409
*                                       ACCEPT NEW I/O         @Z40X9DG 46432609
IOSBECPR EQU   X'20'                    CCW'S ARE REAL         @Z40X9DG 46432809
IOSBECPV EQU   X'FF'-IOSBECPR           CCW'S ARE VIRTUAL      @Z40X9DG 46433009
IOSBENRQ EQU   X'10'                    QUEUE TYPE             @Z40X9DG 46433209
*                                         1 = NON-REUS QUEUES  @Z40X9DG 46433409
*                                         0 = REUS QUEUES      @Z40X9DG 46433609
IOSBECPB DS    AL3                      ADDRESS OF CPB         @Z40X9DG 46433809
IOSBEXCC DS    H                        ARM POSITION           @Z40X9DG 46434009
IOSBERET DS    XL3                      RETRY QUEUE            @Z40X9DG 46434209
IOSBENEW DS    AL3                      NEW QUEUE OF CPB'S     @Z40X9DG 46434409
IOSBELEN EQU   *-IOSBE                  LENGTH OF IOSBE        @Z40X9DG 46434609
         EJECT                                                 @Z40X9DG 46434809
*        DSECT NEEDED BY STARTIO MACRO                         @Z40X9DG 46435009
         SPACE 1                                               @Z40X9DG 46435209
         IECDIOCM                                              @Z40X9DG 46435409
         EJECT                                                 @Z40X9DG 46435609
         IECDIPIB                                              @Z40X9DG 46435809
         EJECT                                                 @Z40X9DG 46436009
         IHAWSAVT CLASS=LOCAL,DSECT=YES                                 46440006
         IHAPSA                                                         46460006
         IHAASXB                                                        46480006
         IHAASCB                                                        46500006
         SPACE 1                                                        46520006
         TTCXD                                                   Y02027 46540006
         EJECT                                                          46560006
         TPEBD                                                          46580006
         TPEWAD                                                         46600006
         TPECBD                                                         46620006
CVTMAP   CVT   DSECT=YES                                                46640006
         TPRIOR                                                  Y02027 46660006
         DCBD  DSORG=PS                                                 46680006
DCBPECB  EQU   DCBIOBAD                 USED BY TCAM             Y02027 46700006
         IECTDECB                                                       46720006
         EJECT                                                          50300020
*                                                                     * 50400020
*                 D S E C T S                                         * 50500020
*                                                                     * 50600020
         SPACE 2                                                        50700020
         TAVTD                                                          50800020
         TTCBD                                                          50900020
         TDEBAPD                                                        51000020
         TRECBD                                                         51100020
         SPACE 1                                                        51130006
         TAIBD EXT=(QRESET,POINT,CKREQ,GETREAD,NETWKCTL,PUTWRITE)       51160006
         SPACE 1                                                        51200006
         TTRMD                                                   Y02027 51250006
         END                                                            51300020
