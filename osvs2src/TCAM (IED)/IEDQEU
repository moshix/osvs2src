EU01     TITLE '''IEDQEU'' - TCAM OPEN/CLOSE SUBTASK'                   00050008
IEDQEU   CSECT                                                          00100008
*A-000000-999999                                               @X31X8N0 00150008
         SPACE 3                                                        00200008
******************** MICROFICHE FLAGS *********************** SUPT CODE 00200405
*A022600-023200,061000,148100-148500,188200-189400,344200-345600,Y01004 00200505
*A415000,474200-475600,548020-548040,578060-578540,586867-586881,Y01004 00200605
*A614040-614320,641000,662450,665000,667000,800600-800700,       Y01004 00200705
*A821802-821948,834000,875703-875754                             Y01004 00200805
*C072000,226000,306000,414000,436000,522000,548000,578000,586840,Y01004 00200905
*C630000,640000,662400,662800-662900,663200,664000,666000,744000,Y01004 00201005
*C748000,800500                                                  Y01004 00201105
*D228000-300000,308000,330000,438000,586845,587800,624000-626000,Y01004 00201205
*D630600-638000,642000-656000,662200,663000,668000,752000,       Y01004 00201305
*D764000-776000,854000-856000                                    Y01004 00201405
*C567000                                                         X02004 00201505
*A413000,865000                                                  X03039 00202508
*C012080,026000-028000,701600,786200-786300                      X03039 00203508
*D320000-328000,398200-399800,573001-573010,587233,614080-614200,X03039 00204508
*D786000-786100,786480-786880,844000-846000,875500-875600,875742,X03039 00205508
*D883500,888000,911500                                           X03039 00206508
*C012080                                                       @Z30X8NM 00207508
*C586785,586840-586860                                           Y05330 00211505
*D586786,586867-586874,586881,800500-800700                      Y05330 00221505
*C022000-037000,044000,060000,061000,064000,070000,072000,088000 Y02027 00221806
*C120000,178000,304000,340000,344200-345600,369500,370000,374000 Y02027 00222106
*C400000,402000,404000,408000,414000,415000,474200,474200-514000 Y02027 00222406
*C548000,548020,548040,564000,564300,565200,565500,567000,568000 Y02027 00222706
*C570000,586720,586920,587020,587080,587213,587216,604000,614040 Y02027 00223006
*C662300,663100,663500,750000,754000,762000,778200,778300,778600 Y02027 00223306
*C778700,780000,798000,821808,821818,821840,821848               Y02027 00223606
*C821850,821852,821874,821898,821900,826000,834000,875748,911500 Y02027 00223906
*D046000,148100-148500,210000,212000,312000,320000-328000        Y02027 00224206
*D360000-362000,366000,368000,376000,398200-399800,406000,416000 Y02027 00224506
*D430000-440000,456000-468000,516000-522000,548160,548240        Y02027 00224806
*D548320-549840,564600,564900,565800-566700,567300,573000-578540 Y02027 00225106
*D582000-584000,586840-586850,587110,587165,614080-614320,660000 Y02027 00225406
*D786480-786880,821810-821816,821820-821828,821838,821842,821854 Y02027 00225706
*D821906-821946,828000,840000-846000,849400-849800,864000-874000 Y02027 00226006
*D875500-875600,875730-875745,875760,875880                      Y02027 00226306
*A060500,061500,071000,073000,188000-198000,225000,340300-341500 Y02027 00226606
*A345800-347760,371000-373000,375000,414500,420400-421600,445000 Y02027 00226906
*A449000-452000,472500-473500,474250-514000,548010,548030        Y02027 00227206
*A548050-548070,569000,571000,579270-579830,608400-609600        Y02027 00227506
*A614020-659640,663520-663580,746600-747200,751000,754080-755920 Y02027 00227806
*A778650,821851,834080-835920,875749,892060-893800,911570-911920 Y02027 00228106
*A821600,848000                                                 SA55382 00250622
*A028000,368000,376000,548000,614000,656000,8757000              S22027 00250722
*C586890                                                        SA55382 00250822
*C786000                                                         S22027 00250922
*D884000                                                         S22027 00251022
*D656720-656740,656770-656790                                   SA53603 00251122
*A820400                                                        SA53603 00251222
*C046000,152000-154000,207200,656000,656190,657120,684000        S22025 00251322
*C830000,832000                                                  S22025 00251422
*A701200                                                         A47139 00251522
*C150000,701600,882500                                           A42393 00251622
*C150000,882500                                                  S21101 00251722
*C656350                                                         A42382 00251822
*D657040-657080                                                  S21101 00251922
*A656080                                                         A42396 00252022
*A206600,206900,586950,656760,656890                             A48269 00252122
*C820000                                                         A48269 00252222
*D819540,819820                                                  A48269 00252322
*A656320                                                         A49227 00252422
*D656330,656390                                                  A49227 00252522
*A776000                                                        SA51082 00252622
*C149000-150000,612000,730000                                   SA51082 00252722
*D718000                                                        SA51082 00252822
*A662000                                                        SA51092 00252922
*D670000                                                        SA51092 00253022
*A466000                                                        SA52507 00253122
*A594000                                                        SA53625 00253222
*A586400,586950                                                 SA52971 00253322
*C172000,587050-587490,890000                                   SA52971 00253422
*D206300-207500,586855-586857,656025-657190,818070-821600       SA52971 00253522
*A573001-573010                                                 SA56920 00253605
*C586700-586830                                                 SA59162 00253705
*C586700                                                        SA59000 00253805
*A778000                                                        SA59000 00253905
*A778300                                                        SA62376 00254005
*A586710,586750,587030,821607                                   SA63961 00274052
*A398000,786400                                                 SA64000 00304052
*D413000,448400-455000,800500-801500                            SA64000 00354052
*D586790                                                        SA63957 00404052
*A586860,586890                                                 SA63957 00454052
*A587228                                                        SA65388 00504052
*A587213                                                        SA66619 00512005
*A587010,734000,875970                                          SA67159 00520005
*A780000                                                        SA68210 00528005
*D345060-345120                                                 OX03937 00536005
*A 224000,754000                                                OY00490 00536105
*D 310000-312000                                                OY00490 00536205
* A587030                                                       OY03851 00536305
* C587036-587040                                                OY03851 00536405
*A735400                                                        OY03924 00536505
*D322000                                                         Y06327 00544005
*C628840                                                       @ZA00906 00544561
*A647690                                                       @ZA00235 00545061
*D648840                                                       @ZA00235 00545561
*C587012,587014                                                @YA04902 00546061
*A192000                                                       @ZA00907 00546561
*A780120,780480                                                @YA05169 00547061
*C780540                                                       @YA05169 00547561
*A587010                                                       @YA06283 00548061
*D587020,587031                                                @YA06283 00548561
*A476850,875990                                                @SA71519 00549061
*A631640,635640                                                @ZA01155 00549261
*D629240-630440                                                @SA70283 00549561
*D780180                                                       @ZA02065 00559561
*A780240                                                       @ZA02065 00569561
*D677000-686000                                                @YA07682 00571561
*D586460-586520                                                @SA72476 00573561
*A780520                                                       @ZA02602 00575561
*C478200                                                       @ZA02056 00577561
*D190100-190200,354000,356000,481850-481970,564100             @ZA02601 00579561
*D746600-747300                                                @ZA02601 00581561
*C214000-222000,333000,346080-347040,347440-347760             @ZA02601 00583561
*C502300-503500548071-548311,586720-586730,638840-643240       @ZA02601 00585561
*C656040-656440,754320,754560-755600,762000,786100-786300      @ZA02601 00587561
*C821818-821840,821882-821888,821904-821948                    @ZA02601 00589561
*A482050,482350,637640,643640,754160,835120,875724,893170      @ZA02601 00591561
*A420400,421600,428000,448000,467000,472500                    @YA08086 00591909
*C790000,794000-808000                                         @YA08086 00592309
*D474000,787000                                                @YA08086 00592709
*A332000,223000                                                @SA70894 00593109
*D329000,756000-760000                                         @SA70894 00593509
*C904000                                                       @SA74021 00593909
*A477650                                                       @SA73573 00594309
*420000                                                        @SA74065 00594709
*A428000,862000                                                @ZA03745 00595109
*A628840                                                       @ZA03123 00595509
*A633240                                                       @YA09127 00595909
*C482055,482070,781020,780540-780600                           @YA09755 00596309
*D780360,835150-835160                                         @YA09755 00596709
*A781080,830000,882000                                         @YA09755 00597109
*A344200,347440                                                @ZA04027 00597509
*C587225-587228                                                @YA10244 00597909
*A488000                                                       @ZA05000 00598309
*D494000-497000                                                @ZA05000 00598709
*A332500,875995                                                @XA11307 00598809
*C586400                                                       @XA11307 00598909
*C490000-502000                                                @Z40X9NG 00599009
*A876000                                                       @Z40X9NG 00599109
*C821866-821880                                                @ZA06620 00599209
*A568000                                                       @SA76288 00599381
*C568600-568800                                                @SA76288 00599481
*A781110                                                       @YA11505 00599581
*C586920                                                       @OZ07798 00599691
*A568500                                                       @OS76679 00599791
*D568600-568700                                                @OS76679 00599891
*C587080-587159                                                @OY12440 00599991
*C341200,834400,649240                                         @OZ09293 00600091
*C488600                                                       @OZ09920 00600191
*C617240,626840-628440,629640,630440                           @OY12956 00600291
*D633340-633440                                                @OY12956 00600391
*A833000,894000,621240,637040                                  @OY12956 00600491
*C420500-420700,812000                                         @OZ09921 00600591
*A834000,806900                                                @OZ09921 00600691
*D408000                                                       @OZ09956 00600791
*A332000,332700                                                @OZ09951 00600891
*A199000,549271,835120                                         @OZ11167 00600991
*C629640,630440                                                @OZ14179 00601091
*C633240,636320                                                @OY14493 00601191
*A632440,835680,875997,636200,636840                           @OY14493 00601291
*D628840-630840                                                @OY14493 00601391
*D587116,821761-821782                                         @OY15028 00601491
*C587089-587113,821670-821684,821705-821712,821726-821740      @OY15028 00601591
*C821754                                                       @OY15028 00601691
*D781110-781560                                                @OZ17603 00601791
*A586730                                                       @OZ18783 00611700
*C632640                                                       @OZ24771 00621700
*           TCAM 10.0 CHANGES                                  @G36XRNP 00631700
*A875998,480200-480400,633452                                  @G36XRNP 00661700
*C510000-512000,548000,568590,586950,636260,636290,735700      @G36XRNP 00691700
*D833300,480250-480300                                         @G36XRNP 00721700
*                                                              @G36XRNP 00751700
*A448500,472700                                                @OZ27843 00757700
*C579550,570000-571000                                         @OZ26305 00763700
*A579620                                                       @OZ28213 00763886
*C587128-587146                                                @OS80123 00763986
*A568300                                                       @OZ29235 00764086
*A196000                                                       @OY20422 00764186
*A618440                                                       @OZ30337 00764286
*A420400,908000                                                @OY20522 00764386
*D474750,474950                                                @OY20522 00764486
*C658440-658840                                                @OZ32188 00764586
*D633454-633456                                                @OZ33239 00764686
*********************************************************************** 00800020
*                                                                     * 01000020
*TITLE: 'IEDQEU' OPEN/CLOSE SUBTASK                                   * 01200020
*                                                                     * 01201022
*  MODULE NAME = IEDQEU   (TCAM,INITIALIZATION)                @G36XRNP 01202000
*                                                                     * 01203022
*  DESCRIPTIVE NAME = OPEN/CLOSE SUBTASK                              * 01204022
*                                                                     * 01205022
*  COPYRIGHT = 'NONE'                                                 * 01206022
*                                                                     * 01207022
*  STATUS:  CHANGE LEVEL 10.0                                  @G36XRNP 01208000
*                                                                     * 01209022
*FUNCTION: THIS ROUTINE IS A LOGICAL EXTENSION OF APPL PROG OPEN AND  * 01400020
*   CLOSE EXECUTORS.  IT ALLOCATES AND DEALLOCATES MAIN STORAGE IN    * 01600020
*   THE MCP REGION OR PARTITION FOR CONTROL BLOCKS NECESSARY TO       * 01800020
*   COMPLETE THE CROSS-PARTITION DATA TRANSFER INTERFACE, INCLUDING   * 02000020
*   ONE LCB PER PCB, ONE PEB PER PCB, AND ONE PEWA + SCB + TRT        * 02200006
*   PER PROCESS ENTRY IN CSA. THE PEWAS AND PEBS ARE CHAINED AT       * 02220006
*   OPEN AND DECHAINED AT CLOSE OFF THE TCX.                          * 02240006
*   IF CHECKPOINT IS ACTIVE, THE TTR TABLE IS SEARCHED.  IF           * 02260006
*   MATCHING ENTRY IS FOUND IN CKREQ- TTR TABLE, THE FLAG BYTE        * 02280006
*   IS ZEROED.                                                        * 02300006
*                                                                     * 02320006
*   AT OPEN TIME, ERROR CHECKS ARE PERFORMED FOR INVALID QNAME        * 02340006
*   AND PROCESS ENTRY IN USE.  IN ADDITION, OPEN                      * 02360006
*   PERFORMS PARTIAL INITIALIZATION OF THESE CONTROL BLOCKS.  IT      * 02400020
*   LOADS AND DELETES GET SCHEDULER, PUT SCHEDULER, POINT-MCP         * 02600006
*   ROUTINE AS REQUIRED BY PROCESS ENTRY TYPE, THE ADDRESSES OF       * 02620006
*   THE SCHEDULERS ARE PLACED IN THE AVT AND ADDR OF QCBS IN TCX.     * 02640006
*                                                                       02660006
*   IF MESSAGES ARE ON THE QCB-FEFO CHAIN, IT BUILDS AN ERB TO        * 02680006
*   START THE READ AHEAD PROCESS.  IF NO MESSAGES ARE ON ANY          * 02700006
*   PRIORITY LEVEL QCB, THE STCB IS MOVED FROM THE RAQCB TO           * 02720006
*   DEST. QCB.                                                        * 02740006
*                                                                     * 02760006
*   IF USER HAS SPECIFIED QBACK=YES ON TPROCESS, THIS MODULE     S22027 02850022
*   LOADS AND DELETES THE QRESET EXECUTOR.                            * 02900006
*                                                                     * 02950006
*        AT CLOSE TIME, THE PEWA IS FLAG AS CLOSING.                  * 03000006
*        FOR INPUT DCBS, THE BUFFERS ON THE READ AHEAD QUEUE ARE      * 03050006
*   PUT ON THE RETURN BUFFER QCB, THE SEQ. NO. IS RESTORED IN         * 03100006
*   THE TERMINAL TABLE, AND THE MESSAGE PUT BACK IN THE FEFO          * 03150006
*   CHAIN. THE LAST MESSAGE IS MARKED SERVICED.                       * 03200006
*        FOR OUTPUT DCBS, THE MESSAGE ON THE READ AHEAD QUEUE         * 03260006
*   IS  POSTED TO THE MESSAGE HANDLER AFTER ADJUSTING SIZE AND        * 03320006
*   FORCING EOM. BUFFERS ON THE ERB CHAIN ARE POSTED TO THE           * 03400006
*   RETURN BUFFER QUEUE. THE ERB IS REMOVE FROM THE BUFFER            * 03460006
*   RETURN QCB IF NECESSARY.                                          * 03520006
*      THE WAITING EXECUTOR IS POSTED COMPLETE VIA XMPOST.            * 03600006
*                                                                     * 03700006
*ENTRY POINT:                                                         * 03800020
*        IEDQEU                                                       * 04000020
*INPUT:                                                               * 04200020
*   1  - ADDRESS OF SPECIAL OPEN CLOSE RCB                            * 04400006
*   11 - DISPATCHER ADDRESS                                           * 04800020
*   13 - REGISTER SAVEAREA ADDRESS                                    * 05000020
*   15 - ENTRY POINT ADDRESS                                          * 05200020
*OUTPUT:                                                              * 05400020
*    NONE                                                             * 05600020
*EXTERNAL ROUTINES:                                                   * 05800020
*        POST - CROSS MEMORY                                          * 06000006
*        LOAD                                                         * 06050006
*        GETMAIN                                                      * 06100006
*        IEDQA1 - USED TO VALIDATE QNAME AND GET TT OFFSET            * 06150006
*EXITS-NORMAL:                                                        * 06200020
*        OPEN-DSPDISP,DSPPOST                                         * 06400006
*        CLOSE-DSPDISP OR DSPCHAIN(BUFFER POSTING)                    * 06600020
*EXITS-ERROR:                                                         * 06800020
*        SAME AS 'NORMAL' EXCEPT RCBERR IN RCB CONTAINS ERROR CODE    * 07000006
*        X'01' GETMAIN FAILURE                                        * 07100006
*        X'0F' INVALID QNAME                                          * 07200006
*        X'0C' PROC ENTRY IN USE                                      * 07300006
*TABLES/WORKAREAS:                                                    * 07400020
*        AVT                                                          * 07600020
*        QCB                                                          * 07800020
*        TERMINAL ENTRY                                               * 08000020
*        SCB                                                          * 08200020
*        LCB                                                          * 08400020
*        PEWA                                                         * 08600020
*        PCB                                                          * 08800020
*        RCB                                                          * 08900006
*ATTRIBUTES -- REUSABLE,REENTERANT,PROBLEM PROGRAM MODE.              * 09000052
*                                                                     * 09200052
*NOTES: THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL         * 09400020
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 09600020
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   * 09800020
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     * 10000020
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.          * 10200020
*********************************************************************** 10400020
         EJECT                                                          10600020
*                                        *                              10800020
*  S Y M B O L I C    R E G I S T E R S  *                              11000020
*                                        *                              11200020
         SPACE                                                          11400020
RZERO    EQU   0                                                        11600020
RPARM    EQU   1                        PARAMETER REGISTER              11800020
RRECB    EQU   2                        RECB BASE REGISTER       Y02027 12000006
RPENTRY  EQU   3                        ADDRESS OF PROCESS ENTRY        12200020
RQCB     EQU   4                        ADDR OF DESTINATION QCB         12400020
RPCB     EQU   5                        ADDRESS OF PROCESS CONTROL BLK  12600020
RCOUNT   EQU   6                        GETMAIN BYTE COUNTER            12800020
RWORK    EQU   7                        ADDR OF GETMAIN WORKAREA        13000020
RTEMP    EQU   8                        GENERAL WORK REGISTER           13200020
RLCB     EQU   9                        ADDR OF LINK CONTROL BLOCK      13400020
RPEWA    EQU   10                       PROCESS ENTRY WORKAREA          13600020
RDISP    EQU   11                       DISPATCHER BASE REGISTER        13800020
RBASE    EQU   12                       CSECT BASE REGISTER             14000020
RSAVE    EQU   13                       SAVEAREA & AVT BASE REG         14200020
RETURN   EQU   14                       RETURN ADDRESS                  14400020
RENTRY   EQU   15                       ENTRY POINT ADDRESS             14600020
         SPACE 2                                                        14800020
IEDQEU   IEDHJN                                                         14900022
         DC    AL1(DSPMCPL4)            STCB VTO = 6             S22025 15200022
         DC    AL3(*-1)                 STCB ADDRESS             S22025 15400022
         BALR  RBASE,RZERO              ESTABLISH                       15600020
         USING *,RBASE                           ADDRESSABILITY         15800020
         EJECT                                                          16000020
*                                                   *                   16200020
* I N I T I A L I Z E   B A S E   R E G I S T E R S *                   16400020
*                                                   *                   16600020
         SPACE 2                                                        16800020
         USING IEDQDISP,RDISP           DISPATCHER ADDRESSABILITY       17000020
         USING AVTSAVE2,RSAVE           AVT ADDRESSABILITY      SA52971 17200022
         USING IEDQPCB,RPCB             PROCESS CONTROL BLOCK           17400020
*                                       ADDRESSABILITY                  17600020
         USING IEDQRECB,RRECB           SET RECB BASE REGISTER   Y02027 17800006
         USING IEDQQCB,RQCB                                             18000020
         USING IEDQTRM,RPENTRY                                          18200020
         USING IEDQPEWA,RPEWA           BASE REGISTER FOR PROCESS       18400020
*                                       ENTRY WORKAREA                  18600020
*****************************************************************Y02027 18800006
*              GET ADDRESS OF PROCESS ENTRY                      Y02027 18840006
*****************************************************************Y02027 18880006
         USING IEDQPEB,RWORK            SET PEB BASE REGISTER    Y02027 18920006
         USING IEDQTCX,RETURN           BASE FOR TCX             Y02027 18940006
         LR    RRECB,RPARM              SAVE RCB ADDRESS         Y02027 19000006
         TM    RECBKEY,OPENFLG          OPEN OR CLOSE.           Y02027 19040006
         BNO   CLOSE                    BRANCH IF CLOSE.         Y02027 19080006
         LA    RPARM,RCBDSNM            PT TO PROC ENTRY ID      Y02027 19120006
         SR    RLCB,RLCB                SET SWITCH TO ZERO       Y02027 19160006
         LA    RZERO,EIGHT              LOAD MAXIMUM LENGTH      Y02027 19200006
         LA    RENTRY,SEVEN(RPARM)      ADDR LAST CHAR         @ZA00907 19204061
NAMELOOP EQU   *                                               @ZA00907 19208061
         CLI   ZERO(RENTRY),BLANK       END OF NAME            @ZA00907 19212061
         BNE   SEARCH                   BR IF YES              @ZA00907 19216061
         BCTR  RENTRY,ZERO              DECREMENT NAME PTR     @ZA00907 19220061
         BCT   RZERO,NAMELOOP           LOOK AT NEXT CHAR      @ZA00907 19224061
         B     ABORT1                   NO NAME                @ZA00907 19228061
SEARCH   EQU   *                                               @ZA00907 19232061
         L     RENTRY,AVTMSGS-ONE       GET VCON TABLE ADDRESS   Y02027 19240006
         L     RENTRY,EIGHT(RENTRY)     LOAD ADDRESS OF IEDQA1   Y02027 19280006
         BAL   RETURN,FOUR(RENTRY)      SEARCH TERMNAME TABLE    Y02027 19320006
         LTR   RENTRY,RENTRY            PROCESS ENTRY FOUND      Y02027 19360006
         BZ    ABORT1                   BRANCH-NO                Y02027 19400006
         LR    RPARM,RENTRY             TERM NAME TABLE OFFSET   Y02027 19440006
         STH   RPARM,RECBQCBA+ONE       SAVE PROC ENTRY OFFSET   Y02027 19480006
         L     RENTRY,AVTRNMPT          ADDRESS OF CONVERSION RTNY02027 19520006
         BALR  RETURN,RENTRY            GET PROC ENTRY ADDRESS   Y02027 19560006
         LR    RPENTRY,RPARM            ADDRESS OF PROCESS ENTRY Y02027 19600006
         TM    TRMSTATE,TRMPROC         IS TPROCESS BIT ON     @OY20422 19620086
         BZ    ABORT1                   NO, FAIL OPEN          @OY20422 19640086
         TM    TRMSTATE,TRMLINE+TRMLIST   TPROCESS ONLY BIT ON @OY20422 19660086
         BNZ   ABORT1                   NO, NOT A TPROCESS ENT @OY20422 19680086
         NC    TRMSTAT(THREE),TRMSTAT   IS PROCESS ENTRY IN USE. Y02027 19700006
         BNZ   ABORT2                   BRANCH IN USE            Y02027 19800006
         L     RQCB,TRMDESTQ-1          DESTINATION QCB ADDRESS         19900020
         TM    QCBDSFLG,QSPEC           PUT TPROCESS ENTRY?    @OZ11167 19930091
         BZ    OUTPUT                   BR, YES                @OZ11167 19960091
         CLI   RCBDCBMA,ZERO            IS OPEN FOR OUTPUT     @OZ11167 19990091
         BE    ABORT4                   YES,INVALID OPEN       @OZ11167 20020091
         B     OPENOK                   CONT OPEN              @OZ11167 20050091
OUTPUT   EQU   *                                               @OZ11167 20080091
         CLI   RCBDCBMA,ZERO            OUTPUT DCB             @OZ11167 20110091
         BNE   ABORT4                   NO,  INVALID OPEN      @OZ11167 20140091
OPENOK   EQU   *                                               @OZ11167 20170091
         L     RPCB,QCBDCBAD-1          ADDRESS OF PROCESS CONTROL      20200020
*                                       BLOCK                           20600020
         EJECT                                                          20800020
***************************************************************@ZA02601 21400061
*              GET CORE FOR PEB                                @ZA02601 21460061
***************************************************************@ZA02601 21520061
         SR    RCOUNT,RCOUNT            CLEAR FOR ICM          @ZA02601 21580061
         ICM   RCOUNT,HIGH,PCBUCNT      GET PCB COUNT          @ZA02601 21640061
         BNZ   PWRKA                    BRANCH NOT FIRST USE   @ZA02601 21700061
         LA    RWORK,SPCSANFP           SUBPOOL FOR PEB        @ZA02601 21760061
         LA    RCOUNT,PEBSIZE           SIZE OF PEB            @ZA02601 21820061
         BAL   RETURN,GETMS             GET PEB CORE           @ZA02601 21880061
         ST    RPARM,PCBPEBAD           STORE PEB ADDR IN PCB  @ZA02601 21940061
         LR    RWORK,RPARM              COPY PEB ADDRESS       @ZA02601 22000061
         MVC   PEBASID,RCBASID          APPL ASID              @ZA02601 22060061
         MVC   PEBASCB,RCBASCB          APPL ASCB ADDRESS      @ZA02601 22120061
         MVC   PEBTCB,RCBTCB            APPL TCB ADDRESS       @ZA02601 22180061
         MVC   PCBJOBNA,RCBJOBNM        APPL JOBNAME TO PCB    @ZA02601 22240061
         ST    RPCB,PEBPCB              STORE PCB ADDR IN PEB  @ZA02601 22300061
         NC    PCBLCBAD+1(3),PCBLCBAD+1 NEED AN LCB            @SA70894 22330009
         BNZ   PWRKA                    BRANCH NOT FIRST USE   @SA70894 22360009
         LA    RCOUNT,LCBLEN            SIZE OF LINE CONTROL BLOCK      22400020
         LA    RWORK,SPLCB              SUBPOOL FOR LCB IN MCP   Y02027 22500006
         BAL   RETURN,GETMS             GET MAIN STORAGE FOR LCB Y01004 22600005
* C O M P L E T E   L C B   I N I T I A L I Z A T I O N                 30200020
         LR    RLCB,RPARM               ADDRESS OF LINE OCB      Y02027 30400006
         STCM  RLCB,ADDR,PCBLCBAD+ONE   PUT LCB ADDRESS INTO PCB Y01004 30600005
         USING IEDQLCB,RLCB             LINE CONTROL BLOCK       Y02027 31000006
         MVI   LCBFLAG1,X'C2'           IOS FLAGS                       31400020
         MVI   LCBECBCC,X'7F'           NORMAL COMPLETION CODE          31600020
         ST    RPCB,LCBDCBPT            PCB ADDRESS                     31800020
PWRKA    EQU   *                                                        33200020
         TM    DCBOFLGS-IHADCB(RPCB),OPEN    PCB OPEN          @OZ09951 33210091
         BO    PCBOPEN                  YES, BRANCH            @OZ09951 33220091
         OI    DCBOFLGS-IHADCB(RPCB),OPEN  SET PCB AS OPEN     @SA70894 33250009
         XC    PCBCNT,PCBCNT            INITIALIZE 'PUT' COUNT @XA11307 33260009
*                                        TO ZERO               @XA11307 33270009
PCBOPEN  EQU   *                                               @OZ09951 33280091
         L     RWORK,PCBPEBAD           LOAD PEB ADDR FROM PCB @ZA02601 33300061
         CLC   PEBASID,RCBASID          ASID'S MATCH           @ZA02601 33310061
         BNE   ABORT3                   NO, TAKE ERROR EXIT    @ZA02601 33320061
         CLC   PEBASCB,RCBASCB          ASCB ADDRESS'S MATCH   @ZA02601 33330061
         BNE   ABORT3                   NO, TAKE ERROR EXIT    @ZA02601 33340061
         CLC   PEBTCB,RCBTCB            TCB ADDRESS'S MATCH    @ZA02601 33350061
         BNE   ABORT3                   NO, TAKE ERROR EXIT    @ZA02601 33360061
         CLC   PCBJOBNA,RCBJOBNM        JOB NAMES MATCH        @ZA02601 33370061
         BNE   ABORT3                   NO, TAKE ERROR EXIT    @ZA02601 33380061
         SR    RLCB,RLCB                INITIALIZE SWITCH TO ZERO       33400020
         SR    RCOUNT,RCOUNT            CLEAR COUNTER TO ZERO           33600020
         IC    RCOUNT,AVTSCBSZ          STATION CONTROL BLOCK SIZE      33800020
         LA    RCOUNT,PEWASIZE(,RCOUNT) ADD IN PEWA SIZE.        Y02027 34000006
         CLI   RCBDCBMA,ZERO            TEST FOR INPUT DCB       Y02027 34030006
         LA    RWORK,SPCSANFP           SUBPOOL FOR PEWA IN CSA  Y02027 34060006
         BE    NOTRT                    BRANCH IF NOT INPUT      Y02027 34090006
         LA    RCOUNT,TRTLEN(,RCOUNT)   ADD TRT TABLE LENGTH   @OZ09293 34120091
NOTRT    EQU   *                                                 Y02027 34150006
         LA    RCOUNT,LCBCHAIN-IEDQLCB+FOUR(RCOUNT) LCB BUMP    OY00490 34170006
         BAL   RETURN,GETMS             BRANCH TO GETMAIN               34200020
*                                       SUBROUTINE                      34400020
         LA    RPEWA,LCBCHAIN-IEDQLCB+FOUR(RPARM) PEWA ADDR.    OY00490 34420006
         BAL   RETURN,LOCK              GO GET LOCK            @ZA04027 34430009
         L     RPARM,CVTPTR             LOAD CVT ADDRESS         Y02027 34450006
         L     RETURN,CVTAQAVT-CVT(RPARM)  LOAD TCX ADDRESS      Y02027 34460006
         L     RENTRY,TCXPEWAC          ADDRESS OF 1ST PEWA IN   Y02027 34480006
*                                       CHAIN                    Y02027 34500006
CHAINPEW ST    RENTRY,PEWALINK          POINTER TO PREVIOUS HD OFY02027 34520006
*                                       CHAIN                    Y02027 34540006
         CS    RENTRY,RPEWA,TCXPEWAC    CHAIN NEW PEWA ON FRONT  Y02027 34560006
         BNE   CHAINPEW                 OF OLD CHAIN             Y02027 34580006
         EJECT                                                          34600020
         L     RWORK,PCBPEBAD           ADDRESS OF PEB         @ZA02601 34608061
         SR    RCOUNT,RCOUNT            CLEAR FOR ICM          @ZA02601 34628061
         IC    RCOUNT,PCBUCNT           GET PCB COUNT          @ZA02601 34648061
         LTR   RCOUNT,RCOUNT            FIRST USE OF PCB       @ZA02601 34658061
         BNZ   HAVEPEB                  BRANCH NOT FIRST USE   @ZA02601 34668061
         L     RENTRY,TCXPEBC           ADDRESS 1ST PEB IN CHAIN Y02027 34712006
CHAINPEB ST    RENTRY,PEBLINK           PT TO PREV HD OF CHAIN   Y02027 34720006
         CS    RENTRY,RWORK,TCXPEBC     CHAIN NEW PEB ON         Y02027 34728006
         BNE   CHAINPEB                 FRONT OF OLD CHAIN       Y02027 34736006
HAVEPEB  EQU   *                                               @ZA02601 34744061
         BAL   RETURN,UNLOCKIT          UNLOCK                 @ZA04027 34764009
*                                   *                                   34800020
* INITIALIZE PROCESS ENTRY WORKAREA *                                   35000020
*                                   *                                   35200020
         AH    RCOUNT,HONE              INCREMENT USE COUNT BY ONE      35800020
         STC   RCOUNT,PCBUCNT           PUT NEW USE COUNT IN PCB        36400020
         TM    TRMSTAT+3,QR             HAS QUEUE RESET FUNCTION S22027 36850022
*                                       BEEN REQUESTED           S22027 36900022
         ST    RPEWA,TRMSTAT            STORE PEWA ADDR.         Y02027 36950006
         BNO   CONTINU                  BRANCH IF NO Q-RESET.    Y02027 37000006
         L     RETURN,CVTPTR            CVT ADDR.                Y02027 37100006
         L     RETURN,CVTAQAVT-CVT(,RETURN) TCX ADDR.            Y02027 37200006
         LOAD  EP=IEDQGQ                LOAD Q-RESET MODULE      Y02027 37300006
         ST    RZERO,TCXQRQ             STORE GQ ADDR IN TCX.    Y02027 37400006
         OI    PEWAGSW+ONE,ARESET       INDICATE Q-RESET PRESENT.Y02027 37500006
CONTINU  EQU   *                                                 S22027 37900022
         ST    RPCB,PEPCBAD             ADDRESS OF PROCESS              38200020
*                                       CONTROL BLOCK                   38400020
         ST    RPENTRY,PEWAPROC         BACK CHAIN TO PROCESS ENTRY     38600020
         LA    RQCB,PERAQCB             ADDRESS OF MAIN STORAGE QCB     38800020
         MVI   QCBDSFLG,RAQCBKEY        QCB KEY FIELD                   39000020
         MVC   QCBELCHN(3),AVTDELAD+1   STORE ADDRESS OF DUMMY LAST     39200020
*                                       ELEMENT IN ELEMENT CHAIN        39400020
*                                       FIELD OF QCB                    39600020
         MVI   QCBPRI,RAQCBPRI          PRIORITY FIELD                  39800020
         MVC   PEWALREC,RCBDCBLR        MOVE DCBLRECL TO PEWA.   Y02027 40000006
         MVC   PEWAOPTC,RCBDCBOP        MOVE OPTION BYTE TO PEWA.Y02027 40200006
         MVC   PEWAPETO,RECBQCBA+ONE    MOVE PROC ENTRY OFFSET   Y02027 40400006
         L     RTEMP,TRMDESTQ-1         DESTINATION QCB ADDRESS         41000020
         MVC   PEWADEB,RCBDEBAD         APPL PROG DEB ADDRESS    Y02027 41400006
         L     RCOUNT,CVTPTR            LOAD CVT ADDR.           Y02027 41450006
         L     RCOUNT,CVTAQAVT-CVT(RCOUNT) LOAD TCX ADDR.        Y02027 41500006
         CLI   0(RTEMP),QCBFQCB         PUT PROCESS ENTRY               41800020
         BE    PUT                      BRANCH IF YES                   42000020
         NI    QCBFLAG-IEDQQCB(RTEMP),AVTEFF-QCBSDFFO          @SA74065 42010009
*                                       SET QCB NOT SENDING    @SA74065 42020009
         OI    PEWAOPT2,PEWAIN          SET INPUT INDICATOR.     Y02027 42040006
         LA    RZERO,TRMTPIN            GET TPROCESS FIELD FLG @OY20522 42040486
         LR    RPARM,RPENTRY            GET TPROCESS ADDR      @OY20522 42040886
         L     RENTRY,AVTDDFT           DEV DEP LOOKUP RTN ADDR@OY20522 42041286
         ST    RSAVE,PEWASAVE           SAVE R13 PTR           @OY20522 42041686
         LA    RSAVE,PEWASAVE+FOUR      SAVE AREA- CALLED RTN  @OY20522 42042086
         BALR  RETURN,RENTRY            GET DEV DEP INFO       @OY20522 42042486
         L     RSAVE,PEWASAVE           RESTORE R13            @OY20522 42042886
         USING IEDPROC,RENTRY           ADDRESSABILITY         @OY20522 42043286
         MVI   RCBSQ,ZERO               CLEAR SECURE Q FLG     @OY20522 42043686
         LTR   RENTRY,RENTRY            DEV DEP INFO SPEC?     @OY20522 42044086
         BZ    NODEVDEP                 BR, NO                 @OY20522 42044486
         TM    PROFLAG,PROSECQ          SECURE Q SPEC          @OY20522 42044886
         BNO   NOSECURE                 BR, NO                 @OY20522 42045286
         MVI   RCBSQ,SECURE             SET SECURE Q FLG       @OY20522 42045686
NOSECURE EQU   *                                               @OY20522 42046086
         TM    PROFLAG,PRODATE          DATE=YES ON TPROCESS   @OY20522 42046486
         BNO   NODEVDEP                 BR, NO                 @OY20522 42046886
         OI    PEWAOPT2,PEWADATE        SET DATE=YES FOR TPDATE@OY20522 42047286
NODEVDEP EQU   *                                               @OY20522 42047686
         DROP  RENTRY                                          @OY20522 42048086
         TM    RCBDCBMA,POINT           IS IT POINT            @OZ09921 42050091
         BNO   NOTPTS                   BR,NO                  @OZ09921 42056091
         NC    TCXPNTQ+1-IEDQTCX(3,RCOUNT),TCXPNTQ+1-IEDQTCX(RCOUNT)    42062091
*                                       POINT RTN LOADED       @OZ09921 42068091
         BNZ   NOTPTS                   BR YES                 @OZ09921 42074091
         MVI   MNAME+FIVE,PTS           POINT MODULE SUFFIX.     Y02027 42080006
         BAL   RETURN,LOADER            LOAD POINT MODULE.       Y02027 42120006
         ST    RZERO,TCXPNTQ-IEDQTCX(RCOUNT) POINT RTN. ADDR.    Y02027 42160006
NOTPTS   EQU   *                                               @YA08086 42180009
         LA    RETURN,0(0,RPEWA)                                        42200020
         LA    RTEMP,LCBCHAIN-IEDQLCB   LCB OFFSET                      42400020
         SR    RETURN,RTEMP             DUMMY LCB ADDRESS               42600020
         ST    RETURN,PEWALCBA          SET UP FOR GET/READ MH          42800020
         MVI   LCBFLAG1-IEDQLCB(RETURN),XC2  DUMMY IOS FLAGS   @ZA03745 43000009
         CLI   TCXGETQ+ONE-IEDQTCX(RCOUNT),AVTEZERO            @YA08086 43200009
*                                        ALREADY LOADED        @YA08086 43400009
         BNE   NOTEW                    BRANCH IF YES          @YA08086 43600009
         MVI   MNAME+5,GS               MODULE IDENTIFIER               44200020
         BAL   RETURN,LOADER            GO LOAD MODULE                  44400020
         ST    RZERO,TCXGETQ-IEDQTCX(RCOUNT) GET SCHD. ADDR.     Y02027 44500006
         AH    RZERO,AVTHA2             BUMP PAST OFFSET                44600020
         ST    RZERO,AVTEW              GET SCHEDULER                   44800020
NOTEW    EQU   *                                               @YA08086 44850009
         L     RPARM,TCXGETQ-IEDQTCX(RCOUNT) QCB ADDR - IEDQEW @OZ27843 44860000
         L     RPARM,EIGHT(RPARM)       GET STCB PTR           @OZ27843 44870000
         ST    RPARM,PEWASTCB           PUT STCB PTR IN DUMMY  @OZ27843 44880000
*                                        QCB                   @OZ27843 44890000
         L     RPARM,PEWALCBA           ADDRESS OF DUMMY LCB     Y02027 44900006
         MVC   LCBTTCIN-IEDQLCB(2,RPARM),PEWAPETO SET UP TO TT   Y02027 45000006
         MVC   LCBTTBIN-IEDQLCB(2,RPARM),PEWAPETO ENTRY OFFSET   Y02027 45100006
         B     CLEANUP1                 PREPARE TO RETURN        Y02027 45200006
         EJECT                                                          46400020
PUT      EQU   *                                                        46600020
         XC    PERAQCB(4),PERAQCB       CLEAR FOR PUT ENTRY     SA52507 46700022
         CLI   AVTEC+1,AVTEZERO         ALREADY LOADED         @YA08086 46800009
         BNE   PUT1                     BRANCH IF YES          @YA08086 46900009
         MVI   MNAME+5,PS               MODULE IDENTIFIER               47000020
         BAL   RETURN,LOADER            GO LOAD MODULE                  47200020
         ST    RZERO,TCXPUTQ-IEDQTCX(RCOUNT) PUT SCHD. ADDR.     Y02027 47250006
         ST    RZERO,AVTEC              PUT SCHEDULER ADDRESS  @YA08086 47260009
PUT1     EQU   *                                               @YA08086 47270009
         L     RPARM,TCXPUTQ-IEDQTCX(RCOUNT) QCB ADDR - IEDQEC @OZ27843 47276000
         L     RPARM,EIGHT(RPARM)       GET STCB PTR           @OZ27843 47282000
         ST    RPARM,PEWASTCB           PUT STCB PTR IN DUMMY  @OZ27843 47288000
*                                        QCB                   @OZ27843 47294000
         OI    PEWAOPT2,PEWAOUT         SET OUTPUT INDICATOR.    Y02027 47300006
         OI    PEWAGSW+ONE,NEEDHDRN     SET NEED HDR FLAG IN PEWAY02027 47350006
         LA    RPARM,PEWAQCBS           MAKE STCB POINT          Y02027 47420006
         ST    RPARM,PEWAQCBS           TO ITSELF                Y02027 47425006
         MVI   PEWAQCBS,PSVTO           PUT SCHED. VTO           Y02027 47430006
         SPACE                                                          47435006
CLEANUP1 EQU   *                                                 Y02027 47440006
         LA    RPARM,PERAQCB            MAIN STG QCB             Y02027 47445006
         STCM  RPARM,ADDR,PERCQCB+ONE   SET DUMMY LCB            Y02027 47450006
         MVC   PEWAGSW(1),RCBDCBRF      PUT RECFM IN PEWA        Y02027 47455006
         OI    PEWAGSW,RETRIEVE         SET RETREIVE OK FLAG     Y02027 47460006
         MVC   PEWAFLG1(1),RCBDCBF1     PUT DCBFLAG1 IN PEWA     Y02027 47465006
         MVC   PEWACBUF,AVTDELAD        MOVE IN DUMMY ADDR.      Y02027 47470006
         OI    TRMDEVFL,HEX80           INDICATE BUFSIZE SPEC.   Y02027 47500006
         TM    TRMSTATE,TRMOPTFN        OPTION FLDS SPECIFIED-   Y02027 47505006
         BO    COMPOPTF                 BRANCH-YES.              Y02027 47510006
         LA    RPARM,TRMOPTBL           ADDR OF BUFSIZE FLD.     Y02027 47515006
         B     SETBFZ                   GO SET BUFFER SIZE.      Y02027 47520006
COMPOPTF EQU   *                                                 Y02027 47525006
         SR    RPARM,RPARM              CLAER REG.               Y02027 47530006
         IC    RPARM,TRMOPNO            LOAD NO. OF OPT FLDS.    Y02027 47535006
         LA    RPARM,TRMOPT+ONE(RPARM)  GET ADDR OF BUFSIZE FLD  Y02027 47540006
SETBFZ   EQU   *                                                 Y02027 47545006
         TM    RCBDCBDS,PHYSSEQ         TEST FOR PHYS. SEQ.      Y02027 47550006
         BO    BUFLTST                  BRANCH IF YES.           Y02027 47555006
MOVEBFZ  EQU   *                                                 Y02027 47560006
         MVC   ZERO(TWO,RPARM),PCBBFSZE MOVE BUFSIZE FROM PCB.   Y02027 47565006
         B     SETCNT                   GO SET UNIT COUNT.       Y02027 47570006
BUFLTST  EQU   *                                                 Y02027 47575006
         NC    RCBDCBBU,RCBDCBBU        IS BUFSIZE IN DCB.       Y02027 47580006
         BZ    MOVEBFZ                  BUFSIZE NOT IN DCB.      Y02027 47585006
         MVC   ZERO(TWO,RPARM),RCBDCBBU MOVE BUFSIZE OF DCB.     Y02027 47590006
SETCNT   EQU   *                                                 Y02027 47595006
         SR    RENTRY,RENTRY            CLEAR REG.               Y02027 47600006
         LR    RETURN,RENTRY            CLEAR REG.               Y02027 47605006
         ICM   RENTRY,THREE,ZERO(RPARM) BUFFER SIZE              Y02027 47610006
         STCM  RENTRY,THREE,PEWASOWA    STORE BUFSIZE IN PEWA.   Y02027 47615006
         LH    RZERO,AVTKEYLE           LOAD UNIT SIZE           Y02027 47620006
         DR    RETURN,RZERO             COMPUTE UNIT/BUFFER.     Y02027 47625006
         LTR   RETURN,RETURN            TEST FOR REMAINDER.      Y02027 47630006
         BZ    STORE                    GO STORE UNIT/BUFFER.    Y02027 47635006
         LA    RENTRY,ONE(,RENTRY)      ROUND TO NEXT UNIT.      Y02027 47640006
STORE    EQU   *                                                 Y02027 47645006
         STC   RENTRY,PEUNCT            STORE UNIT COUNT IN PEWA.Y02027 47650006
         MVC   PEWABFCT,PCBBUFMX        MOVE BUFMAX TO PEWA.     Y02027 47655006
         LA    RZERO,AVTBFRTB           BUFFER RETURN QCB ADDR.  Y02027 47660006
         LA    RPARM,AVTINOUT           MH PARAMETER.            Y02027 47665006
         STM   RZERO,RPARM,PEWASCB      INITIALIZE SCB FLDS.     Y02027 47670006
         CLI   RCBDCBMA,NULL            TEST DCB TYPE.           Y02027 47675006
         BE    EXITTST                  BRANCH IF OUTPUT DCB.    Y02027 47680006
         OI    PEWAFLG,MHOK             SET MH OK FLAG IN PEWA.  Y02027 47685006
         NI    PEWAOPTC,PARTOFF         CLEAR PART BUF FLAG    @SA71519 47687061
*****   MOVE GET SCHEDULER STCB FROM READ-AHEAD QCB STCB.        Y02027 47690006
*****     CHAIN TO STCB CHAIN OF THE DESTINATION QCB.            Y02027 47695006
STCBMOVE EQU   *                                                 Y02027 47700006
         L     RQCB,TRMDESTQ-ONE        ADDR OF DEST QCB         Y02027 47705006
         LA    RENTRY,QCBSTVTO-IEDQQCB(RQCB) LOAD STCB CHAIN ADDRY02027 47710006
         ST    RENTRY,QCBSTVTO-IEDQQCB(RQCB) CHAIN STCB TO ITSELFY02027 47715006
         MVI   QCBSTVTO-IEDQQCB(RQCB),GETSCHD  SET FOR GET SCHD, Y02027 47720006
         L     RENTRY,CVTPTR            LOAD CVT ADDR.           Y02027 47725006
         L     RENTRY,CVTAQAVT-CVT(RENTRY) LOAD TCX ADDR.        Y02027 47730006
         L     RENTRY,TCXGETQ-IEDQTCX(RENTRY) LOAD GET SCHD ADDR.Y02027 47735006
         LA    RENTRY,EIGHT(RENTRY)     POINT TO GET SCHD STCB   Y02027 47740006
         ST    RENTRY,PEWAQCBS          STORE STCB IN STCB OF    Y02027 47745006
*                                       READ AHEAD QCB           Y02027 47750006
*                                                                Y02027 47755006
         L     RQCB,TRMDESTQ-ONE        GET DEST QCB ADDR        Y02027 47760006
         OI    QCBFLAG,QCBPROC          PROCESS QCB FLAG.        Y02027 47765006
         TM    QCBDSFLG,QCBHELD         REUSEABILITY IN        @SA73573 47766009
         BO    CKPTTST                  YES-BYPASS READ-AHEAD  @SA73573 47767009
         SR    RETURN,RETURN            CLEAR REG.               Y02027 47770006
         USING IEDQPQCB,RQCB            PRIORITY QCB BASE        Y02027 47775006
         LA    RQCB,IEDQPQCB-IEDQQCB(RQCB)  GET ADDRESS OF       Y02027 47780006
*                                       PRIORITY QCB             Y02027 47785006
QLOOP    EQU   *                                                 Y02027 47790006
         NC    QCBFFEFO,QCBFFEFO        TEST FOR COMPLETE MSG.   Y02027 47795006
         BNZ   ERBFIX                   BUILD ERB TO BRING MSG-  Y02027 47800006
*                                        ONTO RD-AHEAD QUEUE.    Y02027 47805006
         NC    QCBPRIPQ,QCBPRIPQ        TEST FOR LAST PRIRITY QCBY02027 47810006
         BZ    CKPTTST                  TEST FOR CHECK POINT     Y02027 47815006
         LA    RQCB,QCBPSIZE(RQCB)      PT TO NEXT LEVEL QCB   @ZA02056 47820061
         LA    RETURN,ONE(,RETURN)      INCREMENT PRI. QCB CNTR. Y02027 47825006
         B     QLOOP                    CHECK NEXT PRIORITY QCB. Y02027 47830006
         EJECT                                                   Y02027 47835006
*****    START READ- AHEAD PROCESS HERE.                         Y02027 47840006
ERBFIX   EQU   *                                                 Y02027 47845006
         USING IEDQSCB,RWORK            SET UP SCB BASE REG.     Y02027 47850006
         LA    RWORK,PEWASCB            LOAD SCB ADDR.           Y02027 47855006
         MVC   SCBDESTQ,TRMDESTQ        MOVE DEST. QCB ADDR.     Y02027 47860006
         MVC   SCBSCHDR,QCBFFEFO        MOVE DISK/CORE REC. NO.  Y02027 47865006
         MVC   SCBSCSEG,QCBFFEFO        MOVE DISK/CORE REC NO.   Y02027 47870006
         STC   RETURN,SCBPRI            SET PRIORITY IN SCB      Y02027 47875006
         LA    RTEMP,PEERB              ERB ADDR IN PEWA.        Y02027 47880006
         USING LCBERB,RTEMP             SET UP ERB BASE.         Y02027 47885006
         XC    LCBERB(TWELVE),LCBERB    CLEAR ERB                Y02027 47890006
         LA    RENTRY,AVTDSIOB          DISK I/O QCB ADDR.       Y02027 47895006
         ST    RENTRY,LCBERBQB-ONE      PUT ADDR OF QCB IN ERB.  Y02027 47900006
         ST    RWORK,LCBSCBA-ONE        STORE SCB ADDR IN LCB.   Y02027 47905006
         MVI   LCBERBKY,ERBKEY          PUT ERB KEY IN ERB.      Y02027 47910006
         MVI   LCBERBPY,ERBPRI          PUT PRIORITY IN ERB.     Y02027 47915006
         MVC   LCBERBCT(ONE),PEWABFCT   MOVE BUFFER LIMIT.       Y02027 47920006
         OI    PEWAFLG,ERBBUSY          SET ERB BUSY FLAG.       Y02027 47925006
         L     RQCB,TRMDESTQ-ONE        DESTINATION QCB ADDRESS  Y02027 47930006
         USING IEDQQCB,RQCB                                      Y02027 47935006
         OI    QCBFLAG,QCBSDFFO         SET SEND FLAG.           Y02027 47940006
         L     RWORK,PEWALCBA           DUMMY LCB ADDR.          Y02027 47945006
         MVI   LCBSTAT1-IEDQLCB(RWORK),LCBSENDN SET LCB SENDING. Y02027 47950006
         LA    RLCB,FOUR                INDICATE ERB FOR DSPPOST.Y02027 47955006
         L     RWORK,TRMDESTQ-ONE       DEST QCB CONTAINS STCB   Y02027 47960006
         LA    RPENTRY,PERAQCB          ADDRESS OF QCB TO WHICH  Y02027 47965006
*                                       STCB IS TO BE MOVED      Y02027 47970006
         BAL   RETURN,DSPUNAVR          PUT STCB IN RAQCB        Y02027 47975006
         LR    RPARM,RTEMP              ERB TO BE POSTED         Y02027 47980006
         L     RPENTRY,PEWAPROC         RESTORE TT ADDRESS       Y02027 47985006
         B     CKPTTST                  SET  CKREQ-TTR TABLE     Y02027 47990006
         EJECT                                                   Y02027 47995006
*****   ERB IS READY TO BE POSTED TO THE ASYNC READY QUEUE.    @G36XRNP 48000000
CKPTTST  EQU   *                                                 Y02027 48005006
         LA    RTEMP,EXITTST            SET EXIT ADDRESS         Y02027 48015006
CKPTRTN  EQU   *                                                 Y02027 48020006
         TM    AVTCKFLG,AVTCKTAC        IS TCAM CKPT ACTIVE    @G36XRNP 48020200
         BNOR  RTEMP                    BRANCH IF NO CHKPT     @ZM46636 48020400
         L     RENTRY,AVTTCB            GET TCAM TCB ADDRESS   @G36XRNP 48020600
         USING IEDQTCB,RENTRY           TCB ADDRESSABILITY     @G36XRNP 48020800
         LA    RENTRY,TCBDEB-(DEBDEBAD-DEBNMSUB) GET ADDR OF   @G36XRNP 48021000
*                                       TCAM DEB CHAIN AS      @G36XRNP 48021200
*                                       DUMMY 1ST DEB          @G36XRNP 48021400
         DROP  RENTRY                   TCB ADDRESSABILITY     @G36XRNP 48021600
         USING DEBNMSUB,RENTRY          DEB ADDRESSABILITY     @G36XRNP 48021800
         DROP  RETURN                   TCX ADDRESSABILITY     @G36XRNP 48022000
         USING IHADCB,RETURN            DCB ADDRESSABILITY     @G36XRNP 48022200
CKPTLOOP EQU   *                                               @G36XRNP 48022400
         L     RENTRY,DEBDEBAD          GET ADDR OF NEXT DEB   @G36XRNP 48022600
         L     RETURN,DEBDCBAD          GET ADDR OF DCB        @G36XRNP 48022800
         TM    DCBDSRG2,DCBDSGTQ        IS THIS TCAM QUEUE     @G36XRNP 48023000
*                                       DATA SET               @G36XRNP 48023200
         BNO   CKPTLOOP                 NO, GET NEXT DEB       @G36XRNP 48023400
         TM    DCBOPTCD,CHECKPT         IS THIS THE TCAM       @G36XRNP 48023600
*                                       CHKPT DCB              @G36XRNP 48023800
         BNO   CKPTLOOP                 NO, GET NEXT DEB       @G36XRNP 48024000
         L     RENTRY,DCBIOBAD          GET CHKPT WORKAREA     @G36XRNP 48024200
         TM    TRMSTATE,TRMHELDN        CHECK FOR SYNC=YES       Y02027 48040006
         BZR   RTEMP                    BRANCH IF SYNC=NO        Y02027 48045006
         SR    RETURN,RETURN            CLEAR REGISTER           Y02027 48050006
         DROP  RENTRY                   DEB ADDRESSABILITY     @G36XRNP 48051000
         DROP  RETURN                   DCB ADDRESSABILITY     @G36XRNP 48052000
         USING IEDQCKPD,RENTRY          CKPT WORK AREA BASE REG@G36XRNP 48053000
         IC    RETURN,CKPCKRQS          NUMB OF CKREQS SPECIFIED Y02027 48055006
         LTR   RETURN,RETURN            TEST FOR ZERO CKREQS     Y02027 48060006
         BZR   RTEMP                    BRANCH IF ZERO CKREQS    Y02027 48065006
         LA    RETURN,CKPCKRNO(,RETURN) NUMBER OF CKREQ DSK RECS Y02027 48070006
         L     RENTRY,CKPCTTRB          GET CKREQ-TTR TABLE      Y02027 48075006
*                                                                Y02027 48080006
*              LOOK FOR PROC ENTRY IN CKREQ-TTR TABLE            Y02027 48085006
*                                                                Y02027 48090006
QNB40    EQU   *                                                        48095006
         TM    CKPCTFLG(RENTRY),CKPCTDER CHECK FOR DISK ERROR    Y02027 48100006
         BO    QNB42                    BRANCH IF DISK ERROR     Y02027 48105006
         CLC   CKPCTTTR(TWO,RENTRY),PEWAPETO COMPARE OFFSETS.    Y02027 48110006
         BE    QNB89                    BRANCH IF TT OFFSETS =   Y02027 48115006
QNB42    EQU   *                                                 Y02027 48120006
         LA    RENTRY,CKPCTTRL(,RENTRY) MOVE TO NEXT ENTRY       Y02027 48125006
         BCT   RETURN,QNB40             SCAN CKREQ-TTR TABLE     Y02027 48130006
         BR    RTEMP                    BRANCH ENTRY FOUND       Y02027 48135006
QNB89    EQU   *                                                 Y02027 48140006
         MVI   CKPCTFLG(RENTRY),ZERO    ZERO BYTE IN CKREQ-TTR TBY02027 48145006
         BR    RTEMP                    EXIT                     Y02027 48150006
EXITTST  EQU   *                                                 Y02027 48155006
         MVC   RCBDEBTA,PEWAPETO        MOVE PROC ENRTY OFFSET.  Y02027 48160006
         STCM  RPEWA,ADDR,RCBDEBPW      STORE PEWA ADDR.         Y02027 48165006
         STCM  RPCB,ADDR,RCBDEBPC       STORE PCB ADDR.          Y02027 48170006
         MVC   RCBPEBAD,PCBPEBAD+ONE    MOVE PEB ADDR.           Y02027 48175006
CLEANUP  EQU   *                                                 Y02027 48180006
         TM    RECBKEY,OPENFLG          TEST FOR OPEN.           Y02027 48200006
         BO    OPENBR                   BRANCH IF OPEN           Y02027 48205006
         LA    RZERO,AIBKEY-IEDQAIB     ADJUST FOR AIB         @YA09755 48205509
         LA    RETURN,ZERO(RRECB)       COPY RCB ADDRESS       @ZA02601 48206061
         SR    RETURN,RZERO             NOW AT AIB             @ZA02601 48206561
         CLC   AIBECBA-IEDQAIB(FOUR,RETURN),QOT1               @YA09755 48207009
*                                        ENTRY FROM RTM        @YA09755 48207209
         BNE   NOTRTM                   NO, BRANCH             @ZA02601 48207561
         MVI   ZERO(RETURN),ZERO        FREE AIB               @ZA02601 48208061
         B     NOPOST                   SKIP POST              @ZA02601 48208561
NOTRTM   EQU   *                                               @ZA02601 48209061
         L     RETURN,CVTPTR            LOAD CVT ADDR            Y02027 48210006
         L     RETURN,CVTAQAVT-CVT(,RETURN) LOAD TCX ADDR.       Y02027 48215006
         USING IEDQTCX,RETURN           TCX ADDRESSABILITY     @G36XRNP 48217000
         MVC   RCBPEBAD,TCXASCB+ONE     MOVE MCP ASCB ADDR       Y02027 48220006
         LA    RETURN,AVTOPCOB+FOUR     GET CLOSEDOWN ECB ADDR   Y02027 48225006
         STCM  RETURN,ADDR,RCBOPECB     AND PUT IN RCB           Y02027 48230006
         MVC   RCBAVTBT,AVTBIT1         PASS BITS TO A.P. CLOSE  Y02027 48235006
         B     ERROR                    SKIP CLEAR OF RETURN CD@ZA02601 48237061
OPENBR   EQU   *                                                 Y02027 48240006
         XC    RCBERR,RCBERR            STORE  NORMAL RETURN CODEY02027 48245006
ERROR    EQU   *                                                        48400020
***** ISSUE CROSS MEMORY POST TO APPLICATION PGM ECB.            Y02027 48600006
         LR    RPENTRY,RPARM            SAVE ACROSS POST         Y02027 48800006
         SR    RZERO,RZERO              CLEAR COMPLETION CODE  @ZA05000 48810009
         IC    RZERO,RCBERR             PICK UP COMP CODE      @ZA05000 48820009
         L     RPARM,CVTPTR             CVT PTR                @ZA05000 48830009
         ICM   RPARM,ALL,CVTAQAVT-CVTMAP(RPARM)  TCX ADDR      @ZA05000 48840009
         L     RETURN,PCBPEBAD          PEB ADDR               @ZA05000 48850009
         CLC   RCBASID+TWO(2),TCXASID-IEDQTCX(RPARM)           @OZ09920 48860091
*                                       IS A.P. A SUBTASK OF   @ZA05000 48870009
*                                         THE MCP              @ZA05000 48880009
         BNE XMPOST                     BR NO FOR XMPOST       @ZA05000 48890009
         L     RPARM,RCBPECB            GET ECB ADDR           @ZA05000 48900009
         POST  (1),(0)                  DO NORMAL POST         @ZA05000 48910009
         B     NOPOST                   BYPASS XMPOST          @ZA05000 48920009
XMPOST   EQU   *                                               @ZA05000 48930009
*        ISSUE SVC 102 TO HAVE SRB SCHEDULED IN APPLICATION    @Z40X9NG 49000009
*        PROGRAM'S MEMORY TO DO POST                           @Z40X9NG 49100009
         LA    RPARM,RCBPECB            POINT TO PARM LIST     @Z40X9NG 49200009
         USING SSRBSECT,RPARM           PARM LIST ADDRESS      @Z40X9NG 49300009
         MVI   SSRBENTC,SSRBCODE        SET ENTRY CODE         @Z40X9NG 49400009
         STC   RZERO,SSRBCC             SET COMPLETION CODE    @Z40X9NG 49500009
         AQCTL                          ISSUE SVC 102          @Z40X9NG 49600009
         DROP  RPARM                                           @Z40X9NG 49700009
NOPOST   EQU   *                                               @ZA02601 50230061
         LR    RPARM,RPENTRY            RESTORE REG.             Y02027 50400006
         B     BTAB(RLCB)               BRANCH TO PROPER EXIT.   Y02027 50600006
BTAB     EQU   *                                                 Y02027 50800006
         B     DSPDISP                  RETURN TO DISPATCHER.  @G36XRNP 51000000
         BAL   RETURN,DSPPOST           RETURN AND POST ELEMENT@G36XRNP 51200000
         B     CLEANPUT                 CHAIN IN ELEMENTS.       Y02027 51400006
CLEANPUT EQU   *                                                        52400020
         L     RPEWA,AVTSAVE2+4         RESTORE ELEMENT ADDR     Y02027 52500006
         LR    RPARM,RPEWA              ADDRESS OF ELEMENT CHAIN        52600020
ENDLOOP  EQU   *                                                        52800020
         CLC   5(3,RPEWA),AVTFZERO      END OF CHAIN                    53000020
         BE    OK                       BRANCH IF YES                   53200020
         CLC   5(3,RPEWA),AVTDELAD+1    END OF CHAIN                    53400020
         BE    SETEND                   BRANCH IF YES                   53600020
         L     RPEWA,4(0,RPEWA)         ADDRESS OF NEXT ELEMENT         53800020
         B     ENDLOOP                  GO CHECK THIS ONE               54000020
SETEND   EQU   *                                                        54200020
         XC    5(3,RPEWA),5(RPEWA)      SET END OF CHAIN INDICATOR      54400020
OK       EQU   *                                                        54600020
         BAL   RETURN,DSPCHAIN          BRANCH TO DISPATCHER   @G36XRNP 54800000
         EJECT                                                   Y02027 54801006
ABORT1   EQU   *                        PROCESS ENTRY NOT FOUND. Y02027 54802006
         MVI   RCBERR,NTFND             SET RETURN CODE FOR POST.Y02027 54803006
         B     ERROR                    POST APPLIC. ECB COMPLETEY02027 54804006
ABORT2   EQU   *                        PROC. ENTRY IN USE.      Y02027 54805006
         MVI   RCBERR,INUSE             SET RETURN CODE.         Y02027 54806006
         B     ERROR                    GO POST APPLIC. ECB COMP.Y02027 54807006
ABORT3   EQU   *                                               @ZA02601 54807161
         MVI   RCBERR,PCBINVLD          SET INVALID PCB RETURN @ZA02601 54867161
         B     ERROR                    POST APPL ECB COMPLETE @ZA02601 54927161
ABORT4   EQU   *                                               @OZ11167 54937191
         MVI   RCBERR,INVAL             INVALID OPEN  043-2    @OZ11167 54947191
         B     ERROR                    POST ECB COMPLETE      @OZ11167 54957191
         EJECT                                                          55000020
*                                                                       55200020
*  THIS SECTION HANDLES CLOSE REQUESTS FOR PROCESS ENTRIES              55400020
*                                                                       55600020
CLOSE    EQU   *                                                        55800020
*                                               *                       56000020
         SR    RLCB,RLCB                SET SWITCH TO ZERO              56200020
         L     RPEWA,RCBDSNM            LOAD PEWA ADDR FROM RCB. Y02027 56400006
*                                       IS TERMINATING           Y02027 56420006
         L     RPENTRY,PEWAPROC         LOAD PROC ENTRY ADDR.    Y02027 56430006
         L     RQCB,TRMDESTQ-ONE        LOAD DEST. QCB ADDR.     Y02027 56520006
         LR    RCOUNT,RQCB              SAVE QCB ADDRESS         Y02027 56560006
         L     RPCB,QCBDCBAD-ONE        PCB ADDR.                Y02027 56700006
         OI    PEWAFLG,CFLG             TURN ON CLOSE FLAG.      Y02027 56800006
         TM    QCBDSFLG,QCBHELD         IS REUS PROCESSING THIS@SA76288 56810081
*                                        QUEUE NOW             @SA76288 56820081
         BNO   SETQCB1                  CONTINUE IF NO         @SA76288 56830081
         MVI   RCBERR,ZERO              RESET RCB POSTED FLAG  @OZ29235 56835086
         XC    PEWAELEM+8(2),PEWAELEM+8  SET SPECIAL ELEMENT   @SA76288 56840081
*                                       NOT IN USE FOR QEW     @SA76288 56850081
         LA    RCOUNT,QCBSTVTO          ADDR OF STCB           @OS76679 56850991
         ICM   RLCB,ADDR,QCBSTCHN       IS GET SCHED           @OS76679 56851891
         CR    RCOUNT,RLCB               DEST QCB              @OS76679 56852791
         BE    DSPDISP                  BR YES, DELAY PROCESSIN@OS76679 56853691
*                                        UNTIL REUS IS COMPLETE@OS76679 56854591
         LR    RPENTRY,RQCB             QCB TO WHICH STCB IS   @OS76679 56855491
*                                        TO BE MOVED           @OS76679 56856391
         LA    RWORK,PERAQCB            ADDR OF QCB NOW        @OS76679 56857291
*                                        CONTAINING THE STCB   @OS76679 56858191
         BAL   RETURN,DSPUNAV           MOVE SCHED             @G36XRNP 56859000
SETQCB1  EQU   *                                               @SA76288 56880081
         TM    PEWAGSW+ONE,RESETACT     QRESET IN PROGRESS       Y02027 56900006
         BNO   NQRESET                  BR,NO                  @OZ26305 57000000
         MVI   RCBERR,ZERO              RESET POSTED FLAG SO   @OZ26305 57030000
*                                       IEDQGQ WILL POST RCB   @OZ26305 57100000
         B     DSPDISP                  WAIT FOR QGQ POST      @OZ26305 57150000
NQRESET  EQU   *                                               @OZ26305 57200000
         CLI   QCBDSFLG,QCBFQCB         PUT PROCESS ENTRY               57860020
         BE    PUTQCBX                  BRANCH IF YES                   57920020
*****************************************************************Y02027 57927006
******                     CLOSE INPUT DCB.                      Y02027 57934006
*****************************************************************Y02027 57941006
         TM    PEWAFLG,ERBBUSY          IS ERB BUSY.             Y02027 57948006
         BNO   QCBTEST                  BR NO, CONT CLOSE      @OZ26305 57955000
         MVI   RCBERR,ZERO              RESET POSTED FLAG SO   @OZ26305 57956000
*                                        IEDQEW WILL POST RCB  @OZ26305 57957000
         B     DSPDISP                  WAIT FOR IEDQEW POST   @OZ26305 57958000
QCBTEST  EQU   *                                                 Y02027 57962006
         L     RPARM,PEWALCBA           GET LCB ADDR           @OZ28213 57962586
         TM    LCBSTAT1-IEDQLCB(RPARM),LCBRCLLN    RETRIEVE?   @OZ28213 57963086
         BNO   NORTV                    BR, NO                 @OZ28213 57963586
         LA    RPARM,PEERB              GET ERB ADDR           @OZ28213 57964086
         LA    RLCB,PERAQCB             GET ADDR OF R.A. QCB   @OZ28213 57964586
         ST    RLCB,ZERO(RPARM)         R.A. QCB IN ERB        @OZ28213 57965086
         MVI   FOUR(RPARM),PRIBFRTB     ERB PRIORITY           @OZ28213 57965586
         MVI   RCBERR,ZERO              RESET POSTED FLAG SO   @OZ28213 57966086
*                                        IEDQEW WILL POST RCB  @OZ28213 57966586
         BAL   RETURN,DSPPOST           REPOST ERB TO GET OUT  @OZ28213 57967086
*                                        OF RETRIEVE MODE      @OZ28213 57967586
NORTV    EQU   *                                               @OZ28213 57968086
         L     RPARM,QCBSTVTO           LOAD STCB PTR            Y02027 57969006
         CLI   0(RPARM),GETSCHD         GET SCHED IN DEST QCB    Y02027 57970006
         BNE   REMOVEIT                 BR IF YES                Y02027 57971006
         MVC   QCBSTCHN,QCBSLINK        MOVE HM PTR              Y02027 57972006
         B     PUTQCB                   BR                       Y02027 57973006
REMOVEIT STCM  RPARM,SEVEN,QCBSLINK     REMOVE SCHED             Y02027 57974006
         DROP  RETURN                                            Y02027 57976006
         USING IEDQRECB,RRECB           SET UP BASE REG.         Y02027 57983006
         EJECT                                                          57992020
PUTQCB   EQU   *                                                        58000020
         LA    RQCB,PERAQCB             MAIN STORAGE QCB ADDRESS        58600020
         CLI   QCBDSFLG-IEDQQCB(RCOUNT),QCBFQCB  PUT QCB                58620020
         BNE   NOTPUT                   BRANCH IF NO           @XA11307 58640009
         ST    RPARM,AVTDOUBL           SAVE REG1 CONTENTS     @XA11307 58641009
         L     RPARM,PCBLCBAD           GET LCB ADDRESS        @XA11307 58642009
         CLI   LCBPRI-IEDQLCB(RPARM),PUTDELAY   IS LCB FROM    @XA11307 58643009
*                                        PUT TIME DELAY        @XA11307 58644009
         BNE   NOGET2                   BRANCH IF NO           @XA11307 58645009
         L     RENTRY,AVTHG02           ADDRESS OF SUBTASK TO  @XA11307 58646009
*                                        REMOVE LCB FROM       @XA11307 58647009
*                                        TIME DELAY            @XA11307 58648009
         BALR  RETURN,RENTRY            REMOVE LCB FROM DELAY  @XA11307 58649009
NOGET2   EQU   *                                               @XA11307 58650009
         L     RPARM,AVTDOUBL           RESTORE REG1 CONTENTS  @XA11307 58651009
         B     NOGET                    BR TO CONTINUE CLOSE   @XA11307 58652009
NOTPUT   EQU   *                                               @XA11307 58653009
         NC    EOMSAVE+1(2),EOMSAVE+1   MSG TO FLAG SERVICED            58660020
         BZ    CKPECBUF                 BRANCH IF YES           SA59000 58670022
         LA    RZERO,AVTDSIOB           DISK I/O QCB ADDRESS            58670522
         L     RPARM,EOMSAVE            BFR TO FLAG SERVICED            58671022
         MVI   PRFPRI-IEDQPRF(RPARM),PRIDKSRV MARK MSG TO BE SERVY02027 58671106
         MVI   PRFTIC-IEDQPRF(RPARM),TIC                         Y02027 58671206
         TM    PEWAFLG,PEWASTOP         PROCESS ENTRY DISABLED  SA63961 58671352
         BO    STOP                     BRANCH IF YES           SA63961 58671652
         TM    RCBTCBFL,TERM            IS APPL TERMINATING    @ZA02601 58672061
         BZ    SERVICE                  BRANCH IF NO           @ZA02601 58673061
         OI    PCBOFLG1,PCBABEND        SET PCB ABEND FLAG     @OZ18783 58673500
         TM    PCBOFLG1,PCBSFLAG        OMIT MSG SERVICING      SA59162 58674022
         BNO   SERVICE                  BRANCH IF NO            SA59162 58675022
STOP     EQU   *                                                SA63961 58675552
         LA    RZERO,AVTBFRTB           BUFFER RETURN QUEUE     SA59162 58676022
         MVI   PRFPRI-IEDQPRF(RPARM),PRIBFRTB RETURN PRTY       SA59162 58677022
SERVICE  EQU   *                                                SA59162 58678022
         STCM  RZERO,ADDR,ONE(RPARM)    PUT QCB ADDR. IN BUFFER. Y01004 58678505
         LA    RTEMP,PEWASCB            SCB ADDRESS                     58678752
         XC    EOMSAVE(4),EOMSAVE       SET NONE OTHER                  58678852
         TM    PCBOFLG1,PCBABEND+PCBSFLAG  NO SERVICING WANTED  SA63957 58685105
         BNO   SERVX                    BRANCH IF NO            SA63957 58685205
         ICM   RZERO,ADDR,PERAQCB+ONE   TOP OF READ-AHEAD QUEUE  Y05330 58685305
         ST    RPARM,PERAQCB            TOP OF READ-AHEAD QUEUE SA63957 58685552
         STCM  RZERO,ADDR,FIVE(RPARM)   RE-LINK CHAIN            Y05330 58686005
         B     SERVY                    GO SET FEFO             SA63957 58686552
         SPACE                                                          58687552
SERVX    EQU   *                                                SA63957 58688052
         BAL   RETURN,SETFEFO          BESURE FRFO PTR IS CORRECSA55382 58689000
SERVY    EQU   *                                                SA63957 58690052
         NI    PCBOFLG1,AVTEFF-PCBABEND CLEAR ABEND FLAG        SA63957 58691052
         L     RPARM,PEWARCB            LOAD RCB ADDRESS       @OZ07798 58692091
         BAL   RETURN,DSPPOST           REPOST SPECIAL ELEMENT @G36XRNP 58695000
         SPACE 1                                                        58696022
*                                                                     * 58697022
*        IF MESSAGE IS READ AHEAD BUT NOT SENT TO APPL PROG, RESET    * 58698022
*        FEFO POINTER TO ALLOW MSG TO BE READ NEXT TIME DCB OPENS.    * 58699022
*                                                                       58700061
ENQUEUE  EQU   *                                                        58700361
         CLC   QCBELCHN(3),AVTDELAD+1   READ AHEAD Q EMPTY     @YA06283 58700661
         BE    NOGET                    BR, IF YES             @YA06283 58700961
         L     RETURN,PERAQCB           BUFFER ADDRESS         @YA04902 58701261
         TM    PRFSTAT1-IEDQPRF(RETURN),PRFDUPLN               @YA04902 58701361
*                                       RECALLED BUFFER?       @YA04902 58701461
         BO    RETCLEAN                 BRANCH IF YES           SA67159 58701605
         TM    PEWAFLG,PEWASTOP         PROCESS ENTRY DISABLED  SA63961 58703352
         BO    NOUPDTE                  YES, BRANCH             OY03851 58703605
         TM    PEWAOPT2,OVERFLOW        WORKAREA OVERFLOW        Y02027 58705006
         BNO   NOOFLO                   BRANCH IF NO           @OY12440 58708091
*                                                              @OY12440 58708391
*        MESSAGE THAT CAUSED WORKAREA OVERFLOW MUST BE         @OY12440 58708691
*        DISCARDED BY MARKING IT SERVICED RATHER THAN          @YA12440 58708991
*        REINSERTING IT IN THE FEFO CHAIN                      @YA12440 58709091
         MVC   QCBELCHN(3),PRFLINK-IEDQPRF(RETURN)  REMOVE     @YA12440 58709191
*                                  BUFFER FROM READ-AHEAD QUEUE@YA12440 58709291
         NI    PRFSTAT1-IEDQPRF(RETURN),PRFNLSTF  FLAG AS EOM  @YA12440 58709391
         MVI   PRFPRI-IEDQPRF(RETURN),PRIDKSRV SERVICED PRTY   @YA12440 58709491
         LA    RPARM,AVTDSIOB           DISK I/O QCB           @YA12440 58709591
         ST    RPARM,PRFQCBA-1-IEDQPRF(,RETURN) SET QCB ADDR   @YA12440 58709691
         MVI   AVTDOUBL+4,ZERO          SET NO OVERFLOW        @YA12440 58709791
         SR    RZERO,RZERO              CLEAR FOR IC           @OY15028 58709891
         IC    RZERO,PRFTQBCK-IEDQPRF(RETURN) GET PRIORITY     @OY15028 58709991
*                                        LEVEL INDEX           @OY15028 58710091
         LA    RPARM,QCBPSIZE           SIZE OF PRILVL QCB     @OY15028 58710191
         MR    RZERO,RZERO              OFFSET TO PRIO QCB     @OY15028 58710291
         LA    RPARM,IEDQPQCB-IEDQQCB(RPARM,RCOUNT) GET ADDR   @OY15028 58710391
*                                        OF PRIORITY QCB       @OY15028 58710491
         MVC   PRFSRCE-IEDQPRF(L3,RETURN),QCBFFEFO-IEDQPQCB(RPARM)      58710591
*                                        SET FEFO PTR FOR FA   @OY15028 58710691
         LR    RPARM,RETURN             SET DISPATCHER PARM    @OY15028 58710791
         NI    PEWAOPT2,AVTEFF-OVERFLOW SET NO OVERFLOW        @OY12440 58711991
         LR    RTEMP,RPENTRY            SAVE PROCESS ENTRY     @OY12440 58712291
         LR    RZERO,RQCB               SAVE DEST QUEUE        @OY12440 58712591
         XC    FIVE(3,RPARM),FIVE(RPARM)   CLEAR LINK FIELD    @OS80123 58712886
         L     RPENTRY,PEWARCB          GET CLOSE ELEM ADDR    @OS80123 58713186
         STCM  RPARM,ADDR,FIVE(RPENTRY) CHAIN BUFF TO CLOSE ELE@OS80123 58713486
         LR    RPARM,RPENTRY            GET ELEM ADDR          @OS80123 58713786
         BAL   RETURN,DSPCHAIN          CHAIN ELEM ON RDY Q    @OS80123 58714086
NOOFLO   EQU   *                                               @OY12440 58714991
*        FIND CORRECT PRIORITY LEVEL QCB                              * 58716222
         NC    PRFSIZE-IEDQPRF(,RETURN),PRFSIZE-IEDQPRF(RETURN)  S22027 58716622
*                                       QUICK CLOSE BUFFER       S22027 58716722
         BZ    NOUPDTE                  BRANCH IF YES            S22027 58716822
         LA    RTEMP,IEDQPQCB-IEDQQCB(0,RCOUNT) FIRST PRTY LEVEL QCB    58717122
         SR    RZERO,RZERO              CLEAR WORK REGISTER      A49227 58717422
         IC    RZERO,PRFTQBCK-IEDQPRF(RETURN) SCB PRTY INDEX     A49227 58717722
         LA    RPARM,QCBPEND-IEDQPQCB   PRTY QCB LENGTH          A49227 58718022
         MR    RZERO,RZERO              PRTY QCB OFFSET          A49227 58718322
         AR    RTEMP,RPARM              CORRECT PRTY QCB         A49227 58718622
         LA    RPARM,PRFCRCD-IEDQPRF(,RETURN) SET THIS RCD PTR  SA52971 58718922
         TM    PRFSTAT1-IEDQPRF(RETURN),PRFNHDRN IS IT A HEADER SA52971 58719222
         BNO   HDR                      YES, GOT THE ONE DESIREDSA52971 58719522
         LA    RPARM,PRFCHDR-IEDQPRF(,RETURN) GET HEADER PTR    SA52971 58719822
HDR      EQU   *                                                SA52971 58720122
         TM    L'PRFCRCD-1(RPARM),CPBQTYPE IS THIS CORE PRT     SA52971 58720422
         BNZ   DISKONLY                 NO, WE'RE SET           SA52971 58720722
         MVC   AVTDOUBL+1(3),AVTEZERO(RPARM) GET QUEUED HEADER'SSA52971 58721022
         L     RENTRY,AVTDOUBL          ADDRESS.                 Y02027 58721306
         MVC   PRFIOADR-IEDQPRF(3,RENTRY),QCBFFEFO-IEDQPQCB(RTEMP) 6619 58721406
*                                       SET FEFO ADDRESS IN COPYSA66619 58721505
         LA    RPARM,PRFCRCD-IEDQPRF(RENTRY) SET PROPER FEFO ADD.Y02027 58721606
DISKONLY EQU   *                                                SA52971 58721922
         MVC   QCBFFEFO-IEDQPQCB(3,RTEMP),AVTEZERO(RPARM) BACK  SA52971 58722222
*                                       UP FEFO CHAIN          @YA10244 58722509
         NC    QCBLFEFO-IEDQPQCB(3,RTEMP),QCBLFEFO-IEDQPQCB(RTEMP)      58722609
*                                       IS LFEFO ZERO          @YA10244 58722709
         BNZ   NOFEFO                   NO, LFEFO IS OK        @YA10244 58722809
         MVC   QCBLFEFO-IEDQPQCB(3,RTEMP),AVTEZERO(RPARM)      @YA10244 58723009
*                                       RESET LFEFO            @YA10244 58723209
NOFEFO   EQU   *                                               @YA10244 58723409
         TM    PRFTIC-IEDQPRF(RETURN),PRFRESET QRESET BUFFER    SA65388 58723852
         BO    NOUPDTE                  BRANCH IF YES           SA65388 58724352
         MVC   TRMOUTSQ,PRFTQBCK+1-IEDQPRF(RETURN)    RESTORE    A42396 58725022
*                                        THE SEQUENCE NUMBER     A42396 58727022
NOUPDTE  EQU   *                                                 S22027 58728022
         LA    RTEMP,AVTBFRTB           BUFFER RETURN QCB ADDRESS       58729022
XLOOP    EQU   *                                                        58731022
         ST    RTEMP,PRFQCBA-1-IEDQPRF(0,RETURN) QCB ADDR IN HDR        58733022
         MVI   PRFPRI-IEDQPRF(RETURN),PRIBFRTB BUFFER RETURN PRTY       58735022
         CLC   PRFLINK-IEDQPRF(3,RETURN),AVTDELAD+1 END OF CHAIN        58737022
         BE    GETBFR                   BRANCH IF YES                   58739022
         CLC   PRFLINK-IEDQPRF(3,RETURN),AVTFZERO END OF CHAIN          58741022
         BE    GETBFR                   BRANCH IF YES                   58743022
         L     RETURN,PRFLINK-1-IEDQPRF(0,RETURN) NEXT BFR IN CHAIN     58745022
         B     XLOOP                    GO CHECK NEXT BUFFER     S22025 58747022
GETBFR   EQU   *                                                        58749022
NOGET    EQU   *                                                        58760020
         CLC   QCBELCHN(3),AVTDELAD+1   ELEMENT CHAIN EMPTY             58800020
         BE    INIT                     BRANCH IF YES                   59000020
         NC    QCBELCHN(2),QCBELCHN     CHAIN EMPTY                     59200020
         BZ    INIT                     BRANCH IF YES                   59400020
         LA    RTEMP,PEERB              ERB ADDRESS             SA53625 59450022
         XC    LCBERBCH-LCBERB(3,RTEMP),LCBERBCH-LCBERB(RTEMP)  SA53625 59500022
*                                       CLEAR EMPTY BFR POINTER SA53625 59550022
         L     RTEMP,QCBELCHN-1         ADDR OF BUFFERS TO RETURNY02027 59600006
*                                       TO POOL OR BUFFER TO POST       59800020
*                                       TO MESSAGE HANDLER              60000020
         XC    QCBELCHN(3),QCBELCHN     SET AS EMPTY CHAIN              60200020
         LA    RLCB,EIGHT               SET FLAG TO INDICATE THERY02027 60400006
*                                       IS A CHAIN OF ELEMENTS TO       60600020
*                                       BE POSTED                       60800020
         ST    RTEMP,AVTSAVE2+4         SAVE ELEMENT ADDR        Y02027 60900006
         CLI   QCBDSFLG-IEDQQCB(RCOUNT),QCBFQCB     PUT QCB             61000020
         BNE   INIT                     BRANCH IF NO            SA51082 61200022
         CLI   PRFPRI-IEDQPRF(RTEMP),PRIAPBFR  EOM BFR TO MH     Y02027 61230006
         BE    CLEANPUT                 BRANCH IF YES           SA51082 61260022
         EJECT                                                          61300020
INIT     EQU   *                                                        61400020
         ST    RLCB,AVTSAVE2            SAVE INDEX REG           Y02027 61402006
         NI    QCBFLAG-IEDQQCB(RCOUNT),AVTEFF-QCBSDFFO  SET QCB  Y02027 61404006
*                                       NOT SENDING              Y02027 61444006
         BAL   RTEMP,CKPTRTN            GO RESET CKPT-TTR ENTRY  Y02027 61484006
         L     RQCB,AVTTCB              LOAD MCP TCB ADDR.       Y02027 61524006
         L     RQCB,TCBDEB-IEDQTCB(RQCB) LOAD ADDR OF 1ST DEB.   Y02027 61564006
CHLCK011 EQU   *                                                 Y02027 61604006
         LA    RQCB,ZERO(,RQCB)         ZERO HIGH ORDER BYTE.    Y02027 61644006
         LTR   RQCB,RQCB                TEST DEB ADDR FOR ZERO   Y02027 61684006
         BZ    CHLCK060                 BR IF END OF CHAIN     @OY12956 61724091
*                                       TO CHECK FOR NCP TERM  @OY12956 61744091
         L     RETURN,DEBDCBAD-DEBNMSUB(RQCB)  LOAD DCB ADDR     Y02027 61764006
         TM    DCBDSORG+ONE-IHADCB(RETURN),IEDQLINE  IS IT LINE  Y02027 61804006
*                                       DCB                      Y02027 61824006
         BZ    CHLCK03                  BRANCH IF NOT LINE DCB.  Y02027 61844006
         TM    DCBOFLGS-IHADCB(RETURN),OPEN  IS DCB OPEN       @OZ30337 61854086
         BNO   CHLCK03                  BR, NO                 @OZ30337 61864086
         L     RLCB,DCBIOBAD-IHADCB(RETURN) IOB ADDR.            Y02027 61884006
         LA    RENTRY,LCBFLAG1-IEDQLCB  DISPLACEMENT FOR LCB.    Y02027 61924006
         SR    RLCB,RENTRY              LCB ADDR.                Y02027 61964006
         XR    RENTRY,RENTRY            CLEAR INDEX REG.         Y02027 62004006
         IC    RENTRY,DCBEIOBX-IHADCB(RETURN) LGTH OF LCB.       Y02027 62044006
         XR    RTEMP,RTEMP              CLEAR LOOP CONTROLL.     Y02027 62084006
         IC    RTEMP,DEBNMEXT-DEBNMSUB(RQCB)  NUMB LINES IN GRP  Y02027 62124006
         LA    RCOUNT,CHLCK021          RETURN REG             @OY12956 62144091
CHLCK02  EQU   *                                                 Y02027 62164006
         AR    RLCB,RENTRY              PT. TO NEXT LCB.         Y02027 62204006
         ICM   RETURN,ADDR,LCBSCBA-IEDQLCB(RLCB) LOAD SCB ADDR   Y02027 62244006
         TM    SCBSTATE-IEDQSCB(RETURN),SCBLCK1N CHK FOR LOCK    Y02027 62284006
*                                       MODE                     Y02027 62324006
         BO    CHLCK04                  BRANCH IF LOCK MODE.     Y02027 62364006
CHLCK021 EQU   *                                                 Y02027 62404006
         BCT   RTEMP,CHLCK02            CHK ALL LINES IN GRP.    Y02027 62444006
CHLCK03  EQU   *                                                 Y02027 62484006
         L     RQCB,DEBDEBAD-DEBNMSUB(RQCB)  PT TO NAXT DEB      Y02027 62524006
         B     CHLCK011                 CHK NEXT DEB.            Y02027 62564006
*** SEE IF LINE IS LOCKED TO PROCESS PGM. BEING CLOSED.          Y02027 62604006
CHLCK04  EQU   *                                                 Y02027 62644006
         L     RPARM,RCBDSNM            GET PEWA ADDR FROM RCB @OY12956 62684091
         CLC   PEWAPETO-IEDQPEWA(2,RPARM),LCBINSRC  IS PROCESS @OY12956 62734091
*                                        ENTRY LOCKED IN.      @OY12956 62784091
         BNER  RCOUNT                   BR, NO                 @OY12956 62834091
         LH    RPARM,LCBTTCIN-IEDQLCB(RLCB)    TNT OFFSET        Y02027 63124006
         N     RPARM,AVTCLRHI           CLEAR HIGH ORDER HALF.   Y02027 63164006
         STM   RZERO,RENTRY,AVTSAVE2+12  SAVE OVER DISPCALL    @ZA01155 63184061
         L     RENTRY,AVTRNMPT          TNT CONVERSION LOGIC.    Y02027 63204006
         BALR  RETURN,RENTRY            COMPUTE TERM ENTRY ADDR  Y02027 63244006
         LM    RETURN,RENTRY,AVTSAVE2+X44   RESTORE REGS       @OZ24771 63264000
         TM    LCBINSRC+TWO,X30         LOCK RESPONSE DUE      @OY14493 63324091
         BNZ   CHKBD                    BR YES                 @OY14493 63326091
         OI    SCBSTATE-IEDQSCB(RETURN),SCBMSGLN FORCE MSG LOCK@OY14493 63328091
         TM    LCBINSRC+TWO,X40         HM IN PROGRESS         @OY14493 63330091
         BOR   RCOUNT                   BR YES                 @OY14493 63332091
CHKBD    EQU   *                                               @OY14493 63334091
         NI    SCBSTATE-IEDQSCB(RETURN),UNLOCK RESET LOCK MODE @OY14493 63336091
         CLI   LCBINSRC+TWO,AVTEZERO    IS TERM IN EXTENDED    @OY14493 63338091
*                                       LOCK WAITING FOR       @OY14493 63340091
*                                       TERMINAL INPUT         @OY14493 63342091
         BNE   CHKBD1                   BR NO                  @OY14493 63344091
         BR    RCOUNT                   GET NEXT DEB OR TNT    @OY14493 63344691
CHKBD1   EQU   *                                               @OY14493 63345291
         TM    LCBINSRC+TWO,X80         BD IN PROGRESS         @OY14493 63346091
         MVC   LCBINSRC(3),AVTFZERO     CLEAR LCBINSRC         @OY14493 63348091
         BOR   RCOUNT                   YES, DB WILL POST LCB  @OY14493 63350091
*** POST LCB TO ITSELF.                                          Y02027 63364006
         ST    RLCB,LCBRCB               POST LCB TO ITSELF.     Y02027 63404006
         XC    LCBLINK,LCBLINK          CLEAR LINK FIELD.        Y02027 63444006
         MVI   LCBPRI,PRIEDISP          SET LCB PRIORITY.        Y02027 63484006
         LR    RPARM,RLCB               PT. RCB PTR. TO LCB.     Y02027 63524006
         BAL   RETURN,DSPPOSTR          POST LCB TO READY QUEUE. Y02027 63564006
         LM    RZERO,RENTRY,AVTSAVE2+12  RESTORE REGS          @ZA01155 63584061
         BR    RCOUNT                   CHECK NEXT ENTRY       @OY12956 63604091
CHLCK060 EQU   *                                               @OY12956 63605091
*                                       CHECK NCP TERMINALS    @OY12956 63606091
         TM    AVTSAVTF,AVTVTMCP        IS 3705 RUNNING        @OY12956 63607091
         BZ    CHLCK061                 BR,NO                  @OY12956 63608091
         LA    RCOUNT,CHLCK06A          RETURN ADDR            @OY12956 63609091
         L     RENTRY,AVTRNMPT          TERM NAME TABLE        @OY12956 63610091
         LH    RQCB,TNTLEN-IEDQTNTD(RENTRY)  NUM TNT ENTRIES   @OY12956 63611091
         N     RQCB,AVTCLRHI            CLEAR HI ORDER HALF    @OY12956 63612091
         SR    RTEMP,RTEMP              CLEAR FOR TNT LOOP     @OY12956 63613091
CHLCK06A EQU   *                                               @OY12956 63614091
         LA    RTEMP,ONE(RTEMP)         BUMP TO NEXT ENTRY     @OY12956 63615091
         LR    RPARM,RTEMP              INPUT TO TNT           @OY12956 63616091
         CLR   RQCB,RTEMP               END OF TNT             @OY12956 63617091
         BL    CHLCK061                 BR,YES                 @OY12956 63618091
         L     RENTRY,AVTRNMPT          TERM NAME TABLE        @OY12956 63619091
         BALR  RETURN,RENTRY            GET TERM ENTRY ADDR    @OY12956 63620091
         DROP  RPENTRY                  DROP TPROCESS TRM ENTRY@OY14493 63620591
         USING IEDNTRM,RPARM            TERM ENTRY ADDRESSABILI@ZM48410 63621000
         LA    RENTRY,TRMPRFSZ          TRM NEG PREFIX         @ZM48410 63621200
         SR    RPARM,RENTRY             BACK UP TO PREFIX      @ZM48410 63621400
         TM    TRMSTATE,XE0             IS IT TERM ENTRY       @OY12956 63622091
         BNZR  RCOUNT                   NO,CHECK NEXT ENTRY    @OY12956 63623091
         TM    TRMDSORG,TRMLGB          IS IT AN LGB           @OY12956 63624091
         BOR   RCOUNT                   YES, GET NEXT ENTRY    @OY12956 63625091
         TM    TRMSTATE,TRMPREF         IS IT NCP TERM         @G36XRNP 63626000
         BNOR  RCOUNT                   NO, GET NEXT ENTRY     @OY12956 63627091
         CLI   TRMTYPE,TRMLULO          LOWER THAN LU          @ZM48410 63627200
         BLR   RCOUNT                   YES,GET NEXT ENTRY     @ZM48410 63627400
         CLI   TRMTYPE,TRMPSHI          HIGHER THAN PRESNA     @ZM48410 63627600
         BHR   RCOUNT                   YES,GET NEXT ENTRY     @ZM48410 63627800
         L     RETURN,TRMDESTQ-1        GET QCB ADDR           @OY12956 63628091
         LA    RENTRY,QCBPRFSZ          GET NEG PREFIX         @ZM47556 63628500
         SR    RETURN,RENTRY            BACK UP TO QCB PREFIX  @ZM47556 63629000
         TM    QCBSTAT1-IEDNQCB(RETURN),QCBPLCBN  PLCB ASSIGNED@OY12956 63630091
         BNOR  RCOUNT                   NO, CHECK NEXT TNT ENTR@OY12956 63631091
         ICM   RLCB,SEVEN,QCBPLCBA-IEDNQCB(RETURN) PLCB ADDR   @OY14493 63632091
         ICM   RETURN,ADDR,LCBSCBA-IEDQLCB(RLCB)  GET SCB ADDR @OY12956 63633091
         TM    SCBSTATE-IEDQSCB(RETURN),SCBLCK1N  IS IT LOCKED @OY12956 63634091
         BO    CHLCK04                  BR, YES                @OY12956 63635091
         BR    RCOUNT                   GET NEXT TNT ENTRY     @OY12956 63636091
CHLCK061 EQU   *                                                 Y02027 63644006
*** DELINK AND FREE CORE OF THE PEWA(SCB&T.R.T.)                 Y02027 63684006
         USING IEDQTRM,RPENTRY          TPROCESS TRM ENTRY     @OY14493 63694091
         L     RQCB,TRMDESTQ-1          RESTORE DEST QCB ADDR    Y02027 63704006
         DROP  RPEWA                    CHANGE PEWA BASE       @OY12956 63710091
         USING IEDQPEWA,RCOUNT                                 @OY12956 63716091
         SR    RCOUNT,RCOUNT            CLEAR REG                Y02027 63724006
         ICM   RCOUNT,SEVEN,RCBDSNM+ONE LOAD PEWA ADDR FROM RCB  Y02027 63744006
         BZ    PCBTEST                  BRANCH IF NO PEWA.       Y02027 63764006
         BAL   RETURN,LOCK              GET LOCAL AND CMS LOCKS@ZA02601 63774061
PEWADLNK EQU   *                                               @ZA02601 63784061
         L     RETURN,CVTPTR            LOAD CVT ADDR.           Y02027 63804006
         L     RETURN,CVTAQAVT-CVT(RETURN) LOAD TCX ADDR.        Y02027 63844006
         LA    RETURN,TCXPEWAC-IEDQTCX-PEWALINK+IEDQPEWA(RETURN)        63884061
*                                       DUMMY FIRST PEWA       @ZA02601 63924061
PEWADLN1 EQU   *                                               @ZA02601 63964061
         LR    RENTRY,RETURN            COPY PEWA ADDRESS      @ZA02601 64004061
         ICM   RETURN,ALL,PEWALINK-IEDQPEWA(RENTRY) NEXT PEWA  @ZA02601 64044061
         BZ    FREEPEWA                 END OF PEWA CHAIN      @ZA02601 64084061
         CR    RETURN,RCOUNT            THIS PEWA TO DELINK    @ZA02601 64124061
         BNE   PEWADLN1                 NO, GET NEXT PEWA      @ZA02601 64164061
         L     RETURN,PEWALINK-IEDQPEWA(RETURN) NEXT PEWA      @ZA02601 64204061
         CS    RCOUNT,RETURN,PEWALINK-IEDQPEWA(RENTRY)         @ZA02601 64244061
*                                       REMOVE PEWA            @ZA02601 64284061
         BNE   PEWADLNK                 RETRY IF FAILED        @ZA02601 64324061
FREEPEWA EQU   *                                                 Y02027 64364006
         BAL   RETURN,UNLOCKIT          RELEASE LOCKS          @ZA02601 64384061
         TM    PEWAGSW+ONE,ARESET       TEST FOR Q-RESET SPECD.  Y02027 64404006
         BNO   NOQRESET                 BRANCH IF NOT SPECIFID   Y02027 64444006
         DELETE EP=IEDQGQ               DELETE Q-RESET MODULE.   Y02027 64484006
         L     RPENTRY,PEWAPROC         LOAD PROC. ENTRY ADDR.   Y02027 64524006
         OI    TRMSTAT+THREE,QR         RESET Q-RESET SWITCH.    Y02027 64564006
NOQRESET EQU   *                                                 Y02027 64604006
         DROP  RCOUNT                                            Y02027 64644006
         USING IEDQPEWA,RPEWA           SET BASE.                Y02027 64684006
         SR    RCOUNT,RCOUNT            ZERO WORK REG.           Y02027 64724006
         IC    RCOUNT,AVTSCBSZ          PICK UP SCB SIZE.        Y02027 64764006
          LA    RCOUNT,PEWASIZE(,RCOUNT) ADD PEWA SIZE FOR FREEMZA00235 64769061
         TM    PEWAOPT2,PEWAIN          INPUT DCB                Y02027 64804006
         BNO   NOTRT1                   BR IF NOT INPUT          Y02027 64844006
         LA    RCOUNT,TRTLEN(,RCOUNT)   ADD TRT TABLE LENGTH   @OZ09293 64924091
NOTRT1   EQU   *                                                 Y02027 64964006
         LA    RTEMP,LCBCHAIN-IEDQLCB+FOUR ADJUST FOR LCB       OY00490 64974006
         AR    RCOUNT,RTEMP             ADD TO LENGTH           OY00490 64984006
         SR    RPEWA,RTEMP              ADDRESS TO FREE         OY00490 64994006
         LA    RTEMP,AVTDOUBL           PT. TO PEWA ADDR.        Y02027 65004006
         ST    RPEWA,AVTDOUBL           STORE PEWA ADDR.         Y02027 65044006
         BAL   RETURN,FREEMS            GO FREE PEWA.            Y02027 65084006
         B     PCBTEST                  GO CHECK PCB USE COUNT.  Y02027 65124006
         EJECT                                                          65164006
         SPACE 1                                                        65204006
*****************************************************************Y02027 65244006
******                       CLOSE OUTPUT DCB.                   Y02027 65284006
*****************************************************************Y02027 65324006
PUTQCBX  EQU   *                                                 Y02027 65364006
         SR    RENTRY,RENTRY            CLEAR FOR ICM            Y02027 65404006
         ICM   RENTRY,ADDR,PERAQCB+ONE  LOAD READ AHEAD ADDR.    Y02027 65444006
         BZ    NOBUF                    BRANCH IF RD-AHD EMPTY.  Y02027 65484006
         NI    PRFSTAT1-IEDQPRF(RENTRY),AVTEFF-PRFNLSTN  FLAG    Y02027 65524006
*                                       BUFFER AS EOM            Y02027 65544006
         MVC   PRFQCBA-IEDQPRF(THREE,RENTRY),PCBMH MH ADDR IN BFRY02027 65564006
         TM    RCBTCBFL,TERM            IS APPL TERMINATING    @ZA02601 65604061
         BZ    NOFLAG                   BRANCH IF NO           @ZA02601 65644061
         LA    RETURN,PEWASCB           LOAD SCB ADDR.           Y02027 65684006
         OI    SCBERR4-IEDQSCB(RETURN),SCBAPERR SET ERROR FLAG.  Y02027 65724006
NOFLAG   EQU   *                                                 Y02027 65764006
         LR    RETURN,RENTRY            COPY UNIT ADDR.          Y02027 65804006
         NC    NINE(2,RETURN),NINE(RETURN) LAST UNIT?          @OZ32188 65844086
         BZ    SETTIC                   BR, YES                @OZ32188 65854086
         ICM   RENTRY,SEVEN,NINE(RETURN)  NO, GET NEXT UNIT    @OZ32188 65864086
         B     NOFLAG                   CONT SCAN              @OZ32188 65874086
SETTIC   EQU   *                                               @OZ32188 65884086
         MVI   ELEVEN(RETURN),TWO       SET INVALID TIC ADDR.    Y02027 65924006
NOBUF    EQU   *                                                 Y02027 65964006
         LA    RQCB,PERAQCB                                             66200020
         LA    RTEMP,PEERB              ERB ADDRESS             SA51092 66210022
         LA    RENTRY,AVTBFRTB-FOUR     SIMULATE ELEMENT.        Y02027 66230006
         SR    RPARM,RPARM              CLEAR FOR ICM.           Y01004 66240005
         ICM   RPARM,ADDR,AVTBFRTB+ONE  TOP OF BUFFER RETURN Q.  Y01004 66245005
ERBLOOP  EQU   *                                                SA51092 66250022
         CLI   RECBPRI-IEDQRECB(RPARM),AVTEZERO END OF QUEUE    SA51092 66260022
         BE    NOTINQ                   BRANCH IF YES           SA51092 66270022
         CLR   RPARM,RTEMP              IS ERB IN QUEUE          Y01004 66280005
         BE    REMOVE                   BRANCH IF YES.           Y01004 66290005
         LR    RENTRY,RPARM             SAVE ELEMENT ADDR        Y02027 66310006
         ICM   RPARM,ADDR,RECBLINK-IEDQRECB(RPARM)  NEXT ELEMENT Y01004 66320005
         B     ERBLOOP                  GO CHECK THIS ONE       SA51092 66330022
REMOVE   EQU   *                                                SA51092 66340022
         DROP  RRECB                                             Y02027 66350006
         USING IEDQRECB,RENTRY          SET BASE.                Y02027 66352006
         MVC   RECBLINK(3),RECBLINK-IEDQRECB(RPARM) REMOVE ERB   Y02027 66354006
         DROP  RENTRY                                            Y02027 66356006
         USING IEDQRECB,RRECB           SET BASE.                Y02027 66358006
*                                       REMOVE ERB FROM QUEUE   SA51092 66360022
NOTINQ   EQU   *                                                SA51092 66370022
         ICM   RPARM,ADDR,QCBELCHN      GET ADDRESS OF PARTIAL   Y01004 66400005
*                                       BUFFER.                  Y01004 66500005
         CLM   RPARM,APPRI,AVTFZERO     WAS PARTIAL BUFFER SAVED Y01004 66600005
         BE    EMPTY                    BRANCH IF NO.            Y01004 66700005
         MVC   LCBERBCH-LCBERB(3,RTEMP),PRFLINK-IEDQPRF(RPARM)          67200020
         LH    RTEMP,PRFSIZE-IEDQPRF(0,RPARM)  BYTES OF DATA IN BFR     67400020
         N     RTEMP,AVTCLRHI           CLEAR HIGH-ORDER HALF           67600020
         CLI   TRMCHCIN,0               RECDEL SPECIFIED                69200020
         BE    NOBCTR                   BRANCH IF YES                   69400020
         BCTR  RTEMP,0                  ACCOUNT FOR RECDEL BYTE         69600020
NOBCTR   EQU   *                                                        69800020
         STH   RTEMP,PRFSIZE-IEDQPRF(0,RPARM) UPDATE PREFIX             70000020
         LA    RTEMP,PEWASCB            SCB ADDRESS                     70040020
         L     RPARM,PRFLCB-1-IEDQPRF(0,RPARM) LCB ADDRESS              70080020
         ST    RTEMP,LCBSCBA-1-IEDQLCB(0,RPARM) SCB ADDRESS             70120020
         ST    RPEWA,LCBERCCW-IEDQLCB(,RPARM) SAVE PEWA ADDRESS  A47139 70140021
         OI    LCBERBST-IEDQLCB(RPARM),LCBDLNKN  DELINK SWITCH   A42393 70160008
         SPACE 2                                                        70200020
EMPTY    EQU   *                                                        70400020
         LA    RPARM,PEERB              PUT SCHEDULER'S ERB             70600020
         NC    LCBERBCH-LCBERB(2,RPARM),LCBERBCH-LCBERB(RPARM)          70800020
*                                       ERB EMPTY                       71000020
         BE    PUTQCB                   BRANCH IF YES                   71200020
         LR    RTEMP,RPARM              ERB ADDRESS                     71400020
         L     RPARM,LCBERBCH-1-LCBERB(0,RPARM) ADDR OF FIRST BFR       71600020
         LA    RTEMP,AVTBFRTB                                           72000020
RLOOP    EQU   *                                                        72200020
         ST    RTEMP,0(0,RPARM)         BFR RETURN QCB ADDR             72400020
         MVI   4(RPARM),PRIBFRTB        BFR RETURN PRIORITY             72600020
         NC    5(2,RPARM),5(RPARM)      END OF CHAIN                    72800020
         BZ    TESTQCB                  BRANCH IF YES           SA51082 73000022
         L     RPARM,4(0,RPARM)         GET ADDR OF NEXT BUFFER         73200020
         B     RLOOP                    GO FIX THIS ONE                 73400020
         SPACE 2                                                        73420005
RETCLEAN EQU   *                                                SA67159 73440005
         ST    RQCB,PEWAELEM            SET QCB ADDRESS         SA67159 73460005
         MVI   PEWAELEM+4,RETPRI        SET PRIORITY            SA67159 73480005
         MVI   PEWAELEM+10,BLANK        SET RETRIEVE TERMINATIONSA67159 73500005
         LA    RPARM,PEWAELEM           ELEMENT ADDRESS         SA67159 73520005
         OI    PEWAFLG,CLOSFLG          SET CLOSEDOWN IN SESSIONSA67159 73540005
         BAL   RETURN,DSPPOST           POST ELEM TO EW        @G36XRNP 73570000
         EJECT                                                          73600020
PCBTEST  EQU   *                                                        73800020
         SR    RCOUNT,RCOUNT            CLEAR REGISTER TO ZERO          74000020
         IC    RCOUNT,PCBUCNT           PCB USE COUNT                   74200020
         BCTR  RCOUNT,RZERO             DECREMENT USE COUNT BY 1 Y01004 74400005
         STC   RCOUNT,PCBUCNT           PUT NEW USE COUNT IN PCB        74600020
         LTR   RCOUNT,RCOUNT            IS PCB USE COUNT ZERO    Y01004 74800005
         BNZ   DELETER                  BRANCH IF NO             Y02027 75000006
CLSPCB   EQU   *                                                 Y02027 75100006
         NI    DCBOFLGS-IHADCB(RPCB),AVTEFF-OPEN SET PCB UNOPENED       75300020
         MVI   PCBOFLG,NULL             CLEAR FLAG BYTE          Y02027 75400006
         XC    PCBASID,PCBASID          CLEAR ASID OF A.P.       Y02027 75408006
*** DELINK AND FREE THE PEB POINTED TO BY PCB.                   Y02027 75416006
         BAL   RETURN,LOCK              GET LOCAL AND CMS LOCKS@ZA02601 75418061
PEBDLNK  EQU   *                                               @ZA02601 75420061
         L     RWORK,PCBPEBAD           LOAD PEB PTR.            Y02027 75424006
         SR    RETURN,RETURN            CLEAR FOR STCM         @ZA02601 75432061
         STCM  RETURN,ALL,PEBTCB-IEDQPEB(RWORK) CLEAR TCB ADDR @ZA02601 75436061
         L     RETURN,CVTPTR            LOAD CVT ADDR.           Y02027 75440006
         L     RETURN,CVTAQAVT-CVT(RETURN) LOAD TCX ADDR         Y02027 75448006
         LA    RETURN,TCXPEBC-IEDQTCX(RETURN) ADDR OF PEB CHAIN@ZA02601 75456061
PEBDLNK1 EQU   *                                               @ZA02601 75464061
         LR    RENTRY,RETURN            COPY PEB ADDRESS       @ZA02601 75472061
         ICM   RETURN,ALL,PEBLINK-IEDQPEB(RENTRY) NEXT PEB     @ZA02601 75480061
         BZ    FREEPEB1                 END OF CHAIN           @ZA02601 75488061
         CR    RETURN,RWORK             THIS PEB TO DELINK     @ZA02601 75496061
         BNE   PEBDLNK1                 NO, GET NEXT PEB       @ZA02601 75504061
         L     RETURN,PEBLINK-IEDQPEB(RETURN) NEXT PEB         @ZA02601 75512061
         CS    RWORK,RETURN,PEBLINK-IEDQPEB(RENTRY) REMOVE-PEB @ZA02601 75520061
         BNE   PEBDLNK                  RETRY IF CS FAILED     @ZA02601 75528061
FREEPEB1 EQU   *                                               @ZA02601 75536061
         BAL   RETURN,UNLOCKIT          RELEASE LOCKS          @ZA02601 75544061
         LA    RWORK,DELETER            EXIT ADDRESS           @ZA02601 75552061
FREEPEB  EQU   *                                                 Y02027 75568006
         LA    RCOUNT,PEBSIZE           LOAD SIZE FOR FREEMAIN.  Y02027 75576006
         LA    RTEMP,PCBPEBAD           ADDR OF PTR TO PEB.      Y02027 75584006
         BAL   RETURN,FREEMS            GO FREE PEB.             Y02027 75592006
         XC    PCBJOBNA,PCBJOBNA        CLEAR JOBNAME          @ZA02601 76200061
         BR    RWORK                    EXIT SUBROUTINE        @ZA02601 76900061
         SPACE 2                                                SA51082 77620022
TESTQCB  EQU   *                                                SA51082 77640022
         NC    QCBELCHN(2),QCBELCHN     BUFFER SAVED            SA51082 77660022
         BNZ   PUTQCB                   BRANCH IF YES           SA51082 77680022
         LA    RTEMP,PEERB              ERB ADDRESSABILITY      SA51082 77700022
         MVC   QCBELCHN(3),LCBERBCH-LCBERB(RTEMP) SAVE CHAIN    SA51082 77720022
         XC    LCBERBCH-LCBERB(3,RTEMP),LCBERBCH-LCBERB(RTEMP)  SA51082 77740022
*                                       CLEAR CHAIN TO ZERO     SA51082 77760022
         B     PUTQCB                   CONTINUE TO CLOSE       SA51082 77780022
         EJECT                                                          77800020
CKPECBUF EQU   *                                                SA59000 77810022
         CLC   PEWACBUF+ONE(THREE),AVTDELAD+ONE BUFFER TO RETURN Y02027 77820006
         BE    ENQUEUE                  BRANCH IF NO            SA62376 77830005
         CLC   PEWACBUF+ONE(THREE),AVTFZERO  !UFFER TO RETURN    Y02027 77833006
         BE    ENQUEUE                  BRANCH IF NO            SA62376 77836005
         STM   RETURN,RBASE,AVTSAVE3+12 SAVE REGISTERS          SA59000 77840022
         LA    RTEMP,AVTBFRTB           BUFFER RETURN QUEUE     SA59000 77850022
         L     RPARM,PEWACBUF           FIRST BUFFER ON QUEUE.   Y02027 77860006
         MVC   PEWACBUF+ONE(THREE),PRFLINK-IEDQPRF(RPARM) CLOSE- Y02027 77865006
*                                                       CHAIN.   Y02027 77870006
         ST    RTEMP,PRFQCBA-1-IEDQPRF(,RPARM) SET QCB ADDRESS  SA59000 77880022
         MVI   PRFPRI-IEDQPRF(RPARM),PRIBFRTB SET PRIORITY      SA59000 77890022
         XC    PRFLINK-IEDQPRF(3,RPARM),PRFLINK-IEDQPRF(RPARM)  SA59000 77900022
*                                       SET LINK FIELD TO ZERO  SA59000 77910022
         BAL   RETURN,DSPPOSTR          PUT BFR ON READY QUEUE  SA59000 77920022
         LM    RETURN,RBASE,AVTSAVE3+12 RESTORE REGISTERS       SA59000 77930022
         B     CKPECBUF                 CONTINUE CHAIN SCAN     SA59000 77940022
         EJECT                                                          77950022
DELETER  EQU   *                                                 Y02027 78000006
         STM   RETURN,RBASE,AVTSAVE3+12  SAVE REGS              SA68210 78006005
         L     RTEMP,AVTSAVTP           SECONDARY AVT           SA68210 78012005
         LA    RTEMP,0(,RTEMP)          CLEAR HIGH BYTE        @YA05169 78013061
         TM    AVTSAVTF,AVTVTMCP        VTAM IN MCP?             X03039 78014008
         BZ    DONE                     NO IT IS NOT IN THE SYSTMX03039 78016008
         LA    RPARM,SAVTRQCH-IEDNSVTD-FOUR(RTEMP) INIT PREVIOUS        78024005
*                                                     ENTRY     SA68210 78030005
         L     RTEMP,SAVTRQCH-IEDNSVTD(RTEMP) APP PROG QUEUE   @ZA02065 78033061
GETNEXT  EQU   *                                                SA68210 78042005
         LA    RTEMP,ZERO(RTEMP)        CLEAR HO BYTE           SA68210 78048005
         LTR   RTEMP,RTEMP              END OF QUEUE           @YA05169 78050061
         BZ    DONE                     YES, BRANCH            @YA05169 78052061
         CLM   RTEMP,ADDR,AVTDELAD+1    DUMMY ELEMENT?         @ZA02602 78052661
         BE    DONE                     BR YES                 @ZA02602 78053261
         LR    RCOUNT,RTEMP             COPY RCB ADDRESS       @YA09755 78054009
         SH    RCOUNT,SIXTEEN           BACK UP TO AIB         @YA09755 78057009
         CLM   RPCB,ADDR,AIBPCBAD+1-IEDQAIB(RCOUNT)            @YA09755 78060009
*                                        AIB FOR THIS PCB      @YA09755 78066009
         BE    FOUND                    BRANCH IF YES          @YA09755 78072009
         LR    RPARM,RTEMP              SAVE (PREVIOUS) ENTRY   SA68210 78078005
         L     RTEMP,FOUR(RTEMP)        GET NEXT ENTRY          SA68210 78084005
         B     GETNEXT                  GO PROCESS NEXT ENTRY   SA68210 78090005
FOUND    EQU   *                                                SA68210 78096005
         MVI   AIBSTATE-IEDQAIB(RCOUNT),AIBFREE  FREE AIB      @YA09755 78102009
         MVC   AIBLINK-AIBKEY(3,RPARM),AIBLINK-AIBKEY(RTEMP)   @YA09755 78105009
*                                       DELINK ENTRY            SA68210 78108005
         LM    RETURN,RBASE,AVTSAVE3+12 RESTORE REGS            SA68210 78162005
DONE     EQU   *                                                SA68210 78168005
         L     RTEMP,TRMDESTQ-1         DESTINATION QCB ADDRESS         78200020
         XC    TRMSTAT(L3),TRMSTAT      CLEAR PROCESS ENTRY WORK X03039 78620008
*                                       AREA POINTER             X03039 78630008
         NI    TRMSTAT+3,QR             RESTORE QRESET FLAG      S22027 78640022
         CLI   0(RTEMP),QCBFQCB         PUT PROCESS ENTRY               78800020
         BE    DELETE1                                         @YA08086 79000009
         MVC   9(3,RTEMP),13(RTEMP)     RESTORE DEST SCHED STCB         79200020
DELETE1  EQU   *                                               @YA08086 79400009
*                                                              @YA08086 79450009
*  IF THERE ARE NO ACTIVE PCB'S, DELETE THE                    @YA08086 79500009
*  SCHEDULERS NOW                                              @YA08086 79550009
*                                                              @YA08086 79600009
         L     RLCB,AVTSAVE2            RESTORE INDEX REG        Y02027 79640009
         L     RTEMP,AVTPCBPT                                  @YA08086 79680009
PCBLOOP  EQU   *                                               @YA08086 79720009
         LA    RTEMP,0(,RTEMP)          CLEAR HIGH-ORDER BYTE  @YA08086 79760009
         LTR   RTEMP,RTEMP              NO ACTIVE PCB'S        @YA08086 79800009
         BZ    DELETE2                  BRANCH IF YES          @YA08086 79850009
         CLI   PCBUCNT-IEDQPCB(RTEMP),ZERO  PCB ACTIVE         @YA08086 79900009
         BNE   CLEANUP                  BRANCH IF YES          @YA08086 79950009
         L     RTEMP,PCBLINK-1-IEDQPCB(,RTEMP)  NEXT PCB       @YA08086 80000009
         B     PCBLOOP                  YES CHECK THIS ONE     @YA08086 80030009
DELETE2  EQU   *                                               @YA08086 80060009
         L     RTEMP,CVTPTR             CVT ADDR               @YA08086 80090009
         L     RTEMP,CVTAQAVT-CVT(,RTEMP)  TCX ADDR            @YA08086 80120009
         CLI   TCXPUTQ+ONE-IEDQTCX(RTEMP),AVTEZERO             @YA08086 80150009
*                                       DELETE PUT SCHED       @YA08086 80180009
         BE    TRYEW                    BRANCH IF NO           @YA08086 80210009
         MVI   MNAME+5,PS               MODULE IDENTIFIER      @YA08086 80240009
         BAL   RETURN,DELE              DELETE PUT SCHEDULER   @YA08086 80270009
         XC    AVTEC,AVTEC              CLEAR DISP TABLE ENTRY @YA08086 80300009
         XC    TCXPUTQ-IEDQTCX(,RTEMP),TCXPUTQ-IEDQTCX(RTEMP)  @YA08086 80330009
*                                       CLEAR TCX PUT SCHED ADD@YA08086 80360009
*                                       CLEAR TCX PUT SCHED ADD@YA08086 80390009
TRYEW    EQU   *                                               @YA08086 80420009
         CLI   TCXGETQ+ONE-IEDQTCX(RTEMP),AVTEZERO  DELETE     @YA08086 80450009
*                                       GET SCHED              @YA08086 80480009
         BE    CLEANUP                  BRANCH IF NO           @YA08086 80510009
         MVI   MNAME+5,GS               MODULE IDENTIFIER      @YA08086 80540009
         BAL   RETURN,DELE              DELETE GET SCHEDULER   @YA08086 80570009
         XC    AVTEW,AVTEW              CLEAR DISP TABLE ENTRY @YA08086 80600009
         XC    TCXGETQ-IEDQTCX(,RTEMP),TCXGETQ-IEDQTCX(RTEMP)  @YA08086 80630009
*                                       CLEAR GET SCHED ADDR   @YA08086 80660009
*                                       CLEAR GET SCHED ADDR   @YA08086 80690009
         CLI   TCXPNTQ+1-IEDQTCX(RTEMP),AVTEZERO  POINT LOADED @OZ09921 80700091
         BE    CLEANUP                  BR NO                  @OZ09921 80710091
         MVI   MNAME+5,PTS              MODULE IDENTIFIER      @YA08086 80720009
         BAL   RETURN,DELE              DELETE POINT           @OZ09921 81200091
         XC    TCXPNTQ-IEDQTCX(,RTEMP),TCXPNTQ-IEDQTCX(RTEMP)  @OZ09921 81250091
*                                       CLEAR POINT ADDR       @OZ09921 81300091
         B     CLEANUP                  BR TO EXIT             @OZ09921 81350091
DELE     EQU   *                                                        81400020
         DELETE EPLOC=MNAME                                             81600020
         BR    RETURN                   RETURN TO CALLER                81800020
SETFEFO  EQU   *                                                SA55382 82160700
         TM    PEWAFLG,PEWASTOP         PROCESS ENTRY DISABLED  SA63961 82160952
         BO    DSPPOSTR                 BRANCH IF YES           SA63961 82161152
         NC    PERAQCB+1(3),PERAQCB+1  IS BUFFER ON READ AHEAD  SA55382 82161400
         BZ    DSPPOSTR                NO, POST                 SA55382 82162100
         CLC   PERAQCB+1(3),AVTDELAD+1 DUMMY END ON RD AHD      SA55382 82162800
         BE    DSPPOSTR                YES POST                 SA55382 82163500
         L     RPENTRY,PERAQCB         GET PTR FORM READ ADHEADQSA55382 82164200
         CLC   PRFTQBCK-IEDQPRF(1,RPENTRY),PRFTQBCK-IEDQPRF(RPARM) 5382 82164900
*                                      SAME PRIORITY            SA55382 82165600
         BNE   DSPPOSTR                NO, POST                 SA55382 82166300
         LA    RWORK,PRFCRCD-IEDQPRF(RPENTRY) ASSUME HDR       @OY15028 82167091
         TM    PRFSTAT1-IEDQPRF(RPENTRY),PRFNHDRN IS IT HDR     SA55382 82169100
         BNO   HDROK                   YES, FINISH              SA55382 82169800
         LA    RWORK,PRFCHDR-IEDQPRF(RPENTRY) GET HDR ADDRESS  @OY15028 82170591
HDROK    EQU   *                                                SA55382 82171900
         TM    TWO(RWORK),DISK          IS IT DISK POINTER     @OY15028 82172691
         BNZ   DISKFEFO                 BRANCH IF YES          @OY15028 82173191
         ICM   RWORK,ADDR,AVTEZERO(RWORK) CORE COPY OF HDR     @OY15028 82173691
         LA    RWORK,PRFCRCD-IEDQPRF(RWORK) GET DISK POINTER   @OY15028 82174191
DISKFEFO EQU   *                                                SA55382 82174700
         MVC   PRFSRCE-IEDQPRF(3,RPARM),AVTEZERO(RWORK) SET    @OY15028 82175491
*                                       FEFO POINTER FOR FA    @OY15028 82175791
         B     DSPPOSTR                POST THE BUFFER          SA55382 82178900
         EJECT                                                          82180022
* S U B R O U T I N E S                                          Y01004 82180205
         SPACE 2                                                        82180405
GETMS    EQU   *                        GETMAIN SUBROUTINE.      Y01004 82180605
*              FOR GETMAIN, REG 6=SIZE AND REG 7=SUBPOOL         Y02027 82180806
         GETMAIN RC,LV=(RCOUNT),SP=(RWORK)                     @ZA02601 82181861
         LTR   RENTRY,RENTRY            WAS GETMAIN SUCCESSFUL @ZA02601 82182061
         BZ    GO                       BRANCH IF YES          @ZA02601 82182261
         SR    RLCB,RLCB                CLEAR REGISTER NINE    @ZA02601 82182461
         MVI   RCBERR,ERRCODE           SET OUT-OF-CORE RETURN @ZA02601 82182661
         CLM   RLCB,HIGH,PCBUCNT        FIRST OPEN FOR PCB     @ZA02601 82182861
         BNE   ERROR                    NO, BRANCH             @ZA02601 82183061
         BAL   RWORK,FREEPEB            FREE GOTTEN            @ZA02601 82183261
*                                       CONTROL BLOCKS         @ZA02601 82183461
         B     ERROR                    GO ACTIVATE PUT/WRITE.   Y01004 82184405
GO       EQU   *                                                 Y01004 82184605
         LR    RWORK,RPARM              ADDRESS OF GOTTEN AREA   Y02027 82184806
CLEARLP  MVI   ZERO(RWORK),ZERO         ZERO BYTE                Y02027 82185006
         LA    RWORK,ONE(,RWORK)        PT TO NEXT BYTE          Y02027 82185106
         BCT   RCOUNT,CLEARLP           ZERO ENTIRE AREA         Y02027 82185206
         BR    RETURN                   RETURN TO CALLER.        Y01004 82185605
         SPACE 2                                                        82185805
FREEMS   EQU   *                        FREEMAIN SUBROUTINE.     Y01004 82186005
         NC    ONE(L3,RTEMP),ONE(RTEMP) IS AN AREA TO BE FREED   Y01004 82186205
         BCR   EIGHT,RETURN             RETURN TO CALLER IF NO.  Y01004 82186405
         ST    RTEMP,AVTSAVE3+FOUR      STORE POINTER TO ADDR  @ZA06620 82186609
*                                        OF AREA TO BE FREED   @ZA06620 82186809
         ST    RCOUNT,AVTSAVE3          SET BYTE COUNT IN FREE-@ZA06620 82187009
*                                        MAIN PARM LIST        @ZA06620 82187209
         MVI   AVTSAVE3+NINE,SPCSANFP   SET SUB POOL NUMBER    @ZA06620 82187409
         MVI   AVTSAVE3+EIGHT,MACTYPE   SET MACRO TYPE         @ZA06620 82187609
         LA    RPARM,AVTSAVE3           FREEMAIN PARM LIST ADDR@ZA06620 82187809
         FREEMAIN ,MF=(E,(1))           FREE MAIN STORAGE      @ZA02601 82188261
         SR    RPARM,RPARM              CLEAR FOR STCM         @ZA02601 82188461
         STCM  RPARM,ADDR,ONE(RTEMP)    CLEAR POINTER          @ZA02601 82188661
         BR    RETURN                   RETURN TO CALLER.        Y01004 82189005
         SPACE 2                                                        82189205
LOADER   EQU   *                        LOAD SUBROUTINE.         Y01004 82189405
         L     RTEMP,CVTPTR             GET CVT ADDRESS          Y01004 82189605
         L     RTEMP,CVTLINK-CVT(RTEMP) ADDR. OF LINKLIB DCB.    Y02027 82189806
         LOAD  EPLOC=MNAME              TEMP. OMIT DCB ADDR      Y02027 82190006
         BR    RETURN                   RETURN TO CALLER.        Y01004 82190205
LOCK     EQU   *                                               @ZA02601 82190461
         STM   RZERO,RENTRY,RCBSAVE     SAVE REGS              @ZA02601 82190761
         MODESET MODE=SUP               GET IN SUPER STATE     @ZA02601 82191061
         MODESET EXTKEY=SUPR            GET INTO KEY ZERO      @ZA02601 82191361
LOCALGET SETLOCK OBTAIN,TYPE=LOCAL,MODE=UNCOND,                @ZA02601X82191661
               RELATED=(PEBPEWA,IEDQEU(LOCALREL),IEDQOT01(LOCALREL),IGGX82191961
               02046(LOCALREL))                                @ZA02601 82192261
CMSGET   SETLOCK OBTAIN,TYPE=CMS,MODE=UNCOND,                  @ZA02601X82192561
               RELATED=(PEBPEWA,IEDQEU(CMSREL),IEDQOT01(CMSREL),IGG0204X82192861
               6(CMSREL))                                      @ZA02601 82193161
         LM    RZERO,RENTRY,RCBSAVE     RESTORE REGS           @ZA02601 82193461
         BR    RETURN                   RETURN TO CALLER       @ZA02601 82193761
UNLOCKIT EQU   *                                               @ZA02601 82194061
         STM   RZERO,RENTRY,RCBSAVE     SAVE REGS              @ZA02601 82194361
CMSREL   SETLOCK RELEASE,TYPE=CMS,                             @ZA02601X82194661
               RELATED=(PEBPEWA,IEDQEU(CMSGET),IEDQOT01(CMSGET),IGG0204X82194961
               6(CMSGET))                                      @ZA02601 82195261
LOCALREL SETLOCK RELEASE,TYPE=LOCAL,                           @ZA02601X82195561
               RELATED=(PEBPEWA,IEDQEU(LOCALGET),IEDQOT01(LOCALGET),IGGX82195861
               02046(LOCALGET))                                @ZA02601 82196161
         USING *,RETURN                 ADDRESSABILITY         @ZA02601 82196461
         MODESET EXTKEY=TCAM            RETURN TO TCAM KEY     @ZA02601 82196761
         MODESET MODE=PROB              RETURN TO PROBLEM STATE@ZA02601 82197061
         DROP  RETURN                                          @ZA02601 82197361
         LM    RZERO,RENTRY,RCBSAVE     RESTORE REGS           @ZA02601 82197661
         BR    RETURN                   RETURN TO CALLER       @ZA02601 82197961
         EJECT                                                 @ZA02601 82198261
*   C O N S T A N T S   A N D   E Q U A T E S   *                       82200020
*                                               *                       82400020
         DS    0H                                                       82600020
PATCH    DC    10F'0'                   PATCH AREA               Y02027 82700006
HONE     DC    H'1'                     SET HALFWORD TO 1        S22025 83000022
SIXTEEN  DC    H'16'                    CONSTANT               @YA09755 83100009
MNAME    DC    CL8'IEDQE'               BASE FOR MODULE ID       S22025 83300022
XE0      EQU   X'E0'                    TERM ENTRY MASK        @OY12956 83360091
PTS      EQU   C'S'                     POINT ROUTINE SUFFIX.    Y02027 83400006
POINT    EQU   X'04'                    RCB MASK FOR POINT     @OZ09921 83404091
TWELVE   EQU   12                       CONSTANT                 Y02027 83408006
GETSCHD  EQU   X'10'                    GET SCHD. VTO.           Y02027 83416006
PSVTO    EQU   X'12'                    PUT SCHEDULAR VTO        Y02027 83424006
SPLCB    EQU   250                      SUBPOOL FOR LCB IN MCP   Y02027 83432006
TRTLEN   EQU   256                      TRT TABLE LEN          @OZ09293 83440091
FOURTEEN EQU   14                       OBVIOUS.                 Y02027 83448006
HEX80    EQU   X'80'                    OBVIOUS.                 Y02027 83456006
PHYSSEQ  EQU   X'40'                    PHYSICAL SEQ. BIT.       Y02027 83464006
THREE    EQU   3                        OBVIOUS.                 Y02027 83472006
NULL     EQU   0                        OBVIOUS.                 Y02027 83480006
ERBKEY   EQU   0                        ERB KEY.                 Y02027 83488006
ERBPRI   EQU   X'D0'                    ERB PRIORITY.            Y02027 83496006
NTFND    EQU   X'0F'                    PROC. ENTRY NOT FND.     Y02027 83504006
INUSE    EQU   X'0C'                    PROC. ENTRY IN USE       Y02027 83512006
INVAL    EQU   X'0F'                    INVALID OPEN 043-2     @OZ11167 83512291
QSPEC    EQU   X'70'                    TYPE QUEUING SPECIFIED @OZ11167 83512491
*                                       10=REUS,20=NREUS,40=COR@OZ11167 83512691
PCBINVLD EQU   X'20'                    PCB ALREADY IN USE     @ZA02601 83513061
TERM     EQU   X'C0'                    NORM AND ABNORM TERM   @ZA02601 83514061
QOT1     DC    C'QOT1'                  SPECIAL ID FOR RTM     @ZA02601 83517061
TERMNATE EQU   X'40'                    BIT IN RECB TO INDIC. A.PY02027 83520006
*                                       IS IN TERMINATOR MODULE. Y02027 83528006
TWNTY3   EQU   23                       NUMB OF BITS FOR SHIFT.  Y02027 83536006
IEDQLINE EQU   X'40'                    BIT IN DSORG+1 FOR TCAM  Y02027 83544006
UNLOCK   EQU   X'D7'                    UNLOCK BITS.             Y02027 83552006
X30      EQU   X'30'                    EQUATE                   Y02027 83560006
X80      EQU   X'80'                    EQUATE                   Y02027 83568006
X40      EQU   X'40'                    HM FLAG IN LCBINSRC+2  @OY14493 83572091
ABND     EQU   X'80'                    ABEND BIT IN TCBFLGS.    Y02027 83576006
ELEVEN   EQU   11                       EQUATE                   Y02027 83584006
SECURE   EQU   1                        SECURE QUEUES            Y02027 83592006
TIC      EQU   X'08'                    TIC                      Y02027 83594006
SEVEN    EQU   7                        MASK FOR ICM/STCM        Y02027 83596006
GS       EQU   C'W'                                                     83600020
PS       EQU   C'C'                                                     83800020
ZERO     EQU   0                                                        84800020
DISK     EQU   3                                                SA55382 84860000
EIGHT    EQU   8                                                SA55382 84920000
ERRCODE  EQU   1                                                        85000020
OPENFLG  EQU   X'08'                                                    85200020
RAQCBPRI EQU   5                                                        85800020
RAQCBKEY EQU   0                                                        86000020
APPRI    EQU   6                                                        86200020
XC2      EQU   X'C2'                    DUMMY IOS FLAGS        @ZA03745 86500009
PRFRESET EQU   X'20'                    QRESET BUFFER FLAG      SA65388 86800008
OPEN     EQU   X'10'                    PCB OPEN FLAG                   87500020
CLOSFLG  EQU   X'40'                    CLOSE-IN-PROGRESS FLAG          87570020
ONE      EQU   1                        OFFSET OF ONE.           Y01004 87570305
TWO      EQU   2                        OFFSET OF TWO.           Y01004 87570605
L3       EQU   3                        OFFSET OF THREE.         Y01004 87570905
FOUR     EQU   4                        OFFSET OF FOUR.          Y01004 87571205
FIVE     EQU   5                        OFFSET OF FIVE.          Y01004 87571505
SIX      EQU   6                        OFFSET OF SIX.           Y01004 87571805
ADDR     EQU   7                        ICM/STCM/CLM MASK FOR    Y01004 87572105
*                                       ADDRESSES.               Y01004 87572405
HIGH     EQU   8                        ICM/STCM MASK          @ZA02601 87572561
ALL      EQU   15                       ICM/STCM MASK          @ZA02601 87572661
NINE     EQU   9                        OFFSET OF NINE.          Y01004 87572705
SPCSANFP EQU   231                      SUBPOOL FOR CSA, USER    Y02027 87574806
*                                         KEY, & NOT FTCH PROT.  Y02027 87574906
MACTYPE  EQU   X'20'                    GETMAIN/FREEMAIN MACRO   Y01004 87575105
*                                       TYPE.                    Y01004 87575405
*                                       AREA PREFIX              S22027 87582022
*                                       BY IEDQGQ                       87594022
QR       EQU   X'01'                    QUEUE RESET FLAG         S22027 87597022
BLANK    EQU   X'40'                    RETRIEVE TERMINATION    SA67159 87598005
RETPRI   EQU   X'50'                    RETRIEVE ELEM PRIORITY  SA67159 87599005
PARTOFF  EQU    X'FD'                    TURN OFF PART BUF     @SA71519 87599561
PUTDELAY EQU   X'D6'                    PUT TIME DELAY FLAG    @XA11307 87599709
X44      EQU   X'44'                    OFFSET OF REG 14       @OY14493 87599891
CHECKPT  EQU   X'20'                    TCAM CHECKPOINT        @G36XRNP 87599900
         EJECT                                                          87600020
*        PARAMETER LIST FOR SCHEDULE SRB FUNCTION OF SVC 102 * @Z40X9NG 87606009
         SPACE 1                                               @Z40X9NG 87612009
SSRBSECT DSECT                                                 @Z40X9NG 87618009
SSRBENTC DS    XL1                      ENTRY CODE             @Z40X9NG 87624009
SSRBCODE EQU   X'2C'                    ENTRY CODE = '2C'      @Z40X9NG 87630009
SSRBECBA DS    AL3                      ADDRESS OF ECB         @Z40X9NG 87636009
SSRBASCB DS    A                        ADDRESS OF ASCB        @Z40X9NG 87642009
SSRBCC   DS    XL1                      COMPLETION CODE        @Z40X9NG 87648009
         DS    XL1                      UNUSED                 @Z40X9NG 87654009
SSRBASID DS    H                        ASID                   @Z40X9NG 87660009
SSRBTCB  DS    A                        TCB ADDRESS            @Z40X9NG 87666009
         SPACE 4                                               @Z40X9NG 87672009
*********************************************************************** 87678009
*                *                                                    * 87684009
*    SSRBENTC    *                      SSRBECBA                      * 87690009
*                *                                                    * 87696009
*********************************************************************** 87702009
*                                                                     * 87708009
*                              SSRBASCB                               * 87714009
*                                                                     * 87720009
*********************************************************************** 87726009
*                *                 *                                  * 87732009
*    SSRBCC      *                 *             SSRBASID             * 87738009
*                *                 *                                  * 87744009
*********************************************************************** 87750009
*                                                                     * 87756009
*                              SSRBTCB                                * 87762009
*                                                                     * 87768009
*********************************************************************** 87774009
         EJECT                                                 @Z40X9NG 87780009
*                                    *                                  87800020
* * * *    D  S  E  C  T  S    * * * *                                  88000020
*                                    *                                  88200020
         SPACE 2                                               @YA09755 88210009
         TAIBD                                                 @YA09755 88220009
         EJECT                                                 @YA09755 88230009
         TCPBD 3330                                              S21101 88250021
         EJECT                                                          88300020
         TPRIOR                                                         88600020
         TTCBD                                                          88800020
         TAVTD ,                        ADDRESS VECTOR TABLE    SA52971 89000022
         TRECBD                         RESOURCE CONTROL BLOCK          89200020
*****************************************************************Y02027 89206006
*****    RCB EXTENSION FOR TCAM APPLICATION OPEN/CLOSE.          Y02027 89212006
*****************************************************************Y02027 89218006
RCBPECB  DS    F                        A. P. PECB ADDR          Y02027 89224006
RCBASCB  DS    F                        A. P. ASCB ADDR          Y02027 89230006
RCBERRET DS    0F                       ERROR RTN ADDR           Y02027 89236006
RCBASID  DS    F                        APPLIC. PGM ASID ADDR.   Y02027 89242006
RCBTCB   DS    F                        APPLIC. PGM TCB ADDR.    Y02027 89248006
RCBDCBMA DS    H                        DCBMACRF FROM APPLIC.    Y02027 89254006
RCBTCBFL DS    0X                       APPLIC. TCB FLAGS.       Y02027 89260006
RCBDCBDS DS    H                        DCBDSORG FROM APPLIC.    Y02027 89266006
RCBDSNM  DS    CL8                      PROCESS QUEUE NAME.      Y02027 89272006
RCBDEBAD DS    F                        DEB ADDR FOR APPLIC. DCB.Y02027 89278006
RCBDCBBU DS    H                        DCBBUFL FROM APPLIC.     Y02027 89284006
RCBDCBLR DS    H                        DCBLRECL FROM APPLIC.    Y02027 89290006
RCBDCBOP DS    X                        DCBOPTCD FROM APPLIC.    Y02027 89296006
RCBDCBRF DS    X                        DCBRECFM FROM APPLICATIONY02027 89302006
RCBDCBF1 DS    X                        DCBFLAG1 FROM APPLICATIONY02027 89308006
RCBERR   DS    X                        ERROR INDICATOR          Y02027 89314006
RCBJOBNM DS    CL8                      JOBNAME                  Y02027 89317006
RCBSAVE  DS    18F                      SAVE AREA FOR IEDQEU   @ZA02601 89318061
RCBEND   DS    0X                       END OF DSECT.            Y02027 89320006
         ORG   RCBTCB                                                   89326006
RCBDEBTA DS    H                        OFFSET IN T.T. FOR ENTRY.Y02027 89332006
RCBOPECB DS    0AL3                     OPCTL ECB ADDRESS        Y02027 89338006
RCBDEBPW DS    AL3                      ADDR. OF PEWA.           Y02027 89344006
RCBDEBPC DS    AL3                      ADDR. OF PCB.            Y02027 89350006
         DS    2F                       QNAME                    Y02027 89356006
RCBSQ    DS    0X                       SECURE QUEUE FLAG        Y02027 89362006
RCBAVTBT DS    X                        AVTBIT1 ON RETURN FROM EUY02027 89368006
RCBPEBAD DS    AL3                      ADDR OF PEB IN CSA.      Y02027 89374006
RCBSIZE  EQU   RCBEND-RECBKEY           SIZE OF DSECT.           Y02027 89380006
         TQCBD                                                          89400020
         TTNTD                                                 @OY12956 89500091
         TDISPD                                                         89600020
         TTRMD                                                          89800020
         TSCBD                                                          90000020
         TLCBD                                                          90200020
LCBLEN   EQU   LCBCPA+56-IEDQLCB        APPL PGM LCB LENGTH    @SA74021 90400009
         TPEWAD                                                         90600020
         TPCBD                                                          90800020
         EJECT                                                          90850086
         TPROCD                                                @OY20522 90900086
         TPRFD                                                          91000020
         DCBD  DSORG=TX                                                 91100020
         TDEBD                                                          91150006
         IHAPSA                                                  Y02027 91157006
CVT      DSECT                                                   Y02027 91164006
         CVT                                                     Y02027 91171006
         TTCXD                                                   Y02027 91178006
         TCKPD                                                   Y02027 91185006
         TPEBD                                                   Y02027 91192006
         END                                                            91200020
