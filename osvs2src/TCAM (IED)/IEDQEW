EW01     TITLE '''IEDQEW'' - TCAM GET SCHEDULER'                        00010006
IEDQEW   CSECT                                                          00020006
*A000000-999999                                                @X31X8A0 00023008
         SPACE 3                                                        00026008
**************************** MICROFICHE FLAGS *************** SUPT CODE 00030006
*CHANGE-ACTIVITY = AS FOLLOWS:                                  SA21903 00040006
*D250000-251000                                                 SA55392 00050006
*C454000                                                        SA55392 00060006
*C164000                                                        SA54921 00070006
*A341640                                                        SA54271 00080006
*C341725-341733                                                 SA54271 00090006
*C495000                                                        SA54942 00100006
*A655000                                                        SA54942 00110006
*A603000,133000                                                  A47127 00120006
*C102600,663000                                                  A47127 00130006
*A121000,156000,167000,253500,328000,402000,539000,544000,567000 S21101 00140006
*A686000,539500                                                  S21101 00150006
*C 149000,201000,337000,509000,439000-443000,578000-580000       S21101 00160006
*C504000                                                         S21101 00170006
*D 142000-143000,149000,161000-165000,201000,222000-232000       S21101 00180006
*D 314000-315000,317000,346000-351000,362000,383340-385100       S21101 00190006
*D 412000,436000,452000,498500-501000,505000                     S21101 00200006
*D 548000,550000-551000,565000,570000,625000                     S21101 00205006
*D 629000,669000-673000,696000-697000,709000                     S21101 00210006
*A340000                                                        SA56624 00215006
*C655000                                                        SA56624 00220006
*A485000                                                        SA59016 00225006
*D506000                                                        SA59016 00230006
*D693000                                                        SA58456 00235006
*A695000,748600                                                 SA58456 00240006
*A205500                                                        SA55392 00245006
*C102600,424000,424400,424720,748000                             A47133 00300006
*C006400-118000,143120,149000,151000,153000,162000,166000,166500 Y02027 00300106
*C167284,167292,167552,167560,167596-167626,167782,167839,167856 Y02027 00300206
*C168000,178000,183000,198000,200000,208000-209000,247000,261000 Y02027 00300306
*C266000,270000-274600,279000-286000,289000,291000,301070,301000 Y02027 00300406
*C310000,319000,321000,323000,328700,3300000,332000,338000,339000Y02027 00300506
*C340000,344000,353000,361000,369000,378000,387000,396000,405000 Y02027 00300606
*C414000,433000-434000,449000,473200,482000,485500,486000,487000 Y02027 00300706
*C488000-490000,493000,497120,497280,497400,497480,497520,497560 Y02027 00300806
*C497600,497840-497880,519000,521000,525000,527000,530000,534000 Y02027 00300906
*C536000,544100,555000,556030,556180-556360,557000,585000,586300 Y02027 00301006
*C621620,621680,622000,630000,631000-632500,636000-637000,639000 Y02027 00301106
*C649000,655600-658000,662000-662500,664400,666000,674300,695400 Y02027 00301206
*C695600,696200,696800,698000,728000,746000,746200,748300,748600 Y02027 00301306
*C750000,033600                                                  Y02027 00301406
*A142700,156520-156500,165800,166200,199500,205800,213500        Y02027 00301506
*A247200-247600,290500,301070-301840,338500,344500,449500,473300 Y02027 00301606
*A486500,487500,519500,584500,620200-620600,624800,630500,639500 Y02027 00301706
*A642500,650100-650600,655600-655700,666800-673200,674400        Y02027 00301806
*A686850-686950,721200,724300-724800,725400-727400,72900         Y02027 00301906
*A746010-746110,748400-748500,748700,032950,033605-033620,267500 Y02027 00302006
*D148500,149500-150000,152000,154000-155000,167000,167220-167240 Y02027 00302106
*D167774-167778,190000-191000,210000,240000-243000,254000        Y02027 00302206
*D293000-298000,353300-360000,363000-368000,370000-377000        Y02027 00302306
*D379000-386000,388000-394600,397000-4040000,405200-413000       Y02027 00302406
*D414500-432000,439000-448000,439000-448000,450000-473000        Y02027 00302506
*D494000-496000,497640,497760,516000,522000,556390,599000-611000 Y02027 00302606
*D621040,821080,621120,621340,633000,658500,697400               Y02027 00302706
*D701000,702000,703000-705000,718000-719000,722000-723000,731000 Y02027 00302806
*D733000,735000-742000,748800,751000,752000,764000               Y02027 00302906
*A353300-353600,383100,431600-431700,461100-461500              SA60013 00305105
*D453000-454000                                                 SA60013 00305205
*A556640-556650                                                 SA60004 00305305
*A341290,341361,405000,721000                                    S22024 00305405
*C466600-467000                                                 SA60322 00305505
*D247500,438500,445000                                          SA61747 00305605
*A280000                                                        SA62970 00305705
*C291000-292000                                                 SA62970 00305805
*D295000,299000                                                 SA62970 00305905
*A167309-167339                                                 SA62953 00306005
*C167299                                                        SA62953 00306105
*A470000                                                        SA63027 00306205
*C159000,185000,202000,205600,476000                            SA63961 00316252
*C160000,186000,203000,205700,477000                            SA63961 00326252
*A695000                                                        SA63961 00336252
*A603000                                                        SA63985 00346252
*C133200-134500                                                 SA65385 00386252
*A309500                                                        SA65388 00426252
*A291000,663000                                                 SA67159 00446254
*C290500,663100                                                @ZA01105 00446561
*A519000                                                       @SA64355 00446861
*C461300,592000                                                @SA68228 00447161
*A674600                                                       @SA68228 00447461
*D240000-241000                                                @SA69091 00447761
*C196000                                                       @SA69658 00448061
*A031550,033150                                                @ZA00203 00448361
*A091245-091260                                                @SA69973 00448661
*A655000                                                       @ZA02616 00456661
*A488000,658500                                                 SA67792 00466254
*A341320                                                         X03039 00466308
*C006900,341361                                                  X03039 00466408
*C746200-747600,495000,497600,497560                             S21903 00500006
*A394000,399000                                                 SA56234 00510006
*D726000-727000,729000-730000,732000,743000-744000               S21903 00520006
*A353300-353600,383100,431600-431700,461100-461500              SA60013 00530006
*D453000-454000                                                 SA60013 00540006
*A556640-556650                                                 SA60004 00550006
*A286000                                                       @SA69063 00550161
*A186000                                                       @SA71093 00550261
*C663000                                                       @SA71938 00550361
*A696200                                                       @YA06305 00550461
*A654000,661000                                                @XA05282 00550561
*C592000,684000                                                @XA05282 00550661
*A121197                                                       @ZA01154 00550761
*D294000-297000                                                @ZA02059 00550861
*C186600                                                       @SA73367 00550961
*A184000                                                       @SA73367 00551061
*C663000,663300                                                @SA74016 00552061
*A006000                                                       @Z30X8AM 00553008
*C086000                                                       @ZA02645 00553581
*A090000,323000,654500,672400,090200                           @ZA03050 00554081
*C493000,497520,650200                                         @ZA03050 00554581
*D318000-319000,655500                                         @ZA03050 00555081
*A661000                                                       @ZA02649 00555581
*A245000,748000                                                @ZA03097 00555681
*D556480-556630,556660-556690                                  @YA09297 00555781
*A639500                                                       @YA09297 00555881
*D098500-116000                                                @SA75446 00555981
*A084600,085350,748400                                         @ZA05000 00556081
*D746100,746110                                                @ZA05000 00556181
*C085070                                                       @ZA05000 00556281
*C289000,663100                                                @OZ07798 00556381
*C643300-644100                                                OZ07100  00556481
*A283000,290000,291000                                         @OY11980 00556581
*D696400-696600                                                @OS76679 00556681
*A158000                                                       @OS77017 00556781
*C025070                                                       @OZ09292 00556881
*D027810                                                       @OZ09292 00556981
*A022420                                                       @OZ09927 00557081
*A642500,748240,686900                                         @OZ11164 00557181
*A086120                                                       @OZ08360 00557281
*C643500-644600                                                @OZ11164 00557381
*C044100,044500                                                @OZ14162 00557481
*A290300                                                       @OY14498 00557581
*C290030                                                       @OY14498 00557681
*A663000,746090                                                @OZ11199 00557781
*A489500                                                       @OZ15631 00557881
*C655100-655200                                                @OZ15631 00557981
*A047300,674600,649000,748270                                  @OY15490 00558081
*A695000                                                       @OZ17615 00558181
* A000000,005581,024200,024500,086080,086120,086130,086140,    @G36XRAW 00558210
* A143000,143100,143120,143140,156600,156700,159000,160000,    @G36XRAW 00558310
* A185000,186000,198000,199000,202000,203000,205600,205700,    @G36XRAW 00558410
* A650300,663200,663300,672600,672800                          @G36XRAW 00558510
* C000230,006020,024300,086120,086140,086600,091480,121199,    @G36XRAW 00558610
* C125000,143100,143140,153000,156700,160000,165200,184400,    @G36XRAW 00558710
* C186000,199000,203000,205700,220000,245120,273800,300000,    @G36XRAW 00558810
* C328000,341324-341326,341361,341364,345000,479000,650400,    @G36XRAW 00558910
* C663300,672800                                               @G36XRAW 00559010
* D341328-341336,341322                                        @G36XRAW 00559110
*A205600                                                       @OZ26860 00559200
*D205501                                                       @OZ26860 00559300
*C488600-488700,489700,655100,657300-657600                    @OX16398 00559400
*A727800,727900                                                @OX16398 00559700
*D084600                                                       @Z40X9AG 00560000
*C085000-085280                                                @Z40X9AG 00561000
*        INCLUDE OX16398 AND Z40X9AG IN LEVEL 10               @OZ27023 00562000
*C488700                                                       @OZ27022 00563000
* DUMMY APAR                                                   @OZ27328 00564000
*D200000                                                       @OZ26356 00564100
*A203000                                                       @OZ26356 00564200
*A245080,748280                                                @OZ26305 00564300
*300000,663300,695120                                          @OZ26305 00564600
*C301280                                                       @OZ28213 00564786
*A086920                                                       @OZ26376 00564886
*C037400                                                       @OY20522 00564986
*********************************************************************** 00565000
*TITLE: 'IEDQEW' GET SCHEDULER                                        * 00570006
*                                                                     * 00575008
*MODULE-NAME = IEDQEW                                           SA21903 00580006
*                                                                     * 00585008
*DESCRIPTIVE NAME = TCAM GET SCHEDULER                          SA21903 00590006
*                                                                     * 00595008
* COPYRIGHTS = 'NONE'                                           SA21903 00600006
*                                                                     * 00601008
* STATUS: CHANGE LEVEL 10                                      @G36XRAW 00602008
*                                                                     * 00605006
*FUNCTION: THIS ROUTINE PERFORMS THREE FUNCTIONS: (1) GET-MCP SUBTASK * 00640006
*   WHEN A GET IS ISSUED, (2) GET SCHEDULER, (3),RETRIEVING MESSAGES. * 00645006
*   THIS ROUTINE CONTAINS THE GET QCB TO WHICH SVC 102 POST AN RCB    * 00660006
*   IN AN AIB. THIS SUBTASK CHECKS FOR MESSAGES ON THE READ AHEAD     * 00662006
*   QUEUE. FOR QSAM IF NO MESSAGES,EXIT IS MADE TO THE DISPATCHER TO  * 00664006
*   WAIT.  FOR BSAM IF NO MESSAGES ON READ AHEAD OR DEST QCB, THE     * 00666006
*   WORKAREA POINTER IN THE PEWA IS ZEROED AND ECB IS POSTED COMPLETE * 00700006
*   TO RETURN TO IEDQEB.                                              * 00710006
*                                                                     * 00720006
*   IF BUFFER IS ON QUEUE, THE DATA IS MOVED FROM THE BUFFER INTO     * 00730006
*   THE WORKAREA OF THE AIB.  THE DATA IS MOVED UNTIL AN ENTIRE       * 00740006
*   WORK UNIT IS MOVED, THE WORKAREA IS FULL, OR THE END OF A MESSAGE * 00750006
*   IS REACHED, OR END OF BUFFERS. WHEN BUFFERS ARE EMPTIED, THEY     * 00760006
*   ARE RETURNED TO THE BUFFER RETURN QCB. THE WORKAREA POINTER IN    * 00770006
*   THE PEWA IS ZEROED, WORKAREA FULL IS SET IN AIB, AND ECB IS POSTED* 00780006
*   COMPLETE TO RETURN TO IEDQEB.                                     * 00790006
*                                                                     * 00800006
*   AT THE USER'S OPTION, THIS SUBTASK PLACES THE NAME OF THE SOURCE  * 00810006
*   TERMINAL, DATE, TIME, AND/OR WORKAREA CONTENTS DESCRIPTOR BYTE    * 00820006
*   IN THE WORKAREA.                                                  * 00830006
*                                                                     * 00840006
*   THE SCHEDULER ROUTINE PERFORMS A READ AHEAD FUNCTION FROM A       * 00850006
*   DESTINATION QUEUE IN ANTICIPATION OF A USER'S GET OR READ.  ALSO, * 00860006
*   IT REACTS TO AND SERVICES RETRIEVE REQUESTS.  IT WAITS ON EITHER  * 00870006
*   THE READ-AHEAD OR PROCESS QCB.  IT WAITS ON THE DESTINATION       * 00880006
*   PROCESS QCB UNTIL A COMPLETE MESSAGE HAS BEEN RECEIVED.  FULL     * 00890006
*   BUFFERS ARE POSTED TO THE DESTINATION SCHEDULER.  WHEN THE        * 00900006
*   DESTINATION SCHEDULER SEES AN EOM BUFFER, IT BRANCHES TO A        * 00910006
*   SPECIAL ENTRY POINT IN THE GET SCHEDULER.  IT QWAITS ON THE READ- * 00920006
*   AHEAD QCB, POSTS A SPECIAL ELEMENT TO ITSELF, AND RETURNS CONTROL * 00930006
*   TO THE DESTINATION SCHEDULER.                                     * 00940006
*                                                                     * 00950006
*   AS LONG AS BUFFERS ARE AVAILABLE, THE GET SCHEDULER POSTS AN ERB  * 00960006
*   TO DISK I/O TO READ DATA FROM THE DESTINATION QUEUE.  IT RECEIVES * 00970006
*   THE ERB CONTAINING A BUFFER CHAIN.  BUFFERS ARE PLACED IN A QUEUE * 00980006
*   PRIOR TO POSTING THEM TO THE SEND MH FOR THE APPLICATION PROGRAM. * 00990006
*   CARE IS TAKEN TO INSURE THAT NO MORE THAN ONE MESSAGE HAS BEEN    * 01000006
*   PROCESSED BY MH BUT NOT BY THE APPLICATION PROGRAM AT ANY GIVEN   * 01010006
*   TIME.  A HEADER BUFFER IS NOT POSTED TO MH FOR PROCESSING AND     * 01020006
*   SUBSEQUENT POSTING TO THE READ-AHEAD QCB UNTIL THE EOM BUFFER FOR * 01030006
*   THE PREVIOUS MESSAGE HAS BEEN FLAGGED SERVICED.                   * 01040006
*   IF THE WORKAREA ADDRESS OF THE AIB IS IN THE PEWA WHEN A FULL     * 01050006
*   BUFFER IS PLACES ON THE RAQUEUE, THE DATA IS MOVE BY THE GET      * 01060006
*   SUBTASK.                                                          * 01070006
*                                                                     * 01080006
*   WHEN A GET IS ISSUED AFTER A POINT, THIS ROUTINE WAITS FOR THE ERB* 01090006
*   TO BECOME FREE.  AT THAT TIME, FULL BUFFERS ARE SAVED ALONG WITH  * 01100006
*   SCB INFORMATION NECESSARY TO RESUME SEQUENTIAL GET.  IT THEN      * 01110006
*   PREPARES THE SCB AND ERB FOR RECALL FROM THE SPECIFIED DESTINATION* 01120006
*   QUEUE AND POSTS THE ERB TO DISK I/O.  AN ERB WITH RECALLED BUFFER * 01130006
*   ATTACHED IS RETURNED.  EACH HEADER IN QBACK CHAIN IS TESTED FOR   * 01140006
*   THE CORRECT INPUT OR OUTPUT SEQUENCE NUMBER.  IF IT CANNOT BE     * 01150006
*   FOUND, AN ERROR CODE IS STORED IN THE PEWA. IF THE DESIRED NUMBER * 01160006
*   IS FOUND, THE ENTIRE MESSAGE IS RECALLED.  IF THE GET SCHEDULER   * 01170006
*   RECEIVES AN 'EXIT-RETRIEVE-MODE' REQUEST BEFORE THE ENTIRE        * 01180006
*   MESSAGE IS RECALLED, IT RETURNS FILLED BUFFERS TO BUFFER AND      * 01190006
*   RETURNS TO SEQUENTIAL GET MODE.  THIS ACTION ALSO OCCURS WHEN     * 01200006
*   THE EOM BUFFER IS RETRIEVED.                                      * 01210006
*                                                                     * 01215008
*ENTRY POINT:                                                         * 01220006
*        IEDQEW                                                       * 01230006
*        TAG   (BY IEDQHM, CALCULATED BY OFFSET IN GETQCB)            * 01240006
*                                                                     * 01245008
*INPUT:                                                               * 01250006
*   1  - ONE OF THE FOLLOWING:                                        * 01260006
*        (1) ELEMENT REQUEST BLOCK                                    * 01270006
*        (2) PARAMETER LIST                                           * 01280006
*        (3) FULL BUFFER                                              * 01290006
*        (4) BUFFER WHEN GET SCHEDULER WAITING IN DESTINATION QCB     * 01300006
*        (5) SPECIAL 'QWAIT' ELEMENT                                  * 01310006
*   11 - DISPATCHER ADDRESS                                           * 01320006
*   13 - REGISTER SAVEAREA ADDRESS                                    * 01330006
*   15 - ENTRY POINT ADDRESS                                          * 01340006
*                                                                     * 01345008
*OUTPUT:                                                              * 01350006
*        NONE                                                         * 01360006
*                                                                     * 01365008
*EXTERNAL ROUTINES:                                                   * 01370006
*        OS POST - CROSS MEMORY                                       * 01380006
*                                                                     * 01385008
*EXITS-NORMAL:                                                        * 01390006
*        DSPDISP                                                      * 01400006
*        DSPCHAIN                                                     * 01410006
*        DSPPOSTR                                                     * 01420006
*                                                                     * 01425008
*EXIT-ERROR:  NONE                                                    * 01430006
*                                                                     * 01435008
*TABLES/WORKAREAS:                                                    * 01440006
*        AIB                                                          * 01450006
*        PEB                                                          * 01460006
*        TNT                                                          * 01470006
*        AVT                                                          * 01480006
*        QCB                                                          * 01490006
*        SCB                                                          * 01500006
*        LCB                                                          * 01510006
*        PROCESS/TERMINAL ENTRY                                       * 01520006
*        PCB                                                          * 01530006
*        PEWA                                                         * 01540006
*                                                                     * 01550006
*NOTES: THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL         * 01560006
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT  * 01570006
*   TO THE ONE USED AT ASSEMBLY TIME.  THE CODING HAS BEEN ARRANGED   * 01580006
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS, BY REASSEMBLY,     * 01590006
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.          * 01600006
*                                                                     * 01610006
*********************************************************************** 01620006
         EJECT                                                          01630006
RZERO    EQU   0                        GENERAL COUNTER REGISTER        01640006
RPARM    EQU   1                        PARAMETER REGISTER              01650006
RBASE2   EQU   2                        SECOND BASE REGISTER     Y02027 01660006
RSTCB    EQU   3                        STCB BASE REGISTER       Y02027 01670006
RWORK    EQU   4                        GENERAL WORK REGISTER    Y02027 01680006
RTEMP    EQU   5                        GENERAL WORK REGISTER           01690006
RRCB     EQU   RPARM                    RCB BASE REGISTER               01700006
RBFR     EQU   6                        BUFFER ADDRESS           Y02027 01710006
RQCB     EQU   7                        QCB BASE REGISTER               01720006
RGETWORK EQU   8                        PROCESS ENTRY WORKAREA          01730006
*                                       BASE REGISTER                   01740006
RSCB     EQU   9                        SCB BASE REGISTER               01750006
RCOUNT   EQU   9                        COUNT OF BYTES FILLED    Y02027 01760006
RERB     EQU   10                       ERB BASE REGISTER               01770006
RDISP    EQU   11                       DISPATCHER BASE REGISTER        01780006
RBASE    EQU   12                       GET SCHEDULER BASE REGISTER     01790006
RAVT     EQU   13                       AVT BASE REGISTER               01800006
RETURN   EQU   14                       RETURN ADDRESS REGISTER         01810006
RENTRY   EQU   15                       ENTRY POINT/RETURN CODE REG     01820006
*              THE FOLLOWING 3 WORDS IS A QCB-STCB FOR THE MCP-  Y02027 01830006
*              GET ROUTINE. ELEMENTS (IN AIB) ARE POSTED TO THIS Y02027 01840006
*              QCB BY SVC 102.  SINCE THE FIRST 2 WORDS ARE NOT  Y02027 01850006
*              NEEDED FOR QCB, THEY CONTAIN THE OFFSET AND       Y02027 01860006
*              BRANCH IF ENTERED AS A SCHEDULER.                 Y02027 01870006
         DS    0F                                                Y02027 01880006
GETQCB   DC    AL2(TAG-IEDQEW)          OFFSET USED BY HM        Y02027 01890006
         SPACE 2                                                        01900006
         SPACE 2                                                        01908006
         USING *,RENTRY                 BASE REG FOR BRANCH      Y02027 01916006
         B     GETSCHED                 BRANCH TO GET SCHEDULER  Y02027 01924006
         DS    0F                       STCB POINTER AND STCB    Y02027 01932006
         DC    AL1(DSPMCPL6)            MCPL FOR LAT STCB FOR    Y02027 01940006
*                                       RAQCB (QEVENT)           Y02027 01948006
         DC    AL3(GSTCB)               QCB STCB POINTER         Y02027 01956006
*                                       FOR GET QCB              Y02027 01964006
         DC    AL2(0)                   PRIORITY OF LAST STCB    Y02027 01972006
*                                       INDICATOR                Y02027 01980006
IEDQEW   IEDHJN                                                         01988006
GSTCB    DC    AL1(DSPMCPL2)            GET                      Y02027 02000006
         DC    AL1(0)                   STCB                     Y02027 02009006
*              CODE EXECUTED AS RESULT OF ELEMENT POSTED TO      Y02027 02018006
*              GET QCB.                                          Y02027 02027006
         EJECT                                                   Y02027 02036006
*                                                                Y02027 02045006
*              ADDRESSABILITY                                    Y02027 02054006
*                                                                Y02027 02063006
         BALR  RBASE,RZERO              ESTABLISH ADDRESSABILITY Y02027 02072006
LABEL    EQU   *                                                 Y02027 02081006
         DROP  RENTRY                                            Y02027 02090006
         USING *,RBASE                  CSECT ADDRESSABILITY     Y02027 02100006
         LA    RBASE2,GETSCHED-LABEL(RBASE) ESTABLISH SECOND     Y02027 02110006
         USING GETSCHED,RBASE2          BASE REGISTER            Y02027 02120006
         EJECT                                                          02130006
         USING IEDQPEWA,RGETWORK        GET SCHEDULER                  X02140006
                                        PROCESS ENTRY                  X02150006
                                        WORKAREA ADDRESSABILITY         02160006
         USING IEDQDISP,RDISP           DISPATCHER ADDRESSABILITY       02170006
         USING AVTSAVE2,RAVT            AVT ADDRESSABILITY       Y02027 02180006
         USING IEDQQCB,RQCB             QCB ADDRESSABILITY              02190006
         USING IEDQSCB,RSCB             SCB ADDRESSABILITY              02200006
         USING LCBERB,RERB              ERB ADDRESSABILITY              02207006
         SH    RRCB,AVTHA16             BACK UP TO BEGINNING OF  Y02027 02214006
         USING IEDQAIB,RRCB             AIB FOR ADDRESSABILITY   Y02027 02221006
         L     RGETWORK,AIBGPEWA        GET PEWA ADDRESS         Y02027 02228006
         LA    RETURN,DSPDISP           SET RETURN FOR POSSIBLE  Y02027 02235006
*                                       ERROR OR EMPTY QUEUE     Y02027 02242006
         MVC   PEWAWA,AIBWAPTR          SAVE WORK AREA PTR     @OZ09927 02245081
         MVC   PEWAECBA(4),AIBECBA       MOVE ECB ADDR           Y02027 02249006
         TM    PEWAFLG,PEWASTOP         PROCESS ENTRY DISABLED   Y02027 02251006
         BO    STOPERR                  BR IF YES                Y02027 02253006
*                                                                Y02027 02256006
*              TEST FOR GET FOR RETRIEVAL                        Y02027 02263006
*                                                                Y02027 02270006
         CLI   PEWARTVE+TWO,BLANK       RETRIEVE TERMINATION     Y02027 02277006
         BE    OUTRX                    BRANCH IF YES            Y02027 02284006
         TM    PEWAOPTC,RTVFLG          RETRIEVE MODE FLAG SET   Y02027 02300006
         BNO   NORETR                   RETRIEVE NOT REQUESTED   Y02027 02310006
         TM    PEWAGSW,RETRIEVE         RETRIEVE OK NOW          Y02027 02320006
         BO    RETRVE                   BRANCH IF YES            Y02027 02330006
NORETR   EQU   *                                                 Y02027 02340006
         CLI   PEWASAVE,AVTECD12        RETRIEVE ERROR           Y02027 02350006
         BE    GOODRETC                 BRANCH IF YES TO RETURN  Y02027 02360006
*                                                                Y02027 02370006
*              CHECK FOR MESSAGE READ AHEAD                      Y02027 02380006
*                                                                Y02027 02390006
         CLC   PERAQCB+1(3),AVTDELAD+1  READ-AHEAD QUEUE EMPTY   Y02027 02400006
         BNE   GO                       BRANCH IF NOT EMPTY      Y02027 02410006
         TM    AIBMACRF,QSAMFLG         QSAM DCB                 Y02027 02420006
         BNO   NOTQSAM                  BRANCH IF NOT QSAM     @G36XRAW 02421010
         BAL   RETURN,DSPDISP           BRANCH IF QSAM TO      @G36XRAW 02430006
*                                       DISPATCH. IEDQEB WILL    Y02027 02440006
*                                       WAIT TILL MSG PUT ON Q.  Y02027 02450006
NOTQSAM  EQU   *                                               @G36XRAW 02451010
         XC    AIBDECS+1(3),AIBDECS+1   CLEAR TO ZERO            Y02027 02460006
         MVI   AIBDECS,EOQ              SET C.C. TO INDICATE READY02027 02470006
*                                       AHEAD QUEUE AND DEST. Q. Y02027 02480006
*                                       ARE EMPTY BEFORE TESTS   Y02027 02490006
         TM    PEWAFLG,ERBBUSY          ERB POSTED               Y02027 02500006
         BNO   SETECB                   NO, BR                 @OZ09292 02507081
         MVI   AIBDECS,EOD              ON DEST. QUEUE BUT NOT   Y02027 02660006
*                                       ON READ-AHEAD QUEUE      Y02027 02670006
SETECB   EQU   *                        PREPARE FOR POST         Y02027 02680006
         XC    PEWAWA(4),PEWAWA         ZERO WORKAREA POINTER SO Y02027 02690006
*                                       MSG WILL NOT BE PUT IN   Y02027 02700006
*                                       AIB WHEN PUT ON R.A. Q.  Y02027 02709006
         MVC   AIBCMPTG(4),PEWAECBA     PUT ECB ADDR IN POST LISTY02027 02718006
         MVC   PEWAECBA+ONE(3),AIBDECBG+ONE SET DECBAS ECBTO BE  Y02027 02727006
*                                       POSTED WHEN MSG PUT ON   Y02027 02736006
*                                       R.A QUEUE.               Y02027 02745006
         SR    RENTRY,RENTRY            GOOD RETURN              Y02027 02754006
         B     XMPOST1                  CROSS MEMORY POST ECB    Y02027 02763006
*                                       SVC 102 IS WAITING ON    Y02027 02772006
         SPACE 2                                                        02781106
STOPERR  EQU   *                                                 Y02027 02781206
         LA    RENTRY,STOPQRC           DISABLE ENTRY CODE       Y02027 02781306
         B     XMPOST                   RETURN                   Y02027 02781406
         EJECT                                                   Y02027 02790006
GO       EQU   *                        MESSAGE ON QUEUE         Y02027 02800006
         USING IEDQPRF,RBFR             BUFFER PREFIX ADDRESS    Y02027 02810006
         L     RBFR,PEWAPEBF            GET ADDR OF PART BUFFER  Y02027 02820006
         TM    PEWAOPTC,PARTBUF         PARTIAL BUFFER EMPTY     Y02027 02830006
         BNZ   BEGIN                    BRANCH IF PARTIAL BUFFER Y02027 02840006
*                                                                Y02027 02850006
*              INITIALIZE FOR NEW BUFFER                         Y02027 02860006
*                                                                Y02027 02870006
         L     RBFR,PERAQCB             ADDR OF NEW BUFFER       Y02027 02880006
         ST    RBFR,PEWAPEUN            SAVE CURRENT UNIT        Y02027 02890006
         LH    RTEMP,PRFSIZE            GET BUFFER SIZE          Y02027 02900006
         N     RTEMP,AVTCLRHI           AND CLEAR TOP HALF WORD  Y02027 02910006
         LA    RWORK,AVTTXTSZ           ASSUME TEXT, PREFIX SIZE Y02027 02920006
         TM    PRFSTAT1,PRFNHDRN        HEADER BUFFER ?          Y02027 02930006
         BO    TEXT                     BRANCH IF TEXT           Y02027 02940006
         LA    RWORK,AVTHDRSZ           GET HEADER PREFIX SIZE   Y02027 02950006
TEXT     SR    RTEMP,RWORK              COMPUTE DATA SIZE AND    Y02027 02960006
         STH   RTEMP,PEWAPSZE           SAVE IN PEWA             Y02027 02970006
         STH   RTEMP,PEWAUSZE           ASSUME DATA SIZE IS LESS Y02027 02980006
*                                       THAN UNIT SIZE           Y02027 02990006
         LH    RTEMP,AVTKEYLE           GET LENGTH OF A BUFFER   Y02027 03000006
*                                       UNIT LESS UNIT MANAGEMENTY02027 03006006
*                                       AREA                     Y02027 03012006
         CH    RTEMP,PRFSIZE            CAN LOGICAL BUFFER BE    Y02027 03018006
*                                       CONTAINED IN ONE UNIT    Y02027 03024006
         BNL   CKCLOSE                  BRANCH IF NO             Y02027 03030006
         SR    RTEMP,RWORK              SUBTRACT PREFIX SIZE TO  Y02027 03036006
         STH   RTEMP,PEWAUSZE           OBTAIN MAX DATA LENGTH   Y02027 03042006
CKCLOSE  EQU   *                        CHECK FOR CLOSEDOWN      Y02027 03048006
         ICM   RCOUNT,THREE,PRFSIZE     ZERO LENGTH BUFFER       Y02027 03054006
         BNZ   NFCLOSE                  BRANCH IF NO             Y02027 03060006
         MVC   PERAQCB+ONE(3),PRFLINK   DELINK BUFFER            Y02027 03066006
         B     CLOSE                    POST CLOSE ELEMENT       Y02027 03072006
NFCLOSE  EQU   *                                                 Y02027 03078006
         TM    PRFSTAT1,PRFNHDRN        HEADER BUFFER ?          Y02027 03084006
         BO    BEGIN                    BRANCH IF NO             Y02027 03100006
         NI    PEWAGSW+1,AVTEFF-EOM     TURN OFF EOM             Y02027 03110006
         TM    AVTBIT1,AVTCLOSN+AVTQUCKN CLOSEDOWN IN PROGRESS   Y02027 03120006
         BNO   CHECKEOF                 BRANCH IF NO             Y02027 03130006
CLOSE    EQU   *                                                 Y02027 03140006
         LA    RENTRY,FOUR              SET EODAD CODE           Y02027 03150006
         LA    RETURN,DSPDISP           SET RETURN TO DISPATCHEROZ00203 03155061
         B     XMPOST                   CROSS MEMORY POST ECB    Y02027 03160006
*                                       TO RETURN TO IEDQEB      Y02027 03170006
CHECKEOF EQU   *                                                 Y02027 03180006
         NI    PEWAGSW,AVTEFF-RETRIEVE  CAN NOT DO RETRIEVE      Y02027 03190006
         TM    PRFSTAT1,PRFEOFN         SETEOF DONE FOR BUFFER   Y02027 03200006
         BNO   BEGIN                    BRANCH IF NO             Y02027 03210006
         OI    PEWAOPTC,EODADFLG        SET EODAD TO BE INSPECTEDY02027 03220006
*                                       ON NEXT GET/READ         Y02027 03230006
         EJECT                                                          03240006
BEGIN    EQU   *                        CHECK FOR SOWA ERROR     Y02027 03250006
*                                       DURING GET               Y02027 03260006
         L     RWORK,AIBWAPTR           WORKAREA ADDRESS         Y02027 03270006
         CLC   PEWASOWA(2),AVTFZERO     VALID SOWA SPECIFIED     Y02027 03280006
         BNE   SOWAOK                   BRANCH IF YES            Y02027 03290006
BADLRECL EQU   *                        LRECL=0 FOR FIXED IS INVAY02027 03295006
         MVI   AIBDECS,SOWACC           BAD SOWA CODE            Y02027 03300006
         LA    RENTRY,SOWACC            SET COMPLETION CODE      Y02027 03310006
         LA    RETURN,DSPDISP           SET RETURN TO DISPATCHEROZ00203 03315061
         B     XMPOST                   CROSS MEMORY POST ECB    Y02027 03320006
*                                       TO RETURN TO IEDQEB      Y02027 03330006
SOWAOK   SR    RCOUNT,RCOUNT            CLEAR REGISTER           Y02027 03340006
         TM    AIBRECFG,FIXFLG          FIXED OR UNDEFINED?      Y02027 03350006
         BNO   VARIABLE                 BR IF NEITHER            Y02027 03360006
         CLI   AIBRECFG,FIXFLG          IS IT FIXED              Y02027 03360506
         BNE   OPTCDTST                 BR IF NOT                Y02027 03361006
         CLC   PEWALREC(2),AVTFZERO     LRECL=0                  Y02027 03361506
         BE    BADLRECL                 BR TO SET COMP CODE      Y02027 03362006
         B     OPTCDTST                 CK OPTCD                 Y02027 03362506
VARIABLE EQU   *                                                 Y02027 03363006
*                                                                Y02027 03370006
*                                       IF VARIABLE              Y02027 03380006
*              ADJUST SIZES FOR PREFIX                           Y02027 03390006
*                                                                Y02027 03400006
         XC    0(4,RWORK),0(RWORK)      ZERO PREFIX              Y02027 03410006
         LA    RWORK,PRFLEN(RWORK)      INCREMENT WORKAREA PTR   Y02027 03420006
*                                       BY SAM PREFIX LENGTH     Y02027 03430006
         LA    RCOUNT,PRFLEN(RCOUNT)    INCREMENT BYTE COUNTER   Y02027 03440006
*                                       BY SAM PREFIX LENGTH     Y02027 03450006
         TM    AIBMACRF,QSAMFLG         QSAM DCB                 Y02027 03460006
         BO    OPTCDTST                 BRANCH IF YES            Y02027 03470006
         TM    AIBRECFG,BLKFLG          VARIABLE BLOCKED         Y02027 03480006
         BNO   OPTCDTST                 BRANCH IF NO             Y02027 03490006
         XC    0(4,RWORK),0(RWORK)      ZERO BSAM PREFIX         Y02027 03500006
         LA    RWORK,PRFLEN(RWORK)      UPDATE WORKAREA PTR FOR  Y02027 03510006
*                                       BSAM PREFIX              Y02027 03520006
         LA    RCOUNT,PRFLEN(RCOUNT)    UPDATE BYTE COUNTER FOR  Y02027 03530006
*                                       BSAM PREFIX              Y02027 03540006
OPTCDTST EQU   *                                                 Y02027 03550006
         TM    AIBOPTCG,CTLBYTE         OPTCD=C SPECIFIED        Y02027 03560006
         BNO   TSEARCH                  BRANCH IF NO             Y02027 03570006
         ST    RWORK,AIBCTLG            SAVE ADDRESS OF CTL BYTE Y02027 03580006
*                                       IN WORKAREA              Y02027 03590006
         MVI   0(RWORK),ISEGFLAG        SET DEFAULT VALUE        Y02027 03600006
         LA    RWORK,CBYTELEN(RWORK)    INCREMENT WORKAREA PTR   Y02027 03610006
*                                       BY ONE                   Y02027 03620006
         LA    RCOUNT,CBYTELEN(RCOUNT)  INCREMENT BYTE COUNTER   Y02027 03630006
*                                       BY ONE                   Y02027 03640006
*                                                                Y02027 03650006
*              CHECK FOR DATE, TIME, AND SOURCE OPTIONS          Y02027 03660006
*                                                                Y02027 03670006
TSEARCH  EQU   *                                                 Y02027 03680006
         TM    AIBOPTCG,TNMEFLG         OPTCD=W SPECIFIED        Y02027 03690006
         BNO   CHKDTS                   NO, CHECK DATE           Y02027 03700006
         MVC   0(8,RWORK),BLANKS        INITIALIZE FIELD         Y02027 03710006
CHKDTS   EQU   *                                                 Y02027 03720006
         L     RTEMP,PEWAPROC           PROCESS ENTRY ADDRESS    Y02027 03730006
         TM    PEWAOPT2,PEWADATE        DATE=YES SPECIFIED?    @OY20522 03740086
         BNO   CHKNAME                  NO CHECK FOR NAME NEEDED Y02027 03750006
         TM    PRFSTAT1,PRFNHDRN        HEADER?                  Y02027 03760006
         BO    CHKNAME                  NO, IGNORE DATE AND TIME Y02027 03770006
         TM    PEWAOPTC,PARTBUF         IS THIS A PARTIAL BUFFER Y02027 03780006
         BO    CHKNAME                  YES, DATE PROVIDED       Y02027 03790006
         ICM   RTEMP,SEVEN,PEWADTSA     DTS AREA SPECIFIED       Y02027 03800006
         BZ    CHKNAME                  NO IGNORE TIME/DATE      Y02027 03810006
         MVI   AIBKEY+ONE,AVTEZERO      ZERO TPDATE              Y02027 03820006
         MVC   AIBKEY+TWO(SIX),AIBKEY+ONE DATE TIME FIELD        Y02027 03830006
         MVC   PEWAELEM+EIGHT(EIGHT),BLANKS BLANK NAME           Y02027 03840006
         OI    PEWAOPT2,DATE            INDICATE OPTION USED     Y02027 03850006
         B     NAME                     GET NAME                 Y02027 03860006
CHKNAME  EQU   *                                                 Y02027 03870006
         TM    AIBOPTCG,TNMEFLG         DCBOPTCD=W               Y02027 03880006
         BNO   NOSEARCH                 BRANCH IF NO             Y02027 03890006
NAME     EQU   *                                                 Y02027 03900006
         MVI   AIBKEY,AVTEZERO          INIT AIB FOR NO TPDATE   Y02027 03905006
         SR    RSTCB,RSTCB              CLEAR FOR ICM            Y02027 03910006
         ICM   RSTCB,THREE,PRFSRCE      GET TERMNAME TABLE INDEX Y02027 03920006
*                                       FOR SOURCE               Y02027 03930006
         BZ    NONAME                   BRANCH IF NO SOURCE      Y02027 03940006
*                                       SPECIFIED                Y02027 03950006
         L     RTEMP,AVTRNMPT           ADDR OF TERMNAME TABLE   Y02027 03960006
         BCTR  RSTCB,RZERO              DECREMENT INDEX BY ONE   Y02027 03970006
         STH   RSTCB,PEWASRCE           STORE INDEX              Y02027 03980006
         SR    RSTCB,RSTCB              CLEAR AGAIN              Y02027 03990006
         IC    RSTCB,TNTENLEN-IEDQTNTD(RTEMP) LENGTH OF TNT ENTRYY02027 04000006
         LR    RENTRY,RSTCB             SAVE ENTRY LENGTH        Y02027 04010006
         AH    RSTCB,AVTHA3             BUMP TO TTABLE POINTER   Y02027 04020006
         LA    RTEMP,TNTOFF(RTEMP)      ADDR OF FIRST ENTRY IN   Y02027 04030006
*                                       TERMNAME TABLE           Y02027 04040006
         MH    RSTCB,PEWASRCE           COMPUTE DISPLACEMENT OF  Y02027 04050006
         AR    RTEMP,RSTCB              THE SOURCE TNT ENTRY     Y02027 04060006
         LR    RSTCB,RENTRY             RESTORY ENTRY LENGTH     Y02027 04070006
NONAME   EQU   *                                                 Y02027 04080006
         BCTR  RSTCB,RZERO              DECREMENT NUMBER OF      Y02027 04090006
*                                       BYTES BY ONE             Y02027 04100006
         TM    AIBOPTCG,TNMEFLG         DCBOPTCD=W               Y02027 04110006
         BNO   MOVESRC                  BRANCH IF NO, CHECK DATE Y02027 04120006
         LTR   RSTCB,RSTCB              OFFSET PRESENT           Y02027 04130006
         BM    NOMOVE                   BRANCH IF NONE           Y02027 04140006
         EX    RSTCB,MOVENME            MOVE NAME                Y02027 04150006
NOMOVE   EQU   *                                                 Y02027 04160006
         LA    RWORK,SRCELEN(RWORK)     INCREMENT WORKAREA PTR   Y02027 04170006
*                                       BY LENGTH OF SOURCE NAME Y02027 04180006
         LA    RCOUNT,SRCELEN(RCOUNT)   INCREMENT BYTE COUNTER BYY02027 04190006
MOVESRC  EQU   *                        LENGTH OF SOURCE NAME    Y02027 04200006
         TM    PEWAOPT2,DATE            DATE SPECIFIED           Y02027 04210006
         BNO   NOSEARCH                 NO IGNORE NAME           Y02027 04220006
         LA    RENTRY,PEWAELEM          GET TPDATE SRC ADDRESS   Y02027 04230006
         LTR   RSTCB,RSTCB              OFFSET PRESENT           Y02027 04240006
         BM    NOMOVE2                  BRANCH IF NO             Y02027 04250006
         EX    RSTCB,MOVE2              MOVE SOURCE              Y02027 04260006
NOMOVE2  EQU   *                                                 Y02027 04270006
         CLC   PRFSRCE,PRFDEST          OPCTL RESPONSE         @SA69063 04273061
         BE    NOSEARCH                 BRANCH YES             @SA69063 04276061
         LA    RSTCB,PRFSHDR            GET START OF DATA        Y02027 04280006
         AH    RSTCB,PRFSCAN            BUMP PAST IDLES          Y02027 04290006
         MVC   AIBKEY+ONE(SEVEN),ONE(RSTCB) PUT DATE TIME IN AIB Y02027 04300006
         MVI   AIBKEY,DATE              INDICATE DATE/TIME STAMP Y02027 04303006
*                                       AVAILABLE IN AIB         Y02027 04306006
         EJECT                                                          04310006
NOSEARCH EQU   *                                                 Y02027 04320006
         LH    RTEMP,PEWASOWA           SIZE OF WORKAREA         Y02027 04330006
         N     RTEMP,AVTCLRHI           CLEAR HIGH ORDER HALF    Y02027 04340006
         SR    RTEMP,RCOUNT             EFFECTIVE WORKAREA LENGTHY02027 04350006
         STH   RTEMP,PEWASOWA           SAVE LENGTH              Y02027 04360006
         MVC   PEWALREC(2),AIBLRECL     INIT WORK AREA FIELD     Y02027 04370006
         L     RENTRY,PEWAMOVE          ADDR OF NEXT BYTE FOR    Y02027 04380006
*                                       PART-EMPTY BUFFER        Y02027 04390006
         TM    PEWAOPTC,PARTBUF         PARTIALLY EMPTY BUFFER   Y02027 04400006
         BNO   NOTEMPTY                 BRANCH IF NO           @OZ14162 04410081
         MVI   AIBEXLFG,AVTEZERO        SET NO CHECKPOINT TAKEN@OZ14162 04412081
         B     PARTEMP                  PROCESS PARTIALLY      @OZ14162 04414081
*                                        EMPTY BUFFER          @OZ14162 04416081
NOTEMPTY EQU   *                                               @OZ14162 04418081
         LA    RENTRY,PRFSTXT           ADDR OF DATA IN BUFFER   Y02027 04420006
*                                       IF TEXT                  Y02027 04430006
         TM    PRFSTAT1,PRFNHDRN        HEADER BUFFER            Y02027 04440006
         BNO   HDRBFR                   BRANCH IF YES          @OZ14162 04450081
         MVI   AIBEXLFG,AVTEZERO        SET NO CHECKPOINT TAKEN@OZ14162 04452081
         B     POSTHDRX                 PROCESS NON-HEADER BFR @OZ14162 04454081
HDRBFR   EQU   *                                               @OZ14162 04456081
         LA    RENTRY,PRFSHDR           ADDR OF DATA IN HEADER   Y02027 04460006
*                                                                Y02027 04470006
*              CHECK FOR ENVIRONMENT CHECKPOINT TAKEN            Y02027 04480006
*                                                                Y02027 04490006
         TM    AIBEXLFG,CKPTFLG         CHECK POINT EXIT SPECIF'DY02027 04500006
         BNO   SETNO                    BRANCH IF NO             Y02027 04510006
         L     RTEMP,AIBPCBAD           GET PCB ADDRESS          Y02027 04520006
         TM    PCBOFLG-IEDQPCB(RTEMP),PCBCKPTN  CKPT ISSUED SINCEY02027 04530006
*                                       LAST HEADER EXAMINED     Y02027 04540006
         BNO   SETNO                    BRANCH IF NO             Y02027 04550006
         NI    PCBOFLG-IEDQPCB(RTEMP),PCBCKPTF IF YES,TURN OFF   Y02027 04560006
*                                       FLAG                     |02027 04570006
         B     CTEST                    BYPASS NO SETTING        Y02027 04580006
SETNO    MVI   AIBEXLFG,AVTEZERO        SET NO CHECKPOINT TAKEN  Y02027 04590006
*                                       IF AIBEXLFG = CKPTFLG    Y02027 04600006
*                                       EXLST EXIT IS TO BE TAKENY02027 04610006
CTEST    EQU   *                                                 Y02027 04620006
         TM    AIBOPTCG,CTLBYTE         CONTROL BYTE SPECIFIED   Y02027 04630006
         BNO   POSTHDRX                 BRANCH IF NO             Y02027 04640006
         L     RTEMP,AIBCTLG            GET ADDRESS CONTROL BYTE Y02027 04650006
*                                       IN WORK AREA             Y02027 04660006
         MVI   0(RTEMP),HDRFLG          SET HEADER FLAG IN       Y02027 04670006
*                                       CONTROL BYTE             Y02027 04680006
         EJECT                                                          04690006
*                                                                Y02027 04700006
*              FOR MULTIPLE RETRIEVAL, SEVERAL FIELDS MUST BE    Y02027 04710006
*              MOVED INTO THE USERS WORKAREA                     Y02027 04720006
*                                                                Y02027 04730006
         TM    PRFSTAT1,PRFDUPLN        RECALLED BUFF          @OY15490 04733081
         BNO   POSTHDRX                 BR NO                  @OY15490 04736081
         TM    PEWARTVE+THREE,MULTSEQ   MULTIPLE RETIEVAL MODE   Y02027 04740006
         BNO   POSTHDRX                 BRANCH IF NO             Y02027 04750006
         MVC   ZERO(2,RWORK),PRFSRCE    SAVE SOURCE TNT OFFSET   Y02027 04760006
         MVC   TWO(1,RWORK),PRFSTAT1    STATUS                   Y02027 04770006
         MVC   THREE(2,RWORK),PRFISEQ   INPUT SEQUENCE NUMBER    Y02027 04780006
         MVC   FIVE(2,RWORK),PRFCORE    OUTPUT SEQUENCE NUMBER   Y02027 04790006
         MVC   SEVEN(2,RWORK),PRFDEST   DESTINATION              Y02027 04800006
         MVC   NINE(1,RWORK),PRFSCAN+ONE GIVE USER NO. OF IDLES  Y02027 04810006
         LH    RTEMP,PEWASOWA           WORKAREA SIZE            Y02027 04820006
         N     RTEMP,AVTCLRHI           CLEAR HI-ORDER HALF      Y02027 04830006
         LA    RSTCB,TEN                SIZE OF RETR INFO        Y02027 04840006
         SR    RTEMP,RSTCB              SUBTRACT 10              Y02027 04850006
         STH   RTEMP,PEWASOWA           RESET WORK AREA SIZE     Y02027 04860006
         LA    RWORK,TEN(RWORK)         UPDATE WORKAREA PTR      Y02027 04870006
         LA    RCOUNT,TEN(RCOUNT)       UPDATE BYTE COUNTER      Y02027 04880006
         B     PARTEMP                  PRETEND IDLES NOT THERE  Y02027 04890006
         EJECT                                                          04900006
POSTHDRX EQU   *                                                 Y02027 04910006
         LH    RSTCB,PRFSCAN            GET IDLE COUNT           Y02027 04920006
         TM    PEWAOPT2,DATE            DATE/TIME SPECIFIED      Y02027 04930006
         BZ    NODTS                    BR IF NO                 Y02027 04940006
         LA    RSTCB,PARMLEN(RSTCB)     BUMP PAST DATE/TIME      Y02027 04950006
         NI    PEWAOPT2,AVTEFF-DATE     TURN OFF FLAG            Y02027 04960006
NODTS    EQU   *                                                 Y02027 04970006
         LH    RTEMP,PEWAUSZE           UNIT COUNT               Y02027 04980006
         SR    RTEMP,RSTCB              SUBTRACT IDLE COUNT      Y02027 04990006
         STH   RTEMP,PEWAUSZE           UPDATE UNIT LENGTH       Y02027 05000006
         LH    RTEMP,PEWAPSZE           BUFFER LENGTH            Y02027 05010006
         N     RTEMP,AVTCLRHI           CLEAR HIGH ORDER HALF    Y02027 05020006
         SR    RTEMP,RSTCB              SUBTRACT IDLE COUNT      Y02027 05030006
         STH   RTEMP,PEWAPSZE           UPDATE BUFFER LENGTH     Y02027 05040006
         AR    RENTRY,RSTCB             BUMP PAST IDLE CHARS     Y02027 05050006
PARTEMP  EQU   *                                                 Y02027 05060006
         TM    AIBRECFG,VARFLG          VARIABLE OR UNDEFINED    Y02027 05070006
         BO    WUTST                    BRANCH IF YES            Y02027 05080006
*                                                                Y02027 05090006
*              FIXED FORMAT                                      Y02027 05100006
*                                                                Y02027 05110006
         CLC   PEWALREC(2),AIBLRECL     START OF WORKAREA        Y02027 05120006
         BNE   SZETST                   BRANCH IF NO             Y02027 05130006
         LH    RTEMP,PEWALREC           SIZE OF WORKAREA         Y02027 05140006
         N     RTEMP,AVTCLRHI           CLEAR HI-ORDER HALF      Y02027 05150006
         SR    RTEMP,RCOUNT             SUBTRACT PREFIX LENGTH   Y02027 05160006
         STH   RTEMP,PEWALREC           AND SAVE                 Y02027 05170006
SZETST   EQU   *                                                 Y02027 05180006
         CLC   PEWAUSZE(2),PEWALREC     AMOUNT OF DATA IN UNIT   Y02027 05190006
*                                       GREATER THAN WORKAREA    Y02027 05200006
         BNH   EMPTYBFR                 BRANCH IF ALL DATA IN    Y02027 05210006
*                                       BUFFER FITS IN WORKAREA  Y02027 05220006
         SR    RSTCB,RSTCB              CLEAR FOR ICM            Y02027 05230006
         ICM   RSTCB,THREE,PEWALREC     GET NUMBER OF BYTES IN   Y02027 05240006
*                                       BUFFER TO BE MOVED       Y02027 05250006
         SR    RTEMP,RTEMP              CLEAR FOR ICM            Y02027 05260006
         ICM   RTEMP,THREE,PEWAPSZE     SIZE OF LOGICAL DATA     Y02027 05270006
         SR    RTEMP,RSTCB              COMPUTE AMOUNT LEFT IN   Y02027 05280006
*                                       LOGICAL BUFFER AFTER MOVEY02027 05290006
         STH   RTEMP,PEWAPSZE           SAVE COUNT FOR NEXT MOVE Y02027 05300006
         LH    RTEMP,PEWAUSZE           BYTES IN BUFFER UNIT     Y02027 05310006
         SR    RTEMP,RSTCB              COMPUTE AMOUNT LEFT IN   Y02027 05320006
*                                       BUFFER UNIT              Y02027 05330006
         STH   RTEMP,PEWAUSZE           STORE COUNT FOR NEXT MOVEY02027 05340006
         LR    RTEMP,RENTRY             ADDR OF FIRST/NEXT BYTE  Y02027 05350006
*                                       IN BUFFER TO BE MOVED    Y02027 05360006
         AR    RTEMP,RSTCB              ADDR OF NEXT BYTE TO BE  Y02027 05370006
*                                       MOVED AFTER MOVE         Y02027 05380006
         ST    RTEMP,PEWAMOVE           SAVE ADDR FOR NEXT MOVE  Y02027 05390006
         AR    RCOUNT,RSTCB             INCREMENT COUNT OF BYTES Y02027 05400006
*                                       USED IN WORKAREA         Y02027 05410006
         BCTR  RSTCB,RZERO              SUBTR 1 FOR EXECUTE      Y02027 05420006
         EX    RSTCB,MOVER              MOVE DATA FROM BUFFER TO Y02027 05430006
*                                       WORKAREA                 Y02027 05440006
*                                                                Y02027 05450006
*        WORK AREA IS FULL                                       Y02027 05460006
*                                                                Y02027 05470006
         OI    PEWAOPTC,PARTBUF         TURN ON PARTIAL BUFFER   Y02027 05480006
         ST    RBFR,PEWAPEBF            SAVE ADDR OF PARTIALLY   Y02027 05490006
*                                       EMPTY BUFFER             Y02027 05500006
         B     OFLOTST                  BRANCH TO FINISH UP      Y02027 05507006
         EJECT                                                          05514006
*        VARIABLE OR UNDEFINED FORMAT                            Y02027 05521006
*                                                                Y02027 05528006
WUTST    EQU   *                                                 Y02027 05535006
         LA    RSTCB,PEWATRT            GET TRT TABLE            Y02027 05542006
         SR    RZERO,RZERO              CLEAR REGISTER           Y02027 05549006
         IC    RZERO,AVTSCBSZ           SCB SIZE                 Y02027 05556006
         AR    RSTCB,RZERO              GET TRT PAST SCB         Y02027 05563006
         TM    AIBOPTCG,MSGFLG          WORK UNIT A MESSAGE      Y02027 05570006
         BO    RECORD                   BRANCH IF YES            Y02027 05577006
*                                                                Y02027 05584006
*        CHECK PROCESS ENTRY FOR USER SPECIFIED RECORD DELIMITER Y02027 05591006
*                                                                Y02027 05600006
         L     RETURN,PEWAPROC          ADDRESS OF PROCESS ENTRY Y02027 05610006
         SR    RTEMP,RTEMP              CLEAR REG FOR IC         Y02027 05620006
         IC    RTEMP,TRMCHCIN-IEDQTRM(RETURN) SET UP TRT INDEX   Y02027 05630006
         STC   RTEMP,0(RTEMP,RSTCB)     PUT STOPPER IN TRT TABLE Y02027 05640006
         STC   RTEMP,PEWARDEL           SAVE RECORD DELIMITER    Y02027 05650006
RECORD   EQU   *                                                 Y02027 05700006
*        PREPARE TO SCAN BUFFER FOR RECORD DELIMITER             Y02027 05710006
*                                                                Y02027 05720006
         LH    RTEMP,PEWASOWA           NUMBER OF BYTES OF DATA  Y02027 05730006
*                                       IN BUFFER TO BE SCANNED  Y02027 05740006
         CLC   PEWAUSZE(2),PEWASOWA     AMOUNT OF DATA IN BUFFER Y02027 05750006
*                                       GREATER THAN WORKAREA    Y02027 05760006
         BH    SCANNER                  BRANCH IF YES            Y02027 05770006
         LH    RTEMP,PEWAUSZE           NUMBER OF BYTES LEFT     Y02027 05780006
*                                       IN BUFFER                Y02027 05790006
SCANNER  EQU   *                                                 Y02027 05800006
         LR    RZERO,RRCB               SAVE AIB ADDRESS         Y02027 05808006
         LR    RETURN,RBASE2            SAVE THRU TRT            Y02027 05816006
         STH   RTEMP,PEWASCAN           SAVE SCAN LENGTH         Y02027 05824006
         BCTR  RTEMP,RZERO              SUBTR 1 FOR EXECUTE      Y02027 05832006
         EX    RTEMP,SCAN               SCAN BUFFER FOR RECDEL   Y02027 05840006
         LR    RBASE2,RETURN            RESTORE AFTER TRT        Y02027 05848006
         BZ    NORECDEL                 BRANCH IF NO RECORD      Y02027 05856006
*                                       DELIMITOR FOUND IN BUFFERY02027 05864006
*        IF RECORD DELIMITER FOUND                               Y02027 05872006
*        - RRCB CONTAINS ADDRESS OF RECORD DELIMITER             Y02027 05880006
*        - RSTCB CONTAINS THE FUNCTION BYTE THAT STOPPED THE SCANY02027 05888006
*                                                                Y02027 05900006
         LA    RSTCB,ONE(RRCB)          GET ADDR 1 BYTE PAST     Y02027 05910006
         ST    RSTCB,PEWAMOVE           RECDEL AND SAVE          Y02027 05920006
         LR    RRCB,RZERO               RESTORE AIB BASE         Y02027 05930006
         TM    AIBOPTCG,CTLBYTE         DCBOPTCD=C SPECIFIED     Y02027 05940006
         BNO   NEOR                     BRANCH IF NO             Y02027 05950006
         TM    AIBOPTCG,MSGFLG          MESSAGE MODE             Y02027 05960006
         BO    NEOR                     BRANCH IF YES            Y02027 05970006
         L     RTEMP,AIBCTLG            GET ADDR OF CTL BYTE     Y02027 05980006
         OI    0(RTEMP),EOR                                      Y02027 05990006
NEOR     EQU   *                                                 Y02027 06000006
         TM    PEWAOPT2,DELETE          SHOULD RECDEL BE DELETED Y02027 06010006
         BZ    RECDELIN                 BRANCH IF NO             Y02027 06020006
         BCTR  RSTCB,RZERO              SUBTRACT 1 TO RECDEL     Y02027 06030006
         LH    RTEMP,PEWAPSZE           GET COUNT OF DATA IN BUF Y02027 06040006
         BCTR  RTEMP,RZERO              AND SUBTR 1 FOR RECDEL TOY02027 06050006
         STH   RTEMP,PEWAPSZE           BE DELETED AND SAVE      Y02027 06060006
         LH    RTEMP,PEWAUSZE           GET COUNT OF DATA IN UNITY02027 06070006
         BCTR  RTEMP,RZERO              AND SUBTR 1 FOR RECDEL TOY02027 06080006
         STH   RTEMP,PEWAUSZE           BE DELETED AND SAVE      Y02027 06090006
RECDELIN EQU   *                                                 Y02027 06100006
         SR    RSTCB,RENTRY             COMPUTE COUNT FOR MOVE   Y02027 06110006
*                                       RECDEL - FIRST DATA BYTE Y02027 06120006
         STH   RSTCB,PEWASCAN           SAVE COUNT               Y02027 06130006
         AR    RCOUNT,RSTCB             ADD TO NUMBER OF BYTES   Y02027 06140006
*                                       OF WORKAREA USED         Y02027 06150006
         BCTR  RSTCB,RZERO              SUBTR 1 FOR EXECUTE      Y02027 06160006
         EX    RSTCB,MOVER              MOVE DATA FROM BUFFER    Y02027 06170006
*                                       TO WORKAREA              Y02027 06180006
         L     RENTRY,PEWAMOVE          NEXT BYTE TO BE MOVED    Y02027 06190006
         AH    RWORK,PEWASCAN           ADDR OF NEXT EMPTY BYTE  Y02027 06200006
*                                       IN WORKAREA              Y02027 06210006
         XC    PEWASOWA,PEWASOWA        ZERO WORKAREA SIZE       Y02027 06220006
         STH   RCOUNT,PEWALREC          STORE RECORD LENGTH      Y02027 06230006
         LH    RTEMP,PEWAPSZE           COUNT OF DATA IN BUFFER  Y02027 06240006
         N     RTEMP,AVTCLRHI           CLEAR HI-ORDER BYTE      Y02027 06250006
         SH    RTEMP,PEWASCAN           COMPUTE AMOUNT LEFT IN   Y02027 06260006
         STH   RTEMP,PEWAPSZE           LOGICAL BUFFER AND STORE Y02027 06270006
         LH    RTEMP,PEWAUSZE           LENGTH OF DATA IN UNIT   Y02027 06280006
         SH    RTEMP,PEWASCAN           COMPUTE AMOUNT LEFT IN   Y02027 06290006
         STH   RTEMP,PEWAUSZE           UNIT AND SAVE            Y02027 06300006
         ST    RBFR,PEWAPEBF            SAVE ADDR OF PARTIALLY   Y02027 06310006
*                                       EMPTY BUFFER             Y02027 06320006
         OI    PEWAOPTC,PARTBUF         TURN ON PARTIAL BUFFER   Y02027 06330006
         NC    PEWAUSZE(2),PEWAUSZE     UNIT EMPTY               Y02027 06340006
         BNZ   CLEAN                    BRANCH IF NO             Y02027 06350006
         NC    PEWAPSZE(2),PEWAPSZE     BUFFER EMPTY             Y02027 06360006
         BNZ   PCHNTST                  BRANCH IF NO             Y02027 06370006
BCLEAN   NI    PEWAOPTC,AVTEFF-PARTBUF  TURN OFF PARTIAL BUFFER  Y02027 06380006
         BAL   RETURN,POSTBUF           POST EMPTY BUFFER TO RETBY02027 06390006
         LR    RRCB,RERB                RESTORE AIB BASE         Y02027 06400006
         EJECT                                                          06410006
CLEAN    EQU   *                                                 Y02027 06420006
         STH   RCOUNT,PEWALREC          COUNT OF BYTES MOVED     Y02027 06430006
         TM    AIBRECFG,UNDFLG          UNDEFINED LENGTH SPEC'D  Y02027 06440006
         BO    OFLOTST                  BRANCH IF YES            Y02027 06450006
         L     RWORK,PEWAWA             GET ADDR OF WORKAREA     Y02027 06460006
         MVC   0(2,RWORK),PEWALREC      MOVE RECORD LENGTH IN WA Y02027 06470006
         TM    AIBMACRF,QSAMFLG         QSAM REQUEST             Y02027 06480006
         BO    OFLOTST                  BRANCH IF YES            Y02027 06490006
         TM    AIBRECFG,BLKFLG          BLOCK RECORDS SPECIFIED  Y02027 06500006
         BNO   OFLOTST                  BRANCH IF NO             Y02027 06510006
         LR    RTEMP,RCOUNT             GET LOGICAL RECORD LENGTHY02027 06520006
         SH    RTEMP,AVTHA4             SUBTR SAM PREFIX         Y02027 06530006
         STH   RTEMP,FOUR(RWORK)        STORE SIZE IN PREFIX     Y02027 06540006
         B     OFLOTST                  CHECK FOR PARIALLY EMPTY Y02027 06550006
*                                       BUFFER                   Y02027 06560006
         EJECT                                                          06570006
*        BUFFER SCANNED BUT NO RECORD DELIMITER FOUND            Y02027 06580006
*        DATA MUST BE MOVED FROM BUFFER TO WORKAREA AND IF WORK  Y02027 06590006
*        AREA IS NOT FULL, NEXT BUFFER EXAMINED                  Y02027 06600006
*                                                                Y02027 06610006
NORECDEL EQU   *                                                 Y02027 06620006
         LR    RRCB,RZERO               RESTORE AIB BASE         Y02027 06630006
         LH    RSTCB,PEWASCAN           GET SCAN LENGTH          Y02027 06640006
         AR    RCOUNT,RSTCB             ADD TO NUMBER OF BYTES   Y02027 06650006
*                                       USED IN WORKAREA         Y02027 06660006
         STH   RCOUNT,PEWALREC          SAVE NUMBER MOVED        Y02027 06670006
         BCTR  RSTCB,RZERO              SUBTR 1 FOR EXECUTE      Y02027 06680006
         EX    RSTCB,MOVER              MOVE DATA TO WORKAREA    Y02027 06690006
         LH    RSTCB,PEWASOWA           WORKAREA SIZE            Y02027 06700006
         N     RSTCB,AVTCLRHI           CLEAR HI-ORDER HALF      Y02027 06710006
         LH    RTEMP,PEWASCAN           COUNT OF BYTES MOVED     Y02027 06720006
         N     RTEMP,AVTCLRHI           CLEAR HI-ORDER HALF      Y02027 06730006
         SR    RSTCB,RTEMP              SUBTR NUMBER OF BYTES    Y02027 06740006
         STH   RSTCB,PEWASOWA           MOVED AND SAVE           Y02027 06750006
         AR    RWORK,RTEMP              ADDR OF NEXT EMPTY BYTE  Y02027 06760006
*                                       IN WORKAREA              Y02027 06770006
         LH    RSTCB,PEWAPSZE           COUNT OF BYTES LEFT IN   Y02027 06780006
*                                       LOGICAL BUFFER           Y02027 06790006
         N     RSTCB,AVTCLRHI           CLEAR HI-ORDER HALF      Y02027 06800006
         SR    RSTCB,RTEMP              SUBTR NUMBER OF BYTES    Y02027 06810006
         STH   RSTCB,PEWAPSZE           MOVED AND SAVE DATA LEFT Y02027 06820006
         LH    RSTCB,PEWAUSZE           COUNT OF BYTES IN UNIT   Y02027 06830006
         SR    RSTCB,RTEMP              SUBTR NUMBER OF BYTES    Y02027 06840006
         STH   RSTCB,PEWAUSZE           LEFT IN UNIT AND STORE   Y02027 06850006
         CLC   PEWASOWA(2),PEWAUSZE     UNIT   EMPTY AND WORKAREAY02027 06860006
*                                       FULL                     Y02027 06870006
         BNE   CHECK                    BRANCH IF NO             Y02027 06880006
         NC    PEWAPSZE(2),PEWAPSZE     LOGICAL BUFFER EMPTY     Y02027 06890006
         BZ    BCLEAN                   BRANCH IF YES            Y02027 06900006
CHECK    EQU   *                                                 Y02027 06910006
         CLC   PEWASOWA(2),PEWAUSZE     COMPARE WORKAREA TO UNIT Y02027 06920006
*                                       SIZE                     Y02027 06930006
         BL    SETPART                  BRANCH IF WORKAREA FULL  Y02027 06940006
*                                       AND UNIT NOT EMPTY       Y02027 06950006
         NC    PEWAPSZE(2),PEWAPSZE     LOGICAL BUFFER EMPTY     Y02027 06960006
         BNZ   PCHNTST                  BRANCH IF WORKAREA NOT   Y02027 06970006
*                                       FULL AND LOGICAL BUFFER  Y02027 06980006
*                                       NOT EMPTY                Y02027 06990006
         EJECT                                                          07000006
*                                                                Y02027 07010006
*        WORKAREA NOT FULL AND LOGICAL BUFFER EMPTY              Y02027 07020006
*                                                                Y02027 07030006
         BAL   RETURN,POSTBUF           POST EMPTY BUFFER TO RETBY02027 07040006
         LR    RRCB,RERB                RESTORE AIB BASE         Y02027 07050006
         NI    PEWAOPTC,AVTEFF-PARTBUF  TURN OFF PARTIAL BUFFER  Y02027 07060006
         TM    PRFSTAT1,PRFNLSTN        BUFFER CONTAIN END OF MSGY02027 07070006
         BO    QCBTEST                  BRANCH IF NO             Y02027 07080006
         OI    PEWAGSW,RETRIEVE         SET RETRIEVE OK          Y02027 07090006
         OI    PEWAGSW+1,EOM            SET EOM LAST TIME FLAG   Y02027 07100006
         B     CLEAN                    RETURN ANY EMPTY BUFFERS Y02027 07110006
*                                                                Y02027 07120006
*              BUFFER NOT EMPTY                                  Y02027 07130006
*                                                                Y02027 07140006
SETPART  EQU   *                                                 Y02027 07150006
         AH    RENTRY,PEWASCAN          ADDR OF NEXT BYTE TO BE  Y02027 07160006
         B     SETPARTA                 MOVED                    Y02027 07170006
PCHNTST  L     RTEMP,PEWAPEUN           GET ADDR OF PARTIALLY    Y02027 07180006
         L     RTEMP,EIGHT(RTEMP)       EMPTY UNIT               Y02027 07190006
         ST    RTEMP,PEWAPEUN           AND UPDATE TO NEXT UNIT  Y02027 07200006
         LA    RENTRY,AVTUMALN(RTEMP)   GET ADDR OF FIRST BYTE   Y02027 07210006
*                                       OF DATA                  Y02027 07220006
         MVC   PEWAUSZE(2),PEWAPSZE     ASSUME SHORT BUFFER COUNTY02027 07230006
         CLC   PEWAPSZE(2),AVTKEYLE     BUFFER A FULL UNIT       Y02027 07240006
         BL    NOTFULL                  BR IF NO                 Y02027 07250006
         MVC   PEWAUSZE(2),AVTKEYLE     SET FULL BUFFER COUNT    Y02027 07260006
NOTFULL  NC    PEWASOWA(2),PEWASOWA     WORKAREA FULL            Y02027 07270006
         BNZ   WUTST                    NO, BRANCH               Y02027 07280006
SETPARTA EQU   *                                                 Y02027 07290006
         OI    PEWAOPTC,PARTBUF         TURN ON PARTIAL BUFFER   Y02027 07300006
         ST    RENTRY,PEWAMOVE          SAVE ADDR FOR NEXT GET   Y02027 07310006
         ST    RBFR,PEWAPEBF            SAVE ADDR OF PARTIAL BFR Y02027 07320006
         B     CLEAN                    RETURN BUFFERS           Y02027 07330006
         EJECT                                                          07340006
*        ALL DATA IN BUFFER CAN BE MOVED INTO WORKAREA           Y02027 07350006
*                                                                Y02027 07360006
EMPTYBFR EQU   *                                                 Y02027 07370006
         SR    RSTCB,RSTCB              CLEAR                    Y02027 07380006
         SR    RTEMP,RTEMP              REGISTERS FOR ICM        Y02027 07390006
         ICM   RSTCB,THREE,PEWAUSZE     NUMBER OF BYTES IN UNIT  Y02027 07400006
*                                       LEFT TO BE MOVED         Y02027 07410006
         ICM   RTEMP,THREE,PEWAPSZE     NUMBER OF BYTES IN       Y02027 07420006
*                                       LOGICAL BUFFER TO BE     Y02027 07430006
*                                       MOVED                    Y02027 07440006
         SR    RTEMP,RSTCB              COMPUTE AMOUNT LEFT IN   Y02027 07450006
         STH   RTEMP,PEWAPSZE           LOGICAL BUFFER AND SAVE  Y02027 07460006
         LH    RTEMP,PEWALREC           COUNT OF BYTES LEFT IN   Y02027 07470006
         N     RTEMP,AVTCLRHI           WORK AREA                Y02027 07480006
         SR    RTEMP,RSTCB              CALCULATE NUMBER OF BYTESY02027 07490006
         STH   RTEMP,PEWALREC           OF WORKAREA LEFT AND SAVEY02027 07500006
         AR    RCOUNT,RSTCB             COUNT OF BYTES LEFT IN   Y02027 07510006
*                                       WORKAREA                 Y02027 07520006
         BCTR  RSTCB,RZERO              SUBTR 1 FOR EXECUTE      Y02027 07530006
         EX    RSTCB,MOVER              MOVE DATA TO WORKAREA    Y02027 07540006
         LA    RSTCB,ONE(RSTCB)         ADD ONE TO COUNT         Y02027 07545006
         AR    RWORK,RSTCB              COMPUTE ADDR OF NEXT     Y02027 07550006
*                                       EMPTY BYTE IN WORKAREA   Y02027 07560006
         NC    PEWAPSZE(2),PEWAPSZE     IS BUFFER EMPTY          Y02027 07570006
         BZ    DONE                     BRANCH IF YES            Y02027 07580006
         L     RTEMP,PEWAPEUN           GET ADDR OF PARIALLY     Y02027 07590006
         L     RTEMP,EIGHT(RTEMP)       EMPTY UNIT               Y02027 07600006
         ST    RTEMP,PEWAPEUN           AND UPDATE TO NEXT UNIT  Y02027 07610006
         LA    RENTRY,AVTUMALN(RTEMP)   GET ADDR OF FIRST BYTE   Y02027 07620006
*                                       OF DATA                  Y02027 07630006
         MVC   PEWAUSZE(2),PEWAPSZE     ASSUME SHORT BUFFER COUNTY02027 07640006
         CLC   PEWAPSZE(2),AVTKEYLE     BUFFER A FULL UNIT       Y02027 07650006
         BL    SHORTBUF                 BRANCH IF NO             Y02027 07660006
         MVC   PEWAUSZE(2),AVTKEYLE     SET FULL BUFFER COUNT    Y02027 07670006
SHORTBUF EQU   *                                                 Y02027 07680006
         ST    RENTRY,PEWAMOVE          NEXT BYTE TO BE MOVED    Y02027 07690006
         OI    PEWAOPTC,PARTBUF         SET PARTIAL BUFFER       Y02027 07700006
         B     NOPOST                   SKIP BUFFER POST         Y02027 07708006
DONE     EQU    *                                                Y02027 07716006
         BAL   RETURN,POSTBUF           POST EMPTY BUFFER TO RETBY02027 07724006
         LR    RRCB,RERB                RESTORE AIB BASE         Y02027 07732006
NOPOST   EQU   *                                                 Y02027 07740006
         CLC   PEWALREC(2),AVTFZERO     WORKAREA FULL            Y02027 07748006
         BE    CLEANUP                  BRANCH IF YES            Y02027 07756006
         NI    PEWAOPTC,AVTEFF-PARTBUF  TURN OFF PARTIAL BUFFER  Y02027 07764006
         NC    PEWAPSZE(2),PEWAPSZE     LOGICAL BUFFER EMPTY     Y02027 07772006
         BNZ   SZETST                   BRANCH IF NO             Y02027 07780006
         TM    PRFSTAT1,PRFNLSTN        EOM IN BUFFER            Y02027 07788006
         BO    QCBTEST                  BRANCH IF NO             Y02027 07800006
*                                                                Y02027 07810006
         OI    PEWAGSW,RETRIEVE         SET RETRIEVE OK          Y02027 07820006
         OI    PEWAGSW+1,EOM            SET EOM FLAG             Y02027 07830006
         NI    PEWAGSW,AVTEFF-INCWA     NOT INCOMPLETE WORKAREA  Y02027 07840006
         EJECT                                                          07850006
*                                                                Y02027 07860006
*              CHECK FOR WORKAREA OVERFLOW TO BE SET             Y02027 07870006
*                                                                Y02027 07880006
OFLOTST  TM    PEWAOPTC,PARTBUF         PARTIAL BUFFER           Y02027 07890006
         BNO   CLEANUP                  BRANCH IF NO             Y02027 07900006
         TM    AIBOPTCG,CTLBYTE         CONTROL BYTE SPECIFIED   Y02027 07910006
         BO    CLEANUP                  BRANCH IF YES            Y02027 07920006
         TM    AIBOPTCG,MSGFLG          WORK UNIT A MESSAGE      Y02027 07930006
         BNO   CLEANUP                  BRANCH IF NO             Y02027 07940006
         OI    PEWAOPTC,SYNADFLG        SET SYNAD EXIT FLAG      Y02027 07950006
CLEANUP  EQU   *                                                 Y02027 07960006
         STH   RCOUNT,PEWALREC          SAVE AMOUNT OF DATA MOVEDY02027 07970006
         TM    AIBOPTCG,MSGFLG          IS WORK UNIT A MESSAGE   Y02027 07980006
         BO    BACKUP                   BRANCH IF YES            Y02027 07990006
         CLI   PEWARDEL,AVTEZERO        WAS RECORD DELIMITER     Y02027 08000006
*                                       SPECIFIED                Y02027 08010006
         BE    BACKUP                   BRANCH IF NO             Y02027 08020006
         LA    RSTCB,PEWATRT            GET ADDR OF TRT TABLE    Y02027 08030006
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 08040006
         IC    RTEMP,AVTSCBSZ           GET SCB SIZE             Y02027 08050006
         AR    RSTCB,RTEMP              GET TRT PAST SCB         Y02027 08060006
         IC    RTEMP,PEWARDEL           GET RECORD DELIMITER     Y02027 08070006
         AR    RSTCB,RTEMP              ADDR OF BYTE IN TABLE    Y02027 08080006
         MVI   0(RSTCB),AVTEZERO        CLEAR TRT TABLE          Y02027 08090006
         MVI   PEWARDEL,AVTEZERO        SET SWITCH BACK TO ZERO  Y02027 08100006
BACKUP   EQU   *                                                 Y02027 08110006
         TM    AIBOPTCG,CTLBYTE         CONTROL BYTE IN WORKAREA Y02027 08120006
         BZ    GOBACK                   BRANCH IF NO             Y02027 08130006
         L     RTEMP,AIBCTLG            ADDR OF CONTROL BYTE     Y02027 08140006
         OI    0(RTEMP),ISEGFLAG        SET BIT TO INDICATE      Y02027 08150006
*                                       INTERMEDIATE SEGMENT     Y02027 08160006
         CLC   PEWAPSZE(2),AVTFZERO     BUFFER EMPTY             Y02027 08170006
         BNE   GOBACK                   BRANCH IF YES            Y02027 08180006
         TM    PRFSTAT1,PRFNLSTN        BUFFER CONTAIN EOM       Y02027 08190006
         BO    GOBACK                   BRANCH IF NO             Y02027 08200006
         OI    0(RTEMP),EOMFLAG         SET BITS TO INDICATE     Y02027 08208006
*                                       LAST SEGMENT OF MESSAGE  Y02027 08216006
         OI    PEWAGSW,RETRIEVE         SET RETRIEVE OK          Y02027 08224006
         OI    PEWAGSW+1,EOM            SET EOM LAST TIME FLAG   Y02027 08232006
GOBACK   EQU   *                                                 Y02027 08240006
         MVI   AIBDECS,WAFULL           SET BUFFERS IN AIB       Y02027 08248006
*                                       WORKAREA                 Y02027 08256006
         XC    PEWAWA(4),PEWAWA         ZERO WORKAREA PTR        Y02027 08264006
CONTRET  EQU   *                                                 Y02027 08272006
         LA    RETURN,CONTINU           SET RETURN AFTER POST    Y02027 08280006
GOODRETC EQU   *                                                 Y02027 08288006
         SR    RENTRY,RENTRY            SET GOOD COMPLETION CODE Y02027 08300006
*        POST APPLICATION PROGRAM ECB COMPLETE -PECB OR DECB     Y02027 08308006
XMPOST   EQU   *                                                 Y02027 08316006
         MVC   AIBCMPTG(4),PEWAECBA     PUT ECB ADDR IN LIST     Y02027 08324006
         NI    PEWAFLG,POSTOFFF         TURN POST FLAG OFF       Y02027 08332006
         XC    PEWAECBA,PEWAECBA        CLEAR ECB PTR            Y02027 08340006
XMPOST1  EQU   *                                                 Y02027 08348006
         LR    RZERO,RENTRY             LOAD COMPLETION CODE     Y02027 08356006
         MVI   AIBCMPTG,ZERO            ZERO HIGH ORDER BYTE     Y02027 08364006
*                                       OF ECB PTR               Y02027 08372006
         L     RERB,PEPCBAD             GET PCB ADDRESS          Y02027 08380006
         L     RERB,PCBPEBAD-IEDQPCB(RERB) GET PEB ADDRESS       Y02027 08388006
         LTR   RERB,RERB                TEST IF AP IS ACTIVE     Y02027 08400006
         BZ    FREEAIB                  BRANCH IF NO             Y02027 08410006
         L     RERB,PEBASCB-IEDQPEB(RERB) GET ASCB ADDRESS       Y02027 08420006
         LTR   RERB,RERB                TEST IF FLAG HAS         Y02027 08430006
*                                       INVALIDATED ASCB ADDR    Y02027 08440006
         BM    FREEAIB                  BRANCH IF NEG. FLAG ON   Y02027 08450006
         L     RENTRY,PEPCBAD           PCB ADDR               @ZA05000 08463081
         L     RENTRY,PCBPEBAD-IEDQPCB(RENTRY) PEB ADDR        @ZA05000 08466081
         L     RERB,CVTPTR              CVT ADDR               @ZA05000 08469081
         ICM   RERB,ALL,CVTAQAVT-CVTMAP(RERB)  TCX ADDR        @ZA05000 08472081
         CLC   PEBASID-IEDQPEB+TWO(2,RENTRY),TCXASID-IEDQTCX(RERB)      08475081
*                                       IS A.P. A SUBTASK OF   @ZA05000 08478081
*                                         MCP                  @ZA05000 08481081
         BNE   XMPOST2                  NO, DO CROSS MEMORY    @ZA05000 08484081
*                                         POST                 @ZA05000 08487081
         L     RPARM,AIBCMPTG           GET ECB ADDR           @ZA05000 08490081
         POST  (1),(0)                  DO NORMAL POST         @ZA05000 08491081
         B     XMPOST3                  CONTINUE               @ZA05000 08493081
XMPOST2  EQU   *                                               @ZA05000 08496081
*        ISSUE SVC 102 TO SCHEDULE SRB TO POST THE             @Z40X9AG 08500000
*        ECB IN THE APPLICATION PROGRAM'S MEMORY               @Z40X9AG 08501000
         MVC   AIBSSGAS,PEBASCB-IEDQPEB(RENTRY) SET ASCB ADDR  @Z40X9AG 08502000
         MVC   AIBSSGID,PEBASID+TWO-IEDQPEB(RENTRY) SET ASID   @Z40X9AG 08507000
         STC   RZERO,AIBSSGCC           SET COMPLETION CODE    @Z40X9AG 08509000
         MVC   AIBSSGTC,PEBTCB-IEDQPEB(RENTRY) SET TCB ADDR    @Z40X9AG 08514000
         MVI   AIBSSGF1,AIBSSGEC        SET ENTRY CODE         @Z40X9AG 08516000
         LA    RPARM,AIBCMPTG           POINT TO PARM LIST     @Z40X9AG 08521000
         AQCTL                          SVC 102                @Z40X9AG 08523000
*                                                                Y02027 08535006
XMPOST3  EQU   *                                               @ZA05000 08538081
         LA    RERB,PEERB               RELOAD ERB ADDRESS       Y02027 08542006
         BR    RETURN                   BRANCH AS SET UP TO      Y02027 08549006
*                                       DSPDISP,NOTRET,CONTINU     2027 08556006
CONTINU  EQU   *                                                 Y02027 08563006
         L     RTEMP,PEWALCBA           DUMMY LCB ADDRESS        Y02027 08570006
         TM    LCBSTAT1-IEDQLCB(RTEMP),LCBRCLLN  RETRIEVE MODE   Y02027 08577006
         BNO   CKREADA                  BRANCH IF NO             Y02027 08584006
         TM    PRFSTAT1,PRFNLSTN        EOM BUFFER               Y02027 08591006
         BNO   CONTINU1                 BRANCH IF YES          @ZA02645 08600081
         TM    LCBERBST-IEDQLCB(RTEMP),LCBEOMSG                @ZA02645 08600881
*                                       EOM BUFFER RETRIEVED   @ZA02645 08601681
         BNO   BLDERBB                  YES, CONTINUE RECALL   @ZA02645 08602481
CONTINU1 EQU   *                                               @ZA02645 08603281
         CLC   PERAQCB+ONE(THREE),AVTDELAD+ONE READ AHEAD QUE    Y02027 08604006
*                                       EMPTY                    Y02027 08608006
         BE    QEMPTY                   BRANCH IF QUEUE EMPTY  @G36XRAW 08609010
         BAL   RETURN,DSPDISP           NO, BRANCH NO CLEAN UP @G36XRAW 08612006
QEMPTY   EQU   *                                               @G36XRAW 08612510
         TM    PEWARTVE+THREE,MULTSEQ   IS THIS MULT RETRIEVE  @OZ08360 08613081
         BNO   NOMLTRVE                 BR- NOT MULTI RETRIEVE @G36XRAW 08613510
         BAL   RETURN,DSPDISP           BR YES TO DISPATCHER   @G36XRAW 08614081
NOMLTRVE EQU   *                                               @G36XRAW 08614510
         B     RCLEANX                  CLEAN UP RETRIEVE        Y02027 08616006
CKREADA  EQU   *                                                 Y02027 08620006
         CLC   PEWACBUF+ONE(3),AVTDELAD+ONE  CHAIN EMPTY         Y02027 08624006
         BNE   MHPOST                   BRANCH IF NO             Y02027 08628006
         TM    LCBERBST-IEDQLCB(RTEMP),LCBEOMSG  EOM SEG READ    Y02027 08632006
         BO    NOTRET                   BRANCH IF YES READ AHEAD Y02027 08636006
         TM    PRFSTAT1,PRFNLSTN        EOM BUFFER               Y02027 08640006
         BO    BLDERB                   BRANCH IF NO             Y02027 08644006
         B     NOTRET                   START READ AHEAD         Y02027 08648006
FREEAIB  EQU   *                                                 Y02027 08652006
         MVI   AIBSTATE,AIBFREE         SET AIB AS FREE          Y02027 08656006
         BAL   RETURN,DSPDISP           BRANCH TO AVOID XMPOST @G36XRAW 08660006
         EJECT                                                          08664006
QCBTEST  EQU   *                                                        08668006
         CLC   PERAQCB+ONE(3),AVTDELAD+ONE  MORE BUFFERS ON CHAINY02027 08672006
         BE    QWAIT                    BRANCH IF NO             Y02027 08676006
         L     RBFR,PERAQCB             GET ADDR OF NEXT BUFFER  Y02027 08680006
         ST    RBFR,PEWAPEUN            SAVE CURRENT UNIT        Y02027 08684006
         LH    RTEMP,AVTKEYLE           GET LENGTH OF UNIT LESS  Y02027 08688006
*                                       UNIT MANAGEMENT AREA     Y02027 08692006
         ST    RBFR,PEWAPEBF            SAVE PARTIAL BFR ADDR  @OZ26376 08696086
         LA    RSTCB,AVTTXTSZ           LENGTH OF TEXT PREFIX    Y02027 08700006
         SR    RTEMP,RSTCB              COMPUTE DATA LENGTH IN   Y02027 08710006
         STH   RTEMP,PEWAUSZE           UNIT AND SAVE            Y02027 08720006
         LH    RTEMP,PRFSIZE            GET LOGICAL BUFFER SIZE  Y02027 08730006
         N     RTEMP,AVTCLRHI           CLEAR HI-ORDER HALF      Y02027 08740006
         SR    RTEMP,RSTCB              SUBTRACT LENGTH OF PREFIXY02027 08750006
         STH   RTEMP,PEWAPSZE           AND STORE DATA SIZE      Y02027 08760006
         LA    RENTRY,PRFSTXT           INITIALIZE WITH DATA ADDRY02027 08770006
         CLC   PEWAUSZE(2),PEWAPSZE     LOGICAL BUFFER FIT IN    Y02027 08780006
*                                       ONE UNIT                 Y02027 08790006
         BL    POSTHDRX                 BRANCH IF YES            Y02027 08800006
         MVC   PEWAUSZE(2),PEWAPSZE     ADJUST UNIT SIZE         Y02027 08810006
         B     POSTHDRX                 GET NEXT BUFFER          Y02027 08820006
QWAIT    EQU    *                       WAIT FOR NEXT ELEMENT    Y02027 08830006
         L     RTEMP,PEWALCBA           DUMMY LCB ADDRESS        Y02027 08840006
         ST    RWORK,PEWANEB            SAVE ADDR OF NEXT EMPTY  Y02027 08850006
*                                       BYTE IN WORKAREA         Y02027 08860006
         ST    RCOUNT,PEWAPEUN          SAVE NUMBER OF BYTES USEDY02027 08900006
         OI    PEWAGSW,INCWA            SET INCOMPLETE WORKAREA  Y02027 08908006
         TM    LCBSTAT1-IEDQLCB(RTEMP),LCBRCLLN RETRIEVE MODE    Y02027 08916006
         BO    BLDERBB                  YES, BRANCH GET NXT BUFF Y02027 08924006
         B     CKREADA                  WHEN ELEMENT IS PUT ON   Y02027 08932006
*                                       RAQCB, BRANCH WILL BE    Y02027 08940006
*                                       TAKEN TO QCBTEST         Y02027 08948006
         EJECT                                                          08956006
*                                                                Y02027 08964006
*              RETURN EMPTY BUFFER TO RETURN BUFFER QUEUE        Y02027 08972006
*                                                                Y02027 08980006
POSTBUF  MVC   PERAQCB+ONE(3),PRFLINK   REMOVE EMPTY BUFFER FROM Y02027 08988006
*                                       READ AHEAD QCB           Y02027 09000006
         TM    PRFSTAT1,PRFDUPLN        RECALL                 @ZA03050 09001081
         BNZ   POSTBUF1                 BRANCH IF YES          @ZA03050 09002081
         SR    RERB,RERB                CLEAR REGISTER           Y02027 09005006
         IC    RERB,PEWABFCT            CURRENT BUFFER COUNT     Y02027 09010006
         LA    RERB,ONE(RERB)           ADD ONE TO COUNT         Y02027 09015006
         STC   RERB,PEWABFCT            NEW BUFFER COUNT         Y02027 09020006
POSTBUF1 EQU   *                                               @ZA03050 09022081
         LR    RERB,RRCB                SAVE AIB ADDRESS         Y02027 09025006
         TM    PRFSTAT1,PRFNLSTN        EOM BUFFER               Y02027 09030006
         BO    NOTEOM                   BRANCH IF NO             Y02027 09035006
*                                                                Y02027 09040006
*              SAVE EOM BUFFER UNTIL NEXT EOM BUFFER             Y02027 09045006
*                                                                Y02027 09050006
         L     RTEMP,PEWALCBA           GET LCB ADDRESS          Y02027 09055006
         TM    LCBSTAT1-IEDQLCB(RTEMP),LCBRCLLN  RETRIEVE MODE   Y02027 09060006
         BO    NOTEOM                   BRANCH IF YES            Y02027 09065006
         MVC   PRFSVFFO,PRFQCBA         MOVE FROM SAVED LOCATION Y02027 09070006
         OI    PEWAFLG,MHOK             SET ALRIGHT TO SEND      Y02027 09075006
*                                       MESSAGE TO MH            Y02027 09080006
         L     RSTCB,EOMSAVE            GET LAST EOM BUFFER      Y02027 09100006
         ST    RBFR,EOMSAVE             SAVE NEW EOM BUFFER      Y02027 09104006
         LTR   RSTCB,RSTCB              EOM BUFFER SAVED?        Y02027 09108006
         BZR   RETURN                   BRANCH IF NO             Y02027 09112006
*                                                                Y02027 09116006
*              POST PREVIOUS EOM BUFFER TO MARK SERVICED         Y02027 09120006
*                                                                Y02027 09124006
         LA    RTEMP,PEWASCB            SCB ADDR               @SA69973 09124561
         L     RRCB,PEWAPROC            PROCESS ENTRY ADDR     @SA69973 09125061
         MVC   SCBDESTQ-IEDQSCB(3,RTEMP),TRMDESTQ-IEDQTRM(RRCB) SA69973 09125561
*                                       SET DEST QCB ADDR      @SA69973 09126061
         LA    RTEMP,AVTDSIOB           ADDR OF DISK I/O QCB     Y02027 09128006
         STCM  RTEMP,SEVEN,PRFQCBA-IEDQPRF(RSTCB) STORE BUFFER   Y02027 09132006
         MVI   PRFPRI-IEDQPRF(RSTCB),PRIDKSRV BUFFER SERVICED PRIY02027 09136006
         MVI   PRFTIC-IEDQPRF(RSTCB),TIC                         Y02027 09140006
         LR    RRCB,RSTCB               SET REG FOR TPOST        Y02027 09144006
         B     DSPPOSTR                 POST BUFFER TO DSKIO Q   Y02027 09148006
*                                       RETURN IS VIA REGISTER 14Y02027 09152006
*                                       WHICH RETURNS TO CALLER  Y02027 09156006
NOTEOM   EQU   *                                                 Y02027 09160006
         LA    RTEMP,AVTBFRTB           ADDR OF RETURN BUF QCB   Y02027 09164006
         STCM  RTEMP,SEVEN,PRFQCBA      STORE QCB IN ELEMENT     Y02027 09168006
         MVI   PRFPRI,PRIBFRTB          PRIORITY OF POST         Y02027 09172006
         LR    RRCB,RBFR                SET UP REG1 FOR DSPPOSTR Y02027 09176006
         B     DSPPOSTR                 POST BUFFER TO RETURN    Y02027 09180006
*                                       BUFFER QUEUE             Y02027 09184006
*                                       RETURN IS VIA REGISTER   Y02027 09188006
*                                       14 WHICH RETURNS TO      Y02027 09192006
*                                       CALLING ROUTINE          Y02027 09196006
*                                                                Y02027 09600006
*              INSTRUCTIONS FOR EXECUTE STATEMENTS               Y02027 09610006
*                                                                Y02027 09620006
MOVER    MVC   0(1,RWORK),0(RENTRY)     EXECUTE INSTRUCTION THAT Y02027 09630006
*                                       MOVES DATA FROM BUFFER   Y02027 09640006
*                                       TO WORKAREA              Y02027 09650006
SCAN     TRT   0(1,RENTRY),0(RSTCB)     EXECUTE INSTRUCTION THAT Y02027 09660006
*                                       SCANS BUFFER FOR USER'S  Y02027 09670006
*                                       RECDEL                   Y02027 09680006
MOVENME  MVC   0(1,RWORK),0(RTEMP)      EXECUTE INSTRUCTION THAT Y02027 09690006
*                                       MOVES TERMNAME TO SOURCE Y02027 09700006
*                                       FIELD IN WORKAREA        Y02027 09708006
MOVE2    MVC   EIGHT(1,RENTRY),0(RTEMP) EXECUTE INSTRUCTION THAT Y02027 09716006
*                                       MOVES SOURCE TO WORKAREA Y02027 09724006
PATCH    DC    25H'0'                   PATCH AREA               Y02027 09732006
         EJECT                                                          09740006
GETSCHED EQU   *                        GET SCHEDULER            Y02027 09748006
         LA    RBASE2,GETSCHED-IEDQEW-TWO(RENTRY) LOAD BASE REG  Y02027 09756006
*                                       FOR GET SCHEDULER PORTIONY02027 09764006
         LA    RBASE,LABEL-IEDQEW-TWO(RENTRY) ESTABLISH FIRST    Y02027 09772006
*                                       BASE REGISTER            Y02027 09780006
         DROP  RRCB                                              Y02027 09788006
         USING IEDQRECB,RRCB                                     Y02027 09800006
*                                                                Y02027 11700006
*              BUFFER POSTED TO DESTINATION QCB                  Y02027 11750006
*                                                                Y02027 11800006
         TM    QCBDSFLG,QCBFQCB         DESTINATION QCB                 11900020
         BNO   ELEMTEST                 BRANCH IF NO                    12000020
         SPACE 2                                                        12100020
         TM    PRFSTAT1-IEDQPRF(RRCB),PRFNHDRN   IS THIS A HDR   S21101 12110020
         BO    BYPASS                  NO, NO CHECK FOR INIT     S21101 12112020
         L     RWORK,PRFLCB-1-IEDQPRF(,RPARM)   GET LCB ADDRESS  S21101 12114020
         TM    LCBSTAT1-IEDQLCB(RWORK),LCBINITN    INITIATE MODE S21101 12116020
         BNO   BYPASS                  NO, DO NOT INITIATE GET   S21101 12118020
         STM   RPARM,RQCB,AVTSAVE3+24  SAVE REGISTERS            S21101 12118420
         LA    RENTRY,TAG              SET BASE FOR ROUTINE      S21101 12118820
         BALR  RETURN,RENTRY           BRANCH - RETURN FROM      S21101 12119220
*                                       DSPPOSTR                 S21101 12119620
         LM    RPARM,RQCB,AVTSAVE3+24  RESTORE REGISTERS         S21101 12119720
         L     RSTCB,QCBSTCHN-1         DEST SCHED STCB        @ZA01154 12119861
         BAL   RETURN,DSPBYPAS          START INIT MODE        @G36XRAW 12119961
*                                                                     * 12120020
*        GET SCHEDULER HAS BEEN POSTED A FULL BUFFER                  * 12140020
*                                                                     * 12160020
BYPASS   EQU   *                                                        12200020
         L     RSTCB,4(0,RSTCB)         ADDRESS OF STCB FOR             12300020
*                                       DESTINATION SCHEDULER           12400020
         BAL   RETURN,DSPBYPAS          PASS FULL BUFFER TO    @G36XRAW 12500020
*                                       DESTINATION SCHEDULER           12600020
         EJECT                                                          12700020
CHNGTST  EQU   *                                                 S21101 14200020
*                                                                S21101 14250020
         OI    PEWAFLG,RAFLG            ALLOW READ AHEAD         Y02027 14270006
         CLC   PERAQCB+1(3),AVTDELAD+1  READ-AHEAD QCB EMPTY     S21101 14300020
         BE    RQEMPTY                  BR-YES READ QUE EMPTY  @G36XRAW 14301010
         BAL   RETURN,DSPDISP           NO-DO NOT CHANGE QCB'S @G36XRAW 14310020
RQEMPTY  EQU   *                                               @G36XRAW 14310510
         CLC   PEWACBUF+ONE(3),AVTDELAD+ONE  BUFFER READY FOR MH Y02027 14312006
         BE    GOMH                     BR-YES                 @G36XRAW 14313010
         BAL   RETURN,DSPDISP           BRANCH IF NO           @G36XRAW 14314022
GOMH     EQU   *                                               @G36XRAW 14315010
*                                                                     * 14320020
*        PUT GET SCHEDULER'S STCB INTO DESTINATION QCB                * 14340020
*                                                                     * 14360020
         L     RSTCB,PEWAPROC           PROCESS ENTRY ADDRESS           14400020
         L     RSTCB,TRMDESTQ-1-IEDQTRM(0,RSTCB) SET REG TO POINT       14500020
*                                       TO QCB TO WHICH STCB IS         14700020
*                                       TO BE MOVED                     14800020
         LA    RQCB,PERAQCB             ADDRESS OF QCB NOW       Y02027 14900006
*                                       CONTAINING THE STCB      Y02027 15100006
         BAL   RETURN,DSPUNAV           MOVE SCHEDULER         @G36XRAW 15300006
         EJECT                                                          15600020
NOTRET   EQU   *                                                 S21101 15650020
*                                                                Y02027 15652006
*              LOOK FOR NEXT MESSAGE TO GET                      Y02027 15654006
*                                                                Y02027 15656006
         TM    PEWAFLG,RAFLG           CAN WE DO READ-AHEAD NOW  S21101 15660020
         BO    RDAHEAD                 BR-YES                  @G36XRAW 15661010
         BAL   RETURN,DSPDISP          BRANCH IF NO            @G36XRAW 15670020
RDAHEAD  EQU   *                                               @G36XRAW 15671010
         NI    PEWAFLG,X'FF'-RAFLG     SET NO READ-AHEAD NOW     S21101 15680020
ERBFIX   EQU   *                                                        15700020
* FIND PRIORITY QCB CONTAINING A MESSAGE                                15800020
         TM    PEWAFLG,CFLG+PEWASTOP    STOPPED WITH CLOSE     @OS77017 15820081
*                                        PENDING               @OS77017 15840081
         BO    CLOSDOWN                 YES, BRANCH            @OS77017 15860081
         TM    PEWAFLG,ERBBUSY+PEWASTOP ERB NOT POSTABLE        SA63961 15900052
         BZ    ERBPOST                  BR IF IS POSTABLE      @G36XRAW 15901010
         BAL   RETURN,DSPDISP           EXIT IF YES            @G36XRAW 16000052
ERBPOST  EQU   *                                               @G36XRAW 16100010
         CLC   PEWACBUF+ONE(3),AVTDELAD+ONE  NEW READ POSSIBLE   Y02027 16200006
         BE    ERBFIXA                  BRANCH IF YES           SA54921 16400022
         CLC   PERAQCB+1(3),AVTDELAD+1  R.A. QUEUE EMPTY        SA54921 16440022
         BE    MHPOST                   BRANCH IF YES           SA54921 16480022
         BAL   RETURN,DSPDISP           EXIT TO DISPATCHER     @G36XRAW 16520022
ERBFIXA  EQU   *                                                SA54921 16560022
         LA    RSCB,PEWASCB             ADDRESS OF SCB           Y02027 16580006
         L     RSTCB,PEWAPROC           PROCESS ENTRY ADDRESS    Y02027 16600006
         MVC   SCBDESTQ(3),TRMDESTQ-IEDQTRM(RSTCB) SET DESTQ     Y02027 16620006
         L     RQCB,TRMDESTQ-ONE-IEDQTRM(0,RSTCB) DEST QCB ADDR. Y02027 16650006
         SPACE 1                                                        16710020
         USING IEDQPCB,RWORK                                     S21101 16720020
         L     RWORK,QCBINSRC-1        GET INITIATE SOURCE LCB   S21101 16726020
         N     RWORK,CLEAR             CLEAR IN-SOURCE BITS      S21101 16728020
         LA    RQCB,ZERO(RQCB)          CLEAR FOR COMPARE        Y02027 16728406
         L     RTEMP,PEWALCBA          PUT DEST LCB ADDR         S21101 16728820
         CLR   RWORK,RQCB               IS THERE INITIATE MSG    Y02027 16729206
         BE    NOINIT                  NO, CHECK FOR PRIORITY MSGS21101 16729620
         MVC   QCBINSRC(3),LCBINSRC-IEDQLCB(RWORK)  REMOVE LCB   S21101 16729720
*                                      FROM INITIATE CHAIN       S21101 16729820
         IC    RZERO,LCBCHAIN-IEDQLCB(,RWORK)  SAVE DISPOSITION SA62953 16729905
*                                       STATUS BITS             SA62953 16730905
         ST    RTEMP,LCBINSRC-ONE-IEDQLCB(,RWORK) IN SOURCE LCB SA62953 16731905
         STC   RZERO,LCBCHAIN-IEDQLCB(,RWORK)  RESTORE DISPOSI- SA62953 16732905
*                                       TION STATUS BITS        SA62953 16733905
         L     RWORK,LCBSCBA-1-IEDQLCB(RWORK)  SOURCE SCB ADDR   S21101 16739920
         MVC   SCBSCHDR,SCBDCHDR-IEDQSCB(RWORK)                  S21101 16749920
         TM    QCBDSFLG,QCBREUS+QCBNREUS    REUSABILITY IN       S21101 16753220
         BNZ   MOVEIT                   BRANCH IF YES            Y02027 16755206
         MVC   SCBSCHDR,SCBCCHDR-IEDQSCB(RWORK)                  S21101 16755620
MOVEIT   EQU   *                                                 Y02027 16756006
         MVC   SCBSCSEG,SCBSCHDR       SET HEADER ADDRESS        S21101 16756420
         NI    SCBQTYPE,X0F            CLEAR Q-TYPE              S21101 16756520
         OI    LCBSTAT1-IEDQLCB(RTEMP),LCBSENDN+LCBINITN         S21101 16756620
         NI    LCBSTAT1-IEDQLCB(RTEMP),AVTEFF-LCBRCLLN ENSURE    Y02027 16759606
*                                       RECALL NOT SET           Y02027 16762606
         B     INITSEND                 GO TO INITIATE SENDING  SA52971 16767422
         USING IEDQPQCB,RSTCB           QCB BASE                 Y02027 16778206
         SPACE 1                                                        16778320
NOINIT   EQU   *                                                 S21101 16781920
         NI    LCBSTAT1-IEDQLCB(RTEMP),AVTEFF-LCBINITN           Y02027 16783906
         SR    RTEMP,RTEMP             CLEAR WORK REGISTER       S21101 16784320
         TM    QCBDSFLG,QCBHELD         REUSABILITY IN           Y02027 16785606
         BO    CHNGTST                  BRANCH IF YES                   16789220
         LA    RSTCB,IEDQPQCB-IEDQQCB(RQCB) PRIORITY QCB ADDR.   Y02027 16800006
LOOP     EQU   *                                                        16900020
         NC    QCBFFEFO(THREE),QCBFFEFO IS THERE A MSG FOR THIS        X17000020
                                        PRIORITY LEVEL                  17100020
         BNZ   BUILDSCB                 BRANCH IF YES                   17200020
         CLI   QCBPRIPQ,ZERO            IS THIS THE LAST PRIORITY      X17300020
                                        QCB FOR THIS MASTER QCB         17400020
         BZ    CHNGTST                  BRANCH IF YES- ASSUME THAT     X17500020
                                        GET SCHEDULER ACTIVATED        X17600020
                                        FROM READ-AHEAD QCB             17700020
         LA    RSTCB,QCBPEND            GET ADDRESS OF NEXT PQCB Y02027 17800006
         LA    RTEMP,ONE(RZERO,RTEMP)   INCREMENT PQCB COUNTER          17900020
         B     LOOP                     TEST THIS PRIORITY QCB          18000020
         EJECT                                                          18100020
BUILDSCB EQU   *                                                        18200020
*                                                                     * 18220020
*        PREPARE SCB FOR USE IN READING MESSAGE FROM DESTINATION QCB  * 18240020
*                                                                     * 18260020
         CLI   PEWABFCT,AVTEZERO        BUFFER LIMIT REACH       Y02027 18300006
         BNE   SKIPRDFG                 BYPASS TURNING RAFLG ON  Y02027 18400006
SETRAFLG EQU   *                                               @SA73367 18410061
         OI    PEWAFLG,RAFLG            ALLOW READ AHEAD         Y02027 18420006
         BAL   RETURN,DSPDISP           BR TO DISP             @G36XRAW 18440006
SKIPRDFG EQU   *                        CONT BUILDING SCB        Y02027 18460006
         TM    PEWAFLG,ERBBUSY+PEWASTOP ERB NOT POSTABLE        SA63961 18500052
         BZ    ERBPOSTA                                        @G36XRAW 18501010
         BAL   RETURN,DSPDISP           EXIT IF YES            @G36XRAW 18600052
ERBPOSTA EQU   *                                               @G36XRAW 18610010
         CLC   PERAQCB+1(3),AVTDELAD+1  R.A.Q. EMPTY           @SA71093 18630061
         BNE   SETRAFLG                 SET RAFLG AND EXIT     @SA73367 18660061
         MVC   SCBSCHDR,QCBFFEFO        MOVE DISK/CORE RECORD           18700020
         MVC   SCBSCSEG,QCBFFEFO        NUMBER INTO SCB                 18800020
         NI    SCBQTYPE,X0F             CLEAR QUEUE TYPE                18850020
         STC   RTEMP,SCBPRI             PUT PRIORITY QCB INDEX         X19300020
                                        INTO SCB                        19400020
         L     RWORK,PEWALCBA           LCB ADDRESS                     19500020
         MVI   LCBSTAT1-IEDQLCB(RWORK),LCBSENDN  SET FOR SEND  @SA69658 19600061
INITSEND EQU   *                                                SA52971 19620022
         XC    SCBFEFO,SCBFEFO          CLEAR SCB FOR SENDING   SA52971 19640022
         OI    QCBFLAG,QCBSDFFO         MARK QCB AS IN PROCESS  SA52971 19660022
*                                       OF SENDING MESSAGE      SA52971 19680022
BLDERB   EQU   *                                                        19700020
         CLI   PEWABFCT,AVTEZERO        BUFFER SUPPLY EXHAUSTED  Y02027 19800006
         BNE   MORBUF                   BR-NO                  @G36XRAW 19800110
         BAL   RETURN,DSPDISP           BRANCH IF YES          @G36XRAW 19900020
MORBUF   EQU   *                                               @G36XRAW 19930010
         LA    RERB,PEERB               RELOAD ERB ADDRESS       Y02027 19950006
         TM    PEWAFLG,ERBBUSY+PEWASTOP ERB NOT POSTABLE        SA63961 20200052
         BZ    ERBPOST1                 BR- NO                 @G36XRAW 20200110
         BAL   RETURN,DSPDISP           EXIT IF YES            @G36XRAW 20300052
ERBPOST1 EQU   *                                               @G36XRAW 20300110
         MVC   LCBERBCT(1),PEWABFCT     NO. BUFFERS WANTED     @OZ26356 20340100
         L     RWORK,PEWALCBA           LCB ADDRESS             SA57355 20400022
         MVC   LCBTTCIN,LCBTTBIN-IEDQLCB(RWORK)                 SA57355 20450022
*                                       SET UP TTCIN            SA57355 20500022
BLDERBB  EQU   *                                                        20550020
         TM    PEWAFLG,ERBBUSY+PEWASTOP ERB NOT POSTABLE        SA63961 20560052
         BZ    ERBPOST2                 BR NO                  @OZ26860 20565000
         BAL   RETURN,DSPDISP           EXIT IF YES            @G36XRAW 20570052
ERBPOST2 EQU   *                                               @G36XRAW 20570110
         LA    RERB,PEERB               RELOAD ERB ADDRESS       Y02027 20580006
         LA    RWORK,AVTDSIOB           GET ADDRESS OF DISK I/O        X20600020
                                        QCB FROM AVT                    20700020
         STCM  RWORK,SEVEN,LCBERBQB     PUT ADDR OF DISK I/O QCB Y02027 20800006
*                                       IN ERB                   Y02027 20900006
         XC    LCBERBCH(3),LCBERBCH     CLEAR BFR CHAIN FIELD           21100020
         MVI   LCBERBST,0                                               21200020
         MVI   LCBERBPY,PRIAPERB        FLAG AS GET/READ ERB            21300020
         LA    RSCB,PEWASCB             GET SCB ADDR             Y02027 21350006
         ST    RSCB,LCBSCBA-1           ADDRESS OF CURRENT SCB          21400020
         LR    RPARM,RERB               SET UP DISPATCHER               21500020
*                                       PARAMETER REGISTERS             21600020
         OI    PEWAFLG,ERBBUSY          TURN ON ERB-BUSY FLAG           21700020
         LA    RTEMP,PERAQCB            READ-AHEAD QCB ADDRESS          21800020
         ST    RTEMP,PERCQCB            RETURN ADDRESS OF ERB           21900020
         BAL   RETURN,DSPPOST           POST ERB TO DISK I/O   @G36XRAW 22000020
         EJECT                                                          22100020
ELEMTEST EQU   *                                                        23300020
*                                                                     * 23320020
*        DETERMINE TYPE OF ELEMENT POSTED TO READ-AHEAD QUEUE         * 23340020
*                                                                     * 23360020
         LR    RGETWORK,RQCB            INIT POINTER TO GET/READ       X23400020
                                        WORKAREA                        23500020
         LA    RSCB,PERAQCB-IEDQPEWA    DISPL OF QCB IN PEWA            23600020
         SR    RGETWORK,RSCB            ADDRESS OF PEWA                 23700020
         LA    RSCB,PEWASCB             ADDRESS OF SCB                  23800020
         LA    RERB,PEERB               ADDRESS OF ERB                  23900020
         CLI   RECBKEY,DUMMY            SPECIAL QWAIT ELEMENT           24400020
         BNE   ELEMTST1                 BRANCH IF NO                    24500081
         TM    PEWAFLG,CFLG             CLOSE REQUESTED                 24502081
         BNO   NOTRET                   BRANCH IF NO                    24504081
         L     RPARM,PEWARCB            SPECIAL ELEMENT FOR             24506081
*                                        IEDQEU                         24508081
         TS    FORTY7(RPARM)            SET POSTED FLAG        @OZ26305 24508600
         BC    4,DSPDISP                GET OUT,RCB ON RDY Q   @OZ26305 24509200
         XC    5(3,RPARM),5(RPARM)      CLEAR LINK FIELD                24510081
         BAL   RETURN,DSPPOST           POST ELEM TO IEDQEU    @G36XRAW 24512081
ELEMTST1 EQU   *                                                        24514081
         CLI   RECBPRI,RETPRI           RETRIEVE TERMINATION?  @ZA03097 24520081
         BE    OUTRZ                    YES, EMPTY QCBACK CHAIN@ZA03097 24540081
*                                       IF MULTIPLE RETRIEVAL  @ZA03097 24560081
         CLI   RECBPRI,PRIAPBFR         IS ELEMENT A FULL BUFFER        24600020
         BNE   ERBTEST                  BRANCH IF NO             Y02027 24700006
*                                                                Y02027 24720006
*              FULL BUFFER ON READ AHEAD QUEUE                   Y02027 24740006
*                                                                Y02027 24760006
         L     RWORK,PEWALCBA           LCB ADDRESS                     24800020
         NI    LCBSTAT1-IEDQLCB(RWORK),LCBRCLLF INDICATE NO RECALL      24900020
         OI    PEWAFLG,POSTAP           SET ECB-TO-BE-POSTED FLAG       25200020
         MVI   PRFSCAN-IEDQPRF(RRCB),AVTEZERO ZERO SCAN POINTER         25320020
         MVC   PRFTQBCK+1-IEDQPRF(SEQLEN,RRCB),SCBOSEQ           A42396 25360021
*                                       SAVE THE SEQUENCE NUMBER A42396 25370021
         MVC   PRFQCBA-IEDQPRF(3,RRCB),SCBFEFO SAVE FEFO PTR    SA52971 25380022
         LR    RTEMP,RQCB               GET ADDRESS OF HEAD OF THE     X25500020
                                        READ-AHEAD QCB ELEM CHAIN       25600020
         SH    RTEMP,AVTHA4             SIMULATE AN RCB                 25700020
LOOPA    EQU   *                                                        25800020
         CLC   5(3,RTEMP),AVTDELAD+1    IS THIS THE LAST ELEMENT        25900020
*                                       IN THE ELEMENT CHAIN            26000020
         BE    HANGIT                   BRANCH IF YES            Y02027 26100006
         L     RTEMP,FOUR(RZERO,RTEMP)  GET ADDRESS OF NEXT ELEMENT    X26200020
                                        IN THE CHAIN                    26300020
         B     LOOPA                    CHECK NEW ELEMENT               26400020
HANGIT   EQU   *                                                        26500020
         STCM  RRCB,SEVEN,FIVE(RTEMP)   HANG BUFFER ON READ AHEADY02027 26600006
*                                       QCB ELEMENT CHAIN        Y02027 26650006
         L     RTEMP,4(0,RTEMP)         ADDR OF NEXT BUFFER             26700020
         LR    RBFR,RTEMP               GET BUFFER ADDR          Y02027 26750006
         MVC   5(3,RTEMP),AVTDELAD+1    ADDR OF DUMMY LAST ELEMENT      26800020
         TM    PRFSTAT1-IEDQPRF(RTEMP),PRFNLSTN  EOM BUFFER             26820020
         BO    NOTNOW                   BRANCH IF NO                    26840020
         OI    PEWAFLG,RAFLG            SET READ-AHEAD FLAG             26860020
         XC    SCBSCHDR(3),SCBSCHDR     ZERO HDR PTR TO MAKE    SA52971 26863022
*                                         HM03 TEST FAIL        SA52971 26866022
         EJECT                                                          26870020
NOTNOW   EQU   *                                                        26880020
         TM    PRFSTAT1-IEDQPRF(RTEMP),PRFNHDRN  HEADER BUFFER          26881020
         BO    NOIDLE                   BRANCH IF NO                    26882020
         L     RPARM,PEWAPROC           PROCESS ENTRY ADDRESS           26882120
         L     RPARM,TRMDESTQ-1-IEDQTRM(0,RPARM) QCB ADDRESS            26882220
         CLC   PRFSCAN-IEDQPRF(2,RTEMP),AVTFZERO RESERVE CHARS LEFT     26883020
         BE    NOIDLE                   BRANCH IF NO                    26884020
*                                                                     * 26884220
*        REPLACE RESERVE CHARACTERS WITH EBCDIC IDLE CHARACTERS FOR   * 26884420
*        SUPPORT OF COMPATIBLE QTAM GET.                              * 26884620
*                                                                     * 26884820
         LH    RWORK,PRFSCAN-IEDQPRF(0,RTEMP) RESERVE CHAR COUNT        26885020
         LA    RPARM,PRFSHDR-IEDQPRF(0,RTEMP) FIRST RESERVE CHAR        26886020
IDLE     EQU   *                                                        26887020
         MVI   AVTEZERO(RPARM),IDLECHAR INSERT IDLE CHARACTER           26888020
         LA    RPARM,1(0,RPARM)         BUMP TO NEXT CHAR               26889020
         BCT   RWORK,IDLE               SUBTRACT AND BRANCH IF          26890020
*                                       ALL IDLES NOT INSERTED          26891020
NOIDLE   EQU   *                                                        26892020
         TM    PEWAFLG,POSTAP           NEED TO POST ECB                26900020
         BNO   RAGO                     BRANCH IF NO TO CHECK    Y02027 27000006
*                                       FOR POSSIBLE READ AHEAD  Y02027 27010006
POST     EQU   *                                                 Y02027 27020006
         NC    PEWAECBA+ONE(3),PEWAECBA+ONE  ECB TO POST         Y02027 27030006
         BZ    POSTPOST                 BRANCH IF NO             Y02027 27040006
         ICM   RRCB,ALL,PEWAWA          GET WORKAREA ADDRESS     Y02027 27050006
         BNZ   RAIB                     BRANCH IF ADDR IS THERE  Y02027 27060006
         LA    RRCB,AVTSAVE3            USE AVT SAVEAREA AS      Y02027 27070006
*                                       FAKE AIB EXTENSION       Y02027 27080006
         B     CONTRET                  CROSS MEMORY POST        Y02027 27090006
RAIB     EQU   *                                                 Y02027 27100006
         LA    RWORK,AIBWAG-IEDQAIB     GET AIB EXTENSION SIZE   Y02027 27110006
         SR    RRCB,RWORK               GET AIB BASE             Y02027 27120006
         TM    PEWAGSW,INCWA            INCOMPLETE WORKAREA      Y02027 27130006
         BZ    GO                       BRANCH IF NO - START AT  Y02027 27140006
*                                       BEGINNING OF WORKAREA    Y02027 27150006
*                                       IF YES, WAITING FOR MSG  Y02027 27160006
*                                       ON RAQCB IN GET          Y02027 27170006
         L     RWORK,PEWANEB            RESTORE ADDR OF NEXT     Y02027 27180006
*                                       EMPTY BYTE IN WORKAREA   Y02027 27190006
         L     RCOUNT,PEWAPEUN          RESTORE NUMBER OF BYTES  Y02027 27200006
*                                       USED                     Y02027 27220006
         NI    PEWAGSW,AVTEFF-INCWA     TURN OFF INCOMPLETE BIT  Y02027 27240006
         B     QCBTEST                  BR                       Y02027 27260006
POSTPOST EQU   *                                                        27300006
         NI    PEWAFLG,POSTOFFF         TURN OFF POST-NEEDED FLAG       27310006
RAGO     EQU   *                                                        27320006
         L     RTEMP,PEWALCBA           DUMMY LCB ADDRESS               27330006
         TM    LCBSTAT1-IEDQLCB(RTEMP),LCBRCLLN RETRIEVE MODE           27340006
         BNO   NOTRET                   BRANCH IF NO                    27350006
         TM    PRFSTAT1,PRFNLSTN        EOM BUFFER               Y02027 27360006
         BO    BLDERBB                  BRANCH IF NO                    27370006
         BAL   RETURN,DSPDISP           EXIT TO DISPATCHER     @G36XRAW 27380006
         EJECT                                                          27400020
*                                                                Y02027 27420006
*              ERB POSTED TO READ AHEAD QCB                      Y02027 27440006
*                                                                Y02027 27460006
CLOSDOWN EQU   *                                                        27500022
         LA    RWORK,AVTBFRTB           ADDR OF BUFFER RETURN QCB       27800020
         SR    RTEMP,RTEMP              CLEAR REGISTER           Y02027 27900006
         ICM   RTEMP,SEVEN,LCBERBCH     ADDRESS OF FIRST FULL BFRY02027 27930006
         BZ    ENDC                     BRANCH IF MSG CANCELLED  Y02027 27960006
RETLOOP  EQU   *                                                 Y02027 28000006
         STCM  RWORK,SEVEN,PRFQCBA-IEDQPRF(RTEMP) PUT BUFFER     Y02027 28100006
*                                       RETURN QCB INTO BUFFER   Y02027 28200006
         MVI   PRFPRI-IEDQPRF(RTEMP),PRIBFRTB  BUFFER-RETURN PRI Y02027 28300006
         MVC   PRFTQBCK-IEDQPRF(1,RTEMP),SCBPRI SET PRIORTY    @OY11980 28320081
*                                        LEVEL QUEUE OFFSET    @OY11980 28340081
         MVC   PRFTQBCK+1-IEDQPRF(2,RTEMP),SCBOSEQ  SAVE       @OY11980 28360081
*                                        SEQUENCE NUMBER       @OY11980 28380081
         CLC   PRFLINK-IEDQPRF(2,RTEMP),AVTFZERO LAST BUFFER     Y02027 28400006
         BZ    ENDC                     BRANCH IF YES            Y02027 28500006
         L     RTEMP,PRFLINK-ONE-IEDQPRF(RTEMP) ADDR OF NEXT BFR Y02027 28600006
         B     RETLOOP                  GET NEXT BUFFER                 28700020
ENDC     EQU   *                                                        28800020
         L     RPARM,PEWARCB            ADDR OF SPECIAL ELEMENT@OZ07798 28900081
*                                       FOR OPEN/CLOSE SUBTASK          29000020
         ICM   RWORK,SEVEN,LCBERBCH     GET FIRST BUFFER       @OY14498 29003081
         BZ    ENDC1                    BRANCH IF ZERO ADDRESS @OY14498 29004081
         TM    PRFSTAT1-IEDQPRF(RWORK),PRFNHDRN  HEADER BUFFER @OY11980 29006081
         BNO   ENDC1                    BRANCH IF YES          @OY11980 29009081
         CLC   PERAQCB+1(3),AVTDELAD+1  READY QUEUE EMPTY      @OY11980 29012081
         BNE   ENDC1                    BRANCH IF NO           @OY11980 29015081
         MVC   PERAQCB+1(3),LCBERBCH    PUT THE TEXT BUFFER ON @OY11980 29018081
*                                        BUFFER READ AHEAD OR  @OY11980 29021081
*                                        READ AHEAD QUEUE SO   @OY11980 29024081
*                                        IEDQEU RECONSTRUCTS   @OY11980 29027081
*                                        THE FEFO CHAIN        @OY11980 29030081
         L     RWORK,PERAQCB            ADDRESS OF BUFFER      @OY14498 29030381
ZEROLINK EQU   *                                               @OY14498 29030681
         NC    FIVE(THREE,RWORK),FIVE(RWORK)  LINK FIELD ZERO  @OY14498 29030981
         BZ    PUTDELAD                 YES, BRANCH            @OY14498 29031281
         L     RWORK,FOUR(,RWORK)       ADDRESS NEXT BUFFER    @OY14498 29031581
         B     ZEROLINK                 LOOK AT THIS BUFFER    @OY14498 29031881
PUTDELAD EQU   *                                               @OY14498 29032181
         MVC   FIVE(THREE,RWORK),AVTDELAD+1  GET DELEM ADDRESS @OY14498 29032481
         XC    FIVE(3,RPARM),FIVE(RPARM)  CLEAR LINK FIELD OF  @OY11980 29033081
*                                        SPECIAL ELEMENT       @OY11980 29036081
         B     ENDC2                                           @OY11980 29039081
ENDC1    EQU   *                        DO NOT ADD BUFFERS     @OY11980 29042081
*                                        TO CHAIN              @OY11980 29045081
          MVC   FIVE(3,RPARM),LCBERBCH   ADD BUFFERS TO CHAIN  @ZA01105 29050061
POSTEU   EQU   *                                               SA67159  29100006
ENDC2    EQU   *                                               @OY11980 29500081
         TS    FORTY7(RPARM)            SET RCB POSTED FLAG    @OZ26305 30000000
         BC    8,ENDC3                  BR,IF RCB REQUIRES POST@OZ26305 30010000
         ICM   RPARM,SEVEN,FIVE(RPARM)  ELSE, GET NEXT ELEMENT @OZ26305 30020000
         BNZ   ENDC3                      AND POST             @OZ26305 30030000
         B     DSPDISP                  NO POST REQUIRED       @OZ26305 30040000
ENDC3    EQU   *                                               @OZ26305 30050000
         BAL   RETURN,DSPCHAIN          POST ELEMENT           @OZ26305 30060000
ERBTEST  EQU   *                                                        30100006
         NI    PEWAFLG,ERBFREE          TURN OFF ERB-BUSY FLAG          30107006
         L     RWORK,PEWALCBA           LCB ADDRESS                     30114006
         TM    PEWAFLG,CFLG             CLOSEDOWN IN PROGRESS           30121006
         BNO   NOTCLOSE                 BR,NO                  @OZ28213 30128086
         TM    LCBSTAT1-IEDQLCB(RWORK),LCBRCLLN   RETRIEVE?    @OZ28213 30129086
         BO    OUTRX                    BR, YES                @OZ28213 30130086
         B     CLOSDOWN                 BR, NO                 @OZ28213 30131086
NOTCLOSE EQU   *                                               @OZ28213 30132086
         TM    LCBSTAT1-IEDQLCB(RWORK),LCBRCLLN  RETRIEVE MODE          30135006
         BO    RECALL                   BRANCH IF YES                   30142006
         NC    LCBERBCH(3),LCBERBCH     CANCELLED MESSAGE               30149006
         BNZ   MHQ                      BRANCH IF NO             Y02027 30156006
         TM    PEWAFLG,RFLG             WAITING TO DO RETRIEVAL  Y02027 30163006
         BO    RETERB                   BRANCH IF YES            Y02027 30170006
         B     ERBFIX                   CONTINUE TO READ AHEAD   Y02027 30177006
         EJECT                                                          30184006
MHQ      EQU   *                                                        30200020
*                                                                     * 30220020
*        MOVE BUFFERS TO PRE-MH QUEUE FROM ELEMENT REQUEST BLOCK      * 30240020
*                                                                     * 30260020
         SR    RTEMP,RTEMP              CLEAR TO ZERO                   30300020
         LR    RERB,RPARM               ERB ADDRESS                     30400020
MHLOOP   EQU   *                                                        30500020
         L     RWORK,LCBERBCH-1         ADDR OF A FULL BUFFER           30600020
         MVC   LCBERBCH(3),RECBLINK-IEDQRECB(RWORK) CLOSE THE CHAIN     30700020
         LR    RPARM,RWORK              BUFFER ADDRESS                  30800020
         MVI   4(RPARM),PRIAPBFR        SET BUFFER PRIORITY             30900020
         MVC   PRFTQBCK-IEDQPRF(1,RPARM),SCBPRI SAVE QCB PRTY    A49227 30950022
         TM    PRFSTAT1-IEDQPRF(RPARM),PRFNHDRN HEADER BUFFER   SA65388 30952052
         BO    MHLOOP1                  BRANCH IF NO            SA65388 30954052
         MVI   PEPCBAD,AVTEZERO         CLEAR QRESET FLAG       SA65388 30956052
         NC    SCBOSEQ,SCBOSEQ          QRESET MESSAGE          SA65388 30958052
         BZ    MHLOOP1                  BRANCH IF NO            SA65388 30960052
         MVI   PEPCBAD,AVTEFF           SET QRESET FLAG         SA65388 30962052
MHLOOP1  EQU   *                                                SA65388 30964052
         CLI   PEPCBAD,AVTEFF           QRESET BUFFER           SA65388 30966052
         BNE   MHLOOP2                  BRANCH IF NO            SA65388 30968052
PRFRESET EQU   X'20'                    QRESET BUFFER FLAG      SA65388 30970052
         OI    PRFTIC-IEDQPRF(RPARM),PRFRESET SET QRESET BUFFER SA65388 30972052
MHLOOP2  EQU   *                                                SA65388 30974052
         TM    PRFSTAT1-IEDQPRF(RPARM),PRFNLSTN EOM BUFFER      SA65388 30976052
         BO    MHLOOP3                  BRANCH IF NO            SA65388 30978052
         MVI   PEPCBAD,AVTEZERO         CLEAR QRESET FLAG       SA65388 30980052
MHLOOP3  EQU   *                                                SA65388 30982052
         LA    RQCB,PEWACBUF            MH READ AHEAD CHAIN      Y02027 31000006
         BAL   RETURN,DSPPRIOR          PUT BUFFER ON CHAIN             31100020
         LA    RTEMP,1(0,RTEMP)                                         31200020
         CLC   LCBERBCH(2),AVTFZERO     IS CHAIN EMPTY                  31300020
         BNE   MHLOOP                   NO, CONTINUE             S21101 31400020
*                                                                     * 31550020
*        POST FULL BUFFERS TO MESSAGE HANDLER                         * 31600020
*                                                                     * 31650020
         SR    RZERO,RZERO              CLEAR REG TO ZERO               32000020
         IC    RZERO,PEWABFCT           CURRENT COUNT            Y02027 32100006
         SR    RZERO,RTEMP              NEW COUNT                       32200020
         STC   RZERO,PEWABFCT           CURRENT BUFFER COUNT     Y02027 32300006
         TM    PEWAFLG,RFLG             WAITING TO DO RETRIEVAL@ZA03050 32330081
         BO    RETERB                   BRANCH IF YES          @ZA03050 32360081
         TM    PEWAFLG,MHOK             MAY BFRS GO TO MH NOW           32400020
         BO    MHPOST                   BRANCH IF YES                   32500020
         TM    PRFSTAT1-IEDQPRF(RWORK),PRFNLSTN END OF MSG              32600020
         BO    BLDERB                   BRANCH IF NO                    32700020
         BAL   RETURN,DSPDISP           EXIT TO DISPATCHER     @G36XRAW 32800020
         SPACE 1                                                        32850020
MHPOSTX EQU    *                                                 S21101 32860020
         CLC   PEWACBUF+ONE(3),AVTDELAD+ONE  CHAIN EMPTY         Y02027 32870006
         BE    BLDERB                   BRANCH IF YES           SA51083 32880022
MHPOST   EQU   *                                                        32900020
         CLC   PEWACBUF+ONE(3),AVTDELAD+ONE  CHAIN EMPTY         Y02027 33000006
         BE    ERBFIX                   BRANCH IF YES                   33100020
         L     RPARM,PEWACBUF           FULL BUFFER ADDRESS      Y02027 33200006
         L     RWORK,PEPCBAD            PCB ADDRESS                     33300020
         MVC   1(3,RPARM),PCBMH         PREPARE TO POST TO MH           33400020
         MVC   PRFLCB-IEDQPRF(3,RPARM),PEWALCBA+1 DUMMY LCB ADDR        33500020
         L     RETURN,PEWALCBA          LCB ADDRESS                     33600020
         OI    LCBSTAT1-IEDQLCB(RETURN),LCBSENDN                 S21101 33700020
         MVC   PEWACBUF+ONE(3),PRFLINK-IEDQPRF(RPARM) CLOSE      Y02027 33800006
*                                       ELEMENT CHAIN            Y02027 33850006
         LA    RSCB,PEWASCB                                      Y02027 33900006
         ST    RSCB,LCBSCBA-1-IEDQLCB(0,RETURN) SCB ADDR         Y02027 34000006
         L     RTEMP,PEWAPROC           PROCESS ENTRY ADDRESS   SA56624 34030022
         MVC   SCBDESTQ(3),TRMDESTQ-IEDQTRM(RTEMP)   SET QCB AD SA56624 34060022
         BAL   RETURN,DSPPOSTR          POST BUFFER TO MH               34100020
         EJECT                                                          34101020
        TM    PRFSTAT1-IEDQPRF(RRCB),PRFNHDRN  HEADER BUFFER            34102020
         BO    NOPE                     BRANCH IF NO                    34104020
         LA    RWORK,AVTINOUT                                           34104620
         ST    RWORK,PEWASCB+4                                          34105220
         L     RWORK,PEWALCBA           DUMMY LCB ADDRESS               34106020
         MVC   LCBTTCIN-IEDQLCB(2,RWORK),PRFDEST-IEDQPRF(RRCB) SET      34108020
*                                       PROCESS ENTRY TNT OFFSET        34110020
NOPE     EQU   *                                                        34112020
         TM    PRFSTAT1-IEDQPRF(RRCB),PRFLOCK LOCK INQUIRY              34114020
         BNO   NOLOCK                   BRANCH IF NO                    34116020
         NI    PRFSTAT1-IEDQPRF(RRCB),AVTEFF-PRFLOCK                    34116620
*                                       SET NEITHER LOCK NOR SETEOF     34117220
         LR    RWORK,RRCB               SAVE BUFFER ADDRESS             34118020
         SR    RPARM,RPARM              CLEAR REGISTER TO ZERO          34120020
         LH    RPARM,PRFSRCE-IEDQPRF(0,RWORK)  SOURCE OFFSET            34122020
         N     RPARM,AVTCLRHI           CLEAR HIGH-ORDER HALF           34124020
        L     RENTRY,AVTRNMPT          CONVERSION LOGIC ADDRESS         34126020
         BALR  RETURN,RENTRY            CONVERT OFFSET TO ADDRESS       34128020
         LR    RENTRY,RPARM             SAVE TERM ENTRY ADDRESS  S22024 34129022
         L     RPARM,TRMDESTQ-1-IEDQTRM(0,RPARM)  QCB ADDRESS           34130020
         L     RPARM,QCBDCBAD-1-IEDQQCB(0,RPARM)  DCB ADDRESS           34132020
         TM    DCBOFLGS-IHADCB(RPARM),DCBOPEN  IS DCB OPENED            34134020
         BNO   NOTLOCK                  BRANCH IF NO                    34136020
         TM    TRMSTATE-IEDQTRM(RENTRY),TRMPREF    3705 TERM   @G36XRAW 34136100
         BNO   NOT3705                  BR NO                  @G36XRAW 34136200
         L     RPARM,TRMDESTQ-1-IEDQTRM(RENTRY) GET QCB ADDR     S22024 34137100
         SH    RPARM,QCBHDRSZ           DECREMENT TO PLCB ADDR @ZM47936 34137200
         USING IEDNQCB,RPARM            SET BASE                 S22024 34139200
         ICM   RPARM,15,QCBPLCBA-1      GET PLCB ADDRESS         S22024 34139300
         BNM   NOTLOCK                  BRANCH POSITIVE - NO     S22024 34139400
*                                       PLCB ASSIGNED            S22024 34139500
         LA    RETURN,NUMEXT            SET DEB EXTENTS TO ONE   S22024 34139600
         B     LCBLOOP                  AND CHECK FOR LCB        S22024 34139700
NOT3705  EQU   *                                                 S22024 34139800
         L     RENTRY,DCBDEBAD-IHADCB(0,RPARM)  DEB ADDRESS             34139900
         SR    RETURN,RETURN            CLEAR COUNTER TO ZERO           34140020
         IC    RETURN,OFF(0,RENTRY)     NUMBER OF LCB'S IN LINE GROUP   34142020
         SR    RZERO,RZERO              CLEAR COUNTER TO ZERO           34144020
         LA    RZERO,LCBFLAG1-IEDQLCB                                   34146020
         SR    RENTRY,RENTRY            CLEAR REGISTER TO ZERO          34148020
         IC    RENTRY,DCBEIOBX-IHADCB(0,RPARM)  LCB LENGTH              34150020
         L     RPARM,DCBIOBAD-IHADCB(0,RPARM)   IOB ADDRESS             34152020
         SR    RPARM,RZERO              DUMMY LCB ADDRESS               34154020
         AR    RPARM,RENTRY             ADDR OF FIRST REAL LCB          34156020
LCBLOOP  EQU   *                                                        34158020
         CLC   LCBTTCIN-IEDQLCB(2,RPARM),PRFSRCE-IEDQPRF(RWORK)         34160020
*                                       RIGHT LCB FOR SOURCE            34162020
         BE    SETLOCK                  BRANCH IF YES                   34164020
NEXTLCB  EQU   *                                                SA54271 34165022
         AR    RPARM,RENTRY             ADDR OF NEXT REAL LCB           34166020
         BCT   RETURN,LCBLOOP           CHECK NEXT LCB                  34168020
         B     NOTLOCK                  BRANCH WHEN ALL CHECKED  S21903 34170022
         EJECT                                                          34171020
SETLOCK  EQU   *                                                        34172020
         L     RTEMP,LCBSCBA-1-IEDQLCB(,RPARM) SCB ADDRESS      SA54271 34172522
         TM    SCBSTATE-IEDQSCB(RTEMP),SCBLCK1N SOURCE LOCKED   SA54271 34172822
         BNO   NEXTLCB                  BRANCH IF NO            SA54271 34173122
         TM    LCBINSRC+2-IEDQLCB(RPARM),LOCKI  LOCK INQUIRY            34173620
         BNO   NOTLOCK                  BRANCH IF NO                    34173720
         NI    LCBINSRC+2-IEDQLCB(RPARM),AVTEFF-LOCKI SET NOT INQ       34173820
         OI    LCBINSRC+2-IEDQLCB(RPARM),LOCKR  SET RESPONSE DUE        34174020
         L     RPARM,PEPCBAD            PCB ADDRESS                     34175120
         L     RPARM,PCBLCBAD-IEDQPCB(0,RPARM) LCB ADDRESS              34175220
         LH    RENTRY,LCBINCAM-IEDQLCB(0,RPARM) LOCK RESPONSE CNT       34175320
         LA    RENTRY,1(0,RENTRY)       BUMP COUNT BY ONE               34175420
         STH   RENTRY,LCBINCAM-IEDQLCB(0,RPARM) SET NEW RESPONSE CNT    34175520
NOTLOCK  EQU   *                                                        34176020
         LR    RPARM,RWORK              RESTORE BUFFER ADDRESS          34178020
NOLOCK   EQU   *                                                        34180020
         TM    PRFSTAT1-IEDQPRF(RPARM),PRFNLSTN EOM BUFFER              34200020
         BO    MHPOSTX                  BRANCH IF NO                    34300020
         NI    PEWAFLG,AVTEFF-MHOK      BUFFER MAY NOT BE POSTED Y02027 34400006
*                                       TO MH                    Y02027 34450006
         BAL   RETURN,DSPDISP           EXIT TO DISPATCHER     @G36XRAW 34500020
         EJECT                                                          35200020
RETRVE   EQU   *                                                 Y02027 35300006
*                                                                Y02027 36100006
*              REMOVE STCB FROM DEST QCB SO GET SCHEDULER WILL   Y02027 36900006
*              NOT PUT MESSAGES ON QUEUE                         Y02027 37800006
         L     RQCB,PEWAPROC            ADDR OF TERM ENTRY       Y02027 38700006
         L     RQCB,TRMDESTQ-ONE-IEDQTRM(RQCB) ADDR OF DEST Q.   Y02027 39600006
         LA    RSTCB,QCBSTVTO-IEDQQCB(RQCB)  GET ADDR OF STCB    Y02027 40500006
         CLM   RSTCB,SEVEN,PEWAQCBS+ONE STCB IN DEST QUEUE       Y02027 41400006
         BE    RETERB                   BRANCH IF STCB IN        Y02027 43300006
*                                       CORRECT QUEUE            Y02027 43400006
         LA    RSTCB,PERAQCB            GET RAQCB ADDRESS        Y02027 44900006
         BAL   RETURN,DSPUNAVR          MOVE STCB TO RAQCB       Y02027 44950006
*                                                                Y02027 45700006
RETERB   EQU   *                                                 Y02027 47320006
*                                                                Y02027 47330006
*        THIS SUBROUTINE RETRIEVES MESSAGES BY DESINATION/OUTPUT SEQ  * 47340020
*        NUMBER OR BY SOURCE/INPUT SEQ NUMBER BY USING RECALL FUNCTION* 47360020
*                                                                     * 47380020
         LA    RSCB,PEWASCB             SCB ADDRESS                     47400020
         LA    RERB,PEERB               ERB ADDRESS                     47500020
         TM    PEWAFLG,ERBBUSY+PEWASTOP ERB NOT POSTABLE        SA63961 47600052
         BZ    RSETUP                   BRANCH IF NO            SA63961 47700052
         OI    PEWAFLG,RFLG             RETRIEVE MODE FLAG              47800020
         BAL   RETURN,DSPDISP           WAIT FOR THE ERB       @G36XRAW 47900020
         SPACE 2                                                        48000020
RSETUP   EQU   *                                                        48100020
         CLI   PEWARTVE+TWO,BLANK       RETRIEVE TERMINATION     Y02027 48200006
         BE    OUTRZ                    BRANCH IF YES                   48300020
*   SAVE SCB INFORMATION IN PROCESS ENTRY WORKAREA                      48400020
         NI    PEWAFLG,AVTEFF-FIRSTR    INITIALIZE TO 1ST TIME   99226  48500022
         MVC   PEWAQCBL+ONE(3),PERAQCB+ONE SAVE ANY FULL BUFFERS Y02027 48550006
         MVI   PEWASAVE,AVTECD12        SET FOR POSSIBLE ERROR   Y02027 48600006
*                                       ZEROED WHEN CORRECT MSG  Y02027 48650006
*                                       FOUND                    Y02027 48700006
         MVC   PEWASAVE+ONE(3),SCBSCSEG SAVE ADDR OF CURRENT SEG Y02027 48750006
         MVC   PEWASAVE+FOUR(4),SCBUNTCT SAVE CNT & HDR ADDR     Y02027 48800006
         MVC   PEWASAVE+EIGHT(4),SCBSTATE SAVE DEST QCB ADDR     Y02027 48850006
         MVC   PEWASAVE+TWENTY4(7),SCBSCHDR SAVE CHDR + FFEFO  @OX16398 48860000
         MVC   PEWASAVE+THIRTY1(3),SCBDCHDR SAVE CURRENT HEADER@OZ27022 48870000
         XC    PEWASAVE+TWELVE(3),PEWASAVE+TWELVE CLEAR BYTES    Y02027 48900006
         MVC   PEWASAVE+TWENTY2(2),SCBOSEQ   SAVE SEQUENCE NO.   Y02027 48950006
         L     RTEMP,PEWALCBA           GET LCB ADDR           @OZ15631 48960081
         MVC   PEWASAVE+THIRTY4(1),LCBERBST-IEDQLCB(RTEMP)     @OX16398 48970000
*                                       SAVE ERB STATE         @OZ15631 48980081
         L     RTEMP,PEWARTVE+FOUR      TERMINAL ENTRY ADDRESS   Y02027 49000006
         L     RWORK,TRMDESTQ-1-IEDQTRM(0,RTEMP) DEST QCB ADDR          49100020
         NC    QCBQBACK-IEDQQCB(3,RWORK),QCBQBACK-IEDQQCB(RWORK)        49200020
         BZ    RCLEAN2                  EXIT WITH RC=X'0C'     @ZA03050 49300081
         ST    RWORK,SCBSTATE           ADDR OF RETRIEVAL QCB           49700020
*********************************************************************** 49704022
*        AT THIS POINT WE HAVE TO CHECK FOR MULTIPLE RETRIEVAL   99226  49708022
*        IF IT IS A MULTIPLE RETRIEVAL SITUATION PEWASAVE+16 WILLY02027 49712006
*        CONTAIN THE STARTING QBACK CHAIN TO USE FOR THIS        99226  49716022
*        RETRIEVAL..... SO HERE WE GO                            99226  49720022
*********************************************************************** 49724022
         TM    PEWARTVE+THREE,MULTSEQ   SEE IF MULTIPLE          Y02027 49728006
*                                      RETRIEVAL IS IN PROGRESS  99226  49732022
         BNO   NOTAMULT                BRANCH IF NOT MLTPL RET   99226  49736022
         TM    PEWARTVE+THREE,MRM       FIRST TIME               Y02027 49740006
         BO    NOTOMULT                IF 1ST TIME MULTI         99226  49744022
         NC    PEWASAVE+SIXTEEN(3),PEWASAVE+SIXTEEN QBACK SAVED  Y02027 49748006
         BZ    RCLEAN2                  BRANCH IF NO,RC=X'0C'  @ZA03050 49752081
         MVC   SCBDEOB+ONE(3),PEWASAVE+SIXTEEN USE SAVED ONE     Y02027 49760006
*                                      OF THE  ORIGINAL QBACK    99226  49768022
         B     MULTXNOW                CONTINUE MULTIPLE PROCESS 99226  49772022
NOTOMULT EQU   *                                                 99226  49780022
         NI    PEWARTVE+THREE,AVTEFF-MRM TURN OFF 1ST TIME SW    Y02027 49784006
         XC    PEWASAVE+SIXTEEN(3),PEWASAVE+SIXTEEN CLEAR        Y02027 49786006
*                                       BACKCHAIN PTR            Y02027 49788006
NOTAMULT EQU   *                                                 99226  49792022
         MVC   SCBDEOB+1(3),QCBQBACK-IEDQQCB(RWORK) QBACK POINTER       49800020
MULTXNOW EQU   *                                                 99226  50000022
         MVI   SCBDEOB,0                                                50200020
         L     RTEMP,PEWALCBA           LCB ADDRESS                     50300020
         MVI   LCBSTAT1-IEDQLCB(RTEMP),LCBRCLLN+LCBRECVN RECALL  S21101 50400021
         MVC   PERAQCB+1(3),AVTDELAD+1                                  50700020
         XC    LCBTTCIN(2),LCBTTCIN     CLEAR FOR RETRIEVE              50800020
         B     BLDERBA                  GO PREPARE FOR RECALL    S21903 50900022
         EJECT                                                          51100020
RECALL   EQU   *                                                        51200020
*                                                                       51300020
*    PROCESS RECALLED BUFFER POINTED TO BY ERB                          51400020
*                                                                       51500020
         NC    LCBERBCH(3),LCBERBCH     BFR NO LONGER ON QUEUE          51700020
         BZ    SETERR3                  BRANCH IF YES                   51800020
         L     RBFR,LCBERBCH-1          ADDRESS OF RECALLED      Y02027 51900006
*                                       BUFFER                   Y02027 51950006
         NI    PRFSTAT1,PRFEOFF         CLEAR LOCK/EOF BIT     @SA64355 51980061
         LA    RTEMP,AVTBFRTB           BUFFER RETURN QCB ADDR          52000020
         STCM  RTEMP,SEVEN,PRFQCBA      PUT QCB PTR IN BUFFER    Y02027 52100006
         MVI   PRFPRI,PRIBFRTB                                          52300020
         MVI   PRFSCAN,AVTEZERO         CLEAR IDLE COUNT                52350020
         MVI   LCBERBCT,1               SET BFR RECALL COUNT            52400020
         CLI   PEWASAVE,ZERO            SUBSEQUENT READ OF MSG   Y02027 52500006
         BNE   NOTSUB                   BRANCH IF NO                    52600020
         LR    RPARM,RBFR               DISP PARM                Y02027 52700006
         LA    RQCB,PERAQCB             ELEMENT CHAIN ADDRESS           52800020
         BAL   RETURN,DSPPRIOR          HANG BUFFER ON READ-AHEAD Q     52900020
         CLI   PEWARTVE+TWO,BLANK       RETRIEVE TERMINATION     Y02027 53000006
         BE    OUTRZ                    BRANCH IF YES                   53100020
         B     SAVBFRX                  BRANCH IF NO             S21903 53200022
NOTSUB   EQU   *                                                        53300020
         CLI   PEWARTVE+TWO,BLANK       RETRIEVE TERMINATION     Y02027 53400006
         BE    OUTR                     BRANCH IF YES                   53500020
         CLI   PEWARTVE+TWO,AIBIN       SCAN BY INPUT SEQ. NO.   Y02027 53600006
         BE    INPUT                    BRANCH IF YES                   53700020
         TM    PRFSTAT1,PRFNHDRN        HEADER BUFFER                   53800020
         BNO   HDR                      BRANCH IF YES                   53900020
SETDEOB  EQU   *                                                 S21101 53950020
         NC    PRFTQBCK(3),PRFTQBCK     END OF QBACK CHAIN       S21101 53960021
         BZ    SETERR                   BRANCH IF YES            S21101 53970021
         MVC   SCBDEOB+1(3),PRFTQBCK    SET UP TO RECALL HDR            54000020
*   RETURN UNWANTED BUFFER TO BUFFER RETURN QUEUE                       54100020
*                                                                       54200020
         SPACE 2                                                        54300020
EMPTYRTN EQU   *                                                        54400020
         LR    RPARM,RBFR               BUFFER ADDR FOR DISPATCHRY02027 54410006
         BAL   RETURN,DSPPOSTR          POST BUFFER AND RETURN   S21101 54420020
BLDERBA  EQU   *                                                 S21101 54430020
         MVC   SCBSCHDR(3),SCBDEOB+1                                    54450020
         XC    SCBXTRA(3),SCBXTRA                                       54500020
         XC    SCBNTXT(3),SCBNTXT                                       54600020
         NI    SCBQTYPE,X'0F'                                           54700020
         MVI   SCBDEOB,AVTEZERO         CLEAR DEOB               S99226 54800022
         MVI   LCBERBCT,1               BUFFER RECALL COUNT             54900020
         B     BLDERBB                  DO ANOTHER RECALL               55200020
         EJECT                                                          55300020
HDR      EQU   *                                                        55400020
         CLC   PEWARTVE(2),PRFDEST      CORRECT DESTINATION      Y02027 55500006
         BNE   GETITX                   BRANCH IF NO                    55600020
         TM    PEWARTVE+THREE,MULTSEQ   MULTIPLE RETRIEVAL       Y02027 55603006
         BNO   DESNOT                  BRANCH NO                 99226  55606022
*********************************************************************** 55609022
*        IF YES WE WISH TO RETRIEVE ONE AND SAVE QBACK CORRECTLY 99226  55612022
*********************************************************************** 55615022
         MVC   PEWASAVE+SIXTEEN(3),PRFHQBCK  SAVE BACK CHAIN PTR Y02027 55618006
         MVC   PEWASAVE+TWENTY(2),PEWARTVE+THREE  MOVE SEQ. NO.  Y02027 55619006
*                                       TO SAVEAREA              Y02027 55621006
         NI    PEWASAVE+TWENTY,AVTEFF-MULTSEQ-MRM RESET FLAGS    Y02027 55624006
         CLC   PEWASAVE+TWENTY(2),SCBOSEQ IS THIS MESSAGE WANTED Y02027 55625006
         BNL   SAVBFR1                  YES, SAVE SEQ NUMBER     Y02027 55627006
         NC    PEWASAVE+SIXTEEN(3),PEWASAVE+SIXTEEN END OF CHAIN Y02027 55630006
         BZ    SETERR                   BRANCH IF YES            Y02027 55631006
         MVC   SCBDEOB+ONE(3),PEWASAVE+SIXTEEN MOVE QBACK FOR    Y02027 55633006
*                                       SEARCH                   Y02027 55636006
         B     EMPTYRTN                RETURN BUFFER POST ERB    99226  55642022
SAVBFR1  EQU   *                       FOUND MESSAGE ROUTINE     99226  55645022
         NC    SCBOSEQ(2),SCBOSEQ       MESSAGE SENT YET        SA60004 55664004
         BZ    GETIT                    NO, CONTINUE SCAN       SA60004 55665004
         B     SAVBFR                  NOW RETRIEVE THE MESSAGE  99226  55672022
DESNOT   EQU   *                       SINGLE RETRIEVAL ROUTINE  99226  55675022
         CLC   PEWARTVE+THREE(2),SCBOSEQ COMPARE SEARCH ARGUMENT Y02027 55700006
*                                       WITH OUTPUT SEQ NO.             55800020
         BE    SAVBFR                   BEGIN MSG RETVL IF FOUND        56000020
*    ASSUME THAT WE MUST CONTINUE THE SEARCH                            56100020
GETIT    EQU   *                                                        56200020
         NC    PRFHQBCK(3),PRFHQBCK     END OF BACK CHAIN               56300020
         BZ    SETERR                   BRANCH IF YES                   56400020
         MVC   SCBDEOB+1(3),PRFHQBCK    SET UP TO SEARCH                56600020
         B     EMPTYRTN                 RETURN BFR & POST ERB           56700020
         SPACE 1                                                        56750020
GETMOREX EQU   *                                                 S21101 56760020
         TM    PRFSTAT1,PRFNHDRN        HEADER BUFFER            S21101 56770020
         BO    GETITZ                   BRANCH IF NO             S21101 56780020
GETITX   EQU   *                                                        56800020
         LH    RPARM,PRFDEST            DESTINATION OFFSET              56900020
         N     RPARM,AVTCLRHI           CLEAR HIGH-ORDER HALFWORD       57100020
         L     RENTRY,AVTRNMPT          TNT CONVERSION ROUTINE          57200020
         BALR  RETURN,RENTRY            GET TERM ENTRY ADDRESS          57300020
         CLC   TRMDESTQ-IEDQTRM(3,RPARM),SCBDESTQ SAME QUEUE            57400020
         BE    GETIT                    BRANCH IF YES                   57500020
GETITZ   EQU   *                                                        57600020
         NC    PRFTQBCK,PRFTQBCK        END OF QBACK CHAIN              57700020
         BNZ   SETDEOB                  NO, CONTINUE THE SEARCH  S21101 57800020
SETERR   EQU   *                                                        58400020
         NI    PEWAOPTC,AVTEFF-RTVFLG   TURN OFF RETRIEVE MODE   Y02027 58450006
         MVI   PEWASAVE,AVTECD12        SET ERROR INDICATOR      Y02027 58500006
OUTR     EQU   *                                                        58600020
         XC    PEWASAVE+SIXTEEN(3),PEWASAVE+SIXTEEN CLEAR MULTRETY02027 58630006
*                                      QBACK CHAIN JUST IN CASE  99226  58660022
         LA    RTEMP,AVTBFRTB           BUFFER RETURN QCB               58700020
         ST    RTEMP,PRFQCBA-1          PREPARE TO RETURN BUFFER        58800020
         LR    RPARM,RBFR               DISPATCHER PARAMETER     Y02027 59000006
         BAL   RETURN,DSPPOSTR          POST BUFFER                     59100020
SETLCBAD EQU   *                                               @XA05282 59200061
         L     RTEMP,PEWALCBA           LCB ADDRESS            @XA05282 59230061
         B     RCLEAN2                  START CLEANUP          @XA05282 59260061
         EJECT                                                          59300020
INPUT    EQU   *                                                        59400020
*    SCAN FOR 'LAST TEXT' SEGMENTS                                      59500020
*   WHEN ONE IS FOUND, RECALL RELATED HEADER TO CHECK INPUT SEQNO       59600020
         TM    SCBSTAT1,PRFNLSTN        EOM BUFFER RECALLED             59700020
         BO    NOTLAST                  BRANCH IF NO             Y02027 59800006
LASTSEG  EQU   *                                                        61200020
         CLC   PEWARTVE(2),PRFSRCE      CORRECT SOURCE           Y02027 61400006
         BNE   GETMOREX                 BRANCH IF NO                    61500020
         TM    PRFSTAT1,PRFNHDRN        HEADER BUFFER                   61600020
         BNO   ISEQ                     BRANCH IF YES                   61700020
         OI    PEWAFLG,FIRSTR           SET FIRST-TIME SWITCH           61750020
         MVC   PEWASAVE+TWELVE(3),PRFTQBCK   SAVE TEXT QBACK     Y02027 61800006
         MVC   SCBDEOB+1(3),PRFCHDR     SET UP TO RECALL HEADER         61900020
         B     EMPTYRTN                 RETURN BFR AND POST ERB  S21903 62000022
NOTLAST  EQU   *                                                 Y02027 62020006
         TM    PEWAFLG,FIRSTR           FIRST TIME THROUGH       Y02027 62040006
         BNO   GETIT                    BRANCH IF YES            Y02027 62060006
ISEQ     EQU   *                                                        62100020
         TM    PEWARTVE+THREE,MULTSEQ   MULTI-RETRIEVAL MODE     Y02027 62102006
         BNO   NOMULTIN                 BRANCH IF NO             Y02027 62106006
         MVC   PEWASAVE+TWENTY(2),PEWARTVE+THREE  MOVE SEQ. NO.  Y02027 62110006
*                                       TO WORKAREA              Y02027 62114006
         NI    PEWASAVE+TWENTY,AVTEFF-MULTSEQ-MRM CLEAR MULTI    Y02027 62118006
*                                       RETRIEVE FLAGS           Y02027 62122006
         CLC   PEWASAVE+TWENTY(2),PRFISEQ IS THIS MESSAGE WANTED Y02027 62126006
         BL    NOTSEQ                   BRANCH IF YES            Y02027 62130006
COMPBACK EQU   *                                                 99226  62136022
         TM    PEWAFLG,FIRSTR          FIRST TIME HEADER         99226  62138022
         BNO   OURGETX                 GO SAVE THE CORRECT QBACK 99226  62140022
         MVC   PEWASAVE+SIXTEEN(3),PEWASAVE+TWELVE PUT QBACK     Y02027 62142006
         NI    PEWAFLG,AVTEFF-FIRSTR   CLEAR FIRST TIME HEADER   99226  62144022
         B     SAVBFR                  GO AND RETREIVE THE MSG   99226  62146022
OURGETX  EQU   *                                                 99226  62148022
         LH    RPARM,PRFDEST           GET THE DESTINATION OFFST 99226  62150022
         N     RPARM,AVTCLRHI          CLEAR THE HIGH ORDER HALF 99226  62152022
         L     RENTRY,AVTRNMPT         GET TNT CONVERSION ROUTINE99226  62154022
         BALR  RETURN,RENTRY           GET THE TERMINAL ADDRESS  99226  62156022
         CLC   TRMDESTQ-IEDQTRM(3,RPARM),SCBDESTQ  SAME QUEUE    99226  62158022
         BE    OURHQ                   YES SAVE THE CORRECT QBACK99226  62160022
         MVC   PEWASAVE+SIXTEEN(3),PRFTQBCK SAVE PROPER QBACK    Y02027 62162006
         B     SAVBFR                  NOW GO AND GET THE MSG    99226  62164022
OURHQ    EQU   *                                                 99226  62166022
         MVC   PEWASAVE+SIXTEEN(3),PRFHQBCK  SAVE QBACK          Y02027 62168006
         B     SAVBFR                  GO AND GET THE MESSAGE    99226  62170022
NOMULTIN EQU   *                                                 99226  62172022
         CLC   PEWARTVE+THREE(2),PRFISEQ COMPARE SEARCH ARGUMENT Y02027 62200006
         BE    SAVBFR                   BRANCH IF MSG FOUND             62400020
NOTSEQ   EQU   *                                                 Y02027 62480006
         TM    PEWAFLG,FIRSTR           FIRST-TIME HEADER               62560020
         BNO   GETITX                   BRANCH IF NO             A41026 62620020
*   ASSUME SEQUENCE NUMBER NOT REACHED YET                              62800020
*                                                                       62900020
         NC    PEWASAVE+TWELVE(3),PEWASAVE+TWELVE END OF CHAIN   Y02027 63000006
         BZ    SETERR                   BRANCH IF YES            Y02027 63050006
         MVC   SCBDEOB+ONE(3),PEWASAVE+TWELVE QBACK FROM CURRENT Y02027 63100006
*                                       LAST TEXT                Y02027 63200006
         XC    PEWASAVE+TWELVE(3),PEWASAVE+TWELVE CLEAR QBACK PTRY02027 63250006
         NI    PEWAFLG,AVTEFF-FIRSTR    SET NOT FIRST-TIME              63350020
         B     EMPTYRTN                 RETURN BFR AND POST ERB  S21903 63400022
SAVBFR   EQU   *                                                        63500020
         MVI   PEWASAVE,ZERO            SET NORMAL COMPLETION C. Y02027 63600006
         ST    RBFR,PERAQCB             SAVE HDR BFR ON R-A QCB  Y02027 63700006
         MVI   PRFSCAN,AVTEZERO         CLEAR IDLE COUNT                63750020
         MVC   PRFLINK,AVTDELAD+1       SET UP LINK FIELD               63800020
         NI    PEWAOPTC,AVTEFF-RTVFLG   TURN OFF RETRIEVE MODE   Y02027 63900006
*                                       NEXT GET NOT IN RET. MODEY02027 63950006
         MVC   PRFCORE(2),SCBOSEQ       SAVE SEQUENCE NUMBER   @YA09297 63958081
*                                        FOR MULTIPLE RETRIEVE @YA09297 63966081
*                                        USE. GET/READ ROUTINE @YA09297 63974081
*                                        WILL PASS IT BACK     @YA09297 63982081
*                                        TO THE USER.          @YA09297 63990081
SAVBFRX  EQU   *                                                        64000020
         TM    PRFSTAT1,PRFNLSTN        EOM BUFFER                      64100020
         BNO   POST                     BRANCH IF YES                   64200020
         LA    RERB,PEERB               RELOAD ERB ADDRESS       Y02027 64250006
         CLC   SCBSCSEG(3),SCBCRCD      HAS THIS RECORD BEEN   @OZ11164 64270081
*                                        READ BEFORE           @OZ11164 64290081
         BE    NOTLAST1                 YES, BR                @OZ11164 64310081
         TM    SCBSTAT1,PRFNLSTN        EOM BUFFER             OZ07100  64330081
         BO    NOTLAST1                 BR IF NO               OZ07100  64340081
         MVI   AVTDOUBL,AVTEZERO        CLEAR HI BYTE          @OZ11164 64350081
         MVC   AVTDOUBL+1(3),SCBXTRA    CURRENT EXTRE RECORD   @OZ11164 64358081
         MVC   SCBNTXT(3),SCBCRCD       ASSUME NO EXTRA        @OZ11164 64366081
         L     RTEMP,AVTDOUBL           GET IT                 @OZ11164 64374081
         LTR   RTEMP,RTEMP              ANY EXTRA RECORDS      @OZ11164 64382081
         BZ    NOTLAST1                 BR IF NO               @OZ11164 64390081
         LH    RRCB,SCBSIZE             GET PREFIX SIZE        @OZ11164 64398081
         N     RRCB,AVTCLRHI            CLEAR HIGH HALFWORD    @OZ11164 64406081
XTRALOOP EQU   *                                               @OZ11164 64414081
         LA    RTEMP,INCR(,RTEMP)       BUMP ADDRESS           @OZ11164 64422081
         SH    RRCB,AVTKEYLE            REDUCE BY KEY LENGTH   @OZ11164 64430081
         BP    XTRALOOP                 BR IF STILL PLUS       @OZ11164 64438081
         SH    RTEMP,CONST              ADJUST REG             @OZ11164 64446081
         ST    RTEMP,AVTDOUBL           LAST EXTRA FOR NTXT    @OZ11164 64454081
         MVC   SCBNTXT(3),AVTDOUBL+1    SET STOPPER FOR        @OZ11164 64462081
*                                        READING EOM           @OZ11164 64470081
NOTLAST1 EQU   *                                               @OZ11164 64478081
         NI    SCBQTYPE,X'0F'                                           64500020
         MVI   LCBERBCT,1               UNIT COUNT                      64600020
         L     RTEMP,PEWALCBA           LCB ADDRESS                     64630020
         MVI   LCBSTAT1-IEDQLCB(RTEMP),LCBRCLLN+X'01' SET RECALL FLAGS  64660020
         B     POST                     POST ECB AND DO RECALL          64730020
SETERR3  EQU   *                                                        64800020
         MVI   PEWASAVE,AVTECD12        SET ERROR CODE           Y02027 64900006
         NI    PEWARTVE+THREE,RESETRM   RESET MRM              @OY15490 64950081
RCLEAN   EQU   *                                                        65000020
         CLI   PEWASAVE,AVTECD12        ERROR                    Y02027 65010006
         BE    RCLEAN2                  YES,CLEANUP            @ZA03050 65020081
         CLI   PEWARTVE+TWO,ZERO        RETRIEVE TERMINATION     Y02027 65030006
         BE    RCLEANX                  BR-YES                 @G36XRAW 65035010
         BAL   RETURN,DSPDISP           NO, WAIT FOR GET TO    @G36XRAW 65040006
*                                       CLEANUP                  Y02027 65050006
RCLEANX  EQU   *                                                        65060006
*   EOM EMPTY SO GET OUT OF RETRIEVE MODE                               65100020
         L     RTEMP,PEWALCBA           LCB ADDRESS                     65200020
         TM    LCBSTAT1-IEDQLCB(RTEMP),LCBRCLLN RETRIEVE MODE           65300020
         BNO   ERBFIX                   BRANCH IF NO                    65400020
RCLEAN2  EQU   *                                               @XA05282 65450061
         L     RTEMP,PEWALCBA           LCB ADDRESS            @ZA03050 65470081
         MVI   LCBSTAT1-IEDQLCB(RTEMP),LCBSENDN CLEAR RECALL FLGSA56624 65500022
         MVC   LCBERBST-IEDQLCB(1,RTEMP),PEWASAVE+THIRTY4      @OX16398 65510000
*                                       RESTORE ERB STATUS     @OZ15631 65530081
         LA    RERB,PEERB               RELOAD ERB ADDRESS       Y02027 65560006
         LA    RSCB,PEWASCB             ADDRESS OF SCB           Y02027 65570006
         MVC   SCBSCSEG(3),PEWASAVE+ONE RESTORE CURRENT SEG ADDR Y02027 65600006
         MVC   SCBUNTCT(4),PEWASAVE+FOUR RESTORE CNT & HDR ADDR  Y02027 65650006
         MVC   SCBSTATE(4),PEWASAVE+EIGHT RESTORE PROC QCB ADDR  Y02027 65700006
         MVC   SCBSCHDR(7),PEWASAVE+TWENTY4 RESTORE CHDR + FFEFO@X16398 65730000
         MVC   SCBDCHDR(3),PEWASAVE+THIRTY1 RESTORE CURRENT HDR@OX16398 65750000
         MVC   SCBOSEQ,PEWASAVE+TWENTY2 RESTORE SEQ NUMBER       Y02027 65800006
         L     RTEMP,PEPCBAD            PROCESS CONTROL BLOCK           65900020
         MVC   LCBERBCT(1),PCBBUFMX-IEDQPCB(RTEMP)  RESET RAQ LIM       66000020
         NI    PEWAFLG,X'FF'-RFLG       TURN OFF RETRIEVE MODE FLAG     66100020
         NI    PEWAOPTC,AVTEFF-RTVFLG   CLEAR RETRIEVE FLAG    @ZA02649 66110081
         NC    PERAQCB+5(3),PERAQCB+5   BFR ADDR ZERO          @XA05282 66120061
         BNZ   NOTZERO                  BRANCH IF NO           @XA05282 66140061
         MVC   PERAQCB+5(3),AVTDELAD+1  SET DELEM ADDR         @XA05282 66160061
NOTZERO  EQU   *                                               @XA05282 66180061
         MVC   PERAQCB+ONE(3),PEWAQCBL+ONE RESTORE FULL BFR CHAINY02027 66200006
         XC    PEWAQCBL+ONE(3),PEWAQCBL+ONE  SHOW NO BUFFERS     Y02027 66250006
         XC    PEWAELEM+8(3),PEWAELEM+8  CLEAR COUNT TO ZERO   @SA74016 66300061
         MVI   PEWARTVE,XC2             RESTORE APPL. PROG. FLG@OZ11199 66305081
         L     RPARM,PEWARCB            RCB ADDRESS            @OZ07798 66310081
         TM    PEWAFLG,CFLG             CLOSEDOWN ACTION        SA67159 66320054
         BNO   NOCLOSE                  BR-NO                  @G36XRAW 66325010
         TS    FORTY7(RPARM)            SET RCB POSTED FLAG    @OZ26305 66330000
         BC    4,DSPDISP                GET OUT, RCB ON RDY Q  @OZ26305 66331000
         BAL   RETURN,DSPPOST           POST RCB               @OZ26305 66332000
NOCLOSE  EQU   *                                               @G36XRAW 66335010
         CLC   PERAQCB+1(3),AVTDELAD+1  QUEUE EMPTY?             A47127 66370021
         BNE   PREPOST                  BRANCH IF NO             Y02027 66440006
         OI    PEWAFLG,RAFLG            SET READ AHEAD FLAG      A47127 66510021
PREPOST  EQU   *                                                 Y02027 66600006
         NC    PEWAECBA,PEWAECBA        ECB TO POST              Y02027 66680006
         LA    RETURN,NOTRET            SET FOR BRANCH TO TRY A  Y0202M 66760006
*                                       READ AHEAD               Y02027 66840006
         BZR   RETURN                   BRANCH IF NO             Y02027 66920006
         LA    RRCB,AVTSAVE3            USE AVT SAVEAREA         Y02027 67000006
*                                       AS FAKE AIB              Y02027 67080006
         B     GOODRETC                 CROSS MEMORY POST        Y02027 67160006
OUTRX    EQU   *                                                 Y02027 67240006
         TM    PEWAFLG,ERBBUSY          ERB NOT POSTABLE       @ZA03050 67260081
         BNO   ERBPOST3                 BR-NO                  @G36XRAW 67270010
         BAL   RETURN,DSPDISP                                  @G36XRAW 67280081
ERBPOST3 EQU   *                                               @G36XRAW 67290010
         MVI   PEWARTVE+TWO,ZERO        RESET TERMINATION FLAG   Y02027 67320006
OUTRZ    EQU   *                                                        67400020
         XC    PEWASAVE+SIXTEEN(3),PEWASAVE+SIXTEEN CLEAR        Y02027 67430006
*                                       MULTIPLE RETRIEVAL       Y02027 67440006
*                                      QBACK CHAIN JUST IN CASE  99226  67460022
         NI    PEWARTVE+THREE,RESETRM   RESET MRM              @OY15490 67470081
OUTRZ1   EQU   *                                               @SA68228 67480061
         CLC   PERAQCB+1(3),AVTDELAD+1  QUEUE EMPTY                     67500020
         BE    RCLEAN                   BRANCH IF YES                   67600020
         L     RPARM,PERAQCB            ADDRESS OF FIRST BUFFER         67700020
RLOOP    EQU   *                                                        67800020
         L     RTEMP,PRFLINK-1-IEDQPRF(0,RPARM) NEXT BUFFER             67900020
         XC    PRFLINK-IEDQPRF(3,RPARM),PRFLINK-IEDQPRF(RPARM)          68000020
         BAL   RETURN,DSPPOSTR          POST BFR TO RETURN QCB          68100020
         LA    RTEMP,0(0,RTEMP)                                         68200020
         C    RTEMP,AVTDELAD            LAST BUFFER                     68300020
         BE    SETLCBAD                 BRANCH IF YES          @XA05282 68400061
         LR    RPARM,RTEMP              BUFFER ADDRESS                  68500020
         B     RLOOP                    GO RETURN THIS BUFFER           68600020
         SPACE 1                                                        68650020
**  **  C O N S T A N T S  **  **                                S21101 68660020
         SPACE 1                                                        68670020
CLEAR    DC    0F'0',X'00FFFFFC'                                 S21101 68680020
BLANKS   DC    8C' '                    EIGHT BLANKS TO CLEAR    Y02027 68685006
*                                       NAME FIELD               Y02027 68690006
CONST    DC    H'8'                     CONSTANT               @OZ11164 68692081
QCBHDRSZ DS    0H                       QCB HDR SIZE           @ZM47936 68692100
         DC    AL2(QCBPRFSZ)            QCB HDR SIZE           @ZM47936 68692200
PATCH1   DC    25H'0'                   PATCH AREA               Y02027 68695006
         EJECT                                                          68700020
*        THIS LOGIC IS ACTIVATED BY THE DESTINATION SCHEDULER         * 68800020
*        WHEN AN EOM BUFFER IS POSTED TO A PREVIOUSLY EMPTY           * 68900020
*        DESTINATION QUEUE.                                           * 69000020
TAG      EQU   *                                                        69100020
         USING *,RENTRY                                                 69200020
         L     RWORK,QCBPREN            PROCESS ENTRY ADDRESS           69400020
         L     RGETWORK,TRMSTAT-IEDQTRM(0,RWORK) PEWA ADDRESS           69500020
         TM    PEWAFLG,CFLG             CLOSE PENDING          @OZ17615 69503081
         BNO   TAG1                     BR, NO                 @OZ17615 69506081
         ICM   RPARM,SEVEN,PEWARCB+ONE   GET CLOSE RCB         @OZ17615 69509081
         TS    FORTY7(RPARM)            SET POSTED FLAG        @OZ26305 69512000
         BC    8,DSPPOSTR               POST RCB FOR CLOSE     @OZ26305 69512700
         BR    RETURN                   RETURN, RCB ON READY Q @OZ26305 69513400
TAG1     EQU   *                                               @OZ17615 69515081
         TM    PEWAFLG,PEWASTOP         ENTRY CLOSED            SA63961 69520052
         BNZR  RETURN                   BR IF YES                Y02027 69540006
         MVC   QCBSTCHN(3),QCBSLINK     MOVE GET SCHEDULER TO    Y02027 69560006
         MVC   QCBSLINK(3),PEWAQCBS+ONE READ AHEAD QCB AS DONE   Y02027 69620006
         LA    RWORK,QCBSTVTO           BY DSPUNAV. DEST QCB'S   Y02027 69680006
         ST    RWORK,PEWAQCBS           STCB POINTS TO HM        Y02027 69800006
         LA    RWORK,PERAQCB            READ-AHEAD QCB ADDRESS          69900020
         ST    RWORK,PEWAELEM                                           70000020
         OI    PEWAFLG,RAFLG            SET 'READ NOW' FLAG      S22025 70250022
         MVI   PEWAELEM,DUMMY           CHANGE-Q ELEMENT FLAG           70600020
         MVI   PEWAELEM+4,X'C0'         CHANGE-Q ELEM PRIORITY          70700020
         XC    PEWAELEM+5(3),PEWAELEM+5 SET LINK FIELD TO ZERO          70800020
         LA    RPARM,PEWAELEM           ADDR OF DUMMY ELEMENT           71000020
         L     RWORK,PEWALCBA           LCB ADDRESS                     71100020
         NI    LCBSTAT1-IEDQLCB(RWORK),LCBRCLLF NO RECALL               71200020
         B     DSPPOSTR                 POST DUMMY ELEMNT &RTN          71300020
*                                       TO DESTINATION SCHEDULER        71400020
         DROP  RENTRY                                                   71500020
** **  E Q U A T E S  **                                                71600020
         SPACE 2                                                        71700020
LOCKI    EQU   X'10'                    LOCK INQUIRY FLAG        S21903 71750022
ZERO     EQU   0                        ZERO-BYTE DISPLACEMENT          72000020
ONE      EQU   1                        ONE-BYTE DISPLACEMENT           72100020
TWO     EQU    2                        DISPLACEMENT             Y02027 72120006
NUMEXT   EQU   1                        NUMBER OF DEB EXTENTS    S22024 72150022
THREE    EQU   3                        THREE-BYTE DISPLACEMENT         72400020
FOUR     EQU   4                        DISPLACEMENT             Y02027 72430006
FIVE     EQU   5                        DISPLACEMENT             Y02027 72460006
SIX      EQU   6                        DISPLACEMENT             Y02027 72480006
EIGHT    EQU   8                        EIGHT-BYTE DISPLACEMENT         72500020
NINE     EQU   9                        DISPLACEMENT             Y02027 72540006
TEN      EQU   10                       DISPLACEMENT             Y02027 72580006
TWELVE   EQU   12                       DISPLACEMENT             Y02027 72620006
SIXTEEN  EQU   16                       DISPLACEMENT             Y02027 72660006
TWENTY   EQU   20                       DISPLACEMENT             Y02027 72700006
TWENTY2  EQU   22                       DISPLACEMENT             Y02027 72740006
TWENTY4  EQU   24                       DISPLACEMENT             Y02027 72760006
THIRTY   EQU   30                       DISPLACEMENT             Y02027 72780006
THIRTY1  EQU   31                       DISPLACEMENT           @OX16398 72783000
THIRTY4  EQU   34                       DISPLACEMENT           @OX16398 72786000
THIRT3   EQU   33                       DISPLACEMENT           @OZ15631 72790081
SEVEN    EQU   7                        MASK OF 0111             Y02027 72800006
ALL      EQU   15                       MASK OF 1111             Y02027 72900006
SEQLEN   EQU   2                        SEQ NUMBER LENGTH        S21903 73250022
DUMMY    EQU   X'08'                    QWAIT ELEMENT KEY               73400020
BLANK    EQU   C' '                     RETRV TRMNATION INDICATR S21903 74500022
QSAMFLG  EQU   X'40'                    QSAM DCBMACRF IDENTIFIER Y02027 74600006
EOQ      EQU   X'02'                    BOTH QUEUES EMPTY        Y02027 74601006
EOD      EQU   X'01'                    READ AHEAD QUEUE EMPTY   Y02027 74602006
SOWACC   EQU   X'52'                    ERROR CODE               Y02027 74603006
DATET    EQU   X'10'                    DATE=YES IS SPECIFIED    Y02027 74604006
STOPQRC  EQU   20                       DISABLED ENTRY R.C.      Y02027 74604506
TIC      EQU   X'08'                    TIC OP CODE              Y02027 74605006
PRFLEN   EQU   4                        PREFIX LENGTH            Y02027 74606006
SRCELEN  EQU   8                        LENGTH OF SOURCE FIELD   Y02027 74607006
PARMLEN  EQU   8                        LENGTH OF DATE/TIME      Y02027 74608006
CBYTELEN EQU   1                        CONTROL BYTE LENGTH      Y02027 74609006
XC2      EQU   X'C2'                    FLAG FOR APPL. PROG.   @OZ11199 74629081
OFF      EQU   X'10'                    TEN-BYTE DISPLACEMENT    S21903 74650022
DCBOPEN  EQU   X'10'                    TO TEST FOR OPEN DCB     S21903 74680022
LOCKR    EQU   X'20'                    RESPONSE DUE FLAG        S21903 74710022
IDLECHAR EQU   X'17'                    EBCDIC IDLE CHARACTER    S21903 74740022
X0F      EQU   X'0F'                    TO CLEAR Q-TYPE FLAGS    S21903 74770022
DISKAD   EQU   X'03'                    FLAGS USED IN DISK ADDR  A47133 74800021
RETPRI   EQU   X'50'                    PRIORITY OF ELEMENT    @ZA03097 74806081
*                                       POSTED TO IEDQEW BY    @ZA03097 74812081
*                                       IEDQEU IF CLOSEDOWN IS @ZA03097 74818081
*                                       REQ DURING RETRIEVE    @ZA03097 74824081
INCR     EQU   4                        INC VALUE FOR ADDR     @OZ11164 74827081
RESETRM  EQU   X'7F'                    FLAG TO RESET MRM      @OY15490 74828081
FORTY7   EQU   47                       RCB OFFSET FOR POSTED  @OZ26305 74828600
*                                        FLAG                  @OZ26305 74829200
         EJECT                                                          74830006
*                             DSECTS                                    74840006
         TTCXD                                                 @ZA05000 74842081
         EJECT                                                          74844081
CVTMAP   CVT   DSECT=YES                                       @ZA05000 74846081
         EJECT                                                          74848081
        TAIBD  EXT=(GETREAD,POINT)                                      74850006
        TPEBD                                                           74860006
         TTNTD                                                          74870006
         TPRIOR                                                         74900020
         TAVTD                                                          75000006
         TQCBD                          QUEUE CONTROL BLOCK             75300020
         TSCBD                                                          75400020
         TLCBD                          LINE CONTROL BLOCK              75500020
         TRECBD                         RESOURCE CONTROL BLOCK          75600020
         TSTCBD                         SUBTASK CONTROL BLOCK           75700020
         TTRMD                                                          75800020
         TPRFD                                                          75900020
         TDISPD                                                         76000020
         TPCBD                                                          76100020
         TPEWAD                                                         76200020
         TDEBAPD                                                        76300020
         DCBD  DSORG=TX                                                 76450020
         END                                                            76500020
