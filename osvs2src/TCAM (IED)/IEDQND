          TITLE 'IEDQND-READY ROUTINE'                                  00200020
IEDQND   CSECT                                                          00400020
*A-000000-999999                                               @X31X8N0 00400208
         SPACE 3                                                 S21903 00400505
*CHANGE ACTIVITY= AS FOLLOWS:                                           00410022
******************** MICROFICHE FLAGS *********************** SUPT CODE 00417005
*C676000-678000                                                  S22026 00425022
*A849000                                                         S22026 00425122
*A444000                                                         A42401 00425222
*C138000                                                         A42401 00425322
*C134000,166000,224000,576000,836000,839200                      S22025 00425422
*C074000                                                        SA53627 00425522
*C012000                                                         S21903 00425622
*D114000,212000                                                  S21903 00425722
*C712000,842000                                                 SA59006 00425822
*A618290,844500                                                 SA58457 00425922
*C004250-005950,016000                                          SA58457 00426022
*A674200-675800                                                  S22024 00426122
*C094000-126000,618140-618160,618260,851000                      S22024 00426222
*    CLEAN-UP                                                    S21903 00426305
*A692000,842000                                                 SA63007 00426405
*C 618390                                                       SA63993 00426551
*C128700,618140,618160,618260                                    S05331 00506552
*A250000,276000,298000,528000                                  @SA67132 00536561
*C302000,534000,541000                                         @SA67132 00566561
*A240500                                                       @OS76514 00566691
*A250600,556600                                                @ZA06155 00576509
*C676500                                                       @OY12667 00576691
*A680000                                                       @OY14058 00576791
*D240450-240500                                                @OS77945 00576891
*    TCAM LEVEL 10.0 MVS CHANGES                               @G36XRNP 00579800
*A035100,051200,055300,128630,129890,208000,242000,670000      @G36XRNP 00582800
*A812000,839200,816200                                         @G36XRNP 00585800
*C016000,020000,022000,618140,666000                           @G36XRNP 00588800
*A128840,508000,828000                                         @OZ26495 00588982
*C445200                                                       @OZ26495 00589082
*D055200-055300,214000,670200-670800,857000                    @G36XRNP 00591800
*                                                              @G36XRNP 00594800
*D246000-250000,534000,556920                                  @OY19771 00594982
*A251801-251803,534000,556961                                  @OY19771 00595082
*A444000,508120                                                @OY20722 00595182
         SPACE 3                                                        00600020
*********************************************************************** 00800020
*                                                                     * 01000020
*MODULE-NAME= IEDQND  (TCAM,INITIALIZATION)                    @G36XRNP 01200000
*                                                                S21903 01240022
*DESCRIPTIVE-NAME= READY ROUTINE                                 S21903 01280022
*                                                                S21903 01320022
*COPYRIGHT= 'NONE'                                               S21903 01360022
*                                                                     * 01400020
*STATUS: CHANGE LEVEL 10.0                                     @G36XRNP 01600000
*                                                                     * 01800020
*FUNCTION:THIS MODULE CHECKS FOR CHECKPOINT OR ON-LINE-TEST OPTIONS   * 02000020
*   SPECIFIED AND PERFORMS ASSOCIATED FUNCTIONS.  IF EITHER    @G36XRNP 02200000
*   THE TCAM CHECKPOINT DCB OR A 3705 CHECKPOINT               @G36XRNP 02300000
*   DCB HAS BEEN OPENED, THIS MODULE ATTACHES THE CHECKPOINT          * 02400020
*   EXECUTOR AND SETS UP REGISTERS IN AVTSAVE2 SO THAT THE TCAM       * 02600020
*   DISPATCHER WILL PUT THE ENVIRONMENT CHECKPOINT REQUEST ELEMENT    * 02800020
*   ON THE READY QUEUE.  IF ON-LINE-TEST HAS BEEN SPECIFIED ON INTRO  * 03000020
*   THIS MODULE CHECKS FOR SUFFICIENT CORE FOR IT TO PERFORM ITS      * 03200020
*   FUNCTIONS.                                                        * 03400020
*                                                                     * 03410022
*        IF A RESTART IS BEING PERFORMED, THE OPERATOR CONTROL        * 03420022
*   INCIDENT RECORDS RECORDED AFTER THE LAST ENVIRONMENT              * 03430022
*   CHECKPOINT ARE SENT TO OPERATOR CONTROL TO BE PROCESSED           * 03440022
*   AGAIN.  START LINE AND STOP LINE COMMANDS ARE IGNORED AT          * 03450022
*   THIS POINT SINCE THOSE FUNCTIONS WERE PERFORMED DURING OPEN       * 03460022
*   PROCESSING.  IF AN I/O ERROR OCCURS WHILE READING THE             * 03470022
*   INCIDENT RECORDS OR IF THERE IS NOT ENOUGH CORE AVAILABLE         * 03480022
*   TO READ THE RECORDS, THE TELEPROCESSING CONSOLE OPERATOR IS       * 03490022
*   NOTIFIED VIA A WRITE-TO-OPERATOR AND THE INCIDENT RECORD IS       * 03500022
*   IGNORED.                                                          * 03510022
*                                                                     * 03600020
*        IEDQND LINKS TO IEDIAB TO PERFORM INITIATION OF NAT,  @G36XRNP 03620000
*   PLCB AND SIB POOLS, SAT, AND THE HOST SUBAREA RVT.  IT     @G36XRNP 03640000
*   ALSO LINKS TO IGCFD10D TO DEACTIVATE THE TERMINAL          @G36XRNP 03660000
*   HIERARCHIES.                                               @G36XRNP 03680000
*                                                              @G36XRNP 03700000
*        270X TERMINAL DESTINATION QCBS SPECIFYING CLOCK/CINTVL@G36XRNP 03720000
*   ARE PLACED ON THE TIME DELAY QUEUE.                        @G36XRNP 03740000
*                                                              @G36XRNP 03760000
*ENTRY POINT:                                                         * 03800020
*                                                                     * 04000020
*        IEDQND                                                       * 04200020
*                                                                     * 04400020
*INPUT:REGISTER 13 HAS THE ADDRESS OF THE AVT.                        * 04600020
*                                                                     * 04800020
*OUTPUT:THE ADDRESS OF THE OPERATOR CONTROL INCIDENT RECORD TO        * 05000022
*   BE PROCESSED IS PLACED IN THE FIELD NAMED OPCCOPCE IN THE         * 05060022
*   OPERATOR CONTROL AVT.                                             * 05120022
*                                                                     * 05200020
*EXTERNAL REFERENCES:                                                 * 05220000
*        ROUTINES -                                            @G36XRNP 05240000
*               IEDQTNT (TTCIN TO TTE CONVERSION ROUTINE)      @G36XRNP 05260000
*               IEDQTL (DEV DEPENDENT FIELDS LOOKUP ROUTINE)   @G36XRNP 05280000
*               IEDQCA(RESIDENT OP CTL ROUTINE)ACTIVATED VIA A @G36XRNP 05300000
*               POST SVC.                                      @G36XRNP 05320000
*               IEDIAB(PLCB,NAT,SAT,RVT INITIATION)            @G36XRNP 05340000
*               IGCFD10D(DEACTIVATE HIERARCHY)                 @G36XRNP 05360000
*        MACROS -                                                     * 05400000
*              (IEDHJN)                                                 05405000
*        SVC 0 (EXCP)                                                 * 05410022
*        SVC 1 (WAIT)                                                 * 05420022
*        SVC 2 (POST)                                                 * 05430022
*        SVC 4 (GETMAIN)                                              * 05440022
*        SVC 5 (FREEMAIN)                                             * 05450022
*        SVC 8 (LOAD)                                                 * 05460022
*        SVC 10 (GETMAIN)                                             * 05470022
*        SVC 10 (FREEMAIN)                                            * 05480022
*        SVC 11 (TIME)                                                * 05490022
*        SVC 35 (WTO)                                                 * 05500022
*        SVC 42 (ATTACH)                                              * 05510022
*        SVC  6 (LINK)                                                  05515000
*                                                                     * 05600020
*MODULE TYPE = PROCEDURE                                       @G36XRNP 05610000
*                                                              @G36XRNP 05620000
*PROCESSOR = ASSEMBLER XF                                      @G36XRNP 05630000
*                                                              @G36XRNP 05640000
*MODULE SIZE = THERE IS NO SIZE RESTRICTIONS.                  @G36XRNP 05650000
*                                                              @G36XRNP 05660000
*PURPOSE = SEE FUNCTION                                        @G36XRNP 05670000
*                                                              @G36XRNP 05680000
*LINKAGE = THIS ROUTINE IS LINKED (SVC 6) TO FROM              @G36XRNP 05690000
*          THE READY MACRO GENERATION IN THE MCP.              @G36XRNP 05700000
*                                                              @G36XRNP 05710000
*EXITS-NORMAL:THIS MODULE RETURNS TO THE ADDRESS IN R14               * 05800020
*                                                                     * 06000020
*EXITS-ERROR:NONE                                                     * 06200020
*                                                                     * 06400020
*TABLES/WORKAREAS:                                                    * 06600020
*        AVT                                                          * 06800022
*        CVT                                                   @Z30X8NJ 06810008
*        DEB                                                   @Z30X8NJ 06820008
*        DCB                                                          * 06840022
*        QCB                                                          * 06880022
*        TSO QCB                                                      * 06920022
*        TERMINAL ENTRY                                        @Z30X8NJ 06960008
*        TERMNAME TABLE                                        @Z30X8NJ 06970008
*        PRIORITY DSECT                                        @Z30X8NJ 06980008
*        TCX                                                   @Z30X8NJ 06990008
*        CHECKPOINT WORKAREA                                          * 07000022
*        CHECKPOINT INCIDENT RECORD DSECT                             * 07040022
*        OPERATOR CONTROL AVT                                         * 07080022
*        OPERATOR CONTROL ELEMENT DSECT                               * 07120022
*                                                                     * 07200020
*ATTRIBUTES: REUSABLE                                           SA53627 07400022
*                                                                     * 07600020
*NOTES = SEE BELOW                                             @G36XRNP 07660000
* DEPENDENCIES =                                               @G36XRNP 07720000
*      THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL REPRE-   * 07800000
*   SENTATION OF THE EXTERNAL CHARACTER SET WHICH IS EQUIVALENT TO    * 08000020
*   THE ONE USED AT ASSEMBLY TIME. THE CODING HAS BEEN ARRANGED SO    * 08200020
*   THAT REDIFINITION OF 'CHARACTER' CONSTANTS,BY REASSEMBLY, WILL    * 08400020
*   RESULT IN A CORRECT MODULE FOR THE NEW DIEFINITIONS.              * 08600020
*                                                                     * 08800020
* RESTRICTIONS = NONE                                          @G36XRNP 08820000
*                                                              @G36XRNP 08840000
* REGISTER CONVENTIONS = SEE REGISTER ASSIGNMENT               @G36XRNP 08860000
*                                                              @G36XRNP 08880000
* PATCH = THE SYMBOLIC NAME IS PATCH.                          @G36XRNP 08900000
*                                                              @G36XRNP 08920000
*********************************************************************** 09000020
         EJECT                                                   S21903 09200005
R0       EQU   0                        REG 0                    S22024 09400022
R1       EQU   1                        REG 1                    S22024 09600022
R2       EQU   2                        REG 2                    S22024 09800022
R3       EQU   3                        REG 3                    S22024 10000022
R4       EQU   4                        REG 4                    S22024 10200022
R5       EQU   5                        REG 5                    S22024 10400022
R6       EQU   6                        REG 6                    S22024 10600022
R7       EQU   7                        REG 7                    S22024 10800022
R8       EQU   8                        REG 8                    S22024 11000022
RTERM    EQU   8                        ADDRESS OF TERM ENTRY    S22024 11200022
R9       EQU   9                        REG 9                    S22024 11400022
R10      EQU   10                       REG 10                   S22024 11600022
R11      EQU   11                       REG 11                   S22024 11800022
R12      EQU   12                       REG 12                   S22024 12000022
R13      EQU   13                       REG 13                   S22024 12200022
R14      EQU   14                       REG 14                   S22024 12400022
R15      EQU   15                       REG 15                   S22024 12600022
         SPACE 3                                                        12800020
HALF     EQU   32                       THIRTY TWO               S22024 12807005
LOWEQ    EQU   X'0A'                    CC OF LOW OR EQUAL      SA59006 12814005
ONE      EQU   1                        ONE                      S22024 12821005
ZERO     EQU   0                        CONSTANT VALUE           S99528 12828005
EIGHT    EQU   8                        REG 8 EQU                       12835005
ECMODE   EQU   X'20'                    EXTENDED CONTROL MODE   SA58457 12842005
TEN      EQU   10                       CONSTANT VALUE           S99528 12849005
TWO      EQU   2                        COUNT OF TWO             S21903 12856005
THREE    EQU   3                        LENGTH VALUE            SA63007 12863005
DREG2    EQU   16                       DISPLACEMENT TO REG 2  @G36XRNP 12866000
QNDOLTST EQU   18                       MIN VALUE FOR OLTEST     S05331 12870052
X10      EQU   X'10'                    HEX 10                   S21903 12877005
X40      EQU   X'40'                    HEX 40                   S21903 12884005
X60      EQU   X'60'                    HEX 60                 @OZ26495 12885082
X20      EQU   X'20'                    HEX 20                 @OZ26495 12886082
SIXTEN   EQU   16                       CONSTANT               @OZ26495 12887082
X41      EQU   X'41'                    HEX 41                   S21903 12891005
X70      EQU   X'70'                    HEX 70                   S21903 12898005
X7F      EQU   X'7F'                    HEX 7F                   S21903 12905005
X80      EQU   X'80'                    HEX 80                   S21903 12912005
XD0      EQU   X'D0'                    HEX D0                   S21903 12919005
XE0      EQU   X'E0'                    HEX E0                   S21903 12926005
XFC      EQU   X'FC'                    HEX FC                   S21903 12933005
XFE      EQU   X'FE'                    HEX FE                   S21903 12940005
XFF      EQU   X'FF'                    HEX FF                   S21903 12947005
L1       EQU   1                        LENGTH OF 1              S21903 12954005
L2       EQU   2                        LENGTH OF 2              S21903 12961005
L3       EQU   3                        LENGTH OF 3              S21903 12968005
L4       EQU   4                        LENGTH OF 4              S21903 12975005
L6       EQU   6                        LENGTH OF 6              S21903 12982005
L8       EQU   8                        LENGTH OF 8              S21903 12989005
CHECKPT  EQU   X'20'                    TCAM CKPT DCB FLAG     @G36XRNP 12992000
ADDRMSK  EQU   7                        ADDRESS MASK           @G36XRNP 12995000
*STANDARD LINKAGE                                                       13000020
         USING *,R15                    BASE REG                        13200020
IEDQND  IEDHJN QND00                                             S22025 13400022
         USING IEDQAVTD,R13             BASE FOR AVT                    14200020
         STM   R14,R12,12(R13)          SAVE REGS                       14400020
         LR    R12,R15                  BASE REG                        14600020
         DROP  R15                                                      14800020
         USING IEDQND,R12                                               15000020
         SPACE 3                                                        15200020
         SPACE 3                                                        20600020
*CHECK TO DETERMINE IF THE CHECKPOINT DCB WAS OPENED                    20800020
         SPACE                                                          21000020
         TM    AVTCKFLG,AVTCKTAC        TCAM CKPT ACTIVE       @G36XRNP 21400000
         BO    QND20                    BRANCH IF OPENED       @G36XRNP 21600000
         MVI   AVTCKECA,X40             POST COMPLETION ECB SINCES21903*22000005
                                        CKPT WILL NEVER TERMINATE       22200020
         B     QND79                    CHECK FOR 3705 CKPT    @G36XRNP 22400000
         SPACE                                                          22407000
QND20    EQU   *                                               @G36XRNP 22414000
*                                                              @G36XRNP 22421000
*        FIND TCAM CHECKPOINT DCB ADDRESS                      @G36XRNP 22428000
*                                                              @G36XRNP 22435000
         L     R1,AVTTCB                GET TCAM TCB ADDRESS   @G36XRNP 22442000
         USING IEDQTCB,R1               SET ADDRESSABILITY     @G36XRNP 22449000
         L     R1,TCBDEB                GET FIRST DEB ADDRESS  @G36XRNP 22456000
         DROP  R1                                              @G36XRNP 22463000
         USING DEBNMSUB,R1              SET ADDRESSABILITY     @G36XRNP 22470000
         USING IHADCB,R2                SET ADDRESSABILITY     @G36XRNP 22477000
QND35    EQU   *                                               @G36XRNP 22484000
         L     R2,DEBDCBAD              GET DCB ADDRESS        @G36XRNP 22491000
         TM    DCBDSRG2,DCBDSGTQ        IS THIS A TCAM QUEUE   @G36XRNP 22498000
*                                       DATA SET               @G36XRNP 22505000
         BZ    QND37                    NO, BRANCH             @G36XRNP 22512000
         TM    DCBOPTCD,CHECKPT         TCAM CKPT DCB          @G36XRNP 22519000
         BO    QND40                    YES                    @G36XRNP 22526000
QND37    EQU   *                                               @G36XRNP 22533000
         L     R1,DEBDEBAD              GET NEXT DEB ADDRESS   @G36XRNP 22540000
         B     QND35                    CONTINUE SEARCH FOR    @G36XRNP 22547000
*                                       TCAM CKPT DCB          @G36XRNP 22554000
QND40    EQU   *                                               @G36XRNP 22561000
         L     R2,DCBIOBAD              GET CKPT WORK AREA     @G36XRNP 22568000
*                                       ADDRESS                @G36XRNP 22575000
         DROP  R1                                              @G36XRNP 22582000
         DROP  R2                                              @G36XRNP 22589000
         SPACE 3                                                        22600020
*THE LATEST TOTAL ENVIRONMENT RECORD HAS BEEN USED TO UPDATE THE        22800020
*TAM TABLES. USE THE INCIDENT RECORDS TAKEN AFTER THE TOTAL TO          23000020
*UPDATE THE TABLES FURTHER.                                             23200020
         SPACE                                                          23400020
QND56    EQU   *                                                   0803 23600020
         USING IEDQCKPD,R2              BASE FOR CKPT WORK AREA         23800020
         USING IEDQCDRD,R11             BASE FOR DISK RECORD            24000020
         MVI   CKPSWCH2,0               INITIALIZE INVITATN LST SW 0911 24005020
         SPACE 3                                                        24010020
*PUT ENVIRONMENT REQUEST ELEMENT IN DISPATCHERS REG 1 SO IT WILL BE1002 24015020
*PUT ON READY QUEUE WHEN DISPATCHER GETS CONTROL                        24020020
         SPACE                                                          24025020
         LA    R15,AVTCKELE             ADDRESS OF CKPT ELEMENT         24030020
         ST    R15,AVTSAVE2+24          STORE INTO REG1 POSITION       X24035020
                                        FOR DISPATCHER                  24040020
         OI    AVTCKELF,AVTCRTLN        TURN ON CHECKPOINT     @OS76514 24051091
*                                        REQUEST BIT           @OS76514 24052091
         MVI   AVTCKELE,X70             SET KEY FIELD            S21903 24055005
         MVI   AVTCKELE+4,PRICKPT       PRIORITY OF CHECKPOINT ELEM     24060020
         SPACE 3                                                        24065020
*CHECK FOR SYSTEM DELAY SPECIFIED AND LOAD IEDQHI IF NECESSARY          24070020
*IF SYSTEM DELAY  WAS IN EFFECT AT TIME OF LAST CHECKPOINT,TURN OFF1002 24075020
*THE BIT AND PUT A REQUEST ELEMENT ON THE READY QUEUE  FOR THE          24080020
*SYSTEM DELAY ROUTINE.                                                  24085020
         SPACE                                                          24090020
         LH    R1,AVTINTLV              GET SYSTEM INTERVAL        0826 24095020
         LTR   R1,R1                    CHECK FOR ZERO             0826 24100020
         BZ    QND57                    BRANCH IF STILL ZERO       0115 24105020
         L     R1,AVTHI                 ADDR OF SYSTEM DELAY RTN   0826 24110020
         LTR   R1,R1                    CHECK FOR RTN LOADED       0826 24115020
         BNZ   QND57                    BRANCH ID ALREADY LOADED   0115 24120020
         LOAD  EP=IEDQHI                LOAD SYSTEM DELAY RTN      0826 24125020
         ST    R0,AVTHI                 SAVE ADDR OF RTN           0826 24130020
         SPACE 3                                                        24180020
*SEE  IF IT IS NECESSARY TO READ INCIDENT RECORDS FOR OPERATOR CONTL    24185020
         SPACE                                                          24190020
QND57    EQU   *                                                   1002 24195020
         TM    AVTBIT2,AVTSTRTN         CHECK FOR RESTART          0804 24200020
         BZ    QND79                    BRANCH IF NOT RESTARTING   0804 24400020
         L     R15,AVTTCB               GET TCAM TCB ADDRESS   @G36XRNP 24403000
         LA    R15,FOUR(R15)            POINT TO FIRST DEB-4   @G36XRNP 24406000
FOUR     EQU   4                        CONSTANT OF FOUR       @G36XRNP 24409000
         USING DEBNMSUB,R15                                    @G36XRNP 24412000
DEBLOOP  EQU   *                                               @G36XRNP 24415000
         L     R15,DEBDEBAD             GET NEXT DEB ADDRESS   @G36XRNP 24418000
         LA    R15,AVTEZERO(R15)        CLEAR HIGH ORDER BYTE  @G36XRNP 24421000
         LTR   R15,R15                  CHECK FOR END OF CHAIN @G36XRNP 24424000
         BZ    QND5750                  YES, EXIT              @G36XRNP 24427000
         L     R14,DEBDCBAD             GET DCB ADDRESS        @G36XRNP 24430000
         USING IHADCB,R14                                      @G36XRNP 24433000
         TM    DCBDSRG2,DCBDSGTR        IS THIS A 3705 DCB     @G36XRNP 24436000
         BZ    DEBLOOP                  NO, RELOOP             @G36XRNP 24439000
         LR    R1,R14                   GET 3705 DCB ADDRESS   @G36XRNP 24442000
         BAL   R7,QND90                 GET 3705 NCP TTE ADDR  @G36XRNP 24445000
*        REG 1 HAS 3705 NCP TTE ADDRESS                        @G36XRNP 24448000
         LA    R0,TRMNCPI               SET MASK TO GET ADDR   @G36XRNP 24451000
*                                       OF NCP DEVICE DEP FLD  @G36XRNP 24454000
         BAL   R7,QND95                 GET 3705 NCP DEVICE    @G36XRNP 24457000
*                                       DEP FIELDS ADDRESS     @G36XRNP 24460000
         LR    R11,R1                   SAVE NCP DEVICE DEP    @G36XRNP 24463000
*                                       FIELDS ADDRESS         @G36XRNP 24466000
         USING IEDNCP,R1                SET ADDRESSABILITY     @G36XRNP 24469000
         ICM   R1,ADDRMSK,NCPCKPT+1     GET 3705 CKPT DCB ADDR @G36XRNP 24472000
         BZ    DEBLOOP                  NO CKP DCB, BRANCH     @G36XRNP 24475000
         TM    DCBOFLGS-IHADCB(R1),DCBOFOPN DCB OPENED         @G36XRNP 24478000
         BZ    DEBLOOP                  NO, RETURN             @G36XRNP 24481000
         ICM   R8,7,DCBIOBAD+1-IHADCB(R1) GET CKP WORKAREA ADR @G36XRNP 24484000
         BZ    DEBLOOP                  NOT OPEN, RETURN       @G36XRNP 24487000
         CLI   CKPBCKUP-IEDQCKPD(R8),AVTEZERO WAS BACKUP       @G36XRNP 24490000
*                                       CHANGED                @G36XRNP 24493000
         BE    DEBLOOP                  NO, RETURN             @G36XRNP 24496000
         STM   R2,R15,CKPSAVE2          SAVE REGISTERS         @G36XRNP 24499000
         LR    R7,R2                    SAVE CKP WORKAREA BASE @G36XRNP 24502000
         LR    R4,R13                   AVT ADDR FOR DCB LOOKUP@G36XRNP 24505000
         LA    R3,AVTSAVE3+12           DUMMY OPCE ADDRESS     @G36XRNP 24508000
         L     R2,AVTOCGET              OP CTL AVT ADDRESS     @G36XRNP 24511000
         MVC   OPCDOUBL-IEDQOPCD(L8,R2),CKPBCKUP-IEDQCKPD(R8)  @G36XRNP 24514000
*                                       SET DDNAME FOR LOOKUP  @G36XRNP 24517000
         LA    R13,AVTSAVE4+12          SAVE AREA FOR LOOKUP   @G36XRNP 24520000
         L     R15,OPCTOFLK-IEDQOPCD(R2) GET DCB LOOKUP ADDR   @G36XRNP 24523000
         BALR  R14,R15                  LINK TO GET DCB ADDR   @G36XRNP 24526000
         B     PROCESS                  GOOD RETURN            @G36XRNP 24529000
         SR    R1,R1                    BAD RETURN             @G36XRNP 24532000
PROCESS  EQU   *                                               @G36XRNP 24535000
         LR    R2,R7                    RESTORE WORK AREA BASE @G36XRNP 24538000
         LM    R2,R15,CKPSAVE2          RESTORE REGISTERS      @G36XRNP 24541000
         LTR   R1,R1                    WAS DCB OPEN           @G36XRNP 24544000
         BZ    DEBLOOP                  NO, RETURN             @G36XRNP 24547000
         L     R1,TRMDESTQ-1-IEDQTRM(R1) GET QCB ADDRESS       @G36XRNP 24550000
         L     R1,QCBDCBAD-1-IEDQQCB(R1) GET DCB ADDRESS       @G36XRNP 24553000
         TM    DCBOFLGS-IHADCB(R1),DCBOFOPN IS DCB OPEN        @G36XRNP 24556000
         BZ    DEBLOOP                  NO, GET NEXT DEB       @G36XRNP 24559000
         LR    R1,R11                   RESTORE 3705 NCP DEV   @G36XRNP 24562000
*                                       DEP FIELDS ADDRESS     @G36XRNP 24565000
         MVC   NCPBKUPN(L8),CKPBCKUP-IEDQCKPD(R8) SET BACKUP   @G36XRNP 24568000
*                                       DDNAME                 @G36XRNP 24571000
         DROP  R1                                              @G36XRNP 24574000
         B     DEBLOOP                  AND RETURN             @G36XRNP 24577000
         DROP  R14                                             @G36XRNP 24580000
         DROP  R15                                             @G36XRNP 24583000
QND5750  EQU   *                                               @G36XRNP 24586000
         LA    R14,CKPINRNO             RECORDS ON FIRST TRACK @SA67132 25020061
         SR    R1,R1                    CLEAR FOR IC           @SA67132 25040061
         IC    R1,CKPINCNT              COUNT OF INCIDENTS     @SA67132 25060061
         BCTR  R1,R0                    DECREMENT INCIDENT     @ZA06155 25066009
*                                        COUNT BY ONE          @ZA06155 25072009
         L     R15,CKPTTRIN-1           FIRST RECORD ADDRESS   @SA67132 25080061
FINDLAST EQU   *                                               @SA67132 25100061
         BAL   R7,GETNEXT               GET NEXT RECORD ADDR   @SA67132 25120061
         LR    R15,R0                   SAVE RECORD ADDRESS    @SA67132 25140061
         BCT   R1,FINDLAST              RELOOP                 @SA67132 25160061
         ST    R0,AVTPARM               SAVE LAST RECORD ADDR+1@SA67132 25180061
         TM    CKPFLAGS,CKPOPCRD        CHECK FOR OP CONTROL   @OY19771 25180182
*                                       INCIDENT REC TO PROCESS@OY19771 25180282
         BZ    QND78                    BRANCH IF NO OPC       @OY19771 25180382
         NI    CKPFLAGS,X'FF'-CKPOPCRD  TURN OFF OPC BIT           0804 25200020
         MVC   CKPTRKLN,CKPSECLI        GET TRK DATA LENGTH 0416 S21101 25400000
         L     R0,CKPTTRLI-1            GET  TTR OF LAST INCIDENT  0814 25600020
         LA    R14,CKPIPERT             NO. OF INC RCDS ON FULL TRA0814 25800020
         CLC   CKPTTRIN(2),CKPTTRLI     CHECK FOR RCD ON 1ST TRACK 0814 26000020
         BNE   QND7605                  BRANCH IF NOT ON 1ST TRACK 0929 26200020
         LA    R14,CKPINRNO             NO. OF INC RCDS ON 1ST TRK 0814 26400020
         B     QND7605                  GET NEXT RCD               0925 26600020
         SPACE 3                                                        26800020
*CONVERT RELATIVE TTR TO ABSOLUTE DISK ADDRESS AND READ THE RECORD      27000020
*INCIDENT RECORD.                                                       27200020
         SPACE                                                          27400020
QND58    EQU   *                                                   0805 27600020
         C     R0,AVTPARM               CHECK FOR LAST RECORD  @SA67132 27650061
         BNL   LASTREC                  LAST RECORD ALREAD RD @SA67132  27700061
*                                        RESET TO FIRST RECORD @SA67132 27750061
         STM   R0,R14,CKPSAVE2          SAVE REGS                       27800020
         L     R15,16                   GET CVT                         28000020
         L     R15,28(0,R15)            GET CONVERSION ROUTINE          28200020
         LR    R3,R2                    SAVE WORK AREA BASE             28400020
         LM    R1,R2,CKPCPARM           GET DEB AND CONVERSN RESULT     28600020
         SLL   R0,8                     POSITION TTR                    28800020
         BALR  R14,R15                  BRANCH TO CONVERT ROUTINE       29000020
         LR    R2,R3                    RESTORE BASE               0716 29200020
         LM    R0,R14,CKPSAVE2          RESTORE REGS               0716 29400020
         LTR   R15,R15                  CHECK FOR END OF DATA SET       29600020
         BZ    QND59                    BRANCH IF NOT END OF DATAST0814 29800020
LASTREC  EQU   *                                               @SA67132 29830061
         NC    CKPTTRLI,CKPTTRLI        CHECK FOR LAST INC RCD-WRAP0925 29860020
         BZ    QND7603                  BRANCH IF WRAP REACHED   S99240 29920022
QND5805  EQU   *                                                   0814 30000020
         L     R15,CKPTTRIN-1           GET FIRST REC ADDR     @SA67132 30200061
         LA    R0,0(R15)                CLEAR HI ORDER BYTE    @SA67132 30300061
         LA    R14,CKPINRNO             NO. OF INC RCDS ON 1ST TRK 0814 30400020
         MVC   CKPTRKLN,CKPSECIN        TRK LN-1ST INC RCD  0416 S21101 30500000
         B     QND58                    READ RCD                   0814 30600020
         SPACE                                                          30800020
QND59    EQU   *                                                   0814 31000020
         CLI   CKPSETSC,CKPNOOP         CHECK FOR RPS FEATURE416 S21101 31010000
         BE    QND595                   BRANCH IF NOT PRESENT416 S21101 31020000
         LH    R0,CKPTRKLN              GET TRK DATA LENGTH 0416 S21101 31030000
         O     R0,QNDFLAG-2             SET FLAG FOR CNVRT  0507 S21101 31040000
         SLL   R0,CKP2BYTE              LOW ORDER HALF WORD 0416 S21101 31050000
         IC    R0,CKPIOR                GET RECORD NUMBER   0416 S21101 31060000
         L     R13,CKPCVTPT             GET CVT ADDRESS     0416 S21101 31070000
         L     R15,CKPCNSEC(,R13)       SECTOR CNVRT RTN AD 0416 S21101 31080000
         LR    R13,R2                   SAVE CKPT BASE      0416 S21101 31090000
         L     R2,CKPPARM2              UCB INDEX AND ADDR 0416 S21101  31100000
         BALR  R14,R15                  GET SECTOR ID       0416 S21101 31110000
         LR    R2,R13                   RESTORE CKPT BASE   0416 S21101 31120000
QND595   EQU   *                                            0416 S21101 31130000
         EXCP  CKPIOB                   START READ OPERATION            31200020
         SPACE                                                          31400020
         WAIT  ECB=CKPECB               WAIT FOR COMPLETION             31600020
         SPACE                                                          31800020
         LM    R0,R14,CKPSAVE2          RESTORE REGS                    32000020
         L     R11,CKPEXCP              GET ADDRESS OF RECORD           32200020
         TM    CKPECB,X7F               CHECK FOR DISK ERROR     S21903 32400005
         BO    QND60                    BRANCH IF NO ERROR         0804 32600020
         SPACE 3                                                        32800020
*DISK ERROR                                                             33000020
         SPACE                                                          33200020
         LR    R3,R0                    SAVE TTR                        33400020
         WTO   'IED085I CHECKPOINT DISK ERROR-INCIDENT RECORD IGNORED',X33600006
               ROUTCDE=11,DESC=4                                   0807 33800020
         LR    R0,R3                    RESTORE TTR                     34000020
         L     R3,AVTOCGET              GET OP CTL AVT ADDRESS   S99240 34200022
QND596   XC    CDRTTRLI,CDRTTRLI        ZERO LINK FIELD          S99240 34240022
         OI    CDRTTRLI+2,2             SET AS LAST SEGMENT      S99240 34280022
         B     QND66                    GO FREE PREVIOUS         S99240 34320022
*                                        CONTINUATION SEGMENTS   S99240 34360022
         SPACE 3                                                        34400020
*DETERMINE TYPE OF INCIDENT RECORD AND PROCESS                          34600020
         SPACE                                                          34800020
QND60    EQU   *                                                   0804 35000020
         USING IEDQCDRD,R11                                             35200020
         CLC   CDRDATE(8),CKPDATIM      COMPARE TIME OF INC., TOTAL     35400020
         BNH   QND77                    BRANCH IF INCIDENT NOT MORE0118X35700020
                                        RECENT THAN TOTAL               36000020
         TM    AVTBIT3,AVTSTAYN         CHECK FOR SCAN SPECIFIED   0118 36060020
         BO    QND76                    BRANCH IF SCAN NOT SPECIFIE0118 36120020
         CLI   CDRKEY,CDROPC            CHECK FOR OPERATOR CONTROL      36200020
         BNE   QND70                    BRANCH IF NOT OPERATOR CNTL0814 36400020
         SPACE 3                                                        36600020
*INCIDENT RECORD WAS A RESULT OF AN OPERATOR CONTROL COMMAND. SET       36800020
*UP THE INFO IN OP.CONTROL WORKAREA AND WAIT SO OP.CONTROL CAN          37000020
*REPROCESS THE COMMAND,UPDATING THE PROPER TABLES.  IF THE COMMAND      37200020
*IS START LINE OR STOP LINE THE PROCESSING HAS ALREADY BEEN DONE.       37400020
         SPACE                                                          37600020
         USING IEDQOPCD,R3              BASE FOR OP CTL AVT      S99240 37800022
         L     R3,AVTOCGET              ADDR OF OP CTL AVT       S99240 37830022
         SPACE 3                                                        37860022
*   ALL STOP OR START LINE OPERATOR CONTROL INCIDENT RECORDS WERE     * 37890022
*   PROCESSED DURING OPEN.  THE FOLLOWING CODE CHECKS FOR THESE       * 37920022
*   COMMANDS AND DOES NOT PASS THEM TO OPERATOR CONTROL, BUT          * 37950022
*   RETURNS TO READ THE NEXT INCIDENT RECORD.                         * 37980022
         SPACE 3                                                        38010022
         CLI   CDROPCB+CKPOCODE,OCSTOPL STOP LINE COMMAND        S99240 38040022
         BE    QND76                    YES, BRANCH              S99240 38070022
         CLI   CDROPCB+CKPOCODE,OCSTARTL START LINE COMMAND      S99240 38100022
         BE    QND76                    YES, BRANCH              S99240 38130022
         CLI   CDROPCB+CKPOCODE,OCVARY  VARY COMMAND             S99240 38160022
         BNE   QND6305                  NO, BRANCH               S99240 38190022
         CLI   CDROPCB+CKPOCSWC,OCX11   VARY OFFTP COMMAND       S99240 38220022
         BE    QND76                    YES, BRANCH              S99240 38250022
         CLI   CDROPCB+CKPOCSWC,OCX12   VARY OFFTP HALT COMMAND  S99240 38280022
         BE    QND76                    YES, BRANCH              S99240 38310022
         CLI   CDROPCB+CKPOCSWC,OCX18   VARY ONTP COMMAND        S99240 38340022
         BE    QND76                    YES, BRANCH              S99240 38370022
         SPACE 3                                                        38400022
QND6305  EQU   *                                                 S99240 38430022
         XC    CDRDATE(8),CDRDATE       ZERO LINK FIELD OF ELEM  S99240 38460022
         LR    R10,R0                   SAVE TTR                 S99240 38490022
         TM    CDRTTRLI+2,1             IS THIS A CONTINUATION   S99240 38520022
*                                        SEGMENT                 S99240 38550022
         BO    QND66                    YES, LINK INTO CHAIN     S99240 38580022
         ST    R11,OPCCOPCE             PUT ADDRESS OF ELEMENT INS99240 38610022
*                                        OPERATOR CONTROL AVT    S99240 38640022
QND64    TM    CDRTTRLI+2,2             IS THIS THE LAST SEGMENT S99240 38670022
*                                        OF THE COMMAND          S99240 38700022
         BZ    QND68                    NO, SET UP TO READ NEXT  S99240 38730022
*                                        CONTINUATION SEGMENT    S99240 38760022
         TM    CKPECB,X7F               CHECK FOR DISK ERROR     S21903 38790005
         BNO   QND65                    YES, FREE SEGMENTS       S99240 38820022
         OI    OPCSPEC,OPCRSTRT         SET RESTART BIT FOR OPC  S99240 38850022
         LA    R1,AVTOPCOB+4            ADDR OF  OPC CONTROL ECB        39200020
         POST  (1)                      POST OPC CONTROL COMPLETE       39600020
         SPACE                                                          39800020
         WAIT  ECB=AVTCKPTB+4           WAIT FOR UPDATE                 40000020
         MVI   AVTCKPTB+4,0             CLEAR ECB COMPLETION CODE  0827 40100020
         NI    OPCSPEC,OCFOXES-OPCRSTRT TURN OFF RESTART BIT     S99240 40200022
         SPACE 3                                                        40210022
QND65    MVC   CKPEXCP+1(3),OPCCOPCE+1  RESET I/O BUFFER ADDRESS S99240 40220022
         MVC   CKPRW+1(3),CKPEXCP+1     RESET READ COMMAND ADDR  S99240 40230022
         L     R11,OPCCOPCE             GET FIRST SEGMENT ADDRESSS99240 40240022
         MVC   OPCCOPCE+1(3),CDRTTRLI   REMOVE SEGMENT FROM CHAINS99240 40250022
QND6505  NI    OPCCOPCE+3,XFC           RESET LOW ORDER BITS     S21903 40260005
         LR    R0,R10                   RESTORE TTR              S99240 40270022
         OC    OPCCOPCE+1(3),OPCCOPCE+1 END OF CHAIN             S99240 40280022
         BZ    QND76                    YES, GO READ NEXT RECORD S99240 40290022
         LH    R1,CKPBPERR              LENGTH OF GETMAIN        S99240 40300022
         CH    R1,CKPINCLN              CHECK INCIDENT LENGTH    S99240 40310022
         BH    QND6506                  INCIDENT LENGTH LOW      S99240 40320022
         LH    R1,CKPINCLN              GET INCIDENT RECORD LEN  S99240 40330022
QND6506  EQU   *                                                 S99240 40340022
         CH    R1,CKPCKRLN              CHECK CKREQ LENGTH       S99240 40350022
         BH    QND6507                  CKREQ LENGTH LOW         S99240 40360022
         LH    R1,CKPCKRLN              USE CKREQ LENGTH         S99240 40370022
QND6507  EQU   *                                                 S99240 40380022
         ST    R1,CKPGETML              STORE IN FREEMAIN LIST   S99240 40390022
         LA    R1,OPCCOPCE              PUT ADDRESS OF AREA TO   S99240 40400022
         ST    R1,CKPGETML+4             FREE IN LIST            S99240 40410022
         L     R11,OPCCOPCE             RESET CURRENT OPCE PTR   S99240 40420022
         L     R11,CDRTTRLI-1           GET NEXT SEGMENT ADDRESS S99240 40430022
         LA    R11,0(R11)               CLEAR HIGH ORDER BYTE    S99240 40440022
         FREEMAIN E,MF=(E,CKPGETML),SP=0 FREE I/O BUFFER         S99240 40450022
         ST    R11,OPCCOPCE             UPDATE CURR SEGMENT PTR  S99240 40460022
         B     QND6505                  CHECK FOR MORE BUFFERS TOS99240 40470022
*                                        FREE                    S99240 40480022
         SPACE 2                                                        40490022
QND66    XC    CDRDATE(8),CDRDATE       CLEAR LINK FIELDS        S99240 40500022
         OC    OPCCOPCE+1(3),OPCCOPCE+1 HAS THIS FUNCTION BEEN   S99240 40510022
*                                        CANCELLED DUE TO A DISK S99240 40520022
*                                        I/O ERROR               S99240 40530022
         BZ    QND76                    YES, IGNORE CONTINUATION S99240 40540022
         LA    R1,OPCCOPCE-8            SET UP FOR FIRST TIME    S99240 40550022
         DROP  R11                      SET UP NEW               S99240 40560022
         USING IEDQCDRD,R1                USING STATEMENT        S99240 40570022
QND67    L     R1,CDRTTRLI-1            GET NEXT SEGMENT ADDRESS S99240 40580022
         OC    CDRTTRLI,CDRTTRLI        CHECK FOR LAST SEGMENT   S99240 40590022
         BNZ   QND67                    NOT LAST, RELOOP         S99240 40600022
         ST    R11,CDRTTRLI-1           LINK THIS SEGMENT AS LASTS99240 40610022
         DROP  R1                       REVERT TO                S99240 40620022
         USING IEDQCDRD,R11               OLD USING STATEMENT    S99240 40630022
         NI    CDRTTRLI+2,XFE           TURN-OFF CONTINUATION    S21903 40640005
*                                        SEGMENT IDENTIFIER      S99240 40650022
         B     QND64                    GO CHECK FOR LAST SEGMENTS99240 40660022
         SPACE 3                                                        40800020
QND68    EQU   *                                                 S99240 40808022
         LH    R1,CKPBPERR              LENGTH OF GETMAIN        S99240 40816022
         CH    R1,CKPINCLN              CHECK INCIDENT LENGTH    S99240 40824022
         BH    QND6803                  INCIDENT LENGTH LOW      S99240 40832022
         LH    R1,CKPINCLN              GET INCIDENT RECORD LEN  S99240 40840022
QND6803  EQU   *                                                 S99240 40848022
         CH    R1,CKPCKRLN              CHECK CKREQ LENGTH       S99240 40856022
         BH    QND6808                  CKREQ LENGTH LOW         S99240 40864022
         LH    R1,CKPCKRLN              USE CKREQ LENGTH         S99240 40872022
QND6808  EQU   *                                                 S99240 40880022
         ST    R1,CKPGETML              STORE IN GETMAIN PARM LSTS99240 40888022
         LA    R1,CKPEXCP               SET FOR GETMAIN TO PUT   S99240 40896022
*                                        ADDR OF AREA IN CKPEXCP S99240 40904022
         ST    R1,CKPGETML+4            STORE IN PARM LIST       S99240 40912022
         GETMAIN EC,MF=(E,CKPGETML),SP=0 GET CORE FOR CONTINUED  S99240 40920022
         LTR   R15,R15                  WAS CORE AVAILABLE       S99240 40928022
         BNZ   QND69                    NO, PRINT NO CORE MESSAGES99240 40936022
         MVC   CKPRW+1(3),CKPEXCP+1     SET ADDRESS IN READ CCW  S99240 40944022
         LR    R0,R10                   RESTORE TTR              S99240 40952022
         B     QND76                    AND READ NEXT RECORD     S99240 40960022
QND69    WTO   'IED010I CHECKPOINT-INSUFFICIENT CORE-INCIDENT RECORD IGX40968022
               NORED',ROUTCDE=11,DESC=4                          S99240 40976022
         B     QND65                    FREE PREVIOUS SEGMENTS   S99240 40984022
         SPACE 3                                                        40992022
*INCIDENT RECORD WAS THE RESULT OF A MH MACRO OR A TCHNG MACRO.         41000020
         SPACE                                                          41200020
QND70    EQU   *                                                   0814 41400020
         USING IEDQTRM,RTERM                                            41600020
         LH    R1,CDROFFS               GET TERMNAME OFFSET             41800020
         L     R15,AVTRNMPT                                             42000020
         STM   R14,R1,CKPSAVE2          SAVE REGS                       42200020
         N     R1,AVTCLRHI              CLEAR HIGH ORDER HALF WORD      42400020
         BALR  R14,R15                  GET TERM ENTRY                  42600020
         USING IEDQTRM,RTERM                                       0629 42800020
         LR    RTERM,R1                 BASE FOR TERM ENTRY             43000020
         LM    R14,R1,CKPSAVE2          RESTORE REGS                    43200020
         MVC   TRMSTATE,CDRSTAT         UPDATE TERM STATUS FIELD        43400020
         SPACE 3                                                        43600020
*UPDATE OPTION FIELDS FOR THIS TERMINAL ENTRY.(REGISTERS BEING USED     43800020
*AT THIS TIME ARE 0,2,8,9,11,12,14THIS OPTION TABLE SUBROUTINE USES     44000020
*1,3,4,5,6,7,10,13,15).                                                 44200020
         SPACE                                                          44400020
         LR    R10,R11                  SAVE REGISTER          @OY20722 44430082
         TM    TRMSTATE,TRMOPTFN        ARE THERE OPTIONS        A42401 44460021
         BNO   QND7502                  BRANCH IF NOT          @OZ26495 44520082
         SR    R6,R6                    INITIALIZE INDEX REG            44600020
         SR    R7,R7                                                    44800020
         IC    R7,TRMOPNO               COMPARAND-NO. OPTIONENTRIES     45000020
         L     R5,AVTOPTPT              ADDR OF OPTION TABLE            45200020
         L     R4,4(0,R5)               ADDR OF OPTION LENGTH TABLE     45400020
         LH    R1,TRMOPTBL              OFFST TO OPT FOR THIS ENTRY     45600020
         N     R1,AVTCLRHI              CLEAR HIGH ORDER HALF WORD      45800020
         AR    R5,R1                    ADD OFFST TO OPT TABLE ADDR     46000020
         SR    R1,R1                    CLEAR                           46200020
         SR    R3,R3                    CLEAR LENGTH FOR MOVE           46400020
         SPACE 3                                                        46600020
*BEGINNING OF LOOP THROUGH OPTION TABLE OFFSETS FOR THIS TERMINAL       46800020
         SPACE                                                          47000020
QND74    EQU   *                                                   0814 47200020
         LR    R15,R5                   INITIALIZE BEG OPTN ENTRIES     47400020
         IC    R1,TRMOPT(R6)            OPTION OFFSET                   47600020
         CH    R1,QMGNOPT               CHECK FOR UNUSED FIELD          47800020
         BE    QND75                    BRANCH IF UNUSED           0814 48000020
         AR    R15,R1                   ADDR OF OPTION ENTRY            48200020
         IC    R3,0(R4)                 GET LNGTH OF THIS OPT ENTRY    X48400020
                                        (1 HAS ALREADY BEEN SUB-       X48600020
                                        TRACTED FOR EXECUTE)            48800020
         CLI   L1(R4),XD0               CHECK OPTION TYPE        S21903 48830005
         BH    QND7405                  BRANCH IF NOT ADDRESS TYPE 0115 48860020
         CLI   L1(R4),X80               CHECK OPTION TYPE        S21903 48890005
         BH    QND75                    BRANCH IF ADDRESS TYPE     0115 48920020
QND7405  EQU   *                                                   0115 48950020
         EX    R3,QNDMOVE1              MOVE OPTIONS TO OPTION TABL0814 49000020
         LA    R11,1(R3,R11)            ADD LENGTH MOVED TO BASE OF    X49200020
                                        DISK RECORD                     49400020
QND75    EQU   *                                                   0814 49600020
         LA    R4,CKPOPLTL(0,R4)        MOVE TO NEXT OPTION LENGTH     X49800020
                                        TABLE ENTRY                     50000020
         LA    R6,1(,R6)                ADD 1 TO INDEX                  50200020
         BCT   R7,QND74                 SUB 1 FROM NO. OF ENTRIES  0814 50400020
         SPACE                                                          50600020
*END OF LOOP THROUGH OPTION TABLE OFFSETS                               50800020
         SPACE 3                                               @OZ26495 50806082
QND7502  EQU   *                                               @OZ26495 50812082
         CLI   CDRKEY-IEDQCDRD(R10),CDRLCB INCIDENT RECORD FOR @OY20722 50813082
*                                        MH MACRO              @OY20722 50814082
         BE    QND76                    YES, BRANCH            @OY20722 50815082
         TM    TRMDEVFL,X60             DIAL DIGITS/ADDR CHAR? @OZ26495 50818082
         BZ    QND76                    NO, BRANCH             @OZ26495 50824082
         SR    R3,R3                    CLEAR REG              @OZ26495 50830082
         LA    R11,SIXTEN(R11)          START OF DEVICE FIELDS @OZ26495 50836082
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS USED     @OZ26495 50842082
         BNO   NOOPTS                   NO, BRANCH             @OZ26495 50848082
         LA    R15,TRMOPT               START OF OPTIONS       @OZ26495 50854082
         IC    R3,TRMOPNO               NUMBER OF OPTIONS      @OZ26495 50860082
         LA    R15,0(R3,R15)            START OF DEVICE FIELDS @OZ26495 50866082
*                                        IN TERMINAL ENTRY     @OZ26495 50872082
         B     CKBUF                    CHECK DEVICE FIELDS    @OZ26495 50878082
NOOPTS   EQU   *                                               @OZ26495 50884082
         LA    R15,TRMOPNO              START OF DEVICE FIELDS @OZ26495 50890082
CKBUF    EQU   *                                               @OZ26495 50896082
         TM    TRMDEVFL,X80             BUFSIZE SPECIFIED      @OZ26495 50902082
         BNO   CKDIAL                   NO, BRANCH             @OZ26495 50908082
         A     R15,ADD3                 BUMP PAST BUFSIZE      @OZ26495 50914082
CKDIAL   EQU   *                                               @OZ26495 50920082
         TM    TRMDEVFL,X40             DIAL DIGITS SPECIFIED  @OZ26495 50926082
         BNO   CKADDR                   NO, BRANCH             @OZ26495 50932082
         IC    R3,0(R11)                LENGTH OF DIAL DIGITS  @OZ26495 50938082
         EX    R3,QNDMOVE2              UPDATE DIAL DIGITS     @OZ26495 50944082
         LA    R15,ONE(R3,R15)          BUMP PAST DIAL DIGITS  @OZ26495 50950082
         LA    R11,ONE(R3,R11)          BUMP PAST DIAL DIGITS  @OZ26495 50956082
CKADDR   EQU   *                                               @OZ26495 50962082
         TM    TRMDEVFL,X20             ADDR CHAR SPECIFIED    @OZ26495 50968082
         BNO   QND76                    NO, BRANCH             @OZ26495 50974082
         IC    R3,0(R11)                LENGTH OF ADDR CHAR    @OZ26495 50980082
         EX    R3,QNDMOVE2              UPDATE ADDR CHAR       @OZ26495 50986082
         SPACE 3                                                        51000020
*DETERMINE RELATIVE TTR OF NEXT CKREQ OR INCIDENT RECORD                51400020
         SPACE                                                          51600020
QND76    EQU   *                                                   0814 51800020
         IC    R15,CKPINCNO             GET COUNT OF AVAILABLE INC 0118 51810020
         BCTR  R15,0                    SUBTRACT 1 FROM COUNT      0118 51820020
         STC   R15,CKPINCNO             RESTORE COUNT IN CONTROL RD0118 51830020
         ST    R0,CKPTRMAD              STORE TTR                  0118 51860020
         CLC   CKPTRMAD+1(3),CKPTTRLI   CHECK FOR LAST INC RCD USED0118 51890020
         BNE   QND7605                  BRANCH NOT LAST          S99240 51920022
QND7603  EQU   *                                                 S99240 51923022
         L     R3,AVTOCGET              GET OP CTL AVT ADDRESS   S99240 51926022
         OC    OPCCOPCE+1(3),OPCCOPCE+1 ANY PARTIAL OP CONTROL   S99240 51929022
*                                        INCIDENT RECORDS        S99240 51932022
         BZ    QND78                    NO, BRANCH               S99240 51935022
         LR    R10,R0                   SAVE TTR                 S99240 51938022
         IC    R15,CKPINCNO             GET COUNT OF AVAILABLE   S99240 51941022
         LA    R15,1(R15)               ADD ONE - WILL BE        S99240 51944022
*                                        SUBTRACTED LATER        S99240 51947022
         STC   R15,CKPINCNO             RESTORE COUNT            S99240 51950022
         MVI   CKPECB,X41               SET-LOOK LIKE DISK ERROR S21903 51953005
         B     QND596                   GO FREE INCIDENT SEGMENTSS99240 51956022
QND7605  EQU   *                                                   0925 51960020
         LH    R15,CKPTRKLN             GET TRK DATA LENGTH 0416 S21101 51970000
         AH    R15,CKPINCLN             ADD LN OF RCD WRITTN0416 S21101 51980000
         STH   R15,CKPTRKLN             RESTORE DATA LENGTH 0416 S21101 51990000
         LR    R15,R0                                                   52000020
         LA    R15,0(,R15)              CLEAR HIGH ORDER BYTE      0817 52200020
         LTR   R15,R15                  CHECK FOR 1ST INC RCD      0826 52400020
         BZ    QND5805                  BRANCH IF 1ST RCDSHOULD BE 0826X52600020
                                        READ                            52800020
         LA    R7,QND58                 SET RETURN ADDRESS     @SA67132 52860061
GETNEXT  EQU   *                                               @SA67132 52920061
         LA    R0,1(0,R15)              GET NEXT RCD ON TRACK           53000020
         EX    R15,QNDCOMPR             CHECK FORLAST RCD ON TRACK 0814 53200020
         BHR   R7                       BR IF NOT END OF TRK   @OY19771 53400082
         LA    R0,CKP101(0,R15)         GET NEXT TRACK                  53600020
         IC    R0,QMGONE                INITIALIZE TO 1ST RECORD        53800020
         LA    R14,CKPIPERT             RCD NO-LAST RCD ON TRACK   0814 54000020
         XC    CKPTRKLN,CKPTRKLN        INITIALIZE DATA LN  0416 S21101 54050000
         BR    R7                       READ NEXT RECORD       @SA67132 54100061
QND77    EQU   *                                                   0118 54200020
         MVC   CKPTTRLI(3),CKPTRMAD+1   UPDATE LAST INC RCD USED   0118 54300020
         ST    R0,CKPTRMAD              STORE TTR                  0118 54400020
         CLC   CKPTRMAD+1(3),CKPTTRIN   CHECK FOR FIRST INC RCD  S99240 54500022
         BNE   QND7603                  BRANCH NOT FIRST         S99240 54600022
         XC    CKPTTRLI,CKPTTRLI        INDICATE 1ST RCD           0118 54700020
         SPACE 3                                                        55000020
*ATTACH CHECKPOINT EXECUTOR-IEDQNF                                      55200020
         SPACE                                                          55400020
QND78    EQU   *                                                   0803 55600020
         LA    R1,CKPEXCP               PTR TO ADDR OF AREA 0405 S21101 55660000
         SR    R3,R3                    CLEAR REGISTER         @ZA06155 55662009
         L     R15,CKPTTRLI-1           PICK UP LAST INCIDENT  @ZA06155 55664009
         LA    R15,ZERO(R15)            CLEAR HIGH BYTE        @ZA06155 55666009
         LTR   R15,R15                  END OF DATA SET        @ZA06155 55668009
         BZ    ENDDATA                  YES, BRANCH            @ZA06155 55670009
         LA    R14,CKPIPERT             NUMBER OF INCIDENTS    @ZA06155 55672009
*                                        PER TRACK             @ZA06155 55674009
         CLC   CKPTTRIN(2),CKPTTRLI     IS LAST INCIDENT ON    @ZA06155 55676009
*                                        FIRST TRACK           @ZA06155 55678009
         BNE   GETREC                   NO, BRANCH             @ZA06155 55680009
         LA    R14,CKPINRNO             NUMBER OF INCIDENTS ON @ZA06155 55682009
*                                       FIRST TRACK            @ZA06155 55684009
GETREC    EQU  *                                               @ZA06155 55686009
         BAL   R7,GETNEXT               GET NEXT RECORD        @ZA06155 55688009
         LR    R15,R0                   SET REGISTER 15        @ZA06155 55690009
         C     R0,AVTPARM               AT END OF INCIDENTS    @ZA06155 55694009
         BNL   SETCOUNT                 NO, BRANCH             @ZA06155 55696009
         LA    R3,ONE(R3)               INCREMENT COUNT        @OY19771 55696182
         B     GETREC                   GET RECORD             @ZA06155 55698009
SETCOUNT  EQU  *                                               @ZA06155 55700009
         STC   R3,CKPINCNO              STORE INCIDENT COUNT   @ZA06155 55702009
*                                        REMAINING             @ZA06155 55704009
         B     QND7801                  ATTACH CHECKPOINT      @ZA06155 55706009
ENDDATA   EQU  *                                               @ZA06155 55708009
         MVC   CKPINCNO,CKPINCNT        SET AVAILABLE EQUAL    @ZA06155 55710009
*                                        TOTAL                 @ZA06155 55712009
QND7801  EQU   *                                               @ZA06155 55714009
         ST    R1,CKPGETML+4            PUT PTR IN PARM LIST0405 S21101 55720000
         LH    R1,CKPBPERR              LENGTH OF GETMAIN               55800020
         CH    R1,CKPINCLN              CHECK LENGTH OF INC 0405 S21101 55820000
         BH    QND7803                  BRANCH IF INC IS LOW0405 S21101 55840000
         LH    R1,CKPINCLN              USE INCIDENT LENGTH 0405 S21101 55860000
QND7803  EQU   *                                            0405 S21101 55880000
         CH    R1,CKPCKRLN              CHECK LENGTH OF CKREQ405 S21101 55900000
         BH    QND7806                  BRANCH IF CKREQ LOW 0405 S21101 55920000
         LH    R1,CKPCKRLN              USE CKREQ LN FOR FREE405 S21101 55940000
QND7806  EQU   *                                            0405 S21101 55960000
         ST    R1,CKPGETML                                              56000020
         FREEMAIN E,MF=(E,CKPGETML),SP=0 FREE I/O BUFFER           0806 56200020
         XC    CKPECB(CKPCTTRB-CKPECB),CKPECB  CLEAR WORK AREA USED    X56400020
                                        BY OPEN MODULES                 56600020
QND79    EQU   *                                                   0804 56800020
         TM    AVTCKFLG,AVTCKTAC+AVTCKNAC EITHER CHECK ACTIVE @ZM46597  56860000
         BZ    QND80                    NO BYPASS SET UP      @ZM46597  56920000
         LA    R3,AVTCKECA              ADDRESS OF CHECKPT ECB          57000020
         L     R4,AVTCLOSB+8            ADDRESS OF IEDQNA               57200020
         LA    R4,6(,R4)                ADDRESS OF IEDQNA3              57400020
         LR    R1,R13                   PASS ADDR OF AVT TO IEDQNF 0115 57500020
*                                       ATTACH CHECK-POINT EXECUTOR     57520020
         TM    AVTBIT1,AVTTSON          IS TIME SHARING ACTIVE          57540020
         BO    QND7905                  BRANCH ON YES                   57560020
         ATTACH ECB=(3),ETXR=(4),SF=(E,CKPTLIST)                        57580020
         B     QND7910                  BRANCH AROUND TSO ATTACH S22025 57600022
QND7905  EQU   *                                                        57620020
         L     R6,AVTTSOPT              ADDRESS OF TIME SHARING QCB     57640020
         L     R6,TSISTAE-IEDQTSI(,R6)  ADDRESS OF STAE ROUTINE         57660020
         LA    R6,4(,R6)                ADDRESS OF STAI ENTRY POINT     57680020
         ATTACH ECB=(3),ETXR=(4),STAI=((6)),SF=(E,CKPTLIST)             57700020
QND7910  EQU   *                                                        57720020
         ST    R1,AVTCKTCB              ADDRESS OF CHECKPOINT TCB       57800020
         SPACE 3                                                        59400020
*CHECK FOR OPERATOR AWARENESS ROUTINE AND LOAD IF NECESSARY        1002 59600020
         SPACE                                                          60000020
QND80    EQU   *                                                        60200020
         LH    R1,AVTOPCON              PRIMARY OP CONSOLE         0815 60400020
         LTR   R1,R1                    CHECK FOR SYSCON           0815 60600020
         BZ    QND8005                  BRANCH IF SYSCON           0815 60800020
         L     R1,AVTNX                 GET ADDR OF OPAR RTN       0815 61000020
         LTR   R1,R1                    CHECK FOR RTN              0815 61200020
         BNZ   QND8005                  BRANCH IF ALREADY LOADED   0815 61400020
         LOAD  EP=IEDQNX                LOAD OPAR RTN              0815 61600020
         ST    R0,AVTNX                 SAVE ENTRY POINT ADDRESS   0815 61800020
         SPACE 2                                                        61801022
* CHECK FOR ON-LINE TEST SPECIFIED ON INTRO                      S99528 61802022
         SPACE 1                                                        61803022
QND8005  EQU   *                                                 S99528 61804022
         CLI   AVTOLTST,ZERO            CHECK OLTEST OPERAND     S99528 61805022
         BNE   QND30                    BRANCH IF SPECIFIED      S99528 61806022
         MVI   AVTOLECA,X40             POST COMPLETION ECB SINCES99528 61807022
*                                       OLT WILL NEVER TERMINATE S99528 61808022
         B     QND80055                 CHECK TIME DELAY QUEUE   S99528 61809022
         SPACE 2                                                        61810022
* CHECK FOR SUFFICIENT CORE                                      S99528 61811022
         SPACE 1                                                        61812022
QND30    EQU   *                                                 S99528 61813022
         GETMAIN R,LV=18432             UNCONDITIONAL GETMAIN    S05331*61814052
                                         FOR MINIMUM AMOUNT      S22024 61815022
         FREEMAIN R,LV=18432,A=(1)      FREE THE CORE            S05331 61816052
         SR    R2,R2                    CLEAR REG 2              S99528 61817022
         IC    R2,AVTOLTST              GET NO. BLOCKS OF CORE   S99528 61818022
         SLL   R2,TEN                   MULTIPLY BY 1024         S99528 61819022
         SPACE 1                                                        61820022
         GETMAIN EC,LV=(R2),A=AVTDOUBL,MF=(E,AVTGETMN),SP=0      S99528 61821022
         LTR   R15,R15                  CHECK RETURN CODE        S99528 61822022
         BZ    QND50                    BRANCH IF CORE AVAILABLE S99528 61823022
         WTO   'IED094I CORE REQUESTED FOR ON-LINE TEST NOT AVAILABLE',X61824022
               ROUTCDE=10,DESC=4                                 S99528 61825022
         MVI   AVTOLTST,QNDOLTST        CHANGE OLT PARM TO 18K   S05331 61826052
         B     QND80055                 SKIP FREEMAIN            S99528 61827022
QND50    EQU   *                                                 S99528 61828022
         FREEMAIN E,MF=(E,AVTGETMN)      FREE UP AREA            S99528 61829022
         MVI   AVTGETMN+8,ECMODE        RESET MODE FIELD        SA63993 61839051
         SPACE 3                                                        61850020
*PUT DESTINATION QCBS ON TIME DELAY QUEUE IF NECESSARY                  61900020
         SPACE                                                          61950020
QND80055 EQU   *                                                 S99528 62000022
         DROP  R8                       CHANGE BASE FOR TERM ENTRY 0819 64000020
         L     R11,AVTEA                ADDRESS OF DISPATCHER           64200020
         LA    R13,AVTSAVE3             USE SAVE 3                      64400020
         USING AVTSAVE3,R13                                             64600020
         SR    R2,R2                    CLEAR FOR TNT LOOP              64800020
         ST    R2,AVTDOUBL              SET END OF QCB CHAIN            65000020
         L     R15,AVTRNMPT             TERMINAL NAME TABLE             65200020
         USING IEDQTNTD,R15                                             65400020
         LH    R7,TNTLEN                NUMBER OF TTABLE ENTRIES        65600020
         N     R7,AVTCLRHI              CLEAR HIGH ORDER HALF           65800020
         BAL   R14,QND81                ENTER LOOP AND SET RETURN       66000020
*                                                                       66200020
         USING IEDQTRM,R1                                               66400020
         TM    TRMSTATE,TRMSNGLE        TPROCESS, LIST, LOG,   @G36XRNP 66600000
*                                       LINE OR GROUP ENTRY?   @G36XRNP 66700000
         BNZ   QND81                    BRANCH NO                       66800020
         TM    TRMSTATE,TRMPREF         NCP ATTACHED TERMINAL  @G36XRNP 67080000
         BO    QND81                    BR YES                   X03039 67100008
*                                                                X03039 67120008
         L     R4,TRMDESTQ-1            QCB ADDRESS                     67200020
         USING IEDQQCB,R4                                               67400020
         CLI   QCBSTPRI,X70             INTVL OPTION             S22026 67600022
         BNE   QND80058                 BRANCH IF NO           @OY12667 67650091
         CLC   QCBMSGCT(2),AVTFZERO     ANY MSGS QUEUED        @OY12667 67660091
         BNE   QND81                    YES, DONT CHAIN QCB    @OY12667 67670091
         B     QND8006                  NO, CONTINUE           @OY12667 67680091
QND80058 EQU   *                                               @OY12667 67690091
         CLI   QCBSTPRI,X80             CLOCK OPTION             S22026 67700022
         BNE   QND81                    BRANCH IF NO             S22026 67750022
* IF THIS IS NOT CLOCK OR CINTVL BYPASS PROCESSING             @G36XRNP 67760000
         CLI   QCBSTPRI,QCBCNTVL        CLOCK/CINTVL           @G36XRNP 67770000
         BL    QND81                    BRANCH NO              @G36XRNP 67780000
QND8006  EQU   *                                                 S22026 67800022
*                                                                       68000020
         NC    QCBINTVL,QCBINTVL        DIAL-UP READ ONLY      @OY14058 68060091
         BZ    QND81                    BYPASS DELAY Q         @OY14058 68120091
         TM    QCBINSRC+2,QCBDELAY      QCB SERVICED PREVIOUSLY         68200020
         BO    QND81                    BRANCH YES - TRY NEXT           68400020
         L     R3,QCBDCBAD-1            DCB ADDRESS                     68600020
         USING IHADCB,R3                                                68800020
         TM    DCBOFLGS,X10             IS DCB OPEN                     69000020
         BZ    QND81                    BRANCH NO                       69200020
         L     R1,DCBDEBAD              ADDRESS OF DEB          SA63007 69210005
         CLC   DEBNMEXT-DEBNMSUB(ONE,R1),QCBRELLN IS RLN VALID  SA63007 69220005
         BL    QND81                    BRANCH ON NO            SA63007 69230005
         SR    R1,R1                    CLEAR REGISTER          SA63007 69240005
         IC    R1,QCBRELLN              PICK UP RELATIVE LINE   SA63007 69250005
         BCTR  R1,ZERO                  DECREMENT BY ONE        SA63007 69260005
         SLL   R1,TWO                   MULTIPLY BY FOUR        SA63007 69270005
         A     R1,DCBDEBAD              ADD DEB ADDRESS         SA63007 69280005
*                                       IS ENTRY DD DUMMY       SA63007 69290005
         CLC   DEBUCBAD-DEBNMSUB+1(THREE,R1),AVTFZERO           SA63007 69300005
         BE    QND81                    BRANCH ON YES           SA63007 69310005
*                                                                       69400020
         OI    QCBINSRC+2,QCBDELAY      SET PREVIOUSLY SERVICED FLAG    69600020
         MVC   QCBELCHN,AVTDOUBL+1      SET LINK FIELD FOR NEXT LOOP    69800020
         MVC   QCBSTCHN(3),QCBSLINK     FIX SCHEDULER                   70000020
         ST    R4,AVTDOUBL              SET FOR NEXT LINK               70200020
QND81    EQU   *                                                        70400020
         LA    R2,ONE(,R2)              ADD ONE TO NEXT ENTRY           70600020
         LR    R1,R2                    TO INPUT REG FOR TNT            70800020
         CLR   R7,R2                    COMPARE TOTAL TO THIS ENTRY     71000020
         BCR   LOWEQ,R15                BR IF TOTAL IS HIGH     SA59006 71200022
*                                                                       71400020
         DROP  R15                                                      71600020
         BALR  R14,0                    SET RETURN AND BEGIN SEARCH     71800020
         L     R1,AVTDOUBL              FIRST QCB TO ENTER DELAY        72000020
         LA    R1,0(,R1)                CLEAR HIGH ORDER                72200020
         LTR   R1,R1                    ANY TO SERVICE                  72400020
         BZ    QND84                    BRANCH NO - EXIT           0803 72600020
*                                                                       72800020
         DROP  R4                                                       73000020
         USING IEDQQCB,R1                                               73200020
         L     R4,QCBELCHN-1            NEXT ELEMENT                    73400020
         MVC   QCBELCHN,AVTDOUBL+1      SET TO POINT TO ITSELF          73600020
         ST    R4,AVTDOUBL              NEXT ELEMENT                    73800020
         LH    R4,QCBINTVL              DELAY IN SECONDS                74000020
         N     R4,AVTCLRHI              CLEAR HIGH ORDER HALF           74200020
         CLI   QCBSTPRI,X70             DIAL UP OPTIONS=INTVL           74400020
         BE    QND82                    YES, INTVL OK                   74600091
*                                                                       74800020
         AR    R4,R4                    DOUBLE                          75000020
*              ORIGINAL DELAY FOR CLOCK WAS DIVIDED BY  2 AT            75200020
*              ASSEMBLY TIME.  MUST BE RESTORED FOR TIME DELAY          75400020
         LR    R3,R1                    SAVE QVB ADDRESS                75600020
*                                       GET TIME OF DAY                 75800020
         TIME  BIN                                                      76000020
         SRDL  R0,HALF                  SHIFT TIME TO R1                76200020
         D     R0,HUND                  CONVERT TO SECONDS              76400020
*              RESULT IS IN R0 + 1                                      76600020
         N     R1,CLRMASK               CLEAR UNNEEDED BITS             76800020
         CLR   R1,R4                    TIME OF DAY TO CLOCK REQUEST    77000020
         BL    SAMEDAY                  BRANCH IF INTERRUPT IS TODAY    77200020
*                                                                       77400020
         A     R4,TW24HRS               ADD 24 HOURS                    77600020
SAMEDAY  EQU   *                                                        77800020
         SR    R4,R1                    GET DIFFERENCE                  78000020
         LR    R1,R3                    RESTORE QCB ADDRESS             78200020
QND82    EQU   *                                                        78400020
         C     R4,TWLVE                 IS DELAY GREATER THAN 12 HOURS  78600020
         BL    QND83                    BRANCH NO                       78800020
*                                                                       79000020
         S     R4,TWLVE                 DECREMENT BY 12 HOURS           79200020
         OI    QCBSTAT,QCBTIME          SET FLAG FOR TIME DELAY         79400020
QND83    EQU   *                                                        79600020
         STH   R4,QCBEOLDT              SET DELAY REQUES                79800020
         MVI   QCBLKRLN,0               SET FLAG INDICATING ELEMENT     80000020
         MVI   QCBPRI,PRIEDISP          SET PRIORITY FOR POST BY HG     80200020
*                                       IS A QCB                        80400020
         L     R15,AVTHG01              TIME DELAY SUBROUTINE ADDRESS   80600020
         BR    R15                      INSERT ELEMENT ON TIME DELAY Q  80800020
*                                                                       81000020
QND84    EQU   *                                                   0803 81200020
         SPACE                                                          81200300
* IF NOT EP ONLY LINK TO IEDIAB TO BUILD SAT,NAT,RVT AND       @G36XRNP 81200600
* PLCB AND SIB POOLS.                                          @G36XRNP 81200900
         SPACE                                                          81201200
         L     R13,AVTBASE              BASE ON AVTSAVE1       @G36XRNP 81201500
         USING IEDQAVTD,R13                                    @G36XRNP 81201800
         TM    AVTSAVTF,AVTVTMCP        EP ONLY?               @G36XRNP 81202100
         BZ    QNDEXIT                  BRANCH YES             @G36XRNP 81202400
         LINK  EP=IEDIAB                IEDIAB                 @G36XRNP 81202700
         L     R3,AVTOCGET              OP CTL AVT BASE        @G36XRNP 81203000
         USING IEDQOPCD,R3              OP CTL AVT BASE        @G36XRNP 81203300
         SPACE                                                          81203600
* IF RESTART INDICATED LINK TO IGCFD10D TO DELINK RESOURCE     @G36XRNP 81203900
* HIERARCHIES IN TERMINAL TABLE.                               @G36XRNP 81204200
         SPACE                                                          81204500
         TM    AVTBIT2,AVTSTRTN         RESTART?               @G36XRNP 81204800
         BZ    QNDEXIT                  BRANCH IF NOT          @G36XRNP 81205100
         OI    OPCSPEC,OPCRSTRT         INDICATE RESTART FOR   @G36XRNP 81205400
*                                       FOR DEACTIVATE.        @G36XRNP 81205700
         LA    R13,AVTSAVE3             SET REG 13 TO SAVE AREA@G36XRNP 81206000
         USING AVTSAVE3,R13             ADDRESSIBLITY          @G36XRNP 81206300
         LINK  EP=IGCFD10D              IGCFD10D               @G36XRNP 81206600
         L     R13,AVTBASE              RESTORE AVT BASE       @G36XRNP 81206900
         USING IEDQAVTD,R13             ADDRESSIBLITY          @G36XRNP 81207200
         NI    OPCSPEC,255-OPCRSTRT     TURN OFF RESTART FLAG. @G36XRNP 81207500
         B     QNDEXIT                  EXIT                   @G36XRNP 81207800
         EJECT                                                          81208100
************************************************************** @G36XRNP 81208400
*        THE PURPOSE OF THIS ROUTINE IS TO FIND THE NCP TTE  * @G36XRNP 81208700
*        ADDRESS FOR A PARTICULAR 3705.                      * @G36XRNP 81209000
*                                                            * @G36XRNP 81209300
*        INPUT - REG 1 = 3705 DCB ADDRESS                    * @G36XRNP 81209600
*                REG 7 = RETURN ADDRESS                      * @G36XRNP 81209900
*                                                            * @G36XRNP 81210200
*        OUTPUT- REG 1 = 3705 NCP TTE ADDRESS                * @G36XRNP 81210500
*                                                            * @G36XRNP 81210800
************************************************************** @G36XRNP 81211100
QND90    EQU   *                                               @G36XRNP 81211400
         USING IHADCB,R1                SET ADDRESSABILITY     @G36XRNP 81211700
         USING IEDQLCB,R7               SET ADDRESSABILITY     @G36XRNP 81212000
         STM   R14,R12,CKPSAVE2         SAVE CALLER'S REG      @G36XRNP 81212300
         SLR   R7,R7                    CLEAR REG              @G36XRNP 81212600
         IC    R7,DCBEIOBX              GET LCB SIZE           @G36XRNP 81212900
         LA    R9,1                     SET RLN                @G36XRNP 81213200
         L     R11,DCBIOBAD             GET IOB ADDRESS        @G36XRNP 81213500
         MR    R6,R9                    GET LCB IOB OFFSET     @G36XRNP 81213800
         AR    R7,R11                   LCB IOB ADDRESS        @G36XRNP 81214100
         LA    R11,LCBPRFSZ             IOB OFFSET IN LCB      @G36XRNP 81214400
         SLR   R7,R11                   GET LCB ADDRESS        @G36XRNP 81214700
         LH    R1,LCBTTCIN              GET NCP TTCIN          @G36XRNP 81215000
         L     R15,AVTRNMPT             TTCIN TO TTE           @G36XRNP 81215300
*                                       CONVERSION ROUTINE     @G36XRNP 81215600
         BALR  R14,R15                  FIND 3705 NCP TTE ADDR @G36XRNP 81215900
*        REG 1 HAS 3705 NCP TTE ADDRESS                        @G36XRNP 81216200
         LM    R14,R0,CKPSAVE2          RESTORE REG 14-0       @G36XRNP 81216500
         LM    R2,R12,CKPSAVE2+DREG2    RESTORE REG 2-12       @G36XRNP 81216800
         BR    R7                       RETURN TO CALLER       @G36XRNP 81217100
         DROP  R1                                              @G36XRNP 81217400
         DROP  R7                                              @G36XRNP 81217700
         EJECT                                                          81218000
************************************************************** @G36XRNP 81218300
*                                                            * @G36XRNP 81218600
*        THE PURPOSE OF THIS ROUTINE IS TO FIND THE ADDRESS  * @G36XRNP 81218900
*        OF THE DEVICE DEPENDENT FIELDS OF A 3705 NCP        * @G36XRNP 81219200
*        TERMINAL ENTRY                                      * @G36XRNP 81219500
*                                                            * @G36XRNP 81219800
*        INPUT - REG 0 = MASK FOR DEVICE DEPENDENT FIELDS    * @G36XRNP 81220100
*                REG 1 = 3705 NCP TTE ADDRESS                * @G36XRNP 81220400
*                REG 7 = RETURN ADDRESS                      * @G36XRNP 81220700
*                                                            * @G36XRNP 81221000
*        OUTPUT- REG 1 = NCP DEVICE DEPENDENT FIELDS ADDRESS * @G36XRNP 81221300
*                                                            * @G36XRNP 81221600
************************************************************** @G36XRNP 81221900
QND95    EQU   *                                               @G36XRNP 81222200
         STM   R14,R12,CKPSAVE2         SAVE CALLER'S REG      @G36XRNP 81222500
         LR    R11,R13                  SAVE AVT ADDRESS       @G36XRNP 81222800
         L     R15,AVTDDFT              GET ADDRESS OF DEVICE  @G36XRNP 81223100
*                                       DEP LOOKUP ROUTINE     @G36XRNP 81223400
         LA    R13,CKPSAVE1             GET SAVE AREA ADDRESS  @G36XRNP 81223700
         BALR  R14,R15                  FIND ADDRESS OF NCP    @G36XRNP 81224000
*                                       DEVICE DEP FIELDS      @G36XRNP 81224300
         LR    R1,R15                   SAVE NCP DEVICE DEP    @G36XRNP 81224600
*                                       FIELDS ADDRESS         @G36XRNP 81224900
         LR    R13,R11                  RESTORE AVT ADDRESS    @G36XRNP 81225200
         LM    R14,R0,CKPSAVE2          RESTORE REG 14-0       @G36XRNP 81225500
         LM    R2,R12,CKPSAVE2+DREG2    RESTORE REG 2-12       @G36XRNP 81225800
         BR    R7                       RETURN TO CALLER       @G36XRNP 81226100
         EJECT                                                          81226400
QNDEXIT  EQU   *                                               @G36XRNP 81226700
         L     R1,CVTPTR                LOAD CVT ADDR            Y02027 81230006
         L     R1,CVTAQAVT-CVT(R1)      LOAD TCAM CVT EXTENSION  Y02027 81260006
         OI    TCXBIT1-IEDQTCX(R1),AVTREADN                      Y02027 81290006
*                                       MAP READY BIT FOR COMM   Y02027 81320006
*                                       TASK                     Y02027 81350006
         L     R13,AVTBASE              RESTORE AVT ADDRESS             81400020
         LM    R14,R12,12(R13)          RESTORE REGS                    81600020
         BR    R14                      RETURN TO READY                 81800020
         SPACE 3                                                        82000020
QMGONE   DC    X'1'                     USED TO INITIALIZE TO 1ST      X82200020
                                        RECORD ON TRACK                 82400020
         DS    0F                       FULLWORD            0507 S21101 82500000
QMGNOPT  DC    H'255'                   UNUSED OPTION FIELD INDICA      82600020
QNDFLAG  DC    X'8000'                  FLAG FOR SECTR CNVRT0507 S21101 82700000
QNDMOVE1 MVC   0(0,R15),CDROPTN         MOVE OPTION FIELD          0814 82800020
QNDMOVE2 MVC   0(0,R15),0(R11)          UPDATE DEVICE FIELDS   @OZ26495 82850082
ADD3     DC    F'3'                     CONSTANT               @OZ26495 82900082
QNDCOMPR CLI   0(R14),0                 CHECK FOR LAST RCD ON TRACK0814 83000020
         SPACE 3                                                        83200020
CKPTLIST ATTACH EP=IEDQNF,SF=L                                          83300020
TW24HRS  DC    F'86400'                 24 HOURS IN SECONDS             83400020
HUND     DC    F'100'                   CONVERT TIME TO SECONDS  S22025 83600022
TWLVE    DC    A(43200)                 TWELVE HOURS (IN SECONDS)       83800020
CLRMASK  DS    0F                                                       83860020
         DC    X'7FFFFFFF'              MASK TO CLEAR HIGH BIT   S22025 83920022
PATCH    DC    12F'0'                   PATCH AREA             @G36XRNP 84520000
         EJECT                                                          85200022
         TOPCAVTD                                                       85240022
         EJECT                                                          85280022
         TOPCED                                                         85320022
         EJECT                                                          85360022
         TCKPD 3330                     MERLIN VERSION      0510 S21101 85600000
         EJECT                                                          85750008
         TQCBD                                                          85800020
         EJECT                                                          86000022
         DCBD  DSORG=(TX,TR)                                     S22024 86040022
         EJECT                                                          86080022
         TDEBD                                                          86120022
         EJECT                                                          86130000
         TTCBD                                                 @G36XRNP 86140000
         EJECT                                                          86160022
         TLCBD                                                 @G36XRNP 86168000
         EJECT                                                          86176000
         TNCPID                                                @G36XRNP 86184000
         EJECT                                                          86192000
         TTNTD                                                          86200020
         EJECT                                                          86300008
         TTRMD                                                          86400020
         EJECT                                                          86500008
         TPRIOR                                                         86600020
         EJECT                                                          86700008
         TAVTD                                                          86800020
         EJECT                                                          86810008
         TTCXD                          DSECT                    Y02027 86830006
         EJECT                                                          86840008
         CVT   DSECT=YES                DSECT                    Y02027 86860006
         EJECT                                                          86880008
         TTSID                                                          86900020
         END                                                            87000020
