QNK      TITLE 'IEDQNK-BUILD ENVIRONMENT CHECKPOINT RECORD(S)'          00100005
IEDQNK   CSECT                                                          00200005
         SPACE 3                                                        00300005
*A000000-999999                                                @Y16X5C0 00350000
**************************** MICROFICHE FLAGS *************** SUPT CODE 00400005
*A576400-577600                                                 SA51078 00400205
*C226000,496000-498000                                          SA53610 00400305
*A697200,906000                                                  A47151 00400405
*C226000,700000-722000                                           A47151 00400505
*D210000                                                         A47151 00400605
*A736300-737500,906200-906400                                   SA57661 00400705
*A210000,612100-612300,905500                                   SA56611 00400805
*A789230-789350                                                 SA59171 00400905
*C016000,504000,529120,768000                                    S22024 00401005
*A616200-617400                                                  S22024 00401105
*A516001-516002,520001                                          SA59179 00401205
*A526000,592840,925500                                          SA58453 00401305
*C696330-696350                                                  Y06328 00401405
*A907600                                                         Y06328 00401505
*C526180                                                        SA66372 00501554
*C504000                                                        SA67099 00501654
*A509236                                                        SA67099 00501754
*A700000                                                       @XA05305 00501856
*C528720-528760                                                @YA05454 00501956
*A527350                                                       @SA75469 00502058
*C504000,596000,486000                                         @Y17XACT 00572000
*A529840,598000,692000,202000,517200,528160,896000,486000,     @Y17XACT 00612000
*A907600                                                       @Y17XACT 00652000
*D509536,616200-617400,696120-696390                           @Y17XACT 00712000
*A788400,788600                                                @Y17XACA 00732000
*C788600,788800,789000,789230,789320,789400,789600             @Y17XACA 00752000
*A320000,501000,504000,501700-503100,594000,782000,786500      @OX16402 00761000
*D468000-470000                                                @OX16402 00770000
*D529760-586000 COPIED TO STMT 501700                          @OX16402 00779000
*C502000,502300,502400-502450,528240                           @OX16402 00788000
*A906400                                                       @OZ26495 00788182
*C528240,529720                                                @OZ26495 00788282
*A539720,541720,545720,547720                                  @OZ30950 00788382
*C540720-541220,546720-547220                                  @OZ30950 00788482
*********************************************************************** 00800020
*                                                                     * 00820022
*MODULE-NAME=IEDQNK (TCAM,CHECKPOINT/RESTART)                  @Y17XACT 00840000
*                                                                     * 00860022
*DESCRIPTIVE-NAME=BUILD ENVIRONMENT CHECKPOINT RECORDS                * 00880022
*                                                                     * 00900022
*COPYRIGHT='NONE'                                                     * 00920022
*                                                                     * 01000020
*STATUS -- VERSION 10.0                                        @Y17XACT 01600000
*                                                                     * 01800020
*FUNCTION:THIS MODULE BUILDS AN ENVIRONMENT DISK RECORD SEGMENT(S). IT* 02000020
*   DETERMINES WHETHER IT IS TO BUILD THE FIRST SEGMENT OF AN ENVIRON-* 02200020
*   MENT CHECKPOINT OR A SUBSEQUENT SEGMENT BY CHECKING THE CURRENT   * 02400020
*   EXCP SLOT (CKPEXCP); IF IT CONTAINS A POINTER TO AN ENVIRONMENT   * 02600020
*   TYPE RECORD WHICH IS TO BE CONTINUED(THE KEY FIELD CONTAINS X'20')* 02800020
*   THIS MODULE PICKS UP ITS REGISTERS FROM CKPSAVE1 AND BUILDS THE   * 03000020
*   NEXT SEGMENT IN THE GETMAIN AREA POINTED TO BY CKPEXCP. OTHERWISE * 03200020
*   IT ISSUES A GETMAIN AND PUTS ITS ADDRESS IN CKPLDRB (LAST DISK    * 03400020
*   RECORD BUILT). BEFORE MOVING A GROUP OF INFORMATION FROM THE MCP  * 03600020
*   TABLES TO THE DISK RECORD,THIS MODULE CHECKS TO SEE IF THERE IS   * 03800020
*   ROOM FOR IT IN THIS RECORD SEGMENT. IF NOT,IT PUTS X'20' IN THE   * 04000020
*   KEY FIELD,SAVES ITS REGISTERS IN CKPSAVE1,AND RETURNS TO THE      * 04200020
*   CHEKCPOINT EXECUTOR. IF IT REACHES THE END OF THE MCP TABLES      * 04400020
*   BEFORE IT REACHES THE END OF THE RECORD SEGMENT,IT PUTS X'1C' IN  * 04600020
*   THE KEY FIELD AND RETURNS TO THE CHECKPOINT EXECUTOR WITHOUT      * 04800020
*   SAVING ITS REGISTERS. IF IT JUST BUILT THE FIRST (OR ONLY) SEG.   * 05000020
*   MENT,IT RETURNS TO THE EXECUTOR WITH THE OFFSET OF THE CHECKPOINT * 05200020
*   I/O QUEUE MANAGER;IF IT JUST BUILT ANY OTHER SEGMENT IT RETURNS   * 05400020
*   WITH THE OFFSET OF THE CHECKPOINT I/O ROUTINE.(ONLY THE FIRST     * 05600020
*   SEGMENT IS ENQUEUED ON THE DISK I/O SUEUE.)                       * 05800020
*   WHEN THIS MODULE BEGINS TO BUILD A FIRST SEGMENT,IT TURNS OFF ALL * 06000020
*   REQUEST BITS IN THE ENVIRONMENT REQUEST ELEMENT(AVTCKELE) AND     * 06200020
*   TURNS ON THE CHECKPOINT IN PROGRESS FLAG IN THE REQUEST ELEMENT.  * 06400020
*   ANY SUBSEQUEST SETTINGS OF REQUEST BITS WILL CAUSE ANOTHER        * 06600020
*   ENVIRONMENT CHECKPOINT TO BE TAKEN.                               * 06800020
*                                                              @Y17XACT 06810000
*NOTES: SEE BELOW                                              @Y17XACT 06820000
*                                                              @Y17XACT 06830000
*    DEPENDENCIES = EBCDIC CHARACTER CODE DEPENDENCY           @Y17XACT 06840000
*                   CORRECTABLE BY REASSEMBLY                  @Y17XACT 06850000
*                                                              @Y17XACT 06860000
*    RESTRICTIONS = NONE                                       @Y17XACT 06870000
*                                                              @Y17XACT 06880000
*    REGISTER CONVENTIONS = SEE REGISTER ASSIGNMENTS           @Y17XACT 06890000
*                                                              @Y17XACT 06900000
*    PATCH LABEL = NONE                                        @Y17XACT 06910000
*                                                              @Y17XACT 06920000
*MODULE TYPE = PROCEDURE                                       @Y17XACT 06930000
*                                                              @Y17XACT 06940000
*    PROCESSOR = ASSEMBLER XF                                  @Y17XACT 06950000
*                                                              @Y17XACT 06960000
*    MODULE SIZE = SEE EXTERNAL SYMBOL DICTIONARY              @Y17XACT 06970000
*                                                              @Y17XACT 06980000
*    ATTRIBUTES = REENTERABLE                                  @Y17XACT 06990000
*                                                                     * 07000020
*ENTRY POINT = IEDQNK                                          @Y17XACT 07200000
*                                                                     * 07400020
*    PURPOSE = SEE FUNCTION                                    @Y17XACT 07450000
*                                                              @Y17XACT 07500000
*    LINKAGE = AT ENTRY,REG 15 CONTAINS ENTRY POINT ADDRESS    @Y17XACT 07550000
*                                                                     * 07800020
*INPUT:REGISTERS 2,3,9,12,14,15 CONTAIN THE FOLLOWING VALUES:         * 08000020
*                                                                     * 08200020
*   2-ADDRESS OF CHECKPOINT WORKAREA                                  * 08400020
*   3-ADDRESS OF REQUEST ELEMENT                                      * 08600020
*   9-ADDRESS OF AVT                                                  * 08800020
*   12-BASE REGISTER FOR CHECKPOINT EXECUTOR-IEDQNF                   * 09000020
*   14-RETURN ADDRESS-IN IEDQNF                                       * 09200020
*   15-ENTRY POINT OF THIS MODULE                                     * 09400020
*                                                                     * 09600020
*OUTPUT:THE ABOVE REGISTERS 2-14 ARE UNCHANGED. THIS MODULE BUILDS AN * 09800020
*   ENVIRONMENT DISK RECORD SEGMENT IN A GETMAIN AREA POINTED TO BY   * 10000020
*   CKPEXCP OR CKPLDRB (SEE FUNCTIONS)                                * 10200020
*                                                                     * 10400020
*EXITS-NORMAL:THIS MODULE RETURNS TO THE ADDRESS IN REGISTER 14 WITH  * 11000020
*   THE OFFSET OF EITHER THE I/O QUEUE MANAGER OR THE I/O ROUTINE IN  * 11200020
*   REGISTER 15.(SEE FUNCTIONS)                                       * 11400020
*                                                                     * 11600020
*EXITS-ERROR:THIS MODULE RETURNS TO THE ADDRESS IN REGISTER 14 WITH   * 11800020
*   THE OFFSET OF THE NO CORE ROUTINE IN REGISTER 15.                 * 12000020
*                                                                     * 12200020
*EXTERNAL REFERENCES = SEE BELOW                               @Y17XACT 12210000
*                                                              @Y17XACT 12220000
*    ROUTINES = NONE                                           @Y17XACT 12230000
*                                                              @Y17XACT 12240000
*    DATA AREAS = INVITATION LIST,CHECKPOINT WORKAREA          @Y17XACT 12250000
*                 CHECKPOINT REQUEST ELEMENT, READ AHEAD       @Y17XACT 12260000
*                 QUEUE (FOR TPROCESS ENTRY ONLY)              @Y17XACT 12270000
*                                                              @Y17XACT 12280000
*    CONTROL BLOCKS = AVT,DCB,DEB,LCB,QCB,TERMINAL ENTRY       @Y17XACT 12290000
*                                                              @Y17XACT 12300000
*TABLES = OPTION TABLE, TERMNAME TABLE                         @Y17XACT 12310000
*                                                              @Y17XACT 12320000
*MACROS = GETMAIN, IEDHJN                                      @Y17XACT 12330000
*                                                              @Y17XACT 12340000
*********************************************************************** 16200020
         EJECT                                                          16300005
         SPACE 3                                                        16400020
*REGISTER ASSIGNMENTS                                                   16600020
         SPACE                                                          16800020
R0       EQU   0                        REG ZERO                 S22024 17000022
R1       EQU   1                        INDEX-TERMNAME TABLE            17200020
R2       EQU   2                        ADDRESS OF CKPT WORK AREA       17400020
R3       EQU   3                        ADDRESS OF REQUEST ELEMENT      17600020
R4       EQU   4                        ADDRESS OF DISK RECORD          17800020
R5       EQU   5                        LENGTH-TERMNAME                 18000020
R6       EQU   6                        ADDRESS OF TERMNAME ENTRY       18200020
R7       EQU   7                        ADDRESS OF QCB                  18400020
R8       EQU   8                        ADDRESS OF TERM ENTRY           18600020
RAVT     EQU   9                        ADDRESS OF AVT                  18800020
R10      EQU   10                       POSITION IN DISK RECORD         19000020
R11      EQU   11                       LENGTH FOR GETMAIN              19200020
R12      EQU   12                       BASE REG FOR IEDQNF             19400020
R13      EQU   13                       BRANCH REG                      19600020
R14      EQU   14                       RETURN REG-IN IEDQNF            19800020
R15      EQU   15                       ENTRY POINT FOR THIS MODULE     20000020
         SPACE                                                          20200020
ONE      EQU   1                        ONE                    @Y17XACT 20300000
QNKMOVEL EQU   X'100'                   MAX LENGTH FOR EXECUTE     0725 20400020
QNKSTOP  EQU   X'01'                    BIT INDICATES LINE STOPPED 0728X20600020
                                        PRIOR TO CLOSEDOWN         0728 20800020
         SPACE 3                                                        21200020
         USING *,R15                    BASE REG                        21400020
         USING IEDQAVTD,RAVT            BASE FOR AVT                    21600020
         USING IEDQCKPD,R2              BASE FOR CKPT WORK AREA         21800020
         SPACE                                                          22000020
IEDQNK   IEDHJN  QNK00                                          SA56611 22200022
         USING IEDQCRED,R3              BASE FOR REQUEST ELEMENT        23000020
         USING IEDQCDRD,R4              BASE FOR DISK RECORD            23200020
         SPACE                                                          23400020
         LH    R11,CKPBPERR             LENGTH OF ENVIRONMENT SEG       23600020
         LR    R10,R11                  SAVE TOTAL LENGTH FOR GETMN1130 23650020
         LA    R0,CDRTINFO              LENGTH OF CON TROL DATA    1201 23700020
         SR    R11,R0                   SUBTRACT LEN FROM RCD LEN  1201 23750020
         L     R4,CKPEXCP               CURRENT EXCP RCD                23800020
         LTR   R4,R4                    CHECK FOR NO RCD BEING         X24000020
                                        WRITTEN CURRENTLY               24200020
         BZ    QNK30                    BRANCH IF 1ST SEGMENT           24400020
         CLI   CDRKEY,CDRTOTLC          CHECK FOR ENV RCD WHICH IS     X24600020
                                        CONTINUED                       24800020
         BNE   QNK30                    BRANCH IF 1ST SEG OF ENV        25000020
         SPACE 3                                                        25200020
*THIS IS A CONTINUATION OF AN ENV CKPT                                  25400020
         SPACE                                                          25600020
         LM    R13,R14,CKPSAVE1+8       RESTORE REGS                    26200020
         LM    R0,R8,CKPSAVE1+20        RESTORE REGS               1109 26400020
         LA    R10,CDRDATA              ADDRESS OF DATA PORTION         26800020
         B     0(R13,R15)               LOOP POSITION AT END OF SEG     27000020
         SPACE 3                                                        27200020
*THIS IS THE FIRST SEGMENT OF AN ENVIRONMENT CKPT. ISSUE GETMAIN        27400020
         SPACE                                                          27600020
QNK30    EQU   *                                                        27800020
         LA    R6,CKPLDRB               ADDRESS OF ADDR LOCATION        28000020
         LR    R7,R15                   SAVE REG                        28200020
         GETMAIN EC,LV=(R10),A=(R6),MF=(E,CKPGETML) AREA FOR RCD   1130 28400020
         SPACE                                                          28600020
         LTR   R15,R15                  CHECK RETURN CODE               28800020
         LR    R15,R7                   RESTORE REG                     29000020
         BZ    QNK35                    BRANCH IF REQUEST SATISFIED     29200020
         SPACE 3                                                        29400020
*THERE IS INSUFFICIENT CORE FOR THIS RECORD. RETURN TO CKPT             29600020
*EXECUTOR WITH THE OFFSET OF THE NO CORE MODULE.                        29800020
         SPACE                                                          30000020
         LA    R15,CKPNOCOR             OFFSET                          30200020
         BR    R14                      RETURN TO EXECUTRO              30400020
         SPACE 3                                                        30600020
*BUILD FIRST SEGMENT OF ENVIRONMENT CHECKPOINT                          30800020
         SPACE                                                          31000020
QNK35    EQU   *                                                        31200020
         L     R4,CKPLDRB               ADDRESS OF GETMAIN RCD          31400020
         LA    R10,CDRDATA              POSITION IN RCD OF DATA         31600020
         OI    AVTCKELF,AVTCPIPN        TURN ON CKPT IN PROGRESS        31800020
         NI    AVTCKELF,X'FF'-AVTCRTLN  TURN OFF REQUEST BIT            32000020
         NI    CKPFLAGS,AVTEFF-CKPOPNEN   SET FOR QCB SCAN     @OX16402 32050000
         XI    CKPSWCH1,CKPSET1         INITIALIZE QCB SWITCH  @OX16402 32100000
         SPACE 3                                                        34200020
*INITIALIZE FOR LOOP THROUGH TERMNAME TABLE                             44800020
         SPACE                                                          45000020
QNK47     EQU  *                                                        45200020
         USING IEDQTNTD,R6                                              45400020
         L     R6,AVTRNMPT              ADDRESS OF TERMNAME TABLE       45600020
         SR    R5,R5                    CLEAR                           45800020
         IC    R5,TNTENLEN              LENGTH OF TERMNAME              46000020
         LH    R1,TNTLEN                COUNT OF ENTRIES                46200020
         N     R1,AVTCLRHI              CLEAR HIGH ORDER HALF WORD      46400020
         LA    R6,TNTFIRST              GET FIRST ENTRY                 46600020
         SPACE 3                                                        47200020
*BEGINNING OF LOOP THROUGH TERMNAME TABLE                               47400020
         SPACE                                                          47600020
QNK50    EQU   *                                                        47800020
         AR    R6,R5                    MOVE PAST NAME FIELD            48000020
         MVC   CKPTRMAD+1(3),0(R6)      MOVE ADDR TO WORD BOUNDARY      48200020
         L     R8,CKPTRMAD              LOAD RERMINAL TABLE ADDRESS     48400020
         USING IEDNTRM,R8               BASE FOR TERM ENTRY    @Y17XACT 48600000
         SH    R8,TRMBCKUP              PT TO NEG PRFIX        @Y17XACT 48700000
         SPACE 3                                                        48800020
*CHECK TYPE OF TERMINAL ENTRY-SKIP CASCADE OR DISTRIBUTION LISTS.       49000020
*MOVE TERMINAL AND QCB INFO TO DISK RECORD                              49200020
         SPACE                                                          49400020
         TM    TRMDSORG,TRMLGB          IS THIS LINE GROUP ENTRY S22024 49460022
         BO    QNK65                    YES, DO NOT CHECKPOINT   S22024 49520022
         TM    TRMSTATE,TRMLIST         IS THE LIST BIT ON      SA53610 49600022
         BNO   QNK5002                  IF NOT, CKPT THIS ENTRY SA53610 49700022
         TM    TRMSTATE,TRMLOG          IS THIS LOGTYPE         SA53610 49800022
         BNO   QNK65                    IF NOT, DO NOT CKPT     SA53610 49900022
         SPACE                                                          50000022
QNK5002  EQU   *                                                SA53610 50100022
         TM    CKPFLAGS,CKPOPNEN        TERMINAL SCAN          @OX16402 50106000
         BO    QNK60A                   YES, SKIP QCB SCAN     @OX16402 50112000
         SPACE 3                                               @OX16402 50118000
*CHECKPOINT MASTER QCB FIELDS                                           50124000
         SPACE                                                          50130000
QNK55    EQU   *                                                   1109 50136000
         TM    TRMSTATE,TRMLOG          PROCESS OR LOG TYPE    @Y17XACT 50142000
         BM    QNK5501                  YES, NOT 3705 ENTRY    @Y17XACT 50148000
         TM    TRMSTATE,TRMPREF         3705 TTE               @Y17XACT 50154000
         BNO   QNK5501                  NO,DONT DO SSCP CHECK  @Y17XACT 50160000
         CLI   TRMTYPE,TRMSSCP             SSCP ENTRY          @Y17XACT 50166000
         BE    QNK65                    YES,NO VALID QCB       @Y17XACT 50172000
QNK5501  EQU   *                                               @Y17XACT 50178000
         USING IEDQQCB,R7               MASTER QCB BASE         SA58453 50184000
         L     R7,TRMDESTQ-1            ADDRESS OF MASTER QCB      1106 50190000
         TM    QCBDSFLG,QCBDISK         CHECK QUEUE TYPE           1116 50196000
         BZ    QNK65                    BRANCH IF CORE ONLY    @OX16402 50202000
         MVC   CKPSAVE1(1),QCBFLAG                                      50208000
         NI    CKPSAVE1,QCBCKPT         CLEAR ALL BUT CKPT BIT          50214000
         CLC   CKPSAVE1(1),CKPSWCH1     COMPARE SWITCHES                50220000
         BE    QNK65                    BRANCH IF ALREADY CKPOINTED     50226000
         XI    QCBFLAG,QCBCKPT          INVERT QCB SWITCH               50232000
         LA    R0,CKPMQBLN              LENGTH OF MASTER QCB FIEDLS     50238000
         BAL   R13,QNK90                CHECK FOR END OF RECORD         50244000
         MVI   0(R10),CKPQDELM          MOVE IN QCB DELIMITER  @OX16402 50250000
         MVC   ONE(CKPMCTLN,R10),QCBMSGCT  MOVE MSG COUNT      @OX16402 50256000
         MVC   CKPMCTLN+ONE(CKPQBKLN,R10),QCBQBACK  MOVE QBACK @OX16402 50262000
*                                         TTR                  @OX16402 50268000
         AR    R10,R0                   MOVE TO NEXT DISK POSITION      50274000
         SPACE 3                                                        50280000
*BEGINNING OF LOOP THROUGH PRIORITY LEVEL QCBS                          50286000
         SPACE                                                          50292000
QNK60    EQU   *                                                        50298000
         LA    R0,CKPQCBLN              LENGTH OF DISK POINTERS         50304000
         BAL   R13,QNK90                CHECK FOR END OF RECORD         50310000
         MVC   0(CKPQCBLN,R10),QCBDNHDR MOVE DISK PTRS                  50316000
         AR    R10,R0                   MOVE TO NEXT DISK POSITION      50322000
         LA    R0,CKPQBKLN              LENGTH OF QBACK POINTER SA51078 50328000
         BAL   R13,QNK90                CHECK FOR END OF RECORD SA51078 50334000
         MVC   0(CKPQBKLN,R10),QCBPQBCK SET QBACK POINTER       SA51078 50340000
         AR    R10,R0                   SET NEXT POSITION       SA51078 50346000
         CLI   QCBPRIPQ,0               CHECK FOR 0 PRIORITY            50352000
         LA    R7,QCBPSIZE(0,R7)        MOVE TO NEXT PRIORITY QCB       50358000
         BNZ   QNK60                    BRANCH IF NOT LAST QCB          50364000
         SPACE                                                          50370000
*END OF LOOP THROUGH PRIORITY LEVEL QCBS                                50376000
         B     QNK65                    CHECK NEXT TNT ENTRY   @OX16402 50400000
         SPACE 3                                               @OX16402 50420000
* THE FOLLOWING INSTRUCTIONS HAVE BEEN MOVED TO UPDATE THE     @OX16402 50440000
* QCB FIELDS BEFORE THE TERMINAL ENTRY FIELDS. THIS IS FOR     @OX16402 50460000
* RESTART SO THAT IT CAN BE SURE THAT THE SEQUENCE NUMBER HAS  @OX16402 50480000
* BEEN UPDATED TO WHAT THE DISK POINTERS INDICATE.             @OX16402 50500000
QNK60A   EQU   *                                               @OX16402 50520000
         LA    R0,CKPTRMLN+CKPDELLN            LENGTH INCREMENT@ZM47916 50540000
         BAL   R13,QNK90                CHECK FOR END OF RECORD         50600020
         MVI   0(R10),CKPDELMT          TERMINAL ENTRY DELIMITER   0422 50800000
         MVC   CKPDELLN(CKPTRMLN,R10),TRMSTATE    MOVE STATUS BYTE 0218 50923600
         AR    R10,R0                   MOVE TO NEXT DISK POSITION      51000020
         USING IEDQQCB,R7               BASE FOR QCB                    51400020
         L     R7,TRMDESTQ-1            ADDRESS OF QCB                  51600020
         TM    TRMSTATE,TRMLOG          PROCESS ENTRY           SA59179 51660005
         BM    QNK5003                  YES,SAVE FIELDS         SA59179 51720005
         TM    TRMSTATE,TRMPREF         NEG PREFIX EXIST       @Y17XACT 51723000
         BO    QNK5002A                 YES,BRANCH             @Y17XACT 51726000
         TM    TRMSTATE,TRMSNGLE        SINGLE ENTRY           @Y17XACT 51729000
         BNZ   QNK5002B                 NO, BRANCH             @Y17XACT 51732000
         LA    R0,CKPSENSE              LENGTH OF TRMSENSE     @Y17XACT 51735000
         BAL   R13,QNK90                CHECK FOR END OF REC   @Y17XACT 51738000
         MVC   0(CKPSENSE,R10),TRMSENSE                        @Y17XACT 51741000
*                                       CHECKPOINT TRMSENSE    @Y17XACT 51744000
         AR    R10,R0                   BUMP RECORD POINTER    @Y17XACT 51747000
         B     QNK5002B                 NOT 3705               @Y17XACT 51750000
QNK5002A EQU   *                                               @Y17XACT 51753000
         CLI   TRMTYPE,TRMLUNT             LU TYPE             @Y17XACT 51762000
         BE    QNK5002B                                        @Y17XACT 51765000
         CLI   TRMTYPE,TRMPSNA              PRESNA TERM        @Y17XACT 51768000
         BE    QNK5002B                                        @Y17XACT 51771000
         CLI   TRMTYPE,TRMCTERM             CTERM TYPE         @Y17XACT 51774000
         BNE   QNK5005A                                        @Y17XACT 51777000
QNK5002B EQU   *                                               @Y17XACT 51780000
         TM    QCBDSFLG,QCBDISK         CHECK FOR DISK QUEUES           51800020
         BZ    QNK5005                  BRANCH IF CORE ONLY        1116 52000020
QNK5003  EQU   *                                                SA59179 52100005
         LA    R0,CKPSEQLN              LENGTH OF SEQUENCE NO           52200020
         BAL   R13,QNK90                CHECK FOR END OF RCD            52400020
         MVC   0(CKPSEQLN,R10),TRMINSEQ                                 52600020
         TM    TRMSTATE,TRMLOG          VERIFY PROCESS ENTRY    SA58453 52609005
         BNM   QNK5004                  BRANCH IF NOT PROCESS   SA66372 52618054
         CLI   QCBDSFLG,QCBFQCB         PUT PROCESS ENTRY       SA66372 52621054
         BE    QNK5004                  BRANCH IF YES           SA66372 52624054
         NC    TRMSTAT+1(2),TRMSTAT+1   PEWA ALLOCATED          SA58453 52627005
         BZ    QNK5004                  BRANCH IF NO            SA58453 52636005
         DROP  R7                                                       52645005
         USING IEDQPEWA,R7              BASE FOR PEWA           SA58453 52654005
         L     R7,TRMSTAT               PEWA ADDRESS            SA58453 52663005
         NC    EOMSAVE+1(2),EOMSAVE+1   EOM SAVED               SA58453 52672005
         BZ    QNK50021                 BRANCH IF NO            SA58453 52681005
         L     R13,EOMSAVE              BUFFER ADDRESS          SA58453 52690005
         B     QNK50022                 SET SEQUENCE OUT        SA58453 52699005
QNK50021 EQU   *                                                SA58453 52708005
         CLC   PERAQCB+1(3),AVTDELAD+1  READ AHEAD Q EMPTY      SA58453 52717005
         BE    QNK5004                  BRANCH IF YES           SA58453 52726005
         L     R13,PERAQCB             BUFFER ADDRESS           SA58453 52735005
         TM    PRFSTAT1-IEDQPRF(R13),PRFDUPLN RETRIEVED BUFFER @SA75469 52736058
         BNO   QNK50022                 BRANCH IF NO           @SA75469 52737058
         CLC   PERAQCB+5(3),AVTDELAD+1  REGULAR BUFFER SAVED AC@SA75469 52738058
*                                       ACROSS RETRIEVE        @SA75469 52739058
         BE    QNK5004                  BRANCH IF NO           @SA75469 52740058
         L     R13,PERAQCB+4            BUFFER ADDRESS         @SA75469 52741058
         DROP  R7                                                       52744005
QNK50022 EQU   *                                                SA58453 52753005
         MVC   2(CKPSEQLN-2,R10),PRFTQBCK+1-IEDQPRF(R13)        SA58453 52762005
*                                       SET CORRECT NUMBER      SA58453 52771005
         AR    R10,R0                   BUMP REC PTR           @Y17XACT 52774000
         B     QNK5005B                 GO PROC OPTIONS        @Y17XACT 52777000
QNK5004  EQU   *                                                SA58453 52780005
         AR    R10,R0                                                   52800020
         SPACE 3                                                        52804020
*SAVE NEW 3705 TTE FIELDS                                      @Y17XACT 52808000
         SPACE                                                          52812020
QNK5005  EQU   *                         *                         1116 52812200
         TM    TRMSTATE,TRMPREF         NEG PREFIX *           @Y17XACT 52812400
         BNO   QNK5005B                 BR IF NOT *            @Y17XACT 52812600
QNK5005A EQU   *                        *                      @Y17XACT 52812800
         LA    R0,CKPNRSZ               LENGTH OF DATA *       @Y17XACT 52813000
         BAL   R13,QNK90                CHECK FOR END OF REC*  @Y17XACT 52813200
         USING CKPNRES,R10              USE CHECKPOINT DSECT*  @Y17XACT 52813400
         MVC   CKPSUBST,TRMSUBST             SAVE TRMSUBST*    @Y17XACT 52813600
         MVC   CKPCOHRT,TRMCOHRT             SAVE TRMCOHORT *  @Y17XACT 52813800
         MVI   CKPNFLG,X'00'            CLEAR FLAG *           @Y17XACT 52814000
         TM    TRMBYTE2,TRMREMB             REMB BIT SET *     @Y17XACT 52814200
         BNO   AROUND                   NO ,DONT SAVE*         @Y17XACT 52814400
         OI    CKPNFLG,CKPREMB          SAVE REMB BIT *        @Y17XACT 52814600
AROUND   EQU   *                        *                      @Y17XACT 52814800
         TM    TRMBYTE2,TRMRSACT              ACTIVE BIT SET*  @Y17XACT 52815000
         BNO   AROUND1                  NOT SET, DONT SAVE *   @Y17XACT 52815200
         OI    CKPNFLG,CKPRSACT         SAVE ACTIVE FLAG*      @Y17XACT 52816200
AROUND1  EQU   *                         *                     @Y17XACT 52816400
         TM    TRMSTATE,TRMLINE         TTE FOR LINE *         @Y17XACT 52816600
         BNO   AROUND2                  NO,DONT CHECK EPMODE*  @Y17XACT 52816700
         TM    TRMLINK,TRMEPMOD             EP MOD SET*        @Y17XACT 52816900
         BNO   AROUND2                  NO, DONT SAVE *        @Y17XACT 52817200
         OI    CKPNFLG,CKPEPMOD         SAVE EPMOD FLAG*       @Y17XACT 52817400
AROUND2  EQU   *                        *                      @Y17XACT 52817600
         CLI   TRMTYPE,TRMLUNT          TTE FOR LU*            @Y17XACT 52817800
         BNE   AROUND3                  NO, DONT CHECK TRMLU*  @Y17XACT 52818000
         TM    TRMLU,TRMLULOG             LULOG SET            @Y17XACT 52818400
         BNO   AROUND3                  NO, DONT SAVE          @Y17XACT 52818500
         OI    CKPNFLG,CKPLULOG         SAVE LU LOG BIT        @Y17XACT 52818600
AROUND3  EQU   *                                               @Y17XACT 52818700
         MVC   CKPTYPE,TRMTYPE             SAVE TRMTYPE        @Y17XACT 52818800
         AR    R10,R0                   GET NEXT DISK POSTION  @Y17XACT 52818900
         DROP  R10                                             @Y17XACT 52819000
QNK5005B EQU   *                                               @Y17XACT 52819100
         SPACE                                                          52819300
* SAVE OPTIONS FIELDS EXCEPTS THOSE DEFINED AS ADDRESSES       @Y17XACT 52819500
         SPACE                                                          52819700
         TM    TRMSTATE,TRMOPTFN        CHECK FOR OPTIONS DEFINED  1109 52820020
         BZ    QNK61                    BRANCH IF NOT USED     @OZ26495 52824082
         XC    CKPSAVE1+68(4),CKPSAVE1+68  CLEAR OPTION COUNT      1109 52828020
         L     R7,AVTOPTPT              ADDRESS OF OPTION TABLE    1109 52832020
         L     R3,4(,R7)                ADDR OF OPTION CHARACT TBL 1109 52836020
         SPACE 3                                                        52840020
*BEGINNING OF LOOP THROUGH COUNT OF OPTION FIELDS FOR THIS TERMINAL1109 52844020
         SPACE                                                          52848020
QNK51    EQU   *                                                   1109 52852020
         L     R13,CKPSAVE1+68          INDEX TO OPTION FIELD      1109 52856020
         IC    R13,TRMOPT(R13)          OFFSET                     1106 52860020
         CH    R13,QNKNOPT              CHECK FOR UNUSED ENTRY     1109 52864020
         BE    QNK54                    BRANCH IF NOT USED         1109 52868020
         LH    R7,TRMOPTBL              GET ENTRY OFFSET       @YA05454 52872056
         N     R7,AVTCLRHI              CLEAR HI HALF          @YA05454 52874056
         A     R7,AVTOPTPT              ADD OPT TBL OFFSET     @YA05454 52876056
         AR    R7,R13                   ADDR OF OPTION FIELD       1109 52880020
         IC    R13,0(R3)                LENGTH OF FIELD            1116 52884020
         CLI   1(R3),X'D0'              CHECK OPTION TYPE          1116 52888020
         BH    QNK52                    BRANCH IF  NOT ADDRESS TYPE1109 52892020
         CLI   1(R3),X'80'              CHECK OPTION TYPE          1116 52896020
         BH    QNK54                    BRANCH IF ADDRESS          1109 52900020
QNK52    EQU   *                                                   1109 52904020
         LA    R0,1(,R13)               LENGTH OF OPTION FIELD     1109 52908020
         BC    0,*                      NO-OP FOR RETURN BRANCH    1109 52912020
         BAL   R13,QNK90                CHECK FOR END OF RECORD SEG1106 52916020
         LR    R13,R0                   GET LENGTH                 1109 52920020
         BCTR  R13,0                    SUBTRACT 1 FOR EXECUTE     1106 52924020
         EX    R13,QNKMOVE              MOVE OPTION FIELD TO RCD   1106 52928020
         AR    R10,R0                   ADD LENGTH TO RCD POSITION 1106 52932020
QNK54    EQU   *                                                   1106 52936020
         LA    R3,CKPOPLTL(,R3)         GET NEXT ENTRY IN OP T CHAR1109 52940020
         L     R13,CKPSAVE1+68          GET INDEX                  1109 52944020
         LA    R13,1(,R13)              ADD 1 TO INDEX             1109 52948020
         ST    R13,CKPSAVE1+68          RESTORE INDEX              1109 52952020
         CLC   CKPSAVE1+71(1),TRMOPNO   CHEKC FOR END OF OPTION S  1109 52956020
         BNE   QNK51                    BRANCH IF NOT END OF OPT FI1109 52960020
         SPACE                                                          52964020
*END OF LOOP THROUGH OPTION FIELDS FOR THIS TERMINAL ENTRY         1109 52968020
         SPACE 3                                               @OZ26495 52972082
QNK61    EQU   *                                               @OZ26495 53022082
         TM    TRMDEVFL,X60             DIAL DIGITS/ADDR CHAR? @OZ26495 53072082
         BZ    QNK62                    NO, BRANCH             @OZ26495 53122082
         SR    R13,R13                  CLEAR REG              @OZ26495 53172082
         TM    TRMSTATE,TRMOPTFN        OPTIONS SPECIFIED      @OZ26495 53222082
         BNO   NOOPTS                   NO, BRANCH             @OZ26495 53272082
         LA    R7,TRMOPT                START OF OPTIONS       @OZ26495 53322082
         IC    R13,TRMOPNO              NUMBER OF OPTIONS      @OZ26495 53372082
         AR    R7,R13                   START OF DEVICE FIELDS @OZ26495 53422082
         B     CKBUF                    CHECK BUFSIZE          @OZ26495 53472082
NOOPTS   EQU   *                                               @OZ26495 53522082
         LA    R7,TRMOPNO               START OF DEVICE FIELDS @OZ26495 53572082
CKBUF    EQU   *                                               @OZ26495 53622082
         TM    TRMDEVFL,X80             BUFSIZE SPECIFIED      @OZ26495 53672082
         BNO   CKDIAL                   NO, BRANCH             @OZ26495 53722082
         IC    R13,0(R7)                LENGTH OF BUFSIZE      @OZ26495 53772082
         LA    R7,ONE(R13,R7)           BUMP PAST BUFSIZE      @OZ26495 53822082
CKDIAL   EQU   *                                               @OZ26495 53872082
         TM    TRMDEVFL,X40             DIAL DIGITS SPECIFIED  @OZ26495 53922082
         BNO   CKADDR                   NO, BRANCH             @OZ26495 53972082
         LA    R0,ONE                   SIZE OF LENGTH BYTE    @OZ30950 53978082
         BC    0,*                      NO-OP FOR RETURN BRANCH@OZ30950 53984082
         BAL   R13,QNK90                CHECK END OF RCD SEG   @OZ30950 53990082
         LA    R13,ONE                  LENGTH BYTE            @OZ30950 53996082
         BCTR  R13,0                    SUBTRACT FOR EXECUTE   @OZ30950 54002082
         EX    R13,QNKMOVE              MOVE LENGTH BYTE       @OZ30950 54008082
         LA    R10,ONE(R10)             ADJUST RECORD POSITION @OZ30950 54014082
         IC    R13,0(R7)                LENGTH OF DIAL DIGITS  @OZ26495 54022082
         LR    R0,R13                   LENGTH TO BE MOVED     @OZ30950 54072082
         B     DIALSKIP                 SKIP NEXT INSTRUCTION  @OZ30950 54082082
         B     CKDIAL                   START OVER IF NOT      @OZ30950 54092082
*                                        ENOUGH SPACE          @OZ30950 54102082
DIALSKIP EQU   *                                               @OZ30950 54112082
         BAL   R13,QNK90                CHECK - END OF RCD SEG @OZ26495 54172082
         LA    R7,ONE(R7)               BUMP PAST LEN PTR      @OZ30950 54192082
         LR    R13,R0                   LENGTH TO BE MOVED     @OZ26495 54222082
         BCTR  R13,0                    SUBTRACT 1 FOR EXECUTE @OZ26495 54272082
         EX    R13,QNKMOVE              MOVE DIAL DIGITS       @OZ26495 54322082
         AR    R10,R0                   ADJUST RECORD POSITION @OZ26495 54372082
         LA    R7,ONE(R13,R7)           BUMP PAST DIAL DIGITS  @OZ26495 54422082
CKADDR   EQU   *                                               @OZ26495 54472082
         TM    TRMDEVFL,X20             ADDR CHAR SPECIFIED    @OZ26495 54522082
         BNO   QNK62                    NO, BRANCH             @OZ26495 54572082
         LA    R0,ONE                   SIZE OF LENGTH BYTE    @OZ30950 54578082
         BC    0,*                      NO-OP FOR RETURN BRANCH@OZ30950 54584082
         BAL   R13,QNK90                CHECK END OF RCD SEG   @OZ30950 54590082
         LA    R13,ONE                  LENGTH BYTE            @OZ30950 54596082
         BCTR  R13,0                    SUBTRACT FOR EXECUTE   @OZ30950 54602082
         EX    R13,QNKMOVE              MOVE LENGTH BYTE       @OZ30950 54608082
         LA    R10,ONE(R10)             ADJUST RECORD POSITION @OZ30950 54614082
         IC    R13,0(R7)                LENGTH OF ADDR CHAR    @OZ26495 54622082
         LR    R0,R13                   LENGTH TO BE MOVED     @OZ30950 54672082
         B     ADDRSKIP                 SKIP NEXT INSTRUCTION  @OZ30950 54682082
         B     CKADDR                   START OVER IF NOT      @OZ30950 54692082
*                                        ENOUGH SPACE          @OZ30950 54702082
ADDRSKIP EQU   *                                               @OZ30950 54712082
         BAL   R13,QNK90                CHECK - END OF RCD SEG @OZ26495 54772082
         LA    R7,ONE(R7)               BUMP PAST LENGTH BYTE  @OZ30950 54792082
         LR    R13,R0                   RESTORE LENGTH         @OZ26495 54822082
         BCTR  R13,0                    SUBTRACT 1 FOR EXECUTE @OZ26495 54872082
         EX    R13,QNKMOVE              MOVE ADDR CHAR         @OZ26495 54922082
         AR    R10,R0                   ADJUST RECORD POSITION @OZ26495 54972082
         SPACE 3                                                        58800020
*CHECKPOINT LINE STATUS                                                 59000020
         SPACE                                                          59200020
QNK62    EQU   *                                                        59400020
         USING IEDQQCB,R7                                      @OX16402 59450000
         TM    TRMSTATE,TRMPROC         PROCESS OR LOG ENTRY   @Y17XACT 59600000
         BO    QNK65                    BRANCH IF PROC OR LOG  @Y17XACT 59800000
         TM    TRMSTATE,TRMPREF         3705 RESOURCE          @Y17XACT 59860000
         BO    QNK3705                  YES DO 3705 PROCESSING @Y17XACT 59920000
         LA    R0,CKPLCBLN+CKPDCBLN     LENGTH OF LCB,DCB INFO     1012 60000020
         BAL   R13,QNK90                CHECK FOR END OF CKPT RCD  0620 60200020
         L     R7,TRMDESTQ-1            RESTORE ADDRESS OF QCB          60400020
         SR    R13,R13                  CLEAR                           60600020
         IC    R13,QCBRELLN             RELATIVE LINE NO                60800020
         L     R7,QCBDCBAD-1            DCB ADDRESS                     61000020
         USING IHADCB,R7                BASE FOR DCB                    61200020
         MVI   0(R10),X'FF'             MARK LINE AS UNOPENED      0620 61260020
         MVI   1(R10),0                 CLEAR LCBSTAT2 TO ZERO     1001 61320020
         TM    DCBOFLGS,X'10'           CHECK FOR OPENED DCB       0620 61400020
         BZ    QNK64                    BRANCH IF NOT OPENED       1120 61600020
QNK6205  EQU   *                                                 S22024 61740022
         L     R8,DCBDEBAD              GET DEB ADDR            SA56611 61800022
         EX    R13,CKRLN                CHECK FOR UNOPENED LINE SA56611 62000022
         BL    QNK64                    BRANCH IF LCB UNOPENED  SA56611 62200022
QNK63    EQU   *                                                   0620 62400020
         LR    R8,R1                    SAVE REG                   0620 62600020
         SR    R1,R1                    CLEAR REG                  0620 62800020
         IC    R1,DCBEIOBX              GET LENGTH OF LCB          0620 63000020
         MR    R0,R13                   MULTIPLY BY REL LINE NO.   0620 63200020
         L     R0,DCBIOBAD              IOB ADDR FOR REL LINE -1   0620 63400020
         AR    R1,R0                    ADD DISPLACEMENT FOR PROPER0620X63600020
                                        LINE                       0620 63800020
         LA    R0,LCBFLAG1-IEDQLCB      DISPLACEMENT FROM BEGINNING0729 64000020
         SR    R1,R0                    GET BEGINNING ADDR OF LCB  0729 64200020
         USING IEDQLCB,R1               BASE FOR LCB               0729 64400020
         MVC   0(CKPLCBLN,R10),LCBSTAT1 MOVE LINE STAT TO CKPT RCD 0620 64600020
         CLI   LCBPRI,PRILCBDL          CHECK FOR LCB ON SYS DELAY 1012 64660020
         BE    QNK6304                  BRANCH IF ON QUEUE-NOT STOP1012 64720020
         TM    AVTBIT1,AVTCLOSN         CHECK FOR CLOSEDOWN IN PROG0728 64800020
         BZ    QNK6305                  BRANCH IF NO CLOSEDOWN     0728 65000020
         TM    LCBSTCBA+2,QNKSTOP       CHECK FOR LINE STOPPED         X65200020
                                        PRIOR TO CLOSEDOWN         0728 65400020
         BO    QNK6305                  BRANCH IF STOPPED PRIOR    0728 65600020
QNK6304  EQU   *                                                   1012 65700020
         OI    0(R10),LCBRECVN          MARK LCB NOT STOPPED IN    0728X65800020
                                        CKPT RCD                   Z728 66000020
QNK6305  EQU   *                                                   0728 66200020
         LR    R1,R8                    RESTORE REG                0620 66400020
         SPACE 3                                                        67000020
*CHECKPOINT THE INTERVAL IN THE LINE DCB                                67200020
         SPACE                                                          67400020
QNK64    EQU   *                                                   1116 67800020
         MVC   CKPLCBLN(CKPDCBLN,R10),DCBINTVL MOVE DCB INTERVAL   1116 68100020
         LA    R10,CKPLCBLN+CKPDCBLN(,R10) ADD LENGTH OF 2 FIELDS  1116 68400020
         SPACE 3                                                        68800020
*CHECKPOINT THE INVITATION LIST,IF SPECIFIED                            69000020
         SPACE                                                          69200020
INVLIST  EQU   *                                               @Y17XACT 69300000
         TM    CKPFLAGS,CKPSTAIN        CHECK FOR INV LISTS CKPTED 0525 69400020
         BZ    QNK65                    BRANCH IF NOT TO BE CKPTED      69600020
         MVC   CKPTRMAD+1(THREE),AVTEZERO(R6) MOVE ADDR TO       S22024 69603022
*                                        WORD BOUNDARY           S22024 69606022
         L     R8,CKPTRMAD              RELOAD TERM ENTRY ADDR   S22024 69609022
         SH    R8,TRMBCKUP              BACK UP TO NEG PREF    @YM06009 69619000
         L     R7,TRMDESTQ-1            RESTORE QCB ADDRESS      S22024 69642022
         USING IEDQQCB,R7               BASE FOR QCB             S22024 69645022
         SR    R13,R13                  CLEAR FOR IC             S22024 69648022
         IC    R13,QCBRELLN             GET RELATIVE LINE NO.    S22024 69651022
         L     R7,QCBDCBAD-1            RESET DCB ADDRESS        S22024 69654022
         USING IHADCB,R7                BASE FOR DCB             S22024 69657022
         EX    R13,QNKCOMPR             CHECK FOR INVITATION LIST  1209 69660020
         BL    QNK65                    BRANCH IF NOT DEFINED INDCB1209 69720020
         BCTR  R13,0                    DECREMENT BY ONE         A47151 69760022
         SLL   R13,2                    MULTIPLY BY 4                   69800020
         L     R7,DCBINVLI(R13)         ADDRESS OF INVLIST       A47151 70000022
         LA    R7,AVTEZERO(,R7)         CLEAR HI ORDER BYTE    @XA05305 70020056
         LTR   R7,R7                    INVLIST OMITTED ON GRP @XA05305 70040056
         BZ    QNK65                    BR YES                 @XA05305 70060056
         CLI   INVENTS(R7),AVTEZERO     DOES LIST HAVE ENTRIES   A47151 70100022
         BE    QNK65                    IF NO, DO NOT CHECKPOINT A47151 70200022
         TM    CKPSWCH2,CKPSET2         SWITCH FLIP OR FLOP      A47151 70300022
         BNO   QNK6403                  IF FLIP, TEST ON COND    A47151 70400022
         TM    INVSTAT(R7),CKPSET2      CHECK SW IN INVLIST      A47151 70500022
         BNO   QNK65                    BRANCH IF LIST CKPTED    A47151 70600022
         B     QNK6406                  ELSE, CHECKPOINT IT      A47151 70700022
         SPACE                                                          70800022
QNK6403  EQU   *                                                 A47151 70900022
         TM    INVSTAT(R7),CKPSET2      CHECK SW IN INVLIST      A47151 71000022
         BO    QNK65                    BRANCH IF LIST CKPTED    A47151 71100022
         SPACE                                                          71200022
QNK6406  EQU   *                                                 A47151 71300022
         XI    INVSTAT(R7),CKPSET2      INVERT SW TO IND CKPT    A47151 71400022
         ST    R1,CKPSAVE1              SAVE REG                   1020 72400020
         SR    R0,R0                    CLEAR                      0709 72600020
         SR    R1,R1                    CLEAR                           72800020
         IC    R0,0(R7)                 GET NO. ENTRIES IN LIST         73000020
         IC    R1,2(R7)                 GET LENGTH OF ONE ENTRY         73200020
         MR    R0,R0                    GET LENGTH OF TOTAL LIST        73400020
         LA    R0,9(0,R1)               ADD LENGTH OF CONTROL AREA 0724 73600020
         TM    INVSTAT(R7),EOTBIT       IS IT EOT-FE (BSC)      SA57661 73630022
         BZ    QNK6406A                 NO, BRANCH              SA57661 73660022
         LA    R0,TEN(,R1)              ADD LENGTH OF CONTROL   SA57661 73690022
*                                       AREA FOR BSC            SA57661 73720022
QNK6406A EQU   *                                                SA57661 73750022
         LTR   R1,R11                   CHECK FOR END OF RCD SEG   0822 73800020
         BNZ   QNK6407                  BRANCH IF NOT END          0916 74000020
         BAL   R13,QNK91                WRITE OUT CURRENT SEG      0822 74200020
QNK6407  EQU   *                                                   0916 74400020
         BAL   R8,QNK95                 MOVE INV LIST TO RCD SEG   0822 74600020
         B     QNK6409                  CHECK FOR FILLED RCD SEG   0916 74800020
         SPACE 3                                                        75000020
QNK6408  EQU   *                                                   0916 75200020
         SR    R0,R1                    SUBTRACT LENGTH MOVED FROM 0822X75400020
                                        TOTAL LENGTH OF INV LIST   0822 75600020
         BP    QNK6407                  MOVE REST TO NEW RCD SEG   0916 75800020
         SPACE 3                                                        76000020
*CONTROL IS RETURNED HERE IF ANOTHER RECORD SEGMENT IS REQUIRED FOR0822 76200020
*THE REMAINDER OF THE INVITATION LIST                                   76400020
         SPACE                                                          76600020
         B     QNK6408                  CONTINUE MOVE            S22024 76800022
QNK6409  EQU   *                                                   0916 77000020
         BAL   R13,QNK90                CHECK FOR END OF REC SEG   0822 77200020
         SPACE 3                                                        77400020
         L     R1,CKPSAVE1              RESTORE REG                1020 77600020
QNK65    EQU   *                                                        77800020
         LA    R6,3(0,R6)               MOVE PAST ADDR FIELD IN TNT     78000020
         BCT   R1,QNK50                 SUBTRACT FROM NO.OF ENTRIES     78200020
         TM    CKPFLAGS,CKPOPNEN        TERMINAL SCAN DONE     @OX16402 78230000
         BO    ENDLOOP                  YES, MOVE AVT DATA     @OX16402 78260000
         OI    CKPFLAGS,CKPOPNEN        SET FOR TERM SCAN      @OX16402 78290000
         XI    CKPSWCH2,CKPSET2         INITIALIZE INV LIST SW @OX16402 78320000
         B     QNK47                    SCAN TERMINAL ENTRIES  @OX16402 78350000
         SPACE                                                          78400020
*END OF LOOP THROUGH TERMNAME TABLE                                     78600020
         SPACE                                                          78650020
ENDLOOP  EQU   *                                               @OX16402 78660000
         NI    CKPFLAGS,AVTEFF-CKPOPNEN   TURN OFF BIT         @OX16402 78670000
         LA    R0,CKPAVTLN              LENGTH OF AVT FIELDS       0208 78700020
         BAL   R13,QNK90                CHECK FOR END OF RECORD    0208 78750020
         SPACE 3                                                        78800020
*SIGNIFICANT AVT DATA                                                   78820020
         SPACE                                                          78840020
         USING CKPAVT,R10               AVT CHECK POINT FIELDS @Y17XACA 78850000
         MVC   CKPOPCON,AVTOPCON        PRI OP/CNTRL TERMINAL  @Y17XACA 78860000
         MVC   CKPOPCIN,AVTOPCIN        PRI OP/CNTRL TTCIN     @Y17XACA 78870000
         MVC   CKPINTLV,AVTINTLV          SYSTEM DELAY INTERVL @Y17XACA 78880000
         MVC   CKPBIT1(2),AVTBIT1       SYS DLY IN EFFECT(BIT3)@Y17XACAX78900000
                                        AND REUS ACTIVE-AVTBIT2    0525 78920020
         NI    CKPBIT1,AVTEFF-AVTRFULN  CLEAR BIT              @Y17XACA 78923000
         TM    AVTBIT3,AVTRFULN         IN SLOW DOWN            SA59171 78926022
         BZ    QNK80                    BRANCH IF NO            SA59171 78929022
         OI    CKPBIT1,AVTRFULN         SET SLOW DOWN IN CK REC@Y17XACA 78932000
QNK80    EQU   *                                                SA59171 78935022
         MVC   CKPNADDR(8),AVTNADDR     DISK QUEUES-REUSABLE,NO@Y17XACA 78940000
         MVC   CKPLODPT,AVTLODPT        REUS LODPT FIELD       @Y17XACA 78960000
         MVC   CKPSUBT(2),AVTSUBT       AVTSUBT & AVTIOTR      @Y17XACA 78980000
         MVI   CDRKEY,CDRTOTAL          INDICATE LAST SEGMENT           79000020
QNK81    EQU   *                                                        79200020
         LR    R1,R15                                                   79400020
         DROP  R15                                                      79600020
         USING IEDQNK,R1                CHANGE PROG BASE                79800020
         LA    R3,AVTCKELE              RESTORE ADDR OF REQ ELEMNT 1109 79900020
         C     R4,CKPEXCP                                               80000020
         LA    R15,CKPDIOR              OFFSET FOR DISK I/O ROUTINE     80200020
         BCR   8,R14                    BRANCH IF NOT 1ST SEGMENT       80400020
         LA    R15,CKPIOQM              OFFSET FOR I/O QUEUE MGR        80600020
         BR    R14                      RETURN TO CKPT EXECUTOR         80800020
         SPACE 3                                                        81000020
*SUBROUTINE TO CHECK FOR END OF DISK RECORD AND SAVE REGS IF END        81200020
         SPACE                                                          81400020
QNK90    EQU   *                                                        81600020
         DROP  R1                                                       81800020
         USING IEDQNK,R15                                               82000020
         SR    R11,R0                   SUB FIELD LNGTH FROM TOTAL      82200020
         BCR   10,R13                   RETURN IF NOT END OF RCD        82400020
         SH    R13,QNKEIGHT             ADJUST BRANCH RETURN ADDR       82600020
QNK91    EQU   *                                                        82800020
         SR    R13,R15                  GET RELATIVE ADDR-THIS         X83000020
                                        MODULE MIGHT BE RELOADED       X83200020
                                        INTO ANOTHER LOCATION           83400020
         MVI   CDRKEY,CDRTOTLC          SET KEY FOR CONTINUED SEG       83600020
         STM   R13,R11,CKPSAVE1+8       SAVE REGS UNTIL NEXT SEG IS    X83800020
                                        BUILT                           84000020
         B     QNK81                    RETURN TO EXECUTOR              84200020
         SPACE 3                                                        84400020
         SPACE 3                                                        84600020
*SUBROUTINE TO MOVE OPTION DATA OR INVITATION LISTS TO RECORD SEG  0822 84800020
         SPACE                                                          85000020
QNK95    EQU   *                                                   0822 85200020
         ST    R11,CKPSAVE2             SAVE REG                   1006 85400020
         CR    R11,R0                   COMPARE LENGTHS            1006 85600020
         BL    QNK9505                  BRANCH IF INV LIST IS TOO  1006X85800020
                                        LARGE TO FIT IN THIS SEG   1006 86000020
         LR    R11,R0                   USE LENGTH OF LIST FOR MOVE1006 86200020
QNK9505  EQU   *                                                   1006 86400020
         LR    R13,R11                  COPY REMAINING RCD LENGTH  0725 86600020
         SRL   R11,8                    GET NO. OF EXECUTES REQUIRD0725 86800020
         LA    R11,1(R11)               ADD 1 TO COUNT OF EXECUTES 0728 87000020
         N     R13,QNK000F              CLEAR ALL BUT LAST BYTE    0725 87200020
QNK96    EQU   *                                                   0822 87400020
         BCTR  R13,0                    SUBTRACT 1 FOR EXECUTE INST0725 87600020
         EX    R13,QNKMOVEO             MOVE OPTIONS TO DISK RCD   0725 87800020
         LA    R7,1(R7,R13)             ADD LENGTH TO ADDR OF OPTON0822 88000020
         LA    R10,1(R10,R13)           ADD LENGTH TO ADDR OF RCD  0725 88200020
         LA    R13,QNKMOVEL             GET MAX LENGTH FOR EXECUTE 0725 88400020
         BCT   R11,QNK96                CHECK FOR ANOTHER EX REQURD0822 88600020
         L     R11,CKPSAVE2             RESTORE REG                1006 88800020
         BR    R8                       RETURN                     0916 89000020
         SPACE                                                          89200020
*END OF SUBROUTINE                                                      89400020
         SPACE 3                                                        89600020
QNK3705  EQU   *                                               @Y17XACT 89610000
         CLI   TRMTYPE,TRMSSCP          SSCP                   @ZM47916 89613000
         BE    QNK65                    YES NO FURTHER PROCESS @ZM47916 89616000
         CLI   TRMTYPE,TRMLNCP             NCP TYPE            @Y17XACT 89640000
         BNE   INVLIST                  PROCESS INV LIST       @Y17XACT 89650000
         LA    R0,ONE                   DATA LENGTH            @Y17XACT 89660000
         BAL   R13,QNK90                END OF REC             @Y17XACT 89670000
         MVI   0(R10),X'00'             CLEAR NEXT BYTE        @Y17XACT 89680000
         USING IEDQQCB,R7                                      @Y17XACT 89690000
         L     R7,TRMDESTQ-1            GET QCB ADDR           @Y17XACT 89700000
         L     R7,QCBDCBAD-1            GET DCB ADDR           @Y17XACT 89710000
         USING IHADCB,R7                                       @Y17XACT 89720000
         TM    DCBOFLGS,DCBOFOPN        DCB OPEN               @Y17XACT 89730000
         BZ    NOTOPEN                  BR,IF NOT OPEN         @Y17XACT 89740000
         SR    R8,R8                    CLEAR REG 8            @Y17XACT 89741000
         IC    R8,DCBEIOBX              CALCULATE..            @Y17XACT 89742000
         A     R8,DCBIOBAD                      ADDR OF...     @Y17XACT 89743000
         SH    R8,LCBBCKUP                             LCB     @Y17XACT 89744000
         USING IEDQLCB,R8                                      @Y17XACT 89745000
         TM    LCBSTAT2,LCBTRACE        TRACE INDICATED        @Y17XACT 89746000
         BNO   NOTOPEN                  NO,BRNCH AROUND        @Y17XACT 89747000
         OI    0(R10),LCBTRACE          SET TRACE BIT          @Y17XACT 89750000
NOTOPEN  EQU   *                                               @Y17XACT 89760000
         AR    R10,R0                   BUMP DISK POSTION      @Y17XACT 89770000
         B     QNK65                    DONE FOR NCP           @YM06868 89775000
         DS    0F                       WORD BNDRY                 0725 89800020
QNK000F  DC    X'000000FF'              MASK TO CLEAR ALL BUT LAST 0725 90000020
QNKNOPT  EQU   QNK000F+2                INDICATES UNUSED OPTION FLD1109 90100020
QNKMOVEO EQU   *                        MOVE OPTION DATA           0822 90200020
QNKMOVE  MVC   0(0,R10),0(R7)           MOVE INVITATION LIST       0822 90400020
QNKCOMPR CLI   DCBILCT,0                CHECK FOR INV LIST FOR REL 1209 90500020
CKRLN    CLI   DEBNMEXT-DEBNMSUB(R8),0  CK EXTS AGAINST RLN     SA56611 90550004
QNKEIGHT DC    H'8'                     USED TO ADJUST BRANCH ADDR      90600020
THREE    EQU   3                        LENGTH OF MOVE           S22024 90606022
TRMBCKUP DC    AL2(IEDQTRM-IEDNTRM)     LENGTH OF 3705 PREFIX    S22024 90612022
TEN      EQU   10                       BSC CONTROL AREA LNGTH  SA57661 90620022
EOTBIT   EQU   X'80'                    EOT-FE (BSC) IN INVLIST SA57661 90640022
X80      EQU   X'80'                    FLAG FOR BUFSIZE       @OZ26495 90644082
X60      EQU   X'60'                    FLAG FOR DIAL/ADDR     @OZ26495 90648082
X40      EQU   X'40'                    FLAG FOR DIAL DIGITS   @OZ26495 90652082
X20      EQU   X'20'                    FLAG FOR ADDR CHAR     @OZ26495 90656082
INVENTS  EQU   0                        OFFSET TO NO. OF ENTRIES A47151 90660022
INVSTAT  EQU   3                        OFFSET TO LIST STATUS    A47151 90720022
LCBBCKUP DC    AL2(LCBFLAG1-IEDQLCB)    LCB BACK UP VALUE      @Y17XACT 90780000
         SPACE 3                                                        90800020
         TAVTD                                                          91200020
         TCKPD 3330                     MERLIN VERSION OF DSECT         91400000
         TTNTD                                                          91600020
         TTRMD                                                          91800020
         TQCBD                                                          92000020
         TLCBD                                                          92200020
         DCBD  DSORG=TX                                                 92400020
         TPRIOR                                                         92500020
         TDEBD                                                          92550022
         EJECT                                                          92560005
         TPEWAD                                                         92570005
         EJECT                                                          92580005
         TPRFD                                                          92590005
         END                                                            92600020
