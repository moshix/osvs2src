OA TITLE '''IEDQOA''-LINKOR FROM INTRO'                                 00030000
IEDQOA   CSECT                                                          00060000
*A-000000-999999                                               @G36XRNP 00090000
*CHANGE ACTIVITY= AS FOLLOWS:                                           00120000
*A021000,539000                                                  S21903 00150000
*C479000,508000,869200,869600-870800,871200,872600,873000,873400 S21903 00180000
*C873600,873550,874300-874400,875000-875200,876200-876400,877300 S21903 00210000
*C878000                                                         S21903 00240000
*D028000,485000,828600                                           S21903 00270000
*A808600                                                         A48270 00300000
*C508000                                                         A48270 00330000
*D810200-810400                                                  A48270 00360000
*A014000,077000,273000,351000,371000,385000,451000,497000,654000 CLUP21 00390000
*C806800,818000                                                  S22026 00420000
*A293100-293600,372000,391000-394000,415000-416000,431000-432000 S22026 00450000
*A444000-446000,453000-454000,471000-473000,824072-824359        S22026 00480000
*A775820-775940                                                  S22026 00510000
*C508000,777000                                                  S22026 00540000
*D761000-761400                                                  S22026 00570000
*A863209-863389,873500-873550,874300,877300,879660-879720        S22026 00600000
*A304000-309000,412000,498000,689600,710402-710570,866900,873700 S22027 00630000
*A875500,878100,879060                                           S22027 00660000
*C508000                                                         S22027 00690000
*C042000,175000-203000,301000-308000,343000-350000,399000        CLUP21 00720000
*C413000-441000,455000,469000,483000-490000,504000,602000-616000 CLUP21 00750000
*C630000-651000                                                  CLUP21 00780000
*D231000-252000,280000-287000,392000,588000,658000-952000        CLUP21 00810000
*C581000,770800,790400-790600,800400,830800,837400,866200,866000 S22025 00840000
*A812800,813400                                                 SA51787 00870000
*A394000,648800,860800,862400                                    X01004 00900000
*C663600-664200,664800,665400-667800,670200,678000-710400,              00930000
*C853200,866800                                                  X01004 00960000
*D650400-651000,661000-661800,864400                                    00990000
*A648870                                                         Y01004 01020000
*A648830,866880                                                  X02004 01050000
*C648860-648870,670200,678800,709000-710600                      X02004 01080000
*A824319                                                        SA54926 01110000
*C508000                                                         S22024 01140000
*D746800                                                         S22024 01170000
*A747000,783800,876600                                           S22024 01200000
*C678639,678645-678747                                           Y05330 01230000
*D866850                                                         Y05330 01260000
*A835800                                                        SA64692 01290000
*D839400-844000                                                 SA64692 01320000
*A581000,649400,664290,665600,666950,853200,866960,878400,879060,X03039 01350000
*A879400                                                         X03039 01380000
*C042000,670200,678800-679000,780600                             X03039 01410000
*D678606-678774,725804-725988,873800,876640-876710               X03039 01440000
*C679005,679015,879460                                         @XA07498 01470000
*C678832,678850,679080                                         @X50X9NI 01500000
*A683900                                                       @X50X9NI 01530000
*A663000                                                       @YA07705 01560000
*A664112,664120                                                @ZA02084 01590000
*A648940,878100                                                @ZA02084 01620000
*A826600,856000,878100,868800                                  @YA10680 01650000
*C868900                                                       @AS09138 01680000
*A775860,886900                                                @OY12967 01710000
*A360000,414000,422000,434000,442000,448000,452000             @Y17XANG 01740000
*A454000,473000,648940,678870,678965,679010,806800,879060,     @Y17XANG 01770000
*A8668815,880000,783000,808720,811800                          @Y17XANG 01800000
*C649440,649520,664292,664296,665610,665630,666960,666980      @Y17XANG 01830000
*C678810,678831,678845,678855,678905,678925,679000,770800      @Y17XANG 01860000
*C697400,866815,866980                                         @Y17XANG 01890000
*D582000-588000,648943,648947,666970                           @Y17XANG 01920000
*D678875-678895,678970-678975,679015-679065,866960             @Y17XANG 01950000
*D867200-869600                                                @Y17XANG 01980000
*C726600-726800                                                @OY14517 02010000
*       TCAM LEVEL 10.0 MVS CHANGES                            @G36XRNP 02040000
*A664260,745600,826678,866845,869522,663656,648814             @G36XRNP 02070000
*C683918,866820,648814                                         @G36XRNP 02100000
*D648828-648884,648898-648905,826684-826756,866994             @G36XRNP 02130000
*D863218-863389                                                @G36XRNP 02160000
*C477000                                                       @OY18827 02170000
*                                                              @G36XRNP 02190000
*A161100,166800                                                @OY19124 02190182
*C184200-196800,744600-748500                                  @OY19405 02190282
*A183300,198900,765300                                         @OY19405 02190382
*A418500                                                       @OZ29219 02190482
*D540600-541500                                                @OY20289 02190582
*C544800-545100                                                @OY20289 02190682
*****************************************************************S21903 02220000
*                                                                     * 02250000
*MODULE-NAME= IEDQOA   (TCAM,INITIALIZATION)                   @G36XRNP 02280000
*                                                                S21903 02310000
*DESCRIPTIVE-NAME= GETMAIN, SORT, AND ATTACH ROUTINE             S21903 02340000
*                                                                S21903 02370000
*COPYRIGHT= 'NONE'                                               S21903 02400000
*                                                                     * 02430000
*STATUS -- CHANGE LEVEL 10.0                                   @G36XRNP 02460000
*                                                                     * 02490000
*FUNCTION -- THIS MODULE IS TO HANDLE ALL NON-RESIDENT ROUTINES       * 02520000
*   WHICH DO THE INITIAL PROCESSING AT INTRO EXECUTION TIME.  A       * 02550000
*   MESSAGE IS TYPED WHICH CONTAINS AN ERROR CODE NUMBER WHICH IS     * 02580000
*   THE SAME AS THE RETURN CODE PASSED FROM INTRO TO USER'S           * 02610000
*   NEXT INSTRUCTION. THE FUNCTIONS OF THIS ROUTINE INCLUDE:     CLUP21 02640000
*                                                                CLUP21 02670000
*        1 - LINKING TO THE INTRO CONSOLE COMMUNICATIONS ROUTINE CLUP21 02700000
*            (IEDQOB) TO OBTAIN NEW VALUES FOR THOSE INTRO       CLUP21 02730000
*            VALUES SPECIFIED OR OMITTED AT ASSEMBLY TIME.       CLUP21 02760000
*                                                                CLUP21 02790000
*        2 - SCRAMBLING THE 8-CHARACTER PASSWORD IF ONE HAS BEEN CLUP21 02820000
*            SPECIFIED.                                          CLUP21 02850000
*                                                                CLUP21 02880000
*        3 - OBTAIN MAIN STORAGE FOR LINE BUFFERS, A CORE QUEUE  CLUP21 02910000
*            DATA SET IF NECESSARY, CHANNEL PROGRAM BLOCKS,      S22027 02940000
*            TRACE TABLES REQUESTED BY THE USER, AND COMMBUF     S22027 02970000
*            STCB'S, DATA AREAS,AND MASTER QCB, IF REQUESTED.    S22027 03000000
*                                                                CLUP21 03030000
*        4 - SORTING THE TERMNAME TABLE INTO ALPHABATICAL        CLUP21 03060000
*            SEQUENCE. THE TERMNAME TABLE OFFSETS FOR DISTRI-    CLUP21 03090000
*            BUTION LISTS, CASCADE LISTS, LINE ENTRIES, AND      CLUP21 03120000
*            INVITATION LISTS, AS WELL AS ALTERNATE DESTINATION  CLUP21 03150000
*            OFFSETS ARE RE-CALCULATED. ALL ALTERNATE DESTIN-    CLUP21 03180000
*            ATIONS ARE TESTED FOR ACCEPT CAPABILITIES. CERTAIN  CLUP21 03210000
*            FIELDS IN THE TERMNAME TABLE NECESSARY FOR THE      CLUP21 03240000
*            BINARY SEARCH ROUTINE ARE INITIALIZED, AND CHECKS   CLUP21 03270000
*            ARE MADE FOR THE PRESENCE OF A PRIMARY OPERATOR     CLUP21 03300000
*            CONTROL TERMINAL. IF A DEAD LETTER QUEUE IS DEFINED,CLUP21 03330000
*            THE NUMBER WITHIN THE TERMNAME TABLE OF THE DLQ     CLUP21 03360000
*            ENTRY IS DETERMINED AND SAVED IN THE AVT.           CLUP21 03390000
*                                                                CLUP21 03420000
*        5 - UNCONDITIONAL ATTACHMENT OF THE OPERATOR CONTROL    CLUP21 03450000
*            MODULE AND CONDITIONAL ATTACHMENT OF THE ON-LINE    CLUP21 03480000
*            TEST MODULE AND COMMON WRITE MODULE. EXTRACT AND    CLUP21 03510000
*            QEDIT MACRO EXPANSIONS SET UP THE COMMUNICATIONS    CLUP21 03540000
*            PARAMETER LIST INTERFACE BETWEEN TCAM AND THE       CLUP21 03570000
*            OPERATING SYSTEM. IF A SYSTEM DELAY INTERVAL IS     CLUP21 03600000
*            SPECIFIED THE SYSTEM DELAY ROUTINE IS LOADED. IF A  CLUP21 03630000
*            PRIMARY OPERATOR CONTROL TERMINAL IS DEFINED THE    CLUP21 03660000
*            OPERATOR AWARENESS MESSAGE ROUTER ROUTINE IS LOADED.CLUP21 03690000
*                                                              @Y17XANG 03720000
*        6 - ESTABLISHMENT OF GROUP-LINE TERMINAL TABLE        @Y17XANG 03750000
*            HIERARCHIES. THIS CONSISTS OF:                    @Y17XANG 03780000
*                                                              @Y17XANG 03810000
*                - CHAINING THE GROUP LGB TO ITS FIRST LINE    @Y17XANG 03840000
*                  VIA THE LGB SUBSTRUCT POINTER;              @Y17XANG 03870000
*                                                              @Y17XANG 03900000
*                - SUBSEQUENT LINE TO NEXT LINE VIA COHORT     @Y17XANG 03930000
*                  POINTER;                                    @Y17XANG 03960000
*                                                              @Y17XANG 03990000
*                - LAST LINE'S COHORT POINTER BACK TO THE LGB. @Y17XANG 04020000
*                                                              @Y17XANG 04050000
*            THIS IS DONE FOR EACH 3705 LINE GROUP.  3705 LINE @Y17XANG 04080000
*            GROUPS TRANSCEND 3705 SUBAREAS.                   @Y17XANG 04110000
*                                                                       04140000
*                                                                     * 04170000
*ENTRY POINT -- THERE IS ONE ENTRY POINT, LINKED TO BY INTRO          * 04200000
*        'IEDQOA' -- LINKOR                                           * 04230000
*   CALLING SEQUENCE -                                                * 04260000
*        LA    R1,AVT         PASS ADDR OF AVT IN R1                  * 04290000
*        LINK  EP=IEDQOA      IEDQOA RESIDES ON LINKLIB               * 04320000
*                                                                     * 04350000
*INPUT -- R1 HAS ADDR OF AVT.                                         * 04380000
*   R13 HAS ADDR OF 18 WORD SAVEAREA.                                 * 04410000
*   R15 HAS ADDR OF ENTRY POINT.                                      * 04440000
*   R14 HAS ADDR OF RETURN ADDRESS.                                   * 04470000
*                                                                     * 04500000
*OUTPUT -- SCRAMBLED PASSWORD, LINE BUFFERS, A CORE QUEUE DATA   CLUP21 04530000
*   SET, CHANNEL PROGRAM BLOCKS, NECESSARY TRACE TABLES, SORTED  CLUP21 04560000
*   TERMNAME TABLE WITH ADJUSTED OFFSETS, REQUESTED SUBTASKS     CLUP21 04590000
*   ATTACHED, AND REQUIRED ROUTINES LOADED.                      CLUP21 04620000
*                                                                     * 04650000
*EXTERNAL ROUTINES -- ALL ARE ACTIVATED WITH 'LINK'.                  * 04680000
*        'IEDQOB' -- WTOR INTERPRETER                                 * 04710000
*                                                                     * 04740000
*EXITS-NORMAL -- NO ERROR FOUND BY ANY SUBROUTINE.  R15 IS ZERO.      * 04770000
*                                                                     * 04800000
*EXITS-ERROR -- THE ERROR CODE IS RETURNED TO THE CALLER IN      CLUP21 04830000
*   REGISTER 15 AND THE MESSAGE 'IED065I INITIALIZATION ERROR    CLUP21 04860000
*   XXXX' IS DISPLAYED. ERROR CODES ARE:                         CLUP21 04890000
*                                                                CLUP21 04920000
*       04 - TCAM ALREADY ACTIVE.                                CLUP21 04950000
*                                                                CLUP21 04980000
*       08 - GETMAIN FAILURE.                                    CLUP21 05010000
*                                                                CLUP21 05040000
*       12 - GETMAIN FAILURE.                                    CLUP21 05070000
*                                                                CLUP21 05100000
*       16 - TERMINAL DEFINITION ERROR. THE DIAGNOSTIC 'IEDQ065I CLUP21 05130000
*            XXXXXXXX ILLEGAL DESTINATION' WILL BE DISPLAYED.    CLUP21 05160000
*            THE XXXXXXXX FIELD IS THE TERMINAL NAME.            CLUP21 05190000
*                                                                CLUP21 05220000
*       20 - ERROR IN DEFINITION OF THE PRIMARY OPERATOR CONTROL CLUP21 05250000
*            TERMINAL. E. G., THE DESIGNATED TERMINAL COULD NOT  CLUP21 05280000
*            BE FOUND IN THE TERMNAME TABLE, OR IT DID NOT HAVE  CLUP21 05310000
*            SEND AND ACCEPT CAPABILITIES, OR IT WAS NOT DEFINED CLUP21 05340000
*            AS BEING A POSSIBLE SECONDARY OPERATOR CONTROL      CLUP21 05370000
*            TERMINAL, ETC.                                      CLUP21 05400000
*                                                                S22026 05430000
*       24 - ERROR IN SORTING THE DEVICE ID TABLE.  THE TNT      S22026 05460000
*            OFFSET IN THE DEVICE ID TABLE NOT FOUND IN THE      S22026 05490000
*            OFFSET TABLE, OR THE DEVICE DEPENDENT FIELD         S22026 05520000
*            POINTING TO THE DEVICE ID TABLE FOR A CONCENTRATOR  S22026 05550000
*            TERMINAL ENTRY DID NOT INDICATE A CONCENTRATOR.     S22026 05580000
*                                                                     * 05610000
*       28 - AUTHORIZATION ERROR. SOMEONE HAS ATTEMPTED TO     @G36XRNP 05640000
*            START AND UNAUTHORIZED MCP. E.G. THE MCP WAS NOT  @G36XRNP 05670000
*            RUNNING UNDER PROTECT KEY 6                       @G36XRNP 05700000
*                                                              @G36XRNP 05730000
*TABLES/WORKAREA -- AVT                     TNT                @G36XRNP 05760000
*                   TERMINAL ENTRY          LCB                @G36XRNP 05790000
*                   QCB                     DEVICE ID TABLE    @G36XRNP 05820000
*                   CPB                     ACB                @G36XRNP 05850000
*                   DCB                     CVT                @G36XRNP 05880000
*                   COMMON BUFFER MASTER QCB                   @G36XRNP 05910000
*                                                                     * 05940000
*ATTRIBUTES -- SERIALLY REUSABLE, NON-RESIDENT, ENABLED,              * 05970000
*              PROBLEM PROGRAM MODE.                                  * 06000000
*                                                                     * 06030000
*NOTES -- THE OPERATION OF THIS MODULE DEPENDS UPON AN INTERNAL  CLUP21 06060000
*   REPRESENTATION OF THE EXTERNAL CHARACTER SET EQUIVALENT TO   CLUP21 06090000
*   THE ONE USED AT ASSEMBLY TIME. THE CODING HAS BEEN ARRANGED  CLUP21 06120000
*   SO THAT REDEFINITION OF 'CHARACTER' CONSTANTS AND REASSEMBLY CLUP21 06150000
*   WILL RESULT IN A CORRECT MODULE FOR THE NEW DEFINITIONS.     CLUP21 06180000
         EJECT                                                          06210000
* REGISTER EQUATES AND DEFINITIONS                               CLUP21 06240000
RTRM     EQU   15                       POINTER TO NEXT TNT ENTRY       06270000
RLGB     EQU   15                       RLGB OF CURRENT GROUP  @Y17XANG 06300000
R15      EQU   15                       ENTRY POINT ADDRESS             06330000
RDCB     EQU   14                       DCB DSECT BASE REGISTER         06360000
R14      EQU   14                       RETURN ADDRESS                  06390000
RTNTCTR  EQU   14                       TNT ENTRY COUNTER        S22026 06420000
RTNT     EQU   13                       TERMNAME TABLE DSECT BASE       06450000
R13      EQU   13                       SAVEAREA                        06480000
RBASE    EQU   12                       PROGRAM BASE                    06510000
RQCB     EQU   11                       QCB DSECT BASE REGISTER         06540000
RCTR1    EQU   11                       LOOP COUNTER             S22026 06570000
RLENDE   EQU   11                       LENGTH OF DVC TBL ENTRY  S22026 06600000
R11      EQU   11                                                X01004 06630000
R10      EQU   10                                                X01004 06660000
RCPB     EQU   10                       CPB DSECT BASE                  06690000
RAVT     EQU   9                        AVT DSECT BASE                  06720000
RFIRST   EQU   8                        ADDRESS OF FIRST TNT ENTRY      06750000
RCMB     EQU   8                        CMB DSECT BASE REGISTER  S22027 06780000
R8       EQU   8                        WORK REGISTER                   06810000
RGETM    EQU   8                        SORT WORK AREA BASE.   @Y17XANG 06840000
RTNTOFF  EQU   8                        ADDR OF TNT OFFSET       S22026 06870000
RLINK    EQU   7                        SUBRTN LINKAGE REGISTER  S22026 06900000
RGETAREA EQU   7                        OFFSET TABLE                    06930000
R7       EQU   7                        WORK REGISTER                   06960000
RNLINE   EQU   7                        ADDR OF CURRENT LINE   @Y17XANG 06990000
*                                       TTE TO GO INTO THE     @Y17XANG 07020000
*                                       HIERARCHY.             @Y17XANG 07050000
ROTNEXT  EQU   6                        POINTER TO NEXT OFFSET ENTRY    07080000
R6       EQU   6                        WORK REGISTER                   07110000
RWORK    EQU   6                        WORK REGISTER            S22026 07140000
RCTR2    EQU   6                        LOOP COUNTER             S22026 07170000
R5       EQU   5                        WORK REGISTER                   07200000
ROTNOW   EQU   5                        POINTER TO THIS OFFSET ENTRY    07230000
RTBL     EQU   5                        CURRENT SORT TABLE     @Y17XANG 07260000
*                                       ENTRY - FORWARD SORT.  @Y17XANG 07290000
RLEN     EQU   4                        LENGTH OF A TERMNAME ENTRY      07320000
R4       EQU   4                        WORK REGISTER                   07350000
RCURR    EQU   4                        CURRENT SORT TABLE     @Y17XANG 07380000
*                                       ADDRESS.               @Y17XANG 07410000
RLENTN   EQU   4                        LENGTH OF TERMINAL NAME  S22026 07440000
RIDCNT   EQU   3                        DVC ID TABLE COUNT       S22026 07470000
R3       EQU   3                        SAVES ERROR CODE                07500000
RTNT2    EQU   3                        ADDRESS CURRENT TNT    @Y17XANG 07530000
*                                       LINE SEARCH            @Y17XANG 07560000
REOT     EQU   3                        LAST SORT TABLE ENTRY  @Y17XANG 07590000
R2       EQU   2                        WORK REGISTER                   07620000
R1ST     EQU   2                        1ST LINE ENTRY IN SORT @Y17XANG 07650000
*                                       TABLE.                 @Y17XANG 07680000
RFLD     EQU   2                        ADDR OF DVC DEP FIELD    S22026 07710000
RIDPTR   EQU   2                        DVC ID TABLE POINTER     S22026 07740000
RTNT1    EQU   2                        ADDRESS CURRENT TNT    @Y17XANG 07770000
*                                       IN LGB SEARCH.         @Y17XANG 07800000
RPRESENT EQU   1                        POINTER TO PRESENT OFFSET NTRY  07830000
R1       EQU   1                        ADDR OF AVT,PASSED TO SUBROUT   07860000
R0       EQU   0                        WORK REGISTER                   07890000
RFLGS    EQU   0                        DVC DEPENDNT FIELD FLAGS S22026 07920000
RSVADR   EQU   0                        SAVE-ADDRESS REGISTER    S22026 07950000
*                                       TABLE                  @Y17XANG 07980000
ADDR     EQU   7                        MASK TO ICM ADDRESS L'3@Y17XANG 08010000
         USING *,R15                    TEMPORARY ADDRESSIBILITY S21903 08040000
         USING IEDQAVTD,RAVT            AVT DSECT                       08070000
         USING IEDQTNTD,RTNT            TERMNAME TABLE DSECT            08100000
         USING IHADCB,RDCB              DCB DSECT                       08130000
         USING IEDQCPB,RCPB             CPB DSECT                       08160000
         USING IEDCMB,RCMB              CMB DSECT BASE REGISTER  S22027 08190000
         EJECT                                                          08220000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       08250000
*                                                                       08280000
*        THIS SECTION OF CODE SAVE THE CALLER'S REGISTERS, CHAINS       08310000
*        SAVEAREAS, AND LINKS TO IEDQOB TO GET INTRO PARAMETERS         08340000
*                                                                       08370000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       08400000
*                                                                       08430000
IEDQOA   IEDHJN  START                                           S21903 08460000
         SAVE  (14,12)                  SAVE CALLER'S REGISTERS  S21903 08490000
         LA    R2,2*AVTSVSIZ(R1)        GET ADDR OF AVTSAVE3            08520000
         ST    R13,4(R2)                CHAIN                           08550000
         ST    R2,8(R13)                  SAVEAREAS                     08580000
         LR    R13,R2                   SET AVT BASE                    08610000
         LR    RBASE,R15                SET PROGRAM BASE                08640000
         DROP  R15                                                      08670000
         USING IEDQOA,RBASE             CSECT ADRRESSABILITY     S21903 08700000
         USING IEDQTRM,RTRM             TRM ADDRESSIBILITY       S21903 08730000
         LR    RAVT,R1                  SAVE AVT ADDR                   08760000
*                                                                       08790000
         LINK  MF=(E,(1)),SF=(E,LINKOB) CALL WTOR INTERPRETER           08820000
*                                                                       08850000
         LTR   R15,R15                  TEST RETURN CODE                08880000
         BNZ   ERROR                    BRANCH IF ERROR          S22025 08910000
         CLC   AVTPASWD,NOPASS          WAS PASSWRD SPECIFIED           08940000
         BE    SKIP                     NO, SKIP SCRAMBLING             08970000
         LA    R1,AVTPASWD              PASS ADDR OF 8 CHAR WORD        09000000
         LA    R2,WORK(R13)             WORDS 6 AND 7 OF SAVE AREA      09030000
*                                         ARE WORKAREA                  09060000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       09090000
*                                                                       09120000
*        THIS SECTION OF CODE SCRAMBLES THE SPECIFIED PASSWORD          09150000
*                                                                       09180000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       09210000
*                                                                       09240000
         MVC   2(1,R2),1(R1)                                            09270000
         MVC   5(1,R2),0(R1)            RANDOM                          09300000
         MVC   3(2,R2),6(R1)            CHARACTER                       09330000
         MVC   0(2,R2),2(R1)            ARRANGEMENT                     09360000
         MVC   6(2,R2),4(R1)                                            09390000
*                                                                       09420000
         LA    R3,NUM                   TRAILING DECISION COUNT FOR     09450000
*                                         EIGHT ITERATIONS              09480000
LOOPIT   EQU   *                                                        09510000
         NI    0(R2),NR                 TURN OFF BIT 1                  09540000
         XI    0(R2),XR                 FLIP BITS 4 THROUGH 7           09570000
         LA    R2,1(R2)                 GET NEXT CHARACTER              09600000
         BCT   R3,LOOPIT                REITERATE UNTIL DONE            09630000
         MVC   AVTPASWD(8),WORK(R13)    SAVE SCRAMBLED RESULTS          09660000
         EJECT                                                          09690000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       09720000
*                                                                       09750000
*        THIS SECTION OF CODE STORES THE TCB ADDRESS IN THE AVT         09780000
*                                                                       09810000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       09840000
*                                                                       09870000
SKIP     EQU   *                                                        09900000
         L     R1,CVTPTR                ADDRESS OF THE CVT       X02004 09930000
         L     R1,0(,R1)                ADDRESS OF THE TCB POINTER      09960000
         L     R1,4(,R1)                ADDRESS OF THE TCB              09990000
         ST    R1,AVTTCB                STORE TCB ADDRESS IN AVT        10020000
*                                                                       10050000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       10080000
*                                                                       10110000
*        THIS SECTION OF CODE BUILDS ALL LINE BUFFERS                   10140000
*                                                                       10170000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       10200000
*                                                                       10230000
         SR    R5,R5                    CLEAR LENGTH OF I/O TRACEX01004 10260000
         L     R3,PAGESIZE              SIZE OF MVS PAGE       @G36XRNP 10290000
         OI    AVTPKF,AVTFTCHF          SET FETCH PROTECT ACTIVE Y01004 10320000
         USING IEDQQCB,RQCB             QCB DSECT BASE REGISTER  X02004 10350000
         SR    R7,R7                    CLEAR I/O TRACE LENGTH   X01004 10380000
         CLC   AVTRACE,AVTFZERO         USER REQUESTED TRACE AREAX01004 10410000
         BE    BLDLBUF                  NO, BRANCH               X01004 10440000
         LA    R7,IOTRCSIZ              SIZE OF 1 TRACE ENTRY    X01004 10470000
         L     R5,AVTRACE               # TRACE ENTRIES        @Y17XANG 10500000
         LA    R5,THREE(R5)             MAKE MODULO 4          @Y17XANG 10530000
         SRL   R5,TWO                                          @Y17XANG 10560000
         SLL   R5,TWO                                          @Y17XANG 10590000
         ST    R5,AVTRACE               SAVE ENTRIES MOD 4     @Y17XANG 10620000
         M     R6,AVTRACE               MULTIPLY SIZE OF ENTRY @Y17XANG 10650000
*                                       NUMBER OF ENTRIES        X01004 10680000
         LA    R5,THRTTWO(R7)           ADD CONTROL INFORMATION  X01004 10710000
BLDLBUF  EQU   *                                                 X01004 10740000
         LR    R6,R3                    COPY PAGE SIZE           X01004 10770000
         SR    R3,R3                    CLEAR A COUNT REGISTER          10800000
         LH    R1,AVTKEYLE              SIZE OF 1 UNIT RECORD           10830000
         LA    R1,AVTUMALN(,R1)         ADD PREFIX SIZE                 10860000
         TM    AVTSAVTF,AVTVTMCP        3705 IN SYSTEM?        @Y17XANG 10890000
         BZ    NOLCCWS                  BR NO                    X03039 10920000
         LA    R1,LCCWSZ(,R1)           ADD SIZE OF NEG BUFFER @Y17XANG 10950000
*                                       PREFIX.                @Y17XANG 10980000
NOLCCWS  EQU   *                                                 X03039 11010000
         LA    R1,ROUND(,R1)            ROUND UP THE UNIT SIZE TO       11040000
         SRL   R1,THREE                 THE NEXT DOUBLE WORD            11070000
         SLL   R1,THREE                 BOUNDARY                        11100000
         LR    R8,R1                    SAVE BUFFER SIZE                11130000
*                                                                       11160000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       11190000
*                                                                       11220000
*        TEST FOR CORE QUEUE PARAMETERS                                 11250000
*                                                                       11280000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       11310000
*                                                                       11340000
         TM    AVTBIT1,AVTAQTAN         ARE CORE CONSTANTS IN AVT       11370000
         BZ    AVTGET                   NO, FORGET CORE CONSTANTS       11400000
         CLC   AVTTOTNC,AVTFZERO        HAS THE USER REQUESTED A        11430000
*                                         CORE DATA SET                 11460000
         BE    AVTGET                   NO, FORGET CORE QUEUE           11490000
         EJECT                                                          11520000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       11550000
*                                                                       11580000
*        CALCULATE THE MAXIMUM AND MINIMUM THRESHOLD VALUES             11610000
*                                                                       11640000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       11670000
*                                                                       11700000
         LA    R2,PERCENT               LOAD THE PERCENTAGE FACTOR      11730000
         SR    R0,R0                    CLEAR  MULTIPLICATION REG.      11760000
         L     R1,AVTCMIN               LOAD THE MINIMUM THRESHOLD      11790000
*                                         VALUE                         11820000
         M     R0,AVTTOTNC              MULTIPLY BY THE NUMBER OF       11850000
*                                         CORE RECORDS                  11880000
         DR    R0,R2                    DIVIDE THE MINIMUM NUMBER       11910000
*                                         OF CORE RECORDS BY 100        11940000
         LTR   R0,R0                    IS THERE A REMAINDER            11970000
         BE    SKIP1                    NO, SKIP THE NEXT               12000000
*                                         INSTRUCTION                   12030000
         LA    R1,ONE(R1)               INCREMENT THE MINIMUM COUNT     12060000
*                                                                       12090000
SKIP1    EQU   *                                                        12120000
         ST    R1,AVTCMIN               STORE THE MINIMUM VALUE         12150000
         SR    R0,R0                    CLEAR ANY REMAINDER             12180000
         L     R1,AVTCMAX               LOAD THE MAXIMUM THRESHOLD      12210000
*                                         VALUE                         12240000
         M     R0,AVTTOTNC              MULTIPLY BY THE NUMBER OF       12270000
*                                         CORE RECORDS                  12300000
         DR    R0,R2                    DIVIDE THE MAXIMUM NUMBER       12330000
*                                         OF CORE RECORDS BY 100        12360000
         LTR   R0,R0                    IS THERE A REMAINDER            12390000
         BZ    SKIP2                    NO, SKIP THE NEXT               12420000
*                                         INSTRUCTION                   12450000
         LA    R1,ONE(,R1)              INCREMENT THE MAXIMUM COUNT     12480000
*                                                                       12510000
SKIP2    EQU   *                                                        12540000
         ST    R1,AVTCMAX               STORE THE MAXIMUM THRESHOLD     12570000
*                                         VALUE                         12600000
         L     R3,AVTTOTNC              LOAD THE NUMBER OF CORE         12630000
*                                         BUFFERS REQUESTED             12660000
         EJECT                                                          12690000
AVTGET   EQU   *                                                        12720000
         AH    R3,AVTNOLBF              ADD TO THIS THE NUMBER OF       12750000
*                                         LINE BUFFER UNITS             12780000
         N     R3,AVTCLRHI              CLEAR HI ORDER 2 BYTES @YA07705 12810000
         STH   R3,AVTAVFCT              STORE IN THE AVAILABLE          12840000
*                                         BUFFER FIELD OF THE AVT       12870000
         SR    R1,R1                    CLEAR LENGTH ACCUMULATOR X01004 12900000
MOREPAGE AR    R1,R6                    BUMP CORE NEEDED BY PAGE X01004 12930000
         CR    R5,R1                    I/O TRACE FIT            X01004 12960000
         BH    MOREPAGE                 NO, BUMP CORE NEEDED     X01004 12990000
         LR    R10,R1                   COPY CORE REQUIRED       X01004 13020000
         SR    R10,R5                   FIND EXTRA CORE AVAILABLEX01004 13050000
         LR    R5,R10                   SAVE EXTRA CORE FOR      X01004 13080000
*                                         I/O TRACE              X01004 13110000
PADCHECK EQU   *                                               @G36XRNP 13140000
         CH    R10,H8                   ENOUGH CORE LEFT IN    @G36XRNP 13170000
*                                       PAGE FOR PADDING FOR   @G36XRNP 13200000
*                                       FOR ERRORMSG BFR ACTING@G36XRNP 13230000
*                                       AS QCB                 @G36XRNP 13260000
         BH    PADOK                    YES, BRANCH            @G36XRNP 13290000
         LR    R10,R6                   NEED NEW PAGE          @G36XRNP 13320000
         AR    R1,R6                    INCREMENT TOTAL PAGES  @G36XRNP 13350000
PADOK    EQU   *                                               @G36XRNP 13380000
         SH    R10,H8                   ALLOW FOR PADDING      @G36XRNP 13410000
MOREBUF  CR    R8,R10                   CORE LEFT IN PAGE FOR    X01004 13440000
*                                         THIS BUFFER            X01004 13470000
         BNH   BUFFIT                   YES, BRANCH              X01004 13500000
         LR    R10,R6                   NEED NEW PAGE            X01004 13530000
         AR    R1,R6                    BUMP TOTAL PAGES         X01004 13560000
         B     MOREBUF                  CHECK NEXT BUFFER        X01004 13590000
BUFFIT   EQU   *                                                 X01004 13620000
         SR    R10,R8                   DECREMENT AVAILABLE CORE X01004 13650000
         BCT   R3,MOREBUF               CHECK NEXT BUFFER        X01004 13680000
         SR    R4,R4                    CLEAR SIZE OF CPB        X01004 13710000
         TM    AVTBIT1,AVTDISKN         DISK QUEVEING SUPPORTED  X01004 13740000
         BZ    GETPBNDY                 NO, BRANCH               X01004 13770000
         LA    R4,CPBSIZE-IEDQCPB       SIZE OF REGULAR CPB      X01004 13800000
         AR    R4,R8                    CPB + SIZE OF BUFFER     X01004 13830000
         LH    R11,AVTCPBNO             GET NUMBER OF CPB'S      X01004 13860000
         N     R11,AVTCLRHI             FORCE POSITIVE           X01004 13890000
MORECPB  EQU   *                                                 X01004 13920000
         CR    R4,R10                   WILL CPB FIT IN THIS PAGEX01004 13950000
         BNH   CPBFIT                   YES, BRANCH              X01004 13980000
         LR    R10,R6                   NEED NEW PAGE            X01004 14010000
         AR    R1,R6                    BUMP TOTAL PAGES         X01004 14040000
         B     MORECPB                  CONTINUE LOOP            X01004 14070000
CPBFIT   EQU   *                                                 X01004 14100000
         SR    R10,R4                   DECREMENT AVAILABLE CORE X01004 14130000
         BCT   R11,MORECPB              CHECK NEXT BUFFER        X01004 14160000
GETPBNDY EQU   *                                                 X01004 14190000
         LA    R0,FREEPTR               AREA TO HOLD CORE        X01004 14220000
         BAL   R14,AVTPAR1              GETMAIN FOR PAGE         X01004 14250000
         L     R0,AVTGETMN              GET LENGTH OF GOTTEN COREX01004 14280000
         L     R1,FREEPTR               ADDRESS OF GOTTEN CORE   X01004 14310000
         LR    R15,R0                   COPY LENGTH              X01004 14340000
         LR    R14,R1                   COPY GOTTEN CORE ADDRESS X01004 14370000
         STM   R14,R15,FBUFSAV          SAVE ADDRESS OF CORE ON  X01004 14400000
*                                        PAGE BOUNDARY AND       X01004 14430000
*                                        ITS LENGTH              X01004 14460000
CLEARCOR MVI   0(R14),AVTEZERO          CLEAR CORE               X01004 14490000
         LA    R14,ONE(R14)             INCREMENT ADDRESS        X01004 14520000
         BCT   R15,CLEARCOR             DECREMENT COUNT & BRANCH X01004 14550000
         ST    R14,FREEPTR+FOUR         SAVE ENDING ADDRESS      X01004 14580000
         ST    R6,0(R1)                 SET LENGTH               X01004 14610000
         LTR   R7,R7                    I/O TRACE TO BE USED     X01004 14640000
         BZ    BLDLBUF1                 NO, BRANCH               X01004 14670000
         LA    R11,SIXTEEN              ADD 16 BYTES FOR CONTROL X01004 14700000
         AR    R1,R11                   BUMP PAST CONTROL INFO.  X01004 14730000
         ST    R1,AVTRACE               SAVE ADDRESS OF TRACE    X01004 14760000
         LA    R10,SIXTEEN(R7,R1)       ADDRESS OF END OF TRACE  X01004 14790000
         ST    R10,FREEPTR              UPDATE AVAILABLE CORE PTRX01004 14820000
         ST    R5,0(R10)                SET NEW LENGTH           X01004 14850000
         LA    R0,0(R11,R1)             ADDRESS OF FIRST ENTRY   X01004 14880000
         SR    R10,R11                  COMPUTE ADDRESS OF LAST  X01004 14910000
*                                         ENTRY IN TRACE TABLE   X01004 14940000
         ST    R10,EIGHT(R1)            SAVE ADDR. OF LAST ENTRY X01004 14970000
         AR    R0,R11                   ALLOW FOR PREFIX       @ZA02084 15000000
         ST    R0,0(R1)                 ADDRESS OF CURRENT ENTRY X01004 15030000
         SR    R0,R11                   ADJUST FOR PREFIX      @ZA02084 15060000
         ST    R0,FOUR(R1)              ADDRESS OF FIRST ENTRY   X01004 15090000
         SRL   R7,ONE                   OFFSET TO MIDDLE ENTRY   X01004 15120000
         AR    R0,R7                    ADDRESS OF MIDDLE ENTRY  X01004 15150000
         ST    R0,TWELVE(R1)            SAVE MIDDLE ENTRY ADDRESSX01004 15180000
         TM    FIFTEEN(R1),BOUND8       IS MIDDLE ON 8-BYTE      X01004 15210000
*                                         BOUNDARY               X01004 15240000
         BZ    TURNON                   NO, BRANCH               X01004 15270000
         SR    R10,R11                  GET NEW LAST ENTRY       X02004 15300000
         ST    R10,EIGHT(R1)            SET NEW LAST ENTRY       X02004 15330000
         LA    R11,EIGHT                ADJUST BY EIGHT BYTES    X01004 15360000
         SR    R0,R11                   GET NEW MIDDLE ENTRY     X01004 15390000
         ST    R0,TWELVE(R1)            STORE NEW MIDDLE ENTRY   X01004 15420000
TURNON   EQU   *                                                 X01004 15450000
         OI    TWELVE(R1),IOTRCFLG      SET HIGH ORDER BITS OF   X01004 15480000
*                                        I/O TRACE FLAGS         X01004 15510000
BLDLBUF1 EQU   *                                                 X01004 15540000
         LH    R1,H8                    SIZE OF PADDING FOR    @G36XRNP 15570000
*                                       ERRORMSG BUFFER ACTING @G36XRNP 15600000
*                                       AS QCB                 @G36XRNP 15630000
         BAL   R14,GETFIXD              GET PADDING            @G36XRNP 15660000
         LH    R10,AVTAVFCT             TOTAL NUMBER OF BUFFERS  X01004 15690000
         LR    R1,R8                    LENGTH TO ASSIGN         X01004 15720000
         BAL   R14,GETFIXD              GET FIRST BUFFER         X01004 15750000
         TM    AVTSAVTF,AVTVTMCP        3705 IN SYSTEM         @Y17XANG 15780000
         BZ    NOLCCW                   BR NO                    X03039 15810000
         LA    R1,LCCWSZ(,R1)           ADD SIZE OF NEG BUFFER @Y17XANG 15840000
*                                       PREFIX.                @Y17XANG 15870000
NOLCCW   EQU   *                                                 X03039 15900000
         ST    R1,AVTCOREC              SAVE ADDRESS OF BUFFER   X01004 15930000
         MVC   EIGHT(EIGHT,R1),FBUFSAV  COPY ADDRESS OF BUFFERS  X01004 15960000
*                                        AND LENGTH FOR OPEN     X01004 15990000
*                                        TO FIX                  X01004 16020000
         MVC   AVTBFREB+1(3),AVTCOREC+1 MOVE THE BUFFER ADDRESS TO      16050000
*                                         AVAILABLE BUFFER QCB          16080000
         BCT   R10,CORCOPY              REDUCE COUNT BY ONE      X01004 16110000
         STCM  R1,7,AVTSELCH            SAVE ADDRESS LAST UNIT @OY19124 16120082
         B     BLDCPB                   BRANCH IF ONLY ONE BUFFERX01004 16140000
*                                                                       16170000
CORCOPY  EQU   *                                                        16200000
         LR    R2,R1                    SAVE BUFFER ADDRESS FOR  X01004 16230000
*                                         CHAINING OF BUFFERS    X01004 16260000
         LR    R1,R8                    GET LENGTH OF BUFFER     X01004 16290000
*                                                                X01004 16320000
         BAL   R14,GETFIXD              GET NEXT BUFFER          X01004 16350000
         TM    AVTSAVTF,AVTVTMCP        3705 IN SYSTEM?        @Y17XANG 16380000
         BZ    NOBUMP                   BR NO                    X03039 16410000
         LA    R1,LCCWSZ(,R1)           BUMP PAST NEG BUF PREF @Y17XANG 16440000
NOBUMP   EQU   *                                                 X03039 16470000
         ST    R1,FOUR(R2)              CHAIN BUFFER TO          X01004 16500000
*                                         PREVIOUS BUFFER        X01004 16530000
         BCT   R10,CORCOPY              REDUCED COUNT AND        X01004 16560000
*                                         GET NEXT BUFFER.       X01004 16590000
*                                         ON LAST BUFFER         X01004 16620000
*                                         FALL THROUGH TO GET    X01004 16650000
*                                         CHANNEL PROGRAM BLOCKS X01004 16680000
         STCM  R1,7,AVTSELCH            SAVE ADDRESS LAST UNIT @OY19124 16690082
         EJECT                                                          16710000
*********************************************************************** 16740000
*                                                                     * 16770000
*        THIS SECTION OF CODE GETS CORE FOR AND                       * 16800000
*        INITIALIZES A CPB FREEPOOL.                                  * 16830000
*                                                                     * 16860000
*********************************************************************** 16890000
BLDCPB   EQU   *                                                 X01004 16920000
         TM    AVTBIT1,AVTDISKN         DISK QUEVEING SUPPORTED  X01004 16950000
         BZ    RTEND                    NO, BRANCH               X02004 16980000
         LH    R5,AVTCPBNO              GET NUMBER OF CPB'S      X01004 17010000
         N     R5,AVTCLRHI              FORCE POSITIVE           X01004 17040000
         LR    R1,R4                    SIZE OF CPB              X01004 17070000
         BAL   R14,GETFIXD              GET FIRST BUFFER         X01004 17100000
         ST    R1,AVTFCPB               SAVE FIRST CPB ADDRESS   X01004 17130000
         STCM  R1,AD,AVTCPBPT+ONE       SAVE IN SECOND ADDRESS   X01004 17160000
         DROP  RCPB                                              X01004 17190000
         USING IEDQCPB,R1                                        X01004 17220000
CPBLOAD  EQU   *                                                 X01004 17250000
         LA    R7,CPBSIZE               GET ADDR. OF UNIT        X01004 17280000
         TM    AVTSAVTF,AVTVTMCP        3705 IN SYSTEM?        @Y17XANG 17310000
         BZ    DONTBUMP                 BR NO                  @Y17XANG 17340000
         LA    R7,LCCWSZ(,R7)           ADD SIZE OF NEG BUFFER @Y17XANG 17370000
*                                       PREFIX.                @Y17XANG 17400000
DONTBUMP EQU   *                                                 X03039 17430000
         ST    R7,CPBXREAF               INTO CPB                X01004 17460000
         MVI   CPBXOUNT+ONE,AVTDATLN    SET DATA LENGTH          X01004 17490000
         LR    R2,R1                    SAVE ADDRESS OF PREVIOUS X01004 17520000
         LR    R1,R4                    LENGTH OF CPB            X01004 17550000
         BCT   R5,CHAIN                 DO NEXT CPB, IF ANY      X01004 17580000
         B     RTEND                    END OF CPB FREEPOOL      X02004 17610000
CHAIN    EQU   *                                                 X01004 17640000
         BAL   R14,GETFIXD              GET CPB BUFFER           X01004 17670000
         ST    R1,CPBNEXTF-IEDQCPB(R2)  CHAIN CPB'S TOGETHER     X01004 17700000
         B     CPBLOAD                  DO NEXT CPB              X01004 17730000
         DROP  R1                                                X01004 17760000
         USING IEDQCPB,RCPB                                      X01004 17790000
RTEND    EQU   *                                                 X02004 17820000
         L     R1,FREEPTR               ADDRESS OF UNUSED CORE   X02004 17850000
         LTR   R1,R1                    IS CORE GOTTEN           X02004 17880000
         BZ    TESTDISP                 NO, BRANCH               X02004 17910000
         L     R0,0(R1)                 LENGTH OF UNUSED CORE    X02004 17940000
         LTR   R0,R0                    ALL USED                 X02004 17970000
         BZ    TESTDISP                 YES, BRANCH              X02004 18000000
         FREEMAIN R,LV=(0),A=(1)                                 X02004 18030000
         EJECT                                                          18060000
         EJECT                                                          18090000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       18120000
*                                                                       18150000
*        THIS SECTION OF CODE GETMAINS MAIN STORAGE FOR                 18180000
*        A DISPATCHER TRACE AREA                                        18210000
*                                                                       18240000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       18270000
*                                                                       18300000
TESTDISP EQU   *                                                        18330000
         ST    R6,SAVER6                SAVE REG FOR USE LATER @OY19405 18340082
         NC    AVTDISTR(4),AVTDISTR     HAS A TRACE TABLE BEEN          18360000
*                                         REQUESTED                     18390000
         BZ    TESTBUFT                 BR NO                  @OY19405 18420082
         L     R6,DISPTR                GET RTN ADDRESS        @OY19405 18470082
         BR    R6                       GO TO RTN.             @OY19405 18520082
DISPTR   DC    A(DISPATR)                                      @OY19405 18570082
SAVER6   DC    F'0'                     REG 6 SAVE             @OY19405 18580082
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *@OY19405 18620082
*                                                              @OY19405 18670082
*        THIS SECTION OF CODE GETS CORE FOR A BUFFER TRACE     @OY19405 18720082
*                                                              @OY19405 18770082
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *@OY19405 18820082
*                                                              @OY19405 18870082
TESTBUFT EQU   *                                               @OY19405 18920082
         NC    AVTBUENT(2),AVTBUENT     TRACE REQUESTED?       @OY19405 18970082
         BZ    TPIOTRAC                 BR NO                  @OY19405 19020082
         L     R6,BUFRTN                GET RTN ADD.           @OY19405 19070082
         BR    R6                       GO TO RTN TO AVOID     @OY19405 19120082
*                                       ADDRESSABILTY PROB.    @OY19405 19170082
BUFRTN   DC    A(BUFFRTN)                                      @OY19405 19220082
         EJECT                                                          19270082
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 19710000
*                                                                X03039 19740000
*        THIS SECTION OF CODE GETS CORE FOR A PIU TRACE TABLE  @Y17XANG 19770000
*                                                                X03039 19800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *X03039 19830000
*                                                                X03039 19860000
TPIOTRAC EQU   *                                                 X03039 19890000
         L     R6,SAVER6                RESTORE REG 6          @OY19405 19900082
         TM    AVTSAVTF,AVTVTMCP        IS THERE A 3705?       @Y17XANG 19920000
         BZ    BRACKET                  NO, NO TBL REQUIRED    @X50X9NI 19950000
         USING IEDNSVTD,R4                                       X03039 19980000
         L     R4,AVTSAVTP              ADDRESS OF SECONDARY AVT X03039 20010000
         NC    SAVTPIUT,SAVTPIUT        PIU TRACE REQUESTED?   @Y17XANG 20040000
         BZ    BRACKET                  BR NO                  @X50X9NI 20070000
         L     R1,SAVTPIUT              NUMBER OF TABLE ENTRIES@Y17XANG 20100000
         LA    R1,ONE(R1)               ROUND UP TO AN EVEN ...  X03039 20130000
         SRL   R1,ONE                   ... NUMBER IF ODD        X03039 20160000
         SLL   R1,ONE                                            X03039 20190000
         LR    R3,R1                    SAVE # ENTRIES         @Y17XANG 20220000
         LA    R5,ENTRYSZ               ENTRY SIZE             @Y17XANG 20250000
         MR    R0,R5                    LENGTH OF ENTRIES IN R1@Y17XANG 20280000
         LA    R1,2*HDRSZ+CNTRLSZ(R1)   TABLE SIZE = LENGTH OF @Y17XANG 20310000
*                                       ENTRIES + CONTROL AREA.@Y17XANG 20340000
*                                       + 2 HALF TABLE HEADERS.@Y17XANG 20370000
         LR    R5,R1                    SAVE TABLE SIZE        @Y17XANG 20400000
         LA    R0,SAVTPIUT              ADDR TO RECEIVE TABLE  @Y17XANG 20430000
*                                       ADDRESS FROM GETMAIN.  @Y17XANG 20460000
         BAL   R14,AVTPAR               LINK TO GETMAIN          X03039 20490000
         LR    R1,R5                    RESTORE TABLE SIZE       X03039 20520000
         USING TTRCCTLD,R2                                       X03039 20550000
         L     R2,SAVTPIUT              ADDRESS OF TRACE TABLE @Y17XANG 20580000
         LA    R5,CNTRLSZ(R2)           FIRST ENTRY ADDRESS      X03039 20610000
         ST    R5,TTRCFRST              STORE IN CONTROL AREA    X03039 20640000
         LA    R5,HDRSZ(R5)             CURRENT ENTRY ADDRESS    X03039 20670000
         ST    R5,TTRCCURR              STORE IN CONTROL AREA    X03039 20700000
         LA    R5,0(R1,R2)              ADDRESS ON END OF TABLE  X03039 20730000
         SH    R5,HEIGHT                ADDRESS OF LAST ENTRY    X03039 20760000
         ST    R5,TTRCLAST              STORE IN CONTROL AREA    X03039 20790000
         LR    R1,R3                    NUMBER OF ENTRIES        X03039 20820000
         MH    R1,HEIGHT                #ENTRIES * ENTRY SIZE  @Y17XANG 20850000
         SRL   R1,1                     DIVIDED BY 2           @Y17XANG 20880000
         LA    R1,HDRSZ(R1)             + HALF TBL HDR SIZE =  @Y17XANG 20910000
*                                       HALF TBL SIZE          @Y17XANG 20940000
         ST    R1,TTRCLNTH              STORE IN CONTROL AREA    X03039 20970000
         SR    R5,R1                    ADDRESS OF MIDDLE ENTRY  X03039 21000000
*                                       (LAST ENTRY IN 1ST HALF) X03039 21030000
         ST    R5,TTRCMIDL              STORE IN CONTROL AREA    X03039 21060000
         LOAD  EP=IEDNTR                LOAD PIU TRACE ROUTINE @Y17XANG 21090000
         ST    R0,TTRCRTNA-ONE          STORE TRACE ROUTINE    @XA07498 21120000
*                                       ... ADDR IN CONTROL AREA X03039 21150000
         L     R5,TTRCFRST              1ST ENTRY ADDRESS      @Y17XANG 21180000
         XC    0(HDRSZ,R5),0(R5)        CLEAR 1ST HALF HEADER  @Y17XANG 21210000
         MVC   0(L'TTRCID,R5),TTRCID    MOVE ID TO 1ST HALF HDR@Y17XANG 21240000
         L     R5,TTRCMIDL              2ND HALF TBL ADDR      @Y17XANG 21270000
         XC    ENTRYSZ(HDRSZ,R5),ENTRYSZ(R5) 2ND HALF HEADER   @Y17XANG 21300000
         MVC   ENTRYSZ(L'TTRCID,R5),TTRCID   MOVE ID TO 2ND    @Y17XANG 21330000
*                                            HALF HEADER.      @Y17XANG 21360000
         SPACE                                                          21390000
* CLEAR FIRST HALF TABLE.                                      @Y17XANG 21420000
         SPACE                                                          21450000
         SRL   R3,1                     #ENTRIES/2=HALF SIZE.  @Y17XANG 21480000
         LR    R1,R3                    LOOP COUNT             @Y17XANG 21510000
         L     R5,TTRCFRST              1ST HALF ADDRESS       @Y17XANG 21540000
         LA    R5,HDRSZ(R5)             BYPASS HEADER.         @Y17XANG 21570000
TBL1HLF  EQU   *                                               @Y17XANG 21600000
         XC    0(ENTRYSZ,R5),0(R5)      CLEAR ENTRY.           @Y17XANG 21630000
         LA    R5,ENTRYSZ(R5)           NEXT ENTRY             @Y17XANG 21660000
         BCT   R1,TBL1HLF               LOOP TILL CLEAR        @Y17XANG 21690000
         SPACE                                                          21720000
* CLEAR 2ND HALF TABLE.                                        @Y17XANG 21750000
         SPACE                                                          21780000
         LR    R1,R3                    LOOP COUNT             @Y17XANG 21810000
         L     R5,TTRCMIDL              2ND HALF ADDR-ENTRY    @Y17XANG 21840000
         LA    R5,ENTRYSZ+HDRSZ(R5)     1ST ENTRY ADDR         @Y17XANG 21870000
TBL2HLF  EQU   *                                               @Y17XANG 21900000
         XC    0(ENTRYSZ,R5),0(R5)      CLEAR ENTRY            @Y17XANG 21930000
         LA    R5,ENTRYSZ(R5)           NEXT ENTRY             @Y17XANG 21960000
         BCT   R1,TBL2HLF               LOOP TILL CLEAR        @PI02854 21990000
         SPACE                                                          22020000
* SET TRACE ACTIVE.                                            @Y17XANG 22050000
         SPACE                                                          22080000
         MVI   TTRCFLGS,TTRCTSYS        SET FLAG TO TRACE ALL  @Y17XANG 22110000
         DROP  R2                                                X03039 22140000
         SPACE 2                                                        22170000
         B     BRACKET                  CHECK FOR BRACKET      @X50X9NI 22200000
         EJECT                                                          22230000
*****************************************************************X01004 22260000
*        THIS ROUTINE ALLOCATES FOR PAGES TO BE USE FOR THE LINE*X01004 22290000
*        BUFFER POOL, MESSAGE QUEVE POOL, AND CPB POOL. THE CORE*X01004 22320000
*        GOTTEN WILL BE FIXED AT OPEN. THE CORE IS ALLOCATED AT *X01004 22350000
*        A BUFFER UNIT AT A TIME TO INSURE THAT NO BUFFERS WILL *X01004 22380000
*        CROSS PAGE BOUNDARIES.                                 *X01004 22410000
*****************************************************************X01004 22440000
*                                                               *X01004 22470000
*        INPUT:                                                 *X01004 22500000
*              REGISTER ONE CONTAINS THE NUMBER OF FIXED BYTES  *X01004 22530000
*                REQUESTED                                      *X01004 22560000
*              REGISTER 14 CONTAINS THE RETURN ADDRESS OF THE   *X01004 22590000
*                CALLER                                         *X01004 22620000
*                                                               *X01004 22650000
*        REGISTERS    0,11,3,& 15 ARE DESTROYED BEFORE RETURN   *X01004 22680000
*                                                               *X01004 22710000
GETFIXD  EQU   *                                                 X01004 22740000
         LR    R3,R1                    SAVE LENGTH REQUESTED    X01004 22770000
         L     R11,FREEPTR              GET ADDRESS OF CURRENT   X01004 22800000
*                                         UNUSED BLOCK           X01004 22830000
         LR    R1,R11                   ANY UNUSED CORE ALLOCATEDX01004 22860000
         L     R0,0(R1)                 GET LENGTH OF UNUSED     X01004 22890000
RECK     EQU   *                        UNUSED AREA LARGE ENOUGH X01004 22920000
         CR    R3,R0                      TO FILL REQUEST        X01004 22950000
         BH    FREEPAGE                 NO GET ANOTHER BLOCK     X01004 22980000
         AR    R11,R3                   BUMP TO FREE CORE        X01004 23010000
         SR    R0,R3                    GET NEW LENGTH           X01004 23040000
         LTR   R0,R0                    END OF PAGE              X01004 23070000
         BNZ   SETFRPTR                 NO, UPDATE STARTING PTR. X01004 23100000
         CLM   R11,AD,FREEPTR+FIVE      END OF GOTTEN CORE       X01004 23130000
         BE    RTRNCORE                 YES, SKIP UPDATE         X01004 23160000
SETFRPTR EQU   *                                                 X01004 23190000
         ST    R0,0(R11)                SET NEW LENGTH           X01004 23220000
         ST    R11,FREEPTR              UPDATE POINTER TO        X01004 23250000
*                                        AVAILABLE UNUSED CORE   X01004 23280000
RTRNCORE EQU   *                                                 X01004 23310000
         XC    0(FOUR,R1),0(R1)         RESET LENGTH BYTE IN AREAX01004 23340000
*                                         TO BE RETURNED         X01004 23370000
         BR    R14                      RETURN TO INVOKER        X01004 23400000
FREEPAGE EQU   *                                                 X01004 23430000
         LTR   R0,R0                    NEED TO FREEMAIN         X01004 23460000
         BZ    NOFREE                   N/, BRANCH               X01004 23490000
         AR    R11,R0                   BUMP TO FREE AREA        X01004 23520000
         FREEMAIN R,LV=(0),A=(1)        FREE UNUSABLE CORE       X01004 23550000
NOFREE   EQU   *                                                 X01004 23580000
         LR    R0,R6                    SET FREE LENGTH TO PAGE  X01004 23610000
*                                        SIZE                    X01004 23640000
         LR    R1,R11                   SET NEW START ADDRESS    X01004 23670000
         B     RECK                     ALLOCATE CORE            X01004 23700000
         EJECT                                                          23730000
BRACKET  EQU   *                        BRACKET PROCESSING     @X50X9NI 23760000
         TM    AVTSAVTF,AVTVTMCP        USING NCP SUPPORT      @G36XRNP 23790000
         BZ    COMMBUF                  NO,DONT LOAD BRACKT MGR@X50X9NI 23820000
         USING IEDNSVTD,R4                                     @X50X9NI 23850000
         L     R4,AVTSAVTP              ADDR SECONDARY AVT     @X50X9NI 23880000
         NC    SAVTBSM,SAVTBSM          WAS BRACKET=YES SPEC'D @X50X9NI 23910000
         BZ    COMMBUF                  NO,DONT LOAD BRKT MGR  @X50X9NI 23940000
         SPACE 1                                               @X50X9NI 23970000
         LOAD  EP=IEDBSM                LOAD BRACKET MANAGER   @YM06007 24000000
         SPACE 1                                               @X50X9NI 24030000
         ST    R0,SAVTBSM               STORE ADDR IN SEC. AVT @X50X9NI 24060000
         B     COMMBUF                  GO PROCESS COMMBUF     @X50X9NI 24090000
         SPACE 1                                               @X50X9NI 24120000
         DROP  R4                                              @X50X9NI 24150000
         EJECT                                                          24180000
* * * * * * * * * * * * * * * * * * * * * * * * *  * * * * * * * X02004 24210000
*                                                                X02004 24240000
*        THIS SECTION OF CODE GETMAINS AN AREA OF MAIN STORAGE   X02004 24270000
*        FOR THE COMMON BUFFER MASTER QCB, STCBS, AND DATA AREAS.X02004 24300000
*        IT ALSO INITIALIZES FIELDS IN THE MASTER QCB            X02004 24330000
*                                                                X02004 24360000
* * * * * * * * * * * * * * * * * * * * * * * * *  * * * * * * * X02004 24390000
*                                                                X02004 24420000
COMMBUF  EQU   *                                                 X02004 24450000
         XC    FREEPTR,FREEPTR          CLEAR POINTER TO AVAIL.  X02004 24480000
*                                       CORE FOR COMMBUF GETMAINSX02004 24510000
         TM    AVTSCOPT,AVTCMBUF        IS COMMON BUFFER         X02004 24540000
*                                         TRANSMISSION TO BE USEDX02004 24570000
         BZ    CROSSREF                 BRANCH IF NOT            X02004 24600000
         SR    R10,R10                  CLEAR REGISTERS          X02004 24630000
         SR    R4,R4                      FOR                    X02004 24660000
         SR    R1,R1                      SAVING VALUES          X02004 24690000
         LH    R4,AVTCBQCB              GET NUMBER OF STCB'S     X02004 24720000
         LH    R10,AVTCBQCB+2           GET NUMBER OF DATA AREAS X02004 24750000
         LH    R1,AVTCMBSS+2            GET DATA AREA SIZE       X02004 24780000
         LR    R2,R1                    SAVE DATA AREA SIZE      X02004 24810000
         LA    R1,TWELVE(R0)            ADD 12 FOR PREFIX        X02004 24840000
         LR    R11,R4                   SAVE NUMBER OF STCB'S    X02004 24870000
         LR    R5,R10                   SAVE NO. DATA AREAS      X02004 24900000
         MR    R0,R10                   MULTIPLY DATA AREA SIZE  X02004 24930000
*                                         BY NO. DATA AREAS      X02004 24960000
         LA    R8,EIGHT                 GET SIZE OF AN STCB      X02004 24990000
         MR    R10,R8                   MULTIPLY BY NO. STCB'S   X02004 25020000
         AR    R1,R11                   ADD STCB'S TO DATA AREA  X02004 25050000
         LA    R1,MQCBSIZE(R1)          ADD SIZE OF MASTER QCB   X02004 25080000
         LR    R3,R1                    SAVE SIZE OF GETMAIN AREAX02004 25110000
         LA    R0,AVTCBQCB              LOAD THE ADDRESS OF THE  X02004 25140000
*                                         AREA TO HOLD THE ADDR  X02004 25170000
*                                         OF THE MASTER QCB      X02004 25200000
         BAL   R14,AVTPAR               BRANCH TO GETMAIN ROUTINEX02004 25230000
         L     R14,AVTCBQCB             GET ADDRESS OF MASTER QCBX02004 25260000
         LR    RCMB,R14                 GET ADDRESS OF MASTER QCBX02004 25290000
CMBCLEAR EQU   *                                                 X02004 25320000
         MVI   0(R14),AVTEZERO          CLEAR ONE BYTE           X02004 25350000
         LA    R14,ONE(R14)             INCREMENT THE COMMON     X02004 25380000
*                                         BUFFER AREA ADDRESS    X02004 25410000
         BCT   R3,CMBCLEAR              DECREMENT THE COUNT      X02004 25440000
         MVI   8(RCMB),VTO              MOVE IN OFFSET           X02004 25470000
         STH   R4,CMBASTCB              STORE AVAILABLE STCB'S   X02004 25500000
         STH   R5,CMBDAREA              STORE NO. OF DATA AREAS  X02004 25530000
         STH   R2,CMBSIZE               STORE DATA AREA SIZE     X02004 25560000
         LR    R7,R4                    GET NO. AVAIABLE STCB'S  X02004 25590000
         LA    R4,MQCBSIZE(RCMB)        POINT TO FIRST STCB      X02004 25620000
         BCTR  R7,R0                    SUBTRACT 1 FROM NO. STCB X02004 25650000
         ST    R4,CMBFLAG1              STORE ADDR OF FIRST STCB X02004 25680000
         LA    R3,8(R4)                 GET ADDR OF NEXT STCB    X02004 25710000
         ST    R3,CMBPRI                STORE ADDR OF NEXT STCB  X02004 25740000
         MVI   4(RCMB),PRIORITY         MOVE IN PRIORITY         X02004 25770000
STCBINIT EQU   *                                                 X02004 25800000
         LR    R3,R4                    GET ADDR OF FIRST STCB   X02004 25830000
         LA    R4,8(R4)                 POINT TO NEXT STCB       X02004 25860000
         ST    R4,4(R3)                 STORE ADDR IN LINK FIELD X02004 25890000
         BCT   R7,STCBINIT              SUBTRACT 1 FROM NO. STCB X02004 25920000
         LA    R4,8(R4)                 POINT TO FIRST DATA AREA X02004 25950000
*                                         PREFIX                 X02004 25980000
         ST    R4,CMBFIRST-1            STORE ADDRESS OF FIRST   X02004 26010000
*                                         DATA AREA PREFIX       X02004 26040000
         ST    R4,CMBNEXT-1             STORE ADDR OF NEXT       X02004 26070000
*                                         DATA AREA PREFIX       X02004 26100000
         SR    R3,R3                    CLEAR INDEX              X02004 26130000
         SR    R0,R0                    CLEAR FOR DIVIDE         X02004 26160000
         LA    R1,EIGHT(R2)             COPY DATA AREA SIZE PLUS X02004 26190000
*                                       CONTRL INFO              X02004 26220000
         DR    R0,R6                    DIVIDE BUFFER SIZE BY    X02004 26250000
*                                       PAGE SIZE.               X02004 26280000
         SLL   R1,THREE                 MULTIPLY BY EIGHT FOR    X02004 26310000
*                                       INDIRECT ADDRESS ENTRY   X02004 26340000
*                                       FOR EACH PAGE THE        X02004 26370000
*                                       COMMBUF SPANS            X02004 26400000
         LA    R1,EIGHT(R1,R2)          TOTAL LENGTH NEEDED FOR  X02004 26430000
*                                       EACH BUFFER              X02004 26460000
         LA    R1,ROUND(R1)             ROUND UP TO DOUBLE WORD  X02004 26490000
         SRL   R1,THREE                 BOUNDARY                 X02004 26520000
         SLL   R1,THREE                                          X02004 26550000
         LR    R7,R1                    SAVE BUFFER LENGTH       X02004 26580000
COM0     EQU   *                        LOOP TO GET BUFFERS      X02004 26610000
         LA    R11,FREEPTR              ADDR. OF AVAIL. CORE     X02004 26640000
         NC    0(FOUR,R11),0(R11)       CHAIN EMPTY              X02004 26670000
         BZ    COM2                     YES, ISSUE GETMAIN       X02004 26700000
COM1     EQU   *                        LOOP THRU GOTTEN CORE    X02004 26730000
         LR    R10,R11                  SAVE OLD CHAIN POINTER   X02004 26760000
         L     R11,0(R11)               GET NEW POINTER          X02004 26790000
         CLM   R7,AD,FIVE(R11)          REQUEST SATISFIED        X02004 26820000
         BNH   COM8                     YES, BRANCH              X02004 26850000
         CLC   0(FOUR,R11),AVTFZERO     END OF CHAIN             X02004 26880000
         BNE   COM1                     NO, BUMP TO NEXT AVAIL.  X02004 26910000
COM2     EQU   *                        GET MORE CORE            X02004 26940000
         LA    R0,0(R11)                ADDR. FOR GETMAIN        X02004 26970000
         SR    R1,R1                    CLEAR FOR LENGTH INSERT  X02004 27000000
COM3     EQU   *                                                 X02004 27030000
         AR    R1,R6                    ADD PAGE TO LENGTH       X02004 27060000
         CR    R1,R7                    LENGTH LARGER THAN REQ.  X02004 27090000
         BL    COM3                     NO, ADD ANOTHER PAGE     X02004 27120000
         BAL   R14,AVTPAR1              GETMAIN FOR BUFFER       X02004 27150000
         LM    R15,R0,AVTGETMN          LENGTH AND ADDRESS FROM  X02004 27180000
*                                       GETMAIN.                 X02004 27210000
         LR    R1,R15                   COPY LENGTH              X02004 27240000
         L     R14,0(R11)               ADDRESS OF GOTTEN CORE   X02004 27270000
         LR    R10,R11                  UPDATE OLD CHAIN POINTER X02004 27300000
         LR    R11,R14                  SET NEW CHAIN POINTER    X02004 27330000
COM4     EQU   *                        LOPP TO CLEAR BUFFER     X02004 27360000
         MVI   0(R14),AVTEZERO          CLEAR ONE BYTE           X02004 27390000
         LA    R14,ONE(R14)             BUMP TO NEXT BYTE        X02004 27420000
         BCT   R15,COM4                 CLEAR NEXT BYTE          X02004 27450000
COM5     EQU   *                        UPDATE FREE CORE IN THIS X02004 27480000
*                                       BLOCK OF UNUSED CORE     X02004 27510000
         SR    R1,R7                    FIND CORE TO REMAIN FREE X02004 27540000
         BZ    COM6                     REQUEST EQUAL AVAIL.     X02004 27570000
         LA    R15,0(R7,R11)            BUMP TO AVAIL. CORE      X02004 27600000
         ST    R1,FOUR(R15)             UPDATE AVAIL. IN BLOCK   X02004 27630000
COM6     EQU   *                                                 X02004 27660000
         ST    R15,0(R10)               REMOVE BLOCK FROM CHAIN  X02004 27690000
*                                       IF REQUEST EQUAL AVAIL.  X02004 27720000
*                                       OR UPDATE CHAIN IF NOT   X02004 27750000
         LR    R10,R7                   COPY LENGTH REQUESTED    X02004 27780000
         LR    R15,R2                   COPY BUFFER LENGTH       X02004 27810000
         LA    R15,ROUND(R15)           ROUND UP TO DOUBLE WORD  X02004 27840000
         SRL   R15,THREE                BOUNDARY                 X02004 27870000
         SLL   R15,THREE                                         X02004 27900000
         SR    R10,R15                  OFFSET TO BUFFER         X02004 27930000
         LA    R10,0(R10,R11)           ADDRESS OF BUFFER        X02004 27960000
         ST    R10,0(R4)                STORE BUFFER ADDRESS IN  X02004 27990000
*                                       PREFIX                   X02004 28020000
         STC   R3,0(R4)                 STORE INDEX IN PREFIX    X02004 28050000
         LR    R15,R2                   COPY BUFFER LENGTH       X02004 28080000
         SH    R15,HSIX                 SUBTRACT LENGTH OF HEADERX02004 28110000
         STH   R15,0(R10)               STORE LENGTH IN BUFFER   X02004 28140000
         LA    R0,SIX(R10)              GET START OF DATA AREA   X02004 28170000
         SH    R10,H8                   INDIRECT ADDR. POINTER @Y17XANG 28200000
         ST    R7,FOUR(R10)             SAVE TOTAL LENGTH FOR    X02004 28230000
*                                       PAGE FIX IN OPEN         X02004 28260000
         ST    R11,0(R10)               ASSUME INDIRECT ADDR.    X02004 28290000
         OI    0(R10),CCWIDA            SET INDIRECT ADDR. FLAG  X02004 28320000
COM7     EQU   *                                                 X02004 28350000
         LR    R14,R0                   COPY DATA AREA ADDRESS   X02004 28380000
         LR    R1,R6                    COPY PAGE SIZE           X02004 28410000
         BCTR  R1,R0                    SUBTRACT ONE FROM PAGE   X02004 28440000
         NR    R1,R14                   MASK TO GET DATA AREA    X02004 28470000
*                                       OFFSET IN PAGE           X02004 28500000
         XR    R0,R1                    GET START OF PAGE        X02004 28530000
         AR    R1,R15                   OFFSET INTO PAGE PLUS    X02004 28560000
*                                       LENGTH IN BUFFER         X02004 28590000
         SR    R1,R6                    SUBTRACT PAGE SIZE       X02004 28620000
         ST    R14,0(R11)               SET INDIRECT ADDRESS PTR X02004 28650000
*                                       IF NO IDA IS NEEDED R11  X02004 28680000
*                                       WILL EQUAL R10 AND THE   X02004 28710000
*                                       IDA FLAG WILL BE TURNED  X02004 28740000
*                                       OFF BY THIS STORE        X02004 28770000
         BNP   COM9                     NO IDA                   X02004 28800000
         LR    R15,R1                   SET NEW LENGTH           X02004 28830000
         AR    R0,R6                    BUMP DATA ADDRESS TO     X02004 28860000
*                                       NEXT PAGE.               X02004 28890000
         LA    R11,FOUR(R11)            BUMP IDA LIST POINTER    X02004 28920000
         B     COM7                     BUILD NEXT IDA           X02004 28950000
COM8     EQU   *                        NEW GETMAIN NOT NEEDED   X02004 28980000
         L     R1,FOUR(R11)             GET LENGTH AVAIL. IN PAGEX02004 29010000
         B     COM5                     REMOVE CORE FROM AVAIL.  X02004 29040000
COM9     EQU   *                        BUMP TO NEXT BUFFER      X02004 29070000
         LA    R3,ONE(R3)               BUMP INDEX               X02004 29100000
         LA    R4,TWELVE(R4)            BUMP TO NEXT PREFIX      X02004 29130000
         BCT   R5,COM0                  GET NEXT BUFFER          X02004 29160000
*              ALL BUFFERS GOTTEN                                X02004 29190000
         BCTR  R3,R0                    ADJUST INDEX BYTE        X02004 29220000
         SH    R4,HSIX                  ADJUST PREFIX POINTER    X02004 29250000
         SH    R4,HSIX                                           X02004 29280000
         ST    R4,CMBLAST-ONE           STORE ADDR. OF LAST      X02004 29310000
         STC   R3,CMBLINDX              STORE INDEX BYTE         X02004 29340000
         SPACE 5                                                        29370000
         LA    R2,FREEPTR               ADDR. UNUSED CORE        X02004 29400000
COMEND   EQU   *                                                 X02004 29430000
         ICM   R1,ALL,0(R2)             CORE TO FREE             X02004 29460000
         BZ    CROSSREF                 NO, BRANCH               X02004 29490000
         LR    R2,R1                    UPDATE UNUSED CORE PTR   X02004 29520000
         ICM   R0,ALL,FOUR(R1)          LENGTH TO FREE           X02004 29550000
         BZ    COMEND                   EMPTY, SKIP FREEMAIN     X02004 29580000
         FREEMAIN R,LV=(0),A=(1)        FREE UNUSED CORE         X02004 29610000
         B     COMEND                   FREE NEXT BLOCK          X02004 29640000
         EJECT                                                          29670000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       29700000
*                                                                       29730000
*        THIS SECTION OF CODE GETMAINS AN AREA OF MAIN STORAGE          29760000
*        FOR A USER REQUESTED CROSS REFERENCE TABLE                     29790000
*                                                                       29820000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       29850000
*                                                                       29880000
CROSSREF EQU   *                                                        29910000
         L     R1,AVTCRSRF              GET NO. CROSSRF ENTRIES         29940000
         LTR   R4,R1                    ANY ENTRIES REQUESTED           29970000
         BZ    NEXT                       NO, EXIT                      30000000
         SLL   R1,FOUR                  MULTIPLY THE NUMBER OF          30030000
*                                         ENTRIES BY 16                 30060000
         LA    R1,8(,R1)                ADD 8 ADDITIONAL BYTES TO       30090000
*                                         THE CROSS REFERENCE TABLE     30120000
         LA    R0,AVTCRSRF              LOAD THE ADDRESS OF THE         30150000
*                                         AREA TO HOLD THE ADDRESS      30180000
*                                         OF THE TABLE                  30210000
         BAL   R14,AVTPAR               BRANCH TO GETMAIN ROUTINE       30240000
*                                                                       30270000
         L     R3,AVTCRSRF              LOAD THE ADDRESS OF THE TABLE   30300000
         LA    R1,EIGHT(R3)             SET THE ADDRESS POINTER TO      30330000
*                                         THE FIRST ENTRY               30360000
         ST    R1,0(R3)                 SET THE FIRST AVAILABLE         30390000
*                                         ENTRY ADDRESS                 30420000
REFCLEAR EQU   *                                                        30450000
         LA    R7,ENTRYSIZ(R1)          LOAD THE ADDRESS OF THE         30480000
*                                         NEXT AVAILABLE ENTRY          30510000
         XC    0(ENTRYSIZ,R1),0(R1)     CLEAR AN ENTRY IN THE TABLE     30540000
         ST    R7,0(R1)                 STORE THE ENTRY CHAINING        30570000
*                                         ADDRESS                       30600000
         LA    R1,ENTRYSIZ(R1)          SET THE ADDRESS POINTER TO      30630000
*                                         THE NEXT ENTRY                30660000
         BCT   R4,REFCLEAR              DECREMENT THE COUNT AND         30690000
*                                         BRANCH                        30720000
         LA    R4,ENTRYSIZ              LOAD THE SIZE OF AN ENTRY       30750000
         SR    R1,R4                    SET THE ADDRESS OF THE LAST     30780000
*                                         ENTRY IN THE TABLE            30810000
         ST    R1,4(,R3)                STORE THE ADDRESS OF THE        30840000
*                                         LAST ENTRY                    30870000
NEXT     EQU   *                                                        30900000
         L     RTNT,AVTRNMPT            LOAD THE ADDRESS OF THE         30930000
*                                         TERMNAME TABLE                30960000
         SR    RLEN,RLEN                CLEAR THE LENGTH REGISTER       30990000
         IC    RLEN,TNTENLEN            INSERT THE LENGTH OF EACH       31020000
*                                         TERMNAME ENTRY                31050000
         BCTR  RLEN,0                   SUBTRACT ONE TO EXECUTE         31080000
*                                         THE COMPARISON                31110000
         L     R1,TNTENLEN              LOAD ADDRESS OF LAST ENTRY      31140000
*                                         IN TERMNAME TABLE             31170000
         LA    R1,ONE(R1)               CLEAR HIGH ORDER BYTE OF        31200000
*                                         ADDRESS OF LAST ENTRY         31230000
         LA    RFIRST,TNTFIRST          ADDRESS OF FIRST ENTRY IN       31260000
*                                         TERMNAME TABLE                31290000
         EJECT                                                          31320000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       31350000
*                                                                       31380000
*        THIS NEXT SECTION OF CODE WILL CALCULATE THE TOTAL             31410000
*        NUMBER OF ENTRIES IN THE TERMNAME TABLE                 S22024 31440000
*                                                                       31470000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       31500000
*                                                                       31530000
         SR    R1,RFIRST                SUBTRACT THE ADDRESS OF THE     31560000
*                                         FIRST ENTRY FROM THE          31590000
*                                         ADDRESS OF THE LAST ENTRY     31620000
         SR    R0,R0                    CLEAR DIVIDE REGISTER           31650000
         LA    R3,4(RLEN)               LENGTH OF ENTRY NAME AND ADDR   31680000
         DR    R0,R3                    DIVIDE THE LENGTH OF TABLE      31710000
*                                         BY THE LENGTH OF AN ENTRY     31740000
         LA    R1,ONE(R1)               ADD ONE TO THE RESULT TO        31770000
*                                         GET THE ACTUAL NUMBER         31800000
*                                         OF ENTRIES                    31830000
         STH   R1,TNTLEN                STORE THE TOTAL NUMBER OF       31860000
*                                         TERMNAME ENTRIES              31890000
*                                         IN THE TERMNAME TABLE         31920000
         LA    R3,ONE                   LOAD A COMPARISON VALUE         31950000
         CR    R3,R1                    TEST FOR JUST ONE ENTRY IN      31980000
*                                         THE TERMNAME TABLE            32010000
         BNE   NOTONE                   BRANCH IF MORE THAN    @YM08559 32040000
*                                       ONE ENTRY              @YM08559 32070000
         LA    R6,ONE(RLEN,RFIRST)      BUMP TO ADDRESS PORTION@OY14517 32100000
*                                       OF ENTRY               @OY14517 32130000
         NI    TWO(R6),RESTLOW          RESET LOW ORDER BIT    @OY14517 32160000
         B     PRIMOPT                  BRANCH TO SET UP       @OY14517 32190000
*                                       TERMNAME TABLE         @OY14517 32220000
NOTONE   EQU   *                                               @OY14517 32250000
         SLL   R1,ONE                   MULTIPLY ENTRIES BY 2 TO        32280000
*                                         GET SIZE OF OFFSET TABLE      32310000
         ST    R1,AVTSAVE4+12           SAVE LENGTH FOR FREEMAIN        32340000
         LA    R0,AVTSAVE4+16           LOAD RECEIVING ADDRESS          32370000
*                                         RECEIVE THE ADDRESS OF        32400000
*                                         THE GETMAINED AREA            32430000
         BAL   R14,AVTPAR               SET UP PARAMETER LIST           32460000
*                                                                       32490000
         L     RGETAREA,AVTSAVE4+16     LOAD THE ADDRESS OF THE         32520000
*                                         OFFSET TABLE                  32550000
         LA    R2,ONE                   FIRST OFFSET VALUE              32580000
         LH    R1,TNTLEN                NUMBER TERMNAME TABLE ENTRIES   32610000
*                                         TERMNAME ENTRIES              32640000
OFFSTORE EQU   *                                                        32670000
         STH   R2,0(RGETAREA)           STORE FIRST/NEXT VALUE IN       32700000
*                                         THE OFFSET TABLE              32730000
         BCT   R1,UPDATE                REDUCE NUMBER OF ENTRIES        32760000
*                                         BY ONE                        32790000
         EJECT                                                          32820000
FIRSTENT EQU   *                                                        32850000
         LR    RPRESENT,RFIRST          ADDRESS OF THE FIRST ENTRY      32880000
*                                         IN THE TERMNAME TABLE         32910000
         LA    RTRM,4(RLEN,RFIRST)      ADDRESS OF THE SECOND ENTRY     32940000
*                                         IN THE TERMNAME TABLE         32970000
         L     ROTNOW,AVTSAVE4+16       LOAD ADDRESS OF OFFSET TABLE    33000000
         LA    ROTNEXT,2(ROTNOW)        LOAD THE ADDRESS OF THE         33030000
*                                         SECOND ENTRY IN OFFSET TBL    33060000
         MVI   AVTGETMN,NOSWAP          CLEAR THE SWAP INDICATOR        33090000
         LA    R3,3(RLEN)               GET THE LENGTH OF THE           33120000
*                                         ENTRY NAME AND ADDRESS        33150000
*                                         MINUS 1                       33180000
EXECT    EX    RLEN,COMPENT             EXECUTE A COMPARISON OF THE     33210000
*                                         TWO TERMNAME ENTRIES          33240000
         BNH   COMTAB                   THE TWO ENTRIES ARE IN          33270000
*                                         ALPHABETICAL ORDER            33300000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       33330000
*                                                                       33360000
*        SWAPPING ROUTINE                                               33390000
*                                                                       33420000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       33450000
*                                                                       33480000
         EX    R3,EX1                   SWAP THE TWO                    33510000
         EX    R3,EX2                     ENTRIES IN THE                33540000
         EX    R3,EX1                     TERMNAME TABLE                33570000
*                                                                       33600000
         XC    0(TWO,ROTNOW),0(ROTNEXT) SWAP THE TWO                    33630000
         XC    0(TWO,ROTNEXT),0(ROTNOW)   ENTRIES IN THE                33660000
         XC    0(TWO,ROTNOW),0(ROTNEXT)   OFFSET TABLE                  33690000
*                                                                       33720000
         MVI   AVTGETMN,SWAP            SET SWAP INDICATOR              33750000
*                                                                       33780000
COMTAB   EQU   *                                                        33810000
         L     R1,TNTENLEN              LAST ENTRY IN TERMNAME TABLE    33840000
         LA    R1,0(R1)                 CLEAR HIGH ORDER BYTE           33870000
         CR    RTRM,R1                  CHECK FOR END OF THE            33900000
*                                         TERMNAME TABLE                33930000
         BNL   CHKSWAP                  IF END OF TABLE, GO TO          33960000
*                                         CHECK SWAP INDICATOR          33990000
         LR    RPRESENT,RTRM            UPDATE POINTER TO TERMNAME      34020000
*                                         ENTRY N                       34050000
         LA    RTRM,4(RLEN,RTRM)        UPDATE POINTER TO TERMNAME      34080000
*                                         ENTRY N+1                     34110000
         LR    ROTNOW,ROTNEXT           UPDATE PRESENT OFFSET POINTER   34140000
         LA    ROTNEXT,TWO(ROTNEXT)     UPDATE NEXT OFFSET POINTER      34170000
         B     EXECT                    COMPARE NEXT 2 ENTRIES          34200000
*                                                                       34230000
UPDATE   EQU   *                                                        34260000
         LA    RGETAREA,2(RGETAREA)     BUMP POINTER TO THE             34290000
*                                         OFFSET TABLE BY TWO           34320000
         LA    R2,ONE(R2)               BUMP INDEX BY ONE               34350000
         B     OFFSTORE                 STORE OFFSET IN OFFSET TABLE    34380000
*                                                                       34410000
CHKSWAP  TM    AVTGETMN,SWAP            TEST SWAP INDICATOR             34440000
         BO    FIRSTENT                 GO THRU TABLE ONCE MORE         34470000
         EJECT                                                          34500000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       34530000
*                                                                       34560000
*        THIS SECTION OF CODE STORES NEW VALUES INTO THE ALTERNATE      34590000
*        TERMINAL OFFSET FIELD IN THE TERMINAL TABLE AND TESTS THE      34620000
*        STATUS OF EACH TERMINAL LISTED AS AN ALTERNATE DESTINATION     34650000
*                                                                       34680000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       34710000
*                                                                       34740000
         LH    R6,TNTLEN                NUMBER TERMNAME TABLE ENTRIES   34770000
         MVI   AVTGETMN,NOSWAP          ZERO HIGH ORDER BYTE            34800000
*                                                                       34830000
ALTSET   EQU   *                                                        34860000
         LA    R1,MSGC                  ADDRESS OF THE ERROR MESSAGE    34890000
         EX    RLEN,ERRSET              USE AN EXECUTE TO MOVE THE      34920000
*                                         TERMINAL NAME TO THE          34950000
*                                         ERROR MESSAGE                 34980000
         LA    RFIRST,1(RLEN,RFIRST)    BUMP THE POINTER TO THE         35010000
*                                         ADDRESS PORTION OF THE        35040000
*                                         ENTRY                         35070000
         TM    TWO(RFIRST),LOWBIT       LOW ORDER BIT IN ADDR  @G36XRNP 35100000
         BZ    PROCNOR                  NO, PROCESS NORMALLY   @G36XRNP 35130000
         NI    TWO(RFIRST),RESTLOW      RESET LOW ORDER BIT    @G36XRNP 35160000
         B     FOUNDMAT                 BRANCH FOR NEXT ENTRY  @G36XRNP 35190000
PROCNOR  EQU   *                                               @G36XRNP 35220000
         MVC   AVTGETMN+1(3),0(RFIRST)  MOVE TERMINAL TABLE             35250000
*                                         ADDRESS OF ENTRY INTO         35280000
*                                         A SCRATCH WORD                35310000
         L     RTRM,AVTGETMN            LOAD ADDRESS OF TERM. ENTRY     35340000
         TM    TRMSTATE,SINGLINE        TEST ENTRY TYPE                 35370000
         BO    LOADAD                   LOG ENTRY                       35400000
         BNZ   CHKCORD                  BRANCH ON NO             S22024 35430000
         TM    TRMOUTSQ,LGB             IS THIS AN LGB           S22024 35460000
         BO    FOUNDMAT                 BRANCH ON YES - IGNORE   S22024 35490000
         B     TESTLIST                 SINGLE OR LINE ENTRY     S22024 35520000
CHKCORD  EQU   *                                                 S22024 35550000
         TM    TRMSTATE,CORDLIST        IS THIS ENTRY EITHER A          35580000
*                                         CASCADE OR A DISTRIBUTION     35610000
*                                         LIST ENTRY                    35640000
         BO    CASDISTL                 GO TO UPDATE ANY CASCADE OR     35670000
*                                       DISTRIBUTION LIST ENTRIES       35700000
ALTDTEST EQU   *                                                        35730000
         CLC   TRMALTD(2),AVTFZERO      HAS AN ALTERNATE DESTINATION    35760000
*                                         BEEN SPECIFIED                35790000
         BE    FOUNDMAT                 NO, BRANCH                      35820000
*                                                                       35850000
LOADAD   EQU   *                                                        35880000
         L     R1,AVTSAVE4+16           LOAD THE BEGINNING ADDRESS      35910000
*                                         OF THE OFFSET TABLE           35940000
         LR    R0,R1                    COPY THE BEGINNING ADDRESS      35970000
*                                                                       36000000
CLCOFF   EQU    *                                                       36030000
         CLC   TRMALTD(2),0(R1)         COMPARE THE ALTERNATE           36060000
*                                         DESTINATION OFFSET TO THE     36090000
*                                         FIRST/NEXT ENTRY IN THE       36120000
*                                         OFFSET TABLE                  36150000
         BNE   ENDTAB                   CHECK FOR END OF THE            36180000
*                                         OFFSET TABLE                  36210000
         SR    R1,R0                    PICK UP THE OFFSET FROM         36240000
*                                         START OF OFFSET TABLE         36270000
         LA    R1,TWO(R1)               ADD 2 TO THE DIFFERENCE         36300000
         SRL   R1,ONE                   DIVIDE BY TWO TO GET NEW        36330000
*                                         INDEX FOR ALTERNATE           36360000
         STH   R1,TRMALTD               STORE THE NEW ALTERNATE         36390000
*                                         DESTINATION OFFSET IN THE     36420000
*                                         TERMINAL ENTRY                36450000
         TM    AVTGETMN,ILISTNOW        ARE WE CURRENTLY SORTING AN     36480000
*                                         INVITATION LIST               36510000
         BO    ALCONT                   YES, BRANCH                     36540000
         TM    AVTGETMN,CDLSTNOW        ARE WE CURRENTLY SORTING A      36570000
*                                         CASCADE OR A DISTRIBUTION     36600000
*                                         LIST                          36630000
         BO    CASDIST2                 YES, BRANCH                     36660000
         TM    TRMSTATE,LOGTYPE         IS THIS A LOG ENTRY             36690000
         BO    SETLOG                   YES, BRANCH                     36720000
         LA    RTRM,TNTFIRST            SET THE ADDRESS OF THE FIRST    36750000
*                                         ENTRY IN THE TERMNAME         36780000
*                                         TABLE                         36810000
         BCTR  R1,0                     SUBTRACT 1 FROM OFFSET VALUE    36840000
         LTR   R1,R1                    IS ALTERNATE DESTINATION        36870000
*                                       THE FIRST ENTRY IN TABLE        36900000
         BZ    ENTRY1                   YES, BRANCH                     36930000
*                                                                       36960000
LOOP     EQU   *                                                        36990000
         LA    RTRM,4(RLEN,RTRM)        GO THROUGH TERMNAME TABLE       37020000
         BCT   R1,LOOP                  GO TO NEXT ENTRY                37050000
*                                                                       37080000
ENTRY1   EQU   *                                                        37110000
         LA    RTRM,1(RLEN,RTRM)        BUMP THE POINTER TO THE         37140000
*                                         ADDRESS PORTION OF THE        37170000
*                                         ENTRY                         37200000
         MVC   AVTGETMN+1(3),0(RTRM)    MOVE TERMINAL TABLE             37230000
*                                         ADDRESS OF ENTRY INTO A       37260000
*                                         SCRATCH WORD                  37290000
         L     RTRM,AVTGETMN            LOAD THE ADDRESS OF THE         37320000
*                                         TERMINAL ENTRY                37350000
         TM    TRMSTATE,TRMACPTN        IS THIS TERMINAL ABLE TO        37380000
*                                         ACCEPT                        37410000
         BNO   TERMERR                  UNABLE TO ACCEPT                37440000
*                                                                       37470000
FOUNDMAT EQU   *                                                        37500000
         LA    RFIRST,3(RFIRST)         BUMP TERMINAL I.D. POINTER      37530000
*                                         TO NEXT ENTRY                 37560000
         BCT   R6,ALTSET                REDUCE ENTRY COUNT AND GO       37590000
*                                         TO NEXT ID ENTRY              37620000
*                                                                       37650000
         TM    AVTGETMN,ALTDSTER        HAVE WE DETECTED ANY ERRORS     37680000
*                                         WHILE RESETTING THE           37710000
*                                         ALTERNATE DESTINATIONS        37740000
         BO    TERMERR1                 YES, BRANCH                     37770000
         EJECT                                                          37800000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       37830000
*                                                                       37860000
*        THIS ROUTINE SETS UP CERTAIN FIELDS IN THE FIRST OF THE        37890000
*        TERMNAME TABLE NECESSARY FOR THE BINARY SEARCH ROUTINE         37920000
*                                                                       37950000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       37980000
*                                                                       38010000
PRIMOPT  EQU   *                                                        38040000
         SR    R6,R6                    CLEAR POWER COUNTER             38070000
         LH    R1,TNTLEN                LOAD THE TOTAL NUMBER OF        38100000
*                                         ENTRIES IN THE TABLE          38130000
         LR    R2,R1                    COPY THE ENTRY COUNT            38160000
*                                                                       38190000
TNTLOOP  EQU   *                                                        38220000
         SRL   R1,ONE                   DIVIDE ENTRIES BY 2             38250000
         LA    R6,ONE(R6)               INCREMENT THE POWER OF 2        38280000
*                                         COUNTER BY 1                  38310000
         LTR   R1,R1                    TEST FOR ZERO                   38340000
         BNZ   TNTLOOP                  DIVIDE IS NOT FINISHED          38370000
         LA    R1,ONE                   PRIME OPTIMUM ENTRY COUNTER     38400000
*                                                                       38430000
TNTLOOP2 EQU   *                                                        38460000
         SLL   R1,ONE                   MULTIPLY ENTRIES BY 2           38490000
         BCT   R6,TNTLOOP2              REDUCE POWER COUNTER BY ONE     38520000
         LR    R6,R1                    COPY OPTIMUM+1 NUMBER           38550000
         SRL   R1,ONE                   DIVIDE OPTIMUM+1 NUMBER BY      38580000
*                                         TWO                           38610000
         BCTR  R1,0                     SUBTRACT 1 FROM THE RESULT      38640000
         SRL   R6,SHIFT2                DIVIDE OPTIMUM BY 4             38670000
         STH   R6,TNTSRCHX              STORE SEARCH EXTENT FACTOR      38700000
         SR    R15,R15                  CLEAR ENTRY LENGTH REGISTER     38730000
         IC    R15,TNTENLEN             SAVE ENTRY LENGTH               38760000
         LA    RFIRST,TNTFIRST          ADDRESS OF THE FIRST ENTRY      38790000
*                                         IN THE TERMNAME TABLE         38820000
         LTR   R6,R6                    TEST FOR 1 ENTRY                38850000
         BNZ   TERMAD                   THERE IS MORE THAN 1 ENTRY      38880000
*                                                                       38910000
TERMSTOR EQU   *                                                        38940000
         ST    RFIRST,TNTENLEN          STORE IN THE TERMNAME TABLE     38970000
         STC   R15,TNTENLEN             RESTORE ENTRY LENGTH            39000000
         B     SORTLINE                 GO ESTABLISH GROUP LINE@Y17XANG 39030000
*                                       HIERARCHY.             @Y17XANG 39060000
TERMAD   EQU   *                                                        39090000
         LA    RFIRST,4(RLEN,RFIRST)    BUMP THE ADDRESS                39120000
         BCT   R1,TERMAD                BUMP THE POINTER AGAIN          39150000
         B     TERMSTOR                 STORE THE ADDRESS OF THE        39180000
         EJECT                                                          39210000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       39240000
*                                                                       39270000
*        THIS SECTION OF CODE RESETS THE TERMNAME OFFSETS               39300000
*        FOR ALL ENTRIES IN EITHER A CASCADE OR A DISTRIBUTION          39330000
*        LIST                                                           39360000
*                                                                       39390000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       39420000
*                                                                       39450000
CASDISTL EQU   *                                                        39480000
         BCTR  RTRM,0                   DECREMENT BEGINNING ADDRESS OF  39510000
         BCTR  RTRM,0                     LIST BY TWO                   39540000
         LH    R3,SIX(RTRM)             LOAD THE NUMBER OF ENTRIES      39570000
         OI    AVTGETMN,CDLSTNOW        SET A FLAG TO INDICATE THAT     39600000
*                                         WE ARE CURRENTLY SORTING      39630000
*                                         A CASCADE OR DISTRIBUTION     39660000
*                                         LIST                          39690000
         B     LOADAD                   SET OFFSET TABLE ADDRESSES      39720000
*                                                                       39750000
CASDIST2 EQU   *                                                        39780000
         LR    R2,R15                   SAVE REG.                S22026 39810000
         L     R15,AVTRNMPT             ADDR OF TNT CODE         S22026 39840000
         BALR  R14,R15                  GET TRM ENTRY ADDRESS    S22026 39870000
         N     R1,LOWOFF                TURN OFF LOW ORDER BIT @OY12967 39900000
         L     R14,TRMDESTQ-IEDQTRM-1(R1) GET QCB ADDR           S22026 39930000
         LR    R15,R2                   RESTORE REG.             S22026 39960000
         TM    QCBDSFLG-IEDQQCB(R14),QCBDRQQ CONC                S22026 39990000
         BO    TERMERR                  YES,ERROR, BRANCH        S22026 40020000
         LA    RTRM,2(RTRM)             BUMP THE POINTER TO THE         40050000
*                                         NEXT LIST ENTRY               40080000
         BCT   R3,LOADAD                SET OFFSET TABLE ADDRESSES      40110000
         NI    AVTGETMN,CDLSTOFF        TURN OFF THE CASCADE SORT       40140000
*                                         IN PROGRESS FLAG              40170000
         B     FOUNDMAT                 GO TO NXT TABLE ENTRY    S22026 40200000
*                                                                       40230000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       40260000
*                                                                       40290000
*        THIS SECTION OF CODE STORES THE NEW TERMNAME OFFSET            40320000
*        FOR ALL LOG ENTRIES IN THE LCB OF THE ENTRIES                  40350000
*                                                                       40380000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       40410000
*                                                                       40440000
SETLOG   EQU   *                                                        40470000
         XC    TRMALTD(TWO),TRMALTD     CLEAR THE DUMMY ALTERNATE       40500000
*                                         DESTINATION FIELD IN THE      40530000
*                                         LOG TERMINAL ENTRY            40560000
         L     RQCB,TRMSTATE            LOAD THE ADDRESS OF THE         40590000
*                                         DESTINATION QCB FOR THIS      40620000
*                                         ENTRY                         40650000
         L     R3,QCBRELLN              LOAD THE ADDRESS OF THE LOG     40680000
*                                         LCB                           40710000
         STH   R1,LCBTTCIN-IEDQLCB(,R3) STORE THE NEW TERMNAME   X03039 40740000
*                                         OFFSET IN THE LOG LCB         40770000
         B     FOUNDMAT                 CHECK THE NEXT ENTRY IN THE     40800000
*                                         TERMNAME TABLE                40830000
         EJECT                                                          40860000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       40890000
*                                                                       40920000
*        THIS ROUTINE SETS UP CERTAIN FIELDS NECESSARY FOR              40950000
*        SORTING ALL INVITATION LISTS ASSOCIATED WITH A DCB             40980000
*                                                                       41010000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       41040000
*                                                                       41070000
TESTLIST EQU   *                                                        41100000
         TM    TRMSTATE,TRMPREF         EP RESOURCE?           @PI02861 41130000
         BZ    NOTSSCP                  BRANCH YES             @PI02861 41160000
         LA    R2,TRMPRFSZ              TRM PREFIX SIZE        @PI02861 41190000
         LR    R3,RTRM                  TRM ADDR               @PI02861 41220000
         SR    R3,R2                    TRM PREFIX ADDRESS     @PI02861 41250000
         USING IEDNTRM,R3                                      @PI02861 41280000
         CLI   TRMTYPE,TRMSSCP          SSCP'S TRM?            @PI02861 41310000
         BE    ALTDTEST                 BRANCH YES TO BYPASS   @PI02861 41340000
         CLI   TRMTYPE,TRMLNCP          NCP TRM?               @PI02861 41370000
         BE    ALTDTEST                 BRANCH YES TO BYPASS   @PI02861 41400000
         DROP  R3                                              @PI02861 41430000
NOTSSCP  EQU   *                                               @PI02861 41460000
         L     RQCB,TRMSTATE            LOAD THE ADDRESS OF THE         41490000
*                                         DESTINATION QCB FOR THIS      41520000
*                                         ENTRY                         41550000
         L     RDCB,QCBRELLN            POINT TO THE DCB                41580000
         TM    DCBDSORG,LGB             IS THIS AN LGB           S22024 41610000
         BNO   SORTED                   BRANCH ON NO             S22024 41640000
         TM    TRMSTATE,LINE            IS THIS A LINE ENTRY     S22024 41670000
         BNO   RNTERM                   NO, MUST BE A TERMINAL   X03039 41700000
         IC    RCPB,LGBLNCT(RDCB)       GET NUMBER OF LINES      S22024 41730000
         LA    RCPB,1(RCPB)             UPDATE COUNT             S22024 41760000
         STC   RCPB,LGBLNCT(RDCB)       STORE NEW COUNT          S22024 41790000
         B     ALTDTEST                 CHECK ALTERNATE DEST     S22024 41820000
RNTERM   EQU   *                                                 X03039 41850000
         NC    LGBBUFSI-IEDNLGB(2,RDCB),LGBBUFSI-IEDNLGB(RDCB) @OZ29219 41855082
*                                       IS BUFSIZE ZERO        @OZ29219 41860082
         BNZ   BUFOK                    IF ZERO LEAVE AS IS    @OZ29219 41865082
         MVC   LGBBUFSI-IEDNLGB(2,RDCB),AVTKEYLE  REP 0 BUFSIZE@OZ29219 41870082
BUFOK    EQU   *                                               @OZ29219 41875082
         CLI   DCBILCT,AVTEZERO         NO LISTS SPECIFIED       X03039 41880000
         BE    ALTDTEST                 NONE, BRANCH             X03039 41910000
SORTED   EQU   *                                                 S22024 41940000
         TM    DCBEIOBX,ILISORTD        HAVE WE SORTED ALL THE          41970000
*                                         INVITATION LISTS              42000000
*                                         ASSOCIATED WITH THIS DCB      42030000
         BO    ALTDTEST                 YES, BRANCH                     42060000
         SR    RCPB,RCPB                CLEAR A REGISTER FOR THE        42090000
*                                         COUNT OF INVITATION LISTS     42120000
         IC    RCPB,DCBILCT             GET THE NUMBER OF INVITATION    42150000
*                                         LIST ADDRESSES IN THIS DCB    42180000
         SR    R2,R2                    CLEAR AN INDEX REGISTER         42210000
*                                                                       42240000
ILSTLOAD EQU   *                                                        42270000
         L     RTRM,DCBINVLI(R2)        LOAD THE ADDRESS OF THE         42300000
*                                         FIRST/NEXT INVITATION         42330000
*                                         LIST                          42360000
         TM    THREE(RTRM),INVLSRTD     HAVE WE PREVIOUSLY SORTED       42390000
*                                         THIS INVITATION LIST          42420000
         BO    RESET                    YES, BRANCH                     42450000
         SR    R3,R3                    CLEAR AN ENTRY COUNTER          42480000
         IC    R3,0(RTRM)               LOAD THE NUMBER OF ENTRIES      42510000
*                                         IN THE INVITATION LIST        42540000
         LTR   R3,R3                    IS THIS A DUMMY INVITATION      42570000
*                                         LIST                          42600000
         BZ    RESET                    YES, BRANCH                     42630000
         LA    R1,TEN                   LOAD A DISPLACEMENT OF 10       42660000
         SR    RTRM,R1                  SET THE STARTING ADDRESS        42690000
*                                         OF THE LIST TO MINUS 8        42720000
         OI    AVTGETMN,ILISTNOW        SET A FLAG TO INDICATE AN       42750000
*                                         INVITATION LIST IS BEING      42780000
*                                         SORTED                        42810000
         B     LOADAD                   LOAD OFFSET ADDRESSES           42840000
*                                                                       42870000
ALCONT   EQU   *                                                        42900000
         BCTR  RTRM,0                   DECREMENT ADDRESS PTR    S22025 42930000
         BCTR  RTRM,0                   DECREMENT POINTER AGAIN  S22025 42960000
         BCT   R3,LOADAD                TEST THE NEXT INVITATION        42990000
*                                         LIST ENTRY                    43020000
         L     R3,DCBINVLI(R2)          LOAD THE ADDRESS OF THE         43050000
*                                         CURRENT INVITATION LIST       43080000
         OI    THREE(R3),INVLSRTD       INDICATE THAT THIS              43110000
*                                         INVITATION LIST HAS BEEN      43140000
*                                         SORTED                        43170000
RESET    EQU   *                                                        43200000
         LA    R2,FOUR(R2)              INCREMENT THE ADDRESS INDEX     43230000
*                                         BY 4                          43260000
         BCT   RCPB,ILSTLOAD            DECREMENT THE COUNT OF          43290000
*                                         INVITATION LISTS TO BE        43320000
*                                         SORTED                        43350000
         NI    AVTGETMN,ILISTOFF        TURN OFF THE LIST BEING         43380000
*                                         SORTED FLAG                   43410000
         OI    DCBEIOBX,ILISORTD        SET THE FLAG TO INDICATE        43440000
*                                         THAT ALL INVITATION LISTS     43470000
*                                         FOR THIS DCB HAVE BEEN SORTED 43500000
         MVC   AVTGETMN+1(3),0(RFIRST)  MOVE THE ADDRESS OF THE         43530000
*                                         TERMINAL ENTRY INTO A         43560000
*                                         SCRATCH WORD                  43590000
         L     RTRM,AVTGETMN            LOAD THE TERMINAL ADDRESS       43620000
         B     ALTDTEST                 TEST FOR AN ALTERNATE           43650000
*                                         DESTINATION                   43680000
ENDTAB   EQU   *                                                        43710000
         CR    R1,RGETAREA              TEST FOR END OF OFFSET TBL      43740000
         BNL   TERMERR                  TERMINAL ERROR DETECTED         43770000
*                                                                       43800000
         LA    R1,TWO(R1)               BUMP POINTER TO NEXT ENTRY      43830000
*                                         IN OFFSET TABLE               43860000
         B     CLCOFF                   TEST NEXT ENTRY IN OFFSET       43890000
*                                         TABLE                         43920000
         EJECT                                                          43950000
TERMERR  EQU   *                                                        43980000
         OI    AVTGETMN,ALTDSTER        SET THE ERROR INDICATOR IN      44010000
*                                         THE AVT                       44040000
MSG      WTO   'IED007I 0        ILLEGAL DESTINATION',                 C44070000
               ROUTCDE=11,DESC=4                                        44100000
*                                                                       44130000
         TM    AVTGETMN,ILISTNOW        ARE WE CURRENTLY SORTING        44160000
*                                         AN INVITATION LIST            44190000
         BO    RESET                    YES, BRANCH                     44220000
         TM    AVTGETMN,CDLSTNOW        ARE WE CURRENTLY SORTING A      44250000
*                                         CASCADE OR A DISTRIBUTION     44280000
*                                         LIST                          44310000
         BZ    FOUNDMAT                 NO, BRANCH                      44340000
         NI    AVTGETMN,CDLSTOFF        YES, TURN OFF THE SORT IN       44370000
*                                         PROGRESS FLAG                 44400000
         B     FOUNDMAT                 GO TO NEXT TABLE ENTRY   S22025 44430000
         EJECT                                                          44460000
COMPSUBR EQU   *                                                        44490000
         EX    RLEN,COMPENT             EXECUTE A COMPARISON TO         44520000
*                                         FIND A MATCH FOR THE          44550000
*                                         OPERATOR CONTROL TERMINAL     44580000
         BNE   NEXTERM                  UPDATE ENTRY POINTER            44610000
         LR    R0,RTRM                  COPY POINTER TO ENTRY IN        44640000
*                                         THE TERMNAME TABLE            44670000
         SR    R0,RTNT                  GET OFFSET FROM START OF        44700000
*                                         TERMNAME TABLE                44730000
         BR    R2                       RETURN                          44760000
*                                                                       44790000
NEXTERM  EQU   *                                                        44820000
         LA    RTRM,4(RLEN,RTRM)        UPDATE POINTER TO NEXT          44850000
*                                         ENTRY IN TERMNAME TABLE       44880000
         BCT   R3,COMPSUBR              TEST THE NEXT TERMINAL          44910000
         LA    R3,AVTDOUBX              LOAD THE ADDRESS OF THE         44940000
*                                         PRIMARY OPERATOR CONTROL      44970000
*                                         TERMINAL NAME                 45000000
         CR    R3,R1                    ARE WE TESTING FOR A POC        45030000
*                                         TERMINAL                      45060000
         BE    POCERR                   YES, BRANCH BECAUSE WE HAVE     45090000
*                                         NOT FOUND THAT TERMINAL       45120000
*                                         DEFINED AS THE PRIMARY        45150000
*                                         OPERATOR CONTROL TERMINAL     45180000
DLQMSG   EQU   *                                                        45210000
         SR    R3,R3                    CLEAR A REGISTER TO ZEROES      45240000
         STH   R3,AVTDLQX               SET THE DEAD LETTER QUEUE       45270000
*                                         OFFSET TO ZERO                45300000
         WTO   'IED078I DLQ TERM ERROR',MF=I,ROUTCDE=11,DESC=4          45330000
*                                                                       45360000
         B     IDSORT                   CHECK FOR CONCENTRATORS  S22026 45390000
         EJECT                                                 @Y17XANG 45420000
*********************************************************************** 45450000
*                                                              @Y17XANG 45480000
* BUILD THE GROUP-LINE TTE HIERARCHY.                          @Y17XANG 45510000
*                                                              @Y17XANG 45540000
***************************************************************@Y17XANG 45570000
SORTLINE EQU   *                                               @Y17XANG 45600000
         SPACE                                                          45630000
* IF THIS IS AN EP ONLY SYSTEM BYPASS ESTABLISHING THE LINE    @Y17XANG 45660000
* GROUP HIERARCHY AND INITIATING THE QCBTTCIN FIELDS.          @Y17XANG 45690000
         SPACE                                                          45720000
         TM    AVTSAVTF,AVTVTMCP        EP ONLY?               @Y17XANG 45750000
         BZ    AVTTEST                  BRANCH YES             @Y17XANG 45780000
         L     R15,SORTAD               ADDR BUILD ROUTINE.    @Y17XANG 45810000
         BALR  R14,R15                  GO BUILD HIERARCHY.    @Y17XANG 45840000
         EJECT                                                 @Y17XANG 45870000
***************************************************************@Y17XANG 45900000
*                                                              @Y17XANG 45930000
* INITIATE QCB TNT INDEX FIELD FOR 3705 CLUSTERS, TERMINALS,   @Y17XANG 45960000
* LU'S AND CTERM TTE'S.                                        @Y17XANG 45990000
*                                                              @Y17XANG 46020000
***************************************************************@Y17XANG 46050000
         SPACE                                                          46080000
         L     R15,TTCINAD              ADDR OF TTCIN ADJ ROUT @Y17XANG 46110000
         BALR  R14,R15                  INITIATE QCB TNT INDEXS@Y17XANG 46140000
         EJECT                                                          46170000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       46200000
*                                                                       46230000
*        THIS ROUTINE CHECKS FOR THE PRESENCE OF A PRIMARY OPERATOR     46260000
*        CONTROL TERMINAL BEING SPECIFIED IN THE AVT                    46290000
*                                                                       46320000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       46350000
*                                                                       46380000
AVTTEST  EQU   *                                                        46410000
         LH    R3,TNTLEN                NUMBER TERMNAME TABLE ENTRIES   46440000
*                                         IN THE TERMNAME TABLE         46470000
         SLR   RLEN,RLEN                                       @Y17XANG 46500000
         IC    RLEN,TNTENLEN            TNT NAME LENGTH        @Y17XANG 46530000
         BCTR  RLEN,0                   MINUS 1 FOR EXECUTE    @Y17XANG 46560000
         CLI   AVTDOUBX,AVTEZERO        TEST FOR A PRIMARY OPERATOR     46590000
*                                         CONTROL TERMINAL              46620000
         BE    BEGINDLQ                 NO POC TERMINAL, BRANCH         46650000
         CLC   AVTDOUBX(EIGHT),SYSCON   HAS SYSCON BEEN SPECIFIED       46680000
*                                         AS THE PRIMARY OPERATOR       46710000
*                                         CONTROL TERMINAL              46740000
         BE    BEGINDLQ                 YES, BRANCH                     46770000
         LA    R1,AVTDOUBX              LOAD THE ADDRESS OF PRIMARY     46800000
*                                       OPERATOR CONTROL TERMINAL       46830000
         LA    RTRM,TNTFIRST            LOAD ADDRESS OF FIRST ENTRY     46860000
*                                         IN TERMNAME TABLE             46890000
         BAL   R2,COMPSUBR              BRANCH TO THE COMPARISON        46920000
*                                         SUBROUTINE                    46950000
         STH   R0,AVTOPCON              STORE OFFSET IN AVT             46980000
         AR    R0,RTNT                  ADD TNT BASE TO OFFSET @Y17XANG 47010000
         LA    R1,TNTFIRST              GET ADDR OF 1ST ENTRY  @YM06156 47040000
*                                       IN THE TNT             @YM06156 47070000
         SR    R0,R1                    DISP TO PRIMARY OPCON  @YM06156 47100000
*                                       FROM FIRST TNT ENTRY.  @Y17XANG 47130000
         LR    R1,R0                    RIGHT MOST DIVIDEND    @Y17XANG 47160000
*                                       REGISTER.              @Y17XANG 47190000
         LA    R2,4(RLEN)               TNT ENTRY LENGTH       @Y17XANG 47220000
         SR    R0,R0                    CLEAR HI ORDER OF      @Y17XANG 47250000
*                                       DIVIDEND REGISTER.     @Y17XANG 47280000
         DR    R0,R2                    TNT INDEX OF PRIMARY   @Y17XANG 47310000
*                                       OP CONSOLE.            @Y17XANG 47340000
         LA    R1,1(,R1)                BUMP RELATIVE OFFSET   @YM06156 47370000
*                                       TO GET TNT OFFSET      @YM06156 47400000
         STH   R1,AVTOPCIN              SAVE IN AVT.           @Y17XANG 47430000
         LA    RTRM,ONE(RLEN,RTRM)      POINTER TO THE                  47460000
*                                         ADDRESS PORTION OF ENTRY      47490000
         MVC   AVTGETMN+1(3),0(RTRM)    MOVE TERMINAL TBL ADDRESS       47520000
*                                         ADDRESS TO SCRATCH AREA       47550000
         L     R2,AVTGETMN              LOAD TERMINAL ADDRESS           47580000
         L     R3,0(R2)                 LOAD QCB ADDRESS        SA51787 47610000
         CLI   0(R3),QCBFQCB            PUT PROCESS ENTRY       SA51787 47640000
         BE    PUTOK                    BRANCH IF YES           SA51787 47670000
         TM    TRMSTATE-IEDQTRM(R2),TRMACPTN  CAN TERM ACCEPT  @OY18827 47700000
*                                         AND ACCEPT CAPABILITIES       47730000
         BNO   POCERR                   GO TO ERROR CODE ROUTINE        47760000
PUTOK    EQU   *                                                SA51787 47790000
         TM    0(R2),SECOPCTL           HAS THIS TERMINAL BEEN          47820000
*                                         DEFINED AS A SECONDARY        47850000
*                                         OPERATOR CONTROL TERMINAL     47880000
         BZ    POCERR                   NO, THEN THERE IS AN ERROR      47910000
         TM    TRMDSORG-IEDQTRM(R2),TRMLGB IS ENTRY A 3705       S22024 47940000
*                                       LINE GROUP BLOCK         S22024 47970000
         BO    POCERR                   YES, ERROR               S22024 48000000
         LH    R3,TNTLEN                NUMBER TERMNAME TABLE ENTRIES   48030000
*                                         NUMBER OF TERMINAL ENTRIES    48060000
         EJECT                                                          48090000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       48120000
*                                                                       48150000
*        THIS SECTION OF CODE TESTS FOR THE PRESENCE OF AN              48180000
*        ENTRY IN THE TERMNAME TABLE WHICH HAS BEEN                     48210000
*        DEFINED AS THE DEAD LETTER QUEUE TERMINAL                      48240000
*                                                                       48270000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       48300000
*                                                                       48330000
BEGINDLQ EQU   *                                                        48360000
         LA    R1,AVTDLQ                LOAD THE ADDRESS OF THE         48390000
*                                         DEAD LETTER QUEUE             48420000
*                                         TERMINAL NAME                 48450000
         NC    0(8,R1),0(R1)            HAS THE USER DEFINED A          48480000
*                                         TERMINAL AS A DEAD LETTER     48510000
*                                         QUEUE                         48540000
         BZ    IDSORT                   NO, BRANCH               S22026 48570000
         LA    RTRM,TNTFIRST            LOAD THE ADDRESS OF THE         48600000
*                                         FIRST ENTRY IN THE TNT        48630000
         BAL   R2,COMPSUBR              BRANCH TO THE COMPARISON        48660000
*                                         SUBROUTINE                    48690000
         LA    R1,TNTOFF                LOAD THE ADDRESS OF THE         48720000
*                                         FIRST ENTRY IN THE TNT        48750000
         SR    R0,R1                    SUBTRACT THE ADDRESS OF         48780000
*                                         THE FIRST ENTRY FROM THE      48810000
*                                         DLQ OFFSET                    48840000
         LR    R1,R0                    COPY THE TERMINAL OFFSET        48870000
         SR    R0,R0                    CLEAR THIS REGISTER FOR         48900000
*                                         THE DIVISION                  48930000
         LA    R3,4(RLEN)               LENGTH OF ENTRY NAME AND ADDR   48960000
         DR    R0,R3                    DIVIDE THE TERMINAL OFFSET      48990000
*                                         BY THE LENGTH OF A            49020000
*                                         TERMNAME TABLE ENTRY          49050000
         LA    R1,ONE(R1)               INCREMENT THE TERMINAL OFFSET   49080000
         STH   R1,AVTDLQX               STORE THE TERMINAL NUMBER       49110000
*                                         OF THE DEAD LETTER QUEUE      49140000
*                                         IN THE AVT                    49170000
         AR    RTRM,RLEN                ACCESS THE ADDRESS OF THE       49200000
*                                         TERMINAL ENTRY                49230000
         MVC   AVTGETMN+1(3),1(RTRM)    MOVE THE TERMINAL ADDRESS       49260000
*                                         OF THE DEAD LETTER QUEUE      49290000
*                                         ENTRY TO A SCATCH WORD        49320000
         L     RTRM,AVTGETMN            LOAD THIS ADDRESS INTO          49350000
*                                         REGISTER                      49380000
         L     RQCB,0(RTRM)             LOAD THE ADDRESS OF THE QCB     49410000
*                                         FOR THIS TERMINAL             49440000
         TM    QCBDSFLG,TSOTERM         IS THIS A TSO TERMINAL          49470000
         BZ    DLQMSG                   YES, BRANCH                     49500000
         EJECT                                                          49530000
*********************************************************************** 49560000
*                                                                     * 49590000
*        THIS SECTION OF CODE SORTS THE DEVICE I.D. TABLE FOR EACH    * 49620000
*        CONCENTRATOR IN THE SYSTEM                                   * 49650000
*                                                                     * 49680000
*********************************************************************** 49710000
IDSORT   EQU   *                                                 S22026 49740000
         TM    AVTSCOPT,AVTCONC+AVTCONCO ANY CONCS IN SYSTEM     S22026 49770000
         BZ    ENDIDSRT                 NO, BRANCH               S22026 49800000
*                                                                S22026 49830000
         MVI   AVTGETMN,HEXZERO         ZERO ERROR SWITCH        S22026 49860000
         LH    RTNTCTR,TNTLEN           NO. OF ENTRIES IN TNT    S22026 49890000
         N     RTNTCTR,AVTCLRHI         CLEAR HIGH-ORDER BYTE    S22026 49920000
         LA    RPRESENT,TNTFIRST        ADDR OF TERMINAL NAME    S22026 49950000
         SR    RLENTN,RLENTN                                     S22026 49980000
         IC    RLENTN,TNTENLEN          LENGTH OF TERMINAL NAME  S22026 50010000
         BCTR  RLENTN,0                 DECREMENT LENGTH         S22026 50040000
NEXTTRMN EQU   *                                                 S22026 50070000
         LA    RTRM,ONE(RLENTN,RPRESENT)                         S22026 50100000
         MVC   AVTGETMN+1(3),0(RTRM)    ADDR OF TRM ENTRY        S22026 50130000
         L     RTRM,AVTGETMN            GET ADDR OF TRM ENTRY    S22026 50160000
         TM    TRMSTATE,ENTRYTYP        SINGLE ENTRY             S22026 50190000
         BNZ   NEXTTRM                  NO, BRANCH               S22026 50220000
         TM    TRMDSORG,TRMLGB          LGB                      S22024 50250000
         BO    NEXTTRM                  YES BRANCH               S22024 50280000
         TM    TRMDEVFL+1,CONC          CONC OR ATTACHED TRM     S22026 50310000
         BO    SORTIDT                  YES, BRANCH              S22026 50340000
*                                                                S22026 50370000
NEXTTRM  EQU   *                                                 S22026 50400000
         LA    RPRESENT,FOUR(RLENTN,RPRESENT) NXT TRM ENTRY ADDR S22026 50430000
         BCT   RTNTCTR,NEXTTRMN         GO THRU ENTIRE TNT       S22026 50460000
*                                                                S22026 50490000
         B     ENDIDSRT                 ALL ID TBLS SORTED       S22026 50520000
*                                                                S22026 50550000
SORTIDT  EQU   *                                                 S22026 50580000
         L     RQCB,TRMDESTQ-1          ADDR OF DEST QCB         S22026 50610000
         TM    QCBDSFLG,QCBDRQQ         DATA READY QUEUE         S22026 50640000
         BO    LOCIDTBL                 YES, BRANCH              S22026 50670000
*                                                                S22026 50700000
         AH    RQCB,QCBEXTO             CALC EXTENSION ADDR      S22026 50730000
         USING IEDQQCBE,RQCB                                     S22026 50760000
         L     RTRM,QCBECONC-1          ADDR OF CONC TRM ENTRY   S22026 50790000
         DROP  RQCB                                              S22026 50820000
         USING IEDQQCB,RQCB                                      S22026 50850000
LOCIDTBL EQU   *                                                 S22026 50880000
         SR    RWORK,RWORK                                       S22026 50910000
         LA    RFLD,TRMOPNO             DVC FLD IF NO OPT FLD    S22026 50940000
         TM    TRMSTATE,TRMOPTFN        OPTION FIELDS USED       S22026 50970000
         BZ    NOOPT                    NO, FIND DEV DEP FIELD   S22026 51000000
*                                                                S22026 51030000
         IC    RWORK,TRMOPNO            NO. OF OPTION ENTRIES    S22026 51060000
         LA    RFLD,THREE(RWORK,RFLD)   BYPASS OPTION FIELDS     S22026 51090000
NOOPT    EQU   *                                                 S22026 51120000
         LH    RFLGS,TRMDEVFL           DEVICE DEPENDENT FIELDS  S22026 51150000
         SLL   RFLGS,FIFTEEN            SHIFT FLAGS TO HI ORDER  S22026 51180000
         LA    RCTR1,EIGHT              DESIRED FIELD            S22026 51210000
LOOPFLD  EQU   *                                                 S22026 51240000
         SLL   RFLGS,ONE                SHIFT TO TEST PRESENCE   S22026 51270000
         LTR   RFLGS,RFLGS              THIS FIELD PRESENT       S22026 51300000
         BNM   BCTIT                    NO, DONT BUMP POINTER    S22026 51330000
*                                                                S22026 51360000
         IC    RWORK,0(RFLD)            GET LENGTH OF THIS FIELD S22026 51390000
         LA    RFLD,ONE(RWORK,RFLD)     BUMP PTR PAST FIELD      S22026 51420000
BCTIT    EQU   *                                                 S22026 51450000
         BCT   RCTR1,LOOPFLD            LOOP TIL FIELD LOCATED   S22026 51480000
*                                                                S22026 51510000
         MVC   AVTGETMN+4(4),ONE(RFLD)  PTR TO DEVICE ID TABLE   S22026 51540000
         L     RIDPTR,AVTGETMN+4        ADDRESS OF DVC ID TABLE  S22026 51570000
         USING IEDQDVCT,RIDPTR                                   S22026 51600000
         LTR   RIDPTR,RIDPTR            CONCENTRATOR             S22026 51630000
         BM    ACONC                    YES, BRANCH              S22026 51660000
*                                                                S22026 51690000
         L     R8,IDERRAD               GET ADDR ERR MSG RTN   @G36XRNP 51720000
         BALR  RLINK,R8                 WRITE ERR MSG          @G36XRNP 51750000
*                                                                S22026 51780000
         B     NEXTTRM                  CHK NEXT TRM             S22026 51810000
*                                                                S22026 51840000
ACONC    EQU   *                                                 S22026 51870000
         TM    DVCSTAT,DVCSORTD         IS TABLE ALREADY SORTED  S22026 51900000
         BO    NEXTTRM                  YES, BRANCH              S22026 51930000
*                                                                S22026 51960000
         LR    RSVADR,RIDPTR            SAVE DVC ID TABLE ADDR   S22026 51990000
         SR    RIDCNT,RIDCNT            ZERO ACCUMULATOR         S22026 52020000
         SR    RLENDE,RLENDE            ZERO ACCUMULATOR         S22026 52050000
         IC    RLENDE,DVCENLTH          LENGTH OF DVC ID ENTRY   S22026 52080000
         LA    RIDPTR,DVCECW-DVCNO(RIDPTR) POINT TO ENTRY        S22026 52110000
NEXTID   EQU   *                                                 S22026 52140000
         LA    RIDCNT,ONE(RIDCNT)       COUNT ENTRY              S22026 52170000
         L     ROTNOW,AVTSAVE4+16       ADDR OF OFFSET TABLE     S22026 52200000
         LH    RCTR2,TNTLEN             ENTRIES IN OFFSET TABLE  S22026 52230000
         N     RCTR2,AVTCLRHI           CLEAR HIGH-ORDER BYTE    S22026 52260000
         SR    RTNTOFF,RTNTOFF                                   S22026 52290000
         IC    RTNTOFF,DVCIDLTH         LENGTH OF THIS DVC ID    S22026 52320000
         LA    RTNTOFF,ONE(RTNTOFF,RIDPTR) ADDR OF TNT OFFSET    S22026 52350000
COMPOFF  EQU   *                                                 S22026 52380000
         CLC   0(2,ROTNOW),0(RTNTOFF)   COMPARE THE OFFSETS      S22026 52410000
         BNE   TRYNEXT                  NO, BRANCH               S22026 52440000
*                                                                S22026 52470000
         S     ROTNOW,AVTSAVE4+16       CALC NEW OFFSET          S22026 52500000
         LA    ROTNOW,TWO(ROTNOW)       ADD TWO TO THE DIFF      S22026 52530000
         SRL   ROTNOW,ONE               CALC NEW INDEX           S22026 52560000
         STH   ROTNOW,AVTGETMN+2        SAVE NEW OFFSET          S22026 52590000
         MVC   0(2,RTNTOFF),AVTGETMN+2  RESET DVC ID TBL OFFSET  S22026 52620000
ENDLIST  EQU   *                                                 S22026 52650000
         LA    RIDPTR,0(RLENDE,RIDPTR)  ADDR NEXT ENTRY IN TABLE S22026 52680000
         CLI   DVCIDLTH,DVCEND          END OF LIST              S22026 52710000
         BNE   NEXTID                   UPDATE NEXT ID OFFSET    S22026 52740000
*                                                                S22026 52770000
         LR    RIDPTR,RSVADR            DVC ID TABLE ADDR        S22026 52800000
         OI    DVCSTAT,DVCSORTD         INDICATE TBL SORTED      S22026 52830000
         STC   RIDCNT,DVCNO             SAVE COUNT OF ENTRIES    S22026 52860000
         B     NEXTTRM                  CHECK NEXT TERMINAL      S22026 52890000
*                                                                S22026 52920000
TRYNEXT  EQU   *                                                 S22026 52950000
         LA    ROTNOW,2(ROTNOW)         INDEX TO NEXT OFFSET     S22026 52980000
         BCT   RCTR2,COMPOFF            END OF OFFSET TABLE      S22026 53010000
*                                                                S22026 53040000
         L     R8,IDERRAD               GET ADDR ERR MSG RTN   @G36XRNP 53070000
         BALR  RLINK,R8                 WRITE ERR MSG          @G36XRNP 53100000
*                                                                S22026 53130000
         B     ENDLIST                  CHK FOR END OF LIST      S22026 53160000
*                                                                S22026 53190000
ENDIDSRT EQU   *                                                 S22026 53220000
         LM    R0,R1,AVTSAVE4+12        LENGTH/AREA TO FREE      S22026 53250000
         LTR   R1,R1                    WAS GETMAIN USED        SA54926 53280000
         BZ    CODEFIX                  IF NOT BRANCH           SA54926 53310000
         FREEMAIN  R,LV=(0),A=(1)       FREE THE OFFSET TABLE    S22026 53340000
         LA    R15,RETCDE               SET RETURN CODE          S22026 53370000
         TM    AVTGETMN,ALTDSTER        ANY ERRORS               S22026 53400000
         BO    ERROR                    YES, BRANCH              S22026 53430000
*                                                                       53460000
CODEFIX  EQU   *                                                        53490000
         LR    R1,RAVT                  AVT IS PARAMETER LIST           53520000
         L     R3,AVTCLOSB+8            LOAD THE ADDRESS OF THE         53550000
*                                         CLOSEDOWN/COMPLETION RTNE     53580000
         LA    R3,SIX(R3)               GET THE ADDRESS OF THE          53610000
*                                         FIRST INSTRUCTION             53640000
         EJECT                                                          53670000
         L     R6,AVTTSOPT              ADDRESS OF TIME SHARING QCB     53700000
         L     R6,TSISTAE-IEDQTSI(,R6)  ADDRESS OF TSO STAE ROUTINE     53730000
         LA    R6,4(,R6)                INCREMENT TO ENTRY POINT        53760000
*                                          FOR STAI EXITS               53790000
***************************************************************@YA10680 53820000
*                                                             *@YA10680 53850000
*   THIS SECTION OF CODE IS TO CHECK TO SEE IF THERE IS       *@YA10680 53880000
*   REALLY A VIRTUAL MACHINE WHEN THE USER SPECIFIED VM=YES   *@YA10680 53910000
*   ON THE INTRO MACRO                                        *@YA10680 53940000
*                                                             *@YA10680 53970000
***************************************************************@YA10680 54000000
         L     R4,AVTSAVTP              SECONDARY AVT          @YA10680 54030000
* CHECK CPU ID                                                 @YA10680 54180000
         MODESET MODE=SUP               SWITCH TO SUPERVISOR   @G36XRNP 54210000
*                                       MODE                   @G36XRNP 54240000
         MODESET EXTKEY=SUPR            SWITCH TO KEY ZERO     @G36XRNP 54270000
         STIDP AVTDOUBL                 STORE CPU ID           @G36XRNP 54300000
         MODESET EXTKEY=TCAM            SWITCH TO TCAM KEY (6) @G36XRNP 54330000
         MODESET MODE=PROB              SWITCH BACK TO PROBLEM @G36XRNP 54360000
*                                       PROGEAM MODE           @G36XRNP 54390000
         LR    R1,RAVT                  RESTORE AVT ADDRESS    @G36XRNP 54420000
         CLI   AVTDOUBL,VMFLG           THIS A VIRTUAL MACHINE @G36XRNP 54450000
         BE    VMYES                    YES, CHECK SAVT FLAG   @OY20289 54480082
         TM    SAVTDIAF-IEDNSVTD(R4),VIRTFLG  IS VIRT SPEC     @OY20289 54486082
         BNO   VMOK                     FLAG OK FOR NO VM      @OY20289 54492082
         B     VMERR                    FLAG INDICATES VM, BUT @OY20289 54498082
*                                       THERE IS NO VM -ERROR  @OY20289 54504082
VMYES    EQU   *                                               @OY20289 54510082
         TM    SAVTDIAF-IEDNSVTD(R4),VIRTFLG   IS VIRTIAL SPEC @OY20289 54516082
         BNO   VMERR                    FLAG INDICATES NO VM   @OY20289 54522082
*                                       BUT IT IS VM  -ERROR   @OY20289 54528082
VMOK     EQU   *                                               @YA10680 54540000
*                                                                       54570000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       54600000
*                                                                       54630000
*        THIS SECTION OF CODE ATTACHES THE COMMON WRITE                 54660000
*        ROUTINE, OPERATOR CONTROL, AND THE ON-LINE TEST                54690000
*        FUNCTION                                                       54720000
*                                                                       54750000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       54780000
*                                                                       54810000
         CLI   AVTOLTST,AVTEZERO        IS THE ON-LINE TEST MODULE      54840000
*                                         TO BE ATTACHED                54870000
         BE    CWRATTCH                 NO, BRANCH                      54900000
         LA    R2,AVTOLECA              LOAD THE ADDRESS OF THE         54930000
*                                         ON-LINE TEST ECB              54960000
         TM    AVTBIT1,AVTTSON          IS TIME SHARING ACTIVE          54990000
         BO    ATCHOLTS                 BRANCH ON YES                   55020000
*                                                                       55050000
         ATTACH ECB=(2),ETXR=(3),MF=(E,(1)),SF=(E,OLLIST)               55080000
*                                                                       55110000
         B     ENDOLATC                 GO GET ON-LINE TEST'S    S22025 55140000
*                                       TCB ADDRESS                     55170000
*                                                                       55200000
ATCHOLTS EQU   *                                                        55230000
*                                                                       55260000
         ATTACH ECB=(2),ETXR=(3),STAI=((6)),MF=(E,(1)),SF=(E,OLLIST)    55290000
*                                                                       55320000
ENDOLATC EQU   *                                                        55350000
         ST    R1,AVTOLTCB              TCB ADDRESS OF ATTACHED         55380000
*                                         TASK - ON-LINE TEST           55410000
         LR    R1,RAVT                  RESTORE THE AVT ADDRESS         55440000
*                                                                       55470000
CWRATTCH EQU   *                                                        55500000
         TM    AVTCWFL1,AVTCOMWN        IS THE COMMON WRITE ROUTINE     55530000
*                                         TO BE ATTACHED                55560000
         BNO   ATTACHOC                 NO, BRANCH                      55590000
         LA    R2,AVTCWECA              LOAD THE  ADDRESS OF THE        55620000
*                                         COMMON WRITE ECB              55650000
         NI    AVTCWECA,AVTEZERO        TURN OFF THE WAITING BIT IN     55680000
*                                         THE ECB                       55710000
         ATTACH EP=IEDQFW,ECB=(2),ETXR=(3),DPMOD=-1,MF=(E,(1))          55740000
*                                                                       55770000
         ST    R1,AVTCWTCB              STORE THE TCB ADDRESS OF THE    55800000
*                                         ATTACHED TASK                 55830000
*                                                                       55860000
ATTACHOC EQU   *                                                        55890000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       55920000
*                                                                       55950000
*        THIS SECTION OF CODE ISSUES THE EXTRACT AND QEDIT              55980000
*        MACROS TO SET UP THE COMMUNICATIONS PARAMETER LIST             56010000
*        INTERFACE BETWEEN TCAM AND THE OPERATING SYSTEM                56040000
*                                                                       56070000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       56100000
*                                                                       56130000
         LA    R4,AVTCOMPT              LOAD THE ADDRESS OF THE         56160000
*                                         AVT ADDRESS FIELD             56190000
         LA    R1,AVTSAVE4+12           ADDRESS OF PARM LIST            56220000
*                                                                       56250000
         EXTRACT (R4),'S',FIELDS=COMM,MF=(E,(1)) ESTABLISH PARM LIST    56280000
*                                                                       56310000
         L     R1,AVTCOMPT              LOAD THE ADDRESS OF THE         56340000
*                                         COMMUNICATIONS PARAMETER      56370000
*                                         LIST                          56400000
         LA    R0,FOUR(R1)              LOAD THE ADDRESS OF THE         56430000
*                                         WORD TO HOLD THE CIB          56460000
*                                         CHAIN ADDRESS                 56490000
         SR    R1,R1                    CLEAR A COUNT REGISTER          56520000
         IC    R1,AVTCIB                LOAD THE NUMBER OF BUFFERS      56550000
*                                         REQUESTED                     56580000
         QEDIT CIBCTR=(1),ORIGIN=(0)    GET THE BUFFERS                 56610000
         LA    R2,AVTOPECA              LOAD THE ADDRESS OF THE         56640000
*                                         OPERATOR CONTROL ECB          56670000
         LR    R1,RAVT                  RESTORE AVT ADDRESS     SA64692 56700000
         TM    AVTBIT1,AVTTSON          IS TIME SHARING ACTIVE          56730000
         BO    ATCHOCTS                 BRANCH ON YES                   56760000
*                                                                       56790000
         ATTACH ECB=(2),ETXR=(3),MF=(E,(1)),SF=(E,OCLIST)               56820000
*                                                                       56850000
         B     ENDOCATC                 GO GET OP CONTROL'S TCB  S22025 56880000
*                                       ADDRESS                         56910000
*                                                                       56940000
ATCHOCTS EQU   *                                                        56970000
*                                                                       57000000
         ATTACH ECB=(2),ETXR=(3),STAI=((6)),MF=(E,(1)),SF=(E,OCLIST)    57030000
*                                                                       57060000
ENDOCATC EQU   *                                                        57090000
         ST    R1,AVTOCTCB              TCB ADDRESS OF ATTACHED         57120000
*                                         TASK - OPERATOR CONTROL       57150000
         EJECT                                                          57180000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       57210000
*                                                                       57240000
*        THIS SECTION OF CODE LOADS THE SYSTEM DELAY ROUTINE            57270000
*                                                                       57300000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       57330000
*                                                                       57360000
         LH    R1,AVTINTLV              LOAD THE LENGTH OF THE          57390000
*                                         SYSTEM DELAY INTERVAL         57420000
         LTR   R1,R1                    IS THE DELAY ZERO               57450000
         BZ    TSTOPCON                 NO, BRANCH                      57480000
*                                                                       57510000
         LOAD  EPLOC=SYSDELAY                                           57540000
*                                                                       57570000
         ST    R0,AVTHI                 STORE THE ENTRY POINT           57600000
*                                         ADDRESS IN THE AVT            57630000
         LR    R1,R0                    COPY THE ENTRY POINT ADDRESS    57660000
         A     R0,EIGHT(,R1)            LOAD THE ADDRESS OF THE         57690000
*                                         STCB FIELD                    57720000
         ST    R0,EIGHT(,R1)            STORE THIS ADDRESS IN THE       57750000
*                                         STCB ADDRESS POINTER          57780000
         EJECT                                                          57810000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       57840000
*                                                                       57870000
*        THIS SECTION OF CODE LOADS THE OPERATOR AWARENESS              57900000
*        MESSAGE ROUTER ROUTINE                                         57930000
*                                                                       57960000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       57990000
*                                                                       58020000
TSTOPCON EQU   *                                                        58050000
         LH    R1,AVTOPCON              LOAD THE TERMNAME TABLE         58080000
*                                         OFFSET TO THE PRIMARY         58110000
*                                         OPERATOR CONTROL TERMINAL     58140000
         LTR   R1,R1                    IS THIS OFFSET ZERO             58170000
         BZ    RETURN                   YES, BRANCH                     58200000
*                                                                       58230000
         LOAD  EPLOC=OPAMSGRT           LOAD THE AWARENESS ROUTINE      58260000
*                                                                       58290000
         ST    R0,AVTNX                 STORE THE ENTRY POINT           58320000
*                                         ADDRESS IN THE AVT            58350000
RETURN   EQU   *                                                        58380000
         SR    R15,R15                  CLEAR RETURN CODE               58410000
*                                                                       58440000
EXIT     EQU   *                                                        58470000
         STC   R15,AVTOPETR             SAVE INTRO RETURN CODE          58500000
*                                         FOR OPEN TO CHECK             58530000
         LTR   R15,R15                  IS THE RETURN CODE ZERO? X03039 58560000
         BNZ   EXIT1                    ERROR BYPASS IECIAA      X03039 58590000
         LR    R1,RAVT                  SET PARMREG TO AVT       X03039 58620000
         LINK  EP=IEDIAA                LINK TO COMMON OPEN      X03039 58650000
EXIT1    EQU   *                                                 X03039 58680000
         SR    R15,R15                  CLEAR RETURN CODE REG    X03039 58710000
         IC    R15,AVTOPETR             RESTORE INTRO RETURN CODEX03039 58740000
         LA    R13,2*AVTSVSIZ(RAVT)     MY SAVEAREA ADDRESS             58770000
         L     R13,4(R13)               RESTORE CALLER'S REGISTERS      58800000
*                                                                       58830000
         RETURN  (14,12),T,RC=(15)      RETURNTO INTRO                  58860000
         EJECT                                                          58890000
GETERR   EQU   *                                                        58920000
         LA    R15,AVTECD8              SET THE RETURN CODE             58950000
         B     ERROR                    EXIT THIS ROUTINE               58980000
*                                                                       59010000
TERMERR1 EQU   *                                                        59040000
         LA    R15,SIXTEEN              AN ERROR IN DEFINING THE        59070000
*                                         TERMINAL                      59100000
         B     ERROR                    EXIT THIS ROUTINE               59130000
*                                                                       59160000
VMERR    EQU   *                                               @YA10680 59190000
         LA    R15,VMCODE               AN ERROR IN SPECIFYING @YA10680 59220000
*                                        MACHINE TYPE          @YA10680 59250000
         B     ERROR                    EXIT THIS ROUTINE      @YA10680 59280000
*                                                              @YA10680 59310000
POCERR   EQU   *                                                        59340000
         LA    R15,TWENTY               AN ERROR IN DEFINING THE        59370000
*                                         PRIMARY OPERATOR CONTROL      59400000
*                                         TERMINAL                      59430000
ERROR    EQU   *                                                        59460000
         LR    R3,R15                   SAVE ERROR CODE                 59490000
         CVD   R15,AVTDOUBL                                             59520000
         UNPK  MSGX(4),AVTDOUBL         PUT ERROR ID IN MESSAGE         59550000
         MVZ   MSGX+3(1),MSGX           GET PROPER ZONE                 59580000
*                                                                       59610000
MSG065   WTO   'IED065I INITIALIZATION ERROR     ',                    C59640000
               ROUTCDE=(2,11),DESC=4                                    59670000
*                                                                       59700000
         LR    R15,R3                   RESTORE ERROR CODE              59730000
         B     EXIT                     AND RETURN                      59760000
         EJECT                                                          59790000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       59820000
*                                                                       59850000
*        THIS ROUTINE SETS UP A PARAMETER LIST IN THE AVT.              59880000
*        THIS LIST WILL BE REFERENCED BY ALL GETMAIN                    59910000
*        MACROS ISSUED IN IEDQOA                                        59940000
*                                                                       59970000
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *       60000000
*                                                                       60030000
AVTPAR1  EQU   *                                                 X01004 60060000
         OI    AVTGETMN+EIGHT,PAGE      ENTRY FOR PAGE BOUNDARY  X01004 60090000
AVTPAR   EQU   *                                                        60120000
         ST    R1,AVTGETMN              LENGTH                          60150000
         ST    R0,AVTGETMN+4            RECEIVING ADDRESS               60180000
         MVI   AVTGETMN+9,AVTEZERO      SET THE SUBPOOL ID FOR          60210000
*                                         PROBLEM PROGRAM MODE          60240000
         LA    R1,AVTGETMN              SVC 4 PARAMETER LIST            60270000
*                                                                       60300000
         GETMAIN ,MF=(E,(1))                                            60330000
         NI    AVTGETMN+EIGHT,X'FF'-PAGE TURN OFF BOUNDARY FLAG  X01004 60360000
*                                                                       60390000
         LTR   R15,R15                  GETMAIN SUCCESSFUL              60420000
         BNE   GETERR                   NO, BRANCH                      60450000
         BR    R14                      RETURN IF GOOD                  60480000
         EJECT                                                          60510000
ERRSET   MVC   0(0,RPRESENT),0(RFIRST)  TERMNAME TO ERRORMSG            60540000
COMPENT  CLC   0(0,RPRESENT),0(RTRM)    COMPARE TERMNAME ENTRIES        60570000
EX1      XC    0(0,RPRESENT),0(RTRM)    SWAP THE TWO                    60600000
EX2      XC    0(0,RTRM),0(RPRESENT)    TERMNAME ENTRIES                60630000
*                                                                       60660000
OLLIST   ATTACH EP=IEDQWA,DPMOD=-1,SF=L                                 60690000
*                                                                       60720000
OCLIST   ATTACH EP=IEDQCA,DPMOD=-1,SF=L                                 60750000
*                                                                       60780000
LINKOB   LINK  EP=IEDQOB,SF=L                                           60810000
*                                                                       60840000
NOPASS   DC    CL8' '                   TO CHECK FOR NO PASSWORD        60870000
SYSDELAY DC    CL8'IEDQHI  '            SYSTEM DELAY ROUTINE     S22025 60900000
OPAMSGRT DC    CL8'IEDQNX  '            OPERATOR AWARENESS ROUTINE      60930000
SYSCON   DC    C'SYSCON  '              ENTRY SPECIFYING SYSTEM  S22025 60960000
*                                       CONSOLE AS PRIMARY OP    S22025 60990000
*                                       CONTROL TERMINAL         S22025 61020000
FREEPTR  DC    2F'0'                    ADDRESS OF FREE CORE     X01004 61050000
FBUFSAV  DC    2F'0'                    SAVE ADDRESS AND SIZE OF X01004 61080000
*                                         GETMAIN FOR I/O BUFFERSX01004 61110000
HEIGHT   DC    H'32'                    LENGTH OF A PIU TRACE  @Y17XANG 61140000
*                                       TABLE ENTRY            @Y17XANG 61170000
H8       DC    H'8'                     HALFWORD CONSTANT      @Y17XANG 61200000
PAGESIZE DC    F'4096'                  MVS PAGE SIZE          @G36XRNP 61230000
PAGE     EQU   X'10'                                             X01004 61260000
FIVE     EQU   5                                                 X01004 61290000
AD       EQU   7                                                 X01004 61320000
CCWIDA   EQU   4                        INDIRECT ADDRESSING FLAG X02004 61350000
ALL      EQU   15                       ICM MASK                 X02004 61380000
LOWBIT   EQU   X'01'                    MASK FOR LOW ORDER BIT @G36XRNP 61410000
RESTLOW  EQU   X'FE'                    MASK FOR LOW ORDER BIT @OY17ANZ 61440000
HSIX     DC    H'6'                     HALF WORD OF SIX         S22027 61470000
         DS    0F                       LOWOFF MASK MUST       @OY12967 61500000
*                                        FOLLOW THSI STMT      @OY12967 61530000
LOWOFF   DC    X'FFFFFFFE'              MASK FOR LOW ORDER BIT @OY12967 61560000
TERMTEMP DC    F'0'                     FULLWORD FOR TNT ADDRESSES22024 61590000
TTRCID   DC    C'PIUT'                  ID FOR PIU TRACE TABLE @Y17XANG 61620000
IDERRAD  DC    A(IDERRMSG)                                     @G36XRNP 61650000
SORTAD   DC    A(SORTHIER)                                     @Y17XANG 61680000
TTCINAD  DC    A(SETTTCIN)                                     @Y17XANG 61710000
         DROP  RQCB                                            @Y17XANG 61740000
         EJECT                                                 @Y17XANG 61770000
***************************************************************@Y17XANG 61800000
*                                                              @Y17XANG 61830000
* THIS SECTION CREATES THE GROUP-LINE TTE HIERARCHY            @Y17XANG 61860000
*                                                              @Y17XANG 61890000
***************************************************************@Y17XANG 61920000
SORTHIER DS    0H                                              @Y17XANG 61950000
         SPACE                                                          61980000
* SET UP TNT SCAN FOR LGB.                                     @Y17XANG 62010000
         SPACE                                                          62040000
         USING SORTHIER,R15                                    @Y17XANG 62070000
         ST    RBASE,SORTL12            SAVE MAINLINE BASE     @Y17XANG 62100000
         LR    RBASE,R15                SET SORT BASE          @Y17XANG 62130000
         DROP  R15                                             @Y17XANG 62160000
         USING SORTHIER,RBASE                                  @Y17XANG 62190000
         ST    R14,SORTL14              SAVE RETURN REG        @Y17XANG 62220000
         L     RTNT,AVTRNMPT            TNT BASE               @Y17XANG 62250000
         USING IEDQTNTD,RTNT                                   @Y17XANG 62280000
         SR    RLEN,RLEN                                       @Y17XANG 62310000
         IC    RLEN,TNTENLEN            LNTH TNT NAME          @Y17XANG 62340000
         LA    RLEN,L'TNTTRMAD(RLEN)    LNTH TNT ENTRY         @Y17XANG 62370000
         LA    RTNT1,TNTFIRST-L'TNTTRMAD 1ST TNT - ADDR LENTH  @Y17XANG 62400000
         LA    RCTR1,1                  START TNT INDEX = 1    @Y17XANG 62430000
         LA    R1,L'GETFIRST            SORT TABLE ENTRY LEN   @Y17XANG 62460000
         MH    R1,TNTLEN                TIMES # TNT ENTRIES    @Y17XANG 62490000
*                                       (MAX POSSIBLE LINES)   @Y17XANG 62520000
         LA    R1,GETFIRST-GETSAVE(R1)   ADD IN SAVE AREA.     @Y17XANG 62550000
         ST    R1,AVTSAVE4+20           SAVE SORT TABLE LEN    @Y17XANG 62580000
         LA    R0,AVTSAVE4+24           LOCATION TO RECV       @Y17XANG 62610000
*                                       GETMAIN ADDR           @Y17XANG 62640000
         L     R15,PARAD                GETMAIN ROUTINE ADDR   @Y17XANG 62670000
         LR    RCTR2,RBASE              SAVE BASE              @Y17XANG 62700000
         L     RBASE,SORTL12            MAINLINE BASE          @Y17XANG 62730000
         BALR  R14,R15                  GETMAIN SORT AREA      @Y17XANG 62760000
         LR    RBASE,RCTR2              RESET BASE             @Y17XANG 62790000
         L     RGETM,AVTSAVE4+24        SORT AREA BASE         @Y17XANG 62820000
         USING GETSAVE,RGETM                                   @Y17XANG 62850000
         SPACE                                                          62880000
* FETCH TTE OF NEXT TNT ENTRY.                                 @Y17XANG 62910000
         SPACE                                                          62940000
FETCHTTE EQU   *                                               @Y17XANG 62970000
         LA    RTNT1,0(RLEN,RTNT1)      NEXT TNT ENTRY         @Y17XANG 63000000
         USING TNTTRMAD,RTNT1                                  @Y17XANG 63030000
         SR    RLGB,RLGB                                                63060000
         ICM   RLGB,ADDR,TNTTRMAD       TTE ADDRESS            @Y17XANG 63090000
         SPACE                                                          63120000
* IF THIS IS AN LGB THEN DO                                    @Y17XANG 63150000
         SPACE                                                          63180000
         USING IEDQTRM,RLGB                                    @Y17XANG 63210000
         CLI   TRMDSORG,TRMLGB          LGB?                   @Y17XANG 63240000
         BNE   NXTLGB                   BRANCH NO              @Y17XANG 63270000
         SPACE                                                          63300000
* SET UP TNT LINE ENTRY SEARCH.                                @Y17XANG 63330000
         SPACE                                                          63360000
         LA    RLGB,IEDQTRM-TRMCOHTG-(LGBBUFOU-LGBSUBST)(RLGB) @Y17XANG 63390000
*                                       ADJUST LGB ADDR SO     @Y17XANG 63420000
*                                       THAT LGBSUBST WILL BE  @Y17XANG 63450000
*                                       SAME RELATIVE DISPLACE-@Y17XANG 63480000
*                                       MENT FROM TTE PREFIX   @Y17XANG 63510000
*                                       AS TRMCOHTG.           @Y17XANG 63540000
         ST    RLGB,GETLGB              SAVE ADJUSTED LGB ADDR @Y17XANG 63570000
         DROP  RLGB                                            @Y17XANG 63600000
         LA    RTNT2,TNTFIRST-L'TNTTRMAD 1ST TNT - ADDR LEN    @Y17XANG 63630000
         LA    RCTR2,1                  START TNT INDEX AT 1   @Y17XANG 63660000
         LA    RTBL,GETFIRST            1ST SORT TABLE ENTRY   @Y17XANG 63690000
         USING GETFIRST,RTBL                                   @Y17XANG 63720000
         SPACE                                                          63750000
* FETCH TTE OF NEXT TNT ENTRY(LINE SEARCH).                    @Y17XANG 63780000
         SPACE                                                          63810000
FETCHLN  EQU   *                                               @Y17XANG 63840000
         LA    RTNT2,0(RLEN,RTNT2)      NEXT TNT ENTRY         @Y17XANG 63870000
         ICM   RNLINE,ADDR,TNTTRMAD-IEDTNTA(RTNT2) TTE ADDR    @Y17XANG 63900000
         USING IEDQTRM,RNLINE                                  @Y17XANG 63930000
         SPACE                                                          63960000
* IF THIS IS A LINE ENTRY THEN DO                              @Y17XANG 63990000
         SPACE                                                          64020000
         TM    TRMSTATE,TRMLINE         LINE?                  @Y17XANG 64050000
         BZ    NXTLINE                  BRANCH NO TO FETCH NEXT@Y17XANG 64080000
*                                       LINE                   @Y17XANG 64110000
         SPACE                                                          64140000
* IF THIS IS THE SAME LINE GROUP AS LGB                        @Y17XANG 64170000
         SPACE                                                          64200000
         USING IEDQQCB,R15                                     @Y17XANG 64230000
         L     R15,TRMDESTQ-1           QCB ADDRESS            @Y17XANG 64260000
         L     R14,QCBLGBAD-1           QCB LGB PTR            @Y17XANG 64290000
         LA    R14,LGBPRFSZ+IEDQTRM-TRMCOHTG-(LGBBUFOU-LGBSUBST)(R14)   64320000
*                                       ADJUST LGB ADDRESS:    @Y17XANG 64350000
*                                       LGB ADDRESS FROM QCB   @Y17XANG 64380000
*                                       IS LGBBUFOU - DCB      @Y17XANG 64410000
*                                       PREFIX.  THEREFORE     @Y17XANG 64440000
*                                       MUST BE PLUS THIS DISP @Y17XANG 64470000
*                                       PLUS SAME ADJUSTMENT   @Y17XANG 64500000
*                                       AS WHEN LGB STORED.    @Y17XANG 64530000
         C     R14,GETLGB               SAME GROUP(LGB)?       @Y17XANG 64560000
         BNE   NXTLINE                  BRANCH NO              @Y17XANG 64590000
         SPACE                                                          64620000
* THEN MAKE LINE ENTRY IN SORT TABLE.                          @Y17XANG 64650000
         SPACE                                                          64680000
         ST    RNLINE,GETTTE            TTE PTR FOR LINE       @Y17XANG 64710000
         STH   RCTR2,GETTTCIN           TNT INDEX OF LINE      @Y17XANG 64740000
         MVI   GETRLN,0                 CLEAR HI BYTE TBL RLN  @Y17XANG 64770000
         MVC   GETRLN+1(L'QCBRELLN),QCBRELLN REL LINE          @Y17XANG 64800000
         LA    RTBL,L'GETFIRST(RTBL)    NEXT SORT TABLE ENTRY  @Y17XANG 64830000
         SPACE                                                          64860000
* STEP TNT INDEX BY 1.                                         @Y17XANG 64890000
         SPACE                                                          64920000
NXTLINE  EQU   *                                               @Y17XANG 64950000
         LA    RCTR2,1(RCTR2)           NEXT TNT INDEX         @Y17XANG 64980000
         DROP  R15                                             @Y17XANG 65010000
         SPACE                                                          65040000
* IF TNT NOT EXHAUSTED GO GET NEXT ENTRY.                      @Y17XANG 65070000
         SPACE                                                          65100000
         CH    RCTR2,TNTLEN             LAST TNT PROCESSED?    @Y17XANG 65130000
         BNH   FETCHLN                  BRANCH NO              @Y17XANG 65160000
         SPACE                                                          65190000
* IF GROUP HAS LINES THEN SORT LINES BY LINE NUMBER AND LINK   @Y17XANG 65220000
* INTO GROUP-LINE HIERARCHY.                                   @Y17XANG 65250000
         SPACE                                                          65280000
         DROP  RTBL                                            @Y17XANG 65310000
         LA    R14,GETFIRST             1ST SORT TABLE ENTRY   @Y17XANG 65340000
         CR    R14,RTBL                 ANY LINES(TBL ENTRIES)?@Y17XANG 65370000
         BE    ELSEWTO                  BRANCH NO TO ELSE      @PI02869 65400000
         BAL   R14,SORTL                SORT LINES             @Y17XANG 65430000
         B     NXTLGB                   BYPASS ELSE            @Y17XANG 65460000
         SPACE                                                          65490000
* ELSE SEND MESSAGE TO OPERATOR : IED526 - GROUP HAS NO LINES. @Y17XANG 65520000
         SPACE                                                          65550000
ELSEWTO  EQU   *                                               @Y17XANG 65580000
         MVI   GRPNAME,C' '                                             65610000
         MVC   GRPNAME+1(8),GRPNAME BLANK GROUP NAME           @Y17XANG 65640000
         SR    R14,R14                                         @Y17XANG 65670000
         IC    R14,TNTENLEN             TNT NAME LEN           @Y17XANG 65700000
         LR    R15,RTNT1                                       @Y17XANG 65730000
         SR    R15,R14                  GROUP NAME ADDR        @Y17XANG 65760000
         BCTR  R14,0                    GROUP NAME LEN FOR MVC @Y17XANG 65790000
         EX    R14,MOVNAME              PUT NAME INTO WTO      @Y17XANG 65820000
         WTO   MF=(E,IED526I)           SEND OP CONSOLE MSG    @Y17XANG 65850000
         SPACE                                                          65880000
* INCREMENT LGB SEARCH INDEX AND RESET SORT TABLE.             @Y17XANG 65910000
         SPACE                                                          65940000
NXTLGB   EQU   *                                               @Y17XANG 65970000
         LA    RCTR1,1(RCTR1)           TNT INDEX + 1          @Y17XANG 66000000
         LA    RTBL,GETFIRST            FIRST SORT ENTRY       @Y17XANG 66030000
         SPACE                                                          66060000
* IF TNT HAS NOT BEEN COMPLETELY PROCESSED FOR LGBS THEN       @Y17XANG 66090000
* GO GET ANOTHER LGB.                                          @Y17XANG 66120000
         SPACE                                                          66150000
         CH    RCTR1,TNTLEN             TNT COMPLETE           @Y17XANG 66180000
         BNH   FETCHTTE                 BRANCH NO FOR MORE LGBS@Y17XANG 66210000
         SPACE                                                          66240000
* FREE SORT TABLE.                                             @Y17XANG 66270000
         SPACE                                                          66300000
         LM    R0,R1,AVTSAVE4+20        TABLE LEN + ADDR       @Y17XANG 66330000
         FREEMAIN R,LV=(0),A=(1)                               @Y17XANG 66360000
         SPACE                                                          66390000
* RETURN TO MAINLINE.                                          @Y17XANG 66420000
         SPACE                                                          66450000
         L     R14,SORTL14              RESTORE RETURN REG     @Y17XANG 66480000
         L     RBASE,SORTL12            RESTORE BASE REG       @Y17XANG 66510000
         BR    R14                      RETURN                 @Y17XANG 66540000
MOVNAME  MVC   GRPNAME(0),0(R15)        MOVE GROUP NAME TO WTO.@Y17XANG 66570000
         EJECT                                                 @Y17XANG 66600000
***************************************************************@Y17XANG 66630000
*                                                              @Y17XANG 66660000
* RLN SORT AND HIERARCHY BUILD ROUTINE.                        @Y17XANG 66690000
*                                                              @Y17XANG 66720000
***************************************************************@Y17XANG 66750000
SORTL    DS    0H                                              @Y17XANG 66780000
         SPACE                                                          66810000
* SET UP SORT.                                                 @Y17XANG 66840000
         SPACE                                                          66870000
         STM   RTNT1,RLEN,GETSAVE       SAVE REGS.             @Y17XANG 66900000
         LR    R0,R14                   SAVE RETURN            @Y17XANG 66930000
         LR    REOT,RTBL                                       @Y17XANG 66960000
         S     REOT,GETLEN              ADDRESS LAST TABLE     @Y17XANG 66990000
*                                       ENTRY.                 @Y17XANG 67020000
         LA    R1ST,GETFIRST            1ST TABLE ENTRY        @Y17XANG 67050000
         LR    RCURR,R1ST               CURRENT TABLE ENTRY    @Y17XANG 67080000
         SPACE                                                          67110000
* IF SORT COMPLETE GO LINK HIERARCHY.                          @Y17XANG 67140000
         SPACE                                                          67170000
SORTLOOP EQU   *                                               @Y17XANG 67200000
         CR    RCURR,REOT               END OF TABLE?          @Y17XANG 67230000
         BNL   HIERLINK                 BRANCH YES WE'RE THRU  @Y17XANG 67260000
         SPACE                                                          67290000
* IF CURRENT TABLE ENTRY ^ LE NEXT.....                        @Y17XANG 67320000
         SPACE                                                          67350000
         USING GETTTE,RCURR                                    @Y17XANG 67380000
         CLC   GETRLN,GETRLN+L'GETFIRST CURRENT LE NEXT RLN?   @Y17XANG 67410000
         BNH   ADTBL                    BRANCH YES             @Y17XANG 67440000
         SPACE                                                          67470000
* THEN SORT TABLE IN OPPOSITE DIRECTION.                       @Y17XANG 67500000
         SPACE                                                          67530000
         BAL   R14,RSORT                REVERSE SORT           @Y17XANG 67560000
         SPACE                                                          67590000
* ADVANCE TO NEXT TABLE ENTRY.                                 @Y17XANG 67620000
         SPACE                                                          67650000
ADTBL    EQU   *                                               @Y17XANG 67680000
         LA    RCURR,L'GETFIRST(RCURR)       NEXT ENTRY        @Y17XANG 67710000
         B     SORTLOOP                                        @Y17XANG 67740000
         SPACE                                                          67770000
* SET UP TO LINK HIERARCHY.                                    @Y17XANG 67800000
         SPACE                                                          67830000
HIERLINK EQU   *                                               @Y17XANG 67860000
         LA    RCURR,GETLGB             LGB ENTRY ADDRESS      @Y17XANG 67890000
*                     * * NOTE * *                             @Y17XANG 67920000
* LGB ADDRESS WAS ADJUSTED EARLIER SO THAT DISPLACEMENT OF     @Y17XANG 67950000
* LGBSUBST FIELD IS SAME RELATIVE DISPLACEMENT AS TRMCOHTG     @Y17XANG 67980000
* FROM PREFIX.  THEREFORE, LGB LINKED TO FIRST LINE SINCE LGB  @Y17XANG 68010000
* ENTRY IN TABLE IMMEDIATELY PRECEEDS FIRST LINE ENTRY.        @Y17XANG 68040000
         SPACE                                                          68070000
* LINK CURRENT LINE TO NEXT.                                   @Y17XANG 68100000
         SPACE                                                          68130000
NXTLINK  EQU   *                                               @Y17XANG 68160000
         LA    R14,TRMPRFSZ             PREFIX SIZE            @Y17XANG 68190000
         L     RTRM,GETTTE              TTE ADDRESS CURRENT ENT@Y17XANG 68220000
         SR    RTRM,R14                 PREFIX ADDRESS         @Y17XANG 68250000
         USING IEDNTRM,RTRM             PREFIX BASE            @Y17XANG 68280000
         LH    R14,GETTTCIN+L'GETFIRST       TTCIN NEXT ENTRY  @Y17XANG 68310000
         STH   R14,TRMCOHTG             LINK CURRENT TO NEXT   @Y17XANG 68340000
         SPACE                                                          68370000
* ADVANCE IN TABLE.                                            @Y17XANG 68400000
         SPACE                                                          68430000
         LA    RCURR,L'GETFIRST(RCURR)       NEXT ENTRY        @Y17XANG 68460000
         SPACE                                                          68490000
* IF NOT END OF TABLE GO BACK AND LINK NEXT ENTRY.             @Y17XANG 68520000
         SPACE                                                          68550000
         CR    REOT,RCURR               END OF TABLE?          @Y17XANG 68580000
         BNE   NXTLINK                  BRANCH NO              @Y17XANG 68610000
         SPACE                                                          68640000
* LINK LAST LINE TO LGB.                                       @Y17XANG 68670000
         SPACE                                                          68700000
         LA    R14,TRMPRFSZ             PREFIX SIZE            @Y17XANG 68730000
         L     RTRM,GETTTE              LAST LINE TTE ADDR     @Y17XANG 68760000
         SR    RTRM,R14                 PREFIX ADDR            @Y17XANG 68790000
         STH   RCTR1,TRMCOHTG           LINK TO LGB            @Y17XANG 68820000
         SPACE                                                          68850000
* RESTORE REGS                                                 @Y17XANG 68880000
         SPACE                                                          68910000
         LM    RTNT1,RLEN,GETSAVE                              @Y17XANG 68940000
         SPACE                                                          68970000
* RETURN TO LOOK FOR NEXT LGB                                  @Y17XANG 69000000
         SPACE                                                          69030000
         LR    R14,R0                   RETURN ADDR            @Y17XANG 69060000
         BR    R14                      RETURN                 @Y17XANG 69090000
         DROP  RTRM                                            @Y17XANG 69120000
         DROP  RTNT                                            @Y17XANG 69150000
         EJECT                                                 @Y17XANG 69180000
***************************************************************@Y17XANG 69210000
*                                                              @Y17XANG 69240000
* REVERSE DIRECTION SORT ROUTINE.                              @Y17XANG 69270000
*                                                              @Y17XANG 69300000
***************************************************************@Y17XANG 69330000
         SPACE                                                          69360000
RSORT    EQU   *                                               @Y17XANG 69390000
* SWAP CURRENT ENTRY WITH NEXT.                                @Y17XANG 69420000
         SPACE                                                          69450000
         XC    GETFIRST,GETFIRST+L'GETFIRST                    @Y17XANG 69480000
         XC    GETFIRST+L'GETFIRST,GETFIRST                    @Y17XANG 69510000
         XC    GETFIRST,GETFIRST+L'GETFIRST                    @Y17XANG 69540000
         SPACE                                                          69570000
* SAVE NEXT ENTRY ADDRESS FOR FORWARD SORT RESUMPTION.         @Y17XANG 69600000
         SPACE                                                          69630000
         ST    RCURR,GETSVCUR           SAVE                   @YM04690 69660000
         SPACE                                                          69690000
* RETREAT TO PREVIOUS ENTRY.                                   @Y17XANG 69720000
         SPACE                                                          69750000
         S     RCURR,GETLEN             PREVIOUS+PRESENT - ENT-@Y17XANG 69780000
*                                       RY LENGTH.             @Y17XANG 69810000
         SPACE                                                          69840000
* IF FIRST OF TABLE GO TO SUBROUTINE EXIT.                     @Y17XANG 69870000
         SPACE                                                          69900000
FRSTCHK  EQU   *                                               @Y17XANG 69930000
         CR    RCURR,R1ST               PRESENT LE 1ST ENTRY   @Y17XANG 69960000
*                                       ADDRESS?               @Y17XANG 69990000
         BNH   RSORTX                   BRANCH YES TO EXIT     @Y17XANG 70020000
         SPACE                                                          70050000
* CURRENT ENTRY GT NEXT IN TABLE(FORWARD)?                     @Y17XANG 70080000
         SPACE                                                          70110000
         CLC   GETRLN,GETRLN+L'GETFIRST IS IT?                 @Y17XANG 70140000
         BNH   BRKLOOP                  BRANCH NO TO ELSE      @Y17XANG 70170000
         SPACE                                                          70200000
* THEN SWAP ENTRIES.                                           @Y17XANG 70230000
         SPACE                                                          70260000
         XC    GETFIRST,GETFIRST+L'GETFIRST                    @Y17XANG 70290000
         XC    GETFIRST+L'GETFIRST,GETFIRST                    @Y17XANG 70320000
         XC    GETFIRST,GETFIRST+L'GETFIRST                    @Y17XANG 70350000
         B     RETREAT                  BRANCH AROUND ELSE     @Y17XANG 70380000
         SPACE                                                          70410000
* ELSE SET CURRENT ENTRY POINTER TO 1ST OF TABLE TO BREAK LOOP.@Y17XANG 70440000
         SPACE                                                          70470000
BRKLOOP  EQU   *                                               @Y17XANG 70500000
         LR    RCURR,R1ST                                      @Y17XANG 70530000
         SPACE                                                          70560000
* RETREAT TO PREVIOUS ENTRY.                                   @Y17XANG 70590000
         SPACE                                                          70620000
RETREAT  EQU   *                                               @Y17XANG 70650000
         S     RCURR,GETLEN             PREVIOUS ENTRY ADDR    @Y17XANG 70680000
         B     FRSTCHK                  GO BACK TO LOOP TOP    @Y17XANG 70710000
         SPACE                                                          70740000
* RESET CURRENT LOCATION TO SAVED RESUME ADDRESS FOR FORWARD   @Y17XANG 70770000
* SORT.                                                        @Y17XANG 70800000
         SPACE                                                          70830000
RSORTX   EQU   *                                               @Y17XANG 70860000
         L     RCURR,GETSVCUR                                  @Y17XANG 70890000
         SPACE                                                          70920000
* RETURN TO FORWARD SORT.                                      @Y17XANG 70950000
         SPACE                                                          70980000
         BR    R14                                             @Y17XANG 71010000
GETLEN   DC    A(L'GETFIRST)            LENGTH OF SORT TABLE   @Y17XANG 71040000
IED526I  WTO   'IED526I LINE GROUP XXXXXXXX HAS NO LINES',     @Y17XANG*71070000
               ROUTCDE=(2,11),DESC=6,MF=L                      @Y17XANG 71100000
GRPNAME  EQU   IED526I+23                                      @Y17XANG 71130000
SORTL12  DS    F                        MAINLINE BASE SAVE     @Y17XANG 71160000
SORTL14  DS    F                        MAINLINE RETURN REG    @Y17XANG 71190000
PARAD    DC    A(AVTPAR1)               ADDR GETMAIN ROUTINE   @Y17XANG 71220000
         DROP  RGETM                                           @Y17XANG 71250000
         DROP  RCURR                                           @Y17XANG 71280000
         DROP  RBASE                                           @Y17XANG 71310000
         DROP  RTNT1                                           @Y17XANG 71340000
         DROP  RNLINE                                          @Y17XANG 71370000
         EJECT                                                 @Y17XANG 71400000
***************************************************************@Y17XANG 71430000
* THIS ROUTINE INITIATES THE QCB TNT INDEX FIELD FOR 3705      @Y17XANG 71460000
* CLUSTERS, TERMINALS, LU'S AND CTERM TTE'S.                   @Y17XANG 71490000
*                                                              @Y17XANG 71520000
***************************************************************@Y17XANG 71550000
         SPACE                                                          71580000
SETTTCIN DS    0H                                              @Y17XANG 71610000
         USING SETTTCIN,R15                                    @Y17XANG 71640000
         USING IEDQTNTD,RTNT                                   @Y17XANG 71670000
         ST    RBASE,TTCIN12            SAVE MAINLINE BASE     @Y17XANG 71700000
         LR    RBASE,R15                SET BASE               @Y17XANG 71730000
         DROP  R15                                             @Y17XANG 71760000
         USING SETTTCIN,RBASE                                  @Y17XANG 71790000
         SPACE                                                          71820000
* SET TNT ENTRY, TNT ENTRY LENGTH AND TNT INDEX REGS.          @Y17XANG 71850000
         SPACE                                                          71880000
         SR    RFIRST,RFIRST                                   @Y17XANG 71910000
         IC    RFIRST,TNTENLEN          TNT NAME LENGTH        @Y17XANG 71940000
         LR    RLEN,RFIRST              SAVE IT                @Y17XANG 71970000
         LA    RFIRST,TNTFIRST(RFIRST)  ADDRESS OF ADDRESS     @Y17XANG 72000000
*                                       PORTION OF FIRST TNT   @Y17XANG 72030000
*                                       ENTRY.                 @Y17XANG 72060000
         LA    RLEN,L'TNTTRMAD(RLEN)    LENGTH TNT ENTRY       @Y17XANG 72090000
         LA    RTNT1,1                  FIRST TNT INDEX        @Y17XANG 72120000
         SPACE                                                          72150000
* IF THIS IS NOT A 3705 RESOURCE.                              @Y17XANG 72180000
         SPACE                                                          72210000
CKTYPE   EQU   *                                               @Y17XANG 72240000
         USING TNTTRMAD,RFIRST                                 @Y17XANG 72270000
         ICM   RTRM,ADDR,TNTTRMAD       TTE ADDRESS            @Y17XANG 72300000
         USING IEDQTRM,RTRM                                    @Y17XANG 72330000
         TM    TRMSTATE,TRMPREF         3705 RESOURCE?         @Y17XANG 72360000
         BZ    NXTQCB                   BRANCH NO              @Y17XANG 72390000
         SPACE                                                          72420000
* THEN IF THIS IS A PRE-SNA TERMINAL, CLUSTER, LU, OR CTERM    @Y17XANG 72450000
         SPACE                                                          72480000
         LA    RWORK,TRMPRFSZ           PREFIX SIZE            @Y17XANG 72510000
         SR    RTRM,RWORK               PREFIX ADDRESS         @Y17XANG 72540000
         USING IEDNTRM,RTRM                                    @Y17XANG 72570000
         CLI   TRMTYPE,TRMPSNA          PRE-SNA TERMINAL?      @Y17XANG 72600000
         BE    FTCHQCB                  BRANCH YES             @Y17XANG 72630000
         CLI   TRMTYPE,TRMLUNT          LU?                    @Y17XANG 72660000
         BE    FTCHQCB                  BRANCH YES             @Y17XANG 72690000
         CLI   TRMTYPE,TRMCLUST         CLUSTER?               @Y17XANG 72720000
         BNE   NXTQCB                   BRANCH NO              @Y17XANG 72750000
         SPACE                                                          72780000
* FETCH QCB.                                                   @Y17XANG 72810000
         SPACE                                                          72840000
FTCHQCB  EQU   *                                               @Y17XANG 72870000
         ICM   RQCB,ADDR,TRMDESTQ       QCB ADDRESS            @Y17XANG 72900000
         SPACE                                                          72930000
* SET QCBTTCIN.                                                @Y17XANG 72960000
         SPACE                                                          72990000
         LA    RWORK,QCBPRFSZ           QCB PREFIX SIZE        @Y17XANG 73020000
         SR    RQCB,RWORK               QCB PREFIX ADDRESS     @Y17XANG 73050000
         USING IEDNQCB,RQCB                                    @Y17XANG 73080000
         STH   RTNT1,QCBTTCIN           SET TTCIN              @Y17XANG 73110000
         DROP  RQCB                                            @Y17XANG 73140000
         SPACE                                                          73170000
* ADVANCE IN TNT.                                              @Y17XANG 73200000
         SPACE                                                          73230000
NXTQCB   EQU   *                                               @Y17XANG 73260000
         LA    RFIRST,0(RLEN,RFIRST)    NEXT TNT ENTRY ADDR    @Y17XANG 73290000
         LA    RTNT1,1(RTNT1)           NEXT ENTRY INDEX       @Y17XANG 73320000
         SPACE                                                          73350000
* IF NOT END OF TNT PROCESS NEXT ENTRY.                        @Y17XANG 73380000
         SPACE                                                          73410000
         CH    RTNT1,TNTLEN             END OF TNT?            @Y17XANG 73440000
         BNH   CKTYPE                   BRANCH NO              @Y17XANG 73470000
         SPACE                                                          73500000
* RETURN TO MAINLINE ROUTINE.                                  @Y17XANG 73530000
         SPACE                                                          73560000
         L     RBASE,TTCIN12            MAINLINE BASE          @Y17XANG 73590000
         BR    R14                                             @Y17XANG 73620000
TTCIN12  DC    A(0)                     MAINLINE BASE SAVE     @Y17XANG 73650000
         DROP  RTNT                                            @Y17XANG 73680000
         DROP  RFIRST                                          @Y17XANG 73710000
         DROP  RTRM                                            @Y17XANG 73740000
*                                                                       73770000
         EJECT                                                          73800000
IDERRMSG EQU   *                                               @G36XRNP 73830000
         USING IDERRMSG,R8                                     @G36XRNP 73860000
         EX    RLENTN,MVCID             INIT ERROR MSG         @G36XRNP 73890000
         OI    AVTGETMN,ALTDSTER        INDICATE ERROR         @G36XRNP 73920000
         LR    RWORK,RPRESENT           SAVE TNT POINTER       @G36XRNP 73950000
         LA    RPRESENT,DIDMSG          MSG ADDR               @G36XRNP 73980000
         SVC   35                                              @G36XRNP 74010000
         LR    RPRESENT,RWORK           RESTORE TNT POINTER    @G36XRNP 74040000
         BR    RLINK                    RETURN                 @G36XRNP 74070000
MVCID    MVC   DIDMSGC(0),0(RPRESENT)   MVE TRM NAME TO ERR MSG@G36XRNP 74100000
         CNOP  0,4                                             @G36XRNP 74130000
DIDMSG   DC    AL2(IDMEND-*)            MSG LENGTH             @G36XRNP 74160000
         DC    X'1000'                  MSG FLAGS              @G36XRNP 74190000
         DC    C'IED138I '              MSG NUMBER             @G36XRNP 74220000
         DC    C'ERROR SORTING DEVICE ID TABLE ' MSG TEXT      @G36XRNP 74250000
DIDMSGC  DC    CL9' '                   TERMINAL NAME          @G36XRNP 74280000
IDMEND   EQU   *                        MSG END                @G36XRNP 74310000
         DC    X'1000'                  DECSRIPTOR CODES       @G36XRNP 74340000
         DC    X'0020'                  ROUTING CODES          @G36XRNP 74370000
         CNOP  0,4                                             @G36XRNP 74400000
         DROP  R8                                              @G36XRNP 74430000
         USING IEDQOA,RBASE                                    @OY19405 74460082
         USING DISPATR,R6                                      @OY19405 74463082
DISPATR  L     R1,AVTDISTR              LOAD THE NUMBER  TRACE @OY19405 74466082
*                                         ENTRIES REQUESTED    @OY19405 74469082
         LA    R1,ONE(,R1)              INCREMENT THE COUNT 1  @OY19405 74472082
         SLL   R1,FOUR                  MULTIPLY THE NUMBER    @OY19405 74475082
*                                       ENTRIES BY THE ENTRY SZ@OY19405 74478082
         LR    R3,R1                    COPY THE TRACE SIZE    @OY19405 74481082
         LA    R0,AVTDISTR              LOAD THE ADDRESS OF THE@OY19405 74484082
*                                         RECEIVING AREA       @OY19405 74487082
         BAL   R14,AVTPAR               LINK TO THE GETMAIN    @OY19405 74490082
*                                              ROUTINE         @OY19405 74493082
         L     R2,AVTDISTR              LOAD THE ADDRESS OF THE@OY19405 74496082
*                                         TRACE AREA           @OY19405 74499082
         LR    R1,R3                    COPY THE SIZE          @OY19405 74502082
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *@OY19405 74505082
*                                                              @OY19405 74508082
*        CLEAR THE TRACE AREA                                  @OY19405 74511082
*                                                              @OY19405 74514082
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *@OY19405 74517082
*                                                              @OY19405 74520082
TRACLEAR EQU   *                                               @OY19405 74523082
         MVI   0(R2),AVTEZERO           CLEAR ONE BYTE         @OY19405 74526082
         LA    R2,ONE(,R2)              INCREMENT TRACE AREA   @OY19405 74529082
*                                         ADDRESS              @OY19405 74532082
         BCT   R1,TRACLEAR              DECREMENT THE COUNT    @OY19405 74535082
*                                         AND BRANCH           @OY19405 74538082
         L     R1,AVTDISTR              LOAD THE BEGINNING ADDR@OY19405 74541082
*                                         OF THE TRACE AREA    @OY19405 74544082
         LR    R4,R1                    COPY THE CONTROL WORD  @OY19405 74547082
*                                         ADDRESS              @OY19405 74550082
         LA    R1,16(,R1)               GET THE ADDRESS OF THE @OY19405 74553082
*                                         TRACE AREA ITSELF    @OY19405 74556082
         ST    R1,0(,R4)                STORE THE BEGIN ADDR   @OY19405 74559082
         ST    R1,4(,R4)                STORE IT ONCE MORE     @OY19405 74562082
         LA    R0,ENTRYSIZ              GET THE SIZE OF A TRACE@OY19405 74565082
*                                         ENTRY                @OY19405 74568082
         SR    R2,R0                    CALCULATE THE ADDRESS  @OY19405 74571082
*                                         OF THE LAST ENTRY    @OY19405 74574082
         ST    R2,8(,R4)                STORE THE ADDRESS IN   @OY19405 74577082
*                                         THE CONTROL LIST     @OY19405 74580082
         ST    R3,12(,R4)               STORE THE SIZE OF AREA @OY19405 74583082
*                                         IN THE CONTROL LIST  @OY19405 74586082
         B     TESTBUFT                   DO NEXT TEST         @OY19405 74589082
         DROP  R6                                              @OY19405 74592082
         EJECT                                                 @OY19405 74595082
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *@OY19405 74598082
         EJECT                                                          74601082
***************************************************************@OY19405 74604082
*        GET STORAGE FOR BUFFER TRACE.  THIS RTN IS BRANCHED   @OY19405 74607082
*        TOO, INSTEAD OF BEING INLINE, TO AVOID SETTING UP A   @OY19405 74610082
*        SECOND BASE REGISTER FOR THE MODULE.                  @OY19405 74613082
***************************************************************@OY19405 74616082
*                                                              @OY19405 74619082
BUFFRTN  EQU   *                                               @OY19405 74622082
         USING BUFFRTN,R6                                      @OY19405 74625082
         LH    R1,AVTBUENT              NO. OF TABLE ENTRIES   @OY19405 74628082
         LA    R1,ONE(R1)               ROUND UP TO AN EVEN ...@OY19405 74631082
         SRL   R1,ONE                   ... NUMBER IF ODD      @OY19405 74634082
         SLL   R1,ONE                                          @OY19405 74637082
         LR    R3,R1                    SAVE # ENTRIES         @OY19405 74640082
         LA    R5,BUFFTRSZ              FIXED TRACE ENTRY SIZE @OY19405 74643082
         AH    R5,AVTKEYLE              ADD KEY LEN            @OY19405 74646082
         LA    R5,X'1F'(R5)             ALIGN EACH ENTRY       @OY19405 74649082
         SRL   R5,5                     TO NEXT SIZE DIV BY    @OY19405 74652082
         SLL   R5,5                     HEX 20                 @OY19405 74655082
         MR    R0,R5                    LENGTH OF ENTRIES IN R1@OY19405 74658082
         LA    R1,2*HDRSZ+BUFFCTBL(R1)  TABLE SIZE = LENGTH OF @OY19405 74661082
*                                       ENTRIES + CONTROL AREA.@OY19405 74664082
*                                       + 2 HALF TABLE HEADERS.@OY19405 74667082
         LR    R5,R1                    SAVE TABLE SIZE        @OY19405 74670082
         LA    R0,AVTBUFTR              ADDR TO RECEIVE TABLE  @OY19405 74673082
*                                       ADDRESS FROM GETMAIN.  @OY19405 74676082
         BAL   R14,AVTPAR               LINK TO GETMAIN        @OY19405 74679082
         LR    R1,R5                    RESTORE TABLE SIZE     @OY19405 74682082
         USING IEDTRBUF,R2                                     @OY19405 74685082
         L     R2,AVTBUFTR              ADDRESS OF TRACE TABLE @OY19405 74688082
         LA    R5,CUR1                  FIRST TABLE ADDRESS    @OY19405 74691082
         ST    R5,CUR                   STORE IN CONTROL AREA  @OY19405 74694082
         LA    R5,BUFFCTBL(R2)          ADD. OF 1ST TABLE      @OY19405 74697082
         ST    R5,TABLE1                STORE IN CONTROL AREA  @OY19405 74700082
         LA    R1,0(R1,R2)              ADDRESS END OF TABLE   @OY19405 74703082
         ST    R1,CUR2+EIGHT            STORE AS LAST OF 2ND   @OY19405 74706082
         LR    R1,R3                    NUMBER OF ENTRIES      @OY19405 74709082
         LA    R3,BUFFTRSZ              GET THE SIZE           @OY19405 74712082
         AH    R3,AVTKEYLE              OF EACH TRACE ENTRY    @OY19405 74715082
         LA    R3,X'1F'(R3)             ALIGN                  @OY19405 74718082
         SRL   R3,5                          ENTRY             @OY19405 74721082
         SLL   R3,5                                SIZE        @OY19405 74724082
         MR    R2,R1                    ENTRIES * ENTRY SIZE   @OY19405 74727082
         SRL   R3,1                     DIVIDED BY TWO         @OY19405 74730082
         LA    R3,HDRSZ(R3)             PLUS HEADER SIZE       @OY19405 74733082
         LA    R1,HDRSZ(R5)             ADD IN HEADER SIZE     @OY19405 74736082
         L     R2,AVTBUFTR              RESTORE TABLE ADDRESS  @OY19405 74739082
         ST    R1,CUR1                  ADD. OF TABLE1 1ST ENT.@OY19405 74742082
         ST    R1,CUR1+FOUR             ADD. OF CURRENT ENTRY  @OY19405 74745082
         AR    R5,R3                    TABLE SIZE + 1ST TBL   @OY19405 74748082
         ST    R5,TABLE2                STORE TABLE2 ADDRESS   @OY19405 74751082
         ST    R5,CUR1+EIGHT            AND LAST ENTRY TABLE1  @OY19405 74754082
         LA    R5,HDRSZ(R5)             ADD HEADER SIZE        @OY19405 74757082
         ST    R5,CUR2                  FIRST ENTRY TABLE2     @OY19405 74760082
         ST    R5,CUR2+FOUR             CURRENT ENTRY TABLE2   @OY19405 74763082
         MVC   COUNT(4),AVTFZERO        CLEAR COUNT FIELD      @OY19405 74766082
         L     R3,TABLE1                GET START OF TABLE1    @OY19405 74769082
         L     R5,CUR2+EIGHT            GET END OF TABLE2      @OY19405 74772082
         SPACE                                                          74775082
* CLEAR TRACE TABLE                                            @OY19405 74778082
         SPACE                                                          74781082
TBLCLR   XC    0(HDRSZ,R3),0(R3)        CLEAR 16 BYTES         @OY19405 74784082
         LA    R3,HDRSZ(R3)             BUMP ADDRESS           @OY19405 74787082
         CR    R3,R5                    END OF TRACE TABLE     @OY19405 74790082
         BL    TBLCLR                   NO, LOOP               @OY19405 74793082
         SPACE                                                          74796082
         L     R3,TABLE1                GET TABLE1 START       @OY19405 74799082
         LA    R3,12(R3)                GET ADD. OF BUFFER ID  @OY19405 74802082
         MVI   0(R3),C'1'               MOVE IN BUFFER ID      @OY19405 74805082
         L     R3,TABLE2                GET TABLE2 START       @OY19405 74808082
         LA    R3,12(R3)                GET ADD. OF BUFFER ID  @OY19405 74811082
         MVI   0(R3),C'2'               MOVE IN BUFFER ID      @OY19405 74814082
         B     TPIOTRAC                 RETURN TO MAIN LINE    @OY19405 74817082
         DROP  R6                                              @OY19405 74820082
         DROP  R2                                              @OY19405 74823082
         EJECT                                                          74826082
ONE      EQU   1                        ONE                    @OY19405 74829082
TWO      EQU   2                        TWO                      S21903 74880000
SHIFT2   EQU   2                        SHIFT 2                  S21903 74910000
THREE    EQU   3                        THREE                    S21903 74940000
FOUR     EQU   4                        FOUR                     S21903 74970000
SIX      EQU   6                        SIX                      S21903 75000000
ROUND    EQU   7                        SEVEN                    S21903 75030000
NUM      EQU   8                        CHARACTERS/PASSWORD             75060000
EIGHT    EQU   8                        EIGHT                    S21903 75090000
TEN      EQU   10                       TEN                      S21903 75120000
TWELVE   EQU   12                       TWELVE                   S21903 75150000
FIFTEEN  EQU   15                       FIFTEEN                  S21903 75180000
SIXTEEN  EQU   16                       SIXTEEN                  S21903 75210000
THRTTWO  EQU   32                       CONSTANT OF THIRTY TWO   X01004 75240000
ENTRYSIZ EQU   16                       SIZE OF TRACE ENTRY      S21903 75270000
WORK     EQU   20                       SAVEAREA OFFSET TO WORKAREA     75300000
TWENTY   EQU   20                       TWENTY                   S21903 75330000
SENDACPT EQU   24                       SEND AND ACCEPT BITS            75360000
RETCDE   EQU   24                       RET CDE FOR ID SORT      S22026 75390000
ENTRYTYP EQU   X'E0'                    SINGLE ENTRY             S21903 75420000
IOTRCSIZ EQU   16                       SIZE OF I/O TRACE ENTRY  S21903 75450000
MQCBSIZE EQU   32                       MASTER QCB SIZE          S22027 75480000
PERCENT  EQU   100                      PERCENTAGE FACTOR               75510000
NOSWAP   EQU   X'00'                    TO RESET SWAP INDICATOR         75540000
HEXZERO  EQU   X'00'                    HEXADECIMAL ZERO         S21903 75570000
SECOPCTL EQU   X'01'                    SECONDARY OP CNTRL       S21903 75600000
BOUND8   EQU   X'08'                    EIGHT BYTE BOUNDARY.            75630000
XR       EQU   X'0F'                    BIT FLIPPER (4-7)               75660000
BOUND32  EQU   X'1F'                    32 BYTE BOUNDARY         S21903 75690000
ALTDSTER EQU   X'20'                    HEX 20                   S22024 75720000
VTO      EQU   X'26'                    COMMON BUFFER VTO        S22027 75750000
INVLSRTD EQU   X'40'                    HEX 40                   S22024 75780000
CDLSTNOW EQU   X'40'                    HEX 40                   S22024 75810000
CORDLIST EQU   X'40'                    HEX 40                   S22024 75840000
SINGLINE EQU   X'60'                    SINGLE OR LINE ENTRY     S21903 75870000
LOGTYPE  EQU   X'60'                    LOG ENTRY                S21903 75900000
TSOTERM  EQU   X'70'                    TO TEST FOR TSO TERMINAL        75930000
LGB      EQU   X'80'                    HEX 80                   S22024 75960000
LINE     EQU   X'80'                    HEX 80                   S22024 75990000
LGBLNCT  EQU   24                       TWENTY4                  S22024 76020000
SWAP     EQU   X'80'                    TO INDICATE SORT IN PROGRESS    76050000
ILISTNOW EQU   X'80'                    HEX 80                   S22024 76080000
ILISORTD EQU   X'80'                    HEX 80                   S22024 76110000
CONC     EQU   X'80'                    CONC OR ATTACHED TERM    S21903 76140000
ILISTOFF EQU   X'7F'                    HEX 7F                   S22024 76170000
NR       EQU   X'BF'                    NON-BLANK MASK                  76200000
CDLSTOFF EQU   X'BF'                    HEX BF                   S22024 76230000
IOTRCFLG EQU   X'C0'                    I/O TRACE FLAG           S21903 76260000
PRIORITY EQU   X'90'                    COMMBUF PRIORITY         S22027 76290000
VIRTFLG  EQU   X'80'                    VIRTUAL MACHINE        @YA10680 76320000
LOGREC   EQU   X'74'                    OFFSET TO LOGREC DCB   @YA10680 76350000
CCHPTR   EQU   X'0C'                    OFFSET TO CCH CAT      @YA10680 76380000
VMFLG    EQU   X'FF'                    VIRTUAL CPU            @YA10680 76410000
VMCODE   EQU   X'20'                    VM ERROR RETURN CODE   @YA10680 76440000
MSGX     EQU   MSG065+37                *****                    S22024 76470000
MSGC     EQU   MSG+16                   *****                    S22024 76500000
LCCWSZ   EQU   8                        SIZE OF VTAM LCCW        X03039 76530000
IEDTRBUF DSECT                                                 @OY19405 76532082
CUR      DS    AL4                 TABLE BEING USED            @OY19405 76534082
TABLE1   DS    AL4                                             @OY19405 76536082
TABLE2   DS    AL4                                             @OY19405 76538082
CUR1     DS    AL4                 CURRENT ENTRY TABLE ONE     @OY19405 76540082
         DS    AL4                 FIRST ENTRY POINTER         @OY19405 76542082
         DS    AL4                 LAST ENTRY POINTER          @OY19405 76544082
CUR2     DS    AL4                 POINTERS FOR TABLE TWO      @OY19405 76546082
         DS    AL4                 FIRST                       @OY19405 76548082
         DS    AL4                 LAST                        @OY19405 76550082
COUNT    DS    AL4                 COUNT OF TABLES USED        @OY19405 76552082
IEDTREND DS    0H                                                       76554082
BUFFTRSZ EQU   X'18'               BUFFER TRACE ENTRY SIZE     @OY19405 76556082
BUFFCTBL EQU   IEDTREND-IEDTRBUF   SIZE OF CONTROL TABLE       @OY19405 76558082
         EJECT                                                          76560000
         TAVTD                                                          76590000
         TCPBD 3330                                                     76620000
         IEDCMB                                                  S22027 76650000
GETD     DSECT                                                 @Y17XANG 76680000
GETSAVE  DS    3A                       REGISTER SAVE          @Y17XANG 76710000
GETSVCUR DS    A                        CURRENT SORT POSITION  @Y17XANG 76740000
GETLGB   DS    2A                       LGB ADDRESS SAVE       @Y17XANG 76770000
*                                       MUST BE 2 WORDS AND    @Y17XANG 76800000
*                                       ALWAYS PRECEED 1ST     @Y17XANG 76830000
*                                       LINE ENTRY.            @Y17XANG 76860000
GETFIRST DS    0CL8                     SORT TABLE ENTRY       @Y17XANG 76890000
GETTTE   DS    A                                               @Y17XANG 76920000
GETTTCIN DS    H                                               @Y17XANG 76950000
GETRLN   DS    H                                               @Y17XANG 76980000
         EJECT                                                          77010000
         TLCBD                                                   X03039 77040000
         SPACE 2                                                        77070000
         TTRMD                                                          77100000
         TTNTD                          TERMNAME TABLE MACRO            77130000
         EJECT                                                          77160000
TTRCCTLD DSECT                          TPIO TRACE CONTROL AREA  X03039 77190000
TTRCCURR DS    F                        CURRENT ENTRY ADDRESS    X03039 77220000
TTRCFRST DS    F                        FIRST ENTRY ADDRESS      X03039 77250000
TTRCLAST DS    F                        LAST ENTRY ADDRESS       X03039 77280000
TTRCFLGS DS    XL1                      FLAGS                  @XA07498 77310000
TTRCTSYS EQU   X'10'                    TRACE TOTAL SYSTEM BIT @XA07498 77340000
TTRCRTNA DS    AL3                      TPIO TRACE RTN ADDRESS @XA07498 77370000
TTRCMIDL DS    F                        MIDDLE ENTRY ADDRESS     X03039 77400000
TTRCLNTH DS    F                        LENGTH OF EACH HALF-TABLEX03039 77430000
TTRCEND  DS    0H                       END OF CONTROL AREA      X03039 77460000
*                                                                X03039 77490000
CNTRLSZ  EQU   TTRCEND-TTRCCTLD         SIZE OF CONTROL AREA     X03039 77520000
HDRSZ    EQU   16                       SIZE OF HALF-TABLE HEADERX03039 77550000
ENTRYSZ  EQU   32                       SIZE OF PIU TRACE ENTRY@Y17XANG 77580000
         EJECT                                                          77610000
         TQCBD                          QCB DSECT                       77640000
         TQCBED                                                  S22026 77670000
         TDVCIDTD                                                S22026 77700000
         DCBD  DSORG=TX                                                 77730000
         TLGBD                                                 @Y17XANG 77760000
         TTSID                                                          77790000
         EJECT                                                          77820000
CVTDSECT CVT   DSECT=YES                                                77850000
         END                                                            77880000
